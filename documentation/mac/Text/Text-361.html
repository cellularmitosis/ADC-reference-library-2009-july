<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Controlling Settings(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING361></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-360.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-362.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-354.html"><B>Chapter 6 - Script Manager</B></A> / <A HREF="Text-359.html"><B>Using the Script Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING361-0></A>
<H2>Controlling Settings</H2>
 The first principal use for the Script Manager is in controlling the settings that determine the current characteristics of the text-handling environment. The Script Manager gives you access to many variables, fields, flags, and files that affect how script systems function and how text is manipulated and displayed. The routines described in this section are of general interest and are used by most text applications. You can use these Script Manager routines to<P>
<UL>
<LI>set the system direction
<LI>access Script Manager variables
<LI>access script variables
<LI>determine the keyboard script, keyboard layout, and input method<P>
</UL>
<A NAME=HEADING361-6></A>
<H3>Checking and Setting the System Direction</H3>
 <A NAME=MARKER-2-36></A>The <B>system direction </B>is a global setting that is commonly used to define the primary line direction for text display. The system direction is specified by the value of the global variable <CODE>SysDirection</CODE>. The value of <CODE>SysDirection</CODE> is 0 for a left-to-right primary line direction and -1 for a right-to-left primary line direction.<P>
 System direction always controls the alignment (right or left) of interface elements such as menu items and dialog box items that are drawn by the system. It can also affect caret placement and the order in which blocks of text are drawn or highlighted in bidirectional script runs and in multiscript lines.<P>
 QuickDraw, TextEdit, and other parts of system software that use TextEdit set the system direction before drawing text. Although applications can format and draw text independently of the current value of system direction, applications that follow suggested procedures for text layout typically set the system direction before laying out and drawing any text. See, for example, the description of the <CODE>GetFormatOrder</CODE> function in the chapter "QuickDraw Text" in this book.<P>
 The default value for <CODE>SysDirection</CODE> usually corresponds to the primary line direction of the system script; it is initialized from the system's international configuration (<CODE>'itlc'</CODE>) resource at startup. The user can change the system direction from the Text control panel if a bidirectional script system is present.<A NAME=MARKER-2-66></A><P>
 If your application uses <CODE>SetSysDirection</CODE> to change the system direction in order to correctly order script runs in a line of text while drawing, be sure to first call <CODE>GetSysDirection</CODE> to save the original value. Then call <CODE>SetSysDirection</CODE> again at the appropriate time--such as when your application becomes inactive--to restore <CODE>SysDirection</CODE> to its original value.<A NAME=MARKER-2-658></A>   <P>
<A NAME=HEADING361-12></A>
<H3>Checking and Setting Script Manager Variables</H3>
 <A NAME=MARKER-2-79></A>The <CODE>GetScriptManagerVariable</CODE> and <CODE>SetScriptManagerVariable</CODE> functions let you check and set the values of the Script Manager variables, general environmental settings that the Script Manager maintains for all script systems.<P>
 These functions give you access to a large variety of general script-related information, including whether one or more bidirectional script systems is present, whether one or more 2-byte script systems is present, and what the states of the font force and international resources selection flags are.<P>
 <A NAME=MARKER-2-12></A>You specify the variable you want to access with a <B>selector,</B> an integer constant that controls the function of a multipurpose routine. You pass a selector as a parameter to <CODE>GetScriptManagerVariable</CODE> or <CODE>SetScriptManagerVariable</CODE>. (The variables themselves are private and you cannot access them directly.) <A HREF=#MARKER-9-46>Table 6-3</A> lists the selector constants and the Script Manager variables they affect. See <A HREF=Text-371.html#MARKER-9-798>"Selectors for Script Manager Variables" beginning on page 6-61</A> for complete explanations of the selectors and variables.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-46></A>Script Manager variables accessed through <CODE>GetScriptManagerVariable/SetScriptManagerVariable</CODE> (Continued)</CAPTION>
<TH>Selector constant<TH>Explanation<TR>
<TD><A NAME=MARKER-2-43></A>smVersion<TD>Script Manager <A NAME=MARKER-2-46></A>version number<TR>
<TD><A NAME=MARKER-2-47></A>smMunged<TD><A NAME=MARKER-2-55></A>Modification count<TR>
<TD><A NAME=MARKER-2-56></A>smEnabled<TD><A NAME=MARKER-2-81></A>Script count (0 if Script Manager not enabled)<TR>
<TD><A NAME=MARKER-2-89></A>smBidirect<TD><A NAME=MARKER-2-205></A>Bidirectional script present flag<TR>
<TD><A NAME=MARKER-9-220></A>smFontForce<TD><A NAME=MARKER-2-9></A>Font force flag<TR>
<TD><A NAME=MARKER-2-257></A>smIntlForce<TD><A NAME=MARKER-2-158></A>International resources selection flag<TR>
<TD><A NAME=MARKER-2-133></A>smForced<TD><A NAME=MARKER-2-128></A>Script-forced result flag<TR>
<TD><A NAME=MARKER-2-130></A>smDefault<TD><A NAME=MARKER-2-131></A>Script-defaulted result flag<TR>
<TD><A NAME=MARKER-2-184></A>smPrint<TD><A NAME=MARKER-2-37></A>Print action vector<TR>
<TD><A NAME=MARKER-2-354></A>smSysScript<TD><A NAME=MARKER-2-392></A>System script code<TR>
<TD><A NAME=MARKER-2-58></A>smLastScript<TD><A NAME=MARKER-2-23></A>Previous keyboard script<TR>
<TD><A NAME=MARKER-8-22></A>smKeyScript<TD><A NAME=MARKER-2-25></A>Current keyboard script<TR>
<TD>smSysRef<TD><A NAME=MARKER-8-86></A>System Folder volume reference number<TR>
<TD>smKeyCache<TD>(obsolete, not used)<TR>
<TD><A NAME=MARKER-2-134></A>smKeySwap<TD><A NAME=MARKER-9-11></A>Handle to keyboard-swap (<CODE>'KSWP'</CODE>) resource<TR>
<TD><A NAME=MARKER-8-88></A>smGenFlags<TD><A NAME=MARKER-2-32></A>Script Manager general flags<TR>
<TD colspan=2>&nbsp;<TR>
<TD><A NAME=MARKER-8-89></A>smOverride<TD><A NAME=MARKER-2-146></A>Script override flags (reserved)<TR>
<TD><A NAME=MARKER-8-90></A>smCharPortion<TD><A NAME=MARKER-2-286></A>Intercharacter/interword spacing proportion<TR>
<TD><A NAME=MARKER-2-370></A>smDoubleByte<TD>2-byte script present flag<TR>
<TD><A NAME=MARKER-8-92></A>smKCHRCache<TD>Pointer to current keyboard-layout (<CODE>'KCHR'</CODE>) data<TR>
<TD><A NAME=MARKER-8-93></A>smRegionCode<TD><A NAME=MARKER-2-174></A>Region code for system script<TR>
<TD><A NAME=MARKER-2-159></A>smKeyDisableState<TD><A NAME=MARKER-2-478></A>Current disable state for keyboards<A NAME=MARKER-2-45></A></TABLE>
<P>
 The following code fragment shows how to use the <CODE>GetScriptManagerVariable</CODE> function to get the Script Manager version number. This is the same value as that returned by the <CODE>Gestalt</CODE> function using the <CODE>gestaltScriptMgrVersion</CODE> selector.<P>
<PRE>
VAR
   selectorValue: LongInt;
BEGIN
   selectorValue := GetScriptManagerVariable(smVersion);
END;
</PRE>
 The <CODE>SetScriptManagerVariable</CODE> function allows you to change many text-related settings, including<P>
<UL>
<LI>the font force flag
<LI>the international resources selection flag
<LI>the current keyboard script
<LI>the Script Manager general flags, which include control of the display of the keyboard icon and the dual caret in TextEdit
<LI>the proportion of intercharacter versus interword spacing, when laying out lines of justified text (in non-Roman script systems)<P>
</UL>
 <A HREF=#MARKER-9-661>Listing 6-1</A> shows how to use the <CODE>SetScriptManagerVariable</CODE> function to specify the display of a dual caret in mixed-directional text. You do this by setting the appropriate bit of the Script Manager general flags field after retrieving it with the <CODE>GetScriptManagerVariable</CODE> function.<P>
<B>Listing 6-1  <A NAME=MARKER-9-661></A>Specifying a dual caret with <CODE>SetScriptManagerVariable</CODE></B><P>
<PRE>
FUNCTION MySetDualCaret: OSErr;
VAR
   myErr:         OSErr;
   selectorValue: LongInt;
   flagValue:     LongInt;
BEGIN
   flagValue := BitShift($0001,smfDualCaret);
   selectorValue := GetScriptManagerVariable(smGenFlags);
   selectorValue := BitOr(selectorValue, flagValue);
   myErr := SetScriptManagerVariable(smGenFlags, selectorValue);
   MySetDualCaret := myErr;
END;
</PRE>
 You can also use <CODE>SetScriptManagerVariable</CODE> to change the settings of the font force flag and the international resources selection flag, two flags that affect which script systems are used for text display and date/time/number formatting, respectively. See <A HREF=Text-362.html#MARKER-9-678>"Determining Script Codes From Font Information" beginning on page 6-21</A>.<P>
 If you are using <CODE>SetScriptManagerVariable</CODE> to change the value of a variable for a specific task, first call <CODE>GetScriptManagerVariable</CODE> to retrieve the variable's original value, and save that value. Then call <CODE>SetScriptManagerVariable</CODE> and perform your task. Finally, restore the original value of the Script Manager variable with another call to <CODE>SetScriptManagerVariable</CODE> as soon as possible, so that other applications or software components that use the Script Manager will find the values they expect.<A NAME=MARKER-2-662></A><P>
<A NAME=HEADING361-29></A>
<H3>Checking and Setting Script Variables</H3>
 <A NAME=MARKER-2-37></A>The <CODE>GetScriptVariable</CODE> and <CODE>SetScriptVariable</CODE> functions let you retrieve and set script variables, local variables maintained for each script system by the Script Manager.<P>
 These functions give you access to a large variety of script-specific information, including the primary line direction for the script system, the default alignment for text in the script system, the script system's preferred system font and size, and its preferred application font and size.<P>
 You specify the script system whose variables you want to access with an explicit script code, or with an implicit script code specifying the system script or the font script. You specify the variable you want to access with a selector constant passed as a parameter to <CODE>GetScriptVariable</CODE> or <CODE>SetScriptVariable</CODE>. <A HREF=#MARKER-9-46>Table 6-3</A> lists the selector constants and the script variables they affect. See <A HREF=Text-372.html#MARKER-9-847>"Selectors for Script Variables" beginning on page 6-65</A> for complete explanations of the selectors and variables.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-46></A>Script variables accessed through <BR><CODE>GetScriptVariable/SetScriptVariable</CODE> (Continued)</CAPTION>
<TH><A NAME=MARKER-2-597></A>Selector constant<TH>Explanation<TR>
<TD><A NAME=MARKER-2-308></A>smScriptVersion<TD>Script-system <A NAME=MARKER-2-10></A>version number<TR>
<TD><A NAME=MARKER-2-175></A>smScriptMunged<TD>Modification count<TR>
<TD><A NAME=MARKER-2-448></A>smScriptEnabled<TD><A NAME=MARKER-2-81></A>Script-enabled flag<TR>
<TD><A NAME=MARKER-2-104></A>smScriptRight<TD><A NAME=MARKER-8-104></A>Right-to-left line direction flag<TR>
<TD><A NAME=MARKER-2-318></A>smScriptJust<TD><A NAME=MARKER-2-204></A>Default alignment (left or right)<TR>
<TD><A NAME=MARKER-2-300></A>smScriptRedraw<TD><A NAME=MARKER-2-305></A>Amount of line to redraw when changing a character<TR>
<TD><A NAME=MARKER-2-404></A>smScriptSysFond<TD>Preferred system font<TR>
<TD><A NAME=MARKER-2-113></A>smScriptAppFond<TD>Preferred <A NAME=MARKER-2-248></A>application font<TR>
<TD><A NAME=MARKER-2-136></A>smScriptNumber<TD>Numeric-format (<A NAME=MARKER-2-604></A><CODE>'itl0'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-2-126></A>smScriptDate<TD>Long-date-format (<A NAME=MARKER-2-160></A><CODE>'itl1'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-8-111></A>smScriptSort<TD>String-manipulation (<CODE>'itl2'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-8-112></A>smScriptFlags<TD><A NAME=MARKER-2-69></A>Script flags<TR>
<TD><A NAME=MARKER-2-323></A>smScriptToken<TD>Tokens (<A NAME=MARKER-2-541></A><CODE>'itl4'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-2-111></A>smScriptEncoding<TD>Encoding/rendering (<A NAME=MARKER-2-464></A><CODE>'itl5'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-2-468></A>smScriptLang<TD>Language code for script<TR>
<TD><A NAME=MARKER-8-116></A>smScriptNumDate<TD><A NAME=MARKER-2-77></A>Current numeral code and calendar code<TR>
<TD><A NAME=MARKER-8-117></A>smScriptKeys<TD>Keyboard-layout (<A NAME=MARKER-2-79></A><CODE>'KCHR'</CODE>) resource ID<TR>
<TD><A NAME=MARKER-8-118></A>smScriptIcon<TD>Keyboard icon family ID<TR>
<TD><A NAME=MARKER-8-119></A>smScriptPrint<TD>Print action routine for script<TR>
<TD><A NAME=MARKER-8-120></A>smScriptTrap<TD>Pointer to script record dispatch routine entry point (for internal use)<TR>
<TD><A NAME=MARKER-8-121></A>smScriptCreator<TD>Creator name for script file<TR>
<TD>smScriptFile<TD><A NAME=MARKER-8-123></A>Filename for script file<B></B><TR>
<TD>smScriptName<TD><A NAME=MARKER-8-124></A>Name of script system<TR>
<TD>smScriptMonoFondSize<TD>Preferred font and size for <A NAME=MARKER-8-125></A>fixed-width font<TR>
<TD>smScriptPrefFondSize<TD>(unused)<B></B><TR>
<TD><A NAME=MARKER-8-126></A>smScriptSmallFondSize<TD>Preferred font family and size for <A NAME=MARKER-2-96></A>small text<TR>
<TD><A NAME=MARKER-8-127></A>smScriptSysFondSize<TD>Preferred <A NAME=MARKER-2-98></A>system font family and size<TR>
<TD><A NAME=MARKER-8-128></A>smScriptAppFondSize<TD>Preferred <A NAME=MARKER-2-100></A>application font family and size<TR>
<TD><A NAME=MARKER-8-129></A>smScriptHelpFondSize<TD>Preferred Balloon <A NAME=MARKER-2-102></A>Help font family and size<TR>
<TD>smScriptValidStyles<TD>Valid text <A NAME=MARKER-8-131></A>styles for script<TR>
<TD>smScriptAliasStyle<TD>Text <A NAME=MARKER-8-132></A>styles to use for aliases<A NAME=MARKER-2-107></A></TABLE>
<P>
 You can use the <CODE>GetScriptVariable</CODE> function to get, for example, the default application font family (<CODE>'FOND'</CODE>) ID and size. In the following code fragment, the application uses the constant <CODE>smSystemScript</CODE> to specify that it is the system script whose font ID is needed. The ID is returned in the high-order word and the size is returned in the low-order word. The application then sets the appropriate graphics port fields to those values.<P>
<PRE>
VAR
   myAppFont: LongInt;
BEGIN
   myAppFont := GetScriptVariable(smSystemScript, 
                                    smScriptAppFondSize);
   TextFont(HiWord(myAppFont));
   TextSize(LoWord(myAppFont));
END;
</PRE>
 <A HREF=#MARKER-9-665>Listing 6-2</A> shows how to represent font names correctly using the proper script for that font. First you call the Font Manager <CODE>GetFNum</CODE> procedure to get the font family ID using the font name. You call the <CODE>FontToScript</CODE> function using that font family ID to get the value of the associated script code. You then call <CODE>GetScriptVariable</CODE> with the <CODE>smScriptSysFond</CODE> selector to determine the font family ID for the preferred system font for the specified script. Finally, you call the QuickDraw <CODE>TextFont</CODE> procedure with that font family ID to set the font ID of the current graphics port to the preferred system font of the specified script.<P>
<DL>
<DT><B>Note</B>
<DD>The Menu Manager <CODE>AddResMenu</CODE> procedure automatically represents font names in their associated script for <CODE>'FOND'</CODE> resources. If you need to display font names elsewhere than in the Font menu (for instance, using the List Manager), be sure to use a technique such as that shown in <A HREF=#MARKER-9-665>Listing 6-2</A>.<EM></EM><A NAME=MARKER-2-664></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<B>Listing 6-2  <A NAME=MARKER-9-665></A>Representing font names correctly in the script for that font</B><P>
<PRE>
PROCEDURE MySetTextFont(fontName: Str255);
VAR
   scriptFont: LongInt;
   scriptNum:  Integer;
   theNum:     Integer;

BEGIN
                              {from font name, get font ID}
   GetFNum(fontName, theNum); {use font ID to get script code, }
                              { then get preferred system font ID}

   scriptNum := FontToScript(theNum);
   scriptFont := GetScriptVariable(scriptNum, smScriptSysFond);

                              {now set the current grafPort's }
   TextFont(scriptFont);      { font ID to that font}
END;
</PRE>
 <A NAME=MARKER-2-666></A>The <CODE>SetScriptVariable</CODE> function allows you to change many script-specific settings, including the default configuration settings for the script system, which are initialized from a script system's international bundle (<CODE>'itlb'</CODE>) resource. You call <CODE>SetScriptVariable</CODE> with the appropriate script constant and selector to indicate the setting you want changed. <A HREF=#MARKER-9-667>Listing 6-3</A> shows how to use the <CODE>SetScriptVariable</CODE> function to set the size of the Balloon Help font to the size passed in the parameter <CODE>theSize</CODE>:<P>
<B>Listing 6-3  <A NAME=MARKER-9-667></A>Setting the size of the Balloon Help font</B><P>
<PRE>
PROCEDURE MySetHelpFontSize(theSize: LongInt);
VAR
   myErr:         OSErr;
   myHelpFont:    LongInt;

BEGIN
   theSize := BitAnd(theSize, $0000FFFF);
                                       {keep low word only}
   myHelpFont := GetScriptVariable(smSystemScript, 
                                    smScriptHelpFondSize);
   myHelpFont := BitAnd(myHelpFont, $FFFF0000);
                                       {keep high word only}
   myErr := SetScriptVariable(smSystemScript, 
                              smScriptHelpFondSize,
                              BitOr(myHelpFont,theSize));
   IF myErr &lt;&gt; noErr THEN DoError(myErr);
END;
</PRE>
 If you are using <CODE>SetScriptVariable</CODE> to change the value of a variable for a specific task, first call <CODE>GetScriptVariable</CODE> to retrieve the variable's original value, and save it. Then call <CODE>SetScriptVariable</CODE> and perform your task. Finally, restore the original value of the script variable with another call to <CODE>SetScriptVariable</CODE> as soon as possible, so that other applications or software components using that script system will find the values they expect.<A NAME=MARKER-9-1></A><P>
<A NAME=HEADING361-43></A>
<H3><A NAME=MARKER-9-669></A>Making Keyboard Settings</H3>
 <A NAME=MARKER-9-39></A>The Script Manager <CODE>KeyScript</CODE> procedure lets you control the script system, keyboard layout, and input method used for text input. It also lets you make other settings related to text input.<P>
 You use the <CODE>KeyScript</CODE> procedure to change the keyboard script, the script system that controls text input. You also use it to switch among different keyboard layouts, resources that define the character sets and key positions for text input in a script system. You can also use it to switch among input methods, software facilities that allow text input in 2-byte script systems. If your application supports multiple languages, use <CODE>KeyScript</CODE> to change the keyboard script when the user changes the current font. For example, if the user selects Geezah as the current font or clicks the cursor within a run of text that uses the Geezah font, your application needs to set the keyboard script to Arabic. To do this, use the <CODE>FontToScript</CODE> function to find the script for the font, then use <CODE>KeyScript</CODE> to set the keyboard.<P>
 In addition, your application can check the keyboard script (using the <CODE>GetScriptManagerVariable</CODE> function) in its main event loop; if the keyboard script has changed, you can set the current font to the last-used font, application font, or system font of the new keyboard script (determined by a call to the <CODE>GetScriptVariable</CODE> function). This action saves the user from having to set the font manually after changing the keyboard script.<P>
 <A NAME=MARKER-2-671></A>The system software performs the equivalent of calling <CODE>KeyScript</CODE> in response to the user selecting a keyboard layout or input method from the Keyboard menu. It also does the same when the user types Command-Option-Space bar (to select the next keyboard layout or input method within the same script system), or Command-Space bar (to select the next script system in the Keyboard menu).<P>
 When you call <CODE>KeyScript</CODE>, you pass it a <CODE>code</CODE> parameter that can explicitly specify a keyboard script by script code, or can implicitly specify a keyboard script, keyboard layout, input method, or other setting. Values for <CODE>code</CODE> equal to or greater than zero are interpreted as normal script codes. Several negative codes specify switching among keyboard scripts, keyboard layout, or input methods. Others toggle line direction or input method and are available only with certain script systems. Still others disable or enable keyboard layouts or keyboard scripts. <A HREF=#MARKER-9-571>Table 6-5</A> lists the valid constants for the <CODE>code</CODE> parameter.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-571></A>Constants for the <CODE>code<A NAME=MARKER-2-572></A></CODE> parameter in the <CODE>KeyScript</CODE> procedure (Continued)</CAPTION>
<TH>Constant<TH>Value<TH>Expanation<TR>
<TD>(any script code)<TD>0...64<TD>Switch to specified script<TR>
<TD><A NAME=MARKER-2-573></A>smKeyNextScript<TD> -1<TD>Switch to next script in Keyboard menu<TR>
<TD><A NAME=MARKER-2-574></A>smKeySysScript<TD> -2<TD>Switch to the system script<TR>
<TD><A NAME=MARKER-2-575></A>smKeySwapScript<TD> -3<TD>Switch to previously used script<TR>
<TD><A NAME=MARKER-2-576></A>smKeyNextKybd<TD> -4<TD>Switch to next keyboard layout or input method in Keyboard menu (within current script)<TR>
<TD><A NAME=MARKER-2-577></A>smKeySwapKybd<TD> -5<TD>(not implemented)<TR>
<TD><A NAME=MARKER-2-578></A>smKeyDisableKybds<TD> -6<TD>Disable keyboard layouts not in system script or Roman script<TR>
<TD><A NAME=MARKER-2-579></A>smKeyEnableKybds<TD> -7<TD>Enable keyboard layouts for all <BR>enabled scripts<TR>
<TD><A NAME=MARKER-2-580></A>smKeyToggleInline<TD> -8<TD>Toggle inline input for current script (available if 2-byte script present)<TR>
<TD><A NAME=MARKER-2-581></A>smKeyToggleDirection<TD> -9<TD>Toggle default line direction (available if bidirectional script present)<TR>
<TD><A NAME=MARKER-2-582></A>smKeyNextInputMethod<TD> -10<TD>(not implemented)<TR>
<TD><A NAME=MARKER-2-583></A>smKeySwapInputMethod<TD> -11<TD>(not implemented)<TR>
<TD><A NAME=MARKER-2-584></A>smKeyDisableKybdSwitch<TD>-12<TD>Disable switching out of current <BR>keyboard layout<TR>
<TD><A NAME=MARKER-2-585></A>smKeySetDirLeftRight<TD>-15<TD>Set primary line direction to left-to-right (available if bidirectional script present)<TR>
<TD><A NAME=MARKER-2-586></A>smKeySetDirRightLeft<TD>-16<TD>Set primary line direction to right-to-left (available if bidirectional script present)<TR>
<TD><A NAME=MARKER-2-587></A>smKeyRoman<TD>-17<TD>Set keyboard script to Roman (available only if multiple scripts present)</TABLE>
<P>
 The <CODE>smKeyDisableKybds</CODE> selector is available for your use, although it is primarily used by the Finder or other parts of the system under special circumstances. For example, when the user enters the name of a file in a Standard-File dialog box, text input must be restricted to scripts that display correctly in the Finder and in dialog boxes, menus, and alert boxes. In that situation the system software calls <CODE>KeyScript</CODE> with the <CODE>smKeyDisableKybds</CODE> selector to disable keyboard input temporarily in any script system except Roman or the system script. Keyboards in other script systems then appear disabled in the Keyboard menu. When the user completes the filename entry, the system calls <CODE>KeyScript</CODE> again with a selector of <CODE>smKeyEnableKybds</CODE> to reenable keyboard input in all enabled script systems.<P>
 The <CODE>smKeyDisableKybdSwitch</CODE> selector is also available for your use, although it is primarily used by the Finder. When keyboard layouts and script systems are being moved into or out of the System file by the user, changing the current keyboard or keyboard script may corrupt files or cause other unpredictable results. To prevent all keyboard switching and to disable all the Keyboard menu items, the Finder calls <CODE>KeyScript</CODE> with the selector <CODE>smKeyDisableKybdSwitch</CODE>. When the move has been completed, the Finder again calls <CODE>KeyScript</CODE> with a selector of <CODE>smKeyEnableKybds</CODE> to reenable keyboard switching.<P>
 If you call <CODE>KeyScript</CODE> with <CODE>code</CODE> = smKeyRoman on a system in which only the Roman script system is enabled, nothing happens. However, if you call <CODE>KeyScript</CODE> with <CODE>code</CODE> = 0 (to select the Roman script system), it forces an update that selects the current default Roman keyboard layout.<A NAME=MARKER-2-278></A><P>
<DL>
<DT><B>IMPORTANT</B>
<DD>Although it is possible to change the keyboard script without changing the keyboard layout--by calling the <CODE>SetScriptManagerVariable</CODE> function with the <CODE>smKeyScript</CODE> selector--it violates the user interface paradigm and creates problems for other script management routines.<EM></EM><A NAME=MARKER-2-673></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING361-53></A>
<H3>Synchronizing the Font Script and Keyboard Script</H3>
 <A NAME=MARKER-2-674></A>To keep the user from accidentally entering meaningless characters, you must always keep the keyboard script synchronized with the font script, so that the glyphs displayed on the screen match the characters entered at the keyboard. You can synchronize the scripts in two ways: by setting the keyboard script when the font script changes, and by setting the font script when the keyboard script changes.<P>
<A NAME=HEADING361-55></A>
<H4>Setting the Keyboard Script From the Font Script</H4>
 Set the keyboard script from the font script when the user selects a new font or when the user clicks in or selects text.<P>
<UL>
<LI>If the user selects a new font from the Font menu, call <CODE>TextFont</CODE> to set the current font to that font. Then set the keyboard script to the script system of that font.
<LI>If the user clicks in or selects a text area, set the current font to be the font, size, and style of the text where the click occurred. Then set the keyboard script to the script system of that font.<P>
</UL>
 <A HREF=#MARKER-9-675>Listing 6-4</A> is an example of code to use for setting the keyboard script from the font script. Once you have obtained the script code value from the font family ID using the <CODE>FontToScript</CODE> function (see <A HREF=Text-362.html#MARKER-9-678>"Determining Script Codes From Font Information" beginning on page 6-21</A>), you call the <CODE>GetScriptManagerVariable</CODE> function with the <CODE>smKeyScript</CODE> selector to determine the keyboard script. If the font script and the keyboard script are not the same, call the <CODE>KeyScript</CODE> procedure to change the keyboard script.<P>
<B>Listing 6-4  <A NAME=MARKER-9-675></A>Setting the keyboard script from the font script</B><P>
<PRE>
PROCEDURE MySetKeyboardFromFont(myFont: Integer);
VAR
   theFontScript: Integer;

BEGIN
                              {get script code from font ID.}
   theFontScript := FontToScript(myFont);
                              {compare with keyboard script, }
                              { change if necessary}
   IF (GetScriptManagerVariable(smKeyScript) &lt;&gt; 
                                       theFontScript) THEN
      KeyScript(theFontScript);
END;
</PRE>
<A NAME=HEADING361-63></A>
<H4>Setting the Font Script From the Keyboard Script</H4>
 Each time the user types a character other than a control character, your application should check that the font script is still the same as the keyboard script. The user may have, for example, switched keyboard scripts since entering the last character. If the font script does not match the keyboard script, change the current font to correspond to the new keyboard script before displaying the character. Follow these guidelines:<P>
<UL>
<LI>If possible, set the current font to the previous font that was used for that script (that is, the last font for that script preceding the current point in the document or text buffer).
<LI>Otherwise, set the font to one of the preferred fonts for that script system. The preferred fonts are the preferred application font, the preferred system font, the preferred monospaced font, and the preferred small font. (The ID numbers of these fonts can be obtained through the <CODE>GetScriptVariable</CODE> function.)<P>
</UL>
 <A HREF=#MARKER-9-676>Listing 6-5</A> is an example of setting the font (and therefore the font script) from the keyboard script. It calls <CODE>GetScriptManagerVariable</CODE> with the <CODE>smKeyScript</CODE> selector to determine the current keyboard script. It then calls <CODE>FontToScript</CODE> to determine whether the keyboard script differs from the font script. If it does, the routine calls <CODE>GetScriptVariable</CODE> with the <CODE>smScriptAppFond</CODE> selector to determine the application font for the script. Then it sets the current font based on that result.<P>
<B>Listing 6-5  <A NAME=MARKER-9-676></A>Setting the font (script) from the keyboard script</B><P>
<PRE>
PROCEDURE MySetFontFromKeyboard(VAR myFont: Integer);
VAR
   scriptNum:  LongInt;

BEGIN
   scriptNum := GetScriptManagerVariable(smKeyScript);
   IF (FontToScript(myFont) &lt;&gt; scriptNum) THEN
      myFont := GetScriptVariable(scriptNum, smScriptAppFond);
   TextFont(myFont)
END;
</PRE>
 You can also use this code if your application does not have an interface that lets users change fonts but still needs to provide for different script systems<A NAME=MARKER-2-677></A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-360.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-362.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
