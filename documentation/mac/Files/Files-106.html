<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Extents Overflow Files (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING106></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-105.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-107.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-99.html"><B>Data Organization on Volumes</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING106-0></A>
<H2><A NAME=MARKER-9-602></A>Extents Overflow Files</H2>
 <A NAME=MARKER-2-603></A>The File Manager keeps track of which allocation blocks belong to a file by maintaining a list of contiguous disk segments that belong to that file, in the appropriate order. When the list of disk segments gets too large, some of those segments (or extents) are stored on disk in a file called the <B>extents overflow file.</B><P>
 The structure of an extents overflow file is relatively simple compared to that of a catalog file. The function of the extents overflow file is to store those file extents that are not contained in the MDB or VCB (in the case of the catalog and extents overflow files themselves) or in an FCB (in the case of all other files). Because the first three file extents are always maintained in memory (in a VCB or an FCB), the File Manager needs to read the extents overflow file only to retrieve any file extents beyond the first three; if a file has at most three extents, the File Manager never needs to read the disk to find the locations of the file's blocks. (This is one good reason to promote file block contiguity.)<P>
 An <B>extent</B> is a contiguous range of allocation blocks that have been allocated to some file. You can represent the structure of an extent using an <B>extent descriptor,</B> defined by the ExtDescriptor data type.<A NAME=MARKER-2-604></A><A NAME=MARKER-2-605></A><A NAME=MARKER-2-606></A><P>
<PRE>
TYPE ExtDescriptor      =        {extent descriptor}
RECORD
   xdrStABN:      Integer;       {first allocation block}
   xdrNumABlks:   Integer;       {number of allocation blocks}
END;
</PRE>
 An extent descriptor record consists of the first allocation block of the extent, followed by the number of allocation blocks in that extent. The File Manager prefers to access extent descriptors in groups of three; to do so, it uses the <B>extent data record,</B> defined by the <CODE>ExtDataRec</CODE> data type.<A NAME=MARKER-2-607></A><A NAME=MARKER-2-608></A><P>
<PRE>
TYPE
   ExtDataRec: ARRAY[1..3] OF ExtDescriptor;{extent data record}
</PRE>
 Recall that the <CODE>drCTExtRec</CODE> and <CODE>drXTExtRec</CODE> fields of the MDB are of type <CODE>ExtDataRec</CODE> (see <A HREF=Files-102.html#MARKER-9-459>"Master Directory Blocks,"</A> earlier in this chapter), as is the <CODE>fcbExtRec</CODE> field of an FCB (see <A HREF=Files-110.html#MARKER-9-674>"File Control Blocks" beginning on page 2-81</A>). Also, <BR>the records in the leaf nodes of the extents overflow file are extent data records. For <BR>this reason, the extents overflow file is much simpler than the catalog file: the data in <BR>a leaf node of an extents overflow file always consists of a single kind of record, <BR>instead of the four kinds of records found in a catalog file.<P>
 The other main difference between a catalog B*-tree and an extents overflow B*-tree concerns the format of the key. You can describe an extent record key with the <CODE>ExtKeyRec</CODE> data type.<P>
<PRE>
TYPE ExtKeyRec    =              {extent key record}
RECORD
   xkrKeyLen:     SignedByte;    {key length}
   xkrFkType:     SignedByte;    {fork type}
   xkrFNum:       LongInt;       {file number}
   xkrFABN:       Integer;       {starting file allocation block}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-609></A>xkrKeyLen</CODE>
<DD> The length (in bytes) of the rest of the key. In the current implementation, this field always contains the value 7.
<DT><CODE><A NAME=MARKER-2-610></A>xkrFkType</CODE>
<DD> The type of file fork. This field contains $00 if the file is a data fork and $FF if the file is a resource fork.
<DT><CODE><A NAME=MARKER-2-611></A>xkrFNum</CODE>
<DD> The file ID of the file.
<DT><CODE><A NAME=MARKER-2-612></A>xkrFABN</CODE>
<DD> The starting file allocation block number. In the list of the allocation blocks belonging to this file, this number is the index of the first allocation block of the first extent descriptor of the extent record.
<DT><B>Note</B>
<DD>Disks initialized using the enhanced Disk Initialization Manager introduced in system software version 7.0 might contain extent records for some blocks that do not belong to any actual file in the file system. These extent records have a file ID set to 5, indicating that the extent contains a bad block. See the chapter "Disk Initialization Manager" in this book for details on bad block sparing.<EM></EM><A NAME=MARKER-2-613></A><A NAME=MARKER-2-614></A><A NAME=MARKER-2-615></A><A NAME=MARKER-2-616></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-105.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-107.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
