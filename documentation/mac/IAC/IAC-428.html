<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PPC Toolbox Calling Conventions(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING428></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-427.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-429.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-423.html"><B>Chapter 11 - Program-to-Program Communications Toolbox</B></A> / <A HREF="IAC-427.html"><B>Using the PPC Toolbox</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING428-0></A>
<H2><A NAME=MARKER-9-46></A><A NAME=MARKER-21-47></A>PPC Toolbox Calling Conventions</H2>
 Most PPC Toolbox functions can execute synchronously (meaning that the application cannot continue until the function completes execution) or asynchronously (meaning that the application is free to perform other tasks while the function is executing). The PPC Toolbox functions that can only be executed synchronously include <CODE>PPCInit</CODE>, <CODE>PPCBrowser</CODE>, <CODE>StartSecureSession</CODE>, <CODE>DeleteUserIdentity</CODE>, and <CODE>GetDefaultUser</CODE>. All other PPC Toolbox functions can execute asynchronously or synchronously. Here's an example: <A NAME=MARKER-2-48></A><P>
<PRE>
FUNCTION PPCFunction (pb: PPCParamBlockPtr; 
                      async: Boolean): OSErr;
</PRE>
 The <CODE>pb</CODE> parameter should point to a PPC parameter block. Set the <CODE>async</CODE> parameter to <CODE>TRUE</CODE> if you want the function to execute asynchronously; set it to <CODE>FALSE</CODE> if you want the function to execute synchronously.<P>
<DL>
<DT><B>Note</B>
<DD>The <CODE>PPCInform</CODE>, <CODE>PPCRead</CODE>, and <CODE>PPCWrite</CODE> functions should always be executed asynchronously, because they require interaction from the other application in the session before they complete execution.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The <CODE>PPCParamBlockRec</CODE> data type defines the PPC parameter block.<A NAME=MARKER-2-49></A><A NAME=MARKER-9-14></A><P>
<PRE>
TYPE PPCParamBlockRec = 
   RECORD
      CASE Integer OF
      0: (openParam:       PPCOpenPBRec);       {PPCOpen params}
      1: (informParam:     PPCInformPBRec);     {PPCInform params}
      2: (startParam:      PPCStartPBRec);      {PPCStart params}
      3: (acceptParam:     PPCAcceptPBRec);     {PPCAccept params}
      4: (rejectParam:     PPCRejectPBRec);     {PPCReject params}
      5: (writeParam:      PPCWritePBRec);      {PPCWrite params}
      6: (readParam:       PPCReadPBRec);       {PPCRead params}
      7: (endParam:        PPCEndPBRec);        {PPCEnd params}
      8: (closeParam:      PPCClosePBRec);      {PPCClose params}
      9: (listPortsParam:  IPCListPortsPBRec);  {IPCListPorts }
                                                { params}
   END;
</PRE>
 For an illustration of the fields of each individual parameter block (such as <CODE>PPCInformPBRec</CODE> or <CODE>IPCListPortsPBRec</CODE>), see <A HREF=IAC-435.html#MARKER-9-209>Figure 11-18 on page 11-47</A>.<P>
 Your application transfers ownership of the PPC parameter block (and any buffers or records pointed to by the PPC parameter block) to the PPC Toolbox until a PPC function completes execution. Once the function completes, ownership of the parameter block (and any buffers or records it points to) is transferred back to your application. If a PPC Toolbox function is executed asynchronously, your program cannot alter memory that might be used by the PPC Toolbox until that function completes.<P>
 A PPC Toolbox function that is executed asynchronously must specify <CODE>NIL</CODE> or the address of a completion routine in the <CODE>ioCompletion</CODE> field of the PPC parameter block. You should use the <CODE>ioResult</CODE> field to determine the actual result code when an asynchronously executed PPC Toolbox function completes.<A NAME=MARKER-2-57></A><P>
 If you specify <CODE>NIL</CODE> in the <CODE>ioCompletion</CODE> field, you should poll the <CODE>ioResult</CODE> field of the PPC parameter block after the function is called to determine whether the PPC function has completed the requested operation. You should poll the <CODE>ioResult</CODE> field within the event loop of your application. If the <CODE>ioResult</CODE> field contains a value other than <CODE>1</CODE>, the function has completed execution. Note that you must not poll the <CODE>ioResult</CODE> field at interrupt time to determine whether the function has completed execution.<P>
 If you specify a completion routine in the <CODE>ioCompletion</CODE> field, it is called at interrupt time when the PPC Toolbox function completes execution.<P>
<DL>
<DT><B>WARNING</B>
<DD>Completion routines execute at the interrupt level and must preserve all registers other than A0, A1, and D0-D2. (Note that MPW C and MPW Pascal do this automatically.) Your completion routine must not make any calls to the Memory Manager directly or indirectly, and it can't depend on the validity of handles to unlocked blocks. The PPC Toolbox preserves the application global register A5.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 You can write completion routines in C, Pascal, or assembly language. A completion routine declared in Pascal has this format:<P>
<PRE>
PROCEDURE MyCompletionRoutine (pb: PPCParamBlockPtr);
</PRE>
 The <CODE>pb</CODE> parameter points to the PPC parameter block passed to the PPC Toolbox function.<P>
 You may call another PPC Toolbox function from within a completion routine, but the function called must be executed asynchronously. It is recommended that you allocate parameter blocks of data type <CODE>PPCParamBlockRec</CODE> so that you may reuse the <CODE>pb</CODE> parameter to call another PPC Toolbox function from within a completion routine. For example, you should call either the <CODE>PPCAccept</CODE> function or the <CODE>PPCReject</CODE> function asynchronously from within a <CODE>PPCInform</CODE> completion routine to accept or reject the session request.<P>
 If your application is executing PPC Toolbox functions asynchronously, you may want to define your own record type to hold all data associated with a session. You can attach the data to the end of the parameter block. Here's an example:<P>
<PRE>
TYPE 
   SessRecHndl = ^SessRecPtr;
   SessRecPtr = ^SessRec;
   SessRec = 
   RECORD
      pb:                  PPCParamBlockRec; {must be first }
                                             { item in record}
      thePPCPortRec:       PPCPortRec;
      theLocationNameRec:  LocationNameRec;
      theUserName:         Str32;
   END;
</PRE>
 The additional data elements in your record can be accessed during execution of a completion routine by coercing the <CODE>pb</CODE> parameter to a pointer to your record type.<A NAME=MARKER-21-80></A><A NAME=MARKER-2-90></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-427.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-429.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
