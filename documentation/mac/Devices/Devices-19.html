<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Device Manager Parameter Block(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING19></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-18.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-20.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-10.html"><B>Chapter 1 - Device Manager</B></A> / <A HREF="Devices-17.html"><B>Device Manager Reference</B></A><BR><DL><DD><A HREF="Devices-18.html"><B>Data Structures</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING19-0></A>
<H3><A NAME=MARKER-9-219></A>Device Manager Parameter Block</H3>
 <A NAME=MARKER-14-220></A><A NAME=MARKER-2-201></A>The Device Manager provides both a high-level and a low-level interface for communicating with device drivers. You pass information to the low-level functions in a parameter block structure, defined by the <CODE>ParamBlockRec</CODE> union.<P>
<PRE>
typedef union ParamBlockRec {
   IOParam        ioParam;
   FileParam      fileParam;
   VolumeParam    volumeParam;
   CntrlParam     cntrlParam;
   SlotDevParam   slotDevParam;
   MultiDevParam  multiDevParam;
} ParamBlockRec;
typedef ParamBlockRec *ParmBlkPtr;
</PRE>
 The Device Manager uses two forms of the parameter block: one for the open, close, read, and write functions (the <CODE>IOParam</CODE> structure) and another for the control and status functions (the <CODE>CntrlParam</CODE> structure). Other managers use other structures of the <CODE>ParamBlockRec</CODE> union.<P>
<PRE>
typedef struct IOParam {
 QElemPtr   qLink;         /* next queue entry */
 short      qType;         /* queue type */
 short      ioTrap;        /* routine trap */
 Ptr        ioCmdAddr;     /* routine address */
 ProcPtr    ioCompletion;  /* completion routine address */
 OSErr      ioResult;      /* result code */
 StringPtr  ioNamePtr;     /* pointer to driver name */
 short      ioVRefNum;     /* volume reference or drive number */
 short      ioRefNum;      /* driver reference number */
 char       ioVersNum;     /* not used by the Device Manager */
 char       ioPermssn;     /* read/write permission */
 Ptr        ioMisc;        /* not used by the Device Manager */
 Ptr        ioBuffer;      /* pointer to data buffer */
 long       ioReqCount;    /* requested number of bytes */
 long       ioActCount;    /* actual number of bytes completed */
 short      ioPosMode;     /* positioning mode */
 long       ioPosOffset;   /* positioning offset */
} IOParam;

typedef struct CntrlParam {
 QElemPtr   qLink;         /* next queue entry */
 short      qType;         /* queue type */
 short      ioTrap;        /* routine trap */
 Ptr        ioCmdAddr;     /* routine address */
 ProcPtr    ioCompletion;  /* completion routine address */
 OSErr      ioResult;      /* result code */
 StringPtr  ioNamePtr;     /* pointer to driver name */
 short      ioVRefNum;     /* volume reference or drive number */
 short      ioCRefNum;     /* driver reference number */
 short      csCode;        /* type of control or status request */
 short      csParam[11];   /* control or status information */
} CntrlParam;
</PRE>
 The first eight fields are common to both structures. Each structure also includes its own unique fields.<P>
<B><CODE>Field descriptions for fields common to both structures</CODE></B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-222></A>qLink</CODE>
<DD> A pointer to the next entry in the driver I/O queue. (This field is used internally by the Device Manager to keep track of asynchronous calls awaiting execution.)
<DT><CODE><A NAME=MARKER-9-165></A>qType</CODE>
<DD> The queue type. (This field is used internally by the Device Manager.)
<DT><CODE><A NAME=MARKER-2-166></A>ioTrap</CODE>
<DD> The trap number of the routine that was called. (This field is used internally by the Device Manager.)
<DT><CODE><A NAME=MARKER-2-28></A>ioCmdAddr</CODE>
<DD> The address of the routine that was called. (This field is used internally by the Device Manager.)
<DT><CODE><A NAME=MARKER-2-226></A>ioCompletion</CODE>
<DD> A pointer to a completion routine. When making asynchronous requests, you must set this field to <CODE>nil</CODE> if you are not specifying a completion routine. The Device Manager automatically sets this field to <CODE>nil</CODE> when you make a synchronous request.
<DT><CODE><A NAME=MARKER-2-227></A>ioResult</CODE>
<DD> A value indicating whether the routine completed successfully. The Device Manager sets this field to 1 when it queues an asynchronous request. When the driver completes the request, it places the actual result code in this field. You can poll this field to detect when the driver has completed the request and to determine its result code. The Device Manager executes the completion routine after this field receives the result code.
<DT><CODE><A NAME=MARKER-2-228></A>ioNamePtr</CODE>
<DD> A pointer to the name of the driver. You use this field only when opening a driver.
<DT><CODE><A NAME=MARKER-2-229></A>ioVRefNum</CODE>
<DD> The drive number, if any. The meaning of this field depends on the device driver. The Disk Driver uses this field to identify disk devices.
</DL>
<B><A NAME=MARKER-9-230></A>Field descriptions for the <CODE>IOParam</CODE> structure</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-231></A>ioRefNum</CODE>
<DD> The driver reference number.
<DT><CODE><A NAME=MARKER-2-232></A>ioVersNum</CODE>
<DD> Not used.
<DT><CODE><A NAME=MARKER-2-233></A>ioPermssn</CODE>
<DD> The read/write permission of the driver. When you open a driver, you must supply one of the following values in this field:
</DL>
<PRE>
<A NAME=MARKER-2-241></A><A NAME=MARKER-2-240></A><A NAME=MARKER-2-239></A><A NAME=MARKER-2-238></A>enum {		
<CODE>	/* access permissions */
	<A NAME=MARKER-2-262></A>fsCurPerm			 	= 0, /* retain current permission */
	<A NAME=MARKER-2-263></A>fsRdPerm			 	= 1, /* allow reads only */
	<A NAME=MARKER-2-264></A>fsWrPerm			 	= 2, /* allow writes only */
	<A NAME=MARKER-2-265></A>fsRdWrPerm				= 3/* allow reads and writes</CODE> */
<CODE>};</CODE>
</PRE>
<DL>
<DT><CODE></CODE>
<DD> The Device Manager compares subsequent read and write requests with the read/write permission of the driver. If the request type is not permitted, the Device Manager returns a result code indicating the error.
<DT><CODE><A NAME=MARKER-2-266></A>ioMisc</CODE>
<DD> Not used.
<DT><CODE><A NAME=MARKER-2-267></A>ioBuffer</CODE>
<DD> A pointer to the data buffer for the driver to use for reads or writes.
<DT><CODE><A NAME=MARKER-2-268></A>ioReqCount</CODE>
<DD> The requested number of bytes for the driver to read or write.
<DT><CODE><A NAME=MARKER-2-269></A>ioActCount</CODE>
<DD> The actual number of bytes the driver reads or writes.
<DT><CODE><A NAME=MARKER-9-270></A>ioPosMode<DFN></DFN></CODE>
<DD> The positioning mode used by drivers of block devices. Bits 0 and 1 of this field indicate where an operation should begin relative to the physical beginning of the block-formatted medium. You can use the following constants to test or set the value of these bits:
</DL>
<PRE>
<A NAME=MARKER-2-252></A><A NAME=MARKER-2-251></A><A NAME=MARKER-2-250></A>enum {			
	/* positioning modes */
	<A NAME=MARKER-2-271></A>fsAtMark    			= 0,	 /* at current position */
	<A NAME=MARKER-2-251></A>fsFromStart			 = 1, 		/* offset from beginning */
	<A NAME=MARKER-2-252></A>fsFromMark			  = 3	  /* offset from current
								position  */
};
</PRE>
<DL>
<DT><CODE></CODE>
<DD> The Dis<DFN>k Driver allows you to add the following constant to this field to specify a read-verify operation:</DFN>
</DL>
<PRE>
<CODE><A NAME=MARKER-2-254></A>enum {
	<A NAME=MARKER-2-254></A>rdVerify 			= 64 			/* read-verify mode */
};</CODE>
</PRE>
<DL>
<DT>
<DD> See the description of the <CODE>PBRead</CODE> function on <A HREF=Devices-32.html#MARKER-9-343>page 1-70</A>.
<DT><CODE><A NAME=MARKER-2-255></A>ioPosOffset</CODE>
<DD> The byte offset, relative to the position specified by the positioning mode, where the driver should perform the operation. If you specify the <CODE>fsAtMark</CODE> positioning mode, the Device Manager ignores this field.<A NAME=MARKER-2-103></A>
</DL>
<B><A NAME=MARKER-9-257></A>Field descriptions for the <CODE>CntrlParam</CODE> structure</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-258></A>ioCRefNum</CODE>
<DD> The driver reference number.
<DT><CODE><A NAME=MARKER-2-259></A>csCode</CODE>
<DD> A value identifying the type of control or status request. Each driver may interpret this number differently.
<DT><CODE><A NAME=MARKER-2-260></A>csParam</CODE>
<DD> The control or status information passed to or from the driver. This field is declared generically as an array of eleven integers. Each driver may interpret the contents of this field differently. Refer to the driver's documentation for specific information.<A NAME=MARKER-2-40></A><A NAME=MARKER-9-104></A>
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-18.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-20.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
