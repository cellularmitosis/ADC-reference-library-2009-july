<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using a Script Context to Handle an Apple Event(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING298></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-297.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-299.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-288.html"><B>Chapter 7 - Introduction to Scripting</B></A> / <A HREF="IAC-296.html"><B>Manipulating and Executing Scripts</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING298-0></A>
<H2><A NAME=MARKER-9-74></A>Using a Script Context to Handle an Apple Event</H2>
 One way to associate a script with an object is to associate a script context with a specific Apple event object--that is, with any object in your application that can be identified by an object specifier record. When an Apple event acts on an Apple event object with which a script context is associated, your application attempts to use the script context to handle the Apple event. This approach can be useful if you want to associate many different scripts with many different kinds of objects.<A NAME=MARKER-6-70></A> <A NAME=MARKER-6-96></A><P>
 <A HREF=#MARKER-9-77>Figure 7-7</A> illustrates one way that an application can use a script context to handle an Apple event. This example shows how you can use a general Apple event handler to provide initial processing for all Apple events received by your application. If an Apple event acts on an object with which a script context is associated, the general handler attempts to use the script context to handle the event.<P>
 The SurfWriter application in <A HREF=#MARKER-9-77>Figure 7-7</A> associates script contexts (called script objects in AppleScript) with geometric shapes such as circles or squares. These script contexts can contain one or more user-defined handlers for specific Apple events. For example, the script context shown in <A HREF=#MARKER-9-77>Figure 7-7</A> is associated with a circle and contains this handler:<P>
<PRE>
on move to {x, y}
   continue move to {x, item 2 of position of this}
end move
</PRE>
 This handler exists only as AppleScript statements in the script context and doesn't have an entry in SurfWriter's Apple event dispatch table. SurfWriter does have its own standard Apple event handlers installed in its Apple event dispatch table. When SurfWriter receives a Move event that acts on the circle with which this script context is associated, SurfWriter uses the handler in the script context to modify its own standard handling of the event. The rest of this section describes how this works.<P>
<B>Figure 7-7  Using a handler in a script context to handle an Apple event<A NAME=MARKER-9-77></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/SC-L-04.jpg"><P>
 The <CODE>MyGeneralAppleEventHandler</CODE> function in <A HREF=#MARKER-9-77>Figure 7-7</A> is installed in SurfWriter's special handler dispatch table. Thus, <CODE>MyGeneralAppleEventHandler</CODE> provides initial processing for all Apple events received by SurfWriter. When it receives an Apple event, <CODE>MyGeneralAppleEventHandler</CODE> checks whether a script context is associated with the object on which the event acts. If so, <CODE>MyGeneralAppleEventHandler</CODE> passes the event and a script ID for the script context to the <CODE>OSADoEvent</CODE> function. If not, <CODE>MyGeneralAppleEventHandler</CODE> returns <CODE>errAEEventNotHandled</CODE>, which causes the Apple Event Manager to look for the appropriate handler in SurfWriter's Apple event dispatch table.<P>
 The <CODE>OSADoEvent</CODE> function looks for a handler in the specified script context that can handle the specified event. If the script context doesn't include an appropriate handler, <CODE>OSADoEvent</CODE> returns <CODE>errAEEventNotHandled</CODE>. If the script context includes an appropriate handler (in this example, a handler that begins <CODE>on move</CODE>), <CODE>OSADoEvent</CODE> attempts to use the handler to handle the event.<P>
 When it encounters the <CODE>continue</CODE> statement during execution of the <CODE>on move</CODE> handler shown in <A HREF=#MARKER-9-77>Figure 7-7</A>, the AppleScript component calls SurfWriter's resume dispatch function. <A NAME=MARKER-2-78></A>A <B>resume dispatch function</B> takes an Apple event and invokes the application's default handler for that event directly, bypassing the application's special handler dispatch table and the <CODE>MyGeneralAppleEventHandler</CODE> handler (or its equivalent). In this case, the AppleScript component uses SurfWriter's default Move handler to move the circle to a different location than the one specified in the original Move event. The location specified by <CODE>{x, item 2 of position of this}</CODE> has the same horizontal coordinate as the location specified by the original event, but specifies the circle's original vertical coordinate (item 2 of the circle's original position), thus constraining motion to a horizontal direction.<P>
 The AppleScript component calls the resume dispatch function as soon as it encounters a <CODE>continue</CODE> statement during script execution. For example, if the handler in <A HREF=#MARKER-9-77>Figure 7-7</A> contained additional indented statements after the <CODE>continue</CODE> statement, the AppleScript component would proceed with the execution of those statements after calling the resume dispatch function successfully.<P>
 A script context can modify the event and use the default Apple event handler to execute the modified event, as in this example; or it can override the default handler completely, performing some completely different action; or it can perform some action and then pass the original event to the application's default handler to be handled in the usual way. Script contexts associated with Apple event objects thus provide a way for users to modify or override the way an application responds to a particular Apple event that manipulates those objects.<P>
 A general Apple event handler can use the <CODE>OSAExecuteEvent</CODE> function instead of <CODE>OSADoEvent</CODE> to execute a script context. The main difference between these functions is is that <CODE>OSAExecuteEvent</CODE> returns the script ID for the resulting script value, whereas <CODE>OSADoEvent</CODE> returns a reply event.<P>
 To create a script context, pass the source data for the scripting-language statements you want the script context to contain to <CODE>OSACompile</CODE> with the <CODE>modeFlags</CODE> parameter set to <CODE>kOSACompileIntoContext</CODE>. The resulting script context is identical to a script context returned by the <CODE>OSAMakeContext</CODE> function, except that it contains compiled statements.<P>
 <A HREF=IAC-338.html#MARKER-9-135>"Using a Script Context to Handle an Apple Event,"</A> which begins on <A HREF=IAC-338.html#MARKER-9-135>page 10-19</A>, describes this method of executing a script in more detail. <A NAME=MARKER-2-430></A> <DFN><A NAME=MARKER-2-228></A></DFN> <DFN><A NAME=MARKER-21-348></A></DFN> <DFN><A NAME=MARKER-2-225></A></DFN> <A NAME=MARKER-2-83></A> <A NAME=MARKER-2-419></A> <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-297.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-299.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
