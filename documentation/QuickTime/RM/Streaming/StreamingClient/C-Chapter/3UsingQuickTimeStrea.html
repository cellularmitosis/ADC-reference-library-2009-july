<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Streaming Guide: Using QuickTime Streaming</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using QuickTime Streaming"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming" title="Using QuickTime Streaming"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../Streaming-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000577" target="_top">Streaming</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP30001145-IntroductiontoQuickTimeStreamingGuide-DontLinkElementID_51">QuickTime Streaming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2AboutQuickTimeStrea.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4MediaPacketizers.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-SW1" title="Using QuickTime Streaming"></a>
<h1>Using QuickTime Streaming</h1>

<p>This chapter describes from a programming perspective how to create, send, and receive streamed movies. Code samples for receiving and creating streaming movies are included.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_8">Receiving Streaming Movies</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_18">Common Streaming Error Codes</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_19">Serving Streaming Movies</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_20">Hint Tracks</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_21">Hint Track Structure</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_25">Creating Streaming Movies</a>
				
			<br/>
			
        
			
			
				<a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_28">Compositing Streaming and Non-Streaming Tracks</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_8" title="Receiving Streaming Movies"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-ReceivingStreamingMovies" title="Receiving Streaming Movies"></a>Receiving Streaming Movies</h2>
<p>An application receives streaming content by opening a movie and playing it.</p>
<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_9" title="Opening a Streaming Movie"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-OpeningaStreamingMovie" title="Opening a Streaming Movie"></a>Opening a Streaming Movie</h3>
<p>In general, opening a streaming movie is like opening any QuickTime movie. You can open a streaming movie by opening</p>
<ul class="spaceabove">
<li class="li"><p>a movie file that contains streaming tracks</p></li>
<li class="li"><p>an SDP file</p></li>
<li class="li"><p>a URL</p></li>
</ul>
<p>You can open a movie file that contains streaming tracks, or open an SDP file, by calling <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromFile" target="_top">NewMovieFromFile</a></code> in the usual way.</p>
<p>You open a movie from a URL by calling <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromDataRef" target="_top">NewMovieFromDataRef</a></code> with a URL data reference. The URL for a real-time streaming movie will use RTSP protocol. The following is a code sample for opening a movie from an RTSP URL:</p>

<div class="codesample"><table><tr><td scope="row"><pre>char url[] = "rtsp://www.mycompany.com/mymovie.mov";<span></span></pre></td></tr><tr><td scope="row"><pre>Handle urlDataRef;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>urlDataRef = NewHandle(strlen(url) + 1);<span></span></pre></td></tr><tr><td scope="row"><pre>if ( ( err = MemError()) != noErr) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>BlockMoveData(url, *urlDataRef, strlen(url) + 1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = NewMovieFromDataRef(&#38;movieInfo-&#62;theMovie, newMovieActive,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;nil, urlDataRef, URLDataHandlerSubType);<span></span></pre></td></tr><tr><td scope="row"><pre>DisposeHandle(urlDataRef);<span></span></pre></td></tr></table></div>

<p>It&#8217;s also possible to open a movie file from an HTTP or FTP URL, and it&#8217;s possible for that movie file to contain streaming tracks.</p>
<p>If you open a streaming movie from a URL or an SDP file, as shown in Figure 2-1, QuickTime will call the appropriate movie importer. If you open a movie file that contains streaming tracks, stream importers will be called.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_60" title="Figure 2-1Opening a streaming movie"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Opening a streaming movie</p><img src = "../Art/open_streaming.gif" alt = "" width="314" height="80"></div><br/>
<p>Opening a streaming movie typically takes more time than opening a movie with purely local content. Each track in the movie on the server is transmitted as an RTP stream, so the client computer must establish a network connection with the server for each track, and often must establish a connection for RTSP control as well. This takes time, particularly if a dial-up connection must be established.</p>
<p>It also means that QuickTime can return connection status messages or networking errors in the process of opening a movie.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_10" title="Playing A Streaming Movie"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-PlayingAStreamingMovie" title="Playing A Streaming Movie"></a>Playing A Streaming Movie</h3>
<p>Applications that can already play QuickTime movies need to observe these cautions to play real-time streaming movies reliably:</p>
<ul class="spaceabove">
<li class="li"><p>Open movies with high-level Movie Toolbox calls or a movie importer.</p></li>
<li class="li"><p>Do not assume that the track structure of the movie you play reflects the track structure of the original movie; a streaming track can contain sound, video, text, MIDI, or all of these.</p></li>
<li class="li"><p>Use a movie controller to play the movie, or use the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/PrePrerollMovie" target="_top">PrePrerollMovie</a></code> function to set up any streams before playing the movie.</p></li>
<li class="li"><p>Display status messages returned by the movie controller.</p></li>
<li class="li"><p>Be prepared to deal with network errors when your application plays a movie (see <span class="content_text"><a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-CommonStreamingErrorCodes">Common Streaming Error Codes</a></span>).</p></li>
<li class="li"><p>Be prepared for movie characteristics to change dynamically; the height, width, duration, and presence of audio or video can all change as the movie plays.</p></li>
<li class="li"><p>Do not assume that the movie will begin immediately.</p></li>
</ul>
<p>The following sections describe some of these factors in more detail.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_11" title="Track Structure"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-TrackStructure" title="Track Structure"></a>Track Structure</h3>
<p>Unlike other QuickTime movies, streaming movies consist of two distinct movie files, one on the server and the other on the client machine, that often have different track structures. You sometimes need to distinguish between the <strong>server</strong> <strong>movie</strong> and the <strong>client</strong> <strong>movie.</strong> See Figure 2-2.</p>
<p>The media of each track in the server movie is transmitted as a separate RTP stream. On the client side, multiple RTP streams can be combined into a single streaming track.</p>
<p>If you open a movie from a URL, for example, the movie importer may create a client movie that contains only a streaming (<code>'strm'</code>) track. Unlike most other QuickTime track types, a streaming track can contain multiple media streams of different types. A streaming track in a client movie may contain the URL of a server movie with audio, video, text, and/or MIDI tracks.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_61" title="Figure 2-2Server movie and client movie"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>Server movie and client movie</p><img src = "../Art/server_and_client.gif" alt = "" width="383" height="166"></div><br/>
<p>The client movie file never contains audio or video media from the server movie; they are displayed and discarded. If a client movie is saved, the saved movie contains information such as the URL of the server movie and the currently-displayed movie time. The client movie can also contain local tracks and local media, but the media samples in the server movie remain on the server except when playing.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_12" title="Pre-Prerolling"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-PrePrerolling" title="Pre-Prerolling"></a>Pre-Prerolling</h3>
<p>Before any movie is played, QuickTime needs to allocate buffers and open appropriate media handlers. This process is called <strong>prerolling</strong> the movie. Before a streaming movie can be played, additional steps need to be taken, such as establishing RTP streams between the client and the server. This setup process is called <strong>pre-prerolling.</strong> Pre-prerolling is performed automatically when a streaming movie is played using a movie controller. If your application uses movie controllers to play movies, you do not need to take any special steps to pre-preroll a streaming movie.</p>
<p>If you are playing movies using lower-level commands, you will need to use the <code>PrePrerollMoviefunction</code> to set up the network connections for a streaming movie before you can preroll or play the movie. The <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/PrePrerollMovie" target="_top">PrePrerollMovie</a></code> function does nothing unless a movie contains streaming content, so it&#8217;s safe to call it for all movies. Here is a code sample:</p>

<div class="codesample"><table><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;PrePrerollMovie(myMovie, 0, GetMoviePreferredRate(myMovie),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;NewMoviePrePrerollCompleteProc(MyMoviePrePrerollCompleteProc),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;(void *)0L);<span></span></pre></td></tr></table></div>

<p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/PrePrerollMovie" target="_top">PrePrerollMovie</a></code> operates either synchronously or asynchronously, depending on whether you specify a completion procedure when you call it.</p>
<p>If called asynchronously, it returns almost immediately, even if the movie contains streaming content. This allows your application to perform other tasks while awaiting the completion of the pre-prerolling. You need to call <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/MoviesTask" target="_top">MoviesTask</a></code> periodically to grant time for the task of pre-prerolling when using it asynchronously.</p>
<p>When the pre-prerolling is finished, <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/PrePrerollMovie" target="_top">PrePrerollMovie</a></code> calls the completion procedure whose address you pass in the <code>NewMoviePrePrerollCompleteProc</code> parameter. In the simplest case, the completion procedure will want to preroll and start the movie.</p>
<p>If no completion procedure is specified, <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/PrePrerollMovie" target="_top">PrePrerollMovie</a></code> returns when the pre-preroll process is complete.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_13" title="Reacting to Changes in Movie Characteristics"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-ReactingtoChangesinMovieCharacteristics" title="Reacting to Changes in Movie Characteristics"></a>Reacting to Changes in Movie Characteristics</h3>
<p>One feature of streamed movies is that their characteristics may change dynamically during playback. For example, when you open a movie from a URL you may not know the actual height and width of the movie, its duration, how many streams it contains, whether it has a sound track, or whether it is an audio-only movie.</p>
<p>QuickTime will assign default values to these characteristics if they are unknown. QuickTime can notify your application when the movie characteristics become known or are changed.</p>
<p>In most cases, your application will want to adjust the size of the window or pane that contains the movie to reflect such changes. You make these adjustments by implementing a movie controller action filter procedure.</p>
<p>To do this, you first need to indicate that you want to be informed of any changes. You do this by setting a movie playback hint:</p>

<div class="codesample"><table><tr><td scope="row"><pre>SetMoviePlayHints(myMovie, hintsAllowDynamicResize,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hintsAllowDynamicResize);<span></span></pre></td></tr></table></div>

<p>Changes in the movie size are announced to your filter procedure by the <code>mcActionControllerSizeChanged</code> selector. Changes in other movie characteristics are announced through the <code>mcActionMovieEdited</code> selector.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_14" title="Size Changes"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-SizeChanges" title="Size Changes"></a>Size Changes</h3>
<p>Whenever the size of the movie changes, the associated movie controller sends the <code>mcActionControllerSizeChanged</code> action to your movie controller action filter procedure. You can intercept that action and respond to it as follows:</p>

<div class="codesample"><table><tr><td scope="row"><pre>pascal Boolean MyMCActionFilterProc (MovieController theMC, short theAction, void *theParams,<span></span></pre></td></tr><tr><td scope="row"><pre>long theRefCon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Movie&#160;&#160;&#160;myMovie = MCGetMovie(theMC);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch (theAction) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// handle window resizing<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case mcActionControllerSizeChanged:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MyResizeWindow(myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(false);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_15" title="Duration Changes"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DurationChanges" title="Duration Changes"></a>Duration Changes</h3>
<p>The duration of a streaming movie or a streaming track may not be initially known. A track or movie whose duration is not known is assigned an <strong>indefinite</strong> <strong>duration:</strong> <code>x7FFFFFF</code>. If you do not treat this as a special case, a streaming movie will appear to your application as a very long movie indeed.</p>
<p>Once the pre-preroll process is complete, QuickTime should know the actual duration of the streams. If you set an action filter procedure and call <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/SetMoviePlayHints" target="_top">SetMoviePlayHints</a></code>, your application will be called with the <code>mcActionMovieEdited</code> selector when QuickTime determines the actual duration.</p>
<p>If the movie contains live content, it may not have a specific duration. In this case, the duration remains indefinite: <code>x7FFFFFF</code>. You might want to set a timeout in your code that detects the fact that QuickTime has not adjusted the duration from <code>x7FFFFFF</code> after a few seconds of movie play. QuickTimePlayer uses such a timeout and displays a &#8220;Live Transmission&#8221; message where the slider would be for a movie with a known duration.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_16" title="Sound and Video Changes"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-SoundandVideoChanges" title="Sound and Video Changes"></a>Sound and Video Changes</h3>
<p>Whether a streaming movie has sound (<code>'ears'</code>) or is sound-only (no video) may not be initially known or may change dynamically. If you set an action filter procedure and call <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/SetMoviePlayHints" target="_top">SetMoviePlayHints</a></code>, your application will be called with the <code>mcActionMovieEdited</code> selector when the sound or video characteristics change.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_17" title="Other Playback Considerations"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-OtherPlaybackConsiderations" title="Other Playback Considerations"></a>Other Playback Considerations</h3>
<p>Streaming movies only play back at a rate of 1. Other playback rates, such as playing backward, are not supported.</p>


<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_18" title="Common Streaming Error Codes"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-CommonStreamingErrorCodes" title="Common Streaming Error Codes"></a>Common Streaming Error Codes</h2>
<p>Here is a list of common streaming error codes. Applications that play streaming movies should deal gracefully with these errors.</p>

<div class="codesample"><table><tr><td scope="row"><pre>// Streaming errors<span></span></pre></td></tr><tr><td scope="row"><pre>-5400    // qtsBadSelectorErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5401    // qtsBadStateErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5402    // qtsBadDataErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5403    // qtsUnsupportedDataTypeErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5404    // qtsUnsupportedRateErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5405    // qtsUnsupportedFeatureErr<span></span></pre></td></tr><tr><td scope="row"><pre>-5406    // qtsTooMuchDataErr<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Network errors<span></span></pre></td></tr><tr><td scope="row"><pre>-5420    // connection failed (couldn't connect to the server)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Open Transport errors, Macintosh only: -3150 to -3180, -3200 to -3285,<span></span></pre></td></tr><tr><td scope="row"><pre>// plus the full range of OT error codes in file OpenTransport.h<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-3150    // kOTBadAddressErr; a bad address was specified<span></span></pre></td></tr><tr><td scope="row"><pre>-3170    // kOTBadNameErr; couldn't do name lookup<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Open Transport errors, Windows only<span></span></pre></td></tr><tr><td scope="row"><pre>10061    // couldn't connect to server<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Streaming can return all QuickTime and Macintosh Toolbox errors.<span></span></pre></td></tr><tr><td scope="row"><pre>// Common error codes returned include:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// QuickTime errors<span></span></pre></td></tr><tr><td scope="row"><pre>-223    // siInvalidCompression; codec not installed<span></span></pre></td></tr><tr><td scope="row"><pre>// Windows-specific errors when component is loading<span></span></pre></td></tr><tr><td scope="row"><pre>-2092   // componentDllEntryNotFoundErr<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// RTSP errors<span></span></pre></td></tr><tr><td scope="row"><pre>// Most of these error codes are the same as for HTTP.<span></span></pre></td></tr><tr><td scope="row"><pre>// These errors are usually generated from the server.<span></span></pre></td></tr><tr><td scope="row"><pre>3xx    // redirect<span></span></pre></td></tr><tr><td scope="row"><pre>400    // bad request<span></span></pre></td></tr><tr><td scope="row"><pre>401    // unauthorized<span></span></pre></td></tr><tr><td scope="row"><pre>402    // payment required<span></span></pre></td></tr><tr><td scope="row"><pre>403    // forbidden<span></span></pre></td></tr><tr><td scope="row"><pre>404    // not found (specified movie not found on server side)<span></span></pre></td></tr><tr><td scope="row"><pre>405    // method not allowed<span></span></pre></td></tr><tr><td scope="row"><pre>406    // not acceptable<span></span></pre></td></tr><tr><td scope="row"><pre>407    // proxy authentication required<span></span></pre></td></tr><tr><td scope="row"><pre>408    // request time-out<span></span></pre></td></tr><tr><td scope="row"><pre>409    // conflict<span></span></pre></td></tr><tr><td scope="row"><pre>410    // gone<span></span></pre></td></tr><tr><td scope="row"><pre>411    // length required<span></span></pre></td></tr><tr><td scope="row"><pre>412    // precondition failed<span></span></pre></td></tr><tr><td scope="row"><pre>413    // request entity too large<span></span></pre></td></tr><tr><td scope="row"><pre>414    // request URI too large<span></span></pre></td></tr><tr><td scope="row"><pre>415    // unsupported media type<span></span></pre></td></tr><tr><td scope="row"><pre>451    // parameter not understood<span></span></pre></td></tr><tr><td scope="row"><pre>452    // conference not found<span></span></pre></td></tr><tr><td scope="row"><pre>453    // not enough bandwidth<span></span></pre></td></tr><tr><td scope="row"><pre>454    // session not founds<span></span></pre></td></tr><tr><td scope="row"><pre>455    // method not valid in this state<span></span></pre></td></tr><tr><td scope="row"><pre>456    // header field not valid for resource<span></span></pre></td></tr><tr><td scope="row"><pre>457    // invalid range<span></span></pre></td></tr><tr><td scope="row"><pre>458    // parameter is read only<span></span></pre></td></tr><tr><td scope="row"><pre>459    // aggregate operation not allowed<span></span></pre></td></tr><tr><td scope="row"><pre>460    // only aggregate operation allowed<span></span></pre></td></tr><tr><td scope="row"><pre>461    // unsupported transport<span></span></pre></td></tr><tr><td scope="row"><pre>462    // destination unreachable<span></span></pre></td></tr><tr><td scope="row"><pre>500    // internal server error<span></span></pre></td></tr><tr><td scope="row"><pre>501    // not implemented<span></span></pre></td></tr><tr><td scope="row"><pre>502    // bad gateway<span></span></pre></td></tr><tr><td scope="row"><pre>503    // service unavailable<span></span></pre></td></tr><tr><td scope="row"><pre>504    // gateway timeout<span></span></pre></td></tr><tr><td scope="row"><pre>505    // version not supported<span></span></pre></td></tr><tr><td scope="row"><pre>551    // option not supported<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_19" title="Serving Streaming Movies"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-ServingStreamingMovies" title="Serving Streaming Movies"></a>Serving Streaming Movies</h2>
<p>To serve QuickTime movies over RTP, your movie server must be equipped with RTP server software that understands the QuickTime file format, including the structure of <strong>hint</strong> <strong>tracks,</strong> which are described in the section <span class="content_text"><a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-HintTrackStructure">Hint Track Structure</a></span>. Your server also needs an RTSP controller application.</p>
<p>Your server does not need to have QuickTime software installed to serve streaming movies.</p>
<p>If your server is merely acting as a reflector for multicasts, no special software is required to reflect QuickTime movies. Forward the RTP streams on request in the usual way.</p>
<p>Your server uses the hint tracks in a streaming QuickTime movie to packetize the movie&#8217;s media into RTP streams. Hint tracks are added to QuickTime movies to prepare them for streaming over RTP. One hint track is added to the movie for each track whose media will be streamed, as illustrated in Figure 2-3.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_62" title="Figure 2-3Streaming a hinted movie"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>Streaming a hinted movie</p><img src = "../Art/streaming_hinted.gif" alt = "" width="349" height="150"></div><br/>
<p>If your server is sending a unicast of a hinted movie, the QuickTime movie controller will provide the client with the ability to pause the movie and to skip backward and forward in movie time. This will be communicated to your server over RTSP.</p>
<p>The RTP server does not need to know about QuickTime media types or codecs. The hint tracks within the movie file provide the information needed to turn QuickTime media into RTP packets. Each hint track contains the data needed to build packet headers for a specific track&#8217;s media. The hint track also supplies a pointer to the media data that goes into each packet.</p>
<p>The RTP server needs to be able to parse a QuickTime movie file sufficiently to find each hint track, then to find the track and sample data that the hint track points to. The hint track contains any precalculated values that may be needed, making it easier for the server to create the RTP packets.</p>
<p>Hint tracks offload a great deal of computation from the RTP server. Consequently, you may find that an RTP server is able to send data more efficiently if it is contained in a QuickTime movie, even if the RTP server already understands the media type, codec, and RTP packing being used.</p>
<p>For example, the H.263+ video codec is an IETF-standard RTP format which your server may already understand, but creating an H.263+ stream from video data requires complex calculations to properly determine packet boundaries. This information is precalculated and stored in the hint track when H.263+ video is contained in a QuickTime movie, allowing your server to packetize the data quickly and efficiently.</p>
<p>If you are writing QuickTime extensions to an RTP server application, you will need to read the <em>QuickTime</em> <em>File</em> <em>Format</em> documentation, as well as <span class="content_text"><a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-HintTracks">Hint Tracks</a></span> in this document.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_20" title="Hint Tracks"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-HintTracks" title="Hint Tracks"></a>Hint Tracks</h2>
<p>You prepare a QuickTime movie for RTP streaming by adding hint tracks. Hint tracks allow an RTP server to stream QuickTime movies without requiring the RTP server to understand QuickTime media types, codecs, or packing. The RTP server needs to understand the QuickTime file format sufficiently to find tracks and media samples in a QuickTime movie, however.</p>
<p>Each track in a QuickTime movie is sent as a separate RTP stream, and the recipe for packetizing each stream is contained in a corresponding hint track. Each sample in a hint track tells the RTP server how to packetize a specific amount of media data. The hint track sample contains any data needed to build a packet header of the correct type, and also contains a pointer to the block of media data that belongs in the packet.</p>
<p>There is at least one hint track for each media track to be streamed. It is possible to create multiple hint tracks for a given track&#8217;s media, optimized for streaming the same media over networks with different packet sizes, for example. The hinter included in QuickTime creates one hint track for each track to be streamed.</p>
<p>Hint tracks are structured in the same way as other QuickTime movie tracks. Standard QuickTime data structures, such as track references, are used to point to data. In order to serve a QuickTime movie, your RTP server must locate the hint tracks contained in the movie and parse them to find the packet data they point to. You should review the <em>QuickTime</em> <em>File</em> <em>Format</em> documentation before you read the remainder of this hint track information. You will also find it helpful to refer to the <em>QuickTime</em> <em>File</em> <em>Format</em> periodically in the course of reading this document.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_21" title="Hint Track Structure"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-HintTrackStructure" title="Hint Track Structure"></a>Hint Track Structure</h2>
<p>Hint tracks are atoms of type <code><!--a target="_top" -->'trak'<!--/a--></code>. A hint track atom contains a track header atom (<code>'tkhd'</code>), an edits atom (<code>'edts'</code>), a track reference atom (<code>'tref'</code>), a media atom (<code>'mdia'</code>), and usually a track user data atom (<code>'udta'</code>). The atoms are normally present in the order described, but this is not a requirement. Most of these atoms have child atoms. An expanded diagram of a typical hint track atom is shown in Figure 2-4.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_63" title="Figure 2-4A typical hint track atom"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>A typical hint track atom</p><img src = "../Art/hint_track_atom.gif" alt = "" width="520" height="288"></div><br/>
<p>A detailed description of each atom&#8217;s contents follows. This document focuses on atom contents that are specific to hint tracks. Refer to the <em>QuickTime</em> <em>File</em> <em>Format</em> documentation for generic information about the structure and contents of the atom types found in track atoms.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_64" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
The actual hint samples are not part of the hint track atom structure. The hint track atom structure contains the information you need to locate and interpret the samples. A description of hint samples follows the description of the hint track&#8217;s atoms. </p>
</div>
<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_22" title="Track Header Atom"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-TrackHeaderAtom" title="Track Header Atom"></a>Track Header Atom</h3>
<p>The <code>flags</code> field of the track header atom must be 0x000000, indicating the track is inactive, and not part of the movie, preview, or poster. Hint tracks must be marked as inactive for the movie to play locally.</p>
<p>The creation time, modification time, and track ID fields are set as they would be for any track.</p>
<p>The <code>duration</code> field is also the duration of the media track being hinted, expressed in movie time scale.</p>
<p>The <code>layer</code> field is not used.</p>
<p>The alternate group field can be used to distinguish alternate language or alternate data rate tracks in streaming movies. It is not required that all servers support this feature. It is not recommended that applications attempt to make use of this feature at this time. This field is normally set to 1.</p>
<p>The remaining track header fields are not used for hint tracks.</p>
<p>Unused fields should be set to 0 when creating hint tracks and ignored when using them.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_23" title="Edits Atom"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-EditsAtom" title="Edits Atom"></a>Edits Atom</h3>
<p>The edits atom contains an edits list atom (<code>'elst'</code>). Edit lists can be used for hint tracks as they can for any other track type.</p>
<p>The fields of the edits list atom (<code>'elst'</code>) are used as follows:</p>
<p>The <code>flags</code> field is not used, and should be set to 0.</p>
<p>The <code>numEntries</code> field is the number of list entries. Unless the hint track has been edited, it will have either 1 or 2 entries.</p>
<p>Each list entry consists of a duration, a media time, and a rate.</p>
<p>If the track should begin playing after the movie begins, there is an &#8220;empty edit&#8221; whose duration is the amount of time that passes until the track begins playing, whose media time is -1, and whose media rate is 1. No data should be sent for this track until the number of movie time units specified by the duration field has passed.</p>
<p>Whether or not there is an empty edit, there will typically be one entry whose duration is the media duration in movie timescale units, whose media time is 0, and whose rate is 1.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_24" title="Track Reference Atom"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-TrackReferenceAtom" title="Track Reference Atom"></a>Track Reference Atom</h3>
<p>Each hint track refers to a media track. The hint track contains a track reference atom (<code>'tref'</code>) that contains exactly one child atom of type <code><!--a target="_top" -->'hint'<!--/a--></code>. This child atom holds the track ID of the media track. The whole track reference atom has this structure:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Atom Type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>Track Reference</p></td>
<td ><p> </p></td>
<td ><p> </p></td>
<td ><p>Contains a <code>'hint'</code>  atom</p></td>
</tr>
<tr>
<td  scope="row"><p>&#160;&#160;</p></td>
<td ><p><code>Size</code></p></td>
<td ><p>4</p></td>
<td ><p>Size of track reference atom (including <code>'hint'</code> atom); 32-bit integer.</p></td>
</tr>
<tr>
<td  scope="row"><p>&#160;&#160;</p></td>
<td ><p><code>Type</code></p></td>
<td ><p>4</p></td>
<td ><p><code>'tref'</code></p></td>
</tr>
<tr>
<td  scope="row"><p>Track Hint</p></td>
<td ><p> </p></td>
<td ><p> </p></td>
<td ><p>Contains the track ID of the media track being hinted</p></td>
</tr>
<tr>
<td  scope="row"><p>&#160;&#160;</p></td>
<td ><p><code>Size</code></p></td>
<td ><p>4</p></td>
<td ><p>Size of this child atom; 32-bit integer.</p></td>
</tr>
<tr>
<td  scope="row"><p>&#160;&#160;</p></td>
<td ><p><code>Type</code></p></td>
<td ><p>4</p></td>
<td ><p><code>'hint'</code></p></td>
</tr>
<tr>
<td  scope="row"><p>&#160;&#160;</p></td>
<td ><p><code>TrackID</code></p></td>
<td ><p>4</p></td>
<td ><p>Track ID of the media track being hinted; 32-bit integer.</p></td>
</tr>

</table></div>
<p>The Track ID field of the <code><!--a target="_top" -->'hint'<!--/a--></code> atom contains the track ID of the media track being hinted. The target track ID can be found in the media track&#8217;s track header atom (<code>'tkhd'</code>). All media sample data should be taken from the specified media track.</p>
<p>There could theoretically be a list of track IDs for a hint track that hinted multiple media tracks, but the current hinter only references one media track per hint track.</p>


<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_25" title="Creating Streaming Movies"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-CreatingStreamingMovies" title="Creating Streaming Movies"></a>Creating Streaming Movies</h2>
<p>Streaming movies come in two forms: server movies and client movies.</p>
<p>You create a server movie that can be streamed over RTP by adding hint tracks. Hint tracks tell the server how to packetize the movie. You add hint tracks by exporting a movie as a hinted movie using QuickTime&#8217;s standard movie export mechanism.</p>
<p>You create a client movie that includes streaming content by adding one or more streaming tracks. A streaming track tells the client where to get the streaming media. In its simplest form, a client movie consists of just a streaming track containing the URL of a movie on a server. A client movie can contain multiple streaming tracks.</p>
<p>A client movie can contain non-streaming tracks with local media content as well as streaming tracks. Streaming tracks can be composited with local tracks. For example, a streaming track could be used as the source for an effect track that is local to the client movie.</p>
<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_26" title="Server Movies"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-ServerMovies" title="Server Movies"></a>Server Movies</h3>
<p>You create a streaming movie for an RTP server by adding hint tracks to an existing movie. You do this by calling <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/ConvertMovieToFile" target="_top">ConvertMovieToFile</a></code>, which invokes a movie exporter component. This displays a standard dialog box that lets the user specify &#8220;Export Movie to Hinted Movie,&#8221; set the parameters for hinting the movie, select compressors, and specify a file name and directory for the hinted movie (see Figure 2-5).</p>
<p>The hinting is performed by media packetizer components. QuickTime selects an appropriate media packetizer for each track and routes each packetizer&#8217;s output through an Apple-provided packet builder to create a hint track. One hint track is created for each streamable track in the movie.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_65" title="Figure 2-5Exporting a hinted movie"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>Exporting a hinted movie</p><img src = "../Art/export_hinted_movie.gif" alt = "" width="429" height="85"></div><br/>
<p>Hint tracks are quite small compared with audio or video tracks. A movie that contains hint tracks can be played from a local disk or streamed over HTTP, like any other QuickTime movie. The hint tracks are only used when streaming the movie over RTP.</p>
<p>As long as your application supports movie exporter components, it should be able to create hinted movies. If you want to bypass the standard dialog for user input, selecting &#8220;Export Movie to Hinted Movie&#8221; programmatically, you will need to modify your code by adding the appropriate selectors.</p>
<p>A hinted movie does not need to be self-contained (flattened). It can reference sample media contained in other files. But observe these cautions:</p>
<ul class="spaceabove">
<li class="li"><p>Use file names that are transportable between the system that the movies are created on and the RTP server.</p></li>
<li class="li"><p>The relative path from the movie file to the data files must not change after the movie is saved.</p></li>
<li class="li"><p>The simplest way to ensure both of these is to use only lowercase letters in file names, without spaces, and to keep the media data files and the movie file in the same folder or directory.</p></li>
<li class="li"><p>Hint tracks should be created as the last step in making a streaming movie. Any editing of the movie that adds or deletes sample data, including the flattening of a movie with edit lists, invalidates the hint track. If your application edits a hinted movie in a way that invalidates the hint tracks, delete the hint tracks and re-export the movie.</p></li>
</ul>
<p>Hint tracks are marked as inactive so they do not interfere with local playback. If you call <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/FlattenMovie" target="_top">FlattenMovie</a></code> with the <code>flattenActiveTracksOnly</code> flag, the hint tracks are deleted from the flattened movie.</p>
<p>This release of QuickTime supports RTP streaming of video, audio, text (including HREF Tracks), and MIDI. If your movie contains other media types, or features that rely on track references, you cannot currently export the entire movie to a hinted movie. You can either stream such movies over HTTP, or you can put some of the tracks into a client movie and stream the rest, as described in the section <span class="content_text"><a href="3UsingQuickTimeStrea.html#//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-CompositingStreamingandNonStreamingTracks">Compositing Streaming and Non-Streaming Tracks</a></span>.</p>

<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_27" title="Client Movies"></a>
<h3><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-ClientMovies" title="Client Movies"></a>Client Movies</h3>
<p>You incorporate streaming content in a client movie by adding at least one streaming track. The simplest form of client movie has only one track: a streaming track with the URL of a movie on a server.</p>
<p>A streaming track has a media type of <code>kQTSStreamMediaType</code> (<code>'strm'</code>) and contains a single media sample: typically either an RTSP URL of a streaming movie or the SDP text describing a multicast.</p>
<p>The code example in Listing 2-1 shows how to create a streaming track, insert a sample description, and add a URL media sample.</p>
<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_66" title="Listing 2-1Creating a streaming track with an RTSP URL"></a>
<p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Creating a streaming track with an RTSP URL</p>
<div class="codesample"><table><tr><td scope="row"><pre>Handle dataRef;<span></span></pre></td></tr><tr><td scope="row"><pre>long dataLength;<span></span></pre></td></tr><tr><td scope="row"><pre>char url[] = "rtsp://myserver.bigcompany.com/mystreaming.mov";<span></span></pre></td></tr><tr><td scope="row"><pre>dataRef = NewHandle(strlen(url) + 1);<span></span></pre></td></tr><tr><td scope="row"><pre>BlockMoveData(url, *urlDataRef, strlen(url) + 1);<span></span></pre></td></tr><tr><td scope="row"><pre>dataLength = GetHandleSize(dataRef);<span></span></pre></td></tr><tr><td scope="row"><pre>newMedia = NewTrackMedia(newTrack, kQTSStreamMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kQTSMediaTimeScale, handleDataRef, HandleDataHandlerSubType);<span></span></pre></td></tr><tr><td scope="row"><pre>err = BeginMediaEdits(newMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>qtsDesc =<span></span></pre></td></tr><tr><td scope="row"><pre>(QTSSampleDescriptionHandle)NewHandleClear(sizeof(QTSSampleDescription));<span></span></pre></td></tr><tr><td scope="row"><pre>(**qtsDesc).descSize = sizeof(QTSSampleDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>(**qtsDesc).dataFormat = 'rtsp';<span></span></pre></td></tr><tr><td scope="row"><pre>(**qtsDesc).dataRefIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>(**qtsDesc).version = kQTSSampleDescriptionVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>duration = kQTSInfiniteDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>err = AddMediaSample(newMedia, dataRef, 0, dataLength, duration,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(SampleDescriptionHandle)qtsDesc, 1, 0, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>err = EndMediaEdits(newMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>err = InsertMediaIntoTrack(newTrack, 0, 0, GetMediaDuration(newMedia),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kQTSNormalForwardRate);<span></span></pre></td></tr></table></div>

<p>A streaming track in a client movie can point to a server movie containing audio, video, text, and MIDI tracks. Any or all of the tracks in the server movie can appear as a single streaming track in the client movie.</p>
<p>To sum up:</p>
<ul class="spaceabove">
<li class="li"><p>A client-side streaming movie contains at least one streaming <code>'strm'</code> track.</p></li>
<li class="li"><p>A streaming track contains a single media sample, typically an RTSP URL that points to streaming content. It can also contain SDP information for a multicast.</p></li>
<li class="li"><p>The streaming content can be a live stream or a stored movie on a streaming server.</p></li>
<li class="li"><p>The movie on the server can contain any number of tracks; multiple tracks in the server movie may be represented in the client movie as a single streaming track.</p></li>
</ul>


<a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-DontLinkElementID_28" title="Compositing Streaming and Non-Streaming Tracks"></a>
<h2><a name="//apple_ref/doc/uid/TP30001145-UsingQuickTimeStreaming-CompositingStreamingandNonStreamingTracks" title="Compositing Streaming and Non-Streaming Tracks"></a>Compositing Streaming and Non-Streaming Tracks</h2>
<p>A client movie can contain non-streaming tracks with locally-stored media, in addition to one or more streaming tracks. Use this technique to add a live stream to a locally-stored movie, or to distribute a movie on CD-ROM that references the latest version of some media stored on a server.</p>
<p>You can composite a streaming track with local tracks. A streaming track can be positioned in time and space like any other track. Bear in mind that the streaming track may contain more than one video, audio, text, or other streams, however.</p>
<p>If your application creates movies, you will want to provide options for creating a server movie and a client movie from the same data, as well as providing options for putting some tracks in the server movie and some in the client movie.</p>
<p>Ordinarily, you create a streaming movie by exporting a movie as a hinted movie, putting that hinted movie on an RTP server, and creating a client movie that contains the URL of the movie on the server.</p>
<p>Sometimes, however, you will want to export part of an existing movie to a hinted server movie while incorporating other parts in the client movie. You might do this to stream the audio and video parts of a movie over RTP, while streaming wired sprites or chapter lists over HTTP.</p>
<p>For example, to create a streaming movie with a chapter list, extract the text track containing the chapter list from the movie and export the remainder as a hinted movie. Create a client movie with just a streaming track containing the URL of the hinted movie. Add the extracted text track to the client movie and make it a chapter list by adding a track reference to the streaming track. The client movie now contains:</p>
<ul class="ul">
<li class="li"><p>a local text track containing the chapter list</p></li>
<li class="li"><p>a streaming track that points to the rest of the movie</p></li>
<li class="li"><p>a track reference of type <code><!--a target="_top" -->'chap'<!--/a--></code> in the streaming track that references the chapter list track</p></li>
</ul>
<p>The server movie contains the original movie, minus the chapter list, plus hint tracks.</p>
<p>You would use a similar technique to stream a movie with QuickTime video effects, storing the effects tracks in the client movie and applying the track references to the streaming tracks that act as sources to the effects.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2AboutQuickTimeStrea.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4MediaPacketizers.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/Streaming/StreamingClient/C-Chapter/3UsingQuickTimeStrea.html%3Fid%3DTP30001145-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/Streaming/StreamingClient/C-Chapter/3UsingQuickTimeStrea.html%3Fid%3DTP30001145-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/Streaming/StreamingClient/C-Chapter/3UsingQuickTimeStrea.html%3Fid%3DTP30001145-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>