<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Password - /Password.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxHumanInterfaceToolbox-date.html">Human Interface Toolbox</a> &gt; <A HREF="javascript:location.replace('index.html');">Password</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Password</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Password.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Password.c</option>
<option value="listing2.html">/Password.h</option>
<option value="listing3.html">/Sample.c</option>
<option value="listing4.html">/Sample.h</option></select>
				</p>
				</form>
				<p><strong><a href="Password.zip">Download Sample</a></strong> (&#147;Password.zip&#148;, 31.3K)<BR>
<strong><a href="Password.dmg">Download Sample</a></strong> (&#147;Password.dmg&#148;, 91.5K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    Password.c  Contains:  This file contains all the interesting password stuff  Written by: Tim Dierks    Copyright:  Copyright &copy; 1991-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        8/9/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#include &lt;Types.h&gt;#include &lt;Memory.h&gt;#include &lt;Resources.h&gt;#include &lt;OSUtils.h&gt;#include &lt;Quickdraw.h&gt;#include &lt;Fonts.h&gt;#include &lt;Events.h&gt;#include &lt;OSEvents.h&gt;#include &lt;Windows.h&gt;#include &lt;Menus.h&gt;#include &lt;Dialogs.h&gt;#include &lt;TextEdit.h&gt;#include &quot;Sample.h&quot;#include &quot;Password.h&quot;void DisplayPassword (ConstStr255Param password){  DialogPtr  dlog;  short    item;  //short    rDisplayPasswordDialog;    dlog = GetNewDialog(rDisplayPasswordDialog,0L,(WindowPtr) -1L);    ParamText((ConstStr255Param)password,0L,0L,0L);    do  {  ModalDialog(0L,&amp;item);  } while (item != 1);      // Until the OK button gets hit    DisposeDialog(dlog);}void TwoItemDialog (StringPtr password){  DialogPtr    dlog;  Handle      itemH;  ControlHandle  chkBox;  short      item,itemType,chkVal;  Rect      box;  Point      size;  static ModalFilterUPP twoItemFilterUPP;    /* set up a UPP for the dialog filter */  if (!twoItemFilterUPP)    twoItemFilterUPP = NewModalFilterProc(TwoItemFilter);    dlog = GetNewDialog(rTwoItemDialog,0L,(WindowPtr) -1L);    if (dlog)  {    do    {  ModalDialog(twoItemFilterUPP,&amp;item);      if (item == 4)                      // Hide/show checkbox      {  GetDialogItem(dlog,4,&amp;itemType,(Handle*)&amp;chkBox,&amp;box);  // Get check value        chkVal = !GetControlValue(chkBox);        SetControlValue(chkBox,chkVal);              // Invert it        size.v = dlog-&gt;portRect.bottom - dlog-&gt;portRect.top;        size.h = dlog-&gt;portRect.right - dlog-&gt;portRect.left;        if (chkVal)          size.v += 35;        else          size.v -= 35;                SizeWindow(dlog,size.h,size.v,true);    // Resize window      }    } while (item != 1);      // Until the OK button is hit      GetDialogItem(dlog,3,&amp;itemType,&amp;itemH,&amp;box);    // Get text from hidden dialog item    GetDialogItemText(itemH, password);        DisposeDialog(dlog);  }}pascal BooleanTwoItemFilter(DialogPtr dlog,EventRecord *event,short *itemHit){  DialogPtr  evtDlog;  short    selStart,selEnd;    if (event-&gt;what == keyDown || event-&gt;what == autoKey)  {  switch (event-&gt;message &amp; charCodeMask)    {  case '\n':      // Return  (hitting return or enter is the same as hitting the OK button)      case '\003':    // Enter        *itemHit = 1;    // OK Button        return true;    // We handled the event      case '\t':      // Tab        event-&gt;what = nullEvent;  // Do nothing (don't let the user tab to the hidden field)        return false;      case '\034':    // Left arrow  (Keys that just change the selection)      case '\035':    // Right arrow      case '\036':    // Up arrow      case '\037':    // Down arrow        return false;      // Let ModalDialog handle them      default:        selStart = (**((DialogPeek)dlog)-&gt;textH).selStart;    // Get the selection in the visible item        selEnd = (**((DialogPeek)dlog)-&gt;textH).selEnd;        SelectDialogItemText(dlog,3,selStart,selEnd);        // Select text in invisible item        DialogSelect(event,&amp;evtDlog,itemHit);      // Input key        SelectDialogItemText(dlog,2,selStart,selEnd);        // Select same area in visible item        if ((event-&gt;message &amp; charCodeMask) != '\010')  // If it's not a backspace (backspace is the only key that can affect both the text and the selection- thus we need to process it in both fields, but not change it for the hidden field.          event-&gt;message = '*';            // Replace with character to use        DialogSelect(event,&amp;evtDlog,itemHit);      // Put in fake character        return true;    }  }    return false;      // For all non-keyDown events}void DifferentFontDialog (StringPtr password){  DialogPtr    dlog;  Handle      itemH;  short      item,itemType,font;  Rect      box;  UserItemUPP     chicagoTextItemUPP;  //short       rDifferentFontDialog;    /* create the UPP for our ChicagoTextItem userItem */  chicagoTextItemUPP = NewUserItemProc(ChicagoTextItem);    GetFNum(&quot;\p.Pwd&quot;,&amp;font);    // Get the font number for our password font (it begins with a period, so AppendResMenu won't add it)  SetDialogFont(font);        // Use this font for static and edit text items in further dialogs    dlog = GetNewDialog(rDifferentFontDialog,0L,(WindowPtr) -1L);    GetDialogItem(dlog,3,&amp;itemType,&amp;itemH,&amp;box);      // Because SetDialogFont affects static items, too, we've got to use user items to draw our prompts  SetDialogItem(dlog,3,itemType,(Handle)chicagoTextItemUPP,&amp;box);  GetDialogItem(dlog,4,&amp;itemType,&amp;itemH,&amp;box);  SetDialogItem(dlog,4,itemType,(Handle)chicagoTextItemUPP,&amp;box);    do  {  ModalDialog(0L,&amp;item);  } while (item != 1);      // Until the OK button is hit    GetDialogItem(dlog,2,&amp;itemType,&amp;itemH,&amp;box);    // Get text from TE item  GetDialogItemText(itemH, password);    DisposeDialog(dlog);    SetDialogFont(0);    // Set the dialog font back to the System font    DisposeRoutineDescriptor(chicagoTextItemUPP);}pascal voidChicagoTextItem(WindowPtr wind,short item){  short    fontStore,sizeStore;  Handle    itemH;  short    itemType;  Rect    box;  char    *text;    SetPort(wind);    fontStore = wind-&gt;txFont;  // Remember the current font &amp; size  sizeStore = wind-&gt;txSize;    TextFont(0);    // Set to default System font &amp; size  TextSize(0);    GetDialogItem(wind,item,&amp;itemType,&amp;itemH,&amp;box);    if (item == 3)      // These strings would probably be in a resource or somesuch in an actual program.    (ConstStr255Param) text = &quot;\pPlease enter your password:&quot;;  if (item == 4)    (ConstStr255Param) text = &quot;\pSpecial Font Password Dialog&quot;;    TETextBox(text+1,*text,&amp;box,teJustLeft);  // Draw the prompt    TextFont(fontStore);    // Restore the font &amp; size  TextSize(sizeStore);}void InternalBufferDialog (StringPtr password){  DialogPtr    dlog;  short      item;  ModalFilterUPP  internalBufferFilterUPP;  //short      rInternalBufferDialog;    /* create the UPP for the InternalBufferFilter */  internalBufferFilterUPP = NewModalFilterProc(InternalBufferFilter);    dlog = GetNewDialog(rInternalBufferDialog,0L,(WindowPtr) -1L);    *password = '\0';          // Zero out the buffered password  SetWRefCon(dlog,(long)password);  // Stash the buffer's address    do  {  ModalDialog(internalBufferFilterUPP,&amp;item);  } while (item != 1);      // Until the OK button is hit    DisposeDialog(dlog);    DisposeRoutineDescriptor(internalBufferFilterUPP);}pascal BooleanInternalBufferFilter(DialogPtr dlog,EventRecord *event,short *itemHit){  char  key;  short  start,end;  char  *buffer;    if (event-&gt;what != keyDown &amp;&amp; event-&gt;what != autoKey)    return false;        // We don't want to deal with them    key = event-&gt;message &amp; charCodeMask;    switch (key)  {  case '\n':      // Return    case '\003':    // Enter      *itemHit = 1;    // OK Button      return true;    // We handled the event    case '\t':      // Tab    case '\034':    // Left arrow    case '\035':    // Right arrow    case '\036':    // Up arrow    case '\037':    // Down arrow      return false;    // Let ModalDialog handle them    default:      // Everything else falls through to be dealt with      break;      //  below  }    start = (**((DialogPeek)dlog)-&gt;textH).selStart;  // Get the current selection  end = (**((DialogPeek)dlog)-&gt;textH).selEnd;    buffer = (char*)GetWRefCon(dlog);    // Get the buffer's address    if (start != end)          // If there's a selection, delete it    DeleteRange(buffer,start,end);    if (key == '\010')  // Backspace  {  if (start != 0)      DeleteRange(buffer,start-1,start);  // Delete the character to the left  }  else  {  InsertChar(buffer,start,key);    // Insert the real key into the buffer    event-&gt;message = '*';        // Character to use in field  }    return false;     // Let ModalDialog insert the fake char}voidDeleteRange(char *buffer,short start,short end){  register char  *src,*dest,*last;    last = buffer + *buffer;    src = buffer + end + 1;  dest = buffer + start + 1;    while (src &lt;= last)      // Shift character to the left over the removed characters    *(dest++) = *(src++);    (*buffer) -= (end-start);  // Adjust the buffer's length}voidInsertChar(char *buffer,short pos,char c){  register short  index,len;    len = *buffer;    if (len == 0xFF)    // if the string is full, return    return;    for (index = len;index &gt; pos;index--)  // Shift characters to the right to make room    buffer[index+1] = buffer[index];    buffer[pos+1] = c;    // Fill in the new character    (*buffer)++;      // Add one to the length of the string}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Password/listing1.html%3Fid%3DDTS10000600-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Password/listing1.html%3Fid%3DDTS10000600-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Password/listing1.html%3Fid%3DDTS10000600-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>