<HTML><!--This file created 7/1/02 11:02 AM by Claris Home Page version 3.0--><HEAD>   <title>Technical Q&amp;A QA1157: Base-Derived async image codecs must implement ImageCodecQueueStarting and ImageCodecQueueStopping</title>   <META NAME=GENERATOR CONTENT="Claris Home Page 3.0">   <X-CLARIS-WINDOW TOP=43 BOTTOM=1023 LEFT=99 RIGHT=1000>   <X-CLARIS-TAGVIEW MODE=minimal><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="Base Codec, Base Image Decompressor, ImageCodecQueueStarting,ImageCodecQueueStopping"><meta name="Description" content="Technical Q&amp;A QA1157: This Q&amp;A describes why Base-Derivedcodecs that set canAsync must implement ImageCodecQueueStartingand ImageCodecQueueStopping."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Jul 8, 2002 - Jul 12, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001701" title="Base-Derived async image codecs must implement ImageCodecQueueStarting and ImageCodecQueueStopping"></a><P><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxQuickTimeComponentCreation-date.html">QuickTime Component Creation</a> &gt; </p><!-- end_header_information --> <!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1157</div>
<div id="pageheadsub">Base-Derived async image codecs must implement ImageCodecQueueStarting and ImageCodecQueueStopping</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --></P><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <P><!-- begin_content -->                  <hr width=500 align=center>                  </P>                  <P id=p2>Q: I've written a codec that uses the Base Image         Decompressor. My Decompressor should be able to run         asynchronously (the DrawBand function doesn't make any         un-safe calls), and I've made sure to set the canAsync flag         in the sub-codec capabilities record during         ImageCodecInitialize. However, the codec doesn't seem to be         running asynchronously. Am I missing something?</P>                  <P id=p4>A: Asynchronous codecs derived from the Base Codec         must make sure to implement the ImageCodecQueueStarting and         ImageCodecQueueStopping routines in addition to setting the         canAsync flag. Your codec must implement these calls or the         Base Codec will fall back to synchronous playback.</P>                  <P id=p4>If your codec doesn't need to do any work at these         times, simply return noErr.</P>                  <P id=p4>Listing 1 demonstrates setting up a dispatch file         and implementing both selectors.</P>                  <P id=p4>Listing 2 demonstrates how to let         ComponentDispatchHelper do the work for you if your codec         doesn't need to do any work in QueueStarting and         QueueStopping.</P>                  <P><BR>         </P>                  <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left><pre>// MySubCodecDispatch.h ...    ComponentRangeBegin (3)        ComponentCall     (Preflight)        ComponentCall     (Initialize)        ComponentCall     (BeginBand)        ComponentCall     (DrawBand)        ComponentCall     (EndBand)<B>        ComponentCall     (QueueStarting)        ComponentCall     (QueueStopping)</B>        ComponentDelegate (DroppingFrame)        ComponentDelegate (ScheduleFrame)        ComponentDelegate (CancelTrigger)    ComponentRangeEnd (3) ...// MySubCodec.c ...// ImageCodecQueueStarting//     The base image decompressor calls your image decompressor component's// ImageCodecQueueStarting function before decompressing the frames in the// queue. The base image decompressor never calls the ImageCodecQueueStarting// function at interrupt time.// If your codec supports asynchronous scheduled decompression you must// implement this selector. If your codec does not need to do anything at// this time simply return noErr.pascal ComponentResult EI_ImageCodecQueueStarting(EI_Globals glob){ #pragma unused(glob)    return noErr;}// ImageCodecQueueStopping//     The base image decompressor calls your ImageCodecQueueStopping// function to notify your codec that the frames in the queue have been// decompressed. After your image decompressor component handles an// ImageCodecQueueStopping call, it can perform any tasks that are required// when decompression of the frames is finished, such as disposing of data// structures that are no longer needed.// If your codec supports asynchronous scheduled decompression you must// implement this selector. If your codec does not need to do anything at// this time simply return noErr.// The base image decompressor never calls the ImageCodecQueueStopping// function at interrupt time.pascal ComponentResult EI_ImageCodecQueueStopping(EI_Globals glob){ #pragma unused(glob)    return noErr;} ...</pre>               </TD>            </TR>            <TR>               <td align="left">                  <P><B>Listing 1</B>. Implementing QueueStarting                  &amp; QueueStopping</P>               </TD>            </TR>         </TABLE>         </CENTER>                  <P><BR>         </P>                  <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <pre>// If your codec doesn't need to perform any work in QueueStarting// and QueueStopping, you can use ComponentNoError in your dispatcher// and let ComponentDispatchHelper do the work for you.// ComponentDispatchHelper will return noErr for these two selectors and not// badComponentSelector.// MySubCodecDispatch.h ...    ComponentRangeBegin (3)        ComponentCall     (Preflight)        ComponentCall     (Initialize)        ComponentCall     (BeginBand)        ComponentCall     (DrawBand)        ComponentCall     (EndBand)<B>        ComponentNoError  (QueueStarting)        ComponentNoError  (QueueStopping)</B>        ComponentDelegate (DroppingFrame)        ComponentDelegate (ScheduleFrame)        ComponentDelegate (CancelTrigger)    ComponentRangeEnd (3) ...</pre>               </TD>            </TR>            <TR>               <td align="left">                  <P><B>Listing 2</B>. Using ComponentNoError to                  implement QueueStarting &amp; QueueStopping</P>               </TD>            </TR>         </TABLE>         </CENTER>                  <P><BR>         </P>                           <H3>References:</H3>                  <BLOCKQUOTE><A HREF="http://developer.apple.com/documentation/quicktime/qtdevdocs/RM/rmCodecComp.htm" TARGET="_blank">QuickTime            Codec Components</A>                        <P><A HREF="http://developer.apple.com/documentation/quicktime/qtdevdocs/REF/refBaseImage.15.htm">Base            Image Decompressor Functions</A></P></BLOCKQUOTE>                  <P>                  <hr width=500 align=center>                  </P>                  <!-- begin_date --><H4><CENTER>[Jul 09 2002]</CENTER></H4><!-- end_date -->      </TD>   </TR></TABLE></CENTER><P><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1157.html%3Fid%3DDTS10001701-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1157.html%3Fid%3DDTS10001701-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1157.html%3Fid%3DDTS10001701-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></P></BODY></HTML>