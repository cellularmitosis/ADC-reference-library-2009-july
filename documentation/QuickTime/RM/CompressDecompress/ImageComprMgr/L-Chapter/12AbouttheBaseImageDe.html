<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Compression and Decompression Guide: About the Base Image Decompressor</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="About the Base Image Decompressor"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor" title="About the Base Image Decompressor"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../CompressionDecompression-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000498" target="_top">Compression &amp; Decompression</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000878-IntroductiontoQuickTimeCompressionandDecompressionGuide-DontLinkElementID_145">QuickTime Compression and Decompression Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../K-Chapter/11CodecComponentsAPI.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../M-Chapter/13UsingDataCodecCompo.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-SW1" title="About the Base Image Decompressor"></a>
<h1>About the Base Image Decompressor</h1>

<p>This chapter describes the features of the base image decompressor. The base image decompressor is an Apple-supplied component that makes it easier for developers to create new decompressors. The base image decompressor does most of the housekeeping and interface functions required for a QuickTime decompressor component, including scheduling for asynchronous decompression.</p>
<p>Whenever possible, an image decompressor component should handle asynchronous requests for decompression, as described in  <span class="content_text"><a href="../J-Chapter/10UsingImageCompresso.html#//apple_ref/doc/uid/TP40000878-UsingImageCompressorComponents-AsynchronousDecompression">Asynchronous Decompression</a></span>. If you are implementing an image decompressor component, you can include this capability with a minimum of additional programming by using the services of the base image decompressor. The base image decompressor handles the necessary scheduling, which frees you to concentrate on the details of decompression.</p>
<p>When you use the base image decompressor with an image decompressor component, your component must support functions that are called by the base image decompressor when necessary. Your component can then delegate a number of other function calls to the base image decompressor, which greatly simplifies the implementation of your component.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_98">Using the Base Image Decompressor</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_99">Connecting to the Base Image Decompressor</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_100">Providing Storage for Frame Decompression</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_101">Initializing Your Decompressor Component</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_102">Specifying Other Capabilities of Your Component</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_103">Implementing Functions for Queues</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_104">Decompressing Bands</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_105">Implementing ImageCodecBeginBand</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_106">Implementing ImageCodecDrawBand</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_107">Implementing ImageCodecEndBand</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_108">Providing Information About the Decompressor</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_109">Providing Progress Information</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_110">Handling and Delegating Other Calls</a>
				
			<br/>
			
        
			
			
				<a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_111">Closing the Component</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_98" title="Using the Base Image Decompressor"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-UsingtheBaseImageDecompressor" title="Using the Base Image Decompressor"></a>Using the Base Image Decompressor</h2>
<p>To use the services of the base image decompressor, your image decompressor component must support functions that the base image decompressor calls when necessary. The following sections explain when the base image decompressor calls these functions and how your image decompressor component must respond. These sections also list standard image decompressor calls that your image decompressor must handle itself rather than delegate.</p>
<p>The base image decompressor and image decompressor components are managed by the Component Manager.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_99" title="Connecting to the Base Image Decompressor"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ConnectingtotheBaseImageDecompressor" title="Connecting to the Base Image Decompressor"></a>Connecting to the Base Image Decompressor</h2>
<p>To use the services of the base image decompressor, your image decompressor component must open a connection to the base image decompressor component. Listing&#160;11-1 illustrates how to make the connection.</p>
<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_181" title="Listing 11-1Connecting to the base image decompressor component"></a>
<p class="codesample"><strong>Listing 11-1&nbsp;&nbsp;</strong>Connecting to the base image decompressor component</p>
<div class="codesample"><table><tr><td scope="row"><pre>ComponentInstance baseCodec;<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>err = OpenADefaultComponent (decompressorComponentType,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; kBaseCodecType,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#38;baseCodec);<span></span></pre></td></tr><tr><td scope="row"><pre>err = ComponentSetTarget (baseCodec,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;self);<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_100" title="Providing Storage for Frame Decompression"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ProvidingStorageforFrameDecompression" title="Providing Storage for Frame Decompression"></a>Providing Storage for Frame Decompression</h2>
<p>Your image decompressor component uses an <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure to store information needed to decompress a single frame. The structure is created by the base decompressor component when your component is initialized, as described in  <span class="content_text"><a href="12AbouttheBaseImageDe.html#//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-InitializingYourDecompressorComponent">Initializing Your Decompressor Component</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_101" title="Initializing Your Decompressor Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-InitializingYourDecompressorComponent" title="Initializing Your Decompressor Component"></a>Initializing Your Decompressor Component</h2>
<p>The first function call that your image decompressor component receives from the base image decompressor is always a call to <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecInitialize" target="_top">ImageCodecInitialize</a></code>. In response to this call, your image decompressor component returns an <code><!--a target="_top" -->ImageSubCodecDecompressCapabilities<!--/a--></code> structure that specifies its capabilities. This structure contains the following fields:</p>
<ul class="ul">
<li class="li"><p><code>canAsync</code> specifies whether the component can support asynchronous decompression operations, as described in  <span class="content_text"><a href="../J-Chapter/10UsingImageCompresso.html#//apple_ref/doc/uid/TP40000878-UsingImageCompressorComponents-AsynchronousDecompression">Asynchronous Decompression</a></span>.</p></li>
<li class="li"><p><code>decompressRecordSize</code> specifies the size of the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure that the base decompressor component creates for your image decompressor component.</p></li>
</ul>
<p>With the help of the base image decompressor, any image decompressor that uses only interrupt-safe calls for decompression operations can support asynchronous decompression.</p>
<p>Listing&#160;11-2 shows how to specify that a decompressor supports asynchronous decompression operations.</p>
<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_182" title="Listing 11-2Specifying the capabilities of a decompressor component."></a>
<p class="codesample"><strong>Listing 11-2&nbsp;&nbsp;</strong>Specifying the capabilities of a decompressor component.</p>
<div class="codesample"><table><tr><td scope="row"><pre>ImageSubCodecDecompressCapabilities deccap;<span></span></pre></td></tr><tr><td scope="row"><pre>ImageSubCodecDecompressRecord decrec;<span></span></pre></td></tr><tr><td scope="row"><pre>deccap-&#62;decompressRecordSize = sizeof(decrec);<span></span></pre></td></tr><tr><td scope="row"><pre>deccap-&#62;canAsync = true;<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_102" title="Specifying Other Capabilities of Your Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-SpecifyingOtherCapabilitiesofYourComponent" title="Specifying Other Capabilities of Your Component"></a>Specifying Other Capabilities of Your Component</h2>
<p>The base image decompressor gets additional information about the capabilities of your image decompressor component by calling your component&#8217;s <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecPreflight" target="_top">ImageCodecPreflight</a></code> function. The base image decompressor uses this information when responding to a call to the <code>ImageCodecPredecompress</code> function, which the Image Compression Manager makes before decompressing an image.</p>
<p>Your image decompressor component returns information about its capabilities by filling in the <code>capabilities</code> structure. Listing&#160;11-3 illustrates how to fill in this structure. In this example, the decompressor component specifies that it supports the ARGB, ABGR, BGRA, and RGBA pixel formats used by Microsoft Windows.</p>
<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_183" title="Listing 11-3Sample implementation of ImageCodecPreflight"></a>
<p class="codesample"><strong>Listing 11-3&nbsp;&nbsp;</strong>Sample implementation of ImageCodecPreflight</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult ImageCodecPreflight (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ComponentInstance ci,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CodecDecompressParams *p)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;register CodecCapabilities*capabilities = p-&#62;capabilities;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*&#160;&#160;Decide which depth compressed data we can deal with. */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;switch ( (*p-&#62;imageDescription)-&#62;depth ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case 16:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return(codecConditionErr);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*&#160;&#160;We can deal only 32 bit pixels. */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;capabilities-&#62;wantedPixelSize = 32;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*&#160;&#160;The smallest possible band we can do is 2 scan lines. */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;capabilities-&#62;bandMin = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*&#160;&#160;We can deal with 2 scan line high bands. */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;capabilities-&#62;bandInc = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*&#160;&#160;If we needed our pixels to be aligned on some integer<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;multiple we would set these to<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;the number of pixels we need the dest extended by.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;If we dont care, or we take care of<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;it ourselves we set them to zero.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;capabilities-&#62;extendWidth = p-&#62;srcRect.right &#38; 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;capabilities-&#62;extendHeight = p-&#62;srcRect.bottom &#38; 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OSType *pf = *glob-&#62;wantedDestinationPixelTypeH;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;p-&#62;wantedDestinationPixelTypes =<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;glob-&#62;wantedDestinationPixelTypeH;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// set up default order<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[0] = k32BGRAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[1] = k32ARGBPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[2] = k32ABGRPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[3] = k32RGBAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch (p-&#62;dstPixMap.pixelFormat) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32BGRAPixelFormat: // we know how to do these pixel formats<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32ABGRPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[0] = k32ABGRPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[1] = k32BGRAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[2] = k32ARGBPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[3] = k32RGBAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32ARGBPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[0] = k32ARGBPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[1] = k32BGRAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[2] = k32ABGRPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[3] = k32RGBAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32RGBAPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[0] = k32RGBAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[1] = k32BGRAPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[2] = k32ARGBPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pf[3] = k32ABGRPixelFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// we don't know how to do these, so return<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// the default<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return(noErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_103" title="Implementing Functions for Queues"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ImplementingFunctionsforQueues" title="Implementing Functions for Queues"></a>Implementing Functions for Queues</h2>
<p>If the image decompressor component supports asynchronous scheduled decompression, it receives a <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecQueueStarting" target="_top">ImageCodecQueueStarting</a></code> call from the base image decompressor when processing of the queue begins and the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecQueueStopping" target="_top">ImageCodecQueueStopping</a></code> function when processing of the queue is finished. It is not necessary for your image decompressor component to implement these functions. Implement them only if there are tasks that your image decompressor component must perform after being notified, such as locking structures in memory before <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> is called.</p>
<p>Calls to <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecQueueStarting" target="_top">ImageCodecQueueStarting</a></code> and <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecQueueStopping" target="_top">ImageCodecQueueStopping</a></code> are never made during interrupt time.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_104" title="Decompressing Bands"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DecompressingBands" title="Decompressing Bands"></a>Decompressing Bands</h2>
<p>Your image decompressor component must implement the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> and <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> functions for decompressing bands. It can also implement the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecEndBand" target="_top">ImageCodecEndBand</a></code> function to be information that decompression of a band is complete. It receives these calls from the base image decompressor when decompression of either a complete frame or an individual band needs to be performed.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_105" title="Implementing ImageCodecBeginBand"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ImplementingImageCodecBeginBand" title="Implementing ImageCodecBeginBand"></a>Implementing ImageCodecBeginBand</h2>
<p>The <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> function allows your image decompressor component to save information about a band before decompressing it. For example, your image decompressor component can change the value of the <code>codecData</code> pointer if not all of the data for the band needs to be decompressed. The base image decompressor preserves any changes your image decompressor component makes to any of the fields in the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> or <code><!--a target="_top" -->CodecDecompressParams<!--/a--></code> structures.</p>
<p>The <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> function is never called at interrupt time. If your component supports asynchronous scheduled decompression, it may receive more than one <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> call before receiving an <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> call.</p>
<p>A sample implementation of <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> is shown in Listing&#160;11-4.</p>
<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_184" title="Listing 11-4Sample implementation of ImageCodecBeginBand"></a>
<p class="codesample"><strong>Listing 11-4&nbsp;&nbsp;</strong>Sample implementation of ImageCodecBeginBand</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult ImageCodecBeginBand (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ComponentInstance ci,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CodecDecompressParams *p,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ImageSubCodecDecompressRecord *drp,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;long flags)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ExampleDecompressRecord *mydrp = drp-&#62;userDecompressRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;numLines,numStrips;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stripBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;width;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;y;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cDataPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/* initialize some local variables */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;width = (*p-&#62;imageDescription)-&#62;width;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;numLines = p-&#62;stopLine - p-&#62;startLine;&#160;&#160;/* number of scanlines in */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* this band */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;numStrips = (numLines+1)&#62;&#62;1;&#160;&#160;&#160;&#160;/* number of strips in this band */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;stripBytes = ((width+1)&#62;&#62;1) * 5;&#160;&#160;&#160;&#160;/* number of bytes in one */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* strip of blocks */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cDataPtr = drp-&#62;codecData;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/*<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;If skipping some data, just skip it here. We can tell because<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;firstBandInFrame says this is the first band for a new frame, and<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; *&#160;&#160;if startLine is not zero, then that many lines were clipped out.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160; */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if ( (p-&#62;conditionFlags &#38; codecConditionFirstBand) &#38;&#38; p-&#62;startLine != 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( p-&#62;dataProcRecord.dataProc ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for ( y=0; y &#60; p-&#62;startLine&#62;&#62;1; y++ ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( (result=CallICMDataProc(p-&#62;dataProcRecord.dataProc,&#38;cDataPtr,stripBytes,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;drp-&#62;dataProcRecord.dataRefCon)) != noErr ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result = codecSpoolErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cDataPtr += stripBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cDataPtr += (p-&#62;startLine&#62;&#62;1) * stripBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;drp-&#62;codecData = cDataPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;mydrp-&#62;width = width;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;mydrp-&#62;numStrips = numStrips;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;mydrp-&#62;srcDataIncrement = stripBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;mydrp-&#62;baseAddrIncrement = drp-&#62;rowBytes&#60;&#60;1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;mydrp-&#62;glob = (void *)storage;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;/* figure out our dest pixel format and select the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;correct DecompressStripProc */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;switch(p-&#62;dstPixMap.pixelFormat) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case 0:&#160;&#160;&#160;&#160;&#160;// old case where planebytes<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// is not set by codecmanager<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32ARGBPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mydrp-&#62;decompressStripProc = DecompressStrip32ARGB;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32ABGRPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mydrp-&#62;decompressStripProc = DecompressStrip32ABGR;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32BGRAPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mydrp-&#62;decompressStripProc = DecompressStrip32BGRA;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case k32RGBAPixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mydrp-&#62;decompressStripProc = DecompressStrip32RGBA;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_106" title="Implementing ImageCodecDrawBand"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ImplementingImageCodecDrawBand" title="Implementing ImageCodecDrawBand"></a>Implementing ImageCodecDrawBand</h2>
<p>When the base image decompressor calls your image decompressor component&#8217;s <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> function, your component must perform the decompression specified by the fields of the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure. The structure includes any changes your component made to it when performing the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> function.</p>
<p>If the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure specifies either a progress function or a data-loading function, the base image decompressor never calls the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> function at interrupt time. If not, the base image decompressor may call the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> function at interrupt time.</p>
<p>If the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure specifies a progress function, the base image decompressor handles <code>codecProgressOpen</code> and <code>codecProgressClose</code> calls, and your image decompressor component must not implement these functions.</p>
<p>If your component supports asynchronous scheduled decompression, it may receive more than one <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBeginBand" target="_top">ImageCodecBeginBand</a></code> call before receiving an <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> call.</p>
<p>A sample implementation of <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecDrawBand" target="_top">ImageCodecDrawBand</a></code> is shown in Listing&#160;11-5.</p>
<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_185" title="Listing 11-5Sample implementation of ImageCodecDrawBand"></a>
<p class="codesample"><strong>Listing 11-5&nbsp;&nbsp;</strong>Sample implementation of ImageCodecDrawBand</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult ImageCodecDrawBand (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ComponentInstance ci,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ImageSubCodecDecompressRecord *drp)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ExampleDecompressRecord *mydrp = drp-&#62;userDecompressRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short y;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr cDataPtr = drp-&#62;codecData;&#160;&#160;// compressed data pointer;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr baseAddr = drp-&#62;baseAddr;&#160;&#160;&#160;// base address of dest PixMap;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SInt8 mmuMode = true32b;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// we want to be in 32-bit mode<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;for (y = 0; y &#60; mydrp-&#62;numStrips; y++) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (drp-&#62;dataProcRecord.dataProc) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( (err =<span></span></pre></td></tr><tr><td scope="row"><pre>CallICMDataProc(drp-&#62;dataProcRecord.dataProc,&#38;cDataPtr,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mydrp-&#62;srcDataIncrement,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;drp-&#62;dataProcRecord.dataRefCon)) != noErr ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = codecSpoolErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SwapMMUMode(&#38;mmuMode);&#160;&#160;&#160;&#160;&#160;&#160;// put us in 32-bit mode<span></span></pre></td></tr><tr><td scope="row"><pre>(mydrp-&#62;decompressStripProc)(cDataPtr,baseAddr,(short)drp-&#62;rowBytes,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(short)mydrp-&#62;width,glob-&#62;sharedGlob); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SwapMMUMode(&#38;mmuMode);&#160;&#160;&#160;&#160;&#160;&#160;// put us back<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;baseAddr += mydrp-&#62;baseAddrIncrement;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cDataPtr += mydrp-&#62;srcDataIncrement;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (drp-&#62;progressProcRecord.progressProc) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( (err =<span></span></pre></td></tr><tr><td scope="row"><pre>CallICMProgressProc(drp-&#62;progressProcRecord.progressProc,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecProgressUpdatePercent,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FixDiv ( y, mydrp-&#62;numStrips),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;drp-&#62;progressProcRecord.progressRefCon)) != noErr ) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = codecAbortErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_107" title="Implementing ImageCodecEndBand"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ImplementingImageCodecEndBand" title="Implementing ImageCodecEndBand"></a>Implementing ImageCodecEndBand</h2>
<p>Your image decompressor component is not required to implement the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecEndBand" target="_top">ImageCodecEndBand</a></code> function. If it does, the base image decompressor calls the function when the decompression of a band is complete or is terminated by the Image Compression Manager. The call simply notifies your component that decompression is finished. After your component handles the call, it can perform any tasks that are necessary when decompression is finished, such as disposing of data structures that are no longer used, after receiving notification. Note that because the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecEndBand" target="_top">ImageCodecEndBand</a></code> function can be called at interrupt time, your image decompressor component cannot use this function to dispose of data structures; this must occur after handling the function.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_108" title="Providing Information About the Decompressor"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ProvidingInformationAbouttheDecompressor" title="Providing Information About the Decompressor"></a>Providing Information About the Decompressor</h2>
<p>Your image decompressor component must also implement the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetCodecInfo" target="_top">ImageCodecGetCodecInfo</a></code>. This performs the same task as the <code>CDGetCodecInfo</code> function. The Image Compression Manager calls your image decompressor component&#8217;s <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetCodecInfo" target="_top">ImageCodecGetCodecInfo</a></code> function when it receives a <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/GetCodecInfo" target="_top">GetCodecInfo</a></code> call.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_109" title="Providing Progress Information"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ProvidingProgressInformation" title="Providing Progress Information"></a>Providing Progress Information</h2>
<p>If the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure does not specify a progress function, your image decompressor component can implement <code>codecProgressOpen</code> and <code>codecProgressClose</code> functions to provide progress information. If the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure does specify a progress function, your image decompressor component can implement the <code>codecProgressUpdatePercent</code> function to provide progress information during lengthy decompression operations. Implementing this function is optional.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_110" title="Handling and Delegating Other Calls"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-HandlingandDelegatingOtherCalls" title="Handling and Delegating Other Calls"></a>Handling and Delegating Other Calls</h2>
<p>Your image decompressor component must delegate the following image decompressor component calls to the base image decompressor:</p>
<ul class="ul">
<li class="li"><p><code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecPreDecompress" target="_top">ImageCodecPreDecompress</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBandDecompress" target="_top">ImageCodecBandDecompress</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecBusy" target="_top">ImageCodecBusy</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecFlush" target="_top">ImageCodecFlush</a></code></p></li>
</ul>
<p>If the <code><!--a target="_top" -->ImageSubCodecDecompressRecord<!--/a--></code> structure specifies a progress function, your image decompressor component must also delegate these decompressor component calls to the base image decompressor:</p>
<ul class="ul">
<li class="li"><p><code>codecProgressOpen</code></p></li>
<li class="li"><p><code>codecProgressClose</code></p></li>
</ul>
<p>Your image decompressor component can implement any other image decompressor component functions itself or delegate any of the calls to the base image decompressor. To delegate calls, it uses the <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/DelegateComponentCall" target="_top">DelegateComponentCall</a></code> function.</p>

<a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-DontLinkElementID_111" title="Closing the Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-AbouttheBaseImageDecompressor-ClosingtheComponent" title="Closing the Component"></a>Closing the Component</h2>
<p>When your image decompressor component closes, it must close its connection to the base image decompressor by calling the <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/CloseComponent" target="_top">CloseComponent</a></code> function.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../K-Chapter/11CodecComponentsAPI.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../M-Chapter/13UsingDataCodecCompo.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/L-Chapter/12AbouttheBaseImageDe.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/L-Chapter/12AbouttheBaseImageDe.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/L-Chapter/12AbouttheBaseImageDe.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>