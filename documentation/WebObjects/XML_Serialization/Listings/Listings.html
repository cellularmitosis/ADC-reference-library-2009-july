<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects XML Serialization Guide: Code Listings</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Code Listings"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000184" title="Code Listings"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../AboutThisBook/AboutThisBook.html#//apple_ref/doc/uid/TP30000177-DontLinkElementID_4">WebObjects XML Serialization Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SchemaAndDTD/SchemaAndDTD.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory/RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000184-SW7" title="Code Listings"></a><h1>Code Listings</h1><p>This appendix contains the listings of the example serialization utility classes used in <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW36">“Serializing Objects and Data”</a></span> and <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW13">“Transforming XML Documents”</a></span> and the example transformation script, which is also used in the transformation of XML documents.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Listings.html#//apple_ref/doc/uid/TP30000184-SW1">BinarySerialization.java</a>
				
			<br/>
			
        
			
			
				<a href="Listings.html#//apple_ref/doc/uid/TP30000184-SW3">XMLSerializer.java</a>
				
			<br/>
			
        
			
			
				<a href="Listings.html#//apple_ref/doc/uid/TP30000184-SW5">SimpleTransformation.xsl</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000184-SW1" title="BinarySerialization.java"></a><h2>BinarySerialization.java</h2><p><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_56"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_57"></a><span class="content_text">Listing B-1</span> shows the implementation of the BinarySerialization example class.</p><a name="//apple_ref/doc/uid/TP30000184-SW2" title="Listing B-1BinarySerializer.java class"></a><p class="codesample"><strong>Listing B-1&nbsp;&nbsp;</strong><code>BinarySerializer.java</code> class</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.appserver.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.BufferedInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.BufferedOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.FileInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.FileOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.IOException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.lang.ClassNotFoundException;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Manages serialization and deserialization of objects<span></span></pre></td></tr><tr><td scope="row"><pre> * to and from binary files.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class BinarySerializer {<span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Encapsulates a file stream and an object stream (a channel).<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static class Channel {<span></span></pre></td></tr><tr><td scope="row"><pre>        protected Object file_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        protected Object object_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        protected boolean input_stream;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Channel(Object file_stream, Object object_stream, boolean input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>            this.file_stream = file_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>            this.object_stream = object_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>            this.input_stream = input_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Stores open channels.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static NSMutableDictionary channels = new NSMutableDictionary();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Directory in which serialized data intended for<span></span></pre></td></tr><tr><td scope="row"><pre>     * deserialization is stored.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static final String FILE_PREFIX = "/tmp/";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Suffix (including extension) of files used to store serialized data.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static final String FILE_SUFFIX = "_data.binary";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Serializes data to a file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param source          object to serialize<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param identifier      file identifier for deserialization<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        (name of the file without the extension)<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return &lt;code>true&lt;/code> when the process succeeds.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static boolean serializeObject(Object source, String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    ObjectOutputStream binary_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        String filename = FILE_PREFIX + identifier + FILE_SUFFIX;<span></span></pre></td></tr><tr><td scope="row"><pre>        boolean success = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create a stream to the output file.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream = (ObjectOutputStream)BinarySerializer.openStream(filename, false);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Serialize data to output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream.writeObject(source);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream.flush();<span></span></pre></td></tr><tr><td scope="row"><pre>            closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            success = true;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return success;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Deserializes data from a file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param identifier      file identifier (name of the file<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        without the extension)<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return deserialized object.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static Object deserializeObject(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    ObjectInputStream binary_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        String filename = FILE_PREFIX + identifier + FILE_SUFFIX;<span></span></pre></td></tr><tr><td scope="row"><pre>        Object object = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create a stream to the input file.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream = (ObjectInputStream)openStream(filename, true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Deserialize data from input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            object = (Object)binary_stream.readObject();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        catch (ClassNotFoundException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return object;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename          fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                          target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                          the channel to open.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static ObjectOutputStream openOutputStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (ObjectOutputStream)openStream(filename, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens an input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename           fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           the channel to open.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static ObjectInputStream openInputStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (ObjectInputStream)openStream(filename, true);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens a file stream to or from a file and a corresponding<span></span></pre></td></tr><tr><td scope="row"><pre>     * output or input object stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     * The method adds the pair of streams to an internal dictionary<span></span></pre></td></tr><tr><td scope="row"><pre>     * for use by the &lt;code>closeStream&lt;/code> method.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename           fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           the channel to open.<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param input_stream       indicates whether the stream returned<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           is an input stream or an output stream:<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           &lt;code>true&lt;/code> for an input stream and<span></span></pre></td></tr><tr><td scope="row"><pre>     *                           &lt;code>false&lt;/code> for an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return object stream, &lt;code>null&lt;/code> when the stream could not<span></span></pre></td></tr><tr><td scope="row"><pre>     *         be created.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static Object openStream(String filename, boolean input_stream) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        BufferedOutputStream file_output_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>        BufferedInputStream file_input_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>        Channel channel;<span></span></pre></td></tr><tr><td scope="row"><pre>        Object binary_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create an input stream from the file.<span></span></pre></td></tr><tr><td scope="row"><pre>            file_input_stream = new BufferedInputStream(new FileInputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Create object-input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream = new ObjectInputStream(file_input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            channel = new Channel(file_input_stream, binary_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create an output stream to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>            file_output_stream = new BufferedOutputStream(new FileOutputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Create object-output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            binary_stream = new ObjectOutputStream(file_output_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            channel = new Channel(file_output_stream, binary_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        channels.setObjectForKey(channel, filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return binary_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Closes an object stream and its corresponding file stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename             fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                             target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                             the streams to close.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static void closeStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>    Channel channel = (Channel)channels.objectForKey(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (channel.input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>        ((ObjectInputStream)channel.object_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>        ((BufferedInputStream)channel.file_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        ((ObjectOutputStream)channel.object_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>        ((BufferedOutputStream)channel.file_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    channels.removeObjectForKey(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000184-SW3" title="XMLSerializer.java"></a><h2>XMLSerializer.java</h2><p><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_58"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_59"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_60"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_61"></a><span class="content_text">Listing B-2</span> shows the implementation of the XMLSerializer example class.</p><a name="//apple_ref/doc/uid/TP30000184-SW4" title="Listing B-2XMLSerializer.java class"></a><p class="codesample"><strong>Listing B-2&nbsp;&nbsp;</strong><code>XMLSerializer.java</code> class</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.appserver.WOApplication;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.appserver.WOResourceManager;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.xml.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.BufferedInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.BufferedOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.File;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.FileInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.FileNotFoundException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.FileOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.InputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.IOException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.OutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import javax.xml.transform.Transformer;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Manages serialization and deserialization of objects<span></span></pre></td></tr><tr><td scope="row"><pre> * to and from XML files.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class XMLSerializer extends Object {<span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Encapsulates a file stream and an object stream (a channel).<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static class Channel {<span></span></pre></td></tr><tr><td scope="row"><pre>        protected Object file_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        protected Object object_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        protected boolean input_stream;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Channel(Object file_stream, Object object_stream, boolean input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>            this.file_stream = file_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>            this.object_stream = object_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>            this.input_stream = input_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Identifier for a simple transformation.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static final String TRANSFORM_SIMPLE = "SimpleTransformation";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Directory where serialized data is stored.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static final String FILE_PREFIX = "/tmp/";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Suffix (including extension) of files used to store serialized data.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static final String FILE_SUFFIX = "_data.xml";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Stores open channels.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static NSMutableDictionary channels = new NSMutableDictionary();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Serializes data to a file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param source          object to serialize<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param identifier      file identifier for deserialization<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        (name of the file without its path or extension)<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return &lt;code>true&lt;/code> when the process succeeds.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static boolean serializeObject(Object source, String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>        String filename = FILE_PREFIX + identifier + FILE_SUFFIX;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        boolean success = transformObject(source, filename, null);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return success;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Deserializes data from a file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param identifier      file identifier<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        (name of the file without the extension)<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return deserialized object.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static Object deserializeObject(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>        String filename = FILE_PREFIX + identifier + FILE_SUFFIX;<span></span></pre></td></tr><tr><td scope="row"><pre>        Object object = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create a stream from the input file.<span></span></pre></td></tr><tr><td scope="row"><pre>            NSXMLInputStream stream = (NSXMLInputStream)openStream(filename, true, null);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Deserialize data from input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            object = stream.readObject();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Close stream<span></span></pre></td></tr><tr><td scope="row"><pre>            closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        catch (FileNotFoundException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        catch (ClassNotFoundException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return object;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Serializes objects and data to a stream, which can also be<span></span></pre></td></tr><tr><td scope="row"><pre>     * transformed. The product of the process is written to a file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param source          object to serialize or transform<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename        filename of the target document,<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        including path and extension<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param transformation  type of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        indicates which transformation script to use.<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        When &lt;code>null&lt;/code>, no transformation<span></span></pre></td></tr><tr><td scope="row"><pre>     *                        is to be performed, only serialization.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return &lt;code>true&lt;/code> when the process succeeds.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static boolean transformObject(Object source, String filename, String transformation) {<span></span></pre></td></tr><tr><td scope="row"><pre>        boolean success = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create a stream to the output file.<span></span></pre></td></tr><tr><td scope="row"><pre>            NSXMLOutputStream stream = (NSXMLOutputStream)openStream(filename, false, transformation);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Serialize data to object output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            stream.writeObject(source);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            stream.flush();<span></span></pre></td></tr><tr><td scope="row"><pre>            closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            success = true;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>            e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return success;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename         fully qualified filename of the target<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         or source file; identifies the channel to open.<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param transformation   type of transformation to perform<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         (indicates which transformation file to use)<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static NSXMLOutputStream openOutputStream(String filename, String transformation) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (NSXMLOutputStream)openStream(filename, false, transformation);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens an input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename   fully qualified filename of the target<span></span></pre></td></tr><tr><td scope="row"><pre>     *                   or source file; identifies the channel to open.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static NSXMLInputStream openInputStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (NSXMLInputStream)openStream(filename, true, null);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Opens a file stream to or from a file and a corresponding<span></span></pre></td></tr><tr><td scope="row"><pre>     * output or input object stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     * Adds the pair of streams to an internal dictionary for use by<span></span></pre></td></tr><tr><td scope="row"><pre>     * the &lt;code>closeStream&lt;/code> method.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename       fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         the channel to open<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param input_stream     indicates whether the stream returned<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         is an input stream or an output stream:<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         &lt;code>true&lt;/code> for an input stream and<span></span></pre></td></tr><tr><td scope="row"><pre>     *             &lt;code>false&lt;/code> for an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param transformation   type of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         indicates which transformation script to use.<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         When &lt;code>null&lt;/code> no transformation<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         is performed, only serialization.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return object stream, &lt;code>null&lt;/code> when the stream<span></span></pre></td></tr><tr><td scope="row"><pre>     *         could not be created.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static Object openStream(String filename, boolean input_stream, String transformation) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        BufferedOutputStream file_output_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>        BufferedInputStream file_input_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>        Channel channel;<span></span></pre></td></tr><tr><td scope="row"><pre>        Object xml_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create an input stream from the file.<span></span></pre></td></tr><tr><td scope="row"><pre>            file_input_stream = new BufferedInputStream(new FileInputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Create object-input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            xml_stream = new NSXMLInputStream(file_input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            channel = new Channel(file_input_stream, xml_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create an output stream to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>            file_output_stream = new BufferedOutputStream(new FileOutputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Create object-output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>            if (transformation != null) {<span></span></pre></td></tr><tr><td scope="row"><pre>                xml_stream = initializeTransformer(file_output_stream, transformation);<span></span></pre></td></tr><tr><td scope="row"><pre>            } else {<span></span></pre></td></tr><tr><td scope="row"><pre>                xml_stream = new NSXMLOutputStream(file_output_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // Set the format of the output document (XML).<span></span></pre></td></tr><tr><td scope="row"><pre>            NSXMLOutputFormat format = new NSXMLOutputFormat(true);<span></span></pre></td></tr><tr><td scope="row"><pre>            ((NSXMLOutputStream)xml_stream).setOutputFormat(format);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            channel = new Channel(file_output_stream, xml_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        channels.setObjectForKey(channel, filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Closes an object stream and its corresponding file stream.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param filename   fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre>     *                   target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre>     *                   the channel to close<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public static void closeStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        Channel channel = (Channel)channels.objectForKey(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (channel.input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>            ((NSXMLInputStream)channel.object_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>            ((BufferedInputStream)channel.file_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            ((NSXMLOutputStream)channel.object_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>            ((BufferedOutputStream)channel.file_stream).close();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        channels.removeObjectForKey(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Computes the URI of a transformation file.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param transformation   type of transformation (does not<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         include the .xsl extension);<span></span></pre></td></tr><tr><td scope="row"><pre>     *                         for example, "SimpleTransformation"<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return relative path to the transformation file.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static String transformationURI(String transformation) {<span></span></pre></td></tr><tr><td scope="row"><pre>        WOApplication application = WOApplication.application();<span></span></pre></td></tr><tr><td scope="row"><pre>        WOResourceManager resource_manager = application.resourceManager();<span></span></pre></td></tr><tr><td scope="row"><pre>        String transformationURI = resource_manager.pathForResourceNamed("SimpleTransformation" + ".xsl", null, null);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return transformationURI;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Initializes the transformer.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param file_stream       target file stream<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param transformationtype of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre>     *                          indicates which transformation script to use<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @throws IOException when there's a problem initializing<span></span></pre></td></tr><tr><td scope="row"><pre>     *         the transformer.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private static NSXMLOutputStream initializeTransformer(BufferedOutputStream file_stream, String transformation) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream xml_stream = new NSXMLOutputStream(file_stream, new File(transformationURI(transformation)));<span></span></pre></td></tr><tr><td scope="row"><pre>        Transformer transformer = ((NSXMLOutputStream)xml_stream).transformer();<span></span></pre></td></tr><tr><td scope="row"><pre>        transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000184-SW5" title="SimpleTransformation.xsl"></a><h2>SimpleTransformation.xsl</h2><p><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_62"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_63"></a><a name="//apple_ref/doc/uid/TP30000184-DontLinkElementID_64"></a><span class="content_text">Listing B-3</span> shows an example of an XSLT file that is used by an XML transformer or XSLT processor to transform an XML document generated by NSXMLOutputStream into another XML document.</p><a name="//apple_ref/doc/uid/TP30000184-SW6" title="Listing B-3SimpleTransformation.xsl file"></a><p class="codesample"><strong>Listing B-3&nbsp;&nbsp;</strong><code>SimpleTransformation.</code>xsl file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlns:woxml="http://www.apple.com/webobjects/XMLSerialization"<span></span></pre></td></tr><tr><td scope="row"><pre>    exclude-result-prefixes="woxml"<span></span></pre></td></tr><tr><td scope="row"><pre>    version="1.0"><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:output method="xml" encoding="UTF-8" omit-xml-declaration="no" indent = "yes"/><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- ** Constants ** --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Indicates how dictionaries are encoded: key-value or two-array. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:variable name="dictionary_encoding"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:value-of select="'key-value'" /><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- ** Utilities ** --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Gets the base class name from a fully-qualified class name. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template name="basename"><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;xsl:param name="path"/><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>     &lt;xsl:when test="contains($path, '.')"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:call-template name="basename"><span></span></pre></td></tr><tr><td scope="row"><pre>           &lt;xsl:with-param name="path" select="substring-after($path, '.')"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:call-template><span></span></pre></td></tr><tr><td scope="row"><pre>     &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>     &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:value-of select="$path"/><span></span></pre></td></tr><tr><td scope="row"><pre>     &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- ** Element Processing ** --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes the tree root. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template match="/"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:element name="content"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:apply-templates select="woxml:content" /><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes the root element (woxml:content). --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template match="woxml:content"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:apply-templates select="*"/><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes woxml:object elements. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template name="process_object" match="woxml:object"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- extract class name --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:variable name="className"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:value-of select="woxml:class/@name" /><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- get base class name --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:variable name="class"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:call-template name="basename"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:with-param name="path" select="$className"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:call-template><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- determine the element name --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:variable name="tag"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="$class='NSDictionary' or $class='NSMutableDictionary'"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="'dictionary'" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="$class='NSArray' or $class='NSMutableArray'"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="'array'" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="$class" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- create the element --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:element name="{$tag}"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="$class='NSDictionary' or $class='NSMutableDictionary'"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:call-template name="process_dictionary" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:call-template name="process_object_content" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes the content of a woxml:object element. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template name="process_object_content"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:apply-templates select="*" /><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes woxml:class elements. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template match="woxml:class" /><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes woxml:array elements. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template match="woxml:array"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:for-each select="woxml:object"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:call-template name="process_object" /><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:for-each><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes primitive-type and woxml:string elements. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template match="woxml:boolean|woxml:byte|woxml:ch|woxml:short|woxml:int|<span></span></pre></td></tr><tr><td scope="row"><pre>                     woxml:long|woxml:float|woxml:double|woxml:string"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- determine the element name --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:variable name="element_name"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="@key"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="@key" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="@field"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="@field" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="name()" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- store possible reference to another element --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:variable name="ref"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:value-of select="@idRef" /><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;!-- create the element --><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:element name="{$element_name}"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:when test="string(number($ref))='NaN'"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;!-- $ref is not a number, therefore there's no reference --><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="." /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;!-- $ref is a number and, by extension, a reference --><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:value-of select="//*[@id=$ref]" /><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!-- Processes woxml:object elements that contain a NSDictionary or NSMutableDictionary. --><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;xsl:template name="process_dictionary"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:when test="$dictionary_encoding='key-value'"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;!-- output the two arrays as key-value pairs within item elements --><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:for-each select="woxml:array[1]"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:for-each select="*"><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;xsl:variable name="current_position"><span></span></pre></td></tr><tr><td scope="row"><pre>                        &lt;xsl:value-of select="position()" /><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;/xsl:variable><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;xsl:element name="item"><span></span></pre></td></tr><tr><td scope="row"><pre>                        &lt;xsl:element name="key"><span></span></pre></td></tr><tr><td scope="row"><pre>                            &lt;xsl:apply-templates select="." /><span></span></pre></td></tr><tr><td scope="row"><pre>                        &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        &lt;xsl:element name="value"><span></span></pre></td></tr><tr><td scope="row"><pre>                            &lt;xsl:apply-templates select="ancestor::*[position()=2]/child::woxml:array[2]/child::*[position()=$current_position]" /><span></span></pre></td></tr><tr><td scope="row"><pre>                        &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;/xsl:for-each><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:for-each><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:when><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;!-- output the two arrays on separate nodes --><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;xsl:for-each select="woxml:array"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;xsl:element name="array"><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;xsl:apply-templates select="*"/><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;/xsl:element><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/xsl:for-each><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/xsl:otherwise><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/xsl:choose><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:template><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/xsl:stylesheet><span></span></pre></td></tr></table></div>	

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SchemaAndDTD/SchemaAndDTD.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory/RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/XML_Serialization/Listings/Listings.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/XML_Serialization/Listings/Listings.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/XML_Serialization/Listings/Listings.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>