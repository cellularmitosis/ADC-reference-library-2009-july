<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1116: couldNotResolveDataRef (-2000) returned from DataHSetDataRef and OpenADataHandler</title><meta name="keywords" content="Data Handlers, couldNotResolveDataRef"><meta name="Description" content="Technical Q&amp;A QA1116: This Q&amp;A describes why DataHSetDataRefand OpenADataHandler may return a couldNotResolveDataReferror in the writing case."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Feb 4, 2002 - Feb 8, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001664" title="couldNotResolveDataRef (-2000) returned from DataHSetDataRef and OpenADataHandler"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxQuickTimeComponentCreation-date.html">QuickTime Component Creation</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1116</div>
<div id="pageheadsub">couldNotResolveDataRef (-2000) returned from DataHSetDataRef and OpenADataHandler</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      I'm currently working on implementing the MovieExportFromProceduresToDataRef      function for an export component, but I've run into      couldNotResolveDataRef errors using <CODE>DataHSetDataRef</CODE> and <CODE>OpenADataHandler</CODE>      APIs.</p><P id=p2>      In the DataHSetDataRef case, I manually iterate over all      the Data Handler components using FindNextComponent until      I find a handler for the dataRefType I'm passed in (I'm      currently only concerned with 'alis' references). I open      it using OpenComponent and call DataHSetDataRef. This results      in a couldNotResolveDataRef (-2000) error.</p><P id=p2>      After looking though some QuickTime documentation I encountered      OpenADataHandler. This seemed like a much better, more convenient      way to do what I needed. I removed all my previous code in      favor of this single API, but it returns the same couldNotResolveDataRef      error.</p><P id=p2>      Is there something else I can do to get DataHSetDataRef to      work? Is OpenADataHandler the correct API?</p>                          <P id=p4>A: DataHSetDataRef assigns a data reference to the data handler           component you're working with, this reference is used to identify and           locate a movie's container.<BR>        </p><P id=p4>      The 'alis' Data Handler Components internal implementation      of DataHSetDataRef performs a MatchAlias to find the file      referenced. If the file does not yet exist, MatchAlias will      return a file not found error ('fnfErr') but will also return      a valid FSSpec.</p><P id=p4>      The error returned from DataHSetDataRef in this case is couldNotResolveDataRef,      exactly what is being seen. The data reference is good, even      though the call returned an error.</p><P id=p4>      OpenADataHandler on the other hand is a 'convenience' function      which finds, opens, and sets up a data handler component      in a single call. It's internal implementation uses the sequence      of GetDataHandler, OpenAComponent and SetDataRef calls. However,      it checks the result of DataHSetDataRef and fails if the      result is not 'noErr', again returning couldNotResolveDataRef.</p><P id=p4>      Therefore, you currently cannot replace the GetDataHandler,      OpenAComponent, SetDataRef sequence of calls (see Listing 1) with the simpler      OpenADataHandler call for the writing case. If the file already      exists you will not encounter this problem.</p>        <P id=p4> Notice the result from DataHSetDataRef is ignored in the code because           the file might not exist.</p>        <table border=0 cellpadding=4 width=550>          <tr>            <td bgcolor="#E6E6E6" align=left scope="row">               <pre>Component   dh;DataHandler theDataHandler;dh = GetDataHandler((Handle)inAlias, inDataRefType, kDataHCanRead | kDataHCanWrite);if (NULL == dh) {    err = cantFindHandler;    goto bail;}err = OpenAComponent(dh, &amp;theDataHandler);if (err) goto bail;// Ignore error from this call, as the file may not already existDataHSetDataRef(theDataHandler, (Handle)inAlias);</pre>            </td>          </tr>          <tr>            <td align="left" scope="row">               <p><b>Listing 1</b>. Finding and Opening a Data Handler</p>            </td>          </tr>        </table>        <P id=p4>      Additionally, developers should be aware that component manager      functions are often unable to make the best choice when there      are several different data handlers available for data references      of a specific type. Developers should always use either GetDataHandler      or OpenADataHandler (note the case discussed above) APIs when attempting to find and/or open      a Data Handler Component. Using FindNextComponent may get      you something you didn't really want.</p><P id=p4>      For example, when looking for an 'alis' Data Handler you      could find the &quot;Apple Alias Data Handler for CDi Disks&quot;      or the &quot;Apple Alias Data Handler&quot; or the &quot;Streaming      file data handler.&quot; All three have the same Type and      SubType but serve different purposes.</p><P id=p4>      Additional information:</p>        <P id=p4> <a href="../../documentation/quicktime/qtdevdocs/RM/rmDataHandlerComp.htm" target="_blank">QuickTime           Data Handler Documentation</a> </p>                <P id=p4> <a href="../../documentation/quicktime/qtdevdocs/REF/refDataHandlerComp.7.htm" target="_blank">Using           Data Handler Components</a> </p>                <P id=p4> <a href="../../documentation/quicktime/qtdevdocs/APIREF/SOURCESI/getdatahandler.htm" target="_blank">GetDataHandler           Reference</a> </p>                <P id=p4> <a href="../../documentation/quicktime/qtdevdocs/APIREF/SOURCESII/openadatahandler.htm" target="_blank">OpenADataHandler           Reference</a> </p>                <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Feb 07 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1116.html%3Fid%3DDTS10001664-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1116.html%3Fid%3DDTS10001664-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1116.html%3Fid%3DDTS10001664-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>