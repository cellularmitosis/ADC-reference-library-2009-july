<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Mac OS X ABI Function Call Guide: IA-32 Function Calling Conventions</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="IA-32 Function Calling Conventions"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002492" title="IA-32 Function Calling Conventions"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000436" target="_top">Tools</a> &gt; <a href="../../../CompilersDebuggers-date.html#//apple_ref/doc/uid/TP30000440-TP30000436-TP30001025" target="_top">Compiling &amp; Debugging</a> &gt; <a href="../index.html" target="_top">Mac OS X ABI Function Call Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../110-64-bit_PowerPC_Function_Calling_Conventions/64bitPowerPC.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../140-x86-64_Function_Calling_Conventions/x86_64.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40002492-SW4" title="IA-32 Function Calling Conventions"></a><hr /><H1>IA-32 Function Calling Conventions</H1><p>When functions (routines) call other functions (subroutines), they may need to pass arguments to them. The called subroutines access these arguments as <strong>parameters</strong>. Conversely, some subroutines pass a <strong>result</strong> or return value to their callers. In the IA-32 environment most arguments are passed on the runtime stack; some vector arguments are passed in registers. Results are returned in registers or in memory. To efficiently pass values between callers and callees, GCC follows strict rules when it generates a program’s object code.</p><p>This article describes the data types that can be used to manipulate the arguments and results of subroutine calls, how routines pass arguments to the subroutines they call, and how subroutines that provide a return value pass the result to their callers. This article also lists the registers available in the IA-32 architecture and whether their value is preserved after a subroutine call.</p><p>The function calling conventions used in the IA-32 environment are the same as those used in the System V IA-32 ABI, with the following exceptions:</p><ul class="ul"><li class="li"><p>Different rules for returning structures</p></li><li class="li"><p>The stack is 16-byte aligned at the point of function calls</p></li><li class="li"><p>Large data types (larger than 4 bytes) are kept at their natural alignment</p></li><li class="li"><p>Most floating-point operations are carried out using the SSE unit instead of the x87 FPU, except when operating on <code>long double</code> values. (The IA-32 environment defaults to 64-bit internal precision for the x87 FPU.)</p></li></ul><p>The content of this article is largely based in <em>System V Application Binary Interface: Intel386 Architecture Processor Supplement</em>, available at <span class="content_text"><a href="http://www.caldera.com/developers/devspecs/abi386-4.pdf" target="_blank">http://www.caldera.com/developers/devspecs/abi386-4.pdf</a></span>.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW11">Data Types and Data Alignment</a>
				
			<br/>
			
        
			
			
				<a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW19">Function Calls</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002492-SW11" title="Data Types and Data Alignment"></a><h2>Data Types and Data Alignment</h2><p>Using the correct data types for your variables helps to maximize the performance and portability of your programs. Data alignment<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_204"></a> specifies how data is laid out in memory. A data type’s <strong>natural alignment</strong> specifies the default alignment of values of that that type.</p><p><span class="content_text">Table 1</span> lists the ANSI C scalar<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_205"></a> data types and their sizes and natural alignment in this environment.</p><a name="//apple_ref/doc/uid/TP40002492-SW1" title="Table 1Size and natural alignment of the scalar data types"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1&nbsp;&nbsp;</strong>Size and natural alignment of the scalar data types</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Size (in bytes)</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Natural alignment (in bytes)</p></th></tr><tr><td  scope="row"><p><code>_Bool</code>, <code>bool</code></p></td><td ><p>1</p></td><td ><p>1</p></td></tr><tr><td  scope="row"><p><code>unsigned char</code></p></td><td ><p>1</p></td><td ><p>1</p></td></tr><tr><td  scope="row"><p><code>char</code>, <code>signed char</code></p></td><td ><p>1</p></td><td ><p>1</p></td></tr><tr><td  scope="row"><p><code>unsigned short</code></p></td><td ><p>2</p></td><td ><p>2</p></td></tr><tr><td  scope="row"><p><code>signed short</code></p></td><td ><p>2</p></td><td ><p>2</p></td></tr><tr><td  scope="row"><p><code>unsigned int</code></p></td><td ><p>4</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>signed int</code></p></td><td ><p>4</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>unsigned long</code></p></td><td ><p>4</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>signed long</code></p></td><td ><p>4</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>unsigned long long</code></p></td><td ><p>8</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>signed long long</code></p></td><td ><p>8</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>float</code></p></td><td ><p>4</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>double</code></p></td><td ><p>8</p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>long double</code></p></td><td ><p>16</p></td><td ><p>16</p></td></tr><tr><td  scope="row"><p>pointer</p></td><td ><p>4</p></td><td ><p>4</p></td></tr></table></div><p><span class="content_text">Table 2</span> shows the vector types available in this environment.</p><a name="//apple_ref/doc/uid/TP40002492-SW8" title="Table 2Size and alignment of the vector types"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2&nbsp;&nbsp;</strong>Size and alignment of the vector types</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Vector type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Element data type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Size (in bytes)</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Alignment (in bytes)</p></th></tr><tr><td  scope="row"><p><code>__m64</code></p></td><td ><p><code>int</code></p></td><td ><p>8</p></td><td ><p>8</p></td></tr><tr><td  scope="row"><p><code>__m128i</code></p></td><td ><p><code>int</code></p></td><td ><p>16</p></td><td ><p>16</p></td></tr><tr><td  scope="row"><p><code>__m128</code></p></td><td ><p><code>float</code></p></td><td ><p>16</p></td><td ><p>16</p></td></tr><tr><td  scope="row"><p><code>__m128d</code></p></td><td ><p><code>double</code></p></td><td ><p>16</p></td><td ><p>16</p></td></tr></table></div><p>These are some important details about this environment:</p><ul class="ul"><li class="li"><p>A byte<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_206"></a> is 8 bits long.</p></li><li class="li"><p>A null pointer<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_207"></a> has a value of 0.</p></li><li class="li"><p>This environment doesn’t require 8-byte alignment for double-precision<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_208"></a> values.</p></li><li class="li"><p>This environment requires 16-byte alignment for 128-bit vector<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_209"></a> elements.</p></li></ul><p>These are the alignment rules<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_210"></a> followed in this environment:</p><ol class="ol"><li class="li"><p>Scalar data types use their natural alignment.</p></li><li class="li"><p>Composite data types (arrays, structures, and unions) take on the alignment of the member with the highest alignment. An array assumes the same alignment as its elements. The size of a composite data type is a multiple of its alignment (padding may be required).</p></li></ol><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_211"></a><a name="//apple_ref/doc/uid/TP40002492-SW19" title="Function Calls"></a><h2>Function Calls</h2><p>This section details the process of calling a subroutine and passing parameters to it, and how subroutines return values to their callers.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002492-SW20" title="Note"></a><p><strong>Note:</strong>&nbsp;These parameter-passing conventions are part of the Apple standard for procedural programming interfaces. Object-oriented languages may use different rules for their own method calls. For example, the conventions for C++ virtual function calls may be different from those for C functions.</p></div><a name="//apple_ref/doc/uid/TP40002492-SW16" title="Stack Structure"></a><h3>Stack Structure</h3><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_212"></a><p>The IA-32 environment uses a stack that—at the point of function calls—is 16-byte aligned, grows downward, and contains local variables and a function’s parameters. Each routine may add linkage information to its stack frame, but it’s not required to do so. <span class="content_text">Figure 1</span> shows the stack before and during a subroutine call. (To help prevent the execution of malicious code on the stack, GCC protects the stack against execution.)</p><br/><div><a name="//apple_ref/doc/uid/TP40002492-SW2" title="Figure 1Stack layout"></a><p><strong>Figure 1&nbsp;&nbsp;</strong>Stack layout</p><img src = "../art/ia-32_stack.jpg" alt = "" ></div><br/><p>The <strong>stack pointer</strong> (SP)<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_213"></a> points to the bottom of the stack. Stack frames contain the following areas:</p><ul class="spaceabove"><li class="li"><p><strong>The parameter area</strong><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_214"></a> stores the arguments the caller passes to the called subroutine. This area resides in the caller’s stack frame.</p></li><li class="li"><p><strong>The linkage area</strong><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_215"></a> contains the address of the caller’s next instruction.</p></li><li class="li"><p><strong>The saved frame pointer</strong><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_216"></a> (optional) contains the base address of the caller’s stack frame.</p><p>You can use the <code>gcc -fomit-frame-pointer</code> option to make the compiler not save, set up, and restore the frame pointer in function calls that don’t need one, making the EBP register available for general use. However, doing so may impair debugging.</p></li><li class="li"><p>The <strong>local storage area</strong> contains the subroutine’s local variables and the values of the registers that must be restored before the called function returns. See <span class="content_text"><a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW7">“Register Preservation”</a></span> for details.</p></li><li class="li"><p>The <strong>saved registers area</strong> contains the values of the registers that must be restored before the called function returns. See <span class="content_text"><a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW7">“Register Preservation”</a></span> for details.</p></li></ul><p>In this environment, the stack frame size is not fixed.</p><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_217"></a><a name="//apple_ref/doc/uid/TP40002492-SW15" title="Prologs and Epilogs"></a><h3>Prologs and Epilogs</h3><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_218"></a><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_219"></a><p>The called subroutine is responsible for allocating its own stack frame. This operation is accomplished by a section of code called the <strong>prolog</strong>, which the compiler places before the body of the function. After the body of the function, the compiler places an <strong>epilog</strong> to restore the process to the state it was prior to the subroutine call.</p><p>The prolog performs the following tasks:</p><ol class="ol"><li class="li"><p>Pushes the value of the stack frame pointer<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_220"></a> (EBP) onto the stack.</p></li><li class="li"><p>Sets the stack frame pointer to the value of the stack pointer<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_221"></a> (ESP).</p></li><li class="li"><p>Pushes the values of the registers that must be preserved (EDI, ESI, and EBX) onto the stack.</p></li><li class="li"><p>Allocates<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_222"></a> space in the stack frame for local storage.</p></li></ol><p>The epilog performs these tasks:</p><ol class="ol"><li class="li"><p>Deallocates the space used for local storage in the stack.</p></li><li class="li"><p>Restores the preserved registers (EDI, ESI, EBX, EBP) by popping the values saved on the stack by the prolog.</p></li><li class="li"><p>Returns.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40002492-SW21" title="Note"></a><p><strong>Note:</strong>&nbsp;Functions called during signal handling<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_223"></a> have no unusual restrictions on their use of registers. When a signal-handling function returns, the process resumes its original path with the registers restored to their original values.</p></div><p><span class="content_text">Listing 1</span> shows the definition of the <code>simp</code><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_224"></a> function.</p><a name="//apple_ref/doc/uid/TP40002492-SW12" title="Listing 1Definition of the simp function"></a><p class="codesample"><strong>Listing 1&nbsp;&nbsp;</strong>Definition of the <code>simp</code> function</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>void simp(int i, short s, char c) {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("Hi!\n");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 2</span> shows a possible prolog for the <code>simp</code> function.</p><a name="//apple_ref/doc/uid/TP40002492-SW14" title="Listing 2Example prolog"></a><p class="codesample"><strong>Listing 2&nbsp;&nbsp;</strong>Example prolog</p><div class="codesample"><table><tr><td scope="row"><pre>pushl   %ebp            ; save EBP<span></span></pre></td></tr><tr><td scope="row"><pre>movl    %esp,%ebp       ; copy ESP to EBP<span></span></pre></td></tr><tr><td scope="row"><pre>pushl   %ebx            ; save EBX<span></span></pre></td></tr><tr><td scope="row"><pre>subl    $0x24,%esp      ; allocate space for local storage<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 3</span> shows a possible epilog for the <code>simp</code> function.</p><a name="//apple_ref/doc/uid/TP40002492-SW13" title="Listing 3Example epilog"></a><p class="codesample"><strong>Listing 3&nbsp;&nbsp;</strong>Example epilog</p><div class="codesample"><table><tr><td scope="row"><pre>addl    $0x24,%esp      ; deallocate space for local storage<span></span></pre></td></tr><tr><td scope="row"><pre>popl    %ebx            ; restore EBX<span></span></pre></td></tr><tr><td scope="row"><pre>popl    %ebp            ; restore EBP<span></span></pre></td></tr><tr><td scope="row"><pre>ret                     ; return<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_225"></a><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_226"></a><a name="//apple_ref/doc/uid/TP40002492-SW3" title="Passing Arguments"></a><h3>Passing Arguments</h3><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_227"></a><p>The compiler adheres to the following rules when passing arguments to subroutines:</p><ol class="ol"><li class="li"><p>The caller ensures that the stack is 16-byte aligned<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_228"></a> at the point of the function call.</p></li><li class="li"><p>The caller aligns nonvector<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_229"></a> arguments to 4-byte (32 bits) boundaries.</p><p>The size of each argument is a multiple of 4 bytes, with tail padding when necessary. Therefore, 8-bit and 16-bit integral data types are promoted to 32-bit before they are pushed onto the stack.</p></li><li class="li"><p>The caller places arguments in the parameter area<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_230"></a> in reverse order, in 4-byte chunks. That is, the rightmost argument has the highest address.</p></li><li class="li"><p>The caller places all the fields of structures<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_231"></a> (or unions) with no vector elements in the parameter area. These structures are 4-byte aligned .</p></li><li class="li"><p>The caller places structures with vector elements on the stack, 16-byte aligned. Each vector within the structure is 16-byte aligned.</p></li><li class="li"><p>The caller places 64-bit vectors<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_232"></a> (<code>__m64</code>) on the parameter area, aligned to 8-byte boundaries.</p></li><li class="li"><p>The caller places vectors 128-bit vectors<a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_233"></a> (<code>__m128</code>, <code>__m128d</code>, and <code>__m128i</code>) in registers XMM0 through XMM3). When the usable XMM registers are exhausted, the caller places 128-bit vectors in the parameter area. The caller aligns 128-bit vectors in the parameter area to 16-byte boundaries.</p></li></ol><p>In general, the caller is responsible for removing all the parameters used in a function call after the called function returns. The only exception are parameters that are generated automatically by GCC. <a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_234"></a>When a function returns a structure or union larger than 8 bytes, the caller passes a pointer to appropriate storage as the first argument to the function. GCC adds this parameter automatically in the code generated. See <span class="content_text"><a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW5">“Returning Results”</a></span> for more information. For example, the compiler would translate the code shown in <span class="content_text">Listing 4</span> to machine language as if it were written as shown in <span class="content_text">Listing 5</span>.</p><a name="//apple_ref/doc/uid/TP40002492-SW17" title="Listing 4Using a large structure&acirc;&#128;&#148;source code"></a><p class="codesample"><strong>Listing 4&nbsp;&nbsp;</strong>Using a large structure—source code</p><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_235"></a><div class="codesample"><table><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    float ary[8];<span></span></pre></td></tr><tr><td scope="row"><pre>} big_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>big_struct callee(int a, float b) {<span></span></pre></td></tr><tr><td scope="row"><pre>    big_struct callee_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    return callee_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>caller() {<span></span></pre></td></tr><tr><td scope="row"><pre>    big_struct caller_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>    caller_struct = callee(3, 42.0);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002492-SW18" title="Listing 5Using a large structure&acirc;&#128;&#148;compiler interpretation"></a><p class="codesample"><strong>Listing 5&nbsp;&nbsp;</strong>Using a large structure—compiler interpretation</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    float ary[8];<span></span></pre></td></tr><tr><td scope="row"><pre>} big_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>void callee(big_struct *p, int a, float b)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    big_struct callee_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    *p = callee_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>    return;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>caller() {<span></span></pre></td></tr><tr><td scope="row"><pre>    big_struct caller_struct;<span></span></pre></td></tr><tr><td scope="row"><pre>    callee(&amp;caller_struct, 3, 42.0);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002492-SW22" title="Passing Arguments of the Fundamental Data Types"></a><h4>Passing Arguments of the Fundamental Data Types</h4><p>Assume the function <code>foo</code><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_236"></a> is declared like this:</p><div class="codesample"><table><tr><td scope="row"><pre>void foo(SInt32 i, float f, double d, SInt16 s, UInt8 c);<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 2</span> illustrates the placement of arguments in the parameter area at the point of the function call. Note the padding added to align the stack at 16 bytes.</p><br/><div><a name="//apple_ref/doc/uid/TP40002492-SW9" title="Figure 2Argument assignment with arguments of the fundamental data types"></a><p><strong>Figure 2&nbsp;&nbsp;</strong>Argument assignment with arguments of the fundamental data types</p><img src = "../art/ia32_call_simple.jpg" alt = "" ></div><br/><a name="//apple_ref/doc/uid/TP40002492-SW23" title="Passing Structures and Vectors"></a><h4>Passing Structures and Vectors</h4><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_237"></a><p>Assume the structure <code>data</code> and the function <code>bar</code><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_238"></a> are declared like this:</p><div class="codesample"><table><tr><td scope="row"><pre>struct data {<span></span></pre></td></tr><tr><td scope="row"><pre>    float f;<span></span></pre></td></tr><tr><td scope="row"><pre>    long long l;<span></span></pre></td></tr><tr><td scope="row"><pre>    __m128 vf;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>void bar(SInt32 i, UInt8 c, struct data b, __m128i vi, void* p);<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 3</span> illustrates the placement of arguments in the parameter area, the stack’s 16-byte alignment padding at the point of the call, and the XMM registers.</p><br/><div><a name="//apple_ref/doc/uid/TP40002492-SW10" title="Figure 3Argument assignment with structure and vector arguments"></a><p><strong>Figure 3&nbsp;&nbsp;</strong>Argument assignment with structure and vector arguments</p><img src = "../art/ia32_call_struct_vector.jpg" alt = "" ></div><br/><a name="//apple_ref/doc/uid/TP40002492-SW5" title="Returning Results"></a><h3>Returning Results</h3><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_239"></a><p>This is how functions pass results to their callers:</p><ul class="spaceabove"><li class="li"><p><strong>Scalar values.</strong> Scalar values include structures that contain only one scalar value.</p><ul class="nested"><li class="nested li"><p>The called function places integral or pointer results in EAX.</p></li><li class="nested li"><p>The called function places floating-point results in ST0.</p></li><li class="nested li"><p>The caller removes the value from this register, even when it doesn’t use the value.</p></li></ul></li><li class="li"><p><strong>Structures.</strong> The called function returns structures according to their aligned size.</p><ul class="nested"><li class="nested li"><p>Structures 1 or 2 bytes in size are placed in EAX.</p></li><li class="nested li"><p>Structures 4 or 8 bytes in size are placed in: EAX and EDX.</p></li><li class="nested li"><p>Structures of other sizes are placed at the address supplied by the caller. For example, the C++ language occasionally forces the compiler to return a value in memory when it would normally be returned in registers. See <span class="content_text"><a href="IA32.html#//apple_ref/doc/uid/TP40002492-SW3">“Passing Arguments”</a></span> for more information.</p></li></ul></li><li class="li"><p><strong>Vectors.</strong></p><ul class="nested"><li class="nested li"><p>The called function places vectors at the address supplied by the caller.</p></li></ul></li></ul><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_240"></a><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_241"></a><a name="//apple_ref/doc/uid/TP40002492-SW7" title="Register Preservation"></a><h3>Register Preservation</h3><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_242"></a><p><span class="content_text">Table 3</span> lists the IA-32 architecture registers used in this environment and their volatility in procedure calls. Registers that must preserve their value after a function call are called <strong>nonvolatile</strong>.</p><a name="//apple_ref/doc/uid/TP40002492-SW6" title="Table 3Processor registers in the IA-32 architecture"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3&nbsp;&nbsp;</strong>Processor registers in the IA-32 architecture</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Preserved</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>General-purpose register</p></td><td ><p>EAX</p></td><td ><p>No</p></td><td ><p>Used to return integral and pointer values. The caller may also place the address to storage where the callee places its return value in this register.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>EDX</p></td><td ><p>No</p></td><td ><p>Dividend register (divide operation). Available for general use for all other operations.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>ECX</p></td><td ><p>No</p></td><td ><p>Count register (shift and string operations). Available for general use for all other operations.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>EBX</p></td><td ><p>Yes</p></td><td ><p>Position-independent code base register. Available for general use in non–position-independent code.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>EBP</p></td><td ><p>Yes</p></td><td ><p>Stack frame pointer. Optionally holds the base address of the current stack frame. A routine’s parameters reside in the previous frame as positive offsets of this register’s value. Local variables reside at negative offsets.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>ESI</p></td><td ><p>Yes</p></td><td ><p>Available for general use.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>EDI</p></td><td ><p>Yes</p></td><td ><p>Available for general use.</p></td></tr><tr><td  scope="row"><p>Stack-pointer register</p></td><td ><p>ESP</p></td><td ><p>Yes</p></td><td ><p>Holds the address of the bottom of the stack.</p></td></tr><tr><td  scope="row"><p>Floating-point register</p></td><td ><p>ST0</p></td><td ><p>No</p></td><td ><p>Used to return floating-point values. When the function doesn’t return a floating-point value, this register must be empty. This register must also be empty on function entry.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>ST1–ST7</p></td><td ><p>No</p></td><td ><p>Available for general use. These registers must be empty on routine entry and exit.</p></td></tr><tr><td  scope="row"><p>64-bit register</p></td><td ><p>MM0–MM7</p></td><td ><p>No</p></td><td ><p>Used to execute single-instruction, multiple-data (SIMD) operations on 64-bit packed byte, 2-byte, and 4-byte integers.</p></td></tr><tr><td  scope="row"><p>128-bit register</p></td><td ><p>XMM0–XMM7</p></td><td ><p>No</p></td><td ><p>Used to execute 32-bit and 64-bit floating-point arithmetic. Also used to execute single-instruction, multiple-data (SIMD) operations on 128-bit packed single-precision and double-precision scalar and floating-point values, and 128-bit packed byte, 2-byte, and 4-byte integers.  XMM0–XMM3 are used to pass the first four vectors in a function call.</p></td></tr><tr><td  scope="row"><p>System-flags register</p></td><td ><p>EFLAGS</p></td><td ><p>No</p></td><td ><p>Contains system flags, such as the direction flag and the carry flag. The direction flag must be set to the “forward” direction (that is, <code>0</code>) before entry to and upon exit from a routine. Other user flags have no specified role in the standard calling sequence and are not preserved.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002492-DontLinkElementID_243"></a>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../110-64-bit_PowerPC_Function_Calling_Conventions/64bitPowerPC.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../140-x86-64_Function_Calling_Conventions/x86_64.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/LowLevelABI/130-IA-32_Function_Calling_Conventions/IA32.html%3Fid%3DTP40002521-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/LowLevelABI/130-IA-32_Function_Calling_Conventions/IA32.html%3Fid%3DTP40002521-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/LowLevelABI/130-IA-32_Function_Calling_Conventions/IA32.html%3Fid%3DTP40002521-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
