<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>32-Bit Everything</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING123></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-122.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-124.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-115.html"><B>Chapter 10 - Classic 68K Runtime Architecture</B></A> / <A HREF="RTArch-119.html"><B>Bypassing MC68000 Addressing Limitations</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING123-0></A>
<H2><A NAME=MARKER-9-53></A><A NAME=MARKER-21-54></A>32-Bit Everything</H2>
 The 32-bit everything method allows you to remove limitations on segment size, global data size, and jump-table size by using compiler and linker <CODE>-model far</CODE> options instead of the default value, which is <CODE>-model near</CODE>. For each compilation unit, the compiler allows you to choose<A NAME=MARKER-2-55></A><P>
<UL>
<LI>full 32-bit offsets for global data by specifying the <CODE>-model farData</CODE> option
<LI>full 32-bit offsets for code references by specifying the <CODE>-model farCode</CODE> option
<LI>full 32-bit offsets for data and code by specifying the <CODE>-model far</CODE> option<P>
</UL>
 You can link any combination of near and far model compiled modules, but if any of the modules are compiled with the <CODE>-model far</CODE>, <CODE>-model farData</CODE>, or <CODE>-model farCode</CODE> options, you must specify the <CODE>-model far</CODE> linker option. <P>
<DL>
<DT><B>WARNING</B>
<DD>Because the 32-bit everything solution is implemented by modifications to the <CODE>LoadSeg</CODE>, <CODE>UnloadSeg</CODE>, <CODE>Launch</CODE>, <CODE>Chain</CODE>, and <CODE>ExitToShell</CODE> traps, it will not work if your application patches these traps without calling the original traps when your patch completes. If you need to use <CODE>_LoadSeg</CODE> or <CODE>_UnloadSeg</CODE> in the 32-bit everything environment, you must use the routines in the <CODE>RTLib.o</CODE> library. For details, see <A HREF=RTArch-137.html#MARKER-9-12>Appendix B</A>.<EM></EM><A NAME=MARKER-2-56></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 In assembly language, the use of a 32-bit reference for the target address of an instruction must be explicitly demanded by use of the absolute long address syntax (expr).<CODE>L</CODE>, where expr is a relocatable expression. Two other requirements must be met:<P>
<UL>
<LI>The relevant operand symbol must be imported. This means that the defining occurrence of the symbol must be in a different module than the module or modules containing its use as a 32-bit reference.
<LI>The option <CODE>-model far</CODE> must be used for the assembly. Since the absolute long address syntax specifies absolute operands by definition, the use of this form with a relocatable symbol is an error unless you specify the <CODE>-model far</CODE> option. <P>
</UL>
 Global data references, references to code in the same segment, and references to code in a different segment all cause the assembler to produce similar records that tell the linker that a 32-bit patch is needed. The linker determines whether the references are to code or data. If the reference is to code, the linker can also determine whether the reference is internal or external.<P>
 The example shown in <A HREF=#MARKER-9-57>Listing 10-1</A> illustrates using 32-bit references for the target address of an instruction.<P>
<B>Listing 10-1  <A NAME=MARKER-9-57></A>Using 32-bit references for the target address of an instruction</B><P>
<PRE>
            MAIN
            IMPORT STUFF               ; Symbols from other
            IMPORT THERE               ; modules must be
            IMPORT ELSEWHERE           ; imported.
            JSR (THERE).L              ; Symbols are written using
            JSR (ELSEWHERE).L          ; (xxx).L syntax.
            ADD.W (STUFF).L,DO
            ENDMAIN

            PROC                       ; Note that THERE is in the MAIN
            EXPORT            THERE    ; segment
THERE       NOP                        
            ENDPROC
            SEG               'SG1 '   ; Note that ELSEWHERE
            PROC                       ; is in a different segment
            EXPORT            ELSEWHERE
ELSEWHERE   NOP      
            ENDPROC
            PROC
            DATA
            EXPORT            STUFF    
STUFF       DS                1
            ENDPROC
            END
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-122.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-124.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
