<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Dispatching to Functions Defined by a Color Picker</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING40></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-39.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-41.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-29.html"><B>Chapter 2 - Color Picker Manager</B></A> / <A HREF="ACI-38.html"><B>Writing Your Own Color Pickers</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING40-0></A>
<H2><A NAME=MARKER-9-115></A>Dispatching to Functions Defined by a Color Picker</H2>
 <A NAME=MARKER-2-116></A>As explained in <A HREF=ACI-39.html#MARKER-9-109>"Creating a Component Resource for a Color Picker" (page 2-30)</A>, the code for your color picker should be contained in a resource. The Component Manager expects the entry point in this resource to be a function having this format:<P>
<PRE>
pascal ComponentResult MyColorPickerDispatch (
                                  ComponentParameters *params, 
                                  Handle storage)
</PRE>
 Whenever the Color Picker Manager uses the Component Manager to send a request to your color picker, the Component Manager calls your component's entry point and passes any parameters, along with information about the current connection, in a component parameters structure. The Component Manager also passes a handle to the global storage associated with that instance of your color picker.<P>
 When your color picker receives a request, it should examine the parameters to determine the nature of the request, perform the appropriate processing, set an error code if necessary, and return an appropriate function result to the Component Manager.<P>
 The component parameters structure is defined by a data structure of type <CODE>ComponentParameters</CODE>. The <CODE>what</CODE> field of this structure specifies the type of request. Your color picker's entry point should interpret the request code and then possibly dispatch to some other subroutine. Your color picker must be able to handle the required request codes represented by the constants <CODE>kComponentOpenSelect</CODE>, <CODE>kComponetCloseSelect</CODE>, <CODE>kComponentCanDoSelect</CODE>, and <CODE>kComponentVersionSelect</CODE>.<P>
<DL>
<DT><B>Note</B>
<DD>For complete details on required component request codes and the <CODE>ComponentParameters</CODE> structure, see the chapter "Component Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A NAME=MARKER-2-117></A>In addition to these required request codes, your color picker must also be able to handle the request codes defined by the elements of the <CODE>PickerMessages</CODE> enumerated data type, which is shown here and described in detail in <A HREF=#nonexistent-marker>"Request Codes" (page 2-12)</A> in <I>Advanced Color Imaging Reference</I>.<P>
<PRE>
typedef enum   {     /* request codes handled by a color picker */
 kInitPicker,  /* initialize any private data */
 kTestGraphicsWorld, /* test operability on current system */
 kGetDialog,   /* if using own dialog box, return its pointer; for 
                  default dialog box, return nil */
 kGetItemList, /* return a list of items for dialog box */
 kGetColor,    /* return original or newest color */
 kSetColor,    /* change original or newest color */
 kEvent,       /* perform any special processing necessary for an event */
 kEdit,        /* perform an editing command */
 kSetVisibility,/* make color picker visible or invisible */
 kDrawPicker,  /* redraw color picker */
 kItemHit,     /* respond to event in a dialog box item */
 kSetBaseItem, /* set base item for dialog box items */
 kGetProfile,  /* return a handle to the destination profile */
 kSetProfile,  /* change the destination color-matching profile */
 kGetPrompt,   /* return prompt string */
 kSetPrompt,   /* set a new prompt */
 kGetIconData, /* return script code and resource ID of icon family */
 kGetEditMenuState,/* return information about edit menu */
 kSetOrigin,   /* update any info about local coordinate system */
 kExtractHelpItem/* return information about help balloons */
} PickerMessages;
</PRE>
 Your color picker should respond to these request codes by performing the requested action. Your color picker may need to access additional information provided in the <CODE>params</CODE> field to service the request. The <CODE>params</CODE> field of the component parameters structure is an array that contains the parameters specified by the Color Picker Manager. Your color picker can use the <CODE>CallComponentFunctionWithStorage</CODE> function to extract the parameters from this array and pass these parameters to a subroutine of your color picker. <A HREF=#MARKER-9-118>Listing 2-16</A> illustrates how to define a color picker entry point routine. This example inspects the <CODE>params-&gt;what</CODE> field to determine which request code to handle.<P>
<B>Listing 2-16  <A NAME=MARKER-9-118></A>Handling Component Manager request codes</B><P>
<PRE>
pascal ComponentResult MyColorPickerDispatch(ComponentParameters *params, 
                                  Handle storage)
{
   short             message;
   ComponentResult   result;
   ComponentFunction RoutineToCall = 0;

   message = params-&gt;what;
   if (message &lt; 0)
      /* negative values are Component Manager request codes */
      switch (message)
      {
         case kComponentOpenSelect:
                              RoutineToCall = MyOpen; break;
         case kComponentCloseSelect:
                              RoutineToCall = MyClose; break;
         case kComponentCanDoSelect:
                              RoutineToCall = MyCanDo; break;
         case kComponentVersionSelect:
                              RoutineToCall = MyVersion; break;
         case kComponentRegisterSelect:
                              RoutineToCall = MyRegister; break;
         case kComponentTargetSelect:
                              RoutineToCall = MySetTarget; break;
         default:             return 0;    /* no error */
      }
   else
   {
      switch (message)
      {
         case kInitPicker:       RoutineToCall = MyInitPicker; break;
         case kTestGraphicsWorld:RoutineToCall = MyTestGraphicsWorld; break;
         case kGetDialog:        RoutineToCall = MyGetDialog; break;
         case kGetItemList:      RoutineToCall = MyGetItemList; break;
         case kGetColor:         RoutineToCall = MyGetColor; break;
         case kSetColor:         RoutineToCall = MySetColor; break;
         case kEvent:            RoutineToCall = MyDoEvent; break;
         case kEdit:             RoutineToCall = MyDoEdit; break;
         case kSetVisibility:    RoutineToCall = MySetVisibility; break;
         case kDrawPicker:       RoutineToCall = MyDrawPicker; break;
         case kItemHit:          RoutineToCall = MyItemHit; break;
         case kSetBaseItem:      RoutineToCall = MySetBaseItem; break;
         case kGetProfile:       RoutineToCall = MyGetProfile; break;
         case kSetProfile:       RoutineToCall = MySetProfile; break;
         case kGetPrompt:        RoutineToCall = MyGetPrompt; break;
         case kSetPrompt:        RoutineToCall = MySetPrompt; break;
         case kGetIconData:      RoutineToCall = MyGetIconData; break;
         case kGetEditMenuState: RoutineToCall = MyGetEditMenuState; break;
         case kSetOrigin:        RoutineToCall = MySetOrigin; break;
         case kExtractHelpItem:  RoutineToCall = MyExtractHelpItem; break;
         default:                return 0;
      }
   }
   result=CallComponentFunctionWithStorage(storage, params, RoutineToCall);
   return result;
}
</PRE>
 <A HREF=#nonexistent-marker>"Color Picker-Defined Functions" (page 2-59)</A> in <I>Advanced Color Imaging Reference</I> describes the interfaces your color picker must provide to respond to these request codes. The next several sections provide examples of how your color picker can respond to most of these request codes.<A NAME=MARKER-2-119></A><A NAME=MARKER-2-120></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-39.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-41.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
