<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><!-- <LINK REL="STYLESHEET" HREF="PowerMacG3.css"> --><script language="JavaScript" src="frametest.js"></script><TITLE> Features of the New Approach</TITLE></HEAD><BODY BGCOLOR="#ffffff"><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><table border="0" cellpadding="0" cellspacing="2" width="432">		<tr>	<td scope="row"><font face="Geneva,Helvetica,Arial" size="1">	<b>PATH<img src="../../../images/space.gif" width="6" height="12"></b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a --> 	<b>&gt;</b> Power Macintosh G3 Developer Note		</font></td>	</tr>	</table><!-- end of path --><DIV><!-- top navigation --><P><A HREF="PowerMacG3.52.html"><img src="images/up.gif" border="0" alt="Up"></A> <A HREF="PowerMacG3.53.html"><img src="images/previous.gif" border="0" alt="Previous"></A> <A HREF="PowerMacG3.55.html"><img src="images/next.gif" border="0" alt="Next"></A> <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></a></div><!-- end top navigation --><hr><h2 CLASS="H2.Heading2"><A NAME="pgfId=3308"> </A>Features of the New Approach<A NAME="marker=3307"> </A></h2><P CLASS="T1.Text1"><A NAME="pgfId=3309"> </A>Because the latest Power Macintosh G3 computer has new hardware features that are different from other Macintosh computers, new software features are needed in addition to the NewWorld requirements for other Macintosh computers. This list includes features that implement the NewWorld approach along with features that support the new hardware features: </P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3310"> </A>Power-on Self Test (POST) software, which resides in the boot ROM, provides hardware initialization and diagnostic functions. <A NAME="marker=4008"> </A></LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3311"> </A>Open Firmware, which resides in ROM, completes hardware initialization, provides a description of the hardware, loads initial operating system software, and transfers control to that software.<A NAME="marker=3312"> </A></LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3313"> </A>Run-Time Abstraction Services (RTAS), which resides in ROM, is instantiated into RAM through an Open Firmware method called by the OS. RTAS provides functions that are available to the operating system at any time to access platform-specific hardware, such as the real-time clock and NV-RAM.<A NAME="marker=3314"> </A><A NAME="marker=3315"> </A></LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3316"> </A>Mac OS ROM image, a file that contains the high-level software that resides in the Mac OS ROM on other Macintosh computers.<A NAME="marker=3317"> </A></LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3319"> </A>10Base-T/100Base-TX Ethernet device driver, in the boot ROM.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3320"> </A>Device driver for the USB hub, Apple USB keyboard, and Apple USB mouse, in the Mac OS ROM image.</LI></UL><P CLASS="T1.Text1"><A NAME="pgfId=3321"> </A>In addition to the above new features, changes have been made to the source base for the components of the Mac OS ROM to abstract it from the hardware. These changes are designed to reduce bring-up time and effort, improve reliability of the Mac OS ROM components, and reduce testing time by moving the changes necessary for a new computer to the boot ROM. Some of the hardware components accessed through this new abstracted software are the interrupt controller, ADB, USB, SCSI, ATA (IDE), sound, and Ethernet. </P><DIV><H4 CLASS="H3.Heading3"><A NAME="pgfId=3324"> </A>Performance <A NAME="marker=3323"> </A></H4><P CLASS="T1.Text1"><A NAME="pgfId=3325"> </A>Performance of a Power Macintosh G3 computer using ROM in RAM should exceed performance measurements for other Macintosh computers with comparable CPUs and speeds due to improved interrupt handling with the NewWorld approach. In addition, performance is improved due to executing code that normally exists in ROM in RAM, because the RAM devices operate faster than the ROM devices normally used. </P></DIV><DIV><H4 CLASS="H3.Heading3"><A NAME="pgfId=3327"> </A>RAM Footprint<A NAME="marker=3326"> </A></H4><P CLASS="T1.Text1"><A NAME="pgfId=3328"> </A>The latest Power Macintosh G3 computer has its Mac OS ROM image stored in RAM. This removes approximately 3 megabytes of RAM from availability for other uses. In effect, a system with 32 megabytes of RAM appears to have only 29 megabytes available. Some portion of the missing 3 megabytes is offset by having fewer patches in RAM. Other mechanisms are being explored in an attempt to minimize the impact of ROM-in-RAM.</P></DIV><DIV><H4 CLASS="H3.Heading3"><A NAME="pgfId=3330"> </A>User Experience<A NAME="marker=3329"> </A></H4><P CLASS="T1.Text1"><A NAME="pgfId=3331"> </A>Setting the boot volume from the Startup Disk control panel makes all the changes to the boot process that are necessary to operate with a Mac OS ROM image in RAM. The control panel user interface remains unchanged for this release. </P></DIV><DIV><H4 CLASS="H3.Heading3"><A NAME="pgfId=3333"> </A>Data Structures and Files<A NAME="marker=3332"> </A></H4><P CLASS="T1.Text1"><A NAME="pgfId=3334"> </A>The Mac OS ROM image is contained in a new file, named &quot;Mac OS ROM&quot;, that is kept in the System Folder. The Mac OS ROM image is exactly the same as it would be if it were an actual Mac OS ROM, containing the high-level software, the kernel software, and the 68K emulator.<A NAME="marker=3335"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=3336"> </A>The Startup Disk control panel sets the Open Firmware's boot-device configuration variable by modifying the Open Firmware NV-RAM partition that contains the Open Firmware's configuration variables. The format of the NV-RAM partition is defined in the Open Firmware CHRP Binding. The partition is accessed using RTAS.</P></DIV><DIV><H4 CLASS="H3.Heading3"><A NAME="pgfId=3339"> </A><A NAME="27176"> </A>Compatibility <A NAME="marker=3338"> </A></H4><P CLASS="T1.Text1"><A NAME="pgfId=3340"> </A>A Mac OS ROM image that is in write-protected RAM will appear to be a ROM to all MacOS software and applications. Because the image of the Mac OS ROM in RAM appears to be a ROM, the ROM-in-RAM approach is completely compatible with all application and system software.</P><P CLASS="T1.Text1"><A NAME="pgfId=3341"> </A>The Mac OS ROM image is kept in a file in the System Folder on the specified boot device. In order to avoid problems with localizing the name, the file is located by file type instead of by name.</P><P CLASS="T1.Text1"><A NAME="pgfId=3342"> </A>In order for Open Firmware to retrieve the Mac OS ROM image file, it must be able to read the selected boot device. If the Mac OS ROM image file is on a partition that is on a RAID, encrypted, striped, or otherwise non-standard device, Open Firmware must be able to read from these devices in order to boot the Mac OS. Two possible solutions to this problem are to have a standard partition available on the device that contains the Mac OS ROM image file, or to provide Open Firmware methods to read the file.<A NAME="marker=3343"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=3344"> </A>The main incompatibility that ROM-in-RAM approach introduces is that memory is not mapped one-to-one, as it has been for previous PCI-based Macs. Software that assumes the logical and physical addresses are the same will fail, even when virtual memory is not on. Well-behaved software--that is, software that calls the <TT CLASS="cv">LogicalToPhysical</TT> or <TT CLASS="cv">PrepareMemoryForIO</TT> functions when it needs a physical memory address--will continue to work.<A NAME="marker=3345"> </A> <A NAME="marker=3346"> </A><A NAME="marker=3347"> </A></P></DIV><BLOCKQUOTE><P CLASS="ImportantHead"><A NAME="pgfId=14722"> </A><B>IMPORTANT</B></P><P CLASS="I.Important"><A NAME="pgfId=4150"> </A>Designers of DMA device drivers should refer to <I CLASS="italics">Designing PCI Cards and Drivers for the Power Macintosh for a information about using the </I><TT CLASS="cv">PrepareMemoryForIO</TT><I CLASS="italics"> function to set up mapping for physical and logical addresses. The relevant section is on pages </I>219-229. For device drivers running with the NewWorld software, the sentence on page 227 that says &quot;Certain DMA transactions require both mapping tables&quot; should be interpreted to mean &quot;All DMA transactions...&quot;</P></BLOCKQUOTE><HR>\xA9 1998 Apple Computer, Inc. &#151; (Last Updated 5 Jan 99)<P><A HREF="PowerMacG3.52.html"><img src="images/up.gif" border="0" alt="Up"></A> <A HREF="PowerMacG3.53.html"><img src="images/previous.gif" border="0" alt="Previous"></A> <A HREF="PowerMacG3.55.html"><img src="images/next.gif" border="0" alt="Next"></A>  <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!-- document.write(frameLink);//--></script><!-- end Show/Hide frames --></a></P><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>