<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyCMMFlattenProfile(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING334></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-333.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-335.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-314.html"><B>Chapter 4 - ColorSync Manager Reference for Color Management Modules</B></A> / <A HREF="ACIReference-322.html"><B>Optional CMM-Defined Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B></B></A> / <A HREF="ACIReference-317.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING334-0></A>
<H3><A NAME=MARKER-9-77></A>MyCMMFlattenProfile</H3>
 Handles the <CODE>kCMMFlattenProfile</CODE> request by extracting profile data from the profile to flatten and passing it to the specified function.<P>
 A CMM may <A NAME=MARKER-2-78></A>respond to the <CODE>kCMMFlattenProfile</CODE> request code, but it is not required to do so. Most CMMs can rely on the default Apple CMM to handle this request code adequately. The ColorSync Manager sends this request code to your CMM on behalf of an application or device driver that called the <CODE>CMFlattenProfile</CODE> function. The ColorSync Manager dispatches this request to the Component Manager, which calls your CMM to service the request. A CMM that handles the <CODE>kCMMFlattenProfile</CODE> request code typically responds by calling a CMM-defined function (for example, <A NAME=MARKER-11-79></A><CODE>MyCMMFlattenProfile</CODE>). <P>
 The MyCMMFlattenProfile function is a color management module-defined subroutine.<P>
<PRE>
pascal CMError MyCMMFlattenProfile (
ComponentInstance CMSession,
CMProfileRef prof,
unsigned long flags,
CMFlattenUPP proc,
void *refCon); 
</PRE>
<DL>
<DT><CODE>CMSession</CODE>
<DD> A handle to your CMM's storage for the instance of your component associated with the calling application or device driver. 
<DT><CODE>prof</CODE>
<DD> A reference to the profile to flatten.
<DT><CODE>flags</CODE>
<DD> Reserved for future use. 
<DT><CODE>proc</CODE>
<DD> A pointer to the <CODE>MyColorSyncDataTransfer</CODE> function supplied by the calling application or device driver to perform the low-level data transfer. Your <CODE>MyCMMFlattenProfile</CODE> function calls this function repeatedly as necessary until all the profile data is transferred.
<DT><CODE>refCon</CODE>
<DD> A reference constant containing data specified by the calling application or device driver. 
<DT><I>function result</I>
<DD> A result code of type CMError. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-172)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING334-11></A>
<H5>DISCUSSION</H5>
 Only in rare circumstances should a custom CMM need to support this request code. The process of flattening a profile is complex, and the default Apple CMM handles this process adequately for most cases. A custom CMM might respond to this request code if the CMM provides special services such as profile data encryption or compression, for example. Read the rest of this description if your CMM handles this request code.<P>
 Your <CODE>MyCMMFlattenProfile</CODE> function must extract the profile data from the profile to flatten, identified by the <CODE>prof</CODE> parameter, and pass the profile data to the function specified in the <CODE>proc</CODE> parameter.<P>
 Your <CODE>MyCMMFlattenProfile</CODE> function calls the <CODE>MyColorSyncDataTransfer</CODE> function supplied by the calling application. Here is the prototype for the <CODE>MyColorSyncDataTransfer</CODE> function pointed to by the <CODE>proc</CODE> parameter:<P>
<PRE>
pascal OSErr MyColorSyncDataTransfer(
                  long command,
                  long *size, 
                  void *data,
                  void *refCon); 
</PRE>
 Your <CODE>MyCMMFlattenProfile</CODE> function communicates with the <CODE>MyColorSyncDataTransfer</CODE> function using a command parameter to identify the operation to perform. Your function should call the <CODE>MyColorSyncDataTransfer</CODE> function first with the <CODE>openWriteSpool</CODE> command to direct the <CODE>MyColorSyncDataTransfer</CODE> function to begin the process of writing the profile data you pass it in the <CODE>data</CODE> buffer. Next, you should call the <CODE>MyColorSyncDataTransfer</CODE> function with the <CODE>writeSpool</CODE> command. After the <CODE>MyColorSyncDataTransfer</CODE> function returns in the <CODE>size</CODE> parameter the amount of data it actually wrote, you should call the <CODE>MyColorSyncDataTransfer</CODE> function again with the <CODE>writeSpool</CODE> command, repeating this process as often as necessary until all the profile data is transferred. After the data is transferred, you should call the <CODE>MyColorSyncDataTransfer</CODE> function with the <CODE>closeSpool</CODE> command.<P>
 When your function calls the <CODE>MyColorSyncDataTransfer</CODE> function, it passes in the <CODE>data</CODE> buffer the profile data to transfer to the <CODE>MyColorSyncDataTransfer</CODE> function and the size in bytes of the buffered data in the <CODE>size</CODE> parameter. The <CODE>MyColorSyncDataTransfer</CODE> function may not always write all the data you pass it in the <CODE>data</CODE> buffer. Therefore, on return the <CODE>MyColorSyncDataTransfer</CODE> function command passes back in the <CODE>size</CODE> parameter the number of bytes it actually wrote. Your function keeps track of the number of bytes of remaining profile data.<P>
 Your <CODE>MyCMMFlattenProfile</CODE> function is responsible for obtaining the profile data from the profile, allocating a buffer in which to pass the data to the <CODE>MyColorSyncDataTransfer</CODE> function, and keeping track of the amount of remaining data to transfer to the <CODE>MyColorSyncDataTransfer</CODE> function.<P>
 Each time your <CODE>MyCMMFlattenProfile</CODE> function calls the <CODE>MyColorSyncDataTransfer</CODE> function, you pass it the reference constant passed to your function in the reference constant parameter.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-333.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-335.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
