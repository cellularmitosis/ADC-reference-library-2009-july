<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note QD01: 32-Bit QuickDraw: Version 1.2 Features</title>                                      <meta name="categories" content="QuickDraw"><meta name="week-posted" content="Mar 26, 1990 - Apr 6, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002714" title="32-Bit QuickDraw: Version 1.2 Features"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/index.html" target="_blank">Reference Library > QuickTime</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QD01</div>
<div id="pageheadsub">32-Bit QuickDraw: Version 1.2 Features</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">New Features (In No Particular Order)</A><BR><BR><A HREF="#Section3">Random Notes</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note describes the changes and enhancements to 32-Bit QuickDrawfrom version 1.0 (as shipped on the original Color Disk) to version 1.2, whichships with System Software 6.0.5 and later.  This Note assumes familiarity with<i>Inside Macintosh</i>, Volume V, Color QuickDraw, and 32-Bit QuickDrawrelease notes.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><H2>32-Bit QuickDraw</h2><p>Version 1.0 of 32-Bit QuickDraw shipped in May 1989 in response to the growingneed for Color QuickDraw support for direct color devices and pictures (PICT2)and video boards for large-screen monitors which require 32-bit addressing forblack and white operation.  This original version of 32-Bit QuickDraw was aseparate file that had to be copied manually into the System Folder.  With theintroduction of the Macintosh IIci, Apple put 32-Bit QuickDraw into ROM.  NowSystem Software 6.0.5 and later offer 32-Bit QuickDraw as an integral part ofthe System Software which can be installed by the standard Installer (althoughthe file is still separate).</p><p>This Note describes the changes and enhancements in version 1.2 of 32-BitQuickDraw from version 1.0.  Beginning with version 1.2, QuickDrawfunctionality is identical on all Color QuickDraw machines, including all theperformance improvements which were originally only available in the IIciROM.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><H2>New Features (In No Particular Order)</h2><h3>PICTs Contain Font Name Information</h3><p>Every time you draw text inside of an <code>_OpenPicture</code> and<code>_ClosePicture</code> pair, QuickDraw stores the name of the current font anduses it when playing back the picture.  The opcode used to save thisinformation is $002C and its data is as follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    PictFontInfo = Record                     length   : Integer;    { length of data in bytes }                     fontID   : Integer;    { ID in the source system }                     fontName : Str255;</pre>	</TD></TR></TABLE></CENTER><p>QuickDraw only saves this information one time for each font used in a picture.When QuickDraw plays back a picture, it uses the <code>fontID</code> as a referenceinto the list of font names which are used to set the correct font on thetarget system.</p><p>For example, the following code:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    GetFNum('Venice', theFontID);    { Set a font before opening PICT}    TextFont(theFontID);    pHand2 := OpenPicture (pictRect);        MoveTo(20,20);        DrawString(' Better be Venice');        GetFNum('Geneva', theFontID);        TextFont(theFontID);        MoveTo(20,40);        DrawString('Geneva');        GetFNum('New York', theFontID);        TextFont(theFontID);        MoveTo(20,60);        DrawString('New York');        GetFNum('Geneva', theFontID);        TextFont(theFontID);        MoveTo(20,80);        DrawString('Geneva');</pre>	</TD></TR></TABLE></CENTER><p>generates a picture containing font information like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    OpCode 0x002C {9,        &quot;0005 0656 656E 6963 65&quot;}              /* save current font     */    TxFont 'venice'    DHDVText {20, 20, &quot; Better be Venice&quot;}    OpCode 0x002C {9,                          /* save next font name   */        &quot;0003 0647 656E 6576 61&quot;}    TxFont 'geneva'    DVText {20, &quot;Geneva&quot;}    OpCode 0x002C {11,                         /* ditto                 */        &quot;0002 084E 6577 2059 6F72 6B&quot;}    TxFont 'newYork'    DVText {20, &quot;New York&quot;}    TxFont 'geneva'                            /* second Geneva does not                                                 need another $002C guy */</pre>	</TD></TR></TABLE></CENTER><p>This feature works regardless of the type of picture being saved, including oldstyle PICTs in a black and white port.  Using <code>_OpenCPicture</code> instead of<code>_OpenPicture</code> to start a recording session results in the samefunctionality.</p><h3>Direct PixPat Structures Now Supported</h3><p>QuickDraw now supports 16-bit and 32-bit per pixel <code>PixPat</code> structures(<code>patType = 1</code>).  In addition, it now supports a new <code>patType</code>(3) which uses dithering whenever 16-bit or 32-bit  pixel patterns aredisplayed on indexed devices.</p><h3>Direct 'cicn' Resources Now Supported</h3><p>QuickDraw now supports 16-bit and 32-bit per pixel <code>'cicn'</code> resources.The 16-bit per pixel is particularly cool since you save the space required foran 8-bit <code>'clut'</code>.</p><h3>GWorlds Can Now Be Allocated in MultiFinder Temporary Memory</h3><p>You can now use the new <code>useMFTempBit </code>(bit 2) in a call to<code>NewGWorld</code> as an option to allocate pixels in MultiFinder temporarymemory.  In addition, you can now allocate screen buffers in MultiFindertemporary memory using the following routine, defined in Pascal and C:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION NewTempScreenBuffer (globalRect: Rect; purgeable: BOOLEAN;                              VAR gdh: GDHandle;                               VAR offscreenPixMap: PixMapHandle): QDErr;             INLINE $203C,$000E, $0015,$AB1D; { Move.L #$000E0015,D0                                               _QDOffscreen                                             }pascal QDErr NewTempScreenBuffer (Rect *globalRect, BOOLEAN purgeable,                              GDHandle *gdh,                              PixMapHandle&nbsp;*offscreenPixMap)</pre>	</TD></TR></TABLE></CENTER><h3>Indexed to Indexed Dithering</h3><p><code>_CopyBits</code> now supports the <code>ditherCopy</code> transfer mode whenever thedestination device is between one and eight bits per pixel, regardless of thedepth of the source image.  With this support, an eight-bit image can now beapproximated on a one-bit or a four-bit device by using error diffusion.Furthermore, an eight-bit image could also be dithered to a different set of256 colors or a four-bit image could be dithered to an eight-bit device thatdoes not have the desired colors.</p><h3>32-Bit Addressed PixMap Structures</h3><p>Version 1.2 defines a new <code>pmVersion</code> (<code>baseAddr32 = 4</code>) for32-bit pointer <code>baseAddr</code> values.  The <code>baseAddr</code> of such<code>PixMap</code> structures is treated as a 32-bit address, so no stripping oraddress translation is performed on it in 32-bit mode.  This is a speciallyuseful feature when the base address of a <code>PixMap</code> points to a NuBus address, for example in a video grabber board.</p><p>A new call, <code>Pixmap32Bit</code>, is now available to inquire if a given<code>PixMap</code> requires 32-bit addressing.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION Pixmap32Bit(pmh:pixMapHandle):Boolean;    INLINE $203C,$0004, $0016,$AB1D; { Move.L #$00040016,D0                                      _QDOffscreen                                    }pascal BOOLEAN Pixmap32Bit(pixMapHandle pmh)</pre>	</TD></TR></TABLE></CENTER><h3>Updated GetPixBaseAddress</h3><p>Version 1.2 updates <code>GetPixBaseAddress</code> to return the address of any<code>PixMap</code>.  The routine does the right address translation or strippingfor all <code>PixMap</code> structures, including screen devices, unlocked <code>GWorlds</code>,and 32-bit addressed <code>PixMap</code> structures.  The address it returns isonly valid in 32-bit addressing mode. Also unless the <code>PixMap</code> is lockedand made unpurgeable, the address returned by <code>GetPixBaseAddress</code> isonly valid until any call to QuickDraw or the toolbox is made.</p><h3>_CopyBits from Screen Devices</h3><p>The picture recording mechanism has changed so that if you call<code>_CopyBits</code> while recording a picture with the source <code>PixMap</code>being a screen device, the data is correctly accumulated into the picture.Note that if the screen being copied is not the main screen, then the<code>PixMap</code> must be a 32-bit addressed <code>PixMap</code>.  No auxiliaryscreen buffer is allocated if the source rectangle covers only one screen.</p><h3>New Picture Recording Trap</h3><p>Version 1.2 adds a new call, <code>_OpenCPicture</code>, to create pictures thatcontain information regarding the native resolution of the recorded image.When QuickDraw draws this picture, it scales the image to the resolution of thetarget device.  Applications that need to scale the images directly can alsoaccess this information.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION OpenCPicture(VAR CPictInfo:CPictRecord):PicHandle;    INLINE $AA20;pascal PicHandle OpenCPicture(CPictRecord *CPictInfo)</pre>	</TD></TR></TABLE></CENTER><p>where</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct CPictRecord {      Rect CPicFrame;           /* Bounding rect of Picture at native resolution */      Fixed CPicHRes;           /* native horizontal resolution in pixels/inch   */      Fixed CPicVRes;           /* native vertical resolution in pixels/inch     */      short CPicVersion;        /* version of this PICT info set to -2           */      short reserved;           /* for future expansion set to zero              */      long reserved;            /* for future expansion set to zero              */</pre>	</TD></TR></TABLE></CENTER><p>The new picture header data looks like the following:</p><P align=center><img src="images/qd_01_001.gif" alt="new picture header data 1" width=336 height=56></p><P align=center><img src="images/qd_01_002.gif" alt="new picture header data 2" width=392 height=152></p><p>The following is a sample PICT created with <code>_OpenCPicture</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    00 48                          /* low word of size              */    00 00 00 00 00 7D 00 7D        /* picFrame at 72 dpi            */    00 11                          /* PICT version opcode           */    02 FF                          /* version number                */    0C 00                          /* PICT header Opcode            */    FF FE                          /* PICT version -2               */    00 00                          /* reserved                      */    01 20 00 00                    /* HRes (Fixed)                  */    01 20 00 00                    /* VRes (Fixed)                  */    00 00 00 00 01 F4 01 F4        /* picFrame at native resolution */    00 00 00 00                    /* reserved                      */    /* picture data follows                                         */</pre>	</TD></TR></TABLE></CENTER><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><H2>Random Notes</h2><p>For information on bug fixes in the System Software 6.0.5 release of 32-BitQuickDraw (version 1.2), please refer to the System Software 6.0.5 ChangeHistory, which is available on the Developer CD Series, AppleLink in theDeveloper Services Bulletin Board (Developer Services: Macintosh DeveloperTechnical Support: System Software), and the Apple FTP site on the Internet inthe ~ftp/pub/dts/sw.license.</p><p>Note that the dispatching mechanism for the new <code>_QDOffscreen</code> calls isslightly different than previously documented; it now requires that the highword passed in <code>D0</code> contain the total length of the parameters (inbytes).  The reason for this change is that if the call is made in an earlierversion of 32-Bit QuickDraw, the system can strip the parameters from the stackand return <code>QDError</code> set to the caller (instead of crashing).</p><a name="References"></a><P><A HREF="#top">Back to top</A></p><H2>References</h2><P><i>Inside Macintosh</i>, Volume V, Color QuickDraw</p><P>32-Bit QuickDraw Release Notes (available from APDA)</p><P>System Software 6.0.5 Change History</p><P><i>d e v e l o p</i>, Issue I</p><P>NuBus is a trademark of Texas Instruments.</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (120K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qd_01.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qd/qd_01.html%3Fid%3DDTS10002714-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qd/qd_01.html%3Fid%3DDTS10002714-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qd/qd_01.html%3Fid%3DDTS10002714-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>