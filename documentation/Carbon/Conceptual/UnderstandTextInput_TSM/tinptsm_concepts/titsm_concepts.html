<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Understanding Text Input and the Text Services Manager in Carbon: Understanding Text Input and the Text Services Manager</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Understanding Text Input and the Text Services Manager"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000091" title="Understanding Text Input and the Text Services Manager"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../tinptsm_intro/tinptsm_intro.html#//apple_ref/doc/uid/TP30000090-DontLinkElementID_4">Understanding Text Input and the Text Services Manager in Carbon</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../tinptsm_intro/tinptsm_intro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../tinptsm_docrevhist/tinptsm_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000091-DontLinkElementID_1" title="Understanding Text Input and the Text Services Manager"></a><h1><a name="//apple_ref/doc/uid/TP30000091-TPXREF101" title="Understanding Text Input and the Text Services Manager"></a>Understanding Text Input and the Text Services Manager</h1><p>This document presents the information needed to appropriately handle keyboard input in Carbon, to create Carbon text service components for Mac OS X, and to revise Carbon client applications of text services. It discusses keyboard input, Carbon text input events, Unicode input, and the changes to the Text Services Manager (“TSM”), in the context of Carbon and Mac OS X.</p><p>If you have a Carbon program that uses text services or if you are interested in handling raw keyboard events (that is, if you must do key filtering or key input validation), you should read the sections <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJDECCH">“What’s New for Applications With TSM and Text Input in Carbon”</a></span> and <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJDDIBI">“Text Input Event Handling for Applications With Carbon.”</a></span></p><p>If you have a text service component, see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJEAEJC">“What’s New for Text Service Components With TSM and Text Input in Carbon”</a></span> and <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJFGJBJ">“Event Handling for Text Service Components With Carbon.”</a></span></p><p>This document assumes some prior knowledge of the Text Services Manager, text input, and keyboard events on the Mac OS. If you would like background information, please see the following sources:</p><ul class="ul"><li class="li"><p>For an introduction to the Text Services Manager, see the chapter “Text Services Manager” in <em>Inside Macintosh: Text</em> at <span class="content_text"><a href="http://developer.apple.com/documentation/mac/Text/Text-409.html" target="_top">http://developer.apple.com/documentation/mac/Text/Text-409.html</a></span></p></li><li class="li"><p>For a description of the Text Services Manager programming interface, see <em>Inside Carbon: Text Services Manager Reference</em> at <span class="content_text"><a href="http://developer.apple.com/documentation/Carbon/Reference/Text_Services_Manager/index.html" target="_top">http://developer.apple.com/documentation/Carbon/Reference/Text_Services_Manager/index.html</a></span>.</p></li><li class="li"><p>For a detailed description of Carbon text input events, see the CarbonLib Universal Interfaces file <code>CarbonEvents.h</code>.</p></li></ul><a name="//apple_ref/doc/uid/TP30000091-BHJDECCH" title="What&acirc;&#128;&#153;s New for Applications With TSM and Text Input in Carbon"></a><h2>What’s New for Applications With TSM and Text Input in Carbon</h2><p>Adapting your application for Carbon is not mandatory, but it is recommended, both for increased compatibility with text services and for the enhanced performance of your program. As you read through this section, you may find that the changes discussed below simplify your use of the Text Services Manager and/or your handling of text input.</p><p>If your program directly handles keyboard input, you can read the list that follows for highlights of the changes in handling text input with Carbon.</p><p>If your application currently supports the Text Services Manager, the following list provides an overview and checklist for revising your application for the Text Services Manager in Carbon. If your application does not currently support the Text Services Manager, the list supplements the information given in the Text Services Manager chapter of <em>Inside Macintosh: Text</em>.</p><ul class="ul"><li class="li"><p>Carbon provides a suite of text input events (corresponding to the text service Apple events) that supersede other mechanisms for handling text input. In most cases, if your application directly handles raw keyboard input, whether or not it uses the Text Services Manager, it should use Carbon text input events over raw keyboard events. For more information, see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJIDAEE">“Handling Unicode and Keyboard Input in Carbon.”</a></span></p></li><li class="li"><p>At minimum, all application developers should consider providing a handler for the Carbon text input event <code>kEventTextInputOffsetToPos</code> (or the corresponding Apple event, <code><!--a  -->kOffset2Pos<!--/a--></code>). Handling <code>kEventTextInputOffsetToPos</code> (or <code><!--a  -->kOffset2Pos<!--/a--></code>) is recommended not only when there is not a currently active inline input session, but even if your application does not use the Text Services Manager and does not currently provide any other text input event handlers at all. By providing a handler that simply returns the position of the insertion point when the requested offset is 0, it makes your application more compatible with text services now and in the future.</p></li><li class="li"><p>The <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventTextInputOffsetToPos" target="_top">kEventTextInputOffsetToPos</a></code> Carbon text input event has an additional optional parameter (<code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventParamTextInputReplyFMFont" target="_top">kEventParamTextInputReplyFMFont</a></code> = <code>'trfm'</code>) that the corresponding <code><!--a  -->kOffset2Pos<!--/a--></code> Apple event previously did not. (Note that the <code><!--a  -->kOffset2Pos<!--/a--></code> event now also has been upgraded to include a similar parameter, <code><!--a  -->keyAETSMTextFMFont<!--/a--></code> = <code>'ktxm'</code>.) This parameter consists of an <code>FMFont</code> value of type <code>UInt32</code>, allowing the event handler to return an <code>FMFont</code> value instead of an <code>FMFontFamily</code> value (or a <code>FOND</code> resource ID). The <code>FMFont</code> value is easier for ATSUI-based applications to obtain and more useful for ATSUI-based text services. For more information on using ATSUI to render Unicode text, see <span class="content_text"><a href="http://developer.apple.com/documentation/Carbon/COnceptual/ATSUI_Concepts/index.html" target="_top">http://developer.apple.com/documentation/Carbon/COnceptual/ATSUI_Concepts/index.html</a></span>.</p></li><li class="li"><p> Carbon applications that support inline input from a text service (as opposed to automatically being provided a floating or “bottomline” input window by the Text Services Manager) should use the function <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TSMSetInlineInputRegion" target="_top">TSMSetInlineInputRegion</a></code>. The <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TSMSetInlineInputRegion" target="_top">TSMSetInlineInputRegion</a></code> function informs the Text Services Manager of the region occupied by an inline input session. If certain mouse events occur within this region, the Text Services Manager forwards these events to the current input method. If an application does not call this function, when an input method is active the Text Services Manager by default intercepts mouse events in the entire content region of the window that currently has user focus. The <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TSMSetInlineInputRegion" target="_top">TSMSetInlineInputRegion</a></code> function replaces the function <code><!--a-->SetTSMCursor<!--/a--></code> for Carbon applications. For a description of the <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TSMSetInlineInputRegion" target="_top">TSMSetInlineInputRegion</a></code> function, see <em>Inside Carbon: Text Services Manager Reference</em>.</p></li><li class="li"><p>Carbon applications do not need to pass events to the Text Services Manager as non-Carbon applications must. Therefore, Carbon applications need no longer use the functions <code>TSMEvent</code>, <code>TSMMenuSelect</code>, or <code>SetTSMCursor</code>. For more on how applications obtain events, see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJDDIBI">“Text Input Event Handling for Applications With Carbon.”</a></span></p></li><li class="li"><p>Carbon clients of the Text Services Manager no longer need to call the functions <code>InitTSMAwareApplication</code> or <code>CloseTSMAwareApplication</code>. If a non-Carbon application uses any Text Services Manager routines, it must call these functions so the Text Services Manager can allocate necessary data for the application in its internal data structures, that is, so it can have a “TSM context.” Carbon automatically associates with each of its clients the data that is necessary for the Text Services Manager to interact with the application, so Carbon applications are automatically provided a TSM context.</p></li></ul><a name="//apple_ref/doc/uid/TP30000091-BHJDDIBI" title="Text Input Event Handling for Applications With Carbon"></a><h2>Text Input Event Handling for Applications With Carbon</h2><p>The Text Services Manager and text service components use text input events to give information to and request specific actions of client applications. Supporting full Unicode input and having inline input in your application depends on your installing handlers for these events. If your application does not handle text input events, the Text Services Manager automatically provides support only for partial Unicode input, via a floating or “bottomline” input window.</p><p>The following sections describe the various aspects of text input event handling for Carbon applications:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJDJDFG">“Carbon Text Input Events and Apple Events”</a></span></p></li><li class="li"><p><span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJEIIEC">“Text Input Event Routing”</a></span></p></li><li class="li"><p><span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJIDAEE">“Handling Unicode and Keyboard Input in Carbon”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000091-BHJDJDFG" title="Carbon Text Input Events and Apple Events"></a><h3>Carbon Text Input Events and Apple Events</h3><p>Prior to Carbon, applications received text input events in the form of Apple events. With Carbon, the Text Services Manager now also provides Carbon text input events to applications. Supporting Carbon text input events is optional, but highly recommended. The performance advantages of using Carbon events over Apple events are significant. In addition, unlike Apple events, which are always targeted at the application level, Carbon events also can be targeted at the level of a window or even a control. If you have an existing Text Services Manager client application, revising it to use Carbon events is made simpler by the fact that it can be done piecemeal—you can change one, some, or all of its existing Apple event handlers at any time. <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJEHCAG">Table 2-1</a></span> presents the Carbon text input events and notes the Apple events to which they correspond. (For a detailed description of the Carbon text input events, see the CarbonLib Universal Interfaces file <code>CarbonEvents.h</code>.)</p><a name="//apple_ref/doc/uid/TP30000091-DontLinkElementID_2" title="Table 1-1Text input events"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30000091-BHJEHCAG" title="Table 1-1Text input events"></a><strong>Table 1-1&nbsp;&nbsp;</strong>Text input events</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Event description</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Carbon event—kEventClassTextInput</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Apple event—kTextServiceClass</p></th></tr><tr><td  scope="row"><p>Create or update text in an active input area</p></td><td ><p>Must be supported for inline input</p></td><td ><p><code>kEventTextInput UpdateActiveInputArea</code></p></td><td ><p><code>kUpdateActive InputArea</code></p></td></tr><tr><td  scope="row"><p>Receive Unicode text generated from a keyboard layout or via the TSM bottomline input window</p></td><td ><p></p></td><td ><p><code>kEventTextInput UnicodeForKeyEvent</code></p></td><td ><p><code>kUnicodeNotFrom InputMethod</code></p></td></tr><tr><td  scope="row"><p>Help position items on the screen by converting a byte offset in characters in the active input area to global coordinates</p></td><td ><p>Supporting this event is recommended even for those applications that do not use inline input; to do so, provide a handler to this event that simply returns the position of the insertion point when the requested offset is 0</p></td><td ><p><code>kEventTextInput OffsetToPos</code></p></td><td ><p><code>kOffset2Pos</code></p></td></tr><tr><td  scope="row"><p>Help track cursor movements by converting global coordinates to a byte offset in characters in the active input area</p></td><td ><p></p></td><td ><p><code>kEventTextInputPosTo Offset</code></p></td><td ><p><code>kPos2Offset</code></p></td></tr><tr><td  scope="row"><p>Show or hide a floating input window </p></td><td ><p>Most applications do not need to support this event; this event must be supported only by applications that provide their own bottomline input window</p></td><td ><p><code>kEventTextInputShow HideBottomWindow</code></p></td><td ><p><code>kShowHideInput Window</code></p></td></tr><tr><td  scope="row"><p>Return the current text selection or the text on either side of the current insertion point</p></td><td ><p></p></td><td ><p><code>kEventTextInput GetSelectedText</code></p></td><td ><p><code>kGetSelected Text</code></p></td></tr></table></div><p>The <code>kEventTextInputUnicodeForKeyEvent</code> event, by its very nature, always contains Unicode. For other Carbon text input events that contain text, a client application informs the Text Services Manager of what kind of encoding to use for these events when the application creates a new TSM document and specifies its desired interface type(s). For example, an application can request that its text be delivered in the Unicode encoding by creating a TSM document with the <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kUnicodeDocument" target="_top">kUnicodeDocument</a></code> signature.</p><a name="//apple_ref/doc/uid/TP30000091-BHJEIIEC" title="Text Input Event Routing"></a><h3>Text Input Event Routing</h3><p>The Text Services Manager mediates the routing of text input events. In the case of text service–generated events, the component calls the Text Services Manager function <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SendTextInputEvent" target="_top">SendTextInputEvent</a></code> to initiate the routing of the event. Then, the Text Services Manager delivers the event in the appropriate form for your application.</p><p>In general, the Text Services Manager tries to route events in their most optimal form. In Mac OS X, since Carbon events are more efficient than Apple events, the Text Services Manager first attempts to pass a text input event to an application as a Carbon event. The Text Services Manager routes Carbon text input events to the current user focus—typically a control, window, or application.</p><p>If the Carbon text input event is not handled, typically the Text Services Manager then generates the Apple event that corresponds to the unhandled Carbon event and sends that. And, if neither the Carbon text input event nor the corresponding Apple event is handled, then typically the event simply remains unhandled. An exception to these rules is the event <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventTextInputUnicodeForKeyEvent" target="_top">kEventTextInputUnicodeForKeyEvent</a></code>; see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJIDAEE">“Handling Unicode and Keyboard Input in Carbon”</a></span> for more details.</p><a name="//apple_ref/doc/uid/TP30000091-BHJIDAEE" title="Handling Unicode and Keyboard Input in Carbon"></a><h3>Handling Unicode and Keyboard Input in Carbon</h3><p>To receive text input, applications must support the two keyboard-related text input events. The first, the <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventTextInputUpdateActiveInputArea" target="_top">kEventTextInputUpdateActiveInputArea</a></code> Carbon event (or the Apple event <code><!--a  -->kUpdateActiveInputArea<!--/a--></code>), delivers text to your application that is generated by an input method in an inline input session. The second, the <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventTextInputUnicodeForKeyEvent" target="_top">kEventTextInputUnicodeForKeyEvent</a></code> Carbon event (or the Apple event <code><!--a  -->kUnicodeNotFromInputMethod<!--/a--></code>), delivers text to your application that is derived from a keyboard layout or via the Text Services Manager’s bottomline window. Especially if you want your client application to always receive Unicode characters, your application should handle the <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/kEventTextInputUnicodeForKeyEvent" target="_top">kEventTextInputUnicodeForKeyEvent</a></code> text input event.</p><p>In order to avoid interference with input methods, providing a handler for the <code>kEventTextInputUnicodeForKeyEvent</code> event and examining its parameters is the preferred means on Carbon for directly examining keyboard input in general. Even if your application doesn’t support Unicode, it can still examine the <code>kEventTextInputUnicodeForKeyEvent</code> event’s parameters and extract Mac character codes, when they exist.</p><p>Only in special cases, such as if an application handles individual key presses or performs its own keyboard translation, might the application need to obtain a keyboard event prior to the event being processed by the Text Services Manager. In these cases, in Carbon you can obtain such events by installing Carbon event handlers for raw keyboard events. The Carbon Event Manager then dispatches the event to the application before it is sent to the Text Services Manager.</p><p>The Text Services Manager sends the <code>kEventTextInputUnicodeForKeyEvent</code> event to deliver Unicode text when the input source is either a keyboard layout or a text service via the Text Services Manager’s bottomline input window. Unlike other Carbon text input events, in the case of <code>kEventTextInputUnicodeForKeyEvent</code> the Text Services Manager falls back to sending the corresponding Apple event only if the application specifically requests Unicode (by creating a TSM document that has the <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kUnicodeDocument" target="_top">kUnicodeDocument</a></code> signature). So, if the application has requested Unicode, but it does not handle the <code>kEventTextInputUnicodeForKeyEvent</code> event, only then does the Text Services Manager convert the event to a <code>kUnicodeNotFromInputMethod</code> Apple event. Finally, if the application does not handle the <code>kUnicodeNotFromInputMethod</code> Apple event, then the Text Services Manager attempts to produce a stream of “classic” events, which the application can handle in its <code>WaitNextEvent</code> loop.</p><p>For more information on Unicode input, as of Mac OS 8.5, see <em>Inside Macintosh: Supporting Unicode Input</em> at <span class="content_text"><a href="http://developer.apple.com/documentation/Carbon/Conceptual/Supporting_Unicode_Input/index.html" target="_top">http://developer.apple.com/documentation/Carbon/Conceptual/Supporting_Unicode_Input/index.html</a></span>.</p><a name="//apple_ref/doc/uid/TP30000091-BHJEAEJC" title="What&acirc;&#128;&#153;s New for Text Service Components With TSM and Text Input in Carbon"></a><h2>What’s New for Text Service Components With TSM and Text Input in Carbon</h2><p>With Mac OS X, text service components must be Carbon clients. (This is in contrast to Mac OS 8 and 9, where text service components cannot be Carbon clients, due to the potentially destabilizing effects of a component loading Carbon in the context of a non-Carbon application.) To help you in creating a Mac OS X–ready component, the following list provides a brief overview of the changes required:</p><ul class="ul"><li class="li"><p>Unlike applications, text service components must be Carbon event–based for Mac OS X. Components are required to use Carbon events with Mac OS X in order to receive events targeted at their own user interface elements, such as the input method menu and its floating windows. Because on Mac OS X the Text Services Manager no longer calls the functions <code><!--a-->TextServiceMenuSelect<!--/a--></code> or <code><!--a-->SetTextServiceCursor<!--/a--></code>, the component must install Carbon event handlers on its user interface elements for these purposes. For more details, see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJFGJBJ">“Event Handling for Text Service Components With Carbon.”</a></span></p></li><li class="li"><p>Components should also use Carbon text input events when sending events. The function <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SendTextInputEvent" target="_top">SendTextInputEvent</a></code> is provided for this purpose. The sending of Apple events and the use of the pre-Carbon function <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SendAEFromTSMComponent" target="_top">SendAEFromTSMComponent</a></code> is discouraged on Mac OS X.</p></li><li class="li"><p>Text service components in Mac OS X must use Carbon Window Manager functions to create floating utility windows, rather than the Text Services Manager “service window” calls. For example, to create a floating input window, a Carbon text service component should use the Window Manager function <code>CreateNewWindow</code> (of class <code>kUtilityWindowClass</code>), rather than the Text Services Manager function <code>NewServiceWindow</code>, which is not available in Carbon. Note that, in this example, input methods should clear the <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kWindowHideOnFullScreenAttribute" target="_top">kWindowHideOnFullScreenAttribute</a></code> window attribute that is part of the default Carbon Window Manager behavior for utility windows, since it is likely that the input method would continue to be needed by the user, even if the application were to be put into full-screen mode.</p></li><li class="li"><p>Unlike with Mac OS 8 and 9, instances of a single component that are running in different applications in Mac OS X do not share the same address space. Because of this, in Mac OS X, you may want to factor out some shared elements of your text service component into a separate process. For example, factoring out your dictionaries and global user interface elements ensures a continuity of state in your component’s menus and windows among applications, as well as helping to reduce your memory requirements.</p></li><li class="li"><p>Text service components for Mac OS X are assumed to use Unicode. The main requirement imposed by the Text Services Manager is that input methods communicate externally using Unicode text. However, it is assumed to be desirable or necessary for performance and other reasons that an input method performs its internal processing in Unicode and image Unicode text in its user interface. For more information, as of Mac OS 8.5, see <em>Inside Macintosh: Supporting Unicode Input</em> at <span class="content_text"><a href="http://developer.apple.com/documentation/Carbon/Conceptual/Supporting_Unicode_Input/index.html" target="_top">http://developer.apple.com/documentation/Carbon/Conceptual/Supporting_Unicode_Input/index.html</a></span>.</p></li></ul><a name="//apple_ref/doc/uid/TP30000091-BHJFGJBJ" title="Event Handling for Text Service Components With Carbon"></a><h2>Event Handling for Text Service Components With Carbon</h2><p>Unlike client applications, text service components both send and receive events. Text service components, via the Text Services Manager, send text input events to give information to and request specific actions of client applications. The component calls the Text Services Manager function <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SendTextInputEvent" target="_top">SendTextInputEvent</a></code> to initiate the routing of the event, which is delivered by the Text Services Manager in the form appropriate for the application. (Note that the sending of Apple events and the use of the pre-Carbon function <code><a href="../../../Reference/Text_Services_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SendAEFromTSMComponent" target="_top">SendAEFromTSMComponent</a></code> is discouraged on Mac OS X.) For more information on text input events, see <span class="content_text"><a href="titsm_concepts.html#//apple_ref/doc/uid/TP30000091-BHJDDIBI">“Text Input Event Handling for Applications With Carbon.”</a></span></p><p>A text service component also receives certain events targeted at the current user focus from the Text Services Manager, which it intercepts on the component’s behalf. These events are of two types: keyboard events and mouse events that intersect an inline input session’s region. The Text Service Manager routes these events to the active input method and to any other text services associated with the active TSM document through calls to the function <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/TextServiceEventRef" target="_top">TextServiceEventRef</a></code>. For a more detailed discussion of the <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/TextServiceEventRef" target="_top">TextServiceEventRef</a></code> function and the <code><a href="../../../Reference/Text_Services_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SendTextInputEvent" target="_top">SendTextInputEvent</a></code> function, see <em>Inside Carbon: Text Services Manager Reference</em>.</p><p>The Text Services Manager works on behalf of components to intercept keyboard events (these are Carbon events of class <code>kEventClassKeyboard</code>) in two passes. First, the Text Services Manager intercepts the raw keyboard event and uses a keyboard-layout resource to translate the keypress into character data. The Text Services Manager stores the keyboard translation information in the keyboard event and dispatches it to the current user focus—such as a window, menu, or control. Then, if the event is not handled, the Text Services Manager sends the event to the text service component.</p><p>In addition to keyboard events, the Text Services Manager intercepts mouse events for routing to components. The Text Services Manager directly passes any mouse-click events (<code>kEventMouseDown</code>, <code>kEventMouseUp</code>, <code>kEventMouseDragged</code>) that intersect an inline input session’s region to the active component(s).</p><p>The Text Services Manager also intercepts mouse-moved events, however it does not pass them along in a direct form to components, as it does with mouse-click events. The Text Services Manager promotes <code>kEventMouseMoved</code> events, after the applicable control or window receives them, to the window-specific <code>kEventWindowCursorChange</code> event. Next, the Text Services Manager delivers the <code>kEventWindowCursorChange</code> event to the active input method, then, if it is not handled, to any other active text services. If the event is still not handled, the Text Services Manager finally passes the event to the current user focus. This event-dispatching process gives applications that need to see the low-level mouse-moved events a chance to see these events first, while providing a mechanism for text services and applications to act on these events without conflict. After completing this process, the Carbon Event Manager converts any <code>kEventWindowCursorChange</code> event that remains unhandled to a “classic” mouse-moved event for <code>WaitNextEvent</code> clients.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../tinptsm_intro/tinptsm_intro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../tinptsm_docrevhist/tinptsm_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/UnderstandTextInput_TSM/tinptsm_concepts/titsm_concepts.html%3Fid%3DTP40000957-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/UnderstandTextInput_TSM/tinptsm_concepts/titsm_concepts.html%3Fid%3DTP40000957-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/UnderstandTextInput_TSM/tinptsm_concepts/titsm_concepts.html%3Fid%3DTP40000957-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>