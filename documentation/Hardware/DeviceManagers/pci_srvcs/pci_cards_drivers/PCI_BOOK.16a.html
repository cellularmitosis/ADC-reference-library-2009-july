<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> BlockMove11</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.168.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.169.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.16b.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="RoH.RoutineHeading"><A NAME="pgfId=4067"> </A>BlockMove</H1><P CLASS="T1.Text1"><A NAME="pgfId=4068"> </A>The DSL includes new extensions to the <TT CLASS="cv">BlockMove</TT> routine that deliver improved performance for software running in native mode. The original <TT CLASS="cv">BlockMove</TT> routine is described in <I CLASS="italics">Inside Macintosh: Memory.</I> </P><P CLASS="T1.Text1"><A NAME="pgfId=4072"> </A><A HREF="PCI_BOOK.16a.html#26969" CLASS="XRef">Table&nbsp;11-1</A> lists the different versions of the <TT CLASS="cv">BlockMove</TT> function that are in the DSL. It indicates for each routine what memory contents it is designed for and whether it can be used with buffers or other destinations that are not level-one cached. <A NAME="marker=4126"> </A><A NAME="marker=4127"> </A><A NAME="marker=4128"> </A><A NAME="marker=4129"> </A><A NAME="marker=4130"> </A><A NAME="marker=4131"> </A><A NAME="marker=4132"> </A><A NAME="marker=4133"> </A></P><b><P CLASS="TbF.TblFull"><A NAME="pgfId=4079"> </A>Table&nbsp;11-1	<TT CLASS="cv">BlockMove</TT><A NAME="26969"> </A> versions&nbsp;</P></b><TABLE border=1 cellpadding=3><TR><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=4085"> </A>Version</P></TH><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=4087"> </A>Use with what memory contents</P></TH><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=4089"> </A>Can be used with buffers</P></TH></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4091"> </A><TT CLASS="cv">BlockMove</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4093"> </A>Contains some 68K code, L1 cached</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4095"> </A>No</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4097"> </A><TT CLASS="cv">BlockMoveData</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4099"> </A>No 68K code, L1 cached (fastest)</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4101"> </A>No</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4103"> </A><TT CLASS="cv">BlockMoveDataUncached</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4105"> </A>No 68K code, uncached</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4107"> </A>Yes</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4109"> </A><TT CLASS="cv">BlockMoveUncached</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4111"> </A>Some 68K code, uncached (slowest)</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4113"> </A>Yes</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4115"> </A><TT CLASS="cv">BlockZero</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4117"> </A>Set memory to zero, L1 cached</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4119"> </A>No</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4121"> </A><TT CLASS="cv">BlockZeroUncached</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4123"> </A>Set memory to zero, uncached</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=4125"> </A>Yes</FONT></TD></TR></TABLE><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=4134"> </A>DESCRIPTION</H5><P CLASS="T1.Text1"><A NAME="pgfId=4135"> </A>The <TT CLASS="cv">BlockMove</TT> extensions provide a way to handle cache-inhibited address spaces and are able to flush the dynamic recompilation emulator's cache, and include high-speed routines for setting memory to 0.</P><P CLASS="T1.Text1"><A NAME="pgfId=4136"> </A>The <TT CLASS="cv">BlockMove</TT> extensions use 8-byte floating-point registers for large blocks and assume a data cache block size of 32 bytes. They may not work if the 8-byte floating point hardware is disabled or absent or if cache blocks are larger than 32 bytes. They do not use <TT CLASS="cv">lswx</TT> and <TT CLASS="cv">stswx</TT> instructions, which are slow on Macintosh models other than those using the PowerPC 601.</P><P CLASS="T1.Text1"><A NAME="pgfId=4137"> </A>Except for <TT CLASS="cv">BlockZero</TT> and <TT CLASS="cv">BlockZeroUncached</TT>, the <TT CLASS="cv">BlockMove</TT> extensions use the same parameters as <TT CLASS="cv">BlockMove</TT>. Calls to <TT CLASS="cv">BlockZero</TT> and <TT CLASS="cv">BlockZeroUncached</TT> have only two parameters, a pointer and a length, which are the same as the second and third parameters of <TT CLASS="cv">BlockMove</TT>. </P></DIV><DIV><blockquote><H4 CLASS="ImportantHead"><A NAME="pgfId=19134"> </A>IMPORTANT</H4><P CLASS="I.Important"><A NAME="pgfId=4138"> </A>The <TT CLASS="cv">BlockMove</TT> versions for cacheable data use the PowerPC <TT CLASS="cv">dcbz</TT> instruction to avoid unnecessary prefetching of destination cache blocks. For uncacheable data, you should avoid using those routines because the <TT CLASS="cv">dcbz</TT> instruction faults on uncacheable or write through locations, making execution extremely slow.  <A NAME="marker=4142"> </A><A NAME="marker=4143"> </A><A NAME="marker=4144"> </A></P></blockquote><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=4145"> </A>EXECUTION CONTEXT</H5><P CLASS="T1.Text1"><A NAME="pgfId=4146"> </A>The <TT CLASS="cv">BlockMove</TT> routines may be called from task level, software interrupt level, or hardware interrupt level.</P></DIV></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.168.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.169.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.16b.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>