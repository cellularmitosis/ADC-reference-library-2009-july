<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Tumbler and Podium - /TumblerSource/Tumbler_file.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Tumbler and Podium</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Tumbler and Podium</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/TumblerSource/Tumbler_file.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/TumblerSource/Tumbler_AEVT.c</option>
<option value="listing2.html">/TumblerSource/Tumbler_AEVT.h</option>
<option value="listing3.html">/TumblerSource/Tumbler_camera.c</option>
<option value="listing4.html">/TumblerSource/Tumbler_camera.h</option>
<option value="listing5.html">/TumblerSource/Tumbler_cursor.c</option>
<option value="listing6.html">/TumblerSource/Tumbler_cursor.h</option>
<option value="listing7.html">/TumblerSource/Tumbler_document.c</option>
<option value="listing8.html">/TumblerSource/Tumbler_document.h</option>
<option value="listing9.html">/TumblerSource/Tumbler_drag.c</option>
<option value="listing10.html">/TumblerSource/Tumbler_drag.h</option>
<option value="listing11.html">/TumblerSource/Tumbler_ErrorHandler.c</option>
<option value="listing12.html">/TumblerSource/Tumbler_ErrorHandler.h</option>
<option value="listing13.html">/TumblerSource/Tumbler_event.c</option>
<option value="listing14.html">/TumblerSource/Tumbler_event.h</option>
<option value="listing15.html">/TumblerSource/Tumbler_file.c</option>
<option value="listing16.html">/TumblerSource/Tumbler_file.h</option>
<option value="listing17.html">/TumblerSource/Tumbler_globals.h</option>
<option value="listing18.html">/TumblerSource/Tumbler_HideMenuBar.c</option>
<option value="listing19.html">/TumblerSource/Tumbler_HideMenuBar.h</option>
<option value="listing20.html">/TumblerSource/Tumbler_initialize.c</option>
<option value="listing21.html">/TumblerSource/Tumbler_initialize.h</option>
<option value="listing22.html">/TumblerSource/Tumbler_main.c</option>
<option value="listing23.html">/TumblerSource/Tumbler_main.h</option>
<option value="listing24.html">/TumblerSource/Tumbler_menus.c</option>
<option value="listing25.html">/TumblerSource/Tumbler_menus.h</option>
<option value="listing26.html">/TumblerSource/Tumbler_offscreen.c</option>
<option value="listing27.html">/TumblerSource/Tumbler_offscreen.h</option>
<option value="listing28.html">/TumblerSource/Tumbler_PICTImport.c</option>
<option value="listing29.html">/TumblerSource/Tumbler_PICTImport.h</option>
<option value="listing30.html">/TumblerSource/Tumbler_podium.c</option>
<option value="listing31.html">/TumblerSource/Tumbler_podium.h</option>
<option value="listing32.html">/TumblerSource/Tumbler_prototypes.h</option>
<option value="listing33.html">/TumblerSource/Tumbler_resources.h</option>
<option value="listing34.html">/TumblerSource/Tumbler_teutilities.c</option>
<option value="listing35.html">/TumblerSource/Tumbler_teutilities.h</option>
<option value="listing36.html">/TumblerSource/Tumbler_traps.c</option>
<option value="listing37.html">/TumblerSource/Tumbler_traps.h</option>
<option value="listing38.html">/TumblerSource/Tumbler_utility.c</option>
<option value="listing39.html">/TumblerSource/Tumbler_utility.h</option>
<option value="listing40.html">/TumblerSource/Tumbler_windows.c</option>
<option value="listing41.html">/TumblerSource/Tumbler_windows.h</option></select>
				</p>
				</form>
				<p><strong><a href="Tumbler_and_Podium.zip">Download Sample</a></strong> (&#147;Tumbler_and_Podium.zip&#148;, 1.07M)<BR>
<strong><a href="Tumbler_and_Podium.dmg">Download Sample</a></strong> (&#147;Tumbler_and_Podium.dmg&#148;, 1.15M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">//    file.c////    File Input/Output routines.//    ////    Author:    Nick Thompson &amp; Pablo Fernicola, with thanks to the QuickDraw 3D team//    Date:    Thursday, January 26, 1992////  Modification History:////    11/27/94  nick    there seems to be a problem reading metafiles into the app//    01/25/95  nick    slotted in spin code (thanks kent), updated for viewhints.  //                If we have view hints, then we can export things like the //                renderer type and lighting and camera in a drag or cut/copy//////  To Do://     factor for AppleEvents////    Copyright &copy; 1992-95 Apple Computer, Inc., All Rights Reserved#include &quot;Tumbler_globals.h&quot;#include &quot;Tumbler_prototypes.h&quot;#include &quot;Tumbler_resources.h&quot;#include &quot;QD3DStorage.h&quot;#include &quot;QD3DGroup.h&quot;#include &quot;QD3DIO.h&quot;#include &quot;QD3DShader.h&quot;#include &quot;QD3DView.h&quot;#include &quot;Tumbler_file.h&quot;#include &quot;Tumbler_camera.h&quot;#include &quot;Tumbler_document.h&quot;#include &quot;Tumbler_PICTImport.h&quot;#include &quot;Tumbler_utility.h&quot;#include &lt;string.h&gt;static OSErr WriteDocumentFile(DocumentPtr theDocument);//-----------------------------------------------------------------------------TQ3Status Tumbler_ReadScene(  TQ3FileObject    file,  short        isText,  TQ3SharedObject    *viewHints,  TQ3Object      *model){  char        filename[64];//  TQ3Object      group;  TQ3Object      object;  TQ3Boolean      isEOF;    *viewHints  = NULL;  if( *model ) {    Q3Object_Dispose(*model);  }  *model    = Q3DisplayGroup_New();//  group    = NULL;  object    = NULL;    SetCursor(*GetCursor(watchCursor));  if (Q3File_OpenRead(file, NULL) != kQ3Success)  {    SetCursor(&amp;qd.arrow);    return kQ3Failure;  }  while ((isEOF = Q3File_IsEndOfFile(file)) == kQ3False)  {    object = NULL;        object = Q3File_ReadObject(file);        if (object == NULL)     {      /*         Check and handle errors here -           Some errors may mean more objects are left in the file.      */      break;    }    if (Q3Object_IsType(object, kQ3SharedTypeViewHints))    {      if (*viewHints == NULL)      {        *viewHints = object;        object = NULL;      }    }    else if (Q3Object_IsDrawable(object))    {      if (*model)      {        Q3Group_AddObject(*model, object);      }//      else//      {//        group = Q3DisplayGroup_New();////        Q3Group_AddObject(group, *model);//        Q3Group_AddObject(group, object);//        Q3Object_Dispose(*model);////        *model = group;//      }    }    if (object != NULL)       Q3Object_Dispose(object);  }        Q3File_Close(file);    if (isEOF == kQ3False)  {    if (*model != NULL)    {  Q3Object_Dispose(*model); *model = NULL; }      if (*viewHints != NULL)    {  Q3Object_Dispose(*viewHints); *viewHints = NULL; }        SetCursor(&amp;qd.arrow);    return kQ3Failure;  }    SetCursor(&amp;qd.arrow);  return kQ3Success;}//-----------------------------------------------------------------------------////  Tumbler_WriteScene()//void Tumbler_WriteScene(  TQ3FileObject    file,  short        textMode,  DocumentPtr      theDocument){  TQ3GroupPosition  gPos;  TQ3Object      object;  TQ3ViewStatus    fileStatus;    SetCursor(*GetCursor(watchCursor));  if (Q3File_OpenWrite(file, kQ3FileModeText) != kQ3Success)  {    SetCursor(&amp;qd.arrow);    return;  }    Q3View_StartWriting(theDocument-&gt;theView, file);      if (theDocument-&gt;viewHints != NULL)  {    if (Q3Object_Submit(theDocument-&gt;viewHints, theDocument-&gt;theView) == kQ3Failure)    {      Q3File_Cancel(file);      SetCursor(&amp;qd.arrow);      return;    }  }  do {    if (theDocument-&gt;documentGroup != NULL)    {        Q3Group_GetFirstPosition(theDocument-&gt;documentGroup, &amp;gPos);        while (gPos)        {          TQ3Status status;                    Q3Group_GetPositionObject(theDocument-&gt;documentGroup, gPos, &amp;object);          status = Q3Object_Submit(object, theDocument-&gt;theView);          Q3Object_Dispose(object);                    if (status != kQ3Failure)          {            Q3Group_GetNextPosition(theDocument-&gt;documentGroup, &amp;gPos);          }        }    }  } while ((fileStatus = Q3View_EndWriting(theDocument-&gt;theView)) == kQ3ViewStatusRetraverse);      if( Q3File_Close(file) == kQ3Failure ) {    SetCursor(&amp;qd.arrow);    return;  }  SetCursor(&amp;qd.arrow);  return ;}//-----------------------------------------------------------------------------// ReadDocumentFileshort ReadDocumentFile(DocumentPtr theDocument, TQ3Boolean isText){  TQ3StorageObject    storage;  TQ3FileObject    fd;  TQ3Object       objects = nil;  TQ3Object      viewHints;      storage = Q3MacintoshStorage_New( theDocument-&gt;fRefNum );    if (storage == nil)    goto bail;    fd = Q3File_New();    if (fd == nil)    goto bail;  Q3File_SetStorage(fd, storage);  Q3Object_Dispose(storage);    Tumbler_ReadScene(    fd,    isText,    &amp;viewHints,    &amp;theDocument-&gt;documentGroup) ;    TumblerDocument_UpdateView( theDocument, viewHints ) ;    AdjustLightsPositions(theDocument);  if (viewHints)    Q3Object_Dispose(viewHints);  Q3Object_Dispose(fd);  return(noErr);bail:  Q3Object_Dispose(fd);  return(fnOpnErr);}//-PicHandle OpenPICTFile(  FSSpec *theFile){  OSErr    err;  long    curEOF;  PicHandle  my_pic;  long     count;  Ptr     buffer;  short    refNum;    if (FSpOpenDF(theFile, fsRdWrPerm, &amp;refNum))    return(0);  /* get size of file */  err = GetEOF(refNum, &amp;curEOF);  if (err != 0) {    return(0);  }    /* move the file mark to 512 */  err = SetFPos(refNum, fsFromStart, 512L);  if (err != 0) {    return(0);  }  /* size of data to read */  count = curEOF - 512;    /* create the PicHandle */  my_pic = (PicHandle)NewHandle(count);  HLock((Handle)my_pic);    /* read the PICT info */  buffer = (Ptr)(*my_pic);  err = FSRead(refNum, &amp;count, buffer);  if (err != 0) {    return(0);  }  HUnlock((Handle)my_pic);  FSClose(refNum);    return (my_pic);}OSErr WriteDocumentFile(DocumentPtr theDocument){  OSErr    theResult;  long    length;  char    *bufPtr;  SetCursor(*GetCursor(watchCursor));  if (! theDocument-&gt;fRefNum)    return(fnOpnErr);  if ((theResult = SetFPos(theDocument-&gt;fRefNum, fsFromStart, 0)) != noErr )     return(theResult);  if( theDocument-&gt;documentGroup ) {    TQ3StorageObject  storage;    TQ3FileObject  fd;        storage = Q3MacintoshStorage_New(theDocument-&gt;fRefNum);        if (storage == nil)      goto bail;        fd = Q3File_New();        if (fd == nil)      goto bail;    Q3File_SetStorage(fd, storage);    Q3Object_Dispose(storage);        Tumbler_WriteScene(fd,               kQ3FileModeText,              theDocument) ;    Q3Object_Dispose(fd);  }  return(noErr);bail:  return(fnOpnErr);}void DoNewDocument(void){  DocumentPtr theDocument;  if ((theDocument = NewDocument(NULL, NULL)) != nil) {    ShowWindow(theDocument-&gt;theWindow);  }}OSErr DoOpenFile(FSSpec *theFile){  OSErr        result;  short        refNum;  DocumentPtr     theDocument;  FInfo        fndrInfo ;  TQ3Boolean      isText ;  // we assume the FSSpec passed in was valid, get the file information  // we need to know the file type, this routine may get called by an appleEvent  // handler, so we can't assume a type, we need to get it from the fsspec.    FSpGetFInfo( theFile, &amp;fndrInfo ) ;    // pull out the file type    isText = (fndrInfo.fdType == 'TEXT') ;    if ((result = FSpOpenDF(theFile, fsRdWrPerm, &amp;refNum)) != noErr)    return(result);  if ((theDocument = NewDocument(NULL, NULL)) != nil) {    theDocument-&gt;fRefNum = refNum;    theDocument-&gt;theFileSpec = *theFile ;    SetCursor(*GetCursor(watchCursor));    ReadDocumentFile( theDocument, isText ) ;    SetWTitle(theDocument-&gt;theWindow, theFile-&gt;name);    ShowWindow(theDocument-&gt;theWindow);    AdjustCamera(theDocument,      theDocument-&gt;theWindow-&gt;portRect.right - theDocument-&gt;theWindow-&gt;portRect.left,      theDocument-&gt;theWindow-&gt;portRect.bottom - theDocument-&gt;theWindow-&gt;portRect.top);    SetCursor(&amp;qd.arrow);  } else {    SysBeep(1);    FSClose(refNum);    return(memFullErr);  }  return(noErr);}void DoImport3DMFDocument(DocumentPtr theDocument){  short        refNum;  StandardFileReply  theReply;  SFTypeList      theTypeList = { 'TEXT', '3DMF', 0 };  short        numtypes = 2 ;  if(theDocument == nil)    return;  StandardGetFile(0L, numtypes, theTypeList, &amp;theReply);  // read for podium files  if (theReply.sfGood) {    if(theReply.sfType == 'TEXT' || theReply.sfType == '3DMF') {      // did we try to open a metafile ???          OSErr        result;      short        refNum;      DocumentPtr     theDocument;      FInfo        fndrInfo ;      TQ3Boolean      isText ;            isText = (theReply.sfType == 'TEXT') ;            if ((result = FSpOpenDF(&amp;theReply.sfFile, fsRdWrPerm, &amp;refNum)) != noErr)        return ;              theDocument-&gt;fRefNum = refNum;            ReadDocumentFile( theDocument, isText ) ;      #ifdef PODIUM_APP      AdjustCamera(theDocument,        theDocument-&gt;geometriesOffscreen-&gt;portRect.right - theDocument-&gt;geometriesOffscreen-&gt;portRect.left,        theDocument-&gt;geometriesOffscreen-&gt;portRect.bottom - theDocument-&gt;geometriesOffscreen-&gt;portRect.top);#else    AdjustCamera(theDocument,      theDocument-&gt;theWindow-&gt;portRect.right - theDocument-&gt;theWindow-&gt;portRect.left,      theDocument-&gt;theWindow-&gt;portRect.bottom - theDocument-&gt;theWindow-&gt;portRect.top);#endif    }   }}//--------------------------------------------------------------------------------void DoOpenDocument(DocumentPtr theDocument){  short        refNum;#ifndef PODIUM_APP  SFTypeList      theTypeList = { 'TEXT', '3DMF', 'PICT', 0 };  short        numtypes = 3 ;#else  SFTypeList      theTypeList = { 'PICT', 0 };  short        numtypes = 1 ;#endif  StandardFileReply  theReply;  StandardGetFile(0L, numtypes, theTypeList, &amp;theReply);#ifndef PODIUM_APP  // read for Tumbler files  if (theReply.sfGood) {    if( theReply.sfType == 'TEXT' || theReply.sfType == '3DMF') {      DoOpenFile(&amp;theReply.sfFile);    } else if( theReply.sfType == 'PICT' &amp;&amp; theDocument &amp;&amp; theDocument-&gt;documentGroup) {      PicHandle      thePict;      TQ3StoragePixmap   textureImage;            // get the picture from the file      thePict = OpenPICTFile(&amp;theReply.sfFile);            // make a texture      TextureFromPICT( thePict, &amp;textureImage);      AddTextureToDocument( theDocument, &amp;textureImage);            // and free the space occupied by the picture      KillPicture(thePict) ;        }  }#else  // read for podium files  if (theReply.sfGood) {    // podium's slide files are PICT files    if( theReply.sfType == 'PICT' ) {      short      refNum;      DocumentPtr    theDocument;      PicHandle    theBackgroundPict ;      OSErr      theErr ;            if((theErr = FSpOpenDF(&amp;theReply.sfFile, fsRdPerm, &amp;refNum)) != noErr )        return ;          if ((theDocument = NewDocument(NULL, NULL)) != nil) {        Rect      bounds;        PicHandle    thePict;        GWorldPtr    savedGWorld ;        GDHandle    savedDevice ;                GetGWorld(&amp;savedGWorld,&amp;savedDevice);                theBackgroundPict = OpenPICTFile(&amp;theReply.sfFile);        bounds = (**theBackgroundPict).picFrame;        theErr = UpdateGWorld(&amp;theDocument-&gt;screenBuffer, 16, &amp;bounds, nil, nil, 0L ) ;        if( (theErr = UpdateGWorld(&amp;theDocument-&gt;bgOffscreen, 16, &amp;bounds, nil, nil, 0L )) != noErr )  {          return ;        }                // draw the picture into the offscreen          SetGWorld( theDocument-&gt;bgOffscreen , nil ) ;        DrawPicture( theBackgroundPict, &amp;bounds ) ;        SetGWorld(savedGWorld,savedDevice);                SizeWindow(theDocument-&gt;theWindow, bounds.right - bounds.left, bounds.bottom - bounds.top, false);        {          Rect  screenRect = (**GetMainDevice()).gdRect;          Rect  winRect = theDocument-&gt;theWindow-&gt;portRect ;                CenterRectInRect(&amp;screenRect, &amp;winRect) ;          MoveWindow(theDocument-&gt;theWindow,winRect.left,winRect.top,false);        }        SetWTitle(theDocument-&gt;theWindow, theReply.sfFile.name);        ShowWindow(theDocument-&gt;theWindow) ;      } else {              SysBeep(1);        FSClose(refNum);        return;              }    }    else if(theDocument != nil &amp;&amp; (theReply.sfType == 'TEXT' || theReply.sfType == '3DMF')) {      // did we try to open a metafile ???          OSErr        result;      short        refNum;      DocumentPtr     theDocument;      FInfo        fndrInfo ;      TQ3Boolean      isText ;            isText = (theReply.sfType == 'TEXT') ;            if ((result = FSpOpenDF(&amp;theReply.sfFile, fsRdWrPerm, &amp;refNum)) != noErr)        return ;              theDocument-&gt;fRefNum = refNum;            ReadDocumentFile( theDocument, isText ) ;      AdjustCamera(theDocument,        theDocument-&gt;geometriesOffscreen-&gt;portRect.right - theDocument-&gt;geometriesOffscreen-&gt;portRect.left,        theDocument-&gt;geometriesOffscreen-&gt;portRect.bottom - theDocument-&gt;geometriesOffscreen-&gt;portRect.top);    }   }#endif}Boolean DoSaveAsDocument(DocumentPtr theDocument){  short        theResult;  Str255        thePrompt, theName;  StandardFileReply  theReply;  if (! theDocument)    return(false);  GetIndString(thePrompt, FileStringsID, slSavePromptIndex);  GetWTitle(theDocument-&gt;theWindow, theName);  StandardPutFile( (ConstStr255Param) &amp;thePrompt, (ConstStr255Param) &amp;theName, &amp;theReply);  if (theReply.sfGood) {    if (!theReply.sfReplacing) {      if ((theResult = FSpCreate(&amp;theReply.sfFile, FileCreator, FileType, theReply.sfScript)) != noErr) {        SysBeep(1);        return(false);      }    }    if (theDocument-&gt;fRefNum) {      theResult = FSClose(theDocument-&gt;fRefNum);    }    if ((theResult = FSpOpenDF(&amp;theReply.sfFile, fsRdWrPerm, &amp;theDocument-&gt;fRefNum)) != noErr) {      SysBeep(1);      return(false);    }    if ((theResult = WriteDocumentFile(theDocument)) != noErr) {      SysBeep(1);      return(false);    }    SetWTitle(theDocument-&gt;theWindow, theReply.sfFile.name);    theDocument-&gt;dirty = false;  } else {    return(false);  }  return(true);}Boolean DidSaveDocument(DocumentPtr theDocument){  if ( theDocument == nil )    return(false);  if (theDocument-&gt;fRefNum) {    if (WriteDocumentFile(theDocument)) {      SysBeep(1);      return(false);    } else {      theDocument-&gt;dirty = false;    }    return(true);  } else {    return(DoSaveAsDocument(theDocument));  }}void DoRevertDocument(DocumentPtr theDocument){  Str255    theName;  if (! theDocument)    return;  if (theDocument-&gt;fRefNum) {    GetWTitle(theDocument-&gt;theWindow, theName);    ParamText( (ConstStr255Param) &amp;theName, (ConstStr255Param) &quot;&quot;, (ConstStr255Param) &quot;&quot;, (ConstStr255Param) &quot;&quot;);    if (Alert(idRevertALRT, 0L) == 1) {      FInfo        fndrInfo ;          // we assume the FSSpec in the document is valid, get the file information      // we need to know the file type            FSpGetFInfo( &amp;theDocument-&gt;theFileSpec, &amp;fndrInfo ) ;            // pull out the file type            ReadDocumentFile(theDocument, (fndrInfo.fdType == 'TEXT')) ;    }  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Tumbler_and_Podium/listing15.html%3Fid%3DDTS10000127-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Tumbler_and_Podium/listing15.html%3Fid%3DDTS10000127-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Tumbler_and_Podium/listing15.html%3Fid%3DDTS10000127-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>