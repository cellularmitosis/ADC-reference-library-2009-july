<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1131: Apple Mass Storage Class Driver always matches to my device at startup</title><meta name="keywords" content="USB, Mass Storage Class Driver, USBAddDriverForFSSpec, multi-LUN"><meta name="Description" content="Technical Q&amp;A QA1131: "><meta name="categories" content="USB and Hardware"><meta name="week-posted" content="May 20, 2002 - May 24, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001678" title="Apple Mass Storage Class Driver always matches to my device at startup"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxMassStorageDevices-date.html" target="_blank">Hardware & Drivers > Storage</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1131</div>
<div id="pageheadsub">Apple Mass Storage Class Driver always matches to my device at startup</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      I have a mass storage device for which I've written a vendor      specific driver. For MacOS 9.x, if I have the device attached      and restart the system, the Apple Mass Storage Class driver      always gets matched to my device. Why is this happening and      can anything be done to force my driver to be used instead?</p>                  <P id=p4>A:      This is a known issue which results in trying to support      booting the Macintosh from a USB mass storage device. At      boot time, only drivers from the ROM are available to the      system. The Apple Mass Storage class driver is implemented      in ROM and is the only driver available to support USB Mass      Storage class devices. At system start time, the Apple driver      is used to support each USB mass storage device with media,      that is present. If the mass storage device with media, is      not present at system start time, but is attached anytime      afterwards or the media is inserted later on, then the standard      device driver arbitration mechanism is used which will match      the device to a vendor specific driver, if present.</p><P id=p4>      Note that this problem is only with Power Macintosh Systems      with USB built-in running Mac OS 9.0 or greater. Beige G3's      with a PCI USB card or PowerBook G3's (without USB built-in)      using a CardBus USB card, will not have this problem.</p><P id=p4>      During the development of the Apple Mass Storage class driver      for Mac OS 9, it was understood that if the USB mass storage      device was not the boot device, that there should be a way      to allow the Apple driver to be replaced by a vendor specific      driver later on, if one was present. Similar support was      already in place for non-Apple USB keyboards and mice. Due      to time constraints, this support could not be implemented      and was deferred as an enhancement for a future release of      the Apple Mass Storage class driver. Unfortunately, this      enhancement has not been implemented. With the engineering      focus on Mac OS X, there are no plans at this time to change      the loading behavior of the Apple Mass Storage class driver.</p><P id=p4>      The problem described here primarily affects mass storage      class devices with multi-LUN support. Hardware vendors for      USB multi-LUN mass storage devices know that the Apple driver      does not support multiple LUNS and thus provide vendor specific      drivers to support their devices. The Apple Mass Storage      class driver only supports LUN 0 on the USB mass storage      device. As a result, when the multi-LUN mass storage class      device is attached at system start, only the LUN 0 storage      device is visible. As such, hardware vendors should ensure      that the device works properly with the Apple driver to support      LUN 0.</p><P id=p4>      Developers may note that the USB API provides the USBAddDriverForFSSpec      call. This call is used to force USB to quit using the current      driver and use a different driver for the device. One might      think that an INIT could be implemented to force their vendor      specific driver to be used instead of the Apple driver. The      problem with this option is that the USBAddDriverForFSSpec      call results in yanking a drive from the system without ensuring      that that system is not accessing a file on the drive. This      is not a trivial problem to resolve.</p><P id=p4>      Your options for this situation, are limited. The first option      is to inform users as to the limitation of the Apple Mass      Storage class driver when the USB device is attached at system      start, and to advise them to un-mount USB device volumes,      unplug the device and reconnect the device. In this way,      the vendor specific driver will be matched to the device.</p><P id=p4>      The alternative and attractive option, is to alter the firmware      so that the device has a vendor specific class and subclass.      By doing this, the Apple Mass Storage class driver will never      match to the device.</p>          <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[May 23 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1131.html%3Fid%3DDTS10001678-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1131.html%3Fid%3DDTS10001678-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1131.html%3Fid%3DDTS10001678-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>