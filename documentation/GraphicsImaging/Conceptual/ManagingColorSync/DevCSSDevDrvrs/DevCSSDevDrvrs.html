<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Managing Colors With ColorSync in Mac OS 9 (Legacy): Developing ColorSync-Supportive Device Drivers</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Developing ColorSync-Supportive Device Drivers"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000277" title="Developing ColorSync-Supportive Device Drivers"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/MacOS9Earlier-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000540" target="_top">Mac OS 9 &amp; Earlier</a> &gt; <a href="../PrefaceCS/PrefaceCS.html#//apple_ref/doc/uid/TP30000249-DontLinkElementID_94">Managing Colors With ColorSync in Mac OS 9 (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DevCSApps/DevCSApps.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../DevCMMs/DevCMMs.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_60" title="Developing ColorSync-Supportive Device Drivers"></a><h1><a name="//apple_ref/doc/uid/TP30000277-BCIHGGGI" title="Developing ColorSync-Supportive Device Drivers"></a>Developing ColorSync-Supportive Device Drivers</h1><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_280"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_281"></a>This section describes how you can use the ColorSync Manager to provide ColorSync-supportive device drivers for peripherals. It first describes how input, display, and output devices work with color profiles. It then discusses how devices interact with color management modules (CMMs). Next it describes what you must do to provide minimum ColorSync support, as well as how you can provide more extensive support. Finally, it uses a QuickDraw-based printer device driver to demonstrate some of the color-matching features a device driver can provide.</p><p>Read this section if your device driver for an input, display, or output device will support the ColorSync Manager and allow users to produce color-matched images.</p><p>Before you read this section, you should read <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCFGIBI">Overview of ColorSync</a></span> and <span class="content_text"><a href="../IntroCSpaces/IntroCSpaces.html#//apple_ref/doc/uid/TP30000280-BBCBDGDD">Overview of Color and Color Management Systems</a></span>. These sections provide an overview of ColorSync, explain color theory and color management systems, and define key terms.</p><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_282"></a>Although the features described here are commonly provided by printer device drivers, the code samples in <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCJCBHD">Developing ColorSync-Supportive Applications</a></span> may also be of use in developing your device driver.</p><p><em>ColorSync Manager Reference</em> describes constants, data structures, functions, and result codes for ColorSync-supportive applications and device drivers.</p><p><span class="content_text"><a href="../VersAndCompat/VersAndCompat.html#//apple_ref/doc/uid/TP30000275-BCIFHIID">ColorSync Version Information</a></span> describes the <code>Gestalt</code> information, shared library version numbers, CMM version numbers, and ColorSync header files you use with different versions of the ColorSync Manager. It also includes CPU and Mac OS system requirements.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-TPXREF101">About ColorSync-Supportive Device Driver Development</a>
				
			<br/>
			
        
			
			
				<a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-TPXREF108">Developing Your ColorSync-Supportive Device Driver</a>
				
			<br/>
			
        
			
			
				<a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIJICIF">Color Matching an Image to Be Printed</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000277-TPXREF101" title="About ColorSync-Supportive Device Driver Development"></a><h2>About ColorSync-Supportive Device Driver Development</h2><p>A device driver that supports ColorSync should provide at least one profile for the device. In addition, it can provide its own <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_283"></a>CMM, designed to <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_284"></a>perform the best possible color matching for the device. If you are creating your own CMM, you should read <span class="content_text"><a href="../DevCMMs/DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDGEBC">Developing Color Management Modules</a></span> and <em>ColorSync Manager Reference</em>.</p><a name="//apple_ref/doc/uid/TP30000277-BAJICJDH" title="Devices and Their Profiles"></a><h3>Devices and Their Profiles</h3><p>To <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_285"></a>assess the way each device interprets color, color scientists and profile developers perform device characterizations. <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_286"></a>This process, which entails measuring the gamut of a device, yields a color profile for that device. For an overview of profiles, see <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCGDGHA">Profiles</a></span>.</p><p>Device <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_287"></a>profiles are of paramount importance to any color management system because they characterize the unique color behavior of each device and provide the data needed for color matching and color conversion. Device profiles are used by CMMs that perform the low-level calculations required to match colors from a source device to a destination device.</p><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_288"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_289"></a>The ICC defines a device profile class for each of three types of devices:</p><ul class="spaceabove"><li class="li"><p>An <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_290"></a>input device, such as a scanner or a digital camera.</p></li><li class="li"><p>A <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_291"></a>display device, such as a monitor or a liquid crystal display.</p></li><li class="li"><p>An <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_292"></a>output device, such as a printer.</p></li></ul><p>These classes are described in detail in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCIAIDH">Profile Classes</a></span>.</p><p>Each device profile class has its own signature. The ColorSync constants for these signatures are described in <em>ColorSync Manager Reference</em>. You can create a device driver for any of the device classes. When you create a profile for your device, you specify the signature in the profile header’s <code>profileClass</code> field. For more information on profile headers, see <em>ColorSync Manager Reference</em></p><p>Whether<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_293"></a> you create a profile for your device or obtain one from a profile vendor, your device driver must provide at least one profile for its device. However, you can provide more than one profile for the same device to characterize different states. Although a printer that your device driver supports may have a number of profiles for different conditions, such as the use of foils or different grades of paper, all of its profiles will use the same profile signature, <code>cmOutputClass</code>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF102" title="The Profile Format and Its Cross-Platform Use"></a><h4>The Profile Format and Its Cross-Platform Use</h4><p>Device<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_294"></a> profiles follow the ICC profile format, an industry standard described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCGDGHA">Profiles</a></span>. You can provide a single profile or a set of profiles that can be used across different operating systems for the device your driver supports. <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_295"></a>The common profile format specified by the ICC allows end users to transparently move profiles and images with embedded profiles between different operating systems.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_61" title="Note"></a><p><strong>Note:</strong>&nbsp;The ICC publishes the International Color Consortium Profile Format Specification.To obtain a copy of the specification, visit the ICC Web site at &lt;http://www.color.org/>.</p></div><p>The profile structure is defined as a header followed by a tag table which, in turn, is followed by a series of tagged elements that your device driver can access randomly and individually. Using ColorSync Manager functions, you can read the profile header and modify its contents and you can get and set individual tags and their element data.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF103" title="ColorSync Profile Format Version Numbers"></a><h4>ColorSync Profile Format Version Numbers</h4><p>This document uses 2.x to refer to ColorSync profiles for ColorSync Manager version 2.0 and greater, as described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCHHHGG">ColorSync and ICC Profile Format Version Numbers</a></span>. Version 2.x profiles require more information and are larger than ColorSync 1.0 profiles, which were originally memory based. Because version 2.x profiles are larger, they are disk-based. The ICC profile format specification defines how profiles can be stored as disk files and how profiles can be embedded in common graphics file formats such as PICT and TIFF. The ColorSync Manager provides the <code>CMProfileLocation</code> data structure to identify the location of a profile. It also provides functions you can use to embed a profile in or extract if from a PICT file, as described in <em>ColorSync Manager Reference</em>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF104" title="Storing and Handling Device Profiles "></a><h4>Storing and Handling Device Profiles </h4><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_296"></a><p>Device profiles reside in the <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_297"></a>ColorSync Profiles folder, in pictures, or with device drivers. Files that contain profiles store profile data in the data fork and have a file type of <code>'prof'</code>.</p><p>By convention, profiles not embedded in image documents are stored in the ColorSync Profiles folder, as described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCBECGG">Profile Search Locations</a></span>. You can store your profile files wherever you want, but if you want other drivers or applications to have access to them, you should store them in the ColorSync Profiles folder. Applications that perform <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_298"></a>soft proofing or gamut checking can use ColorSync Manager routines to search the folder for specific types of profiles to provide a pop-up menu or list to the user. If your profiles are not available, these applications will not be able to include these profiles in menus or lists, and will not be able to color match to your device (unless they provide a profile for your device themselves).</p><p>Some applications may place special-purpose profiles for your device in the ColorSync Profiles folder. For this reason, when your device driver itself displays a pop-up menu or list to the user, you should search not only your private profile location storage, if you use one, but also the ColorSync Profiles folder, to make sure that you offer a complete list of available profiles for your device.</p><p>The ColorSync Profiles folder can contain both ColorSync 1.0 profiles and version 2.x profiles. However, your <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_299"></a>device driver will be able to search for only version 2.x profiles. This is because ColorSync Manager 2.x search functions do not acknowledge ColorSync 1.0 profiles. Support for 1.0 profiles may be even more limited in the future. For more information on this and other limitations of the 1.0 profile format, see <span class="content_text"><a href="../VersAndCompat/VersAndCompat.html#//apple_ref/doc/uid/TP30000275-BCIHDHDB">ColorSync 1.0 Profiles and Version 2.x Profiles</a></span>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF105" title="How a Device Driver Uses Profiles"></a><h4>How a Device Driver Uses Profiles</h4><p>For most ColorSync Manager functions that your device driver calls, you will need to supply references to profiles for both the source device on which the image was created and the destination device for which it is to be color matched and where it will be rendered.</p><p>The driver for an input device such as a scanner typically embeds the scanner profile used to create the image in the document containing the image. The driver for a device that displays an existing image on the system’s display or a printer device that prints a color-matched image typically extracts the embedded profile that accompanies the image from the document containing the image, and uses that profile as the source profile when matching.</p><p>Images created using input devices are commonly color matched using the profile for the<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_300"></a> input device as the source profile and the system profile for the display as the destination profile. <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCIEIEE">Setting Default Profiles</a></span> describes how to set the default system profile and other default profiles. Images that are created, depicted, or modified on a display device and that are destined for an output device such as a printer are color matched using the profile for the display as the source profile and the printer’s profile as the destination profile.</p><p>To use a profile, you must first obtain a reference to the profile. For a description of how to do this, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCJDHBI">Obtaining Profile References</a></span>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF106" title="Devices and Color Management Modules"></a><h3>Devices and Color Management Modules</h3><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_301"></a>Your de<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_302"></a>vice driver can use the color conversion functions, described in <em>ColorSync Manager Reference</em>, to convert colors between color spaces belonging to the same base family without relying on a CMM. However, color matching, gamut checking, providing color rendering dictionaries to PostScript printers, and other tasks you perform using ColorSync Manager functions all require use of a CMM. It is the <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_303"></a>CMM that actually carries out the work of the ColorSync Manager functions, such as performing the low-level calculations required to match colors from a source device to a destination device.</p><p>If your ColorSync-supportive device driver can use the Apple-supplied default CMM, you need only provide one or more profiles for your device. However, you may want to provide a custom CMM that is optimized for your device and its profiles. For example, a profile can provide private tags containing information a custom CMM might use to achieve better results for the device. </p><p>To provide your own CMM, you can create one or obtain one from a vendor. For information describing how to create a CMM, see <span class="content_text"><a href="../DevCMMs/DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDGEBC">Developing Color Management Modules</a></span> and <em>ColorSync Manager Reference</em><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_304"></a></p><p>For additional information on CMMs, see <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCGBFFC">Setting a Preferred CMM</a></span> and <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCBBFJD">How the ColorSync Manager Selects a CMM</a></span>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF107" title="Providing ColorSync-Supportive Device Drivers"></a><h3>Providing ColorSync-Supportive Device Drivers</h3><p>Your ColorSync-supportive device driver can provide users with various color-matching features based on the type of device you support. This section describes:</p><ul class="spaceabove"><li class="li"><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIHCIIC">Providing Minimum ColorSync Support</a></span></p></li><li class="li"><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIEIHHG">Providing More Extensive ColorSync Support</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000277-BCIHCIIC" title="Providing Minimum ColorSync Support"></a><h4>Providing Minimum ColorSync Support</h4><p>The <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_305"></a>minimum level of ColorSync support you should provide differs depending on the type of device your driver supports.</p><p>For a scanner, you should embed the scanner profile used to create the image in the document containing the image; this is also referred to as tagging an image. If you do not tag the image with the profile, you should at least make the profile for the image available so that it can be used for color matching. If you do not provide the scanner profile, an application or driver that attempts to color match the scanned image will use the system profile as the source profile and may produce results inconsistent with the colors of the original image.</p><p>For a display device driver or a printer device driver, you must preserve images tagged with a profile by not stripping out picture comments used to embed profiles or by leaving profiles in documents that use other methods to include them. For example, if your driver displays or prints PICT files but does not perform color matching, your driver should not strip out the ColorSync-related picture comments that are used to embed profiles in PICT files, begin and end use of a specific profile, and enable and disable color matching. Even though your driver may not make use of the comments, another display or printer driver or an application may use them.</p><p>If you don’t perform color matching but you want to allow other applications to produce images that are color matched for your device, you should provide a device profile to be used as the destination profile. If you provide a profile for your display or printer and place it in the ColorSync Profiles folder, applications that perform color matching can use it to create a color-matched image expressed in the colors of your device’s gamut. A user can then print a color-matched image using the printer your driver supports<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_306"></a>. </p><a name="//apple_ref/doc/uid/TP30000277-BCIEIHHG" title="Providing More Extensive ColorSync Support"></a><h4>Providing More Extensive ColorSync Support</h4><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_307"></a>Instead of relying on an application to color match an image for your printer, your printer driver can color match the image itself before sending it to the printer. To perform color matching, your printer driver must obtain a reference to the source profile. Documents containing images to be printed often contain an embedded profile along with the image. To use the source profile, your printer driver must be able to extract it. If an image is not accompanied by a source profile, the default system profile is used, as described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCIEIEE">Setting Default Profiles</a></span>. In this case, your driver should provide an interface that allows the user to select the rendering intent to be used. Rendering intents are described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCHJGFF">Rendering Intents</a></span>.</p><p>You can provide an interface that offers additional features. Your interface can </p><ul class="spaceabove"><li class="li"><p>allow a user to turn ColorSync color matching on or off before printing</p></li><li class="li"><p>offer pop-up menus, allowing the user to choose</p><ul class="nested"><li class="nested li"><p>the rendering method to be used in color matching the image (perceptual, colorimetric, or saturation)</p></li><li class="nested li"><p>the color-image quality (normal, draft, or best)</p></li></ul></li></ul><p>Some of these features are discussed below and in <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCJCBHD">Developing ColorSync-Supportive Applications</a></span><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_308"></a>.</p><a name="//apple_ref/doc/uid/TP30000277-TPXREF108" title="Developing Your ColorSync-Supportive Device Driver"></a><h2>Developing Your ColorSync-Supportive Device Driver</h2><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_309"></a>This section describes how your device driver can implement certain color matching and related features with ColorSync. It includes the following:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCICJAFG">Determining If the ColorSync Manager Is Available</a></span></p></li><li class="li"><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIJBECH">Interacting With the User</a></span></p></li><li class="li"><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIJICIF">Color Matching an Image to Be Printed</a></span></p></li></ul><p>Many of the tasks that your device driver performs to support ColorSync can also be performed by other kinds of color-matching applications. Some of these tasks are mentioned here, but not explained in detail. For a list of code samples shown elsewhere, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCHIGJG">Developing Your ColorSync-Supportive Application</a></span>.</p><a name="//apple_ref/doc/uid/TP30000277-BCICJAFG" title="Determining If the ColorSync Manager Is Available"></a><h3>Determining If the ColorSync Manager Is Available</h3><p>To <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_310"></a>determine if the ColorSync Manager (version 2.x) is available, call the <code>Gestalt</code> function with the <code>gestaltColorMatchingVersion</code> selector. For sample code that demonstrates how to perform this operation, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCBDFDG">Determining If the ColorSync Manager Is Available</a></span>. ColorSync constants for use with the <code>Gestalt</code> function are described in <em>ColorSync Manager Reference</em>. For related information on ColorSync versions, see <span class="content_text"><a href="../VersAndCompat/VersAndCompat.html#//apple_ref/doc/uid/TP30000275-TPXREF115">Table 7-1</a></span>, which lists version numbers for releases of the ColorSync Manager, along with corresponding shared library version numbers, <code>Gestalt</code> selector codes, and hardware and system requirements.</p><a name="//apple_ref/doc/uid/TP30000277-BCIJBECH" title="Interacting With the User"></a><h3>Interacting With the User</h3><p>Using lists and dialog boxes, you can provide choices that influence the color-matching process. For example, you can offer any of the following:</p><ul class="spaceabove"><li class="li"><p>A list of profiles to select from. You can allow the user to choose the appropriate profile for your printer in its current state. To provide a list of profiles for the user to select from, you must first search for the relevant profiles:</p><ul class="nested"><li class="nested li"><p>Starting with version 2.5 of the ColorSync Manager, you should use the algorithm shown in <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCCHEAG">Performing Optimized Profile Searching</a></span> to search for profiles. That algorithm uses <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMIterateColorSyncFolder" target="_top">CMIterateColorSyncFolder</a></code>.</p></li><li class="nested li"><p>For versions of the ColorSync Manager prior to 2.5, you can use the functions described in <em>ColorSync Manager Reference</em>. </p></li></ul></li><li class="li"><p>A dialog box for specifying how the image will be color matched. If the source profile is embedded with the image, the source profile specifies the rendering intent to be used. However, if the source profile is not provided and the system profile is used as the source profile, you should allow the user to select the rendering intent to be used. After the user chooses a rendering intent, you can use the selection to set the source profile’s header. <span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCICJGHI">Setting a User-Selected Rendering Intent</a></span> explains this process.</p></li><li class="li"><p>A dialog box for choosing which color-matching quality of image to produce. A user may want to produce a draft of the image quickly for review before producing the best possible quality of the image. After the user chooses a color-matching quality, you can use the selection to set the source profile’s header. <span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIDCFID">Setting a User-Selected Color-Matching Quality Flag</a></span> explains how to do this.</p></li><li class="li"><p>A dialog box for turning ColorSync color matching on or off before printing. If an application that creates or modifies an image has already performed color matching using your printer profile as the destination profile, the user might want to turn off color matching. To provide this capability, your driver should support the <code>PrGeneral</code> function with the <code>enableColorMatchingOp</code> operation code. For information on the <code>PrGeneral</code> function, see Inside Macintosh: Imaging With QuickDraw. The <code>enableColorMatchingOp</code> operation code constant defined by the ColorSync Manager is described in <em>ColorSync Manager Reference</em>.</p></li></ul><a name="//apple_ref/doc/uid/TP30000277-BCICJGHI" title="Setting a User-Selected Rendering Intent"></a><h4>Setting a User-Selected Rendering Intent</h4><p>The ColorSync <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_311"></a>Manager supports the four standard rendering intents defined by the ICC—perceptual, relative colorimetric, saturated, and absolute colorimetric. Every profile supports these four intents, which are commonly used to match the colors of a source image to the color gamut of the destination device in the most optimum way for the type of image. These intents are described in detail in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCHJGFF">Rendering Intents</a></span>.</p><p>If the source profile is embedded with the image, the source profile specifies the rendering intent to be used. However, if the source profile is not available and the system profile must be used as the source profile, you should allow the user to select the rendering intent to be used.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_62" title="Note"></a><p><strong>Note:</strong>&nbsp;Starting with ColorSync 2.5, your application can call <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetDefaultProfileBySpace" target="_top">CMGetDefaultProfileBySpace</a></code> to obtain an appropriate source profile for matching, rather than using the default system profile. However, you may still wish to allow the user to specify a rendering intent.</p></div><p>To <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_312"></a>allow users to choose the rendering intent most appropriate for color matching a graphical image, you can provide a pop-up menu or a dialog box identifying the rendering intent options available. By providing a description of the available rendering intents, you can help a user select the rendering intent that best maintains important aspects of the image.</p><p>Color professionals and technically-sophisticated users are likely to be familiar with the ICC terms for rendering intent and the gamut-matching strategies they represent. If your application is aimed at novice users, however, you may prefer to use a simplified terminology based on the typical image content associated with a rendering intent, as described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCBGDDB">Table 3-1</a></span>. For example, you might note the following:</p><ul class="spaceabove"><li class="li"><p>For <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_313"></a>perceptual matching, all the colors of a given gamut may be scaled to fit within another gamut. This intent is the best choice for realistic images, such as scanned photographs.</p></li><li class="li"><p>For <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_314"></a>saturation matching, the relative saturation of colors is maintained from gamut to gamut. Rendering the image using this intent gives the strongest colors and is the best choice for bar graphs and pie charts, in which the actual color displayed is less important than its vividness.</p></li><li class="li"><p>For <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_315"></a>relative colorimetric matching, the colors that fall within the gamuts of both devices are left unchanged. Some colors in both images will be exactly the same, a useful outcome when colors must match quantitatively. This intent is best suited for logos or spot colors.</p></li><li class="li"><p>For <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_316"></a>absolute colorimetric matching, a close appearance match may be achieved over most of the tonal range, but if the minimum density of the idealized image is different from that of the output image, the areas of the image that are left blank will be different. Colors that fall within the gamuts of both devices are left unchanged.</p></li></ul><p>After the user selects the intent to be used, you must modify the <code>renderingIntent</code> field of the system profile’s header to reflect the choice. To put the rendering intent chosen by the user in the profile header, follow these steps:</p><ol class="ol"><li class="li"><p>Obtain a profile reference to the system profile.</p><p><span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCJJBEF">Identifying the Current System Profile</a></span> describes how to do this.</p></li><li class="li"><p>Get the profile header of the system profile.</p><p>You call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetProfileHeader" target="_top">CMGetProfileHeader</a></code>, passing the profile reference, to obtain the profile’s header. The function returns the profile header using a union of type <code>CMAppleProfileHeader</code>. You can use this function for both ColorSync 1.0 profiles and version 2.x profiles. </p><p>For a version 2.x profile, you use the data structure <code>CM2Header</code>. For a version 1.0 profile, you use the <code>CMHeader</code> data structure. For more information on profile headers, see <em>ColorSync Manager Reference</em>. </p></li><li class="li"><p>Assign the new rendering intent to the header field.</p><p>To assign a rendering intent to the system profile header’s <code>renderingIntent</code></p><p><code>enum { cmPerceptual= 0, cmRelativeColorimetric= 1, cmSaturation= 2, cmAbsoluteColorimetric= 3 };</code> field, use the constants defined by the following enumeration:</p><p>These constants are described in <em>ColorSync Manager Reference</em>.</p></li><li class="li"><p>Set the modified profile header of the system profile.</p><p>After you assign the rendering intent, you must replace the header by calling the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMSetProfileHeader" target="_top">CMSetProfileHeader</a></code>. You can use this function to set a header for a version 1.0 or a version 2.x ColorSync profile. You pass the header using the union <code>CMAppleProfileHeader</code>.</p></li></ol><p>You can now use the system profile to create a color world for the color-matching process. For information on how to create a color world, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCIAFAE">Creating a Color World to Use With the General Purpose Functions</a></span>.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_63" title="Important:"></a><p><strong>Important:</strong>&nbsp;When you call <code>CMSetProfileHeader</code>, the profile header is modified temporarily. The rendering intent change is discarded when you call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMCloseProfile" target="_top">CMCloseProfile</a></code>. To preserve the change, you must call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMUpdateProfile" target="_top">CMUpdateProfile</a></code>.</p><p></p></div><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIBGCII">Listing 5-1</a></span> includes code that uses the <code>cmSaturation</code> constant to set the rendering intent for a profile. <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_317"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_318"></a></p><a name="//apple_ref/doc/uid/TP30000277-BCIDCFID" title="Setting a User-Selected Color-Matching Quality Flag"></a><h3>Setting a User-Selected Color-Matching Quality Flag</h3><p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_319"></a>The <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_320"></a>ColorSync Manager provides a feature, called the quality flags settings, that controls the quality of the color-matching process in relation to the time required to perform the match. This feature, which is not a standard feature defined by the ICC profile format specification, works by letting you manipulate certain bits of the profile header’s <code>flags</code> field. There are three quality flag settings: normal, draft, and best. For a description of the profile header’s <code>flags</code> field, see <em>ColorSync Manager Reference</em>.</p><p>Normal mode is the default setting. Color matching using draft mode takes the least time and produces the least exact results. Color matching using best mode takes the longest time but produces the finest results.</p><p>Users sometimes want to produce review drafts of images quickly before expending the time to produce the best-quality final copy. Your interface can allow them this flexibility by offering a dialog box that provides the three options.</p><p>After the user selects the color-matching quality, you can use the selection to set the appropriate bits of the source profile’s <code>flags</code> field. To set the color-matching quality chosen by the user, follow these steps:</p><ol class="ol"><li class="li"><p>Obtain a profile reference to the source profile.</p><p><span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCJDHBI">Obtaining Profile References</a></span> describes how to do this.</p></li><li class="li"><p>Get the profile header of the source profile.</p><p>You call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetProfileHeader" target="_top">CMGetProfileHeader</a></code>, passing the profile reference, to obtain the profile’s header. The function returns the profile header using a union of type <code>CMAppleProfileHeader</code>.</p></li><li class="li"><p>Optionally, test the current setting of the source profile header’s flags.</p><p>The <code>flags</code> field of the source profile header is a long word coded in big-endian notation. Big-endian notation is a means of encoding data in which the first byte within 16-bit and 32-bit quantities is the most significant. The ICC profile consortium reserves the first 2 bits of the low word for its own use. The least significant 2 bits of the high word constitute the quality flag settings used to specify the quality for the color matching. The bit definitions for the <code>flags</code> field are shown in <em>ColorSync Manager Reference</em>.</p><p>To evaluate and interpret the current setting of the quality flags bits, you can take these steps, in order:</p><ul class="ul"><li class="li"><p>Right-shift by 16 bits.</p></li><li class="li"><p>Mask off the high 14 bits.</p></li><li class="li"><p>Compare the result with values defined by the following enumeration:</p></li></ul><div class="codesample"><table><tr><td scope="row"><pre>        enum<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>         cmNormalMode = 0,<span></span></pre></td></tr><tr><td scope="row"><pre>         cmDraftMode = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>         cmBestMode = 2<span></span></pre></td></tr><tr><td scope="row"><pre>        };<span></span></pre></td></tr></table></div><p>These constants are described in <em>ColorSync Manager Reference</em>.</p></li><li class="li"><p>Set the quality flags bits to the user-selected value.</p><p>To set the quality flag, you can use the constants defined by the enumeration provided by the ColorSync Manager and shown in step 3.</p></li><li class="li"><p>Set the source profile with the modified profile header.</p><p>After you set the <code>flags</code> field based on the user’s selection, you must replace the header by calling the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMSetProfileHeader" target="_top">CMSetProfileHeader</a></code>. You pass the header using the union <code>CMAppleProfileHeader</code>.</p></li></ol><p>You can now use the source profile to create a color world for the color-matching process. For information on how to create a color world, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCIAFAE">Creating a Color World to Use With the General Purpose Functions</a></span>.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_64" title="Important:"></a><p><strong>Important:</strong>&nbsp;When you call <code>CMSetProfileHeader</code>, the profile header is modified temporarily. Changes to the <code>flags</code> field are discarded when you call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMCloseProfile" target="_top">CMCloseProfile</a></code>. To preserve the change, you must call the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMUpdateProfile" target="_top">CMUpdateProfile</a></code>.</p><p></p></div><p><span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIBGCII">Listing 5-1</a></span> shows how to set the system profile’s quality flag to best mode for producing the highest-quality color-matched image. It also sets the rendering intent to saturation before setting up a color world based on the modified system profile and the printer profile.</p><p>The <code>MySetHeader</code> function shown in <span class="content_text"><a href="DevCSSDevDrvrs.html#//apple_ref/doc/uid/TP30000277-BCIBGCII">Listing 5-1</a></span> initializes the <code>CMProfileRef</code> data structures it will use for the system profile and the printer profile before it calls the following two functions—the ColorSync Manager function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetSystemProfile" target="_top">CMGetSystemProfile</a></code> to obtain a reference to the system profile and its own function <code>MyGetPrinterProfile</code> to obtain a reference to the profile for its printer.</p><p>The <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_321"></a>source profile (in this case, the system profile), not the printer profile, determines the quality mode and the rendering intent to be used in color matching the image to the destination printer. Now that it has a reference to the system profile, the code can obtain the profile’s header. It does this by calling the function <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetProfileHeader" target="_top">CMGetProfileHeader</a></code>, specifying the reference it obtained to the system profile.</p><p>Using the <code>kSpeedAndQualityFlagMask</code> constant it defined earlier, the code clears the quality mode bits of the system profile’s <code>flags</code> field. Then it sets the quality mode bits to <code>cmBestMode</code> to specify best mode quality for color matching. The least significant 2 bits of the <code>flags</code> field’s high word constitute the quality flag. After setting the quality flag, the code sets the system profile header’s <code>renderingIntent</code> field to <code>cmSaturation</code>.</p><p>Now that the code has modified the system profile’s header to indicate the user’s selections, it calls the <code>CMSetProfileHeader</code> function to write the profile header to the profile. Because the driver code intends to use the values the user selected only to color match the image to be printed, it does not permanently preserve the header field changes by calling <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMUpdateProfile" target="_top">CMUpdateProfile</a></code> to write the changes to the profile. When the code closes its reference to the system profile after having built the color world, the system profile’s header modifications are discarded.</p><p>The code calls the <code>NCWNewColorWorld </code>function, passing the temporarily modified system profile, to create the color world. It then closes its references to both the system and printer profiles and color matches the image before sending it to the printer. When it no longer needs the color world, the code calls the <code>CWDisposeColorWorld</code> function to close the color world and release the memory it uses. Finally, the code tests to ensure that the profile references are closed.</p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_65" title="Listing 5-1Modifying a profile header&acirc;&#128;&#153;s quality flag and setting the rendering intent"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000277-BCIBGCII" title="Listing 5-1Modifying a profile header&acirc;&#128;&#153;s quality flag and setting the rendering intent"></a><strong>Listing 5-1&nbsp;&nbsp;</strong>Modifying a profile header’s quality flag and setting the rendering intent</p><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_322"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_323"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_324"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_325"></a><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_326"></a><div class="codesample"><table><tr><td scope="row"><pre>void MySetHeader(void);<span></span></pre></td></tr><tr><td scope="row"><pre>CMError MyGetPrinterProfile(CMProfileRef *printerProf);<span></span></pre></td></tr><tr><td scope="row"><pre>/* for CM2Header.profileVersion */<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMajorVersionMask 0XFF000000<span></span></pre></td></tr><tr><td scope="row"><pre>/* two bits used to specify speed &amp; quality */<span></span></pre></td></tr><tr><td scope="row"><pre>/* must be shifted left 16 bits in flag’s long word */<span></span></pre></td></tr><tr><td scope="row"><pre>#define kSpeedAndQualityFlagMask 0X00000003<span></span></pre></td></tr><tr><td scope="row"><pre>void MySetHeader(void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CMError                     cmErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CMProfileRef                sysProf;<span></span></pre></td></tr><tr><td scope="row"><pre>    CMAppleProfileHeader        sysHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    CMProfileRef                printerProf;<span></span></pre></td></tr><tr><td scope="row"><pre>    CMWorldRef                  cw;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sysProf = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    printerProf= NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    cw  = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    cmErr = CMGetSystemProfile(&amp;sysProf);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (cmErr == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        cmErr = MyGetPrinterProfile(&amp;printerProf);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (cmErr == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        cmErr = CMGetProfileHeader(sysProf, &amp;sysHeader);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (cmErr == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        /* clear the current quality and then set it to best */<span></span></pre></td></tr><tr><td scope="row"><pre>        sysHeader.cm2.flags &amp;= ~(kSpeedAndQualityFlagMask &lt;&lt; 16);<span></span></pre></td></tr><tr><td scope="row"><pre>        sysHeader.cm2.flags |= (cmBestMode &lt;&lt; 16);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* set rendering intent to saturation */<span></span></pre></td></tr><tr><td scope="row"><pre>        sysHeader.cm2.renderingIntent = cmSaturation;<span></span></pre></td></tr><tr><td scope="row"><pre>        cmErr = CMSetProfileHeader(sysProf, &amp;sysHeader);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (cmErr == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        cmErr = NCWNewColorWorld(&amp;cw, sysProf, printerProf);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* close any open profiles */<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sysProf != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        (void) CMCloseProfile(sysProf);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (printerProf != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        (void) CMCloseProfile(printerProf);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>        /* device-driver functions that use the color world to color match<span></span></pre></td></tr><tr><td scope="row"><pre>            the image and send it to the printer belong here */<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>                    .<span></span></pre></td></tr><tr><td scope="row"><pre>    if (cw != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        CWDisposeColorWorld(cw);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000277-BCIJICIF" title="Color Matching an Image to Be Printed"></a><h2>Color Matching an Image to Be Printed</h2><p>The ColorSync Manager provides QuickDraw-specific and general purpose color-matching functions, as described in <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCGJIJA">When Color Matching Occurs</a></span>. Printer device drivers usually perform color matching using the general purpose ColorSync Manager functions to match all QuickDraw operations as they pass through the bottleneck routines of the printing grafport. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_66" title="Note"></a><p><strong>Note:</strong>&nbsp;The general-purpose functions can perform all the operations performed by the QuickDraw-specific functions, but the reverse is not true.</p></div><p>When the stream of QuickDraw data sent to your printer device driver contains a profile embedded using picture comments, your driver should extract the embedded profile using the ColorSync Manager’s <code>CMUnflattenProfile</code> function. After you extract the profile and open a reference to it, you should create a new color world based on the extracted profile and a profile for your printer. For information on how to extract an embedded profile, see <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCEAAFB">Extracting Profiles Embedded in Pictures</a></span>. <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCIAFAE">Creating a Color World to Use With the General Purpose Functions</a></span> describes how to create a color world.</p><p>If the QuickDraw data stream does not contain embedded profiles, your driver should use the system profile as the source profile in creating the color world.</p><p>You should then match subsequent QuickDraw operations using the color world before sending them to your <a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_327"></a>printe<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_328"></a>r.<a name="//apple_ref/doc/uid/TP30000277-DontLinkElementID_329"></a> See <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCIEIEE">Setting Default Profiles</a></span> for information on how the user and how your code can set default profiles.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DevCSApps/DevCSApps.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../DevCMMs/DevCMMs.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 1999, 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-02-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCSSDevDrvrs/DevCSSDevDrvrs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCSSDevDrvrs/DevCSSDevDrvrs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCSSDevDrvrs/DevCSSDevDrvrs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>