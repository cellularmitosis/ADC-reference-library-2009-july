<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Responding to Calls(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING423></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-422.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-424.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-409.html"><B>Chapter 7 - Text Services Manager</B></A> / <A HREF="Text-421.html"><B>Using the Text Services Manager (for Text Service Components)</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING423-0></A>
<H2><A NAME=MARKER-2-278></A>Responding to Calls</H2>
 When a client application makes certain calls to the Text Services Manager application interface, the Text Services Manager in turn calls your text service component. Your text service component responds to these calls by initiating or closing a text service, manipulating text service windows, responding to events or menu commands, and confirming text input.<P>
<A NAME=HEADING423-2></A>
<H3><A NAME=MARKER-9-279></A>Initiating a Text Service</H3>
 When your text service component receives the <CODE>InitiateTextService</CODE> call, it can commence its operations to provide its text service. That may include opening windows or palettes, initializing data structures, communicating with the user or application, or otherwise getting started with its tasks.<P>
 <A NAME=MARKER-2-364></A>The Text Services Manager may call <CODE>InitiateTextService</CODE> on its own or in response to receiving the application-interface call <CODE>OpenTextService</CODE>.<P>
<A NAME=HEADING423-5></A>
<H3><A NAME=MARKER-2-189></A>Activating Text Service Component Windows</H3>
 If a window associated with a TSM document associated with your text service is being activated, your text service component receives the <CODE>ActivateTextService</CODE> call. You should show floating windows associated with your component instance and prepare to receive and handle events.<P>
 <A NAME=MARKER-2-365></A>If the window is being deactivated, your text service component receives the <CODE>DeactivateTextService</CODE> call. You should perform any necessary cleanup or other tasks associated with deactivating your current component instance. If your text service component is not an input method, you should also hide all floating windows associated with the document being deactivated. If your text service component is an input method and if the newly activated document does <I>not</I> use your text services, you will receive the <CODE><A NAME=MARKER-2-191></A>HidePaletteWindows</CODE> call. At that point you should hide all floating windows associated with the component instance being deactivated.<P>
 <A NAME=MARKER-2-51></A>The Text Services Manager calls <CODE>ActivateTextService</CODE> and <CODE>DeactivateTextService</CODE> in response to receiving the application-interface calls <CODE>ActivateTSMDocument</CODE> and <CODE>DeactivateTSMDocument</CODE>, respectively.<P>
<A NAME=HEADING423-9></A>
<H3><A NAME=MARKER-2-41></A>Responding to Events and Updating the Cursor and Menu</H3>
 <A NAME=MARKER-2-194></A>The Text Services Manager (or a client application) is responsible for adding your <BR>text service component's menu to the menu bar. When your text service component receives a <CODE>GetTextServiceMenu</CODE> call, it needs to return a menu handle. The section <A HREF=Text-422.html#MARKER-9-178>"Providing Menus and Icons" on page 7-38</A> gives instructions for creating text service menus and icons.<P>
 <A NAME=MARKER-2-361></A>When your text service component receives the call <CODE>TextServiceEvent</CODE>, <CODE>TextServiceMenuSelect</CODE>, or <CODE>SetTextServiceCursor</CODE>, <A NAME=MARKER-2-196></A>it should handle the event, menu command, or cursor-drawing if appropriate. For example, when the user enters text, you receive and handle the key-down events; you in turn inform the application what characters to draw in the active input area. When the user makes a menu selection, you are given an opportunity to check whether it is from your menu and then to act on it. You are regularly given the opportunity to redraw the cursor, in case it may be over an area under your control (such as a palette window or the active input area).<P>
 <A NAME=MARKER-2-362></A>The Text Services Manager may call <CODE>GetTextServiceMenu</CODE> on its own or in response to receiving the application-interface call <CODE>OpenTextService</CODE>. The Text Services Manager calls <CODE>TextServiceEvent</CODE>, <CODE>TextServiceMenuSelect</CODE>, and <CODE>SetTextServiceCursor</CODE> in response to receiving the application-interface calls <CODE>TSMEvent</CODE>, <CODE>TSMMenuSelect</CODE>, and <CODE>SetTSMCursor</CODE>, respectively.<P>
<A NAME=HEADING423-13></A>
<H3>Confirming Active Text Input</H3>
 <A NAME=MARKER-2-198></A>A client application may need your input method text service component to terminate input immediately and confirm any text currently in the active input area. When your text service component receives the call <CODE>FixTextService</CODE>, it should confirm all text in the active input area, just as if the user had pressed Return. It should send the confirmed text to the client application through the Update Active Input Area Apple event.<P>
 <A NAME=MARKER-2-199></A>The Text Services Manager calls <CODE>FixTextService</CODE> in response to receiving the application-interface call <CODE>FixTSMDocument</CODE>.<A NAME=MARKER-2-200></A><P>
<A NAME=HEADING423-16></A>
<H3><A NAME=MARKER-2-201></A>Closing a Text Service</H3>
 When your text service is no longer needed, the Text Services Manager calls your text service component's <CODE>TerminateTextService</CODE> function before calling the Component Manager to close the component. Your text service component should use this time to confirm any active input in progress and then dispose of memory as needed.<P>
 The Text Services Manager may call <CODE>TerminateTextService</CODE> on its own or in response to receiving the application-interface call <CODE>CloseTextService</CODE>.<P>
<A NAME=HEADING423-19></A>
<H3><A NAME=MARKER-9-202></A><A NAME=MARKER-2-301></A>Identifying the Supported Scripts and Languages</H3>
 The Operating System, the Text Services Manager, or a client application may need to determine which scripts and languages your text service component supports. When you receive the <CODE>GetScriptLanguageSupport</CODE> call, you return that information in a script-language support record.<P>
 <A NAME=MARKER-2-205></A>The <CODE>GetScriptLanguageSupport</CODE> function and several Text Services Manager application-interface routines use the <B>script-language record</B>--and the <B>script-language support record</B>--to pass information about the scripts and languages associated with text service components.<P>
 The script-language record provides a script code and language code for the script system and the language associated with a given text service component. The script-language record is defined by the <CODE>ScriptLanguageRecord</CODE> data type as follows:<P>
<PRE>
TYPE ScriptLanguageRecord = 
   RECORD
      fScript:    ScriptCode;
      fLanguage:  LangCode;
   END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><A NAME=MARKER-2-206></A><CODE>fScript</CODE>
<DD> The number that identifies a script system supported by the text service component
<DT><CODE><A NAME=MARKER-2-207></A>fLanguage</CODE>
<DD> The number that identifies a language associated with the script supported by the text service component
</DL>
 For a list of constants for all defined script and language codes, see the chapter "Script Manager" in this book.<P>
 The script-language support record consists of an array of script-language records. It is defined by the <CODE>ScriptLanguageSupport</CODE> data type as follows: <P>
<PRE>
TYPE ScriptLanguageSupport = 
   RECORD
      fScriptLanguageCount:   Integer;
      fScriptLanguageArray:   ARRAY[0..0] of ScriptLanguageRecord;
   END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-308></A>fScriptLanguageCount</CODE>
<DD> The number of script-language records in this script-language support record.
<DT><A NAME=MARKER-2-309></A><CODE>fScriptLanguageArray</CODE>
<DD> A variable-length array of script-language records.
</DL>
 The Text Services Manager can call <CODE>GetScriptLanguageSupport</CODE> on its own or in response to receiving the application-interface call <CODE>GetTextServiceLanguage</CODE>.<P>
 <A HREF=#MARKER-9-210>Listing 7-10</A> gives an example of the response to the <CODE>GetScriptLanguageSupport</CODE> call by a Chinese input method.<P>
<B>Listing 7-10  <A NAME=MARKER-9-210></A>Determining the script and language for a text service component</B><P>
<PRE>
TYPE
   scriptHandlePtr= ^ScriptLanguageSupportHandle;
   
VAR
   scriptHdlPtr:scriptHandlePtr;

{The following is part of the case statement that dispatches }
{ text service component routines. It is the component's }
{ response to receiving a GetScriptLanguageSupport call}

kCMGetScriptLangSupport:
   BEGIN
      scriptHdlPtr := (scriptHandlePtr) @(cmParams^.params[0]);
      IF scriptHdlPtr^ = NIL THEN
         scriptHdlPtr^ := (ScriptLanguageSupportHandle)NewHandle
                                 (sizeof(ScriptLanguageSupport));
      IF scriptHdlPtr^ &lt;&gt; NIL THEN
            WITH scriptHdlPtr^^^ DO BEGIN
               fScriptLanguageCount := 1;
               fScriptLanguageArray[0].fScript:= smTradChinese;
               fScriptLanguageArray[0].fLanguage:= 
                                                langTradChinese;
               result := noErr;
            END;
      ELSE
         result := memFullErr;
   END;  
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-422.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-424.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
