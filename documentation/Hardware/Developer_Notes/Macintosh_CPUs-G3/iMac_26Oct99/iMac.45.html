<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Aspects of the New Approach</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><table border="0" cellpadding="0" cellspacing="2" width="432">		<tr>	<td scope="row"><font face="Geneva,Helvetica,Arial" size="1">	<b>PATH<img src="images/space.gif" width="6" height="12"></b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a --> 	<b>&gt;</b> iMac Developer Note		</font></td>	</tr>	</table><br><!-- end of path --><A HREF="iMac.44.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="iMac.44.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="iMac.46.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=5239"> </A>Aspects of the New Approach</H1><P CLASS="T1.Text1"><A NAME="pgfId=5240"> </A>Some aspects of the ROM-in-RAM approach are apparent in the operation of the system. </P><P CLASS="T1.Text1"><A NAME="pgfId=5532"> </A><A HREF="iMac.45.html#12868" CLASS="XRef">RAM Footprint</A></P><P CLASS="T1.Text1"><A NAME="pgfId=5537"> </A><A HREF="iMac.45.html#24686" CLASS="XRef">Startup Disk Control Panel</A></P><P CLASS="T1.Text1"><A NAME="pgfId=5542"> </A><A HREF="iMac.45.html#17724" CLASS="XRef">Data Structures and Files</A></P><P CLASS="T1.Text1"><A NAME="pgfId=5547"> </A><A HREF="iMac.45.html#27176" CLASS="XRef">Memory Mapping</A></P><DIV><H3 CLASS="H3nb.Heading3"><A NAME="pgfId=3799"> </A><A NAME="12868"> </A>RAM Footprint<A NAME="marker=3798"> </A></H3><P CLASS="T1.Text1"><A NAME="pgfId=3800"> </A>The iMac computers have their Mac OS ROM image stored in RAM. The area of RAM that contains the Mac OS ROM image is excluded from the available memory space and is marked as read-only. This removes approximately 3 megabytes of RAM from availability for other uses. In effect, a system with 64 megabytes of RAM appears to have only 61 megabytes available. </P></DIV><DIV><H3 CLASS="H3nb.Heading3"><A NAME="pgfId=3801"> </A><A NAME="24686"> </A>Startup Disk Control Panel</H3><P CLASS="T1.Text1"><A NAME="pgfId=3802"> </A>Setting the startup device from the Startup Disk control panel makes the changes to the boot process that are needed for the ROM-in-RAM approach. The Startup Disk control panel sets the Open Firmware's boot-device configuration variable by modifying the Open Firmware NV-RAM partition that contains the Open Firmware's configuration variables. <A NAME="marker=3803"> </A></P><DIV><BLOCKQUOTE><H4 CLASS="ImportantHead"><A NAME="pgfId=15601"> </A>IMPORTANT</H4><P CLASS="I.Important"><A NAME="pgfId=4336"> </A>The previous API for controlling the startup device selection, using <TT CLASS="cv">_GetDefaultStartup</TT> and<TT CLASS="cv"> _SetDefaultStartup</TT>, is not effective on computers that use the ROM-in-RAM approach.  </P></BLOCKQUOTE></DIV></DIV><DIV><H3 CLASS="H3nb.Heading3"><A NAME="pgfId=3809"> </A><A NAME="17724"> </A>Data Structures and Files<A NAME="marker=3808"> </A></H3><P CLASS="T1.Text1"><A NAME="pgfId=3810"> </A>The Mac OS ROM image is contained in a new file, named &quot;Mac OS ROM&quot;, that is kept in the System Folder. The Mac OS ROM image is the same as it would be if it were an actual Mac OS ROM, containing the high-level software, the kernel software, and the 68K emulator.<A NAME="marker=3811"> </A></P></DIV><DIV><H3 CLASS="H3nb.Heading3"><A NAME="pgfId=3814"> </A><A NAME="27176"> </A>Memory Mapping <A NAME="marker=3813"> </A></H3><P CLASS="T1.Text1"><A NAME="pgfId=3815"> </A>With the ROM-in-RAM approach, memory is not mapped one-to-one as it has been for previous PCI-based Macs. This could be a compatibility issue with some software. Software that assumes the logical and physical addresses are the same will fail, even when virtual memory is not on. Well-behaved software--that is, software that always calls the <TT CLASS="cv">LogicalToPhysical</TT> or <TT CLASS="cv">PrepareMemoryForIO</TT> functions when it needs a physical memory address--will continue to work.<A NAME="marker=3816"> </A> <A NAME="marker=3817"> </A></P><DIV><BLOCKQUOTE><H4 CLASS="ImportantHead"><A NAME="pgfId=15603"> </A>IMPORTANT</H4><P CLASS="I.Important"><A NAME="pgfId=3818"> </A>Designers of DMA device drivers should refer to <I>Designing PCI Cards and Drivers for Power Macintosh Computers .</I>or information about using the <TT CLASS="cv">PrepareMemoryForIO</TT> function to set up mapping for physical and logical addresses. The relevant section is on pages 219-229. For device drivers running with the NewWorld software, the sentence on page 227 that says &quot;Certain DMA transactions require both mapping tables&quot; should be interpreted to mean &quot;All DMA transactions require both mapping tables.&quot; <A NAME="marker=3819"> </A></P></BLOCKQUOTE></DIV></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 Oct 99)<P><A HREF="iMac.44.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="iMac.44.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="iMac.46.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>