<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Integrating Oracle Context</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.39.html"><img src="previous.gif" border="0" alt="Previous"></A><!-- end of banner --></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="31487"> </A>Integrating Oracle Context</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=613916"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=613917"> </A>Describes how to use Oracle Context in a WebObjects application.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=613918"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=613919"> </A>Oracle Context is a powerful searching extension to the Oracle Database engine that adds several features including support for mixing full-text qualifiers with traditional relational qualifiers and background creation of GISTS, and THEMES. It fairly easy to integrate Context searches with EOF since EOF supports custom SQL qualifiers.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606105"> </A>CONTAINS()</H3><P CLASS="Body"><A NAME="pgfId=606107"> </A>Oracle Context adds a new SQL keyword called <TT CLASS="Code">CONTAINS</TT> to the SQL parser inside the Oracle database. This new <TT CLASS="Code">CONTAINS</TT> keyword requires three parameters: </P><PRE CLASS="Code"><A NAME="pgfId=606108"> </A>CONTAINS(columnName, `some text to search for', containsId) &gt; score </PRE><UL><LI CLASS="Bulleted"><A NAME="pgfId=606109"> </A><TT CLASS="Code">ColumnName</TT> is a column within the selected table that has a special Context index created for it.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606111"> </A><TT CLASS="Code">ContainsId</TT> is an integer number that uniquely identifies a given <TT CLASS="Code">CONTAINS</TT> clause within a <TT CLASS="Code">Select</TT> statement. This identifier enables you to use logical operators to combine multiple <TT CLASS="Code">CONTAINS</TT> clauses within a single <TT CLASS="Code">Select</TT> statement.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606112"> </A><TT CLASS="Code">Score</TT> is the score threshold you must overcome to consider a record a hit (usually set to zero).</LI></UL></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606113"> </A>SCORE()</H3><P CLASS="Body"><A NAME="pgfId=606115"> </A>You can obtain the <TT CLASS="Code">SCORE</TT> of each matching record by adding <TT CLASS="Code">SCORE(containsId)</TT> to the SQL <TT CLASS="Code">Select</TT> statement. However, this is a problem for EOF because your <TT CLASS="Code">Select</TT> statements are usually autogenerated from the fixed list of attributes in an entity. If you are always searching with a fixed amount of <TT CLASS="Code">CONTAINS</TT> clauses, you can make a copy of the entity and add the <TT CLASS="Code">SCORE(containsId)</TT> as a derived column and fetch from this special EO that has <TT CLASS="Code">SCORE</TT> attribute(s).</P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606116"> </A>EOSQLQualifier for the CONTAINS Clause</H3><P CLASS="Body"><A NAME="pgfId=606118"> </A>In EOF, you can create an EOSQLQualifier to represent the <TT CLASS="Code">CONTAINS</TT> clause and then AND/OR that EOSQLQualifier to another other EOQualifier to obtain a complete compound qualifier.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607981"> </A>Creating an EOSQLQualifier with &quot;CONTAINS&quot; (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=607983"> </A>EOEntity anEntity=EOModelGroup.defaultGroup().entityNamed(&quot;MyEntity&quot;);<A NAME="pgfId=607985"> </A>EOSQLQualifier (anEntity, &quot;CONTAINS(columnName,'&quot;+someString+&quot;, 1)&gt;0&quot;);</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608002"> </A>Creating an EOSQLQualifier with &quot;CONTAINS&quot; (Objective-C)</H4><PRE CLASS="Code"><A NAME="pgfId=608004"> </A>EOEntity *anEntity=[[EOModelGroup defaultGroup] entityNamed:@&quot;MyEntity&quot;];<A NAME="pgfId=608006"> </A>EOSQLQualifier *qual=[[[EOSQLQualifier alloc] initWithEntity: anEntity<A NAME="pgfId=616630"> </A>    qualifierFormat:@&quot;CONTAINS(%A, '%@', 1)&gt;0&quot;, @&quot;myEnityAttribute&quot;,<A NAME="pgfId=616631"> </A>    someString] autorelease];</PRE><P CLASS="Body"><A NAME="pgfId=616627"> </A></P></DIV></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606127"> </A>Overcoming DISTINCT Problems</H3><P CLASS="Body"><A NAME="pgfId=606129"> </A>A frequent problem when working with Context is that you might get duplicate records matching your query. The obvious way to eliminate the duplicates is to use the <TT CLASS="Code">DISTINCT</TT> keyword in your Select. (see &quot;Fetching Distinct Results&quot;) The problem arises because the column that is indexed with Oracle Context usually contains a <TT CLASS="Code">LONG</TT>, a <TT CLASS="Code">LONG RAW</TT>, or a <TT CLASS="Code">BLOB</TT>. Oracle does not support using <TT CLASS="Code">DISTINCT</TT> with these types of columns. This is one way to solve this problem:</P><P CLASS="Numbered1"><A NAME="pgfId=606231"> </A>	Put the <TT CLASS="Code">LONG RAW</TT> data you are indexing on in a separate table with just the primary key and <TT CLASS="Code">LONG RAW</TT> column (<TT CLASS="Code">DOCUMENT_DATA</TT>).</P><OL><LI CLASS="Numbered"><A NAME="pgfId=608919"> </A>	Make an Entity to the table with all the other attributes (that is, <TT CLASS="Code">DOCUMENT</TT>).</LI><LI CLASS="Numbered"><A NAME="pgfId=608920"> </A>	Make a to-one propagate primary key relationship to the table with the <TT CLASS="Code">LONG RAW</TT> (that is, <TT CLASS="Code">toDocumentData</TT>).</LI><LI CLASS="Numbered"><A NAME="pgfId=606133"> </A>	Make the inverse relationship from the <TT CLASS="Code">LONG RAW</TT> table to the real table (<TT CLASS="Code">toDocument</TT>).</LI><LI CLASS="Numbered"><A NAME="pgfId=606134"> </A>	Query with an EOFetchSpecification <TT CLASS="Code">setUsesDisitinct:YES</TT> on the <TT CLASS="Code">DOCUMENT</TT> table using <TT CLASS="Code">CONTAINS(toDocumentData.data,'some string',1)&gt;0.</TT></LI><LI CLASS="Numbered"><A NAME="pgfId=606135"> </A>	Then, if you really want the long raw data, you can traverse the <TT CLASS="Code">toDocumentData.data</TT> keypath to get the data.</LI></OL><P CLASS="Warning"><A NAME="pgfId=606136"> </A><DIV><IMG SRC="ProgrammingTopics-13.gif"></DIV>Note<BR>Breaking up the long raw data into separate tables is a good convention because many databases have restrictions on using <TT CLASS="Code">DISTINCT</TT> with long raw (memo) columns.<DIV><IMG SRC="ProgrammingTopics-13.gif"></DIV></P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606137"> </A>GISTS and THEMES</H3><P CLASS="Body"><A NAME="pgfId=606139"> </A>Oracle Context has very advanced facilities to do <TT CLASS="Code">GISTS</TT> and <TT CLASS="Code">THEMES</TT>. <TT CLASS="Code">GISTS</TT> are summaries of the documents, and <TT CLASS="Code">THEMES</TT> are a small set of topics covering all of the documents. You can set up <TT CLASS="Code">ORACLE</TT> to automatically update <TT CLASS="Code">GIST</TT> and <TT CLASS="Code">THEME</TT> tables that correspond to your full-text data. You can create Entities in EOModeler that correspond to the <TT CLASS="Code">GISTS</TT> and <TT CLASS="Code">THEME</TT> tables, and you can create relationships in EOModeler from the <TT CLASS="Code">GISTS/THEMES</TT> entities to the actual data entity. Then, you can present the user with a list of all the themes. You can also create a to-one relationship from the data entity to the <TT CLASS="Code">GISTS</TT> entity to provide an easy way to show the summary of a fetched data record.</P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606140"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606141"> </A><A HREF="ProgrammingTopics.1f.html#21824" CLASS="XRef">Fetching Distinct Results</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606142"> </A><A HREF="ProgrammingTopics.19.html#19760" CLASS="XRef">Working with Unnormalized Tables</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606143"> </A>EOSQLQualifier class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=614798"> </A><A HREF="ProgrammingTopics.1a.html#15933" CLASS="XRef">Fetching with an Editing Context</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=614799"> </A>EOQualifier class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=614800"> </A>EOFetchSpecification class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606144"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606145"> </A>	How do I integrate Oracle Context with EOF?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606146"> </A>	How do I use <TT CLASS="Code">GISTS</TT> or <TT CLASS="Code">THEMES</TT>?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606148"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606149"> </A>Oracle</LI><LI CLASS="Bulleted"><A NAME="pgfId=606150"> </A>Context</LI><LI CLASS="Bulleted"><A NAME="pgfId=606151"> </A><TT CLASS="Code">CONTAINS</TT></LI><LI CLASS="Bulleted"><A NAME="pgfId=606152"> </A><TT CLASS="Code">SCORE</TT></LI><LI CLASS="Bulleted"><A NAME="pgfId=606153"> </A><TT CLASS="Code">GISTS</TT></LI><LI CLASS="Bulleted"><A NAME="pgfId=606154"> </A><TT CLASS="Code">THEMES</TT></LI><LI CLASS="Bulleted"><A NAME="pgfId=606155"> </A>EOSQLQualifier</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606156"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606157"> </A>21 July, 1998. David Scheck. First Draft.<BR>19 November, 1998. Clif Liu. Second Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.39.html"><img src="previous.gif" border="0" alt="Previous"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>