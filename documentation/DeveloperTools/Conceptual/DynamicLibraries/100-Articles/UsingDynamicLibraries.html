<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Dynamic Library Programming Topics: Using Dynamic Libraries</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using Dynamic Libraries"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002182" title="Using Dynamic Libraries"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../Darwin/index.html#//apple_ref/doc/uid/TP30000440-TP30000422" target="_top">Darwin</a> &gt; <a href="../../../../Darwin/RuntimeArchitecture-date.html#//apple_ref/doc/uid/TP30000440-TP30000422-TP30000459" target="_top">Runtime Architecture</a> &gt; <a href="../index.html" target="_top">Dynamic Library Programming Topics</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CreatingDynamicLibraries.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="RunpathDependentLibraries.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40002182-SW10" title="Using Dynamic Libraries"></a><hr /><H1>Using Dynamic Libraries</H1><p>When you need to use a dynamic library in your product, you have to install the library in your computer. You may use dynamic libraries as dependent libraries (by specifying them in your product’s link line) or as runtime loaded libraries (by loading them when they are needed, using <code><a href="../../../Reference/MachOReference/Reference/reference.html#//apple_ref/c/func/dlopen" target="_top">dlopen</a></code>).</p><p>This article describes the process of installing and using dynamic libraries. It’s based on the Ratings dynamic library and the StarMeals, StarMeals2, and Grades applications, which are included in this document’s companion-file package. This article also shows how to use dynamic libraries as dependent libraries  or as runtime-loaded libraries. Finally, this article demonstrates how to interpose the functions exported by a dynamic library.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW12">Installing Dependent Libraries</a>
				
			<br/>
			
        
			
			
				<a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW11">Using Dependent Libraries</a>
				
			<br/>
			
        
			
			
				<a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW13">Using Runtime-Loaded Libraries</a>
				
			<br/>
			
        
			
			
				<a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW14">Interposing Functions in Dependent Libraries</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002182-SW12" title="Installing Dependent Libraries"></a><h2>Installing Dependent Libraries</h2><p>Before you can use a dynamic library as a dependent library, the library and its header files must be installed on your computer. The standard locations for header files are <code>~/include</code>, <code>/usr/local/include</code> and <code>/usr/include</code>. The standard locations for dynamic libraries are <code>~/lib</code>, <code>/usr/local/lib</code>, and <code>/usr/lib</code>.</p><p>You may also place the <code>.dylib</code> file at a nonstandard location in your file system, but you must add that location to one of these environment variables:</p><ul class="ul"><li class="li"><p><code>LD_LIBRARY_PATH</code></p></li><li class="li"><p><code>DYLD_LIBRARY_PATH</code></p></li><li class="li"><p><code>DYLD_FALLBACK_LIBRARY_PATH</code></p></li></ul><p>For details on how to add paths to these environment variables, see <span class="content_text"><a href="DynamicLibraryUsageGuidelines.html#//apple_ref/doc/uid/TP40001928-SW12">“Opening Dynamic Libraries.”</a></span> To learn about installing dependent libraries in a relocatable directory, see <span class="content_text"><a href="RunpathDependentLibraries.html#//apple_ref/doc/uid/TP40008306-SW1">“Run-Path Dependent Libraries.”</a></span></p><p>If you don’t want to change the environment variables and you want to place the dynamic library in a nonstandard location, you must specify where in your file system you placed the library when you link your image. See the description of the <code>gcc -dylib_file</code> option in the <code><a href="../../../../Darwin/Reference/ManPages/man1/gcc.1.html#//apple_ref/doc/man/1/gcc" target="_top">gcc</a></code> man page for details.</p><p>For example, in Mac OS X the executable code of applications can be packaged together with frameworks containing libraries created specifically for a particular application. These frameworks are known as <strong>private embedded frameworks</strong>. Applications that use private embedded frameworks, as well as the frameworks themselves, must be specially built. See “<span class="content_text"><a href="../../../../MacOSX/Conceptual/BPFrameworks/Tasks/CreatingFrameworks.html#//apple_ref/doc/uid/20002258" target="_top">Creating a Framework</a></span>” in <em><a href="../../../../MacOSX/Conceptual/BPFrameworks/index.html#//apple_ref/doc/uid/10000183i" target="_top">Framework Programming Guide</a></em> and “<span class="content_text"><a href="../../MachOTopics/1-Articles/loading_code.html#//apple_ref/doc/uid/TP40001830" target="_top">Loading Code at Runtime</a></span>” in <em><a href="../../MachOTopics/index.html#//apple_ref/doc/uid/TP40001519" target="_top">Mach-O Programming Topics</a></em> for details.</p><p><span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW11">“Using Dependent Libraries”</a></span> requires that the Averages 1.1 and Ratings 1.1 dynamic libraries be installed on your computer. To install these libraries:</p><ol class="ol"><li class="li"><p>Open this document’s companion-file package.</p></li><li class="li"><p>In Terminal, execute these commands:</p><div class="codesample"><table><tr><td scope="row"><pre>[Averages/1.1]% make install<span></span></pre></td></tr><tr><td scope="row"><pre>[Ratings/1.1]% make install<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40002182-SW15" title="Note"></a><p><strong>Note:</strong>&nbsp;To uninstall the libraries, execute these commands:</p><div class="codesample"><table><tr><td scope="row"><pre>[Averages/1.1]% make uninstall<span></span></pre></td></tr><tr><td scope="row"><pre>[Ratings/1.1]% make uninstall<span></span></pre></td></tr></table></div></div></li></ol><a name="//apple_ref/doc/uid/TP40002182-SW11" title="Using Dependent Libraries"></a><h2>Using Dependent Libraries</h2><p>Using dynamic libraries as dependent libraries by linking your image against them provides several benefits, including producing smaller executable files and not having to get the address of the libraries’ exported symbols before using them in your code. However, you still have to make sure a weakly imported symbol exists before using it.</p><p>All you need to do to use a dynamic library as a dependent library is include the library’s headers in your source code and link the library against your application or library. The library’s headers describe the symbols you can use. You should not use any other symbols to access the library’s functionality. Otherwise, you may get unexpected results, or your image may stop working for its users when they update the dependent library in their computers.</p><p><span class="content_text">Listing 1</span> shows the source code of a small program that uses Ratings 1.1, developed in <span class="content_text"><a href="CreatingDynamicLibraries.html#//apple_ref/doc/uid/TP40002073-SW1">“Creating Dynamic Libraries.”</a></span></p><a name="//apple_ref/doc/uid/TP40002182-SW1" title="Listing 1Using Ratings 1.1 as a dependent library"></a><p class="codesample"><strong>Listing 1&nbsp;&nbsp;</strong>Using Ratings 1.1 as a dependent library</p><div class="codesample"><table><tr><td scope="row"><pre>/* File: StarMeals.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Uses functions in libRatings.A.dylib.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Ratings.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAMES 100<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAME_LENGTH 30<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_RATING_LENGTH 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char* name_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static char* rating_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static int names = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void addNameAndRating(char* name, char* rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    name_list[names] = strdup(name);<span></span></pre></td></tr><tr><td scope="row"><pre>    rating_list[names] = (strlen(rating) > MAX_RATING_LENGTH)? "*****" : strdup(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    names++;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void test_data(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Spinach", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Cake", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Steak", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Caviar", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Broccoli", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Gagh", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Chicken", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main(int argc, char* argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int test_mode = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (argc == 2) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (strcmp(argv[1], "test") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            test_mode = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[start_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            test_data();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("Enter meal names and ratings in the form &lt;name> &lt;rating>.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("No spaces are allowed in the name and the rating.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("The rating can be * through *****.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("To finish, enter \"end\" for a meal name.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        while (names &lt; MAX_NAMES) {<span></span></pre></td></tr><tr><td scope="row"><pre>            char name[MAX_NAME_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>            char rating[MAX_RATING_LENGTH + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("\nName and rating: ");<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", &amp;name);<span></span></pre></td></tr><tr><td scope="row"><pre>            if (strcmp(name, "end") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            addNameAndRating(name, rating);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (names) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Print data entered and call libRatings.addRating().<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("This is the data you entered:\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = 0; i &lt; names; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("%s (%s)\n", name_list[i], rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>            addRating(rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print statistical information.<span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        printf("\nThe mean rating is %s\n", meanRating()); // 1</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        if (medianRating) {                                // 2</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The median rating is %s\n", medianRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre class="bold">        if (frequentRating) {                              // 3</pre><pre><span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The most frequent rating is %s\n", frequentRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        //printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (test_mode) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[end_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>This list describes the highlighted lines:</p><ul class="ul"><li class="li"><p>Line 1: The <code>meanRating</code> function is guaranteed to exist in all versions of <code>libRating.A.dylib</code>. Therefore, no existence test is required.</p></li><li class="li"><p>Lines 2 and 3: The functions <code>medianRating</code> and <code>frequentRating</code> are available in Ratings 1.1 but not Ratings 1.0. Since StarMeals is to be backwards compatible with Ratings 1.0, it has to check for the existence of these functions before using them. Otherwise, StarMeals may crash.</p></li></ul><p>To compile the <code>StarMeals.c</code> file, use the command shown in <span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW2">Listing 2</a></span>.</p><a name="//apple_ref/doc/uid/TP40002182-SW2" title="Listing 2Compiling and linking StarMeals using only the link line"></a><p class="codesample"><strong>Listing 2&nbsp;&nbsp;</strong>Compiling and linking StarMeals using only the link line</p><div class="codesample"><table><tr><td scope="row"><pre>[StarMeals]% make<span></span></pre></td></tr><tr><td scope="row"><pre>gcc -std=gnu99 StarMeals.c ~/lib/libRatings.dylib ~/lib/libAverages.dylib -o StarMeals<span></span></pre></td></tr></table></div><p>Notice that the exact location of the library StarMeals directly depends (<code>libRatings.dylib</code>) is provided at the link line. The pathname <code>~/lib/libRatings.dylib</code> is actually a symbolic link to <code>~/lib/libRatings.A.dylib</code>. At link time, the static linker resolves the link and stores the library’s actual filename in the image it generates. With this approach, the dynamic linker always uses the library’s complete name when it looks for an image’s dependent libraries.</p><p>The static linker must also have access to the library the Ratings library depends on (<code>libAverages.A.dylib</code>), either through the link line (as <span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW2">Listing 2</a></span> shows) or by having a symbolic link to that library in the current working directory, as shown in <span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW3">Listing 3</a></span>. This requirement stems from the fact that the static linker attempts to resolve all the dependent library’s undefined external symbols. Any unresolved undefined external symbol causes the static linker to cancel the link operation. The location of <code>libAverages.A.dylib</code> at launch time doesn’t necessarily have to be the same location of the library at link time.</p><a name="//apple_ref/doc/uid/TP40002182-SW3" title="Listing 3Compiling and linking StarMeals using the link line and a symbolic link"></a><p class="codesample"><strong>Listing 3&nbsp;&nbsp;</strong>Compiling and linking StarMeals using the link line and a symbolic link</p><div class="codesample"><table><tr><td scope="row"><pre>[StarMeals]% ln -s ~/lib/libAverages.A.dylib<span></span></pre></td></tr><tr><td scope="row"><pre>[StarMeals]% gcc -std=gnu99 StarMeals.c ~/lib/libRatings.A.dylib -o StarMeals<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 4</span> shows the output StarMeals produces when run in test mode:</p><a name="//apple_ref/doc/uid/TP40002182-SW4" title="Listing 4Test output of the StarMeals application"></a><p class="codesample"><strong>Listing 4&nbsp;&nbsp;</strong>Test output of the StarMeals application</p><div class="codesample"><table><tr><td scope="row"><pre>> ./StarMeals test<span></span></pre></td></tr><tr><td scope="row"><pre>start_test<span></span></pre></td></tr><tr><td scope="row"><pre>This is the data you entered:<span></span></pre></td></tr><tr><td scope="row"><pre>Spinach (*)<span></span></pre></td></tr><tr><td scope="row"><pre>Cake (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Steak (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Caviar (*)<span></span></pre></td></tr><tr><td scope="row"><pre>Broccoli (****)<span></span></pre></td></tr><tr><td scope="row"><pre>Gagh (*****)<span></span></pre></td></tr><tr><td scope="row"><pre>Chicken (*****)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>The mean rating is ***<span></span></pre></td></tr><tr><td scope="row"><pre>The medianRating is ****<span></span></pre></td></tr><tr><td scope="row"><pre>The most frequent rating is ****<span></span></pre></td></tr><tr><td scope="row"><pre>[end_test]<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002182-SW13" title="Using Runtime-Loaded Libraries"></a><h2>Using Runtime-Loaded Libraries</h2><p>An image that uses dynamic libraries as runtime-loaded libraries is smaller and loads faster than the image using the same libraries as dependent libraries. The static linker doesn’t add information about the runtime-loaded libraries to the image. And the dynamic loader doesn’t have to load the library’s dependent libraries  when the image is loaded. However, this flexibility comes at a price. Before an image can use a dynamic library that is not one of its dependent libraries, it must load the library with <code><a href="../../../Reference/MachOReference/Reference/reference.html#//apple_ref/c/func/dlopen" target="_top">dlopen</a></code> and get the address of each symbol it needs with <code><a href="../../../Reference/MachOReference/Reference/reference.html#//apple_ref/c/func/dlsym" target="_top">dlsym</a></code>. The image must also call <code><a href="../../../Reference/MachOReference/Reference/reference.html#//apple_ref/c/func/dlclose" target="_top">dlclose</a></code> when it’s done using the library.</p><p>The StarMeals2 program provides the same functionality that StarMeals provides. But StarMeals2 uses the Ratings 1.1 dynamic library as a runtime loaded library. <span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW5">Listing 5</a></span> shows the program’s source code.</p><a name="//apple_ref/doc/uid/TP40002182-SW5" title="Listing 5Using Ratings 1.1 as a runtime loaded library"></a><p class="codesample"><strong>Listing 5&nbsp;&nbsp;</strong>Using Ratings 1.1 as a runtime loaded library</p><div class="codesample"><table><tr><td scope="row"><pre>/* File: StarMeals2.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Uses functions in libRatings.A.dylib.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;dlfcn.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Ratings.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAMES 100<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_NAME_LENGTH 30<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_RATING_LENGTH 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char* name_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static char* rating_list[MAX_NAMES];<span></span></pre></td></tr><tr><td scope="row"><pre>static int names = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void addNameAndRating(char* name, char* rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    name_list[names] = strdup(name);<span></span></pre></td></tr><tr><td scope="row"><pre>    rating_list[names] =<span></span></pre></td></tr><tr><td scope="row"><pre>        (strlen(rating) > MAX_RATING_LENGTH)?<span></span></pre></td></tr><tr><td scope="row"><pre>        "*****" : strdup(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    names++;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void test_data(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Spinach", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Cake", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Steak", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Caviar", "*");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Broccoli", "****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Gagh", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>    addNameAndRating("Chicken", "*****");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main(int argc, char* argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int test_mode = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (argc == 2) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (strcmp(argv[1], "test") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            test_mode = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[start_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            test_data();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("Enter restaurant names and ratings in the form &lt;name> &lt;rating>.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("No spaces are allowed in the name and the rating.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("The rating can be * through *****.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("To finish, enter \"end\" for a restaurant name.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        while (names &lt; MAX_NAMES) {<span></span></pre></td></tr><tr><td scope="row"><pre>            char name[MAX_NAME_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>            char rating[MAX_RATING_LENGTH + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("\nName and rating: ");<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", &amp;name);<span></span></pre></td></tr><tr><td scope="row"><pre>            if (strcmp(name, "end") == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            scanf("%s", rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            addNameAndRating(name, rating);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (names) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open Ratings library.<span></span></pre></td></tr><tr><td scope="row"><pre>        void* lib_handle = dlopen("libRatings.A.dylib", RTLD_LOCAL|RTLD_LAZY);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!lib_handle) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to load library: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print data entered and call libRatings.A:addRating().<span></span></pre></td></tr><tr><td scope="row"><pre>        void (*addRating)(char*) = dlsym(lib_handle, "addRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!addRating) {       // addRating is guaranteed to exist in libRatings.A.dylib<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to get symbol: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("This is the data you entered:\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = 0; i &lt; names; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("%s (%s)\n", name_list[i], rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>            addRating(rating_list[i]);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Print statistical information.<span></span></pre></td></tr><tr><td scope="row"><pre>        char* (*meanRating)(void) = dlsym(lib_handle, "meanRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!meanRating) {      // meanRating is guaranteed to exist in libRatings.A.dylib<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Unable to get symbol: %s\n", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>            exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\nThe mean rating is %s\n", meanRating());<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        char* (*medianRating)(void) = dlsym(lib_handle, "medianRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (medianRating) {     // Backwards compatibility with Ratings 1.0<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The median rating is %s\n", medianRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        char* (*frequentRating)(void) = dlsym(lib_handle, "frequentRating");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (frequentRating) {   // Backwards compatibility with Ratings 1.0<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("The most frequent rating is %s\n", frequentRating());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close Ratings library<span></span></pre></td></tr><tr><td scope="row"><pre>        if (dlclose(lib_handle) != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("[%s] Problem closing library: %s", __FILE__, dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (test_mode) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[end_test]\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p><span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW6">Listing 6</a></span> shows to compile the StarMeals2 application.</p><a name="//apple_ref/doc/uid/TP40002182-SW6" title="Listing 6Compiling and linking StarMeals2"></a><p class="codesample"><strong>Listing 6&nbsp;&nbsp;</strong>Compiling and linking StarMeals2</p><div class="codesample"><table><tr><td scope="row"><pre>[StarMeals2]% make<span></span></pre></td></tr><tr><td scope="row"><pre>gcc -std=gnu99 StarMeals2.c -I&lt;home_dir>/include -o StarMeals2<span></span></pre></td></tr></table></div><p>The static linker doesn’t complain about the unresolved external references in <code>libRatings.A.dylib</code> because it’s not included at the link line. The dynamic linker resolves these references when StarMeals2 uses <code><a href="../../../Reference/MachOReference/Reference/reference.html#//apple_ref/c/func/dlopen" target="_top">dlopen</a></code> to load <code>libRatings.A.dylib</code>.</p><a name="//apple_ref/doc/uid/TP40002182-SW14" title="Interposing Functions in Dependent Libraries"></a><h2>Interposing Functions in Dependent Libraries</h2><p>Sometimes you need to perform operations before or after a function is called to gather statistical data or to modify its inputs our outputs. For example, you may want to find out how many times a program calls a specific function to determine whether an algorithm should be optimized. However, you may not always have access to the function’s source code to make the modifications. Interposition is a mechanism through which you can define your own version of a function that’s defined in an image’s dependent libraries. In your version, you may or may not call the original function.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002182-SW17" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X you can interpose only dependent libraries. Symbols in runtime loaded libraries cannot be interposed.</p></div><p>To call an interposed function from a custom definition, you use the <code>dlsym(RTLD_NEXT, "&lt;function_name>")</code> call to get the address of the “real” function. For example, <span class="content_text">Listing 7</span> shows how you may write a custom version of a function defined in a dynamic library.</p><a name="//apple_ref/doc/uid/TP40002182-SW7" title="Listing 7Interposing a function"></a><p class="codesample"><strong>Listing 7&nbsp;&nbsp;</strong>Interposing a function</p><div class="codesample"><table><tr><td scope="row"><pre>char* name(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    static int name_calls = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("[STATS] name() has been called %i times\n", name_calls);<span></span></pre></td></tr><tr><td scope="row"><pre>    char* (*next_name)(void) = dlsym(RTLD_NEXT, "name");<span></span></pre></td></tr><tr><td scope="row"><pre>    return next_name();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You may use interposition to adapt an existing dynamic library to your particular needs without changing its API. For example, this document’s companion package includes the implementations of two dynamic libraries called Ratings and RatingsAsGrades. The Ratings library implements a star-based rating system (it can be used to tally restaurant and hotel ratings; for example, *** and *****). The RatingsAsGrades library implements a letter-based grading system, which can be used to tally student grades; for example A and C. Instead of writing a new algorithm to manage letter grades, the RatingsAsGrades library leverages the functionality of the Ratings library. <span class="content_text">Listing 8</span> shows the interface and implementation of the RatingsAsGrades library.</p><a name="//apple_ref/doc/uid/TP40002182-SW8" title="Listing 8RatingsAsGrades Interposing Ratings"></a><p class="codesample"><strong>Listing 8&nbsp;&nbsp;</strong>RatingsAsGrades Interposing Ratings</p><div class="codesample"><table><tr><td scope="row"><pre>/* File: RatingsInterposed.h<span></span></pre></td></tr><tr><td scope="row"><pre> * Interface to the RatingsAsGrages dynamic library.<span></span></pre></td></tr><tr><td scope="row"><pre> **************************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Adds 'grade' to the set.<span></span></pre></td></tr><tr><td scope="row"><pre> *      grade: Non-NULL string. Contains zero or<span></span></pre></td></tr><tr><td scope="row"><pre> *             one of these characters:<span></span></pre></td></tr><tr><td scope="row"><pre> *             A, B, C, D, F.<span></span></pre></td></tr><tr><td scope="row"><pre> *             Examples: "", "A", "B".<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>void addRating(char* grade);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Returns the median grade.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>char* medianRating(void);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Returns the most frequent grade.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>char* frequentRating(void);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* File: RatingsAsGrades.c<span></span></pre></td></tr><tr><td scope="row"><pre> * Compile with -fvisibility=hidden.<span></span></pre></td></tr><tr><td scope="row"><pre> ***********************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include "RatingsAsGrades.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;dlfcn.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define EXPORT __attribute__((visibility("default")))<span></span></pre></td></tr><tr><td scope="row"><pre>#define MAX_STAR_RATING_LEN 6<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static char* _ratingAsGrade(char* rating) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int rating_length = strlen(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (rating_length > MAX_STAR_RATING_LEN - 1) {<span></span></pre></td></tr><tr><td scope="row"><pre>        rating_length = MAX_STAR_RATING_LEN - 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    char grade;<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (rating_length) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case 5:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'A';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 4:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'B';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 3:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'C';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 2:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'D';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case 1:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = 'F';<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            grade = '\0';<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    char char_grade[2] = { grade, '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(char_grade);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:addRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>void addRating(char* grade) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char rating[MAX_STAR_RATING_LEN] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (*grade) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'A':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'B':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'C':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'D':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        case 'F':<span></span></pre></td></tr><tr><td scope="row"><pre>            strcat(rating, "*");<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            ;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    void (*next_addRating)(char*) =<span></span></pre></td></tr><tr><td scope="row"><pre>dlsym(RTLD_NEXT, "addRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_addRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        next_addRating(rating);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:medianRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>char* medianRating(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char medianGrade[2] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    char* (*next_medianRating)(void) =<span></span></pre></td></tr><tr><td scope="row"><pre>dlsym(RTLD_NEXT, "medianRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_medianRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        strcpy(medianGrade,<span></span></pre></td></tr><tr><td scope="row"><pre>_ratingAsGrade(next_medianRating()));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(medianGrade);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Interpose libRatings.B.dylib:frequentRating.<span></span></pre></td></tr><tr><td scope="row"><pre>EXPORT<span></span></pre></td></tr><tr><td scope="row"><pre>char* frequentRating(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char frequentGrade[2] = { '\0' };<span></span></pre></td></tr><tr><td scope="row"><pre>    char* (*next_frequentRating)(void) =<span></span></pre></td></tr><tr><td scope="row"><pre>        dlsym(RTLD_NEXT, "frequentRating");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (next_frequentRating) {<span></span></pre></td></tr><tr><td scope="row"><pre>        strcpy(frequentGrade,<span></span></pre></td></tr><tr><td scope="row"><pre>            _ratingAsGrade(next_frequentRating()));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("[%s] Fatal problem: %s", dlerror());<span></span></pre></td></tr><tr><td scope="row"><pre>        exit(EXIT_FAILURE);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return strdup(frequentGrade);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Notice how the <code>addRating</code>, <code>medianRating</code>, and <code>frequentRating</code> functions, modify the input and output of the definitions they shadow.</p><p>The companion-files package includes the source code of the Grades application. This application uses the RatingsAsGrades library to tally the grades of students.</p><p>Follow these instructions to build and run the Grades application:</p><ol class="ol"><li class="li"><p>Open this document’s companion-files package.</p></li><li class="li"><p>In Terminal, perform these commands:</p><div class="codesample"><table><tr><td scope="row"><pre>[Ratings/1.1]% make install<span></span></pre></td></tr><tr><td scope="row"><pre>[Grades]% make<span></span></pre></td></tr></table></div></li></ol><p><span class="content_text"><a href="UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW9">Listing 9</a></span> shows the output of the Grades application when ran in test mode.</p><a name="//apple_ref/doc/uid/TP40002182-SW9" title="Listing 9Test output of the Grades application"></a><p class="codesample"><strong>Listing 9&nbsp;&nbsp;</strong>Test output of the Grades application</p><div class="codesample"><table><tr><td scope="row"><pre>[Grades]% ./Grades test<span></span></pre></td></tr><tr><td scope="row"><pre>[start_test]<span></span></pre></td></tr><tr><td scope="row"><pre>This is the data you entered:<span></span></pre></td></tr><tr><td scope="row"><pre>Eloise  (F)<span></span></pre></td></tr><tr><td scope="row"><pre>Karla   (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Iva     (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Hilaire (F)<span></span></pre></td></tr><tr><td scope="row"><pre>Jewel   (B)<span></span></pre></td></tr><tr><td scope="row"><pre>Simone  (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Yvette  (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Renee   (A)<span></span></pre></td></tr><tr><td scope="row"><pre>Mimi    (A)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>The median grade is B<span></span></pre></td></tr><tr><td scope="row"><pre>The most frequent grade is A<span></span></pre></td></tr><tr><td scope="row"><pre>[end_test]<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CreatingDynamicLibraries.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="RunpathDependentLibraries.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-26<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/UsingDynamicLibraries.html%3Fid%3DTP40001869-1.6&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/UsingDynamicLibraries.html%3Fid%3DTP40001869-1.6&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/UsingDynamicLibraries.html%3Fid%3DTP40001869-1.6&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
