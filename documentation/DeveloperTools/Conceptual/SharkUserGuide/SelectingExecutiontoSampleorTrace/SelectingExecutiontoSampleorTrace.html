<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shark User Guide: Advanced Profiling Control</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Advanced Profiling Control"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005233-CH13" title="Advanced Profiling Control"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000436" target="_top">Tools</a> &gt; <a href="../../../Performance-date.html#//apple_ref/doc/uid/TP30000440-TP30000436-TP30000901" target="_top">Performance</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_6">Shark User Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005233-CH13-SW15" title="Advanced Profiling Control"></a><h1>Advanced Profiling Control</h1><p>Although the <em>Start</em> button makes starting and stopping Shark quite simple, sometimes it can be impractical, or even impossible to use. For example, how can you press the start button on a headless server? Profiling application launch can be hard to accomplish by hand as well. And what if you are only interested in profiling one particular “hot” loop, buried somewhere deep within your application?</p><p>This section discusses various advanced ways to control <em>what</em> Shark profiles, <em>when</em> it profiles, and <em>how</em> the resulting profile relates to your target execution.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW12">Process Attach</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW13">Process Launch</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW2">Batch Mode</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW1">Windowed Time Facility (WTF)</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW20">Unresponsive Application Measurements</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW23">Command Line Shark</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW17">Interprocess Remote Control</a>
				
			<br/>
			
        
			
			
				<a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW19">Network/iPhone Profiling</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005233-CH13-SW12" title="Process Attach"></a><h2>Process Attach</h2><p>It’s not always beneficial to profile the entire system — often there is just too much information. For this reason, Shark allows you to target any process in the system individually, further focusing your profile. In this mode, Shark will only save samples from the target process, while discarding any others. </p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW9" title="Figure 5-1Process Attach"></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>Process Attach</p><img src = "../Art/ProcessAttach.jpg" alt = "Shark in &quot;Process Attach&quot; mode" ></div><br/><p>When you enter this mode by selecting <em>Process</em> from the Target popup in Shark’s main window(or use <em>Command-2</em>), the Shark window will expand, adding a new popup — the <em>Process List</em>, as we show in <span class="content_text">Figure 5-1</span>. By default, the Process List is sorted by process name, and you will only see processes that you own. To change these defaults, open the preferences by selecting the <em>Shark</em>→<em>Preferences</em> menu item (<em>Command-Comma</em>) and adjust the values for the Process List under the “Appearance” tab <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW5">“Shark Preferences.”</a></span> </p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW13" title="Process Launch"></a><h2>Process Launch</h2><p>Attempting to profile launch times for your application by hand can be a frustrating endeavor. Profiling an application (or part of one) that only runs for a short time can be similarly difficult. For this reason, Shark allows you to launch your application directly, from within Shark. To instruct Shark to launch your process, enter <em>Process Attach</em> mode, by selecting <em>Process</em> from the Target popup (<em>Command-2</em>). Now, select the “Launch...” target from the top of the process list (or use <em>Command-Shift-L</em>). Choosing this “process” and then pressing “Start” will bring up the Process Launch Panel, shown below in <span class="content_text">Figure 5-2</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW6" title="Figure 5-2Launch Process Panel"></a><p><strong>Figure 5-2&nbsp;&nbsp;</strong>Launch Process Panel</p><img src = "../Art/LaunchPanel451.jpg" alt = "Shark's process launch panel" ></div><br/><p>Once the Process Launch Panel has appeared, you need to “fill in the blanks” in order to tell Shark how to launch your application. If you reach here by choosing <em>Debug</em>→<em>Launch Using Performance Tool</em>→<em>Shark</em> in Xcode, most of these blanks will be completed for you. At the very least, you must choose an executable file before pressing “OK” and continuing. However, you can also supply many other bits of information to Shark in order to simulate the launching of your application from a command-line shell prompt, and specify a couple of options to help limit capture of spurious samples.</p><ol class="ol"><li class="li"><p><strong>Executable</strong>— The <em>full</em> path to the executable. You can either type it here or press the “Set...” button and then find it using a normal Mac “Open File...” dialog box. For Mac applications, you can set this to be either the entire application or the core binary file inside of it.</p></li><li class="li"><p><strong>Working Dir</strong>— The <em>full</em> path to the working directory that the application will start using. By default, this is the path where the executable is located, but you may point it anywhere else that you like. When the application is executed, it will appear to have been started from a shell that had this directory as its working directory (i.e. the output of <code>pwd</code>) just before executing the command. Hence, relative paths to data files will start being determined from this directory.</p></li><li class="li"><p><strong>Arguments</strong>— Enter any arguments here that you would have normally entered onto your shell command line after the name of the executable. Shark will feed them into the application just as if they had come from a normal shell. Note that since Shark’s “shell” does not have any text I/O, you will need to provide <code>&lt; stdin.txt</code> and <code>> stdout.txt</code> redirection operations here if your executable expects to use <code>stdin</code> and/or <code>stdout</code> “files.”</p></li><li class="li"><p><strong>Environment Variables</strong>— Supply <em>any</em> environment variables that must be set before your application starts in this table. Otherwise, Shark will start your application with <em>no</em> environment variables set (it even clears out any “defaults” that you may have had before invoking Shark). Pressing the “+” and “–” buttons below the table allows you to add or remove environment variables, respectively. Once added, you can freely edit the names of the variables and their value in the appropriate table cells.</p></li><li class="li"><p><strong>Stop sampling if this application exits</strong>— If checked, Shark stops sampling immediately after your application completes. Hence, this will prevent Shark from capturing a bunch of samples that have nothing to do with your application if it completes quickly.</p></li><li class="li"><p><strong>Cancel &amp; OK</strong>— Shark will start your application and sample it <em>immediately</em> after you hit OK. If you change your mind, Cancel will return you back to the main Shark window.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH13-SW2" title="Batch Mode"></a><h2>Batch Mode</h2><p>Batch mode queues up any sessions recorded without displaying them. Pending sessions are listed in the main Shark window. Batch mode allows multiple sessions to be recorded in quick succession, by not immediately incurring the overhead of displaying the viewers for each session. To enter Batch Mode, select the <em>Sampling→Batch Mode</em>menu item (or <em>Command-Shift-B</em>).</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW21" title="Figure 5-3Batch Mode"></a><p><strong>Figure 5-3&nbsp;&nbsp;</strong>Batch Mode</p><img src = "../Art/BatchMode.jpg" alt = "Shark in Batch Mode" ></div><br/><p>Batch mode is most useful when paired with remote control from within your application’s code, profiling multiple hot loops in quick succession, during a single program execution. Using a different session label for each loop, you can rapidly obtain multiple profiles for later investigation. See <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW4">“Performance Counter Spreadsheet Advanced Settings”</a></span> for information on using this technique.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW1" title="Windowed Time Facility (WTF)"></a><h2>Windowed Time Facility (WTF)</h2><p>For measuring hard to repeat scenarios, Shark provides the Windowed Time Facility (abbreviated as <em>WTF</em>) with the Time Profile and System Trace configurations. The Windowed Time Facility directs Shark to only record and process a finite buffer of the most recently acquired samples, allowing it to run <em>continuously</em> for long periods of time in the background. This continuous behavior allows you to stop profiling just <em>after</em> something interesting occurs. At this point, Shark processes the samples in the <em>window</em> of time just before profiling was terminated. This allows you to determine what part of your program’s execution is “interesting” <em>after</em> it occurs, instead of trying to anticipate it in advance. Now, you effectively have the benefit of hindsight for finding hard to repeat problems.</p><p>Another way of describing how WTF mode works is how it modifies Shark’s normal “start” and “stop” behavior. Generally, Shark processes <em>all</em> the data between the “start” and “stop” trigger events, as is shown in <span class="content_text">Figure 5-4</span>. Most commonly, users start Shark just before entering an “interesting” period of execution and stop it when leaving the area of interest. However, you may not always know when you will encounter the “interesting” region of your program in advance. WTF mode sidesteps this problem by eliminating the need to “start” normally. While Shark stops in the normal way, as we show in <span class="content_text">Figure 5-5</span>, the starting position is just a fixed number of samples (or effectively amount of time, with Time Profiling) before the end, instead of at a user-specified point.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW10" title="Figure 5-4Normal Profiling Workflow"></a><p><strong>Figure 5-4&nbsp;&nbsp;</strong>Normal Profiling Workflow</p><img src = "../Art/WTFNormalFlow.jpg" alt = "Shark's normal profiling workflow: press start, press stop, profile everything inbetween." ></div><br/><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW11" title="Figure 5-5Windowed Time Facility Workflow"></a><p><strong>Figure 5-5&nbsp;&nbsp;</strong>Windowed Time Facility Workflow</p><img src = "../Art/WTFNewFlow.jpg" alt = "Shark's Windowed Time facility allows you to profile continuously, pressing stop after the &quot;interesting&quot; event happens." ></div><br/><p>Tracing the execution around an asynchronous event, such as inter-thread communication, the arrival of a network packet, or OS event such as a page fault, are all situations when WTF mode can make profiling easier, especially when these “glitches” occur at hard-to-predict times.</p><p>This mode of profiling is especially useful for game programming; often, the timing of calls to performance-critical code regions is highly dependent upon a player’s actions, which can be hard to reproduce. For example, assume you are developing a video game engine and occasionally see the frame rate drop and/or video glitches. If the conditions for causing the glitch are unpredictable and inconsistent, then you would normally have to start sampling, attempt to reproduce the problem, and then stop sampling afterwards. If the glitch is rare, then odds will be low that you will catch the glitch within the limited sampling window, creating an extremely frustrating workflow. With WTF mode, in contrast, you can just start Shark and forget about it — until the glitch actually occurs, when a quick press of the “stop” button will capture the sequence of samples involving the glitch.</p><p>WTF mode can be enabled in several different ways. In order of increasing complexity, it can be turned on through any of the following three options:</p><ul class="ul"><li class="li"><p>You can select the <em>Time Profile</em> and <em>System Trace</em> configurations with “WTF” included in the name from the Configuration popup (see <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW4">“Main Window”</a></span>).</p></li><li class="li"><p>WTF is an option for the “normal” <em>Time Profile</em> and <em>System Trace</em> configurations which may be enabled by checking the “WTF Mode” check boxes in the mini-configuration editors associated with these configurations (see <span class="content_text"><a href="../TimeProfiling/TimeProfiling.html#//apple_ref/doc/uid/TP40005233-CH3-SW23">“Taking a Time Profile”</a></span> and <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW26">“Basic Usage”</a></span>).</p></li><li class="li"><p>You may include this option in your own configurations that use the “Timed Samples &amp; Counters” or “System Trace” data source plugins (see <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW12">“Simple Timed Samples and Counters Config Editor”</a></span> and <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW19">“System Trace Data Source PlugIn Editor”</a></span>).</p></li></ul><p>In addition, WTF mode works perfectly well with <em>all</em> of the different ways to effectively press “start” and “stop” described in this chapter. For example, instead of manually pressing “stop” at the end of your WTF region, you might have code in your program detect “glitch” conditions and programmatically fire a “stop” signal using the techniques described in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW16">“Programmatic Control.”</a></span></p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW22" title="WTF with System Trace"></a><h3>WTF with System Trace</h3><p>In most ways, WTF mode functions exactly the same when used with both the Time Profile and System Trace configurations. However, there are two notable differences.</p><p>First, since System Trace is event-driven, and not time interval-driven, the “window” is actually a fixed number of <em>system events</em> per processor, and not a fixed window of time. Therefore, the actual period of time represented by the window is highly dependent on the rate that system events occur for each processor. If these events occur very rapidly, the window might be quite short in time; if these events occur infrequently, the window might represent a long interval.</p><p>Second, the beginning of a WTF System Trace Timeline (see <span class="content_text">Figure 5-6</span>) can appear a bit strange; different processors might first appear at vastly different points in the timeline. In the figure below, the timeline for the processor at (1) begins well before the other three processor timelines at (2). This occurs because each processor maintains its own “window” of samples, and system events can occur at vastly different rates on each processor. As a result, each processor’s window of samples can correspond to different periods of time. Since all processors’ timelines end at the same time, the effect of this is that some processors won’t show up in the timeline until much later than other processors.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW14" title="Figure 5-6The Windowed Time Facility Timeline"></a><p><strong>Figure 5-6&nbsp;&nbsp;</strong>The Windowed Time Facility Timeline</p><img src = "../Art/WTFTimeLine.jpg" alt = "A Timeline showing multiple processors starting at different points in time" ></div><br/><a name="//apple_ref/doc/uid/TP40005233-CH13-SW20" title="Unresponsive Application Measurements"></a><h2>Unresponsive Application Measurements</h2><p>During the development process, there may come a point where your application goes unresponsive, and the dreaded spinning rainbow cursor is displayed (<img src = "../Art/SPOD.jpg" alt = "Spinning beachball mouse cursor" >). Often, the situations in which this happens can be hard to repeat. For these situations, Shark provides <em>Unresponsive Application</em> Triggering, allowing you to automatically sample whenever an application becomes unresponsive. This method of triggering is enabled by selecting the <em>Sampling</em>→<em>Unresponsive Applications</em> menu item (<em>Command-Shift-A</em>). When Unresponsive Application Triggering is enabled, Shark will automatically switch to Batch Mode and display unresponsive application triggering options, as shown below.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW5" title="Figure 5-7Unresponsive Application Triggering"></a><p><strong>Figure 5-7&nbsp;&nbsp;</strong>Unresponsive Application Triggering</p><img src = "../Art/UnresponsiveApp.jpg" alt = "Unresponsive Application Triggering" ></div><br/><p>Unresponsive application profiling can be limited to a single application by setting the <em>Application Name Filter</em> check box and filling in a name or partial name in the associated text field. The threshold for the amount of time an application is unresponsive (does not respond to mouse or keyboard events) can be set by entering a value (in seconds) in the <em>Unresponsive Time Threshold</em> text field. With this, you can eliminate sampling of expected, brief bits of unresponsive time and focus instead on the really long and painful occurrences.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005233-CH13-DontLinkElementID_11" title="Note"></a><p><strong>Note:</strong>&nbsp;The <em>Unresponsive Time Threshold</em> value modifies the system-wide definition of what an “unresponsive application” actually is, and will consequently change the amount of time from the last time the application was responsive to the first time that the system presents the spinning rainbow cursor for it.</p></div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW23" title="Command Line Shark"></a><h2>Command Line Shark</h2><p>In some situations, such as profiling on headless servers, it is not possible to use the graphical user interface at all. For these cases, use <code>/usr/bin/shark</code>. Command line <code>shark</code> supports the major features of its graphical counterpart for data collection, but does not do much with the recorded data beyond saving sessions. In general, it is intended that you use it to collect sessions and then review your results with a graphical copy of Shark later. This section will discuss some common ways to use command line <code>shark</code>. A more complete description of the options available when using command line <code>shark</code> is available in its man page, <code>shark(1)</code>.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW24" title="Basic Methodology"></a><h3>Basic Methodology</h3><p>There are four main ways to use command-line <code>shark</code>. With the exception of network mode, which can run along with interactive and remote modes, any one invocation of <code>shark</code> is locked into using only one of these modes for its entire duration.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW25" title="Interactive Mode"></a><h4>Interactive Mode</h4><p>By default, command-line <code>shark</code> works in a simple interactive mode. After starting up, it records sessions on demand through a simple, three-step process:</p><ol class="ol"><li class="li"><p><code>shark</code> waits in the background until it spots a “hot key” press, and then it starts sampling. On your local system, the hot key same as graphical Shark (<em>Option-Escape</em>, by default), while on remote terminals it defaults to <em>Control-\</em>, since this key combination can be transmitted through a generic terminal.</p></li><li class="li"><p>When you press the same “hot key” again, <code>shark</code> will stop sampling and begin analyzing its samples to produce a standard Shark session file. It displays progress as this occurs, and then writes out the session file to disk, using the name <code>session_XX.mshark</code> (XX = a number) and the current terminal directory by default. When complete, shark waits for another “hot key” press.</p></li><li class="li"><p>If you press <em>Control-c</em> instead of a “hot key,” then <code>shark</code> will terminate and return you to the shell prompt.</p></li></ol><p>After <code>shark</code> completes, you will have a sequence of Shark session files that you may then examine at your leisure with graphical Shark. Of course, there are many ways to modify this basic methodology, described in the next few sections.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW26" title="Immediate Mode"></a><h4>Immediate Mode</h4><p>Command line <code>shark</code> also supports <em>immediate</em> mode, where it starts sampling immediately after it is launched with no user interaction, and quits after it finishes profiling — usually after 30 seconds, or when the user presses <em>Control-C</em>. This is often useful for invocation from shell scripts. To launch <code>shark</code> in this mode, use the <code>-i</code> option, as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -i<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW3" title="Remote Mode"></a><h4>Remote Mode</h4><p>A third way to use command line <code>shark</code> is <em>remote</em> mode, which works much like the remote mode supported by graphical Shark and described in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW17">“Interprocess Remote Control.”</a></span> Once started in this mode, <code>shark</code> will wait for start/stop signals from other processes to arrive in any one of three ways:</p><ol class="ol"><li class="li"><p>A program instrumented with <code>chudStartRemotePerfMonitor()</code> and <code>chudStopRemotePerfMonitor()</code> calls can start and stop <code>shark</code>, respectively. This works the same as the equivalent functionality described in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW16">“Programmatic Control.”</a></span></p></li><li class="li"><p>The utility program <code>chudRemoteCtrl</code> can start and stop <code>shark</code>. This works the same as the equivalent functionality described in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW18">“Command Line Remote Control.”</a></span></p></li><li class="li"><p>The UNIX <code>SIGUSR1</code> and <code>SIGUSR2</code> signals can be sent to <code>shark</code>’s PID by your program or the UNIX <code>kill</code> utility with the “<code>-s USR1</code>” and “<code>-s USR2</code>” options. It will interpret <code>SIGUSR1</code> as a start/stop toggle and <code>SIGUSR2</code> as a command to stop sampling and generate a session.</p></li></ol><p>To launch <code>shark</code> in this mode, use the <code>-r</code> option, as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -r<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW27" title="Network Mode"></a><h4>Network Mode</h4><p>Finally, command line <code>shark</code> supports <em>network</em> mode, where it is controlled remotely by graphical Shark running on another computer. When enabled, <code>shark</code> starts up in interactive (or remote) mode, and works normally that way. However, it also listens for network connections from graphical Shark running on different Macintoshes. You can then use a combination of local start/stop operations and network start/stop operations while <code>shark</code> is running. To launch <code>shark</code> in this mode, use the <code>-N</code> option, as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -N<span></span></pre></td></tr></table></div><p>A full description of network shark usage is in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW19">“Network/iPhone Profiling.”</a></span></p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW28" title="Common Options"></a><h3>Common Options</h3><p>Many of Shark’s configurations, such as <em>Time Profile</em> and <em>System Trace</em>, support common options such as time and sample limits. Command line <code>shark</code> allows you to change these limits for configurations that support them. These common options include:</p><ul class="spaceabove"><li class="li"><p><em>Time Limit</em>— <code>shark -T</code> allows you to change the time limit. Valid times are any integer followed by “u,” “m,” or “s,” corresponding to microseconds, milliseconds, and seconds, respectively.</p></li><li class="li"><p><em>Time Interval</em> — <code>shark -I</code> allows you to change the sampling interval for configurations that support a sampling interval. Valid times are entered the same way as for time limits.</p></li><li class="li"><p><em>Sample Limit</em> — <code>shark -S</code> allows you to specify the maximum number of samples to record during each session.</p></li></ul><p>Some other, less commonly used options change the behavior of <code>shark</code>:</p><ul class="spaceabove"><li class="li"><p><em>Quiet Mode</em>— <code>shark -q</code> will limit terminal output to reporting of errors only.</p></li><li class="li"><p><em>Ignore task exits</em>— <code>shark -x</code> will instruct shark to ignore task exit notifications. Normally, shark gets notified when tasks are about to exit while it is profiling. This allows shark to collect some basic information about the task just before it is allowed to quit. It is possible, though not likely, that this can cause gaps in profiling. Use of this option is discouraged. This is equivalent to the use of the similarly named preference in <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW5">“Shark Preferences.”</a></span></p></li><li class="li"><p><em>Change default filename</em>— <code>shark -o</code> allows you to change the default session file name from <code>session_XX.mshark</code> to a user supplied name. This name will be appended with a unique number to create a unique file name. For example, <code>shark -o myfile</code> will result in session files names <code>myfile_01.mshark</code>, <code>myfile_02.mshark</code>, and so on.</p></li><li class="li"><p><em>Change session file path</em>— <code>shark -d</code> allows you to specify the directory where shark will save session files, instead of the current working directory.</p></li></ul><a name="//apple_ref/doc/uid/TP40005233-CH13-SW29" title="Target Selection"></a><h3>Target Selection</h3><p>With command line <code>shark</code>, you can choose to launch and attach <code>shark</code> to a process, or attach <code>shark</code> to a currently running process, using options similar to the ones described previously in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW12">“Process Attach”</a></span> and <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW13">“Process Launch”</a></span> for graphical Shark. To launch a process, simply append the process invocation as you normally would to the end of the shark command line. The following example would launch <code>/bin/ls ~/Documents</code>, and start <code>shark</code> profiling immediately:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -i /bin/ls ~/Documents<span></span></pre></td></tr></table></div><p>Instead, if you wanted to attach to a running <em>Apache</em> daemon process, you might try this line:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -i -a [pid of httpd]<span></span></pre></td></tr></table></div><p>Making things even simpler, if you do not know the PID of the process in which you are interested, you can specify a full or partial name as the argument to the <code>-a</code> option. If there are multiple matches to a partial name, Shark will take its best guess. For these situations, it is often best to supply a PID instead.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW30" title="Reports"></a><h3>Reports</h3><p>Command line shark supports generation of textual reports, either from session files that you’ve already created, or from new sessions as they are generated. These reports can be simple summaries (<code>-g</code> or <code>-G</code> options), or complete analysis reports (<code>-t</code> option). </p><p>When creating a summary report, you can either create one from a session that is already saved on disk, with <code>shark -g</code>, or create it for new sessions, with <code>shark -G</code>. Both options result in the creation of a sidecar file, whose name will be the original session file name with <code>-report.txt</code> appended.</p><p>Creating a full analysis, either from previously saved sessions, or for any new sessions, requires passing the <code>-t</code> flag to <code>shark</code>. The <code>-t</code> flag optionally takes a filename as an argument. If no file name is specified, <code>shark</code> will allow you to take sessions as normal, except it will write one additional file per session — the full analysis report. If you specify a file name, <code>shark</code> will instead only generate the full analysis report sidecar file, and immediately quit. In both cases, the report filename will be the session file name, with <code>-full.txt</code> appended.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW31" title="Custom Configurations"></a><h3>Custom Configurations</h3><p>Because of its command line nature, <code>shark</code> can only operate on configurations already created by its graphical counter-part as discussed in <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW1">“Custom Configurations.”</a></span> To use a custom configuration on a headless server, export it from Shark by opening the Configuration Editor, selecting the desired Configuration, and clicking the “Export...” button in the Configuration Editor (as described in <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW13">“The Config Editor”</a></span>). Copy the resulting <code>.cfg</code> file to <code>~/Library/Application Support/Shark/Configs</code> on the target machine so that command-line <code>shark</code> can find it.</p><p>Running <code>shark -l</code> will list all installed configurations, including any custom configurations (which will be near the bottom of the list). Using a capital <code>-L</code> instead will additionally list a short summary of what each configuration does, what plugins are active with each one, and their settings.</p><p>Instruct <code>shark</code> to use your custom config by passing its corresponding number to the <code>-c</code> argument. For example, if your new configuration was listed as number 13, you might use the following command line to load that configuration into command line <code>shark</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -c 13<span></span></pre></td></tr></table></div><p>Alternatively, you can specify the configuration file to use directly, using <code>-m</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>shark -m custom.cfg<span></span></pre></td></tr></table></div><p>For more information on creating and using custom profiling configurations, see <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW1">“Custom Configurations.”</a></span></p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW32" title="More Information"></a><h3>More Information</h3><p>This section has presented some of the most common options and techniques for using command-line <code>shark</code>. For more detailed information on all available options, please read the man page: <code>shark(1)</code>.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW17" title="Interprocess Remote Control"></a><h2>Interprocess Remote Control</h2><p>In some cases, it is best to have your programs start and stop Shark’s sampling at precisely chosen points in their execution. Shark supports two major forms of start/stop “remote control” from other processes: <em>programmatic control</em> allows you to insert code directly into your application to start and stop profiling, while command line remote control allows you to insert commands in your <code>perl</code> or shell scripts to start and stop profiling. In order for a remote client to activate Shark, Shark must first be placed in remote mode using the <em>Shark</em>→<em>Sampling</em>→<em>Programmatic</em> (<em>Remote</em>) menu item. Similarly, you can use <code>shark -r</code> to start command line <code>shark</code> in remote mode (as mentioned in <span class="content_text"><a href="SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW3">“Remote Mode”</a></span>).</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW16" title="Programmatic Control"></a><h3>Programmatic Control</h3><p>It may be useful to narrow down what is profiled by Shark to a particular section of code within your application. You can start and stop sampling from within your application’s code by calling the <code>chudStartRemotePerfMonitor()</code> and <code>chudStopRemotePerfMonitor()</code> functions, defined in the <code>CHUD.framework</code>. This can be accomplished in one of two ways:</p><ol class="ol"><li class="li"><p><em>Remote Profiling</em>— instrument your code with calls to <code>chudStartRemotePerfMonitor()</code>/ <code>chudStopRemotePerfMonitor()</code>. Shark should then be placed in remote monitoring mode via the <em>Sampling</em>➝<em>Programmatic (Remote)</em> menu item (<em>Command-Shift-R</em>) before running your instrumented program. For every pair of start/stop calls, Shark will create a new sampling session. This can be especially useful with <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW2">“Adding Shortcut Equations.”</a></span></p></li><li class="li"><p><em>Thread Marking</em>— When using Hardware Performance Counters on a PowerPC machine, as discussed in <span class="content_text"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html#//apple_ref/doc/uid/TP40005233-CH10-SW1">“Hardware Counter Configuration,”</a></span> you can use <code>chudMarkPID()</code> to mark your process or <code>chudMarkCurrentThread()</code> to mark the current thread around your critical sections of code. If you configure Shark to sample only marked performance events, only code in the critical sections will be profiled.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005233-CH13-DontLinkElementID_12" title="Note"></a><p><strong>Note:</strong>&nbsp;Currently, Intel machines do not support process or thread marking for performance monitoring. Consequently, this technique is only useful for PowerPC machines.</p></div></li></ol><p>It is important to keep in mind that many profiling techniques used by Shark employ statistical sampling in order to generate a profile. If the sampling interval is longer than the time it takes to execute the instrumented section of code, you may see few or no samples in the resulting profile. Statistical sampling is most useful when at least several hundred samples are taken.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW33" title="Example: Towers of Hanoi"></a><h4>Example: Towers of Hanoi</h4><p>We will use the Towers of Hanoi puzzle as an example of controlling Shark from within source code. The French mathematician Edouard Lucas invented the Towers of Hanoi puzzle in 1883 . The puzzle begins with a tower of N disks, initially stacked in decreasing size on one of three pegs. The goal is to transfer the entire tower to one of the other pegs, moving only one disk at a time and never a larger one onto a smaller one. A common solution to the Towers of Hanoi problem is a recursive algorithm (see <span class="content_text">Listing 5-1</span>, below).</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW34" title="Listing 5-1Towers of Hanoi Source Code"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Towers of Hanoi Source Code</p><div class="codesample"><table><tr><td scope="row"><pre>/* This functions takes a tower of n disks and moves from peg   */<span></span></pre></td></tr><tr><td scope="row"><pre>/* 'source' to peg 'destination'.  Peg 'temp' may be used       */<span></span></pre></td></tr><tr><td scope="row"><pre>/* temporarily.                                                 */<span></span></pre></td></tr><tr><td scope="row"><pre>void Hanoi(char source, char temp, char destination, int n){<span></span></pre></td></tr><tr><td scope="row"><pre>   if(n>0) {<span></span></pre></td></tr><tr><td scope="row"><pre>      Hanoi (source, destination, temp, n-1);<span></span></pre></td></tr><tr><td scope="row"><pre>      Hanoi (temp, source, destination, n-1);<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>As a demonstration of source code instrumentation, we insert calls to start and stop Shark into the Towers of Hanoi test program (see <span class="content_text">Listing 5-2</span>, below). Shark is then placed in <em>Remote Monitoring</em> mode and set to use the standard <em>Time Profile</em> configuration. The test program is run for N=10..20 disks. Shark records a session for each pair of start and stop calls.</p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW35" title="Listing 5-2Instrumented Towers of Hanoi"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>Instrumented Towers of Hanoi</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;CHUD/CHUD.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   chudInitialize();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   chudAcquireRemoteAccess();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for(i=n_min; i&lt;=n_max; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>      sprintf(label_str, "Hanoi #%d", i);<span></span></pre></td></tr><tr><td scope="row"><pre>      chudStartRemotePerfMonitor(label_str);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      Hanoi('A','B','C',i);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      chudStopRemotePerfMonitor();<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   chudReleaseRemoteAccess();<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40005233-CH13-DontLinkElementID_13" title="Note"></a><p><strong>Note:</strong>&nbsp;To compile this example program, you must instruct <code>gcc</code> to link with the CHUD framework:</p><div class="codesample"><table><tr><td scope="row"><pre>gcc -framework CHUD -F/System/Library/PrivateFrameworks towersOfHanoi.c<span></span></pre></td></tr></table></div></div><p>The Towers of Hanoi test program demonstrates the need for a sampling interval that is much shorter than the time between the calls to start and stop Shark (see <span class="content_text">Figure 5-8</span>). Less than 100 samples are taken unless the problem size is at least 15 disks. As a result, you will often find that it is better to sample your entire application and use Shark’s powerful <span class="content_text"><a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html#//apple_ref/doc/uid/TP40005233-CH7-SW1">“Data Mining”</a></span> mechanisms to narrow down what is displayed after sampling.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW36" title="Figure 5-8Samples Taken for Towers of Hanoi N=10..20"></a><p><strong>Figure 5-8&nbsp;&nbsp;</strong>Samples Taken for Towers of Hanoi N=10..20</p><img src = "../Art/HanoiGraph.jpg" alt = "Samples Taken for Towers of Hanoi N=10..20" ></div><br/><a name="//apple_ref/doc/uid/TP40005233-CH13-SW18" title="Command Line Remote Control"></a><h3>Command Line Remote Control</h3><p>You can also start sampling remotely through the command-line using the  <code>chudRemoteCtrl</code> command-line tool. Again, in order for remote clients to activate Shark, Shark must first be placed in remote mode using the <em>Shark</em>→<em>Sampling</em>→<em>Programmatic</em> (<em>Remote</em>) menu item. </p><p>To start profiling from within your shell scripts (or by hand), issue the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>chudRemoteCtrl -s MySessionLabel<span></span></pre></td></tr></table></div><p>The argument to <code>-s</code>, above, is an arbitrary, user-specified label that will be applied to the generated session. To stop profiling, issue the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>chudRemoteCtrl -e<span></span></pre></td></tr></table></div><p>When used to stop profiling, <code>chudRemoteCtrl</code> will not return until Shark has stopped profiling. In the case of command-line <code>shark</code>, <code>chudRemoteCtrl</code> will not exit until the session file is written to disk. More information on chudRemoteCtrl is available from its man page, <code>chudRemoteCtrl(1)</code>. </p><a name="//apple_ref/doc/uid/TP40005233-CH13-SW19" title="Network/iPhone Profiling"></a><h2>Network/iPhone Profiling</h2><p>Shark allows you to share computers for profiling over a network and to discover other computers sharing their copies of Shark using <em>Bonjour</em> or manual IP address entry. This allows you to record profiles on two separate Macs on your desk (good for fullscreen application profiling), Macs in another room (useful when you are profiling servers), or even Macs halfway around the world (for travelers).</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005233-CH13-DontLinkElementID_14" title="Note"></a><p><strong>Note:</strong>&nbsp;Because of changes required to add iPhone OS support to Shark 4.6, the networking protocol software changed between versions 4.5 and 4.6 of Shark. As a result, you cannot control computers running versions of Shark 4.5 or earlier from a machine running 4.6 or later, and vice-versa. Hence, it is a good idea to keep copies of Shark that may be communicating with each other remotely synchronized to the same version.</p></div><p>In addition, the same user interface can be used to control Shark running on any iPhone (or other device that runs the iPhone OS, such as the iPod Touch). Shark is included by default in the iPhone OS developer tools, so once they are installed onto your device it can be controlled by Shark running on any Mac simply by docking the device and attaching the dock to one of the Mac’s USB ports.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40005233-CH13-DontLinkElementID_15" title="Important:"></a><p><strong>Important:</strong>&nbsp;Shark cannot capture <em>symbol</em> information on the iPhone itself, so “raw” sessions recorded from an iPhone will appear in Shark labeled only based on sample address ranges. This can make it very difficult to understand the results that Shark returns. Instead, you must tell Shark to recover symbol information afterwards from a copy of your iPhone OS application which is stored locally on your Macintosh. As a result, anybody profiling an iPhone will definitely want to check out <span class="content_text"><a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html#//apple_ref/doc/uid/TP40005233-CH7-SW3">“Manual Session Symbolication”</a></span> for more information about how to tell Shark where your application’s symbols are located.</p><p></p></div><p>To use Network Profiling, select the <em>Shark</em>→<em>Sampling</em>→<em>Network/iPhone Profiling...</em> menu item (<em>Command-Shift-N</em>), and the main window will expand to show the <em>Network/iPhone Manager</em> pane below the main controls, as shown in <span class="content_text">Figure 5-9</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW4" title="Figure 5-9Network/iPhone Manager"></a><p><strong>Figure 5-9&nbsp;&nbsp;</strong>Network/iPhone Manager</p><img src = "../Art/NetworkControl.jpg" alt = "Network/iPhone Manager" ></div><br/><p>The controls in this window are described below:</p><ol class="ol"><li class="li"><p><strong>Modes of Operation</strong>— Choose the overall network operation mode here:</p><ul class="ul"><li class="li"><p><em>Profile this computer</em>— Profile the system that is running this instance of Shark; this is the “normal” way of running Shark, and effectively disables Network/iPhone Mode.</p></li><li class="li"><p><em>Share this computer for network profiling</em>— Shark will advertise itself as a shared profiling service to networked computers. In this shared profiling mode, the user interface for starting and stopping profiling on the local machine is disabled.</p></li><li class="li"><p><em>Control network profiling of shared computers</em>— Any computers on the network (in the local domain) running Shark in “shared” network mode will automatically be listed as available for control by this instance of Shark. In addition, all iPhone OS devices in docks attached directly to this computer will also appear as “shared computers” if they have Shark installed (because it cannot be controlled directly on the device, Shark is automatically started in “shared” mode on these devices when necessary). In “Control” mode, clicking on Shark’s <em>Start</em> button triggers profiling on the selected shared computer(s). “Distant” computers that are outside of the local network domain can be added to the list of controlled computers by entering the computer’s network name in the field below the shared computer table and clicking the Add (+) button.</p></li></ul></li><li class="li"><p><strong>Control All Computers checkbox</strong>— When selected, <em>all</em> of the currently listed shared computers will be automatically selected for control. Any new computers that become available in the list (either by Bonjour auto-discovery or by being manually added by name to the table) will be automatically selected for control, as well. All computers will start and stop sampling together, at approximately the same time. Additionally, changing the config or target of <em>any</em> shared computer causes all the controlled computers’ settings to change to the same setting, if it is available. This option is very useful when you are attempting to control a large cluster of identical computers.</p></li><li class="li"><p><strong>Auto Download checkbox</strong>— When selected, the shared computers controlled by this copy of Shark will automatically deliver sessions to the the controller. The name of the system that generated each session is included in the title of each session document window. Otherwise, the sessions will be saved locally on the controlled machines for later download. This can be a better policy if you are taking many sessions in quick succession, and network bandwidth becomes a limiting factor or impacts your measurements adversely.</p></li><li class="li"><p><strong>Computer table</strong>— This is the list of all the Macs running the Shark application in shared profiling mode and attached iPhone OS devices. These computers can be selected for profiling control by this Shark application. Columns are discussed in the order they are presented onscreen, left-to-right:</p><ul class="ul"><li class="li"><p><em>Use</em>— Toggles whether or not to control Shark on a shared computer.</p></li><li class="li"><p><em>Computer</em>— The name of each shared computer</p></li><li class="li"><p><em>Status</em>— This shows the current “state” of Shark running on the remote system. There are several different possible states of a shared computer running Shark in network mode:</p><ul class="nested"><li class="nested li"><p>Unknown (–?–): Computer is not connected.</p></li><li class="nested li"><p>Ready (–R–): Shark can start sampling.</p></li><li class="nested li"><p>Sampling (–S–): Shark is actively collecting profile data.</p></li><li class="nested li"><p>Processing (–P–): Shark is creating a profile session.</p></li><li class="nested li"><p>Transmitting (–T–): The new session is being sent.</p></li></ul></li><li class="li"><p><em>Config</em>— The currently active <em>Sampling Configuration</em> on the shared computer. The entries in this column are menus, just like the one in Shark’s main window (see <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW4">“Main Window”</a></span>). The selected configuration on the remote shared computer can be changed by changing the selection in the menu</p></li><li class="li"><p><em>Target</em>— The currently active <em>Profiling Target</em> on the shared computer. The entries in this column are menus, just like the one in Shark’s main window (see<span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW4">“Main Window”</a></span>). The targeted process (if any) on the remote shared computer can be changed by changing the selection in the menu.</p></li><li class="li"><p><em>Cached Sessions (not pictured)</em>— This column is only visible if “Auto Download” is not active. It lists the number of complete profile sessions cached on each shared computer, and waiting for download to the controlling system.
</p></li></ul></li><li class="li"><p><strong>Refresh button</strong>— Click this button to clear the table and search for shared computers and attached iPhone OS devices again. Computers that you have added by hand will not be cleared from the list when you refresh.</p></li><li class="li"><p><strong>Add Computer button and Name field</strong>— Pressing this button attempts to add the computer with the name or IP address entered into the computer name field to the list of shared computers. The specified computer must be attached to the network and running Shark in shared profiling mode, or this will fail.</p></li><li class="li"><p><strong>Download One and Download All buttons</strong>— If the <em>Auto Download</em> checkbox is not selected, then computers that are being controlled across the network will cache the session files they generate for later download rather than sending them immediately to the controlling Shark application. The number of sessions available to download is listed in the Shared Computer table’s <em>Cached Sessions</em> column. Clicking the <em>Download One</em> button will download a single session, while clicking the Download All button will download all available sessions. Sessions are always retrieved in the order that they were created.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH13-SW37" title="Using Shared Profiling Mode"></a><h3>Using Shared Profiling Mode</h3><p>Although the graphical Shark application can be placed in “Share this computer” mode, it is more typical to use command line <code>shark</code> on any remote, shared computers. You can use <code>ssh(1)</code> to connect to a remote computer. Once connected, launch command line <code>shark</code> with the <code>–N</code> option. The remote run of <code>shark</code> will then respond to network requests to start and stop profiling. A sample transcript of a remote command line shark in “Network Sharing” mode is shown in <span class="content_text">Figure 5-10</span>. For more information on the usage and configuration of command line <code>shark</code>, see <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW7">“Timed Counters: The Performance Counter Spreadsheet.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW38" title="Figure 5-10Command Line Shark in Network Profiling Mode"></a><p><strong>Figure 5-10&nbsp;&nbsp;</strong>Command Line Shark in Network Profiling Mode</p><img src = "../Art/NetworkTranscript.jpg" alt = "Command Line Shark in Network Profiling Mode" ></div><br/><a name="//apple_ref/doc/uid/TP40005233-CH13-SW39" title="Mac OS X Firewall Considerations"></a><h3>Mac OS X Firewall Considerations</h3><p>The sharing firewall on Mac OS X can prevent Shark’s network profiling from working in either sharing or control mode. When the Shark Network Manager successfully opens a network connection, the communication port number Shark is using is listed in brackets. This is normally port number 7475. Unfortunately, this port is not “open” through the firewall by default. If you attempt to enter “Shared Profiling” or “Network Control” mode while the firewall is enabled, you will be presented with a warning dialog, as illustrated in <span class="content_text">Figure 5-11</span></p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW7" title="Figure 5-11Sharing Firewall Warning Dialog"></a><p><strong>Figure 5-11&nbsp;&nbsp;</strong>Sharing Firewall Warning Dialog</p><img src = "../Art/FirewallWarning.jpg" alt = "The Sharing Firewall Warning Dialog allows you to add a firewall rule for Shark profiling" ></div><br/><p>Click the <em>Sharing...</em> button in the warning dialog to bring up the <em>System Preferences</em> window <em>Sharing</em> tab. Otherwise click the <em>Ignore</em> button to dismiss the dialog, but note that doing so may result in the inability to use Shark over the network. Once in the <em>Sharing Preference</em> window of <em>System Preferences</em>, select the <em>Firewall</em> tab. If you have never before added settings for Shark, then click the <em>New…</em> button, and fill in the sheet as shown in <span class="content_text">Figure 5-12</span>, and click the <em>OK</em> button.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH13-SW8" title="Figure 5-12Firewall Sharing Preferences, while adding a new port range for Shark"></a><p><strong>Figure 5-12&nbsp;&nbsp;</strong>Firewall Sharing Preferences, while adding a new port range for Shark</p><img src = "../Art/AddPortRange.jpg" alt = "Sharing Preferences - Firewall Tab - Adding a New Port Range" ></div><br/>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-04-14<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>