<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Determining the Features of the File Manager (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING90></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-89.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-91.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-89.html"><B>Using the File Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING90-0></A>
<H2><A NAME=MARKER-9-325></A>Determining the Features of the File Manager</H2>
 <A NAME=MARKER-2-151></A>Some of the capabilities provided by the File Manager depend on the version of system software that is running, and some others depend on the characteristics of the target volume. For example, the routines that accept <CODE>FSSpec</CODE> records as file or directory specifications were introduced in system software version 7.0 and are unavailable in earlier system software versions--unless your software development system provides "glue" that allows you to call those routines when running in earlier system software versions (or unless some system extension provides those routines). Similarly, some volumes support features that other volumes do not; a volume that has local file <BR>sharing enabled, for instance, allows you to lock byte ranges in any files on a volume <BR>that is sharable.<P>
 Before using any of the File Manager features that are not universally available in all system software versions and on all volumes, you should check for that feature's availability by calling either the <CODE>Gestalt</CODE> function or the <CODE>PBHGetVolParms</CODE> function, according to whether the feature's presence depends on the system software or the characteristics of the volume.<P>
 You can use <CODE>Gestalt</CODE> to determine whether or not you can call the functions that accept and support <CODE>FSSpec</CODE> records. Call <CODE>Gestalt</CODE> with the <CODE>gestaltFSAttr</CODE> selector to check for File Manager features. The <CODE>response</CODE> parameter currently has two relevant bits:<P>
<PRE>
CONST
   gestaltFullExtFSDispatching   =  0;    {exports HFSDispatch traps}
   gestaltHasFSSpecCalls         =  1;    {supports FSSpec records}
</PRE>
<B><CODE>Constant descriptions</CODE></B><P>
<DL>
<DT><CODE>gestaltFullExtFSDispatching</CODE>
<DD> <BR>If set, all of the routines selected through the <CODE>_HFSDispatch</CODE> trap are available to external file systems. If this bit is clear, the File Manager checks the selector passed to <CODE>_HFSDispatch</CODE> and ensures that it is valid; if the selector is invalid, the result code <CODE>paramErr</CODE> is returned to the caller. If this bit is set, no such validity checking is performed.<A NAME=MARKER-2-152></A>
<DT><CODE>gestaltHasFSSpecCalls</CODE>
<DD> <BR>If set, the operating environment provides the file system specification versions of the basic file-manipulation functions, plus the <CODE>FSMakeFSSpec</CODE> function.<A NAME=MARKER-2-153></A>
</DL>
 The chapter "Introduction to File Management" in this book illustrates how to use the <CODE>Gestalt</CODE> function to determine whether the operating environment supports the routines that accept <CODE>FSSpec</CODE> records. For a complete description of the <CODE>Gestalt</CODE> function, see the chapter "Gestalt Manager" in <I><A HREF="../OSUtilities/OSUtilities-2.html">Inside Macintosh: Operating System Utilities</A></I>.<P>
 To test for the availability of the features that depend on the volume, you can call the low-level function <CODE>PBHGetVolParms</CODE>. <A HREF=#MARKER-9-329>Listing 2-1</A> illustrates how you can determine whether the <CODE>PBCatSearch</CODE> function is available before using it to search a volume's catalog. Note that the SupportsCatSearch function defined in <A HREF=#MARKER-9-329>Listing 2-1</A> first calls <CODE>Gestalt</CODE> to determine whether the File Manager supports <CODE>PBCatSearch</CODE>. If it does, the SupportsCatSearch function calls <CODE>PBHGetVolParms</CODE> to see if the indicated volume also supports <CODE>PBCatSearch</CODE>.<P>
<B>Listing 2-1  <A NAME=MARKER-9-329></A>Testing for <CODE>PBCatSearch</CODE></B><P>
<PRE>
FUNCTION SupportsCatSearch (vRefNum: Integer): Boolean;
VAR
   myHPB:         HParamBlockRec;
   infoBuffer:    GetVolParmsInfoBuffer;
   attrib:        LongInt;
BEGIN
   SupportsCatSearch := FALSE;   {assume no PBCatSearch support}
   IF gHasGestalt THEN           {set this somewhere else}
      IF Gestalt(gestaltFSAttr, attrib) = noErr THEN
         IF BTst(attrib, gestaltFullExtFSDispatching) THEN

            BEGIN                {this File Mgr has PBCatSearch}
               WITH myHPB DO
                  BEGIN
                     ioNamePtr := NIL;
                     ioVRefNum := vRefNum;
                     ioBuffer := @infoBuffer;
                     ioReqCount := SIZEOF(infoBuffer);
                  END;
               IF PBHGetVolParms(@myHPB, FALSE) = noErr THEN
                  IF BTST(infoBuffer.vMAttrib, bHasCatSearch) THEN
                     SupportsCatSearch := TRUE;
            END;
END;
</PRE>
 The <CODE>SupportsCatSearch</CODE> function calls <CODE>PBHGetVolParms</CODE> for the volume whose reference number is passed as a parameter to <CODE>SupportsCatSearch</CODE>. The <CODE>PBHGetVolParms</CODE> function returns information about a volume in a record of type <CODE>GetVolParmsInfoBuffer</CODE>. The <CODE>vMAttrib</CODE> field of that record contains a number of bits that encode information about the capabilities of the target volume. In particular, the bit <CODE>bHasCatSearch</CODE> is set if the specified volume supports the <CODE>PBCatSearch</CODE> function.<P>
<DL>
<DT><B>Note</B>
<DD>Some features of volumes might change dynamically during the execution of your application. For example, the user can turn File Sharing on and off, thereby changing the capabilities of volumes. See <A HREF=Files-98.html#MARKER-9-391>"Locking and Unlocking File Ranges" on page 2-50</A> for more details.<EM></EM><A NAME=MARKER-2-330></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-89.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-91.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
