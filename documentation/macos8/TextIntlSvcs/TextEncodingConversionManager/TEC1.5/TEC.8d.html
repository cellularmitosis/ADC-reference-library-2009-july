<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<script language="JavaScript" src="frametest.js"></script>
<TITLE> ConvertFromUnicodeToScriptCodeRun</TITLE><LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a>
<!-- start of header -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of header --><A HREF="TEC.88.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.8c.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.8e.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A><br>
<font face="Geneva,Helvetica,Arial" size="1"><b><br>
		PATH<spacer type="horizontal" size="5">&nbsp;</b></font><a href="../../../mac8.html"><font face="Geneva,Helvetica,Arial" size="1">Mac OS 8 and 9 Developer Documentation</a>  <b>&gt;</b> Text Encoding Conversion Manager<br>
		<img src="images/im_smblue.gif" width="116" height="8"><img src="images/space.gif" width="6" height="11">Programming With the Text Encoding Conversion Manager</font><br>
		<br>
		<hr>

</DIV>
<H1>
<A NAME="pgfId=7601">
 </A>
<A NAME="37389">
 </A>
ConvertFromUnicodeToScriptCodeRun</H1>
<P>
<A NAME="pgfId=10808">
 </A>
Converts a string from Unicode to one or more scripts. </P>
<TT>
<A NAME="pgfId=26587">
 </A>
pascal OSStatus ConvertFromUnicodeToScriptCodeRun (<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextRunInfo iUnicodeToTextInfo,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iUnicodeLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConstUniCharArrayPtr iUnicodeStr,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptionBits iControlFlags,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount iOffsetCount,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset iOffsetArray[],<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount *oOffsetCount,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset oOffsetArray[],<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iOutputBufLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oInputRead,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oOutputLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogicalAddress oOutputStr,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount iScriptRunBufLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount *oScriptRunOut</TT>
<DL COMPACT>
<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26591">
 </A>
<TT>iUnicodeToTextInfo</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10830">
 </A>
 	You use the function <A HREF="TEC.8b.html" CLASS="XRef"><TT>CreateUnicodeToTextRunInfoByScriptCode</TT></A> to obtain a Unicode converter object to specify for this parameter. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26604">
 </A>
<TT>iUnicodeLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10747">
 </A>
The length in bytes of the Unicode string to be converted. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26613">
 </A>
<TT>iUnicodeStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10748">
 </A>
A pointer to the Unicode string to be converted.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26622">
 </A>
<TT>iControlFlags</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10749">
 </A>
Conversion control flags. The following constants define the masks for control flags valid for this parameter. You can use these masks to set the <TT>iControlFlags</TT> parameter: </DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10865">
 </A>
<TT>kUnicodeUseFallbacksBit kUnicodeKeepInfoBit kUnicodeVerticalFormBit kUnicodeLooseMappingsBit kUnicodeStringUnterminatedBit kUnicodeTextRunBit kUnicodeKeepSameEncodingBit kUnicodeForceASCIIRangeMask kUnicodeNoHalfwidthCharsMask kUnicodeTextRunHeuristicsMask</TT>  You can also set one of the following directionality masks:  			 <TT>kUnicodeDefaultDirection</TT> 	 	<TT>kUnicodeLeftToRightBit</TT> 		 <TT>kUnicodeRightToLeft</TT></DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=14598">
 </A>
For a description of these control flags, see <A HREF="TEC.6d.html" CLASS="XRef">
Conversion Control Flags</A>
. </DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10962">
 </A>
	If the text-run control flag is clear, <TT>ConvertFromUnicodeToScriptCodeRun</TT> attempts to convert the Unicode text to the single script from the list of scripts in the Unicode converter object that produces the best result, that is, that provides for the greatest amount of source text conversion. If the complete source text can be converted into more than one of the scripts specified in the array, then the converter chooses among them based on their order in the array. If this flag is clear, the <TT>oScriptCodeRuns</TT> parameter always points to a value equal to 1. </DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10963">
 </A>
If you set the use-fallbacks control flag, the converter uses the default fallback characters for the current script. If the converter cannot handle a character using the current encoding, even using fallbacks, the converter attempts to convert the character using the other scripts, beginning with the first one specified in the list and skipping the one where it failed. </DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10964">
 </A>
If you set the <TT>kUnicodeTextRunBit</TT> control flag, the converter attempts to convert the complete Unicode text string into the first script specified in the Unicode mapping structures array you passed to <TT>CreateUnicodeToTextRunInfo</TT>, <TT>CreateUnicodeToTextRunInfoByEncoding</TT>, or <TT>CreateUnicodeToTextRunInfoByScriptCode</TT> to create the Unicode converter object used for this conversion. If it cannot do this, the converter then attempts to convert the first text element that failed to the remaining scripts, in their specified order in the array. What the converter does with the next text element depends on the setting of the keep-same-encoding control flag: </DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10761">
 </A>
If the keep-same-encoding control flag is clear and the text-run heuristics control flags is clear, the converter returns to the original encoding and attempts to continue conversion with that encoding; this is equivalent to converting each text element to the first encoding that works, in the order specified. If the text-run heuristics control flags is set, the converter does not return to the original encoding for common characters such as space and punctuation that are present in most encodings and shared by many writing systems.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=10762">
 </A>
If the Unicode-keep-same-encoding control flag is set, the converter continues with the new destination script until it encounters a text element that cannot be converted using the new script. This attempts to minimize the number of script code changes in the output text. When the converter cannot convert a text element using any of the scripts in the list and the Unicode-keep-same-encoding control flag is set, the converter uses the fallbacks default characters for the current script.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26687">
 </A>
<TT>iOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=14715">
 </A>
The number of offsets in the array pointed to by the <TT>iOffsetArray</TT> parameter. Your application supplies this value. The number of entries in <TT>iOffsetArray</TT> must be fewer than half the number of bytes specified in <TT>iUnicodeLen</TT>. If you don't want offsets returned to you, specify <TT>0</TT> (zero) for this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26696">
 </A>
<TT>iOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10771">
 </A>
An array of type <TT>ByteOffset.</TT> On input, you specify the array that contains an ordered list of significant byte offsets pertaining to the source Unicode string. These offsets may identify font or style changes, for example, in the Unicode string. If you don't want offsets returned to your application, specify <TT>NULL</TT> for this parameter and <TT>0</TT> (zero) for <TT>iOffsetCount</TT>.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26705">
 </A>
<TT>oOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10772">
 </A>
A pointer to a value of type <TT>ItemCount</TT>. On output, this value contains the number of offsets that were mapped in the output stream.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26714">
 </A>
<TT>oOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10773">
 </A>
An array of type <TT>ByteOffset</TT>. On output, this array contains the corresponding new offsets for the resulting converted string.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26723">
 </A>
<TT>iOutputBufLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10774">
 </A>
The length in bytes of the output buffer pointed to by the <TT>oOutputStr</TT> parameter. Your application supplies this buffer to hold the returned converted string. The <TT>oOutputLen</TT> parameter may return a byte count that is less than this value if the converted byte string is smaller than the buffer size you allocated. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26732">
 </A>
<TT>oInputRead</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10775">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value contains the number of bytes of the Unicode source string that were converted. If the function returns a result code other than <TT>noErr</TT>, then this parameter returns the number of bytes that were converted before the error occurred. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26741">
 </A>
<TT>oOutputLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10776">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value contains the length in bytes of the converted string. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26750">
 </A>
<TT>oOutputStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10777">
 </A>
A buffer address. On input, this value points to the beginning of the buffer for the converted string. On output, this buffer contains the converted string in one or more encodings. When an error occurs, the ConvertFromUnicodeToScriptCodeRun function returns the converted string up to the character that caused the error. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26759">
 </A>
<TT>iScriptRunBufLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10888">
 </A>
 The number of script code run elements you allocated for the script code run array pointed to by the <TT>oScriptCodeRuns</TT> parameter. The converter returns the number of valid script code runs in the location pointed to by <TT>oScriptRunOutLen</TT>. Each entry in the script code run array specifies the beginning offset in the converted text and its associated script code.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26769">
 </A>
<TT>oScriptRunOutLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10880">
 </A>
 A pointer to a value of type ItemCount. On output, this value contains the number of valid script code runs returned in the <TT>oScriptCodeRuns</TT> parameter. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26779">
 </A>
<TT>oScriptCodeRuns</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=10882">
 </A>
 An array of elements of type <TT>ScriptCodeRun</TT>. Your application should allocate an array with the number of elements you specify in the <TT>iScriptRunBufLen</TT> parameter. On output, this array contains the script code runs for the converted text string. Each entry in the array specifies the beginning offset in the converted text string and the associated script code specification.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26791">
 </A>
<I CLASS="italics">
function result</I>
</DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=16402">
 </A>
A result code. The result codes are the same as those for the function<TT> </TT><A HREF="TEC.86.html" CLASS="XRef"><TT>ConvertFromUnicodeToText</TT></A>. </DD><P>

</DL COMPACT>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=16046">
 </A>
DISCUSSION</H5>
<P>
<A NAME="pgfId=16052">
 </A>
To use the <TT>ConvertFromUnicodeToScriptCodeRun</TT> function, you must first set up an array of script codes containing in order of precedence the scripts to be used for the conversion. To create a Unicode converter object, you call the function <A HREF="TEC.8b.html" CLASS="XRef"><TT>CreateUnicodeToTextRunInfoByScriptCode</TT></A>. You pass the returned Unicode converter object as the <TT>iUnicodeToTextInfo</TT> parameter when you call the <TT>ConvertFromUnicodeToScriptCodeRun</TT> function.<P>


<A NAME="pgfId=16060">
 </A>
The <TT>ConvertFromUnicodeToScriptCodeRun</TT> function returns the converted string in the array pointed to by the <TT>oOutputStr</TT> parameter. <A NAME="11291">
 </A>
</P>
</DIV>
<HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 13 Dec 99)<P><A HREF="TEC.88.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.8c.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.8e.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A>

<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY>
</HTML>
