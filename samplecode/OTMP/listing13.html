<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>OTMP - /MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxNetworking-date.html">Networking</a> &gt; <A HREF="javascript:location.replace('index.html');">OTMP</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxNetworking-date.html" target="_blank">Carbon > Networking</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">OTMP</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/MIB_Carbon.h</option>
<option value="listing2.html">/MoreMemory/MoreMemory.c</option>
<option value="listing3.html">/MoreMemory/MoreMemory.h</option>
<option value="listing4.html">/MoreMultiprocessing/MoreBlueActions.c</option>
<option value="listing5.html">/MoreMultiprocessing/MoreBlueActions.h</option>
<option value="listing6.html">/MoreMultiprocessing/MoreMPLog.c</option>
<option value="listing7.html">/MoreMultiprocessing/MoreMPLog.h</option>
<option value="listing8.html">/MoreOpenTransport/OTClassicContext.h</option>
<option value="listing9.html">/MoreOpenTransport/OTMP.c</option>
<option value="listing10.html">/MoreOpenTransport/OTMP.h</option>
<option value="listing11.html">/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.c</option>
<option value="listing12.html">/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.h</option>
<option value="listing13.html">/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.c</option>
<option value="listing14.html">/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.r</option>
<option value="listing15.html">/MoreOpenTransport/OTMPSimpleServerHTTP/Sample HTTP Source/index.html</option>
<option value="listing16.html">/MoreOpenTransport/Read_Me_About_OTMP.html</option>
<option value="listing17.html">/MoreProcesses/MoreProcesses.cp</option>
<option value="listing18.html">/MoreProcesses/MoreProcesses.h</option>
<option value="listing19.html">/MoreSetup.h</option></select>
				</p>
				</form>
				<p><strong><a href="OTMP.zip">Download Sample</a></strong> (&#147;OTMP.zip&#148;, 808.3K)<BR>
<strong><a href="OTMP.dmg">Download Sample</a></strong> (&#147;OTMP.dmg&#148;, 1.20M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    OTMPSimpleServerHTTPTest.c  Contains:  A test program for the simple HTTP server code (using MP tasks).  Written by:  Quinn &quot;The Eskimo!&quot;  Copyright:  Copyright &copy; 1997-2000 by Apple Computer, Inc., All Rights Reserved.  Disclaimer:  IMPORTANT:  This Apple software is supplied to you by Apple Computer, Inc.        (&quot;Apple&quot;) in consideration of your agreement to the following terms, and your        use, installation, modification or redistribution of this Apple software        constitutes acceptance of these terms.  If you do not agree with these terms,        please do not use, install, modify or redistribute this Apple software.        In consideration of your agreement to abide by the following terms, and subject        to these terms, Apple grants you a personal, non-exclusive license, under Apple's        copyrights in this original Apple software (the &quot;Apple Software&quot;), to use,        reproduce, modify and redistribute the Apple Software, with or without        modifications, in source and/or binary forms; provided that if you redistribute        the Apple Software in its entirety and without modifications, you must retain        this notice and the following text and disclaimers in all such redistributions of        the Apple Software.  Neither the name, trademarks, service marks or logos of        Apple Computer, Inc. may be used to endorse or promote products derived from the        Apple Software without specific prior written permission from Apple.  Except as        expressly stated in this notice, no other rights or licenses, express or implied,        are granted by Apple herein, including but not limited to any patent rights that        may be infringed by your derivative works or by other works in which the Apple        Software may be incorporated.        The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO        WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED        WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR        PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE OR IN        COMBINATION WITH YOUR PRODUCTS.        IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR        CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE        GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)        ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION        OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER UNDER THEORY OF CONTRACT, TORT        (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN        ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  Change History (most recent first):         &lt;9&gt;     21/9/01    Quinn   Fix Project Builder warning.         &lt;8&gt;     21/9/01    Quinn   Version 1.0a5 update.         &lt;7&gt;      9/7/01    Quinn   More MPLogPrintfSlow elimination. Also added a UI command for                                    printing the number of active threads.         &lt;6&gt;      5/7/01    Quinn   Don't init BlueActions because OTMP now does it for us.         &lt;5&gt;     15/2/01    Quinn   Minor tweaks to get it building under Project Builder.         &lt;4&gt;      8/2/01    Quinn   [2619462] The fix for the MP bug is in CarbonLib 1.2.5.         &lt;3&gt;     5/12/00    Quinn   Looks like the bug fix won't make it into CarbonLib 1.2.         &lt;2&gt;    10/11/00    Quinn   Call OTMPGetCanRunStatus and refuse to run on unsupported                                    systems.         &lt;1&gt;     7/11/00    Quinn   First checked in.*//////////////////////////////////////////////////////////////////// MIB Setup#include &quot;MoreSetup.h&quot;// Mac OS Interfaces#if ! MORE_FRAMEWORK_INCLUDES  #include &lt;OpenTransportProviders.h&gt;  #include &lt;Gestalt.h&gt;  #include &lt;Multiprocessing.h&gt;  #include &lt;Folders.h&gt;#endif// Standard C interfaces#include &lt;stdio.h&gt;// MIB prototypes#include &quot;MoreProcesses.h&quot;#include &quot;OTMP.h&quot;// Prototypes for the actual core HTTP server code.#include &quot;MoreMPLog.h&quot;#include &quot;OTMPSimpleServerHTTP.h&quot;/////////////////////////////////////////////////////////////////// The only way to tell whether OT supports IP single link// multihoming is to check the version number.  The feature was// added in OT 1.3.  The initialisation code sets // gHaveIPSingleLinkMultihoming depending on the version number// to avoid the rest of the code having to call Gestalt repeatedly.enum{  kOTIPSingleLinkMultihomingVersion = 0x01300000};static Boolean gHaveIPSingleLinkMultihoming;/////////////////////////////////////////////////////////////////// When this boolean is to set true, this module assumes that the// host application is trying to quit and all the threads created by// this module start dying.  See the associated comment in the// YieldingNotifier routine.static Boolean gQuitNow = false;static Boolean gServerStarted = false;/////////////////////////////////////////////////////////////////static OSErr FSpGetCatInfo(FSSpecPtr fss, short ioFDirIndex, CInfoPBPtr cpb)  // A simple wrapper for GetCatInfo.{  cpb-&gt;hFileInfo.ioVRefNum = fss-&gt;vRefNum;  cpb-&gt;hFileInfo.ioDirID = fss-&gt;parID;  cpb-&gt;hFileInfo.ioNamePtr = fss-&gt;name;  cpb-&gt;hFileInfo.ioFDirIndex = ioFDirIndex;  return PBGetCatInfoSync(cpb);}/////////////////////////////////////////////////////////////////// MP tasks are started with a single parameter.  Because we need // more than one parameter for our HTTPServerProc task, we pack them // into a parameter block (ServerContext).struct ServerContext {  InetHost     ipAddr;  FSVolumeRefNum  rootVRefNum;  UInt32      rootDirID;};typedef struct ServerContext ServerContext;static OSStatus HTTPServerProc(void *param)  // This routine is the initial start routine for the server's   // preemptive thread.  It unpacks the parameters from the   // context then calls our HTTP server module to execute the server.{  OSStatus     err;  ServerContext *context;    context = (ServerContext *) param;  err = RunHTTPServerMP(context-&gt;ipAddr, context-&gt;rootVRefNum, context-&gt;rootDirID);  MPFree(context);    return err;}static OSStatus RunOneServer(InetHost ipAddr)  // This routine is the main line of the thread that runs  // an HTTP server.  ipAddr is the address on which the  // server is listening.  //  // The routine uses a directory whose name is the  // dotted decimal string representation of ipAddr as the  // root directory of the HTTP server.{  OSStatus   err;  OSStatus   junk;  Str255     ipAddrString;  FSSpec     dirSpec;  CInfoPBRec   cpb;  ServerContext *context;  MPTaskID    junkServerThread;    // Allocate a context for the preemptive thread.    err = noErr;  context = (ServerContext *) MPAllocateAligned(sizeof(*context), kMPAllocateDefaultAligned, kNilOptions);  if (context == nil) {    err = memFullErr;  }    // Fill out the context.  We do this here because it needs   // to use services that aren't MP-safe.    if (err == noErr) {    context-&gt;ipAddr = ipAddr;        // Get ipAddr as a dotted decimal Pascal string.    OTInetHostToString(ipAddr, ((char *) ipAddrString) + 1);    ipAddrString[0] = OTStrLength(((char *) ipAddrString) + 1);        // Find the associated dirID, creating the directory    // if necessary.    junk = MoreProcGetCurrentProcessFSSpec(&amp;dirSpec);    MoreAssertQ(junk == noErr);          (void) FSMakeFSSpec(dirSpec.vRefNum, dirSpec.parID, ipAddrString, &amp;dirSpec);    context-&gt;rootVRefNum = dirSpec.vRefNum;    err = FSpGetCatInfo(&amp;dirSpec, 0, &amp;cpb);    if (err == noErr &amp;&amp; ( (cpb.hFileInfo.ioFlAttrib &amp; (1 &lt;&lt; 4)) != 0) ) {      context-&gt;rootDirID = cpb.hFileInfo.ioDirID;    } else {      err = FSpDirCreate(&amp;dirSpec, 0, (SInt32 *) &amp;context-&gt;rootDirID);    }  }    // Start a preemptive thread to run an HTTP server on the IP address.    if (err == noErr) {    err = MPCreateTask(HTTPServerProc, context, 65536, kInvalidID, nil, nil, kNilOptions, &amp;junkServerThread);    if (err == noErr) {      context = nil;        // it's now the task's responsibility    }  }  if (context != nil) {    MPFree(context);  }    return err;}/////////////////////////////////////////////////////////////////static OSStatus RunServersForInterface(InetInterfaceInfo* interfaceInfo, SInt32 interfaceIndex)  // Run HTTP servers for all of the IP addresses associated  // with the interface denoted by interfaceInfo and interfaceIndex.  // This routine first starts a server for the primary address  // of the interface, then iterates through the secondary addresses on  // the interface, starting a server thread for each one.{  OSStatus err;  InetHost *secondaryAddressBuffer;  UInt32   numberOfSecondaryAddresses;  UInt32   addressIndex;  secondaryAddressBuffer = nil;    // First run the server for the interfaces primary address.    err = RunOneServer(interfaceInfo-&gt;fAddress);    // Now start a server for each of the interface's secondary  // addresses.  This stuff can only be done on systems that  // support IP single link multihoming.  numberOfSecondaryAddresses = interfaceInfo-&gt;fIPSecondaryCount;    if ( err == noErr &amp;&amp; gHaveIPSingleLinkMultihoming &amp;&amp; numberOfSecondaryAddresses &gt; 0 ) {    // Allocate a buffer for the secondary address info.        secondaryAddressBuffer = (InetHost *) OTAllocMemInContext( numberOfSecondaryAddresses * sizeof(InetHost) , nil);    if (secondaryAddressBuffer == nil) {      err = kENOMEMErr;    }        // Ask OT for the list of secondary addresses on this interface.        if (err == noErr) {      err = OTInetGetSecondaryAddresses(secondaryAddressBuffer, &amp;numberOfSecondaryAddresses, interfaceIndex);    }        // Start a server for each secondary address.        addressIndex = 0;    while (err == noErr &amp;&amp; addressIndex &lt; numberOfSecondaryAddresses) {      err = RunOneServer(secondaryAddressBuffer[addressIndex]);      if (err == noErr) {        addressIndex += 1;      }    }  }  // Clean up.    if (secondaryAddressBuffer != nil) {    OTFreeMem(secondaryAddressBuffer);  }  return err;}/////////////////////////////////////////////////////////////////static OSStatus RunAllHTTPServers(void)  // Run HTTP servers for all of the IP addresses on the machine.  // This routine iterates through the active Internet interfaces,   // starting server threads for each active IP address on each  // interface.{  OSStatus err;  OSStatus junk;  EndpointRef dummyEP;  InetInterfaceInfo info;  SInt32 interfaceIndex;  Boolean done;  TEndpointInfo epInfo;    // Force TCP to load by creating a dummy endpoint.  Otherwise,  // if we're the first TCP application to run, OTInetGetInterfaceInfo  // will not return any active interfaces )-:    // Note that we do this with OTOpenEndpoint rather than OTMPXOpenEndpoint   // because we know we're running at system task time so we might as   // well give OT time to dial the modem etc.    dummyEP = OTOpenEndpointInContext(OTCreateConfiguration(&quot;tcp&quot;), 0, &amp;epInfo, &amp;err, nil);  if (err == noErr) {      // Iterate through the interfaces, starting HTTP servers on each.        done = false;    interfaceIndex = 0;     do {      done = ( OTInetGetInterfaceInfo(&amp;info, interfaceIndex) != noErr );      if ( ! done ) {        err = RunServersForInterface(&amp;info, interfaceIndex);        interfaceIndex += 1;      }    } while (err == noErr &amp;&amp; !done);  }    if (dummyEP != nil) {    junk = OTCloseProvider(dummyEP);    MoreAssertQ(junk == noErr);  }    return err;}/////////////////////////////////////////////////////////////////#if MORE_DEBUG  static void DoWriteMPLog(void)    // This routine writes out the MP log contents to     // a file &quot;MPLog.txt&quot; on the desktop.  {    OSStatus err;    FSSpec fss;        err = FindFolder(kOnSystemDisk, kDesktopFolderType, true, &amp;fss.vRefNum, &amp;fss.parID);    if (err == noErr) {      (void) FSMakeFSSpec(fss.vRefNum, fss.parID, &quot;\pMPLog.txt&quot;, &amp;fss);      err = MPLogWriteToFile(&amp;fss);    }    if (err == noErr) {      printf(&quot;Success!\n&quot;);    } else {      printf(&quot;Failed with error %ld.\n&quot;, err);    }  }#endifstatic void ServerCommandLoop(void)  // After initialising the various server modules, the main   // routine calls this routine to execute the server's user   // interface command loop.  This loop asks the user to   // enter a command and then executes that command.  //  // This loop is radicially different from the loop used by   // the cooperative scheduled predecessor of this sample.    // Because we use preemptive threads, we can block inside   // the standard C library gets routine.  The preemptive threads   // will continue to handle network operations even while we're   // blocked.{  OSStatus       err;  char         commandStr[256];  // In the debug version, set the default debug log mask to   // log all OTMP API calls.      #if MORE_DEBUG    MPLogSetMask(1 &lt;&lt; kOTMPAPILogID);  #endif    // The server command loop.  Print the list of commands, get   // a command, execute it.    do {    printf(&quot;s) Start HTTP servers\n&quot;);    printf(&quot;S) Stop  HTTP servers\n&quot;);    #if MORE_DEBUG      printf(&quot;l) Set MPLog mask\n&quot;);      printf(&quot;w) Write MPLog to disk\n&quot;);      printf(&quot;t) Print running thread count\n&quot;);    #endif    printf(&quot;q) Quit\n&quot;);    printf(&quot;Enter a command:\n&quot;);    fflush(stdout);    if ( fgets(commandStr, sizeof(commandStr), stdin) == nil ) {            commandStr[0] = 0;        }        switch (commandStr[0]) {      case 's':        if (gServerStarted) {          printf(&quot;Server is already running (supposedly).\n&quot;);        } else {          err = RunAllHTTPServers();          if (err == noErr) {            gServerStarted = true;            printf(&quot;Success!\n&quot;);          } else {            printf(&quot;Failed with error %ld\n&quot;, err);          }        }        break;      case 'S':        if (gServerStarted) {          TermOTMPSimpleServerHTTP();          gServerStarted = false;                    err = InitOTMPSimpleServerHTTP();          if (err == noErr) {            printf(&quot;Success!\n&quot;);          } else {            printf(&quot;Failed to reinitialise server (%ld)\n&quot;, err);          }        } else {          printf(&quot;Server is not running.\n&quot;);        }        break;            #if MORE_DEBUG              case 'l':          printf(&quot;Enter new log mask (in hex):\n&quot;);          gets(commandStr);          if (commandStr[0] != 0) {            UInt32 newMask;                        sscanf(commandStr, &quot;%lx&quot;, &amp;newMask);            MPLogSetMask(newMask);            printf(&quot;MPLogSetMask(0x%08lx)\n&quot;, newMask);          }          break;        case 'w':          DoWriteMPLog();          break;                case 't':          {            extern volatile SInt32 gRunningThreads;                        printf(&quot;gRunningThreads = %ld\n&quot;, gRunningThreads);          }          break;      #endif            case 'q':        gQuitNow = true;        break;      default:        printf(&quot;Huh?\n&quot;);        break;    }  } while ( ! gQuitNow );  }int main(void)  // The main line of the application.  This routine performs  // two functions.  At startup, it initialises the various modules.  // It then calls ServerCommandLoop to enter the server's user interface.{  OSStatus err;  OTClientContextPtr   junkContext;  NumVersionVariant   otVersion;    printf(&quot;OTMPSimpleServerHTTP!\n&quot;);        // Use printf because MP is not yet initialised.  printf(&quot;-- World's dumbest HTTP server.\n&quot;);  printf(&quot;-- Now using preemptive threads.\n&quot;);  printf(&quot;\n&quot;);  err = noErr;  if ( ! MPLibraryIsLoaded() ) {    err = -1;  }  #if MORE_DEBUG    if (err == noErr) {      OSStatus junk;            junk = InitMPLog(65536);    }  #endif    if (err == noErr) {    UInt32 response;        err = Gestalt(gestaltSystemVersion, (SInt32 *) &amp;response);    if ( (err == noErr) &amp;&amp; (response == 0x0910) ) {      printf(&quot;***\xCAThis code may be unreliable on Mac OS 9.1.\n&quot;);      printf(&quot;***\xCASee the documentation for details.\n&quot;);    }  }    if (err == noErr) {    switch ( OTMPGetCanRunStatus() ) {      case kOTMPCanRun:        // do nothing        break;      case kOTMPSystemTooOld:        printf(&quot;OTMP is not supported on this system\n&quot;);        err = unimpErr;        break;      case kOTMPBadCarbon:        printf(&quot;OTMP can not be used when CarbonLib &lt; 1.2.5 is installed.\n&quot;);        err = unimpErr;        break;      default:        MoreAssertQ(false);        break;    }  }  if (err == noErr) {    gHaveIPSingleLinkMultihoming = ( Gestalt(gestaltOpenTptVersions, (long *) &amp;otVersion) == noErr                      &amp;&amp; (otVersion.whole &gt;= kOTIPSingleLinkMultihomingVersion ) );    err = InitOpenTransportMPXInContext(kInitOTForApplicationMask, &amp;junkContext);    if (err == noErr) {      err = InitOTMPSimpleServerHTTP();      if (err == noErr) {        ServerCommandLoop();        if (gServerStarted) {          TermOTMPSimpleServerHTTP();        }      }      CloseOpenTransportMPXInContext(nil);    }  }    if (err == noErr) {    printf(&quot;Success.\n&quot;);    // Use printf because we might not have successfully initialised MP.  } else {    printf(&quot;Failed with error %ld.\n&quot;, err);  }    printf(&quot;Done.  Press command-Q to Quit.\n&quot;);        return 0;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/OTMP/listing13.html%3Fid%3DDTS10000251-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/OTMP/listing13.html%3Fid%3DDTS10000251-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/OTMP/listing13.html%3Fid%3DDTS10000251-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>