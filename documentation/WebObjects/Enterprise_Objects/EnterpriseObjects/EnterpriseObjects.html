<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Enterprise Objects Programming Guide: Business Objects</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Business Objects"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001011-CH203" title="Business Objects"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../About/About.html#//apple_ref/doc/uid/TP30001011-CH201-DontLinkElementID_1">WebObjects Enterprise Objects Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../BusinessLogic/BusinessLogic.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_27" title="Business Objects"></a><h1><a name="//apple_ref/doc/uid/TP30001011-CH203-TP1" title="Business Objects"></a>Business Objects</h1><p>The most important part of applications that use the Enterprise Object technology are the application’s enterprise object instances—your application’s business objects. Designing these objects is one of the primary tasks in developing an Enterprise Objects application. This chapter explains the structure of enterprise objects, how they interact with other parts of the technology, and how you can leverage the power of the technology in your custom enterprise object classes.</p><p>Designing enterprise objects entails three major steps:</p><ul class="ul"><li class="li"><p>Designing a database schema</p></li><li class="li"><p>Modeling enterprise objects</p></li><li class="li"><p>Implementing enterprise object classes</p></li></ul><p>This chapter briefly discusses the first two steps but leaves the details to <em><a href="../../UsingEOModeler/index.html#//apple_ref/doc/uid/TP30001018" target="_top">EOModeler User Guide</a></em>. This chapter focuses on the third step, implementing enterprise object classes. The chapter is divided into these sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity”</a></span> introduces a simple entity object that is referred to throughout the chapter.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHEEDID">“Designing a Schema”</a></span> discusses how design decisions in database schemas and in their corresponding enterprise object models affect one another.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBIFCC">“Defining the Model”</a></span> discusses the earliest design decisions you make about enterprise objects classes, which are reflected in your application’s data model.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHDAFBJ">“Which Enterprise Object Class?”</a></span> discusses the various concrete implementations of the EOEnterpriseObject interface.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHJJFJI">“Choosing Class Properties”</a></span> discusses how to choose class properties.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBFJGE">“Relationships With Other Enterprise Objects”</a></span> discusses relationships between enterprise objects.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHDIGDJ">“Referential Integrity”</a></span> discusses the referential integrity rules you can build into enterprise objects.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBDFHF">“Implementing an Enterprise Object”</a></span> discusses how to implement an enterprise object class.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCAEDE">“Accessing an Enterprise Object’s Data”</a></span> discusses how to use key-value coding to access an enterprise object’s data.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-TPXREF142">“Common Programming Errors”</a></span> discusses some common mistakes in implementing enterprise object classes.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-TPXREF145">“Synchronizing Model Changes to Class Files”</a></span> discusses how to merge model changes with existing enterprise object class files.</p></li><li class="li"><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-TPXREF146">“Instantiating Enterprise Objects”</a></span> discusses common ways to instantiate enterprise objects programmatically.</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA" title="Reference Entity"></a><h2>Reference Entity</h2><p>To help you better understand the concepts in this chapter, it helps to refer to a simple entity that includes characteristics that illustrate those concepts. This section describes that entity.</p><p>The entity is a simplified version of the Listing entity in the Real Estate model. (This example model is included with WebObjects 5.2. It is installed in <code>/Developer/Examples/JavaWebObjects/Frameworks/JavaRealEstate</code>.) It includes three attributes and one relationship:</p><ul class="ul"><li class="li"><p>a primary key called <code>listingID</code></p></li><li class="li"><p>an attribute called <code>bedrooms</code>, which stores the number of bedrooms</p></li><li class="li"><p>an attribute called <code>bathrooms</code>, which stores the number of bathrooms</p></li><li class="li"><p>a relationship called <code>address</code> to a ListingAddress entity</p></li></ul><p>This entity appears in EOModeler as shown in <span class="content_text">Figure 3-1</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_28" title="Figure 2-1A simplified version of the Listing entity"></a><p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHIIJEE" title="Figure 2-1A simplified version of the Listing entity"></a><strong>Figure 2-1&nbsp;&nbsp;</strong>A simplified version of the Listing entity</p><img src = "../Art/simplelistingentity.gif" alt = "A simplified version of the Listing entity" width="682" height="205"></div><br/><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHEEDID" title="Designing a Schema"></a><h2>Designing a Schema</h2><p>If the application you’re building with Enterprise Objects accesses an existing database, its schema<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_287"></a> dictates many of the design decisions you’ll make when modeling enterprise objects. However, if you’re designing a database schema while designing enterprise objects, you have more flexibility and you can design a database schema that takes advantage of features of enterprise objects, such as faulting.</p><p>If you’re designing the database schema while you design enterprise objects, be sure to keep both designs in mind as you work; decisions you make about either design affect the other.</p><p>This chapter doesn’t directly address issues of database design, but the information presented here helps you create a design that works effectively with the Enterprise Objects frameworks.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHBIFCC" title="Defining the Model"></a><h2>Defining the Model</h2><p>The work of writing enterprise objects typically begins in EOModeler. An individual enterprise object class maps to an entity in the data model. It then follows that an entity’s characteristics map to an enterprise object’s characteristics and behavior. You make the following decisions for a particular enterprise object in EOModeler:</p><ul class="ul"><li class="li"><p>Should an enterprise object map to EOGenericRecord or a custom class? (<span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHDAFBJ">“Which Enterprise Object Class?”</a></span>)</p></li><li class="li"><p>What entity attributes should be class properties? (<span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHJJFJI">“Choosing Class Properties”</a></span>)</p></li><li class="li"><p>What relationships does an enterprise object have with other enterprise objects? (<span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBFJGE">“Relationships With Other Enterprise Objects”</a></span>)</p></li><li class="li"><p>What referential integrity rules should the relationships in an enterprise object have? (<span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHDIGDJ">“Referential Integrity”</a></span>)</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHDAFBJ" title="Which Enterprise Object Class?"></a><h2>Which Enterprise Object Class?</h2><p>An enterprise object is an instance of a class<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_288"></a> that implements the <code>com.webobjects.eocontrol.EOEnterpriseObject</code> interface. This interface provides enterprise objects with the infrastructure they need to communicate with other enterprise objects, to set and return values for enterprise object attributes, and to provide a framework for validation and other business logic. </p><p>The Enterprise Objects frameworks provide for you two classes that each provide a complete implementation of the EOEnterpriseObject interface<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_289"></a>. These classes are <code>com.webobjects.eocontrol.EOCustomObject</code> and <code>com.webobjects.eocontrol.EOGenericRecord</code>. By default, enterprise object instances map to the implementation of the EOEnterpriseObject interface in the class EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_290"></a>. That is, entities you add to an EOModel are mapped to EOGenericRecord.</p><p>EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_291"></a> is sufficient for enterprise objects in which you don’t need to add custom business logic. But when you need to add custom business logic to a particular enterprise object class, you need to create a custom subclass of EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_292"></a>. To do this, you assign to an entity the name of a custom subclass and then generate source files for that custom class. This process is described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCHHFC">“Generating Source Files.”</a></span></p><p>When you assign an entity to a custom enterprise object class, the class file EOModeler generates for the custom class inherits from EOGenericRecord, but you can change the superclass to EOCustomObject. Most people prefer to work with enterprise object classes that inherit from EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_293"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_294"></a> because they are a bit easier to work with. There are at least a few reasons:</p><ul class="ul"><li class="li"><p>EOGenericRecords by default don’t include fields<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_295"></a> for their properties—they use key-value coding accessors and store the values in a dictionary. This makes EOGenericRecord subclasses easier to maintain, especially if you make changes to the entity to which a generic record maps.</p></li><li class="li"><p>EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_296"></a> subclasses automatically use deferred faulting, which increases performance and decreases memory usage. See <span class="content_text"><a href="../Fetching/Fetching.html#//apple_ref/doc/uid/TP30001011-CH206-TPXREF151">“Advanced Faulting”</a></span> for more information on deferred faulting.</p></li><li class="li"><p>EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_297"></a> subclasses automatically take care of certain faulting requirements like invoking <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_298"></a></code> and <code>willChange<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_299"></a></code> when necessary. See <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-TPXREF140">“Faulting”</a></span> for more information about these two methods.</p></li></ul><p>That said, there are a few reasons why you might want custom enterprise object classes to inherit directly from EOCustomObject rather than from EOGenericRecord. They include:</p><ul class="ul"><li class="li"><p>EOCustomObject<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_300"></a> subclasses tend to be more transparent than generic record subclasses; there is less “magic” going on behind the scenes.</p></li><li class="li"><p>You access the fields of EOCustomObject subclasses with <code>set</code> and <code>get</code> accessor methods, rather than through key-value coding, which some people prefer.</p></li><li class="li"><p>If you are making an existing Java class persistent, it’s easier to do so by changing its superclass to EOCustomObject rather than EOGenericRecord as you can then use the class’s existing fields and accessor methods.</p></li><li class="li"><p>EOCustomObject subclasses allow you to strongly type attributes, which provides compile-time type checking and saves you from having to type cast the results of key-value coding accessors.</p></li></ul><p>In short, the choice of which class to use is really a matter of preference. Both types of classes are first-class citizens within the Enterprise Objects frameworks, so you don’t lose any power or flexibility with either choice. If you’re new to the technology, you’ll probably find that EOGenericRecords are easier to work with because they encapsulate some of the framework’s complexities.</p><p><span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBDFHF">“Implementing an Enterprise Object”</a></span> compares concrete examples of both types of classes.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_29" title="Note"></a><p><strong>Note:</strong>&nbsp;Although the enterprise object classes you write are of one of these types, when you program to those classes in your application, when possible, <em>always program to the interface rather than to the implementation</em>. That is, declare enterprise objects you use as EOEnterpriseObject rather than as EOCustomObject or as EOGenericRecord, regardless of that object’s concrete class type. This makes your applications easier to maintain and allows you to change how enterprise object classes are implemented without affecting the code that uses them.</p></div><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHJJFJI" title="Choosing Class Properties"></a><h2>Choosing Class Properties</h2><p>When you add attributes to entities in EOModeler, they are marked as class properties<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_301"></a> (denoted by the diamond in an attribute’s row). When an attribute is marked as a class property, accessor methods for that attribute are included in that class definition when you generate source<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_302"></a> files for the class using EOModeler. When instances of an enterprise object are created, the data that maps to an attribute is fetched from the database and stored in the enterprise object instance, so you should mark attributes only as class properties if their data is needed in an enterprise object instance.</p><p>As a general rule, you should mark attributes as class properties<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_303"></a> only if their values are meaningful to a particular enterprise object’s business logic or if their values are displayed in the user interface. An attribute that won’t be used in business logic or that users don’t need to see or manipulate shouldn’t be marked as class properties. </p><p>Database artifacts<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_304"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_305"></a> such as primary and foreign keys shouldn’t be marked as class properties. There are exceptions to this rule, such as when you provide custom primary keys, but they are rare. Enterprise Objects handles key generation for you, so these keys aren’t necessary in your business logic classes. Also, it is rare that a primary key would contain data valuable to a user. (This generally reflects poor schema design, such as when a driver license number is used as a table’s primary key.)</p><p>In the Listing entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity,”</a></span> the <code>bedrooms</code>, <code>bathrooms</code>, and <code>address</code> properties are selected as class properties, while the entity’s primary key, <code>listingID</code>, is not marked as a class property. The <code>bedrooms</code>, <code>bathrooms</code>, and <code>address</code> properties contain data that is meaningful to the application’s users; the <code>listingID</code> property does not.</p><p>A consideration, especially for advanced users, is to ensure that a given entity doesn’t have any redundant attributes that are marked as class properties. A common mistake when building data models that use entity inheritance is to mark multiple attributes as class properties when the attributes in fact represent the same data, such as can occur when flattening attributes and relationships. This issue is discussed in more detail in <em><a href="../../UsingEOModeler/index.html#//apple_ref/doc/uid/TP30001018" target="_top">EOModeler User Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHBFJGE" title="Relationships With Other Enterprise Objects"></a><h2>Relationships With Other Enterprise Objects</h2><p>One of the most important parts of a data model is the relationships<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_306"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_307"></a> it expresses between entities. You use relationships to access data across multiple objects in an object graph. Relationships are similar to attributes in that they can be marked as class properties. When they are marked as class properties, accessor methods are included in the generated class file for them, as is the case for attributes that are marked as class properties.</p><p>Unlike attributes, however, there are additional factors to consider when marking a relationship as a class property. Relationships in Enterprise Objects are not used just to specify the affinity between two tables. Relationships are also used when configuring entity inheritance and when flattening relationships (either explicitly or in a many-to-many relationship). Follow these guidelines when deciding whether to mark a relationship as a class property:</p><ul class="ul"><li class="li"><p>Relationships that represent an entity’s relationship to an intermediate join table (such as in a many-to-many relationship) shouldn’t be marked as class properties (unless they contain data that’s meaningful in your application, which is rare).</p></li><li class="li"><p>When modeling vertical inheritance mapping, the to-one relationship from a child entity to its parent shouldn’t be marked as a class property. This relationship is used to allow the parent entity’s attributes to be flattened into the child entity and in most cases isn’t of any use as a class property. See <em>Using EOModeler</em> for more information on entity inheritance.</p></li></ul><p>In the Listing entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity,”</a></span> the <code>address</code> property, which represents the entity’s relationship to a ListingAddress entity, is marked as a class property. The relationship is a to-one relationship and joins on the source entity’s primary key <code>listingID</code> and the destination entity’s primary key <code>listingID</code>.</p><p>When you mark relationships as class properties, to-one relationships are represented as references to other objects and to-many relationships are represented as NSArray objects. You usually access the data in other objects by using relationship properties to traverse the object graph in running applications. For example, the following code uses Listing’s <code>address</code> relationship to access the <code>street</code> property in the Address object:</p><div class="codesample"><table><tr><td scope="row"><pre>String streetAddress = (String)listing.valueForKeyPath("address.street");<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 3-2</span> illustrates this example. </p><p>The Listing enterprise object has many properties—many attributes and relationships. To access an attribute in an enterprise object, you invoke on it the method <code>valueForKey("</code><em>attributeName</em><code>")</code>. To access an attribute in one of an enterprise object’s relationships, you invoke on it the method <code>valueForKeyPath("</code><em>relationship.relationshipAttribute</em><code>")</code>. The methods <code>valueForKey</code> and <code>valueForKeyPath</code> return a <code>java.lang.Object</code>, which you usually cast to the data type of the attribute being accessed (such as <code>java.lang.Number</code> and <code>java.lang.String</code>, or NSArray if the attribute represents a to-many relationship in the enterprise object).</p><p>To access a Listing’s features, you use this code to get an array of a particular listing’s features:</p><div class="codesample"><table><tr><td scope="row"><pre>NSArray features = (NSArray)listing.valueForKeyPath("features");<span></span></pre></td></tr></table></div><br/><div><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_30" title="Figure 2-2Key value-coding and relationships as key paths"></a><p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF150" title="Figure 2-2Key value-coding and relationships as key paths"></a><strong>Figure 2-2&nbsp;&nbsp;</strong>Key value-coding and relationships as key paths</p><img src = "../Art/keypathinrelationship.gif" alt = "Key value-coding and relationships as key paths" width="523" height="199"></div><br/><p>Enterprise Objects handles the resolution of relationships automatically, which may involve fetching from the database. You don’t have to worry about explicitly generating SQL statements or resolving joins; Enterprise Objects takes care of all this for you. All you need to supply is a well-designed data model and Enterprise Objects takes care of the rest.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHDIGDJ" title="Referential Integrity"></a><h2>Referential Integrity</h2><p>Referential integrity<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_308"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_309"></a> rules are part of the definition of relationships between enterprise objects, just like joins between database tables. These rules work to maintain the integrity and consistency of the data that gets committed to the database. Enterprise Objects supports these referential integrity rules:</p><ul class="ul"><li class="li"><p>optionality</p></li><li class="li"><p>delete rule</p></li><li class="li"><p>owns destination</p></li><li class="li"><p>propagate primary key</p></li></ul><p>These rules are described in more detail in <em><a href="../../UsingEOModeler/index.html#//apple_ref/doc/uid/TP30001018" target="_top">EOModeler User Guide</a></em>. In most cases, you configure referential integrity rules in EOModeler. Your enterprise object classes have no direct knowledge of the referential integrity rules of their relationships. These rules are characteristics of EORelationship objects of which individual enterprise objects<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_310"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_311"></a> have no direct knowledge. This means that you need to be concerned with referential integrity rules when designing data models but not when adding custom logic to enterprise object classes.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHBDFHF" title="Implementing an Enterprise Object"></a><h2>Implementing an Enterprise Object</h2><p>As discussed in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHDAFBJ">“Which Enterprise Object Class?,”</a></span> one of the first decisions you need to make about an enterprise object is what class it maps to. In many cases, an enterprise object should map to EOGenericRecord. Enterprise object classes that include custom business logic should map to custom subclasses of EOGenericRecord. In some cases, particularly for advanced developers, an enterprise object can map to a custom subclass of EOCustomObject.</p><p>From the perspective of Enterprise Objects, these three choices are identical: they all interact with the technology in the same way because they all implement the EOEnterpriseObject interface<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_312"></a>. That interface specifies a complete set of methods that support common operations for all types of enterprise objects. It includes methods for initializing enterprise object instances, announcing changes to other enterprise objects, setting and retrieving property values in enterprise objects, and performing validation of enterprise object values.</p><p>One of the three types of enterprise object class mappings should be sufficient for all circumstances. <em>You should never need to implement the EOEnterpriseObject interface from scratch.</em> Most of the methods in EOEnterpriseObject are meant to be used internally, and besides, the default implementations of the interface provide the default behavior you want.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHCHHFC" title="Generating Source Files"></a><h3>Generating Source Files</h3><p>The first step in creating a custom enterprise object is with EOModeler<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_313"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_314"></a>’s Generate Java Files and Generate Client Java Files commands. These commands take the entities, attributes, and relationships you’ve defined in a model to generate a corresponding enterprise object class. Before generating a class file for a particular entity, you must assign a class name to that entity. You assign custom class names to entities in EOModeler’s table mode. While in table mode, select the root of the tree view to display the model’s entities in table mode, as <span class="content_text">Figure 3-3</span> illustrates.</p><p>In this table, you specify the class name to use for an entity. The class name is used when you generate source files for that entity.</p><br/><div><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_31" title="Figure 2-3Custom classes for entities"></a><p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHHIJCH" title="Figure 2-3Custom classes for entities"></a><strong>Figure 2-3&nbsp;&nbsp;</strong>Custom classes for entities</p><img src = "../Art/listingsimpleclasses.gif" alt = "Custom classes for entities" width="764" height="134"></div><br/><p>EOModeler warns you if you try to generate a source file for an entity that hasn’t been assigned a custom class name. When you specify a custom class name for an entity, in most cases EOModeler generates a class file whose class member inherits from EOGenericRecord. However, if you’re using inheritance, a child entity’s class definition is generated to inherit from its parent.</p><p>The class that EOModeler generates for the entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity”</a></span> appears in <span class="content_text">Listing 3-1</span>. It provides public accessor methods for the entity’s class properties, but not for the entity’s primary key, <code>listingID</code>, which is not selected as a class property.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_32" title="Listing 2-1Generated class for simplified Listing entity (EOGenericRecord)"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHFAJEF" title="Listing 2-1Generated class for simplified Listing entity (EOGenericRecord)"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Generated class for simplified Listing entity (EOGenericRecord)</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.math.BigDecimal;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.util.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class Listing extends EOGenericRecord {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Listing() {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Number bedrooms() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (Number)storedValueForKey("bedrooms");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setBedrooms(Number value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        takeStoredValueForKey(value, "bedrooms");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Number bathrooms() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (Number)storedValueForKey("bathrooms");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setBathrooms(Number value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        takeStoredValueForKey(value, "bathrooms");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public EOEnterpriseObject address() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (EOEnterpriseObject)storedValueForKey("address");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setAddress(EOEnterpriseObject value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        takeStoredValueForKey(value, "address");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public NSArray features() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (NSArray)storedValueForKey("features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setFeatures(NSArray value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        takeStoredValueForKey(value, "features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void addToFeatures(EOEnterpriseObject object) {<span></span></pre></td></tr><tr><td scope="row"><pre>        includeObjectIntoPropertyWithKey(object, "features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void removeFromFeatures(EOEnterpriseObject object) {<span></span></pre></td></tr><tr><td scope="row"><pre>        excludeObjectFromPropertyWithKey(object, "features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If you prefer to use EOCustomObject subclasses, you can modify the class in <span class="content_text">Listing 3-1</span> as shown in <span class="content_text">Listing 3-2</span>.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_33" title="Listing 2-2Generated class for simplified Listing entity (EOCustomObject)"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHHIGII" title="Listing 2-2Generated class for simplified Listing entity (EOCustomObject)"></a><strong>Listing 2-2&nbsp;&nbsp;</strong>Generated class for simplified Listing entity (EOCustomObject)</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.math.BigDecimal;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.util.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class Listing extends EOCustomObject {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    private Double _bathrooms = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    private Double _bedrooms = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    private EOEnterpriseObject _address = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    private NSArray _features = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Listing() {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    public static boolean usesDeferredFaultCreation() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return true;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    public Double bathrooms() {<span></span></pre></td></tr><tr><td scope="row"><pre>        willRead();<span></span></pre></td></tr><tr><td scope="row"><pre>        return _bathrooms;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setBathrooms(Double value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        willChange();<span></span></pre></td></tr><tr><td scope="row"><pre>        _bathrooms = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Double bedrooms() {<span></span></pre></td></tr><tr><td scope="row"><pre>        willRead();<span></span></pre></td></tr><tr><td scope="row"><pre>        return _bedrooms;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setBedrooms(Double value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        willChange();<span></span></pre></td></tr><tr><td scope="row"><pre>        _bedrooms = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    public EOEnterpriseObject address() {<span></span></pre></td></tr><tr><td scope="row"><pre>        willRead();<span></span></pre></td></tr><tr><td scope="row"><pre>        willReadRelationship(_address);<span></span></pre></td></tr><tr><td scope="row"><pre>        return _address;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setAddress(EOEnterpriseObject value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        willChange();<span></span></pre></td></tr><tr><td scope="row"><pre>        _address = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    public NSArray features() {<span></span></pre></td></tr><tr><td scope="row"><pre>        willRead();<span></span></pre></td></tr><tr><td scope="row"><pre>        willReadRelationship(_features);<span></span></pre></td></tr><tr><td scope="row"><pre>        return _features;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void setFeatures(NSArray value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        willChange();<span></span></pre></td></tr><tr><td scope="row"><pre>        _features = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void addToFeatures(EOEnterpriseObject object) {<span></span></pre></td></tr><tr><td scope="row"><pre>        includeObjectIntoPropertyWithKey(object, "features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void removeFromFeatures(EOEnterpriseObject object) {<span></span></pre></td></tr><tr><td scope="row"><pre>        excludeObjectFromPropertyWithKey(object, "features");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>These two code listings demonstrate the primary differences between EOGenericRecord subclasses and EOCustomObject subclasses. <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHFAJEF">Listing 3-1</a></span> contains no fields for the object’s attributes; they are stored in a dictionary that the class maintains internally. Contrast this with <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHHIGII">Listing 3-2</a></span>, which includes fields for the object’s attributes: <code>_bathrooms</code>, <code>_bedrooms</code>, <code>_address</code>, and <code>_features</code>. </p><p><span class="content_text">Listing 3-2</span> includes accessor methods that explicitly act on the object’s fields, whereas the accessor methods in <span class="content_text">Listing 3-1</span> use key-value coding to access the object’s data in its internal dictionary.</p><p><span class="content_text">Listing 3-2</span>, being a class that inherits from EOCustomObject, explicitly calls <code>willChange<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_315"></a></code> immediately before a property is mutated and calls <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_316"></a></code> immediately before a property is accessed. These invocations are required in EOCustomObject<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_317"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_318"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_319"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_320"></a> subclasses to support faulting and change notification; they are invoked automatically in EOGenericRecord subclasses, so they aren’t present in the class in <span class="content_text">Listing 3-1</span>.</p><p>Finally, <span class="content_text">Listing 3-2</span> implements a feature of Enterprise Objects called deferred faulting, which is discussed in <span class="content_text"><a href="../Fetching/Fetching.html#//apple_ref/doc/uid/TP30001011-CH206-TPXREF157">“Deferred Faulting.”</a></span> It implements this feature by overriding <code>usesDeferredFaultCreation<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_321"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_322"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_323"></a></code> and by invoking <code>willReadRelationship<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_324"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_325"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_326"></a></code> in accessor methods that return values from the object’s relationships. <span class="content_text">Listing 3-1</span> uses deferred faulting automatically because it is an EOGenericRecord subclass.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF139" title="Fields"></a><h3>Fields</h3><p>As discussed in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCHHFC">“Generating Source Files,”</a></span> EOModeler generates class files whose class members inherit from EOGenericRecord. By default, EOGenericRecords do not include fields for their properties. Rather, they store their properties in a dictionary that can be accessed using key-value coding accessors. This both reduces the amount of code you need to write and makes your custom enterprise object classes easier to maintain. </p><p>That said, you can add fields for an enterprise object’s properties to an EOGenericRecord subclass if you want to, or you can use an EOCustomObject in which you are required to use fields, as <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHHIGII">Listing 3-2</a></span> illustrates.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHFCDGG" title="Change Notification"></a><h3>Change Notification</h3><p>In Enterprise Objects, objects that need to know about changes to an enterprise object register as observers for particular change notifications<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_327"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_328"></a>. When an enterprise object is about to change, it is responsible for posting a notification so that registered observers are notified that it’s about to change. To do this, enterprise object instances invoke <code>willChange<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_329"></a></code> prior to altering their state. Whenever you add your own methods that change an object’s state, you need<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_330"></a> to include this invocation.</p><p>When invoked in an EOGenericRecord subclass, the stored value accessor (<code>takeStoredValueForKey</code>), automatically invokes<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_331"></a><code>willChange</code> for you, as a convenience. However, in enterprise object class that includes fields for its properties, this isn’t the case, so you must invoke <code>willChange<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_332"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_333"></a></code> yourself, as the class in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHHIGII">Listing 3-2</a></span> does. </p><p>The fact that change notification is handled for you is another reason why some people prefer to use EOGenericRecord<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_334"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_335"></a> subclasses.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF140" title="Faulting"></a><h3>Faulting</h3><p>When an enterprise object is about to retrieve data for one or more of its properties, it is required to notify other objects that it’s about to take action. It does this by invoking <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_336"></a></code>. An EOGenericRecord class using <code>takeStoredValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_337"></a></code> to access data automatically invokes <code>willRead</code>. </p><p>This method is a part of Enterprise Object’s <strong>faulting</strong><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_338"></a> mechanism. Faulting is the mechanism by which Enterprise Objects delays the full initialization of an enterprise object instance until that object’s data is actually required. You can think of faulting as creating a shell of an enterprise object that includes just some (or perhaps none) of its data. See <span class="content_text"><a href="../Fetching/Fetching.html#//apple_ref/doc/uid/TP30001011-CH206-BADCJHCC">Figure 6-3</a></span> for an illustration.</p><p>Faulting<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_339"></a> reduces memory consumption and provides a performance improvement to applications by delaying fetches to the database until data is actually needed. Database fetches are expensive, especially during the resolution of relationships. Often, an enterprise object needs a reference to a particular relationship but doesn’t necessarily need the data in that relationship. By providing that enterprise object with a reference to the relationship using a fault, you save the expense of performing a fetch if it’s not necessary.</p><p>The default implementation of <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_340"></a></code> checks to see if its receiver has already been fully initialized (that is, if its receiver is a full-formed enterprise object). If it hasn’t been fully initialized, it fills the object with values fetched from the database. Before an application attempts to invoke a method on a particular enterprise object, you must ensure that object has already fetched its data. To ensure that an enterprise object is in the correct state before its data is accessed, you need to invoke <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_341"></a></code>, typically in “get” methods. (Enterprise objects don’t have to invoke <code>willRead</code> in “set” methods because the default implementation of <code>willChange</code><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_342"></a> invokes <code>willRead</code> internally.)</p><p>Again, if you use EOGenericRecord subclasses that don’t access their properties with fields, <code>willRead</code> is handled for you by <code>storedValueForKey</code><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_343"></a>.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-CEHCAEDE" title="Accessing an Enterprise Object&acirc;&#128;&#153;s Data"></a><h2>Accessing an Enterprise Object’s Data</h2><p>In implementing your enterprise object classes, you want to focus on the code that’s unique to your application, not on the code that deals with fitting your objects into the framework of Enterprise Objects. To help with this, Enterprise Objects provides key-value coding, a standard interface for accessing an enterprise object’s properties ( key-value coding was introduced in <span class="content_text"><a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30001011-CH202-TPXREF147">“Key-Value Coding”</a></span>).</p><p>Key-value coding specifies that an object’s properties are accessed indirectly by name or key rather than directly through invocation of an accessor method or as fields. This provides a consistent way to access an object’s data, regardless if the object provides accessor methods or fields to its data. The EOEnterpriseObject interface implements the EOKeyValueCoding and NSKeyValueCoding<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_344"></a> interfaces, so custom enterprise object classes automatically inherit key-value coding behavior.</p><p>The basic methods for accessing an object’s values are <code>takeValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_345"></a></code> and <code>valueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_346"></a></code>, which set or return the value for the specified key, respectively. Key-value coding uses the first accessor it finds when both setting and getting the value for a given key. The following lists describe the lookup order of accessors. </p><p> The order<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_347"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_348"></a> of lookup when retrieving a value is:</p><ul class="ul"><li class="li"><p><code>get</code><em>Keyname</em><code>()</code> method</p></li><li class="li"><p><em>keyname</em><code>()</code> method</p></li><li class="li"><p><code>_get</code><em>Keyname</em><code>()</code> method</p></li><li class="li"><p><code>_</code><em>keyname</em><code>()</code> method</p></li><li class="li"><p><em>keyname</em> field</p></li><li class="li"><p><code>_</code><em>keyname</em> field</p></li><li class="li"><p><code>handleQueryWithUnboundKey("</code><em>keyname</em><code>")</code> method, if none of the above accessors are found</p></li></ul><p>In the Listing entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity,”</a></span> an invocation of <code>valueForKey("</code><em>bedrooms</em><code>")</code> on a Listing enterprise object looks up the value of the <code>bedrooms</code> property by invoking accessor methods and fields in the following order:</p><ul class="ul"><li class="li"><p><code>get</code><em>Bedrooms</em><code>()</code> method</p></li><li class="li"><p><em>bedrooms</em><code>()</code> method</p></li><li class="li"><p><code>_get</code><em>bedrooms</em><code>()</code> method</p></li><li class="li"><p><code>_</code><em>bedrooms</em><code>()</code> method</p></li><li class="li"><p><em>bedrooms</em> field</p></li><li class="li"><p><code>_</code><em>bedrooms</em> field</p></li><li class="li"><p><code>handleQueryWithUnboundKey("</code><em>bedrooms</em><code>")</code> method, if none of the above accessors are found</p></li></ul><p>The order of lookup<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_349"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_350"></a> when setting a value is:</p><ul class="ul"><li class="li"><p><code>set</code><em>Keyname</em>(<em>value</em><code>)</code> method</p></li><li class="li"><p><code>_set</code><em>Keyname</em><code>(</code><em>value</em><code>)</code> method </p></li><li class="li"><p><em>keyname</em> field</p></li><li class="li"><p><code>_</code><em>keyname</em> field</p></li><li class="li"><p><code>handleTakeValueForUnboundKey(</code><em>value</em>, <code>"</code><em>keyname</em><code>")</code> method, if none of the above accessors are found </p></li></ul><p>In the Listing entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity,”</a></span> an invocation of <code>takeValueForKey(</code><em>new Integer(4)</em><code>,"</code><em>bedrooms</em><code>")</code> on a Listing enterprise object attempts to set the value of the <code>bedrooms</code> property by invoking accessor methods and setting fields in the following order:</p><ul class="ul"><li class="li"><p><code>set</code><em>Bedrooms</em>(<code>new Integer(4)</code><code>)</code></p></li><li class="li"><p><code>_set</code><em>Bedrooms</em><code>(</code><code>new Integer(4)</code><code>)</code></p></li><li class="li"><p><code>bedrooms = new Integer(4)</code></p></li><li class="li"><p><code>_bedrooms = new Integer(4)</code></p></li><li class="li"><p><code>handleTakeValueForUnboundKey(</code><code>new Integer(4)</code>, <code>"</code><em>bedrooms</em><code>")</code> method, if none of the above accessors are found </p></li></ul><p>There is another set of methods<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_351"></a> defined by the EOKeyValueCoding interface, <code>takeStoredValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_352"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_353"></a></code> and <code>storedValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_354"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_355"></a></code>. You never explicitly invoke these methods, but you may implement them in enterprise object classes. The stored value methods are used internally to transport data to and from trusted sources. For example, <code>takeStoredValueForKey</code> is used to initialize an object’s properties with values fetched from the database, whereas <code>takeValueForKey</code> is used to modify an object’s properties from values provided by a user.</p><p>The default lookup order<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_356"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_357"></a> for the stored value methods for retrieving the value of a property is:</p><ul class="ul"><li class="li"><p><code>_get</code><em>Keyname</em><code>()</code> and <code>_</code><em>keyname</em><code>()</code> methods</p></li><li class="li"><p><em>_keyname</em> and <em>keyname</em> fields</p></li><li class="li"><p> get<em>keyname</em><code>()</code> and <em>keyname</em><code>()</code> methods</p></li></ul><p>The default lookup order<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_358"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_359"></a> for the stored value methods for setting the value of a property is:</p><ul class="ul"><li class="li"><p><code>_set</code><em>Keyname</em><code>()</code> method</p></li><li class="li"><p><em>_keyname</em>, and <em>keyname</em> fields</p></li><li class="li"><p><code>set</code><em>Keyname</em><code>()</code> method</p></li></ul><p>Refer to the API reference for <code>com.webobjects.eocontrol.EOKeyValueCoding</code> and for <code>com.webobjects.foundation.NSKeyValueCoding</code> for complete information about accessor lookup order.</p><p>EOGenericRecord adds some additional behavior to key-value coding. When <code>takeStoredValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_360"></a></code> or <code>storedValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_361"></a></code> is invoked in an EOGenericRecord object, a corresponding <code>willChange<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_362"></a></code> or <code>willRead<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_363"></a></code> invocation is sent automatically, before the accessor is looked up. This supports the requirement that enterprise object instances notify other instances when they’re about to change the state of their data. This requirement is described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHFCDGG">“Change Notification.”</a></span></p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF141" title="Error Handling for Accessors"></a><h3>Error Handling for Accessors</h3><p>As introduced in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCAEDE">“Accessing an Enterprise Object’s Data,”</a></span> the public key-value coding<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_364"></a> accessors <code>valueForKey</code> and <code>takeValueForKey</code> have a default lookup order of accessors. The final lookup key for <code>valueForKey</code> is <code>handleQueryWithUnboundKey("</code><em>keyName</em><code>")</code> and for <code>takeValueForKey</code> is <code>handleTakeValueForUnboundKey(</code><em>value</em>, <code>"</code><em>keyName</em><code>")</code>. That is, the default implementation of key-value coding invokes these methods when they receive a key for which they can find no accessor methods or fields. The default implementations throw exceptions, but you can override them to handle the error more gracefully.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF142" title="Common Programming Errors"></a><h2>Common Programming Errors</h2><p>This section discusses some of the more subtle issues you need to be aware of when building enterprise object classes.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF143" title="Overriding equals or  hashcode"></a><h3>Overriding equals or  hashcode</h3><p>Don’t override <code>equals<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_365"></a></code> or <code>hashcode<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_366"></a></code>. Enterprise Objects uses the methods <code>equals</code> and <code>hashcode</code> in enterprise object classes to perform object comparisons and other functions. You should not implement either method in your enterprise object classes. </p><p>A common mistake is to use <code>equals</code> to compare enterprise objects. Avoid doing this and instead compare the global IDs<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_367"></a><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_368"></a> of enterprise objects using <code>equals</code>. The code in <span class="content_text">Listing 3-3</span> provides an example.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_34" title="Listing 2-3Comparing two enterprise objects using equals on their global IDs"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF149" title="Listing 2-3Comparing two enterprise objects using equals on their global IDs"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Comparing two enterprise objects using <code>equals</code> on their global IDs</p><div class="codesample"><table><tr><td scope="row"><pre>if ((editingContext.globalIDForObject(enterpriseObject1)).<span></span></pre></td></tr><tr><td scope="row"><pre>equals(editingContext.globalIDForObject(enterpriseObject2)));<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF147" title="Immutable Primary Keys"></a><h3>Immutable Primary Keys</h3><p>Enterprise Objects does not support changeable<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_369"></a> primary keys. That is, you cannot change the value of a row’s primary key. A common, though poor, design pattern in database application development is to store meaningful business data as primary keys such as driver license numbers. </p><p>What if a value like this changes? If you try to change the value of a row’s primary key in Enterprise Objects, the enterprise object that represents that row will never be allowed to save in the Enterprise Objects application. The optimistic locking mechanism in Enterprise Objects always throws an exception if a row’s primary key changes. So, don’t mix columns that include meaningful business data with columns that are used to define database structure.</p><p>If you encounter a situation in which you must change an object’s primary key, the recommended procedure is to create a new enterprise object of the same type, copy the data from the original object into the new object, and delete the original object.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF148" title="Primary Keys and Allows Null"></a><h3>Primary Keys and Allows Null</h3><p>In some cases, you need to set the allows null<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_370"></a> characteristic of a primary key attribute to <code>true.</code> This situation often occurs in master-detail relationships in which a detail object is added to the relationship but is not immediately saved to the database. You usually set a primary key’s allows null characteristic in the advanced attribute inspector in EOModeler. </p><p>What a primary key’s allows null characteristic means, however, may be unclear. No primary key is ever allowed to be <code>null</code> in a database that Enterprise Objects accesses. When you allow <code>null</code> for a primary key, validation within Enterprise Objects doesn’t throw an exception when a new enterprise object is created and is used within the application before being inserted into the database; on the way to the database, Enterprise Objects generates a value for the primary key regardless of its allows <code>null</code> characteristic. </p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF145" title="Synchronizing Model Changes to Class Files"></a><h2>Synchronizing Model Changes to Class Files</h2><p>In the course of building an Enterprise Objects application, you’ll likely make changes to a model that affect enterprise object class files that you’ve generated from EOModeler, as described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCHHFC">“Generating Source Files.”</a></span> Since you usually add custom logic to those enterprise object class files, you must make sure not to overwrite those changes when generating class files from an updated EOModel. EOModeler is careful to not blindly overwrite generated class files and instead presents a dialog allowing you to merge changes. </p><p>Clicking Merge in this dialog opens the FileMerge application and allows you to merge the updated entity definition class with the old entity definition class that contains custom business logic.</p><a name="//apple_ref/doc/uid/TP30001011-CH203-TPXREF146" title="Instantiating Enterprise Objects"></a><h2>Instantiating Enterprise Objects</h2><p>There are at least a few ways to create<a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_371"></a> enterprise objects programmatically. The approach you use largely depends on the configuration of the entity from which you want to create the object. </p><p>In EOModeler, if the entity’s class is assigned to EOGenericRecord, you must first retrieve the entity’s class description before instantiating an enterprise object. An entity’s class description holds meta-information about an entity that describes an entity’s various characteristics, such as its attributes and relationships. Once you have an entity’s class description, you can instantiate an enterprise object of that class.</p><p>For example, consider the Listing entity described in <span class="content_text"><a href="EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBGGIA">“Reference Entity.”</a></span> You can use this code to instantiate an enterprise object of type Listing:</p><div class="codesample"><table><tr><td scope="row"><pre>EOClassDescription listingCD =           EOClassDescription.classDescriptionForEntityName("Listing");<span></span></pre></td></tr><tr><td scope="row"><pre>EOEnterpriseObject listing =<span></span></pre></td></tr><tr><td scope="row"><pre>         listingCD.createInstanceWithEditingContext(null, null);<span></span></pre></td></tr><tr><td scope="row"><pre>editingContext.insertObject(listing);<span></span></pre></td></tr></table></div><p>Note that immediately after the enterprise object is created, it is inserted into an editing context. As a cardinal rule, all enterprise objects reside in an editing context. This is necessary in order for enterprise objects to send and receive the notifications necessary for change tracking and other mechanisms within Enterprise Objects. So, for every enterprise object you create, you must immediately insert it into an editing context.</p><p>You can simplify the above code example by supplying an editing context object as the first argument to the <code>createInstanceWithEditingContext</code><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_372"></a> invocation.</p><p>If an entity’s class is assigned to a custom subclass of EOGenericRecord (so that the Listing entity’s class name assignment in EOModeler is “Listing” or “com.myapp.Listing”), you can also create an enterprise object with this code by using the subclasses’s constructor:</p><div class="codesample"><table><tr><td scope="row"><pre>Listing image = new Listing();<span></span></pre></td></tr><tr><td scope="row"><pre>editingContext.insertObject(image);<span></span></pre></td></tr></table></div><p>You can also use the method in the EOUtilities class called <code>createAndInsertInstance</code><a name="//apple_ref/doc/uid/TP30001011-CH203-DontLinkElementID_373"></a> to instantiate an enterprise object:</p><div class="codesample"><table><tr><td scope="row"><pre>EOUtilities.createdAndInsertInstance(editingContext(), "Listing");<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../BusinessLogic/BusinessLogic.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Enterprise_Objects/EnterpriseObjects/EnterpriseObjects.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Enterprise_Objects/EnterpriseObjects/EnterpriseObjects.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Enterprise_Objects/EnterpriseObjects/EnterpriseObjects.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>