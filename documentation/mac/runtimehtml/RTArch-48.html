<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Use PEF Version Numbering</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING48></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-35.html"><B>Chapter 3 - Programming for the CFM-Based Runtime Architecture </B></A> / <A HREF="RTArch-45.html"><B>Import Library Techniques</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING48-0></A>
<H2>Use PEF Version Numbering</H2>
 <A NAME=MARKER-2-51></A>The Code Fragment Manager relies on version numbers stored in the import library PEF containers to determine whether an implementation library is compatible with the definition stub library. The developer can assign version numbers as a redundancy check for possible library mismatches during a library's development. As shown in the example that follows, there are some cases that this method does not solve. This section gives several examples of when and how to change these version numbers when developing import libraries. <P>
 When using PEF versioning, the developer should use the following rules:<P>
<UL>
<LI>The first library should have all three version numbers set to zero. 
<LI>The current version number can be incremented each time the developer releases a change to the library.  
<LI>The old definition version number should be incremented only if the developer changes the library's API in a manner that makes the library incompatible with older clients (for example, removing a routine that older clients expect to see).  
<LI>The old implementation number should be incremented only if the developer makes additions to the API that new clients must depend on (for example, adding a routine that all new clients will require).<P>
</UL>
<DL>
<DT><B>IMPORTANT</B>
<DD>The version numbers encoded in an import library are for developer use only. The library compatibility version numbers do not need to correspond to the version numbers visible to the end user.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 <A HREF=#MARKER-9-52>Figure 3-2</A> shows the version numbers required for each update of a library <CODE>mooLib</CODE> that contains the function <CODE>moo</CODE>.<P>
<B>Figure 3-2  <A NAME=MARKER-9-52></A>Changes to import library version numbers</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-82.jpg"> <P>
 When you first build the library, you do not have to worry about compatibility, so all the version numbers are set to 0. <P>
 Now, suppose you find a minor bug in the function <CODE>moo</CODE> in your first version. After fixing the bug, you create version 1. Fragments built with version 0 can run on machines that contain version 1 without having to be updated, because the two versions of <CODE>moo</CODE> are compatible. Similarly, fragments built with version 1 can still run on machines that contain version 0 (even though it contains a bug). Therefore, the old implementation and old definition numbers remain at 0 while the current version number is raised to 1.<P>
 Now, suppose you update the library again to add a different implementation of function <CODE>moo</CODE>, called <CODE>new_moo</CODE>. The definition and implementation for function <CODE>moo</CODE> remain the same. This version becomes version 2 of the import library. Fragments built with either of the older versions still run on machines that have version 2 because they won't look for the function <CODE>new_moo</CODE>. However, fragments built with version 2 cannot run on machines containing older versions of the library because they cannot find an implementation for function <CODE>new_moo</CODE>. Therefore, version 2 of <CODE>mooLib</CODE> has an old definition version of 0 and an old implementation version of 2. <P>
 Finally, you remove function <CODE>moo</CODE>, so that only <CODE>new_moo</CODE> is supported, and build version 3 of the import library. Fragments built with older versions of the import library won't run with version 3 because they expect <CODE>moo</CODE> to be present. However, fragments built with version 3 run on machines that contain any version that has an implementation for <CODE>new_moo</CODE> (in this case, version 2 or version 3). Therefore, version 3 of <CODE>mooLib</CODE> should have a old definition version of 3 and an old implementation version of 2. <P>
 A drawback of simple PEF versioning is that if a compatible implementation library is not found, the program fails. Although this result is the same as using no versioning at all, PEF versioning can also prevent incompatible usage in cases where the symbols have not changed. In addition, PEF versioning acts as a redundancy check for possible library mismatches during development. Note that even when a compatible library is found, the client fragment cannot determine which version of the library was actually used. <P>
 In addition, each version number can represent only a single compatibility range. Depending on how the developer changes the library, it is possible to have pockets of compatibility appear in older versions that cannot be represented by the version numbers. As a trivial example, say you create a version 4 of <CODE>mooLib</CODE> that restores the function <CODE>moo</CODE>. Fragments built with version 4 cannot run with version 3 because version 3 does not contain <CODE>moo</CODE>; the old definition version number must be 4. However, this choice also disqualifies version 2, which does contain <CODE>moo</CODE> and would be a compatible library. <P>
 <A NAME=MARKER-2-53></A>In some cases, the developer can increase the compatibility ranges by designating weak symbols in addition to PEF versioning. For example, say you have a library <CODE>dogLib</CODE> with the functions <CODE>woof </CODE>and <CODE>arf</CODE>. Normally, if you add a new function <CODE>bark</CODE> to <CODE>dogLib</CODE>, you must increase the current and old implementation version numbers as in the previous example. However, if the fragment that imports from <CODE>dogLib</CODE> declares <CODE>bark</CODE> to be weak, you have a little more flexibility. For example, if version 0 is the original <CODE>dogLib</CODE> and version 1 contains the <CODE>bark</CODE> function, the following are true:<P>
<UL>
<LI>A client fragment built with version 0 of <CODE>dogLib</CODE> can run with either version 0 or version 1, since it neither knows about nor uses <CODE>bark</CODE>. 
<LI>A client fragment built with version 1 of <CODE>dogLib</CODE> can run with either version 0 or version 1 if the client declares <CODE>bark</CODE> to be weak. (Note that the client fragment must check for the presence of <CODE>bark</CODE> and use it only if it is available.) <P>
</UL>
 Therefore, if <CODE>bark</CODE> is weak, version 1 of <CODE>dogLib</CODE> can have both its old definition and old implementation version numbers set to 0. <A HREF=#MARKER-9-54>Figure 3-3</A> shows the version numbers for both variations of <CODE>bark</CODE>.<P>
<B>Figure 3-3  <A NAME=MARKER-9-54></A>Version numbering with weak imports<A NAME=MARKER-2-55></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-83.jpg"> <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
