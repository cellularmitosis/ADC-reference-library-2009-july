<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Open Directory Programming Guide: Working with Nodes</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Working with Nodes"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000917-CH5" title="Working with Nodes"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000429" target="_top">Networking</a> &gt; <a href="../../../MacOSXServer-date.html#//apple_ref/doc/uid/TP30000440-TP30000429-TP30000542" target="_top">Mac OS X Server</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40000917-CH1-DontLinkElementID_4">Open Directory Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../openDirectoryConcepts/openDirectoryConcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../workingWithRecords/workingWithRecords.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000917-CH5-SW1" title="Working with Nodes"></a><h1>Working with Nodes</h1><p>This chapter provides sample code that shows how to work with nodes. Finding a specific node, opening a session with the node, and authenticating a user to the node are fundamental Open Directory tasks.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51046">Listing Registered Nodes</a>
				
			<br/>
			
        
			
			
				<a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51136">Finding a Node</a>
				
			<br/>
			
        
			
			
				<a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-SW6">Opening and Closing a Node</a>
				
			<br/>
			
        
			
			
				<a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51379">Authenticating a User to a Node</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000917-CH5-51046" title="Listing Registered Nodes"></a><h2>Listing Registered Nodes</h2><p>The sample code in <span class="content_text">Listing 2-1</span> demonstrates how to get a list of all registered nodes. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its own <code>ListNodes</code> routine.</p><p>The <code>ListNodes</code> routine calls <code>dsGetDirNodeCount</code> to get the number of registered nodes. If the number of registered nodes is not zero, <code>ListNodes</code> calls <code>dsDataBufferAllocate</code> to allocate a data buffer and then calls <code>dsGetDirNodeList</code> to fill the buffer with the list of registered node names. The <code>ListNodes</code> routine then calls <code>dsDataListAllocate </code>to allocate a data list and <code>dsGetDirNodeName</code> to fill the data list with registered node names from the data buffer. The <code>ListNodes</code> routine then calls its own <code>PrintNodeName</code> routine to print the node names and passes to it a pointer to the data list.</p><p>The <code>PrintNodeName</code> routine calls <code>dsGetPathFromList</code> to get a node name from the data list and prints the name.</p><p>When the <code>PrintNodeName</code> routine returns, the <code>ListNodes</code> routine cleans up by calling <code>dsDataListDeallocate</code> and <code>free()</code> to deallocate the data list.</p><a name="//apple_ref/doc/uid/TP40000917-CH5-51127" title="Listing 2-1Listing registered nodes"></a><a name="//apple_ref/doc/uid/TP40000917-CH5-SW2" title="Listing 2-1Listing registered nodes"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Listing registered nodes</p><div class="codesample"><table><tr><td scope="row"><pre>tDirReference gDirRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        ListNodes();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void ListNodes ( void ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    bool done = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long index = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long nodeCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long bufferCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataBufferPtr dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataListPtr nodeName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tContextData context = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsGetDirNodeCount( gDirRef, &amp;nodeCount );<span></span></pre></td></tr><tr><td scope="row"><pre>    printf( "Registered node count is: %lu\n", nodeCount  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( (dirStatus == eDSNoErr) &amp;&amp; (nodeCount != 0) )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        //Allocate a 32k buffer.<span></span></pre></td></tr><tr><td scope="row"><pre>        dataBuffer = dsDataBufferAllocate( gDirRef, 32 * 1024 );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dataBuffer != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            while ( (dirStatus == eDSNoErr) &amp;&amp; (done ==  false) )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsGetDirNodeList( gDirRef, dataBuffer,  &amp;bufferCount,  &amp;context );<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    for ( index = 1; index &lt;= bufferCount; index++  )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsGetDirNodeName( gDirRef, dataBuffer,  index,  &amp;nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            printf( "#%4ld ", index );<span></span></pre></td></tr><tr><td scope="row"><pre>                            PrintNodeName( nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                            //Deallocate the data list containing  the node name.<span></span></pre></td></tr><tr><td scope="row"><pre>                            dirStatus = dsDataListDeallocate( gDirRef,  nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                            free(nodeName);<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                        else<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            printf("dsGetDirNodeName error  = %ld\n", dirStatus );<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                done = (context == NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            if (context != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                dsReleaseContinueData( gDirRef, context );<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataBufferDeAllocate( gDirRef, dataBuffer );<span></span></pre></td></tr><tr><td scope="row"><pre>            dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // ListNodes<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void PrintNodeName ( tDataListPtr inNode ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char* pPath;<span></span></pre></td></tr><tr><td scope="row"><pre>    pPath = dsGetPathFromList( gDirRef, inNode, "/" );<span></span></pre></td></tr><tr><td scope="row"><pre>    printf( "%s\n", pPath );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( pPath != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        free( pPath );<span></span></pre></td></tr><tr><td scope="row"><pre>        pPath = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // PrintNodeName<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000917-CH5-51136" title="Finding a Node"></a><h2>Finding a Node</h2><p>The sample code in <span class="content_text"><a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51278">Listing 2-2</a></span> demonstrates how to find the node for a specific pathname. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its own <code>FindNodes</code> routine and passes to it the pathname for the node that is to be found (<code>/NetInfo/root</code>).</p><p>The <code>FindNodes</code> routine calls <code>dsBuildFromPath</code> to build a data list for the pathname and calls <code>dsDataBufferAllocate</code> to allocate a data buffer in which to store the result of calling <code>dsFindDirNodes</code>. The routine then calls <code>dsFindDirNodes</code> to find the node whose name matches the specified pathname.</p><p>Then the <code>FindNodes</code> routine calls <code>dsDataListAllocate</code> to allocate a data list and provides that data list as a parameter when it calls <code>dsGetDirNodeName</code>. The <code>dsGetDirNodeName</code> function copies the node name from the data buffer filled in by <code>dsFindDirNodes</code> to the data list. Then the <code>FindNodes</code> routine calls its <code>PrintNodeName</code> routine to print the node name that was found. The <code>PrintNodeName</code> routine is described in the section <span class="content_text"><a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51127">Listing 2-1</a></span>.</p><p>When the <code>PrintNodeName</code> routine returns, the <code>FindNodes</code> routine cleans up by calling <code>dsDataListDeallocate</code> and <code>free()</code> to deallocate the data list.</p><a name="//apple_ref/doc/uid/TP40000917-CH5-51278" title="Listing 2-2Finding the node for a pathname"></a><a name="//apple_ref/doc/uid/TP40000917-CH5-SW3" title="Listing 2-2Finding the node for a pathname"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Finding the node for a pathname</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        FindNodes("/NetInfo/root");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void FindNodes ( char* inNodePath ){<span></span></pre></td></tr><tr><td scope="row"><pre>    bool done = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long index = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long bufferCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataBufferPtr dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataListPtr nodeName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tContextData context = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    nodeName = dsBuildFromPath( gDirRef, inNodePath, "/");<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( nodeName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        //Allocate a 32k buffer.<span></span></pre></td></tr><tr><td scope="row"><pre>        dataBuffer = dsDataBufferAllocate( gDirRef, 32 * 1024 );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dataBuffer != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            while ( (dirStatus == eDSNoErr) &amp;&amp; (done ==  false) )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsFindDirNodes( gDirRef, dataBuffer,  nodeName,  eDSContains, &amp;bufferCount, &amp;context );<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    for ( index = 1; index &lt;= bufferCount; index++  )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsGetDirNodeName( gDirRef, dataBuffer,  index,  &amp;nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            printf( "#%4ld ", index );<span></span></pre></td></tr><tr><td scope="row"><pre>                            PrintNodeName( nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                            //Deallocate the nodes.<span></span></pre></td></tr><tr><td scope="row"><pre>                            dirStatus = dsDataListDeallocate( gDirRef,  nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>                            free(nodeName);<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                        else<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            printf("dsGetDirNodeName error  = %ld\n", dirStatus );<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                done = (context == NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsDataBufferDeAllocate( gDirRef, dataBuffer  );<span></span></pre></td></tr><tr><td scope="row"><pre>            dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // FindNodes<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000917-CH5-51298" title="Opening and Closing a Node"></a><a name="//apple_ref/doc/uid/TP40000917-CH5-SW6" title="Opening and Closing a Node"></a><h2>Opening and Closing a Node</h2><p>The sample code in <span class="content_text">Listing 2-3</span> demonstrates how to open and close a node. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated.</p><p>The <code>MyOpenDirNode</code> routine prints a prompt that solicits the entry of a node to open and calls <code>scanf()</code> to get the node’s name. It then calls <code>dsBuildFromPath</code> to build a data list containing the node name that was entered. It specifies the slash (<code>/</code>) character as the path delimiter. Then the <code>MyOpenDirNode</code> routine calls <code>dsOpenDirNode</code> to open the node. If the node can be opened, <code>dsOpenDirNode</code> stores in the node reference parameter a node reference that the application can use in subsequent calls to Open Directory functions that operate on the open node.</p><p>The <code>MyOpenDirNode</code> routine cleans up by calling <code>dsCloseDirNode</code> to close the node that was opened.</p><a name="//apple_ref/doc/uid/TP40000917-CH5-51370" title="Listing 2-3Opening a node"></a><a name="//apple_ref/doc/uid/TP40000917-CH5-SW4" title="Listing 2-3Opening a node"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Opening a node</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>long MyOpenDirNode ( tDirNodeReference *outNodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    char nodeName[ 256 ] = "\0";<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataListPtr nodePath = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    printf( "Open Node : " );<span></span></pre></td></tr><tr><td scope="row"><pre>    fflush( stdout );<span></span></pre></td></tr><tr><td scope="row"><pre>    scanf( "%s", nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>    printf( "Opening: %s.\n", nodeName );<span></span></pre></td></tr><tr><td scope="row"><pre>    nodePath = dsBuildFromPath( gDirRef, nodeName, "/"  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( nodePath != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsOpenDirNode( gDirRef, nodePath, outNodeRef  );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf( "Open succeeded. Node Reference = %lu\n",  (unsigned  long)outNodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            printf( "Open node failed. Err = %ld\n", dirStatus  );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    dsDataListDeallocate( gDirRef, nodePath );<span></span></pre></td></tr><tr><td scope="row"><pre>    free( nodePath );<span></span></pre></td></tr><tr><td scope="row"><pre>    return( dirStatus );<span></span></pre></td></tr><tr><td scope="row"><pre>} // MyOpenDirNode<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000917-CH5-51379" title="Authenticating a User to a Node"></a><h2>Authenticating a User to a Node</h2><p>To authenticate itself to the Open Directory for the purposes of reading, writing, or making changes to a node, an Open Directory client application calls <code>dsDoDirNodeAuth</code>. The <code>dsDoDirNodeAuth</code> function handles authentication methods that use one or more steps to complete the authentication process.</p><p>To determine the authentication methods that a node supports, call <code>dsGetDirNodeInfo</code> for the node and request the <code>kDSNAttrAuthMethod</code> attribute. For any particular user, some methods may not be supported. The available authentication methods depend on the authentication authority of the user that is being authenticated.</p><p>If the authentication methods that an authentication authority implements are known, the authentication authority may be used to deduce those authentication methods that are available for a user. Note, however, that it is possible to disable hash storage on a per-user basis, which has the effect of disabling some authentication methods that would otherwise be available.</p><a name="//apple_ref/doc/uid/TP40000917-CH5-103948" title="Directory Native Authentication"></a><h3>Directory Native Authentication</h3><p>The sample code <span class="content_text"><a href="workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-103977">Listing 2-4</a></span> demonstrates directory native authentication. In the sample code, the <code>inDirNodeRef</code> parameter contains a node reference for the node, <code>inUserName</code> parameter contains the user name that is to be authenticated to the node, the <code>inUserPassword</code> contains the password in cleartext that is to be used to authenticate the user name.</p><a name="//apple_ref/doc/uid/TP40000917-CH5-103977" title="Listing 2-4Authenticating using directory native authentication"></a><a name="//apple_ref/doc/uid/TP40000917-CH5-SW5" title="Listing 2-4Authenticating using directory native authentication"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Authenticating using directory native authentication</p><div class="codesample"><table><tr><td scope="row"><pre>Bool DoNodeNativeAuthentication ( const tDirReference inDirRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            const tDirNodeReference inDirNodeRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            const char *inUserName,<span></span></pre></td></tr><tr><td scope="row"><pre>                            const char *inUserPassword )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    //  Native authentication is a one step authentication scheme.<span></span></pre></td></tr><tr><td scope="row"><pre>    //  Step 1<span></span></pre></td></tr><tr><td scope="row"><pre>    //      Send: &lt;length>&lt;recordname><span></span></pre></td></tr><tr><td scope="row"><pre>    //            &lt;length>&lt;cleartextpassword><span></span></pre></td></tr><tr><td scope="row"><pre>    //   Receive: success or failure.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr anAuthType2Use = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataBufferPtr anAuthDataBuf = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataBufferPtr aAuthRespBuf = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirStatus aDirErr = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tContextData aContinueData = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    long aDataBufSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    long aTempLength = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    long aCurLength = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    bool aResult = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    // First, specify the type of authentication.<span></span></pre></td></tr><tr><td scope="row"><pre>    anAuthType2Use =  dsDataNodeAllocateString(inDirRef,kDSStdAuthNodeNativeClearTextOK);<span></span></pre></td></tr><tr><td scope="row"><pre>    // The following is an optional method of authentication that  allows the<span></span></pre></td></tr><tr><td scope="row"><pre>    // plug-in to choose the authentication method, but the client  can<span></span></pre></td></tr><tr><td scope="row"><pre>    // “restrict” the authentication request to be "secure"  and not use<span></span></pre></td></tr><tr><td scope="row"><pre>    // cleartext. Both authentication methods take the same buffer  arguments.<span></span></pre></td></tr><tr><td scope="row"><pre>    /* anAuthType2Use = dsDataNodeAllocate(inDirRef,  kDSStdAuthNodeNativeNoClearText); */<span></span></pre></td></tr><tr><td scope="row"><pre>    aDataBufSize += sizeof(long) + ::strlen(inUserName);<span></span></pre></td></tr><tr><td scope="row"><pre>    aDataBufSize += sizeof(long) + ::strlen(inUserPassword);<span></span></pre></td></tr><tr><td scope="row"><pre>    anAuthDataBuf = dsDataBufferAllocate(inDirRef, aDataBufSize);<span></span></pre></td></tr><tr><td scope="row"><pre>    aAuthRespBuf = dsDataBufferAllocate(inDirRef, 512); // For the  response.<span></span></pre></td></tr><tr><td scope="row"><pre>    // Put all of the authentication arguments into the data buffer.<span></span></pre></td></tr><tr><td scope="row"><pre>    aTempLength = ::strlen(inUserName);<span></span></pre></td></tr><tr><td scope="row"><pre>    ::memcpy(&amp;(anAuthDataBuf->fBufferData[aCurLength]), &amp;aTempLength,  sizeof(long));<span></span></pre></td></tr><tr><td scope="row"><pre>    aCurLength += sizeof(long);<span></span></pre></td></tr><tr><td scope="row"><pre>    ::memcpy(&amp;(anAuthDataBuf->fBufferData[aCurLength]), inUserName,  aTempLength);<span></span></pre></td></tr><tr><td scope="row"><pre>    aCurLength += aTempLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    aTempLength = ::strlen(inUserPassword);<span></span></pre></td></tr><tr><td scope="row"><pre>    ::memcpy(&amp;(anAuthDataBuf->fBufferData[aCurLength]), &amp;aTempLength,  sizeof(long));<span></span></pre></td></tr><tr><td scope="row"><pre>    aCurLength += sizeof(long);<span></span></pre></td></tr><tr><td scope="row"><pre>    ::memcpy(&amp;(anAuthDataBuf->fBufferData[aCurLength]), inUserPassword,  aTempLength);<span></span></pre></td></tr><tr><td scope="row"><pre>    aCurLength += aTempLength;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    anAuthBuff->fBufferLength = aDataBufSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    aDirErr = dsDoDirNodeAuth(inDirNodeRef, anAuthType2Use, true,  anAuthDataBuf,  aAuthRespBuf, &amp;aContinueData);<span></span></pre></td></tr><tr><td scope="row"><pre>    switch(aDirErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case eDSNoErr:<span></span></pre></td></tr><tr><td scope="row"><pre>            aResult = true;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            // If any other error, assume the name or password is  bad.<span></span></pre></td></tr><tr><td scope="row"><pre>            aResult = false;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    // Clean up allocations.<span></span></pre></td></tr><tr><td scope="row"><pre>    aDirErr = dsDataBufferDeAllocate(inDirRef, anAuthDataBuf);<span></span></pre></td></tr><tr><td scope="row"><pre>    anAuthDataBuf = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Don't need to keep the response.<span></span></pre></td></tr><tr><td scope="row"><pre>    aDirErr = dsDataBufferDeAllocate(inDirRef, aAuthRespBuf);<span></span></pre></td></tr><tr><td scope="row"><pre>    aAuthRespBuf = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Don't need the authentication type value. Build a new one  if needed<span></span></pre></td></tr><tr><td scope="row"><pre>    // later.<span></span></pre></td></tr><tr><td scope="row"><pre>    aDirErr = dsDataNodeDeAllocate(inDirRef, anAuthType2Use);<span></span></pre></td></tr><tr><td scope="row"><pre>    anAuthType2Use = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Return the result of the authentication.<span></span></pre></td></tr><tr><td scope="row"><pre>    return (aResult);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../openDirectoryConcepts/openDirectoryConcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../workingWithRecords/workingWithRecords.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-01-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Networking/Conceptual/Open_Directory/workingWithNodes/workingWithNodes.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Networking/Conceptual/Open_Directory/workingWithNodes/workingWithNodes.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Networking/Conceptual/Open_Directory/workingWithNodes/workingWithNodes.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>