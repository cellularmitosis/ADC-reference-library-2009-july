<!-- legacy work start -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- legacy work end -->


<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)

LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Finding and Changing Component Capabilities (IM: S)  (deprecated)</Title>

<!-- legacy work start -->
        <META NAME="Generator" CONTENT="manual">
        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">
        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">
        <META NAME="IndexTitle" CONTENT="Inside Macintosh: Sound (Not Recommended)">
        <meta name="xcode-display" content="render">

        <LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->
        <script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
<!-- legacy work end -->

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME=HEADING276></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Sound-275.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-277.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Sound-2.html"><B>Sound</B></A> / <BR><DD><A HREF="Sound-266.html"><B>Chapter 5 - Sound Components</B></A> / <A HREF="Sound-271.html"><B>Writing a Sound Component</B></A></DL></FONT><P>
<HR>

<!-- legacy work start -->
<script type="text/javascript"> placeWatermark()</script>
<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
<i>Inside Macintosh: Sound</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="../../../referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div>
<!-- legacy work end -->


<BLOCKQUOTE>
<A NAME=HEADING276-0></A>
<H2><A NAME=MARKER-9-61></A>Finding and Changing Component Capabilities</H2>
 <A NAME=MARKER-2-45></A>All sound components take a stream of input data and produce a (usually different) stream of output data. The Sound Manager needs to know what operations your component can perform, so that it knows what other sound components might need to be linked together to play a particular sound on the available sound output device. It calls your component's <CODE>SoundComponentGetInfo</CODE> and <CODE>SoundComponentSetInfo</CODE> functions to get and set information about the capabilities and current settings of your sound component.<A NAME=MARKER-2-585></A><P>
 To specify the kind of information it wants to get or set, the Sound Manager passes your component a <B>sound component information selector.</B> If your component does not support a particular selector, if should pass the selector to the specified sound source. If your component does support the selector, it should either return the desired information directly or alter its settings as requested.<A NAME=MARKER-2-64></A><A NAME=MARKER-2-65></A><P>
 The sound component information selectors can specify any of a large number of audio capabilities or component settings. For example, the selector <CODE>siRateMultiplier</CODE> is passed to get or set the current output sample rate multiplier value.<P>
<DL>
<DT><B>Note</B>
<DD>The Sound Manager uses many of the sound input device information selectors defined by the Sound Input Manager for communicating with sound input devices. See "Sound Input Manager" in this book for a description of the sound input device information selectors. A complete list of all sound component information selectors is provided in <A HREF=Sound-279.html#MARKER-9-73>"Sound Component Information Selectors" beginning on page 5-22</A>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A NAME=MARKER-2-551></A>Your component's <CODE>SoundComponentGetInfo</CODE> function has the following declaration:<P>
<PRE>
pascal ComponentResult SoundComponentGetInfo (ComponentInstance ti, 
                                       SoundSource sourceID, OSType selector, 
                                       void *infoPtr);
</PRE>
 The sound component information selector is passed in the <CODE>selector</CODE> parameter. The sound source is identified by the source ID passed in the <CODE>sourceID</CODE> parameter. The <CODE>infoPtr</CODE> parameter specifies the location in memory of the information returned by <CODE>SoundComponentGetInfo</CODE>. If the information to be returned occupies four bytes or fewer, you can simply return the information in the location pointed to by that parameter. Otherwise, you should pass back in the <CODE>infoPtr</CODE> parameter a pointer to a record of type <CODE>SoundInfoList</CODE>, which contains an integer and a handle to an array of data items. In the second case, you'll need to allocate memory to hold the information you need to pass back. <A HREF=#MARKER-9-67>Listing 5-5</A> defines a component's <CODE>SoundComponentGetInfo</CODE> routine. It returns information to the Sound Manager about its capabilities and current settings.<P>
<B>Listing 5-5  <A NAME=MARKER-9-67></A>Getting sound component information</B><P>
<PRE>
static pascal ComponentResult MySoundComponentGetInfo 
                     (SoundComponentGlobalsPtr globals, SoundSource sourceID, 
                        OSType selector, void *infoPtr)
{
   HandleListPtr        listPtr;
   short                *sp, i;
   UnsignedFixed        *lp;
   Handle               h;
   HardwareGlobalsPtr   hwGlobals = globals-&gt;hwGlobals;
   ComponentResult      result = noErr;

   /*Make sure we got our global variables.*/
   if (hwGlobals == nil)
      return (notEnoughHardwareErr);

   switch (selector)
   {
      case siSampleSize:                  /*return current sample size*/
         *((short *) infoPtr) = hwGlobals-&gt;sampleSize;
         break;

      case siSampleSizeAvailable:         /*return sample sizes available*/
         h = NewHandle(sizeof(short) * kSampleSizesCount);
         if (h == nil)
            return (MemError());

         listPtr = (HandleListPtr) infoPtr;
         listPtr-&gt;count = 0;              /*num. sample sizes in handle*/
         listPtr-&gt;handle = h;             /*handle to be returned*/

         sp = (short *) *h;               /*store sample sizes in handle*/

         for (i = 0; i &lt; kSampleSizesCount; ++i)
            if (hwGlobals-&gt;sampleSizesActive[i])
            {
               listPtr-&gt;count++;
               *sp++ = hwGlobals-&gt;sampleSizes[i];
            }
         break;

      case siSampleRate:                  /*return current sample rate*/
         *((Fixed *) infoPtr) = hwGlobals-&gt;sampleRate;
         break;

      case siSampleRateAvailable:         /*return sample rates available*/
         h = NewHandle(sizeof(UnsignedFixed) * kSampleRatesCount);
         if (h == nil)
            return (MemError());

         listPtr = (HandleListPtr) infoPtr;
         listPtr-&gt;count = 0;              /*num. sample rates in handle*/
         listPtr-&gt;handle = h;             /*handle to be returned*/

         lp = (UnsignedFixed *) *h;

         /*If the hardware can support a range of sample rate values,
           the list count should be set to 0 and the minimum and maximum
           sample rate values should be stored in the handle.*/
         if (hwGlobals-&gt;supportsRateRange)
         {
            *lp++ = hwGlobals-&gt;sampleRateMin;
            *lp++ = hwGlobals-&gt;sampleRateMax;
         }
         
         /*If the hardware supports a limited set of sample rates, 
           the list count should be set to the number of sample rates 
           and this list of rates should be stored in the handle.*/
         else
         {
            for (i = 0; i &lt; kSampleRatesCount; ++i)
               if (hwGlobals-&gt;sampleRatesActive[i])
               {
                  listPtr-&gt;count++;
                  *lp++ = hwGlobals-&gt;sampleRates[i];
               }
         }
         break;

      case siNumberChannels:              /*return current num. channels*/
         *((short *) infoPtr) = hwGlobals-&gt;numChannels;
         break;

      case siChannelAvailable:            /*return channels available*/
         h = NewHandle(sizeof(short) * kChannelsCount);
         if (h == nil)
            return (MemError());

         listPtr = (HandleListPtr) infoPtr;
         listPtr-&gt;count = 0;              /*num. channels in handle*/
         listPtr-&gt;handle = h;             /*handle to be returned*/

         sp = (short *) *h;               /*store channels in handle*/

         for (i = 0; i &lt; kChannelsCount; ++i)
            if (hwGlobals-&gt;channelsActive[i])
            {
               listPtr-&gt;count++;
               *sp++ = hwGlobals-&gt;channels[i];
            }
         break;

      case siHardwareVolume:
         *((long *)infoPtr) = hwGlobals-&gt;volume;
         break;

      /*If you do not handle a selector, delegate it up the chain.*/
      default:
         result = SoundComponentGetInfo(globals-&gt;sourceComponent, sourceID, 
                                    selector, infoPtr);
         break;
   }
   return (result);
}
</PRE>
 You can define your <CODE>MySoundComponentSetInfo</CODE> routine in an exactly similar fashion.<A NAME=MARKER-2-68></A><A NAME=MARKER-2-564></A><A NAME=MARKER-2-553></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Sound-275.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-277.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Sound-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
