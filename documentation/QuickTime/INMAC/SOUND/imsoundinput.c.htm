<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Responding to Status and Control Requests (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound Manager</I><P>| <A target="doc" HREF="imsoundinput.b.htm">Previous</A> | <A target="doc" HREF="imsoundinput.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundinput.htm">Chapter top</A> | <A target="doc" HREF="imsoundinput.b.htm">Section top</A> | <A target="doc" HREF="imsoundinput.d.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H3.Heading3"><A NAME="pgfId=1123"> </A>Responding to Status and Control Requests</H1><P CLASS="T0.Text0"><A NAME="pgfId=1125"> </A>The Sound Input Manager supports sound input device information selectors by sending your device driver Status and Control requests. It uses Status requests to get information about your device; it uses Control requests to change settings of your sound input device.</P><P CLASS="T1.Text1"><A NAME="pgfId=1126"> </A>The behavior of your sound input device driver in response to Status and Control requests depends on the value of the <TT CLASS="cv">csCode</TT> field of the Device Manager control parameter block. If the <TT CLASS="cv">csCode</TT> field contains 2, then the sound input information selector is passed in the first 4 bytes of the <TT CLASS="cv">csParam</TT> field of the Device Manager control parameter block. For Status requests, the next 18 bytes can be used for your device driver to pass information back to an application. For Control requests, these 18 bytes are used by an application to pass data to your sound input device driver.<A NAME="marker=545"> </A><A NAME="marker=341"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=594"> </A><A target="doc" HREF="imsoundinput.c.htm#17480" CLASS="XRef">Figure&nbsp;10</A> shows the contents of the <TT CLASS="cv">csParam</TT> field of the Device Manager control parameter block for a sample Status request. The first four bytes of the <TT CLASS="cv">csParam</TT> field contain the input selector <TT CLASS="cv">'srav'</TT>, which is a request for the available sample rates. The next four bytes of the field contain a pointer to an application-supplied buffer in which to return the data (the number of rates available) from the Status request.</P><P CLASS="Fg.Figure"><A NAME="pgfId=610"> </A>Figure&nbsp;10 <A NAME="17480"> </A>An example of the <TT CLASS="cv">csParam</TT> field for a Status request</P><DIV><IMG SRC="imsoundinput-1.gif"></DIV><P CLASS="T1.Text1"><A NAME="pgfId=612"> </A>On exit from the Status request, your sound input device driver can respond in one of two ways. If you are returning fewer than 18 bytes of data, your device driver should specify in the first 4 bytes of the <TT CLASS="cv">csParam</TT> field of the Device Manager control parameter block the number of bytes of data being returned and place the data in the following 18 bytes. In this case, the Sound Input Manager copies the data to the application-supplied buffer identified in <A target="doc" HREF="imsoundinput.c.htm#17480" CLASS="XRef">Figure&nbsp;10</A>. If you are returning more than 18 bytes of data, your device driver should copy the data to the application-supplied buffer. In this case, your&nbsp;device driver needs to place a zero in the first 4 bytes of the <TT CLASS="cv">csParam</TT> field to indicate to the Sound Input Manager that the data has already been copied to the application-supplied buffer.</P><P CLASS="T1.Text1"><A NAME="pgfId=619"> </A><A target="doc" HREF="imsoundinput.c.htm#42370" CLASS="XRef">Figure&nbsp;11</A> shows the contents of the <TT CLASS="cv">csParam</TT> field of the Device Manager control parameter block for a sample Control request. The first four bytes of the <TT CLASS="cv">csParam</TT> field contain the input selector <TT CLASS="cv">'srat'</TT> which determines the sample rate for the sound input device. The next eighteen bytes contain the data, which in this example is the sample rate to set for your sound input device. This is a <TT CLASS="cv">Fixed</TT> value of four bytes in length.</P><P CLASS="Fg.Figure"><A NAME="pgfId=656"> </A>Figure&nbsp;11 <A NAME="42370"> </A>An example of the <TT CLASS="cv">csParam</TT> field for a Control request</P><DIV><IMG SRC="imsoundinput-2.gif"></DIV><P CLASS="Note"><A NAME="pgfId=708"> </A>Some sound input information selectors require your sound input device driver to allocate a handle in which to store information. In this case, your driver should attempt to allocate an appropriately sized handle in the current heap zone. If allocation fails, your driver should return the appropriate Memory Manager result code. <A NAME="marker=350"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=1128"> </A>Your sound input device driver must respond to a core set of selectors, but the remaining selectors defined by Apple are optional. Your device driver might also define private selectors to support proprietary features. (Selectors containing all lowercase letters, however, are reserved by Apple.) The section <A target="doc" HREF="imsoundinput.a.htm#20620" CLASS="XRef">&quot;Getting and Setting Sound Input Device Information&quot;</A> lists the core selectors and other selectors that have been defined.<A NAME="marker=343"> </A><A NAME="marker=342"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=1130"> </A>If the <TT CLASS="cv">csCode</TT> field contains 1 (which can occur only for Control requests), the Sound Input Manager is attempting to stop asynchronous recording; that is, it is issuing a <TT CLASS="cv">KillIO</TT> request. In response to this, the driver should stop copying data to the application buffer, update the <TT CLASS="cv">ioActCount</TT> field of the request parameter block, and return via an <TT CLASS="cv">RTS</TT> instruction.<A NAME="marker=344"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=1131"> </A>Before exiting after a Status and Control request, your sound input device driver should fill the D0 register with the appropriate result code or <TT CLASS="cv">noErr</TT>. To exit, your sound input device driver should check whether the Status and Control request was executed immediately or was queued.</P><P CLASS="Note"><A NAME="pgfId=613"> </A>In current versions of system software, the Sound Input Manager always issues Status and Control requests immediately. This might change in future versions of system software. </P><P CLASS="T1.Text1"><A NAME="pgfId=624"> </A>Your sound input device driver can determine whether a request is issued immediately by checking the <TT CLASS="cv">noQueueBit</TT> in the <TT CLASS="cv">ioTrap</TT> field of the Device Manager control parameter block. If the request was made immediately, the Control routine should return via an <TT CLASS="cv">RTS</TT> instruction; if the request was queued, the Control routine should jump to the Device Manager's <TT CLASS="cv">IODone</TT> function via the global jump vector <TT CLASS="cv">JIODone</TT>. You need to make sure that the A0 and A1 registers are set the same as they are on entry to the device driver or <TT CLASS="cv">JIODone</TT> will fail. <A NAME="marker=366"> </A></P><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound Manager</I><P>| <A target="doc" HREF="imsoundinput.b.htm">Previous</A> | <A target="doc" HREF="imsoundinput.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundinput.htm">Chapter top</A> | <A target="doc" HREF="imsoundinput.b.htm">Section top</A> | <A target="doc" HREF="imsoundinput.d.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>