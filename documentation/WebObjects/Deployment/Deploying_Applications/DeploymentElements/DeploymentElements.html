<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Deployment Guide Using JavaMonitor: Managing Application Instances</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Managing Application Instances"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000063" title="Managing Application Instances"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../MacOSXServer/index.html#//apple_ref/doc/uid/TP30000440-TP30000426" target="_top">Mac OS X Server</a> &gt; <a href="../../../../MacOSXServer/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000426-TP30000592" target="_top">WebObjects</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30000059-TPXREF101">WebObjects Deployment Guide Using JavaMonitor</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../WebObjectsAdaptors/WebObjectsAdaptors.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Deployment/Deployment.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000063-BAJEBCEE" title="Managing Application Instances"></a><h1>Managing Application Instances</h1><p>This chapter provides a detailed description of JavaMonitor and wotaskd, two tools you use to manage the application instances running on your site, and it explains how instances communicate with wotaskd:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-BCIIEDEF">“Configuration Files”</a></span> provides an overview of the configuration files that can be used in your site.</p></li><li class="li"><p><span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-TPXREF105">“Lifebeats”</a></span> introduces lifebeats, the mechanism used by wotaskd processes to determine the status of the application instances that they manage.</p></li><li class="li"><p><span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-BCIDIJJJ">“wotaskd Processes”</a></span> explains how wotaskd processes ensure that the application instances they manage are always running. It also describes how to restrict access to wotaskd using JavaMonitor.</p></li><li class="li"><p><span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-SW1">“Security Issues with wotaskd”</a></span> lists the security risks when using wotaskd and JavaMonitor.</p></li><li class="li"><p><span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-BCIGDGEF">“Starting WebObjects Services”</a></span> shows you how to configure a computer to start wotaskd and JavaMonitor during its startup process.</p></li></ul><a name="//apple_ref/doc/uid/TP30000063-BCIIEDEF" title="Configuration Files"></a><h2>Configuration Files</h2><p>You use JavaMonitor<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_265"></a> to configure your site. With it you configure hosts<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_266"></a>, applications<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_267"></a>, and application instances<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_268"></a>. You also define schedules<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_269"></a> for restarting instances and choose the algorithm used to balance the user load among the instances of an application. For details on the tasks that you can perform using JavaMonitor, see <span class="content_text"><a href="../Deployment/Deployment.html#//apple_ref/doc/uid/TP30000064-TPXREF101">“Deployment Tasks.”</a></span></p><p>The <code>SiteConfig.xml</code><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_270"></a> file, which is maintained on each host’s deployment-configuration directory<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_271"></a> by wotaskd, stores the configuration choices you make in JavaMonitor. You should not modify the contents of this file directly. The user under which wotaskd runs must have read and write privileges<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_272"></a> to <code>SiteConfig.xml</code> and the user under which JavaMonitor runs must have read privileges<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_273"></a>.</p><p>You can create another configuration file (the HTTP adaptor configuration file), which is called <code>WOConfig.xml</code><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_274"></a> by default. This is the file the HTTP adaptor uses to obtain your site’s configuration when you choose the configuration file method for the adaptor.</p><p><span class="content_text">Figure 4-1</span> shows how the configuration files are distributed in a deployment with one web server and two application hosts. For information on how to generate the HTTP adaptor configuration file, see <span class="content_text"><a href="../WebObjectsAdaptors/WebObjectsAdaptors.html#//apple_ref/doc/uid/TP30000062-BBCGBGJA">“Creating the HTTP Adaptor Configuration File.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP30000063-BCIBBAGB" title="Figure 4-1WebObjects configuration-file distribution"></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>WebObjects configuration-file distribution</p><img src = "../Art/configurationfiles.gif" alt = "WebObjects configuration-file distribution" width="469" height="397"></div><br/><p>JavaMonitor reads the <code>SiteConfig.xml</code><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_275"></a> file when it starts up but never writes to it. wotaskd writes the <code>SiteConfig.xml</code><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_276"></a> file when instructed by JavaMonitor to do so—such as when existing entities are configured, added, or deleted. Furthermore, JavaMonitor tells wotaskd to update the <code>SiteConfig.xml</code> file only when you use it to change an aspect of your site’s configuration.</p><a name="//apple_ref/doc/uid/TP30000063-TPXREF105" title="Lifebeats"></a><h2>Lifebeats</h2><p>After adding an application<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_277"></a> to your site, you need to add instances of it as well. This allows the application’s users connect to it. One of the main goals of WebObjects Deployment is to provide you with tools that help you deploy a resilient site. To accomplish that, wotaskd restarts application instances<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_278"></a> that become unresponsive.</p><p>A <strong>lifebeat</strong><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_279"></a> is a status message that an application instance sends to a wotaskd process to keep it informed of the instance’s status. There are four kinds of lifebeats:</p><ul class="ul"><li class="li"><p>has started</p></li><li class="li"><p>is alive</p></li><li class="li"><p>will stop</p></li><li class="li"><p>will crash</p></li></ul><p>An application instance is configured by default to send lifebeats<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_280"></a> to a wotaskd process through TCP (Transmission Control Protocol) sockets<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_281"></a>. (A <strong>socket</strong><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_282"></a> is a mechanism through which two processes communicate.) Instances can also send lifebeats using UDP (User Datagram Protocol) sockets<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_283"></a>. UDP sockets use fewer resources than TCP sockets.</p><p>The lifebeat mechanism is how the state<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_284"></a> of your site is constantly updated. Lifebeats are sent from a separate execution thread in a WebObjects application and do not interfere with, nor are they affected by, normal request processing.</p><p>By default, application instances try to send a lifebeat every 30 seconds. If a failure occurs (there is no wotaskd process listening on the port indicated by <code>WOLifebeatDesinationPort</code><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_285"></a><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_286"></a>), the instance does the following:</p><ol class="ol"><li class="li"><p>Sends up to 10 TCP lifebeats until a response is received. After the tenth unanswered lifebeat, the instance goes to stage 2.</p></li><li class="li"><p>Sends UDP lifebeats (low-resource–lifebeat mode) until a response is received. If the instance cannot create a UDP socket, it goes back to stage 1. When the instance receives an acknowledgement, it resumes sending TCP lifebeats.</p></li></ol><p>The two-stage mechanism allows application instances to go into low-resource lifebeat mode if wotaskd isn’t running when the instance starts.</p><a name="//apple_ref/doc/uid/TP30000063-BCIDIJJJ" title="wotaskd Processes"></a><h2>wotaskd Processes</h2><p>WebObjects Deployment uses wotaskd<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_287"></a> to manage the application instances running on your application hosts. Its main task is to start up instances when hosts are restarted. To accomplish this, wotaskd itself has to be restarted when the host starts up. This is done by configuring wotaskd<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_288"></a> as a service started when the computer boots. By default, a wotaskd process running on port <code>1085</code> is configured as a service on all supported platforms. The implementation of this feature is platform-specific. See <span class="content_text"><a href="DeploymentElements.html#//apple_ref/doc/uid/TP30000063-BCIGDGEF">“Starting WebObjects Services”</a></span> for details.</p><p>You need to run a wotaskd process on every computer that you want to use as an application host<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_289"></a>. These processes constantly receive lifebeats from the application instances they manage. Lifebeats communicate the instance’s state and allow wostaskd to determine the state of the instances it oversees. A wotaskd process assumes that an application instance is dead<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_290"></a> if it does not receive a lifebeat within a certain period. For details, see <code>WOAssumeApplicationIsDeadMultiplier</code> in <em><a href="../../../WOAppProperties/index.html#//apple_ref/doc/uid/TP30001020" target="_top">WebObjects Application Properties Reference</a></em>.</p><p>When you restrict access<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_291"></a> to JavaMonitor with a password<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_292"></a>, wotaskd processes running on hosts configured in JavaMonitor are also protected: They do not respond to <code>http://&lt;hostname>:&lt;wotaskd-port></code>.</p><p>To access the state information of a particular wotaskd process, you use JavaMonitor’s Host page. See <span class="content_text"><a href="../Deployment/Deployment.html#//apple_ref/doc/uid/TP30000064-BCIEDJCG">“Viewing a Host’s Configuration”</a></span> for more information.</p><a name="//apple_ref/doc/uid/TP30000063-SW1" title="Security Issues with wotaskd"></a><h2>Security Issues with wotaskd</h2><p>It is very important to secure your website using a firewall to avoid security problems. Using wotaskd and JavaMonitor with Apache but without a firewall has the following security risks:</p><ul class="ul"><li class="li"><p>Passwords are sent in clear text.</p></li><li class="li"><p>There is no authentication mechanism between wotaskd and JavaMonitor.</p></li><li class="li"><p>The sockets used by wotaskd are not secure.</p></li></ul><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_19" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;To avoid serious security problems, any computer that runs JavaMonitor and wotaskd should always be behind a firewall. In addition, only one server per subnet should run JavaMonitor at any time. </p><p></p><div class="clear"></div></div><a name="//apple_ref/doc/uid/TP30000063-BCIGDGEF" title="Starting WebObjects Services"></a><h2>Starting WebObjects Services</h2><p><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_293"></a>You use JavaMonitor and wotaskd to build and troubleshoot your site. WebObjects provides ways that allow you to control some of the behavior of JavaMonitor and wotaskd. Specifically, you can determine whether they are started automatically when a computer starts up. That way, you have one less item to worry about if a computer goes down. On the other hand, if you prefer a more hands-on approach to site management, you can start and stop WebObjects services manually.</p><a name="//apple_ref/doc/uid/TP30000063-TPXREF106" title="Starting WebObjects Services Automatically on Mac OS X Server"></a><h3>Starting WebObjects Services Automatically on Mac OS X Server</h3><p>To set wotaskd and JavaMonitor to start automatically upon boot, you need to first add the WebObjects module to the Server Admin application. (On Mac OS X Server v10.4 the WebObjects module is already included.) To add the WebObjects module, choose General Settings > Services to display the list of services as shown in <span class="content_text">Figure 4-2</span>. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_20" title="Important:"></a><p><strong>Important:</strong>&nbsp;On Mac OS X Server v10.5 and later, you need to select the Advanced Server Configuration instead of the Standard Configuration when doing a clean install in order to select and configure the WebObjects module later. </p><p></p></div><br/><div><a name="//apple_ref/doc/uid/TP30000063-SW3" title="Figure 4-2General Settings pane"></a><p><strong>Figure 4-2&nbsp;&nbsp;</strong>General Settings pane</p><img src = "../Art/configwebmodule1.jpg" alt = "General Settings pane" ></div><br/><p>Select the WebObjects module and save your changes to display the WebObjects pane shown in <span class="content_text">Figure 4-3</span>. Next, select WebObjects in the outline view and select the Enable Monitor option to start JavaMonitor on boot.</p><br/><div><a name="//apple_ref/doc/uid/TP30000063-SW2" title="Figure 4-3WebObjects pane"></a><p><strong>Figure 4-3&nbsp;&nbsp;</strong>WebObjects pane</p><img src = "../Art/configwebmodule2.jpg" alt = "Figure" ></div><br/><p>You can also set wotaskd and JavaMonitor to start automatically from your command shell editor. To start wotaskd, open <code>/System/Library/LaunchDaemons/com.apple.wotaskd.plist</code> and set the <code>Disabled</code> key value to <code>false</code>. To start JavaMontior, open <code>/System/Library/LaunchDaemons/com.apple.womonitor.plist</code> and set the <code>Disabled</code> key value to <code>false</code>.</p><p>After setting these values, you need to either restart your server or use the <code>launchctl</code> application to load these property lists. For more information on <code>launchctl</code>, type <code>man launchctl</code> in your command shell editor.</p><p>Follow these steps to load the property lists manually:</p><ol class="ol"><li class="li"><p>Run launchctl as root.</p></li><li class="li"><p>Use the <code>list</code> command to verify that <code>com.webobjects.womonitor.plist</code> and<code> com.webobjects.wotaskd.plist</code> are listed.</p></li><li class="li"><p>If these files exist, load them manually using these commands:</p><p><code>load /System/Library/LaunchDaemons/com.apple.wotaskd.plist</code></p><p><code>load /System/Library/LaunchDaemons/com.apple.womonitor.plist</code></p></li><li class="li"><p>Start the services with the commands:</p><p><code>start com.webobjects.wotaskd</code></p><p><code>start com.webobjects.womonitor</code></p></li><li class="li"><p>Quit launchctl by typing <code>Control-c</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000063-TPXREF107" title="Starting JavaMonitor Manually"></a><h3>Starting JavaMonitor Manually</h3><p>To start JavaMonitor<a name="//apple_ref/doc/uid/TP30000063-DontLinkElementID_294"></a>, enter the following commands in your command shell editor:</p><div class="codesample"><table><tr><td scope="row"><pre>cd ($NEXT_ROOT)/System/Library/WebObjects/JavaApplications/JavaMonitor.woa<span></span></pre></td></tr><tr><td scope="row"><pre>./JavaMonitor<span></span></pre></td></tr></table></div><p>You should see output similar to that in <span class="content_text">Listing 4-1</span>.</p><a name="//apple_ref/doc/uid/TP30000063-BCIHEGJI" title="Listing 4-1Starting JavaMonitor"></a><p class="codesample"><strong>Listing 4-1&nbsp;&nbsp;</strong>Starting JavaMonitor</p><div class="codesample"><table><tr><td scope="row"><pre>Reading MacOSClassPath.txt ...<span></span></pre></td></tr><tr><td scope="row"><pre>Launching JavaMonitor.woa ...<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>Creating LifebeatThread now with: JavaMonitor 49490 ebruce.apple.com/17.203.33.19 1085 30000<span></span></pre></td></tr><tr><td scope="row"><pre>Opening application's URL in browser:<span></span></pre></td></tr><tr><td scope="row"><pre>http://ebruce.apple.com:49490/cgi-bin/WebObjects/JavaMonitor<span></span></pre></td></tr><tr><td scope="row"><pre>Waiting for requests...<span></span></pre></td></tr></table></div><p>A page like the one in <span class="content_text">Figure 4-4</span> should display in your web browser. If your browser is not launched automatically, you can copy the URL from your shell and paste it into your browser’s address field.</p><br/><div><a name="//apple_ref/doc/uid/TP30000063-BCIECBJF" title="Figure 4-4JavaMonitor&acirc;&#128;&#148;empty Applications page"></a><p><strong>Figure 4-4&nbsp;&nbsp;</strong>JavaMonitor—empty Applications page</p><img src = "../Art/monitor.gif" alt = "JavaMonitor—empty Applications page" width="494" height="337"></div><br/>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../WebObjectsAdaptors/WebObjectsAdaptors.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Deployment/Deployment.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Deployment/Deploying_Applications/DeploymentElements/DeploymentElements.html%3Fid%3DTP30001009-4.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Deployment/Deploying_Applications/DeploymentElements/DeploymentElements.html%3Fid%3DTP30001009-4.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Deployment/Deploying_Applications/DeploymentElements/DeploymentElements.html%3Fid%3DTP30001009-4.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>