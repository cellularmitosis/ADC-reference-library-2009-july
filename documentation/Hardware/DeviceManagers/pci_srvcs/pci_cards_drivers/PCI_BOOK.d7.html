<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Low Power Mode Support Calls</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d6.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d8.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=4702"> </A>Low Power Mode Support Calls</H1><P CLASS="T1.Text1"><A NAME="pgfId=4703"> </A>Control and status calls with <TT CLASS="cv">csCode</TT> = 70 are optional for all drivers. Making a control call with <TT CLASS="cv">csCode</TT> = 70 sets the device's <A NAME="marker=4704"> </A>power-saving mode, while a status call returns it. Information is passed in the following structure in <TT CLASS="cv">csParam[0]</TT>:</P><br><CODE CLASS="Cv.Code"><A NAME="pgfId=17416"> </A>enum {<BR>&nbsp;&nbsp;&nbsp;&nbsp;kcsGetPowerMode = 70 /* returns the current power mode*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;kcsSetPowerMode = 70 /* sets the current power mode*/<BR>};</CODE><br><CODE CLASS="Cv.Code"><A NAME="pgfId=17420"> </A>enum {<BR>&nbsp;&nbsp;&nbsp;&nbsp;pmActive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0, /* normal operation */<BR>&nbsp;&nbsp;&nbsp;&nbsp;pmStandby&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 1, /* minimal energy saving state; can go active<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in 5 seconds */<BR>&nbsp;&nbsp;&nbsp;&nbsp;pmIdle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 2, /* substantial energy savings; can go active <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;in 15 seconds */<BR>&nbsp;&nbsp;&nbsp;&nbsp;pmSleep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 3 &nbsp;/* maximum energy savings; device may be<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;turned off */<BR>};</CODE><br><CODE CLASS="Cv.Code"><A NAME="pgfId=17424"> </A>struct LowPowerMode<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned char mode;<BR>};</CODE><P CLASS="T1.Text1"><A NAME="pgfId=4709"> </A><A NAME="10393"> </A>The differences among these low power modes are the amount of energy savings and the time it takes to return to the active state. Each device driver must determine the appropriate level of energy saving support for the device that it drives. If the device can go into active state in all possible low power states within 5 seconds, it should map both <TT CLASS="cv">pmIdle</TT> and <TT CLASS="cv">pmSleep</TT> to <TT CLASS="cv">pmStandby</TT>. If the device takes a minimum of 10 seconds to go into active state from a low power state, then it should map <TT CLASS="cv">pmStandby</TT> to <TT CLASS="cv">pmActive</TT>. All device drivers should support these four modes; they should never return an error because they do not support a particular mode. Low power modes that are not possible on a given device should be mapped to other appropriate modes.</P><P CLASS="T1.Text1"><A NAME="pgfId=4710"> </A>For the device to become active, it is not required that the device driver get a control call telling it to make the device active. Any operation that requires the device to become active is sufficient. For example, if a hard disk driver currently has its drive in sleep mode and it gets a read call, it should automatically wake up the drive and respond to the read request. Once the drive is made active, the device driver requires a control call telling it to put the device into some other mode. It should not put the device into an inactive mode automatically unless it is managing the device's power state independently of the Mac&nbsp;OS Power Manager.</P><P CLASS="T1.Text1"><A NAME="pgfId=4711"> </A>Drivers that support low power mode calls should return true to the <TT CLASS="cv">'lpwr'</TT> <TT CLASS="cv">DriverGestalt</TT> call listed in <A HREF="PCI_BOOK.d2.html#23107" CLASS="XRef">Table&nbsp;8-5</A>. Drivers that do not support these calls should return false to the <TT CLASS="cv">'lpwr'</TT> <TT CLASS="cv">DriverGestalt</TT> call, return <TT CLASS="cv">controlErr</TT> to the <TT CLASS="cv">SetPowerMode</TT> (<TT CLASS="cv">csCode</TT> = 70) control call, and return <TT CLASS="cv">statusErr</TT> to the <TT CLASS="cv">GetPowerMode</TT> (<TT CLASS="cv">csCode</TT> = 70) status call.</P><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d6.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d8.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>