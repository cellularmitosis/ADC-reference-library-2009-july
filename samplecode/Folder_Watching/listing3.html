<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Folder Watching - /Folder Watcher FBA/FBAAppleEvents.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxInterapplicationCommunication-date.html">Interapplication Communication</a> &gt; <A HREF="javascript:location.replace('index.html');">Folder Watching</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Folder Watching</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Folder Watcher FBA/FBAAppleEvents.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Folder Watcher FBA/FBA.c</option>
<option value="listing2.html">/Folder Watcher FBA/FBA.h</option>
<option value="listing3.html">/Folder Watcher FBA/FBAAppleEvents.c</option>
<option value="listing4.html">/Folder Watcher FBA/FBAAppleEvents.h</option>
<option value="listing5.html">/Folder Watcher FBA/FBALists.c</option>
<option value="listing6.html">/Folder Watcher FBA/FBALists.h</option>
<option value="listing7.html">/Folder Watcher FBA/FBATask.c</option>
<option value="listing8.html">/Folder Watcher FBA/FBATask.h</option>
<option value="listing9.html">/FW Receiver/AppleEvents.c</option>
<option value="listing10.html">/FW Receiver/BareBones.c</option>
<option value="listing11.html">/FW Receiver/BareBones.h</option>
<option value="listing12.html">/FW Receiver/Events.c</option>
<option value="listing13.html">/FW Receiver/Initialize.c</option>
<option value="listing14.html">/FW Receiver/Lists.c</option>
<option value="listing15.html">/FW Receiver/Menus.c</option>
<option value="listing16.html">/FW Receiver/PatchListLDEF.c</option>
<option value="listing17.html">/FW Receiver/Prototypes.h</option>
<option value="listing18.html">/FW Receiver/Utilities.c</option>
<option value="listing19.html">/FW Receiver/Windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="Folder_Watching.zip">Download Sample</a></strong> (&#147;Folder_Watching.zip&#148;, 73.2K)<BR>
<strong><a href="Folder_Watching.dmg">Download Sample</a></strong> (&#147;Folder_Watching.dmg&#148;, 132.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    FBAAppleEvents.c  Contains:    Written by: Greg Sutton    Copyright:  Copyright &copy; 1996-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/21/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#include &quot;FBAAppleEvents.h&quot;#include &quot;FBA.h&quot;#include &quot;FBALists.h&quot;#include &lt;Events.h&gt;#include &lt;Errors.h&gt;#include &lt;AERegistry.h&gt;#include &lt;Gestalt.h&gt;#include &lt;Resources.h&gt;// prototypesstatic pascal OSErr HandleOpenApplication( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon );static pascal OSErr HandleQuitApplication( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon );static pascal OSErr HandleOpenDocuments( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon );static pascal OSErr HandlePrintDocuments( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon );static OSErr    HandleOpenDesc( AEDesc* theDesc );static OSErr    GetDescriptorData( const AEDesc* theDesc, Ptr destPtr, Size maxSize );static OSErr    GetTargetAppDesc( OSType theAppCreator, AEDesc* theTarget );// Globalsextern  short    gQuit;OSErr InitAppleEvents ( void ){  short err;  long response;    err = Gestalt( gestaltAppleEventsAttr, &amp;response );    if (noErr != err)      response = 0L;  if ( ! ( response &amp; (1 &lt;&lt; gestaltAppleEventsPresent)) )    return gestaltUndefSelectorErr;    err = AEInstallEventHandler ( kCoreEventClass, kAEOpenApplication,            NewAEEventHandlerProc(HandleOpenApplication), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEQuitApplication,            NewAEEventHandlerProc(HandleQuitApplication), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEOpenDocuments,            NewAEEventHandlerProc(HandleOpenDocuments), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEPrintDocuments,            NewAEEventHandlerProc(HandlePrintDocuments), 0L, false );done:      return err;}OSErr DoAppleEvent( EventRecord *event ){  short err = noErr;    err = AEProcessAppleEvent ( event );  return err;}static pascal OSErr HandleOpenApplication( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, theReply, theRefcon )#endif  // don't do anything here  return noErr;}static pascal OSErr HandleQuitApplication( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, theReply, theRefcon )#endif  gQuit = true;  return noErr;}// If we get a folder dropped onto the application then we'll add it to our// list of folders to watch.static pascal OSErr HandleOpenDocuments( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon ){#ifdef __MWERKS__  #pragma unused( theReply, theRefcon )#endif  AEDesc  directObj = { typeNull, NULL };  OSErr  err;  err = AEGetParamDesc( theAppleEvent, keyDirectObject, typeWildCard, &amp;directObj );  if ( noErr != err ) goto done;  err = HandleOpenDesc( &amp;directObj );done:  AEDisposeDesc( &amp;directObj );  return err;}static OSErr  HandleOpenDesc( AEDesc* theDesc ){  AEDesc    aDesc = { typeNull, NULL };  FSSpec    anFSSpec;  long    aCount;  DescType  anAEKeyword;  OSErr    err;  switch ( theDesc-&gt;descriptorType )  {    case typeAEList:      err = AECountItems( theDesc, &amp;aCount );      if ( noErr != err ) goto done;            for ( ; aCount &gt; 0; aCount-- )      {        err = AEGetNthDesc( theDesc, aCount, typeWildCard, &amp;anAEKeyword, &amp;aDesc );        if ( noErr != err ) goto done;                err = HandleOpenDesc( &amp;aDesc );        if ( noErr != err ) goto done;                AEDisposeDesc( &amp;aDesc );      }      break;        default:      err = AECoerceDesc( theDesc, typeFSS, &amp;aDesc );      if ( noErr != err ) goto done;            err = GetDescriptorData( &amp;aDesc, (Ptr)&amp;anFSSpec, sizeof( anFSSpec ) );      if ( noErr != err ) goto done;            if ( ! FolderInList( &amp;anFSSpec ) )        if ( AddFolder( &amp;anFSSpec ) )      // If this is a new folder to watch          AddFolderPathResource( &amp;anFSSpec );  // then add it to our resources.  }done:  AEDisposeDesc( &amp;aDesc );    return err;}static OSErr  GetDescriptorData( const AEDesc* theDesc, Ptr destPtr, Size maxSize ){  Size  copySize;  OSErr  err;    if ( typeNull == theDesc-&gt;descriptorType || ! theDesc-&gt;dataHandle )    return( errAENotAEDesc );  copySize = GetHandleSize( (Handle)theDesc-&gt;dataHandle );  if ( copySize &lt;= maxSize )  {    HLock( (Handle)theDesc-&gt;dataHandle );    BlockMoveData( *theDesc-&gt;dataHandle, destPtr, copySize );    HUnlock( (Handle)theDesc-&gt;dataHandle );  }  else    err = errAECorruptData;    return noErr;} // GetDescriptorDatastatic pascal OSErr HandlePrintDocuments( AppleEvent *theAppleEvent, AppleEvent *theReply, long theRefcon ){#ifdef __MWERKS__  #pragma unused(theAppleEvent, theReply, theRefcon )#endif  // Faceless Background Applications can't print documents  return errAEEventNotHandled;}OSErr  SendChangeEvent( ProcessSerialNumber* thePSN, FSSpec* theSpec, DescType theChangeType ){  AppleEvent     anAppleEvent = {typeNull,NULL},          aReply = {typeNull,NULL};  AEDesc       targetDesc = {typeNull,NULL},          specDesc = {typeNull,NULL};  OSErr       err;    err = AECreateDesc( typeProcessSerialNumber, (Ptr)thePSN,                              sizeof( ProcessSerialNumber ), &amp;targetDesc );  if ( noErr != err ) goto done;    // Create the AppleEvent  err = AECreateAppleEvent( kFolderWatcherSuite, theChangeType, &amp;targetDesc,                kAutoGenerateReturnID, kAnyTransactionID, &amp;anAppleEvent );  if ( noErr != err ) goto done;    err = AECreateDesc( typeFSS, (Ptr)theSpec, sizeof( FSSpec ), &amp;specDesc );  if ( noErr != err ) goto done;     err = AEPutParamDesc(&amp;anAppleEvent, keyDirectObject, &amp;specDesc );  if ( noErr != err ) goto done;         err = AESend( &amp;anAppleEvent, &amp;aReply, kAENoReply, kAENormalPriority,                        kAEDefaultTimeout, NULL, NULL );done:  AEDisposeDesc( &amp;anAppleEvent );  AEDisposeDesc( &amp;aReply );  AEDisposeDesc( &amp;targetDesc );  AEDisposeDesc( &amp;specDesc );        return err;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Folder_Watching/listing3.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Folder_Watching/listing3.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Folder_Watching/listing3.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>