<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>ASPUserWrite(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING216></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-215.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-217.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-204.html"><B>Chapter 8 - AppleTalk Session Protocol (ASP)</B></A> / <A HREF="Networking-206.html"><B>ASP Reference</B></A><BR><DL><DD><A HREF="Networking-209.html"><B>Routines</B></A> / <A HREF="Networking-214.html"><B>Sending Commands and Writing Data From the Workstation to the Server</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING216-0></A>
<H3>ASPUserWrite</H3>
 <A NAME=MARKER-11-85></A>The <A NAME=MARKER-9-65></A><CODE>ASPUserWrite</CODE> function transfers data <A NAME=MARKER-2-88></A>from the workstation to the server across a specific session.<P>
<PRE>
FUNCTION ASPUserWrite (thePBptr: XPPParmBlkPtr;
                       async: Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to an XPP parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean that specifies whether the function should be executed asynchronously or synchronously. Specify <CODE>TRUE</CODE> for asynchronous execution.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD><CODE>ioResult</CODE><TD>OSErr<TD>The function result.<TR>
<TD><--<TD>cmdResult<TD>LongInt<TD>The ASP command result.<TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .XPP driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always userWrite for this function.<TR>
<TD>--><TD>sessRefnum<TD>Integer<TD>The session reference number. <TR>
<TD>--><TD>aspTimeout<TD>Byte<TD>The retry interval in seconds.<TR>
<TD>--><TD>cbSize<TD>Integer<TD>The command block size.<TR>
<TD>--><TD>cbPtr<TD>Ptr<TD>A pointer to command blocks<EM>.</EM><TR>
<TD><-><TD>rbSize<TD>Integer<TD>The reply buffer size and reply size.<TR>
<TD>--><TD>rbPointer<TD>Ptr<TD>A pointer to the reply buffer.<TR>
<TD><-><TD>wdSize<TD>Integer<TD>The write data size.<TR>
<TD>--><TD>wdPtr<TD>Ptr<TD>The write data pointer.<TR>
<TD><--<TD>ccbStart<TD>Array<TD>The beginning of memory for the CCB.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>cmdResult</CODE>
<DD> The ASP command result consisting of 4 bytes of data returned by the server. The ASP client application defines the contents of the command result field. For example, AFP defines this field to specify the result of the AFP command. This field is valid if no system-level error is returned in the <CODE>ioResult</CODE> field.
<DT><CODE>sessRefnum</CODE>
<DD> The reference number of the session that you want to use to transfer data. The session reference number is the unique number that the .XPP driver assigned to this session when you opened the session by calling the <CODE>ASPOpenSession</CODE> function. 
<DT><CODE><A NAME=MARKER-2-1></A>aspTimeout</CODE>
<DD> The time in seconds after which ASP is to retry to send data across the session.   
<DT><CODE>cbSize</CODE>
<DD> The size in bytes of the command data that ASP is to transfer across the session. 
<DT><CODE>cbPtr</CODE>
<DD> A pointer to the buffer containing the command data to be transferred. 
<DT><CODE>rbSize</CODE>
<DD> On input, the size in bytes of the buffer that you allocated to contain the command reply that you expect to receive from the server. On return, the size in bytes of the reply data that was actually returned.
<DT><CODE>rbPointer</CODE>
<DD> A pointer to the buffer for the reply data. 
<DT><CODE><A NAME=MARKER-2-9></A>wdSize</CODE>
<DD> On input, the size in bytes of the of the write data that the command is to send. On return, the size in bytes of the write data that was actually sent. 
<DT><CODE><A NAME=MARKER-2-89></A>wdPtr</CODE>
<DD> A pointer to the buffer containing the data to be written.  
<DT><CODE>ccbStart</CODE>
<DD> The beginning of the memory for the command control block (CCB) that the .XPP driver is to use. The maximum size of this block <BR>is 296 bytes. The CCB is an array that is part of the .XPP <BR>parameter block. 
</DL>
<A NAME=HEADING216-16></A>
<H5>DESCRIPTION</H5>
 The <CODE>ASPUserWrite</CODE> function allows you to transfer a variable-size block of data to the server end of the ASP session and receive a reply. If you have previously called the <CODE>ASPUserCommand</CODE> function to send a command that directs the ASP server to open a file, you can call the <CODE>ASPUserWrite</CODE> function to write data to the file. <P>
 The .XPP driver uses the memory at the end of the XPP parameter block defined as <BR>a <CODE>CCBStart</CODE> array as an internal command control block (CCB). To ensure that the function executes successfully, you can specify the maximum size for this array as indicated in particular for the function that uses it. If you want to limit the amount <BR>of memory used for the CCB, you can specify the minimum amount of memory <BR>required for this array. <P>
 A command result error is returned in the <CODE>cmdResult</CODE> field. All other types of errors <BR>are returned in the function's parameter block <CODE>ioResult</CODE> field. Error reporting for <BR>the <CODE>ASPUserWrite</CODE> function is the same as for the <CODE>ASPUserCommand</CODE>.<P>
<A NAME=HEADING216-20></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Note that you must provide the .XPP driver reference number as an input parameter <BR>to this function. You can obtain the driver reference number by calling the Device Manager's <CODE>OpenDriver</CODE> function. <P>
<A NAME=HEADING216-22></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>ASPUserWrite</CODE> function from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>userWrite</CODE> in the <CODE>csCode</CODE> field of the parameter block. You must also specify the .XPP driver reference number. To execute the <CODE>_Control</CODE> trap asynchronously, include the value <CODE>,ASYNC</CODE> in the operand field.<P>
<A NAME=HEADING216-24></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>aspBufTooSmall<TD>-1067<TD>The reply data exceeds the size of the reply buffer; the .XPP driver will fill the buffer and truncate <BR>the data<TR>
<TD>aspParamErr<TD>-1070<TD>You specified an invalid session reference number, <BR>or the session has been closed <TR>
<TD>aspSessClosed<TD>-1072<TD>The .XPP driver is in the process of closing <BR>the session <TR>
<TD>aspSizeErr<TD>-1073<TD>The size of the command block exceeds the <BR>maximum size of 296 bytes</TABLE>
</H5>
<A NAME=HEADING216-25></A>
<H5>SEE ALSO </H5>
 <A NAME=MARKER-2-59></A>To send a command to the server to direct it to perform a prerequisite action before you use the <CODE>ASPUserWrite</CODE> command to write data, use the <CODE>ASPUserCommand</CODE> function, described on <A HREF=Networking-215.html#MARKER-9-68>page 8-15</A>. To determine the minimum amount of memory required for the CCB or to find out more about the possible types of error conditions for which errors are returned and how these error results are reported,<A NAME=MARKER-2-92></A> see the description of the <CODE>ASPUserCommand</CODE> function. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-215.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-217.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
