<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MoreIsBetter - /MIB-Libraries/MoreDisks/MoreDisks.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">MoreIsBetter</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MoreIsBetter</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MIB-Libraries/MoreDisks/MoreDisks.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/MIB-Clients/Demos/MoreOpenAndSaveDemo/AnswerShell.c</option>
<option value="listing2.html">/MIB-Clients/MacCVSProTool/MacCVSProTool.c</option>
<option value="listing3.html">/MIB-Clients/SampleSubmit/SampleSubmit.c</option>
<option value="listing4.html">/MIB-Documentation/index.html</option>
<option value="listing5.html">/MIB-Documentation/MoreDocumentation/0ReleaseNotes.html</option>
<option value="listing6.html">/MIB-Documentation/MoreDocumentation/0toc.html</option>
<option value="listing7.html">/MIB-Documentation/MoreDocumentation/banner.html</option>
<option value="listing8.html">/MIB-Documentation/MoreDocumentation/BuildingAndUsing.html</option>
<option value="listing9.html">/MIB-Documentation/MoreDocumentation/ContributingToMoreIsBetter.html</option>
<option value="listing10.html">/MIB-Documentation/MoreDocumentation/copyright.html</option>
<option value="listing11.html">/MIB-Documentation/MoreDocumentation/index.html</option>
<option value="listing12.html">/MIB-Documentation/MoreDocumentation/intro.html</option>
<option value="listing13.html">/MIB-Documentation/MoreDocumentation/MoreAppearance.html</option>
<option value="listing14.html">/MIB-Documentation/MoreDocumentation/MoreAppleEvents.html</option>
<option value="listing15.html">/MIB-Documentation/MoreDocumentation/MoreCDs.html</option>
<option value="listing16.html">/MIB-Documentation/MoreDocumentation/MoreCodeFragments.html</option>
<option value="listing17.html">/MIB-Documentation/MoreDocumentation/MoreControls.html</option>
<option value="listing18.html">/MIB-Documentation/MoreDocumentation/MoreDevices.html</option>
<option value="listing19.html">/MIB-Documentation/MoreDocumentation/MoreDialogs.html</option>
<option value="listing20.html">/MIB-Documentation/MoreDocumentation/MoreDisks.html</option>
<option value="listing21.html">/MIB-Documentation/MoreDocumentation/MoreErrors.html</option>
<option value="listing22.html">/MIB-Documentation/MoreDocumentation/MoreEvents.html</option>
<option value="listing23.html">/MIB-Documentation/MoreDocumentation/MoreInterfaceLib.html</option>
<option value="listing24.html">/MIB-Documentation/MoreDocumentation/MoreLists.html</option>
<option value="listing25.html">/MIB-Documentation/MoreDocumentation/MoreMemory.html</option>
<option value="listing26.html">/MIB-Documentation/MoreDocumentation/MoreMenus.html</option>
<option value="listing27.html">/MIB-Documentation/MoreDocumentation/MoreMultiprocessing.html</option>
<option value="listing28.html">/MIB-Documentation/MoreDocumentation/MoreNavigation.html</option>
<option value="listing29.html">/MIB-Documentation/MoreDocumentation/MoreNetworkSetup.html</option>
<option value="listing30.html">/MIB-Documentation/MoreDocumentation/MoreOpenAndSave.html</option>
<option value="listing31.html">/MIB-Documentation/MoreDocumentation/MoreOpenTransport.html</option>
<option value="listing32.html">/MIB-Documentation/MoreDocumentation/MoreOSL.html</option>
<option value="listing33.html">/MIB-Documentation/MoreDocumentation/MoreOSUtils.html</option>
<option value="listing34.html">/MIB-Documentation/MoreDocumentation/MorePatches.html</option>
<option value="listing35.html">/MIB-Documentation/MoreDocumentation/MorePreferences.html</option>
<option value="listing36.html">/MIB-Documentation/MoreDocumentation/MoreProcesses.html</option>
<option value="listing37.html">/MIB-Documentation/MoreDocumentation/MoreQuickDraw.html</option>
<option value="listing38.html">/MIB-Documentation/MoreDocumentation/MoreResources.html</option>
<option value="listing39.html">/MIB-Documentation/MoreDocumentation/MoreTextUtils.html</option>
<option value="listing40.html">/MIB-Documentation/MoreDocumentation/MoreToolbox.html</option>
<option value="listing41.html">/MIB-Documentation/MoreDocumentation/MoreWindows.html</option>
<option value="listing42.html">/MIB-Libraries/MIB_Carbon.h</option>
<option value="listing43.html">/MIB-Libraries/MIB_SourceHeader.txt</option>
<option value="listing44.html">/MIB-Libraries/MoreAppearance/MoreAppearance.cp</option>
<option value="listing45.html">/MIB-Libraries/MoreAppearance/MoreAppearance.h</option>
<option value="listing46.html">/MIB-Libraries/MoreAppleEvents/MoreAEDataModel.c</option>
<option value="listing47.html">/MIB-Libraries/MoreAppleEvents/MoreAEDataModel.h</option>
<option value="listing48.html">/MIB-Libraries/MoreAppleEvents/MoreAEObjects.c</option>
<option value="listing49.html">/MIB-Libraries/MoreAppleEvents/MoreAEObjects.h</option>
<option value="listing50.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEvents.cp</option>
<option value="listing51.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEvents.h</option>
<option value="listing52.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEventsPlus.c</option>
<option value="listing53.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEventsPlus.h</option>
<option value="listing54.html">/MIB-Libraries/MoreAppleEvents/MoreFinderEvents.c</option>
<option value="listing55.html">/MIB-Libraries/MoreAppleEvents/MoreFinderEvents.h</option>
<option value="listing56.html">/MIB-Libraries/MoreAppleEvents/MoreOSA.c</option>
<option value="listing57.html">/MIB-Libraries/MoreAppleEvents/MoreOSA.h</option>
<option value="listing58.html">/MIB-Libraries/MoreAppleEvents/ProductInfo.txt</option>
<option value="listing59.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/Carbon.r</option>
<option value="listing60.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/HelloWorld.c</option>
<option value="listing61.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/Info.plist.r</option>
<option value="listing62.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/TestMoreAppleEvents.c</option>
<option value="listing63.html">/MIB-Libraries/MoreAppleEvents/VersionInfo.r</option>
<option value="listing64.html">/MIB-Libraries/MoreCarbonEvents/MoreCarbonEvents.c</option>
<option value="listing65.html">/MIB-Libraries/MoreCarbonEvents/MoreCarbonEvents.h</option>
<option value="listing66.html">/MIB-Libraries/MoreCFQ/MoreCFQ.c</option>
<option value="listing67.html">/MIB-Libraries/MoreCFQ/MoreCFQ.h</option>
<option value="listing68.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/CallMachOFramework.c</option>
<option value="listing69.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/CallMachOFramework.r</option>
<option value="listing70.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/Read Me CallMachOFramework.txt</option>
<option value="listing71.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/System Framework Stub/Stub Library Read Me.txt</option>
<option value="listing72.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CFMLateImport.c</option>
<option value="listing73.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CFMLateImport.h</option>
<option value="listing74.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/LateImportTest.c</option>
<option value="listing75.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/TestLibrary/TestLibrary.h</option>
<option value="listing76.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/TestLibrary/TestLibraryImpl.c</option>
<option value="listing77.html">/MIB-Libraries/MoreControls/MoreControls.cp</option>
<option value="listing78.html">/MIB-Libraries/MoreControls/MoreControls.h</option>
<option value="listing79.html">/MIB-Libraries/MoreCRC/MoreCRC.c</option>
<option value="listing80.html">/MIB-Libraries/MoreCRC/MoreCRC.h</option>
<option value="listing81.html">/MIB-Libraries/MoreDebugging/MoreAddrToSym.c</option>
<option value="listing82.html">/MIB-Libraries/MoreDebugging/MoreAddrToSym.h</option>
<option value="listing83.html">/MIB-Libraries/MoreDebugging/MoreBacktrace.c</option>
<option value="listing84.html">/MIB-Libraries/MoreDebugging/MoreBacktrace.h</option>
<option value="listing85.html">/MIB-Libraries/MoreDebugging/MoreBacktraceTest/MoreBacktraceTest.c</option>
<option value="listing86.html">/MIB-Libraries/MoreDebugging/MoreBBLog.c</option>
<option value="listing87.html">/MIB-Libraries/MoreDebugging/MoreBBLog.h</option>
<option value="listing88.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/GenerateFont/GenerateFont.c</option>
<option value="listing89.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.c</option>
<option value="listing90.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.h</option>
<option value="listing91.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.s</option>
<option value="listing92.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/TestInterruptSafeDebug/TestInterruptSafeDebug.c</option>
<option value="listing93.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/ReadMe.html</option>
<option value="listing94.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TestTradDriverLoaderLib/TestDriver/TestDriverMain.c</option>
<option value="listing95.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TestTradDriverLoaderLib/TestTradDriverLoader.c</option>
<option value="listing96.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TradDriverLoaderLib.c</option>
<option value="listing97.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TradDriverLoaderLib.h</option>
<option value="listing98.html">/MIB-Libraries/MoreDialogs/MoreDialogs.cp</option>
<option value="listing99.html">/MIB-Libraries/MoreDialogs/MoreDialogs.h</option>
<option value="listing100.html">/MIB-Libraries/MoreDisks/MoreCDs.c</option>
<option value="listing101.html">/MIB-Libraries/MoreDisks/MoreCDs.h</option>
<option value="listing102.html">/MIB-Libraries/MoreDisks/MoreDisks.c</option>
<option value="listing103.html">/MIB-Libraries/MoreDisks/MoreDisks.h</option>
<option value="listing104.html">/MIB-Libraries/MoreDisks/TestMoreDisks/TestMoreDisks.c</option>
<option value="listing105.html">/MIB-Libraries/MoreErrors/MoreErrors.c</option>
<option value="listing106.html">/MIB-Libraries/MoreErrors/MoreErrors.h</option>
<option value="listing107.html">/MIB-Libraries/MoreErrors/MoreErrors.r</option>
<option value="listing108.html">/MIB-Libraries/MoreEvents/MoreEvents.h</option>
<option value="listing109.html">/MIB-Libraries/MoreInterfaceLib/MoreInterfaceLib.c</option>
<option value="listing110.html">/MIB-Libraries/MoreInterfaceLib/MoreInterfaceLib.h</option>
<option value="listing111.html">/MIB-Libraries/MoreInterfaceLib/RemoteAccessInterface.h</option>
<option value="listing112.html">/MIB-Libraries/MoreInterfaceLib/TestMoreInterfaceLib/TestMoreInterfaceLib.c</option>
<option value="listing113.html">/MIB-Libraries/MoreIsBetter.h</option>
<option value="listing114.html">/MIB-Libraries/MoreLists/MoreLists.c</option>
<option value="listing115.html">/MIB-Libraries/MoreLists/MoreLists.h</option>
<option value="listing116.html">/MIB-Libraries/MoreMemory/MoreMemory.c</option>
<option value="listing117.html">/MIB-Libraries/MoreMemory/MoreMemory.h</option>
<option value="listing118.html">/MIB-Libraries/MoreMemory/TestMoreMemory/TestMoreMemory.c</option>
<option value="listing119.html">/MIB-Libraries/MoreMenus/MenuKeyGlyphs.h</option>
<option value="listing120.html">/MIB-Libraries/MoreMenus/MoreMenus.c</option>
<option value="listing121.html">/MIB-Libraries/MoreMenus/MoreMenus.h</option>
<option value="listing122.html">/MIB-Libraries/MoreMenus/MoreSystemMenus.c</option>
<option value="listing123.html">/MIB-Libraries/MoreMenus/MoreSystemMenus.h</option>
<option value="listing124.html">/MIB-Libraries/MoreMenus/TestMoreSystemMenus/TestMoreSystemMenus.c</option>
<option value="listing125.html">/MIB-Libraries/MoreMultiprocessing/MoreBlueActions.c</option>
<option value="listing126.html">/MIB-Libraries/MoreMultiprocessing/MoreBlueActions.h</option>
<option value="listing127.html">/MIB-Libraries/MoreMultiprocessing/MoreMPLog.c</option>
<option value="listing128.html">/MIB-Libraries/MoreMultiprocessing/MoreMPLog.h</option>
<option value="listing129.html">/MIB-Libraries/MoreNavigation/MoreNavigation.c</option>
<option value="listing130.html">/MIB-Libraries/MoreNavigation/MoreNavigation.h</option>
<option value="listing131.html">/MIB-Libraries/MoreOpenAndSave/MoreOpenAndSave.cp</option>
<option value="listing132.html">/MIB-Libraries/MoreOpenAndSave/MoreOpenAndSave.h</option>
<option value="listing133.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPush.c</option>
<option value="listing134.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPush.h</option>
<option value="listing135.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPushTest/MoreAutoPushTest.c</option>
<option value="listing136.html">/MIB-Libraries/MoreOpenTransport/OTClassicContext.h</option>
<option value="listing137.html">/MIB-Libraries/MoreOpenTransport/OTClassicContextTest/OTClassicContextTest.c</option>
<option value="listing138.html">/MIB-Libraries/MoreOpenTransport/OTMP.c</option>
<option value="listing139.html">/MIB-Libraries/MoreOpenTransport/OTMP.h</option>
<option value="listing140.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.c</option>
<option value="listing141.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.h</option>
<option value="listing142.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.c</option>
<option value="listing143.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.r</option>
<option value="listing144.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/Sample HTTP Source/index.html</option>
<option value="listing145.html">/MIB-Libraries/MoreOpenTransport/OTMPTest/OTMPTest.c</option>
<option value="listing146.html">/MIB-Libraries/MoreOpenTransport/Read_Me_About_OTMP.html</option>
<option value="listing147.html">/MIB-Libraries/MoreOpenTransport/ReadMeOTClassicContext.html</option>
<option value="listing148.html">/MIB-Libraries/MoreOSL/MoreOSL.c</option>
<option value="listing149.html">/MIB-Libraries/MoreOSL/MoreOSL.h</option>
<option value="listing150.html">/MIB-Libraries/MoreOSL/MoreOSLHelpers.c</option>
<option value="listing151.html">/MIB-Libraries/MoreOSL/MoreOSLHelpers.h</option>
<option value="listing152.html">/MIB-Libraries/MoreOSL/MoreOSLStringComp.applescript</option>
<option value="listing153.html">/MIB-Libraries/MoreOSL/MoreOSLStringCompare.c</option>
<option value="listing154.html">/MIB-Libraries/MoreOSL/MoreOSLStringCompare.h</option>
<option value="listing155.html">/MIB-Libraries/MoreOSL/MoreOSLTokens.c</option>
<option value="listing156.html">/MIB-Libraries/MoreOSL/MoreOSLTokens.h</option>
<option value="listing157.html">/MIB-Libraries/MoreOSL/ReadMe.html</option>
<option value="listing158.html">/MIB-Libraries/MoreOSL/TestMoreOSL/Test Script.applescript</option>
<option value="listing159.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSL.c</option>
<option value="listing160.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSLTerminology.h</option>
<option value="listing161.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSLTerminology.r</option>
<option value="listing162.html">/MIB-Libraries/MoreOSUtils/MoreOSUtils.c</option>
<option value="listing163.html">/MIB-Libraries/MoreOSUtils/MoreOSUtils.h</option>
<option value="listing164.html">/MIB-Libraries/MoreOSUtils/TestMoreOSUtils/TestMoreOSUtils.c</option>
<option value="listing165.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.c</option>
<option value="listing166.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.h</option>
<option value="listing167.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.s</option>
<option value="listing168.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatchesTest/MoreCFMPatchesTest.c</option>
<option value="listing169.html">/MIB-Libraries/MorePreferences/MorePreferences.cp</option>
<option value="listing170.html">/MIB-Libraries/MorePreferences/MorePreferences.h</option>
<option value="listing171.html">/MIB-Libraries/MoreProcesses/MoreProcesses.cp</option>
<option value="listing172.html">/MIB-Libraries/MoreProcesses/MoreProcesses.h</option>
<option value="listing173.html">/MIB-Libraries/MoreProcesses/MoreScheduledExec.c</option>
<option value="listing174.html">/MIB-Libraries/MoreProcesses/MoreScheduledExec.h</option>
<option value="listing175.html">/MIB-Libraries/MoreProcesses/TestMoreScheduledExec/TestMoreScheduledExec.c</option>
<option value="listing176.html">/MIB-Libraries/MoreQuickDraw/MoreQuickDraw.cp</option>
<option value="listing177.html">/MIB-Libraries/MoreQuickDraw/MoreQuickDraw.h</option>
<option value="listing178.html">/MIB-Libraries/MoreResources/MoreResources.c</option>
<option value="listing179.html">/MIB-Libraries/MoreResources/MoreResources.h</option>
<option value="listing180.html">/MIB-Libraries/MoreSCF/MoreSCF.c</option>
<option value="listing181.html">/MIB-Libraries/MoreSCF/MoreSCF.h</option>
<option value="listing182.html">/MIB-Libraries/MoreSCF/MoreSCFCCLScanner.c</option>
<option value="listing183.html">/MIB-Libraries/MoreSCF/MoreSCFCCLScanner.h</option>
<option value="listing184.html">/MIB-Libraries/MoreSCF/MoreSCFDigest.c</option>
<option value="listing185.html">/MIB-Libraries/MoreSCF/MoreSCFDigest.h</option>
<option value="listing186.html">/MIB-Libraries/MoreSCF/MoreSCFHelpers.c</option>
<option value="listing187.html">/MIB-Libraries/MoreSCF/MoreSCFHelpers.h</option>
<option value="listing188.html">/MIB-Libraries/MoreSCF/MoreSCFPortScanner.c</option>
<option value="listing189.html">/MIB-Libraries/MoreSCF/MoreSCFPortScanner.h</option>
<option value="listing190.html">/MIB-Libraries/MoreSCF/MoreSCFTest/MoreSCFTest.c</option>
<option value="listing191.html">/MIB-Libraries/MoreSCF/ReadMeAboutMoreSCF.html</option>
<option value="listing192.html">/MIB-Libraries/MoreSecurity/MoreSecurity.c</option>
<option value="listing193.html">/MIB-Libraries/MoreSecurity/MoreSecurity.h</option>
<option value="listing194.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTest.c</option>
<option value="listing195.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTestCommon.h</option>
<option value="listing196.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTestTool.c</option>
<option value="listing197.html">/MIB-Libraries/MoreSecurity/ReadMeAboutMoreAuthSample.html</option>
<option value="listing198.html">/MIB-Libraries/MoreSetup.h</option>
<option value="listing199.html">/MIB-Libraries/MoreSetup.r</option>
<option value="listing200.html">/MIB-Libraries/MoreSound/MoreSound.cp</option>
<option value="listing201.html">/MIB-Libraries/MoreSound/MoreSound.h</option>
<option value="listing202.html">/MIB-Libraries/MoreTextUtils/MoreTextUtils.cp</option>
<option value="listing203.html">/MIB-Libraries/MoreTextUtils/MoreTextUtils.h</option>
<option value="listing204.html">/MIB-Libraries/MoreTextUtils/TestMoreTextUtils/TestMoreTextUtils.c</option>
<option value="listing205.html">/MIB-Libraries/MoreTextUtils/TestMoreTextUtils/TestMoreTextUtils.r</option>
<option value="listing206.html">/MIB-Libraries/MoreToolbox/MoreToolbox.cp</option>
<option value="listing207.html">/MIB-Libraries/MoreToolbox/MoreToolbox.h</option>
<option value="listing208.html">/MIB-Libraries/MoreUNIX/MoreUNIX.c</option>
<option value="listing209.html">/MIB-Libraries/MoreUNIX/MoreUNIX.h</option>
<option value="listing210.html">/MIB-Libraries/MoreWindows/MoreWindows.cp</option>
<option value="listing211.html">/MIB-Libraries/MoreWindows/MoreWindows.h</option>
<option value="listing212.html">/MIB-Libraries/NetworkSetup/MoreNetworkSetup.c</option>
<option value="listing213.html">/MIB-Libraries/NetworkSetup/MoreNetworkSetup.h</option>
<option value="listing214.html">/MIB-Libraries/NetworkSetup/Network Setup SDK Bits/ Read Me.txt</option>
<option value="listing215.html">/MIB-Libraries/NetworkSetup/Network Setup SDK Bits/NetworkSetupBigPicture.html</option>
<option value="listing216.html">/MIB-Libraries/NetworkSetup/NetworkSetupHelpers.c</option>
<option value="listing217.html">/MIB-Libraries/NetworkSetup/NetworkSetupHelpers.h</option>
<option value="listing218.html">/MIB-Libraries/NetworkSetup/NetworkSetupTest/NetworkSetupTest.c</option>
<option value="listing219.html">/MIB-Libraries/NetworkSetup/OldStyleAPI/OldOTConfigLib.h</option>
<option value="listing220.html">/MIB-Libraries/NetworkSetup/ReadMe.html</option>
<option value="listing221.html">/MIB-Libraries/PascalInterfaces/MoreSetup.p</option>
<option value="listing222.html">/MIB-Libraries/PascalInterfaces/TradDriverLoaderLib.p</option></select>
				</p>
				</form>
				<p><strong><a href="MoreIsBetter.zip">Download Sample</a></strong> (&#147;MoreIsBetter.zip&#148;, 1.61M)<BR>
<strong><a href="MoreIsBetter.dmg">Download Sample</a></strong> (&#147;MoreIsBetter.dmg&#148;, 2.04M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*
  File:    MoreDisks.c

  Contains:  General disk driver utility routines.

  Written by:  Quinn

  Copyright:  Copyright (c) 1999-2001 by Apple Computer, Inc., All Rights Reserved.

  Disclaimer:  IMPORTANT:  This Apple software is supplied to you by Apple Computer, Inc.
        (&quot;Apple&quot;) in consideration of your agreement to the following terms, and your
        use, installation, modification or redistribution of this Apple software
        constitutes acceptance of these terms.  If you do not agree with these terms,
        please do not use, install, modify or redistribute this Apple software.

        In consideration of your agreement to abide by the following terms, and subject
        to these terms, Apple grants you a personal, non-exclusive license, under Apple's
        copyrights in this original Apple software (the &quot;Apple Software&quot;), to use,
        reproduce, modify and redistribute the Apple Software, with or without
        modifications, in source and/or binary forms; provided that if you redistribute
        the Apple Software in its entirety and without modifications, you must retain
        this notice and the following text and disclaimers in all such redistributions of
        the Apple Software.  Neither the name, trademarks, service marks or logos of
        Apple Computer, Inc. may be used to endorse or promote products derived from the
        Apple Software without specific prior written permission from Apple.  Except as
        expressly stated in this notice, no other rights or licenses, express or implied,
        are granted by Apple herein, including but not limited to any patent rights that
        may be infringed by your derivative works or by other works in which the Apple
        Software may be incorporated.

        The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO
        WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED
        WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR
        PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE OR IN
        COMBINATION WITH YOUR PRODUCTS.

        IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR
        CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
        GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
        ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION
        OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER UNDER THEORY OF CONTRACT, TORT
        (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN
        ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

  Change History (most recent first):

$Log: MoreDisks.c,v $
Revision 1.8  2002/11/08 23:29:52         
Include our prototype early to flush out any missing dependencies. Convert nil to NULL. Convert MoreAssertQ to assert.

Revision 1.7  2001/11/07 15:52:17         
Tidy up headers, add CVS logs, update copyright.


         &lt;6&gt;     21/9/01    Quinn   Changes for CWPro7 Mach-O build.
         &lt;5&gt;      5/7/01    Quinn   Moved CD-ROM stuff to &quot;MoreCDs.c&quot;.
         &lt;4&gt;    24/11/00    Quinn   Complain if compiled for Carbon.
         &lt;3&gt;     14/2/00    Quinn   Update MoreFirstDriveWithoutVolume to handle Imation SuperDisk.
         &lt;2&gt;      7/5/99    Quinn   Added MoreIsDriveCDROM.  Fixed bug in MoreGetDriveRefNum where
                                    it was calling MoreUTFindDrive rather than MoreUTFindDriveQ, and
                                    hence failing on disks controlled by foreign file systems.
         &lt;1&gt;     16/3/99    Quinn   First checked in.
*/

/////////////////////////////////////////////////////////////////

// Our Prototypes

#include &quot;MoreDisks.h&quot;

// Mac OS Interfaces

#if ! MORE_FRAMEWORK_INCLUDES
  #include &lt;Devices.h&gt;
  #include &lt;DriverGestalt.h&gt;
  #include &lt;Gestalt.h&gt;
  #include &lt;FSM.h&gt;
  #include &lt;Disks.h&gt;
  #include &lt;StringCompare.h&gt;
#endif

// MIB Prototypes

#include &quot;TradDriverLoaderLib.h&quot;
#include &quot;MoreInterfaceLib.h&quot;
#include &quot;MoreMemory.h&quot;

/////////////////////////////////////////////////////////////////

// Carbon isn't sensible for MoreDisks because the entire disk 
// driver architecture is Mac OS 9 only, and hence not part of 
// Carbon.  Note that we don't put this in the header because 
// some of the definitions in the header are Carbon compatible.

#if TARGET_API_MAC_CARBON
  #error MoreDisks does not support Carbon development.
#endif

/////////////////////////////////////////////////////////////////
#pragma mark ----- Basic Disk Driver Utilities -----

extern pascal DriveFlagsPtr MoreGetDriveFlags(DrvQElPtr drvQEl)
  // See comment in interface part.
{
  assert(drvQEl != NULL);

  return ((DriveFlagsPtr) drvQEl) - 1;
}

extern pascal OSErr MoreUTFindDriveQ(SInt16 drive, DrvQElPtr *foundDrvQEl)
  // See comment in interface part.
{
  OSErr err;
  UInt32 fsmVers;

  assert(drive &gt; 0);
  assert(foundDrvQEl != NULL);
  
  // Check to see whether we have a useful version of FSM.  Versions of FSM
  // prior to 1.2 do not support the documented FSM API, so we just treat
  // them as if FSM wasn't installed.
  
  if ((Gestalt(gestaltFSMVersion, (SInt32 *) &amp;fsmVers) == noErr) &amp;&amp; (fsmVers &gt;= 0x0120)) {

    // We have FSM, let's call its version of UTFindDrive,
    // and handle the weirdo error we get for non-HFS disks.

    err = MoreUTFindDrive(drive, foundDrvQEl);
    if (err == extFSErr) {
      err = noErr;
    }
  } else {
    DrvQElPtr thisDrv;
  
    // No FSM, let's go poking around in low memory )-:
    
    *foundDrvQEl = NULL;

    thisDrv = (DrvQElPtr) GetDrvQHdr()-&gt;qHead;
    while (thisDrv != NULL &amp;&amp; *foundDrvQEl == NULL) {
      if (thisDrv-&gt;dQDrive == drive) {
        *foundDrvQEl = thisDrv;
      } else {
        thisDrv = (DrvQElPtr) thisDrv-&gt;qLink;
      }
    }
    if (*foundDrvQEl == NULL) {
      err = nsDrvErr;
    } else {
      err = noErr;
    }
  }
  
  return err;
}

extern pascal DrvQElPtr MoreGetIndDrive(SInt16 index)
  // See comment in interface part.
{
  DrvQElPtr thisDrv;
  SInt16    thisDrvIndex;

  assert(index &gt; 0);
  
  thisDrvIndex = 1;
  thisDrv = (DrvQElPtr) GetDrvQHdr()-&gt;qHead;
  while (thisDrv != NULL &amp;&amp; thisDrvIndex != index) {
    thisDrvIndex += 1;
    thisDrv = (DrvQElPtr) thisDrv-&gt;qLink;
  }
  return thisDrv;
}

extern pascal SInt16 MoreFindFreeDriveNumber(SInt16 firstDrive)
  // See comment in interface part.
{
  SInt16 candidate;
  DrvQElPtr junkDrvQElPtr;
  
  assert(firstDrive &gt;= 5);
  
  candidate = firstDrive;
  while ( MoreUTFindDriveQ(candidate, &amp;junkDrvQElPtr) == noErr ) {
    candidate += 1;
  }
  
  // This post condition checks that we didn't wrap
  // around to a negative drive number.

  assert(candidate &gt;= 5);

  return candidate;
}

extern pascal OSErr MoreRemoveDrive(DrvQElPtr drvQEl)
  // See comment in interface part.
{
  OSStatus err;
  
  if ( MoreVolumeMountedOnDrive(drvQEl-&gt;dQDrive, false) == 0 ) {
    err = Dequeue( (QElemPtr) drvQEl, GetDrvQHdr());
  } else {
    err = volOnLinErr;
  }
  return err;
}

extern pascal DriverRefNum MoreGetDriveRefNum(SInt16 drive)
  // See comment in interface part.
{
  DrvQElPtr foundDrvQEl;

  assert(drive &gt; 0);
  
  if ( MoreUTFindDriveQ(drive, &amp;foundDrvQEl) == noErr) {
    return foundDrvQEl-&gt;dQRefNum;
  } else {
    return 0;
  }
}

static pascal Boolean MoreDriveSupportsDriverGestaltInternal(DriverRefNum refNum)
  // An internal version of MoreDriveSupportsDriverGestalt that allows
  // you to pass in the refNum and the drive number.  You can pass
  // in 0 for either refNum or drive (but not both) and the routine
  // will do the appropriate mapping.
{
    OSErr junk;
    DriverFlags driverFlags;
    
    junk = TradGetDriverInformation(refNum, NULL, &amp;driverFlags, NULL, NULL);
    assert(junk == noErr);
    return TradDriverGestaltIsOn(driverFlags);
}

extern pascal Boolean MoreDriveSupportsDriverGestalt(SInt16 drive)
  // See comment in interface part.
{
  return MoreDriveSupportsDriverGestaltInternal(MoreGetDriveRefNum(drive));
}

static pascal Boolean MoreDriveSupportFileExchangeInternal(DriverRefNum refNum, SInt16 drive)
  // An internal version of MoreDriveSupportFileExchange that allows
  // you to pass in the refNum and the drive number.  You can pass
  // in 0 for either refNum or drive (but not both) and the routine
  // will do the appropriate mapping.
{
    DriverGestaltParam pb;
    Boolean result;

    assert( (refNum &lt; 0 &amp;&amp; drive &gt;= 0 &amp;&amp; (drive == 0 || MoreGetDriveRefNum(drive) == refNum)) ||
           (refNum == 0 &amp;&amp; drive &gt; 0) );
    
    if (refNum == 0) {
      refNum = MoreGetDriveRefNum(drive);
    }
    
    result = false;
    if ( MoreDriveSupportsDriverGestaltInternal(refNum) ) {
        pb.ioVRefNum = drive;
        pb.ioCRefNum = refNum;
        pb.csCode = kDriverGestaltCode;
        pb.driverGestaltSelector = kdgAPI;

        if ( PBStatusSync((ParmBlkPtr) &amp;pb) == noErr 
                &amp;&amp; GetDriverGestaltAPIResponse(&amp;pb)-&gt;partitionCmds &amp; 0x01 ) {
            result = true;
        }
    }
    return result;
}

extern pascal Boolean MoreDriveSupportFileExchange(SInt16 drive)
  // See comment in interface part.
{
    assert(drive &gt; 0);
  return MoreDriveSupportFileExchangeInternal(0, drive);
}

// This is the number of format list entries we allocate when issuing
// the return format list status call.  There's no way we can calculate
// the &quot;correct&quot; number, but this should be more than enough.

enum {
  kFormatListEntryCount = 16
};

extern pascal OSErr MoreGetDriveSize(SInt16 drive, UInt32 *sizeInBlocks)
  // See comment in interface part.
{
  OSErr err;
  DrvQElPtr drvQEl;
  CntrlParam pb;
  FormatListRec formatList[kFormatListEntryCount];
  SInt16 formatIndex;
  Boolean foundFormat;
  Str255 driverName;
    DrvSts status;
  
    assert(drive &gt; 0);
    assert(sizeInBlocks != NULL);

  // Start by finding the drive queue element for
  // the drive, and by making sure that there's a disk
  // in the drive.
  
  err = MoreUTFindDriveQ(drive, &amp;drvQEl);
  if (err == noErr) {
    if ( MoreGetDriveFlags(drvQEl)-&gt;diskInPlace &lt;= 0 ) {
      err = offLinErr;
    }
  }

  // Wow, this is harder than it should be, all because of the
  // silly &quot;.Sony&quot; driver.  The basic problem is that
  // the &quot;.Sony&quot; driver doesn't store the disk size in the
  // drive queue element like every other disk drive on the
  // planet.  The solution is a three step process as described
  // in the comments below.
  
  if (err == noErr) {

    // Step 1.  If the driver supports the kReturnFormatList status call,
    //        use it to get a list of formats for the drive and then
    //      return the format marked as current.

    pb.ioNamePtr = NULL;
    pb.ioVRefNum = drvQEl-&gt;dQDrive;
    pb.ioCRefNum = drvQEl-&gt;dQRefNum;
    pb.csCode = kReturnFormatList;
    pb.csParam[0] = kFormatListEntryCount;
    *((FormatListRec **) &amp;pb.csParam[1]) = formatList;
    err = PBStatusSync( (ParmBlkPtr) &amp;pb);
    if (err == noErr) {
      foundFormat = false;
      for (formatIndex = 0; formatIndex &lt; pb.csParam[0]; formatIndex++) {
        if ((formatList[formatIndex].formatFlags &amp; diCIFmtFlagsCurrentMask) != 0) {
          *sizeInBlocks = formatList[formatIndex].volSize;
          foundFormat = true;
        }
      }
      if ( ! foundFormat ) {

        // Hmmm, this isn't good.  The disk driver returned a format
        // list but none of the formats were marked as &quot;current&quot;.
        // We handle this correctly but, in debug builds, we'll also
        // drop into MacsBug, just to let you know this is happening.

        assert(false);
        err = paramErr;
      }
    } else {
    
      // *** The logic here is slightly screwed up.  The problem is that
      // I can't tell whether the kReturnFormatList call failed because
      // the driver just doesn't support it, or because the driver failed
      // to get the information for some other reason.  If that driver
      // happens to be the &quot;.Sony&quot; driver, I'm going to take a wrong step
      // next.
      //
      // For example, say that there's a 1.4MB disk in the floppy drive
      // and I call kReturnFormatList and it fails with an error because
      // of a cosmic ray.  I then test the driver name, find that it's
      // &quot;.Sony&quot;, call DriveStatus, and then return noErr with a size
      // of either 400KB or 800KB.  Not good.
      // 
      // You might think this is an unlikely occurence, but it's exactly
      // what happens when there's no disk in the floppy drive.  I've
      // special-cased that away above, but the general problem still stands.
      // 
      // What are the alternatives?  I could special case the error
      // result from kReturnFormatList and only run this code if I get
      // statusErr.  But can you guarantee that all &quot;.Sony&quot; drives
      // return statusErr for an unrecognised status code?  I thought not.
      // Beyond that, I can't think of any options.  So this code
      // stands.  It's probably never going to bite anyone, but it's
      // worth noting here, just in case.  Besides, this is what
      // the equivalent routine in MoreFiles does (-:
      //
      // -- Quinn, 3 Mar 1999

      // Step 2.  If that doesn't work, then look at the driver.  If it's
      //        the &quot;.Sony&quot; driver (and this will be a really old &quot;.Sony&quot; driver
      //        because new ones support kReturnFormatList), special case
      //        the possible media types.

      err = TradGetDriverInformation(drvQEl-&gt;dQRefNum, NULL, NULL, driverName, NULL);
      if (err == noErr) {
        if ( EqualString(driverName, &quot;\p.Sony&quot;, false, true) ) {
          err = DriveStatus(drvQEl-&gt;dQDrive, &amp;status);
          if (err == noErr) {
            if ( status.twoSideFmt == 0 ) {
              *sizeInBlocks = 400 * 2;
            } else {
              *sizeInBlocks = 800 * 2;
            }
          }
        } else {

          // Step 3.  If it's not the &quot;.Sony&quot; driver, get the size out of the
          //        drive queue element.

          if (drvQEl-&gt;qType == 0) {

            // Old style drive, with just 16 bits of size information
            // in dQDrvSz.

            *sizeInBlocks = drvQEl-&gt;dQDrvSz;
          } else {
          
            // New style drive, with 32 bits of size information spread
            // between dQDrvSz and dQDrvSz2.
            
            *sizeInBlocks = (((UInt32 ) drvQEl-&gt;dQDrvSz2) * 65536) + (UInt32 ) drvQEl-&gt;dQDrvSz;
          }
        }
      }
    }
  }
  
  return err;
}

extern pascal SInt16 MoreVolumeMountedOnDrive(SInt16 drive, Boolean ejectedIsMounted)
  // See comment in interface part.
{
  SInt16 result;
  VCBPtr thisVCB;

    assert(drive &gt; 0);

  // Get the VCB queue (in low memory) and walk it.
  // We can't use UTLocateNextVCB because it will only
  // iterate volumes by name, not return a complete list.
  
  result = 0;
  thisVCB  = (VCBPtr) GetVCBQHdr()-&gt;qHead;
  while (thisVCB != NULL &amp;&amp; result == 0) {
    if (thisVCB-&gt;vcbDrvNum == drive ||
        (ejectedIsMounted &amp;&amp;
         thisVCB-&gt;vcbDrvNum == 0 &amp;&amp;
         thisVCB-&gt;vcbDRefNum == drive
        )
       ) {
      assert(thisVCB-&gt;vcbDrvNum == 0 || thisVCB-&gt;vcbDRefNum == MoreGetDriveRefNum(drive));
      result = thisVCB-&gt;vcbVRefNum;
    } else {
      thisVCB = (VCBPtr) thisVCB-&gt;qLink;
    }
  }
  
  return result;
}

extern pascal SInt16 MoreFirstDriveWithoutVolume(DriverRefNum refNum)
  // See comment in interface part.
  //
  // We never return drive number 1.  This is because the Apple USB
  // Mass Storage driver, in the presence of a Imation SuperDisk, 
  // will create two drive queue elements.  The first, drive number
  // 1, is used for when a standard floppy disk is inserted.  The second, 
  // with a drive number in the standard range (8 or above), is used 
  // when a SuperDisk is inserted.  They do this, presumably, so that
  // they are compatible with software that assumes that floppy disks
  // must be in drive 1, 2 or 3 (bad software, no biscuit!).
  //
  // The problem is that, when we go searching for a free drive queue
  // element to reuse while messing with partitions, we find this drive.
  // But the driver won't let us using this drive for partition work
  // (we just get endless nsDrvErr errors).  So we always skip this drive
  // number in the search, which means that we'll create a /third/ drive
  // queue element for our partition work.
  //
  // This all makes sense if you think about it hard enough (-:
  // Skipping drive number 1 is only dangerous if you're actually
  // expecting this routine to return drive number 1 (say you're looking
  // for the first free drive queue element controlled by the &quot;.Sony&quot;
  // driver).  But it's unlikely that you'll be interested in the &quot;.Sony&quot;
  // drive while messing around with partitions.  So I decided to add
  // this special case and document it in the interface.
{
  Boolean found;
  DrvQElPtr thisDrv;

  found = false;
  thisDrv = (DrvQElPtr) GetDrvQHdr()-&gt;qHead;
  while (thisDrv != NULL &amp;&amp; ! found) {
    if (thisDrv-&gt;dQRefNum == refNum 
        &amp;&amp; MoreVolumeMountedOnDrive(thisDrv-&gt;dQDrive, false) == 0
        &amp;&amp; thisDrv-&gt;dQDrive != 1) {
      found = true;
    } else {
      thisDrv = (DrvQElPtr) thisDrv-&gt;qLink;
    }
  }
  if (found) {
    return thisDrv-&gt;dQDrive;
  } else {
    return 0;
  }
}

/////////////////////////////////////////////////////////////////
#pragma mark ----- File Exchange Control Call Interface -----

extern pascal OSErr MoreCreateNewDriveQueueElement(SInt16 driveToClone,
            UInt32 firstBlock, UInt32 sizeInBlocks,
            SInt16 *newDrive)
  // See comment in interface part.
{
    OSErr err;
    OSErr junk;
    CntrlParam pb;
    DrvQElPtr drvQEl;

    assert(driveToClone &gt; 0);
    assert(newDrive != NULL);
    
  // First check that the driver supports the File Exchange
  // control call interface.
      
    err = noErr;
    if ( ! MoreDriveSupportFileExchange(driveToClone) ) {
      err = controlErr;
    }
    
    // Find the drive queue element associated with
    // driveToClone.  This is an input parameter to
    // kGetADrive.
    
  if (err == noErr) {    
      err = MoreUTFindDriveQ(driveToClone, &amp;drvQEl);
  }
  
  // Make the kGetADrive call to the driver.  Because
  // we pass a pointer to memory outside of the parameter
  // block (drvQEl) and the driver might be a paging device,
  // we must hold drvQEl (and make sure to unhold it later!).
  
    if (err == noErr) {
    err = SafeHoldMemory(&amp;drvQEl, sizeof(drvQEl));
    if (err == noErr) {
          pb.ioVRefNum = driveToClone;
          pb.ioCRefNum = MoreGetDriveRefNum(driveToClone);
          pb.csCode = kGetADrive;
          *((DrvQElPtr **) &amp;pb.csParam[0]) = &amp;drvQEl;

          err = PBControlSync((ParmBlkPtr) &amp;pb);
          if (err == noErr) {
              *newDrive = drvQEl-&gt;dQDrive;
          }
          junk = SafeUnholdMemory(&amp;drvQEl, sizeof(drvQEl));
          assert(junk == noErr);
      }
    }
    
    // Now re-target the new drive to the partition on the
    // disk specified by firstBlock and sizeInBlocks.  We do
    // this in the create call because some disk drivers
    // don't always inherit the partition information from
    // the drive that was cloned.
    
    if (err == noErr) {
    err = MoreSetDrivePartition(*newDrive, firstBlock, sizeInBlocks);
    }
    
    return err;
}

extern pascal OSErr MoreSetDrivePartition(SInt16 drive, UInt32 firstBlock, UInt32 sizeInBlocks)
  // See comment in interface part.
{
    OSErr err;
    CntrlParam pb;
    DrvQElPtr drvQEl;

    assert(drive &gt; 0);
    
  // First check that the driver supports the File Exchange
  // control call interface.
      
    err = noErr;
    if ( ! MoreDriveSupportFileExchange(drive) ) {
      err = controlErr;
    }
    
    // Find the drive queue element associated with
    // drive.  This is an input parameter to
    // kRegisterPartition.
    
  if (err == noErr) {    
      err = MoreUTFindDriveQ(drive, &amp;drvQEl);
  }
  
  // Make the kRegisterPartition control call.  We
  // don't need to hold any memory because all the
  // parameters to this control call are entirely
  // contained within the parameter block.

    if (err == noErr) {
        pb.ioVRefNum = drive;
        pb.ioCRefNum = MoreGetDriveRefNum(drive);
        pb.csCode = kRegisterPartition;
        *((DrvQElPtr *) &amp;pb.csParam[0]) = drvQEl;
        *((UInt32 *) &amp;pb.csParam[2]) = firstBlock;
        *((UInt32 *) &amp;pb.csParam[4]) = sizeInBlocks;

        err = PBControlSync((ParmBlkPtr) &amp;pb);
    }
    
    // In the debug build, check that our changes stuck.
    
    #if MORE_DEBUG
      if (err == noErr) {
        OSErr debugErr;
        UInt32 trueFirstBlock;
        UInt32 trueSizeInBlocks;

      debugErr = MoreGetDrivePartition(drive, &amp;trueFirstBlock, &amp;trueSizeInBlocks);
      assert(debugErr == noErr &amp;&amp; trueSizeInBlocks == sizeInBlocks &amp;&amp; trueFirstBlock == firstBlock);
      }
    #endif
    
    return err;
}

extern pascal OSErr MoreGetDrivePartition(SInt16 drive, UInt32 *firstBlock, UInt32 *sizeInBlocks)
  // See comment in interface part.
{
  OSErr err;
  partInfoRec partInfo;
  
    assert(drive &gt; 0);
    assert(firstBlock != NULL);
    assert(sizeInBlocks != NULL);

  err = MoreGetPartitionInfo(drive, &amp;partInfo);
  if (err == noErr) {
    *firstBlock = partInfo.physPartitionLoc;
    err = MoreGetDriveSize(drive, sizeInBlocks);
  }
  return err;
}

extern pascal OSErr MoreGetPartitionInfo(SInt16 drive, partInfoRec *partInfo)
  // See comment in interface part.
{
    OSErr err;
    OSErr junk;
    CntrlParam pb;
    
    assert(drive &gt; 0);
    assert(partInfo != NULL);

  // First check that the driver supports the File Exchange
  // control call interface.
      
    err = noErr;
    if ( ! MoreDriveSupportFileExchange(drive) ) {
      err = controlErr;
    }

  // Make the kGetADrive call to the driver.  Because
  // we pass a pointer to memory outside of the parameter
  // block (partInfo) and the driver might be a paging device,
  // we must hold partInfo (and make sure to unhold it later!).

  if (err == noErr) {    
    err = SafeHoldMemory(partInfo, sizeof(*partInfo));
    if (err == noErr) {
        pb.ioVRefNum = drive;
        pb.ioCRefNum = MoreGetDriveRefNum(drive);
        pb.csCode = kGetPartInfo;
        *((partInfoRec **) &amp;pb.csParam[0]) = partInfo;

        err = PBStatusSync((ParmBlkPtr) &amp;pb);
        
        junk = SafeUnholdMemory(partInfo, sizeof(*partInfo));
          assert(junk == noErr);
    }
  }
    
    return err;
}

#if 0

// ***
// This code temporarily disable while I figure out what's going on.
// -- Quinn, 3 Mar 1999

extern pascal OSErr MoreGetPartitionVolume(DriverRefNum refNum, const partInfoRec *partInfo, SInt16 *vRefNum)
  // See comment in interface part.
{
    OSErr err;
    OSErr junk;
    CntrlParam pb;
    
    assert(refNum &lt; 0);
    assert(partInfo != NULL);
    assert(vRefNum != NULL);

  // First check that the driver supports the File Exchange
  // control call interface.
      
    err = noErr;
    if ( ! MoreDriveSupportFileExchangeInternal(refNum, 0) ) {
      err = controlErr;
    }

  // Make the kGetPartitionStatus call to the driver.  Because
  // we pass a pointer to memory outside of the parameter
  // block (partInfo and vRefNum) and the driver might be a paging device,
  // we must hold that memory (and make sure to unhold it later!).

  if (err == noErr) {    
    err = SafeHoldMemory( (partInfoRec *) partInfo, sizeof(*partInfo));
    if (err == noErr) {
      err = SafeHoldMemory(vRefNum, sizeof(*vRefNum));
      if (err == noErr) {
          pb.ioVRefNum = 0;
          pb.ioCRefNum = refNum;
          pb.csCode = kGetPartitionStatus;
          *((partInfoRec **) &amp;pb.csParam[0]) = (partInfoRec *) partInfo;
          *((SInt16 **) &amp;pb.csParam[2]) = vRefNum;

          err = PBStatusSync((ParmBlkPtr) &amp;pb);

          junk = SafeUnholdMemory(vRefNum, sizeof(*vRefNum));
            assert(junk == noErr);
      }
        junk = SafeUnholdMemory( (partInfoRec *) partInfo, sizeof(*partInfo));
          assert(junk == noErr);
      }
    }
    return err;
}

#endif
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MoreIsBetter/listing102.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MoreIsBetter/listing102.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MoreIsBetter/listing102.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>