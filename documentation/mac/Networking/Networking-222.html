<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of ASP(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING222></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-221.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-223.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-204.html"><B>Chapter 8 - AppleTalk Session Protocol (ASP)</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING222-0></A>
<H1>Summary of ASP</H1>
<A NAME=HEADING222-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING222-2></A>
<H3>Constants</H3>
<PRE>
CONST
   {.XPP driver unit and reference number}
   xppUnitNum     =      40;           {XPP unit number}
   xppRefNum      =     -41;           {XPP reference number}
   {command codes for ASP}
   openSess       =     255;           {open session}
   closeSess      =     254;           {close session}
   userCommand    =     253;           {user command}
   userWrite      =     252;           {user write}
   getStatus      =     251;           {get server status}
   getParms       =     249;           {get parameters for session}
   abortOS        =     248;           {cancel open session request}
   closeAll       =     247;           {close all open sessions}
   {miscellaneous}
   xppLoadedBit   =      5;            {XPP bit in PortBUse}
   scbMemSize     =     192;           {size of memory for SCB}
</PRE>
<A NAME=HEADING222-6></A>
<H3>Data Types</H3>
<A NAME=HEADING222-7></A>
<H4>Address Block Record</H4>
<PRE>
TYPE AddrBlock = 
   PACKED RECORD
      aNet:       Integer;          {network number}
      aNode:      Byte;             {node ID}
      aSocket:    Byte;             {socket number}
   END;
</PRE>
<A NAME=HEADING222-9></A>
<H4>XPP Parameter Block for ASP</H4>
<PRE>
XPPPrmBlkType = (...XPPPrmBlk,ASPAbortPrm,ASPSizeBlk...);
XPPSubPrmType = (ASPOpenPrm,ASPSubPrm);
XPPEndPrmType = (...ASPEndPrm);
TYPE XPPParamBlock = 
   PACKED RECORD
      qLink:            QElemPtr;         {reserved}
      qType:            Integer;          {reserved}
      ioTrap:           Integer;          {reserved}
      ioCmdAddr:        Ptr;              {reserved}
      ioCompletion:     ProcPtr;          {completion routine}
      ioResult:         OSErr;            {result code}
      cmdResult:        LongInt;          {command result (ATP user bytes)}
      ioVRefNum:        Integer;          {reserved}
      ioRefNum:         Integer;          {driver reference number}
      csCode:           Integer;          {call command code}
      CASE XPPPrmBlkType OF
      ASPAbortPrm:
         (abortSCBPtr: Ptr);              {SCB pointer for AbortOS}
      ASPSizeBlk:
         (aspMaxCmdSize: Integer;         {maximum size of data for commands}
         aspQuantumSize:Integer;          {maximum size of data for request }
                                          { commands and receive replies}
         numSesss: Integer);              {number of concurrent sessions }
                                          { for your node}
   }
      XPPPrmBlk:
      (sessRefnum: Integer;               {offset to session refnum}
      aspTimeout: Byte;                   {timeout for ATP}
      aspRetry: Byte;                     {retry count for ATP}
      CASE XPPSubPrmType OF
      ASPOpenPrm:
      (serverAddr: AddrBlock;             {server address block}
      scbPointer: Ptr;                    {SCB pointer}
      attnRoutine: Ptr);                  {attention routine pointer}
      ASPSubPrm:
      (cbSize: Integer;                   {command block size}
      cbPtr: Ptr;                         {command block pointer}
      rbSize: Integer;                    {reply buffer size}
      rbPtr: Ptr;                         {reply buffer pointer}


      CASE XPPEndPrmType OF
      ASPEndPrm:
      (wdSize: Integer;                   {write data size}
      wdPtr: Ptr;                         {write data pointer}
      ccbStart: ARRAY[0..295] OF Byte))); {beginning of command control }
                                          { block}
   END;
XPPParmBlkPtr = ^XPPParamBlock;
</PRE>
<A NAME=HEADING222-13></A>
<H3>Routines</H3>
<A NAME=HEADING222-14></A>
<H4>Opening and Closing ASP Sessions</H4>
<PRE>
FUNCTION ASPOpenSession(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
FUNCTION ASPCloseSession(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
FUNCTION ASPCloseAll(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING222-18></A>
<H4>Sending Commands and Writing Data From the Workstation to the Server</H4>
<PRE>
FUNCTION ASPUserCommand(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
FUNCTION ASPUserWrite(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING222-21></A>
<H4>Obtaining Information About ASP's Maximum Capacities and the Status of the Server</H4>
<PRE>
FUNCTION ASPGetParms(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
FUNCTION ASPGetStatus(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING222-24></A>
<H4>Canceling an ASP Request to Open a Session</H4>
<PRE>
FUNCTION ASPAbortOS(thePBptr: XPPParmBlkPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING222-26></A>
<H2>C Summary</H2>
<A NAME=HEADING222-27></A>
<H3>Constants</H3>
<PRE>
enum {                                    /*.XPP driver unit and reference */
                                          /* number*/
   xppUnitNum     =         40,           /*XPP unit number*/
   xppRefNum      =        -41};          /*XPP reference number*/
enum {                                    /*command codes for ASP*/
   openSess    =        255,              /*open session*/
   closeSess   =        254,              /*close session*/
   userCommand =        253,              /*user command*/
   userWrite   =        252,              /*user write*/
   getStatus   =        251,              /*get status*/
   getParms    =        249,              /*get parameters*/
   abortOS     =        248,              /*cancel open session request*/
   closeAll    =        247};             /*close all open sessions*/
enum {                                    /*miscellaneous*/
xppLoadedBit   =        5,                /*XPP bit in PortBUse*/
scbMemSize     =        192};             /*size of memory for SCB*/
</PRE>
<A NAME=HEADING222-31></A>
<H3>Data Types</H3>
<A NAME=HEADING222-32></A>
<H4>Address Block Record</H4>
<PRE>
struct AddrBlock {
   short             aNet;                /*network name*/
   unsigned char     aNode;               /*node name*/
   unsigned char     aSocket;             /*socket number*/
};
</PRE>
<A NAME=HEADING222-34></A>
<H4>XPP Parameter Block for ASP </H4>
<PRE>
#define XPPPBHeader\
   QElem          *qLink;              /*reserved*/\
   short          qType;               /*reserved*/\
   short          ioTrap;              /*reserved*/\
   Ptr            ioCmdAddr;           /*reserved*/\
   ProcPtr        ioCompletion;        /*completion routine*/\
   OSErr          ioResult;            /*result code*/\
   long           cmdResult;           /*command result (ATP user bytes)*/\
   short          ioVRefNum;           /*reserved*/\
   short          ioRefNum;            /*driver reference number*/\
   short          csCode;              /*command code*/
typedef struct {
   XPPPBHeader
      short       sessRefnum;             /*offset to session refnum*/
      char        aspTimeout;             /*timeout for ATP*/
      char        aspRetry;               /*retry count for ATP*/
      short       cbSize;                 /*command block size*/
      Ptr         cbPtr;                  /*command block pointer*/
      short       rbSize;                 /*reply buffer size*/
      Ptr         rbPtr;                  /*reply buffer pointer*/
      short       wdSize;                 /*write data size*/
      Ptr         wdPtr;                  /*write data pointer*/
      char        ccbStart[296];          /*CCB memory allocated for */
                                          /* beginning of command control */
                                          /* block*/
}XPPPrmBlk;

typedef struct {
   XPPPBHeader
   short          sessRefnum;             /*offset to session refnum*/
   char           aspTimeout;             /*timeout for ATP*/
   char           aspRetry;               /*retry count for ATP*/
   AddrBlock      serverAddr;             /*server address block*/
   Ptr            scbPointer;             /*SCB pointer*/
   Ptr            attnRoutine;            /*attention routine pointer*/
}ASPOpenPrm;
typedef ASPOpenPrm *ASPOpenPrmPtr;

typedef struct {
   XPPPBHeader
   Ptr            abortSCBPtr;            /*SCB pointer for ASPAbortOS*/
}ASPAbortPrm;
typedef struct {
   XPPPBHeader
   short          aspMaxCmdSize;       /*maximum size of data for commands*/
   short          aspQuantumSize;      /*maximum size of data for request */
                                       /* commands and receive replies*/
   short          numSesss;            /*number of concurrent sessions */
                                       /* for your node*/
}ASPGetparmsBlk;
</PRE>
<A NAME=HEADING222-38></A>
<H3>Routines</H3>
<A NAME=HEADING222-39></A>
<H4>Opening and Closing ASP Sessions</H4>
<PRE>
pascal OSErr ASPOpenSession(ASPOpenPrmPtr thePBptr, Boolean async);
pascal OSErr ASPCloseSession(XPPParmBlkPtr thePBptr, Boolean async);
pascal OSErr ASPCloseAll(XPPParmBlkPtr thePBptr, Boolean async); 
</PRE>
<A NAME=HEADING222-43></A>
<H4>Sending Commands and Writing Data From the Workstation to the Server</H4>
<PRE>
pascal OSErr ASPUserCommand(XPPParmBlkPtr thePBptr, Boolean async);
pascal OSErr ASPUserWrite(XPPParmBlkPtr thePBptr, Boolean async);
</PRE>
<A NAME=HEADING222-46></A>
<H4>Obtaining Information About ASP's Maximum Capacities and the Status of the Server</H4>
<PRE>
pascal OSErr ASPGetParms(XPPParmBlkPtr thePBptr, Boolean async); 
pascal OSErr ASPGetStatus(XPPParmBlkPtr thePBptr, Boolean async);
</PRE>
<A NAME=HEADING222-49></A>
<H4>Canceling an ASP Request to Open a Session</H4>
<PRE>
pascal OSErr ASPAbortOS(XPPParmBlkPtr thePBptr, Boolean async); 
</PRE>
<A NAME=HEADING222-51></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING222-52></A>
<H3>Constants</H3>
<A NAME=HEADING222-53></A>
<H4>Offsets in User Bytes</H4>
<PRE>
aspCmdCode        EQU   0              ;offset to command field
aspWSSNum         EQU   1              ;WSS number in OpenSessions
aspVersNum        EQU   2              ;ASP version number in OpenSessions

aspSSSNum         EQU   0              ;SSS number in OpenSessReplies
aspSessID         EQU   1              ;session ID (requests &amp; OpenSessReply)
aspOpenErr        EQU   2              ;OpenSessReply error code

aspSeqNum         EQU   2              ;sequence number in requests
aspAttnCode       EQU   2              ;attention bytes in attentions
</PRE>
<A NAME=HEADING222-55></A>
<H4>Offsets in ATP Data Part</H4>
<PRE>
aspWrBSize        EQU   0              ;offset to write buffer size
                                       ; (WriteData)
aspWrHdrSz        EQU   2              ;size of data part
</PRE>
<A NAME=HEADING222-57></A>
<H4>Command Codes (csCodes)</H4>
<PRE>
openSess          EQU   255            ;open session
closeSess         EQU   254            ;close session
userCommand       EQU   253            ;user command
userWrite         EQU   252            ;user write
getStatus         EQU   251            ;get status
afpCall           EQU   250            ;AFP command 
getParms          EQU   249            ;get parameters
abortOS           EQU   248            ;abort open session request
closeAll          EQU   247            ;close all open sessions
</PRE>
<A NAME=HEADING222-59></A>
<H4>ASP Commands </H4>
<PRE>
aspCloseSess      EQU   1              ;close session
aspCommand        EQU   2              ;user command
aspGetStat        EQU   3              ;get status
aspOpenSess       EQU   4              ;open session
aspTickle         EQU   5              ;tickle
aspWrite          EQU   6              ;write
aspDataWrite      EQU   7              ;writeData (from server)
aspAttention      EQU   8              ;attention (from server)
</PRE>
<A NAME=HEADING222-61></A>
<H4>Miscellaneous</H4>
<PRE>
aspVersion        EQU   $0100                ;ASP version number
maxCmdSize        EQU   atpMaxData           ;maximum command block size
quantumSize       EQU   atpMaxData*atpMaxNum ;maximum reply size
tickleInt         EQU   30                   ;tickle interval (secs)
tickleTime        EQU   tickleInt*60*4       ;tickle timeout (ticks)
xppLoadedBit      EQU   atpLoadedBit+1       ;XPP loaded bit number in
                                             ; PortBUse
</PRE>
<A NAME=HEADING222-63></A>
<H3>Data Structures</H3>
<A NAME=HEADING222-64></A>
<H4>XPP Parameter Block Common Fields for ASP Routines
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>qLink<TD>long<TD>reserved<TR>
<TD>4<TD>qType<TD>word<TD>reserved<TR>
<TD>6<TD>ioTrap<TD>word<TD>reserved<TR>
<TD>8<TD>ioCmdAddr<TD>long<TD>reserved<TR>
<TD>12<TD>ioCompletion<TD>long<TD>address of completion routine<TR>
<TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>18<TD>cmdResult<TD>long<TD>pointer to attention routine<TR>
<TD>22<TD>ioVRefNum<TD>word<TD>reserved<TR>
<TD>24<TD>ioRefNum<TD>word<TD>driver reference number</TABLE>
</H4>
<A NAME=HEADING222-65></A>
<H4>ASPOpenSession Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>openSess</CODE><TR>
<TD>28<TD>sessRefnum<TD>word<TD>session reference number<TR>
<TD>30<TD>aspTimeout<TD>byte<TD>retry interval in seconds<TR>
<TD>31<TD>aspRetry<TD>byte<TD>number of retries<TR>
<TD>32<TD>serverAddr<TD>long<TD>server internet socket address<TR>
<TD>36<TD>scbPointer<TD>pointer<TD>pointer to session control block<TR>
<TD>40<TD>attnRoutine<TD>long<TD>pointer to attention routine</TABLE>
</H4>
<A NAME=HEADING222-66></A>
<H4>ASPCloseSession Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>closeSes</CODE>s<TR>
<TD>28<TD>sessRefnum<TD>word<TD>session reference number</TABLE>
</H4>
<A NAME=HEADING222-67></A>
<H4>ASPCloseAll
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD><CODE>csCode</CODE><TD>word<TD>command code; always <CODE>closeAll</CODE></TABLE>
 Parameter Block</H4>
<A NAME=HEADING222-68></A>
<H4>ASPUserCommand Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>18<TD>cmdResult<TD>long<TD>ASP command result<TR>
<TD>26<TD>csCode<TD>word<TD>command code; always <CODE>userCommand</CODE><TR>
<TD>28<TD>sessRefnum<TD>word<TD>session reference number<TR>
<TD>30<TD>aspTimeout<TD>byte<TD>retry interval in seconds<TR>
<TD>32<TD>cbSize<TD>word<TD>command block size<TR>
<TD>34<TD>cbPtr<TD>pointer<TD>command block pointer<TR>
<TD>38<TD>rbSize<TD>word<TD>reply buffer and reply size<TR>
<TD>40<TD>rbPtr<TD>pointer<TD>pointer to reply buffer<TR>
<TD>50<TD>ccbStart<TD>record<TD>start of memory for CCB</TABLE>
</H4>
<A NAME=HEADING222-69></A>
<H4>ASPUserWrite Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>18<TD>cmdResult<TD>long<TD>ASP command result<TR>
<TD>26<TD>csCode<TD>word<TD>command code; always <CODE>userWrite</CODE><TR>
<TD>28<TD>sessRefnum<TD>word<TD>session reference number<TR>
<TD>30<TD>aspTimeout<TD>byte<TD>retry interval in seconds<TR>
<TD>32<TD>cbSize<TD>word<TD>size of command block<TR>
<TD>34<TD>cbPtr<TD>pointer<TD>pointer to command block<TR>
<TD>38<TD>rbSize<TD>word<TD>reply buffer size and reply size<TR>
<TD>40<TD>rbPtr<TD>pointer<TD>pointer to reply buffer<TR>
<TD>44<TD>wdSize<TD>word<TD>size of write data<TR>
<TD>46<TD>wdPtr<TD>pointer<TD>pointer to write data<TR>
<TD>50<TD>ccbStart<TD>record<TD>start of memory for CCB</TABLE>
</H4>
<A NAME=HEADING222-70></A>
<H4>ASPGetParms Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>getParm</CODE>s<TR>
<TD>28<TD>aspMaxCmdSize<TD>word<TD>maximum size of command block<TR>
<TD>30<TD>aspQuantumSize<TD>word<TD>maximum data size<TR>
<TD>32<TD>numSesss<TD>word<TD>maximum number of sessions</TABLE>
</H4>
<A NAME=HEADING222-71></A>
<H4>ASPGetStatus Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>getStatus</CODE><TR>
<TD>30<TD>aspTimeout<TD>byte<TD>retry interval in seconds<TR>
<TD>31<TD>aspRetry<TD>byte<TD>number of retries<TR>
<TD>32<TD>serverAddr<TD>long<TD>server internet socket address<TR>
<TD>38<TD>rbSize<TD>word<TD>reply buffer and reply size<TR>
<TD>40<TD>rbPtr<TD>pointer<TD>pointer to reply buffer<TR>
<TD>50<TD>ccbStart<TD>record<TD>start of memory for CCB</TABLE>
</H4>
<A NAME=HEADING222-72></A>
<H4>ASPAbortOS Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>abortOS</CODE><TR>
<TD>28<TD>abortSCBPtr<TD>pointer<TD>pointer to session control block</TABLE>
</H4>
<A NAME=HEADING222-73></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>aspBadVersNum<TD>-1066<TD>The server cannot support the ASP version number<TR>
<TD>aspBufTooSmall<TD>-1067 <TD>The reply data exceeds the size of the reply buffer; the <BR>.XPP driver will fill the buffer and truncate the data<TR>
<TD>aspNoMoreSess<TD>-1068  <TD>The .XPP driver cannot support another ASP session <BR>(the number of sessions that the driver is capable of <BR>supporting is dependent on the machine type)<TR>
<TD>aspNoServers<TD>-1069  <TD>There is no server at the specified <CODE>serverAddr</CODE> address, <BR>or the server did not respond to the request <TR>
<TD>aspParamErr<TD>-1070  <TD>You specified an invalid session reference number, or the <BR>session has been closed <TR>
<TD>aspServerBusy<TD>-1071  <TD>The server cannot open another session<TR>
<TD>aspSessClosed    <TD>-1072<TD>The .XPP driver is in the process of closing down the session<TR>
<TD>aspSizeErr<TD>-1073 <TD>The size of the command block exceeds the maximum size <BR>of <CODE>aspMaxCmdSize</CODE><TR>
<TD>cbNotFound<TD>-1102 <TD>Specified SCB was not found (there is no outstanding open session function call with this SCB)<TR>
<TD>reqAborted<TD>-1105  <TD>The <CODE>ASPOpenSession</CODE> function call was aborted by an <CODE>ASPAbortOS</CODE> function call<A NAME=MARKER-2-69></A></TABLE>
</H2>
<PRE>

</PRE>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-221.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-223.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
