<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Releasing and Detaching Resources (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING19></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-18.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-20.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-9.html"><B>Chapter 1 - Resource Manager</B></A> / <A HREF="MoreToolbox-16.html"><B>Using the Resource Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING19-0></A>
<H2><A NAME=MARKER-9-136></A>Releasing and Detaching Resources</H2>
 <A NAME=MARKER-2-220></A>When you've finished using a resource, you can call <CODE>ReleaseResource</CODE> to release the memory associated with that resource. For a given resource, the <CODE>ReleaseResource</CODE> procedure releases the memory associated with the resource, setting the handle's master pointer to <CODE>NIL</CODE>, thus making your application's handle to the resource invalid. (This is similar to the situation shown in <A HREF=MoreToolbox-18.html#MARKER-9-133>Figure 1-8</A>.) After releasing a resource, use another Resource Manager routine if you need to use the resource again. For example, the code in <A HREF=#MARKER-9-139>Listing 1-3</A> first uses <CODE>GetResource</CODE> to get a handle to a resource, manipulates <BR>the resource, then uses <CODE>ReleaseResource</CODE> when the application has finished <BR>using the resource. If the application needs the resource later, it must get a valid handle to the resource by reading the resource into memory again (using <CODE>GetResource</CODE>, for example).<A NAME=MARKER-2-320></A><P>
<B>Listing 1-3  <A NAME=MARKER-9-139></A>Releasing a resource <A NAME=MARKER-2-59></A></B><P>
<PRE>
PROCEDURE MyGetAndPlaySoundResource(resourceID: Integer);
VAR
   myHndl: Handle;
BEGIN
   myHndl := GetResource('snd ', resourceID);
   {use the resource}
   {when done, release the resource}
   ReleaseResource(myHndl);
END; 
</PRE>
 <A NAME=MARKER-2-350></A>Your application can also use the <CODE>DetachResource</CODE> procedure to replace a resource's handle in the resource map with a handle whose value is <CODE>NIL</CODE>. However, the <CODE>DetachResource</CODE> procedure does not release the memory associated with the resource. You can use <CODE>DetachResource</CODE> when you want your application to access the resource's data directly, without the aid of the Resource Manager, or when you need to pass the handle to a routine that does not accept a resource handle. (For example, the <CODE>AddResource</CODE> routine used in <A HREF=#MARKER-9-143>Listing 1-4 on page 1-18</A> takes a handle to data, not a handle to a resource.) Once you detach a resource, the Resource Manager does not recognize the resource's handle in the resource map in memory as a valid handle to a resource, but your application can still manipulate the resource's data through its own handle to the data. <P>
 <A HREF=#MARKER-9-142>Figure 1-9</A> shows how both your application and the Resource Manager have a handle to a resource after your application calls <CODE>GetResource</CODE>. The figure also shows how the Resource Manager replaces the handle in the resource map in memory with a handle whose value is <CODE>NIL</CODE> when your application calls <CODE>DetachResource</CODE>.<P>
<B>Figure 1-9  <A NAME=MARKER-9-142></A>Detaching a resource</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RM-L-07.jpg">
 You can also easily copy a resource by first reading in the resource using <CODE>GetResource</CODE>, detaching the resource using <CODE>DetachResource</CODE>, then copying the resource by using <CODE>AddResource</CODE> (and specifying a new resource ID). <A HREF=#MARKER-9-143>Listing 1-4</A> uses this technique to copy a resource within the current resource file.<P>
<B>Listing 1-4  <A NAME=MARKER-9-143></A>Detaching a resource <A NAME=MARKER-2-94></A></B><P>
<PRE>
PROCEDURE MyCopyAResource(resourceType: ResType; 
                           resourceID: Integer;
                           VAR myHndl: Handle);
VAR
   newResourceID: Integer;
BEGIN
   myHndl := GetResource(resourceType, resourceID);
   DetachResource(myHndl);                {detach the resource}
   newResourceID := UniqueID(resourceType);
   AddResource(myHndl, resourceType, newResourceID, '');
END;  
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-18.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-20.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
