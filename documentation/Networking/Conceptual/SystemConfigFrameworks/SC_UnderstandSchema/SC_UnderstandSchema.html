<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>System Configuration Programming Guidelines: The System Configuration Schema</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="The System Configuration Schema"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001065-CH203" title="The System Configuration Schema"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000429" target="_top">Networking</a> &gt; <a href="../SC_Intro/SC_Intro.html#//apple_ref/doc/uid/TP40001065-CH201-TPXREF101">System Configuration Programming Guidelines</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SC_Components/SC_Components.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SC_ReachConnect/SC_ReachConnect.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIHDCG" title="The System Configuration Schema"></a><h1>The System Configuration Schema</h1><p>The System Configuration schema defines the layout of network configuration information in the persistent store. This chapter describes this layout and some of the specific combinations of key-value pairs that define sets and services. It then describes which key-value pairs the configuration agents use to manage their areas of interest. Finally, this chapter describes how to use your knowledge of the schema to provide preferences that define a service. You should read this chapter if your application defines sets or services. Additionally, if your application needs detailed information about the status of a PPP connection, you should read this chapter to find out how to interpret the information you receive. </p><p>Most network-aware applications do not need to access network preferences or the dynamic store to perform their tasks. If your application requests network connections or finds out if a remote server is reachable, you might choose to skip ahead to <span class="content_text"><a href="../SC_ReachConnect/SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-BHAFBAHI">“Determining Reachability and Getting Connected.”</a></span></p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFDHFG">Layout of the Persistent Store</a>
				
			<br/>
			
        
			
			
				<a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDDEDFJ">Behavior of the Configuration Agents</a>
				
			<br/>
			
        
			
			
				<a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-TPXREF108">Using the Schema</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001065-CH203-CHDFDHFG" title="Layout of the Persistent Store"></a><h2>Layout of the Persistent Store</h2><p>The hierarchical placement of keys and values in the persistent store is dictated by the System Configuration schema. This section describes the hierarchy of key-value pairs and identifies some of the specific combinations of preferences that define individual services. </p><p><span class="content_text"><a href="../SC_Components/SC_Components.html#//apple_ref/doc/uid/TP40001065-CH207-CHDFEICD">“The Persistent Store”</a></span> introduces the four top-level preferences in the persistent store:</p><ul class="ul"><li class="li"><p>Sets</p></li><li class="li"><p>CurrentSet</p></li><li class="li"><p>NetworkServices </p></li><li class="li"><p>System</p></li></ul><p>The system uses the information in these four preferences to configure network services. <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBDCJIB">Figure 3-1</a></span> shows how these preferences are related.</p><br/><div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBDCJIB" title="Figure 3-1Relationship among top-level preferences in the persistent store"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>Relationship among top-level preferences in the persistent store</p><img src = "../art/sc_sets_layout.gif" alt = "Relationship among top-level preferences in the persistent store" width="401" height="381"></div><br/><p>As you can see in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBDCJIB">Figure 3-1</a></span>, the System preference is separate from the other three preferences. This is because the System dictionary contains global, system-wide information, such as the computer name. This information is applicable to the machine as a whole, regardless of the current network configuration. A network-configuration application has no need to add values to the System preference.</p><p>The CurrentSet preference always contains the internal ID that represents the currently active set in the Sets preference (in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBDCJIB">Figure 3-1</a></span>, this is Set<em>k</em>). When a user selects a different location in Network preferences or from the Apple menu, the preferences monitor notices and updates the dynamic store to reflect the change. For more information on the preferences monitor, see <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFGAEF">“Preferences Monitor ”</a></span>).</p><p>The remaining two top-level preferences, Sets and NetworkServices, contain the bulk of the information the system needs to configure network services. As you can see in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBDCJIB">Figure 3-1</a></span>, a set listed in the Sets dictionary contains the internal IDs that represent individual services listed in the NetworkServices dictionary. The following sections describe the Sets and NetworkServices dictionaries in more detail.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDCCHIA" title="The Sets Dictionary"></a><h3>The Sets Dictionary</h3><p>The Sets dictionary contains a subdictionary for each set defined in the system. Generally, sets represent the locations created by the user in Network preferences, although network-configuration applications can also create them. For example, an ISP might provide an application that defines a new location that makes it easy for a user to connect to the ISP. To offer this new location, the application creates a new set dictionary and some number of new services. The new set dictionary contains configuration information for the location, including a property that holds the ISP’s name, and references to the new services. </p><p>Each individual set dictionary within the top-level Sets dictionary contains the following properties:</p><ul class="spaceabove"><li class="li"><p>UserDefinedName</p></li><li class="li"><p>Network</p></li></ul><p>The <strong>UserDefinedName</strong> property is a string that holds the location name the user enters in Network preferences. An application that defines a new location would use this key to provide a suitable location name, for example, the name of the ISP. The ISP’s name is then displayed in the Location menu of Network preferences and in the Apple menu. </p><p>The <strong>Network</strong> property is a dictionary that describes the network configuration for the set, including a list of services defined for the set. Every Network dictionary within a set should contain the following properties, all of which are dictionaries: </p><ul class="spaceabove"><li class="li"><p>Global</p></li><li class="li"><p>Interface</p></li><li class="li"><p>Service</p></li></ul><p>As its name implies, the <strong>Global</strong> dictionary supplies information that is not specific to any particular service. Currently, the Global dictionary contains two member dictionaries: IPv4 and NetInfo, both of which are required. </p><p>The IPv4 dictionary should contain the ServiceOrder key. This key’s value is an array that allows the user to impose an ordering on his network services in Network preferences. When multiple services are active at the same time, the system uses the ServiceOrder array to determine which service should be deemed primary. The primary service determines the default route and the DNS and proxy server configurations.</p><p>The IPv4 dictionary may also contain the PPPOverridePrimary key. This is a legacy key that allows any active PPP-based service to be treated as if it were first in the ServiceOrder array. This functionality has been replaced by allowing any individual service to include an OverridePrimary key in its own (per service) IPv4 dictionary.</p><p>The NetInfo dictionary contains NetInfo binding preferences. As the use of Directory Services becomes more widespread, however, the NetInfo dictionary will become less common.</p><p>The <strong>Interface</strong> dictionary holds per-interface settings. Each member of the Interface dictionary is a subdictionary identified by the BSD name of the interface, such as <code>en0</code>. Each subdictionary contains a dictionary named Ethernet, which holds the results of a manual configuration of the interface. Speed, duplex, and maximum packet size (maximum transfer unit, or MTU) values are stored here. This information is stored at the interface level to prevent individual services from attempting to configure the same interface in different ways. </p><p>Typically, however, the user accepts the default Ethernet configuration by choosing the Automatically option in the Ethernet configuration tab of Network preferences. When this is the case, the Ethernet dictionary is either not present or contains the key <code>__INACTIVE__</code>.</p><p>The <strong>Service</strong> dictionary contains references to the services defined for this set. Every member of the Service dictionary is itself a dictionary that contains a single member—an internal service ID that refers to a service listed in the top-level NetworkServices dictionary. Network preferences uses the information in the Service dictionary to display the services and whether or not they’re enabled. The preferences monitor also uses this information as it loads the current configuration preferences into the dynamic store (for more information on this process, see <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFGAEF">“Preferences Monitor ”</a></span>).</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDFBDCB" title="The NetworkServices Dictionary"></a><h3>The NetworkServices Dictionary</h3><p>The top-level NetworkServices dictionary contains all the network services defined for the system. Each network service is represented by a dictionary (identified by a unique key) that contains the configuration properties for the entities associated with that service. The combination of entities is determined by the type of service. For example, a modem-based service needs the Interface, PPP, Modem, and IPv4 entities, but not the AppleTalk entity, because Mac OS X does not support AppleTalk over PPP.</p><p>If you are developing an application that adds a service to a new set, you need to create a network service dictionary that describes it. This section outlines the contents of a network service dictionary.</p><p>A network service dictionary can include the following properties:</p><ul class="spaceabove"><li class="li"><p>An interface dictionary that describes the network interface underlying the service</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH203-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp;If you want to ensure that the appropriate configuration agent processes your service, you must include an interface dictionary in your network service dictionary.</p></div></li><li class="li"><p>A variable number of protocol entity dictionaries, each of which describes the configuration of a protocol entity (such as PPP or AppleTalk) that’s defined for the service. (Note that some protocol entity dictionaries may be present in a network service dictionary but be empty or marked as inactive.)</p></li><li class="li"><p>One hardware entity dictionary, depending on the type of service (the type of service is specified in the interface entity dictionary)</p></li><li class="li"><p>A proxies dictionary that identifies which proxies are enabled for the service</p></li><li class="li"><p>A user-visible name for the service</p></li></ul><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDEJACB" title="The Interface Dictionary"></a><h4>The Interface Dictionary</h4><p>The Interface dictionary describes the transport of the service’s network connection. The contents of the Interface dictionary vary according to the type of the service, but three members are required:</p><ul class="spaceabove"><li class="li"><p>DeviceName</p></li><li class="li"><p>Hardware</p></li><li class="li"><p>Type</p></li></ul><p>The value of the <strong>DeviceName</strong> key supplies the BSD device name for the network connection, for example, <code>en0</code> or <code>en1</code>. For serial-like devices, the value of the DeviceName key is the base name, minus any prefix. For example, the DeviceName value for a modem with the name <code>cu.modem</code> is <code>modem</code>. Currently, the System Configuration framework does not supply API to find all ports suitable for networking. See <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDHAHCI">“Programmatically Setting Preferences”</a></span> for a reference to a library of sample code that can help with this. </p><p>The value of the <strong>Hardware</strong> key is a property of type CFString that names the type of hardware underlying the network connection, such as Ethernet or AirPort. You can view the contents of this dictionary as a reference to the hardware entity dictionary of the same name (for more information on hardware entity dictionaries, see <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDECAAI">“Hardware Entity Dictionaries”</a></span>).</p><p>The <strong>Type</strong> key identifies the type of connection, which could be Ethernet, FireWire, PPP, or 6to4.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH203-SW2" title="Note"></a><p><strong>Note:</strong>&nbsp;If the service is PPP, the value of the Type key must be PPP and a SubType key must be added to indicate the type of PPP, such as PPPoE (PPP over Ethernet).</p></div><p>In addition to the required keys, the Interface dictionary usually contains the <strong>UserDefinedName</strong> key, which holds the user-visible name of the network port. </p><p>The Interface dictionary keys and values are summarized in <span class="content_text">Table 3-1</span>, along with associated actions of configuration agents.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBGFDGA" title="Table 3-1Keys and values for the Interface dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Keys and values for the Interface dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Further action required</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>DeviceName</p></td><td ><p>BSD device name</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Hardware</p></td><td ><p>AirPort</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Hardware</p></td><td ><p>Ethernet</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Hardware</p></td><td ><p>Modem</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Type</p></td><td ><p>Ethernet</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Type</p></td><td ><p>FireWire</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Type</p></td><td ><p>6to4</p></td><td ><p>None</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Type</p></td><td ><p>PPP</p></td><td ><p>Must supply a SubType key.</p></td><td ><p>PPP controller configures this service.</p></td></tr><tr><td  scope="row"><p>SubType</p></td><td ><p>PPPoE</p></td><td ><p>Required for PPP over Ethernet services.</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SubType</p></td><td ><p>PPPSerial</p></td><td ><p>Required for PPP over serial, modem, Bluetooth, etc. services.</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SubType</p></td><td ><p>PPTP</p></td><td ><p>Required for VPN (using PPTP) services.</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SubType</p></td><td ><p>L2TP</p></td><td ><p>Required for VPN (using L2TP) services.</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>UserDefinedName</p></td><td ><p>Human readable name </p></td><td ><p>None</p></td><td ><p></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF101" title="Protocol Entity Dictionaries"></a><h4>Protocol Entity Dictionaries</h4><p>Each protocol entity dictionary contains the information the system needs to configure the protocol. For example, the ConfigMethod property in the IPv4 entity dictionary might tell the system to use DHCP to configure IPv4. </p><p>Currently, the protocol entities that can be defined for a service are:</p><ul class="spaceabove"><li class="li"><p>AppleTalk</p></li><li class="li"><p>DNS</p></li><li class="li"><p>IPv4</p></li><li class="li"><p>IPv6</p></li><li class="li"><p>PPP</p></li></ul><p>For the most part, a service dictionary can contain any combination of these protocol entity dictionaries. If an interface does not support a protocol, however, the corresponding dictionary is ignored. For example, in Mac OS X version 10.3, the AppleTalk dictionary is ignored for PPP services because Mac OS X does not support AppleTalk over PPP.</p><p>The contents of some protocol entity dictionaries (such as PPP) affect the contents of other members of a network service dictionary. The following sections describe the contents of each protocol entity dictionary, including any effect those contents might have on other properties.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF102" title="AppleTalk"></a><h5>AppleTalk</h5><p>The AppleTalk protocol entity dictionary is an optional protocol entity dictionary. If it is present, it contains the following required key:</p><ul class="spaceabove"><li class="li"><p>ConfigMethod (<code>kSCValNetAppleTalkConfigMethod</code>) </p></li></ul><p>The possible values for the ConfigMethod key are:</p><ul class="spaceabove"><li class="li"><p>Node (<code>kSCPropNetAppleTalkConfigMethodNode</code>). The standard AppleTalk configuration, which is suitable for general workstations.</p></li><li class="li"><p>Router (<code>kSCPropNetAppleTalkConfigMethodRouter</code>). Used for AppleTalk routers.</p></li><li class="li"><p>SeedRouter (<code>kSCPropNetAppleTalkConfigMethodSeedRouter</code>). Used for AppleTalk seed routers.</p></li></ul><p>Depending on which configuration method you choose, other key-value pairs may be required. For example, if you select the SeedRouter configuration method, you must also supply values for the SeedNetworkRange and SeedZones keys. </p><p>For more information on AppleTalk configuration options, you can view the man page for the <code>appletalk.cfg</code> file (the default configuration file the <code><!--a-->appletalk<!--/a--></code> command reads) at <span class="content_text"><a href="../../../../../documentation/Darwin/Reference/ManPages/index.html" target="_top">http://developer.apple.com/documentation/Darwin/Reference/ManPages/index.html</a></span>.</p><p>The key-value pairs in the AppleTalk protocol entity dictionary have no effect on the contents of other dictionaries in a network service dictionary.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF103" title="DNS"></a><h5>DNS</h5><p>The DNS protocol entity dictionary is an optional protocol entity dictionary. It is usually present in a service’s network service dictionary, but is often empty. An empty DNS protocol dictionary means that the user chooses not to manually configure DNS, allowing the DNS server names and search domains to be automatically supplied by the ISP.</p><p>If you want to require the use of specific DNS servers and search domains, you can add any of the following optional keys to the DNS protocol entity dictionary:</p><ul class="spaceabove"><li class="li"><p>DomainName (<code>kSCPropNetDNSDomainName</code>)</p></li><li class="li"><p>SearchDomains (<code>kSCPropNetDNSSearchDomains</code>)</p></li><li class="li"><p>ServerAddresses (<code>kSCPropNetDNSServerAddresses</code>)</p></li><li class="li"><p>SortList (<code>kSCPropNetDNSSortList</code>)</p></li></ul><p>For more information on the SortList key, you can view the man page for the resolver configuration file format at <span class="content_text"><a href="../../../../../documentation/Darwin/Reference/ManPages/index.html" target="_top">http://developer.apple.com/documentation/Darwin/Reference/ManPages/index.html</a></span>.</p><p>The key-value pairs in the DNS protocol entity dictionary have no effect on the contents of other dictionaries in a network service dictionary.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF104" title="IPv4"></a><h5>IPv4</h5><p>The IPv4 protocol entity dictionary is an optional protocol entity dictionary. It has one required key:</p><ul class="spaceabove"><li class="li"><p>ConfigMethod (<code>kSCPropNetIPv4ConfigMethod</code>) </p></li></ul><p><span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBGJIHI">Table 3-2</a></span> shows the six possible values of the ConfigMethod key. It also shows the additional keys you must supply with certain ConfigMethod values.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBGJIHI" title="Table 3-2Optional values for the IPv4 ConfigMethod key"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-2&nbsp;&nbsp;</strong>Optional values for the IPv4 ConfigMethod key</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Further action required</p></th></tr><tr><td  scope="row"><p>BOOTP</p></td><td ><p>None</p></td></tr><tr><td  scope="row"><p>DHCP</p></td><td ><p>None</p></td></tr><tr><td  scope="row"><p>LinkLocal</p></td><td ><p>None</p></td></tr><tr><td  scope="row"><p>INFORM</p></td><td ><p>Provide values for Addresses, Router, SubnetMasks <code>Setup:</code> keys.</p></td></tr><tr><td  scope="row"><p>Manual</p></td><td ><p>Provide values for Addresses, Router, SubnetMasks <code>Setup:</code> keys.</p></td></tr><tr><td  scope="row"><p>PPP</p></td><td ><p>Can specify a manual address.</p></td></tr></table></div><p>For all ConfigMethod values except PPP, the IPv4 configuration agent publishes values for the Addresses, SubnetMasks, Router, and InterfaceName <code>State:</code> keys. When the ConfigMethod is PPP, the PPP controller publishes values for the Addresses, DestAddresses, Router, and InterfaceName <code>State:</code> keys. For more information on these configuration agents, see <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDDEDFJ">“Behavior of the Configuration Agents.”</a></span></p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF105" title="IPv6"></a><h5>IPv6</h5><p>The IPv6 protocol entity dictionary is an optional protocol entity dictionary. The IPv6 protocol entity dictionary has much the same composition as the IPv4 protocol entity dictionary and it, too, has a single required key:</p><ul class="spaceabove"><li class="li"><p>ConfigMethod (<code>kSCPropNetIPv6ConfigMethod</code>)</p></li></ul><p><span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BGBDHHDH">Table 3-3</a></span> shows the four possible values of the ConfigMethod key, along with any further action required.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBDHHDH" title="Table 3-3Optional values for the IPv6 ConfigMethod key"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-3&nbsp;&nbsp;</strong>Optional values for the IPv6 ConfigMethod key</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Further action required</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>Automatic</p></td><td ><p>None</p></td><td ><p>IPv6 configuration agent publishes values for Addresses, PrefixLength, Flags, and InterfaceName <code>State:</code> keys.</p></td></tr><tr><td  scope="row"><p>Manual</p></td><td ><p>Provide values for Addresses, Router, and PrefixLength</p></td><td ><p>IPv6 configuration agent publishes values for Addresses, PrefixLength, Flags, Router, and InterfaceName <code>State:</code> keys.</p></td></tr><tr><td  scope="row"><p>RouterAdvertisement</p></td><td ><p>None</p></td><td ><p>IPv6 configuration agent publishes values for PrefixLength, Flags, and InterfaceName <code>State:</code> keys.</p></td></tr><tr><td  scope="row"><p>6to4</p></td><td ><p>Provide value for 6to4 Relay</p></td><td ><p>IPv6 configuration agent publishes values for Addresses, PrefixLength, Flags, and InterfaceName <code>State:</code> keys.</p></td></tr></table></div><p>If an IPv6 protocol entity dictionary is present in a network service dictionary, the PPP controller triggers IPv6 negotiation within PPP. It then configures the LinkLocal address if the IPv6 negotiation with the server was successful.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF106" title="PPP"></a><h5>PPP</h5><p>The PPP protocol entity dictionary is an optional protocol entity dictionary. The schema provides many keys and values for use in this dictionary to allow developers to define finely grained services. The content of the PPP protocol entity dictionary affects the contents of some of the other dictionaries in a network service, most notably, the IPv4 and Interface dictionaries. In addition, the presence of a PPP service in a set requires the presence of the PPPOverridePrimary key in the IPv4 subdictionary in the set’s Global dictionary (as described in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDCCHIA">“The Sets Dictionary”</a></span>).</p><p>Mac OS X recognizes a wide range of options for PPP services, many of which are used only in very special circumstances. This document does not attempt to describe them all. Instead, this section focuses on the PPP options a user sees in Network preferences. Because you can connect to the vast majority of PPP services using these more generic options, you can create a PPP protocol entity dictionary using the keys described in this section (and their default values), and your connection should succeed. Then, you can refine your service by adding other keys defined in the <code>SCSchemaDefinitions.h</code> file. </p><p><span class="content_text">Table 3-4</span> shows the keys for the user-visible PPP options, along with some possible values.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBDAIBA" title="Table 3-4Optional keys and values for the PPP protocol entity dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-4&nbsp;&nbsp;</strong>Optional keys and values for the PPP protocol entity dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key </p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>DialOnDemand</p></td><td ><p>0 </p></td><td ><p>Enables automatic dial-up. This key should be used with care to avoid unwanted dialing.</p></td></tr><tr><td  scope="row"><p>IdleReminder</p></td><td ><p>0</p></td><td ><p>Prompts the user to maintain the PPP connection when the seconds in the IdleReminderTimer value elapse. If the user doesn’t acknowledge the onscreen dialog, PPP automatically disconnects.</p></td></tr><tr><td  scope="row"><p>IdleReminderTimer</p></td><td ><p>1800</p></td><td ><p>The number of seconds to elapse before the user is reminded to maintain the PPP connection (if IdleReminder is enabled).</p></td></tr><tr><td  scope="row"><p>DisconnectOnIdle</p></td><td ><p>1</p></td><td ><p>Automatically disconnects if there is no traffic for the number of seconds in the DisconnectOnIdleTimer value.</p></td></tr><tr><td  scope="row"><p>DisconnectOnIdleTimer</p></td><td ><p>900</p></td><td ><p>The number of idle seconds to elapse before the PPP connection automatically disconnects (if DisconnectOnIdle is enabled).</p></td></tr><tr><td  scope="row"><p>DisconnectOnLogout</p></td><td ><p>1</p></td><td ><p>Automatically disconnects when the user logs out or when the user switches out with fast user switching.</p></td></tr><tr><td  scope="row"><p>CommRedialEnabled</p></td><td ><p>1</p></td><td ><p>For modem-based connections, enables redial if busy.</p></td></tr><tr><td  scope="row"><p>CommRedialCount</p></td><td ><p>1</p></td><td ><p>The number of times to redial if busy (if CommRedialEnabled is enabled).</p></td></tr><tr><td  scope="row"><p>CommRedialInterval</p></td><td ><p>30</p></td><td ><p>The interval in seconds to wait between redialing if busy (if CommRedialEnabled is enabled).</p></td></tr><tr><td  scope="row"><p>LCPEchoEnabled</p></td><td ><p>1</p></td><td ><p>Enables the PPP echo protocol. This protocol allows the rapid detection of an unreported modem disconnection. Enabling this protocol generates additional traffic and may not be suitable if the user pays by traffic load instead of by connection time.</p></td></tr><tr><td  scope="row"><p>IPCPCompressionVJ</p></td><td ><p>1</p></td><td ><p>Enables VJ (Van Jacobson) compression on the PPP link. For PPPSerial connections, the value can be 1 (“on”) or 0 (“off”). For PPPoE, PPTP, and L2TP connections, the value should be 0 (“off”).</p></td></tr><tr><td  scope="row"><p>CommDisplayTerminalWindow</p></td><td ><p>0</p></td><td ><p>Enables display of a Terminal window to show login and password interaction with a server. This works only with PPPSerial connections.</p></td></tr><tr><td  scope="row"><p>VerboseLogging</p></td><td ><p>0</p></td><td ><p>Enables the logging of the entire PPP negotiation, which can be useful for debugging a connection failure.</p></td></tr><tr><td  scope="row"><p>UserDefinedName</p></td><td ><p></p></td><td ><p>Optional name for the connection. This value has no effect on the PPP protocol.</p></td></tr><tr><td  scope="row"><p>AuthName</p></td><td ><p></p></td><td ><p>User name for authentication purposes.</p></td></tr><tr><td  scope="row"><p>AuthPassword</p></td><td ><p></p></td><td ><p>Password for authentication purposes.</p></td></tr><tr><td  scope="row"><p>CommRemoteAddress</p></td><td ><p></p></td><td ><p>The address or name of the remote server. This can be a phone number for a PPPSerial connection, a ServiceName for a PPPoE connection, or an IP address or name for a PPTP or L2TP connection.</p></td></tr><tr><td  scope="row"><p>CommAlternateRemoteAddress</p></td><td ><p></p></td><td ><p>Used only for PPPSerial connections, this is an alternate address to use when the address in CommRemoteAddress is busy.</p></td></tr></table></div><p>The definition of a PPP service requires a few changes in some of the other members of your network service dictionary. If you are providing a PPP service, you need to make the following changes to the network service dictionary you are building:</p><ul class="spaceabove"><li class="li"><p>The Type key in the Interface dictionary must have the value PPP. This ensures the PPP Controller agent will act on this service.</p></li><li class="li"><p>You must add the SubType key to the Interface dictionary and give it the value that describes the type of PPP service you’re providing, such as PPPoE or L2TP.</p></li><li class="li"><p>If you’re defining a PPP service meant to be used over a modem, you’ll need to add a modem hardware entity dictionary to the network service dictionary.</p></li></ul><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDECAAI" title="Hardware Entity Dictionaries"></a><h4>Hardware Entity Dictionaries</h4><p>Your network service dictionary must contain exactly one hardware entity dictionary, which should provide information on a per-service basis. Its name must match the value of the Hardware property of the Interface dictionary (described in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDEJACB">“The Interface Dictionary”</a></span>). The hardware entity dictionary can be:</p><ul class="spaceabove"><li class="li"><p>Ethernet</p></li><li class="li"><p>AirPort</p></li><li class="li"><p>Modem</p></li></ul><p>A hardware entity dictionary contains details about the network hardware underlying the service defined by the network service dictionary. Therefore, the keys and values in the dictionary vary according to the type of hardware the dictionary describes.</p><p>The <strong>AirPort</strong> hardware entity dictionary can contain some combination of the keys shown in <span class="content_text">Table 3-5</span>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH203-SW3" title="Note"></a><p><strong>Note:</strong>&nbsp;In versions of Mac OS X later than 10.3, the contents of the AirPort hardware entity dictionary may move to another location. </p></div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBGABCJ" title="Table 3-5Keys and values for the AirPort hardware entity dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-5&nbsp;&nbsp;</strong>Keys and values for the AirPort hardware entity dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key </p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>AllowNetCreation</p></td><td ><p>0 or 1</p></td></tr><tr><td  scope="row"><p>AuthPassword</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>AuthPasswordEncryption</p></td><td ><p>Keychain</p></td></tr><tr><td  scope="row"><p>JoinMode</p></td><td ><p>Automatic </p></td></tr><tr><td  scope="row"><p>JoinMode</p></td><td ><p>Preferred</p></td></tr><tr><td  scope="row"><p>JoinMode</p></td><td ><p>Recent</p></td></tr><tr><td  scope="row"><p>JoinMode</p></td><td ><p>Strongest</p></td></tr><tr><td  scope="row"><p>PowerEnabled</p></td><td ><p>0 or 1</p></td></tr><tr><td  scope="row"><p>PreferredNetwork</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SavePasswords</p></td><td ><p>0 or 1</p></td></tr></table></div><p>The <strong>Modem</strong> hardware entity dictionary supports a large number of options that allow you to specify a highly detailed setup. <span class="content_text">Table 3-6</span> displays some of the keys the schema defines along with some typical values.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIFHBC" title="Table 3-6Keys and typical values for the Modem hardware entity dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-6&nbsp;&nbsp;</strong>Keys and typical values for the Modem hardware entity dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>ConnectionScript</p></td><td ><p>Name of file in modem scripts folder</p></td><td ><p>This is the CCL (connection control language) script.</p></td></tr><tr><td  scope="row"><p>DataCompression</p></td><td ><p>1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>DialMode</p></td><td ><p>WaitForDialTone</p></td><td ><p>Other values are IgnoreDialTone and Manual.</p></td></tr><tr><td  scope="row"><p>ErrorCorrection</p></td><td ><p>1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HoldCallWaitingAudibleAlert</p></td><td ><p>0 or 1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HoldDisconnectOnAnswer</p></td><td ><p>0 or 1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HoldEnabled</p></td><td ><p>0 or 1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HoldReminder</p></td><td ><p>0 or 1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HoldReminderTime</p></td><td ><p></p></td><td ><p></p></td></tr><tr><td  scope="row"><p>PulseDial</p></td><td ><p>0</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Speaker</p></td><td ><p>1</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Speed</p></td><td ><p></p></td><td ><p>The speed the serial port is opened with to communicate with the modem.</p></td></tr></table></div><p>As the developer of a network-configuration application, you supply the modem options required by your setup. When a user opens Network preferences, she can set the options that matter to her. For example, an application can set the ConnectionScript property to point to a file in the modem scripts folder at <code>/Library/Modem Scripts</code>. A user might choose different Speaker and DialMode options depending on the environment in which she is making the connection. </p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF107" title="The Proxies Dictionary"></a><h4>The Proxies Dictionary</h4><p>The Proxies dictionary in each network service dictionary contains the proxy server configuration information. The System Configuration schema defines several properties that allow a user to specify how to configure proxies for the given service. For example, a user can:</p><ul class="spaceabove"><li class="li"><p>Choose which proxies to enable</p></li><li class="li"><p>Identify the server and port associated with enabled proxies</p></li><li class="li"><p>List network resources that should be accessed without a proxy server</p></li></ul><p>A network-configuration application might deliver a custom set of default proxy information for the user to accept or modify. To do this, the application supplies a Proxies dictionary that includes specific proxy servers, ports, and enable status. </p><p>For most proxy types, the <code>SCSchemaDefinitions.h</code> file defines three keys that provide the name of the proxy, the port, and whether or not the proxy is enabled. The keys are of the form <em>Protocol</em>Proxy, <em>Protocol</em>Port, and ProtocolEnable, where <em>Protocol</em> is the name of the service to be proxied. In addition, the schema defines the ExceptionsList key which allows you to list specific hosts and domains for which the proxy settings should be bypassed. <span class="content_text">Table 3-7</span> lists the keys and values you can use to create a Proxies dictionary.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDGJFDI" title="Table 3-7Keys and values for the Proxies dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-7&nbsp;&nbsp;</strong>Keys and values for the Proxies dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>ExceptionsList</p></td><td ><p>Array of host and domain names</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>FTPPassive</p></td><td ><p>0 or 1</p></td><td ><p>Controls whether or not FTP clients use passive FTP. Note that passive FTP can cause problems with older servers and some network configurations. Default value is 1 (passive FTP enabled).</p></td></tr><tr><td  scope="row"><p>FTPEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of FTPEnable is 1, the FTP proxy server is specified by the value of the FTPProxy key.</p></td></tr><tr><td  scope="row"><p>FTPPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>FTPProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>GopherEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of GopherEnable is 1, the gopher proxy server is specified by the value of the GopherProxy key.</p></td></tr><tr><td  scope="row"><p>GopherPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>GopherProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HTTPEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of HTTPEnable is 1, the HTTP proxy server is specified by the value of the HTTPProxy key.</p></td></tr><tr><td  scope="row"><p>HTTPPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HTTPProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HTTPSEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of HTTPSEnable is 1, the HTTPS proxy server is specified by the value of the HTTPSProxy key.</p></td></tr><tr><td  scope="row"><p>HTTPSPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>HTTPSProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>RTSPEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of RTSPEnable is 1, the RTSP proxy server is specified by the value of the RTSPProxy key.</p></td></tr><tr><td  scope="row"><p>RTSPPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>RTSPProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SOCKSEnable</p></td><td ><p>0 or 1</p></td><td ><p>If the value of SOCKSProxy is 1, the SOCKS proxy server is specified by the value of the SOCKSProxy key.</p></td></tr><tr><td  scope="row"><p>SOCKSPort</p></td><td ><p>Port number</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>SOCKSProxy</p></td><td ><p>Proxy server</p></td><td ><p></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDDEDFJ" title="Behavior of the Configuration Agents"></a><h2>Behavior of the Configuration Agents</h2><p>Recall that the system-level daemon, <code>configd</code>, keeps the network state data current by initializing the dynamic store and loading the configuration agents as bundles (or plug-ins). The agents run within the <code>configd</code> memory space and are each responsible for a well-defined area of configuration management.</p><p>The configuration agents use the keys and values defined in the <code>SCSchemaDefinitions.h</code> file to communicate with the dynamic store. The agents use some keys to obtain configuration information and others to publish the results of events they detect and actions they take.</p><p>Although some configuration agents are of internal interest only, others affect the dynamic store in ways your application might need to understand. This section describes the behavior of these configuration agents and lists many of the keys and values they use.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDFGAEF" title="Preferences Monitor "></a><h3>Preferences Monitor </h3><p>The preferences monitor reads the currently active configuration set specified by the user’s CurrentSet preference and loads the associated preferences into the dynamic store. Loading the preferences involves a mapping process that flattens into a single level the hierarchy of nested dictionaries that make up the currently active set. The mapping replaces each nested dictionary with a new key-value pair. The new key is the path from the root of the set dictionary to the nested dictionary and the value is the nested dictionary’s value, minus any additional nested dictionaries. In this way, an arbitrarily deep hierarchy of nested dictionaries can be represented as a series of top-level dictionaries, none of which contain nested dictionaries. </p><p>The mapping process also removes dictionaries that are empty or marked inactive and it resolves all references and links. It’s important to note that a dictionary is considered inactive when it contains the <code>__INACTIVE__</code> key, regardless of the key’s value.</p><p>As it maps the contents of the set dictionary into the dynamic store, the preferences monitor prefixes each key with the string <code>Setup:</code>. This identifies these keys as having come from the user’s preferences in the persistent store. Other keys in the dynamic store begin with other strings, such as <code>State:</code>. The <code>State:</code> keys are those the other configuration agents use to hold transient network and system state information.</p><p>As an example of the mapping process the preferences monitor performs, <span class="content_text">Listing 3-1</span> shows a subset of a user’s preferences as it appears in the persistent store.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDCHDJF" title="Listing 3-1Subset of service dictionary (ServiceID 100)"></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>Subset of service dictionary (<code>ServiceID</code> 100)</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key>100&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>IPv4&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>ConfigMethod&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>BootP&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>DNS&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Interface&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>DeviceName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>en0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>Hardware&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>Type&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UserDefinedName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>Built-in Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>UserDefinedName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Built-in Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p><span class="content_text">Listing 3-2</span> shows what this dictionary looks like after the preferences monitor maps it.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDHCDDH" title="Listing 3-2Subset of service dictionary, after mapping into the dynamic store"></a><p class="codesample"><strong>Listing 3-2&nbsp;&nbsp;</strong>Subset of service dictionary, after mapping into the dynamic store</p><div class="codesample"><table><tr><td scope="row"><pre>/Network/Service/100<span></span></pre></td></tr><tr><td scope="row"><pre>/Network/Service/100/IPv4<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dictionary><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>ConfigMethod&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>BootP&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dictionary><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/Network/Service/100/Interface<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dictionary><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>DeviceName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>en0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Hardware&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Type&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>UserDefinedName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Built-in Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dictionary><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dictionary><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>UserDefinedName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Built-in Ethernet&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dictionary><span></span></pre></td></tr></table></div><p>As you can see in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDHCDDH">Listing 3-2</a></span>, the IPv4 and Interface subdictionaries are now at the same level as their parent (the service dictionary) and have keys that describe their position in the parent dictionary. In addition, the empty DNS subdictionary in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDCHDJF">Listing 3-1</a></span> is not represented in the mapping.</p><p>When it generates a new mapping, the preferences monitor keeps track of the differences from the old mapping. Applying these differences to the dynamic store triggers notifications associated with keys that have changed. This ensures that reconfiguration is automatic when, for example, a user selects a different location in Network preferences or from the Apple menu.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBEEBEJ" title="Kernel Event Monitor "></a><h3>Kernel Event Monitor </h3><p>The kernel event monitor maintains a list of all network interfaces defined in the system, the link status associated with each interface, and any assigned addresses. It monitors low-level kernel events and watches the network stacks, keeping track of the link status of each network interface. The kernel event monitor’s main job is to post the status of each network interface in the dynamic store. This frees applications from having to reach into the kernel to find out, for example, if the Ethernet cable is plugged in or if the assigned addresses have changed.</p><p>Unlike most other agents, the kernel event monitor does not retrieve configuration information from <code>Setup:</code> keys in the dynamic store. Instead, it receives its input directly from the kernel and publishes its observations in some of the <code>State:</code> keys, as shown in <span class="content_text">Table 3-8</span>.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIEFCF" title="Table 3-8Keys the kernel event monitor publishes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-8&nbsp;&nbsp;</strong>Keys the kernel event monitor publishes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv4</p></td><td ><p>Addresses</p></td><td ><p>Published for all interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv4</p></td><td ><p>SubnetMasks</p></td><td ><p>Published for broadcast interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv4</p></td><td ><p>BroadcastAddresses</p></td><td ><p>Published for broadcast interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv4</p></td><td ><p>DestAddresses</p></td><td ><p>Published for point-to-point interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/Link</p></td><td ><p>Active</p></td><td ><p><code>TRUE</code> when interface is active.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface</p></td><td ><p>Interfaces</p></td><td ><p>This is an array of interface names.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBEFCEH" title="IPv4 Configuration Agent"></a><h3>IPv4 Configuration Agent</h3><p>The IPv4 configuration agent configures Ethernet-type devices for IP networking. When the preferences monitor loads an updated mapping from the persistent store into the dynamic store, the IPv4 configuration agent receives a notification for each configured service. It gets the configuration information from the relevant <code>Setup:</code> keys and applies that configuration to the indicated interface. It then updates the dynamic store to reflect the actual IP addresses that were assigned. For some configurations, such as DHCP and BootP, the IPv4 configuration agent also updates the dynamic store with any configuration options it received from the server.</p><p>When a user switches locations or makes a change to the IP configuration preferences in Network preferences, the preferences monitor loads the new settings into the dynamic store. The IPv4 configuration agent receives notification of the changes and updates the network configuration according to the new settings. It then publishes the new network status information in the appropriate<code> State:</code> keys. </p><p>The IPv4 configuration agent also monitors changes in link status. It does this by registering interest in the <code>State:</code> keys the kernel event monitor publishes (shown in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDIEFCF">Table 3-8</a></span>). This supports the automatic configuration of network interfaces when the computer is plugged into the network. <span class="content_text">Table 3-9</span> shows the keys the IPv4 configuration agent uses.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDCBGFH" title="Table 3-9Keys the IPv4 configuration agent uses"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-9&nbsp;&nbsp;</strong>Keys the IPv4 configuration agent uses</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Interface</p></td><td ><p>Interfaces</p></td><td ><p>The list of network interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/Link</p></td><td ><p>Active</p></td><td ><p>The link status of a given interface.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Global/IPv4</p></td><td ><p>ServiceOrder</p></td><td ><p>An array of service IDs used for ranking and prioritization.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>DeviceName</p></td><td ><p>The BSD interface name to be configured.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>Type</p></td><td ><p>Configures services when Type is Ethernet.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>ConfigMethod</p></td><td ><p>Manual, BootP, DHCP, PPP, INFORM, LinkLocal.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Addresses</p></td><td ><p>For Manual and INFORM, the IP address to be assigned.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>SubnetMasks</p></td><td ><p>For Manual and INFORM, the IP mask to be assigned.</p></td></tr></table></div><p>The IPv4 configuration agent also publishes values in the dynamic store. <span class="content_text">Table 3-10</span> shows the keys the IPv4 configuration agent publishes and the circumstances under which it does so.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIDJIF" title="Table 3-10Keys the IPv4 configuration agent publishes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-10&nbsp;&nbsp;</strong>Keys the IPv4 configuration agent publishes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Addresses</p></td><td ><p>The IP address assigned for this service. For Manual and INFORM, this should be the same address specified in the <code>Setup:</code> keys.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>SubnetMasks</p></td><td ><p>The IP mask assigned for this service. For Manual and INFORM, this should be the same address specified in the <code>Setup:</code> keys.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Router</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>InterfaceName</p></td><td ><p>The BSD interface name associated with this service.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>DomainName</p></td><td ><p>Published when ConfigMethod is DHCP, BootP, or INFORM and required data has been provided by the server.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>ServerAddresses</p></td><td ><p>Published when ConfigMethod is DHCP, BootP, or INFORM and required data has been provided by the server.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerAddresses</p></td><td ><p>Published when ConfigMethod is DHCP, BootP, or INFORM and required data has been provided by the server.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerTags</p></td><td ><p>Published when ConfigMethod is DHCP, BootP, or INFORM and required data has been provided by the server.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DHCP</p></td><td ><p></p></td><td ><p>DHCP-specific information, such as the lease time.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBFJGFB" title="IPv6 Configuration Agent"></a><h3>IPv6 Configuration Agent</h3><p>Like the IPv4 configuration agent, the IPv6 configuration agent also configures Ethernet-type devices for IP networking. In addition, the IPv6 configuration agent configures FireWire devices and the new 6to4 interface. When the preferences monitor loads an updated mapping from the persistent store into the dynamic store, the IPv6 configuration agent receives a notification for each configured service. It gets the configuration information from the relevant <code>Setup:</code> keys and applies that configuration to the indicated interface. It then updates the dynamic store to reflect the actual IP addresses that were assigned.</p><p>The IPv6 configuration agent also monitors changes in link status. It does this by registering interest in the <code>State:</code> keys the kernel event monitor publishes (shown in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDIEFCF">Table 3-8</a></span>). This supports the automatic configuration of network interfaces when the computer is plugged into the network. <span class="content_text">Table 3-11</span> shows the keys the IPv6 configuration agent uses.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BABDJBDC" title="Table 3-11Keys the IPv6 configuration agent uses"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-11&nbsp;&nbsp;</strong>Keys the IPv6 configuration agent uses</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Global/IPv4</p></td><td ><p>PrimaryService</p></td><td ><p>Used to determine which interface to use for 6to4 tunnelling.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface</p></td><td ><p>Interfaces</p></td><td ><p>The list of network interfaces.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv6</p></td><td ><p>Addresses</p></td><td ><p>Manual or automatically assigned IP address.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv6</p></td><td ><p>Flags</p></td><td ><p>Address-specifics flags.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv6</p></td><td ><p>PrefixLength</p></td><td ><p>Length of address prefix or subnet.</p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/IPv6</p></td><td ><p>Router</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/Link</p></td><td ><p>Active</p></td><td ><p>The link status of a given interface.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Addresses</p></td><td ><p>The IP address to be assigned.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>ConfigMethod</p></td><td ><p>Automatic, Manual, RouterAdvertisement, 6to4.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Flags</p></td><td ><p>Address-specific flags.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>PrefixLength</p></td><td ><p>Length of address prefix or subnet.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Router</p></td><td ><p>Updates routing table with the default route.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>Type</p></td><td ><p>Configures services when Type is Ethernet, FireWire or 6to4. Also configures IPv4 services over FireWire.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/6to4</p></td><td ><p>Relay</p></td><td ><p>6to4 relay address.</p></td></tr></table></div><p>The IPv6 configuration agent also publishes values in the dynamic store. <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-BABHDFAD">Table 3-12</a></span> shows the keys the IPv6 configuration agent publishes and, for some keys, the circumstances under which it does so.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-BABHDFAD" title="Table 3-12Keys the IPv6 configuration agent publishes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-12&nbsp;&nbsp;</strong>Keys the IPv6 configuration agent publishes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Addresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Flags</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>PrefixLength</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Router</p></td><td ><p>When ConfigMethod is Manual.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>InterfaceName</p></td><td ><p></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBBBJJH" title="IP Monitor "></a><h3>IP Monitor </h3><p>The main job of the IP monitor agent is to select the primary network service. This is typically the service that is associated with the default route and default DNS for the system. To make its determination, the IP monitor agent examines both the user’s preferred priority of services and the current status of those services. It then selects the currently available service that is highest on the user’s priority list and marks that service as primary in the dynamic store.</p><p>The IP monitor agent is driven by information other agents publish in the dynamic store. It monitors the user’s preferences mapped in by the preferences monitor and the configuration status of services published by the IPv4 and IPv6 configuration agents and the PPP controller. <span class="content_text">Table 3-13</span> shows the keys the IP monitor agent uses.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIEDDJ" title="Table 3-13Keys the IP monitor uses"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-13&nbsp;&nbsp;</strong>Keys the IP monitor uses</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Interface/<em>InterfaceName</em>/Link</p></td><td ><p>Active</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Global/IPv4</p></td><td ><p>ServiceOrder</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Router</p></td><td ><p>Specified by the user. In general, these settings are preferred over values derived from the network.</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>DomainName</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SearchDomains</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SortList</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>BindingMethods</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerTags</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Proxies</p></td><td ><p>All properties</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Addresses</p></td><td ><p>Settings derived from the type of configuration. In general, these settings are used when a user-specified setting is unavailable.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Router</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>DomainName</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SearchDomains</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SortList</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/NetInfo</p></td><td ><p>ServerTags</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/Proxies</p></td><td ><p>All properties</p></td><td ><p></p></td></tr></table></div><p>The IP monitor also publishes values in the dynamic store. <span class="content_text">Table 3-14</span> shows the keys the IP monitor publishes and the circumstances under which it does so.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDGBBCB" title="Table 3-14Keys the IP monitor publishes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-14&nbsp;&nbsp;</strong>Keys the IP monitor publishes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Global/IPv4</p></td><td ><p>PrimaryService</p></td><td ><p>Identifies which network service is deemed primary.</p></td></tr><tr><td  scope="row"><p>State:/Network/Global/IPv4</p></td><td ><p>PrimaryInterface</p></td><td ><p>Identifies which network interface is deemed primary.</p></td></tr><tr><td  scope="row"><p>State:/Network/Global/IPv4</p></td><td ><p>Router</p></td><td ><p>Updates routing table with the PrimaryService default route. Handles “proxy arp” which is enabled if the Router value is the same as one of the service’s Addresses values (enabled automatically if Router has no value).</p></td></tr><tr><td  scope="row"><p>State:/Network/Global/DNS</p></td><td ><p>DomainName</p></td><td ><p>Checks each of the DNS properties for the primary service, favoring a property from the <code>Setup:</code> key over one from the <code>State:</code> key. </p></td></tr><tr><td  scope="row"><p>State:/Network/Global/DNS</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Global/DNS</p></td><td ><p>SearchDomains</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Global/DNS</p></td><td ><p>SortList</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Global/NetInfo</p></td><td ><p>ServerAddresses</p></td><td ><p>Generates the list of NetInfo server addresses and server tags based on the primary service’s NetInfo information.</p></td></tr><tr><td  scope="row"><p>State:/Network/Global/NetInfo</p></td><td ><p>ServerTags</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Global/Proxies</p></td><td ><p>All properties</p></td><td ><p>If available, uses the primary service’s proxy information in the <code>Setup:</code> key, otherwise, uses the proxy information in the <code>State:</code> key.</p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv6</p></td><td ><p>Router</p></td><td ><p>For ConfigMethod other than Manual.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-BGBDGFCC" title="PPP Controller "></a><h3>PPP Controller </h3><p>The PPP controller configures PPP interfaces for IP networking. It manages connections through dial-up modems and through PPP over Ethernet (PPPoE) and VPN (virtual private network) connections using PPTP (point-to-point tunneling protocol) and L2TP (layer 2 tunneling protocol). The PPP controller interacts with dialer applications and instantiates PPP interfaces as needed.</p><p>The PPP controller gets its configuration information from the <code>Setup:</code> keys provided by the preferences monitor and receives notification when these keys change. After an interface is configured, the PPP controller publishes the IP, destination, and router addresses and the DNS information provided by the PPP server. <span class="content_text">Table 3-15</span> shows the keys the PPP controller uses.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDCDHJE" title="Table 3-15Keys the PPP controller uses"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-15&nbsp;&nbsp;</strong>Keys the PPP controller uses</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>DeviceName</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>Type</p></td><td ><p>Configures services with Type PPP</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/Interface</p></td><td ><p>SubType</p></td><td ><p>PPPSerial, PPPoE, PPTP, L2TP</p></td></tr><tr><td  scope="row"><p>Setup:/Network/Global/IPv4</p></td><td ><p>ServiceOrder</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Setup:/Network/Service/<em>ServiceID</em>/PPP</p></td><td ><p>All properties</p></td><td ><p></p></td></tr></table></div><p>The PPP controller publishes many keys in the dynamic store. <span class="content_text">Table 3-16</span> shows some of them.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDIGJHG" title="Table 3-16Some keys the PPP controller publishes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-16&nbsp;&nbsp;</strong>Some keys the PPP controller publishes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Addresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>DestAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>Router</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/IPv4</p></td><td ><p>InterfaceName</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>DomainName</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>ServerAddresses</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SearchDomains</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/DNS</p></td><td ><p>SortList</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>State:/Network/Service/<em>ServiceID</em>/PPP</p></td><td ><p></p></td><td ><p>Reserved for Apple use</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF108" title="Using the Schema"></a><h2>Using the Schema</h2><p>The previous section describes how the System Configuration schema structures the persistent store and which key-value combinations define sets and specific services. This is essential knowledge for any developer writing an application that defines a set or provides a network service, because the information must be presented in the correct format. It is also essential knowledge for the developer of an application that requires detailed PPP connection information or that requests notifications. This is because the configuration agents and the dynamic store also adhere to the schema. Whether you need to register for notifications or get information about current connection status, you need to know which key-value pairs hold the data you’re interested in.</p><p>This section describes three situations in which knowledge of the schema is essential. </p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDHAHCI" title="Programmatically Setting Preferences"></a><h3>Programmatically Setting Preferences</h3><p>The System Configuration framework provides an API to programmatically set the keys and values that define sets and services. Unfortunately, the API is very low level. For the most part, it consists of functions to get and set individual key-value pairs. It provides no guidance on how to lay out a set or network service dictionary and no support for building these complex structures. </p><p>To help meet the needs of developers, Apple’s Developer Technical Support provides a large library of sample code that wraps some of the low-level System Configuration API in higher-level functions. Not only does this library insulate you from much of the low-level manipulation of key-value pairs, it also provides a streamlined template you can use to define a basic service. When you get this basic service working, you can then tweak the settings, using the information in<span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFDHFG">“Layout of the Persistent Store”</a></span> as a guide.</p><p>The sample code library, called <em><a href="../../../../../samplecode/MoreSCF/index.html#//apple_ref/doc/uid/DTS10000702" target="_top">MoreSCF</a></em>, contains several modules that help you programmatically define sets, find active ports, and activate services.</p><a name="//apple_ref/doc/uid/TP40001065-CH203-CHDHDCIE" title="Getting Detailed PPP Connection-Status Information"></a><h3>Getting Detailed PPP Connection-Status Information</h3><p>The System Configuration framework provides API that allows you to get detailed information about the current PPP connection. Available in Mac OS X version 10.3 and later, this API gives you access to information gathered by the PPP controller. To use this API, you should be familiar with the layout of the network service dictionary and PPP protocol entity dictionary, as defined by the schema. This is because the information the API returns to you follows the same structure.</p><p>Recall that the preferences monitor reads the persistent store and populates the dynamic store with flattened keys and values that describe the user’s currently active configuration. This information is in the setup portion of the dynamic store, using keys prefixed by <code>Setup:</code> (for more information on how these keys are created, see <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFGAEF">“Preferences Monitor ”</a></span>). The other configuration agents read the setup keys they’re interested in, monitor sources of network status information, and publish the results of their observations and configuration actions in the state portion of the dynamic store. Although it is tempting to go directly to the dynamic store and get the value of a specific key, in some cases, it’s not as effective as you might expect. </p><p>In particular, to get current PPP status, it’s much better to use the <code><!--a-->SCNetworkConnectionCopyExtendedStatus<!--/a--></code> function in the SCNetworkConnection API (defined in the <code>SCNetworkConnection.h</code> file in the System Configuration framework). Using this function, you can get very detailed connection-status information from the PPP controller, including some information that is never copied into the state portion of the dynamic store.</p><p>For example, when a user chooses to make a PPP connection through a modem, there are several steps the modem takes before connection is finally established. If you register for notification on the PPP Status key in the dynamic store (<code>State:/Network/Service/serviceID/PPP/Status</code>), you’ll receive notification when this key’s value is updated. If you need connection-status information sooner, you might choose to retrieve the value of the PPP Status key immediately after a connection is initiated. When you do this, however, you’ll receive the value Disconnected until after the connection completes. This is because the PPP controller does not update the dynamic store PPP Status key until after the connection is complete. If, instead, you use the <code><!--a-->SCNetworkConnectionCopyExtendedStatus<!--/a--></code> function to request immediate notification, you’ll be able to observe intermediate states, such as Initialize, Connect, Negotiate, Authenticate, and Connected. In this way, you can get much more detailed (and more accurate) information than if you simply watched the dynamic store.</p><p>It’s important to remember that the SCNetworkConnection API, like most other System Configuration APIs, depends on the schema-defined layout of network-service dictionaries and of the dynamic store. When you use the <code><!--a-->SCNetworkConnectionCopyExtendedStatus<!--/a--></code> function to get PPP connection-status information, you receive a dictionary that contains a subdictionary for each of the service’s subcomponents, such as PPP, IPv4, and Modem. To successfully interpret the information in these dictionaries, you need to know how the schema defines the layout of the key-value pairs. For more information on the structure of these dictionaries, see the appropriate sections in <span class="content_text"><a href="SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFBDCB">“The NetworkServices Dictionary.”</a></span></p><a name="//apple_ref/doc/uid/TP40001065-CH203-TPXREF109" title="Getting Notifications"></a><h3>Getting Notifications</h3><p>Understanding how the schema positions the information in the dynamic store gives you a lot of power. In particular, it gives you access to a great deal of low-level network status information. On the other hand, it also fosters the notion that you should be paying attention to every small change in network status. Conceivably, you could write an application that watches large numbers of keys and provides the user with constant updates on every network status change. This is seldom necessary, however, and it is not advisable. </p><p>Although the System Configuration framework enables you to request information at this level, it also provides APIs that abstract some of it and provide it in more palatable forms. Therefore, it’s important to know when it’s appropriate to request notifications on individual keys and when it’s appropriate to use the API to get information.</p><p>For example, if your application needs to be aware of changes to network proxy settings while it runs, you should watch the dynamic store key associated with the network proxy settings. This is will ensure you receive a notification when any of these settings change. If, instead, you call the <code><!--a-->SCDynamicStoreCopyProxies<!--/a--></code> function to get the proxy settings in force when your application starts, you won’t get notified of changes as your application runs.</p><p>On the other hand, watching configuration keys (the <code>Setup:</code> keys in the dynamic store) is usually a bad idea unless you’re developing a configuration agent. This is because your application has no way of knowing if, or more importantly when, configuration changes are reflected in the system’s running configuration.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SC_Components/SC_Components.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SC_ReachConnect/SC_ReachConnect.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-02-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_UnderstandSchema/SC_UnderstandSchema.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_UnderstandSchema/SC_UnderstandSchema.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_UnderstandSchema/SC_UnderstandSchema.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>