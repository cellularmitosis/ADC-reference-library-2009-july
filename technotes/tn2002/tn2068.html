<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><TITLE>Technical Note TN2068: Full Screen changes in QuickTime 6.1 and 6.3</TITLE><meta name="keywords" content="have creator list relevant keywords here"><meta name="Description" content="have creator write a brief description here."><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003095" title="Full Screen changes in QuickTime 6.1 and 6.3"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalnotes/QuickTime/idxVideoEffectsTransitions-date.html">Video Effects & Transitions</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2068</div>
<div id="pageheadsub">Full Screen changes in QuickTime 6.1 and 6.3</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><TD align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width="300" valign="top" align="left" scope="row">	<table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width="300" align="left"> <img src="images/tnmenutop.gif" alt="" align="bottom" width="300" height="7"></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width="300" align="left">                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width="300" align="left">					<!-- begin_toc -->												<p id="menutext"><A HREF="#Section1">Introduction</A><BR>													<br>													<A HREF="#Section2">New Full Screen Flags</A><BR>													<br>													<A HREF="#Section3">Window Levels</A><BR>													<br>													<a href="#Section4">QuickTime 6.3</a><br>													<br>													<a href="#Section5">QuickTime 6.1</a><br>													<BR>													<A HREF="#references">References</A><BR>													<BR>													<A HREF="#Downloads">Downloadables</A></P>												<!-- end_toc --></td>                </tr>                <tr>                    <td width="300" align="left" scope="row">                        <img src="images/tnmenubottom.gif" alt="" width="300">                    </td>                </tr>            </table>        </td>        <td width="300" valign="top" align="left"><!-- begin_intro_text --><p id="introtext">This technote discusses changes made to the QuickTime Full Screen API with the release of QuickTime 6.1 and QuickTime 6.3</P><!-- end_intro_text --><!-- begin_date --><H4 ALIGN=center>[Jun 19, 2003]</H4><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <HR width=500 align=center>          <BR><BR>                  <!-- begin_content --><a name=Section1></a><h2>Introduction</h2><p>The QuickTime Full Screen API consists of two function calls; <code>BeginFullScreen</code> and <code>EndFullScreen</code>. With the release of QuickTime 6.1 improvements were made to <code>BeginFullScreen</code> which enhance performance (allowing QuickTime to switch in and out of full-screen mode very quickly), and bring the API into full compliance with the Mac OS X Aqua Human Interface Guidelines.</p><p>This technical note discusses the addition of three new flags which can be used when initiating full-screen mode and also discusses the difference between the way QuickTime 6.1 and QuickTime 6.3 set the CoreGraphics <code>WindowLevel</code> of the full-screen blanking window returned from <code>BeginFullScreen</code>.</p> <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<TD BGCOLOR="#E6E6E6" align="left"><PRE>// Begins full-screen mode for a specified graphics device.OSErr BeginFullScreen(Ptr       *restoreState,                      GDHandle  whichGD,                      short     *desiredWidth,                      short     *desiredHeight,                      WindowRef *newWindow,                      RGBColor  *eraseColor,                      long      flags);</PRE>	</TD></TR></TABLE></CENTER> <br> <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<TD BGCOLOR="#E6E6E6" align="left"><PRE>// Ends full-screen mode for a graphics device.OSErr EndFullScreen(Ptr  fullState,                    long flags); </PRE>	</TD></TR></TABLE></CENTER>						<p>For more information regarding the use of these APIs refer to the <a href="../../documentation/quicktime/qtdevdocs/APIREF/SOURCESV/usingthefullscreen.htm" target="_blank">QuickTime Full Screen API Reference</a>.</p>						<p><a href="#top">Back to top</a></p>						<p><a name=Section2></a></p>						<h2>New Full Screen Flags</h2>						<p><code>BeginFullScreen</code> accepts some flags which control certain aspects of the full-screen mode. Since the release of  QuickTime 6.1 three new flags have been available. These options can improve application performance and allow for display capture.</p>						<table border=0 cellpadding=5 width=550>							<tr>								<td bgcolor="#E6E6E6" align="left" scope="row">									<pre>// New since QuickTime 6.1enum {  fullScreenDontSwitchMonitorResolution = 1L &lt;&lt; 4,  fullScreenCaptureDisplay = 1 &lt;&lt; 5L,     /* mac os x only */  fullScreenCaptureAllDisplays = 1 &lt;&lt; 6L  /* mac os x only */};</pre>								</td>							</tr>						</table>						<br>						<ul>							<li>							<p><code>fullScreenDontSwitchMonitorResolution</code> - this flag allows you to initiate full-screen mode without changing the monitor's resolution.</p>							<p>Previously you could get the same effect by calling <code>BeginFullScreen</code> and passing <code>0</code> for the <code>desiredWidth</code> and <code>desiredHeight</code> parameters, however using this flag now allows you to pass in a valid desired width and height. When this is done, <code>BeginFullScreen</code> will <i>not</i> change the monitors resolution as expected and will pass back (in the <code>desiredWidth</code> and <code>desiredHeight</code> parameters) the width and height that it <i>would have</i> switched to in order to accommodate the requested width and height. This may be useful if your application wanted to forgo the monitor resolution switch but still size its content in the blanking window as if a resolution switch had indeed occurred.</p>							<p>The use of this flag also makes the resolution switch a much faster operation leaving the desktop icons and other application windows in place.</p>							</li>							<li>							<p><code>fullScreenCaptureDisplay</code> - this flag causes QuickTime to capture the display being used for full-screen through the use of <a href="../tn/tn2007.html" target="_blank">CGDirect Display</a>. Capturing the display prevents contention for the screen from other applications and system services. This doesn't look any different, but it will block the Command + Tab key.</p>							</li>							<li>							<p><code>fullScreenCaptureAllDisplays</code> - this flag is similar to the <code>fullScreenCaptureDisplay</code> flag except it will blank out all displays connected to the system, not just the one you are drawing to. This is visually similar to what is seen when iTunes switches to full-screen visualization mode.</p>							</li>						</ul>						<p><a href="#top">Back to top</a></p>						<p><a name=Section3></a></p>						<h2>Window Levels</h2>						<p>The full-screen mode for applications is considered a <i>special mode</i>. An example of this is iTunes' full-screen effects visualizer or iPhoto's full-screen slide show. This <i>special mode</i> prevents other applications' windows from coming to the forefront while your application's full-screen mode is engaged. When an application enters full-screen mode, it essentially becomes a <i>one-window </i>application.</p>						<p>The appropriate window level for full-screen applications on Mac OS X is the ScreenSaver level. This window level is defined as <code>kCGScreenSaverWindowLevel</code> which returns the key value using the function call   <code>CGWindowLevelForKey(kCGScreenSaverWindowLevelKey)</code>. For further details see <code>CGWindowLevel.h</code>.</p>						<p>Windows at lower levels can never be placed visually on top of windows at higher levels, while windows at the same level are ordered relative to each other.</p>						<p>By adding the ability to change window levels, QuickTime is able to prevent certain types of annoying problems from occurring.</p>						<p>One specific problem is related to certain <i>floating-window</i> applications always drawing themselves above the default window level, enabling them to float above all other windows. Clock.app is one such application. The problem with this is, the application then has the ability to draw on top of your highly produced full-screen movie. Not the ideal user experience.</p>						<p>Changing the window level of the Full Screen Blanking Window prevents problems such as this from occurring.</p>						<p><a href="#top">Back to top</a></p>						<p><a name=Section4></a></p>						<h2>QuickTime 6.3</h2>						<p>QuickTime 6.3 allows developers to <b>opt-in</b> to the above mentioned window level change through the use of either the <code>fullScreenCaptureDisplay</code> or <code>fullScreenCaptureAllDisplays</code> flags. </p>						<p>You must explicitly set one of these two flags for QuickTime to change the window level from the default level up to the <code>ScreenSaver</code> level which is appropriate for full-screen mode.</p>						<p>If you specifically <i>do not</i> want to become a one-window application in full screen mode and want to retain pre-6.1 behavior, do not use either the <code>fullScreenCaptureDisplay</code> or <code>fullScreenCaptureAllDisplays</code> flags.</p>						<p><a href="#top">Back to top</a></p>						<p><a name=Section5></a></p>						<h2>QuickTime 6.1</h2>						<p>QuickTime 6.1 by <b>default</b> changes the window level of its Full Screen Blanking Window from the default level up to the <code>ScreenSaver</code> level which is appropriate for full-screen mode.</p>						<p>Some third-party applications may be adversely affected by this, not expecting the window level to change by default.</p>						<div align="left">							<code>BeginFullScreen</code> was designed to give developers access to a blanking window into which to draw, display a movie and so on.</div>						<p>Because traditional Mac OS had no concept of distinct window levels maintained by a window server, a few developers noticed that they could call <code>BeginFullScreen</code>, make new Carbon-style windows, then display these windows on top of the blanking window by calling <code>ShowWindow</code>.</p>						<p>While this practice is technically not an incorrect use of the Full Screen API, the ability to display windows in this manner relies on the specific behavior of traditional Mac OS. QuickTime 6.3 preserves this behavior allowing developers to opt-in to new functionality, while QuickTime 6.1 does not.</p>						<h3>A Simple Fix</h3>						<div align="center">							<table border=0 width=550>								<tr>									<td bgcolor="#E6E6E6" align="left" scope="row">										<p><b>Note:</b><br>This will only affect Mac OS X systems with QuickTime 6.1 installed. If your application expects QuickTime 6 or greater and you're using the Full Screen APIs you may need to incorporate this fix.</p>									</td>								</tr>							</table>						</div>						<p>If your application was affected by this default window level change in QuickTime 6.1, you can get the old behavior back by adding a call to <code>SetWindowGroup</code> after calling <code>BeginFullScreen</code>, as demonstrated in Listing 1.</p>						<p>Calling <code>SetWindowGroup</code> removes the window from its old group (if a window was already in a group) and assigns it to a new group, in our case it's going to be the group containing document class windows defined as <code>kDocumentWindowClass</code>.</p>						<p>As each window group is associated with a layer in the window layering hierarchy, this call will effectively change the layer of the blanking window to document window layer and will allow the placement of new Carbon windows over top of the blanking window.</p>						<CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <TD align="left">                  <P>&nbsp;<B>Listing 1</B>. Duplicate pre-QuickTime 6.1 behavior.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<TD BGCOLOR="#E6E6E6" align="left"><PRE>PtrBeginFullScreenWithFix(short *width, short *height,                       WindowRef *outBlankingWindow,                       long inFlags){     OSErr err;     Ptr theRestoreState = NULL;     err = BeginFullScreen(&amp;theRestoreState,                           NULL,          // main screen                           width, height,                           outBlankingWindow,                           NULL,          // black                           inFlags);     if (err) { outBlankingWindow = NULL; goto bail; }     // restore old behavior     SetWindowGroup(outBlankingWindow,                    GetWindowGroupOfClass(kDocumentWindowClass));bail:     return theRestoreState;}</PRE>	</TD></TR></TABLE></CENTER> <BR>               </TD>            </TR>         </TABLE></CENTER>						<p><a href="#top">Back to top</a></p>						<p><a name=References></a></p>						<h2>References</h2><p><a href="../../documentation/quicktime/qtdevdocs/APIREF/SOURCESII/icmgetpixelformatinfo.htm" target="_blank">Using Full Screen</a></p>	<p><a href="../../documentation/quicktime/qtdevdocs/REF/refMovieToolbox.2a.htm" target="_blank">Full Screen Flags</a></p>						<p>	<a href="../tn/tn2007.html" target="_blank">CGDirectDisplay API</a></p>						<BR>						<P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <TD WIDTH=50 align="left">                  <P ALIGN=center><IMG SRC="images/acrobatsmall.gif" WIDTH=22 HEIGHT=23 ALIGN=middle alt="Acrobat gif"></P>               </TD>               <TD align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <TD WIDTH=60 align="left">                  <P><A HREF="pdf/tn2068.pdf">Download</A></P>               </TD>            </TR>           </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2002/tn2068.html%3Fid%3DDTS10003095-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2002/tn2068.html%3Fid%3DDTS10003095-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2002/tn2068.html%3Fid%3DDTS10003095-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>