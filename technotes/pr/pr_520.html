<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PR520: PrintMonitor Q&amp;As</title>                                       <meta name="categories" content="Printing"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002648" title="PrintMonitor Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PR520</div>
<div id="pageheadsub">PrintMonitor Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					 <A HREF="#Section1">Determining whether background printing is enabled</A><BR><BR><A HREF="#Section2">Location for spool files under System 7.0</A><BR><BR><A HREF="#Section3">Determining whether background printing is turned on</A><BR><BR><A HREF="#Section4">Turning Macintosh background printing on and off</A><BR><BR><A HREF="#Section5">Macintosh PicComments and background printing</A><BR><BR><A HREF="#Section6">SetOrigin and background printing</A><BR><BR><A HREF="#Section7">Macintosh spool file formats aren't available</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <A HREF = "../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p> <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><h2>Determining whether background printing is enabled</h2>62755 MD JM dy 1<P>Date Written:  1/20/93</p><P>Last reviewed:  4/26/93</p><p>How can I tell whether background printing is enabled for the selectedprinter?</p> <P>There's no procedure to determine whether the user has picked backgroundprinting because that's not a standard Macintosh system software feature. Whereit's done, it's implemented on a driver-by-driver basis, and each printerdriver keeps track of it in a different way. Apple does it one way,Hewlett-Packard might do it another way, GCC a third way, and so on.</p><p>Since we don't actually know how it's done, and since Apple doesn't guaranteeits drivers will do it the same way in the future as they do now, we have noinformation to give you on how to determine this. Sorry to be the bearer of badnews.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></P><h2>Location for spool files under System 7.0</h2><P>Date Written:  12/18/90</p><P>Last reviewed:  8/1/92</p><p>Is there a recommended location for printer driver writers to put their ownspool files?</p> <P>Place it in the "PrintMonitor Documents" folder within a "personal spool"folder. PrintMonitor will ignore other folders and it will delete its spoolfile when it was done with it.</p><p>The biggest advantage with this approach is that all the spool files end up inthe same location, which is probably the best solution for the native user.</p><p>There are a few cases when the folder might not be present (such as if the userhas deleted it for some reason). Therefore, you should check to make sure thatthe folder is present before trying to add a file to it. If it is not present,be sure to create it with the exact name; otherwise, PrintMonitor will not beable to find it and will create a second folder with a different name, possiblyconfusing the native user. Folder management is relatively straightforward withthe addition of the "Folder Manager" to System 7.0. The Finder chapter in<i>Inside Macintosh</i> Volume VI contains the details about using it.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>Determining whether background printing is turned on</h2><P>Date Written:  2/5/92</p><P>Last reviewed:  8/1/92</p><p>I need to know whether the currently chosen printer driver - that I'm about toprint to--is going to be doing background printing or not. The user interfaceof our application is somewhat different, depending on this. Currently, I checkthe driver's file type to see whether it's network- or local-attached,generalizing "network = LaserWriter = background capable" and "direct =ImageWriter = foreground only," but I know this isn't always correct, because avariety of direct-connect printer drivers now support background printing. WhatI really need is a way to check specifically for background printing beingturned on. Is there a safe and driver-independent way to check this?</p> <P>No, there's absolutely no safe and driver-independent way to do this. AlthoughApple uses PrintMonitor for all background printing, it's not designed forthird-party products to hook into it. The "background printing" internalsaren't documented because changing that outside an individual printer drivermay not give the driver all the information it needs to correctly print in thebackground. Also, third parties have to implement their <i>own</i> backgroundprinting schemes, and there's absolutely no way to know how they're storing thechoice on whether or not to print in the background.</p><p>If your user interface is substantially different, you may need to require yourusers to enable background printing in your application as well as in theChooser. This isn't exactly friendly, but since there's no mechanism forapplications to communicate with printer drivers to find out about backgroundprinting, it's pretty much your only choice.</p><p>You're right, checking a driver's file type to see whether it's network- orlocal-attached is not a good solution. StyleWriters and LaserWriter LS printersprint in the background but don't use a network. Some third-party laserprinters support AppleTalk but not background printing.</p><a name="Section4"></a><P><A HREF="#top">Back to top</A></P><h2>Turning Macintosh background printing on and off</h2><P>Date Written:  3/25/92</p><P>Last reviewed:  6/14/93</p><p>Someone has requested that we do an extension for our application to turnbackground printing on and off. Can you tell me how to do this?</p> <P>Unfortunately, DTS can't tell you how to turn background printing on and off,for the following reasons:</p><ol type="1">	<li>Apple's mechanism for background printing (PrintMonitor) is at this time only available to Apple's printer drivers. How Apple's printer drivers store the background printing choice is private because Engineering has changed it in the past and might need to change it again.</li>	<li>Since all third-party printer drivers that do background printing have to do it their own way, they all have to find their own ways of recording the "background printing" choice, such as storing the information in resources like the PAPA resource. Since there are no guidelines for recording background printing options, DTS cannot recommend a method which will work with all drivers.</li></ol><p>For these reasons, and to avoid possible Human Interface conflicts, backgroundprinting control is best left to the user.</p><a name="Section5"></a><P><A HREF="#top">Back to top</A></P><h2>Macintosh PicComments and background printing</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  6/14/93</p><p>My Macintosh application prints fine when Background Printing is disabled, butdoesn't print or prints blank pages when Background Printing is enabled. Why?</p> <P>The Printing Manager gets execution time by replacing the <code>grafProcs</code> of thePrinting Manager <code>GrafPort</code> (returned from the <code>PrOpenDoc</code> call). This <code>GrafPort</code> iscreated by the <code>PrOpenDoc</code> call, and is reinitialized by every call to<code>PrOpenPage</code>. On the LaserWriter driver with Background Printing enabled, thisreinitialization causes the clipping region of the port to be set to (0,0,0,0).On the next call to <code>StdLine</code> or <code>StdText</code>, for example, the Printing Managernotices the zeroed clipping region, and sets it to the rectangle specified by<code>prInfo.rPage</code> in the print record. If your application prints its documents withPostScript using <code>PicComments</code>, the Printing Manager never gets a chance todefine the clipping region. All of your PostScript code is sent to theLaserWriter and executed, but the results are clipped to (0,0,0,0). To workaround this problem, you must call at least one Quickdraw drawing routine atthe beginning of each page. The following is frequently used:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    PrOpenPage(...);    MoveTo(-32000, -32000);    Line(0, 0);    { PostScript code here }</pre>	</TD></TR></TABLE></CENTER><p>The <code>MoveTo</code> is needed so that the line is drawn outside of the imageable area ofthe page, and thus is invisible. The Line call calls the Printing Manager'sversion of the <code>StdLine</code> procedure, which defines the clipping region for theport. All subsequent PostScript code will be clipped correctly. Since<code>PrOpenPage</code> resets the clipping region, the <code>MoveTo/Line</code> combination must be doneafter each call to PrOpenPage.</p><a name="Section6"></a><P><A HREF="#top">Back to top</A></P><h2>SetOrigin and background printing</h2><P>Date Written:  1/1/90</p><P>Last reviewed:  6/14/93</p><p>I have noticed PostScript graphics printing in different locations depending onwhether or not Background printing is enabled on the Macintosh. What causesthis?</p> <P>In LaserWriter 4.0 - 5.2, SetOrigin is handled differently when Backgroundprinting is enabled. The method used by these drivers is described below:</p><p>Background Printing DISABLED: The application calls <code>SetOrigin</code>, and QuickDrawresponds to the call by adjusting the portRect of the Print Manager's <code>GrafPort</code>.Since <code>SetOrigin</code> does not cause any <code>grafProcs</code> to run, the Printing Managerdoesn't see this change until the next QuickDraw drawing operation such as<code>DrawString</code> or <code>LineTo</code>. At that time, the Printing Manager notices the change inthe <code>portRect</code>, and updates its internal origin. All QuickDraw graphics are nowlocalized to the new origin. All PostScript graphics will also get thelocalization to the new origin.</p><p>Background Printing ENABLED: Because QuickDraw is playing back a picture thatwas spooled earlier, it handles calls to <code>SetOrigin</code> a little differently. Whenthe <code>SetOrigin</code> call is encountered in a <code>DrawPicture</code> call, the <code>portRect</code> of the<code>GrafPort</code> is NOT updated. Instead, QuickDraw keeps the current origin cached,and offsets each graphic on the fly. Since the <code>portRect</code> was not modified, thePrinting Manager does not see the <code>SetOrigin</code> call. Although all QuickDrawobjects are still localized correctly (by QuickDraw), PostScript graphics donot move to the new origin. Instead, the application localizes the coordinatesof its PostScript graphics. You could also use the technique documented in theTechnical Note <A HREF = "pr_23.html">"Position-Independent PostScript</a>."</p><P>The implementation of the SetOrigin (IM I:166) and ClipRect (IM I:167) callshas been revised in LaserWriter 6.0. This is a general description of thosechanges:</p><p>LaserWriter 6.0: Both QuickDraw and PostScript coordinates are offset withrespect to the origin set by SetOrigin. The driver now inserts a picturecomment into the spool file so that the Print Monitor knows that the origin waschanged during spooling.</p><p>Since applications must support versions of the LaserWriter driver other than6.0, they should still use the method described in this Technote to make suretheir PostScript is position-independent.</p><p>X-Ref:</p><P>DTS Macintosh Technical Note <A HREF = "pr_23.html">"Position-Independent PostScript"</a></p><a name="Section7"></a><P><A HREF="#top">Back to top</A></P><h2>Macintosh spool file formats aren't available</h2><P>Date Written:  1/1/90</p><P>Last reviewed:  8/1/92</p><p>What is file format of Macintosh Printing Manager and LaserShare spool files?</p> <P>Unfortunately, the formats for these files are not currently available, and itis doubtful that they will be made available in the future. Whenever newfeatures are added to LaserShare, the Printing Manager, or other parts of theMacintosh toolbox, it's not uncommon for these spool file formats to beaffected. If the file format were published, and essentially frozen, it wouldbe much harder for engineering to add features.</p><br><br>                  <a name=Downloads></A>                  <P><A HREF="#top">Back to top</A></P><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pr_520.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pr/pr_520.html%3Fid%3DDTS10002648-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pr/pr_520.html%3Fid%3DDTS10002648-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pr/pr_520.html%3Fid%3DDTS10002648-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>