<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Upgrading to the Mac OS X HIToolbox: A Porting Example: Converting a User Item to a Custom View</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="A Porting Example: Converting a User Item to a Custom View"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001140-CH204" title="A Porting Example: Converting a User Item to a Custom View"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../HumanInterfaceToolbox-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000516" target="_top">Human Interface Toolbox</a> &gt; <a href="../upgrading_hitoolbox_intro/upgrading_hitoolbox_intro.html#//apple_ref/doc/uid/TP30001140-CH201-DontLinkElementID_17">Upgrading to the Mac OS X HIToolbox</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../upgrading_hitoolbox_tasks/upgrading_hitoolbox_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../upgrading_hitoolbox_rev/upgrading_hitoolbox_rev.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_19" title="A Porting Example: Converting a User Item to a Custom View"></a><h1><a name="//apple_ref/doc/uid/TP30001140-CH204-BABHCIAC" title="A Porting Example: Converting a User Item to a Custom View"></a>A Porting Example: Converting a User Item to a Custom View</h1><p>This chapter describes how you might convert a dialog-based user item into a custom HIView. </p><p>This example user item/view draws a black box outline, sized to fit inside its bounds. Within the box is a square spot that the user can move or drag around by clicking in the box. The work needed to convert the user item covers many of the steps outined in <span class="content_text"><a href="../upgrading_hitoolbox_tasks/upgrading_hitoolbox_tasks.html#//apple_ref/doc/uid/TP30001140-CH203-BABHCIAC">“Porting Steps”</a></span>: updating Dialog Manager functions, adopting Carbon events, adopting Quartz, and creating a custom view. </p><ul class="ul"><li class="li"><p><span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABDIDEE">“The Old Dialog Manager Code”</a></span> summarizes the Dialog Manager code used to implement the user item and describes how you might update it to use views. </p></li><li class="li"><p><span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-CIAIJBFG">“The New Custom View”</a></span> describes a possible implementation for the new custom view, based on the recommendations given in the previous section. </p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABDIDEE">The Old Dialog Manager Code</a>
				
			<br/>
			
        
			
			
				<a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-CIAIJBFG">The New Custom View</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001140-CH204-BABDIDEE" title="The Old Dialog Manager Code"></a><h2>The Old Dialog Manager Code</h2><p>This section reviews the Dialog Manager code used to create the custom item, along with the recommendations for how to update it. This example assumes a worst-case scenario of System 6 or System 7–era code.</p><p><span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABGFCAB">Listing 4-1</a></span> shows a section of the dialog creation code dealing with the user item. </p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_20" title="Listing 3-1Creating the dialog with the user item"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABGFCAB" title="Listing 3-1Creating the dialog with the user item"></a><strong>Listing 3-1&nbsp;&nbsp;</strong>Creating the dialog with the user item</p><div class="codesample"><table><tr><td scope="row"><pre>void ThisOldDialog(void)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt16 itemHit;<span></span></pre></td></tr><tr><td scope="row"><pre>    DialogItemType itemType;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle itemHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect itemBox;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    DialogRef theDialog = GetNewDialog(256, NULL, (WindowRef)-1L);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (theDialog == NULL) return;<span></span></pre></td></tr><tr><td scope="row"><pre>    …<span></span></pre></td></tr><tr><td scope="row"><pre>    // Setting the draw proc for the user item<span></span></pre></td></tr><tr><td scope="row"><pre>    GetDialogItem(theDialog, 13, &amp;itemType, &amp;itemHandle, &amp;itemBox);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    gUserH = (itemBox.left + itemBox.right) / 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    gUserV = (itemBox.top + itemBox.bottom) / 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    SetDialogItem(theDialog, 13, itemType, (Handle)&amp;MyOldDrawUserItem,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                     &amp;itemBox);<span></span></pre></td></tr><tr><td scope="row"><pre>    …<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeDialog (theDialog);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>To update this code, you need to make the following changes:</p><ol class="ol"><li class="li"><p>Replace the dialog resource (ID 256) with a nib file–based window.</p></li><li class="li"><p>Instead of calling <code>GetDialogItem</code> to obtain the user item’s bounds, call <code>HIViewGetBounds</code> , specifying the HIView reference of the custom view. </p></li><li class="li"><p>Instead of using <code>SetDialogItem</code> to set a draw handler for the user item, register your view for the <code>kEventControlDraw</code> event and do your drawing from the handler you specify for that event. </p></li><li class="li"><p>Call <code>DisposeWindow</code> to remove the dialog because you have made it a window instead.</p></li></ol><p>The old drawing function simply draws the box and the current position of the spot using QuickDraw calls, as shown in <span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABGCACG">Listing 4-2</a></span>.</p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_21" title="Listing 3-2The user item drawing function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABGCACG" title="Listing 3-2The user item drawing function"></a><strong>Listing 3-2&nbsp;&nbsp;</strong>The user item drawing function</p><div class="codesample"><table><tr><td scope="row"><pre>void MyDrawUserItem(DialogRef theDialog, DialogItemIndex itemNo)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    DialogItemType itemType;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle itemHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect itemBox;<span></span></pre></td></tr><tr><td scope="row"><pre>    GetDialogItem(theDialog, itemNo, &amp;itemType, &amp;itemHandle, &amp;itemBox);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGrafPtr savePort;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    GetPort(&amp;savePort);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetPortDialogPort(theDialog);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    PenState penState;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    GetPenState(&amp;penState);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    PenSize(3, 3);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (itemType &amp; itemDisable)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>        Pattern gray;<span></span></pre></td></tr><tr><td scope="row"><pre>        PenPat(GetQDGlobalsGray(&amp;gray));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    FrameRect(&amp;itemBox);<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect userRect = {gUserV-4, gUserH-4, gUserV+4, gUserH+4};<span></span></pre></td></tr><tr><td scope="row"><pre>    PaintRect(&amp;userRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetPenState(&amp;penState);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetPort(savePort);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>To update this code, you want to make the following changes:</p><ol class="ol"><li class="li"><p>Incorporate the drawing function into a <code>kEventControlDraw</code> handler for the custom view.</p></li><li class="li"><p>Instead of calling <code>GetDialogItem</code> to obtain information about the user item, obtain this information directly from the draw event using the Carbon Event Manager <code>GetEventParameter</code> function. </p></li><li class="li"><p>Update all QuickDraw calls to use Quartz. Instead of worrying about graphics ports, you can obtain the Quartz drawing context for your custom view from the drawing event using the <code>GetEventParameter</code> function. </p></li><li class="li"><p>Replace the QuickDraw drawing primitive functions to draw the item’s bounding box and spot with their Quartz equivalents (for example, <code>CGContextStrokeRect</code> replaces <code>FrameRect</code>) </p></li></ol><p>Mouse clicks are handled within the dialog’s event filter, as shown in <span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABHGICH">Listing 4-3</a></span>. </p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_22" title="Listing 3-3Dialog event filter to process user item clicks"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABHGICH" title="Listing 3-3Dialog event filter to process user item clicks"></a><strong>Listing 3-3&nbsp;&nbsp;</strong>Dialog event filter to process user item clicks</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean MySystem6or7DialogFilter(DialogRef theDialog, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                        EventRecord *theEvent, DialogItemIndex *itemHit)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    …<span></span></pre></td></tr><tr><td scope="row"><pre>    // we got a click!<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theEvent->what == mouseDown)<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>        DialogItemType itemType;<span></span></pre></td></tr><tr><td scope="row"><pre>        Handle itemHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>        Rect itemBox;<span></span></pre></td></tr><tr><td scope="row"><pre>        GetDialogItem(theDialog, 13, &amp;itemType, &amp;itemHandle, &amp;itemBox);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CGrafPtr savePort;<span></span></pre></td></tr><tr><td scope="row"><pre>        GetPort(&amp;savePort);<span></span></pre></td></tr><tr><td scope="row"><pre>        SetPortDialogPort(theDialog);<span></span></pre></td></tr><tr><td scope="row"><pre>        Point thePoint = theEvent->where;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        GlobalToLocal(&amp;thePoint);<span></span></pre></td></tr><tr><td scope="row"><pre>        Boolean inside = PtInRect(thePoint, &amp;itemBox);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // is the click inside the user item?<span></span></pre></td></tr><tr><td scope="row"><pre>        if (inside)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>            // let's constrain and move the spot!<span></span></pre></td></tr><tr><td scope="row"><pre>            // it's possible to track the spot here but it's complex<span></span></pre></td></tr><tr><td scope="row"><pre>            // so we just move on the click and don't track.<span></span></pre></td></tr><tr><td scope="row"><pre>            // that's typical of dialog's user items of that era.<span></span></pre></td></tr><tr><td scope="row"><pre>            Rect userRect1 = {gUserV-4, gUserH-4, gUserV+4, gUserH+4};<span></span></pre></td></tr><tr><td scope="row"><pre>            EraseRect(&amp;userRect1);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            InvalWindowRect(GetDialogWindow(theDialog), &amp;userRect1);<span></span></pre></td></tr><tr><td scope="row"><pre>            gUserH = thePoint.h;<span></span></pre></td></tr><tr><td scope="row"><pre>            gUserV = thePoint.v;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (gUserH &lt; itemBox.left+4) gUserH = itemBox.left+4;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (gUserH > itemBox.right-4) gUserH = itemBox.right-4;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (gUserV &lt; itemBox.top+4) gUserV = itemBox.top+4;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (gUserV > itemBox.bottom-4) gUserV = itemBox.bottom-4;<span></span></pre></td></tr><tr><td scope="row"><pre>            Rect userRect2 = {gUserV-4, gUserH-4, gUserV+4, gUserH+4};<span></span></pre></td></tr><tr><td scope="row"><pre>            InvalWindowRect(GetDialogWindow(theDialog), &amp;userRect2);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        SetPort(savePort);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>To update this code, you need to make the following changes:</p><ol class="ol"><li class="li"><p>Handle mouse clicks in a Carbon event handler rather than an event filter. </p></li><li class="li"><p>Replace the mouse-down event handler with Carbon event handlers for the <code>kEventControlHitTest</code> and <code>kEventControlTrack</code> events. The hit test event requires you to tell the system what part of the view the user clicked, while the track event is sent if the user moves the mouse while it is down. </p></li><li class="li"><p>Call <code>GetEventParameter</code> to obtain the view reference, bounds, and the Quartz drawing context from the Carbon event instead of calling <code>GetDialogItem</code>.</p></li><li class="li"><p>You will have to change the code to translate the mouse coordinates. When converting to use views, the mouse position you receive from the Carbon event is automatically converted to be in the local coordinates of the view. </p></li><li class="li"><p>You do not have to compare the mouse position to the bounds. Your view receives a Carbon event only if the mouse click occurs in the view. </p></li><li class="li"><p>Call <code>HIViewSetNeedsDisplay</code> or <code>HIViewSetNeedsDisplayInRegion</code> to mark a view or region as needing to be redrawn. You no longer need to call <code>EraseRect</code> or <code>InvalRect</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30001140-CH204-CIAIJBFG" title="The New Custom View"></a><h2>The New Custom View</h2><p>To reproduce the user item in the HIView world, you implement it as a custom view. A custom view is comprised of a class name identifier, a data structure to hold the instance data, and a collection of Carbon event handlers. <span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABCDDFH">Listing 4-4</a></span> shows an example class name and structure</p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_23" title="Listing 3-4Defining a custom view class and instance structure"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABCDDFH" title="Listing 3-4Defining a custom view class and instance structure"></a><strong>Listing 3-4&nbsp;&nbsp;</strong>Defining a custom view class and instance structure</p><div class="codesample"><table><tr><td scope="row"><pre>#define kCustomSpotViewClassID<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                         CFSTR("com.apple.sample.dts.HICustomSpotView")<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    HIViewRef   view;<span></span></pre></td></tr><tr><td scope="row"><pre>    HIPoint     spot;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>CustomSpotViewData;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><ol class="ol"><li class="li"><p>Select a unique class name for your view. You pass this name to the <code>HIObjectRegisterSubclass</code> function, and you specify it in your nib file for the custom HIView element. </p></li><li class="li"><p>Hold the view’s instance data in a <code>CustomSpotViewData</code> structure. At the bare minimum, it must contain the HIView reference for your view. In this example, the instance data also includes the coordinates of the spot inside the view. </p></li></ol><p>Before you instantiate a window containing the custom view (whether from a nib file or by calling <code>HIObjectCreate</code>), you need to register your subclass by calling the <code>HIObjectRegisterSubclass</code> function, as shown in <span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABBDDDG">Listing 4-5</a></span>.</p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_24" title="Listing 3-5Registering a custom view"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABBDDDG" title="Listing 3-5Registering a custom view"></a><strong>Listing 3-5&nbsp;&nbsp;</strong>Registering a custom view</p><div class="codesample"><table><tr><td scope="row"><pre>HIObjectClassRef theClass;<span></span></pre></td></tr><tr><td scope="row"><pre>EventTypeSpec kFactoryEvents[] =<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassHIObject, kEventHIObjectConstruct },<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassHIObject, kEventHIObjectInitialize },<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassHIObject, kEventHIObjectDestruct },<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassControl, kEventControlHitTest },<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassControl, kEventControlTrack },<span></span></pre></td></tr><tr><td scope="row"><pre>            { kEventClassControl, kEventControlDraw }<span></span></pre></td></tr><tr><td scope="row"><pre>        };<span></span></pre></td></tr><tr><td scope="row"><pre>HIObjectRegisterSubclass(kCustomSpotViewClassID, kHIViewClassID, <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        0, CustomSpotViewHandler, GetEventTypeCount(kFactoryEvents),<span></span></pre></td></tr><tr><td scope="row"><pre>        kFactoryEvents, 0, &amp;theClass);<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_25" title="Note"></a><p><strong>Note:</strong>&nbsp;If you are subclassing an existing view, you need to specify its class ID in place of the base HIView class ID in this example. The header files <code>ControlDefinitions.h</code>, <code>HIView.h</code>, and <code>MacTextEditor.h</code> define the class IDs for all standard views and controls. </p></div><ol class="ol"><li class="li"><p>Pass an <code>EventTypeSpec</code> array containing the events that you want your view to handle. </p><p>All custom views must handle the <code>kEventHIObjectConstruct</code> and <code>kEventHIObjectDestruct</code> events. The <code>kEventHIObjectInitialize</code> event lets you perform any needed initializations.</p><p>The control event class contains the events that describe the unique behavior of your view. Just about any custom view requires a <code>kEventControlDraw</code> handler to draw your content, and a <code>kEventControlHitTest</code> handler to provide feedback to the system about what part of the view the user clicked. This example also includes the <code>kEventControlTrack</code> event handler to track the mouse while it is down within the view.</p></li><li class="li"><p>Register your view using <code>HIObjectRegisterSubclass</code>, specifying the callback function to handle all your view’s events. This handler is just like any other Carbon event handler, except that the instance data structure for your view is passed to you in the user data (<code>inRefCon</code>) parameter.</p></li></ol><p><span class="content_text"><a href="upgrading_hitoolbox_samp.html#//apple_ref/doc/uid/TP30001140-CH204-BABBEGHG">Listing 4-6</a></span> shows a possible implementation for your custom view’s event handler. </p><a name="//apple_ref/doc/uid/TP30001140-CH204-DontLinkElementID_26" title="Listing 3-6An event handler for the converted user item"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001140-CH204-BABBEGHG" title="Listing 3-6An event handler for the converted user item"></a><strong>Listing 3-6&nbsp;&nbsp;</strong>An event handler for the converted user item</p><div class="codesample"><table><tr><td scope="row"><pre>pascal OSStatus CustomSpotViewHandler(EventHandlerCallRef inCaller,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        EventRef inEvent, void* inRefcon)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CustomSpotViewData* myData = (CustomSpotViewData*)inRefcon;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (GetEventClass(inEvent))<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassHIObject:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            switch (GetEventKind(inEvent))<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectConstruct:<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    myData = (CustomSpotViewData*)<span></span></pre></td></tr><tr><td scope="row"><pre>                                calloc(1, sizeof(CustomSpotViewData));<span></span></pre></td></tr><tr><td scope="row"><pre>                    GetEventParameter(inEvent,kEventParamHIObjectInstance,<span></span></pre></td></tr><tr><td scope="row"><pre>                         typeHIObjectRef, NULL, sizeof(myData->view), NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                         &amp;myData->view);<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = SetEventParameter(inEvent, kEventParamHIObjectInstance,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     typeVoidPtr, sizeof(myData), &amp;myData);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectInitialize:<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIRect bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>                    GetEventParameter(inEvent, kEventParamBounds, typeHIRect, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         sizeof(bounds), NULL, &amp;bounds);<span></span></pre></td></tr><tr><td scope="row"><pre>                    myData->spot.x = CGRectGetMidX(bounds) - CGRectGetMinX(bounds);<span></span></pre></td></tr><tr><td scope="row"><pre>                    myData->spot.y = CGRectGetMidY(bounds) - CGRectGetMinY(bounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    HIViewSetVisible(myData->view, true);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectDestruct:<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    free(myData);<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                default:<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassControl:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch (GetEventKind(inEvent))<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventControlDraw:<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    CGContextRef    context;<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIRect          bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = GetEventParameter(inEvent,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                             kEventParamCGContextRef, typeCGContextRef, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 sizeof(context), NULL, &amp;context);<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIViewGetBounds(myData->view, &amp;bounds);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    CGContextSetRGBStrokeColor(context, 0.0, 0.0, 0.0, 0.7);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                    CGContextSetRGBFillColor(context, 0.0, 0.0, 0.0, 0.7);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    CGContextSetLineWidth(context, 3.0);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                    CGContextStrokeRect(context, bounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    HIRect spot = { {myData->spot.x - 4.0, myData->spot.y - 4.0},<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                                     {8.0, 8.0} };<span></span></pre></td></tr><tr><td scope="row"><pre>                    CGContextFillRect(context, spot);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventControlHitTest:<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIPoint pt;<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIRect  bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>                    GetEventParameter(inEvent, kEventParamMouseLocation, <span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                                        typeHIPoint, NULL, sizeof(pt), NULL,&amp;pt);<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIViewGetBounds(myData->view, &amp;bounds);<span></span></pre></td></tr><tr><td scope="row"><pre>                    ControlPartCode part = (CGRectContainsPoint(bounds, pt))<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                                            ?kControlButtonPart:kControlNoPart;<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = SetEventParameter(inEvent, kEventParamControlPart,<span>// 12</span></pre></td></tr><tr><td scope="row"><pre>                                     typeControlPartCode, sizeof(part), &amp;part);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventControlTrack:<span>// 13</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    MouseTrackingResult mouseStatus;<span></span></pre></td></tr><tr><td scope="row"><pre>                    ControlPartCode partCode;<span></span></pre></td></tr><tr><td scope="row"><pre>                    Point theQDPoint;<span></span></pre></td></tr><tr><td scope="row"><pre>                    Rect windBounds;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    HIPoint theHIPoint;<span></span></pre></td></tr><tr><td scope="row"><pre>                    HIRect  bounds;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    HIViewGetBounds(myData->view, &amp;bounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    GetWindowBounds (GetControlOwner(myData->view),<span>// 14</span></pre></td></tr><tr><td scope="row"><pre>                                         kWindowStructureRgn, &amp;windBounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    GetEventParameter(inEvent, kEventParamMouseLocation,<span>// 15</span></pre></td></tr><tr><td scope="row"><pre>                        typeHIPoint, NULL, sizeof(theHIPoint), NULL, &amp;theHIPoint);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    mouseStatus = kMouseTrackingMouseDown;<span></span></pre></td></tr><tr><td scope="row"><pre>                    while (mouseStatus != kMouseTrackingMouseUp)<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                        partCode = (CGRectContainsPoint(bounds, theHIPoint))<span></span></pre></td></tr><tr><td scope="row"><pre>                                    ?kControlButtonPart:kControlNoPart;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        if (partCode == kControlButtonPart)<span>// 16</span></pre></td></tr><tr><td scope="row"><pre>                            {<span></span></pre></td></tr><tr><td scope="row"><pre>                            if (theHIPoint.x &lt; bounds.origin.x+4) <span>// 17</span></pre></td></tr><tr><td scope="row"><pre>                                                theHIPoint.x = bounds.origin.x + 4;<span></span></pre></td></tr><tr><td scope="row"><pre>                            if (theHIPoint.x > bounds.origin.x + bounds.size.width-4)<span></span></pre></td></tr><tr><td scope="row"><pre>                                theHIPoint.x = bounds.origin.x + bounds.size.width-4;<span></span></pre></td></tr><tr><td scope="row"><pre>                            if (theHIPoint.y &lt; bounds.origin.y+4)<span></span></pre></td></tr><tr><td scope="row"><pre>                                                theHIPoint.y = bounds.origin.y + 4;<span></span></pre></td></tr><tr><td scope="row"><pre>                            if (theHIPoint.y > bounds.origin.y + bounds.size.height-4)<span></span></pre></td></tr><tr><td scope="row"><pre>                                theHIPoint.y = bounds.origin.y+bounds.size.height-4;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                            myData->spot = theHIPoint;<span></span></pre></td></tr><tr><td scope="row"><pre>                            HIViewSetNeedsDisplay(myData->view, true);<span>// 18</span></pre></td></tr><tr><td scope="row"><pre>                            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        TrackMouseLocation ((GrafPtr)-1, <span>// 19</span></pre></td></tr><tr><td scope="row"><pre>                                                &amp;theQDPoint, &amp;mouseStatus);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        theHIPoint.x = theQDPoint.h - windBounds.left;<span>// 20</span></pre></td></tr><tr><td scope="row"><pre>                        theHIPoint.y = theQDPoint.v - windBounds.top;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        HIViewConvertPoint(&amp;theHIPoint, NULL, myData->view);<span>// 21</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                default:<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div>	<p>Here is how the code works:</p><ol class="ol"><li class="li"><p>When the view receives an event, obtain the event class by calling <code>GetEventClass</code>. </p></li><li class="li"><p>Implement the HIObject class handlers. The HIObject event class is made up of events that concern the creation and destruction of the HIObjects (of which HIView is a subclass). The actions you take here are essentially the same for any custom view:</p><ul class="ul"><li class="li"><p><code>kEventHIObjectConstruct</code> requires you to allocate memory for your view’s instance data, and then set a pointer to this data in the construct event by calling <code>SetEventParameter</code>. The structure you allocate here is then passed to your event handler when subsequent events occur. </p></li><li class="li"><p><code>kEventHIObjectInitialize</code> gives you an opportunity to perform any initialization. Typically, you use this event to process any input parameters passed to your view. If you are using nibs, you can extract any parameters you specified in the Attributes pane of Interface Builder’s Info window.</p></li><li class="li"><p><code>kEventHIObjectDestruct</code> requires you to free the memory you allocated for your view. </p></li></ul><p>For more details about these events, see <em><a href="../../HIViewDoc/index.html#//apple_ref/doc/uid/TP30000923" target="_top">HIView Programming Guide</a></em>.</p></li><li class="li"><p>Implement a drawing handler. The system sends a <code>kEventControlDraw</code> event to your view whenever it needs to be redrawn, either due to an external change or because your application called <code>HIViewSetNeedsDisplay</code> for the view. As emphasized before, all your drawing must take place within this handler. </p></li><li class="li"><p>For the <code>kEventControlDraw</code> event, obtain the Quartz drawing context for the view by calling <code>GetEventParameter</code> with the <code>kEventParamCGContextRef</code> parameter tag. This context is automatically clipped to only the portion that needs to be drawn. </p></li><li class="li"><p>Obtain the bounds of the view by calling <code>HIViewGetBounds</code>. Note that these bounds are in a structure of type <code>HIRect</code>, not type <code>Rect</code>.</p></li><li class="li"><p>Set the Quartz stroke and fill color. These calls are analogous to setting the pen and fill pattern in QuickDraw. </p></li><li class="li"><p>Set the stroke width and draw the box outline. <code>CGContextStrokeRect</code> is the Quartz equivalent of the QuickDraw <code>FrameRect</code> function. </p></li><li class="li"><p>Draw the 8-by-8 spot centered at the position stored in the view’s instance data. The <code>CGContextFillRect</code> function is analogous to the QuickDraw <code>PaintRect</code> function.</p></li><li class="li"><p>Implement a hit test handler. The system sends a <code>kEventControlHitTest</code> event to your view whenever the user clicks in it. Your handler must determine what part of the view was clicked and report that to the system. Complex controls with multiple parts (such as a scroll bar, which has a track area, a thumb, and increment/decrement buttons) may require different responses depending on which part was hit. </p></li><li class="li"><p>Obtain the mouse position from the <code>kEventControlHitTest</code> event using <code>GetEventParameter</code>.</p></li><li class="li"><p>Determine if the mouse down happened within the view using the Quartz function <code>CGRectContainsPoint</code> function. If so, set the part code to <code>kControlButtonPart</code>; otherwise set the part to <code>kControlNoPart</code>. This example is somewhat trivial, in that the mouse down obviously occurred within the view bounds (the view would not receive the event otherwise), but if you have multiple parts within your view, you may need to perform several such tests to determine just what the user clicked. </p></li><li class="li"><p>Pass the part code back in the event by calling <code>SetEventParameter</code> .</p><p>Later when the user performs additional mouse actions (mouse up, dragging, and so on), subsequent Carbon events sent to the view will have the part code parameter set to what you returned in the <code>kEventControlHitTest</code> handler. </p></li><li class="li"><p>Implement a mouse tracking handler. The system sends a <code>kEventControlTrack</code> event to your application when the user begins moving the mouse while holding the mouse button down. Your tracking handler must update the view depending on where the mouse goes. </p></li><li class="li"><p>Obtain the bounds of the window. Currently, the suggested mouse tracking function <code>TrackMouseLocation</code> returns the position of the mouse as a QuickDraw point. This means that you need to perform some calculations to convert the global QuickDraw point returned by <code>TrackMouseLocation</code> into the local coordinates of your custom view. Obtaining the bounds of the window containing the view enables you to translate the bounds later. </p></li><li class="li"><p>Obtain the current mouse location by calling <code>GetEventParameter</code>. If the mouse down occurred within the view, the first thing to do is to redraw the spot at that location. </p></li><li class="li"><p>If the part code indicates that the mouse action occurred within the view bounds, then change the spot position to be the current position of the mouse. </p></li><li class="li"><p>Constrain the spot to the drawn borders of the view. Use a series of conditionals to ensure that it can never be closer than 4 pixels from the actual view bounds. </p></li><li class="li"><p>Mark the view as needing to be redrawn by calling <code>HIViewSetNeedsDisplay</code>. On the next drawing pass, the draw handler draws the spot in the new location (that is, under the mouse). </p></li><li class="li"><p>Track the mouse by calling <code>TrackMouseLocation</code>. This function completes only when the user performs a mouse action (mouse up, drag, and so on), returning the action taken by the user and the current mouse position. Passing <code>-1</code> for the graphics port specifies that the mouse location should be returned in global coordinates. By keeping the <code>TrackMouseLocation</code> call within a loop, the mouse is continually tracked until the user releases the mouse button. </p></li><li class="li"><p>From the global coordinates of the mouse position, subtract off the top left position of the window. Doing so effectively translates the mouse position to be relative to the window’s structure region (or root view). </p></li><li class="li"><p>Call <code>HIViewConvertPoint</code> to translate the point from the local coordinates of the root view to the local coordinates of your custom view. </p></li></ol><p>Unlike the original custom user item, the custom view is not tied to a particular dialog; you need to define it only once and then you can use it in any window in your application. To add your view to a nib window, simply drag the HIView element into the window and specify its class ID and input parameters (if any) from the Info window. The view is instantiated automatically when you create the window from the nib file. </p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../upgrading_hitoolbox_tasks/upgrading_hitoolbox_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../upgrading_hitoolbox_rev/upgrading_hitoolbox_rev.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2004-06-28<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/Upgrading_HIToolbox/upgrading_hitoolbox_samp/upgrading_hitoolbox_samp.html%3Fid%3DTP30001140-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/Upgrading_HIToolbox/upgrading_hitoolbox_samp/upgrading_hitoolbox_samp.html%3Fid%3DTP30001140-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/Upgrading_HIToolbox/upgrading_hitoolbox_samp/upgrading_hitoolbox_samp.html%3Fid%3DTP30001140-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>