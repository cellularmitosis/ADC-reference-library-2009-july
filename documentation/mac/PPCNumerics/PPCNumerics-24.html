<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Comparisons of Expression Evaluation Methods(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<A NAME="HEADING24"></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-23.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-25.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-9.html"><B>Part 1 - The PowerPC Numerics Environment</B></A><BR><DD><A HREF="PPCNumerics-20.html"><B>Chapter 3 - Expression Evaluation</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING24-0"></A>
<H1><A NAME="MARKER-9-20"></A>Comparisons of Expression Evaluation Methods</H1>
 <A NAME="MARKER-2-60"></A><A NAME="MARKER-2-6"></A>You can think of the difference between using and not using widest-need evaluation <BR>as the way these two expression evaluation methods navigate the parse tree for a complex expression. Widest-need evaluation determines the evaluation format of <BR>the topmost expression first and enforces that format on all lower expressions. If a complex expression is evaluated without widest need, the evaluation format of the bottommost expression is determined first, and the results are converted to wider formats as wider formats are encountered working back up the tree.<P>
 <A NAME="MARKER-2-48"></A><A HREF="#MARKER-9-25">Figure 3-3</A> shows how an expression is evaluated using both methods. In this example, <I>dd</I> is a double-double format constant or variable, <I>d</I> is double format, and <I>s</I> is single format. The minimum evaluation format is single. This expression makes a call to a function named <CODE>dfunc</CODE>, which takes a parameter of type <CODE>double</CODE> and returns a double value. <P>
 If this expression is evaluated without widest need, the evaluation format of the multiplication operation (<I>s</I> <CODE>*</CODE> <I>s</I>) is determined first without regard to the rest of the expression. Its semantic type is single, which is the same as the minimum evaluation format, so it is evaluated in single precision. Its result is then converted to double precision when it is passed to the function <CODE>dfunc</CODE>, which takes a double parameter. The function returns a double result. The next expression is the addition operation, which has a semantic type of double-double. The addition will be performed in double-double precision because double-double format is wider than the minimum evaluation format. The double-format return value from <CODE>dfunc</CODE> is converted to double-double, the addition is performed, and a double-double result is returned.<P>
 If this expression is evaluated with widest-need evaluation, the evaluation format of the addition operation is determined first. All of the variables in the expression that are not assigned to function parameters or not part of an assignment statement or cast are looked at to determine the evaluation format. In this expression, the two variables considered are the <I>dd</I> variable and the <CODE>dfunc</CODE> function call. Because <I>dd</I> is double-double format, the evaluation format of the addition operation is double-double. Now, the double-double format is applied down the parse tree to the operands of the addition operation. The first operand is already in double-double format. The second operand is a function call. As explained on <A HREF="PPCNumerics-23.html#MARKER-9-16">page 3-6</A>, function calls are not subject to the usual arithmetic conversions, so their evaluation formats are determined independently of the outer expression and their results are determined before any conversion takes place. The evaluation format for the assignment of values to the parameters of <CODE>dfunc</CODE> is double because <CODE>dfunc</CODE> takes a parameter of type <CODE>double</CODE>. The multiplication operation is an operand to this operation, so the multiplication is performed in double precision. The result of <CODE>dfunc</CODE> is returned in double format, then is converted to double-double format before the addition is performed.<A NAME="MARKER-2-57"></A><P>
<B>Figure 3-3  <A NAME="MARKER-9-25"></A>Evaluating an expression with a function call</B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/PPCN-L-26.jpg"><P>
 <A NAME="MARKER-2-37"></A><A HREF="#MARKER-9-27">Figure 3-4</A> shows how widest-need evaluation protects against midexpression overflow and underflow better than expression evaluation methods that do not use widest need. In this example, <I>s</I> denotes a single-format variable or number, <I>d</I> is double format, <I>dd</I> is double-double format, and the minimum evaluation format is single.<P>
<B>Figure 3-4  <A NAME="MARKER-9-27"></A>Evaluating an expression with arithmetic operations<A NAME="MARKER-2-40"></A></B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/PPCN-L-25.jpg"><P>
 Without widest-need evaluation, the expression in <A HREF="#MARKER-9-27">Figure 3-4</A> is considered as two separate simple expressions. The multiplication operation (<I>s</I> <CODE>*</CODE> <I>s</I>) is considered first. Its semantic type (single format) is the same as the minimum evaluation format, so the multiplication is performed in single precision. The semantic type of the addition operation is double-double, which is wider than the single minimum format. The addition operation is evaluated in double-double precision, so the value of its single-format operand is converted to double-double format before the result is calculated.<P>
 With widest-need evaluation, all of the operands in the complex expression are looked at first to determine the semantic type. The semantic type is double-double because of the double-double variable. This means that the multiplication of the two single-format variables is performed in double-double precision.<P>
 Suppose that the two single variables have the values 10<SUP>38</SUP> and 10, respectively. Multiplying these two values produces 10<SUP>39</SUP>. However, 10<SUP>39</SUP> is out of the range of single format. If these numbers are multiplied in single precision (that is, if widest-need evaluation is not used), it will produce + <IMG BORDER="NONE" SRC="graphics/infinity.gif">  and a floating-point overflow exception. If the multiplication is evaluated in double-double precision (that is, if widest-need evaluation is used), the correct result is returned because 10<SUP>39</SUP> is within the range of the double-double format. <P>
 <A NAME="MARKER-2-9"></A><A NAME="MARKER-2-28"></A><A NAME="MARKER-2-11"></A><P>
</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="PPCNumerics-23.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-25.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><BR>13 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
