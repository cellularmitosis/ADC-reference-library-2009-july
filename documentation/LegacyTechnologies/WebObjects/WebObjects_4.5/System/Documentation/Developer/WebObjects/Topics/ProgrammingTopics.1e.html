<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Creating Sort Orderings</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1d.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1f.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606320"> </A><A NAME="35104"> </A>Creating Sort Orderings</H1><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to create EOSortOrderings used either to specify fetch order or to sort an array in memory.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=606305"> </A>An array of EOSortOrderings is used within EOF to specify the sort order for a fetch, as well as to specify a sort order to sort an array of enterprise objects already in memory. An EOSortOrdering consists of a key, for example, <TT CLASS="Code">lastName</TT>, and a sort direction, for example, <TT CLASS="Code">caseInsensitiveAscending</TT>. For database fetches, the key can be either an attribute of the object or an attribute<TT CLASS="Code"> </TT>path such as <TT CLASS="Code">studio.name</TT>. When sorting an array in memory, the key can be any key that the object can respond to via <TT CLASS="Code">valueForKey</TT> or <TT CLASS="Code">valueForKeyPath</TT>. This allows you to sort on values returned from methods of the object. For example, you can sort on a derived attribute like <TT CLASS="Code">fullName</TT>, even though it is a method.</P><P CLASS="Body"><A NAME="pgfId=606105"> </A>Creating an array of EOSortOrdering objects defines a complete sort specification. Since a sort ordering is completely generic, it can be used with EOFetchSpecifications and in-memory filters.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606106"> </A>Sorting During Fetches</H3><P CLASS="Body"><A NAME="pgfId=606108"> </A>An EOFetchSpecification object can be given an array of EOSortOrderings to be applied during the fetch. It is the database adaptor's responsibility to use the array of sort orderings and return rows in the specified sorted order. The standard relational database adaptors included with EOF convert the array of EOSortOrdering objects into a SQL <TT CLASS="Code">ORDER BY</TT> clause.</P><P CLASS="Body"><A NAME="pgfId=606109"> </A>The following example fetches all movies that have a title starting with &quot;S&quot;, and requests the database to sort them first by the category (case-insensitive ascending) and then by the title (case-insensitive descending).</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608090"> </A>Creating a sort ordering (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=608092"> </A>public WOComponent fetch() {    EOEditingContext ec=session().defaultEditingContext();    EOQualifier qual=EOQualifier.qualifierWithQualifierFormat         (&quot;title like 'S*'&quot;, null);    Object orderings[]={        EOSortOrdering.sortOrderingWithKey(&quot;category&quot;,             EOSortOrdering.CompareCaseInsensitiveAscending),        EOSortOrdering.sortOrderingWithKey(&quot;title&quot;,             EOSortOrdering.CompareCaseInsensitiveDescending)};    EOFetchSpecification fs=new EOFetchSpecification        (&quot;Movie&quot;, qual, new NSArray(orderings));    movies=ec.objectsWithFetchSpecification(fs);    return null;}</PRE><P CLASS="Warning"><A NAME="pgfId=606128"> </A><DIV><IMG SRC="ProgrammingTopics-9.gif"></DIV>Note<BR>WebScript does not know about the names describing sort direction, since they are defined using <TT CLASS="Code">#define</TT> in <TT CLASS="Code">EOSortOrdering.h</TT>. Since WebScript will convert a string object into an Objective-C selector when necessary, uncomment the definitions for sort direction when using WebScript.<DIV><IMG SRC="ProgrammingTopics-9.gif"></DIV></P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608122"> </A>Creating a sort ordering (Objective-C and WebScript)</H4><PRE CLASS="Code"><A NAME="pgfId=608124"> </A>- fetch {    /* Uncomment these definitions for WebScript    id EOCompareAscending=@&quot;compareAscending:&quot;;    id EOCompareDescending=@&quot;compareDescending:&quot;;    id EOCompareCaseInsensitiveAscending=@&quot;compareCaseInsensitiveAscending:&quot;;    id EOCompareCaseInsensitiveDescending=        @&quot;compareCaseInsensitiveDescending:&quot;;    */    EOEditingContext *ec=[[self session] defaultEditingContext];    EOQualifier *qual=[EOQualifier qualifierWithQualifierFormat:        @&quot;title like 'S*'&quot;];    NSArray *orderings=[NSArray arrayWithObjects:        [EOSortOrdering sortOrderingWithKey:@&quot;category&quot;              selector: EOCompareCaseInsensitiveAscending],        [EOSortOrdering sortOrderingWithKey:@&quot;title&quot;             selector: EOCompareCaseInsensitiveDescending], nil];    EOFetchSpecification *fs=[EOFetchSpecification         fetchSpecificationWithEntityName: @&quot;Movie&quot;        qualifier: qual sortOrderings: orderings];    movies =[ec objectsWithFetchSpecification: fs];    return nil;}</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608160"> </A>SQL log</H4><PRE CLASS="Code"><A NAME="pgfId=608162"> </A>[&lt;ODBCChannel: 0xae0f70&gt; evaluateExpression: &lt;ODBCSQLExpression: &quot;SELECT  t0.`CATEGORY`, t0.`DATE_RELEASED`, t0.`LANGUAGE`, t0.`MOVIE_ID`, t0.`POSTER_NAME`, t0.`REVENUE`, t0.`STUDIO_ID`, t0.`TITLE`, t0.`TRAILER_NAME` FROM `MOVIE` t0  WHERE t0.`TITLE` like ? ORDER BY UCASE(t0.`CATEGORY`) asc, UCASE(t0.`TITLE`) desc&quot; withBindings:(1:S%(title))&gt;]</PRE></DIV></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606152"> </A>Sorting Arrays in Memory</H3><P CLASS="Body"><A NAME="pgfId=606154"> </A>An NSArray or NSMutableArray can use an array of EOSortOrderings to perform an in-memory sort of the contents of the array. Remember that when sorting an array in-memory, the sort ordering key can be any key that the object can respond to via <TT CLASS="Code">valueForKey</TT> or <TT CLASS="Code">valueForKeyPath</TT>. This allows you to even sort on values returned from methods on the object. For example, you can sort on a calculated <TT CLASS="Code">fullName</TT>, even though it is only a method and not an attribute.</P><P CLASS="Body"><A NAME="pgfId=606155"> </A>The following creates a new sorted array from a given original unsorted array. It then resorts a different mutable array within itself using the same sort orderings. The sort is performed first by the category (case-insensitive ascending) and then by the title (case-insensitive descending).</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608182"> </A>In-memory sorting (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=608184"> </A>Object orderings[]={<A NAME="pgfId=608186"> </A>    EOSortOrdering.sortOrderingWithKey(&quot;category&quot;, <A NAME="pgfId=615964"> </A>        EOSortOrdering.CompareCaseInsensitiveAscending),<A NAME="pgfId=608188"> </A>    EOSortOrdering.sortOrderingWithKey(&quot;title&quot;,<A NAME="pgfId=615969"> </A>        EOSortOrdering.CompareCaseInsensitiveDescending)};<A NAME="pgfId=615974"> </A><A NAME="pgfId=608190"> </A>// This returns a new array in sorted order.<A NAME="pgfId=608192"> </A>NSArray newSortedArray=sortedArrayUsingKeyOrderArray<A NAME="pgfId=615978"> </A>    (originalArray, new NSArray(orderings));<A NAME="pgfId=615983"> </A><A NAME="pgfId=608194"> </A>// This resorts the mutableArray itself.<A NAME="pgfId=608196"> </A>sortArrayUsingKeyOrderArray<A NAME="pgfId=615980"> </A>    (originalMutableArray, new NSArray(orderings));</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608244"> </A>In-memory sorting (Objective-C and WebScript)</H4><PRE CLASS="Code"><A NAME="pgfId=608246"> </A>/* Uncomment these definitions for WebScript<A NAME="pgfId=608248"> </A>id EOCompareAscending=@&quot;compareAscending:&quot;;<A NAME="pgfId=608250"> </A>id EOCompareDescending=@&quot;compareDescending:&quot;;<A NAME="pgfId=608252"> </A>id EOCompareCaseInsensitiveAscending=@&quot;compareCaseInsensitiveAscending:&quot;;<A NAME="pgfId=608254"> </A>id EOCompareCaseInsensitiveDescending=@&quot;compareCaseInsensitiveDescending:&quot;;<A NAME="pgfId=615993"> </A>*/<A NAME="pgfId=608258"> </A><A NAME="pgfId=615997"> </A>NSArray *orderings=[NSArray arrayWithObjects:<A NAME="pgfId=608260"> </A>    [EOSortOrdering sortOrderingWithKey:@&quot;category&quot;<A NAME="pgfId=615998"> </A>        selector: EOCompareCaseInsensitiveAscending],<A NAME="pgfId=608262"> </A>    [EOSortOrdering sortOrderingWithKey:@&quot;title&quot;<A NAME="pgfId=615999"> </A>        selector: EOCompareCaseInsensitiveDescending], nil];<A NAME="pgfId=608264"> </A><A NAME="pgfId=616000"> </A>// This returns a new array in sorted order.<A NAME="pgfId=608266"> </A>NSArray *newSortedArray=[originalArray <A NAME="pgfId=616001"> </A>    sortedArrayUsingKeyOrderArray: orderings];<A NAME="pgfId=616002"> </A><A NAME="pgfId=608268"> </A>// This resorts the mutableArray itself.<A NAME="pgfId=608270"> </A>[originalMutableArray  sortUsingKeyOrderArray: orderings];</PRE></DIV></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606219"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606220"> </A><A HREF="ProgrammingTopics.1a.html#15933" CLASS="XRef">Fetching with an Editing Context</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=620444"> </A><A HREF="ProgrammingTopics.1c.html#39919" CLASS="XRef">Creating Fetch Specifications Programmatically</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=620451"> </A><A HREF="ProgrammingTopics.1d.html#21221" CLASS="XRef">Creating EOQualifiers Programmatically</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616004"> </A>EOSortOrdering class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=616005"> </A>EOFetchSpecification class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=616006"> </A>EOEditingContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606221"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606222"> </A>	How do I fetch records in sorted order?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606223"> </A>	What is the EOF equivalent of the SQL <TT CLASS="Code">ORDER BY</TT> clause?</LI><LI CLASS="Bulleted"><A NAME="pgfId=616015"> </A>	How do I sort an array in memory?</LI><LI CLASS="Bulleted"><A NAME="pgfId=616016"> </A>	How do I get case-insensitive sort to work with MSAccess?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=616017"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606227"> </A>Sort</LI><LI CLASS="Bulleted"><A NAME="pgfId=606228"> </A>ORDER BY</LI><LI CLASS="Bulleted"><A NAME="pgfId=606229"> </A>EOSortOrdering</LI><LI CLASS="Bulleted"><A NAME="pgfId=606230"> </A>UPPER</LI><LI CLASS="Bulleted"><A NAME="pgfId=606231"> </A>UCASE</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606232"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606233"> </A>21 July, 1998. David Scheck. First Draft.<BR>19 November 1998. Clif Liu. Second Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1d.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1f.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>