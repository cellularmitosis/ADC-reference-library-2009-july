<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Detecting Freed Object Exceptions</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.4.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.6.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606107"> </A><A NAME="34924"> </A>Detecting Freed Object Exceptions</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606108"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606109"> </A>Describes how to detect a freed object exception.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606110"> </A>Description</H2><P CLASS="Body"><A NAME="pgfId=606111"> </A>For applications written in Objective-C or applications that use the Java-wrapped Application Program Interfaces (APIs), you can use the <TT CLASS="Code">NSZombieEnabled</TT> variable defined in NSDebug.h to detect why an object has been freed.</P><P CLASS="Body"><A NAME="pgfId=606112"> </A>Note that the API provided in <TT CLASS="Code">NSDebug.h </TT>is for debugging purposes only and may not be available in future releases. </P><P CLASS="Body"><A NAME="pgfId=606113"> </A>Setting the <TT CLASS="Code">NSZombieEnabled</TT> variable to <TT CLASS="Code">YES</TT> when running your application from the command line changes the behavior of the memory manager. Objects are not deallocated but are converted to objects in the zombie class. When zombie objects receive a deallocation message, they print a warning that includes the name of the message.</P><P CLASS="Body"><A NAME="pgfId=613836"> </A>The message name helps differentiate whether it is your code or something deep inside the WebObjects hierarchy that is attempting to deallocate the freed object. Another benefit of enabling zombie objects is that a freed object exception does not crash your application, allowing you to debug the application with all of its state intact.</P><P CLASS="Body"><A NAME="pgfId=607157"> </A>The following code shows how to use the zombie API. Create a test application using Project Builder, and paste this code in the <TT CLASS="Code">_main.m</TT> file. Compile and run it inside Project Builder to see the debug output.</P><PRE CLASS="Code"><A NAME="pgfId=607192"> </A>// NSZombieTest.m<A NAME="pgfId=607194"> </A>// Demonstrates how object zombies work. <A NAME="pgfId=607196"> </A><A NAME="pgfId=607198"> </A>#import &lt;Foundation/Foundation.h&gt;<A NAME="pgfId=607200"> </A>#import &lt;Foundation/NSDebug.h&gt;<A NAME="pgfId=607202"> </A>int main (int argc, const char *argv[])<A NAME="pgfId=607204"> </A>{<A NAME="pgfId=607206"> </A>    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];<A NAME="pgfId=607208"> </A>    id foo = [[NSDate alloc] init]; // some random class<A NAME="pgfId=607210"> </A>    // Turn on zombie objects, so we can tell<A NAME="pgfId=618328"> </A>    // what class a freed object was.<A NAME="pgfId=618334"> </A>    // Note: NSZombieEnabled is declared in NSDebug.h<A NAME="pgfId=607214"> </A>    NSZombieEnabled = YES;<A NAME="pgfId=607216"> </A>    // throw foo into the pool<A NAME="pgfId=607218"> </A>    [foo autorelease];<A NAME="pgfId=607220"> </A>    // this will free foo<A NAME="pgfId=607222"> </A>    [foo release];<A NAME="pgfId=607224"> </A>    // this will try to free foo again, raising an exception<A NAME="pgfId=607226"> </A>    [pool release];<A NAME="pgfId=607228"> </A>    exit(0);       // insure the process exit status is 0<A NAME="pgfId=607230"> </A>    return 0;      // ...and make main fit the ANSI spec.<A NAME="pgfId=607232"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=614834"> </A></P><P CLASS="Body"><A NAME="pgfId=613778"> </A></P><P CLASS="Body"><A NAME="pgfId=613773"> </A></P><P CLASS="Body"><A NAME="pgfId=607305"> </A>This code produces the following sample output:</P><PRE CLASS="Code"><A NAME="pgfId=607336"> </A><TT CLASS="Code">warning: Jul 21 01:38:09 ZombieTest[209] *** *** Selector 'release' sent to dealloced instance 0xa0edb0 of class NSConcreteDate.</TT><A NAME="pgfId=607338"> </A><TT CLASS="Code">Break at '-[_NSZombie release]' to debug. Stack=0x32046288 0x32046378 0x3203fc30 0x32040346 0x40108d 0x401561 0x401227 0x77f1b304 </TT><A NAME="pgfId=607340"> </A><TT CLASS="Code">warning: Jul 21 01:38:10 ZombieTest[209] *** -[NSAutoreleasePool dealloc]: Exception ignored while releasing an object in an autorelease pool: NSGenericException *** Selector 'release' sent to dealloced instance 0xa0edb0 of class NSConcreteDate.</TT><A NAME="pgfId=607342"> </A><TT CLASS="Code">Break at '-[_NSZombie release]' to debug. Stack=0x32046288 0x32046378 0x3203fc30 0x32040346 0x40108d 0x401561 0x401227 0x77f1b304 </TT></PRE><P CLASS="Body"><A NAME="pgfId=614847"> </A></P><P CLASS="Body"><A NAME="pgfId=607310"> </A>Note that the class of the freed object is printed in the debugging output (<TT CLASS="Code">NSConcreteDate</TT> or <TT CLASS="Code">NSDate</TT>). You can set a breakpoint at [<TT CLASS="Code">_NSZombie release</TT>] to debug further.</P><P CLASS="Body"><A NAME="pgfId=606150"> </A>Note that running an application with <TT CLASS="Code">NSZombieEnabled</TT> set to <TT CLASS="Code">YES</TT> degrades performance.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606151"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606152"> </A><A HREF="ProgrammingTopics.6.html#21233" CLASS="XRef">Detecting Memory Leaks</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=619350"> </A><TT CLASS="Code">NSDebug.h</TT> header file in the Foundation Framework</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=619338"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606154"> </A>	How do I detect which object has been freed when encountering the freed object exception?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606155"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606156"> </A>Memory</LI><LI CLASS="Bulleted"><A NAME="pgfId=606157"> </A>Free</LI><LI CLASS="Bulleted"><A NAME="pgfId=619330"> </A>Exception</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606159"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606160"> </A>20 July, 1998. Mai Nguyen. First Draft.</P><P CLASS="Body"><A NAME="pgfId=613909"> </A>26 October, 1998. Clif Liu. Second Draft.</P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.4.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.6.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>