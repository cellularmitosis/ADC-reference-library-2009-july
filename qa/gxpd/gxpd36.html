<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A GXPD36: Locating the Selected Printer</title><meta name="keywords" content="Mac OS 7 QuickDraw GX chooser selected printer"><meta name="Description" content="Technical Q&amp;A GXPD36: NOTE: QuickDraw GX printer driversand GX printing extensions will not be supported in Mac OS8.0 or in future Mac OS releases. Q&amp;A provides a way to findout which printer is selected in the Chooser and presentssample code that illustrates this process."><meta name="categories" content="QuickDraw GX"><meta name="week-posted" content="Sep 11, 1995 - Sep 15, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001251" title="Locating the Selected Printer"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A GXPD36</div>
<div id="pageheadsub">Locating the Selected Printer</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><TABLE BORDER="0"><TR>	<td bgcolor="#e6e6e6" align=left>		<B>Important for all Apple Printing and Graphics Developers: </B><p id=p4>		The information in this Technical Q &amp; A is still relevant up to and including		<A HREF="../../technotes/tn/tn1090.html" target="_blank">Mac OS 7.6</A>		with QuickDraw GX 1.1.5. Beginning with the release of Mac OS 8.0,		however, Apple plans to deliver a system which incorporates QuickDraw GX		graphics and typography <B>only</B>. QuickDraw GX printer drivers and GX printing		extensions will <B>not</B> be supported in Mac OS 8.0 or in future Mac OS releases. Apple's		goal is to simplify the user experience of printing by unifying the Macintosh		graphic and printing architectures and standardizing on the classic Printing		Manager. </P>				For details on Apple's official announcement, refer to 		<A HREF="../../technotes/gxchange.html" target="_blank">		&lt;/dev/technotes/gxchange.html&gt;</A>	</TD></TR></TABLE><BR><p id = p2>Q:  How do I find out which printer is selected in the Chooser?</p><p id=p4>A:  Under the old print architecture, you can locate the driver for the currently selected printer by accessing the <code>'STR '</code> -8192 or <code>'alis'</code> -8192 resources in theSystem file. The <code>'STR '</code> -8192 resource contains the name of the current driverand the <code>'alis'</code> resource contains an alias record that will take you right tothe driver. Either can be used to locate the driver. Note that with oldersystem software the <code>'alis'</code> resource does not appear in the System. If the<code>'alis'</code> resource is present, resolve it. If not, look in the Extensions folderand in the System folder for a file with the same name as <code>'STR '</code> -8192.</p><p id=p4>With GX installed, the <code>'STR '</code> -8192 resource is supported for backwardcompatibility in applications that are not GX-printing savvy. In this case the<code>'STR '</code> -8192 resource gives the name of the default DTP file on the desktop.For applications that are GX-printing savvy, the concept of a default printeris not important because the user can pick any printer from the GX Printdialog.</p><p id=p4>Once you've located the <code>'STR '</code> -8192, and you have the name of the currentprinter, you can then determine the printer's zone and type using the <code>'PAPA'</code>resource id -8192 in the driver (if the traditional printing architecture is inuse) or by accessing the printer's 'comm' resource (if the GX printingarchitecture is in use).</p><p id=p4>Here is some sample code which demonstrates how to do this.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// Current Printer info sample code//// Dave Polaschek and David Hayward// Developer Technical Support// AppleLink: DEVSUPPORT//// Copyright 1995, Apple Computer,Inc//// Check the default printer under GX or old printing architecture.// Print out the name, entityType, and zone.//// davep    8/16/95    initial cut#include &lt;stdio.h&gt;#define gestaltGXVersion            'qdgx'  // in PrintingManager.h (old) or GXPrinting.h (new)#define gestaltGXPrintingMgrVersion 'pmgr' // in PrintingManager.h (old) or GXPrinting.h (new)#define gestaltAliasMgrAttr         'alis' // in Aliases.h#define printingResourceID            0xE000            // 0xE000 = -8192OSErr        GetCurrentPrinter(Str255 printer);OSErr        test(void);Boolean        gxInstalled(void);Boolean        validPrinter(void);/*---------------------------------------------------------------------------*\        This function returns true if QuickDraw GX printing is available\*---------------------------------------------------------------------------*/Boolean gxInstalled(void){    long version;    if (Gestalt(gestaltGXVersion, &amp;version) == noErr)        if (Gestalt(gestaltGXPrintingMgrVersion, &amp;version) == noErr)            return(true);    return(false);}/*---------------------------------------------------------------------------*\        This function returns the network entity of the currently        selected printer, and as an added bonus, you get an error code, too!\*---------------------------------------------------------------------------*/OSErr GetCurrentPrinter(Str255 printer){    StringHandle    theDriver;    Handle            thePrinter;    OSErr            theErr;    short            resFileRefnum;    theDriver = GetString(printingResourceID);    if (!theDriver) goto BADDriver;    if (gxInstalled()) {        short    vRefNum;        long    dirID;        FSSpec    theFile;        long    resSize;        theErr=FindFolder(kOnSystemDisk,kDesktopFolderType,kDontCreateFolder,        &amp;vRefNum,&amp;dirID);        if (theErr != noErr) goto BADDriver;        theErr=FSMakeFSSpec(vRefNum,dirID,*theDriver,&amp;theFile);        if (theErr != noErr) goto BADDriver;        resFileRefnum = FSpOpenResFile(&amp;theFile,fsRdPerm);        if (resFileRefnum == -1) goto BADResFile;        thePrinter = Get1Resource('comm', 0);        if (!thePrinter) goto BADPrinter;        if (*((long *)*thePrinter) != 'PPTL') goto BADPrinter;        resSize = GetHandleSize(thePrinter)-6;        BlockMoveData((*thePrinter)+6,printer,resSize);    } else {        Boolean     aliasCallsPresent;        Boolean     aliasResourcePresent;        long        resSize,response;        AliasHandle    theAlias;        aliasCallsPresent = ((Gestalt(gestaltAliasMgrAttr,&amp;response) == noErr)            &amp;&amp;            (response &amp; 1));        theAlias = (AliasHandle) GetResource('alis',printingResourceID);        aliasResourcePresent = !!(theAlias);        if (aliasCallsPresent &amp;&amp; aliasResourcePresent) {            FSSpec    fileSpec;            Boolean    wasChanged;            theErr = ResolveAlias(NULL, theAlias,&amp;fileSpec,&amp;wasChanged);            if (theErr != noErr) goto BADDriver;            resFileRefnum = FSpOpenResFile(&amp;fileSpec,fsRdPerm);            if (resFileRefnum == -1) goto BADResFile;        } else {            resFileRefnum = OpenResFile(*theDriver);            if (resFileRefnum == -1) goto BADResFile;        }        thePrinter = Get1Resource('PAPA', printingResourceID);        if (!thePrinter) goto BADPrinter;        resSize = GetHandleSize(thePrinter);        BlockMoveData(*thePrinter,printer,resSize);    }    ReleaseResource(thePrinter);    CloseResFile(resFileRefnum);    return(noErr);// Error returnsBADPrinter:    CloseResFile(resFileRefnum);BADResFile:    theErr = ResError();BADDriver:    return(theErr);}/*---------------------------------------------------------------------------*\        This function is called by the test harness. Doesn't do much        except prove that things work without crashing.\*---------------------------------------------------------------------------*/OSErr test(void){    OSErr    testValue;    Str255    printerEntity;    testValue = GetCurrentPrinter(printerEntity);    if (testValue)        return testValue;    else {        Str31            printer,type,zone;        unsigned char    *currentString;        currentString = printerEntity;        BlockMove(currentString,printer,Length(currentString)+1);        p2cstr(printer);        currentString += Length(currentString) + 1;        BlockMove(currentString,type,Length(currentString) + 1);        p2cstr(type);        currentString += Length(currentString) + 1;        BlockMove(currentString,zone,Length(currentString) + 1);        p2cstr(zone);        printf("Current Printer name = %s\n"                "EntityType = %s\n"                "Zone = %s\n",printer,type,zone);        return noErr;    }}/*---------------------------------------------------------------------------*\        This function tells if there's a valid printer selected (i.e. not        aimed at a driver that's since been deleted or no printer selected        since last System sw install) in the chooser\*---------------------------------------------------------------------------*/Boolean validPrinter(void){    Str255    printerEntity;    if (GetCurrentPrinter(printerEntity) != noErr)        return false;    else if (Length(printerEntity) == 0)        return false;    else        return true;}// Simple testbed for Macintosh sample code//// Dave Polaschek// Developer Technical Support// AppleLink: DEVSUPPORT//// Copyright 1995, Apple Computer,Inc//// This file contains main, and nothing else.// dave    8/15/95    initial cut#include &lt;stdio.h&gt;extern OSErr test(void);        // in CurrentPrinter.cvoid main(void){    OSErr    testResult;    testResult = test();    printf("Return value from test() = %d\n",testResult);}</pre>	</TD></TR></TABLE></CENTER></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Sep 15 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/gxpd/gxpd36.html%3Fid%3DDTS10001251-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/gxpd/gxpd36.html%3Fid%3DDTS10001251-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/gxpd/gxpd36.html%3Fid%3DDTS10001251-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>