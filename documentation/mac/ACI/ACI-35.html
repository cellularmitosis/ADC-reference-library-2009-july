<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Using the Standard Dialog Box for Color Pickers</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING35></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-34.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-36.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-29.html"><B>Chapter 2 - Color Picker Manager</B></A> / <A HREF="ACI-34.html"><B>Using the Color Picker Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING35-0></A>
<H2><A NAME=MARKER-9-52></A>Using the Standard Dialog Box for Color Pickers</H2>
 <A NAME=MARKER-2-53></A><A NAME=MARKER-2-54></A>When your application calls the <CODE>PickColor</CODE> function, your application passes it a pointer to a color picker parameter block. Your application uses the color picker parameter block (described in <A HREF=#nonexistent-marker>"Color Picker Parameter Block" (page 2-20)</A> in <I>Advanced Color Imaging Reference</I>) to specify information to and obtain information from the Color Picker Manager. For example, <A HREF=#MARKER-9-55>Listing 2-1</A> uses the color picker parameter block to specify which color to initially display in the dialog box and to place the dialog box on the deepest color screen. You also use the color picker parameter block to determine whether the user has selected a new color, and, if so, which color is selected.<P>
<B>Listing 2-1  <A NAME=MARKER-9-55></A>Using the <CODE>PickColor</CODE> function</B><P>
<PRE>
void MyPickAColor(void)
{
   ColorPickerInfo cpInfo;
   /* setting input color to be an RGB color */
   cpInfo.theColor.color.rgb = gMyRGBColor;
   cpInfo.theColor.profile = 0L;
   /* no destination profile */
   cpInfo.dstProfile = 0L;
   cpInfo.flags = AppIsColorSyncAware | CanModifyPalette | 
                  CanAnimatePalette;
   /* center dialog box on the deepest color screen */
   cpInfo.placeWhere = kDeepestColorScreen;
   /* use the system default picker */
   cpInfo.pickerType = 0L;
   /* install event filter and color-changed functions */
   cpInfo.eventProc = MyEventProc;/* see Listing 2-2 (page 2-10) */
   cpInfo.colorProc = MyColorChangedProc;/* see Listing 2-3 */
   cpInfo.colorProcData = 0L;
   strcpy(cpInfo.prompt,&quot;\pChoose a highlight color:&quot;);
   /* describe the Edit menu for Color Picker Manager */
   cpInfo.mInfo.editMenuID = kMyEditMenuID;
   cpInfo.mInfo.cutItem = kMyCutItem;
   cpInfo.mInfo.copyItem = kMyCopyItem;
   cpInfo.mInfo.pasteItem = kMyPasteItem;
   cpInfo.mInfo.clearItem = kMyClearItem;
   cpInfo.mInfo.undoItem = kMyUndoItem;
   /* display dialog box to allow user to choose a color */
   if(PickColor(&amp;cpInfo) == noErr &amp;&amp; cpInfo.newColorChosen)
      /* use this new color */
      DoNewColor(&amp;cpInfo.theColor);
}
</PRE>
 The <CODE>PickColor</CODE> function displays the modal dialog box shown in <A HREF=ACI-31.html#MARKER-9-31>Figure 2-1 (page 2-4)</A>. Your application uses the <CODE>prompt</CODE> field of the color picker parameter block to specify the text string prompting the user to choose a color for a particular use (for example, "Choose a highlight color").<A NAME=MARKER-2-56></A><P>
 When the user clicks the Cancel button, <CODE>PickColor</CODE> removes the dialog box, and the <CODE>newColorChosen</CODE> field of the color picker parameter block contains the value <CODE>false</CODE>. When the user clicks the OK button, <CODE>PickColor</CODE> removes the dialog box, the <CODE>newColorChosen</CODE> field of the color picker parameter block contains the value <CODE>true</CODE>, and the field <CODE>theColor</CODE> contains a structure describing the newly selected color. Your application can then use this color for the purpose described in the prompt string (for example, highlighting text or filling shapes).<P>
 When the dialog box is first displayed, the color that your application specifies in the field <CODE>theColor</CODE> is used as the original color from which the user begins to edit. Upon completion, <CODE>PickColor</CODE> sets this field to the last color that the user chose before clicking OK. Although the new colors selected by the user may vary widely, the original color remains fixed for comparison. <A HREF=ACI-31.html#MARKER-9-31>Figure 2-1 (page 2-4)</A> shows how the standard dialog box displays both the original and the new colors.<P>
<A NAME=HEADING35-7></A>
<H3>Defining an Event Filter Function</H3>
 <A NAME=MARKER-2-57></A>Applications can generally allow the Color Picker Manager to handle all events that might occur while the standard dialog box is displayed. Update events are exceptions to this, however. <P>
 The <CODE>PickColor</CODE> function calls the Dialog Manager function <CODE>DialogSelect</CODE>. As described in the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>, <CODE>DialogSelect</CODE> does not allow background windows to receive update events; therefore, at a minimum, your event filter function should handle update events. If your application needs to filter or preprocess other events before <CODE>DialogSelect</CODE> handles them, your application should do so in its event filter function. <P>
 As you can see in <A HREF=#MARKER-9-55>Listing 2-1</A>, your application should supply the <CODE>eventProc</CODE> field of the color picker parameter block with a pointer to an application-defined filter function for handling user events meant for your application. If your filter function returns <CODE>true</CODE>, the Color Picker Manager won't process the event any further. If your filter function returns <CODE>false</CODE>, the Color Picker Manager handles the event as if it were meant for the color picker. <A HREF=#MARKER-9-58>Listing 2-2</A> illustrates such an event filter function.<P>
<B>Listing 2-2  <A NAME=MARKER-9-58></A>An event filter function for the <CODE>PickColor</CODE> function</B><P>
<PRE>
pascal Boolean MyPickerEventFilterFunction (EventRecord *event) 
{  /* returning false sends events to the Color Picker Manager */
   Boolean handled = false;
   switch(event-&gt;what) 
   {
      case updateEvt:
         DoTheUpdate((WindowPtr) event-&gt;message);
         handled = true;
   }
   return handled;
}
</PRE>
<A NAME=HEADING35-13></A>
<H3>Defining a Color-Changed Function</H3>
 <A NAME=MARKER-2-59></A>As shown in <A HREF=#MARKER-9-55>Listing 2-1</A>, your application can supply the <CODE>colorProc</CODE> field of the color picker parameter block with a pointer to an application-defined function that handles color changes. This function, illustrated in <A HREF=#MARKER-9-60>Listing 2-3</A>, should support the updating of colors in a document as the user selects them. To support faster feedback as the user changes color, this function doesn't update the application's internal data structures. <P>
<B>Listing 2-3  <A NAME=MARKER-9-60></A>A color-changed function</B><P>
<PRE>
pascal void MyColorChangedFunction(long userData, PMColorPtr newColor) 
{
   GrafPtr  port;
   CWorld   cWorld;
   CMColor  color;
   CMError  cwError;

   GetPort(&amp;port);
   SetPort(myDocWindow);
   /* determine whether the color has a profile */
   if(newColor-&gt;profile) 
   {
      /* convert the color to an RGB color */
      cwError = CWNewColorWorld(&amp;cWorld, newColor-&gt;profile, 0L);
      if(cwError == noErr || cwError == CMProfilesIdentical) 
      {
         color = newColor-&gt;color;
         CWMatchColors(cWorld, &amp;color, 1);
         CWDisposeColorWorld(cWorld);
      }
   } 
   else
      color.rgb = newColor-&gt;color.rgb;
   /* change the color of currently highlighted objects */
   MyChangeHighlight(&amp;color.rgb);
   SetPort(port);
}
</PRE>
 In this example, it is assumed that ColorSync is installed because the application sets the <CODE>AppIsColorSyncAware</CODE> flag when calling <CODE>PickColor</CODE>. Because a non-RGB color might come back from the color picker, this example uses ColorSync 1.0 functions to convert the color to an RGB color.<A NAME=MARKER-2-61></A><A NAME=MARKER-2-62></A><A NAME=MARKER-2-63></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-34.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-36.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
