<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using Line-Drawing Picture Comments (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING471></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-470.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-472.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-465.html"><B>Appendix B - Using Picture Comments for Printing</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING471-0></A>
<H1>Using Line-Drawing Picture Comments</H1>
 Line-drawing picture comments, listed in <A HREF=QuickDraw-466.html#MARKER-9-1>Table B-1 on page B-8</A>, provide your application with the ability to draw dashed lines (as described in the next section) and to display fractional line widths (as described in <A HREF=#MARKER-9-168>"Using Fractional Line Widths" on page B-36</A>).<P>
<A NAME=HEADING471-2></A>
<H2><A NAME=MARKER-9-159></A>Drawing Dashed Lines</H2>
 <A NAME=MARKER-2-160></A><A NAME=MARKER-2-161></A><A NAME=MARKER-2-162></A>Your application may use dashed lines frequently, particularly if it is a spreadsheet or accounting application. You can use the <CODE>DashedLine</CODE> picture comment to draw dashed lines on capable printers without drawing each individual dash. You use the <CODE>DashedStop</CODE> picture comment to tell the printer driver when you are finished sending dashed line information. <P>
 <A NAME=MARKER-2-163></A>When you use the <CODE>DashedLine</CODE> comment, the printer driver draws the indicated lines or rectangles. You should pass a handle to a <CODE>TDashedLineRec</CODE> record in the <CODE>dataHandle</CODE> parameter of the <CODE>PicComment</CODE> procedure. You use a <CODE>TDashedLineRec</CODE> record to specify how the dashed line should look. Here is how you should declare these as Pascal data structures:<P>
<PRE>
TYPE 
   TDashedLineHdl = ^TDashedLinePtr;
   TDashedLinePtr = ^TDashedLineRec;
   TDashedLineRec =
   PACKED RECORD
      offset:     SignedByte; {offset}
      centered:   SignedByte; {reserved; set to 0}
      intervals:  ARRAY[0..0] OF SignedByte;
                              {points for drawing and not }
                              { drawing dashes}
   END;
</PRE>
 Use the <CODE>offset</CODE> field to specify an offset as with the PostScript <CODE>setdash</CODE> operator.<A NAME=MARKER-2-164></A><P>
 The <CODE>centered</CODE> field is reserved and should be set to 0. Your application must center the dashed lines.<P>
 In the <CODE>intervals</CODE> field, specify an array of dash intervals describing the number of points drawn for a dash and the number of points not drawn between them.<A NAME=MARKER-2-165></A><A NAME=MARKER-2-166></A><P>
 You must provide both a QuickDraw and a picture comment version of the dashed line. The code in <A HREF=#MARKER-9-167>Listing B-9</A> uses the <CODE>PostScriptBegin</CODE> and <CODE>PostScriptEnd</CODE> picture comments to hide QuickDraw code from PostScript, and it uses pattern mode 23 to render PostScript drawing invisible in QuickDraw. <P>
<B>Listing B-9  <A NAME=MARKER-9-167></A>Using the <CODE>DashedLine</CODE> picture comment</B><P>
<PRE>
PROCEDURE DashDemo;
CONST
   magicPen = 23; 
   cx = 280;      {center along x-axis}
   cy = 280;      {center along y-axis}
   r0 = 200;      {radius}
VAR
   dashHdl:    TDashedLineHdl;
   i:          Integer;
   a, rad:     Extended;
BEGIN
   PenSize(2,2);
   {First the PostScript picture comment version. Pattern mode } 
   { 23 makes the line drawing invisible to QuickDraw.}
   PenMode(magicPen);
   dashHdl := TDashedLineHdl(NewHandle(SizeOf(TDashedLineRec)));
   IF dashHdl &lt;&gt; NIL THEN
   WITH dashHdl^^ DO
   BEGIN
      offset := 4;       {just for fun}
      centered := 0;     {currently ignored--set to 0}
      intervals[0] := 2; {number of interval specs}
      intervals[1] := 4; {this means 4 points on ...}
      intervals[2] := 6; {... and 6 points off}
      PicComment(DashedLine, SizeOf(TDashedLineRec), 
      Handle(dashHdl));
   END;
   rad := 3.14159 / 180;   {conversion degrees -&gt; radians}
   FOR i := 0 TO 9 DO
   BEGIN    {draw some dashed lines}
      a := i * 20 * rad;
      MoveTo(cx, cy);
      Line(round(r0 * cos(a)), - round(r0 * sin(a)));
   END;
   PicComment(DashedStop, 0, NIL);  {that's enough!}
   DisposeHandle(Handle(dashHdl));
   PenMode(srcOr);  {no magic any more}
   {Now, the QuickDraw version. The PostScript driver must }
   { ignore it, so enclose it between PostScriptBegin and }
   { PostScriptEnd comments.}
   PicComment(PostScriptBegin, 0, NIL);
   PenSize(2,2);
   FOR i := 0 TO 9 DO
   BEGIN
      MoveTo(cx,cy);
      MyDashedQDLine(round(r0 * cos(i * 20 * rad)),
                     - round(r0 * sin(i * 20 * rad)), dashHdl);
   END;
   PicComment(PostScriptEnd, 0, NIL);
END;
</PRE>
<A NAME=HEADING471-12></A>
<H2><A NAME=MARKER-9-168></A>Using Fractional Line Widths</H2>
 <A NAME=MARKER-2-169></A><A NAME=MARKER-2-170></A>Your application may need lines as thin as possible or thinner than the screen can display, especially if it is a desktop publishing, spreadsheet, or design application. You can draw <B>hairlines</B> (lines that are less than 1/72 of an inch wide) with printer drivers that support the <CODE>SetLineWidth</CODE> picture comment. Your application passes the printer driver a scaling factor (such as 1/4) that the driver applies to the pen size when rendering the picture. <P>
 QuickDraw and the PostScript language define 1 point to be 1/72 of an inch, so there are exactly 72 points per inch on the Macintosh screen. The resolution of a PostScript device such as the 300-dpi LaserWriter printer is about four times that of the screen, so the driver can render lines that are approximately 1/4 of a point thick, which is about 1/288 of an inch.<P>
 When you specify the <CODE>SetLineWidth</CODE> picture comment in the <CODE>kind</CODE> parameter of the <CODE>PicComment</CODE> procedure, you also specify a <CODE>TLineWidthHdl</CODE> handle (a handle to a data structure of type <CODE>TLineWidth</CODE>) in the <CODE>dataHandle</CODE> parameter. The <CODE>TLineWidth</CODE> data structure is defined by the <CODE>Point</CODE> data type. Here is how you should declare these as Pascal data types in your application:<P>
<PRE>
TLineWidthHdl  = ^TLineWidthPtr;
TLineWidthPtr  = ^TLineWidth;
TLineWidth     = Point; {v = numerator, h = denominator}
</PRE>
 Use the vertical coordinate of the point as the numerator and the horizontal coordinate as the denominator of the scaling factor: the driver multiplies the horizontal and vertical components of the pen by the scaling factor to obtain the new pen width. For example, if you have a pen size of (1,2) and your <CODE>SetLineWidth</CODE> picture comment uses 2 for the horizontal and 7 for the vertical, the pen size will then be (7/2) <EM></EM> 1 pixel wide and <BR>(7/2)<EM> </EM> 2 pixels high.<P>
 In <A HREF=#MARKER-9-171>Figure B-9</A>, the original pen size is 1 point. The first scaling factor is 5.0 or (5,1), which gives the pen a width of 5 points. The second scaling factor, applied to the new pen width, is 0.2 or (1,5), which gives the pen a width of 1 point again.<P>
<B>Figure B-9  <A NAME=MARKER-9-171></A>Changing the pen width using the <CODE>SetLineWidth</CODE> picture comment</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/AppB-L-11.jpg"><BR>
 The <CODE>SetLineWidth</CODE> picture comment is implemented by all PostScript LaserWriter printer drivers and by some QuickDraw printer drivers. However, not all QuickDraw printer drivers support <CODE>SetLineWidth</CODE>, and there is no backup solution for cases where it is not supported. Among QuickDraw printer drivers that do support <CODE>SetLineWidth</CODE>, some drivers emulate PostScript printer drivers, while others--such as the QuickDraw LaserWriter SC driver--implement <CODE>SetLineWidth</CODE> differently. <P>
 The difference between the implementations of the <CODE>SetLineWidth</CODE> comment by the PostScript LaserWriter driver and the QuickDraw LaserWriter SC driver is apparent as soon as <CODE>SetLineWidth</CODE> is used a second time. The PostScript driver keeps an internal line-scaling factor, which is initialized to 1.0 when a job is started. Each number passed through <CODE>SetLineWidth</CODE> is multiplied by the current internal scaling factor to get the effective scaling factor for the pen size. The LaserWriter SC driver, on the other hand, replaces its current scaling factor for the pen size by the new value passed through <CODE>SetLineWidth</CODE>. <P>
 To support both implementations, you must always use an additional <CODE>SetLineWidth</CODE> picture comment to reset the PostScript driver line width to 1.0 before scaling to a new value width, as illustrated by the following lines of code:<P>
<PRE>
PicComment(SetLineWidth, SizeOf(TLineWidth), Handle(1/oldLineWidth));
PicComment(SetLineWidth, SizeOf(TLineWidth), Handle(newLineWidth));
</PRE>
 For example, suppose your application set the line width to 0.25, and now it needs a line width of 0.5. The following two <CODE>SetLineWidth</CODE> comments have the desired effect on all PostScript and QuickDraw drivers that implement the <CODE>SetLineWidth</CODE> comment.
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Current line width,<BR>PS driver<TH>Current line width,<BR>QD driver<TH>Value passed along with <CODE>SetLineWidth</CODE><TH>New line width,<BR>PS driver<TH>New line width,<BR>QD driver<TR>
<TD>0.25<TD>0.25<TD>4/1<TD>1.0<TD>4.0<TR>
<TD>1.0<TD>4.0<TD>1/2<TD>0.5<TD>0.5</TABLE>
<P>
 The sample code in <A HREF=#MARKER-9-172>Listing B-10</A> gives the expected results on PostScript LaserWriter and QuickDraw printer drivers that implement the <CODE>SetLineWidth</CODE> comment.<P>
<B>Listing B-10  <A NAME=MARKER-9-172></A>Using the <CODE>SetLineWidth</CODE> picture comment</B><P>
<PRE>
PROCEDURE MySetNewLineWidth(oldWidth,newWidth: TLineWidth);
VAR
   tempWidthH: TLineWidthHdl;
BEGIN
   tempWidthH := TLineWidthHdl(NewHandle(SizeOf(TLineWidth)));
   tempWidthH^^.v := oldWidth.h;
   tempWidthH^^.h := oldWidth.v;
   PicComment(SetLineWidth, SizeOf(TLineWidth), Handle(tempWidthH));
   tempWidthH^^ := newWidth;
   PicComment(SetLineWidth, SizeOf(TLineWidth), Handle(tempWidthH));
   DisposeHandle(Handle(tempWidthH));
END;
PROCEDURE MyLineWidthDemo;
CONST
   y0 = 50;    {top left of demo}
   x0 = 50;
   d0 = 440;   {length of horizontal lines}
   e0 = 5;     {distance between lines}
   kN = 5;     {number of lines}
VAR
   oldWidth,newWidth:   TLineWidth;
   i,j,y:               Integer;
BEGIN
   PenNormal;
   y := y0;
   SetPt(oldWidth,1,1);             {initial line width = 1.0}
   FOR i := 1 TO 5 DO
   BEGIN
      SetPt(newWidth,4,i);
      {want to set it to i/4 = 0.25, 0.50, 0.75 ...}
      SetNewLineWidth(oldWidth,newWidth);
      MoveTo(x0, y);
      Line(d0, 0);
      y := y + e0;
      oldWidth := newWidth;
   END;
END;
</PRE>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-470.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-472.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
