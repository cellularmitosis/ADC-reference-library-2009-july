<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the SCSI Manager(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING150></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-149.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-151.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-119.html"><B>Chapter 3 - SCSI Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING150-0></A>
<H1>Summary of the SCSI Manager</H1>
<A NAME=HEADING150-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING150-2></A>
<H3>Constants</H3>
<PRE>
CONST
   scInc       = 1;     {transfer data, increment buffer pointer}
   scNoInc     = 2;     {transfer data, don't increment pointer}
   scAdd       = 3;     {add long to address}
   scMove      = 4;     {move long to address}
   scLoop      = 5;     {decrement counter and loop if &gt; 0}
   scNop       = 6;     {no operation}
   scStop      = 7;     {stop TIB execution}
   scComp      = 8;     {compare SCSI data with memory}
   {signature values}
   sbSIGWord   = $4552;    {driver descriptor map signature}
   pMapSIG     = $504D;    {partition map signature}
</PRE>
<A NAME=HEADING150-5></A>
<H3>Data Types</H3>
<PRE>
TYPE SCSIInstr =
   RECORD
      scOpcode:         Integer;    {operation code}
      scParam1:         LongInt;    {first parameter}
      scParam2:         LongInt;    {second parameter}
   END;
   Block0 = 
   PACKED RECORD
      sbSig:         Integer;    {device signature}
      sbBlkSize:     Integer;    {block size of the device}
      sbBlkCount:    LongInt;    {number of blocks on the device}
      sbDevType:     Integer;    {reserved}
      sbDevId:       Integer;    {reserved}
      sbData:        LongInt;    {reserved}
      sbDrvrCount:   Integer;    {number of driver descriptor entries}
      ddBlock:       LongInt;    {first driver's starting block}
      ddSize:        Integer;    {size of the driver, in 512-byte blocks}
      ddType:        Integer;    {operating system type (MacOS = 1)}
      ddPad:         ARRAY [0..242] OF Integer; {additional drivers, if any}
   END;
   Partition = 
   RECORD
      pmSig:         Integer;    {partition signature}
      pmSigPad:      Integer;    {reserved}
      pmMapBlkCnt:   LongInt;    {number of blocks in partition map}
      pmPyPartStart: LongInt;    {first physical block of partition}
      pmPartBlkCnt:  LongInt;    {number of blocks in partition}
      pmPartName:    PACKED ARRAY [0..31] OF Char; {partition name}
      pmParType:     PACKED ARRAY [0..31] OF Char; {partition type}
      pmLgDataStart: LongInt;    {first logical block of data area}
      pmDataCnt:     LongInt;    {number of blocks in data area}
      pmPartStatus:  LongInt;    {partition status information}
      pmLgBootStart: LongInt;    {first logical block of boot code}
      pmBootSize:    LongInt;    {size of boot code, in bytes}
      pmBootAddr:    LongInt;    {boot code load address}
      pmBootAddr2:   LongInt;    {reserved}
      pmBootEntry:   LongInt;    {boot code entry point}
      pmBootEntry2:  LongInt;    {reserved}
      pmBootCksum:   LongInt;    {boot code checksum}
      pmProcessor:   PACKED ARRAY [0..15] OF Char; {processor type}
      pmPad:         ARRAY [0..187] OF Integer;    {reserved}
   END;
</PRE>
<A NAME=HEADING150-9></A>
<H3>Routines</H3>
<PRE>
FUNCTION SCSIReset		: OSErr;
FUNCTION SCSIGet		: OSErr;
FUNCTION SCSISelect		(targetID: Integer): OSErr;
FUNCTION SCSISelAtn		(targetID: Integer): OSErr;
FUNCTION SCSICmd		(buffer: Ptr; count: Integer): OSErr;
FUNCTION SCSIMsgIn		(VAR message: Integer): OSErr;
FUNCTION SCSIMsgOut		(message: Integer): OSErr;
FUNCTION SCSIRead		(tibPtr: Ptr): OSErr;
FUNCTION SCSIRBlind		(tibPtr: Ptr): OSErr;
FUNCTION SCSIWrite		(tibPtr: Ptr): OSErr;
FUNCTION SCSIWBlind		(tibPtr: Ptr): OSErr;
FUNCTION SCSIComplete		(VAR stat: Integer; VAR message: Integer; 
				wait: LongInt): OSErr;
FUNCTION SCSIStat		: Integer;
</PRE>
<A NAME=HEADING150-23></A>
<H2>C Summary</H2>
<A NAME=HEADING150-24></A>
<H3>Constants</H3>
<PRE>
enum {
   /* TIB instruction opcodes */
   scInc       = 1,        /* transfer data, increment buffer pointer */
   scNoInc     = 2,        /* transfer data, don't increment pointer */
   scAdd       = 3,        /* add long to address */
   scMove      = 4,        /* move long to address */
   scLoop      = 5,        /* decrement counter and loop if &gt; 0 */
   scNop       = 6,        /* no operation */
   scStop      = 7,        /* stop TIB execution */
   scComp      = 8,        /* compare SCSI data with memory */
   /* signature values */
   sbSIGWord   = 0x4552,   /* driver descriptor map signature */
   pMapSIG     = 0x504D    /* partition map signature */
};
</PRE>
<A NAME=HEADING150-27></A>
<H3>Data Types</H3>
<PRE>
struct SCSIInstr {
   unsigned short    scOpcode;      /* operation code */
   unsigned long     scParam1;      /* first parameter */
   unsigned long     scParam2;      /* second parameter */
};
typedef struct SCSIInstr SCSIInstr;
struct Block0 {
   unsigned short    sbSig;         /* device signature */
   unsigned short    sbBlkSize;     /* block size of the device*/
   unsigned long     sbBlkCount;    /* number of blocks on the device*/
   unsigned short    sbDevType;     /* reserved */
   unsigned short    sbDevId;       /* reserved */
   unsigned long     sbData;        /* reserved */
   unsigned short    sbDrvrCount;   /* number of driver descriptor entries */
   unsigned long     ddBlock;       /* first driver's starting block */
   unsigned short    ddSize;        /* driver's size, in 512-byte blocks */
   unsigned short    ddType;        /* operating system type (MacOS = 1) */
   unsigned short    ddPad[243];    /* additional drivers, if any */
};
typedef struct Block0 Block0;
Partition {
   unsigned short    pmSig;         /* partition signature */
   unsigned short    pmSigPad;      /* reserved */
   unsigned long     pmMapBlkCnt;   /* number of blocks in partition map */
   unsigned long     pmPyPartStart; /* first physical block of partition */
   unsigned long     pmPartBlkCnt;  /* number of blocks in partition */
   unsigned char     pmPartName[32];/* partition name */
   unsigned char     pmParType[32]; /* partition type */
   unsigned long     pmLgDataStart; /* first logical block of data area */
   unsigned long     pmDataCnt;     /* number of blocks in data area */
   unsigned long     pmPartStatus;  /* partition status information */
   unsigned long     pmLgBootStart; /* first logical block of boot code */
   unsigned long     pmBootSize;    /* size of boot code, in bytes */
   unsigned long     pmBootAddr;    /* boot code load address */
   unsigned long     pmBootAddr2;   /* reserved */
   unsigned long     pmBootEntry;   /* boot code entry point */
   unsigned long     pmBootEntry2;  /* reserved */
   unsigned long     pmBootCksum;   /* boot code checksum */
   unsigned char     pmProcessor[16];  /* processor type */
   unsigned short    pmPad[188];    /* reserved */
};
typedef struct Partition Partition;
</PRE>
<A NAME=HEADING150-31></A>
<H3>Functions</H3>
<PRE>
pascal OSErr SCSIReset     (void);
pascal OSErr SCSIGet       (void);
pascal OSErr SCSISelect    (short targetID);
pascal OSErr SCSISelAtn    (short targetID);
pascal OSErr SCSICmd       (Ptr buffer, short count);
pascal OSErr SCSIMsgIn     (short *message);
pascal OSErr SCSIMsgOut    (short message);
pascal OSErr SCSIRead      (Ptr tibPtr);
pascal OSErr SCSIRBlind    (Ptr tibPtr);
pascal OSErr SCSIWrite     (Ptr tibPtr);
pascal OSErr SCSIWBlind    (Ptr tibPtr);
pascal OSErr SCSIComplete  (short *stat, short *message, 
                            unsigned long wait);
pascal short SCSIStat      (void);
</PRE>
<A NAME=HEADING150-45></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING150-46></A>
<H3>Data Structures</H3>
<A NAME=HEADING150-47></A>
<H4>Transfer Instruction Block
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>scOpcode<TD>word<TD>operation code<TR>
<TD>2<TD>scParam1<TD>long<TD>first parameter<TR>
<TD>6<TD>scParam2<TD>long<TD>second parameter</TABLE>
</H4>
<A NAME=HEADING150-48></A>
<H4>Driver Descriptor Record
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>sbSig<TD>word<TD>device signature<TR>
<TD>2<TD>sbBlkSize<TD>word<TD>block size of the device<TR>
<TD>4<TD>sbBlkCount<TD>long<TD>number of blocks on the device<TR>
<TD>8<TD>sbDevType<TD>word<TD>reserved<TR>
<TD>10<TD>sbDevId<TD>word<TD>reserved<TR>
<TD>12<TD>sbData<TD>long<TD>reserved<TR>
<TD>16<TD>sbDrvrCount<TD>word<TD>number of driver descriptor entries<TR>
<TD>18<TD>ddBlock<TD>long<TD>first driver's starting block<TR>
<TD>22<TD>ddSize<TD>word<TD>driver's size, in 512-byte blocks<TR>
<TD>24<TD>ddType<TD>word<TD>operating system type (MacOS = 1)<TR>
<TD>26<TD>ddPad<TD>486 bytes<TD>additional drivers, if any</TABLE>
</H4>
<A NAME=HEADING150-49></A>
<H4>Partition Map Entry
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>pmSig<TD>word<TD>partition signature<TR>
<TD>2<TD>pmSigPad<TD>word<TD>reserved<TR>
<TD>4<TD>pmMapBlkCnt<TD>long<TD>number of blocks in partition map<TR>
<TD>8<TD>pmPyPartStart<TD>long<TD>first physical block of partition<TR>
<TD>12<TD>pmPartBlkCnt<TD>long<TD>number of blocks in partition<TR>
<TD>16<TD>pmPartName<TD>32 bytes<TD>partition name<TR>
<TD>48<TD>PmParType<TD>32 bytes<TD>partition type<TR>
<TD>80<TD>pmLgDataStart<TD>long<TD>first logical block of data area<TR>
<TD>84<TD>pmDataCnt<TD>long<TD>number of blocks in data area<TR>
<TD>88<TD>pmPartStatus<TD>long<TD>partition status information<TR>
<TD>92<TD>pmLgBootStart<TD>long<TD>first logical block of boot code<TR>
<TD>96<TD>pmBootSize<TD>long<TD>size of boot code, in bytes<TR>
<TD>100<TD>pmBootAddr<TD>long<TD>boot code load address<TR>
<TD>104<TD>pmBootAddr2<TD>long<TD>reserved<TR>
<TD>108<TD>pmBootEntry<TD>long<TD>boot code entry point<TR>
<TD>112<TD>pmBootEntry2<TD>long<TD>reserved<TR>
<TD>116<TD>pmBootCksum<TD>long<TD>boot code checksum<TR>
<TD>120<TD>pmProcessor<TD>16 bytes<TD>processor type<TR>
<TD>136<TD>pmPad<TD>376 bytes<TD>reserved</TABLE>
 Record</H4>
 <P>
<A NAME=HEADING150-51></A>
<H3>Trap Macros</H3>
<A NAME=HEADING150-52></A>
<H4>Trap Macros Requiring Routine Selectors</H4>
<PRE>
_SCSIDispatch
</PRE>
<TABLE BORDER="0" CELLPADDING=3>
<TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>$00<TD><CODE>SCSIReset</CODE><TR>
<TD>$01<TD><CODE>SCSIGet</CODE><TR>
<TD>$02<TD><CODE>SCSISelect</CODE><TR>
<TD>$03<TD><CODE>SCSICmd</CODE><TR>
<TD>$04<TD><CODE>SCSIComplete</CODE><TR>
<TD>$05<TD><CODE>SCSIRead</CODE><TR>
<TD>$06<TD><CODE>SCSIWrite</CODE><TR>
<TD>$08<TD><CODE>SCSIRBlind</CODE><TR>
<TD>$09<TD><CODE>SCSIWBlind</CODE><TR>
<TD>$0A<TD><CODE>SCSIStat</CODE><TR>
<TD>$0B<TD><CODE>SCSISelAtn</CODE><TR>
<TD>$0C<TD><CODE>SCSIMsgIn</CODE><TR>
<TD>$0D<TD><CODE>SCSIMsgOut</CODE></TABLE>


<A NAME=HEADING150-54></A>
<H2><A NAME=MARKER-9-184></A>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD><CODE>noErr</CODE><TD>0<TD>No error<TR>
<TD><CODE>scCommErr</CODE><TD>2<TD>Communications error, operation timeout<TR>
<TD><CODE>scArbNBErr</CODE><TD>3<TD>Bus busy, arbitration timeout<TR>
<TD><CODE>scBadParmsErr</CODE><TD>4<TD>Bad parameter or unrecognized TIB instruction<TR>
<TD><CODE>scPhaseErr</CODE><TD><B>X</B><TD>Phase error on the SCSI bus<TR>
<TD><CODE>scCompareErr</CODE><TD>6<TD>Comparison error from <CODE>scComp</CODE> instruction<TR>
<TD><CODE>scMgrBusyErr</CODE><TD>7<TD>SCSI Manager busy<TR>
<TD>scSequenceErr<TD>8<TD>Attempted operation is out of sequence<TR>
<TD>scBusTOErr<TD>9<TD>Bus timeout during blind transfer<TR>
<TD>scComplPhaseErr<TD>10<TD>SCSI bus was not in status phase on entry to <CODE>SCSIComplete</CODE></TABLE>
</H2>
 <A NAME=MARKER-9-26></A><P>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-149.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-151.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
