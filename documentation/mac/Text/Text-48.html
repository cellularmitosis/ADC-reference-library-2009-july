<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>An Overview of the TextEdit Data Structures(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING48></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-40.html"><B>Chapter 2 - TextEdit</B></A> / <A HREF="Text-41.html"><B>About TextEdit</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING48-0></A>
<H2><A NAME=MARKER-9-107></A>An Overview of the TextEdit Data Structures</H2>
 To edit text on the screen, TextEdit maintains information about where the text is stored, where to display it, and the text style. This information is contained in a record that defines the complete editing environment. You can a<A NAME=MARKER-2-258></A>llocate a <A NAME=MARKER-2-65></A><B>monostyled edit record</B> to contain text that is set in a single font, size, and style, or you can <A NAME=MARKER-2-264></A>allocate <A NAME=MARKER-2-260></A>a <B>multistyled edit record</B> to contain text with attributes that can vary from character to character.<P>
<A NAME=HEADING48-2></A>
<H3><A NAME=MARKER-9-112></A>An Overview of the Edit Record</H3>
 An edit record, which is the primary data structure that TextEdit uses, carries text storage, display, and editing information. When you allocate an edit record, you specify where the text is to be drawn and where it is to be made <A NAME=MARKER-2-70></A>visible. The <B>destination rectangle</B> is the area in which the text is drawn, and the <B>view rectangle</B> <A NAME=MARKER-2-54></A>is that portion of the window within which the text is actually displayed. (For a complete discussion of destination and view rectangles, see the QuickDraw chapters in <I><A HREF="../QuickDraw/QuickDraw-2.html">Inside Macintosh: Imaging</A></I>.) <A HREF=#MARKER-9-117>Figure 2-6</A> shows two sets of destination and view <A NAME=MARKER-2-306></A>rectangles. The view <A NAME=MARKER-2-128></A>rectangles are shaded and defined by dotted lines. The text is drawn in the destination rectangle; the part of it that is displayed is defined by the view rectangle.<P>
<B>Figure 2-6  <A NAME=MARKER-9-117></A><A NAME=MARKER-21-118></A>Destination and view rectangles</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TE_L-27.jpg">
 The edit record includes fields that point to these rectangles. In addition to the two rectangles, the edit record also contains<P>
<UL>
<LI>a handle to the text to be edited
<LI>the current selection range that determines exactly which characters are to be affected by the next editing operation
<LI>the<A NAME=MARKER-2-285></A> alignment of the text, as left, right, or center
<LI>for multistyled edit records, a handle to a subsidiary record, the style record, containing the character attributes used to portray the text. This style record, itself, contains subsidiary data structures.<P>
</UL>
<A NAME=HEADING48-11></A>
<H3><A NAME=MARKER-9-120></A>Related Data Structures</H3>
 Stemming from the main TextEdit edit record, relationships exist among the rest of the TextEdit data structures.<P>
 When TextEdit creates an edit record, the record contains a field that stores the handle to the dispatch record. The dispatch record is an internal data structure whose fields, referred to as hook fields or hooks, contain the <A NAME=MARKER-9-101></A>addresses of routines that TextEdit uses internally, for example, to measure and draw text, or to determine a character's position on a line. These routines, called hook routines, determine the way TextEdit behaves. You can use a TextEdit customization routine to replace the address of a default hook routine with the address of your own customized routine. For example, you can provide a routine to be used for word selection that defines word boundaries more precisely for any script system<A NAME=MARKER-2-978></A>.<P>
 When you allocate a monostyled edit record, the edit record, a handle to the text, and a single subsidiary internal data <A NAME=MARKER-2-31></A>structure, the dispatch record, are created. However, when you allocate a multistyled edit record, a number of additional subsidiary data structures are created to support the text styling capabilities and the display of text in multiple languages.<P>
 For a multistyled edit record, the edit record contains a handle to the style record. The style record<B> </B>stores the character attribute information for the text, and <A NAME=MARKER-9-247></A>contains a handl<A NAME=MARKER-2-231></A>e to the style table, which has one entry for each distinct set of character attributes. Each entry in the style table is a <A NAME=MARKER-2-137></A>style element record. The style record also contains a style run table, which is an array that gives the start of each style run, and an index into the style table. The style run table array identifies the byte offset of the starting character to which the character attributes, stored in the style table, apply.<A NAME=MARKER-2-195></A><P>
 The style record contains two other handles: a handle to the line-height table and a handle to the null style record. The line-height table provides vertical spacing and line ascent information for the text to be edited with one element for each line of an edit record. A line number is a direct index into this array. The <A NAME=MARKER-2-334></A>null style record consists of a reserved field and a handle to the style scrap record.<P>
 The style scrap record, which is part of the null scrap, stores character attribute information <A NAME=MARKER-2-354></A>associated with a null selection to be applied to inserted text. It also holds character attribute information associated with a selected range of multistyled text when the character attributes are to be copied, or the text and its attributes are to be cut <BR>or copied.<P>
 Part of the style scrap record is the <A NAME=MARKER-2-362></A>scrap style table which <A NAME=MARKER-2-150></A>has a separate element for each style run in the style scrap record. The character attribute information for each of these elements is stored in a scrap style <A NAME=MARKER-2-942></A>element record.<P>
 Several TextEdit routines use a text style record <A NAME=MARKER-2-53></A>to pass character attribute information between the application and the routine.<P>
 <A HREF=#MARKER-9-135>Figure 2-7</A> shows the two data structures that TextEdit creates for monostyled text. <A HREF=#MARKER-9-138>Figure 2-8</A> shows the data structures that TextEdit creates for multistyled text and <BR>how they are related; these data structures consist of the two records that TextEdit <BR>also creates for monostyled text plus additional structures needed to store character attribute information. See <A HREF=Text-57.html#MARKER-9-371>Figure 2-15 on page 2-61</A> for a version of the data structures including fields.<P>
<B>Figure 2-7  <A NAME=MARKER-9-135></A>Relationship between the TextEdit data structures for monostyled text</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TE_L-35.jpg"><br><br>
<A NAME=MARKER-2-358></A><B>Figure 2-8  Relationship<A NAME=MARKER-2-73></A>s among <A NAME=MARKER-9-138></A>the TextEdit data structures for multistyled text</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TE_L-32.jpg">
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
