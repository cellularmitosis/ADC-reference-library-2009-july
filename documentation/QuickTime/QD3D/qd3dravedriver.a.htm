<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Using a Draw Context as a Cache</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=43341"> </A><A NAME="15321"> </A>Using a Draw Context as a Cache</H1><P CLASS="T1.Text1"><A NAME="pgfId=43342"> </A><A NAME="marker=51456"> </A>QuickDraw&nbsp;3D RAVE supports draw context caching, a technique that allows you to improve rendering performance when a large number of the objects in a scene don't change from frame to frame. A <B CLASS="bold">draw context cache</B> is simply a draw context that contains an image and is designated as the initial context in a call to <TT CLASS="cv">QARenderStart</TT>. The contents of that context are drawn into the destination draw context before any other objects.</P><P CLASS="T1.Text1"><A NAME="pgfId=43365"> </A>To create a draw context cache, you first create a draw context by calling the <TT CLASS="cv">QADrawContextNew</TT> function, where the <TT CLASS="cv">flags</TT> parameter has the <TT CLASS="cv">QAContext_Cache</TT> flag set. Then you draw the unchanging objects into the draw context cache. For example, suppose that you want to draw a series of frames in which two triangles remain constant from frame to frame but a third triangle changes every frame. <A HREF="qd3dravedriver.a.htm#20149" CLASS="XRef">Listing&nbsp;9</A> shows how to do this.</P><P CLASS="L.Listing"><A NAME="pgfId=43406"> </A>Listing&nbsp;9<A NAME="20149"> </A>Creating and using a draw context cache</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=63992"> </A>TQAVGouraud&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tri1[3], tri2[3], tri3[3];<BR>TQADrawContext&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*myCache, *myDest;<BR><BR>/*Create draw context cache and destination draw context.*/<BR>QADrawContextNew(myDev, rect, NULL, myEng, QAContext_Cache, &amp;myCache);<BR>QADrawContextNew(myDev, rect, NULL, myEng, QAContext_DoubleBuffer, &amp;myDest);<BR><BR>/*Set up the image in the cache context.*/<BR>QARenderStart(myCache, NULL, NULL);<BR>QADrawTriGouraud(myCache, &amp;tri1[0], &amp;tri1[1], &amp;tri1[2], kQATriFlags_None);<BR>QADrawTriGouraud(myCache, &amp;tri2[0], &amp;tri2[1], &amp;tri2[2], kQATriFlags_None);<BR>QARenderEnd(myCache, NULL);<BR><BR>/*Render frames using the cache and moving tri3 only.*/<BR>while (gStillMovingTriangle3) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyMoveTri(tri3);<BR>&nbsp;&nbsp;&nbsp;&nbsp;QARenderStart(myDest, NULL, myCache);<BR>&nbsp;&nbsp;&nbsp;&nbsp;QADrawTriGouraud(myDest, &amp;tri3[0], &amp;tri3[1], &amp;tri3[2], kQATriFlags_None);<BR>&nbsp;&nbsp;&nbsp;&nbsp;QARenderEnd(myDest, NULL);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=43321"> </A>Not all drawing engines support draw context caching. If a drawing engine does not support caching, it should return the value <TT CLASS="cv">NULL</TT> whenever you pass the <TT CLASS="cv">QAContext_Cache</TT> flag to <TT CLASS="cv">QADrawContextNew</TT>.</P><P CLASS="I.Important"><A NAME="pgfId=60446"> </A>All draw context caches must be single buffered, and they must be created using the same device and rectangle as the destination draw contexts with which they will be used. </P><P CLASS="T1.Text1"><A NAME="pgfId=60451"> </A>Once you've created a draw context cache (by setting the <TT CLASS="cv">QAContext_Cache</TT> flag when calling <TT CLASS="cv">QADrawContextNew</TT>), you cannot use that draw context as a non-cached draw context. Objects rendered into a draw context cache never appear on a device (not even on a memory device). The only way to view objects rendered into a draw context cache is to use that cache to initialize a non-cached draw context, as illustrated in <A HREF="qd3dravedriver.a.htm#20149" CLASS="XRef">Listing&nbsp;9</A>. You can, however, use a draw context cache to initialize another draw context cache. Moreover, you can initialize a draw context cache with itself in order to add more objects to an existing draw context cache.<A NAME="marker=60456"> </A></P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>