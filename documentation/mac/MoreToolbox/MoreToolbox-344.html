<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Defining a Component's Interfaces (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING344></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-343.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-345.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-333.html"><B>Chapter 6 - Component Manager</B></A> / <A HREF="MoreToolbox-341.html"><B>Creating Components</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING344-0></A>
<H2><A NAME=MARKER-9-112></A>Defining a Component's Interfaces</H2>
 <A NAME=MARKER-2-113></A>You define the interfaces supported by your component by declaring a set of functions for use by applications. These function declarations specify the parameters that must be provided for each request. The following code illustrates the general form of these function declarations, using the setup request defined for the sample drawing component as an example:<P>
<PRE>
FUNCTION DrawerSetup (myInstance: ComponentInstance; 
                      VAR r: Rect): ComponentResult;
</PRE>
 This example declares a function that supports the setup request. The first parameter to any component function must be a parameter that accepts a component instance. The Component Manager uses this value to correctly route the request. The calling application must supply a valid component instance when it calls your component. The second and following parameters are those required by your component function. For example, the <CODE>DrawerSetup</CODE> function takes one additional parameter, a rectangle. Finally, all component functions must return a function result of type <CODE>ComponentResult</CODE> (a long integer). <P>
 These function declarations must also include inline code. This code identifies the request code assigned to the function, specifies the number of bytes of parameter data accepted by the function, and executes a trap to the Component Manager. To continue with the Pascal example used earlier, the inline code for the <CODE>DrawerSetup</CODE> function is<A NAME=MARKER-9-228></A><P>
<PRE>
INLINE $2F3C, $0004, $0000, $7000, $A82A;
</PRE>
 The first element of this code, <CODE>$2F3C</CODE>, is the opcode for a move instruction that loads the contents of the next two elements onto the stack. The Component Manager uses these values when it invokes your component.<P>
 The second element, <CODE>$0004</CODE>, defines an integer value that specifies the number of bytes of parameter data required by the function, not including the component instance parameter. In this case, the size of a pointer to the rectangle is specified: 4 bytes.<P>
<DL>
<DT><B>Note</B>
<DD>Note that Pascal calling conventions require that Boolean and 1-byte parameters are passed as 16-bit integer values.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The third element, <CODE>$0000</CODE>, specifies the request code for this function as an integer value. Each function supported by your component must have a unique request code. Your component uses this request code to identify the application's request. You may define only request code values greater than or equal to 0; negative values are reserved for definition by the Component Manager. Recall from the oval drawing component that the request code for the setup request, <CODE>kDrawerSetUpSelect</CODE>, has a value of 0. <P>
 The fourth element, <CODE>$7000</CODE>, is the opcode for an instruction that sets the D0 register to 0, which tells the Component Manager to call your component rather than to field the request itself.<P>
 The fifth element, <CODE>$A82A</CODE>, is the opcode for an instruction that executes a trap to the Component Manager.<P>
 If you are declaring functions for use by Pascal-language applications, your declarations should take the following form:<P>
<PRE>
FUNCTION DrawerSetup (myInstance: ComponentInstance; 
                      VAR r: Rect): ComponentResult;
INLINE $2F3C, $0004, $0000, $7000, $A82A;
</PRE>
 If you are declaring functions for use by C-language applications, your declarations can take the following form:<P>
<PRE>
pascal ComponentResult DrawerSetup 
                     (ComponentInstance myInstance, Rect *r) = 
                           {0x2F3C,0x4,0x0,0x7000,0xA82A}; 
</PRE>
 Alternatively, you can define the following statement to replace the inline code:<P>
<PRE>
#define ComponentCall (callNum, paramSize) 
                      {0x2F3C,paramSize,callNum,0x7000,0xA82A}
</PRE>
 Using this statement results in the following declaration format:<P>
<PRE>
pascal ComponentResult DrawerSetup 
                  (ComponentInstance myInstance, Rect *r) = 
                   ComponentCall (kDrawerSetUpSelect, 4);
</PRE>
 When a client application calls your function, the system executes the inline code, which invokes the Component Manager. The Component Manager then formats a component parameters record, locates the storage for the current connection, and invokes your component. The Component Manager provides the component parameters record and a handle to the storage of the current connection to your component as function parameters.<A NAME=MARKER-2-115></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-343.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-345.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
