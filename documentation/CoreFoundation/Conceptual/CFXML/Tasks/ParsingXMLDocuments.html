<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>XML Programming Topics for Core Foundation: Parsing XML Documents</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Parsing XML Documents"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001232" title="Parsing XML Documents"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000421" target="_top">Core Foundation</a> &gt; <a href="../../../DataManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000421-TP30000445" target="_top">Data Management</a> &gt; <a href="../index.html" target="_top">XML Programming Topics for Core Foundation</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Concepts/CFXMLParser.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20001232-CJBEHAAG" title="Parsing XML Documents"></a><hr /><H1>Parsing XML Documents</H1><p>The document shown in <span class="content_text">Listing 1</span> contains the XML representation of a very simple Core Foundation property list created using <code>CFPropertyList</code>. Note that a property list was chosen purely for the purposes of illustrating XML parser usage in a Core Foundation context. <code>CFPropertyList</code> has convenience functions for converting property lists to and from XML format, so in most cases your application would not need to parse an XML property list using the XML parser directly (see <em><a href="../../CFPropertyLists/index.html#//apple_ref/doc/uid/10000130i" target="_top">Property List Programming Topics for Core Foundation</a></em> for more information).</p><a name="//apple_ref/doc/uid/20001232-100971-BAJHDCJD" title="Listing 1A Core Foundation property list in XML format"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-100971" title="Listing 1A Core Foundation property list in XML format"></a><strong>Listing 1&nbsp;&nbsp;</strong>A Core Foundation property list in XML format</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE plist SYSTEM "file://localhost/System/Library/DTDs/PropertyList.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;plist version="0.9"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Jane Doe&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;integer>1999&lt;/integer><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>John Doe&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;integer>2000&lt;/integer><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/plist><span></span></pre></td></tr></table></div><p>In this example XML document, the data consists of two names and associated birth years. The <code>&lt;plist></code> tag declares that the enclosed data is a property list that corresponds to the Core Foundation data type <code>CFPropertyList</code>. The <code>&lt;dict></code> tag declares that its enclosed data corresponds to a CFDictionary. Finally, the name and birth year data are listed in the key/value pair format required for a <code>CFDictionary</code> object. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ParsingXMLDocuments.html#//apple_ref/doc/uid/20001232-101077-CJBCHJFA">Using the Tree-Based Parser Interface</a>
				
			<br/>
			
        
			
			
				<a href="ParsingXMLDocuments.html#//apple_ref/doc/uid/20001232-101323-CJBJICFJ">Using the Event-Driven Parser Interface</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001232-101077" title="Using the Tree-Based Parser Interface"></a><a name="//apple_ref/doc/uid/20001232-101077-CJBCHJFA" title="Using the Tree-Based Parser Interface"></a><h2>Using the Tree-Based Parser Interface</h2><p><span class="content_text">Listing 2</span> shows how you would use the high level XML API to convert the sample XML data in <span class="content_text"><a href="ParsingXMLDocuments.html#//apple_ref/doc/uid/20001232-100971-BAJHDCJD">Listing 1</a></span> into a <code>CFXMLTree</code> object. This example assumes that <code>sourceURL</code> is a valid <code>CFURL</code> object and refers to the XML document. </p><a name="//apple_ref/doc/uid/20001232-101102-BCIDEIJE" title="Listing 2Using the tree-based parser API"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101102" title="Listing 2Using the tree-based parser API"></a><strong>Listing 2&nbsp;&nbsp;</strong>Using the tree-based parser API</p><div class="codesample"><table><tr><td scope="row"><pre>CFXMLTreeRef    cfXMLTree;<span></span></pre></td></tr><tr><td scope="row"><pre>CFDataRef       xmlData;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Load the XML data using its URL.<span></span></pre></td></tr><tr><td scope="row"><pre>CFURLCreateDataAndPropertiesFromResource(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                sourceURL, &amp;xmlData, NULL, NULL, NULL)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Parse the XML and get the CFXMLTree.<span></span></pre></td></tr><tr><td scope="row"><pre>cfXMLTree = CFXMLTreeCreateFromData(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                    xmlData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    sourceURL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kCFXMLParserSkipWhitespace,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kCFXMLNodeCurrentVersion);<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 1</span> illustrates the structure of the <code>CFXMLTree</code> object produced by the code in <span class="content_text"><a href="ParsingXMLDocuments.html#//apple_ref/doc/uid/20001232-101102-BCIDEIJE">Listing 2</a></span>. As you would expect, it exactly reflects the structure of the original XML document. The diagram displays the data type code and data string from each <code>CFXMLNode</code> object.</p><br/><div><a name="//apple_ref/doc/uid/20001232-101193-BAJGFIBB" title="Figure 1The structure of a CFXMLTree"></a><p><a name="//apple_ref/doc/uid/20001232-101193" title="Figure 1The structure of a CFXMLTree"></a><strong>Figure 1&nbsp;&nbsp;</strong>The structure of a CFXMLTree</p><img src = "Art/crxml_tree.gif" alt = "The structure of a CFXMLTree" width="408" height="467"></div><br/><p>The example in <span class="content_text">Listing 3</span> shows how to use some of the XML convenience functions to examine the top level of a <code>CFXMLTree</code> object and print out each node’s data string contents.</p><a name="//apple_ref/doc/uid/20001232-101215-BAJIDJFE" title="Listing 3Obtaining information from a CFXMLTree"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101215" title="Listing 3Obtaining information from a CFXMLTree"></a><strong>Listing 3&nbsp;&nbsp;</strong>Obtaining information from a CFXMLTree</p><div class="codesample"><table><tr><td scope="row"><pre>CFXMLTreeRef    xmlTreeNode;<span></span></pre></td></tr><tr><td scope="row"><pre>CFXMLNodeRef    xmlNode;<span></span></pre></td></tr><tr><td scope="row"><pre>int             childCount;<span></span></pre></td></tr><tr><td scope="row"><pre>int             index;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Get a count of the top level node’s children.<span></span></pre></td></tr><tr><td scope="row"><pre>childCount = CFTreeGetChildCount(cfXMLTree);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Print the data string for each top-level node.<span></span></pre></td></tr><tr><td scope="row"><pre>for (index = 0; index &lt; childCount; index++) {<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlTreeNode = CFTreeGetChildAtIndex(cfXMLTree, index);<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlNode = CFXMLTreeGetNode(xmlTreeNode);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFShow(CFXMLNodeGetString(xmlNode));<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/20001232-101323" title="Using the Event-Driven Parser Interface"></a><a name="//apple_ref/doc/uid/20001232-101323-CJBJICFJ" title="Using the Event-Driven Parser Interface"></a><h2>Using the Event-Driven Parser Interface</h2><p>The event-driven parser API gives you complete flexibility to do whatever you wish with the data in an XML document. To use the event-driven parser API, you define a set of callback functions that the parser invokes as it encounters specific structures in the XML document. The code in this section shows how to use the event-driven parser to print the data in an XML document. A sample implementation for each callback function is shown, and then the code to create and run the parser.</p><p>The code in <span class="content_text">Listing 4</span> implements the first—and by far the longest—callback function, <code>CFXMLParserCreateXMLStructureCallBack</code>. This example implementation prints the contents of each new XML structure’s additional information data as it is encountered.</p><a name="//apple_ref/doc/uid/20001232-101349-BAJDAIJF" title="Listing 4Implementing the CFXMLParserCreateXMLStructureCallBack function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101349" title="Listing 4Implementing the CFXMLParserCreateXMLStructureCallBack function"></a><strong>Listing 4&nbsp;&nbsp;</strong>Implementing the CFXMLParserCreateXMLStructureCallBack function</p><div class="codesample"><table><tr><td scope="row"><pre>void *createStructure(CFXMLParserRef parser,<span></span></pre></td></tr><tr><td scope="row"><pre>            CFXMLNodeRef node, void *info) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef myTypeStr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef myDataStr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFXMLDocumentInfo *docInfoPtr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Use the dataTypeID to determine what to print.<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (CFXMLNodeGetTypeCode(node)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeDocument:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeDocument\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            docInfoPtr = CFXMLNodeGetInfoPtr(node);<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        CFSTR("Document URL: %@\n"),<span></span></pre></td></tr><tr><td scope="row"><pre>                        CFURLGetString(docInfoPtr->sourceURL));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeElement:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeElement\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Element: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeProcessingInstruction:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID:<span></span></pre></td></tr><tr><td scope="row"><pre>                    kCFXMLNodeTypeProcessingInstruction\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("PI: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeComment:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeComment\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Comment: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeText:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeText\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Text:%@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeCDATASection:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: k<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFXMLDataTypeCDATASection\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("CDATA: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeEntityReference:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID:<span></span></pre></td></tr><tr><td scope="row"><pre>                    kCFXMLNodeTypeEntityReference\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Entity reference: %@\n"),<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeDocumentType:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeDocumentType\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("DTD: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kCFXMLNodeTypeWhitespace:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: kCFXMLNodeTypeWhitespace\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFStringCreateWithFormat(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Whitespace: %@\n"), CFXMLNodeGetString(node));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            myTypeStr = CFSTR("Data Type ID: UNKNOWN\n");<span></span></pre></td></tr><tr><td scope="row"><pre>            myDataStr = CFSTR("Unknown type.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Print the contents.<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("---Create Structure Called--- \n");<span></span></pre></td></tr><tr><td scope="row"><pre>    CFShow(myTypeStr);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFShow(myDataStr);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Return the data string for use by the addChild and<span></span></pre></td></tr><tr><td scope="row"><pre>    // endStructure callbacks.<span></span></pre></td></tr><tr><td scope="row"><pre>    return myDataStr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Notice that the <code>CFXMLParserCreateXMLStructureCallBack</code> function returns the data string created using the <code>dataString</code> field of the newly encountered structure. This return value can actually be anything, but is kept by the parser and passed back to you by both the <code>CFXMLParserAddChildCallBack</code> and <code>CFXMLParserEndXMLStructureCallBack</code> functions described below. Note that if your <code>CFXMLParserCreateXMLStructureCallBack</code> function returns <code>NULL</code>, <code>CFXMLParserAddChildCallBack</code> and <code>CFXMLParserEndXMLStructureCallBack</code> will <em>not</em> be called. The only exception is <code>CFNodeTypeDocument</code>; <code>CFXMLParserEndXMLStructureCallBack</code> will be called for it even if you return <code>NULL</code> from <code>CFXMLParserCreateXMLStructureCallBack</code>.</p><p>The parser invokes the <code>CFXMLParserAddChildCallBack</code> when it encounters a child of the most recently parsed structure. In this example, the <code>CFXMLParserAddChildCallBack</code> callback shown in <span class="content_text">Listing 5</span> simply prints out both of the strings to make clear the parent–child relationships of the XML structures being parsed.</p><a name="//apple_ref/doc/uid/20001232-101821-BCICFDHC" title="Listing 5Implementing the CFXMLParserAddChildCallBack function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101821" title="Listing 5Implementing the CFXMLParserAddChildCallBack function"></a><strong>Listing 5&nbsp;&nbsp;</strong>Implementing the CFXMLParserAddChildCallBack function</p><div class="codesample"><table><tr><td scope="row"><pre>void addChild(CFXMLParserRef parser, void *parent, void *child, void *info) {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("---Add Child Called--- \n");<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("Parent being added to: "); CFShow((CFStringRef)parent);<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("Child being added: "); CFShow((CFStringRef)child);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The parser calls the <code>CFXMLParserEndXMLStructureCallBack</code> function, implemented in <span class="content_text">Listing 6</span>, when it moves beyond a given structure. The <code>xmlType</code> parameter is a pointer to whatever data the <code>CFXMLParserCreateXMLStructureCallBack</code> function returned when the structure’s open tag was first encountered. In this example implementation, the callback prints out a string indicating which structure has ended.</p><a name="//apple_ref/doc/uid/20001232-101890-BCIBBIFA" title="Listing 6Implementing the endStructure callback"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101890" title="Listing 6Implementing the endStructure callback"></a><strong>Listing 6&nbsp;&nbsp;</strong>Implementing the endStructure callback</p><div class="codesample"><table><tr><td scope="row"><pre>void endStructure(CFXMLParserRef parser, void *xmlType, void *info) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Leave evidence that we were called.<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("---End Structure Called for \n"); CFShow((CFStringRef)xmlType);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Now that the structure and all of its children have been parsed,<span></span></pre></td></tr><tr><td scope="row"><pre>    // we can release the string.<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(xmlType);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The parser calls the <code>CFXMLParserResolveExternalEntityCallBack</code> function when it encounters an external entity reference. The example XML data in this section contains no entity references so this callback is not invoked. <span class="content_text">Listing 7</span> shows a minimal implementation.</p><a name="//apple_ref/doc/uid/20001232-101961-BCIECAHB" title="Listing 7Implementing the CFXMLParserResolveExternalEntityCallBack function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-101961" title="Listing 7Implementing the CFXMLParserResolveExternalEntityCallBack function"></a><strong>Listing 7&nbsp;&nbsp;</strong>Implementing the CFXMLParserResolveExternalEntityCallBack function</p><div class="codesample"><table><tr><td scope="row"><pre>CFDataRef resolveEntity(CFXMLParserRef parser, CFStringRef publicID,<span></span></pre></td></tr><tr><td scope="row"><pre>        CFURLRef systemID, void *info) {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("---resolveEntity Called---\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The parser calls the <code>CFXMLParserHandleErrorCallBack</code> callback when it encounters an error condition. As shown in <span class="content_text">Listing 8</span>, you can use the XML API to get both the error string and error location information from the parser. If you return <code>false</code> from this callback, the parser aborts. If you return <code>true</code> and the error is nonfatal, the parser continues processing.</p><a name="//apple_ref/doc/uid/20001232-102025-BCICJDBC" title="Listing 8Implementing the handleError CFXMLParserHandleErrorCallBack function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-102025" title="Listing 8Implementing the handleError CFXMLParserHandleErrorCallBack function"></a><strong>Listing 8&nbsp;&nbsp;</strong>Implementing the handleError CFXMLParserHandleErrorCallBack function</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean handleError(CFXMLParserRef parser, SInt32 error, void *info) {<span></span></pre></td></tr><tr><td scope="row"><pre>    char buf[512], *s;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the error description string from the Parser.<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef description = CFXMLParserCopyErrorDescription(parser);<span></span></pre></td></tr><tr><td scope="row"><pre>    s = (char *)CFStringGetCStringPtr(description,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFStringGetSystemEncoding());<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // If the string pointer is unavailable, do some extra work.<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!s) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFStringGetCString(description, buf, 512,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFStringGetSystemEncoding());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(description);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Report the exact location of the error.<span></span></pre></td></tr><tr><td scope="row"><pre>    fprintf(stderr, "Parse error (%d) %s on line %d, character %d\n",<span></span></pre></td></tr><tr><td scope="row"><pre>                    (int)error,<span></span></pre></td></tr><tr><td scope="row"><pre>                    s,<span></span></pre></td></tr><tr><td scope="row"><pre>                    (int)CFXMLParserGetLineNumber(parser),<span></span></pre></td></tr><tr><td scope="row"><pre>                    (int)CFXMLParserGetLocation(parser));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 9</span> demonstrates how to create and invoke the parser. </p><a name="//apple_ref/doc/uid/20001232-102172-BCIDGEAH" title="Listing 9Creating and invoking the XML parser"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-102172" title="Listing 9Creating and invoking the XML parser"></a><strong>Listing 9&nbsp;&nbsp;</strong>Creating and invoking the XML parser</p><div class="codesample"><table><tr><td scope="row"><pre>// First, set up the parser callbacks.<span></span></pre></td></tr><tr><td scope="row"><pre>CFXMLParserCallBacks callbacks = {0, createStructure, addChild, endStructure, resolveEntity, handleError};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create the parser with the option to skip whitespace.<span></span></pre></td></tr><tr><td scope="row"><pre>parser = CFXMLParserCreate(kCFAllocatorDefault, xmlData, urlOut, kCFXMLParserSkipWhitespace, kCFXMLNodeCurrentVersion, &amp;callbacks, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Invoke the parser.<span></span></pre></td></tr><tr><td scope="row"><pre>if (!CFXMLParserParse(parser)) {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("parse failed\n");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>As you can see, once the callbacks have been implemented, the code to create and call the parser is quite simple. <code>“Parser output”</code> shows the output generated by the code in <code><a href="ParsingXMLDocuments.html#//apple_ref/doc/uid/20001232-102172-BCIDGEAH">“Creating and invoking the XML parser”</a></code>.</p><a name="//apple_ref/doc/uid/20001232-102248-BAJEBJCG" title="Listing 10Parser output"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001232-102248" title="Listing 10Parser output"></a><strong>Listing 10&nbsp;&nbsp;</strong>Parser output</p><div class="codesample"><table><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeDocument, Document: file://localhost/myPlist.xml<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeProcessingInstruction, PI: xml<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Document: file://localhost/myPlist.xml<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: PI: xml<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for PI: xml<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeDocumentType, DTD<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Document: file://localhost/myPlist.xml<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: DTD<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for DTD<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: plist<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Document: file://localhost/myPlist.xml<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: plist<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: plist<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeText, Text: Jane Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Text: Jane Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Text: Jane Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeText, Text: 1999<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Text: 1999<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Text: 1999<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeText, Text: John Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Text: John Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called Text: John Doe<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: key<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeElement, Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---Create Structure Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Data Type ID: kCFXMLNodeTypeText, Text: 2000<span></span></pre></td></tr><tr><td scope="row"><pre>---Add Child Called---<span></span></pre></td></tr><tr><td scope="row"><pre>    Parent being added to: Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>    Child being added: Text: 2000<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Text: 2000<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: integer<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: dict<span></span></pre></td></tr><tr><td scope="row"><pre>---End Structure Called for Element: plist<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Concepts/CFXMLParser.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/CoreFoundation/Conceptual/CFXML/Tasks/ParsingXMLDocuments.html%3Fid%3D10000138i-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/CoreFoundation/Conceptual/CFXML/Tasks/ParsingXMLDocuments.html%3Fid%3D10000138i-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/CoreFoundation/Conceptual/CFXML/Tasks/ParsingXMLDocuments.html%3Fid%3D10000138i-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
