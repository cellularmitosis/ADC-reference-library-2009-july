<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of DDP(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING203></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-202.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-204.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-179.html"><B>Chapter 7 - Datagram Delivery Protocol (DDP)</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING203-0></A>
<H1>Summary of DDP</H1>
<A NAME=HEADING203-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING203-2></A>
<H3>Constants</H3>
<PRE>
CONST
   {.MPP driver unit and reference numbers}
   mppUnitNum     =        9;                {MPP unit number}
   mppRefNum      =      -10;                {MPP reference number}
   
   {csCodes}
   writeDDP       =      246;                {write out DDP packet, csCode}
   closeSkt       =      247;                {close DDP socket, csCode}
   openSkt        =      248;                {open DDP socket, csCode}
</PRE>
<A NAME=HEADING203-4></A>
<H3>Data Types</H3>
<A NAME=HEADING203-5></A>
<H4>The Write-Data Structure</H4>
<PRE>
TYPE  WDSElement = 
   RECORD
      entryLength:   Integer;
      entryPtr:      Ptr;
   END;
</PRE>
<A NAME=HEADING203-7></A>
<H4>The Address Block Record</H4>
<PRE>
TYPE AddrBlock = 
   PACKED RECORD
      aNet:          Integer;    {network number}
      aNode:         Byte;       {node ID}
      aSocket:       Byte;       {socket number}
   END;
</PRE>
<A NAME=HEADING203-9></A>
<H4>MPP Parameter Block</H4>
<PRE>
MPPParmType = (...OpenSktParm,CloseSktParm,WriteDDPParm ...)
TYPE MPPParamBlock = 
   PACKED RECORD
      qLink:               QElemPtr;   {reserved}
      qType:               Integer;    {reserved}
      ioTrap:              Integer;    {reserved}
      ioCmdAddr:           Ptr;        {reserved}
      ioCompletion:        ProcPtr;    {completion routine}
      ioResult:            OSErr;      {result code}
      ioNamePtr:           StringPtr;  {reserved}
      ioVRefNum:           Integer;    {reserved}
      ioRefNum:            Integer;    {driver reference number}
      csCode:              Integer;    {command code}
      CASE MPPParmType OF
         OpenSktParm,
         CloseSktParm,
         WriteDDPParm:
         (
            socket:        Byte;       {socket number}
            checksumFlag:  Byte;       {checksum flag}
            listener:      Ptr;        {For POpenSkt, pointer to socket }
                                       { listener routine. For PWriteDDP, }
                                       { pointer to write-data structure.}
         )
   END;
MPPPBPtr = ^MPPParamBlock;
</PRE>
<A NAME=HEADING203-13></A>
<H3>Routines</H3>
<A NAME=HEADING203-14></A>
<H4>Opening and Closing DDP Sockets</H4>
<PRE>
FUNCTION POpenSkt(thePBptr: MPPPBPtr; async: Boolean): OSErr;
FUNCTION PCloseSkt (thePBptr: MPPPBPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING203-17></A>
<H4>Sending DDP Datagrams</H4>
<PRE>
FUNCTION PWriteDDP (thePBptr: MPPPBPtr; async: Boolean): OSErr;
PROCEDURE BuildDDPwds (wdsPtr,headerPtr,dataPtr: Ptr; 
destAddress: AddrBlock; DDPType: Integer; 
dataLen: Integer);
</PRE>
<A NAME=HEADING203-20></A>
<H2>C Summary</H2>
<A NAME=HEADING203-21></A>
<H3>Constants</H3>
<PRE>
/*DDP parameter constants*/
#define MPPioCompletion MPP.ioCompletion
#define MPPioResult MPP.ioResult
#define MPPioRefNum MPP.ioRefNum
#define MPPcsCode MPP.csCode
#define DDPsocket DDP.socket
#define DDPchecksumFlag DDP.checksumFlag
#define DDPwdsPointer DDP.DDPptrs.wdsPointer
#define DDPlistener DDP.DDPptrs.listener
/*.MPP driver unit and reference number*/
enum { 
   mppUnitNum     =        9,          /*MPP unit number*/
   mppRefNum      =      -10           /*MPP reference number*/
};

/*DDP csCodes*/
enum {
   writeDDP       =        246,        /*send DDP packet*/
   closeSkt       =        247,        /*close DDP socket*/
   openSkt        =        248         /*open DDP socket*/
};
</PRE>
<A NAME=HEADING203-24></A>
<H3>Data Types</H3>
<A NAME=HEADING203-25></A>
<H4>The Write-Data Structure</H4>
<PRE>
struct   WDSElement { 
   short    entryLength;
   Ptr      entryPtr;
} WDSElement;
</PRE>
<A NAME=HEADING203-27></A>
<H4>The Address Block Record</H4>
<PRE>
struct AddrBlock { 
      short                aNet;                /*network number*/
      unsigned char        aNode;               /*node ID*/
      unsigned char        aSocket;             /*socket number*/
};

typedef struct AddrBlock AddrBlock;
</PRE>
<A NAME=HEADING203-29></A>
<H4>MPP Parameter Block </H4>
<PRE>
#define MPPATPHeader\ 
   QElem          *qLink;        /*reserved*/\
   short          qType;         /*reserved*/\
   short          ioTrap;        /*reserved */\
   Ptr            ioCmdAddr;     /*reserved*/\
   ProcPtr        ioCompletion;  /*completion routine*/\
   OSErr          ioResult;      /*result code*/\
   long           ioNameptr;     /*command result (ATP user bytes)*/\
   short          ioVRefNum;     /*request transaction ID*/\
   short          ioRefNum;      /*driver reference number*/\
   short          csCode;        /*command code*/

typedef struct {
   MPPATPHeader 
}MPPparms;

union ParamBlockRec {
   MPPparms    MPP;              /*general MPP parms*/
   DDPparms    DDP;              /*DDP calls*/
};
typedef MPPParamBlock   *MPPPBtr;

typedef struct {
MPPATPHeader 
   char socket;                  /*socket number*/
   char checksumFlag;            /*checksum flag*/
   union {
   Ptr wdsPointer;               /*pointer to write-data structure*/
   Ptr listener;                 /*pointer to write-data structure or */
                                 /* pointer to socket listener*/
} DDPptrs;
}DDPparms;
</PRE>
<A NAME=HEADING203-31></A>
<H3>Routines</H3>
<A NAME=HEADING203-32></A>
<H4>Opening and Closing DDP Sockets</H4>
<PRE>
pascal OSErr POpenSkt (MPPPBPtr the PBptr, Boolean async);
pascal OSErr PCloseSkt (MPPPBPtr thePBptr, Boolean async); 
</PRE>
<A NAME=HEADING203-35></A>
<H4>Sending DDP Datagrams</H4>
<PRE>
pascal OSErr PWriteDDP (MPPPBPtr the PBptr, Boolean async);
pascal void BuildDDPwds(Ptr wdsPtr, header Ptr, Ptr dataPtr, 
const AddrBlock netAddr, short ddpType, 
short dataLen); 
</PRE>
<A NAME=HEADING203-38></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING203-39></A>
<H3>Constants</H3>
<PRE>
mppUnitNum     EQU      9        ;MPP unit number
;csCodes for DDP
writeDDP       EQU      246      ;write out DDP packet
closeSkt       EQU      247      ;close DDP socket
openSkt        EQU      248      ;open DDP socket
;long DDP packet header
ddpHopCnt      EQU      0        ;hop count (byte)
ddpLength      EQU      0        ;packet length (word)
ddpChecksum    EQU      2        ;checksum (word)
ddpDstNet      EQU      4        ;destination network number (word)
ddpSrcNet      EQU      6        ;source network number (word)
ddpDstNode     EQU      8        ;destination node address (byte)
ddpSrcNode     EQU      9        ;source node address (byte)
ddpDstSkt      EQU      10       ;destination socket number (byte)
ddpSrcSkt      EQU      11       ;source socket number (byte)
ddpType        EQU      12       ;DDP protocol type field (byte)
;short DDP packet header
sddpDstSkt     EQU      2        ;destination socket number (byte)
sddpSrcSkt     EQU      3        ;source socket number (byte)
sddpType       EQU      4        ;DDP protocol type field (byte)
;DDP long header size
ddphSzLong     EQU      13       ;size of extended DDP header

DDP short header size
ddphSzShort    EQU      5        ;size of short DDP header

shortDDP       EQU      $01      ;LAP type code for DDP (short header)
longDDP        EQU      $02      ;LAP type code for DDP (long header)
;DDP miscellaneous
ddpMaxWKS      EQU      $7F      ;highest valid well-known socket
ddpMaxData     EQU      586      ;maximum DDP data size
ddpLenMask     EQU      $03FF    ;mask for DDP length
rhaSize        EQU      $18      ;size of read-header area
toRHA          EQU      1        ;top of the read-header area
wdsEntrySz     EQU      6        ;size of a write-data structure entry
DDPHopsMask    EQU      $3C00    ;mask hop count bits from field in DDP
                                 ; header
;command codes (csCodes)
writeDDP       EQU      246      ;write out DDP packet
closeSkt       EQU      247      ;close DDP socket
openSkt        EQU      248      ;open DDP socket
</PRE>
<A NAME=HEADING203-48></A>
<H3>Data Structures</H3>
<A NAME=HEADING203-49></A>
<H4>MPP Parameter Block Common Fields for DDP Routines
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>qLink<TD>long<TD>reserved<TR>
<TD>4<TD>qType<TD>word<TD>reserved<TR>
<TD>6<TD>ioTrap<TD>word<TD>reserved<TR>
<TD>8<TD>ioCmdAddr<TD>long<TD>reserved<TR>
<TD>12<TD>ioCompletion<TD>long<TD>address of completion routine<TR>
<TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>18<TD>ioNamePtr<TD>long<TD>reserved<TR>
<TD>22<TD>ioVRefNum<TD>word<TD>reserved<TR>
<TD>24<TD>ioRefNum<TD>word<TD>driver reference number</TABLE>
</H4>
<A NAME=HEADING203-50></A>
<H4>OpenSkt 
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>openSkt</CODE><TR>
<TD>28<TD>socket<TD>byte<TD>socket number<TR>
<TD>30<TD>listener<TD>long<TD>pointer to socket listener</TABLE>
Parameter Variant</H4>
<A NAME=HEADING203-51></A>
<H4>CloseSkt
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>closeSkt</CODE><TR>
<TD>28<TD>socket<TD>byte<TD>number of socket to be closed</TABLE>
 Parameter Variant</H4>
<A NAME=HEADING203-52></A>
<H4>WriteDDP
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>command code; always <CODE>writeDDP</CODE><TR>
<TD>28<TD>socket<TD>byte<TD>number of socket to write from<TR>
<TD>30<TD>listener<TD>long<TD>pointer to write-data structure<A NAME=MARKER-2-103></A></TABLE>
 Parameter Variant</H4>
<A NAME=HEADING203-53></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>ddpSktErr<TD>-91<TD>Bad socket number or socket table is full<TR>
<TD>ddpLenErr<TD>-92<TD>Datagram data exceeds 586 bytes<TR>
<TD>noBridgeErr<TD>-93<TD>Could not find router to forward packet</TABLE>
</H2>
 <P>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-202.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-204.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
