<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Writing Apple Event Handlers(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING122></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-121.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-123.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-116.html"><B>Handling Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING122-0></A>
<H2><A NAME=MARKER-9-341></A><A NAME=MARKER-21-342></A>Writing Apple Event Handlers</H2>
 <A NAME=MARKER-2-162></A>For each Apple event your application supports, you must provide a function called an Apple event handler. The <CODE>AEProcessAppleEvent</CODE> function calls one of your Apple event handlers when it processes an Apple event. Your Apple event handlers should perform any action requested by the Apple event, add parameters to the reply Apple event if appropriate, and return a result code.<P>
 The Apple Event Manager uses dispatch tables to route Apple events to the appropriate Apple event handler. You must supply an Apple event handler for each entry in your application's Apple event dispatch table. Each handler must be a function that uses this syntax:<P>
<PRE>
FUNCTION MyEventHandler (theAppleEvent: AppleEvent; 
                         reply: AppleEvent; 
                         handlerRefcon: LongInt): OSErr; 
</PRE>
 The parameter <CODE>theAppleEvent</CODE> is the Apple event to handle. Your handler uses Apple Event Manager functions to extract any parameters and attributes from the Apple event and then performs the necessary processing. If any of the parameters include object specifier records, your handler should call <CODE>AEResolve</CODE> to resolve them--that is, to locate the Apple event objects they describe. For more information, see the chapter "Resolving and Creating Object Specifier Records" in this book.<P>
 The <CODE>reply</CODE> parameter is the default reply provided by the Apple Event Manager. (<A HREF=IAC-123.html#MARKER-9-362>"Replying to an Apple Event,"</A> which begins on <A HREF=IAC-123.html#MARKER-9-362>page 4-36</A>, describes how to add parameters to the default reply.) The <CODE>handlerRefcon</CODE> parameter is the reference constant stored in the Apple event dispatch table entry for the Apple event. Your handler can check the reference constant, if necessary, for information about the Apple event.<P>
 You can use the reference constant for anything you wish. For example, if you want to use the same handler for several Apple events, you can install entries for each event in your application's Apple event dispatch table that specify the same handler but different reference constants. Your handler can then use the reference constant to distinguish the different Apple events it handles.<A NAME=MARKER-2-247></A><P>
 To provide an Apple event handler in C, be sure to include the Pascal declaration before the handler declaration. This is the syntax for an Apple event handler in C: <P>
<PRE>
pascal OSErr MyEventHandler (const AppleEvent *theAppleEvent, 
                             const AppleEvent *reply, 
                             long handlerRefcon);
</PRE>
 After extracting all known parameters from the Apple event, every handler should determine whether the Apple event contains any further required parameters. Your handler can determine whether it retrieved all the required parameters by checking whether the <CODE>keyMissedKeywordAttr</CODE> attribute exists. If the attribute exists, then your handler has not retrieved all the required parameters and should immediately return an error. If the attribute does not exist, then the Apple event does not contain any more required parameters, although it may contain additional optional parameters.<A NAME=MARKER-21-324></A><P>
 The Apple Event Manager determines which parameters are optional according to the keywords listed in the <CODE>keyOptionalKeywordAttr</CODE> attribute. The source application is responsible for adding these keywords to the <CODE>keyOptionalKeywordAttr</CODE> attribute, but is not required to do so, even if that parameter is listed in the <I>Apple Event Registry: Standard Suites</I> as an optional parameter. If the source application does not add the necessary keyword to the <CODE>keyOptionalKeywordAttr</CODE> attribute, the target application treats the parameter as required for that Apple event. If the target application supports the parameter, it should handle the Apple event as the source application expects. If the target application does not support the parameter and checks whether it has received all the required parameters, it finds that there's another parameter that the client application considered required, and should return the result code <CODE>errAEParamMissed</CODE> without attempting to handle the event.<A NAME=MARKER-2-346></A><A NAME=MARKER-2-280></A> <A NAME=MARKER-2-283></A><P>
 <A HREF=#MARKER-9-353>Listing 4-11</A> shows a function that checks for a <CODE>keyMissedKeywordAttr</CODE> attribute. A handler calls this function after getting all the required parameters it knows about from an Apple event.<A NAME=MARKER-2-159></A><A NAME=MARKER-2-160></A><A NAME=MARKER-21-162></A><A NAME=MARKER-2-163></A><P>
<B>Listing 4-11  <A NAME=MARKER-9-353></A><A NAME=MARKER-21-354></A>A function that checks for a <CODE>keyMissedKeywordAttr</CODE> attribute<A NAME=MARKER-2-243></A></B><P>
<PRE>
FUNCTION MyGotRequiredParams (theAppleEvent: AppleEvent): OSErr;
VAR
   myErr:            OSErr;
   returnedType:     DescType;
   actualSize:       Size;
BEGIN
   myErr := AEGetAttributePtr(theAppleEvent, 
                               keyMissedKeywordAttr, 
                               typeWildCard, returnedType, 
                               NIL, 0, actualSize);
   IF myErr = errAEDescNotFound THEN 
      {you got all the required parameters}
      MyGotRequiredParams := noErr
   ELSE IF myErr = noErr THEN        
      {you missed a required parameter}
      MyGotRequiredParams := errAEParamMissed;
END;
</PRE>
 The code in <A HREF=#MARKER-9-353>Listing 4-11</A> uses the <CODE>AEGetAttributePtr</CODE> function to get the <CODE>keyMissedKeywordAttr</CODE> attribute. This attribute contains the first required parameter, if any, that your handler didn't retrieve. If <CODE>AEGetAttributePtr</CODE> returns the <CODE>errAEDescNotFound</CODE> result code, the Apple event doesn't contain a <CODE>keyMissedKeywordAttr</CODE> attribute. If the Apple event doesn't contain this attribute, then your handler has extracted all of the parameters that the client application considered required. <P>
 If the <CODE>AEGetAttributePtr</CODE> function returns <CODE>noErr</CODE> as the result code, then the attribute does exist, meaning that your handler has not extracted all of the required parameters. In this case, your handler should return an error and not process the Apple event.<P>
 The first remaining required parameter is specified by the data of the <CODE>keyMissedKeywordAttr</CODE> attribute. If you want this data returned, specify a buffer to hold the data. Otherwise, specify <CODE>NIL</CODE> as the buffer and 0 as the size of the buffer. If you specify a buffer to hold the data, you can check the value of the <CODE>actualSize</CODE> parameter to see if the data is larger than the buffer you allocated.<A NAME=MARKER-21-170></A><A NAME=MARKER-21-169></A><A NAME=MARKER-2-170></A><A NAME=MARKER-21-172></A><A NAME=MARKER-21-174></A><A NAME=MARKER-2-175></A><P>
 For more information about specifying Apple event parameters as optional or required, see <A HREF=IAC-198.html#MARKER-9-35>"Specifying Optional Parameters for an Apple Event" beginning on page 5-7</A>. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-121.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-123.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
