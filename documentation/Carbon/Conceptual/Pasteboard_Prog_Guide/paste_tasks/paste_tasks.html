<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Pasteboard Manager Programming Guide: Pasteboard Manager Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Pasteboard Manager Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001439-CH202" title="Pasteboard Manager Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../InterapplicationCommunication-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000451" target="_top">Interapplication Communication</a> &gt; <a href="../paste_intro/paste_intro.html#//apple_ref/doc/uid/TP40001439-CH201-DontLinkElementID_20">Pasteboard Manager Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../paste_concepts/paste_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../paste_scrap/paste_scrap.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_24" title="Pasteboard Manager Tasks"></a><h1><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCGCCFE" title="Pasteboard Manager Tasks"></a>Pasteboard Manager Tasks</h1><p>This chapter describes how to implement pasteboards in your application</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_8">A Day in the Life of a Pasteboard</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_9">Creating a Pasteboard</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_10">Adding Data to the Pasteboard</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_11">Handling Pasteboard Promises</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_12">Retrieving Data from the Pasteboard</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_13">Using the Pasteboard In Drag-And-Drop Operations</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCDCIJI">Handling Translations Using Pasteboards</a>
				
			<br/>
			
        
			
			
				<a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_17">The Pasteboard Peeker</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_8" title="A Day in the Life of a Pasteboard"></a><h2>A Day in the Life of a Pasteboard</h2><p>To get a better understanding of how the Pasteboard Manager works, it’s useful to understand the steps inherent in its use. For example, here is the general sequence that underlies a copy and paste action.</p><p>The copying application is responsible for placing copied or cut data onto the pasteboard:</p><ol class="ol"><li class="li"><p>The user selects some data and invokes the Copy (or Cut) menu item. </p></li><li class="li"><p>If the application doesn’t already have a reference to the Clipboard pasteboard, it creates one. </p></li><li class="li"><p>The application then takes ownership of the pasteboard and clears the current contents. </p></li><li class="li"><p>The application assigns item IDs to the selected data. </p></li><li class="li"><p>If any data is to be promised, the application must register a promise keeper callback function to supply the promised data. </p></li><li class="li"><p>The application adds one or more flavors of each item to the pasteboard, including either the actual flavor data or a promise with each flavor. </p></li></ol><p>The receiving application has a slightly different set of tasks to handle the Paste action:</p><ol class="ol"><li class="li"><p>When the application becomes active, it checks to see if the pasteboard has been modified. If so, it obtains a listing of the flavors on the pasteboard. If there are any flavors the application supports, it can enable its Paste menu item. </p></li><li class="li"><p>The user invokes the Paste menu item.</p></li><li class="li"><p>The application requests the item (or items) on the pasteboard in the flavors that it supports. </p></li><li class="li"><p>If the pasted data is to be stored as a file, the receiving application needs to set a paste location before requesting any flavor data. In any other case, the receiving application doesn’t need to worry about whether the paste data was promised or not. </p></li></ol><p>If the copying application’s promise keeper is called, the callback must do the following:</p><ul class="ul"><li class="li"><p>If the data is to be stored as a file, determine the paste location specified by the receiving application. </p></li><li class="li"><p>Generate or otherwise prepare the promised data for transfer. </p></li><li class="li"><p>If the promised data is not be stored as a file, add the flavor and data to the pasteboard. Otherwise, transfer the promised data to the specified file location. </p></li></ul><p>Some time later, when the application quits, or when it no longer needs the pasteboard, the application can release the pasteboard reference.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_9" title="Creating a Pasteboard"></a><h2>Creating a Pasteboard</h2><p>To create a pasteboard, you call the function <code>PasteboardCreate</code>. The name is a bit misleading, as it may not actually create a pasteboard. This function does one of two things:</p><ul class="ul"><li class="li"><p>If the pasteboard already exists, it creates a retained reference to that pasteboard, which your application can subsequently use to access it. </p></li><li class="li"><p>If the pasteboard does not exist, <code>PasteboardCreate</code> creates it for you and then creates a reference to it. </p></li></ul><p>In most cases your application does not need to worry about which of these actions occurred, because it obtains a pasteboard reference in either case. </p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>PasteboardRef theClipboard;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardCreate( kPasteboardClipboard, &amp;theClipboard );<span></span></pre></td></tr></table></div><p>In this example, the constant <code>kPasteboardClipboard</code> indicates that you want to reference the Clipboard pasteboard. Passing <code>kPasteboardFind</code> instead specifies the Find pasteboard. You can also specify custom pasteboards in one of two ways:</p><ul class="ul"><li class="li"><p>You can pass a unique pasteboard name. This name should be a Core Foundation string presented in reverse-DNS format to ensure uniqueness (that is, in the form <code>com</code>.<em>myCorp</em>.<em>myApp</em>.<em>myPasteboard</em>).</p></li><li class="li"><p>You can pass the constant <code>kPasteboardUniqueName</code>, which lets the Pasteboard Manager creates a uniquely-named pasteboard on your behalf. This option is useful if the pasteboard will have a short lifespan, or will not be widely shared. </p></li></ul><p>As stated previously, pasteboards live in a special global memory space so that they can be shared between applications. Unless you explicitly want a custom pasteboard to exist after your application quits, you should release the pasteboard reference by calling <code>CFRelease</code> when you are done using it. The Clipboard and Find pasteboards are always retained by the system and will never disappear. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_10" title="Adding Data to the Pasteboard"></a><h2>Adding Data to the Pasteboard</h2><p>After you have created a pasteboard, you can add data to it. For example, you would add data to the pasteboard when the user selects some data and then chooses the Copy or Cut menu item. You can then handle the copy operation in your <code>kHICommandCopy</code> event handler. </p><p><span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCBFGCE">Listing 1-1</a></span> shows how you might add some text to a pasteboard. This example assumes that the selection to be added to the pasteboard is contained within an MLTE text object and that the selection is considered to be a single pasteboard item. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_25" title="Listing 2-1Adding data to a pasteboard"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCBFGCE" title="Listing 2-1Adding data to a pasteboard"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Adding data to a pasteboard</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus AddDataToPasteboard( PasteboardRef inPasteboard,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                TXNObject inTXNObject){<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus            err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>PasteboardSyncFlags syncFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>TXNOffset           start, end;<span></span></pre></td></tr><tr><td scope="row"><pre>Handle              dataHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>CFDataRef           textData = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = PasteboardClear( inPasteboard );<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>require_noerr( err, CantClearPasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>syncFlags = PasteboardSynchronize( inPasteboard );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>require_action( !(syncFlags&amp;kPasteboardModified),<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>             PasteboardNotSynchedAfterClear, err = badPasteboardSyncErr );<span></span></pre></td></tr><tr><td scope="row"><pre>require_action( (syncFlags&amp;kPasteboardClientIsOwner),<span></span></pre></td></tr><tr><td scope="row"><pre>             ClientNotPasteboardOwner, err = notPasteboardOwnerErr );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    TXNGetSelection( inTXNObject, &amp;start, &amp;end );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    err = TXNGetDataEncoded( inTXNObject, start, end, &amp;dataHandle,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                                                     kTXNUnicodeTextData );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetDataFromTextObject );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    textData = CFDataCreate( kCFAllocatorDefault, <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                                    (UInt8*)*dataHandle, (end-start)*2 );<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeHandle( dataHandle );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_action( textData != NULL, CantCreateTextData, err = memFullErr );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardPutItemFlavor( inPasteboard, (PasteboardItemID)1,<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                        CFSTR("public.utf16-plain-text"),<span></span></pre></td></tr><tr><td scope="row"><pre>                        textData, 0 );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantPutTextData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantPutTextData:<span></span></pre></td></tr><tr><td scope="row"><pre>CantCreateTextData:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetDataFromTextObject:<span></span></pre></td></tr><tr><td scope="row"><pre>CantSetPromiseKeeper:<span></span></pre></td></tr><tr><td scope="row"><pre>ClientNotPasteboardOwner:<span></span></pre></td></tr><tr><td scope="row"><pre>PasteboardNotSynchedAfterClear:<span></span></pre></td></tr><tr><td scope="row"><pre>CantClearPasteboard:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p><code>PasteboardClear</code> clears the current contents of the pasteboard and makes your application the pasteboard owner. You must clear the pasteboard before you can add any data of your own. </p></li><li class="li"><p>You normally call <code>PasteboardSynchronize</code> when your application becomes active, in order to determine if the pasteboard contents have changed. However, it can also be useful to call this function from a plugin to determine if the host application has ownership of the pasteboard. If so, the plugin can go ahead and add data. </p></li><li class="li"><p>This code example and others in this section use Apple-defined error-checking macros. For more information about using these macros, see the header <code>AssertMacros.h</code> in <code>/usr/include</code>. </p></li><li class="li"><p>Call the MLTE function <code>TXNGetSelection</code> to obtain the start and end points of the selected text in the text object. </p></li><li class="li"><p>Call the MLTE function <code>TXNGetDataEncoded</code> to extract the selection as non-Unicode text, which is then placed in <code>dataHandle</code>.</p></li><li class="li"><p>Pasteboards require data to be store as <code>CFData</code> objects, so you need to call <code>CFDataCreate</code> to create a <code>CFData</code> object containing the text data. After creating the object, you can release the original text data. Note that Unicode encoding requires two bytes per character. </p></li><li class="li"><p>Call <code>PasteboardPutItemFlavor</code> to place a flavor-variant of the selected text on the pasteboard. Each piece of data must have a flavor associated with it (plain text in this case), and an item ID. In this example, the item ID is simply set as 1, but you can assign any value you wish. If you wanted to add another flavor of the same selected text (say Unicode text), you would specify the same item ID, but a different flavor. </p><p>If you want to add multiple items, you should generate them here and then call <code>PasteboardPutItemFlavor</code> to add each flavor of the item to the pasteboard. </p></li></ol><p>Each item you put onto a pasteboard must have a unique item ID. However, an item may be available in several different flavors. For example, you can call <code>PasteboardItemPutFlavor</code> several times specifying the same item ID, each time with a different flavor. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_11" title="Handling Pasteboard Promises"></a><h2>Handling Pasteboard Promises</h2><p>If you want to promise data when adding a flavor, you must pass <code>kPasteboardPromisedData</code> for the data parameter when calling <code>PasteboardPutItemFlavor</code>, In addition, before calling <code>PasteboardPutItemFlavor</code>, you must have set a promise keeper callback function by calling <code>PasteboardSetPromiseKeeper</code>.</p><div class="codesample"><table><tr><td scope="row"><pre> PasteboardSetPromiseKeeper( inPasteboard, myPromiseKeeperCallback,<span></span></pre></td></tr><tr><td scope="row"><pre>                         inContextData );<span></span></pre></td></tr></table></div><p>The <code>inContextData</code> parameter can hold any data that you would like to have passed to your callback function . When a receiving application attempts to obtain promised data from the pasteboard (by calling <code>PasteboardCopyItemFlavorData</code>) the Pasteboard Manager calls your promise keeper callback function. </p><p><span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCJCIGD">Listing 1-2</a></span> shows you might implement a promise keeper callback. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_26" title="Listing 2-2A simple pasteboard promise keeper callback function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCJCIGD" title="Listing 2-2A simple pasteboard promise keeper callback function"></a><strong>Listing 2-2&nbsp;&nbsp;</strong>A simple pasteboard promise keeper callback function</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus myPromiseKeeperCallback ( PasteboardRef inPasteboard,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                PasteboardItemID inItem, CFStringRef inFlavorType,<span></span></pre></td></tr><tr><td scope="row"><pre>                void *inContext )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDataRef   promisedData = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // create the promised flavor data here, as a CFData object <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardPutItemFlavor( inPasteboard, inItem, inFlavorType,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                                 promisedData, 0 );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease( promisedData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantFulfillPromise );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantFulfillPromise:<span></span></pre></td></tr><tr><td scope="row"><pre>CantCreatePromisedData:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>When your promise keeper callback is called, it receives the item ID and the flavor type that you specified when you called <code>PasteboardPutItemFlavor</code>. It also passes you any context data that you specified when you called <code>Pasteboard SetPromiseKeeper</code>. This information should be enough to determine what promised data you need to generate. </p></li><li class="li"><p>You need to convert your promised data to a <code>CFData</code> object before you can add it to a pasteboard. Typically you do so by calling the Core Foundation function <code>CFDataCreate</code>.</p></li><li class="li"><p>Call <code>PasteboardPutItemFlavor</code> to put the promised data onto the pasteboard.</p></li></ol><p>In most cases, you simply add the promised data to the pasteboard just as you would add any other flavor data. However, in some cases the receiver may have specified a URL (by calling <code>PasteboardSetPasteLocation</code> indicating where to place the data. In such cases, your callback needs to call <code>PasteboardCopyPasteLocation</code> to determine the drop location. For example, the Finder lets you copy and paste files in the file system. Rather than moving the contents of the files to the clipboard, it is simpler for the receiver to set the desired paste location. The Finder can then copy the files directly rather than going through the pasteboard. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_12" title="Retrieving Data from the Pasteboard"></a><h2>Retrieving Data from the Pasteboard</h2><p>Prior to doing any actual pasting, your application should call <code>PasteboardSynchronize</code> when handling the <code>kEventAppActivated</code> event to determine if the pasteboard has been modified. If it has, your handler should iterate through the available item flavors and provide visual feedback (activate the Paste menu item, highlight the drag target, and so on) if any compatible data exists. To improve efficiency, your application can exit the search loop immediately upon finding any compatible flavor; identifying all the pasteable flavors can wait until the actual paste routine. <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-CJBJCIFE">Listing 1-5</a></span> shows a possible implementation of the search loop as used in a drag tracking handler.</p><p><span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCIBCFJ">Listing 1-3</a></span> shows how an application might retrieve data from a pasteboard.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_27" title="Listing 2-3Obtaining data from the pasteboard"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCIBCFJ" title="Listing 2-3Obtaining data from the pasteboard"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Obtaining data from the pasteboard</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus GetDataFromPasteboard( PasteboardRef inPasteboard, TXNObject inTXNObject )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    PasteboardSyncFlags syncFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    ItemCount           itemCount;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    syncFlags = PasteboardSynchronize( inPasteboard );<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    require_action( syncFlags&amp;kPasteboardModified, PasteboardOutOfSync,<span></span></pre></td></tr><tr><td scope="row"><pre>                    err = badPasteboardSyncErr );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardGetItemCount( inPasteboard, &amp;itemCount );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetPasteboardItemCount );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for( UInt32 itemIndex = 1; itemIndex &lt;= itemCount; itemIndex++ )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        PasteboardItemID    itemID;<span></span></pre></td></tr><tr><td scope="row"><pre>        CFArrayRef          flavorTypeArray;<span></span></pre></td></tr><tr><td scope="row"><pre>        CFIndex             flavorCount;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = PasteboardGetItemIdentifier( inPasteboard, itemIndex, &amp;itemID );<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantGetPasteboardItemIdentifier );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = PasteboardCopyItemFlavors( inPasteboard, itemID, &amp;flavorTypeArray );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantCopyPasteboardItemFlavors );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        flavorCount = CFArrayGetCount( flavorTypeArray );<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for( CFIndex flavorIndex = 0; flavorIndex &lt; flavorCount; flavorIndex++ )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            CFStringRef             flavorType;<span></span></pre></td></tr><tr><td scope="row"><pre>            CFDataRef               flavorData;<span></span></pre></td></tr><tr><td scope="row"><pre>            CFIndex                 flavorDataSize;<span></span></pre></td></tr><tr><td scope="row"><pre>            char                    flavorText[256];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            flavorType = (CFStringRef)CFArrayGetValueAtIndex( flavorTypeArray,<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                                                                 flavorIndex );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if (UTTypeConformsTo(flavorType, CFSTR("public.utf16-plain-text")))<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                err = PasteboardCopyItemFlavorData( inPasteboard, itemID, <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                                                    flavorType, &amp;flavorData );<span></span></pre></td></tr><tr><td scope="row"><pre>                require_noerr( err, CantCopyFlavorData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                flavorDataSize = CFDataGetLength( flavorData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                flavorDataSize = (flavorDataSize&lt;254) ? flavorDataSize : 254;<span></span></pre></td></tr><tr><td scope="row"><pre>                for( short dataIndex = 0; dataIndex &lt;= flavorDataSize; dataIndex++ )<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    char byte = *(CFDataGetBytePtr( flavorData ) + dataIndex);<span></span></pre></td></tr><tr><td scope="row"><pre>                    flavorText[dataIndex] = byte;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                flavorText[flavorDataSize] = '\0';<span></span></pre></td></tr><tr><td scope="row"><pre>                flavorText[flavorDataSize+1] = '\n';<span></span></pre></td></tr><tr><td scope="row"><pre>                TXNSetData( inTXNObject, kTXNTextData, flavorText, <span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                            flavorDataSize+2, kTXNEndOffset, TXNEndOffset );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                CFRelease (flavorData);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCopyFlavorData:<span></span></pre></td></tr><tr><td scope="row"><pre>            ;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease (flavorTypeArray);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCopyPasteboardItemFlavors:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetPasteboardItemIdentifier:<span></span></pre></td></tr><tr><td scope="row"><pre>        ;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantGetPasteboardItemCount:<span></span></pre></td></tr><tr><td scope="row"><pre>PasteboardOutOfSync:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Here is how the code works:</p><ol class="ol"><li class="li"><p>In most cases, you would call <code>PasteboardSynchronize</code> from your <code>kEventAppActivated</code> handler to synchronize your pasteboard reference with the actual global pasteboard. However, you can call it here if your application does not do any flavor checking beforehand.</p></li><li class="li"><p>Call <code>PasteboardGetItemCount</code> to determine the number of items in the pasteboard. </p></li><li class="li"><p>For each item index, call <code>PasteboardGetItemIdentifer</code> to obtain the item ID.</p></li><li class="li"><p>Once you have the item ID, call <code>PasteboardCopyItemFlavors</code> to obtain the array of flavors corresponding to that item. </p></li><li class="li"><p>The Core Foundation function <code>CFArrayGetCount</code> determines the number of flavors in the array. </p></li><li class="li"><p>Next, iterate through the array of flavors, calling the Core Foundation function <code>CFArrayGetItemAtIndex</code> to obtain the flavor strings.</p></li><li class="li"><p>Use the uniform type identifier function <code>UTTypeConformsTo</code> to determine if the flavor is compatible with the plain Unicode text flavor type. UTIs are arranged in a conformance hierarchy (similar to a class hierarchy) which determines compatibility between flavors. </p></li><li class="li"><p>If the flavor is compatible, retrieve the flavor data from the pasteboard by calling <code>PasteboardCopyItemFlavorData</code>.</p></li><li class="li"><p>Iterate through the bytes of the data and copy them into the <code>flavorText</code> string. Note that because the data is Unicode, each character takes two bytes. </p></li><li class="li"><p> Call <code>TXNSetData</code> to add the pasted data to the end of the MLTE text object. </p></li></ol><p>The way this example is written, it will add every flavor that conforms to the plain Unicode text UTI to the MLTE object. In most cases, your application will choose to obtain only one flavor of each pasteboard item. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_13" title="Using the Pasteboard In Drag-And-Drop Operations"></a><h2>Using the Pasteboard In Drag-And-Drop Operations</h2><p>In Mac OS X v10.3 and later, the Drag Manager can use the Pasteboard Manager to transfer data in drag-and-drop operations. The mechanism is very similar to using a pasteboard to facilitate a cut-and-paste operation. When a drag occurs, the client application creates a pasteboard and places the dragged data onto it. To accept a drop, the receiving application obtains the data from the pasteboard. </p><p>Before implementing drag-and-drop in your application, be sure you understand and follow the drag-and-drop guidelines specified in the <em>Apple Human Interface Guidelines</em>.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_14" title="Initiating a Drag"></a><h3>Initiating a Drag</h3><p>When the user begins a drag, your application receives a <code>kEventControlTrack</code> event. Your application’s tracking handler should then place the dragged data onto a pasteboard.</p><p>The drag initiation handler in <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCJGCIJ">Listing 1-4</a></span> uses the Pasteboard Manager to hold the MLTE text selection being dragged. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_28" title="Listing 2-4A drag initiation handler that uses the Pasteboard Manager"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCJGCIJ" title="Listing 2-4A drag initiation handler that uses the Pasteboard Manager"></a><strong>Listing 2-4&nbsp;&nbsp;</strong>A drag initiation handler that uses the Pasteboard Manager</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus HandleDragInitiation( EventRef inEvent, TXNObject inTXNObject )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    err = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord convertedEvent;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32      keyModifiers;<span></span></pre></td></tr><tr><td scope="row"><pre>    HIPoint     eventPoint;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNOffset   start, end, offset;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( GetEventParameter( inEvent, kEventParamMouseLocation,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>     typeHIPoint, NULL, sizeof( eventPoint ), NULL, &amp;eventPoint ), CantGetHIPoint );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( TXNHIPointToOffset( inTXNObject, &amp;eventPoint, &amp;offset ),<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                                                     CantGetTXNOffsetForPoint );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    TXNGetSelection( inTXNObject, &amp;start, &amp;end );<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    convertedEvent.what = mouseDown;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    GetGlobalMouse (&amp;(convertedEvent.where));<span></span></pre></td></tr><tr><td scope="row"><pre>    GetEventParameter (inEvent, kEventParamKeyModifiers, typeUInt32, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof (keyModifiers), NULL, &amp;keyModifiers);<span></span></pre></td></tr><tr><td scope="row"><pre>    convertedEvent.modifiers = keyModifiers;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if( start &lt;= offset &amp;&amp; offset &lt;= end &amp;&amp; WaitMouseMoved( convertedEvent.where ) )<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        PasteboardRef   pasteboard;<span></span></pre></td></tr><tr><td scope="row"><pre>        DragRef         drag;<span></span></pre></td></tr><tr><td scope="row"><pre>        RgnHandle       theRegion, insetRegion;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = PasteboardCreate( kPasteboardUniqueName, &amp;pasteboard );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantCreatePasteboardForDrag );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = AddDataToPasteboard( pasteboard, inTXNObject);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantAddDataToTheDragPasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = NewDragWithPasteboard( pasteboard, &amp;drag );<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantCreateDrag );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        theRegion = NewRgn();<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>        insetRegion = NewRgn();<span></span></pre></td></tr><tr><td scope="row"><pre>        SetRectRgn( theRegion, convertedEvent.where.h - 10, convertedEvent.where.v - 5,<span></span></pre></td></tr><tr><td scope="row"><pre>                        convertedEvent.where.h + 10, convertedEvent.where.v + 5 );<span></span></pre></td></tr><tr><td scope="row"><pre>        CopyRgn( theRegion, insetRegion );<span></span></pre></td></tr><tr><td scope="row"><pre>        InsetRgn( insetRegion, 1, 1 );<span></span></pre></td></tr><tr><td scope="row"><pre>        DiffRgn( theRegion, insetRegion, theRegion );<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeRgn( insetRegion );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = TrackDrag( drag, &amp;convertedEvent, theRegion );<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr( err, CantTrackDrag );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantTrackDrag:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeRgn( theRegion );<span></span></pre></td></tr><tr><td scope="row"><pre>        check_noerr( DisposeDrag( drag ) );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCreateDrag:<span></span></pre></td></tr><tr><td scope="row"><pre>CantAddDataToTheDragPasteboard:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease( pasteboard );<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCreatePasteboardForDrag:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetTXNOffsetForPoint:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetHIPoint:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Call <code>GetEventParameter</code> to obtain the mouse position from the <code>kEventControlTrack</code> event.</p></li><li class="li"><p>The MLTE function <code>TXNGetOffsetFromPoint</code> determines the position of the mouse as a character offset within the text object. </p></li><li class="li"><p>Use the MLTE function <code>TXNGetSelection</code> to obtain the beginning and end offsets for the text selection within the text object. </p></li><li class="li"><p>The Drag Manager <code>TrackDrag</code> function still assumes that event information is stored in old Event Manager event records. A simple way around this is to manually populate an event record with the relevant data. This example fills out the event record with the event type, <code>mouseDown</code>, the mouse position, and the keyboard modifiers. </p></li><li class="li"><p>If the mouse offset is within the text selection, and the user has begun to drag the mouse (<code>WaitMouseMoved</code> returns <code>True</code>), then you can initiate the actual drag.</p></li><li class="li"><p>Call <code>PasteboardCreate</code> to create a unique pasteboard. This pasteboard needs to exist only for the length of the drag-and-drop operation. </p></li><li class="li"><p>To add the selection data to the pasteboard, call the <code>AddDataToPasteboard</code> function described in <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCBFGCE">Listing 1-1</a></span>, passing the pasteboard and the text object containing the text to be dragged. </p></li><li class="li"><p>To initiate the actual drag, create a drag object using the Drag Manager function <code>NewDragWithPasteboard</code>.</p></li><li class="li"><p>Set up a region to be the visual feedback for the drag. This example sets up a small rectangular region to be dragged. However, for most applications, the region should contain a translucent image or other similar rendering of the data being dragged. </p></li><li class="li"><p>Call the Drag Manager function <code>TrackDrag</code> to begin tracking the actual drag.</p></li><li class="li"><p>After you have initiated the actual drag, you no longer need to hold onto the pasteboard reference (the Drag Manager retains it), so you can release it by calling <code>CFRelease</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_15" title="Tracking a Drag"></a><h3>Tracking a Drag</h3><p>During drag tracking, if the drag enters a droppable region, the receiving application must determine whether it can accept the drag and, if so, highlight the region. You do so using a drag tracking callback function. </p><p>You install your drag tracking callback on a window using the Drag Manager function <code>InstallTrackingHandler</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr InstallTrackingHandler(<span></span></pre></td></tr><tr><td scope="row"><pre>  DragTrackingHandlerUPP   trackingHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>  WindowRef                theWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>  void *                   handlerRefCon<span></span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>In this example, you would pass the text view to receive the drag in the reference constant parameter. </p><p>Your drag tracking handler should visually indicate whether the data being dragged into the window is something it can accept. <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-CJBJCIFE">Listing 1-5</a></span> gives an example of how you might do this.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_29" title="Listing 2-5Tracking a drag in a window"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-CJBJCIFE" title="Listing 2-5Tracking a drag in a window"></a><strong>Listing 2-5&nbsp;&nbsp;</strong>Tracking a drag in a window</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr DragTrackingHandler( DragTrackingMessage inMessage, WindowRef inWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                void *inUserData, DragRef inDrag )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean tastyFlavor = false;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch( inMessage )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDragTrackingEnterWindow:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            ItemCount itemCount;<span></span></pre></td></tr><tr><td scope="row"><pre>            DragAttributes attributes;<span></span></pre></td></tr><tr><td scope="row"><pre>            PasteboardRef pasteboard;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            GetDragAttributes( inDrag, &amp;attributes );<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            err = GetDragPasteboard( inDrag, &amp;pasteboard );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            require_noerr( err, CantGetDragPasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            err = PasteboardGetItemCount (pasteboard, &amp;itemCount);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            for (UInt32 itemIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>                                (itemIndex &lt;= itemCount) &amp;&amp; !tastyFlavor; itemIndex++)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                PasteboardItemID itemID;<span></span></pre></td></tr><tr><td scope="row"><pre>                CFArrayRef  flavorTypeArray;<span></span></pre></td></tr><tr><td scope="row"><pre>                CFIndex     flavorCount;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                err = PasteboardGetItemIdentifier (pasteboard, itemIndex, &amp;itemID);<span></span></pre></td></tr><tr><td scope="row"><pre>                require_noerr (err, CantGetPBItemIdentifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                err = PasteboardCopyItemFlavors (pasteboard, itemID, &amp;flavorTypeArray);<span></span></pre></td></tr><tr><td scope="row"><pre>                require_noerr (err, CantGetPBItemFlavors);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                flavorCount = CFArrayGetCount(flavorTypeArray);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                for (CFIndex FlavorIndex = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                        (FlavorIndex &lt; flavorCount) &amp;&amp; !tastyFlavor; FlavorIndex++)<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFStringRef flavorType;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    flavorType = (CFStringRef)<span></span></pre></td></tr><tr><td scope="row"><pre>                            CFArrayGetValueAtIndex (flavorTypeArray, FlavorIndex);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    if (UTTypeConformsTo (flavorType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                CFSTR("public.plain-text")))<span></span></pre></td></tr><tr><td scope="row"><pre>                         tastyFlavor = true;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                CFRelease (flavorTypeArray);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                CantGetPBItemIdentifier:<span></span></pre></td></tr><tr><td scope="row"><pre>                CantGetPBItemFlavors:<span></span></pre></td></tr><tr><td scope="row"><pre>                    ;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            if( (attributes &amp; kDragHasLeftSenderWindow) &amp;&amp; tastyFlavor )<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                HIViewRef   textView = (HIViewRef)inUserData;<span></span></pre></td></tr><tr><td scope="row"><pre>                HIRect      textFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                RgnHandle   hiliteRgn = NewRgn();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                HIViewGetFrame( textView, &amp;textFrame );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                HIShapeRef textShape = HIShapeCreateWithRect( &amp;textFrame );<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                HIShapeGetAsQDRgn( textShape, hiliteRgn );<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                CFRelease( textShape );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                ShowDragHilite( inDrag, hiliteRgn, true );<span>// 10</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                DisposeRgn( hiliteRgn );<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            CantGetDragPasteboard:<span></span></pre></td></tr><tr><td scope="row"><pre>            ;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kDragTrackingLeaveWindow:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            HideDragHilite( inDrag );<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Define the <code>tastyFlavor</code> flag. Initially set to <code>false</code>, the tracking handler sets this flag if it finds a data flavor that the application can accept.</p></li><li class="li"><p>If the user drags data into the window, the tracking handler receives the <code>kDragTrackingEnterWindow</code> message.</p></li><li class="li"><p>Obtain the drag attributes by calling the Drag Manager function <code>GetDragAttributes</code> These attributes are needed later to determine whether or not to highight the accepting window.</p></li><li class="li"><p>Call the Drag Manager function <code>GetDragPasteboard</code> to obtain the pasteboard associated with the drag (created in the drag initiation handler (<span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCJGCIJ">Listing 1-4</a></span>)).</p></li><li class="li"><p>Determine if the drag contains a flavor the application can accept. This code is essentially a stripped-down version of the flavor-checking code in <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCIBCFJ">Listing 1-3</a></span>. This example simply determines if a compatible flavor exists, and if so, sets the <code>tastyFlavor</code> flag and drops out of the loops. </p><p>Note however, that to conform the to the Apple Human Interface Guidelines for receiving drags, your application must be able to accept a flavor from each dragged item in order to highlight the receiving view. See <span class="content_text"><a href="../../../../UserExperience/Conceptual/AppleHIGuidelines/XHIGDragDrop/XHIGDragDrop.html#//apple_ref/doc/uid/TP30000364-TP17" target="_top">Destination Feedback</a></span> in the <em><a href="../../../../UserExperience/Conceptual/AppleHIGuidelines/index.html#//apple_ref/doc/uid/20000957" target="_top">Apple Human Interface Guidelines</a></em> for more details. </p></li><li class="li"><p>Determine whether to highlight the receiving view or not. To be eligible for highlighting, the drag must have cleared the sending application’s window (as dictated by the Apple Human Interface Guidelines) and an acceptable flavor must exist (<code>tastyFlavor</code>== <code>true</code>).</p></li><li class="li"><p>Obtain the frame coordinates of the receiving view (a text view in this example) by calling the HIView function <code>HIViewGetFrame</code>.</p></li><li class="li"><p>Call the HIShape function <code>HIShapeCreateWithRect</code> to create an HIShape with the same coordinates as the text view. </p></li><li class="li"><p>Call the HIShape function <code>HIShapeGetAsQDRgn</code> to convert the HIShape into an classic QuickDraw region, as that is what the drag highlighting function expects. After creating this region, release the no longer needed HIShape by calling the Core Foundation function <code>CFRelease</code>.</p></li><li class="li"><p>Call the Drag Manager function <code>ShowDragHilite</code> to highlight the text view region. After passing the region to <code>ShowDragHilite</code>, you are free to dispose it. </p></li><li class="li"><p>The other interesting drag message this callback handles is <code>kDragTrackingLeaveWindow</code>, sent when the user moves the dragged data out of the receiving window. In this case, the callback simply hides the drag highlight by calling the Drag Manager function <code>HideDragHilite</code>.</p></li></ol><p>The overhead of obtaining pasteboard items and flavors is relatively low, so it is generally not a problem to repeat the flavor search each time the drag enters the view as well as when you actually obtain the pasteboard data.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_16" title="Receiving a Drag"></a><h3>Receiving a Drag</h3><p>When the user completes a drag-and-drop operation, the receiving application retrieves the data from the pasteboard in the standard drag receive callback function. You install your callback on a window using the Drag Manager function <code>InstallReceiveHandler</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr InstallReceiveHandler (<span></span></pre></td></tr><tr><td scope="row"><pre>   DragReceiveHandlerUPP receiveHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>   WindowRef theWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>   void * handlerRefCon<span></span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>In this example, you would pass the text object associated with the view receiving the drag as the <code>handlerRefCon</code> parameter, which is then passed to the drag receive handler in <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCJCIDH">Listing 1-6</a></span>.</p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_30" title="Listing 2-6Receiving a drag using the pasteboard"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCJCIDH" title="Listing 2-6Receiving a drag using the pasteboard"></a><strong>Listing 2-6&nbsp;&nbsp;</strong>Receiving a drag using the pasteboard</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr DragReceiveHandler( WindowRef inWindow, void *inUserData,<span></span></pre></td></tr><tr><td scope="row"><pre>                            DragRef inDrag )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    PasteboardRef   pasteboard;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject       txnObject = (TXNObject)inUserData;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetDragPasteboard( inDrag, &amp;pasteboard );<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetDragPasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetDataFromPasteboard( pasteboard, txnObject );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CantGetDragPasteboard:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    HideDragHilite( inDrag );<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Call the Drag Manager function <code>GetDragPasteboard</code> to obtain the pasteboard associated with the drag.</p></li><li class="li"><p>Get the data from the pasteboard, just as if you were obtaining it for a paste operation. This example simply calls the <code>GetDataFromPasteboard</code> function in <span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCIBCFJ">Listing 1-3</a></span> to put the pasteboard data into a text object. </p></li><li class="li"><p>After the drop operation is over, call the Drag Manager function <code>HideDragHilite</code> to remove the window highlighting added by the drag tracking callback. </p></li></ol><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCDCIJI" title="Handling Translations Using Pasteboards"></a><h2>Handling Translations Using Pasteboards</h2><p>The Pasteboard Manager supports data translators that present additional flavors available on a pasteboard. For example, a text-editing application may make two data flavors available when it places selected text onto the Clipboard pasteboard, plain and rich (RTF). A registered filter service can also make available another flavor, say <code>com.apple.mytranslatorapp.uppercasetext</code> that is translated from the plain text flavor. That is, when the receiving application obtains the array of data flavors to determine if it can handle them, the upper-case option is included as a promised flavor. These services are automatically available on any pasteboard you create or reference using the Pasteboard Manager. </p><p>If the receiving application chooses to obtain the upper-case text, the plain text is placed onto a new pasteboard and the filter service is invoked. The service obtains the raw data from the pasteboard, translates it accordingly, and then puts the translated data back on the pasteboard. The translated text is then placed back onto the Clipboard pasteboard where the the receiving application can obtain it. </p><p>If your application simply uses pasteboards for data sharing, any translation of pasteboard data occurs transparently. However, if you want to make a translation filter available, you need to write and register a filter service. </p><p>For example, say you want to implement a service that handles data translation (also called filtering) from standard text to all upper-case lettering. You must register this translation service by defining an NSFilter service in your application’s <code>Info.plist</code> file, such as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key>NSServices&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSFilter&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>UpperCaseTranslation&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSReturnTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>com.apple.mytranslatorapp.uppercasetext&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSSendTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>public.plain-text&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSSupportsDataTranslation&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/array><span></span></pre></td></tr></table></div><p>This defines an NSFilter that can take data of type <code>public.plain-text</code> and translate it to data of type <code>com.apple.mytranslatorapp.uppercasetext</code>. Of course, the returned data can be any standard type as well.</p><p>Whenever data is placed onto a pasteboard, the Services Manager scans the flavors and checks them against its list of registered translators. If a translator exists for a given flavor, it can promise the translated flavor on the pasteboard. However, translators are not transitive; if translators exist to convert type A to B and type B to C, this does not mean that a translator from A to C exists. If the receiving application requests a translated flavor, the service that offers that translation receives a <code>kEventServicePerform</code> event.</p><p>The scope of the translation is entirely up to the filter creator. For example, you could create a filter to change plain text to Unicode text, turn encapsulated PostScript(EPS) images into GIFs, or even translate English into French. The only restriction is that you must be able to present the translation option as a unique UTI.</p><p><span class="content_text"><a href="paste_tasks.html#//apple_ref/doc/uid/TP40001439-CH202-BBCHJEJA">Listing 1-7</a></span> shows how you might implement a filter service that offers text translation to either all upper-case or all lower-case lettering. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_31" title="Listing 2-7A filter service handler"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001439-CH202-BBCHJEJA" title="Listing 2-7A filter service handler"></a><strong>Listing 2-7&nbsp;&nbsp;</strong>A filter service handler</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus HandlePerformService( EventRef inEvent )<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef         serviceName, returnType;<span></span></pre></td></tr><tr><td scope="row"><pre>    PasteboardRef       pasteboard;<span></span></pre></td></tr><tr><td scope="row"><pre>    PasteboardItemID    item;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDataRef           sourceData;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex             sourceSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableDataRef    returnData = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    const UInt8*        sourceBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt8*              returnBytes;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetEventParameter( inEvent, kEventParamServiceMessageName,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>         typeCFStringRef, NULL, sizeof( CFStringRef ), NULL, &amp;serviceName );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetServiceName );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetEventParameter( inEvent, kEventParamPasteboardRef,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>         typePasteboardRef, NULL, sizeof( PasteboardRef ), NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>         &amp;pasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetPasteboardRef );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardGetItemIdentifier( pasteboard, 1, &amp;item );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetItemIdentifier );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardCopyItemFlavorData( pasteboard, item,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                CFSTR("public.plain-text"), &amp;sourceData );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantGetSourceData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sourceSize = CFDataGetLength( sourceData );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    returnData = CFDataCreateMutable( kCFAllocatorDefault, sourceSize );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    require_action( returnData != NULL, CantCreateReturnData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    err = memFullErr );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sourceBytes = CFDataGetBytePtr( sourceData );<span></span></pre></td></tr><tr><td scope="row"><pre>    returnBytes = CFDataGetMutableBytePtr( returnData );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDataSetLength( returnData, sourceSize );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if( CFStringCompare( serviceName, CFSTR("UpperCaseTranslation"), 0 )<span></span></pre></td></tr><tr><td scope="row"><pre>            == kCFCompareEqualTo )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        returnType = CFSTR("com.apple.pasteboardpeeker.uppercasetext");<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for( CFIndex i=0; i&lt;sourceSize; i++ )<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>            returnBytes[i] = (UInt8)toupper( sourceBytes[i] );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        returnType = CFSTR("com.apple.pasteboardpeeker.lowercasetext");<span>// 10</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for( CFIndex i=0; i&lt;sourceSize; i++ )<span></span></pre></td></tr><tr><td scope="row"><pre>            returnBytes[i] = (UInt8)tolower( sourceBytes[i] );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardClear( pasteboard );<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantClearPasteboard );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the translated data<span></span></pre></td></tr><tr><td scope="row"><pre>    err = PasteboardPutItemFlavor( pasteboard, item, returnType, <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>            returnData, 0 );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantAddTranslatedData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantAddTranslatedData:<span></span></pre></td></tr><tr><td scope="row"><pre>CantClearPasteboard:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease( returnData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCreateReturnData:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease( sourceData );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantGetSourceData:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetItemIdentifier:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetPasteboardRef:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetServiceName:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>The <code>HandlePerformService</code> function receives an event reference from the <code>kEventServicePerform</code> event handler that calls it.</p></li><li class="li"><p>Call <code>GetEventParameter</code> to obtain the service message that generated the perform event. </p></li><li class="li"><p>For service events, a pasteboard storing the data to be filtered is stored in the event. Call <code>GetEventParameter</code> specifying the <code>kEventParamPasteboardRef</code> parameter to obtain it. This pasteboard was allocated for you, so you do not need to release it when you are done with it. </p></li><li class="li"><p>This example assumes that the data to be filtered is the first item in the pasteboard. </p></li><li class="li"><p>This example also assumes that the data in the item is of type <code>public.plain-text</code>.</p></li><li class="li"><p>Call the Core Foundation function <code>CFGetDataLength</code> to determine the size of the data. As the text contains single-byte characters, this is also the length of the text string. </p></li><li class="li"><p>Call the Core Foundation function <code>CFDataCreateMutable</code> to allocate memory to hold the translated string data. </p></li><li class="li"><p>If the service request is to translate to upper-case, set the return type of the translated text to a unique UTI reflecting this. You must do this, because Translation Services looks for the translated type on the pasteboard (not the original) when retrieving the data.</p></li><li class="li"><p>Use the <code>toupper</code> operator to convert the source text to all upper-case lettering. </p></li><li class="li"><p>Handle the lower-case option in a similar manner as the upper-case option.</p></li><li class="li"><p>Clear the pasteboard in preparation for adding the translated text. </p></li><li class="li"><p>Call <code>PasteboardPutItemFlavor</code> to add the translated text to the pasteboard. After your service handler completes, the Services Manager puts the translated text back onto the original pasteboard so that the receiving application can retrieve it. </p></li></ol><p>For more information about building and installing services, see <em>Setting Up Your Carbon Application to Use the Services Menu</em>. </p><a name="//apple_ref/doc/uid/TP40001439-CH202-DontLinkElementID_17" title="The Pasteboard Peeker"></a><h2>The Pasteboard Peeker</h2><p>For additional examples of using pasteboards, you can examine the <em><a href="../../../../../samplecode/PasteboardPeeker/index.html#//apple_ref/doc/uid/DTS10000672" target="_top">PasteboardPeeker</a></em> sample code available in the ADC Reference Library. </p><p>The Pasteboard Peeker application is also useful for determining what data and types are currently on the Clipboard pasteboard. </p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../paste_concepts/paste_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../paste_scrap/paste_scrap.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-07-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/Pasteboard_Prog_Guide/paste_tasks/paste_tasks.html%3Fid%3DTP40001439-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/Pasteboard_Prog_Guide/paste_tasks/paste_tasks.html%3Fid%3DTP40001439-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/Pasteboard_Prog_Guide/paste_tasks/paste_tasks.html%3Fid%3DTP40001439-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>