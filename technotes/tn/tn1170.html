<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1170: The Printing Plug-ins Manager</title>      <meta name="keywords" content="Mac OS 8 Printing Plug-ins Manager API psGetPrintingPluginsFolder psValidateLibraryLocator">    <meta name="Description" content="Technical Note TN1170: This Technical Note describes therequirements the Printing Plug-ins Manager   imposes on thefiles it manages. This Note also describes the APIs usedby clients of the Printing Plug-ins   Manager. This sectionconsists of a simple call to obtain a list of plug-ins ofgiven type, a more   complex version of this call for specializedclients, a set of utility routines (e.g.- psValidateLibraryLocator,psGetPrintingPluginsFolder, etc.), and common error codesfor the Manager."><meta name="categories" content="Printing"><meta name="week-posted" content="May 31, 1999 - Jun 4, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003009" title="The Printing Plug-ins Manager"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1170</div>
<div id="pageheadsub">The Printing Plug-ins Manager</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>            <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc --><P id = "menutext"><A HREF = "#About">About This Technote</A><BR><BR><A HREF = "#Creators">Information for Plug-in Creators</A><BR><BR><A HREF = "#APIs">Printing Plug-ins Manager APIs</A><BR><BR><A HREF = "#Utility">Utility Routines</A><BR><BR><A HREF = "#Errors">Errors</A><BR><BR><A HREF = "#References">References</A><br><br><A HREF = "#Changes">Change History</A><br><br><A HREF = "#Downloads">Downloadables</A></p> <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">New to PrintingLib 8.6 is functionality built into the SettingsLib library contained in the PrintingLib file. This functionality allows straightforward use of plug-in modules contained in either the PrintingLib file or in a special folder called "Printing Plug-ins" in the Extensions folder in the user's System folder. Plug-in modules are shared libraries whose behavior is unspecified.</p><P id = "introtext">The "Printing Plug-ins Manager" is intended to make it straightforward for software clients to create, load, and use shared libraries which can be treated as printing plug-ins. The Download Manager has been implemented using the Printing Plug-ins Manager to manage its plug-ins. Future printing software will use the Printing Plug-ins Manager to manage other plug-ins.</P><P id = "introtext">This Technote is directed at application developers who wish to write plug-in modules.</P> <!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [May 24 1999]</h3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --> <A NAME="About"></A>         <H2>About This Technote</H2><P>This document is divided into two main sections: <A HREF = "#Creators">Information for Plug-in Creators</A> and <A HREF = "#APIs">Plug-ins Manager APIs</A>.</P><P>The section <A HREF = "#Creators">Information for Plug-in Creators</A> describes the requirements the Printing Plug-ins Manager imposes on the files it manages. These requirements are minimal and are probably similar to requirements a client would otherwise impose. This section applies to developers of Download Manager plug-in low level converters, Desktop Printer Utility plug-ins, and Custom Hoses since these plug-ins are managed by the Printing Plug-ins Manager.</P><P>The section <A HREF = "#APIs">Printing Plug-ins Manager APIs</A> describes the APIs used by clients of the Printing Plug-ins Manager. This section consists of a "simple" call to obtain a list of plug-ins of given type, a more complex version of this call for specialized clients, and a set of utility routines. This section applies only to developers who wish to put plug-ins into the Printing Plug-ins Folder and use the <A HREF = "#APIs">Printing Plug-ins Manager APIs</a> to manage them. For example, an installer program for a plug-in module might use the <CODE>psGetPrintingPluginsFolder</CODE> routine to install printing plug-ins into the proper folder for use with the Download Manager.</P><P>Please see <A HREF = "tn1169.html">Technote 1169: The Download Manager</A> for information about one client of the Printing Plug-ins Manager.</P><BR><P><A HREF = "#top">Back to top</a></p><A NAME="Creators"></A><H2>Information for Plug-in Creators</H2><P>Plug-ins managed by the Printing Plug-ins Manager are required to have a resource of type <CODE>'PLGN'</CODE> with ID <CODE>-8192</CODE> that contains information about the library. If they do not, they cannot be used and are ignored by the Printing Plug-ins Manager. They are also required to have a standard <CODE>'cfrg'</CODE> resource describing the code fragments in the data fork of the file.</P><P>The <CODE>'PLGN'</CODE> resource contains information about how many plug-in shared libraries are contained in this file and for each shared library the type of plug-in that it is, the subtype that library handles and the library name. A subtype of <CODE>'????'</CODE> means that particular plug-in can handle multiple subtypes (as is the case for the Download Manager Plug-ins).</P><P>The <CODE>'PLGN'</CODE> resource is defined as follows (using Rez syntax):</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>type 'PLGN' { integer = $$Countof(PluginLibInfo); array PluginLibInfo {  literal longint; /* Type */  literal longint; /* subtype */  pstring;   /* library name */  align word; };};</pre></TD></TR></TABLE></CENTER><BR><BR><P>A ResEdit template resource (<CODE>'TMPL'</CODE>) for the <CODE>'PLGN'</CODE> resource is contained within PrintingLib versions 8.6 and later.</P><CODE>The PluginLibInfo structure in C syntax is:</CODE><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>typedef OSType SettingsDataType;typedef OSType SettingsDataSubType;short num; // the number of shared libraries this 'PLGN' describesPluginLibInfo libInfo[num];typedef struct PluginLibInfo{ SettingsDataType type; SettingsDataSubType subtype; unsigned char libraryName[ ];  // pascal string        // word aligned}PluginLibInfo;</pre></TD></TR></TABLE></CENTER><BR><BR><P><CODE>type</CODE> is the type of plug-in that is described by this <CODE>PluginLibInfo</CODE>.</P><P><CODE>subtype</CODE> is the subtype of data that can be handled by the plug-in described by this <CODE>PluginLibInfo</CODE> .</P><P><CODE>libraryName</CODE> is the library name of the code fragment in the plug-in file described by this <CODE>PluginLibInfo</CODE>.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>A single file can contain multiple plug-in libraries.</p></TD></TR></TABLE></CENTER><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The subtype <CODE>'zsys'</CODE> is reserved for use by the Printing Plug-ins Manager and cannot be used by a client.</p></TD></TR></TABLE></CENTER><BR><BR><P>A file containing plug-ins for use with the Printing Plug-ins Manager is not required to have any specific Finder Type or Creator. However, the Finder Type <CODE>'bird'</CODE> is a type that is auto-routed by the Finder into the Printing Plug-ins Folder when Mac OS 8.5 and PrintingLib 8.6.1 (or later) are used. For this reason, it is recommended that developers of Printing Plug-ins use <CODE>'bird'</CODE> as the Finder Type for the file. Note that the Finder Type has no connection to the <CODE>SettingsDataType</CODE> referred to by the <CODE>PluginLibInfo</CODE> contained in the <CODE>'PLGN'</CODE> resource.</P><BR><P><A HREF = "#top">Back to top</a></p><A NAME="APIs"></A><H2>Printing Plug-ins Manager APIs</H2><H3>Definitions</H3><P>A <CODE>LibraryLocator</CODE> is a structure which can be used by a client to open a particular shared library using <CODE>GetDiskFragment</CODE>. It contains information about the <CODE>FSSpec</CODE>, the library name, and for the currently executing architecture, the offset of the shared library in the file and the library's length.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>typedef struct LibraryLocator{ FSSpec  librarySpec; Str63  libraryName; SInt32  libraryOffset; // for the currently executing      // architecture SInt32  libraryLength; // for the currently executing      // architecture}LibraryLocator;</pre></TD></TR></TABLE></CENTER><BR><BR><P>For many operations, the Printing Plug-ins Manager maintains a cache of information about the installed Printing Plug-ins. The cache is updated as new plug-ins are installed or existing ones are removed or updated. This cache allows the Printing Plug-ins Manager to respond quickly in its search for a plug-in of a requested type and subtype.</P><H3>Simple Case</H3><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus psGetSubtypeLocators(SettingsDataType type, SettingsDataSubType subtype, long *numLocatorsP, LocatorListH *locatorListHP); </pre></TD></TR></TABLE></CENTER><BR><BR> <P>A client calls this routine to get a handle containing a list of <CODE>LibraryLocators</CODE>. The <CODE>LibraryLocators</CODE> are the plug-ins available with the type and subtype requested by the caller. The caller is required to dispose of the handle when it is done. The returned handle is <CODE>NULL</CODE> if there is an error or if there are no <CODE>LibraryLocators</CODE> of the type and subtype.</P><P>Calling <CODE>psGetSubtypeLocators</CODE> causes the Printing Plug-ins Manager to determine if its cache of plug-ins for the type and subtype specified by the call is current. If it is not, the cache is updated. Once the cache is up to date, the Printing Plug-ins Manager returns the number of locators matching the specified type and subtype in <CODE>*numLocatorsP</CODE>. If the number of <CODE>LibraryLocators</CODE> matching the type, subtype is greater than zero, a handle that points to the list of matching <CODE>LibraryLocators</CODE> is returned in <CODE>*locatorListHP</CODE>. It is up to the caller of <CODE>psGetSubtypeLocators</CODE> to dispose of this handle.</P><P>If the list contains more than one <CODE>LibraryLocator</CODE> the caller must determine which of the <CODE>LibraryLocators</CODE> in the list is of interest. Note that <CODE>LibraryLocators</CODE> that correspond to libraries in the Printing Plug-ins Folder are returned first (external plug-ins have precedence in this list). If a client needs more information to determine which library is the one to use, it should probably use the more complex call <CODE>psGetPreferredSubtypeLocators</CODE> described below.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The subtype <CODE>'zsys'</CODE> is reserved for use by the Printing Plug-ins Manager and cannot be used by a client. If a client calls <CODE>psGetSubtypeLocators</CODE> with a subtype of <CODE>'zsys'</CODE>, an <CODE>errInvalidPluginSubType</CODE> is returned.</p></TD></TR></TABLE></CENTER><BR><BR><H3>More Complex Case</H3>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus psGetPreferredSubtypeLocators(SettingsDataType type,<BR>   SettingsDataSubType subtype, SInt32 clientDataVersion,ClientBuildCacheDataCallBackUPP buildcallback,ClientProcessCacheDataCallBackUPP processcallback, void *clientrefcon, long *numLocatorsP, LibraryLocatorListH *locatorListHP);typedef pascal OSStatus (*ClientBuildCacheDataCallBack) (const LibraryLocator *thisLocator, void *clientrefcon, CacheData cache);typedef pascal OSStatus (*ClientProcessCacheDataCallBack) (const LibraryLocator *thisLocator, void *clientrefcon, SInt32 size, const void *dataPtr, Boolean *addThisLocator);OSStatus psAddSettingsSubTypeData(CacheData cache, SettingsDataSubType subtype, SInt32 size, const void *dataPtr);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The <CODE>psGetPreferredSubtypeLocators</CODE> routine is available when a client has more complex needs. This is the case if a plug-in of a given type can handle multiple subtypes. In this situation, there is some additional work that a client must do to categorize the subtypes that such a plug-in can handle. A second situation where the <CODE>psGetPreferredSubtypeLocators</CODE> call is useful is if there is data associated with the plug-in type and subtype that is used to further refine which plug-in is the needed one. This might be the case if there are multiple plug-ins of a given type and subtype.</P><P>For example, each Download Manager plug-in can potentially handle multiple subtypes. Further, the Download Manager may have multiple plug-ins that can handle a given subtype of data, and there is data about each plug-in that the Download Manager uses to narrow the list of plug-ins which are available for a given download. This data can be stored in the Printing Plug-ins Manager's cache and used to process the <CODE>psGetPreferredSubtypeLocators</CODE> call.</P><P>A client calls <CODE>psGetPreferredSubtypeLocators</CODE> with <CODE>ClientBuildCacheDataCallBack</CODE> and <CODE>ClientProcessCacheDataCallBack</CODE> procedures. If the plug-in manager cache for this type needs to be rebuilt (which it does the first time a given type is seen and later when the cache becomes invalid), the <CODE>ClientBuildCacheDataCallBack</CODE> procedure is called for each library of that type. Once the cache and cached data are up to date, the Printing Plug-ins Manager calls the supplied <CODE>ClientProcessCacheDataCallBack</CODE> to examine the results.</P><P>The <CODE>ClientBuildCacheDataCallBack</CODE> procedure is responsible for gathering its data from each library (e.g., the Download Manager calls into the library to obtain the data it needs) and it should call the <CODE>psAddSettingsSubTypeData</CODE> routine for each subtype for which it has data to add to the cache. For each <CODE>psAddSettingsSubTypeData</CODE> call made, the Printing Plug-ins Manager <I>replaces</I> any data which may have already been added to its cache for this library and subtype. Note that the plug-in subtype for a library passed to the <CODE>ClientBuildCacheDataCallBack</CODE> procedure may not correspond to the subtype passed in to the <CODE>psGetPreferredSubtypeLocators</CODE> call since the process of rebuilding the cache processes each library of a given type.</P><P>Once the cache has been updated, the Printing Plug-ins Manager calls the <CODE>ClientProcessCacheDataCallBack</CODE> procedure for each <CODE>LibraryLocator</CODE> which supports the subtype requested by the <CODE>psGetPreferredSubtypeLocators</CODE> call. This gives the client an opportunity to use the data the <CODE>ClientBuildCacheDataCallBack</CODE> has cached for each <CODE>LibraryLocator</CODE> to pick the appropriate <CODE>LibraryLocator</CODE>. The <CODE>ClientProcessCacheDataCallBack</CODE> can make further calls to the shared library corresponding to that <CODE>LibraryLocator</CODE> in order to aid in its processing. Once a given <CODE>LibraryLocator</CODE> has been processed, the <CODE>ClientProcessCacheDataCallBack</CODE> routine returns a <CODE>Boolean</CODE> indicating whether to keep this <CODE>LibraryLocator</CODE> in its list of <CODE>LibraryLocators</CODE> to return from <CODE>psGetPreferredSubtypeLocators</CODE> in the locatorListHP variable.</P><P>For example, the Download Manager uses the <CODE>psGetPreferredSubtypeLocators</CODE> call. Download Manager plug-ins all have the subtype <CODE>'????'</CODE> because they potentially each handle multiple subtypes of data. In its <CODE>ClientBuildCacheDataCallBack</CODE> routine, the Download Manager obtains information about what type of data a given Download Manager converter library can handle and it supplies that data as its data to cache for that library. This data is cached by the Printing Plug-ins Manager so that further calls to <CODE>psGetPreferredSubtypeLocators</CODE> do not call the <CODE>ClientBuildCacheDataCallBack</CODE> routine unless the set of Printing Plug-ins has changed. Once the cache is up to date, the <CODE>psGetPreferredSubtypeLocators</CODE> calls the supplied <CODE>ClientProcessCacheDataCallBack</CODE> routine.</P><P>In its <CODE>ClientProcessCacheDataCallBack</CODE> routine, the Download Manager uses the cached information about what type of data a given converter library can handle to determine if it needs to call the library itself for more information. For each library which can handle a given type of data, the Download Manager loads and calls that library to refine the search further.</P><P>The parameter <CODE>clientDataVersion</CODE> passed to the <CODE>psGetPreferredSubtypeLocators</CODE> call is a number supplied by the caller and is used to put a version tag on the data the client puts in the cache. Since the client may change over a period of time, it is important to ensure that a new client doesn't receive cached data that was created by an older version of the client. A client only needs to change its version data when the client's custom cached data type changes.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>It is not anticipated that a large number of developers will use the <CODE>psGetPreferredSubtypeLocators</CODE> call to manage plug-ins of the same type. It is important that each client of this call with a given type ensure that the values of <CODE>clientDataVersion</CODE> it uses are unique. Failing to do so could potentially generate collisions in any cached data between clients and possibly return incorrect data to a given client. Following a simple guideline of choosing a large random number for your <CODE>clientDataVersion</CODE> will satisfy the need to avoid collisions between clients. Small integers are greatly discouraged.</P></TD></TR></TABLE></CENTER><BR><BR><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Negative version numbers are reserved by the implementation and must not be used by clients. In later versions of SettingsLib, attempting this will generate the error <CODE>errInvalidPluginsClientDataVersion</CODE>.</p></TD></TR></TABLE></CENTER><BR><BR><P>The parameter <CODE>clientrefcon</CODE> passed to the <CODE>psGetPreferredSubtypeLocators</CODE> call is a pointer to client-supplied data. The <CODE>clientrefcon</CODE> supplied to this routine is typically a pointer to data that the client is gathering. The <CODE>clientrefcon</CODE> supplied to the <CODE>psGetPreferredSubtypeLocators</CODE> will be the <CODE>clientrefcon</CODE> passed to the <CODE>ClientBuildCacheDataCallBack</CODE> and <CODE>ClientProcessCacheDataCallBacks</CODE>.</P><P>Upon return from the <CODE>psGetPreferredSubtypeLocators</CODE> call, <CODE>*numLocatorsP</CODE> contains the number of <CODE>LibraryLocators</CODE> for which the <CODE>ClientProcessCacheDataCallBack</CODE> returns true in the <CODE>*addThisLocator</CODE> variable. Additionally, the <CODE>*locatorListHP</CODE> variable contains a handle which is a list of the <CODE>LibraryLocators</CODE> for which the <CODE>ClientProcessCacheDataCallBack</CODE> returned true in the <CODE>*addThisLocator</CODE> variable. If the returned value of <CODE>*numLocatorsP</CODE> is zero, the value of <CODE>*locatorListHP</CODE> will be <CODE>NULL</CODE>. If the returned value of <CODE>*numLocatorsP</CODE> is non-zero, it is up to the caller of <CODE>psGetPreferredSubtypeLocators</CODE> to dispose of the handle returned in <CODE>locatorListHP</CODE>.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The subtype <CODE>'zsys'</CODE> is reserved for use by the Printing Plug-ins Manager and cannot be used by a client. If a client calls psGetSubtypeLocators with a subtype of <CODE>'zsys'</CODE>, the error <CODE>errInvalidPluginSubType</CODE> is returned.</p></TD></TR></TABLE></CENTER><BR><BR><BR><P><A HREF = "#top">Back to top</a></p><A NAME="Utility"></A><H2>Utility Routines</H2><P>There are several utility routines that may be helpful to clients of the Printing Plug-ins Manager.</P><H3>psValidateLibraryLocator</H3>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus psValidateLibraryLocator( const LibraryLocator *libLocatorP, Boolean *isValid);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The <CODE>psValidateLibraryLocator</CODE> allows a client to have the Printing Plug-ins Manager validate any <CODE>LibraryLocator</CODE>. If the data in the <CODE>LibraryLocator</CODE> pointed to by <CODE>libLocatorP</CODE> is valid, then <CODE>*isValid</CODE> is set to true; otherwise <CODE>*isValid</CODE> is set to false. <CODE>LibraryLocators</CODE> returned by the <CODE>psGetSubtypeLocators</CODE> and <CODE>psGetPreferredSubtypeLocators</CODE> calls are always valid at the time they are returned, but they can become invalid because of user actions. If <CODE>LibraryLocators</CODE> are stored or provided to other pieces of software, it is important to validate them with the <CODE>psValidateLibraryLocator</CODE> routine before using them. For example, if the user updates a library and that library is referenced by a stored <CODE>LibraryLocator</CODE>, the <CODE>LibraryLocator</CODE> may no longer contain correct information about the stored shared library, and use of it with <CODE>GetDiskFragment</CODE> may cause a crash.</P><H3>psGetPrintingPluginsFolder</H3><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus psGetPrintingPluginsFolder(short *vref, long *folderId);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The <CODE>psGetPrintingPluginsFolder</CODE> call allows a client to obtain the volume reference number and <CODE>folderID</CODE> information for the folder that is being used as the Printing Plug-ins Folder. This is useful to clients such as installers who don't want to use the other Printing Plug-ins Manager calls to manage plug-in information but do want to know where the Printing Plug-ins Folder is.</P><H3>psGetPrintingPluginsFolderName</H3>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>StringPtr psGetPrintingPluginsFolderName(void);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The <CODE>psGetPrintingPluginsFolderName</CODE> call allows a client to obtain the name of the folder that is being used as the Printing Plug-ins Folder. This is useful to clients such as installers who don't want to use the other Printing Plug-ins Manager calls to manage plug-in information but do want to know the name of the folder. The <CODE>StringPtr</CODE> returned by this call is only valid while the SettingsLib library is open.</P><H3>psGetPluginPrefsFileName</H3><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>StringPtr psGetPluginPrefsFileName();</pre></TD></TR></TABLE></CENTER><BR><BR><P>The <CODE>psGetPluginPrefsFileName</CODE> call allows a client to obtain the name for the file that is being used as the preferences file by the Printing Plug-ins Manager. This call is currently used only by the Printing Plug-ins Manager. There should be no need for third parties to access data in the preferences file and all data in that file is considered private.</P><H3>psGetTypeLibraryData</H3><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus psGetTypeLibraryData(SettingsDataType type, long *numLibrariesP, LibraryDataListH *libraryListHP);</pre></TD></TR></TABLE></CENTER><BR><BR><P><CODE>psGetTypeLibraryData</CODE> returns a list of <CODE>LibraryData</CODE> structures for all the plug-ins of the specified type. The <CODE>LibraryData</CODE> structure is defined as:</P>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>typedef struct LibraryData{ SettingsDataSubType subtype; LibraryLocator libraryLocator;}LibraryData, *LibraryDataListP, **LibraryDataListH;</pre></TD></TR></TABLE></CENTER><BR><BR><P>The subtype field of the <CODE>LibraryData</CODE> structure is the subtype of the plug-in library represented by the <CODE>libraryLocator</CODE> field of the <CODE>LibraryData</CODE> structure.</P><P>A client calls this routine to enumerate all plug-ins of a given type. This call returns a handle containing a list of <CODE>LibraryData</CODE> structures. The <CODE>LibraryLocators</CODE> are all those plug-ins available with the type specified by the caller. The caller is required to dispose of the returned handle when it is done with it. The returned handle is <CODE>NULL</CODE> if there is an error or if there are no plug-ins of the type specified.</P><P>Note that <CODE>LibraryLocators</CODE> which correspond to libraries in the Printing Plug-ins Folder are returned first; i.e., external plug-ins have precedence in this list.</P><P>Use <CODE>psGetSubtypeLocators</CODE> instead of <CODE>psGetTypeLibraryData</CODE> when the subtype of the desired plug-in is known. The <CODE>psGetSubtypeLocators</CODE> call caches data to improve performance whereas <CODE>psGetTypeLibraryData</CODE> always looks at all the libraries in PrintingLib and the Printing Plug-ins Folder to obtain its list of libraries.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The <CODE>psGetTypeLibraryData</CODE> call is only available in PrintingLib version 8.6.5 and later. Clients should weak-link to PrintingLib and test that the symbol is available before calling <CODE>psGetTypeLibraryData</CODE>. For example:</p></TD></TR></TABLE></CENTER><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>if(psGetTypeLibraryData != (void *)kUnresolvedCFragSymbolAddress){ psGetTypeLibraryData(...)}else{ // alternative approach ...}</pre></TD></TR></TABLE></CENTER><BR><BR><BR><P><A HREF = "#top">Back to top</a></p><A NAME="Errors"></A><H2>Errors</H2><H3>errInvalidPluginSubType</H3><P>Returned by the Printing Plug-ins Manager if the requested subtype is an invalid subtype. The only invalid subtype is the reserved subtype <CODE>'zsys'</CODE>.</P><H3>errInvalidPluginsCache</H3><P>Even though the Printing Plug-ins Manager validated its cache before using it, the cache was not valid. This should never happen, but there is explicit checking to return this error if it does.</P><H3>errInvalidPluginsClientDataVersion</H3><P>This error is returned if a caller of <CODE>psGetPreferredSubtypeLocators</CODE> passes in an invalid value for the argument <CODE>clientDataVersion</CODE>. Negative versions are reserved by the implementation and cannot be used by clients.</P><BR><P><A HREF = "#top">Back to top</a></p>                  <H2>Summary</H2>                  <P>The Printing Plug-ins Manager is used by the Download Manager supplied with LaserWriter 8 Version 8.6 to manage Printing Plug-ins, such as low-level converters, custom hoses and Desktop Printer Utility plug-ins. Developers may wish to use it for writing plug-ins for LaserWriter 8, such as low-level converters, which will be described in a future Technote. The APIs presented in this Technote are also needed to install a printing plug-in correctly.</p><a name="References"></a><H2>References</H2>    <p><A HREF = "tn1169.html">Technote 1169: The Download Manager</A></p>    <p><A HREF = "tn1165.html">Technote 1165: Introducing the LaserWriter 8 Driver Version 8.6.5</A></p>    <p><A HREF = "tn1144.html">Technote 1144: Writing Custom Hoses for LaserWriter 8.6</A></p>    <p><A HREF = "tn1143.html">Technote 1143: Introducing the LaserWriter 8 Driver Version 8.6</A></p>    <p><A HREF = "tn1113.html">Technote 1113: Customizing Desktop Printer Utility</A></p><BR><P><A HREF = "#top">Back to top</a></p><a name="Changes"></a><H2>Change History</H2><TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-April-1998</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-January-1999</P>               </TD>               <td align="left">                  <P>Revised.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>24-May-1999</P>               </TD>               <td align="left">                  <P>Revised yet again.</P>               </TD>            </Tr>         </TABLE><BR><p><A HREF = "#top">Back to top</a></p><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (68K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn1170.pdf">Download</A></P></TD>  </TR>   <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/bluebook.gif" width=22 height=23 align=bottom alt="Bluebook.gif"></P></TD><td align="left">   <p>Binhexed Routine Descriptor Lib (147K).</P></TD><td width=60 align=left>   <p><A HREF = "downloads/tn1170.1.hqx">Download</A></P></TD>  </TR>   </table></center>  <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1170.html%3Fid%3DDTS10003009-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1170.html%3Fid%3DDTS10003009-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1170.html%3Fid%3DDTS10003009-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>