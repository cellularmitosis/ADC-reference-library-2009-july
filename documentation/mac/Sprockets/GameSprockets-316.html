<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of NetSprocket (GameSprockets)</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" ="A" NAME="HEADING316"></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GameSprockets-315.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="GameSprockets-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="GameSprockets-318.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="GameSprockets-317.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GameSprockets-2.html"><B>Apple Game Sprockets Guide</B></A> / <BR><DD><A HREF="GameSprockets-229.html"><B>Chapter 4 - NetSprocket</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING316-0"></A>
<H1><A NAME="MARKER-2-159"></A>Summary of NetSprocket</H1>
<A NAME="HEADING316-1"></A>
<H2>Constants</H2>
<PRE>
#define  kNSpMaxPlayerNameLen          31
#define  kNSpMaxGroupNameLen           31
#define  kNSpMaxPasswordLen            31
#define  kNSpMaxGameNameLen            31
#define  kNSpMaxDefinitionStringLen    255
</PRE>
<A NAME="HEADING316-3"></A>
<H4>Network Message Priority Flags</H4>
<PRE>
enum {
   kNSpJunk                            = 0x10000000,
   kNSpNormal                          = 0x20000000,
   kNSpRegistered                      = 0x30000000
};
</PRE>
<A NAME="HEADING316-5"></A>
<H4>Network Message Delivery Flags</H4>
<PRE>
enum {
   kNSpFailIfPipeFull                  = 0x00000001,
   kNSpSelfSend                        = 0x00000002,
   kNSpBlocking                        = 0x00000004
};
</PRE>
<A NAME="HEADING316-7"></A>
<H4>Options for Hosting, Joining, and Ending Games</H4>
<PRE>
enum {
   kNSpGameFlag_DontAdvertise          = 0x00000001,
   kNSpGameFlag_ForceTerminateGame     = 0x00000002
};
</PRE>
<A NAME="HEADING316-9"></A>
<H4>Network Message Types</H4>
<PRE>
enum {
   kNSpSystemMessagePrefix       = 0x80000000,
   kNSpError                     = kNSpSystemMessagePrefix | 0x7FFFFFFF,
   kNSpJoinRequest               = kNSpSystemMessagePrefix | 0x00000001,
   kNSpJoinApproved              = kNSpSystemMessagePrefix | 0x00000002,
   kNSpJoinDenied                = kNSpSystemMessagePrefix | 0x00000003,
   kNSpPlayerJoined              = kNSpSystemMessagePrefix | 0x00000004,
   kNSpPlayerLeft                = kNSpSystemMessagePrefix | 0x00000005,
   kNSpHostChanged               = kNSpSystemMessagePrefix | 0x00000006,
   kNSpGameTerminated            = kNSpSystemMessagePrefix | 0x00000007
};
</PRE>
<A NAME="HEADING316-11"></A>
<H4>Reserved Player IDs for Network Messages</H4>
<PRE>
enum {
   kNSpAllPlayers                      = 0x00000000,
   kNSpServerOnly                      = 0xFFFFFFFF
};
</PRE>
<A NAME="HEADING316-13"></A>
<H4>Topology Types</H4>
<PRE>
typedef enum {
   kNSpClientServer                    = 0x00000001
} NSpTopology;
</PRE>
<A NAME="HEADING316-15"></A>
<H2>Data Types</H2>
<PRE>
typedef     SInt32      NSpEventCode;
typedef     SInt32      NSpGameID;
typedef     SInt32      NSpPlayerID;
typedef     NSpPlayerID NSpGroupID;
typedef     UInt32      NSpPlayerType;
typedef     SInt32      NSpFlags;
</PRE>
<A NAME="HEADING316-22"></A>
<H4>Opaque Game Reference Structures</H4>
<PRE>
typedef     struct      NSpGamePrivate    *NSpGameReference;
typedef     struct      NSpProtocolPrivate*NSpProtocolReference;
typedef     struct      NSpListPrivate    *NSpProtocolListReference;
typedef     struct      NSPAddressPrivate *NSpAddressReference;
</PRE>
<A NAME="HEADING316-27"></A>
<H4>Player Information Structure</H4>
<PRE>
typedef struct NSpPlayerInfo {
   NSpPlayerID                id;
   NSpPlayerType              type;
   Str31                      name;
   UInt32                     groupCount;
   NSpGroupID                 groups[kVariableLengthArray];
} NSpPlayerInfo, *NSpPlayerInfoPtr;
</PRE>
<A NAME="HEADING316-29"></A>
<H4>Player List Structure</H4>
<PRE>
typedef struct NSpPlayerEnumeration {
   UInt32                     count;
   NSpPlayerInfoPtr           playerInfo[kVariableLengthArray];
} NSpPlayerEnumeration, *NSpPlayerEnumerationPtr;
</PRE>
<A NAME="HEADING316-31"></A>
<H4>Group Information Structure</H4>
<PRE>
typedef struct NSpGroupInfo {
   NSpGroupID                 id;
   UInt32                     playerCount;
   NSpPlayerID                players[kVariableLengthArray];
} NSpGroupInfo, *NSpGroupInfoPtr;
</PRE>
<A NAME="HEADING316-33"></A>
<H4>Group Enumeration Structure</H4>
<PRE>
typedef struct NSpGroupEnumeration {
   UInt32                     count;
   NSpGroupInfoPtr            groups[kVariableLengthArray];
} NSpGroupEnumeration, *NSpGroupEnumerationPtr;
</PRE>
<A NAME="HEADING316-35"></A>
<H4>Game Information Structure</H4>
<PRE>
typedef struct NSpGameInfo {
   UInt32                     maxPlayers;
   UInt32                     currentPlayers;
   UInt32                     currentGroups;
   NSpTopology                topology;
   UInt32                     reserved;
   Str31                      name;
   Str31                      password;
} NSpGameInfo;
</PRE>
<A NAME="HEADING316-37"></A>
<H4>Message Header Structure </H4>
<PRE>
typedef struct NSpMessageHeader {
   UInt32                     version;
   SInt32                     what;
   NSpPlayerID                from;
   NSpPlayerID                to;
   UInt32                     id;
   UInt32                     when;
   UInt32                     messageLen;
} NSpMessageHeader;
</PRE>
<A NAME="HEADING316-39"></A>
<H4>Error Message Structure</H4>
<PRE>
typedef struct NSpErrorMessage {
   NSpMessageHeader           header;
   OSStatus                   error;
} NSpErrorMessage;
</PRE>
<A NAME="HEADING316-41"></A>
<H4>Join Request Message Structure</H4>
<PRE>
typedef struct NSpJoinRequestMessage {
   NSpMessageHeader           header;
   Str31                      name;
   Str31                      password;
   UInt32                     type;
   UInt32                     customDataLen;
   UInt8                      customData[kVariableLengthArray];
} NSpJoinRequestMessage;
</PRE>
<A NAME="HEADING316-43"></A>
<H4>Join Approved Message Structure</H4>
<PRE>
typedef struct NSpJoinApprovedMessage {
   NSpMessageHeader           header;
} NSpJoinApprovedMessage;
</PRE>
<A NAME="HEADING316-45"></A>
<H4>Join Denied Message Structure</H4>
<PRE>
typedef struct NSpJoinDeniedMessage {
   NSpMessageHeader           header;
   Str255    reason;
} NSpJoinDeniedMessage;
</PRE>
<A NAME="HEADING316-47"></A>
<H4>Player Joined Message Structure</H4>
<PRE>
typedef struct NSpPlayerJoinedMessage {
   NSpMessageHeader           header;
   UInt32                     playerCount;
   NSpPlayerInfo              playerInfo;
} NSpPlayerJoinedMessage;
</PRE>
<A NAME="HEADING316-49"></A>
<H4>Player Left Message Structure</H4>
<PRE>
typedef struct NSpPlayerLeftMessage {
   NSpMessageHeader           header;
   UInt32                     playerCount;
   NSpPlayerID                playerID;
} NSpPlayerLeftMessage;
</PRE>
<A NAME="HEADING316-51"></A>
<H4>Host Changed Message Structure</H4>
<PRE>
typedef struct NSpHostChangedMessage {
   NSpMessageHeader           header;
   NSpPlayerID                newHost;
} NSpHostChangedMessage;
</PRE>
<A NAME="HEADING316-53"></A>
<H4>Game Terminated Message Structure</H4>
<PRE>
typedef struct NSpGameTerminatedMessage {
   NSpMessageHeader           header;
} NSpGameTerminatedMessage;
</PRE>
<A NAME="HEADING316-55"></A>
<H2>NetSprocket Functions</H2>
<A NAME="HEADING316-56"></A>
<H4>Initializing NetSprocket</H4>
<PRE>
OSStatus NSpInitialize		(UInt32 inStandardMessageSize,
				UInt32 inBufferSize,
				UInt32 inQElements,
				NSpGameID inGameID,
				UInt32 inTimeout);

typedef pascal void (*NSpCallbackProcPtr)
				(NSpGameReference inGame,
				void *inContext,
				NSpEventCode inCode,
				OSStatus inStatus,
				void* inCookie);

OSStatus NSpInstallCallbackHandler (NSpCallbackProcPtr inHandler,
				void *inContext);
</PRE>
<A NAME="HEADING316-60"></A>
<H4>Human Interface Functions</H4>
<PRE>
NSpAddressReference NSpDoModalJoinDialog
				(ConstStr31Param inGameType,
				ConstStr31Param inEntityListLabel,
				Str31 ioName,
				Str31 ioPassword);

Boolean NSpDoModalHostDialog	(NSpProtocolListReference ioProtocolList,
				Str31 ioGameName,
				Str31 ioPlayerName,
				Str31 ioPassword);
</PRE>
<A NAME="HEADING316-63"></A>
<H4>Hosting and Joining a Game</H4>
<PRE>
OSStatus NSpGame_Host		(NSpGameReference *outGame, 
				NSpProtocolListReference inProtocolList,
				UInt32 inMaxPlayers, 
				ConstStr31Param inGameName, 
				ConstStr31Param inPassword, 
				ConstStr31Param inPlayerName, 
				NSpPlayerType inPlayerType, 
				NSpTopology inTopology, 
				NSpFlags inFlags);

OSStatus NSpGame_Join 	(NSpGameReference *outGame,
				NSpAddressReference inAddress,
				ConstStr31Param inName,
				ConstStr31Param inPassword,
				NSpPlayerType inType,
				Uint32 inUserDataLen,
				void *inUserData,
				NSpFlags inFlags);

OSStatus NSpGame_EnableAdvertising
				(NSpGameReference inGame,
				NSpProtocolReference inProtocol,
				Boolean inEnable);
				
OSStatus NSpGame_Delete		(NSpGameReference inGame,
				NSpFlags inFlags);

typedef pascal Boolean 		(*NSpJoinRequestHandlerProcPtr)
				(NSpGameReference inGame,
				NSpJoinRequestMessage *inMessage,
				void* inContext,
				Str255 outReason);

OSStatus NSpInstallJoinRequestHandler
				(NSpJoinRequestHandlerProcPtr inHandler,
				void *inContext);
</PRE>
<A NAME="HEADING316-70"></A>
<H4>Sending and Receiving Messages</H4>
<PRE>
OSStatus NSpMessage_Send	(NSpGameReference inGame,
				NSpMessageHeader *inMessage,
				NSpFlags inFlags);

NSpMessageHeader *NSpMessage_Get(NSpGameReference inGame);
				void NSpMessage_Release(NSpGameReference inGame,
				NSpMessageHeader *inMessage);

typedef pascal Boolean 	(*NSpMessageHandlerProcPtr)
				(NSpGameReference inGame,
				NSpMessageHeader *inMessage,
				void *inContext);

OSStatus NSpInstallAsyncMessageHandler (NSpMessageHandlerProcPtr inHandler,
					void *inContext);
</PRE>
<A NAME="HEADING316-76"></A>
<H4>Managing Network Protocols</H4>
<PRE>
OSStatus NSpProtocol_Create	(const char* inDefinitionString,
				NSpProtocolReference *outReference);
				void NSpProtocol_Delete(NSpProtocolReference inProtocolRef);

OSStatus NSpProtocol_ExtractDefinitionString
				(NSpProtocolReference inProtocolRef,
				char *outDefinitionString);

OSStatus NSpProtocolList_Create	(NSpProtocolReference inProtocolRef,
				NSpProtocolListReference *outList);

void NSpProtocolList_Delete	(NSpProtocolListReference inProtocolList);

OSStatus NSpProtocolList_Append	(NSpProtocolListReference inProtocolList,
				NSpProtocolReference inProtocolRef);

OSStatus NSpProtocolList_Remove	(NSpProtocolListReference inProtocolList,
				NSpProtocolReference inProtocolRef);

OSStatus NSpProtocolList_RemoveIndexed
				(NSpProtocolListReference inProtocolList,
				UInt32 inIndex);

UInt32 NSpProtocolList_GetCount	(NSpProtocolListReference inProtocolList);

NSpProtocolReference NSpProtocolList_GetIndexedRef
				(NSpProtocolListReference inProtocolList,
				UInt32 inIndex);

NSpProtocolReference NSpProtocol_CreateAppleTalk (ConstStr31Param inNBPName,
				ConstStr31Param inNBPType,
				UInt32 inMaxRTT,
				UInt32 inMinThruput);

NSpProtocolReference NSpProtocol_CreateIP 	(InetPort inPort,
				UInt32 inMaxRTT,
				UInt32 inMinThruput);
</PRE>
<A NAME="HEADING316-89"></A>
<H4>Managing Player Information</H4>
<PRE>
NSpPlayerID NSpPlayer_GetMyID	(NSpGameReference inGame);

OSStatus NSpPlayer_GetInfo	(NSpGameReference inGame,
				NSpPlayerID inPlayerID,
				NSpPlayerInfoPtr *outInfo);

void NSpPlayer_ReleaseInfo	(NSpGameReference inGame,
				NSpPlayerInfoPtr inInfo);

OSStatus NSpPlayer_GetEnumeration	(NSpGameReference inGame,
					NSpPlayerEnumerationPtr *outPlayers);

void NSpPlayer_ReleaseEnumeration	(NSpGameReference inGame,
					NSpPlayerEnumerationPtr inPlayers);

UInt32 NSpPlayer_GetRoundTripTime	(NSpGameReference inGame,
					NSpPlayerID inPlayer,
					UInt32 inTimeout);

UInt32 NSpPlayer_GetThruput	(NSpGameReference inGame,
				NSpPlayerID inPlayer,
				UInt32 inTimeout);
</PRE>
<A NAME="HEADING316-97"></A>
<H4>Managing Groups of Players</H4>
<PRE>
OSStatus NSpGroup_Create	(NSpGameReference inGame,
				NSpGroupID *outGroupID);

OSStatus NSpGroup_Delete	(NSpGameReference inGame,
				NSpGroupID inGroupID);

OSStatus NSpGroup_AddPlayer	(NSpGameReference inGame,
				NSpGroupID inGroupID,
				NSpPlayerID inPlayerID);

OSStatus NSpGroup_RemovePlayer	(NSpGameReference inGame,
				NSpGroupID inGroupID,
				NSpPlayerID inPlayerID);

OSStatus NSpGroup_GetInfo	(NSpGameReference inGame,
				NSpGroupID inGroupID,
				NSpGroupInfoPtr *outInfo);

void NSpGroup_ReleaseInfo	(NSpGameReference inGame,
				NSpGroupInfoPtr inInfo);

OSStatus NSpGroup_GetEnumeration	(NSpGameReference inGame,
					NSpGroupEnumerationPtr *outGroups);

void NSpGroup_ReleaseEnumeration	(NSpGameReference inGame,
					NSpGroupEnumerationPtr inGroups);
</PRE>
<A NAME="HEADING316-106"></A>
<H4>Utility Functions</H4>
<PRE>
void NSpClearMessageHeader	(NSpGameReference inGame,
				NSpMessageHeader *ioMessage);

UInt32 NSpGetCurrentTimeStamp	(NSpGameReference inGame);
			
NSpAddressReference NSpConvertOTAddrToAddressReference
				(OTAddress *inAddress);

OTAddress *NSpConvertAddressReferenceToOTAddr
				(NSpAddressReference inAddress);

void NSpReleaseAddressReference	(NSpAddressReference inAddress);
</PRE>
<A NAME="HEADING316-112"></A>
<H2>R<A NAME="MARKER-2-160"></A>esult Codes
<TABLE BORDER="0" CELLPADDING="3"><TD><CODE>noErr</CODE><TD>0<TD>No error<TR>
<TD><CODE>kNSpInitializationFailedErr</CODE><TD>-30360<TD>NetSprocket could not be initialized<TR>
<TD><CODE>kNSpAlreadyInitializedErr</CODE><TD>-30361<TD>NetSprocket has already been initialized<TR>
<TD><CODE>kNSpTopologyNotSupportedErr</CODE><TD>-30362<TD>The requested topology is unimplemented, or invalid value<TR>
<TD><CODE>kNSpMessageSizeTooBigErr</CODE><TD>-30363<TD>Current memory conditions prevent message from being sent<TR>
<TD><CODE>kNSpBufferTooSmallErr</CODE><TD>-30364<TD>The buffer allocated is too small to handle the data<TR>
<TD><CODE>kNSpReceiveDataErr</CODE><TD>-30365<TD>A problem occurred when attempting to receive data<TR>
<TD><CODE>kNSpProtocolNotAvailableErr</CODE><TD>-30366<TD>A protocol reference indicated a protocol that is unavailable<TR>
<TD><CODE>kNSpInvalidGameRefErr</CODE><TD>-30367<TD>An invalid game reference was passed<TR>
<TD><CODE>kNSpInvalidNetMessageErr</CODE><TD>-30368<TD>An invalid message was passed<TR>
<TD><CODE>kNSpInvalidParameterErr</CODE><TD>-30369<TD>A generic parameter error occurred<TR>
<TD><CODE>kNSpOTNotPresentErr</CODE><TD>-30370<TD>Open Transport is not installed or not installed correctly<TR>
<TD><CODE>kNSpHostFailedErr</CODE><TD>-30371<TD>An attemp to host a game failed<TR>
<TD><CODE>kNSpNotHostAddressErr</CODE><TD>-30372<TD>The address specified does not identify a NetSprocket host<TR>
<TD><CODE>kNSpMemAllocationErr</CODE><TD>-30373<TD>NetSprocket has run out of memory<TR>
<TD><CODE>kNSpAlreadyAdvertisingErr</CODE><TD>-30374<TD>The game is already being advertised on the specified protocol<TR>
<TD><CODE>kNSpNoTypeSpecifiedErr</CODE><TD>-30375<TD>An AppleTalk protocol reference that does not specify an NBP type was passed to the host<TR>
<TD><CODE>kNSpNotAdvertisingErr</CODE><TD>-30376<TD>The game is not being advertised at this time<TR>
<TD><CODE>kNSpInvalidAddressErr</CODE><TD>-30377<TD>An invalid address was passed<TR>
<TD><CODE>kNSpFreeQExhaustedErr</CODE><TD>-30378<TD>NetSprocket has exhausted its allocated queue elements and new messages will be dropped<TR>
<TD><CODE>kNSpRemovePlayerFailedErr</CODE><TD>-30379<TD>Your attempt to remove a player failed<TR>
<TD><CODE>kNSpAddressInUseErr</CODE><TD>-30380<TD>You are attempting to use an address that is already in use<TR>
<TD><CODE>NSpFeatureNotImplementedErr</CODE><TD>-30381<TD>You called a NetSprocket function that is not implemented<TR>
<TD><CODE>NSpNameRequiredErr</CODE><TD>-30382<TD>You atemped to join a game without specifying a player name<TR>
<TD>NSpInvalidPlayerIDErr<TD>-30383<TD>You tried to send a message to or get information about a player that is not currently in the game<TR>
<TD>NSpInvalidGroupIDErr<TD>-30384<TD>You tried to send a message to, or get information about a group that is not currently in the game<TR>
<TD>NSpNoPlayersErr<TD>-30385<TD>Returned by <CODE>NSpPlayer_Enumerate</CODE> when there are no players<TR>
<TD>NSpNoGroupsErr<TD>-30386<TD>Returned by <CODE>NSpGroup_Enumerate</CODE> when there are no groups<TR>
<TD>NSpNoHostVolunteersErr<TD>-30387<TD>Returned by <CODE>NSpGame_Delete</CODE> when called by a host and there are no other players capable of taking over the game<TR>
<TD>kNSpCreateGroupFailedErr<TD>-30388<TD>The attempt to creat a group failed<TR>
<TD>NSpAddPlayerFailedErr<TD>-30389<TD>An attempt to add a player to a group failed<TR>
<TD>NSpInvalidDefinitionErr<TD>-30390<TD>A invalid protocol definition string was passed to <CODE>NSpProtocol_Create</CODE><TR>
<TD>NSpInvalidProtocolRefErr<TD>-30391<TD>An invalid protocol reference was passed<TR>
<TD>NSpInvalidProtocolListErr<TD>-30392<TD>An invalid protocol list was passed<TR>
<TD>kNSpTimeoutErr<TD>-30393<TD>A time out error has occurred<TR>
<TD>kNSpGameTerminatedErr<TD>-30394<TD>An attempt to terminate the game has failed<TR>
<TD>kNSpConnectFailedErr<TD>-30395<TD>A connection attempt has failed<TR>
<TD>kNSpSendFailedErr<TD>-30396<TD>An attempt to send a message has failed<TR>
<TD>kNSpPortTakenErr<TD>-30397<TD>The port you attempted to use is already in use<TR>
<TD>kNSpNotPlayingErr<TD>-30398<TD>The player you sent a message to is not playing the game</TABLE>
</H2>
</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="GameSprockets-315.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="GameSprockets-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="GameSprockets-318.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="GameSprockets-317.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="GameSprockets-3.html">&copy; Apple Computer, Inc.</A><BR>2 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
