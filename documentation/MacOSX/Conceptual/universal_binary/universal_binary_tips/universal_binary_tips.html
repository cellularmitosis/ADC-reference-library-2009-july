<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Universal Binary Programming Guidelines, Second Edition: Guidelines for Specific Scenarios</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Guidelines for Specific Scenarios"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002217-CH239" title="Guidelines for Specific Scenarios"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index-date.html#//apple_ref/doc/uid/TP30000440-TP30000471" target="_top">Mac OS X</a> &gt; <a href="../universal_binary_intro/universal_binary_intro.html#//apple_ref/doc/uid/TP40002217-CH204-TPXREF101">Universal Binary Programming Guidelines, Second Edition</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_byte_swap/universal_binary_swap.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_vector/universal_binary_vector.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40002217-CH239-TPXREF101" title="Guidelines for Specific Scenarios"></a><h1>Guidelines for Specific Scenarios</h1>
<p>This chapter lists an assortment of scenarios that relate to a specific technology or API. Although many of these scenarios are uncommon, you will want to at least glance at the topics to determine whether anything applies to your application. The topics are organized alphabetically. </p>

<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-280527">Aliases</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBJIACH">Archived Bit Fields</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBGHFFD">Automator Scripts</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-294521">Bit Shifting</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-283008">Bit Test, Set, and Clear Functions: Carbon and POSIX</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-297992">CPU Subtype</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBEFGHC">Dashboard Widgets</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-297331">Deprecated Functions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBJIABG">Disk Partitions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-280753">Double-Precision Values: Bit-by-Bit Sensitivity</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBGDBAC">Finder Information and Low-Level File System Operations</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBCBJIB">FireWire Device Access</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBCCBDD">Font-Related Resources</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBDEIHA">GWorlds</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBGJDBB">Java Applications</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-282306">Java I/O API (NIO)</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-295019">Machine Location Data Structure</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBFIJGG">Mach Processes: The Task for PID Function</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBFHCHJ">Metrowerks PowerPlant</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBIHCFC">Multithreading</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBJABFC">Objective-C: Messages to nil</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-280661">Objective-C Runtime: Sending Messages</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-283936">Open Firmware</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBJDEAJ">OpenGL</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-291017">OSAtomic Functions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBHDFCB">Pixel Data</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-SW2">PostScript Printing</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBCHIAG">Quartz Bitmap Data</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBDHDDB">QuickDraw Routines</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBIIDGI">QuickTime Components</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBJEGFB">QuickTime Metadata Functions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBGCBHA">Runtime Code Generation</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-SW1">Spotlight Importers</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-BCICJCDG">System-Specific Predefined Macros</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBIIIIE">USB Device Access</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-CJBCHHBG">See Also</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002217-CH239-280527" title="Aliases"></a><h2>Aliases</h2>
<p>Aliases are big-endian on all systems. Applications that add extra information to the end of an <code>AliasHandle</code> must ensure that the extra data is always endian-neutral or of a defined endian type, preferably big-endian. </p>
<p>The <code>AliasRecord</code> data structure is opaque when building your application with the Mac OS X v10.4(Universal) SDK. Code that formerly accessed the <code>userType</code> field of an <code>AliasRecord</code> must use the Alias Manager functions <code>GetAliasUserType</code>, <code>GetAliasUserTypeFromPtr</code>, <code>SetAliasUserType</code>, or <code>SetAliasUserTypeFromPtr</code>. Code that formerly accessed the <code>aliasSize</code> field of an <code>AliasRecord</code> must use the functions <code>GetAliasSize</code> or <code>GetAliasSizeFromPtr</code>. </p>
<p>These Alias Manger functions are available in Mac OS X v10.4 and later. For more information, see <em><a href="../../../../Carbon/Reference/Alias_Manager/index.html#//apple_ref/doc/uid/TP30000146" target="_top">Alias Manager Reference</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-291864" title="Archived Bit Fields"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBJIACH" title="Archived Bit Fields"></a><h2>Archived Bit Fields</h2>
<p>For cross platform portability, avoid using bit fields.  It’s best not to use the <code>NSArchiver</code> class to archive any structures that contain bit fields as integers. Individual values are stored in the archives in an architecture and compiler dependent manner. In cases where archives already contain such structures, you can read a structure correctly by changing its declaration so that the bit fields are swapped appropriately</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297355" title="Automator Scripts"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBGHFFD" title="Automator Scripts"></a><h2>Automator Scripts</h2>
<p>AppleScript actions are platform-independent and do not need any changes to run on Intel-based Macintosh computers. However, any action that contains Cocoa code, whether it is a solely Cocoa action or an action that uses both AppleScript and Cocoa code, must be built as a universal binary to run correctly on both architectures.</p>
<p>For more information, see <em><a href="../../../../AppleApplications/Conceptual/AutomatorConcepts/index.html#//apple_ref/doc/uid/TP40001450" target="_top">Automator Programming Guide</a></em>. </p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-294521" title="Bit Shifting"></a><h2>Bit Shifting</h2>
<p>When you shift a value by the width of its type or more, the fill bits are undefined regardless of the architecture. In fact, two different compilers on the same architecture could differ on the value of <code>y</code> after these two statements:</p>
<p><code>uint32_t x = 0xDEADBEEF;</code></p>
<p><code>uint32_t y = x >> 32;</code></p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-283008" title="Bit Test, Set, and Clear Functions: Carbon and POSIX"></a><h2>Bit Test, Set, and Clear Functions: Carbon and POSIX</h2>
<p>Don’t mix using the C bitwise operators with the Carbon functions <code><a href="../../../../Carbon/Reference/Mathematical_al_Utilities/Reference/reference.html#//apple_ref/c/func/BitTst" target="_top">BitTst</a></code>, <code><a href="../../../../Carbon/Reference/Mathematical_al_Utilities/Reference/reference.html#//apple_ref/c/func/BitSet" target="_top">BitSet</a></code>,  and <code><a href="../../../../Carbon/Reference/Mathematical_al_Utilities/Reference/reference.html#//apple_ref/c/func/BitClr" target="_top">BitClr</a></code> and the POSIX macros <code>setbit</code>, <code>clrbit</code>, <code>isset</code>, and <code>isclr</code>. If you consistently use the Carbon and POSIX functions and avoid the C bitwise operators, your code will function properly. Keep in mind, however, that you must use the Carbon and POSIX functions on the correct kind of data. The Carbon and POSIX functions perform a byte-by-byte traversal, which causes problems on an Intel-based Macintosh when they operate on data types that are larger than 1 byte. You can use these functions only on a pointer to a string of endian-neutral bytes. When you need to perform bit manipulation on integer values you should use functions such as <code>(int32 &amp; (1 &lt;&lt; 26))</code> instead of <code>BitTst(&amp;int32, 5L</code>).</p>
<p>You’ll encounter problems when you use the function <code>BitTst</code> to test for 24-bit mode. For example, the following bit test returns <code>false</code>, which indicates that the process is running in 24-bit mode, or at least that the code is not running in 32-bit mode. The POSIX equivalents perform similarly:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Gestalt(gestaltAddressingModeAttr, &amp;gestaltResult);<span></span></pre></td></tr><tr><td scope="row"><pre>if (!(BitTst(&amp;gestaltResult,31L)) )      /*If 24 bit<span></span></pre></td></tr></table></div>
<p>You can use any of the bit testing, setting, and clearing functions if you pass a pointer to data whose byte order is fixed. Used in this way, these functions behave the same on both architectures.</p>
<p>For more information, see the <code>ToolUtils.h</code> header file in the Core Services framework and <em><a href="../../../../Carbon/Reference/Mathematical_al_Utilities/index.html#//apple_ref/doc/uid/TP30000236" target="_top">Mathematical and Logical Utilities Reference</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297992" title="CPU Subtype"></a><h2>CPU Subtype</h2>
<p>Don't try to build a binary for a specific CPU subtype. Since the CPU subtype for Intel-based Macintosh computers is generic, you can't use it to check for specific functionality. If your application requires information about specific CPU functionality, use the <code>sysctlbyname</code> function, providing an appropriate selector. See <em><a href="../../../../Darwin/Reference/ManPages/index.html#//apple_ref/doc/uid/TP40000894" target="_top">Mac OS X Man Pages</a></em> for information on using <code>sysctlbyname</code>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297385" title="Dashboard Widgets"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBEFGHC" title="Dashboard Widgets"></a><h2>Dashboard Widgets</h2>
<p>Dashboard widgets typically contain platform-independent elements such as HTML, JavaScript, CSS, and image files. If you create a widget that contains only these elements, it should work on both PowerPC and Intel-based Macintosh computers without any modification on your part. However, if your widget contains a plug-in, you must build the plug-in as a universal binary for it to run natively on an Intel-based Macintosh computer.</p>
<p>For more information, see <em><a href="../../../../AppleApplications/Conceptual/Dashboard_ProgTopics/index.html#//apple_ref/doc/uid/TP40002837" target="_top">Dashboard Programming Topics</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297331" title="Deprecated Functions"></a><h2>Deprecated Functions</h2>
<p>Many deprecated functions, such as those that use <code>PICT + PS</code> data, have byte swapping issues. You may want to replace deprecated functions at the same time you prepare your code to run as a universal binary. You’ll not only solve byte swapping issues, but your code will use functions that ultimately benefit future development.</p>
<p>A function that is deprecated has an availability statement in its header file that states the version of Mac OS X in which the function is deprecated. Many API reference documents provide a list of deprecated functions. In addition, compiler warnings for deprecated functions are on by default in Xcode 2.2 and later. </p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-283969" title="Disk Partitions"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBJIABG" title="Disk Partitions"></a><h2>Disk Partitions</h2>
<p>The standard disk partition format on an Intel-based Macintosh computer differs from the disk partition format of a PowerPC-based Macintosh computer. If your application depends on the partitioning details of the disk, it may not behave as expected. Partitioning details can affect tools that examine the hard disk at a low level.</p>
<p>By default, internal hard drives on Intel-based Macintosh computers use the GUID Partition Table (GPT) scheme and external drives use the Apple Partition Map (APM) partition scheme. To create an external USB or FireWire disk that can boot an Intel-based Macintosh computer, select the GPT disk partition scheme option using Apple Disk Utility. Starting up an Intel-based Macintosh using an APM disk is not supported.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280753" title="Double-Precision Values: Bit-by-Bit Sensitivity"></a><h2>Double-Precision Values: Bit-by-Bit Sensitivity</h2>
<p>Although both architectures are IEEE 754 compliant, there are differences in the rounding procedure used by each when operating on double-precision numbers. If your application is sensitive to bit-by-bit values in double-precision numbers, be aware that the same computation performed on each architecture may produce a different numerical result. </p>
<p>For more information, see Volume 1 of the Intel developer software manuals, available from the following website:</p>
<p><span class="content_text"><a href="http://developer.intel.com/design/Pentium4/documentation.htm" target="_blank">http://developer.intel.com/design/Pentium4/documentation.htm</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280710" title="Finder Information and Low-Level File System Operations"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBGDBAC" title="Finder Information and Low-Level File System Operations"></a><h2>Finder Information and Low-Level File System Operations</h2>
<p>If your code operates on the file system at a low level and handles Finder information, keep in mind that the file system does not swap bytes for the following information:</p>
<ul class="ul"><li class="li"><p>The <code>finderInfo</code> field in the HFSPlus data structures <code>HFSCatalogFolder</code>, <code>HFSPlusCatalogFolder</code>, <code>HFSCatalogFile</code>, <code>HFSPlusCatalogFile</code>, and <code>HFSPlusVolumeHeader</code>.</p></li>
<li class="li"><p>The <code>FSPermissionInfo</code> data structure, which is used when the constant <code>kFSCatInfoPermissions</code> is passed to the HFSPlus functions <code>FSGetCatalogInfo</code> and <code>FSGetCatalogInfoBulk</code>.</p></li></ul>
<p>The value of multibyte fields on disk always uses big-endian format. When running on a little-endian system, you must swap the bytes of any multibyte fields.</p>
<p>The <code>getattrlist</code> function retrieves the metadata associated with a file. The <code>getxattr</code> function, added in Mac OS X v10.4, retrieves extended attributes—those that are an extension of the basic set of attributes. When using the <code>getxattr</code> function to access the legacy attribute <code>"com.apple.FinderInfo"</code>, note that as with <code>getattrlist</code>, the information returned by this call is not byte swapped. (For more information on the <code>getxattr</code> and <code>getattrlist</code> functions see <em><a href="../../../../Darwin/Reference/ManPages/index.html#//apple_ref/doc/uid/TP40000894" target="_top">Mac OS X Man Pages</a></em>.)</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH239-SW3" title="Note"></a><p><strong>Note:</strong>&nbsp; This issue pertains only to code that operates below CarbonCore. Calls to Carbon functions such as <code>FSGetCatalogInfo</code> are not affected.</p></div>
<a name="//apple_ref/doc/uid/TP40002217-CH239-295126" title="FireWire Device Access"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBCBJIB" title="FireWire Device Access"></a><h2>FireWire Device Access</h2>
<p>The FireWire bus uses big-endian format. If you are developing a universal binary version of an application that accesses a FireWire device, see “FireWire Device Access on an Intel-Based Macintosh” in <em><a href="../../../../DeviceDrivers/Conceptual/WorkingWFireWireDI/index.html#//apple_ref/doc/uid/TP40000969" target="_top">FireWire Device Interface Guide</a></em> for a discussion of the issues you can encounter.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-296381" title="Font-Related Resources"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBCCBDD" title="Font-Related Resources"></a><h2>Font-Related Resources</h2>
<p>Font-related resource types (<code>FOND</code>, <code>NFNT</code>, <code>sfnt</code>, and so forth) are in big-endian format on both PowerPC and Intel-based Macintosh computers. If your application accesses font-related resource types directly, you must swap the fields of font-related resource types yourself.</p>
<p>The following functions from the ATS for Fonts API obtain font resources that are returned in big-endian format:</p>
<ul class="ul"><li class="li"><p><code><a href="../../../../Carbon/Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetTableDirectory" target="_top">ATSFontGetTableDirectory</a></code></p></li>
<li class="li"><p><code><a href="../../../../Carbon/Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetTable" target="_top">ATSFontGetTable</a></code></p></li>
<li class="li"><p><code><a href="../../../../Carbon/Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetFontFamilyResource" target="_top">ATSFontGetFontFamilyResource</a></code></p></li></ul>
<p>The following functions from the Font Manager API obtain font resources that are returned in big-endian format. Note that Font Manager API is based on QuickDraw technology, which was deprecated in Mac OS X v10.4.</p>
<ul class="ul"><li class="li"><p><code><a href="../../../../Carbon/Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontTableDirectory" target="_top">FMGetFontTableDirectory</a></code></p></li>
<li class="li"><p><code><a href="../../../../Carbon/Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontTable" target="_top">FMGetFontTable</a></code></p></li>
<li class="li"><p><code><a href="../../../../Carbon/Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyResource" target="_top">FMGetFontFamilyResource</a></code></p></li></ul>
<a name="//apple_ref/doc/uid/TP40002217-CH239-296415" title="GWorlds"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBDEIHA" title="GWorlds"></a><h2>GWorlds</h2>
<p>When the QuickDraw function <code><a href="../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NewGWorld" target="_top">NewGWorld</a></code> allocates storage for the pixel buffer, and the depth parameter is 16 or 32 bits, the byte ordering within each pixel matters. The <code>pixelFormat</code> field of the <code>PixMap</code> data structure can have the values <code>k16BE555PixelFormat</code> or <code>k16LE555PixelFormat</code> for 2-byte pixels, and <code>k32ARGBPixelFormat</code> or <code>k32BGRAPixelFormat</code> for 4-byte pixels. (These constants are defined in the <code>Quickdraw.h</code> header file.) By default, <code><a href="../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NewGWorld" target="_top">NewGWorld</a></code> always creates big-endian pixel formats (<code>k16BE555PixelFormat</code> or <code>k32ARGBPixelFormat</code>), regardless of the endian format of the system.</p>
<p>For best performance, it is generally preferable for you to use a pixel format that corresponds to the native byte ordering of the system. When you pass <code>kNativeEndianPixMap</code> in the <code>flags</code> parameter to <code><a href="../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NewGWorld" target="_top">NewGWorld</a></code>, the byte ordering of the pixel format is big-endian on big-endian systems, and little-endian on little-endian systems.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH239-SW4" title="Note"></a><p><strong>Note:</strong>&nbsp; QuickDraw does not support little-endian pixel formats on big-endian systems.</p></div>
<p>You can use the GWorld pixel storage as input to the Quartz function <code><a href="../../../../GraphicsImaging/Reference/CGBitmapContext/Reference/reference.html#//apple_ref/doc/c_ref/CGBitmapContextCreate" target="_top">CGBitmapContextCreate</a></code> or as a data provider for the Quartz function <code><a href="../../../../GraphicsImaging/Reference/CGImage/Reference/reference.html#//apple_ref/doc/c_ref/CGImageCreate" target="_top">CGImageCreate</a></code>. The byte ordering of the source pixel format needs to be communicated to Quartz through additional flags in the <code>bitmapInfo</code> parameter. These flags are defined in the <code>CGImage.h</code> header file. Assuming that your <code>bitmapInfo</code> parameter is already set up, you now need to combine it (by using a bitwise <code>OR</code> operator) with <code>kCGBitmapByteOrder16Host</code> or <code>kCGBitmapByteOrder32Host</code> if you created the GWorld with a <code>kNativeEndianPixMap</code> flag. Similarly, you should use <code>kCGBitmapByteOrder16Big</code> or <code>kCGBitmapByteOrder32Big</code> when you know that your pixel byte order is big-endian.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-296312" title="Java Applications"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBGJDBB" title="Java Applications"></a><h2>Java Applications</h2>
<p>Pure Java applications do not require any code changes to run on Intel-based Macintosh computers. However, Java applications that interface with PowerPC-based native code will not run successfully using Rosetta on Intel-based Macintosh computers.</p>
<p>Specifically, the following must be built as universal binaries:</p>
<ul class="ul"><li class="li"><p>JNI libraries built for PowerPC-based Macintosh computers are not loaded using Rosetta because the Java Virtual Machine has already launched without using Rosetta. Java applications fail on Intel-based Macintosh computers when trying to load PowerPC-only binaries.</p></li>
<li class="li"><p>Native applications that use the VM Invocation Interface to start a Java Virtual Machine must be built as universal binaries to run on Intel-based Macintosh computers. The Java VM must run natively; attempts by an application running using Rosetta to instantiate a JVM fail.</p></li></ul>
<p>For more information, see <em>Technical Q &amp;A QA1295: Java on Intel-based Macintosh Computers</em> in the <span class="content_text"><a href="../../../../../technicalqas/Java/index-title.html" target="_top">ADC Reference Library</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-282306" title="Java I/O API (NIO)"></a><h2>Java I/O API (NIO)</h2>
<p>The I/O API (NIO) that was introduced in JDK 1.4 allows the use of native memory buffers. If you are a Java programmer who uses this API, you may need to revise your code. NIO byte buffers have a byte ordering that by default is big-endian. If you have Java code originally written for Mac OS X on PowerPC, when you create <code>java.nio.ByteBuffers</code> you should call the function <code>ByteBuffer.order(ByteOrder.nativeOrder())</code> to set the byte order of the buffers to the native byte order for the current architecture. If you fail to do this, you will obtain flipped data when you read multibyte data from the buffer using JNI.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-295019" title="Machine Location Data Structure"></a><h2>Machine Location Data Structure</h2>
<p>The Memory Management Utilities data type <code>MachineLocation</code> contains information about the geographical location of a computer. The <code><a href="../../../../Carbon/Reference/Memory_Manag_nt_Utilities/Reference/reference.html#//apple_ref/c/func/ReadLocation" target="_top">ReadLocation</a></code> and <code><a href="../../../../Carbon/Reference/Memory_Manag_nt_Utilities/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/WriteLocation" target="_top">WriteLocation</a></code> functions use the geographic location record to read and store the geographic location and time zone information in extended parameter RAM.</p>
<p>If your code uses the <code>MachineLocation</code> data structure, you need to change it to use the <code>MachineLocation.u.dls.Delta</code> field that was added to the structure in Mac OS X version 10.0. </p>
<p>To be endian-safe, change code that uses the old field:</p>
<div class="codesample"><table><tr><td scope="row"><pre>MachineLocation.u.dlsDelta = 1;<span></span></pre></td></tr></table></div>
<p>to use the new field:</p>
<div class="codesample"><table><tr><td scope="row"><pre>MachineLocation.u.dls.Delta = 1;<span></span></pre></td></tr></table></div>
<p>The <code>gmtDelta</code> field remains the same—the low 24 bits are used. The order of assignment is important. The following is incorrect because it overwrites results:</p>
<div class="codesample"><table><tr><td scope="row"><pre>MachineLocation.u.dls.Delta = 0xAA;    // u = 0xAAGGGGGG; G=Garbage<span></span></pre></td></tr><tr><td scope="row"><pre>MachineLocation.u.gmtDelta = 0xBBBBBB;   // u = 0x00BBBBBB;<span></span></pre></td></tr></table></div>
<p>This is the correct way to assign the values:</p>
<div class="codesample"><table><tr><td scope="row"><pre>MachineLocation.u.gmtDelta = 0xBBBBBB;   // u = 0x00BBBBB;<span></span></pre></td></tr><tr><td scope="row"><pre>MachineLocation.u.dls.Delta = 0xAA;       // u = 0xAABBBBBB;<span></span></pre></td></tr></table></div>
<p>For more details see <em><a href="../../../../Carbon/Reference/Memory_Manag_nt_Utilities/index.html#//apple_ref/doc/uid/TP30000153" target="_top">Memory Management Utilities Reference</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297952" title="Mach Processes: The Task for PID Function"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBFIJGG" title="Mach Processes: The Task for PID Function"></a><h2>Mach Processes: The Task for PID Function</h2>
<p>The <code>task_for_pid</code> function returns the task associated with a process ID (PID). This function can be called only if the process is owned by the <code>procmod</code> group or if the caller is <code>root</code>. </p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280326" title="Metrowerks PowerPlant"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBFHCHJ" title="Metrowerks PowerPlant"></a><h2>Metrowerks PowerPlant</h2><p>You can use PowerPlant on an Intel-based Macintosh computer by downloading the PowerPlant framework available from <span class="content_text"><a href="http://sourceforge.net/projects/open-powerplant" target="_blank">http://sourceforge.net/projects/open-powerplant</a></span>. This Open Source version of the PowerPlant Framework for Mac OS X includes support for Intel and GCC 4.0.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-292250" title="Multithreading"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBIHCFC" title="Multithreading"></a><h2>Multithreading</h2>
<p>Multithreading is a technique used to improve performance and enhance the perceived responsiveness of applications. On computers with one processor, this technique can allow a program to execute multiple pieces of code <em>independently</em>. On computers with more than one processor, multithreading can allow a program to execute multiple pieces of code <em>simultaneously</em>. If your application is single-threaded, consider threading your application to take advantage of hardware multithreading processor capabilities. If your application is multithreaded, you’ll want to ensure that the number of threads is not hard coded to a fixed number of processors.</p>
<p>Dual-core technology improves performance by providing two physical cores within a single physical processor package. Multiprocessor and dual-core technology all exploit thread-level parallelism to improve application and system responsiveness and to boost processor throughput. </p>
<p>When you prepare code to run as a universal binary, the multithreading capabilities of the microprocessor are transparent to you. This is true whether your application is threaded or not. However, you can optimize your code to take advantage of the specific way hardware multithreading is implemented for each architecture. </p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297530" title="Objective-C: Messages to nil"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBJABFC" title="Objective-C: Messages to nil"></a><h2>Objective-C: Messages to nil</h2>
<p>In Objective-C, it is valid to send a message to a <code>nil</code> object. The Objective-C runtime assumes that the return value of a message sent to a <code>nil</code> object is <code>nil</code>, as long as the message returns an object or any integer scalar of size less than or equal to <code>sizeof(void*)</code>. </p>
<p>On Intel-based Macintosh computers, messages to a <code>nil</code> object always return <code>0.0</code> for methods whose return type is <code>float</code>, <code>double</code>, <code>long double</code>, or <code>long long</code>. Methods whose return value is a <code>struct</code>, as defined by the <em><a href="../../../../DeveloperTools/Conceptual/LowLevelABI/index.html#//apple_ref/doc/uid/TP40002521" target="_top">Mac OS X ABI Function Call Guide</a></em> to be returned in registers, will return <code>0.0</code> for every field in the data structure. Other <code>struct</code> data types will not be filled with zeros. This is also true under Rosetta. On PowerPC Macintosh computers, the behavior is undefined.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280661" title="Objective-C Runtime: Sending Messages"></a><h2>Objective-C Runtime: Sending Messages</h2>
<p>The information in this section is only for developers who use the Objective-C runtime library, which is used primarily for developing bridge layers between Objective-C and other languages, or for low-level debugging. Most developers do not need to use the Objective-C runtime library directly when programming in Objective-C. </p><p>If your application directly calls the Objective-C runtime function <code>objc_msgSend_stret</code>, you need to change your code to have it work correctly on an Intel-based Macintosh.</p>
<p>The x86 ABI for struct-return functions differs from the ABI for <code>struct-address-as-first-parameter</code> functions, but the two ABIs are identical on PowerPC. When you call <code>objc_msgSend_stret</code>, you must cast the function to a function pointer type that uses the expected <code>struct</code> return type. The same applies for calls to <code>objc_msgSendSuper_stret</code>. </p>
<p>For other details on the ABI, see <span class="content_text"><a href="../universal_binary_abi_32/universal_binary_abi_a.html#//apple_ref/doc/uid/TP40002217-CH246-TPXREF101">“32-Bit Application Binary Interface.”</a></span></p><p>If your application directly calls the Objective-C runtime function <code>objc_msgSend</code>, you should always cast to the appropriate return value. For instance, for a method that returns a <code>BOOL</code> data type, the following code executes properly on a PPC Macintosh but might not on an Intel-based Macintosh computer:</p><div class="codesample"><table><tr><td scope="row"><pre>BOOL isEqual = objc_msgSend(string, @selector("isEqual:"), otherString);<span></span></pre></td></tr></table></div><p>To ensure that the code does executes properly on an Intel-based Macintosh computer, you would change the code to the following:</p><div class="codesample"><table><tr><td scope="row"><pre>BOOL isEqual = ((BOOL (*)(id, SEL, id))objc_msgSend)(object, @selector("isEqual:"), otherString);<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH239-283936" title="Open Firmware"></a><h2>Open Firmware</h2>
<p>Macintosh computers that use an Intel microprocessor do not use Open Firmware. Although many parts of the I/O registry are present and work as expected, information that is provided by Open Firmware on a PowerPC Macintosh (such as a complete device tree) is not available in the I/O registry on a Macintosh that uses an Intel microprocessor. You can obtain some of the information from IODeviceTree by using the <code>sysctlbyname</code> or <code>sysctl</code> commands.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-292620" title="OpenGL"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBJDEAJ" title="OpenGL"></a><h2>OpenGL</h2>
<p>When defining an OpenGL image or texture, you need to provide a type that specifies to OpenGL which format the texture is in. Most of these functions (for example, <code>glTexImage2D</code>) take <code>format</code> and <code>type_</code> parameters that specify how the texture is laid out on disk or in memory. OpenGL supports a number of different image types; some are endian-neutral but others are not.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH239-SW5" title="Note"></a><p><strong>Note:</strong>&nbsp;The advice in this section is for applications that can not reorder their pixel data because of the type of image loaders they are using.</p></div>
<p>For example, a common image format is <code>GL_RGBA</code> with a type of <code>GL_UNSIGNED_BYTE</code>. This means that the image has a byte that specifies the red color data followed by a byte that specifies the green color data, and so forth. This format is not endian-specific; the bytes are in the same order on all architectures. Another common image format is <code>GL_BGRA</code>, often specified by the type <code>GL_UNSIGNED_INT_8_8_8_8_REV</code>. This type means that every 4 bytes of image data are interpreted as an <code>unsigned int</code>, with the most significant 8 bits representing the alpha data, the next most significant 8 bits representing the red color data, and so forth. Because this format is specific to the integer format of the host, the format is interpreted differently on little-endian systems than on big-endian systems. When using <code>GL_UNSIGNED_INT_8_8_8_8_REV</code>, the OpenGL implementation expects to find data in byte order ARGB on big-endian systems, but BGRA on little-endian systems.</p>
<p>Because there is no explicit way in OpenGL to specify a byte order of ARGB with 32-bit or 16-bit packed pixels (which are common image formats on Macintosh PowerPC computers), many applications specify <code>GL_BGRA</code> with <code>GL_UNSIGNED_INT_8_8_8_8_REV</code>. This practice works on a big-endian system such as PowerPC, but the format is interpreted differently on a little-endian system and causes images to be rendered with incorrect colors.</p>
<p>Applications that have this problem are those that use the OpenGL host-order format types, but assume that the data referred to is always big-endian. These types include, but are not limited to the following:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GL_SHORT<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT<span></span></pre></td></tr><tr><td scope="row"><pre>GL_INT<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_INT<span></span></pre></td></tr><tr><td scope="row"><pre>GL_FLOAT<span></span></pre></td></tr><tr><td scope="row"><pre>GL_DOUBLE<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_BYTE_3_3_2<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_4_4_4_4<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_5_5_5_1<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_INT_8_8_8_8<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_INT_10_10_10_2<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_5_6_5<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_BYTE_2_3_3_REV<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_5_6_5_REV<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_4_4_4_4_REV<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_SHORT_1_5_5_5_REV<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_INT_8_8_8_8_REV<span></span></pre></td></tr><tr><td scope="row"><pre>GL_UNSIGNED_INT_2_10_10_10_REV<span></span></pre></td></tr></table></div>
<p>If your application does not use any of these types, it is unlikely to have any problems with OpenGL. Note that an application is not necessarily incorrect to use one of these types. Many applications might already present host-order data tagged with one of these formats, especially with existing cross-platform code, because the Mac OS X implementation behaves the same way as a Windows implementation.</p>
<p>If an application incorrectly uses one of these types, its OpenGL textures and images are rendered with incorrect colors. For example, red might appear green, or the image might appear to be tinted purple.</p>
<p>You can fix this problem in one of the following ways:</p>
<ol class="ol"><li class="li"><p>If the images are generated or loaded algorithmically, change the code to generate the textures in host-order format that matches what OpenGL expects. For example, a JPEG decoder can be modified to store its output in 32-bit integers instead of four 8-bit bytes. The resulting data is identical on big-endian systems, but on a little-endian system, the bytes are in a different order. This matches the OpenGL expectation, and the existing OpenGL code continues to work on both architectures. This is the preferred approach.</p><p>In many cases, rewriting the algorithms may prove a significant amount of work to implement and debug. If that’s the case, an approach that asks OpenGL to interpret the texture data differently might be a better approach for you to take.</p></li>
<li class="li"><p>If the application uses <code>GL_UNSIGNED_INT_8_8_8_8_REV</code> or <code>GL_UNSIGNED_INT_8_8_8_8</code>, it can switch between them based on the architecture. Since these two types are exactly byte swapped versions of the same format, using <code>GL_UNSIGNED_INT_8_8_8_8_REV</code> on a big-endian system is equivalent to using <code>GL_UNSIGNED_INT_8_8_8_8</code> on a little-endian system and vice versa. Code might look as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_BGRA_EXT,<span></span></pre></td></tr><tr><td scope="row"><pre>#if __BIG_ENDIAN__<span></span></pre></td></tr><tr><td scope="row"><pre>                    GL_UNSIGNED_INT_8_8_8_8_REV,<span></span></pre></td></tr><tr><td scope="row"><pre>#else<span></span></pre></td></tr><tr><td scope="row"><pre>                    GL_UNSIGNED_INT_8_8_8_8,<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr><tr><td scope="row"><pre>                    data);<span></span></pre></td></tr></table></div><p>If this is a common idiom, it might be easiest to define it as a macro that can be used multiple times:</p><div class="codesample"><table><tr><td scope="row"><pre>#if __BIG_ENDIAN__<span></span></pre></td></tr><tr><td scope="row"><pre>#define ARGB_IMAGE_TYPE GL_UNSIGNED_INT_8_8_8_8_REV<span></span></pre></td></tr><tr><td scope="row"><pre>#else<span></span></pre></td></tr><tr><td scope="row"><pre>#define ARGB_IMAGE_TYPE GL_UNSIGNED_INT_8_8_8_8<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr><tr><td scope="row"><pre>/* later on, use it like this */<span></span></pre></td></tr><tr><td scope="row"><pre>glTexImage2D (GL_TEXTURE_2D, 0, GL_RGB,<span></span></pre></td></tr><tr><td scope="row"><pre>                width, height, 0, GL_BGRA_EXT,<span></span></pre></td></tr><tr><td scope="row"><pre>                ARGB_IMAGE_TYPE, data);<span></span></pre></td></tr></table></div><p>Note that switching between <code>GL_UNSIGNED_INT_8_8_8_8_REV</code> and <code>GL_UNSIGNED_INT_8_8_8_8</code> works only for this particular 32-bit packed-pixel data type. For 16-bit ARGB data stored using <code>GL_UNSIGNED_SHORT_1_5_5_5_REV</code>, there is no corresponding byte swapped type. Keep in mind that <code>GL_UNSIGNED_SHORT_5_5_5_1</code> is not a replacement for <code>GL_UNSIGNED_SHORT_1_5_5_5_REV</code> on an Intel-based Macintosh computer. The format is interpreted as bit-order <code>arrrrrbbbbbggggg</code> on a big-endian system, and as bit order <code>ggrrrrrabbbbbggg</code> on a little-endian system. </p></li>
<li class="li"><p>If you can’t use the previous approaches, you should either generate/load your data in the native endian format of the system and use the same pixel type on both architectures or use the <code>GL_UNPACK_SWAP_BYTES</code> pixel store setting to instruct OpenGL to swap the bytes of any texture loaded on a little-endian system. This setting applies to all texture or image calls made with the current OpenGL context, so it needs to be set only once per OpenGL context, for example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>#if __LITTLE_ENDIAN__<span></span></pre></td></tr><tr><td scope="row"><pre>            glPixelStorei(GL_UNPACK_SWAP_BYTES, 1);<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr></table></div><p>This method causes images that use the problematic formats to be loaded as they would be on PowerPC. You should consider this option only if no other option is available. Enabling this option causes OpenGL to use a slower rendering path than normal. Performance-sensitive OpenGL applications may be significantly slower with this option enabled than with it off. Although this method can get an OpenGL-based program up and running in as little time as possible, it is highly recommended that you use one of the other two methods.</p></li></ol>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH239-SW6" title="Note"></a><p><strong>Note:</strong>&nbsp;Using the <code>GL_UNSIGNED_INT_8_8_8_8</code> format for <code>GL_BGRA</code> data is not necessarily faster than using <code>GL_UNPACK_SWAP_BYTES</code>. In some cases, performance decreases for rendering textures that use either of those two methods compared to using a data type such as <code>GL_UNSIGNED_INT_8_8_8_8_REV</code>. It’s advisable that you use Shark or other tools to analyze the performance of your OpenGL code and make sure that you are not encountering particularly bad cases.</p></div>
<a name="//apple_ref/doc/uid/TP40002217-CH239-291017" title="OSAtomic Functions"></a><h2>OSAtomic Functions</h2>
<p>The kernel extension functions <code><a href="../../../../Darwin/Reference/KernelIOKitFramework/OSAtomic_h/index.html#//apple_ref/c/func/OSDequeueAtomic" target="_top">OSDequeueAtomic</a></code> and <code><a href="../../../../Darwin/Reference/KernelIOKitFramework/OSAtomic_h/index.html#//apple_ref/c/func/OSEnqueueAtomic" target="_top">OSEnqueueAtomic</a></code> are not available on an Intel-based Macintosh.</p>
<p>For more information on these functions, see <em><a href="../../../../Darwin/Reference/KernelIOKitFramework/index.html#//apple_ref/doc/uid/TP30000816" target="_top">Kernel Framework Reference</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280385" title="Pixel Data "></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBHDFCB" title="Pixel Data "></a><h2>Pixel Data </h2>
<p>Applications that store pixel data in memory using ARGB format must take care in how they read data. If the code is not written correctly, it’s possible to misread the data; the result is colors or alpha that appear wrong.</p>
<p>If you see colors that appear wrong when your application runs on an Intel-based Macintosh computer, the following strategy may help you identify where pixel data is being read incorrectly.</p>
<p>Create a test image whose pixel data is easy to identify. For example, set each pixel so that alpha is <code>ff</code>, red is <code>aa</code>, green is <code>bb</code>, and blue is <code>cc</code>. Then read that image into your application. <span class="content_text">Figure 4-1</span> shows such an image.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40002217-CH239-297126" title="Figure 4-1A test image that can help locate the source of color problems"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBBDDAE" title="Figure 4-1A test image that can help locate the source of color problems"></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>A test image that can help locate the source of color problems</p><img src = "../art/aabbcc.gif" alt = "A test image that can help locate the source of color problems" width="70" height="70"></div><br/>
<p>It's also helpful to go through your code and cast pixel data to the <code>unsigned char</code> data type.</p>
<p>Start with the portion of your code that reads the image. Use the following GDB command to examine the pixel data as hexadecimal bytes:</p>
<p> <code> x/&lt;number_bytes>xb &lt;address of first byte></code></p>
<p>This command prints the specified number of bytes, starting with the first byte of the first pixel. You should easily be able to see whether what’s displayed onscreen matches the values of the pixels in the test image. If the values you see do not match the test image, then you've identified the misreading problem. If the values match, then you need to identify other portions of your code that modify or transform pixel data, and inspect the pixel data after each transformation.</p><a name="//apple_ref/doc/uid/TP40002217-CH239-SW2" title="PostScript Printing"></a><h2>PostScript Printing</h2><p>If you are using the Carbon Printing Manager, note that the PICT with PostScript (<code>'pictwps'</code>) printing path is not available on Intel-based Macintosh computers except under Rosetta. If you need only to support EPS data you can use Quartz drawing together with the function <code>PMCGImageCreateWithEPSDataProvider</code> to allow the inclusion of EPS data as part of your Quartz drawing. If you need to generate the PostScript code for your application drawing you should use the function <code>PMPrinterPrintWithFile</code>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-296869" title="Quartz Bitmap Data"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBCHIAG" title="Quartz Bitmap Data"></a><h2>Quartz Bitmap Data</h2>
<p>The Quartz constants shown in <span class="content_text">Table 4-1</span> specify the byte ordering of pixel formats. These constants, which are defined in the <code>CGImage.h</code> header file, are used in the <code>bitmapInfo</code> parameter. To specify byte ordering to Quartz, use a bitwise <code>OR</code> operator to combine the appropriate constant with the <code>bitmapInfo</code> parameter. </p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-296903" title="Table 4-1Quartz constants that specify byte ordering"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBDGDGD" title="Table 4-1Quartz constants that specify byte ordering"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 4-1&nbsp;&nbsp;</strong>Quartz constants that specify byte ordering</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Constant</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Specifies</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kCGBitmapByteOrderMask</code></p></td>
<td ><p>The byte order mask</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder16Big</code></p></td>
<td ><p>16-bit, big-endian format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder32Big</code></p></td>
<td ><p>32-bit, big-endian format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder16Little</code></p></td>
<td ><p>16-bit, little-endian format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder32Little</code></p></td>
<td ><p>32-bit, little-endian format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder16Host</code></p></td>
<td ><p>16-bit, host-endian format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kCGBitmapByteOrder32Host</code></p></td>
<td ><p>32-bit, host-endian format</p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH239-282833" title="QuickDraw Routines"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBDHDDB" title="QuickDraw Routines"></a><h2>QuickDraw Routines</h2>
<p>If you have existing code that directly accesses the <code>picFrame</code> field of the QuickDraw <code>Picture</code> data structure, you should use the QuickDraw function <code><a href="../../../../Carbon/Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/QDGetPictureBounds" target="_top">QDGetPictureBounds</a></code> to get the appropriately swapped bounds for a <code>Picture</code>. This function is available in Mac OS X version 10.3 and later. Its prototype is as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Rect * QDGetPictureBounds(<span></span></pre></td></tr><tr><td scope="row"><pre>            PicHandle   picH,<span></span></pre></td></tr><tr><td scope="row"><pre>            Rect        *outRect)<span></span></pre></td></tr></table></div>
<p>If you have existing code that uses the QuickDraw <code><a href="../../../../Carbon/Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/DeltaPoint" target="_top">DeltaPoint</a></code> function or the HIToolbox <code><a href="../../../../Carbon/Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/PinRect" target="_top">PinRect</a></code> function (defined in <code>MacWindows.h</code>), make sure that you do not cast the function result to a <code>Point</code> data structure. The horizontal difference is returned in the low 16 bits, and the vertical difference is returned in the high 16 bits. You can obtain the horizontal and vertical values by using code similar to the following:</p>
<div class="codesample"><table><tr><td scope="row"><pre>    Point pointDiff;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32 difference = DeltaPoint (p1, p2);<span></span></pre></td></tr><tr><td scope="row"><pre>    pointDiff.h = LoWord (difference);<span></span></pre></td></tr><tr><td scope="row"><pre>    pointDiff.v = HiWord (difference);<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH239-SW7" title="Tip"></a><p><strong>Tip:</strong>&nbsp;The best solution is to convert your QuickDraw code to Quartz 2D. QuickDraw was deprecated starting in Mac OS X v10.4. For help with converting to Quartz 2D, see <em><a href="../../../../Carbon/Conceptual/QuickDrawToQuartz2D/index.html#//apple_ref/doc/uid/TP40001098" target="_top">Quartz Programming Guide for QuickDraw Developers</a></em>.</p></div>
<a name="//apple_ref/doc/uid/TP40002217-CH239-280796" title="QuickTime Components"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBIIDGI" title="QuickTime Components"></a><h2>QuickTime Components</h2>
<p>The Component Manager recognizes which architectures are supported by a component by looking at the <code>'thng'</code> resource for the component, not the architecture of the file. You must specify the appropriate architectures in the <code>'thng'</code> resource. To accomplish this, in the <code>.r</code> file where you define the <code>'thng'</code> resource, modify your <code>ComponentPlatformInfo</code> array to look similar to the following:</p>
<div class="codesample"><table><tr><td scope="row"><pre>#if defined(__ppc__)<span></span></pre></td></tr><tr><td scope="row"><pre>kMyComponentFlags, kMyCodeType, kMyCodeID, platformPowerPCNativeEntryPoint,<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr><tr><td scope="row"><pre>#if defined(__i386__)<span></span></pre></td></tr><tr><td scope="row"><pre>kMyComponentFlags, kMyCodeType, kMyCodeID, platformIA32NativeEntryPoint,<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr></table></div>
<p>Then, rebuild your component. For details, see <span class="content_text"><a href="../universal_binary_compiling/universal_binary_build.html#//apple_ref/doc/uid/TP40002217-CH206-TPXREF101">“Building a Universal Binary.”</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-297202" title="QuickTime Metadata Functions"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBJEGFB" title="QuickTime Metadata Functions"></a><h2>QuickTime Metadata Functions</h2>
<p>When you call the function <code><a href="../../../../QuickTime/Reference/QTRef_MovieProperties/Reference/reference.html#//apple_ref/doc/c_ref/QTMetaDataGetItemProperty" target="_top">QTMetaDataGetItemProperty</a></code> and the type of the key whose value you are retrieving is <code>code</code>, the data returned is an <code>OSType</code>, not a buffer of four characters. (You can determine the key type by calling the function <code><a href="../../../../QuickTime/Reference/QTRef_MovieProperties/Reference/reference.html#//apple_ref/doc/c_ref/QTMetaDataGetItemPropertyInfo" target="_top">QTMetaDataGetItemPropertyInfo</a></code>.) To ensure that your code runs properly on both PowerPC and Intel-based Macintosh computers, you must use a correctly-typed buffer so that the endian format of the data returned to you is correct. If you supply a buffer of the wrong type, for example a buffer of <code>UInt8</code> instead of a buffer of <code>OSType</code>, the endian format of the data returned in the buffer will be wrong on Intel-based Macintosh Computers.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-292540" title="Runtime Code Generation"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBGCBHA" title="Runtime Code Generation"></a><h2>Runtime Code Generation</h2>
<p>If your application generates code at runtime, keep in mind that the compiler assumes that the stack must be 16-byte aligned when calling into Mac OS X libraries or frameworks. 16-byte stack alignment is enforced on Intel-based Macintosh computers, which means that you need to ensure that your code is 16-byte aligned to avoid having your application crash.</p>
<p>For more information, see <em><a href="../../../../DeveloperTools/Conceptual/LowLevelABI/index.html#//apple_ref/doc/uid/TP40002521" target="_top">Mac OS X ABI Function Call Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP40002217-CH239-SW1" title="Spotlight Importers"></a><h2>Spotlight Importers</h2><p>A Spotlight importer is a plug-in bundle that extracts information from files created by an application. The Spotlight engine uses importers to gather information about new and existing files. Spotlight importers are not compatible with Rosetta. To run an importer on an Intel-based Macintosh as well as on a PowerPC-based Macintosh, you must compile it as a universal binary.</p><p>For more information on Spotlight, see <em><a href="../../../../Carbon/Conceptual/MetadataIntro/index.html#//apple_ref/doc/uid/TP40001268" target="_top">Spotlight Overview</a></em> and<em><a href="../../../../Carbon/Conceptual/MDImporters/index.html#//apple_ref/doc/uid/TP40001267" target="_top">Spotlight Importer Programming Guide</a></em>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-285821" title="System-Specific Predefined Macros"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-BCICJCDG" title="System-Specific Predefined Macros"></a><h2>System-Specific Predefined Macros</h2>
<p>The C preprocessor has several predefined macros whose purpose is to indicate the type of system and machine in use. If your code uses system-specific predefined macros, evaluate whether you really need to use them. In most cases applications need to know the capabilities available on a computer and not the specific system or machine on which the application is running. For example, if your application needs to know whether it is running on a little-endian or big-endian microprocessor, you should use the <code>__BIG_ENDIAN__</code> or <code>__LITTLE_ENDIAN__</code> macros or the Core Foundation function <code><a href="../../../../CoreFoundation/Reference/CFByteOrderUtils/Reference/reference.html#//apple_ref/doc/c_ref/CFByteOrderGetCurrent" target="_top">CFByteOrderGetCurrent</a></code>. Do not use the <code>__i386__</code> and <code>__ppc__</code> macros for this purpose.</p>
<p>See <em><a href="../../../../DeveloperTools/gcc-4.0.1/cpp/index.html#//apple_ref/doc/uid/TP40001839" target="_top">GNU C 4.0 Preprocessor User Guide</a></em> for additional information.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-295087" title="USB Device Access"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBIIIIE" title="USB Device Access"></a><h2>USB Device Access</h2>
<p>USB uses little-endian format. If you are developing a universal binary version of an application that accesses a USB device, see “USB Device Access in an Intel-Based Macintosh” in <em><a href="../../../../DeviceDrivers/Conceptual/USBBook/index.html#//apple_ref/doc/uid/TP40000973" target="_top">USB Device Interface Guide</a></em> for a discussion of the issues you may encounter.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH239-286469" title="See Also"></a><a name="//apple_ref/doc/uid/TP40002217-CH239-CJBCHHBG" title="See Also"></a><h2>See Also</h2>
<p>In addition to the following resources, check the ADC website periodically for updates and technical notes that might address other specific situations:</p>
<ul class="ul"><li class="li"><p><em><a href="../../../../Carbon/Conceptual/QuickDrawToQuartz2D/index.html#//apple_ref/doc/uid/TP40001098" target="_top">Quartz Programming Guide for QuickDraw Developers</a></em> which provides information on moving code from the deprecated QuickDraw API to Quartz</p></li>
<li class="li"><p><em>IA-32 Intel Architecture Optimization Reference Manual</em>, available from:</p><p> <span class="content_text"><a href="http://developer.intel.com/design/pentium4/manuals/index_new.htm" target="_blank">http://developer.intel.com/design/pentium4/manuals/index_new.htm</a></span></p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_byte_swap/universal_binary_swap.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_vector/universal_binary_vector.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_tips/universal_binary_tips.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_tips/universal_binary_tips.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_tips/universal_binary_tips.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>