<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Driver Initialization</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.21d.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.21d.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.21f.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3335"> </A>Driver Initialization</H1><P CLASS="T1.Text1"><A NAME="pgfId=3336"> </A> Any necessary driver initialization should be done by the port scanner before registering the driver. This insures that a device that is not usable does not get registered. For systems using the native driver architecture, Open Transport's port scanner will call <TT CLASS="cv">ValidateHardware</TT> before registering your port.</P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=14312"> </A>OTResult ValidateHardware (RegEntryIDPtr)</CODE><P CLASS="T1.Text1"><A NAME="pgfId=3339"> </A><A NAME="marker=14314"> </A>The parameter passed to the <TT CLASS="cv">ValidateHardware</TT> function depends on the port scanner being used. If the driver is able to change the power level of the device, it must use the <TT CLASS="cv">ValidateHardware</TT> function, setting the device to either low power or no power.</P><P CLASS="T1.Text1"><A NAME="pgfId=3340"> </A>Open Transport requires that <TT CLASS="cv">ValidateHardware</TT> be exported. When this function is called, it should validate that the hardware is correct for the driver and is in good working order. If the function returns <TT CLASS="cv">kENOENTErr</TT>, then the hardware is probably not the hardware for the driver and Open Transport will continue scanning for another driver. This is especially important for cards that do not have Open Firmware ROMs, because multiple vendors' drivers may end up with the same name and appear to be usable with each other's hardware.</P><P CLASS="T1.Text1"><A NAME="pgfId=3341"> </A>For information about Mac&nbsp;OS services available to support <TT CLASS="cv">ValidateHardware</TT>, see <A HREF="PCI_BOOK.8a.html#21936" CLASS="XRef">Driver Initialization and Resource Verification</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3370"> </A><TT CLASS="cv">ValidateHardware</TT> should return one of the following values:</P><TABLE border=1 cellpadding=3><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3347"> </A>kOTNoError</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3349"> </A>The hardware is OK. The device will be registered, and the driver may be unloaded from memory.</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="2"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3351"> </A>kOTPCINoErrorStayLoaded</CODE></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3355"> </A><TT CLASS="cv"></TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3357"> </A>The hardware is OK, the device will be registered, and the driver will not be unloaded from memory.</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3359"> </A>kENXIOErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3361"> </A>The hardware is correct for the driver but is not OK. The port will not be registered, and the driver will be unloaded from memory.</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3363"> </A>kENOENTErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3365"> </A>The hardware is probably not correct for the driver. The port will not be registered, and the driver will be unloaded. Open Transport will continue scanning for other drivers that might work with the hardware.</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3367"> </A>number &lt; 0</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3369"> </A>Any appropriate error code (such as <TT CLASS="cv">kENOMEMErr</TT>). The port will not be registered, and the driver will be unloaded.</FONT></TD></TR></TABLE><P CLASS="T1.Text1"><A NAME="pgfId=3371"> </A>If the <TT CLASS="cv">ValidateHardware</TT> function is not exported, Open Transport will proceed as if the function returned <TT CLASS="cv">kOTNoError</TT>.</P><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.21d.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.21d.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.21f.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>