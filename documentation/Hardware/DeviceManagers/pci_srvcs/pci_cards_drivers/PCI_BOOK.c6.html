<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Control and Status Routines</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c5.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c7.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=3917"> </A><A NAME="28628"> </A>Control and Status Routines</H1><P CLASS="T1.Text1"><A NAME="pgfId=3919"> </A><A NAME="marker=3918"> </A>Control and status routines are normally used to send and receive driver-specific information. However, you can use these routines for any kind of data transfer as long as you implement the minimum functionality described in this section. Control and status routines can execute synchronously or asynchronously, or immediate. </P><P CLASS="T1.Text1"><A NAME="pgfId=3923"> </A><A HREF="PCI_BOOK.c6.html#36653" CLASS="XRef">Listing&nbsp;8-8</A> shows a sample control routine, <TT CLASS="cv">DoControlCommand</TT>. </P><P CLASS="L.Listing"><B><A NAME="pgfId=3927"> </A>Listing&nbsp;8-8	<A NAME="36653"> </A>Sample driver control routine<A NAME="marker=3925"> </A><A NAME="marker=3926"> </A> </B></P><CODE CLASS="Cv.Code"><A NAME="pgfId=17516"> </A>MyDriverGlobalsPtr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gStore;<BR><BR>OSErr DoControlCommand (ParamBlkPtr pb)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;switch (pb-&gt;csCode)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kClearAll:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gStore-&gt;byteCount = 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gStore-&gt;lastErr = 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(noErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;&nbsp;&nbsp;&nbsp;/* always return controlErr for unknown csCode */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(controlErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}</CODE><P CLASS="T1.Text1"><A NAME="pgfId=3930"> </A>The control routine must return <TT CLASS="cv">controlErr</TT> for any <TT CLASS="cv">csCode</TT> values that are not supported. The status routine should work in a similar manner. The Device Manager uses the <TT CLASS="cv">csCode</TT> field to specify the type of status information requested. The status routine should respond to whatever requests are appropriate for the driver and return the error code <TT CLASS="cv">statusErr</TT> for any unsupported <TT CLASS="cv">csCode</TT> value.</P><P CLASS="T1.Text1"><A NAME="pgfId=3931"> </A>The Device Manager interprets a status request with a <TT CLASS="cv">csCode</TT> value of 1 as a special case. When the Device Manager receives such a status request, it returns a handle to the driver's device control entry. The driver's status routine never receives this request.</P><P CLASS="T1.Text1"><A NAME="pgfId=3935"> </A><A HREF="PCI_BOOK.c6.html#25071" CLASS="XRef">Listing&nbsp;8-9</A> shows a sample status routine, <TT CLASS="cv">DoStatusCommand</TT>.</P><P CLASS="L.Listing"><B><A NAME="pgfId=3939"> </A>Listing&nbsp;8-9	<A NAME="25071"> </A>Sample driver status routine<A NAME="marker=3937"> </A><A NAME="marker=3938"> </A> </B></P><CODE CLASS="Cv.Code"><A NAME="pgfId=17520"> </A>MyDriverGlobalsPtr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gStore;<BR><BR>OSErr DoStatusCommand (ParamBlkPtr pb)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;switch (pb-&gt;csCode)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kByteCount:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pb-&gt;csParam[0] = gStore-&gt;byteCount;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(noErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kLastErr:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pb-&gt;csParam[0] = gStore-&gt;lastErr;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(noErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;&nbsp;&nbsp;&nbsp;/* always return statusErr for unknown csCode */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(statusErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}</CODE><P CLASS="T1.Text1"><A NAME="pgfId=3943"> </A><A NAME="Device Manager"> </A>You can define driver-specific <TT CLASS="cv">csCode</TT> values if necessary, as long as they are within the range 0x80 through 0x7FFF.</P><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c5.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c7.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>