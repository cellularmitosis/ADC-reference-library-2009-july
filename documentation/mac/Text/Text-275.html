<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The Style-Mapping Table(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING275></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-274.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-276.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-181.html"><B>Chapter 4 - Font Manager</B></A> / <A HREF="Text-209.html"><B>Font Manager Reference</B></A><BR><DL><DD><A HREF="Text-269.html"><B>The Font Family ('FOND') Resource</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING275-0></A>
<H3><A NAME=MARKER-9-571></A>The Style-Mapping Table</H3>
 <A NAME=MARKER-2-392></A>The printer driver uses <I>font classes</I> to differentiate among the different methods of implementing font styles. The style-mapping table provides a flexible way to assign font classes and to specify character-set encodings. The table contains the font class, information about the character-encoding scheme that the font designer used, and a mechanism for obtaining the name of the appropriate printer font. The style-mapping table is primarily used by drivers for high-resolution printers such as the LaserWriter.<A NAME=MARKER-2-957></A><P>
 The font name suffix subtable and the glyph-encoding subtable that are part of the style-mapping table immediately follow it in the resource data. The font name suffix subtable contains the base font name and the suffixes that can be added to the font family's name to produce a real PostScript name (one that is recognized by the PostScript LaserWriter printer driver). The style-mapping table uses the suffix table to build a font name for a PostScript printer. The glyph-encoding table allows character codes to be mapped to PostScript glyph names. <A HREF=#MARKER-9-574>Figure 4-28</A> shows the structure of the style-mapping table.<P>
<B>Figure 4-28  <A NAME=MARKER-9-574></A>The style-mapping table</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FM-53.jpg">
 The header component of the style-mapping table contains a list of indexes into the font name suffix subtable, which is described below. The style-mapping table is represented by the <A NAME=MARKER-2-575></A><CODE>StyleTable</CODE> data type, which is shown on <A HREF=Text-219.html#MARKER-9-343>page 4-44</A>. The elements of this table are as follows.<P>
<UL>
<LI>Font class. An integer value that specifies a collection of flags that alert the printer driver to what type of PostScript font this font family is. This value is represented by the <A NAME=MARKER-2-576></A><CODE>fontClass</CODE> field of the <CODE>StyleTable</CODE> data type. For more information about how these flags are used, see the <I>LaserWriter Reference</I> book.<P>
The default font class definition is 0, which has settings that indicate the printer driver should derive the bold, italic, condense, and extend styles from the plain font. Intrinsic fonts are assigned classes (bits 2 through 8) that prevent these derivations from occurring. The meanings of the 16 bits of the <CODE>fontClass</CODE> word are as follows:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>0<TD>This bit is set to 1 if the font name needs coordinating.<TR>
<TD>&nbsp;<TD>1<TD>This bit is set to 1 if the Macintosh vector reencoding scheme is required. Some glyphs in the Apple character set, such as the Apple glyph, do not occur in the standard Adobe character set. This glyph must be mapped in from a font that has it, such as the Symbol font, to a font that does not, like Helvetica.<TR>
<TD>&nbsp;<TD>2<TD>This bit is set to 1 if the font family creates the outline style by changing PaintType, a PostScript variable, to 2.<TR>
<TD>&nbsp;<TD>3<TD>This bit is set to 1 if the font family disallows simulating the outline style by smearing the glyph and whiting out the middle.<TR>
<TD>&nbsp;<TD>4<TD>This bit is set to 1 if the font family does not allow simulation of the bold style by smearing the glyphs.<TR>
<TD>&nbsp;<TD>5<TD>This bit is set to 1 if the font family simulates the bold style by increasing point size.<TR>
<TD>&nbsp;<TD>6<TD>This bit is set to 1 if the font family disallows simulating the italic style.<TR>
<TD>&nbsp;<TD>7<TD>This bit is set to 1 if the font family disallows automatic simulation of the condense style.<TR>
<TD>&nbsp;<TD>8<TD>This bit is set to 1 if the font family disallows automatic simulation of the extend style.<TR>
<TD>&nbsp;<TD>9<TD>This bit is set to 1 if the font family requires reencoding other than Macintosh vector encoding, in which case the glyph-encoding table is present.<TR>
<TD>&nbsp;<TD>10<TD>This bit is set to 1 if the font family should have no additional intercharacter spacing other than the space character.<TR>
<TD>&nbsp;<TD>11-15<TD>Reserved. Should be set to 0.</TABLE>

<LI>Offset. A long integer value that specifies the offset from the start of this table to the glyph-encoding subtable component. This value is represented by the <A NAME=MARKER-2-577></A><CODE>offset</CODE> field of the <CODE>StyleTable</CODE> data type.
<LI>Reserved. A long integer element reserved for use by Apple Computer, Inc.
<LI>Index to font name suffix subtable. This is an array of 48 integer index values, each of which is a location in the naming table. The value of the first element is an index into the naming table for the string name for style code 0; the value of the forty-eighth element is an index into the naming table for the string name for style code 47. This array is represented by the <A NAME=MARKER-2-578></A><CODE>indexes</CODE> field of the <CODE>StyleTable</CODE> data type.<P>
</UL>
<A NAME=HEADING275-11></A>
<H4><A NAME=MARKER-9-579></A>The Font Name Suffix Subtable</H4>
 The font name suffix subtable is part of the style-mapping table. This subtable contains the base font name and the suffixes that can be added to the font family's name to produce a real PostScript name (that is, one that is recognized by the PostScript printer driver). This subtable is represented by the <CODE><A NAME=MARKER-2-10></A>NameTable</CODE> data type, which is described on <A HREF=Text-219.html#MARKER-9-343>page 4-44</A>. It consists of the following elements:<P>
<UL>
<LI>String count. An integer value that specifies the number of strings in the array of suffixes. This value is represented by the <A NAME=MARKER-2-322></A><CODE>stringCount</CODE> field of the <CODE>NameTable</CODE> data type.
<LI>Base font name. The font family name in a 256 byte long Pascal string. This value is represented by the <A NAME=MARKER-2-324></A><CODE>baseFontName</CODE> field of the <CODE>NameTable</CODE> data type.
<LI>Strings. A variable length array of Pascal strings, each of which contains the suffixes or numbers specifying which suffixes to put together to produce the real PostScript name. This array is represented by the <CODE>strings</CODE> field of the <CODE>NameTable</CODE> data type. This section describes the format of these strings and provides an example of using this subtable.<P>
</UL>
 Each of the strings in the string list contains a sequence of one-byte values, the first of which specifies how many other bytes follow, and each of the following contains an index value. To form the complete name of a font, the base name is concatenated with each of the strings whose index is in the string.<P>
 For an example of how this table works, consider the PostScript name of the bold-italic version of the font ExampleFont. Here are the strings of the font name suffix subtable for this font:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Index<TH>Contents<TR>
<TD>1<TD>'ExampleFont'<TR>
<TD>2<TD>$02 $09 $0A<TR>
<TD>3<TD>$02 $09 $0B<TR>
<TD>4<TD>$03 $09 $0A $0B<TR>
<TD>5<TD>$02 $09 $0C<TR>
<TD>6<TD>$04 $09 $0C $09 $0A<TR>
<TD>7<TD>$04 $09 $0C $09 $0B<TR>
<TD>8<TD>$05 $09 $0C $09 $0A $0B<TR>
<TD>9<TD>-<TR>
<TD>10<TD>'Bold'<TR>
<TD>11<TD>'Oblique'<TR>
<TD>12<TD>'Narrow'</TABLE>
<P>
 QuickDraw has assigned the bold-italic style the number $03; since the base font name is the first entry in this array, you need to access the entry at <I>i</I>+1, where <I>i</I> is the style value. So, for the bold-italic style, you look at the fourth string. The first byte in this string is $03, which indicates that three string indexes follow.<P>
<UL>
<LI>The first index is $09, which produces the string <CODE>'-'</CODE>.
<LI>The second index is $0A, which produces the string <CODE>'Bold'</CODE>.
<LI>The third index is $0B, which produces the string <CODE>'Oblique'</CODE>.<P>
</UL>
 By concatenating them together with the base font name, you produce the font name string "ExampleFont-BoldOblique". If the LaserWriter printer driver cannot find the font on the printer, it looks for the font: in version 7.1 and later of system software, the driver looks in the "Fonts" folder; in earlier versions of system software, it first looks in the folder where the driver code is located, then in the System Folder. If the font is there, the driver sends it to the printer. If it is not, the driver sends a QuickDraw bitmap that has already been scaled to the correct size.<P>
 <A HREF=#MARKER-9-583>Listing 4-4</A> provides a function for using the style table to build a full PostScript font name.<P>
<B>Listing 4-4  <A NAME=MARKER-9-583></A>Using the style-mapping table to build a PostScript font name</B><P>
<PRE>
TYPE
   IntegerPtr = ^Integer;
   FamRecPtr = ^FamRec;
   FamRecHdl = ^FamRecPtr;
   StyleTablePtr = ^StyleTable;

FUNCTION MyCompressStyle (aStyle: Style): Integer;
   {A "Set of StyleItem" is mapped into [0..47],}
   {assuming that condense and extend are mutually exclusive}

VAR
   styleCode: Integer;

BEGIN
   styleCode := 0;
   IF bold IN aStyle THEN
      styleCode := styleCode + 1;
   IF italic IN aStyle THEN
      styleCode := styleCode + 2;
   IF outline IN aStyle THEN
      styleCode := styleCode + 4;
   IF shadow IN aStyle THEN
      styleCode := styleCode + 8;
   IF condense IN aStyle THEN
      styleCode := styleCode + 16
   ELSE IF extend IN aStyle THEN
      styleCode := styleCode + 32;
   MyCompressStyle := styleCode;
END;


FUNCTION MyNthStyleName (index: Integer; q: Ptr): Str255;

VAR
   s: Str255;

BEGIN
   WHILE index &gt; 1 DO
      BEGIN
      q := Ptr(ord(q) + q^ + 1);
                     { assumes q^ = stringlength &lt; 128 ...}
      index := index - 1;
      END;
   BlockMove(q, @s[0], q^ + 1);
                     { assumes q^ = stringlength &lt; 127 ...}
   MyNthStyleName := s;
END;


FUNCTION MyPSFontName(fh: FamRecHdl; aStyle: Style): Str255;
VAR
   stp: StyleTablePtr;
   q: Ptr;     { pointer to Style-name table. }
               { This is not a Pascal structure. }
   PSName, suffixIndices: Str255;
   i, nbOfStrings, offset, whichIndex: Integer;
BEGIN
   PSName := '';
   offset := fh^^.ffStylOff;
   IF offset &gt; 0 THEN
      BEGIN
      stp := StyleTablePtr(ord(fh^) + offset);
      q := Ptr(ord(stp) + SizeOf(StyleTable));
               { style-name table follows style-mappingTable}
      nbOfStrings := IntegerPtr(q)^; 
            { for range checking below }
      q := Ptr(ord(q) + 2);
               { now pointing to basename of font }
      BlockMove(q, @PSName, q^ + 1);
               { basename of font; assumes length &lt; 128 }
      whichIndex := stp^.indexes[MyCompressStyle(aStyle)];
      IF (whichIndex &gt; 1) AND (whichIndex &lt;= nbOfStrings) THEN
         BEGIN
         suffixIndices := MyNthStyleName(whichIndex, q);
         FOR i := 1 TO ord(suffixIndices[0]) DO
            PSName := concat(PSName,
                  MyNthStyleName(ord(suffixIndices[i]), q));
         END
      ELSE { corrupted FOND };
      END
   ELSE { no style mapping table in FOND };
   MyBuildPSFontName := PSName;
END;
</PRE>
<A NAME=HEADING275-28></A>
<H4><A NAME=MARKER-9-584></A><A NAME=MARKER-2-595></A>The Glyph-Name Encoding Subtable</H4>
 The glyph-name encoding subtable of the style-mapping table allows the font family designer to map 8-bit character codes to PostScript glyph names. This subtable is required when the font family character set is not the Standard Roman character set or the standard Adobe character set. Each entry in this table is a Pascal string, the first byte of which is the character code that is being mapped, and the remaining bytes of which specify the PostScript glyph name.<P>
 There is no data type defined to represent the glyph-encoding subtable. The elements of this subtable are as follows:<P>
<UL>
<LI>String count. An integer value that specifies the number of entries in the encoding subtable.
<LI>Strings. A variable length array of Pascal strings. The first byte of each string is an eight-bit character code, and the remaining bytes are the name of a PostScript glyph. This section beginning on <A HREF=#MARKER-9-584>page 4-98</A>, provides an example of using this table.<P>
</UL>
 The following example demonstrates the use of an encoding table in a font resource:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Byte sequence<TH>Use<TR>
<TD>$0002<TD>The number of entries in this encoding table.<TR>
<TD>$A8<TD>The character code of the first character that is being remapped.<TR>
<TD>'diamond'<TD>The name of the PostScript character to be used for character code $A8.<TR>
<TD>$A9<TD>The character code of the second (and last) character that is being remapped.<TR>
<TD>'heart'<TD>The name of the PostScript character to be used for character code $A9.</TABLE>
<P>
 The effect of this table is to assign the PostScript character named diamond to the character code $A8 and to assign the PostScript character named heart to the character code $A9. If either of these character codes has a character assigned to it in the font, that character is replaced by the PostScript character named in the table.<P>
 For more information about the font name suffix subtable and the glyph-name encoding table, please see the <I>LaserWriter Reference</I>. <A NAME=MARKER-2-586></A><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-274.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-276.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
