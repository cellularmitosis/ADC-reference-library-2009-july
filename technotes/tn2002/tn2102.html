<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html><head>
<!-- BEGIN META TAG INFO -->
<link rel="home" href="http://developer.apple.com/">
<link rel="find" href="http://developer.apple.com/search/">
<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
<script language="JavaScript" type="text/javascript" src="../../documentation/js/busnav.js"></script>
<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- END META TAG INFO -->
<!-- BEGIN TITLE -->
<title>Technical Note TN2102: The System Sound APIs for Mac OS X 10.2, 10.3 and later</title>
<!-- END TITLE -->
</head>
<!-- BEGIN BODY OPEN -->
<body bgcolor="#ffffff"><a name="//apple_ref/doc/uid/DTS10003206" title="The System Sound APIs for Mac OS X 10.2, 10.3 and later"></a>
<!--END BODY OPEN -->
<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->
<a name="top"></a>
<!-- BEGIN LOGO AND SEARCH -->
<!--#include virtual="/includes/adcnavbar"-->
<!-- END LOGO AND SEARCH -->
<!-- START BREADCRUMB -->
<div id="breadcrumb"><table width="680" border="0" cellpadding="0" cellspacing="0"><tr>
<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
<td><img width="340" height="10" src="images/1dot.gif" alt=""></td></tr><tr valign="middle"><td align="left" colspan="2">
<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/MusicAudio/index.html">Audio</a> &gt; <a href="../../technicalnotes/MusicAudio/idxCarbon-date.html">Carbon</a> &gt; 
</td></tr><tr><td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td></tr></table></div>
<!-- END BREADCRUMB -->

<!-- START MAIN CONTENT -->
<!-- START TITLE GRAPHIC AND INTRO-->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top">
<td><h1>
<div id="pagehead">Technical Note TN2102</div>
<div id="pageheadsub">The System Sound APIs for Mac OS X 10.2, 10.3 and later</div>
</h1></td></tr></table>
<!-- END TITLE GRAPHIC AND INTRO -->
<!-- BEGIN WIDE COLUMN -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td align="left" width="680">
<!-- BEGIN CONTENTS -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td><p>This technote discusses the System Sound APIs for correctly playing Alerts and User Interface Sound Effects available in SystemSound.h on Mac OS X 10.2, 10.3 and later.</p></td></tr><tr><td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td width="680"><ul><li><a href="#TNTAG1">Introduction</a></li><li><a href="#TNTAG5">The System Sound APIs</a></li><li><a href="#TNTAG4">Alert Sounds</a></li><li><a href="#TNTAG6">User Interface Sound Effects</a></li><li><a href="#TNTAG7">Creating SystemSoundActionIDs</a></li><li><a href="#TNTAG8">Completion Routines</a></li><li><a href="#TNTAG9">Example Usage</a></li><li><a href="#TNT_HISTORY_TAG">Document Revision History</a></li></ul></td></tr><tr><td colspan="3" scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><A NAME="TNTAG1"></A><H2>Introduction</H2><p>Mac OS X allows users to personally select their preferred audio device for Alerts and Sound Effects (the <strong>Default System Output Device</strong>), as well as the sound output device for all other audio generated by the system (the <strong>Default Output Device</strong>). These can either be set to the same device (for example Internal speakers) or two completely different devices.</p><p>The System Sound API allows developers to correctly play Alert Sounds with all the attributes and respecting all system settings for Alerts. This includes flashing the screen in circumstances where audio output is unavailable or because of a user specified preference such as Mute or the Universal Access Hearing Preference &quot;Flash the screen when an alert sound occurs&quot;.</p><p>System Sound also allows developers to correctly play User Interface Sound Effects if the &quot;Play user interface sound effects&quot; checkbox is checked (see Figure 1).</p><p>In both cases, the audio will be directed to the <strong>Default System Output Device</strong> selected for Alerts and Sound Effects.</p><p>Figure 1 shows the <strong>Default System Output</strong> device for Alert Sounds and Sound Effects (selected from the &quot;Play alerts and sound effects through:&quot; popup) set to Internal speakers, while figure 2 shows the chosen <strong>Default Output Device</strong> set to the EDIROL UA-3D USB device.</p><p>A typical user configuration may be iTunes playing purchased music out a pair of USB speakers (<strong>Default Output Device</strong>) while Alerts and Sound Effects play though the Internal speakers (<strong>Default System Output Device</strong>). Using the System Sound APIs will guarantee that your application never plays an Alert or Sounds Effect out the wrong device, possibly a pair of speakers turned up very loud blasting SpinalTap's greatest hits.</p><div class="notebox"><p><strong>Note:</strong> If your application makes use of alert sounds, using the System Sound APIs is a better approach than using some heavier weight methods to play these sound such as NSSound or QuickTime.</p></div><A NAME="TNTAG2"></A><p class="caption"><strong>Figure 1:</strong> Alerts and Sound Effects.</p><p><img  src="images/tn2102_001.jpg" width="595" height="510" alt="Figure 1, Alerts and Sound Effects."></p><p class="caption"><strong>Figure 2:</strong> Sound Output.</p><p><img  src="images/tn2102_002.jpg" width="595" height="510" alt="Figure 2, Sound Output."></p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG5"></A><H2>The System Sound APIs</H2><p>The following APIs are defined in &quot;SystemSound.h&quot;, part of the OSServices framework, which in turn is part of the CoreServices umbrella framework.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG4"></A><H2>Alert Sounds</H2><p><strong>(available on Mac OS X 10.2 and later)</strong></p><p>There are two APIs for playing Alert Sounds.</p><p><code>AlertSoundPlay</code> (available on Mac OS X 10.2 and later) equates to and supersedes the traditional Mac OS call <code>SysBeep</code>. It takes no parameters and will play the currently selected alert sound out the selected <strong>Default System Output Device</strong> (see <A HREF="#TNTAG2">Figure 1</A>). This call will interrupt any previously playing alert sound.</p><pre class="sourcecodebox">
void AlertSoundPlay(void);
</pre><p><code>AlertSoundPlayCustomSound</code> (available on Mac OS X 10.3 and later) takes a <code><code>SystemSoundActionID</code></code> and will play an alert sound designated by this actionID with the same behavior as <code>AlertSoundPlay</code>.</p><pre class="sourcecodebox">
void AlertSoundPlayCustomSound(SystemSoundActionID inAction)

inAction: A SystemSoundActionID indicating the desired
          Sound to be played with AlertSound behavior.
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG6"></A><H2>User Interface Sound Effects</H2><p><strong>(available on Mac OS X 10.3 and later)</strong></p><p>There is a single API for playing User Interface Sound Effects.</p><p><code>SystemSoundPlay</code> takes a <code><code>SystemSoundActionID</code></code> and will immediately play the sound designated by this actionID out the selected <strong>Default System Output Device</strong> (see <A HREF="#TNTAG2">Figure 1</A>). This call should be used for one time user interface actions that do not require a duration or modification during playback. Sustain loops in the sound will be ignored.</p><div class="notebox"><p><strong>WARNING:</strong> <code>SystemSoundPlay</code> was actually exported in Mac OS X 10.2 and SystemSound.h says that it is available on Mac OS X 10.2.</p><p>Although technically correct, calling <code>SystemSoundPlay</code> on Mac OS X 10.2.x causes an immediate crash. While this behavior can be mildly amusing it is not really very useful (we think you may agree), therefore this technical note has marked <code>SystemSoundPlay</code> as available on Mac OS X 10.3 and later.</p></div><pre class="sourcecodebox">
void SystemSoundPlay(SystemSoundActionID inAction)

inAction: A SystemSoundActionID indicating the desired
          System Sound to be played.
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG7"></A><H2>Creating SystemSoundActionIDs</H2><p><strong>(available on Mac OS X 10.2 and later)</strong></p><p>There are two APIs for working with <code>SystemSoundActionIDs</code>.</p><p><code><code>SystemSoundGetActionID</code></code> allows you to create a 'custom' sound <code><code>SystemSoundActionID</code></code> by providing an audio file. Use this call to add a sound to the System Sound Server that can be played via <code>SystemSoundPlay</code> or <code>AlertSoundPlayCustomSound</code>. This call takes an FSRef * designating the audio file and if successful will return a <code><code>SystemSoundActionID</code></code>.</p><pre class="sourcecodebox">
OSStatus SystemSoundGetActionID(
  const FSRef * userFile,
  SystemSoundActionID * outAction)

userFile: An const FSRef * for the audio file to be used as a System Sound.
          Any audio file supported by the AudioFile APIs in the
          AudioToolbox framework may be used.

outAction: If successful, a SystemSoundActionID will be returned,
           which in turn can be passed to SystemSoundPlay() or
           AlertSoundPlayCustomSound().
</pre><p><code>SystemSoundRemoveActionID</code> allows you to remove a 'custom' sound. Use this call when you no longer need to use the 'custom' sound that was created by <code><code>SystemSoundGetActionID</code></code>. You must remember to call this funtion so the System Sound Server can release resources that are no longer needed. This call takes a single <code><code>SystemSoundActionID</code></code> parameter.</p><pre class="sourcecodebox">
OSStatus SystemSoundRemoveActionID(SystemSoundActionID inAction)

inAction: A SystemSoundActionID indicating the desired System Sound
          to be removed.
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG8"></A><H2>Completion Routines</H2><p><strong>(available on Mac OS X 10.3 and later)</strong></p><p>There are two APIs which let you to work with Completion Routines.</p><p><code>SystemSoundSetCompletionRoutine</code> allows you to set a completion routine which is associated with a specific <code><code>SystemSoundActionID</code></code>. This completion routine will be called when the System Sound Server finishes playing the designated 'custom' sound.</p><pre class="sourcecodebox">
OSStatus SystemSoundSetCompletionRoutine(
  SystemSoundActionID inAction,
  CFRunLoopRef inRunLoop,
  CFStringRef inRunLoopMode,
  SystemSoundCompletionUPP inCompletionRoutine,
  void * inUserData

inAction: The SystemSoundActionID that the completion routine will be
          associated with.

inRunLoop: A CFRunLoopRef indicating the desired run loop the completion
           routine should be run on. Pass NULL for the main run loop.

inRunLoopMode: A CFStringRef indicating the run loop mode for the runloop
               mode for the runloop where the completion routine will be
               executed. Pass NULL to use kCFRunLoopDefaultMode.

inCompletionRoutine: A SystemSoundCompletionProc for the completion
                     routine proc to be called when the provided
                     SystemSoundActionID has completed playing in
                     the server.

inUserData: A void * to pass user data to the completion routine.
</pre><p><code>SystemSoundRemoveCompletionRoutine</code> removes the Completion Routine associated with a specific <code><code>SystemSoundActionID</code></code>. Call this function when you no longer want a Completion Routine set for an associated 'custom' sound to be called when the sound has finished playing.</p><pre class="sourcecodebox">
void SystemSoundRemoveCompletionRoutine(SystemSoundActionID inAction)

inAction: A SystemSoundActionID that currently has an associated
          completion routine.
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG9"></A><H2>Example Usage</H2><p class="smalltext"><strong>Listing 1:</strong> Playing a custom Alert Sound.</p><pre class="sourcecodebox">
SystemSoundActionID gFunkSoundID = 0;

OSStatus CreateFunkActionID(void)
{
  const char *soundFilePath = &quot;/System/Library/Sounds/Funk.aiff&quot;;
  FSRef soundFileRef;
  OSStatus err;

  err = FSPathMakeRef(soundFilePath, &amp;soundFileRef, NULL);
  if (noErr == err) {
    err = SystemSoundGetActionID(&amp;soundFileRef, &amp;gFunkSoundID);
  }

  return err;
}

void MyDoSomethingFunction(void)
{
  .
  .
  .
  if (badBadThing)
    AlertSoundPlayCustomSound(gFunkSoundID);
    // NOTE: Make sure to not remove the Action ID
    // immediately following this call, you must give
    // the system a chance to actually play the sound.
  .
  .
  .
}

void MyCleanUpActionID(void)
{
  // Remember to call SystemSoundRemoveActionID for the ActionID
  // when you are completely done with it.
  // NOTE: Do not remove the Action ID before the system is given a
  // chance to play the sound as noted above.

  SystemSoundRemoveActionID(gFunkSoundID);
}
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNT_HISTORY_TAG"></A><H2>Document Revision History</H2><table cellspacing="0" class="graybox" width="680"><tr><th width="100">Date</th><th width="580">Notes</th></tr><tr><td scope="row">2004-07-13</td><td>Editorial changes and spelling.</td></tr><tr><td scope="row">2004-02-13</td><td>Discusses the System Sound APIs for correctly playing Alerts and User Interface Sound Effects</td></tr></table><p><b>Posted:</b> 2004-07-13</p>
<!-- END CONTENTS -->
</td></tr></table>
<!-- END WIDE COLUMN -->
<!-- END MAIN CONTENT -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2002/tn2102.html%3Fid%3DDTS10003206-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2002/tn2102.html%3Fid%3DDTS10003206-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2002/tn2102.html%3Fid%3DDTS10003206-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<!-- START BOTTOM APPLE NAVIGATION -->
<!--#include virtual="/includes/footer"-->
<!-- END BOTTOM APPLE NAVIGATION -->
<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->
</body></html>