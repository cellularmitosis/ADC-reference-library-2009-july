<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Interpreting Recognition Results</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING17></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="srec-16.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="srec-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="srec-87.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="srec-18.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="srec-2.html"><B>Speech Recognition Manager</B></A> / <BR><DD><A HREF="srec-4.html"><B>Chapter 1 - Speech Recognition Manager</B></A> / <A HREF="srec-9.html"><B>Using the Speech Recognition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING17-0></A>
<H2><A NAME=MARKER-9-146></A>Interpreting Recognition Results</H2>
 A recognition result contains information about a recognized utterance. The standard way to determine what the user said is to read the language model format property of the recognition result. The value of this property is a language model that contains a copy of each word, phrase, path, and language model used in the recognized utterance. You can inspect that language model to determine precisely what the user said and then respond accordingly. To retrieve this language model, call <CODE>SRGetProperty</CODE>, as follows:<P>
<PRE>
SRLanguageModel   myResultLM;
Size              myLen;

myLen = sizeof(myResultLM);
myErr = SRGetProperty(recResult, kSRLanguageModelFormat, 
                                       &amp;myResultLM, &amp;myLen);
</PRE>
 The language model returned by <CODE>SRGetProperty</CODE> is a subset of the complete active language model. For instance, the language model returned for the utterance "schedule meeting with Arlo" has the structure shown in <A HREF=#MARKER-9-147>Figure 1-7</A>. This is a subset of the language model shown in <A HREF=srec-7.html#MARKER-9-86>Figure 1-3 on page 1-12</A>.<P>
<B>Figure 1-7  <A NAME=MARKER-9-147></A>A language model for a recognized utterance</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/SR-04.jpg"><P>
 You can traverse this language model starting from its root by calling <CODE>SRCountItems</CODE> and <CODE>SRGetIndexedItem</CODE>. Then, for any item returned, you can inspect its type and reference constant to identify it. The <CODE>MyProcessRecognitionResult</CODE> function defined in <A HREF=#MARKER-9-148>Listing 1-17</A> shows how to process recognition results for the sample language model built in <A HREF=srec-12.html#MARKER-9-118>Listing 1-5 on page 1-19</A>.<P>
<B>Listing 1-17  <A NAME=MARKER-9-148></A>Handling a recognition result</B><P>
<PRE>
void MyProcessRecognitionResult (SRRecognitionResult recResult)
{
   OSErr          myErr = noErr;

   if (recResult) {
      SRLanguageModel   myResultLM;
      Size              myLen;

      myLen = sizeof(myResultLM);
      myErr = SRGetProperty(recResult, kSRLanguageModelFormat, &amp;myResultLM, &amp;myLen);

      if (!myErr) {
         long           myRefCon;
         SRLanguageObjectmySubElement;

         myLen = sizeof(myRefCon);
         myErr = SRGetProperty(myResultLM, kSRRefCon, &amp;myRefCon, &amp;myLen);
         
         /* if it's a valid result from our top-level LM, */
         /* then parse and process its elements */
         if (!myErr) {
            switch (myRefCon) {
               case kRejectedWordRefCon:
                  /* do nothing, if utterance was rejected */
                  break;
               case kTopLMRefCon:
                  /* parse and process element of top-level LM */
                  /* get the first sub-element (here there is only one) */
                  myErr = SRGetIndexedItem(myResultLM, &amp;mySubElement, 0);
                  if (!myErr) {
                     myLen = sizeof(myRefCon);
                     myErr = SRGetProperty(mySubElement, kSRRefCon, &amp;myRefCon, 
                                                   &amp;myLen);
                     if (!myErr) {
                        if (myRefCon == kCallPersonRefCon)
                           myErr = MyCallPersonInPath((SRPath) mySubElement);
                        /* process other possible subelements here */
                     }
                  }
                  /* release subelement when done with it */
                  myErr = SRReleaseObject(mySubElement);
                  break;
            }
         }

         /* release myResultLM fetched above when done with it */
         myErr = SRReleaseObject(myResultLM);
      }
      
      /* Release SRRecognitionResult because we are done with it. */
      myErr = SRReleaseObject(recResult);
   }
}
</PRE>
 When <CODE>MyHandleRecognitionResult</CODE> determines that the first item in the language model is an object whose reference constant is <CODE>kCallPersonRefCon</CODE>, it dispatches to the application-defined function <CODE>MyCallPersonInPath</CODE>, defined in <A HREF=#MARKER-9-149>Listing 1-18</A>, which continues parsing the language model to determine whom to call.<P>
<B>Listing 1-18  <A NAME=MARKER-9-149></A>Calling a name in a path</B><P>
<PRE>
const char *kPhoneNumbers[] = 
            {&quot;555-4567&quot;, &quot;555-4568&quot;, &quot;555-4569&quot;, &quot;(123) 456-7890&quot;, NULL};

OSErr MyCallPersonInPath (SRPath recognizedPath)
{
   OSErr             myErr = noErr;
   SRLanguageObject  myPersonLM;
   
   /* recognizedPath has two sub-elements: */
   /* &quot;&lt;call&gt;&quot; (SRLanguageModel) and &quot;&lt;person&gt;&quot; (SRLanguageModel) */
   /* Here we get the second sub-element. */
   myErr = SRGetIndexedItem(recognizedPath, &amp;myPersonLM, 1);
   if (!myErr) {
      SRLanguageObjectmyPhraseSpoken;
      
      /* myPersonLM has one sub-element, the name (a phrase) */
      myErr = SRGetIndexedItem(myPersonLM, &amp;myPhraseSpoken, 0);
      if (!myErr) {
         long        myRefCon;
         Size        myLen = sizeof(myRefCon);

         /* When we built the language model, we set the refcon to the index */
         /* of names in a list. The phone numbers in kPhoneNumbers correspond */
         /* to those names */
         myErr = SRGetProperty(myPhraseSpoken, kSRRefCon, &amp;myRefCon, &amp;myLen);
         if (!myErr) {
            short    myArrayIndex = myRefCon;
            
            printf(&quot;Now calling %s. Dialing %s.\n&quot;, 
                  kPersonNames[myArrayIndex], kPhoneNumbers[myArrayIndex]);
         }
         
         /* release myPhraseSpoken when done with it */
         myErr = SRReleaseObject(myPhraseSpoken);
      }
      
      /* release myPersonLM when done with it */
      myErr = SRReleaseObject(myPersonLM);
   }
   
   return myErr;
}
</PRE>
 Note that both <CODE>MyProcessRecognitionResult</CODE> and <CODE>MyCallPersonInPath</CODE> are careful to release any language object references when they are no longer needed.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="srec-16.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="srec-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="srec-87.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="srec-18.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="srec-3.html">&copy; Apple Computer, Inc.</A><br>22 JAN 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
