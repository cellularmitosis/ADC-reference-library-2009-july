<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">

<TITLE> Saving Files</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a><!-- start of banner -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of banner -->

<!-- start of path -->
<font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <a href="../../../../Carbon/index.html#//apple_ref/doc/uid/TP30000420" target="_top">Carbon</a> &gt; <a href="../../../../Carbon/UserExperience-date.html#//apple_ref/doc/uid/TP30000420-TP30000465" target="_top">User Experience</a></font>
<br><br>
<!-- end of path -->

<A HREF="Navigation_Services-12.html"><img src="images/up.gif" border="0" alt="Up"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-14.html"><img src="images/previous.gif" border="0" alt="Previous"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-16.html"><img src="images/next.gif" border="0" alt="Next"></A>
<nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<script type="text/javascript" language="JavaScript"><!--
function loadFrames(){
if (top == self || (parent.frames[1].name != doc))
    top.location.href = '../index.html?' + location.href;
}

if (self != top) {
  // loaded in frames
  document.write('<a href="'+self.location+'" target="_top"><img src="images/hideframes.gif" border="0" alt="Hide Frames"></a>');
  }
else {
  // not loaded frames
	document.write('<a href="JavaScript:loadFrames()"><img src="images/showframes.gif" border="0" alt="Show Frames"></a>');

}
//--></script>
<!-- end Show/Hide frames -->
<HR>
</DIV>
<A NAME="elementId-1012312"></A><A NAME="pgfId-1012320"></A><H1 CLASS="Head2">
<A NAME="BBJBHBGF"></A><A NAME="27906"></A>Saving Files</H1>
<P CLASS="Para">
<A NAME="pgfId-1012335"></A>The function <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 displays a Save dialog box, as shown in Figure 2-8.</P>
<A NAME="pgfId-1012367"></A><H5 CLASS="FigureCaption">
<A NAME="BBJDIDCC"></A>Figure 2-8	<A NAME="16437"></A>Save dialog box</H5>
<DIV>
<IMG SRC="Art/NS-S-03.gif">
</DIV>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1012371"></A>Note: You are strongly encouraged to make all Navigation Services dialog boxes movable by providing updates via an event-handling function. For more information, see Handling Events.</BLOCKQUOTE>
<P CLASS="Para">
<A NAME="pgfId-1028954"></A>Users can create a new folder for saving a document by using the New Folder button.</P>
<P CLASS="Para">
<A NAME="pgfId-1012376"></A>When the user selects a folder, the default button title toggles from Save to Open. When the user selects the editable text field (by clicking or keyboard selection), the default button title reverts to Save. </P>
<P CLASS="Para">
<A NAME="pgfId-1012383"></A>Save dialog boxes display a focus ring to indicate whether the browser list or the editable text field has keyboard focus (that is, the area that receives all keystrokes.) When no filename is displayed in the editable text field, the Save button is disabled.</P>
<DIV CLASS="Warning-or-Important">
<A NAME="elementId-1012389"></A><A NAME="pgfId-1016501"></A>Important<BLOCKQUOTE CLASS="WarningPara">
<A NAME="pgfId-1028996"></A>Always call the function <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 after calling the <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function, even if your application doesn't need automatic translations. Future versions of Navigation Services may provide additional features to your application when it calls the <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function.</BLOCKQUOTE>
</DIV>
<DIV CLASS="Section">
<A NAME="elementId-1012414"></A><A NAME="pgfId-1012420"></A><H1 CLASS="Head3">
<A NAME="BBJBIAEA"></A><A NAME="14959"></A>Providing File Format Options</H1>
<P CLASS="Para">
<A NAME="pgfId-1012436"></A>The<CODE CLASS="otherCodeCharacters">
 </CODE>
 <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function provides the Format pop-up menu button to allow users to choose how a new document or a copy of a document is to be saved. Figure 2-9 shows an example of this menu.</P>
<A NAME="pgfId-1012490"></A><H5 CLASS="FigureCaption">
<A NAME="BBJDABEI"></A>Figure 2-9	<A NAME="34545"></A>Format pop-up menu</H5>
<DIV>
<IMG SRC="Navigation_Services-16.gif">
</DIV>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1016979"></A>Note: If you specify the <CODE CLASS="otherCodeCharacters">
kNavNoTypePopup</CODE>
 constant in the dialogOptionFlags field of the structure <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 that you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function, the Format button does not appear in the Save dialog box.</BLOCKQUOTE>
<P CLASS="Para">
<A NAME="pgfId-1029067"></A>The first item in the Format pop-up menu is defined by the document type specified by your application in the <CODE CLASS="otherCodeCharacters">
fileType</CODE>
 and <CODE CLASS="otherCodeCharacters">
fileCreator</CODE>
 parameters of the<CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function. The name of the menu item is obtained from the Translation Manager. After setting this item, Navigation Services calls the Translation Manager to determine whether to display subsequent menu items describing alternative file types. For more information, see Translating Files on Save.</P>
<P CLASS="Para">
<A NAME="pgfId-1012519"></A>The last item in the menu is the Stationery Option command. This displays the Stationery Option dialog box, shown in Figure 2-10, which lets the user specify whether a new document or a copy of a document should be saved as a document or as stationery.</P>
<A NAME="pgfId-1012573"></A><H5 CLASS="FigureCaption">
<A NAME="BBJDIAJA"></A>Figure 2-10	<A NAME="30541"></A>Stationery Option dialog box</H5>
<DIV>
<IMG SRC="Art/NS-S-12.gif">
</DIV>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1029146"></A>Note: If you clear the <CODE CLASS="otherCodeCharacters">
kNavAllowStationery </CODE>
constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the structure <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 that you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function, the Stationery Option menu item does not appear.</BLOCKQUOTE>
</DIV>
<DIV CLASS="Section">
<A NAME="elementId-1012576"></A><A NAME="pgfId-1012584"></A><H1 CLASS="Head3">
<A NAME="BBJCDGHG"></A><A NAME="29981"></A>Translating Files on Save</H1>
<P CLASS="Para">
<A NAME="pgfId-1029171"></A>Your application supplies its default file type and creator for saved files to the function <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
. Navigation Services uses this information to build a pop-up menu of available translation choices obtained from the Translation Manager. If the user selects an output file type that is different from the native type, Navigation Services prepares a translation specification and supplies a handle to it in the <CODE CLASS="otherCodeCharacters">
fileTranslation</CODE>
 field of a structure of type <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
. If you choose to provide your own translation, Navigation Services informs you that translation is required by setting the translationNeeded field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
structure to <CODE CLASS="otherCodeCharacters">
true</CODE>
. </P>
<DIV CLASS="Warning-or-Important">
<A NAME="elementId-1012614"></A><A NAME="pgfId-1016518"></A>Important<BLOCKQUOTE CLASS="WarningPara">
<A NAME="pgfId-1029197"></A>The function <CODE CLASS="otherCodeCharacters">
NavTranslateFile</CODE>
 is intended to be used only while opening files. Always call the function <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 to provide automatic translation and complete a save operation.</BLOCKQUOTE>
</DIV>
<P CLASS="Para">
<A NAME="pgfId-1016533"></A>When saving a document for the first time, your application should wait until the user closes the document before calling the <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function. This allows your application to save the file in a native format as the user works with the file. When saving a copy of a document, your application should call the <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function immediately after returning from the<CODE CLASS="otherCodeCharacters">
 NavPutFile</CODE>
 function.</P>
<P CLASS="Para">
<A NAME="pgfId-1029274"></A>The <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function provides any necessary translation. If you wish to turn off automatic translation during a save operation, set the value of the translationNeeded field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
structure to <CODE CLASS="otherCodeCharacters">
false </CODE>
before you call the <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function.</P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1029336"></A>Note: You do not need to set the value of the translationNeeded field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
structure to <CODE CLASS="otherCodeCharacters">
false</CODE>
 if the user creates a new document that requires translation, but closes it without saving any data. </BLOCKQUOTE>
<P CLASS="Para">
<A NAME="pgfId-1029302"></A>Once the save is completed, your application must dispose of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
 structure by calling the function <CODE CLASS="otherCodeCharacters">
NavDisposeReply</CODE>
. </P>
<P CLASS="Para">
<A NAME="pgfId-1029355"></A>By default, the <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
 function saves translations as a copy of the original file. Your application can direct Navigation Services to replace the original with the translation by passing the kNavTranslateInPlace constant, described in Translation Option Constants, in the <CODE CLASS="otherCodeCharacters">
howToTranslate</CODE>
 parameter of the <CODE CLASS="otherCodeCharacters">
NavCompleteSave</CODE>
 function.</P>
</DIV>
<DIV CLASS="Section">
<A NAME="elementId-1012742"></A><A NAME="pgfId-1012748"></A><H1 CLASS="Head3">
<A NAME="BBJEBAHH"></A><A NAME="33414"></A>A Sample File-Saving Function</H1>
<P CLASS="Para">
<A NAME="pgfId-1012762"></A>Listing 2-3 illustrates how to save files by using the function <CODE CLASS="otherCodeCharacters">
NavPutFile</CODE>
. The sample listing also shows how to set options and register your event-handling function. Note that this function uses a <CODE CLASS="otherCodeCharacters">
DoSafeSave</CODE>
 function to ensure that the save is completed without error before an existing file is deleted.</P>
<PRE CLASS="CodeLines-Container"><A NAME="pgfId-1012776"></A><H5 CLASS="CodeCaption"><A NAME="BBJDHHAA"></A>Listing 2-3	<A NAME="19648"></A>A sample file-saving function</H5>
<A NAME="pgfId-1032176"></A>OSErr MySaveDocument(WindowPtr theDocument)
{
    OSErr               anErr = noErr;
    NavReplyRecord      reply;
    NavDialogOptions    dialogOptions;
    OSType              fileTypeToSave = 'TEXT';
    OSType              creatorType = 'xAPP';
    NavEventUPP         eventProc = NewNavEventProc(myEventProc);

    anErr = NavGetDefaultDialogOptions(&amp;dialogOptions);
    if (anErr == noErr)
    {
        //  One way to get the name for the file to be saved.
        GetWTitle(theDocument, dialogOptions.savedFileName);
        
        anErr = NavPutFile( nil, &amp;reply, &amp;dialogOptions, eventProc, nil,
                            fileTypeToSave, creatorType );
        if (anErr == noErr &amp;&amp; reply.validRecord)
        {
            AEKeyword   theKeyword;
            DescType    actualType;
            Size        actualSize;
            FSSpec      documentFSSpec;
            
            anErr = AEGetNthPtr(&amp;(reply.selection), 1, typeFSS,
                                &amp;theKeyword, &amp;actualType,
                                &amp;documentFSSpec, sizeof(documentFSSpec),
                                &amp;actualSize );
            if (anErr == noErr)
            {
                if (reply.replacing)
                {
                    // Make sure you save a temporary file
                    // so you can check for problems before replacing
                    // an existing file. Once the save is confirmed,
                    // swap the files and delete the original.
                    anErr = DoSafeSave(&amp;documentFSSpec, creatorType,
                                        fileTypeToSave, theDocument);
                }
                else
                {
                    anErr = WriteNewFile(&amp;documentFSSpec, creatorType,
                                         fileTypeToSave, theDocument);
                }
                
                if ( anErr == noErr)
                {
                    // Always call NavCompleteSave() to complete
                    anErr = NavCompleteSave(&amp;reply,
                                            kNavTranslateInPlace);
                }
            }
            (void) NavDisposeReply(&amp;reply);
        }
        DisposeRoutineDescriptor(eventProc);
    }
    return anErr;
}
</PRE>
</DIV>
<HR>&#169; 2000 Apple Computer, Inc. (Last Updated 18 April 00)<P>
<A HREF="Navigation_Services-12.html"><img src="images/up.gif" border="0" alt="Up"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-14.html"><img src="images/previous.gif" border="0" alt="Previous"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-16.html"><img src="images/next.gif" border="0" alt="Next"></A>
<nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<script type="text/javascript" language="JavaScript"><!--
function loadFrames(){
if (top == self || (parent.frames[1].name != doc))
    top.location.href = '../index.html?' + location.href;
}

if (self != top) {
  // loaded in frames
  document.write('<a href="'+self.location+'" target="_top"><img src="images/hideframes.gif" border="0" alt="Hide Frames"></a>');
  }
else {
  // not loaded frames
	document.write('<a href="JavaScript:loadFrames()"><img src="images/showframes.gif" border="0" alt="Show Frames"></a>');

}
//--></script>
<!-- end Show/Hide frames -->
<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer -->
</BODY>
</HTML>
