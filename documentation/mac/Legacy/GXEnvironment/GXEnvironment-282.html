<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Setting and Getting Global Data for a Single Handler Instance(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING282></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-281.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-283.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-274.html"><B>Chapter 6 - Message Manager</B></A> / <A HREF="GXEnvironment-279.html"><B>Using the Message Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING282-0></A>
<H2><A NAME=MARKER-9-39></A>Setting and Getting Global Data for a Single Handler Instance</H2>
 <A NAME=MARKER-2-40></A><A NAME=MARKER-9-122></A><A NAME=MARKER-2-42></A><A NAME=MARKER-2-71></A>You can use the <CODE>SetMessageHandlerInstanceContext</CODE> function to store data that can be used by a single instance of a message handler. A new instance of your message handler is created each time a new printing job is created. For example, if four printing jobs are created, four instances of the message handler are created. Each job has a unique context called the instance context.<P>
 <A HREF=#MARKER-9-44>Listing 6-3</A> uses this function to store global data whenever a new printing job is initiated. If there are multiple print jobs, this function will be called when each job is started.<P>
<B>Listing 6-3  <A NAME=MARKER-9-44></A>Storing global data for a single message handler instance</B><P>
<PRE>
typedef struct MyDataRec {
   long something;
   long somethingElse;
} MyDataRec, **MyDataHdl;

OSErr MyInitialize()
{
   OSErr       err;
   MyDataHdl   dataHandle;

/*
   Create a new temporary memory handle, initialize
   it, and store it as the message handler's instance
   context.
*/
   dataHandle = (MyDataHdl) TempNewHandle(sizeof(MyDataRec),
                                                 &amp;err);

   if (err == noErr)
   {
      MyInitDataHandle(dataHandle);
      SetMessageHandlerInstanceContext(dataHandle);
   }

   return err;
}
</PRE>
 In <A HREF=#MARKER-9-44>Listing 6-3</A>, you begin by creating a handle to store global data for the <CODE>MyDataRec</CODE> structure. Each message handler instance has a unique copy with unique values for the fields of the data structure. If there is insufficient memory to create the handle, an error will be generated. If the handler is successfully created, the handler is initialized. The <CODE>SetMessageHandlerInstanceContext</CODE> function is then used to store a reference to the handle that can then be used by this message handler's overrides. If you use this code in an extension and four jobs were created for it, each job would have a handle to a unique copy of a record for the structure.<P>
 You can use the <CODE>GetMessageHandlerInstanceContext</CODE> function to retrieve the data that you stored with the <CODE>SetMessageHandlerInstanceContext</CODE> function. <A HREF=#MARKER-9-45>Listing 6-4</A> uses the <CODE>GetMessageHandlerInstanceContext</CODE> function to return and dispose of the handle containing the global data that was previously stored in <A HREF=#MARKER-9-44>Listing 6-3</A>.<P>
<B>Listing 6-4  <A NAME=MARKER-9-45></A>Getting and disposing of global data</B><P>
<PRE>
OSErr MyShutDown()
{
   MyDataHdl dataHandle;

/*
   Retrieve the message handler's instance context.  If the
   value returned isn't nil, it's a handle that we stored
   earlier. Dispose of the handle and set the instance
   context to nil to &quot;clear&quot; it.
*/
   dataHandle = (MyDataHdl) GetMessageHandlerInstanceContext();

   if (dataHandle != nil)
   {
      DisposHandle((Handle) dataHandle);
      SetMessageHandlerInstanceContext(nil);
   }

   return noErr;
}
</PRE>
 In <A HREF=#MARKER-9-45>Listing 6-4</A>, the <CODE>GetMessageHandlerInstanceContext</CODE> function is used to get the previously stored handle containing the global data. If the handle isn't <CODE>nil</CODE>, it's the <CODE>handle</CODE> that was previously stored and it is disposed of. Finally, the <CODE>SetMessageHandlerInstanceContext</CODE> function is used to set the context data to <CODE>nil</CODE>. If the instance context is <CODE>nil</CODE>, the handle was previously disposed of.<P>
 The <CODE>SetMessageHandlerInstanceContext</CODE> function is described on <A HREF=GXEnvironment-294.html#MARKER-9-84>page 6-19</A>. The <CODE>GetMessageHandlerInstanceContext</CODE> function is described on <A HREF=GXEnvironment-295.html#MARKER-9-87>page 6-20</A>.<P>
 Global data is discussed in the section <A HREF=GXEnvironment-277.html#MARKER-9-22>"Global Data Storage for Printing Extensions and Printer Drivers" beginning on page 6-7</A>.<A NAME=MARKER-2-46></A><A NAME=MARKER-2-47></A><A NAME=MARKER-2-48></A><A NAME=MARKER-2-49></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-281.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-283.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
