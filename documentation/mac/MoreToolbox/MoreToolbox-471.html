<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MyCdev (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING471></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-470.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-472.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-453.html"><B>Chapter 8 - Control Panels</B></A> / <A HREF="MoreToolbox-468.html"><B>Control Panels Reference</B></A><BR><DL><DD><A HREF="MoreToolbox-469.html"><B>Application-Defined Routines</B></A> / <A HREF="MoreToolbox-470.html"><B>Control Device Functions </B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING471-0></A>
<H3>MyCdev</H3>
 You provide a control device function to implement your control panel. In the <CODE>message</CODE> parameter, the Finder passes a value indicating which action your control device function should perform. Here's how you declare a control device function called <CODE>MyCdev</CODE>:<A NAME=MARKER-2-357></A><P>
<PRE>
FUNCTION MyCdev(message, item, numItems, CPrivateValue: Integer;
                VAR theEvent: EventRecord; 
                cdevStorageValue: LongInt; CPDialog: DialogPtr)
                : LongInt; 
</PRE>
<DL>
<DT><CODE>message</CODE>
<DD> A value that identifies the event or action to which your control <BR>device function should respond. See <A HREF=#MARKER-9-11>Table 8-3 on page 8-77</A> for the constants your function can receive in this parameter. 
<DT><CODE>item</CODE>
<DD> The number of the item that the user clicked. In System 7, this is always the actual number of the item in your item list. In System 6, the Control Panel desk accessory appends your item list to its own. Although you begin numbering your item list with 1, the Control Panel adds the number of items in its item list to your item. Therefore, to get the <BR>actual number of the clicked item, and to provide for backward compatibility, your control device function should always subtract <CODE>numItems</CODE> from <CODE>item</CODE>. 
<DT><CODE>numItems</CODE>
<DD> In System 7, the Finder passes a value of 0 for this parameter. This parameter is provided for backward compatibility with the Control Panel desk accessory. In System 6, this parameter contains the number of items in the item list belonging to the Control Panel desk accessory. To get the actual number of the item that the user clicked, subtract <CODE>numItems</CODE> from <CODE>item</CODE>. 
<DT><CODE>CPrivateValue</CODE>
<DD> Reserved for use by the Finder or the Control Panel desk accessory. 
<DT><CODE>theEvent</CODE>
<DD> The event record for the event that caused the Finder to send a <CODE>hitDev</CODE>, <CODE>nulDev</CODE>, <CODE>activDev</CODE>, <CODE>deActivDev</CODE>, <CODE>updateDev</CODE>, or <CODE>keyEvtDev</CODE> message to your control device function. See the chapter "Event Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> for a description of events and event records.
<DT><CODE>cdevStorageValue</CODE>
<DD> The first time the Finder calls your control device function, this parameter is set to the constant <CODE>cdevUnset</CODE>. After the first call, this parameter contains the function result last returned by your control device function. Typically, in response to an <CODE>initDev</CODE> message, a control device function allocates a handle to memory and returns this handle as its function result. It does this so that it can store values between calls from the Finder. On all subsequent calls, the Finder passes the handle back to your function as the value of <CODE>cdevStorageValue</CODE>, and your function returns this value as its function result until an error condition occurs or the user closes the control panel.
<DT>
<DD> If your function does not create a handle, your function and the Finder pass <CODE>cdevUnset</CODE> back and forth, instead of the handle, until an error condition occurs or the user closes the control panel. 
<DT><CODE>CPDialog</CODE>
<DD> The dialog pointer for your control panel's dialog box. The dialog can be a color dialog on systems that support color windows. See the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> for a description of dialog pointers.
</DL>
<A NAME=HEADING471-11></A>
<H5>DESCRIPTION</H5>
 The <A NAME=MARKER-2-358></A>Finder calls your control device function repeatedly with various messages in response to user actions and events from the time the user opens your control panel until the user closes the control panel or your function reports an error condition from which it cannot recover. Before attempting to handle messages from the Finder, your control device function should determine whether enough memory is available to perform the requested action.<P>
 Depending on how you define your control panel's machine resource, the Finder calls your control device function for the first time with a <CODE>macDev</CODE> message or an <CODE>initDev</CODE> message. Apart from a <CODE>macDev</CODE> message, your control device function should ignore <BR>any messages that it receives before an <CODE>initDev</CODE> message. Your function should also ignore any messages it receives after a <CODE>closeDev</CODE> message, which the Finder sends under normal conditions free of error as a signal that your function should begin its termination process: releasing any allocated memory, handles, pointers, and so on. Between the <CODE>initDev</CODE> and the <CODE>closeDev</CODE> calls, the Finder calls your control device function to direct it to handle activate, update, keyboard-related, mouse-related, and null events. When the user chooses a command from the Finder's Edit menu, the Finder passes the command to your function as an edit message.<A HREF=#MARKER-9-359></A> <A HREF=#MARKER-9-11>Table 8-3</A> lists the constant names for the values that the Finder passes in the <CODE>message</CODE> parameter and provides a description of the action your function should perform. <A NAME=MARKER-9-359></A>
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-11></A><B>Table 8-3 Messages from the Finder</B> (Continued)</CAPTION>
<TH>Constant<TH>Value<TH>Description<TR>
<TD>initDev<TD>0<TD>Your control device function should perform any initialization, set default values for controls, and create a handle to any memory that it needs. <TR>
<TD>hitDev<TD>1<TD>The user clicked an enabled item, and your control device function should handle the click. <TR>
<TD>closeDev<TD>2<TD>The user closed the control panel; your function should terminate after disposing of any handles and pointers it created. (In System 6 and earlier, the user could have also selected another control panel.)<TR>
<TD>nulDev<TD>3<TD>A null event occurred. Your control device function should perform idle processing. Do not assume any particular timing for this message.<TR>
<TD>updateDev<TD>4<TD>An update event occurred. Your control device function should update any user items and redraw any controls that are not standard dialog items handled by the Dialog Manager.<TR>
<TD>activDev<TD>5<TD>Your control panel is becoming active as the result of an activate event. Your control device function should make the default button and any other controls in your control panel active. <TR>
<TD>deActivDev<TD>6<TD>Your control panel is becoming inactive as the result of an activate event. Your control device function should make the default button and any other controls in your control panel inactive.<TR>
<TD>keyEvtDev<TD>7<TD>A key-down or an auto-key event occurred. Your control device function should process the keyboard event. <TR>
<TD>macDev<TD>8<TD>Your control device function should check the hardware and software configuration to determine whether the control panel can run on it. Your function should return a function result of 1 if it can run and 0 if it cannot. <TR>
<TD>undoDev<TD>9<TD>The user chose the Undo command from the Finder's Edit menu. Your control device function should handle the command. <TR>
<TD>cutDev<TD>10<TD>The user chose the Cut command from the Finder's Edit menu. Your control device function should handle the command.<TR>
<TD>copyDev<TD>11<TD>The user chose the Copy command from the Finder's Edit menu. Your control device function should handle the command.<TR>
<TD>pasteDev<TD>12<TD>The user chose the Paste command from the Finder's Edit menu. Your control device function should handle the command.<TR>
<TD>clearDev<TD>13<TD>The user chose the Clear command from the Finder's Edit menu. Your control device function should handle the command.</TABLE>
 <P>
 In System 7, the Finder processes all Command-key equivalents on behalf of your control panel, except those that it maps to its own Edit menu commands. The Finder converts these Command-key equivalents to edit messages, which it then passes to your control panel for processing. In System 6, the Control Panel passes both commands from the Edit menu and their Command-key equivalents to your control device function for processing. See the sections <A HREF=MoreToolbox-461.html#MARKER-9-198>"Responding to Keyboard Events" on page 8-37</A> and <A HREF=MoreToolbox-461.html#MARKER-9-227>"Handling Edit Menu Commands" on page 8-46</A> for more information on how to handle Command-key <A NAME=MARKER-2-360></A>equivalents. <A NAME=MARKER-2-361></A><P>
 If your function cannot recover from an error condition, it must return one of three error codes to the Finder after disposing of any memory, handles, and pointers that it created and restoring the system stack to the state it would be in after successful execution. See <A HREF=MoreToolbox-461.html#MARKER-9-1>Table 8-2 on page 8-47</A> for the error codes that your control device function can return. <A NAME=MARKER-2-362></A><P>
<A NAME=HEADING471-16></A>
<H5>SEE ALSO</H5>
 For information on how to write a c<A NAME=MARKER-2-363></A>ontrol device function, see <A HREF=MoreToolbox-461.html#MARKER-9-156>"Writing a Control Panel Function" beginning on page 8-25</A>. For information on the required and optional resources for your control panel, see <A HREF=MoreToolbox-459.html#MARKER-9-103>"Creating a Control Panel's Resources" beginning on page 8-14</A>.<A NAME=MARKER-2-364></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-470.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-472.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
