<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz 2D Programming Guide: Patterns</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Patterns"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001066-CH206" title="Patterns"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../dq_intro/dq_intro.html#//apple_ref/doc/uid/TP30001066-CH201-TPXREF101">Quartz 2D Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_affine/dq_affine.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_shadows/dq_shadows.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001066-CH206-TPXREF101" title="Patterns"></a><h1>Patterns</h1><p>A <strong>pattern</strong> is a sequence of drawing operations that is repeatedly painted to a graphics context. You can use patterns in the same way as you use colors. When you paint using a pattern, Quartz divides the page into a set of pattern cells, with each cell the size of the pattern image, and draws each cell using a callback you provide. <span class="content_text">Figure 6-1</span> shows a pattern drawn to a window graphics context. Patterns are available in Mac OS X v10.1 and later.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCBHAIA" title="Figure 6-1A pattern drawn to a window"></a><p><strong>Figure 6-1&nbsp;&nbsp;</strong>A pattern drawn to a window</p><img src = "../Art/patterned_window.gif" alt = "A pattern drawn to a window" width="354" height="265"></div><br/>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCIAJCH">The Anatomy of a Pattern</a>
				
			<br/>
			
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-DontLinkElementID_30">Colored Patterns and Stencil (Uncolored) Patterns</a>
				
			<br/>
			
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCDHCEH">Tiling</a>
				
			<br/>
			
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-DontLinkElementID_31">How Patterns Work</a>
				
			<br/>
			
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-TPXREF117">Painting Colored Patterns</a>
				
			<br/>
			
        
			
			
				<a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCJAJEC">Painting Stencil Patterns</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001066-CH206-BBCIAJCH" title="The Anatomy of a Pattern"></a><h2>The Anatomy of a Pattern</h2><p>The pattern cell is the basic component of a pattern. The pattern cell for the pattern shown in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBHAIA">Figure 6-1</a></span> is shown in <span class="content_text">Figure 6-2</span>. The black rectangle is not part of the pattern; it’s drawn to show where the pattern cell ends. </p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCFEAJJ" title="Figure 6-2A pattern cell"></a><p><strong>Figure 6-2&nbsp;&nbsp;</strong>A pattern cell</p><img src = "../Art/pattern_cell_wborder.gif" alt = "A pattern cell" width="65" height="65"></div><br/><p>The size of this particular pattern cell includes the area of the four colored rectangles and space above and to the right of the rectangles, as shown in <span class="content_text">Figure 6-3</span>. The black rectangle surrounding each pattern cell in the figure is not part of the cell; it’s drawn to indicate the <strong>bounds</strong> of the cell. When you create a pattern cell, you define the bounds of the cell and draw within the bounds.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCEEGDG" title="Figure 6-3Pattern cells with black rectangles drawn to show the bounds of each cell"></a><p><strong>Figure 6-3&nbsp;&nbsp;</strong>Pattern cells with black rectangles drawn to show the bounds of each cell</p><img src = "../Art/pattern_parts_1.gif" alt = "Pattern cells with black rectangles drawn to show the bounds of each cell" width="277" height="185"></div><br/><p>You can specify how far apart Quartz draws the start of each pattern cell from the next in the horizontal and vertical directions. The pattern cells in <span class="content_text">Figure 6-3</span> are drawn so that the start of one pattern cell is exactly a pattern width apart from the next pattern cell, resulting in each pattern cell abutting on the next. The pattern cells in <span class="content_text">Figure 6-4</span> have space added in both directions, horizontal and vertical. You can specify different <strong>spacing values</strong> for each direction. If you make the spacing less than the width or height of a pattern cell, the pattern cells overlap.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJEBAD" title="Figure 6-4Spacing between pattern cells"></a><p><strong>Figure 6-4&nbsp;&nbsp;</strong>Spacing between pattern cells</p><img src = "../Art/pattern_part_2.gif" alt = "Spacing between pattern cells" width="319" height="215"></div><br/><p>When you draw a pattern cell, Quartz uses <strong>pattern space</strong> as the coordinate system. Pattern space is an abstract space that maps to the default user space by the transformation matrix you specify when you create the pattern—the <strong>pattern matrix</strong>. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001066-CH206-DontLinkElementID_64" title="Note"></a><p><strong>Note:</strong>&nbsp;Pattern space is separate from user space. The untransformed pattern space maps to the base (untransformed) user space, regardless of the state of the current transformation matrix. When you apply a transformation to pattern space, Quartz applies the transform only to pattern space.</p></div><p>If you don’t want Quartz to transform the pattern cell, you can specify the identity matrix. However, you can achieve interesting effects by supplying a transformation matrix. <span class="content_text">Figure 6-5</span> shows the effect of scaling the pattern cell shown in <span class="content_text">Figure 6-2</span>. <span class="content_text">Figure 6-6</span> demonstrates rotating the pattern cell. Translating the pattern cell is a bit more subtle. <span class="content_text">Figure 6-7</span> shows the origin of the pattern, with the pattern cell translated in both directions, horizontal and vertical, so that the pattern no longer abuts the window as it does in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBHAIA">Figure 6-1</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJEFJB" title="Figure 6-5A scaled pattern cell"></a><p><strong>Figure 6-5&nbsp;&nbsp;</strong>A scaled pattern cell</p><img src = "../Art/pattern_halfbyonehalf.gif" alt = "A scaled pattern cell" width="236" height="178"></div><br/><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCJAGE" title="Figure 6-6A rotated pattern cell"></a><p><strong>Figure 6-6&nbsp;&nbsp;</strong>A rotated pattern cell</p><img src = "../Art/pattern_2PIdiv6.gif" alt = "A rotated pattern cell" width="189" height="132"></div><br/><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCDAGEI" title="Figure 6-7A translated pattern cell"></a><p><strong>Figure 6-7&nbsp;&nbsp;</strong>A translated pattern cell</p><img src = "../Art/pattern_5_5_translate.gif" alt = "A translated pattern cell" width="230" height="199"></div><br/><a name="//apple_ref/doc/uid/TP30001066-CH206-DontLinkElementID_30" title="Colored Patterns and Stencil (Uncolored) Patterns"></a><h2>Colored Patterns and Stencil (Uncolored) Patterns</h2><p><strong>Colored patterns</strong> have inherent colors associated with them. Change the coloring used to create the pattern cell, and the pattern loses its meaning. A Scottish tartan (such as the sample one shown in <span class="content_text">Figure 6-8</span>) is an example of a colored pattern. The color in a colored pattern is specified as part of the pattern cell creation process, not as part of the pattern drawing process.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCGBJGD" title="Figure 6-8A colored pattern has inherent color"></a><p><strong>Figure 6-8&nbsp;&nbsp;</strong>A colored pattern has inherent color</p><img src = "../Art/tartan.gif" alt = "A colored pattern has inherent color" width="234" height="70"></div><br/><p>Other patterns are defined solely on their shape and, for that reason, can be thought of as <strong>stencil patterns</strong>, uncolored patterns, or even as an image mask. The red and black stars shown in <span class="content_text">Figure 6-9</span> are each renditions of the same pattern cell. The cell itself consists of one shape—a filled star. When the pattern cell was defined, no color was associated with it. The color is specified as part of the pattern drawing process, not as part of the pattern cell creation.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCBCCC" title="Figure 6-9A stencil pattern does not have inherent color"></a><p><strong>Figure 6-9&nbsp;&nbsp;</strong>A stencil pattern does not have inherent color</p><img src = "../Art/star_patterns.gif" alt = "A stencil pattern does not have inherent color" width="244" height="103"></div><br/><p>You can create either kind of pattern—colored or stencil—in Quartz 2D.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCDHCEH" title="Tiling"></a><h2>Tiling</h2><p><strong>Tiling</strong> is the process of rendering pattern cells to a portion of a page. When Quartz renders a pattern to a device, Quartz may need to adjust the pattern to fit the device space. That is, the pattern cell as defined in user space might not fit perfectly when rendered to the device because of differences between user space units and device pixels.</p><p>Quartz has three tiling options it can use to adjust patterns when necessary. Quartz can preserve:</p><ul class="ul"><li class="li"><p>The pattern, at the expense of adjusting the spacing between pattern cells slightly, but by no more than one device pixel. This is referred to as <strong>no distortion</strong>.</p></li><li class="li"><p>Spacing between cells, at the expense of distorting the pattern cell slightly, but by no more than one device pixel. This is referred to as <strong>constant spacing with minimal distortion</strong>.</p></li><li class="li"><p>Spacing between cells (as for the minimal distortion option) at the expense of distorting the pattern cell as much as needed to get fast tiling. This is referred to as <strong>constant spacing</strong>.</p></li></ul><a name="//apple_ref/doc/uid/TP30001066-CH206-DontLinkElementID_31" title="How Patterns Work"></a><h2>How Patterns Work</h2><p>Patterns operate similarly to colors, in that you set a fill or stroke pattern and then call a painting function. Quartz uses the pattern you set as the “paint.” For example, if you want to paint a filled rectangle with a solid color, you first call a function, such as <code>CGContextSetFillColor</code>, to set the fill color. Then you call the function <code>CGContextFillRect</code> to paint the filled rectangle with the color you specify. To paint with a pattern, you first call the function <code>CGContextSetFillPattern</code> to set the pattern. Then you call <code>CGContextFillRect</code> to actually paint the filled rectangle with the pattern you specify. The difference between painting with colors and with patterns is that you must define the pattern. You supply the pattern and color information to the function <code>CGContextSetFillPattern</code>. You’ll see how to create, set, and paint patterns in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-TPXREF117">“Painting Colored Patterns”</a></span> and <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCJAJEC">“Painting Stencil Patterns.”</a></span> </p><p>Here’s an example of how Quartz works behind the scenes to paint with a pattern you provide. When you fill or stroke with a pattern, Quartz conceptually performs the following tasks to draw each pattern cell:</p><ol class="ol"><li class="li"><p>Saves the graphics state.</p></li><li class="li"><p>Translates the current transformation matrix to the origin of the pattern cell.</p></li><li class="li"><p>Concatenates the CTM with the pattern matrix.</p></li><li class="li"><p>Clips to the bounding rectangle of the pattern cell.</p></li><li class="li"><p>Calls your drawing callback to draw the pattern cell.</p></li><li class="li"><p>Restores the graphics state.</p></li></ol><p>Quartz takes care of all the tiling for you, repeatedly rendering the pattern cell to the drawing space until the entire space is painted. You can fill or stroke with a pattern. The pattern cell can be of any size you specify. If you want to see the pattern, you should make sure pattern cell fits in the drawing space. For example, if your pattern cell is 8 units by 10 units, and you use the pattern to stroke a line that has a width of 2 units, the pattern cell will be clipped since it is 10 units wide. In this case, you might not recognize the pattern.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-TPXREF117" title="Painting Colored Patterns"></a><h2>Painting Colored Patterns</h2><p>There are five steps you need to perform to paint a colored pattern: </p><ol class="ol"><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEHCFD">“Write a Callback Function That Draws a Colored Pattern Cell”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEEJEA">“Set Up the Colored Pattern Color Space”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBFEGD">“Set Up the Anatomy of the Colored Pattern”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCDECDJ">“Specify the Colored Pattern as a Fill or Stroke Pattern”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCCIFID">“Draw With the Colored Pattern”</a></span></p></li></ol><p>These are the same steps you use to paint a stencil pattern. The difference between the two is how you set up color information. Each of the subsequent sections explains how to implement each step. You can see how all the steps fit together in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCGHGAG">“A Complete Colored Pattern Painting Function.”</a></span></p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCEHCFD" title="Write a Callback Function That Draws a Colored Pattern Cell"></a><h3>Write a Callback Function That Draws a Colored Pattern Cell</h3><p>What a pattern cell looks like is entirely up to you. For this example, the code in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEGGHH">Listing 6-1</a></span> draws the pattern cell shown in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCFEAJJ">Figure 6-2</a></span>. Recall that the black line surrounding the pattern cell is not part of the cell; it’s drawn to show that the bounds of the pattern cell are larger than the rectangles painted by the code. You specify the pattern size to Quartz later.</p><p>Your pattern cell drawing function is a callback that follows this form:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef void (*CGPatternDrawPatternCallback) (<span></span></pre></td></tr><tr><td scope="row"><pre>                        void *info,<span></span></pre></td></tr><tr><td scope="row"><pre>                        CGContextRef context<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr></table></div><p>You can name your callback whatever you like. The one in <span class="content_text">Listing 6-1</span> is named <code>MyDrawColoredPattern</code>. The callback takes two parameters:</p><ul class="spaceabove"><li class="li"><p><code>info</code>, a generic pointer to private data associated with the pattern. This parameter is optional; you can pass <code>NULL</code>. The data passed to your callback is the same data you supply later, when you create the pattern. </p></li><li class="li"><p><code>context</code>, the graphics context for drawing the pattern cell.</p></li></ul><p>The pattern cell drawn by the code in <span class="content_text">Listing 6-1</span> is arbitrary. Your code draws whatever is appropriate for the pattern you create. These details about the code are important:</p><ul class="spaceabove"><li class="li"><p>The pattern size is declared. You need to keep the pattern size in mind as you write your drawing code. Here, the size is declared as a global. The drawing function doesn’t specifically refer to the size, except in a comment. Later, you specify the pattern size to Quartz 2D. See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBFEGD">“Set Up the Anatomy of the Colored Pattern.”</a></span></p></li><li class="li"><p>The drawing function follows the prototype defined by the <code>CGPatternDrawPatternCallback</code> callback type definition.</p></li><li class="li"><p>The drawing performed in the code sets colors, which makes this a colored pattern.</p></li></ul><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCEGGHH" title="Listing 6-1A drawing callback that draws a colored pattern cell"></a><p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>A drawing callback that draws a colored pattern cell</p><div class="codesample"><table><tr><td scope="row"><pre>#define H_PATTERN_SIZE 16<span></span></pre></td></tr><tr><td scope="row"><pre>#define V_PATTERN_SIZE 18<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void MyDrawColoredPattern (void *info, CGContextRef myContext)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    float subunit = 5; // the pattern cell itself is 16 by 18<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect  myRect1 = {{0,0}, {subunit, subunit}},<span></span></pre></td></tr><tr><td scope="row"><pre>            myRect2 = {{subunit, subunit}, {subunit, subunit}},<span></span></pre></td></tr><tr><td scope="row"><pre>            myRect3 = {{0,subunit}, {subunit, subunit}},<span></span></pre></td></tr><tr><td scope="row"><pre>            myRect4 = {{subunit,0}, {subunit, subunit}};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBFillColor (myContext, 0, 0, 1, 0.5);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext, myRect1);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBFillColor (myContext, 1, 0, 0, 0.5);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext, myRect2);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBFillColor (myContext, 0, 1, 0, 0.5);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext, myRect3);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBFillColor (myContext, .5, 0, .5, 0.5);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext, myRect4);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCEEJEA" title="Set Up the Colored Pattern Color Space"></a><h3>Set Up the Colored Pattern Color Space</h3><p>The code in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEGGHH">Listing 6-1</a></span> uses colors to draw the pattern cell. You must ensure that Quartz paints with the colors you use in your drawing routine by setting the base pattern color space to <code>NULL</code>, as shown in <span class="content_text">Listing 6-2</span>. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCHDIBA" title="Listing 6-2Creating a base pattern color space"></a><p class="codesample"><strong>Listing 6-2&nbsp;&nbsp;</strong>Creating a base pattern color space</p><div class="codesample"><table><tr><td scope="row"><pre>CGColorSpaceRef patternSpace;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>patternSpace = CGColorSpaceCreatePattern (NULL);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>CGContextSetFillColorSpace (myContext, patternSpace);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRelease (patternSpace);<span>// 3</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates a pattern color space appropriate for a colored pattern by calling the function <code>CGColorSpaceCreatePattern</code>, passing <code>NULL</code> as the base color space.</p></li><li class="li"><p>Sets the fill color space to the pattern color space. If you are stroking your pattern, call <code>CGContextSetStrokeColorSpace</code>.</p></li><li class="li"><p>Releases the pattern color space.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCBFEGD" title="Set Up the Anatomy of the Colored Pattern"></a><h3>Set Up the Anatomy of the Colored Pattern</h3><p>Information about the anatomy of a pattern is kept in a CGPattern object. You create a CGPattern object by calling the function <code><a href="../../../Reference/CGPattern/Reference/reference.html#//apple_ref/doc/c_ref/CGPatternCreate" target="_top">CGPatternCreate</a></code>, whose prototype is shown in <span class="content_text">Listing 6-3</span>. </p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJDFFD" title="Listing 6-3The CGPatternCreate function prototype"></a><p class="codesample"><strong>Listing 6-3&nbsp;&nbsp;</strong>The CGPatternCreate function prototype</p><div class="codesample"><table><tr><td scope="row"><pre>CGPatternRef CGPatternCreate (  void *info,<span></span></pre></td></tr><tr><td scope="row"><pre>                                CGRect bounds,<span></span></pre></td></tr><tr><td scope="row"><pre>                                CGAffineTransform matrix,<span></span></pre></td></tr><tr><td scope="row"><pre>                                float xStep,<span></span></pre></td></tr><tr><td scope="row"><pre>                                float yStep,<span></span></pre></td></tr><tr><td scope="row"><pre>                                CGPatternTiling tiling,<span></span></pre></td></tr><tr><td scope="row"><pre>                                int isColored,<span></span></pre></td></tr><tr><td scope="row"><pre>                                const CGPatternCallbacks *callbacks );<span></span></pre></td></tr></table></div><p>The <code>info</code> parameter is a pointer to data you want to pass to your drawing callback. This is the same pointer discussed in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEHCFD">“Write a Callback Function That Draws a Colored Pattern Cell.”</a></span></p><p>You specify the size of the pattern cell in the <code>bounds</code> parameter. The <code>matrix</code> parameter is where you specify the pattern matrix, which maps the pattern coordinate system to the default coordinate system of the graphics context. Use the identity matrix if you want to draw the pattern using the same coordinate system as the graphics context. The <code>xStep</code> and <code>yStep</code> parameters specify the horizontal and vertical spacing between cells in the pattern coordinate system. See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCIAJCH">“The Anatomy of a Pattern”</a></span> to review information on bounds, pattern matrix, and spacing.</p><p>The <code>tiling</code> parameter can be one of three values:</p><ul class="spaceabove"><li class="li"><p><code><a href="../../../Reference/CGPattern/Reference/reference.html#//apple_ref/doc/c_ref/kCGPatternTilingNoDistortion" target="_top">kCGPatternTilingNoDistortion</a></code></p></li><li class="li"><p><code><a href="../../../Reference/CGPattern/Reference/reference.html#//apple_ref/doc/c_ref/kCGPatternTilingConstantSpacingMinimalDistortion" target="_top">kCGPatternTilingConstantSpacingMinimalDistortion</a></code></p></li><li class="li"><p><code><a href="../../../Reference/CGPattern/Reference/reference.html#//apple_ref/doc/c_ref/kCGPatternTilingConstantSpacing" target="_top">kCGPatternTilingConstantSpacing</a></code></p></li></ul><p>See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCDHCEH">“Tiling”</a></span> to review information on tiling.</p><p>The <code>isColored</code> parameter specifies whether the pattern cell is a colored pattern (<code>true</code>) or a stencil pattern (<code>false</code>). If you pass true here, your drawing pattern callback specifies the pattern color, and you must set the pattern color space to the colored pattern color space (see <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEEJEA">“Set Up the Colored Pattern Color Space”</a></span>).</p><p>The last parameter you pass to the function <code>CGPatternCreate</code> is a pointer to a <code>CGPatternCallbacks</code> data structure. This structure has three fields:</p><div class="codesample"><table><tr><td scope="row"><pre>struct CGPatternCallbacks<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned int version;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPatternDrawPatternCallback drawPattern;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPatternReleaseInfoCallback releaseInfo;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>You set the <code>version</code> field to <code>0</code>. The <code>drawPattern</code> field is a pointer to your drawing callback. The <code>releaseInfo</code> field is a pointer to a callback that’s invoked when the CGPattern object is released, to release storage for the <code>info</code> parameter you passed to your drawing callback. If you didn’t pass any data in this parameter, you set this field to <code>NULL</code>.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCDECDJ" title="Specify the Colored Pattern as a Fill or Stroke Pattern"></a><h3>Specify the Colored Pattern as a Fill or Stroke Pattern</h3><p>You can use your pattern for filling or stroking by calling the appropriate function—<code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextSetFillPattern" target="_top">CGContextSetFillPattern</a></code> or <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextSetStrokePattern" target="_top">CGContextSetStrokePattern</a></code>. Quartz uses your pattern for any subsequent filling or stroking.</p><p>These functions each take three parameters:</p><ul class="spaceabove"><li class="li"><p>The graphics context</p></li><li class="li"><p>The CGPattern object that you created previously</p></li><li class="li"><p>An array of color components</p></li></ul><p>Although colored patterns supply their own color, you must pass a single alpha value to inform Quartz of the overall opacity of the pattern when it’s drawn. Alpha can vary from 1 (completely opaque) to 0 (completely transparent). <span class="content_text">Listing 6-4</span> shows an example of how to set opacity for a colored pattern used to fill.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCCJAG" title="Listing 6-4Code that sets opacity for a colored pattern that&acirc;&#128;&#153;s used to fill"></a><p class="codesample"><strong>Listing 6-4&nbsp;&nbsp;</strong>Code that sets opacity for a colored pattern that’s used to fill</p><div class="codesample"><table><tr><td scope="row"><pre>float alpha = 1;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CGContextSetFillPattern (myContext, myPattern, &amp;alpha);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCIFID" title="Draw With the Colored Pattern"></a><h3>Draw With the Colored Pattern</h3><p>After you’ve completed the previous steps, you can call any Quartz 2D function that paints. Your pattern is used as the “paint.” For example, you can call <code>CGContextStrokePath</code>, <code>CGContextFillPath</code>, <code>CGContextFillRect</code>, or any other function that paints.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCGHGAG" title="A Complete Colored Pattern Painting Function"></a><h3>A Complete Colored Pattern Painting Function</h3><p>The code in <span class="content_text">Listing 6-5</span> contains a function that paints a colored pattern. The function incorporates all the steps discussed previously. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCGAHGB" title="Listing 6-5A function that paints a colored pattern"></a><p class="codesample"><strong>Listing 6-5&nbsp;&nbsp;</strong>A function that paints a colored pattern</p><div class="codesample"><table><tr><td scope="row"><pre>void MyColoredPatternPainting (CGContextRef myContext,<span></span></pre></td></tr><tr><td scope="row"><pre>                 CGRect rect)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPatternRef    pattern;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRef patternSpace;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    float           alpha = 1,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    width, height;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    static const    CGPatternCallbacks callbacks = {0, <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                                        &amp;MyDrawPattern,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NULL};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSaveGState (myContext);<span></span></pre></td></tr><tr><td scope="row"><pre>    patternSpace = CGColorSpaceCreatePattern (NULL);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetFillColorSpace (myContext, patternSpace);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRelease (patternSpace);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    pattern = CGPatternCreate (NULL, <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                    CGRectMake (0, 0, H_PSIZE, V_PSIZE),<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                    CGAffineTransformMake (1, 0, 0, 1, 0, 0),<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                    H_PATTERN_SIZE, <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>                    V_PATTERN_SIZE, <span>// 13</span></pre></td></tr><tr><td scope="row"><pre>                    kCGPatternTilingConstantSpacing,<span>// 14</span></pre></td></tr><tr><td scope="row"><pre>                    true, <span>// 15</span></pre></td></tr><tr><td scope="row"><pre>                    &amp;callbacks);<span>// 16</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetFillPattern (myContext, pattern, &amp;alpha);<span>// 17</span></pre></td></tr><tr><td scope="row"><pre>    CGPatternRelease (pattern);<span>// 18</span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext, rect);<span>// 19</span></pre></td></tr><tr><td scope="row"><pre>    CGContextRestoreGState (myContext);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares storage for a CGPattern object that is created later.</p></li><li class="li"><p>Declares storage for a pattern color space that is created later.</p></li><li class="li"><p>Declares a variable for alpha and sets it to <code>1</code>. This specifies the opacity of the pattern as completely opaque.</p></li><li class="li"><p>Declares variable to hold the height and width of the window. In this example, the pattern is painted over the area of a window.</p></li><li class="li"><p>Declares and fills a callbacks structure, passing <code>0</code> as the version and a pointer to a drawing callback function. This example does not provide a release info callback, so that field is set to <code>NULL</code>.</p></li><li class="li"><p>Creates a pattern color space object, setting the pattern’s base color space to <code>NULL</code>. When you paint a colored pattern, the pattern supplies its own color in the drawing callback, which is why you set the color space to <code>NULL</code>.</p></li><li class="li"><p>Sets the fill color space to the pattern color space object you just created.</p></li><li class="li"><p>Releases the pattern color space object.</p></li><li class="li"><p>Passes <code>NULL</code> because the pattern does not need any additional information passed to the drawing callback. </p></li><li class="li"><p>Passes a CGRect object that specifies the bounds of the pattern cell.</p></li><li class="li"><p>Passes a CGAffineTransform matrix that specifies how to translate the pattern space to the default user space of the context in which the pattern is used. This example passes the identity matrix.</p></li><li class="li"><p>Passes the horizontal pattern size as the horizontal displacement between the start of each cell. In this example, one cell will be painted adjacent to the next.</p></li><li class="li"><p>Passes the vertical pattern size as the vertical displacement between start of each cell. </p></li><li class="li"><p>Passes the constant <code>kCGPatternTilingConstantSpacing</code> to specify how Quartz should render the pattern. For more information, see <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCDHCEH">“Tiling.”</a></span></p></li><li class="li"><p>Passes <code>true</code> for the <code>isColored</code> parameter, to specify that the pattern is a colored pattern.</p></li><li class="li"><p>Passes a pointer to the callbacks structure that contains version information, and a pointer to your drawing callback function.</p></li><li class="li"><p>Sets the fill pattern, passing the context, the CGPattern object you just created, and a pointer to the alpha value that specifies an opacity for Quartz to apply to the pattern.</p></li><li class="li"><p>Releases the CGPattern object.</p></li><li class="li"><p>Fills a rectangle that is the size of the window passed to the <code>MyColoredPatternPainting</code> routine. Quartz fills the rectangle using the pattern you just set up.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJAJEC" title="Painting Stencil Patterns"></a><h2>Painting Stencil Patterns</h2><p>There are five steps you need to perform to paint a stencil pattern: </p><ol class="ol"><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBGDFH">“Write a Callback Function That Draws a Stencil Pattern Cell”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCHCBDI">“Set Up the Stencil Pattern Color Space”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCCIGGF">“Set Up the Anatomy of the Stencil Pattern”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCDEJFH">“Specify the Stencil Pattern as a Fill or Stroke Pattern”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCHDJBE">“Draw With the Stencil Pattern”</a></span></p></li></ol><p>These are actually the same steps you use to paint a colored pattern. The difference between the two is how you set up color information. Each of the subsequent sections explains how to implement each step. You can see how all the steps fit together in <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCGDFGH">“A Complete Stencil Pattern Painting Function.”</a></span></p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCBGDFH" title="Write a Callback Function That Draws a Stencil Pattern Cell"></a><h3>Write a Callback Function That Draws a Stencil Pattern Cell</h3><p>The callback you write for drawing a stencil pattern follows the same form as that described for a colored pattern cell. See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCEHCFD">“Write a Callback Function That Draws a Colored Pattern Cell.”</a></span> The only difference is that your drawing callback does not specify any color. The pattern cell shown in <span class="content_text">Figure 6-10</span> does not get its color from the drawing callback. The color is set outside the drawing color in the pattern color space.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCGGJHE" title="Figure 6-10A stencil pattern cell"></a><p><strong>Figure 6-10&nbsp;&nbsp;</strong>A stencil pattern cell</p><img src = "../Art/star_stencil.gif" alt = "A stencil pattern cell" width="58" height="55"></div><br/><p>Take a look at the code in <span class="content_text">Listing 6-6</span>, which draws the pattern cell shown in <span class="content_text">Figure 6-10</span>. Notice that the code simply creates a path and fills the path. The code does not set color. </p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJAAGH" title="Listing 6-6A drawing callback that draws a stencil pattern cell"></a><p class="codesample"><strong>Listing 6-6&nbsp;&nbsp;</strong>A drawing callback that draws a stencil pattern cell</p><div class="codesample"><table><tr><td scope="row"><pre>#define PSIZE 16    // size of the pattern cell<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static void MyDrawStencilStar (void *info, CGContextRef myContext)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int k;<span></span></pre></td></tr><tr><td scope="row"><pre>    double r, theta;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    r = 0.8 * PSIZE / 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    theta = 2 * M_PI * (2.0 / 5.0); // 144 degrees<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextTranslateCTM (myContext, PSIZE/2, PSIZE/2);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextMoveToPoint(myContext, 0, r);<span></span></pre></td></tr><tr><td scope="row"><pre>    for (k = 1; k &lt; 5; k++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CGContextAddLineToPoint (myContext,<span></span></pre></td></tr><tr><td scope="row"><pre>                    r * sin(k * theta),<span></span></pre></td></tr><tr><td scope="row"><pre>                    r * cos(k * theta));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextClosePath(myContext);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillPath(myContext);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCHCBDI" title="Set Up the Stencil Pattern Color Space"></a><h3>Set Up the Stencil Pattern Color Space</h3><p>Stencil patterns require that you set up a pattern color space for Quartz to paint with, as shown in <span class="content_text">Listing 6-7</span>. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCEJFHH" title="Listing 6-7Code that creates a pattern color space for a stencil pattern"></a><p class="codesample"><strong>Listing 6-7&nbsp;&nbsp;</strong>Code that creates a pattern color space for a stencil pattern</p><div class="codesample"><table><tr><td scope="row"><pre>CGPatternRef pattern;<span></span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRef baseSpace;<span></span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRef patternSpace;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>baseSpace = CGColorSpaceCreateWithName (kCGColorSpaceGenericRGB);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>patternSpace = CGColorSpaceCreatePattern (baseSpace);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>CGContextSetFillColorSpace (myContext, patternSpace);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRelease(patternSpace);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRelease(baseSpace);<span>// 5</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>In Mac OS X v10.4, this function creates a generic RGB space. Generic color spaces leave color matching to the system. For more information, see <span class="content_text"><a href="../dq_color/dq_color.html#//apple_ref/doc/uid/TP30001066-CH205-BCIEDGFI">“Creating Generic Color Spaces.”</a></span></p></li><li class="li"><p>Creates a pattern color space. The color space you supply specifies how colors are represented for the pattern. Later, when you set colors for the pattern, you must set them using the pattern color space. For this example, you will need to specify color using RGB values.</p></li><li class="li"><p>Sets the color space to use when filling a pattern. You can set a stroke color space by calling the function <code>CGContextSetStrokeColorSpace</code>.</p></li><li class="li"><p>Releases the base color space object.</p></li><li class="li"><p>Releases the pattern color space object.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCIGGF" title="Set Up the Anatomy of the Stencil Pattern"></a><h3>Set Up the Anatomy of the Stencil Pattern</h3><p>You specify information about the anatomy of a pattern the way you would for a colored pattern—by calling the function <code>CGPatternCreate</code>. The only difference is that you pass <code>false</code> for the <code>isColored</code> parameter. See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCBFEGD">“Set Up the Anatomy of the Colored Pattern”</a></span> for more information on the parameters you supply to the <code>CGPatternCreate</code> function.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCDEJFH" title="Specify the Stencil Pattern as a Fill or Stroke Pattern"></a><h3>Specify the Stencil Pattern as a Fill or Stroke Pattern</h3><p>You can use your pattern for filling or stroking by calling the appropriate function, <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextSetFillPattern" target="_top">CGContextSetFillPattern</a></code> or <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextSetStrokePattern" target="_top">CGContextSetStrokePattern</a></code>. Quartz uses your pattern for any subsequent filling or stroking.</p><p>These functions each take three parameters:</p><ul class="spaceabove"><li class="li"><p>The graphics context</p></li><li class="li"><p>The CGPattern object that you created previously</p></li><li class="li"><p>An array of color components</p></li></ul><p>A stencil pattern does not supply a color in the drawing callback, so you must pass a color to the fill or stroke functions to inform Quartz what color to us. <span class="content_text">Listing 6-8</span> shows an example of how to set color for a stencil pattern. The values in the color array will be interpreted by Quartz in the color space you set up earlier. Because this example uses device RGB, the color array contains values for red, green, and blue components. The fourth value specifies the opacity of the color.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCJCCGG" title="Listing 6-8Code that sets opacity for a colored pattern"></a><p class="codesample"><strong>Listing 6-8&nbsp;&nbsp;</strong>Code that sets opacity for a colored pattern</p><div class="codesample"><table><tr><td scope="row"><pre>static const float color[4] = { 0, 1, 1, 0.5 }; //cyan, 50% transparent<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CGContextSetFillPattern (myContext, myPattern, color);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCHDJBE" title="Draw With the Stencil Pattern"></a><h3>Draw With the Stencil Pattern</h3><p>After you’ve completed the previous steps, you can call any Quartz 2D function that paints. Your pattern is used as the “paint.” For example, you can call <code>CGContextStrokePath</code>, <code>CGContextFillPath</code>, <code>CGContextFillRect</code>, or any other function that paints.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCGDFGH" title="A Complete Stencil Pattern Painting Function"></a><h3>A Complete Stencil Pattern Painting Function</h3><p>The code in <span class="content_text">Listing 6-9</span> contains a function that paints a stencil pattern. The function incorporates all the steps discussed previously. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH206-BBCCIGGG" title="Listing 6-9A function that paints a stencil pattern"></a><p class="codesample"><strong>Listing 6-9&nbsp;&nbsp;</strong>A function that paints a stencil pattern</p><div class="codesample"><table><tr><td scope="row"><pre>#define PSIZE 16<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void MyStencilPatternPainting (CGContextRef myContext,<span></span></pre></td></tr><tr><td scope="row"><pre>                                const Rect *windowRect)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPatternRef pattern;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRef baseSpace;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRef patternSpace;<span></span></pre></td></tr><tr><td scope="row"><pre>    static const float color[4] = { 0, 1, 0, 1 };<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    static const CGPatternCallbacks callbacks = {0, &amp;drawStar, NULL};<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    baseSpace = CGColorSpaceCreateDeviceRGB ();<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    patternSpace = CGColorSpaceCreatePattern (baseSpace);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetFillColorSpace (myContext, patternSpace);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRelease (patternSpace);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGColorSpaceRelease (baseSpace);<span></span></pre></td></tr><tr><td scope="row"><pre>    pattern = CGPatternCreate(NULL, CGRectMake(0, 0, PSIZE, PSIZE),<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                  CGAffineTransformIdentity, PSIZE, PSIZE,<span></span></pre></td></tr><tr><td scope="row"><pre>                  kCGPatternTilingConstantSpacing,<span></span></pre></td></tr><tr><td scope="row"><pre>                  false, &amp;callbacks);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetFillPattern (myContext, pattern, color);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    CGPatternRelease (pattern);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    CGContextFillRect (myContext,CGRectMake (0,0,PSIZE*20,PSIZE*20));<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares an array to hold a color value and sets the value (which will be in RGB color space) to opaque green.</p></li><li class="li"><p>Declares and fills a callbacks structure, passing <code>0</code> as the version and a pointer to a drawing callback function. This example does not provide a release info callback, so that field is set to <code>NULL</code>.</p></li><li class="li"><p>Creates an RGB device color space. If the pattern is drawn to a display, you need to supply this type of color space.</p></li><li class="li"><p>Creates a pattern color space object from the RGB device color space. </p></li><li class="li"><p>Sets the fill color space to the pattern color space object you just created.</p></li><li class="li"><p>Creates a pattern object. Note that the second to last parameter—the <code>isColored</code> parameter—is <code>false</code>. Stencil patterns do not supply color, so you must pass <code>false</code> for this parameter. All other parameters are similar to those passed for the colored pattern example. See <span class="content_text"><a href="dq_patterns.html#//apple_ref/doc/uid/TP30001066-CH206-BBCGHGAG">“A Complete Colored Pattern Painting Function.”</a></span></p></li><li class="li"><p>Sets the fill pattern, passing the color array declared previously.</p></li><li class="li"><p>Releases the CGPattern object.</p></li><li class="li"><p>Fills a rectangle. Quartz fills the rectangle using the pattern you just set up.</p></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_affine/dq_affine.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_shadows/dq_shadows.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_patterns/dq_patterns.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_patterns/dq_patterns.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_patterns/dq_patterns.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>