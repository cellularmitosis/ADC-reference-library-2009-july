<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Setting the Delegates of Database Contexts and Adaptor Contexts</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.37.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.39.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=635137"> </A><A NAME="12885"> </A>Setting the Delegates of Database Contexts and Adaptor Contexts</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=635138"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=635139"> </A>Describes how to set the delegates for EODatabaseContexts, EOAdaptorContexts, and their channels. </P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=635140"> </A> Discussion</H2><P CLASS="Body"><A NAME="pgfId=635141"> </A>The delegates for EODatabaseContexts, EOAdaptorContexts, and their channels receive messages that, if they properly implement the corresponding methods, enable them to generate custom primary keys, fine-tune the behavior of batch faulting, satisfy a fetch request from a local cache, and accomplish a variety of other tasks (see the reference documentation for <TT CLASS="Code">EODatabaseContext.DelegateDelegation</TT>). Because EODatabaseContexts, EODatabaseChannels, and related objects are created dynamically, it's a little tricky to set their delegates. The mechanism that you use to set delegates for these objects is notification.</P><P CLASS="Body"><A NAME="pgfId=635142"> </A>When an EOCooperatingObjectStore is added to the EOObjectStoreCoordinator, the coordinator posts an <TT CLASS="Code">EOCooperatingObjectStoreWasAdded</TT> notification. Since EODatabaseContexts are subclasses of EOCooperatingObjectStore, this notification is posted whenever a database context is created and added to the coordinator. To catch this notification, just set up an observing object that listens for the <TT CLASS="Code">EOCooperatingObjectStoreWasAdded</TT> notification. </P><P CLASS="Body"><A NAME="pgfId=635143"> </A>Whenever the designated method of the observing object is invoked via notification, the coordinator is passed in as the notification object. Given the coordinator, you can traverse all the cooperating object stores and set delegates for them. </P><P CLASS="Body"><A NAME="pgfId=635144"> </A>When you set the delegate of an EODatabaseContext object, that delegate object is propagated to all of the EODatabaseContext's EODatabaseChannels. An EOAdaptorChannel is always created along with the creation of an EODatabaseChannel and an EOAdaptorContext is always created along with creation of an EODatabaseContext; the EODatabaseContext and EODatabaseChannel always keep a reference to these adaptor objects. Through these relationships, a delegate can access EOAdaptorContexts and EOAdaptorChannels from its EODatabaseContext or EODatabaseChannel.</P><P CLASS="Body"><A NAME="pgfId=635279"> </A>The following code shows how to register for <TT CLASS="Code">EOCooperatingObjectStoreWasAdded</TT> notifications in the Session constructor, and then how to set the delegate for each EODatabaseContext. (EOCooperatingObjectStores).</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=635285"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=635287"> </A>public Session() {<A NAME="pgfId=635289"> </A>&nbsp;&nbsp;&nbsp;&nbsp;super();<A NAME="pgfId=635291"> </A>&nbsp;&nbsp;&nbsp;&nbsp;try {<A NAME="pgfId=635293"> </A>        // Create a selector that can be used to define         // a callback to our addedObjectStore method<A NAME="pgfId=635295"> </A>        Class params[]={Class.forName(&quot;com.apple.yellow.foundation.NSNotification&quot;)};<A NAME="pgfId=635297"> </A>        Selector selector=new NSSelector(&quot;addedObjectStore&quot;, params);<A NAME="pgfId=635299"> </A><A NAME="pgfId=635301"> </A>        // Register as a CooperatingObjectStoreWasAdded         // observer with our callback<A NAME="pgfId=635303"> </A>        NSNotificationCenter.defaultCenter().addObserver(this,selector,            EOObjectStoreCoordinator.CooperatingObjectStoreWasAdded, null);<A NAME="pgfId=635305"> </A>    }<A NAME="pgfId=635307"> </A>    catch(Exception e) {<A NAME="pgfId=635309"> </A>        logString(e.toString());<A NAME="pgfId=635311"> </A>    }<A NAME="pgfId=635313"> </A>}<A NAME="pgfId=635315"> </A>public void addedObjectStore(NSNotification notification)<A NAME="pgfId=635317"> </A>{<A NAME="pgfId=635319"> </A>    EOObjectStoreCoordinator coordinator=        (EOObjectStoreCoordinator) notification.object();<A NAME="pgfId=635321"> </A>    NSArray stores=coordinator.cooperatingObjectStores();<A NAME="pgfId=635323"> </A>    NSEnumerator anEnum=(NSEnumerator) stores.objectEnumerator();  <A NAME="pgfId=635325"> </A>   	// make sure all of our stores have our this object as its delegate.<A NAME="pgfId=635327"> </A>    while (anEnum.hasMoreElements()) {<A NAME="pgfId=635329"> </A><A NAME="pgfId=635331"> </A>        EODatabaseContext store=(EODatabaseContext) anEnum.nextElement();<A NAME="pgfId=635333"> </A>        store.setDelegate(this);<A NAME="pgfId=635335"> </A>        logString(&quot;Setting delegate of &quot;+store);<A NAME="pgfId=635337"> </A>    }<A NAME="pgfId=635339"> </A>}</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=635345"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=635347"> </A>- init {<A NAME="pgfId=635349"> </A>    self = [super init];<A NAME="pgfId=635351"> </A>    [[NSNotificationCenter defaultCenter] addObserver: self         selector:@selector(addedObjectStore:)         name:EOCooperatingObjectStoreWasAdded object:nil];<A NAME="pgfId=635353"> </A>    return self;<A NAME="pgfId=635355"> </A>}<A NAME="pgfId=635357"> </A>- (void) addedObjectStore: (NSNotification *)notification<A NAME="pgfId=635359"> </A>{<A NAME="pgfId=635361"> </A>    EOObjectStoreCoordinator *coordinator=[notification object];<A NAME="pgfId=635363"> </A>    NSArray *stores=[coordinator cooperatingObjectStores];<A NAME="pgfId=635365"> </A>   // make sure all of our stores have our this object as its delegate.<A NAME="pgfId=635367"> </A>    [stores makeObjectsPerformSelector: @selector(setDelegate:)         withObject: self];<A NAME="pgfId=635369"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=635519"> </A>  </P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=635370"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=635237"> </A>EODatabaseContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=635238"> </A>EOAdaptorContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=635239"> </A>EOObjectStoreCoordinator class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=635240"> </A>EOCooperatingObjectStore class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=635241"> </A>NSNotificationCenter class specification in the <EM CLASS="Emphasis">Foundation Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=635242"> </A>NSNotification class specification in the <EM CLASS="Emphasis">Foundation Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=639074"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=639075"> </A>How do I dynamically set the delegate for an EODatabaseContext, an EOAdaptorContext, or their related channels?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=635246"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=635247"> </A>Delegate</LI><LI CLASS="Bulleted"><A NAME="pgfId=635511"> </A>Notification</LI><LI CLASS="Bulleted"><A NAME="pgfId=635249"> </A>Adaptor</LI><LI CLASS="Bulleted"><A NAME="pgfId=639084"> </A>Database</LI><LI CLASS="Bulleted"><A NAME="pgfId=639085"> </A>Context</LI><LI CLASS="Bulleted"><A NAME="pgfId=635250"> </A>Channel</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=635252"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=635253"> </A>23 July, 1998. David Scheck. First Draft.</P><P CLASS="Body"><A NAME="pgfId=635491"> </A>17 November, 1998. Terry Donoghue. Second Draft.</P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.37.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.39.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>