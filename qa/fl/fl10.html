<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Q&amp;A FL10: Accessing File Control Blocks</title>         <meta name="keywords" content="Mac OS 8 File Control Blocks FCB accesses">	<meta name="Description" content="Technical Q&amp;A FL10: Q&amp;A provides the correct way to accessfile control blocks for open files. It also reiterates thatthe file control blocks should not be accessed directly andgives several reasons and including documentation for this.Also mentions future plans concerning the FCB in upcomingOS's."><meta name="categories" content="Files"><meta name="week-posted" content="Oct 4, 1999 - Oct 8, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001196" title="Accessing File Control Blocks"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalqas/Carbon/idxFileManagement-date.html">File Management</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A FL10</div>
<div id="pageheadsub">Accessing File Control Blocks</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id=p2>Q: What is the correct way to access a file control block (FCB) for an open file?</P>         <P id =p4>A: The correct way to access the information from an FCBis to use <CODE>FSGetForkCBInfo</CODE> (or its parameter block variants <CODE>PBGetForkCBInfoSync</CODE> and <CODE>PBGetForkCBInfoAsync</CODE>, or <CODE>PBGetFCBInfoSync</CODE> and <CODE>PBGetFCBInfoAsync</CODE> on pre-Mac OS 9.0 systems). In cases where you need immediate access to the FCB it may be necessary to use the File System Manager (FSM) FCB accessors. If FSM is available, you should never access the FCB table or file control blocks (FCBs) directly.</P>         <P id =p4>In Mac OS 9.0, FCBs are no longer stored in a table         pointed to by the low-memory global <CODE>FCBSPtr</CODE>. If         your software accesses FCBs using this low-memory global, it         will either not work in mysterious ways (for 68K code), or         halt the system with a <CODE>dsMustUseFCBAccessors</CODE>         (119) system error (PowerPC code that calls         <CODE>LMGetFCBSPtr</CODE>, <CODE>LMSetFCBSPtr</CODE>, or         <CODE>LMSetFSFCBLen</CODE>).</P>         <TABLE BORDER=0 WIDTH=498>            <TR>               <td bgcolor="#e6e6e6" align=left>                  <P id=p4><B>WARNING:</B></p>                                    <P id=p4>Do not assume a file reference number is an                  offset into a table of FCBs pointed to by the                  low-memory global <CODE>FCBSPtr</CODE>, or that the                  length of an FCB is stored in the low-memory global                  <CODE>FSFCBLen</CODE>. This is no longer the case                  in Mac OS 9.0 and higher.</p>               </TD></TR>         </TABLE>         <P id = p4>There is really only one good reason to access an FCB         immediately: your code is the file system that         controls the volume on which the open file resides.</P>         <P id = p4>Application-level code should always use File Manager         routines to get information from the FCB for an open file.         Appropriate File Manager routines include:</P>                  <UL>            <LI>the high-level routine <CODE>FSGetForkCBInfo</CODE>            (Mac OS 9.0 and higher)</LI>                        <LI>the parameter block routines            <CODE>PBGetForkCBInfoSync</CODE> and            <CODE>PBGetForkCBInfoAsync</CODE> (Mac OS 9.0 and higher)</LI>                        <LI>the parameter block routines            <CODE>PBGetFCBInfoSync</CODE> or            <CODE>PBGetFCBInfoAsync</CODE> (pre-Mac OS 9.0)</LI>         </UL>         <P id = p4>The only fields in the FCB not returned by these routines         are either file system specific, or they are reserved for         the File Manager&#146;s own use. (For example, some fields in an         FCB are used for different purposes by the built-in (HFS or         HFS Plus) file system than what they are used for by the         File Exchange (DOS or ProDOS) file system.) In addition,         some network file systems (for example, AppleShare) use         <CODE>PBGetFCBInfo</CODE> to update the information they         keep in the FCB, so accessing the FCB immediately may give         you stale data.</P>         <P id = p4>However, we recognize that there are circumstances wheredevelopers need immediate access to the FCB, for example, afile system trap patch, or debugging tools such as MacsBug&#146;sFILE <CODE>dcmd</CODE>. In the interest of allowing useful things to keep working, and to allow future enhancements to the File Manager, we now require that you access FCBs using accessor functions. The accessor functions have been public since 1994 as part of the File System Manager (FSM) and FSM has been part of Mac OS since System 7.5. You can check for the presence of FSM with <CODE>Gestalt</CODE> by requesting the<CODE>gestaltFSAttr</CODE> selector and checking for the<CODE>gestaltHasFileSystemManager</CODE> bit in the response.</P>         <P id = p4>The four FCB accessor functions are:</P>                       <OL TYPE="1" START="1">	<LI>   <CODE>UTLocateFCB</CODE>, which finds an FCB by file	             number and volume. (You can also search by filename and	             volume, but that is not very useful since multiple files	             can have the same name on a volume.)</LI>            	<LI>         <CODE>UTLocateNextFCB</CODE>, which finds additional	             FCBs (after using <CODE>UTLocateFCB</CODE>) by file	             number (or name) and volume.</LI>            	<LI>         <CODE>UTIndexFCB</CODE>, which indexes through the	             open FCBs on a volume.</LI>            	<LI>         <CODE>UTResolveFCB</CODE>, which maps a file	             reference number to its FCB.</LI></OL>                  <P id = p4>All four functions return a pointer to an FCB and all but         <CODE>UTResolveFCB</CODE> (where the file reference number         is an input parameter) also return the corresponding file         reference number for the FCB.</P>         <P id = p4>A recap of the rules:</P>                  <UL>            <LI>use File Manager routines to access FCB information            in most cases;</LI>                        <LI>if you must access the FCB directly, use the FSM            accessor functions <CODE>UTLocateFCB</CODE>,            <CODE>UTLocateNextFCB</CODE>, <CODE>UTIndexFCB</CODE>,            and <CODE>UTResolveFCB</CODE>; and</LI>                        <LI>only look at the FCB table when FSM is not available            (that is, prior to System 7.5).</LI>         </UL>         <P id = p4>For more information on this topic, see DTS <a href="../../technotes/tn/tn1184.html" target="_blank">Technote 1184, &#147;FCBs,Now and Forever.&#148;</A></P></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Oct 05 1999]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/fl/fl10.html%3Fid%3DDTS10001196-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/fl/fl10.html%3Fid%3DDTS10001196-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/fl/fl10.html%3Fid%3DDTS10001196-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>