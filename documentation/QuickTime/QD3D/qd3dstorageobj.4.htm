<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Creating a Storage Object</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3131"> </A>Creating a Storage Object</H1><P CLASS="T1.Text1"><A NAME="pgfId=3136"> </A><A NAME="marker=3132"> </A>Creating a storage object essentially involves indicating to QuickDraw&nbsp;3D the location and possibly also the size of the piece of physical storage you later want to read data from or write data to. Once you've created a storage object, you attach it to a file object and perform all I/O operations using file object functions. <A HREF="qd3dstorageobj.4.htm#27182" CLASS="XRef">Listing&nbsp;4</A> illustrates how to create a storage object connected to an open Macintosh file.</P><P CLASS="L.Listing"><A NAME="pgfId=3141"> </A>Listing&nbsp;4<A NAME="27182"> </A>Creating a Macintosh storage object</P><CODE CLASS="Cv.Code"><A NAME="pgfId=5282"> </A>myErr = FSpOpenDF(&amp;myFSSpec, fsCurPerm, &amp;myFRefNum);<BR>if (!myErr) <BR>&nbsp;&nbsp;&nbsp;&nbsp;myStorageObj = Q3MacintoshStorage_New(myFRefNum);<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3146"> </A><A HREF="qd3dstorageobj.4.htm#41582" CLASS="XRef">Listing&nbsp;5</A> illustrates how to open a file and create a UNIX storage object connected to that open file.</P><P CLASS="L.Listing"><A NAME="pgfId=3148"> </A>Listing&nbsp;5<A NAME="41582"> </A>Creating a UNIX storage object</P><CODE CLASS="Cv.Code"><A NAME="pgfId=5286"> </A>myFile = fopen(&quot;..:teacup.eb&quot;, &quot;r&quot;);<BR>if (myFile)<BR>&nbsp;&nbsp;&nbsp;&nbsp;myStorageObj = Q3UnixStorage_New(myFile);<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3153"> </A><A HREF="qd3dstorageobj.4.htm#14661" CLASS="XRef">Listing&nbsp;6</A> illustrates how to allocate a block of memory and create a storage object connected to that block.</P><P CLASS="L.Listing"><A NAME="pgfId=3155"> </A>Listing&nbsp;6<A NAME="14661"> </A>Creating a memory storage object</P><CODE CLASS="Cv.Code"><A NAME="pgfId=5290"> </A>#define kBufferSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;256<BR><BR>myBuffer = malloc(kBufferSize);<BR>if (myBuffer)<BR>&nbsp;&nbsp;&nbsp;&nbsp;myStorageObj = Q3MemoryStorage_NewBuffer(myBuffer, 0, kBufferSize);<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3163"> </A>In the code shown in <A HREF="qd3dstorageobj.4.htm#27182" CLASS="XRef">Listing&nbsp;4</A> through <A HREF="qd3dstorageobj.4.htm#14661" CLASS="XRef">Listing&nbsp;6</A>, your application specifically reserves the desired piece of the physical storage device, either by opening a file or by allocating memory. In these cases, your application must also make sure to close the file or deallocate the memory block after you've closed or disposed of the associated storage object.</P><P CLASS="T1.Text1"><A NAME="pgfId=3167"> </A>Note, however, that QuickDraw&nbsp;3D provides two types of memory storage functions. The function <TT CLASS="cv">Q3MemoryStorage_NewBuffer</TT> creates a new memory storage object using a specified buffer. The function <TT CLASS="cv">Q3MemoryStorage_New</TT> creates a new memory storage object but copies the data in the specified buffer into its own internal memory. If you create a storage object by calling <TT CLASS="cv">Q3MemoryStorage_New</TT>, you can dispose of the buffer once <TT CLASS="cv">Q3MemoryStorage_New</TT> returns.</P><P CLASS="I.Important"><A NAME="pgfId=3168"> </A>Whenever you create a storage object associated with an open file or an allocated memory block, you must close the file or dispose of the memory yourself. </P><P CLASS="W.Warning"><A NAME="pgfId=3209"> </A><A NAME="24563"> </A>When you open a piece of storage (that is, a file or a block of memory), you must not access that piece of storage once you've created a storage object to represent it. QuickDraw&nbsp;3D assumes that it has exclusive access to all data in any part of a physical storage device associated with an open storage object. <A NAME="marker=3219"> </A></P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>