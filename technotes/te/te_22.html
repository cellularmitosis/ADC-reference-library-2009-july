<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TE22: Font Height Tables</title>                                       <meta name="categories" content="Text"><meta name="week-posted" content="Mar 31, 1986 - Apr 4, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002830" title="Font Height Tables"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TE22</div>
<div id="pageheadsub">Font Height Tables</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This technical note describes how the Font Manager (except in 64K ROMs)calculates height tables for fonts and how you can force recalculation.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1986]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><p>In order to expedite the processing of fonts, the Font Manager (in anythingnewer than the 64K ROMs) calculates a height table for all of the characters ina font when the font is first loaded into memory. This height table is thenappended to the end of the font resource in memory; if some program (such as afont editor) subsequently saves the font, the height table will be saved withthe font and will not have to be built again. This is fine for most casesexcept, for example, when the tables really should be recalculated, such as ina font editor when the ascent and/or descent have changed.</p><p>The following is an example of how to eliminate the height table from a font:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    IF (BitAnd(hStrike^^.fontTyp,$1)=1) THEN BEGIN {We have a height table}       {Truncate the height table}       SetHandleSize(Handle(hStrike),GetHandleSize(Handle(hStrike)-                     (2*(hStrike^^.lastChar-hStrike^^.firstChar)+3)));       {We no longer have a height table so set the flag to indicate that}       hStrike^^.format := BitAnd(hStrike^^.fontType,$FFFFFFFE);</pre>	</TD></TR></TABLE></CENTER><h3>In MPW C:</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    if ((**hStrike).fontType &amp; 0x1 ==1) { /*We have a height table*/       /*Truncate the height table*/       SetHandleSize((Handle)hStrike,GetHandleSize((Handle)hStrike)-                     (2*((**hStrike).lastChar-(**hStrike).firstChar)+3));       /*We no longer have a height table so set the flag to indicate that*/       (**hStrike).fontType = (**hStrike).fontType &amp; 0xFFFFFFFE;</pre>	</TD></TR></TABLE></CENTER><p>where <code>hStrike</code> is a handle to the <code>'FONT'</code> or <code>'NFNT'</code> resource (handle toa <code>FontRec</code>).</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>After the height table has been eliminated, the modified fontshould be saved to disk (with <code>ChangedResource</code> and<code>WriteResource</code>) and purged from memory (using<code>ReleaseResource</code>). This is an important step, because the Font Managerdoes not expect other code to go behind its back removing height tables that ithas calculated.</P></TD></TR></TABLE></CENTER><BR><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P>The Font Manager</p><P>The Resource Manager</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (40K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/te_22.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/te/te_22.html%3Fid%3DDTS10002830-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/te/te_22.html%3Fid%3DDTS10002830-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/te/te_22.html%3Fid%3DDTS10002830-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>