<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>System Startup Programming Topics: The Boot Process</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="The Boot Process"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20002130" title="The Boot Process"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index-date.html#//apple_ref/doc/uid/TP30000440-TP30000471" target="_top">Mac OS X</a> &gt; <a href="../index.html" target="_top">System Startup Programming Topics</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../BPSystemStartup.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Daemons.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20002130-BAJJBJEG" title="The Boot Process"></a><hr /><H1>The Boot Process</H1><p>From the moment a user turns on a Mac OS X system to beyond the time the login window appears, Mac OS X executes a boot sequence that readies the system for use. If you provide system services to all users, you might need to execute some code during this process. The following sections explain the basic boot sequence and the places where your code can tie into it. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-100040-TPXREF103">BootROM</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-115736-TPXREF104">BootX, boot.efi, and System Initialization</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-113713-TPXREF107">Authenticating Users</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-115340">Configuring User Sessions</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-114618-BAJGBJHI">Logout Responsibilities</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-112052">Identifying the Scope of Processes</a>
				
			<br/>
			
        
			
			
				<a href="BootProcess.html#//apple_ref/doc/uid/20002130-SW7">The Shutdown Process</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20002130-100040" title="BootROM"></a><a name="//apple_ref/doc/uid/20002130-100040-TPXREF103" title="BootROM"></a><h2>BootROM</h2><p>When the power to a Macintosh computer is turned on, the <a name="//apple_ref/doc/uid/20002130-DontLinkElementID_15"></a>BootROM firmware is activated. BootROM (which is part of the computer’s hardware) has two primary responsibilities: it initializes system hardware and it selects an operating system to run. BootROM has two components to help it carry out these functions:</p><ul class="ul"><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_16"></a><p>POST (Power-On Self Test) initializes some hardware interfaces and verifies that sufficient memory is available and in a good state.</p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_17"></a><p>On PowerPC-based Macintosh computers, Open Firmware initializes the rest of the hardware, builds the initial device tree (a hierarchical representation of devices associated with the computer), and selects the operating system to use.</p><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_18"></a><p>On Intel-based Macintosh computers, EFI does basic hardware initialization and selects which operating system to use.</p></li></ul><p>If multiple installations of Mac OS X are available, BootROM chooses the one that was last selected by the Startup Disk System Preference. The user can override this choice by holding down the Option key while the computer boots, which causes Open Firmware or EFI to display a screen for choosing the boot volume.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp;On some legacy hardware, the same version of BootROM can start either Mac OS 9 or Mac OS X. Most current hardware can start only Mac OS X.</p></div><a name="//apple_ref/doc/uid/20002130-115736" title="BootX, boot.efi, and System Initialization"></a><a name="//apple_ref/doc/uid/20002130-115736-TPXREF104" title="BootX, boot.efi, and System Initialization"></a><h2>BootX, boot.efi, and System Initialization</h2><p>Once BootROM is finished and a Mac OS X partition has been selected, control passes to the <a name="//apple_ref/doc/uid/20002130-DontLinkElementID_19"></a>BootX (PowerPC) or boot.efi (Intel) boot loader. The principal job of this boot loader is to load the kernel environment. As it does this, the boot loader draws the “booting” image on the screen.</p><p>BootX and boot.efi can be found in the <code>/System/Library/CoreServices</code> directory on the root partition. In addition, a copy of boot.efi can be found at <code>/usr/standalone/i386/boot.efi</code>.</p><p>In "exotic” boot situations such as booting from a software RAID volume, a copy of the boot loader is stored on a separate HFS+ “helper” volume to get the system started. In some versions of Mac OS X, a copy of the kernel and mkext cache are also included on the helper volume. In these cases, the booter and other components on the root volume are unused.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_4" title="Note"></a><p><strong>Note:</strong>&nbsp;Booting from a UFS volume is deprecated as of Mac OS X v10.5.</p></div><p>The boot loader first attempts to load a prelinked version of the kernel that includes all device drivers that are involved in the boot process. This prelinked kernel is located in <code>/System/Library/Caches/com.apple.kernelcaches</code>. By linking these drivers into the kernel ahead of time, boot time is reduced.</p><p>If the prelinked kernel is missing, out-of-date, or corrupt, the boot loader attempts to load that same set of device <a name="//apple_ref/doc/uid/20002130-DontLinkElementID_20"></a>drivers all at once in the form of a single, compressed archive called an mkext cache<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_21"></a>.</p><p>If this cache is also out-of-date, missing, or corrupt, the boot loader searches <code>/System/Library/Extensions</code> for drivers and other kernel extensions whose <code>OSBundleRequired</code> property is set to a value appropriate to the type of boot (for example, local or network boot).</p><p>For more information on how drivers are loaded, see <em><a href="../../../../DeviceDrivers/Conceptual/IOKitFundamentals/index.html#//apple_ref/doc/uid/TP0000011" target="_top">I/O Kit Fundamentals</a></em>. </p><p>Once the kernel<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_22"></a> and all drivers necessary for booting are loaded, the boot loader starts the kernel’s initialization procedure. At this point, enough drivers are loaded for the kernel to find the root device. Also from this point, on PowerPC-based Macintosh computers, Open Firmware is no longer accessible (quiesced).</p><p>The kernel initializes the Mach and BSD data structures and then initializes the I/O Kit<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_23"></a>. The I/O Kit links the loaded drivers into the kernel, using the device tree to determine which drivers to link. Once the kernel finds the root device, it roots(*) BSD off of it.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW2" title="Note"></a><p><strong>Note:</strong>&nbsp;As a terminology aside, the term “boot” was historically reserved for loading a bootstrap loader and kernel off of a disk or partition. In more recent years, the usage has evolved to allow a second meaning: the entire process from initial bootstrap until the OS is generally usable by an end user. In this case, the term is used according to the former meaning.</p>As used here, the term “root” refers to mounting a partition as the root, or top-level, filesystem. Thus, while the OS boots off of the root partition, the kernel roots the OS off of the partition before executing startup scripts from it.</p></div><p>Prior to Mac OS X v10.4, the remaining system initialization was handled by the <code>mach_init</code><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_24"></a> and <code>init</code><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_25"></a> processes. During the course of initialization, these processes would call various system scripts (including <code>/etc/rc</code>), run startup items<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_26"></a>, and generally prepare the system for the user. While many of the same scripts and daemons are still run, the <code>mach_init</code> and <code>init</code> processes have been replaced by <code>launchd</code> in Mac OS X v10.4 and later. This change means that <code>launchd</code> is now the root system process. </p><p><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_27"></a>In addition to initializing the system, the <code>launchd</code><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_28"></a> process coordinates the launching of system daemons in an orderly manner. Like the <code>inetd</code> process, <code>launchd</code> launches daemons on-demand. Daemons launched in this manner can shut down during periods of inactivity and be relaunched as needed. (When a subsequent service request comes in, <code>launchd</code> automatically relaunches the daemon to process the request.)</p><p>This technique frees up memory and other resources associated with the daemon, which is worthwhile if the daemon is likely to be idle for extended periods of time. More importantly, however, this guarantees that runtime dependencies between daemons are satisfied without the need for manual lists of dependencies.</p><p>Next, <code><a href="../../../../Darwin/Reference/ManPages/man8/launchd.8.html#//apple_ref/doc/man/8/launchd" target="_top">launchd</a></code> starts <code><a href="../../../../Darwin/Reference/ManPages/man8/SystemStarter.8.html#//apple_ref/doc/man/8/SystemStarter" target="_top">SystemStarter</a></code>, which starts any non-launch-on-demand daemons.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW3" title="Note"></a><p><strong>Note:</strong>&nbsp;While <code>launchd</code> does support non-launch-on-demand daemons, this use is not recommended. The <code>launchd</code> daemon was designed to remove the need for dependency ordering among daemons. If you do not make your daemon be launch-on-demand, you will have to handle these dependencies in another way, such as by using the legacy startup item mechanism.</p></div><p>For more information about launch-on-demand and <code>SystemStarter</code> daemons and how to launch them, see <span class="content_text"><a href="Daemons.html#//apple_ref/doc/uid/TP40001761-BBCBHBFB">“Daemons.”</a></span></p><p>As the final part of system initialization, <code>launchd</code> launches <code>loginwindow</code><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_29"></a>. The <code>loginwindow</code> program controls several aspects of user sessions and coordinates the display of the login window and the authentication of users.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW4" title="Note"></a><p><strong>Note:</strong>&nbsp;By default, Mac OS X boots with a graphical boot screen. For debugging the boot process, it is often useful to disable this, revealing the text console underneath. This mode is known as verbose boot mode. To enable verbose boot mode, simply hold down command-v after the boot chime.</p></div><a name="//apple_ref/doc/uid/20002130-113713" title="Authenticating Users"></a><a name="//apple_ref/doc/uid/20002130-113713-TPXREF107" title="Authenticating Users"></a><h2>Authenticating Users</h2><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_30"></a><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_31"></a><p>Mac OS X requires users to authenticate themselves prior to accessing the system. The <code>loginwindow</code> program coordinates the visual portion of the login process (as manifested by the window where users enter name and password information) and the security portion (which handles the user authentication). Once a user is authenticated by the security systems, <code>loginwindow</code> begins setting up the user environment. </p><p>In two key situations, <code>loginwindow</code> bypasses the usual login prompt and begins the user session immediately. The first situation occurs when the system administrator has configured the computer to automatically log in as a specified user. The second occurs during software installation when the installer program is to be launched immediately after a reboot.</p><a name="//apple_ref/doc/uid/20002130-115340" title="Configuring User Sessions"></a><h2>Configuring User Sessions</h2><p>Immediately after the user is successfully authenticated, <code>loginwindow</code> sets up the user environment and records information about the login. As part of this process, it performs the following tasks:</p><ul class="ul"><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_32"></a><p>Secures the login session from unauthorized remote access. Applications that are launched remotely are not registered with the pasteboard server’s (Clipboard’s) port. As a result, some standard features are blocked for these processes, including copy, cut, paste, Apple events, window minimization, and other services.</p></li><li class="li"><p>Records the login in the system’s <code>utmp</code> database.</p></li><li class="li"><p>Sets the owner and permissions for the console terminal.</p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_33"></a><p>Resets the user’s preferences to include global system defaults.</p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_34"></a><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_35"></a><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_36"></a><p>Registers the pasteboard server (<code>pbs</code>) with the bootstrap port and launches <code>pbs</code>.</p></li><li class="li"><p>Configures the mouse, keyboard, and system sound using the user’s preferences.</p></li><li class="li"><p>Sets the user’s group permissions (<code>gid</code>).</p></li><li class="li"><p>Retrieves the user record from Directory Services and applies that information to the session.</p></li><li class="li"><p>It loads the user’s computing environment (including preferences, environment variables, device and file permissions, keychain access, and so on). </p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_37"></a><p>It launches the Dock, Finder, and SystemUIServer.</p></li><li class="li"><p>It automatically launches applications specified in the Login Items pane of the Accounts System Preferences for the user.</p></li></ul><p>Once the user session is up and running, <code>loginwindow</code> monitors the session and user applications in the following ways: </p><ul class="ul"><li class="li"><p>It manages the logout, restart, and shutdown procedures. See <span class="content_text"><a href="BootProcess.html#//apple_ref/doc/uid/20002130-114618">“Logout Responsibilities”</a></span> for more information.</p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_38"></a><p>It manages the Force Quit window, which includes monitoring the currently active applications and responding to user requests to force-quit applications and relaunch the Finder. (Users open this window from the Apple menu or by pressing Command-Option-Escape.)</p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_39"></a><p>It writes any standard-error (<code>stderr</code>) output to a log file. Log files are stored in the <code>/Library/Logs/Console/</code><em>&lt;uid></em><code>/console.log</code> file, where <em>&lt;uid></em> is the user ID of the currently logged in user. </p></li></ul><p>If the Finder, Dock, or SystemUIServer processes die for some reason, <code>loginwindow</code> automatically restarts them. In the same manner, if the <code>loginwindow</code> process dies, the <code>launchd</code> process automatically restarts it.</p><a name="//apple_ref/doc/uid/20002130-114618" title="Logout Responsibilities"></a><a name="//apple_ref/doc/uid/20002130-114618-BAJGBJHI" title="Logout Responsibilities"></a><h2>Logout Responsibilities</h2><p><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_40"></a>The procedures for <a name="//apple_ref/doc/uid/20002130-DontLinkElementID_41"></a>logging out, restarting the system, or shutting down the system have similar semantics. The foreground process usually initiates these procedures in response to the user choosing an item from the Apple menu; however, a process can also initiate the procedure programmatically by sending an appropriate Apple event to <code>loginwindow</code>. The <code>loginwindow</code> program carries out the procedure, posting alerts and notifying applications to give them a chance to clean up before closing. </p><p>A typical logout/restart/shutdown procedure is as follows:</p><ol class="ol"><li class="li"><p>The user selects Log Out, Restart, or Shut Down from the Apple menu.</p></li><li class="li"><p>The foreground application initiates the user request by sending an Apple event to <code>loginwindow</code>. (See <span class="content_text"><a href="BootProcess.html#//apple_ref/doc/uid/20002130-114709">“Application Responsibilities”</a></span> for a list of events.)</p></li><li class="li"><p>The <code>loginwindow</code> program displays an alert to the user asking for confirmation of the action.</p></li><li class="li"><p>If the user confirms the action, <code>loginwindow</code> sends a Quit Application Apple event (<code>kAEQuitApplication</code>) to every foreground and background user process. </p></li><li class="li"><p>Once all processes have quit, <code>loginwindow</code> closes out the user session and continues with the action.</p><ul class="ul"><li class="li"><p>For a logout action, <code>loginwindow</code> dequeues all events in the event queue, starts the logout-hook program (if one is defined), records the logout, resets device permissions and user preferences to their defaults, and quits. It is subsequently relaunched by <code>launchd</code> to handle a new login. (See <span class="content_text"><a href="CustomLogin.html#//apple_ref/doc/uid/20002134-BAJCGEGG">“Customizing Login and Logout”</a></span> for more on <code>loginwindow</code> hooks.)</p></li><li class="li"><p>For a restart action, <code>loginwindow</code> sets the device permissions and user preferences to their defaults and then restarts the system.</p></li><li class="li"><p>For a shutdown action, <code>loginwindow</code> powers off the system.</p></li></ul></li></ol><p>Foreground processes can choose not to terminate when they receive the Quit Application event. See <span class="content_text"><a href="BootProcess.html#//apple_ref/doc/uid/20002130-114794">“Terminating Processes”</a></span> for more information. </p><a name="//apple_ref/doc/uid/20002130-114709" title="Application Responsibilities"></a><a name="//apple_ref/doc/uid/20002130-114709-BAJCJIEB" title="Application Responsibilities"></a><h3>Application Responsibilities</h3><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_42"></a><p>To initiate a logout, restart<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_43"></a>, or shutdown<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_44"></a> sequence programmatically, the foreground application must send an appropriate Apple event to <code>loginwindow</code>. Upon receipt of the event, <code>loginwindow</code> begins the process of shutting down the user session. Depending on the Apple event sent by the process, <code>loginwindow</code> may or may not post an alert dialog and give the user a chance to abort the sequence. </p><p>The following list shows the preferred Apple events for logout, restart, and shutdown procedures. These events have no required parameters. </p><ul class="spaceabove"><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_45"></a><p><code>kAELogOut</code></p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_46"></a><p><code>kAEShowRestartDialog</code></p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_47"></a><p><code>kAEShowShutdownDialog</code></p></li></ul><p>Upon receipt of one of these events, <code>loginwindow</code> displays an alert notifying the user of the impending action. At this point, the user may continue with the action or abort it. If the user continues with the action, <code>loginwindow</code> sends an Apple event to each application asking it to quit. See <span class="content_text"><a href="BootProcess.html#//apple_ref/doc/uid/20002130-114794">“Terminating Processes.”</a></span></p><p>In addition to the preferred Apple events, there are two additional events that tell <code>loginwindow</code> to proceed immediately with a restart or shutdown sequence:</p><ul class="spaceabove"><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_48"></a><p><code>kAERestart</code></p></li><li class="li"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_49"></a><p><code>kAEShutDown</code></p></li></ul><p>These events proceed with the corresponding sequence without posting an alert dialog to the user. Thus, if you send one of these events to <code>loginwindow</code>, the user does not have an opportunity to abort the sequence. These events should be used sparingly, if at all. </p><div class="importantbox"><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_5" title="Important:"></a><p><strong>Important:</strong>&nbsp;Note that if a logout, restart, or shutdown event originates from an application in the Classic environment<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_50"></a>, the event affects only the Classic environment and its applications. The rest of the user session continues running. </p><p></p></div><a name="//apple_ref/doc/uid/20002130-114794" title="Terminating Processes"></a><a name="//apple_ref/doc/uid/20002130-114794-BAJIBGGI" title="Terminating Processes"></a><h3>Terminating Processes</h3><p>As part of a log out, restart, or shutdown sequence, <code>loginwindow</code> attempts to terminate all foreground and background user processes. It sends each process a Quit Application Apple event<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_51"></a> (<code><a href="../../../../Carbon/Reference/Apple_Event_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kAEQuitApplication" target="_top">kAEQuitApplication</a></code>), as a courtesy, to give each process a chance to shut itself down gracefully. For foreground processes, <code>loginwindow</code> sends the event and waits for a reply. For background processes, <code>loginwindow</code> sends the event but does not wait for a reply. It terminates any lingering background processes by sending a <code>kill</code> command. </p><p>When a foreground process<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_52"></a> receives the Quit Application Apple event from <code>loginwindow</code>, it should terminate itself immediately or post an alert dialog if a user decision is required first (such as when there is an unsaved document); when that condition is resolved the application should then terminate. If the user decides to abort the termination sequence (by clicking Cancel in a Save dialog, for example) the application should respond to the event by returning a <code>userCancelledErr</code> error.</p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW5" title="Note"></a><p><strong>Note:</strong>&nbsp;Cocoa applications do not see the <code>kAEQuitApplication</code> event directly. The Application Kit notifies your application by calling its <code>applicationShouldTerminate:</code> delegate method. To abort the termination sequence, implement this method and return NSTerminateCancel; otherwise, termination of your application continues normally.</p></div><p>If a foreground application fails to reply or terminate itself after 45 seconds, <code>loginwindow</code> automatically aborts the termination sequence. This safeguard is to protect data in various situations, such as when an application is saving a large file to disk and is unable to terminate in the allotted time. If a foreground application is unresponsive and not doing anything, the user must use the Force Quit window to kill it before proceeding.</p><p>For user background processes<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_53"></a> that link with Carbon, Cocoa, or Java, the procedure is a little different. The <code>loginwindow</code> program notifies the process that it is about to be terminated by sending it a Quit Application Apple event (<code><a href="../../../../Carbon/Reference/Apple_Event_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kAEQuitApplication" target="_top">kAEQuitApplication</a></code>) as before. Unlike foreground processes, however, <code>loginwindow</code> does not wait for a reply. It proceeds to terminate any open background processes, regardless of any returned errors.</p><p>During a user logout, <code>loginwindow</code> does not terminate processes residing in the root context. These processes reside outside the context of the user session and are terminated only during a restart or shutdown sequence. The <code>loginwindow</code> program also does not kill background processes that are independent of Carbon, Cocoa, or Java, even if they are launched from the user context. (Though launched from a user context, these processes are taken over by the system when the user logs out.) Mac OS X does not send any notifications to system processes before terminating them.<a name="//apple_ref/doc/uid/20002130-DontLinkElementID_54"></a><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_55"></a></p><a name="//apple_ref/doc/uid/20002130-112052" title="Identifying the Scope of Processes"></a><h2>Identifying the Scope of Processes</h2><p><a name="//apple_ref/doc/uid/20002130-DontLinkElementID_56"></a>Although the <code><a href="../../../../Darwin/Reference/ManPages/man8/launchd.8.html#//apple_ref/doc/man/8/launchd" target="_top">launchd</a></code> process owns every other process on the system, a distinction can still be made between user and system processes. Startup items, daemonized processes, and any processes run prior to <code>loginwindow</code> typically run in the root context. Processes in this context provide services to all users of the system. </p><p>Processes that run within the context of an authenticated user session are <em>user processes</em>. User processes are always associated with a particular user session and are usually children of the <code>WindowServer</code> or <code>loginwindow</code> processes associated with the user login. </p><div class="notebox"><a name="//apple_ref/doc/uid/20002130-SW6" title="Note"></a><p><strong>Note:</strong>&nbsp;Not all user processes are children of the <code>WindowServer</code> process. Processes launched as root, and some special system processes, are owned by the user but are children of the <code>launchd</code> process. You can use the ActivityMonitor application to determine the owner and parent of any process on the system.</p></div><a name="//apple_ref/doc/uid/20002130-SW7" title="The Shutdown Process"></a><h2>The Shutdown Process</h2><p>At shutdown, Mac OS X first executes the service stop routines in any <code>SystemStarter</code> startup items such as those described in <span class="content_text"><a href="StartupItems.html#//apple_ref/doc/uid/20002132-CJBBHDII">“Creating a Startup Item.”</a></span></p><p>Next, as with most UNIX-based and UNIX-like operating systems, Mac OS X sends a <code>SIGTERM</code> signal to all running processes prior to shutdown. Upon receiving this signal, your daemon should quickly make an orderly shutdown.</p><p>Every reasonable attempt will be made to wait for it to exit, but it is ultimately the responsibility of your daemon to keep the amount of unsaved state information to a level that can be reasonably written to disk in the time allotted.</p><p>A few seconds later, your daemon will receive a <code>SIGKILL</code> signal and will be terminated.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../BPSystemStartup.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Daemons.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-11-19<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/MacOSX/Conceptual/BPSystemStartup/Articles/BootProcess.html%3Fid%3D10000172i-3.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/MacOSX/Conceptual/BPSystemStartup/Articles/BootProcess.html%3Fid%3D10000172i-3.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/MacOSX/Conceptual/BPSystemStartup/Articles/BootProcess.html%3Fid%3D10000172i-3.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
