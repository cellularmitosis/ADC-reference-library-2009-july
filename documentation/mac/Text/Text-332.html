<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>StyledLineBreak(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING332></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-331.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-333.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-279.html"><B>Chapter 5 - Text Utilities</B></A> / <A HREF="Text-292.html"><B>Text Utilities Reference</B></A><BR><DL><DD><A HREF="Text-299.html"><B>Routines</B></A> / <A HREF="Text-330.html"><B>Working With Word, Script, and Line Boundaries</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING332-0></A>
<H3><A NAME=MARKER-9-379></A><A NAME=MARKER-2-337></A>StyledLineBreak</H3>
 The <CODE>StyledLineBreak</CODE> function returns the proper location to break a line of text. It breaks the line on a word boundary if possible and allows for multiscript runs and style runs on a single line<A NAME=MARKER-2-453></A>.<A NAME=MARKER-1-382></A><P>
<PRE>
FUNCTION StyledLineBreak(textPtr: Ptr; textLen: LongInt;
                  textStart, textEnd, flags: LongInt;
                  VAR textWidth: Fixed;
                  VAR textOffset: LongInt): StyledLineBreakCode;
</PRE>
<DL>
<DT><CODE>textPtr</CODE>
<DD> A pointer to the beginning of a script run on the current line to be broken.
<DT><CODE>textLen</CODE>
<DD> The number of bytes in the script run on the current line to be broken.
<DT><CODE>textStart</CODE>
<DD> A byte offset to the beginning of a style run within the script run.
<DT><CODE>textEnd</CODE>
<DD> A byte offset to the end of the style run within the script run.
<DT><CODE>flags</CODE>
<DD> Reserved for future expansion; must be 0.
<DT><CODE>textWidth</CODE>
<DD> The maximum length of the displayed line in pixels. <CODE>StyledLineBreak</CODE> decrements this value for its own use. Your responsibility is to set it before your first call to <CODE>StyledLineBreak</CODE> for a line.
<DT><CODE>textOffset</CODE>
<DD> Must be nonzero on your first call to <CODE>StyledLineBreak</CODE> for a line, and zero for subsequent calls to <CODE>StyledLineBreak</CODE> for that line. This value allows <CODE>StyledLineBreak</CODE> to differentiate between the first and subsequent calls, which is important when a long word is found (as described below).
<DT>
<DD> On output, <CODE>textOffset</CODE> is the count of bytes from <CODE>textPtr</CODE> to the location in the text string where the line break is to occur.
</DL>
<A NAME=HEADING332-11></A>
<H5>DESCRIPTION</H5>
 Use the <CODE>StyledLineBreak</CODE> function when you are laying out lines in an environment that may include text from multiple scripts. To use this function, you need to understand how QuickDraw draws text, which is described in the chapter "QuickDraw Text" in this book.<P>
 You can only use the <CODE>StyledLineBreak</CODE> function when you have organized your text in script runs and style runs within each script run. This type of text organization is used by most text-processing applications that allow for multiscript text. Use this function when you are displaying text in a screen area to determine the best place to break each displayed line. For an overview of how to use this function, read the section <A HREF=Text-289.html#MARKER-9-171>"Finding Line Breaks" beginning on page 5-24</A>.<P>
 What you do is iterate through your text, a script run at a time starting from the first character past the end of the previous line. Use <CODE>StyledLineBreak</CODE> to check each style run in the script run (in memory order) until the function determines that it has arrived at a line break. As you loop through each style run, before calling <CODE>StyledLineBreak</CODE>, you must set the text values in the graphics port record that are used by QuickDraw to measure the text. These include the font, font size, and font style of the style run. An example of a loop that uses this function is found in <A HREF=Text-289.html#MARKER-9-178>Listing 5-4 on page 5-27</A>.<P>
 When used with unformatted text, <CODE>textStart</CODE> can be 0, and <CODE>textEnd</CODE> is identical to <CODE>textLen</CODE>. With styled text, the interval between <CODE>textStart</CODE> and <CODE>textEnd</CODE> specifies a style run. The interval between <CODE>textPtr</CODE> and <CODE>textLen</CODE> specifies a script run. Note that the style runs in <CODE>StyledLineBreak</CODE> must be traversed in memory order, not in display order.<P>
 If the current style run is included in a contiguous sequence of other style runs of the same script, then <CODE>textPtr</CODE> should point to the start of the first style run of the same script on the line, and <CODE>textLen</CODE> should include the last style run of the same script on the line. This is because word boundaries can extend across style runs, but not across script runs.<P>
 <CODE>StyledLineBreak</CODE> automatically decrements the <CODE>textWidth</CODE> variable by the width of the style run for use on the next call. You need to set the value of <CODE>textWidth</CODE> before calling it to process a line.<P>
 The <CODE>textOffset</CODE> parameter must be nonzero for the first call on a line and zero for each call to the function on the line. This allows <CODE>StyledLineBreak</CODE> to act differently when a long word is encountered: if the word is in the first style run on the line, <CODE>StyledLineBreak</CODE> breaks the line on a character boundary within the word; if the word is in a subsequent style run on the line, <CODE>StyledLineBreak</CODE> breaks the line before the start of the word.<P>
 When <CODE>StyledLineBreak</CODE> finds a line break, it sets the value of <CODE>textOffset</CODE> to the count of bytes that can be displayed starting at <CODE>textPtr</CODE>.<P>
<DL>
<DT><B>IMPORTANT</B>
<DD>When <CODE>StyledLineBreak</CODE> is called for the second or subsequent style runs within a script run, the <CODE>textOffset</CODE> value at exit may be less than the <CODE>textStart</CODE> parameter (that is, it may specify a line break before the current style run).<EM></EM>   <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 Although the offsets are in long integer values and the widths are in fixed values for future extensions, in the current version the long integer values are restricted to the integer range, and only the integer portion of the widths is used.<P>
 <CODE>StyledLineBreak</CODE> always chooses a line break for the last style run on the line in memory order as if all whitespace in that style run would be stripped. The <CODE>VisibleLength</CODE> function, which is a QuickDraw function used to eliminate trailing spaces from a style run before drawing it, can be called for the style run that is at the display end of a line. This leads to a potential conflict when both functions are used with mixed-directional text: if the end of a line in memory order actually occurs in the middle of the displayed line, <CODE>StyledLineBreak</CODE> assumes that the whitespace is stripped from that run, but <CODE>VisibleLength</CODE> does not strip the characters. The <CODE>VisibleLength</CODE> function is described in the chapter "QuickDraw Text" in this book.<P>
 The <CODE>StyledLineBreak</CODE> result (defined by the <CODE>StyledLineBreakCode</CODE> data type) indicates whether the function broke on a word boundary or a character boundary, or if the width extended beyond the edge of the text<A NAME=MARKER-2-362></A>.<A NAME=MARKER-2-363></A><P>
<A NAME=HEADING332-24></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The trap macro and routine selector for the <CODE>StyledLineBreak</CODE> function are
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Trap macro<TH>Selector<TR>
<TD>_ScriptUtil<TD>$821C FFFE</TABLE>
<P>
<A NAME=HEADING332-26></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>BreakOverflow<TD>2<TD>No line break is yet necessary, since the current style run still fits on the line<TR>
<TD>BreakChar<TD>1<TD>Line breaks on character boundary<A NAME=MARKER-9-366></A><TR>
<TD>BreakWord<TD>0<TD>Line breaks on word boundary<A NAME=MARKER-2-47></A></TABLE>
</H5>
<A NAME=HEADING332-27></A>
<H5>SEE ALSO</H5>
 For details on the <CODE>VisibleLength</CODE>, <CODE>TextWidth</CODE>, and <CODE>PortionText</CODE> functions, see the chapter "QuickDraw Text" in this book.<A NAME=MARKER-2-385></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-331.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-333.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
