<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MacApp's Scripting Model (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING50></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-49.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-51.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-48.html"><B>Chapter 6 - Scripting</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING50-0></A>
<H1><A NAME=MARKER-2-46></A>MacApp's Scripting Model</H1>
 MacApp supports the Apple event object model (described on <A HREF=MacAppProgGuide-49.html#MARKER-9-20>page 140</A>). MacApp uses a global Apple event dispatcher object to serve as an intermediary between the Apple Event Manager (and its Object Support Library component) and the objects in your application that can respond to Apple events.<P>
 The objects in a MacApp application are organized in a hierarchy that extends from the application object, to its document objects, to the documents' window objects, and to the windows' view objects. This hierarchy is shown in <A HREF=MacAppProgGuide-17.html#MARKER-9-38>Figure 1-1 on page 7</A>. An object in the hierarchy that needs to respond to Apple events mixes in the multiple inheritance class <CODE><A NAME=MARKER-2-36></A>MScriptableObject</CODE>. That enables the object to describe itself in terms that the OSL can understand, to contain other Apple event objects (such as shapes, paragraphs, words, styles, and so on), to get and set object properties for the objects it contains, and to have an attached script (which can respond to Apple events sent to the object).<P>
<A NAME=HEADING50-3></A>
<H2>Apple Event Targets</H2>
 <A NAME=MARKER-2-49></A>MacApp's Apple event dispatcher object works with the Apple Event Manager, the OSL, and the scriptable objects in the application's object hierarchy to determine which object is the target for an Apple event, and to hand the event off to that object. If a specified object has an attached script, the script gets first shot at handling the Apple event. If an event doesn't specify a target, it is sent to the default target. MacApp specifies the application object as the default Apple event target, with the following line of code (from the <CODE>IApplication</CODE> method):<P>
<PRE>
TOSADispatcher::fgDispatcher-&gt;SetDefaultTarget(this);
</PRE>
<DL>
<DT><B>Note</B>
<DD>The target specified by an Apple event can be a MacApp object (such as a window) or a simpler Apple event object (such as a paragraph of text). However, the target MacApp passes the event to is always a MacApp object that mixes in the <CODE>MScriptableObject</CODE> class. A MacApp object is a typical C++ object, with code and data, that can perform actions. An Apple event object, such as a paragraph of text, may consist of data only and be unable to perform actions. A MacApp object provides access to the Apple event object it represents or contains.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING50-7></A>
<H2><A NAME=MARKER-2-51></A>An Example of the Object Model in Action</H2>
 Suppose an application receives an Apple event equivalent to <P>
<PRE>
Set the color of the first red circle in the window "Test Shapes" to blue
</PRE>
 The application object calls the Apple Event Manager routine <CODE><A NAME=MARKER-10-7></A>AEProcessAppleEvent</CODE> to dispatch the Apple event. The Apple Event Manager calls a callback method of the application's Apple event dispatcher object, which in turn calls the Object Support Library routine <CODE><A NAME=MARKER-2-53></A>AEResolve</CODE> to find the Apple event object specified by the event (in this case, the first red circle).<P>
<B>Figure 6-1  <A NAME=MARKER-9-54></A>Resolving an object specified by an Apple event</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-053.gif"><P>
 The <CODE>AEResolve</CODE> routine makes a series of calls to application callback routines to help locate the specified Apple event object. In MacApp, those callback routines are methods of the Apple event dispatcher object, installed during initialization of MacApp's UScripting unit. The Apple event dispatcher callback routines in turn make calls on application objects (but only those that mix in the <CODE>MScriptableObject</CODE> class) to find the information requested by the OSL.<P>
 <A HREF=#MARKER-9-54>Figure 6-1</A> shows how MacApp objects communicate with the Apple Event Manager and the OSL to resolve an object specifier.<P>
 How does the shape-drawing application actually change the color of the specified circle? MacApp's application class knows how to return a contained window that matches a particular name. In a shape-drawing application, a window object knows how to return a contained circle shape. A shape object mixes in the <CODE>MScriptableObject</CODE> class and overrides the <CODE><A NAME=MARKER-2-99></A>GetObjectProperty</CODE> method to return its current color and the <CODE><A NAME=MARKER-2-100></A>SetObjectProperty</CODE> method to set a new color. In addition, a shape overrides the <CODE>GetCommandContext</CODE> method to return its document as the context for a command that changes the shape. If the application contains a window with the specified name and the window contains a red circle shape, the circle handles the Set Data Apple event by setting its color to blue. (For more information, see <A HREF=MacAppProgGuide-93.html#MARKER-9-37>"Recipe--Setting Object Properties With Apple Events," beginning on page 355</A> and <A HREF=MacAppProgGuide-93.html#MARKER-9-54>"Recipe--Overriding the GetContainedObject Method," beginning on page 368</A>.)<P>
 This mechanism supports Apple event object hierarchies of arbitrary complexity. For example, a more complicated Apple event might require repeated iterations of the following steps:<P>
<UL>
<LI>Get a contained object with a specified property.
<LI>Get a contained object with a specified property from the previously returned object.<P>
</UL>
 The process of returning contained objects continues until the object specified by the Apple event is identified and given the opportunity to respond to the event.<A NAME=MARKER-2-48></A><A NAME=MARKER-2-53></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-49.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-51.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
