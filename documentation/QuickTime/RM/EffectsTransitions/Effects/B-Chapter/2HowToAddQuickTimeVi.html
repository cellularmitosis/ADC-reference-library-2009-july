<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Video Effects and Transitions Guide: How To Add QuickTime Video Effects</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How To Add QuickTime Video Effects"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects" title="How To Add QuickTime Video Effects"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../VideoEffectsTransitions-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000588" target="_top">Video Effects &amp; Transitions</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000868-IntroductiontoQuickTimeVideoEffectsandTransitionsGuide-DontLinkElementID_130">QuickTime Video Effects and Transitions Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../A-Intro/1Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../C-Chapter/3ConstructingaVideoE.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-SW1" title="How To Add QuickTime Video Effects"></a>
<h1>How To Add QuickTime Video Effects</h1>

<p>This chapter discusses how QuickTime video effects are implemented and how you can add effects to QuickTime movies.</p>
<p>The first step in adding effects to a QuickTime movie is to create an effects track. This is accomplished by using the standard QuickTime API for track creation, as explained in this chapter.</p>
<p>You can also use QuickTime video effects to transition between two graphics worlds. Your application does not have to generate a QuickTime movie to use the video effects.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_4">Effect Tracks</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_5">Adding Video Effects to a QuickTime Movie</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_8">Creating an Effects Track</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_9">Creating an Effect Description</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_16">Working with Source Tracks</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_20">Sources Other Than Video Tracks</a>
				
			<br/>
			
        
			
			
				<a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_21">Using Video Effects Outside a QuickTime Movie</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_4" title="Effect Tracks"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-EffectTracks" title="Effect Tracks"></a>Effect Tracks</h2>
<p>QuickTime video effects are implemented as <strong>components,</strong> which are the standard mechanism used to extend QuickTime. Effect components are actually a specialized type of image decompressor component.</p>
<p>To use an effect component in a QuickTime movie, you add an <strong>effect</strong> <strong>track</strong> to the movie. The size and duration of the track determines the area of the movie that is affected and how long the effect runs.</p>
<p>The effect track has two important attributes: the effect description and the input map. The <strong>effect</strong> <strong>description</strong> is a sample, added to the media of the effects track, that selects which effect to use and contains the parameters for that effect. The <strong>input</strong> <strong>map</strong> describes the <em>sources</em> that the effect works on. Effect components use whole tracks as sources. A track reference redirects the output of the source track to the effect track. You may need to make new tracks, referencing parts of existing video tracks, to act as sources for your effects.</p>
<p>Once you have arranged your source tracks and added the effects track to your movie, QuickTime automatically executes the effect when the movie plays. QuickTime generates as many frames per second as possible for the effect, so the effect will run as smoothly as the CPU and display hardware of the target machine permit.</p>
<p>You can also use the QuickTime video effects outside the context of a QuickTime movie. You still supply an effect description, but instead of creating an effect track, you write code that executes the individual steps of the effect. For details, see the section <span class="content_text"><a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-UsingVideoEffectsOutsideaQuickTimeMovie">Using Video Effects Outside a QuickTime Movie</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_5" title="Adding Video Effects to a QuickTime Movie"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-AddingVideoEffectstoaQuickTimeMovie" title="Adding Video Effects to a QuickTime Movie"></a>Adding Video Effects to a QuickTime Movie</h2>
<p>This section explains the steps you need to take in order to add video effects to a QuickTime movie. In brief, you proceed as follows:</p>
<ol class="ol">
<li class="li"><p>You create and arrange any <strong>source</strong> <strong>tracks</strong> that will be used by the effect.</p></li>
<li class="li"><p>You add a new <strong>effect</strong> <strong>track</strong> to your movie: the offset and duration of the track determine when the effect takes place.</p></li>
<li class="li"><p>You create an <strong>effect</strong> <strong>description</strong> that selects the particular effect you want and supplies values for any parameters the effect has.</p></li>
<li class="li"><p>You create an <strong>input</strong> <strong>map</strong> that defines which tracks in the movie serve as sources for the effect.</p></li>
<li class="li"><p>Finally, you add the effect description as a new sample to the media of the effect track. As part of this process, you create a <strong>sample</strong> <strong>description,</strong> which describes the sample being added.</p></li>
</ol>
<p>There are high-level routines that can be used to greatly simplify this process. For example, <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCreateStandardParameterDialog" target="_top">QTCreateStandardParameterDialog</a></code> can automatically obtain a list of available effects, allow the user to choose an effect and set its parameters, and return an effect description for the chosen effect.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_6" title="Preparing an Effect for Direct Execution"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-PreparinganEffectforDirectExecution" title="Preparing an Effect for Direct Execution"></a>Preparing an Effect for Direct Execution</h3>
<p>The code that prepares the data structures required to directly execute an effect is broadly similar to the code to set up effects within a QuickTime movie.</p>
<p>You first provide an effect description and sample description for the effect component you are going to use. Then you prepare a decompression sequence that will actually playback the effect.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_7" title="Executing the Decompression Sequence"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-ExecutingtheDecompressionSequence" title="Executing the Decompression Sequence"></a>Executing the Decompression Sequence</h3>
<p>With the effect and sample descriptions built and the decompression sequence prepared, you can now execute the effect. The function shown in Listing 1-1 executes a single frame of a decompression sequence.</p>
<p>The parameter <code>theTime</code> contains the number of the frame to be executed. The parameter <code>theNumberOfSteps</code> contains the total number of frames that will be used to run the effect.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_132" title="Listing 1-1Defining the RunEffect function, which executes one frame of an effect"></a>
<p class="codesample"><strong>Listing 1-1&nbsp;&nbsp;</strong>Defining the RunEffect function, which executes one frame of an effect</p>
<div class="codesample"><table><tr><td scope="row"><pre>// Decompress a single step of the effect sequence at time.<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr RunEffect(TimeValue theTime, int theNumberOfSteps)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                   err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICMFrameTimeRecord      frameTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the timebase time to the step of the sequence to be rendered<span></span></pre></td></tr><tr><td scope="row"><pre>    SetTimeBaseValue(gTimeBase, theTime, theNumberOfSteps);<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.value.lo      = theTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.value.hi      = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.scale         = theNumberOfSteps;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.base          = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.duration      = theNumberOfSteps;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.rate          = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.recordSize    = sizeof(frameTime);<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.frameNumber   = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.flags         = icmFrameTimeHasVirtualStartTimeAndDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.virtualStartTime.lo   = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.virtualStartTime.hi   = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    frameTime.virtualDuration     = theNumberOfSteps;<span></span></pre></td></tr><tr><td scope="row"><pre>    HLock(myEffectDesc);<span></span></pre></td></tr><tr><td scope="row"><pre>    DecompressSequenceFrameWhen(gEffectSequenceID,<span></span></pre></td></tr><tr><td scope="row"><pre>                            StripAddress(*myEffectDesc),<span></span></pre></td></tr><tr><td scope="row"><pre>                            GetHandleSize(myEffectDesc),<span></span></pre></td></tr><tr><td scope="row"><pre>                            0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;frameTime);<span></span></pre></td></tr><tr><td scope="row"><pre>    HUnlock(myEffectDesc);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The code in Listing 1-2 executes this effect in 30 steps.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_133" title="Listing 1-2Executing an effect directly by calling the RunEffect function"></a>
<p class="codesample"><strong>Listing 1-2&nbsp;&nbsp;</strong>Executing an effect directly by calling the RunEffect function</p>
<div class="codesample"><table><tr><td scope="row"><pre>for (currentTime = 0; currentTime &lt; 30; currentTime++)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = RunEffect(currentTime, 30);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_8" title="Creating an Effects Track"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-CreatinganEffectsTrack" title="Creating an Effects Track"></a>Creating an Effects Track</h2>
<p>The first step in adding effects to a QuickTime movie is to create an effects track. This is accomplished by using the standard QuickTime API for track creation, for example:</p>

<div class="codesample"><table><tr><td scope="row"><pre>theEffectsTrack = NewMovieTrack(theMovie, kTrackWidth, kTrackHeight, 0);<span></span></pre></td></tr></table></div>

<p>You then call the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewTrackMedia" target="_top">NewTrackMedia</a></code> function to add a media to the track. The type of the media for an effects track should always be <code>VideoMediaType</code>, and the media should have whatever duration you want the effect to have. Here is a sample call to <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewTrackMedia" target="_top">NewTrackMedia</a></code> :</p>

<div class="codesample"><table><tr><td scope="row"><pre>theEffectsMedia = NewTrackMedia(theEffectsTrack, VideoMediaType, 600, nil, 0);<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_9" title="Creating an Effect Description"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-CreatinganEffectDescription" title="Creating an Effect Description"></a>Creating an Effect Description</h2>
<p>An effect description tells QuickTime which effect to execute and contains the parameters that control how the effect behaves at runtime. You create an effect description by creating an atom container, inserting a QT atom that specifies the effect, and inserting a set of QT atoms that set its parameters.</p>
<p>There are support functions you can call to assist you in this process. <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCreateStandardParameterDialog" target="_top">QTCreateStandardParameterDialog</a></code> returns a complete effect description that you can use, including user-selected settings; you only need to add <code>kEffectSourceName</code> atoms to the description for effects that require sources. At a lower level, <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTGetEffectsList" target="_top">QTGetEffectsList</a></code> returns a list of the available effects and <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code> will return a description of the parameters for an effect, including the default value for each parameter in the form of a QT atom that can be inserted directly into an effect description.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_10" title="Structure of an Effect Description"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-StructureofanEffectDescription" title="Structure of an Effect Description"></a>Structure of an Effect Description</h3>
<p>An effect description is the sole media sample for an effect track. An effect description is implemented as a <code>QTAtomContainer</code> structure, the general QuickTime structure for holding a set of QuickTime atoms. All effect descriptions must contain the set of <strong>required</strong> <strong>atoms,</strong> which specify attributes such as which effect component to use. In addition, effect descriptions can contain a variable number of <strong>parameter</strong> <strong>atoms,</strong> which hold the values of the parameters for the effect.</p>
<p>Each atom contains either data or a set of child atoms. If a parameter atom contains data, the data is the value of the parameter, and this value remains constant while the effect executes. If a parameter atom contains a set of child atoms, they typically contain a <strong>tween</strong> <strong>entry</strong> so the value of the parameter will be interpolated for the duration of the effect.</p>
<p>You assemble an effect description by adding the appropriate set of atoms to a <code>QTAtomContainer</code> structure.</p>
<p>You can find out what the appropriate atoms are by making an <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code> call to the effect component. This fills an atom container with a set of <strong>parameter</strong> <strong>description</strong> <strong>atoms.</strong> These atoms contain descriptions of the effect parameters, such as each parameter’s atom type, data range, default value, and so on. The default value in each description atom is itself a QuickTime atom that can be inserted directly into your effect description.</p>
<p>You can modify the data in the parameter atoms directly, or let the user set them by calling <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCreateStandardParameterDialog" target="_top">QTCreateStandardParameterDialog</a></code>, which returns a complete effect description (you need to add <code>kEffectSourceName</code> atoms for effects that require sources).</p>
<p>You then add the effect description to the media of the effect track, as described in the section  <span class="content_text"><a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-AddingtheSampletotheMedia">Adding the Sample to the Media</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_11" title="Adding the Sample to the Media"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-AddingtheSampletotheMedia" title="Adding the Sample to the Media"></a>Adding the Sample to the Media</h3>
<p>Once you have the sample description prepared, you can call <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/AddMediaSample" target="_top">AddMediaSample</a></code> to add the effect description to the media. Listing 1-3 shows a sample call.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_134" title="Listing 1-3Calling AddMediaSample to add an effect description"></a>
<p class="codesample"><strong>Listing 1-3&nbsp;&nbsp;</strong>Calling AddMediaSample to add an effect description</p>
<div class="codesample"><table><tr><td scope="row"><pre>// Always call BeginMediaEdits before adding sample to a media<span></span></pre></td></tr><tr><td scope="row"><pre>BeginMediaEdits(theEffectsMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>// Add the sample to the media<span></span></pre></td></tr><tr><td scope="row"><pre>AddMediaSample(theEffectsMedia,<span></span></pre></td></tr><tr><td scope="row"><pre>                (Handle) theEffectDescription,<span></span></pre></td></tr><tr><td scope="row"><pre>                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                GetHandleSize((Handle) theEffectDescription),<span></span></pre></td></tr><tr><td scope="row"><pre>                600,<span></span></pre></td></tr><tr><td scope="row"><pre>                (SampleDescriptionHandle) sampleDescription,<span></span></pre></td></tr><tr><td scope="row"><pre>                1,<span></span></pre></td></tr><tr><td scope="row"><pre>                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;sampleTime);<span></span></pre></td></tr><tr><td scope="row"><pre>// End the media editing session<span></span></pre></td></tr><tr><td scope="row"><pre>EndMediaEdits(theEffectsMedia);<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_12" title="Required Atoms of an Effects Description"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-RequiredAtomsofanEffectsDescription" title="Required Atoms of an Effects Description"></a>Required Atoms of an Effects Description</h3>
<p>There are several required atoms that an effect description must contain. The first is the <code>kParameterWhatName</code> atom, which contains the name of the effect. This specifies which of the available effects to use.</p>
<p>The code snippet shown in Listing 1-4 adds a <code>kParameterWhatName</code> atom to the atom container <code>effectDesc</code>. The constant <code>kCrossFadeTransitionType</code> contains the name of the cross-fade effect. The cross-fade effect is described in detail in <span class="content_text"><a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-ExampleCrossFade">Example: Cross Fade</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_135" title="Listing 1-4Adding a kParameterWhatName atom with the value kCrossFadeTransitionType to the QTAtomContainer effectDesc"></a>
<p class="codesample"><strong>Listing 1-4&nbsp;&nbsp;</strong>Adding a kParameterWhatName atom with the value kCrossFadeTransitionType to the QTAtomContainer effectDesc</p>
<div class="codesample"><table><tr><td scope="row"><pre>effectCode = kCrossFadeTransitionType;<span></span></pre></td></tr><tr><td scope="row"><pre>QTInsertChild(effectDescription,<span></span></pre></td></tr><tr><td scope="row"><pre>                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                kParameterWhatName,<span></span></pre></td></tr><tr><td scope="row"><pre>                kParameterWhatID,<span></span></pre></td></tr><tr><td scope="row"><pre>                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                sizeof(effectCode),<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;effectCode,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil);<span></span></pre></td></tr></table></div>

<p>In addition to the <code>kParameterWhatName</code> atom, the effect description for an effect that uses sources must contain one or more <code>kEffectSourceName</code> atoms. Each of these atoms contains the name of one of the effect’s sources. An <strong>input</strong> <strong>map</strong> is used to map these names to the actual tracks of the movie that are the sources. <span class="content_text"><a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-CreatinganInputMap">Creating an Input Map</a></span> describes how to create the input map.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_13" title="Example: Cross Fade"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-ExampleCrossFade" title="Example: Cross Fade"></a>Example: Cross Fade</h3>
<p><code>kCrossFadeTransitionType</code> <code>('dslv')</code></p>
<p>A “cross fade” or “dissolve” provides a smooth alpha blending between two video sources, changing over time to give a smooth fade out from the first source into the second.</p>
<p>This effect takes a maximum of two sources and has a single parameter.</p>
<p>Use the description below to help you understand what the parameter does. To learn how to use parameter atoms, see <span class="content_text"><a href="2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-AddingVideoEffectstoaQuickTimeMovie">Adding Video Effects to a QuickTime Movie</a></span>.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Name</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Code</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>QTAtom Type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>Percentage</p></td>
<td ><p><code>'pcnt'</code></p></td>
<td ><p><code>kParameterTypeDataFixed</code>; Always a tween</p></td>
<td ><p>This parameter contains a tween. As the effect progresses, QuickTime renders the frame of the effect indicated by the tween's current value as a percentage of the whole effect. For example, if the tween goes from 0 to 100, the effect renders completely; if the tween goes from 25 to 75, rendering begins 25% into the effect and terminates 75% through the effect.</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_14" title="Creating an Input Map"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-CreatinganInputMap" title="Creating an Input Map"></a>Creating an Input Map</h3>
<p>The input map is another <code>QTAtomContainer</code> structure that you attach to the effects track. It describes the sources used in the effect and gives a name to each source. This name is used to refer to the source in the effect description.</p>
<p>An input map works in concert with track reference atoms in the source tracks. A track reference atom of type <code>kTrackModifierReference</code> is added to each source track, which causes that source track’s output to be redirected to the effects track. An input map is added to the effects track to identify the source tracks and give a name to each source, such as <code>'srcA'</code> and <code>'srcB'</code>. The effect can then refer to the sources by name, specifying that <code>'srcB'</code> should slide in over <code>'srcA'</code>, for example.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_15" title="Parameter Atoms of an Effects Description"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-ParameterAtomsofanEffectsDescription" title="Parameter Atoms of an Effects Description"></a>Parameter Atoms of an Effects Description</h3>
<p>In addition to the required atoms, the effects description contains a variable number of parameter atoms. The number and types of parameter atoms vary from effect to effect. For example, the cross fade effect has only one parameter, while the general convolution filter effect has nine. Some effects have no parameters at all, and do not require any parameter atoms. The chapter <span class="content_text"><a href="../D-Chapter/4Built-inQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-BuiltinQuickTimeVideoEffects-SW1">Built-in QuickTime Video Effects</a></span> describes the parameters expected by the built-in effects.</p>
<p>You can obtain the list of parameter atoms for a given effect by calling the effect component using the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code> function. The parameter description atoms it returns include default settings for each parameter in the form of parameter atoms that you can insert into your effect description.</p>
<p>The <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTInsertChild" target="_top">QTInsertChild</a></code> function is used to add these parameters to the effect description, as seen in the code example in Listing 1-4 above.</p>
<p>Consider, for instance, the push effect. It’s effect description contains a <code>kParameterWhatName</code> atom, two <code>kEffectSourceName</code> atoms, and two parameter atoms, one of which is a tween.</p>
<p>The <code>kParameterWhatName</code> atom specifies that this is a <code>'push'</code> effect.</p>
<p>The two <code>kEffectSourceName</code> atoms specify the two sources that this effect will use, in this case <code>'srcA'</code> and <code>'srcB'</code>. The names correspond to entries in the effect track’s input map.</p>
<p>The <code>'pcnt'</code> parameter atom defines which frames of the effect are shown. This parameter contains a tween entry, so that the value of this parameter is interpolated as the effect runs. The interpolation of the <code>'pcnt'</code> parameter causes consecutive frames of the effect to be rendered, creating the push effect.</p>
<p>The <code>'from'</code> parameter determines the direction of the push. This parameter is set from an enumeration list, with 2 being defined as the bottom of the screen.</p>
<p>In this example, the source <code>'srcB'</code> will push in from the bottom, covering the source <code>'srcA'</code>.</p>
<p>The <code>'pcnt'</code> parameter is normally tweened from 0 to 100, so that the effect renders completely, from 0 to 100 percent. In this example, the <code>'pcnt'</code> parameter is tweened from 25 to 75, so the effect will start 25% of the way through (with <code>'srcB'</code> already partly on screen) and finish 75% of the way through (with part of <code>'srcA'</code> still visible).</p>
<p>Figure 1-1 shows the set of atoms that must be added to the entry description.</p>
<br/><div><img src = "../Art/push_effect.jpg" alt = "An example effect description for the Push effect" ></div><br/>
<p>An important property of effect parameters is that most can be tweened (and some must be tweened). Tweening is QuickTime’s general purpose interpolation mechanism. For many parameters, it is desirable to allow the value of the parameter to change as the effect executes.</p>


<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_16" title="Working with Source Tracks"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-WorkingwithSourceTracks" title="Working with Source Tracks"></a>Working with Source Tracks</h2>
<p>You will probably need to do some track-level editing on the tracks your effect will use as sources, depending mainly on the type of effect you choose. There are different considerations for an effect that requires no sources, such as the cloud effect, an effect that requires one source, such as the blur filter, or an effect that requires two or more sources, such as a wipe effect.</p>
<p>An effect component can use any track with video output as a source. Effects are normally applied to video tracks, but a sprite track or a text track can also be a source for an effect. It is even possible to “stack” effects, simply by making one effect track a source for another. Stacking effects this way will make serious real-time demands on the target system’s processor, however, and the end result may not be satisfactory on all machines.</p>
<p>Generally speaking, an effect uses an entire video track as a source. A track reference atom of type <code>kTrackModifierReference</code> is added to the source track, causing the output of the source track to be redirected through the effect.</p>
<p>To make a video track into a source track, for example, you call the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/AddTrackReference" target="_top">AddTrackReference</a></code> function, as shown below.</p>

<div class="codesample"><table><tr><td scope="row"><pre>long addedIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>AddTrackReference(theEffectTrack, theSourceTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>kTrackModifierReference, &amp;addedIndex);<span></span></pre></td></tr></table></div>

<p>The <code>kTrackModifierReference</code> track reference sends all of the source track’s output to an effect track, even if the effect track has a smaller duration than the source. If you want to apply an effect to just part of a track, you need to create a new track that references the portions of source media that you want the effect to use. This is explained in more detail in the examples below.</p>
<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_17" title="Zero-Source Effects"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-ZeroSourceEffects" title="Zero-Source Effects"></a>Zero-Source Effects</h3>
<p>Effects that don’t require a source, such as the fire or cloud effect, are free-standing special effects that can be added anywhere in a movie. Just set the offset and duration of the effects track to the part of the movie where you want the effect to appear. If there is already an active video track at that point in the movie, you control the interaction between the video track and the effects track in the usual ways: putting one track in front of the other, using an alpha channel to allow one track to be partly visible through the other, and so on.</p>
<br/><div><img src = "../Art/effect_track_overlay.jpg" alt = "An effect track overlaying a video track" ></div><br/>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_18" title="One-Source Effects (Filters)"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-OneSourceEffectsFilters" title="One-Source Effects (Filters)"></a>One-Source Effects (Filters)</h3>
<p>Effects that require a source, such as a blur filter, steal the output of a video track by using an input map. The video track’s output is sent to the effects track, and the effect component acts as a special kind of codec to convert the video into the desired effect.</p>
<p>If you want to apply a filter effect to a whole video track, create an effects track with the same offset and duration as the source track. The input map does the rest.</p>
<p>If you want to apply a filter effect to part of a video track, make a new track that references the desired part of the video, then create an effects track with the same offset and duration as this new track. The new track is the source for the effect. You normally want to put the effects track in front of the original track.</p>
<br/><div><img src = "../Art/single_source_effect.jpg" alt = "A single-source effect overlaying part of a video track" ></div><br/>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_19" title="Two-Source Effects (Transitions)"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-TwoSourceEffectsTransitions" title="Two-Source Effects (Transitions)"></a>Two-Source Effects (Transitions)</h3>
<p>An effect that requires two sources, such as a wipe transition, requires some forethought when setting up the source tracks. If you want to create a transition effect between two video clips, you normally make each clip a separate video track, setting the offset of the second track so that it overlaps the end of the first track by the duration of the transition (see the illustration below). You then make two new tracks that reference the end of the first clip and the beginning of the second clip. These new tracks will act as sources for the effect. The effects track and both source tracks should share the same offset and duration, which correspond to the overlap between the two original tracks, as shown in Figure 1-4.</p>
<br/><div><img src = "../Art/two_source_effect.jpg" alt = "Inserting a two-source effect" ></div><br/>
<p>If you want to insert an effect between a sequence of images that now follow each other directly, you face some choices. One choice is to create an effect that overlaps the end of the first sequence with the beginning of the second sequence, making the movie shorter by the length of the effect. This is the usual approach to take, and is illustrated in Figure 1-5.</p>
<br/><div><img src = "../Art/transition_effect.jpg" alt = "A transition effect can shorten a movie" ></div><br/>
<p>Alternately, you can create an effect that transitions between the last image of the first sequence and the first image of the following sequence, freezing both sequences during the transition, and making the movie longer by the duration of the effect, as shown in Figure 1-6. You would normally use this approach to create a transition between two still images, and you could then restore the movie length by shortening the duration of one or both images.</p>
<br/><div><img src = "../Art/freeze_frame_trans_effect.jpg" alt = "Adding a freeze-frame transition effect" ></div><br/>
<p>Either shortening or lengthening a movie can cause problems, particularly if there is a single continuous sound track. To add a transition between two elements that are now sequential, without changing the length of the movie or removing part of the original tracks, you create one frozen source track and one moving source track. In traditional movie editing, this type of transition freezes the first clip, while the second clip is active during the transition, but you can reverse this for a more unusual effect. This technique is illustrated in Figure 1-7.</p>
<br/><div><img src = "../Art/effect_preserve_length.jpg" alt = "Adding a transition effect that preserves the movie length" ></div><br/>


<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_20" title="Sources Other Than Video Tracks"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-SourcesOtherThanVideoTracks" title="Sources Other Than Video Tracks"></a>Sources Other Than Video Tracks</h2>
<p>Any track that produces video output, such as a sprite track, a text track, or another effect track, can be used as the source for an effect. Generally speaking, you use these track types as sources in the same way you use a video track, but some special considerations apply.</p>
<p>If you use sprite tracks as sources, and the sprites can move as a result of user interaction, it may be difficult to accurately predict what a transition effect will look like when it executes at run time.</p>
<p>If you “stack” effects, by using an effects track as a source, the target system must have enough speed to render the source frames for the original effect, then render the effect that is acting as a source, then render the stacked effect, while maintaining a reasonable frame rate. For example, the target system might need to decode a pair of Sorenson frames from two video source tracks, apply a cross-fade transition effect between them, and then apply a ripple effect to the final output. This will only give good results on a fast system.</p>
<p>Similarly, you can use an effect as the source for a sprite track, making the cloud effect a sprite, for example. Build the effect description and sample description as described later in this section, then add the effect description to the sprite track as a media sample, just as you would add an ordinary video sample.</p>

<a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-DontLinkElementID_21" title="Using Video Effects Outside a QuickTime Movie"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-UsingVideoEffectsOutsideaQuickTimeMovie" title="Using Video Effects Outside a QuickTime Movie"></a>Using Video Effects Outside a QuickTime Movie</h2>
<p>Adding video effects to a QuickTime movie, as discussed in this chapter, is straightforward enough. You can also use QuickTime video effects to transition between two graphics worlds. Your application does not have to generate a QuickTime movie to use the video effects. This section deals with the task of running an effect that transitions between two graphics worlds. The general principles also apply to filtering a single image held in a graphics world.</p>
<p>Preparing to execute an effect outside the context of a QuickTime movie is similar to preparing to add a video effect to a movie: you provide an effect description and a sample description. The main difference is that instead of building an input map to describe the sources used by the effect, you use the function <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceNewDataSource" target="_top">CDSequenceNewDataSource</a></code> to use a graphics world as the source for the effect.</p>
<p>As well as setting up the effect, you must provide code to run it, since QuickTime cannot directly control the playback of the effect. Because effects are just a type of image decompressor, the code to execute an effect is the same code you would use to decompress and display an image sequence.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../A-Intro/1Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../C-Chapter/3ConstructingaVideoE.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/B-Chapter/2HowToAddQuickTimeVi.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/B-Chapter/2HowToAddQuickTimeVi.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/B-Chapter/2HowToAddQuickTimeVi.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>