<HTML>		<HEAD>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="Copyright" content="Copyright 2001 Apple Computer, Inc. All Rights Reserved.">        <title>Request Processing</title>		</HEAD>	<BODY bgcolor="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><a href="Managing_User_Input.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="User_Interface.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "BBCJACGH"></a><h2><font face="Lucida Grande,Helvetica,Arial">Request Processing</font></h2><!-- apple_doc: pageHeadingEnd --><p>Each action taken by a user is communicated to your applicationvia the Web server and the WebObjects adaptor. All the pertinentdetails of the user's action&#151;the contents of text fields, thestate of radio buttons and checkboxes, and the selections in pop-upmenus&#151;as well as information about the session and button or linkactivated is encoded in the HTTP (Hypertext Transfer Protocol) request.</p><p>The request is decoded by the action of the WebObjects adaptorand default behaviors in the application. This decoding process,which culminates in the generation of a response page to be returnedto the Web browser, is called the request-response loop. See  <a href="#TPXREF107">Figure 5-1</a>.</p><br><a name = "TPXREF107"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure5-1 The request-response loop</font></b></p> <img src = "../Art/requestresponseloop.gif" alt = "[image: ../Art/requestresponseloop.gif]"><p>WebObjects has two request processing models: component actionsand direct actions.</p><ul><li><b>Componentactions</b> This model enables you to maintain state inyour applications; therefore, it requires and uses sessions. Bydefault, WebObjects applications use this model and it's the oneexplained in this chapter.</font></li><li><b>Direct actions</b> This model is used byapplications that don't require state management (such as searchengines, product catalogs, document libraries, and dynamic publishing).Applications that use this model don't have sessions by default.</font></li></ul><p>As  <a href="#BAJIAFAD">Figure 5-2</a> shows, a component action request URL contains allthe information necessary for WebObjects to reconstruct the statethe session and components were in when a page was last generatedfor a given user.  <a href="#BAJGDDCB">Listing 5-1</a> shows an example of a component action URL.</p><br><a name = "BAJIAFAD"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure5-2 Structure of a component action URL</font></b></p> <img src = "../Art/incomingurl.gif" alt = "[image: ../Art/incomingurl.gif]"><a name = "BAJGDDCB"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing5-1 Example of a component action URL</font></b></p><pre>http://foo.com:49663/cgi-bin/WebObjects/DateDisplay.woa/wo/NDdW3uF2xRVjvbXUgRCVM/ 0.5</pre><p> <a href="#BAJEHHGC">Table 5-1</a> shows a summary explanation of the phases of therequest-response process.  <a href="#BAJDJJCI">Table 5-2</a> shows the order in which the methods involved areinvoked. The process is explained in detail in  <a href="#TPXREF108">"Processing the Request"</a> and  <a href="#BAJDCGEG">"Generating the Response"</a>.</p><br><table border = "1"><a name = "BAJEHHGC"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Table5-1 Request-response processing phases</font></b></p><br><b><font face="Geneva,Helvetica,Arial" size="1"><tr><td scope="row">Phase</td><td>Method</td><td>Description</td></tr></b></font><tr><td scope="row">Awake</td><td><code>public void awake()</code></td><td>The Application, Session, and Component objects are awakened.(Custom initialization logic can be added.)</td></tr><tr><td scope="row">Sync</td><td><code>public void takeValuesFromRequest (WORequest,WOContext)</code></td><td>Form data is read into the instance variables the WebObjectselements are bound to. (Setter methods are used.)</td></tr><tr><td scope="row">Action</td><td><code>public WOActionResults invokeAction (WORequest,WOContext)</code></td><td>The action the user triggered (with a link or a submit button)is performed. The action could create a new page.</td></tr><tr><td scope="row">Response</td><td><code>public void appendToResponse (WOResponse,WOContext)</code></td><td>The response page is generated. The form elements'contents are set to the values stored in the instance variablesthe WebObjects elements are bound to. (Getter methods are used.)</td></tr><tr><td scope="row">Sleep</td><td><code>public void sleep()</code></td><td>The Application, Session, and Component objects are putto sleep. (Custom deactivation logic can be added.)</td></tr></table><br><br><table border = "1"><a name = "BAJDJJCI"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Table5-2 Request-response processing time line</font></b></p><br><b><font face="Geneva,Helvetica,Arial" size="1"><tr><td scope="row">Application</td><td>Session</td><td>Component</td></tr></b></font><tr><td scope="row"><code>awake</code></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td><code>awake</code></td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><code>awake</code></td></tr><tr><td scope="row"><code>takeValuesFromRequest</code></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td><code>takeValuesFromRequest</code></td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><code>takeValuesFromRequest</code></td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td>setter methods invoked</td></tr><tr><td scope="row"><code>invokeAction</code></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td><code>invokeAction</code></td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><code>invokeAction</code></td></tr><tr><td scope="row"><code>appendToResponse</code></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td><code>appendToResponse</code></td><td>&nbsp;</td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><code>appendToResponse</code></td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><p>getter methods invoked</p><p>response pagegenerated</p></td></tr><tr><td scope="row">&nbsp;</td><td>&nbsp;</td><td><code>sleep</code></td></tr><tr><td scope="row">&nbsp;</td><td><code>sleep</code></td><td>&nbsp;</td></tr><tr><td scope="row"><code>sleep</code></td><td>&nbsp;</td><td>&nbsp;</td></tr></table><br><br><a name = "TPXREF108"></a><h3><font face="Lucida Grande,Helvetica,Arial">Processing the Request</font></h3><p>Request processing takes place in three stages: awakening,state synchronization, and action invocation.</p><ul><li><b>Awake</b> Thisstage is carried out when WebObjects invokes the <code>awake</code> method.<p>Ina multi-user system, limited resources need to be used as efficientlyas possible. To this end, applications are only <em>active</em> whilethey are performing a task. A single server can be running severaldifferent applications or many instances of the same application.WebObjects keeps applications asleep while they are not participatingin the request-response loop. See  <a href="#BAJDCGEG">"Generating the Response"</a> formore information.</p><p>The application object's <code>awake</code> methodis invoked first, then the session's, and finally the component's.You can customize this method in each of the classes involved toprovide logic you need to perform before processing the request.Although the default implementations of those methods do nothing,you should call the superclass's method before executing customlogic, as  <a href="#BAJEGEDG">Listing 5-2</a> shows.</p><a name = "BAJEGEDG"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing 5-2 Overridingthe awake method</font></b></p><pre>public void awake() {    super.awake();    /* custom logic goes here */}</pre></font></li><li><b>Sync</b> During this stage, the <code>takeValuesFromRequest</code> methodis invoked, which causes the values entered in form elements bythe user to be copied into the corresponding instance variables.If the component contains no form elements or if the values of the formelements were not changed, this stage is not performed.<p>WebObjectsinvokes the application's <code>takeValuesFromRequest</code> method.The application then invokes the session's method, which in turninvokes the component's method. The component invokes each dynamicelement's <code>takeValuesFromRequest</code> method,which causes form elements to copy the values from the request intothe appropriate component bindings. WebObjects uses the NSKeyValueCodinginterface to determine how to set the value of the binding.</p><p>Toset the value of a key named <code>key</code>,WebObjects looks for an available setter method or an instance variablein the following order:</p><ol><li><code>publicvoid setKey()</code></font></li><li><code>private _setKey()</code></font></li><li><code>_key</code></font></li><li><code>key</code></font></li></ol></font></li><li><b>Action</b> This is where the <code>invokeAction</code> methodis invoked; the action the user chose is executed.<p>Like the <code>takeValuesFromRequest</code> method,WebObjects invokes the application's <code>invokeAction</code> method.The application then invokes the session's method, which in turn invokesthe component's method. The component then invokes the methodon each of its dynamic elements.</p><p>When the <code>invokeAction</code> methodof the dynamic element that triggered the request is invoked (asubmit button, for example), it in turn invokes the method boundto its <code>action</code> attribute.</p></font></li></ul><br><a name = "BAJDCGEG"></a><h3><font face="Lucida Grande,Helvetica,Arial">Generating the Response</font></h3><p>After the form values are gathered and the action method isinvoked, the application creates a response page. This is the componentreturned by the action method. The response-generation process hastwo phases: append to response and sleep.</p><ul><li><b>Response</b> Hereis where the response page is generated. Each WebObjects element's <code>appendToResponse</code> methodis invoked, so that it can add its content to the page to be displayed.<p>WebObjectsinvokes the application's <code>appendToResponse</code> method.Then the application invokes the session's method, which in turninvokes the component's method. The component goes through itsHTML code creating the page's content. When it finds a <code>&lt;WEBOBJECT&gt;</code> tag,it invokes the corresponding element's <code>appendToResponse</code> method,so that it can get the values of its binding and add the resultingcontent to the page. The process continues recursively until theentire response page has been created.</p><p>When a variableneeds to be evaluated, WebObjects uses a system much like the oneit uses when a variable needs to be set. When the value of a keynamed <code>key</code> is requested, WebObjectsfirst looks for a getter method. If one is not found, it accessesthe instance variable itself. The order in which WebObjects triesto obtain the value for <code>key</code> isas follows:</p><ol><li><code>public [...] getKey()</code></font></li><li><code>public [...] key()</code></font></li><li><code>private [...] _getKey()</code></font></li><li><code>private [...] key()</code></font></li><li><code>[...] _key</code></font></li><li><code>[...] key</code></font></li></ol></font></li><li><b>Sleep</b> When the response process iscompleted, the <code>sleep</code> methods of the Component, Session,and Application objects are invoked. (The order in which the objects'sleep method is called is the opposite of the order in which the <code>awake</code> methodsare invoked in the awake phase.) When overriding the sleep method,you should follow the structure in  <a href="#BAJGCGEI">Listing 5-3</a>.<a name = "BAJGCGEI"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing 5-3 Overridingthe sleep method</font></b></p><pre>public void sleep() {    /* custom logic goes here */    super.sleep();}</pre><p>Afterall the objects involved in the request-response process are putto sleep, the new page is sent to the WebObjects adaptor.</p></font></li></ul><br><a name = "TPXREF109"></a><h3><font face="Lucida Grande,Helvetica,Arial">Backtracking Cache</font></h3><p>WebObjects supports the use of a Web browser's Back button(backtracking) by keeping a cache of recently viewed pages on theserver. The cache is configured to hold 30 pages per session, butyou can customize it to meet your needs. To change the default sizeof the cache, add code to the Application class's constructor.For example, to change the page cache size to 45 pages, you addthis code:</p><pre>setPageCacheSize(45);</pre><p>When a response page is generated, it and its state informationare added to the cache. That way, when the user clicks her browser'sBack button, WebObjects can retrieve the correct component and itsstate.</p><p>For backtracking to work properly with dynamic data, a Webbrowser's own cache should be disabled, so that all page requestsgo to the Web server and, therefore, your application. You can accomplishthis by adding this code to the Application class's constructor:</p><pre>setPageRefreshOnBacktrackEnabled(true);</pre><p>When the cache becomes full, the oldest page in it is discardedto make room to store a new page. When the user backtracks pastthe oldest page in the cache, WebObjects informs her of the situationwith a special page.</p><br>    <br><a href="Managing_User_Input.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="User_Interface.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<hr alt=""><p><font face="Palatino" size="1">&#169; 2001 Apple Computer, Inc.</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></html>