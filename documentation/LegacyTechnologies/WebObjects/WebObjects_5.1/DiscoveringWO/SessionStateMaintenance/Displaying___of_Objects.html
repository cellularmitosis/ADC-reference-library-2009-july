<HTML>		<HEAD>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="Copyright" content="Copyright 2001 Apple Computer, Inc. All Rights Reserved.">        <title>Displaying and Editing Listsof Objects</title>		</HEAD>	<BODY bgcolor="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../index.html">Documentation</a> <b>&gt;</b> <a href="../../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><a href="The_Session.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Running_the_Application.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "TPXREF107"></a><h2><font face="Lucida Grande,Helvetica,Arial">Displaying and Editing Listsof Objects</font></h2><!-- apple_doc: pageHeadingEnd --><p>Before you begin, you should make a copy of the ComponentCommunicationproject and name it SessionState. See  <a sector="mod" href="../ComponentCommunication/iCustom_Objects.html" target="_top">"Duplicating the UserEntry Project"</a>.</p><p>You'll now edit the Main component to show a list of usersinstead of just one. For that, you'll need to use the NSArrayand NSMutableArray classes.</p><br><a name = "TPXREF108"></a><h3><font face="Lucida Grande,Helvetica,Arial">The NSArray and NSMutableArrayClasses</font></h3><p>The NSArray represents an ordered collection of objects, muchlike a Java array (java.lang.Array). NSArrayobjects are not changeable after being instantiated. (The array itselfis not changeable, but the items it contains can be changed if theirtypes are mutable.) The NSMutableArray class (a subclass of NSArray)is intended for arrays that need to grow and shrink dynamically.</p><p>The following sections list the NSArray and NSMutableArraymethods that you may find useful when manipulating arrays.</p><br><a name = "TPXREF115"></a><h4><font face="Lucida Grande,Helvetica,Arial">NSArray</font></h4><dl><dt><code>objectAtIndex(intindex)</code></dt><dd>Returns the object at the given integer index. The firstobject in an NSArray is at index zero. Objects are returned as genericJava Objects. Your Java code may need to cast objects to a specificclass to use them.</dd></dl><dl><dt><code>count</code></dt><dd>Returns an integer indicating the number of objectsin the NSArray.</dd></dl><br><a name = "TPXREF116"></a><h4><font face="Lucida Grande,Helvetica,Arial">NSMutableArray</font></h4><dl><dt><code>addObject(ObjectanObject)</code></dt><dd>Adds the given object to the end of the array, increasingits size by one.</dd></dl><dl><dt><code>removeObjectAtIndex(intindex)</code></dt><dd>Removes the indicated object from the array, causingit to shrink in size.</dd></dl><p>In addition to these methods, the NSArray and NSMutableArrayclasses have other methods you may find useful. You can examinethem using Java Browser.</p><br><a name = "BBCBCEJE"></a><h3><font face="Lucida Grande,Helvetica,Arial">Adding the NSMutableArray tothe Session</font></h3><p>You can use WebObjects Builder to add an array to the Sessionclass. </p><ol><li>Open <code>Main.wo</code> inWebObjects Builder.</font></li><li>Add the <code>userList</code> instancevariable to <code>session</code>.<ol><li>Select <code>session</code> inthe Main list.</font></li><li>Control-click in the Session list.<br> <img src = "../Art/wobsessionaddkey.gif" alt = "[image: ../Art/wobsessionaddkey.gif]"></font></li><li>Choose Add Key to Session from the pop-up menu.</font></li><li>Name the variable <code>userList</code>.</font></li><li>Select the "Mutable array of" option and then User fromthe pup-up menu.</font></li><li>Under "Generate source code for," make sure only "Aninstance variable" is selected and click Add.<br> <img src = "../Art/compcommaddarray.gif" alt = "[image: ../Art/compcommaddarray.gif]"></font></li></ol></font></li><li>Initialize the new array in <code>Session.java</code>.<p>TheNSMutableArray needs to be instantiated when the Session objectis created. It will initially be empty, but you will provide methodsto add objects to it.</p><p>Edit the constructor of the <code>Session.java</code> classand add the <code>addToUserList</code> and <code>removeFromUserList</code> methods.When you're done the file should look like  <a href="#BCIIGJHD">Listing 7-1</a>.</p><a name = "BCIIGJHD"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing7-1 Session.java</font></b></p><pre>import com.webobjects.foundation.*;import com.webobjects.appserver.*;import com.webobjects.eocontrol.*;public class Session extends WOSession {    /** @TypeInfo User */    protected NSMutableArray userList;    public Session() {        super();                /* ** Put your per-session initialization code here ** */        userList = new NSMutableArray();    }    public void addToUserList(User newUser) {        userList.addObject(newUser);    }    public void removeFromUserList(User aUser) {        userList.removeObject(aUser);    }}</pre></font></li></ol><br><a name = "TPXREF109"></a><h3><font face="Lucida Grande,Helvetica,Arial">Adding the WORepetition toMain</font></h3><p>A WORepetition element is an element designed to iterate overeach item in an NSArray, repeating a set of HTML code (possiblyincluding WebObjects elements) once for each item. </p><p>A WORepetition has bindings for a list to iterate over (the <code>list</code> attribute)and for a variable to use to hold each item temporarily as it iteratesover the list (the <code>item</code> attribute).As the contents of a WORepetition are displayed, the current itemin the list is stored in the placeholder. WebObjects elements withinthe WORepetition can refer to this placeholder variable, and thevalue of each item is substituted in turn.</p><p>You'll wrap the dynamic elements in <code>Main.wo</code> ina WORepetition. You can use the <code>user</code> instancevariable as the WORepetition's placeholder. After performing thefollowing steps, <code>Main.wo</code> shouldlook similar to  <a href="#BCIJEHCA">Figure 7-2</a>.</p><ol><li>In <code>Main.wo</code>,delete the first WOConditional element (the one that contains thetext "User information has not been entered."</font></li><li>Cut the internal contents of the remaining WOConditional.</font></li><li>Select the WOConditional and delete it.</font></li><li>Paste the content after the Edit WOHyperlink.</font></li><li>Add a <code>deleteUser</code> methodthat returns <code>null</code>.</font></li><li>Add a WOHyperlink to delete users.<ol><li>Add a WOHyperlinkelement after the second WOString.</font></li><li>Enter <code>Delete</code> asthe WOHyperlink's caption.</font></li><li>Add a carriage return after the WOHyperlink by pressing Shift-Enter.</font></li><li>Bind the WOHyperlink's <code>action</code> attributeto the <code>deleteUser</code> method.</font></li></ol></font></li><li>Wrap the dynamic elements in <code>Main.wo</code> witha WORepetition.<ol><li>Select all the elements in the page.</font></li><li>Choose WebObjects &gt; WORepetition.<p>The elements areenclosed in a WORepetition element.</p></font></li></ol></font></li><li>Bind the WORepetition's <code>list</code> attributeto <code>session.userList</code>.<p>Dragfrom <code>session.userList</code> tothe first square of the WORepetition.</p></font></li><li>Bind the WORepetition's <code>item</code> attributeto <code>user</code>.<p>Drag from <code>user</code> tothe second square of the WORepetition.</p></font></li><li>Add an <code>addUser</code> actionthat returns a UserEdit page.</font></li><li>Add a WOHyperlink to add new users.<ol><li>Add a WOHyperlinkbelow the WORepetition.</font></li><li>Enter <code>Add User</code> asthe WOHyperlink's caption.</font></li><li>Bind the WOHyperlink's <code>action</code> attributeto the <code>addUser</code> method.</font></li></ol></font></li></ol><br><a name = "BCIJEHCA"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure7-2 Main.wo with a WORepetition</font></b></p> <img src = "../Art/wobsessionmainwo.gif" alt = "[image: ../Art/wobsessionmainwo.gif]"><br><a name = "TPXREF110"></a><h3><font face="Lucida Grande,Helvetica,Arial">Editing the Users</font></h3><p>You can use the UserEdit component to edit an arbitrary user.To do so, you'll use the <code>editUser</code> methodin <code>Main.java</code>. The methodhas additional logic that is not needed in this application. Editthe <code>editUser</code> method sothat it looks like  <a href="#TPXREF113">Listing 7-2</a>.</p><a name = "TPXREF113"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing7-2 The editUser method of the Main.javaclass</font></b></p><pre>public UserEdit editUser() {    UserEdit nextPage = (UserEdit)pageWithName("UserEdit");    // Initialize your component here    nextPage.setUser(user);    return nextPage;}</pre><p>The <code>editUser</code> methodcreates an instance of UserEdit and calls its <code>setUser</code> methodwith <code>user</code> as the argument.The <code>user</code> variable containsthe appropriate object because, when the user clicks Edit, WebObjectsstores the <code>session.userList</code> itemcorresponding to the row on which the Edit link is located in the <code>user</code> instancevariable. Remember that the WORepetition's <code>item</code> attributeis bound to <code>user</code>.</p><p>The UserEdit component requires a minor change. The <code>submitChanges</code> methodin <code>UserEdit.java</code> no longerneeds to invoke the <code>setUser</code> methodof the <code>Main.java</code> class(user information is stored at the session level, which Main canaccess through the <code>session</code> object).Edit the <code>submitChanges</code> methodso that it looks like  <a href="#CJBDACGH">Listing 7-3</a>.</p><a name = "CJBDACGH"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing7-3 The submitChanges method of the UserEdit.javaclass</font></b></p><pre>public Main submitChanges() {    Main nextPage = (Main)pageWithName("Main");    // Initialize your component here    return nextPage;}</pre><br><a name = "TPXREF107"></a><h3><font face="Lucida Grande,Helvetica,Arial">Adding Users</font></h3><p>This is where it all ties together. Right now, you have ameans of editing a specific user (the UserEdit component); a listof users, which starts out empty (<code>session.userList)</code>;and a WORepetition that displays your list (in the Main component).All you need to add is a way to build the list!</p><p>You need to edit the <code>addUser</code> methodin <code>Main.java</code> so thatit creates a new User object, adds it to the session's list ofusers, and also passes it to the UserEdit page before it is sentto the Web browser to be edited. Edit <code>addUser</code> sothat it matches  <a href="#CJBJFDDI">Listing 7-4</a>. Notice in particular the code that retrieves theSession object. The <code>addToUserList</code> methodof that object is then invoked with the newly created User objectas the argument.</p><a name = "CJBJFDDI"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing7-4 The addUser method of the Main.javaclass</font></b></p><pre>public UserEdit addUser() {    UserEdit nextPage = (UserEdit)pageWithName("UserEdit");    // Initialize your component here    Session session = (Session)session();  // get session for current user    User newUser = new User();             // create a new user object    session.addToUserList(newUser);  // add new user to session's userList    nextPage.setUser(newUser);       // send the new user to UserEdit    return nextPage;}</pre><br><a name = "TPXREF111"></a><h3><font face="Lucida Grande,Helvetica,Arial">Deleting Users</font></h3><p>The last step is to edit the <code>deleteUser</code> methodin <code>Main.java</code> so thatit removes a user from the list. The method is very similar to the <code>addUser</code> methoddescribed in  <a href="#TPXREF107">"Displaying and Editing Lists of Objects"</a>. The only differenceis that, instead of creating a new user object and invoking the <code>Session.addToUserList</code> method,it only invokes the <code>Session.removeFromUserList</code> methodwith the User object in the <code>user</code> instancevariable (updated by WebObjects when the user clicks Delete).</p><p>Edit the <code>deleteUser</code> methodin <code>Main.java</code> so thatit looks like  <a href="#CJBCBAGD">Listing 7-5</a>.</p><a name = "CJBCBAGD"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing7-5 The deleteUser method of the Main.javaclass</font></b></p><pre>public WOComponent deleteUser() {    Session session = (Session)session();// get session for current user    session.removeFromUserList(user);// remove user from session's userList    return null;}</pre><br>    <br><a href="The_Session.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Running_the_Application.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<hr alt=""><p><font face="Palatino" size="1">&#169; 2001 Apple Computer, Inc.</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></html>