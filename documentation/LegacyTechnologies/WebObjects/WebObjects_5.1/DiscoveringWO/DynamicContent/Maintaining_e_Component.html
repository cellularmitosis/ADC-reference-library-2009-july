<HTML>		<HEAD>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="Copyright" content="Copyright 2001 Apple Computer, Inc. All Rights Reserved.">        <title>Maintaining State in the Component</title>		</HEAD>	<BODY bgcolor="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../index.html">Documentation</a> <b>&gt;</b> <a href="../../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><a href="Response_Generation.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Further_Exploration.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "TPXREF106"></a><h2><font face="Lucida Grande,Helvetica,Arial">Maintaining State in the Component</font></h2><!-- apple_doc: pageHeadingEnd --><p>Understanding the connection between a component and its Javaclass file is an important part of WebObjects development. Not onlydo you associate methods with the component to create dynamic contentin this fashion, but you can also use the methods provided by theWOComponent class to maintain state for a component.</p><p>When you add methods to a component in WebObjects Builder,you are actually editing the component's Java file. When you modifyhow the component looks or add display elements, you are editingHTML code. A WebObjects component is a high-level view of both theHTML code and the Java class that describe a Web page, or part ofone. After using WebObjects Builder to define the major parts ofa component, you can add details by editing the HTML code manuallyand by modifying its Java file.</p><p>When your application runs, components are instantiated asneeded. That is, each component is also an object in your application.For example, when the DateDisplay application launches, a Main objectis created. As the component's content is determined by WebObjects,methods in Main.java are used to providethe data for its dynamic elements, in this case the WOString thatdisplays the current time. When it's time for WebObjects to addthe content for the WOString, it looks up the element's <code>value</code> binding. Inthe example, <code>value</code> isbound to the <code>currentTime</code> method.WebObjects then invokes the <tt>currentTime</tt> method,which returns the current time.</p><p>An instance of a component "survives" at least for twocycles of the request-response loop: in the first cycle the pageis rendered while in the second cycle the component determines whichcomponent to display next. If the component to be displayed is differentfrom the first one, the latter is discarded while an instance ofthe new component is created. However, if the component to displayis the same one, then the instance "lives on." You can use instancevariables in your component's class to store information and keeptrack of the user's behavior as she interacts with your application.</p><p>In this case, you'll add a variable to the Main componentand add code to increment it each time the page is displayed. Youcan use this variable to show the number times the page has beenloaded by a specific user in the <b>session</b>.</p><p>To keep track of the number of times the <code>currentTime</code> methodhas been called, you need to add an integer instance variable tothe Main.java file, increment it each timethe page is loaded, and add a means of telling the page to refreshitself.</p><br><a name = "BBCIABIH"></a><h3><font face="Lucida Grande,Helvetica,Arial">Adding the Variable to CountMethod Calls</font></h3><ol><li>Open <code>Main.wo</code> inWebObjects Builder (if it's not already open) by double-clickingit in Project Builder's main window.</font></li><li>Choose Add Key from the Edit Source menu at the bottom-leftcorner of the <code>Main.wo</code> window.</font></li><li>Add a key of type <code>int</code> named <code>loadCount</code>.<br> <img src = "../Art/dynamicaddkey.gif" alt = "[image: ../Art/dynamicaddkey.gif]"></font></li><li>Examine the Java file in Project Builder to confirm that thevariable was added.<pre>public class Main extends WOComponent {    protected int loadCount;</pre></font></li></ol><br><a name = "TPXREF108"></a><h3><font face="Lucida Grande,Helvetica,Arial">Displaying the Count</font></h3><p>To display the load count on the component, you need to addanother WOString to the component.</p><ol><li>Add a labeland a WOString to the component.<ol><li>Enter "<code>Pageload count: </code>" below the line that displaysthe current time.</font></li><li>Add a WOString to the right of the label.</font></li></ol></font></li><li>Bind the <code>loadCount</code> variableto the new WOString's <code>value</code> attribute.</font></li></ol><br> <img src = "../Art/wobdatedisplaycount.gif" alt = "[image: ../Art/wobdatedisplaycount.gif]"><br><a name = "TPXREF109"></a><h3><font face="Lucida Grande,Helvetica,Arial">Increasing the Variable'sValue</font></h3><p>Modify the <code>currentTime</code> methodso it increments the <code>loadCount</code> variableeach time it is called. Since WebObjects calls the method each timethe page needs to be displayed, <code>loadCount</code> isincreased by one each time.</p><pre>public NSTimestamp currentTime() {    loadCount++;    return new NSTimestamp();}</pre><br><a name = "TPXREF110"></a><h3><font face="Lucida Grande,Helvetica,Arial">Refreshing the Page</font></h3><p>Finally, you need to add a way to reload the page. In WebObjects,regular hyperlinks (WOHyperlinks) can call Java methods on yourcomponents. Action methods are covered in greater detail in  <a sector="mod" href="../UserInput/iRequest_Processing.html" target="_top">"Request Processing"</a>.For now, you only need to add a method that simply reloads the currentpage.</p><ol><li>Add the actionmethod.<p>Open the Main component in WebObjects Builder and chooseAdd Action from the Edit Source menu.</p><ol><li>Name the action <code>refreshTime</code>.</font></li><li>Select <code>null</code> fromthe "Page returned" pop-up menu.<p>The value returned byan action method represents the next page (component) to be displayed.When you return <code>null</code>,the current page is redrawn. In a later task, you learn how to returna new component.</p></font></li><li>Click Add.</font></li></ol><br> <img src = "../Art/dynamicaddaction.gif" alt = "[image: ../Art/dynamicaddaction.gif]"></font></li><li>Add a hyperlink.<p>Position the cursor below the line wherethe load count is displayed.</p><p>Choose WebObjects &gt;WOHyperlink, or click  <img src = "../Art/wohyperlinkbtn.gif" alt = "[image: ../Art/wohyperlinkbtn.gif]">.</p><p>Bydefault, the text for a new link is "Hyperlink". You can replacethis by selecting the text and typing something more appropriateover it, such as <code>"Refresh Time"</code>.</p></font></li><li>Connect the <code>refreshTime</code> methodto the WOHyperlink.<p>Much like a WOString, a WOHyperlink hasseveral attributes. In this case, you bind the <tt>refreshTime</tt> methodto the <code>action</code> attributeof the WOHyperlink.</p><br> <img src = "../Art/dynamicbindaction.gif" alt = "[image: ../Art/dynamicbindaction.gif]"><p>Drag from the <code>refreshTime</code> methodin the Main list to the WOHyperlink. When you release the mousebutton, you will see a pop-up list of attributes. Choose the <code>action</code> attributeto indicate that you want the <code>refreshTime</code> methodcalled when the link is clicked.</p></font></li><li>Save <code>Main.wo</code>.</font></li></ol><br><a name = "TPXREF111"></a><h3><font face="Lucida Grande,Helvetica,Arial">The Counter in Action</font></h3><p>Build and run the DateDisplay application. When your browserloads the page, you'll see that the counter has been increasedto 1. If you click Refresh Page, the time and the load count areupdated.</p><br> <img src = "../Art/iedatedisplayloadcount.gif" alt = "[image: ../Art/iedatedisplayloadcount.gif]"><p>This same counter instance variable is increased by one eachtime you use the link because WebObjects created a Main object andassociated it with your browser window. Each time you interact withthe application, by clicking Refresh Page, the same object is used.If you open another browser window and connect to the applicationagain using the URL shown in Project Builder's Run pane, a separateinstance of Main is created and associated with that window. Fromthen on you can work with both windows individually. As a matterof fact, not only is a new instance of Main created, a new Sessionobject is created as well.</p><p>WebObjects determines that a new Session object needs to becreated when the incoming URL does not contain a session ID. Thefirst time you connect to the application using a URL like the onein  <a href="#BAJEHACF">Listing 4-2</a>, WebObjectscreates a Session object and assigns it a session ID and other information.That information is added to the URL returned to your browser togetherwith the Web page to be displayed (see  <a href="#BAJIEHCF">Listing 4-3</a>). When you send another requestfrom your browser (by clicking Refresh Page, for example) WebObjectsuses the session ID encoded in the URL to locate the Session objectthat is to process the request. This is the default mechanism WebObjectsuses to keep track of the state of each user. For more on statemanagement see  <a sector="mod" href="../Introduction/iWebObjects_Features.html" target="_top">"Client-Server Applications"</a>.</p><a name = "BAJEHACF"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing4-2 URL that generates a new Session object</font></b></p><pre>http://foo.com:49361/cgi-bin/WebObjects/DateDisplay</pre><a name = "BAJIEHCF"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing4-3 URL with session ID</font></b></p><pre>http://foo.com:49361/cgi-bin/WebObjects/DateDisplay.woa/wo/whcV5sauLNtG8Tfh6xCuvM/ 0.1</pre><br>    <br><a href="Response_Generation.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Further_Exploration.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<hr alt=""><p><font face="Palatino" size="1">&#169; 2001 Apple Computer, Inc.</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></html>