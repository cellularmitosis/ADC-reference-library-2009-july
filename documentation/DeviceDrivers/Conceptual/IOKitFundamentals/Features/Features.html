<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>I/O Kit Fundamentals: What Is the I/O Kit?</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="What Is the I/O Kit?"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP0000012" title="What Is the I/O Kit?"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../HardwareDrivers/index.html#//apple_ref/doc/uid/TP30000440-TP40003576" target="_top">Hardware &amp; Drivers</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP0000011-CH204-TPXREF101">I/O Kit Fundamentals</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ArchitectOverview/ArchitectOverview.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP0000012-TPXREF101" title="What Is the I/O Kit?"></a><h1>What Is the I/O Kit?</h1><p>The I/O Kit is a collection of system frameworks, libraries, tools, and other resources for creating device drivers in Mac OS X. It is based on an object-oriented programming model implemented in a restricted form of C++ that omits features unsuitable for use within a multithreaded kernel. By modeling the hardware connected to a Mac OS X system and abstracting common functionality for devices in particular categories, the I/O Kit streamlines the process of device-driver development.</p><p>This chapter talks about the inherent capabilities of the I/O Kit (and of the drivers developed with it), about the decisions informing its design, and about the I/O Kit when considered as a product. It also offers some caveats and guidelines for those considering developing kernel software such as device drivers.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-DontLinkElementID_3">Before You Begin</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-TPXREF102">I/O Kit Features</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-TPXREF103">Design Principles of the I/O Kit</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-TPXREF104">Limitations of the I/O Kit</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-TPXREF105">Language Choice</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-TPXREF106">The Parts of the I/O Kit</a>
				
			<br/>
			
        
			
			
				<a href="Features.html#//apple_ref/doc/uid/TP0000012-BBCFBAHF">Should You Program in the Kernel?</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_3" title="Before You Begin"></a><h2>Before You Begin</h2><p>You might have developed device drivers for other platforms—Mac OS 9, perhaps, or BSD or another flavor of UNIX. One thing you’ll discover reading this document is how different the approach is with the I/O Kit. Although writing drivers for Mac OS X requires new ways of thinking and different ways of programming, you are amply rewarded for shifting to this new approach. The I/O Kit simplifies driver development and supports many categories of devices. Once you get the basics of the I/O Kit down, you’ll find it a relatively easy and efficient matter to create device drivers.</p><p>Before you attempt driver development with the I/O Kit, Apple highly recommends certain <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_602"></a>prerequisites. Because the framework uses an object-oriented programming model, which is implemented in a restricted subset of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_603"></a>C++, it helps to know C++ or object-oriented concepts in general. Also, device drivers are not the same thing as applications because, being kernel-resident, they must abide by more restrictive rules. Knowledge of kernel programming is therefore very useful.</p><p>Indeed, programming in the kernel is discouraged except when it is absolutely necessary. Many alternatives for communicating with hardware and networks exist at higher levels of the system, including the “device interface” feature of the I/O Kit described in <span class="content_text"><a href="../ArchitectOverview/ArchitectOverview.html#//apple_ref/doc/uid/TP0000013-BEHEGHEG">“Controlling Devices From Outside the Kernel”</a></span> See <span class="content_text"><a href="Features.html#//apple_ref/doc/uid/TP0000012-BBCFBAHF">“Should You Program in the Kernel? ”</a></span> for more on alternatives to kernel programming.</p><a name="//apple_ref/doc/uid/TP0000012-TPXREF102" title="I/O Kit Features"></a><h2>I/O Kit Features</h2><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_604"></a><p>From its inception, the fundamental goal for the I/O Kit has been to accommodate and augment native features and capabilities of Mac OS X, particularly those of the kernel environment. As the driver model for Mac OS X, the I/O Kit supports the following features:</p><ul class="ul"><li class="li"><p>Dynamic and automatic device configuration (<a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_605"></a>plug-and-play)</p></li><li class="li"><p>Many new types of devices, including <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_606"></a>graphics acceleration and <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_607"></a>multimedia devices</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_608"></a>Power management (for example, “sleep” mode)</p></li><li class="li"><p>The kernel’s enforcement of protected memory—separate address spaces for kernel and user programs</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_609"></a>Preemptive multitasking</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_610"></a>Symmetric multiprocessing</p></li><li class="li"><p>Common abstractions shared between types of devices</p></li><li class="li"><p>Enhanced development experience—new drivers should be easy to write</p></li></ul><p>The I/O Kit supports these kernel features with its new model for device drivers and adds some additional features: </p><ul class="ul"><li class="li"><p>An object-oriented framework implementing common behavior shared among all drivers and types (families) of drivers</p></li><li class="li"><p>Many families for developers to build upon</p></li><li class="li"><p>Threading, communication, and data-management primitives for dealing with issues related to <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_611"></a>multiprocessing, task control, and I/O-transfers</p></li><li class="li"><p>A robust, efficient match-and-load mechanism that scales well to all bus types</p></li><li class="li"><p>The I/O Registry, a database that tracks instantiated objects (such as driver instances) and provides information about them</p></li><li class="li"><p>The <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_612"></a>I/O Catalog, a database of all I/O Kit classes available on a system</p></li><li class="li"><p>A set of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_613"></a>device interfaces—plug-in mechanisms that allows applications and other software in “user space” to communicate with drivers </p></li><li class="li"><p>Excellent overall performance</p></li><li class="li"><p>Support for arbitrarily complex layering of client and provider objects</p></li></ul><p>The I/O Kit’s object-oriented programming model is implemented in a restricted subset of C++. Object-orientation just in itself is an advantage in driver development because of the code reusability it fosters. Once you are familiar with the I/O Kit, you can write device drivers much more quickly and efficiently than you can using a procedural model. In addition, code reusability decreases the memory footprint of drivers; drivers ported from Mac OS 9, for example, have been up to 75% smaller in Mac OS X.<a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_614"></a></p><a name="//apple_ref/doc/uid/TP0000012-TPXREF103" title="Design Principles of the I/O Kit"></a><h2>Design Principles of the I/O Kit</h2><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_615"></a><p>Mac OS X is largely the product of two strains of operating-system technology: <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_616"></a>Mac OS 9 (and its predecessors) and <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_617"></a>BSD. Given this pedigree, one might have expected Apple to adopt the device-driver model of Mac OS 9 or FreeBSD. Instead, Apple chose to redesign the model. Several reasons motivated this decision.</p><p>First, neither the Mac OS 9 driver model nor the FreeBSD driver model offers a set of features rich enough to meet the needs of Mac OS X. The Mac OS X kernel is significantly more advanced than its Mac OS precursors; it handles <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_618"></a>memory protection, preemptive multitasking, multiprocessing, and other features not present in previous versions of Mac OS. Although FreeBSD is capable of handling these features, the BSD model does not offer other features expected in a modern operating system, including automatic configuration, driver stacking, power management, and dynamic loading of devices. </p><p>Thus the primary motivation behind the I/O Kit was the inadequacy of the currently available driver models. The redesign of the I/O architecture had to take advantage of and support the operating-system features of Mac OS X. Toward this end, the I/O Kit’s designers settled on object-oriented programming model that abstracted the kernel capabilities and hardware of a Mac OS X system and provided a view of this abstraction to the upper layers of the operating system. The compelling part of this abstraction is the implementation of behavior common to all device drivers (or types of device drivers) in the classes of the I/O Kit. </p><p>As an example, consider <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_619"></a>virtual memory. In Mac OS 9, virtual memory is not a fundamental part of the operating system; it is an option. Because of this, a developer must always take virtual memory into account when creating a driver, and this raises certain complications. In contrast, virtual memory is an inherent capability of Mac OS X and cannot be turned off. Because virtual memory is a fundamental and assumed capability, knowledge of it is incorporated into system software and driver writers do not have to take it into account. </p><p>The I/O Kit functions as a kind of foundation and coordinator for device drivers. This is a departure from previous driver models. In Mac OS 9, all software development kits (SDKs) are independent of each other and duplicate common functionality. Mac OS X delivers the I/O Kit as part of a single <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_620"></a>kernel development kit (KDK); all portions of the KDK rest on common underpinnings. Mac OS X helps developers take advantage of hardware complexity without requiring them to encode software complexity into each new device driver. In most cases, they need only add the specific code that makes their drivers different.</p><p>Another part of the design philosophy of the I/O Kit is to make the design completely open. Rather than hiding APIs in an attempt to protect developers from themselves, all I/O Kit source code is available as part of Darwin. Developers can use the source code as an aid to designing (and debugging) new drivers.<a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_621"></a></p><a name="//apple_ref/doc/uid/TP0000012-TPXREF104" title="Limitations of the I/O Kit"></a><h2>Limitations of the I/O Kit</h2><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_622"></a><p>Although the I/O Kit supports most types of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_623"></a>hardware on a Mac OS X system, it does not fully support all hardware. One category of such devices are those used for <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_624"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_625"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_626"></a>imaging, among them <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_627"></a>printers, <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_628"></a>scanners, and <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_629"></a>digital cameras. The I/O Kit provides only limited support for these devices, handling communication with these devices through the FireWire and USB families. <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_630"></a>Applications or other programs in user space are responsible for controlling the particular characteristics of these devices (see <span class="content_text"><a href="../ArchitectOverview/ArchitectOverview.html#//apple_ref/doc/uid/TP0000013-BEHEGHEG">“Controlling Devices From Outside the Kernel”</a></span> for details). If your application needs to drive an imaging device, you should use the appropriate imaging <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_631"></a>software development kit (SDK).</p><p>Although the I/O Kit attempts to represent the hierarchy and dynamic relationships among hardware devices and services in a Mac OS X system, some things are difficult to abstract. It is in these gray areas of abstraction, such as when layering violations occur, that driver writers are more on their own. Even when the I/O Kit representation is clean and accurate, the reusability of I/O Kit family code can be limited. All hardware can have its own quirks and a driver’s code must take these quirks into account. </p><a name="//apple_ref/doc/uid/TP0000012-TPXREF105" title="Language Choice"></a><h2>Language Choice</h2><p>Apple considered several <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_632"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_633"></a>programming languages for the I/O Kit and chose a restricted subset of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_634"></a>C++.</p><p>C++ was chosen for several reasons. The C++ compiler is mature and the language provides support for system programming. In addition, there is already a large community of Macintosh (and BSD) developers with C++ experience.</p><p>The restricted subset disallows certain features of C++, including</p><ul class="ul"><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_635"></a>Exceptions</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_636"></a>Multiple inheritance</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_637"></a>Templates</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_638"></a>Runtime type information (RTTI)—the I/O Kit uses its own implementation of a runtime typing system</p></li></ul><p>These features were dropped because they were deemed unsuitable for use within a multithreaded kernel. If you feel you need these features, you should reconsider your design. You should be able to write any driver you require using I/O Kit with these restrictions in place.</p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_4" title="Using Namespaces in an I/O Kit Driver"></a><h3>Using Namespaces in an I/O Kit Driver</h3><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_639"></a>Note that you can use namespaces in your I/O Kit driver. The use of namespaces can help you avoid name collisions and may make your code easier to read and more maintainable. Be sure to use reverse-DNS format for the namespace name (for example, <code>com.mycompany</code>) to avoid potential namespace collisions. </p><p>If you decide to use namespaces in your in-kernel I/O Kit driver, do not declare any subclass of OSObject in a namespace or your driver will not load. At present, the loader does not support OSObject-derived classes that require qualification, such as the one shown below:</p><div class="codesample"><table><tr><td scope="row"><pre>namespace com.mycompany {<span></span></pre></td></tr><tr><td scope="row"><pre>    class com.mycompany.driver.myClass : public IOService { // This is not allowed.<span></span></pre></td></tr><tr><td scope="row"><pre>        OSDeclareDefaultStructors (com.mycompany.driver.myClass);<span></span></pre></td></tr><tr><td scope="row"><pre>    };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_5" title="Using Static Constructors in an I/O Kit Driver"></a><h3>Using Static Constructors in an I/O Kit Driver</h3><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_640"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_641"></a>In Mac OS X v10.4, GCC 4.0 is the default compiler for all new projects, including I/O Kit drivers. This section describes a particular difference between GCC 3.3 and GCC 4.0 that may affect the compatibility of your in-kernel driver between Mac OS X v10.3.x and Mac OS X v10.4.x. For more information on the differences between GCC 3.3 (the default compiler in Mac OS X v10.3) and GCC 4.0, including porting guidance, see <em><a href="../../../../../releasenotes/DeveloperTools/GCC40PortingReleaseNotes/index.html#//apple_ref/doc/uid/TP40002069" target="_top">GCC Porting Guide</a></em>.</p><p>If you perform static construction within a function in a C++ I/O Kit driver (or other KEXT) compiled with GCC 3.3 or earlier, be aware that the same KEXT compiled with GCC 4.0 will no longer load successfully. This is because GCC 4.0 is more strict about taking and releasing locks in the kernel environment. If you perform in-function static construction in your I/O Kit driver compiled with GCC 4.0, you will probably see the following error when you try to load it:</p><div class="codesample"><table><tr><td scope="row"><pre>kld():Undefined symbols:<span></span></pre></td></tr><tr><td scope="row"><pre>__cxa_guard_acquire<span></span></pre></td></tr><tr><td scope="row"><pre>__cxa_guard_release<span></span></pre></td></tr></table></div><p>The solution to this problem is simple: move the static constructor to a global namespace. For example, suppose that your I/O Kit driver includes an in-function static construction, such as in the code shown below:</p><div class="codesample"><table><tr><td scope="row"><pre>class com_mycompany_driver_mystaticclass;<span></span></pre></td></tr><tr><td scope="row"><pre>void com_mycompany_driver_myclass::myfunction(void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    static com_mycompany_driver_mystaticclass staticclass;<span></span></pre></td></tr><tr><td scope="row"><pre>    staticclass.anotherfunction();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You can avoid loading errors by changing this code to avoid in-function static construction, as in the code shown below:</p><div class="codesample"><table><tr><td scope="row"><pre>class com_mycompany_driver_mystaticclass;<span></span></pre></td></tr><tr><td scope="row"><pre>static com_mycompany_driver_mystaticclasss staticclass;<span></span></pre></td></tr><tr><td scope="row"><pre>void com_mycompany_driver_myclass::myfunction(void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    staticclass.anotherfunction();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Note that you may be able to avoid the load errors associated with in-function static construction without changing your code if you compile your KEXT with GCC 4.0 using the <code>-fno-threadsafe-statics</code> compiler option, but this may lead to other problems. Specifically, unless you can guarantee thread safety in other ways, compiling your KEXT with this option may break your code.</p><a name="//apple_ref/doc/uid/TP0000012-TPXREF106" title="The Parts of the I/O Kit"></a><h2>The Parts of the I/O Kit</h2><p>Physically and electronically, the I/O Kit is composed of many parts: frameworks and libraries, development and testing tools, and informational resources such as example projects, documentation, and header files. This section catalogs these parts and indicates where they are installed and how they can be accessed.</p><a name="//apple_ref/doc/uid/TP0000012-BBCJACHC" title="Frameworks and Libraries"></a><h3>Frameworks and Libraries</h3><p>The I/O Kit is based on three C++ <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_642"></a>libraries. All of them are packaged in <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_643"></a>frameworks, but only <code>IOKit.framework</code> is a true framework. The Kernel framework exists primarily to expose kernel <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_644"></a>header files, including those of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_645"></a>libkern and IOKit. The code of these “libraries” is actually built into the kernel; however, drivers (when loaded) do link against the kernel as if it were a library. </p><a name="//apple_ref/doc/uid/TP0000012-TPXREF111" title="Table 1-1Frameworks and libraries of the I/O Kit"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-1&nbsp;&nbsp;</strong>Frameworks and libraries of the I/O Kit</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Framework or library</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description and location</p></th></tr><tr><td  scope="row"><p>Kernel/IOKit</p></td><td ><p>The library used for developing kernel-resident device drivers. Headers location: <code>Kernel.framework/Headers/IOKit</code></p></td></tr><tr><td  scope="row"><p>Kernel/libkern</p></td><td ><p>The library containing classes useful for all development of kernel software. Headers location: <code>Kernel.framework/Headers/libkern</code></p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_646"></a>IOKit</p></td><td ><p>The framework used for developing device interfaces. Location: <code>IOKit.framework</code></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP0000012-TPXREF107" title="Applications and Tools "></a><h3>Applications and Tools </h3><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_647"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_648"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_649"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_650"></a><p>You use a handful of <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_651"></a>development applications to build, manage, debug, examine, and package device drivers. <span class="content_text"><a href="Features.html#//apple_ref/doc/uid/TP0000012-BBCJCJIA">Table 1-2</a></span> lists the applications used in driver development; these applications are installed in <code>/Developer/Applications</code>.</p><a name="//apple_ref/doc/uid/TP0000012-BBCJCJIA" title="Table 1-2Applications used in driver development"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-2&nbsp;&nbsp;</strong>Applications used in driver development</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Application</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_652"></a>Xcode</p></td><td ><p>The primary development application for Mac OS X. Xcode manages projects, provides a full-featured code editor, builds projects according to arbitrarily complex rules, provides a user interface for software configuration, and acts as a front end for debugging and documentation searches.</p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_653"></a>I/O Registry Explorer</p></td><td ><p>Enables the graphical exploration of the contents and structure of the <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_654"></a>I/O Registry. </p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_655"></a>Package Maker</p></td><td ><p>Creates an installation package for the Installer application; used for deployment of kernel extensions (including device drivers).</p></td></tr></table></div><p><span class="content_text"><a href="Features.html#//apple_ref/doc/uid/TP0000012-BBCIGIID">Table 1-3</a></span> describes the <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_656"></a>command-line tools used in developing device drivers with the I/O Kit; all tools are located in <code>/usr/sbin/</code> or <code>/sbin</code>. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_19" title="Note"></a><p><strong>Note:</strong>&nbsp;You can view on-line documentation of these tools (called man pages in the UNIX world) by entering a command in the shell provided by the Terminal application. The command is <code>man</code>, and the main argument to the <code>man</code> command is the name of the tool for which you want to see documentation. For example, to see the man page for the <code>kextload</code> tool, enter the following line in Terminal:</p><code>man kextload</code></p></div><a name="//apple_ref/doc/uid/TP0000012-BBCIGIID" title="Table 1-3Command-line tools used in driver development "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-3&nbsp;&nbsp;</strong>Command-line tools used in driver development </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Tool</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description and location</p></th></tr><tr><td  scope="row"><p><code>ioreg</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_657"></a></p></td><td ><p>Prints the contents of the I/O Registry (a command-line version of the I/O Registry Explorer application).</p></td></tr><tr><td  scope="row"><p><code>kextload</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_658"></a></p></td><td ><p>Loads a kernel extension (such as device driver) or generates a statically linked symbol file for remote debugging.</p></td></tr><tr><td  scope="row"><p><code>kextunload</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_659"></a></p></td><td ><p>Unloads a kernel extension (if possible).</p></td></tr><tr><td  scope="row"><p><code>kextstat</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_660"></a></p></td><td ><p>Prints statistics about currently loaded drivers and other kernel extensions.</p></td></tr><tr><td  scope="row"><p><code>iostat</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_661"></a></p></td><td ><p>Displays kernel I/O statistics on terminal, disk, and CPU operations.</p></td></tr><tr><td  scope="row"><p><code>ioclasscount</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_662"></a></p></td><td ><p>Displays instance count of a specified class.</p></td></tr><tr><td  scope="row"><p><code>ioalloccount</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_663"></a></p></td><td ><p>Displays some accounting of memory allocated by I/O Kit objects in the kernel.</p></td></tr><tr><td  scope="row"><p><code>kextcache</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_664"></a></p></td><td ><p>Compresses and archives kernel extensions (including drivers) so they can be automatically loaded into the kernel at boot time. See <span class="content_text"><a href="../../../../Darwin/Conceptual/KEXTConcept/KEXTConceptLoading/loading_kexts.html#//apple_ref/doc/uid/20002369" target="_top">Loading Kernel Extensions at Boot Time</a></span>.</p></td></tr><tr><td  scope="row"><p><code>gcc</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_665"></a></p></td><td ><p>Apple’s version of the GNU C++ compiler; Xcode automatically invokes it with the correct set of flags for I/O Kit projects. </p></td></tr><tr><td  scope="row"><p><code>gdb</code><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_666"></a></p></td><td ><p>Apple’s version of the GNU debugger; Xcode automatically invokes it with the correct set of flags for I/O Kit projects. <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_667"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_668"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_669"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_670"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_671"></a></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP0000012-TPXREF108" title="Other I/O Kit Resources"></a><h3>Other I/O Kit Resources</h3><p>Several informational resources are included with the I/O Kit “product,” particularly documentation and header files. Some of these resources are described in the preceding chapter, <span class="content_text"><a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP0000011-CH204-TPXREF101">“Introduction to I/O Kit Fundamentals”</a></span> </p><p>The I/O Kit is part of the <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_672"></a>Darwin Open Source project. Apple maintains a website where you can find much information related to the I/O Kit and other Open Source projects managed by Apple. The following two locations are of particular interest:</p><ul class="spaceabove"><li class="li"><p>Open Source Projects—<span class="content_text"><a href="http://developer.apple.com/darwin/projects/" target="_top">http://developer.apple.com/darwin/projects/</a></span></p><p>Here you can find links to the Darwin and Darwin Streaming projects, among other projects. Also featured are links to documentation and tools.</p></li><li class="li"><p>Mailing lists—<span class="content_text"><a href="http://developer.apple.com/darwin/mail.html" target="_top">http://developer.apple.com/darwin/mail.html</a></span></p><p>This page features links that will put you on the Darwin-Development and DarwinOS-Users mailing lists, among others.</p></li></ul><a name="//apple_ref/doc/uid/TP0000012-BBCFBAHF" title="Should You Program in the Kernel? "></a><h2>Should You Program in the Kernel? </h2><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_673"></a><p>If you are thinking of writing code for the kernel environment, think carefully. Programming in the kernel can be a difficult and dangerous task. And often there is a way to accomplish what you want to do without touching the kernel.</p><p>Software that resides in the kernel tends to be expensive. Kernel code is “wired” into physical memory and thus cannot be paged out by the virtual memory system. As more code is put into the kernel, less physical memory is available to user-space processes. Consequently, <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_674"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_675"></a>paging activity will probably intensify, thereby degrading system performance. </p><p>Kernel code is also inherently destabilizing, much more so than application code. The kernel environment is a single process, and this means that there is no <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_676"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_677"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_678"></a>memory protection between your driver and anything else in the kernel. Access memory in the wrong place and the entire system can grind to a halt, a victim of a kernel panic.</p><p>Moreover, because kernel code usually provides services to numerous user-space clients, any inefficiencies in the code can be propagated to those clients, thereby affecting the system globally.</p><p>Finally, kernel software is a real pain to write. There are subtleties to grapple with that are unknown in the realm of application development. And bugs in kernel code are harder to find than in user-space software.</p><p>With all this in mind, the message is clear. It is in everyone's best interest to put as little code as possible into the kernel. And any code that ends up in the kernel should be honed and rigorously tested.</p><a name="//apple_ref/doc/uid/TP0000012-TPXREF109" title="When Code Should Reside in the Kernel"></a><h3>When Code Should Reside in the Kernel</h3><p>A handful of situations warrant loading a driver or extension into the kernel environment:</p><ul class="spaceabove"><li class="li"><p>The software is used by the kernel environment itself.</p></li><li class="li"><p>User-space programs will frequently use the software.</p></li><li class="li"><p>The software needs to respond directly to primary interrupts (those delivered by the CPU's interrupt controller).</p></li></ul><p>If the software you are writing does not match any of these criteria, it probably doesn’t belong in the kernel. If your software is a driver for a disk, a network controller, or a keyboard, it should reside in the kernel. If it is an <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_679"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_680"></a>extension to the file system, it should live in the kernel. If, on the other hand, it is used only now and then by a single user-space program, it should be loaded by the program and reside within it. Drivers for printers and scanners fall into this latter category.</p><a name="//apple_ref/doc/uid/TP0000012-TPXREF110" title="Alternatives to Kernel-Resident Code"></a><h3>Alternatives to Kernel-Resident Code</h3><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_681"></a><p>Apple provides a number of technologies that might let you accomplish what you want to do and stay out of the kernel. First are the higher-level APIs that give you some hardware-level access. For example, <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_682"></a>Open Transport is a powerful resource for many networking capabilities, and <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_683"></a>Quartz Compositor enables you to do some fairly low-level things with the graphics subsystem.</p><p>Second, and just as important, is the <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_684"></a>device-interface technology of the I/O Kit framework. Through a plug-in architecture, this technology makes it possible for your application to interact with the kernel to access hardware. In addition, you can—with a little help from the I/O Kit—use POSIX APIs to access <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_685"></a>serial, <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_686"></a>storage, or <a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_687"></a>network devices. See <span class="content_text"><a href="../ArchitectOverview/ArchitectOverview.html#//apple_ref/doc/uid/TP0000013-BEHEGHEG">“Controlling Devices From Outside the Kernel”</a></span> for a summary of device interfaces and see the document<em><a href="../../AccessingHardware/index.html#//apple_ref/doc/uid/TP30000376" target="_top"> Accessing Hardware From Applications</a></em> for a full discussion of this technology.<a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_688"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_689"></a><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_690"></a></p><div class="notebox"><a name="//apple_ref/doc/uid/TP0000012-DontLinkElementID_20" title="Note"></a><p><strong>Note:</strong>&nbsp;Objective-C does not provide device-level I/O services. However, in your Cocoa application, you can call the C APIs for device-level functionality that the I/O Kit and BSD provide. Note that you can view the man pages that document BSD and POSIX functions and tools at <span class="content_text"><a href="../../../../Darwin/Reference/ManPages/index.html#//apple_ref/doc/uid/TP40000894" target="_top">Mac OS X Man Pages</a></span>.</p></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ArchitectOverview/ArchitectOverview.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-17<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeviceDrivers/Conceptual/IOKitFundamentals/Features/Features.html%3Fid%3DTP0000011-4.8&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeviceDrivers/Conceptual/IOKitFundamentals/Features/Features.html%3Fid%3DTP0000011-4.8&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeviceDrivers/Conceptual/IOKitFundamentals/Features/Features.html%3Fid%3DTP0000011-4.8&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>