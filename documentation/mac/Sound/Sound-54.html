<!-- legacy work start -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- legacy work end -->


<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)

LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Playing Notes (IM: S)  (deprecated)</Title>

<!-- legacy work start -->
        <META NAME="Generator" CONTENT="manual">
        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">
        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">
        <META NAME="IndexTitle" CONTENT="Inside Macintosh: Sound (Not Recommended)">
        <meta name="xcode-display" content="render">

        <LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->
        <script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
<!-- legacy work end -->

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME=HEADING54></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Sound-53.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-55.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Sound-2.html"><B>Sound</B></A> / <BR><DD><A HREF="Sound-44.html"><B>Chapter 2 - Sound Manager</B></A> / <A HREF="Sound-50.html"><B>Using the Sound Manager</B></A></DL></FONT><P>
<HR>

<!-- legacy work start -->
<script type="text/javascript"> placeWatermark()</script>
<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
<i>Inside Macintosh: Sound</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="../../../referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div>
<!-- legacy work end -->


<BLOCKQUOTE>
<A NAME=HEADING54-0></A>
<H2><A NAME=MARKER-9-261></A>Playing Notes<A NAME=MARKER-2-38></A><A NAME=MARKER-2-45></A></H2>
 You can play notes one at a time by using the <CODE>SndDoCommand</CODE> or <CODE>SndDoImmediate</CODE> function to issue <CODE>freqDurationCmd</CODE> sound commands. A sound plays for a specified duration at a specified frequency. You can play sounds defined by any of the three sound data formats. If you play wave-table data or sampled-sound data, then a voice must previously have been installed in the channel. (See <A HREF=#MARKER-9-275>"Installing Voices Into Channels" on page 2-43</A> for instructions on installing wave tables and sampled sounds as voices.)<A NAME=MARKER-2-204></A><A NAME=MARKER-2-72></A><P>
 You can also play notes by issuing the <CODE>freqCmd</CODE> command, which is identical to the <CODE>freqDurationCmd</CODE> command, except that no duration is specified when you issue <CODE>freqCmd</CODE>. <A NAME=MARKER-9-33></A><A NAME=MARKER-2-6></A><A NAME=MARKER-2-68></A><P>
<DL>
<DT><B>Note</B>
<DD>A <CODE>freqDurationCmd</CODE> command might in certain cases continue playing until another command is available in the sound channel. Therefore, to play a single note for a specified duration, you should issue <CODE>freqDurationCmd</CODE> followed immediately by <CODE>quietCmd</CODE>. See <A HREF=Sound-51.html#MARKER-9-185>"Stopping Sound Channels" on page 2-28</A> for further details on <CODE>quietCmd</CODE>.<EM></EM><A NAME=MARKER-2-439></A>   <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The structure of a <CODE>freqDurationCmd</CODE> command is slightly different from that of most other sound commands. The <CODE>param1</CODE> field contains the duration of the sound, specified in half-milliseconds. A value of 2000 represents a duration of 1 second. The maximum duration is 32,767, or about 16 seconds, in Sound Manager versions 2.0 and earlier; the maximum duration in Sound Manager version 3.0 and later is 65,536, or about 32 seconds. The <CODE>param2</CODE> field specifies the frequency of the sound. The frequency is specified as a MIDI note value (that is, a value defined by the established MIDI standard). <A HREF=#MARKER-9-271>Listing 2-15</A> uses the <CODE>freqDurationCmd</CODE> command in a way that ensures the sound stops after the specified duration.<A NAME=MARKER-2-270></A><P>
<B>Listing 2-15  <A NAME=MARKER-9-271></A>Using the <CODE>freqDurationCmd</CODE> command</B><P>
<PRE>
PROCEDURE MyPlayFrequencyOnce (mySndChan: SndChannelPtr;
                                 myMIDIValue: Integer;
                                 milliseconds: Integer);
CONST
   kNoWait = TRUE;                  {add now to full queue?}
VAR
   mySndCmd:   SndCommand;          {a sound command}
   myErr:      OSErr;
BEGIN
   {Start the sound playing.}
   WITH mySndCmd DO
   BEGIN
      cmd := freqDurationCmd;       {play for period of time}
      param1 := milliseconds * 2;   {half-milliseconds}
      param2 := myMIDIValue;        {MIDI value to play}
   END;
   myErr := SndDoCommand(mySndChan, mySndCmd, NOT kNoWait);
   IF myErr &lt;&gt; noErr THEN
      DoError(myErr)
   ELSE
   BEGIN                            {ensure that sound stops}
      WITH mySndCmd DO
      BEGIN
         cmd := quietCmd;           {stop playing sound}
         param1 := 0;               {unused with quietCmd}
         param2 := 0;               {unused with quietCmd}
      END;
      myErr := SndDoCommand(mySndChan, mySndCmd, NOT kNoWait);
      IF myErr &lt;&gt; noErr THEN
         DoError(myErr);
   END;
END;
</PRE>
 <A HREF=#MARKER-9-18>Table 2-2</A> shows the decimal values that can be sent with a <CODE>freqDurationCmd</CODE> or <CODE>freqCmd</CODE> command. Middle C is represented by a value of 60 and is defined by a special Sound Manager constant.<A NAME=MARKER-2-272></A><P>
<PRE>
CONST
   kMiddleC       = 60;       {MIDI note value for middle C}
</PRE>
 Other specifiable frequencies correspond to MIDI note values.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-18></A><B>Table 2-2 Frequencies expressed as MIDI note values</B></CAPTION>
<TH>&nbsp;<TH>A<TH>A#<TH>B<TH>C<TH>C#<TH>D<TH>D#<TH>E<TH>F<TH>F#<TH>G<TH>G#<TR>
<TD>Octave 1<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TD>0<TD>1<TD>2<TD>3<TD>4<TD>5<TD>6<TD>7<TD>8<TR>
<TD>Octave 2<TD>9<TD>10<TD>11<TD>12<TD>13<TD>14<TD>15<TD>16<TD>17<TD>18<TD>19<TD>20<TR>
<TD>Octave 3<TD>21<TD>22<TD>23<TD>24<TD>25<TD>26<TD>27<TD>28<TD>29<TD>30<TD>31<TD>32<TR>
<TD>Octave 4<TD>33<TD>34<TD>35<TD>36<TD>37<TD>38<TD>39<TD>40<TD>41<TD>42<TD>43<TD>44<TR>
<TD>Octave 5<TD>45<TD>46<TD>47<TD>48<TD>49<TD>50<TD>51<TD>52<TD>53<TD>54<TD>55<TD>56<TR>
<TD>Octave 6<TD>57<TD>58<TD>59<TD>60<TD>61<TD>62<TD>63<TD>64<TD>65<TD>66<TD>67<TD>68<TR>
<TD>Octave 7<TD>69<TD>70<TD>71<TD>72<TD>73<TD>74<TD>75<TD>76<TD>77<TD>78<TD>79<TD>80<TR>
<TD>Octave 8<TD>81<TD>82<TD>83<TD>84<TD>85<TD>86<TD>87<TD>88<TD>89<TD>90<TD>91<TD>92<TR>
<TD>Octave 9<TD>93<TD>94<TD>95<TD>96<TD>97<TD>98<TD>99<TD>100<TD>101<TD>102<TD>103<TD>104<TR>
<TD>Octave 10<TD>105<TD>106<TD>107<TD>108<TD>109<TD>110<TD>111<TD>112<TD>113<TD>114<TD>115 <TD>116<TR>
<TD>Octave 11<TD>117<TD>118<TD>119<TD>120<TD>121<TD>122<TD>123<TD>124<TD>125<TD>126<TD>127<A NAME=MARKER-2-19></A><TD>&nbsp;</TABLE>
<P>
 You can play square-wave and wave-table data at these frequencies only. If you are playing a sampled sound, however, you can modify the <CODE>sampleRate</CODE> field of the sound header to play a sound at an arbitrary frequency. To do so, use the following formula:<P>
 new sample rate = (new frequency / original frequency) * original sample rate<P>
 where the new and original frequencies are measured in hertz. To convert a MIDI value to hertz for use in this formula, note that middle C is defined as 261.625 Hz and that the ratio between the frequencies of consecutive MIDI values equals the twelfth root of 2, defined by the constant <CODE>twelfthRootTwo</CODE>.<A NAME=MARKER-2-273></A><A NAME=MARKER-2-24></A><P>
<PRE>
CONST
   twelfthRootTwo          = 1.05946309434;
</PRE>
<DL>
<DT><B>IMPORTANT</B>
<DD>When calculating with numbers of type <CODE>Fixed</CODE>, pay attention to possible overflows. The maximum value of a number of type <CODE>Fixed</CODE> is 65,535.0. As a result, some sample rates and pitches cannot be specified. Sound Manager version 3.0 fixes these overflow problems.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 You can rest a channel for a specified duration by issuing a <CODE>restCmd</CODE> command. The duration, specified in half-milliseconds, is passed in the <CODE>param1</CODE> field of the sound command.<P>
<A NAME=HEADING54-16></A>
<H3><A NAME=MARKER-9-275></A>Installing Voices Into Channels <A NAME=MARKER-2-111></A> <A NAME=MARKER-2-113></A> </H3>
 You can play frequencies defined by any of the three sound data types. By playing a frequency defined by wave-table or sampled-sound data, you can achieve a different sound than by playing that same frequency using square-wave data. For example, you might wish to play the sound of a dog's barking at a variety of frequencies. To do that, however, you need to install a voice of the barking into the sound channel to which you want to send <CODE>freqCmd</CODE> or <CODE>freqDurationCmd</CODE> commands.<P>
 You can install a wave table into a channel as a voice by issuing the <CODE>waveTableCmd</CODE> command. The <CODE>param1</CODE> field of the sound command specifies the length of the wave table, and the <CODE>param2</CODE> field is a pointer to the wave-table data itself. Note that the Sound Manager resamples the wave table so that it is exactly 512 bytes long. <A NAME=MARKER-2-532></A><A NAME=MARKER-2-279></A><P>
 <A NAME=MARKER-2-183></A>You can install a sampled sound into a channel as a voice by issuing the <CODE>soundCmd</CODE> command. You can either issue this command from your application or put it into an <CODE>'snd '</CODE> resource. If your application sends this command, <CODE>param2</CODE> is a pointer to the sampled sound locked in memory. If <CODE>soundCmd</CODE> is contained within an <CODE>'snd '</CODE> resource, the high bit of the command must be set. To use a sampled-sound <CODE>'snd '</CODE> as a voice, first obtain a pointer to the sampled sound header locked in memory. Then pass this pointer in <CODE>param2</CODE> of a <CODE>soundCmd</CODE> command. After using the sound, your application is expected to unlock this resource and allow it to be purged.<A NAME=MARKER-2-23></A><P>
 <A HREF=#MARKER-9-282>Listing 2-16</A> demonstrates how you can use the <CODE>soundCmd</CODE> command to install a sampled sound in memory as a voice in a channel.<P>
<B>Listing 2-16  <A NAME=MARKER-9-282></A>Installing a sampled sound as a voice in a channel</B><P>
<PRE>
FUNCTION MyInstallSampledVoice (mySndHandle: Handle;
                                 mySndChan: SndChannelPtr): OSErr;
VAR
   mySndCmd:         SndCommand;          {a sound command}
   mySndHeader:      SoundHeaderPtr;      {sound header from resource}
BEGIN
                                          {get pointer to sound header}
   mySndHeader := MyGetSoundHeader(mySndHandle);
   WITH mySndCmd DO
   BEGIN
      cmd := soundCmd;                    {install sampled voice}
      param1 := 0;                        {ignored with soundCmd}
      param2 := LongInt(mySndHeader);     {store sound header location}
   END;
   IF mySndHeader = NIL THEN              {check for defective handle}
      MyInstallSampledVoice := badFormat
   ELSE                                   {install sound as voice}
      MyInstallSampledVoice := SndDoImmediate(mySndChan, mySndCmd);
END;
</PRE>
 <A HREF=#MARKER-9-282>Listing 2-16</A> relies on the <CODE>MyGetSoundHeader</CODE> function to obtain a pointer to the sound header within the sound handle. That function is defined in <A HREF=Sound-56.html#MARKER-9-341>"Obtaining a Pointer to a Sound Header" on page 2-57</A> and returns <CODE>NIL</CODE> if the sound handle does not include a sound header. Note that the <CODE>MyGetSoundHeader</CODE> function locks the sound handle in memory so that the pointer to the sound header remains valid. When you are done with the sound channel in which you have installed the sampled sound, you should unlock the sound handle and make it purgeable so that it does not waste memory. <A NAME=MARKER-2-427></A><A NAME=MARKER-2-433></A><P>
<A NAME=HEADING54-24></A>
<H3>Looping a Sound Indefinitely<A NAME=MARKER-2-24></A><A NAME=MARKER-2-140></A></H3>
 If you install a sampled sound as a voice in a channel and then play the sound using a <CODE>freqCmd</CODE> or <CODE>freqDurationCmd</CODE> command that lasts longer than the sound, the sound will ordinarily stop before the end of the time specified by the <CODE>freqCmd</CODE> or <CODE>freqDurationCmd</CODE> command. Sometimes, however, this might not be what you'd like to have happen. For example, you might have recorded the sound of a violin playing and then stored that sound in a resource so that you could play the sound of a violin at a number of different frequencies. Although you could record the sound so that it is long enough to continue playing through the longest <CODE>freqCmd</CODE> or <CODE>freqDurationCmd</CODE> command that your application might require, this might not be practical. Fortunately, the Sound Manager provides a mechanism that allows you to repeat sections of sampled sound after the sound has finished playing once completely.<P>
 When you use the <CODE>freqDurationCmd</CODE> command with a sampled sound as the voice, <CODE>freqDurationCmd</CODE> starts at the beginning of the sampled sound. If necessary to achieve the desired duration of sound, the command replays that part of the sound that is between the loop points specified in the sampled sound header. Note that any sound preceding or following the loop points will not be replayed. There must be an ending point for the loop specified in the header in order for <CODE>freqDurationCmd</CODE> to work properly.<P>
<B>Listing 2-17  <A NAME=MARKER-9-287></A>Looping an entire sampled sound</B><P>
<PRE>
PROCEDURE MyDoLoopEntireSound (sndHandle: Handle);
VAR
   mySndHeader:   SoundHeaderPtr;      {sound header from resource}
   myTotalBytes:  LongInt;             {bytes of data to loop}
BEGIN
   mySndHeader := MyGetSoundHeader(sndHandle);
   IF mySndHeader &lt;&gt; NIL THEN
   BEGIN                               {compute bytes of sound data}
      CASE mySndHeader^.encode OF
         stdSH:                        {standard sound header}
            WITH mySndHeader^ DO
               myTotalBytes := mySndHeader^.length;
         extSH:                        {extended sound header}
            WITH ExtSoundHeaderPtr(mySndHeader)^ DO
               myTotalBytes := numChannels * numFrames * (sampleSize DIV 8);
         cmpSH:                        {compressed sound header}
            WITH CmpSoundHeaderPtr(mySndHeader)^ DO
               myTotalBytes := numChannels * numFrames * (sampleSize DIV 8);
      END;
      WITH mySndHeader^ DO
      BEGIN                            {set loop points}
         loopStart := 0;               {start with first byte}
         loopEnd := myTotalBytes - 1;  {end with last byte}
      END;
   END;
END;
</PRE>
 <A HREF=#MARKER-9-287>Listing 2-17</A> uses the <CODE>MyGetSoundHeader</CODE> function defined in <A HREF=Sound-56.html#MARKER-9-341>"Obtaining a Pointer to a Sound Header" on page 2-57</A>. Note that the formula for computing the length of a sound depends on the type of sound header. Also, while the formula is the same for both an extended and a compressed sound header, you must write code that differentiates between the two types of sound headers because the <CODE>sampleSize</CODE> field is not stored in the same location in both sound headers.<A NAME=MARKER-2-131></A><A NAME=MARKER-2-103></A><A NAME=MARKER-2-105></A><A NAME=MARKER-2-142></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Sound-53.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-55.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Sound-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
