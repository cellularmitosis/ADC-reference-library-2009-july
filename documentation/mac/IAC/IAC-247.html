<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Writing Object Callback Functions(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING247></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-246.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-248.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-231.html"><B>Chapter 6 - Resolving and Creating Object Specifier Records</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING247-0></A>
<H1><A NAME=MARKER-9-202></A>Writing Object Callback Functions</H1>
 <A NAME=MARKER-2-203></A>If an Apple event parameter consists of an object specifier record, your handler for the Apple event typically calls <CODE>AEResolve</CODE> to begin the process of locating the requested Apple event object or objects. In turn, <CODE>AEResolve</CODE> calls object accessor functions and, if necessary, object callback functions provided by your application.<P>
 Every application that supports Apple event objects should provide object accessor functions that can locate Apple event objects belonging to any of the supported object classes. For an overview of the way <CODE>AEResolve</CODE> calls object accessor functions to locate Apple event objects described by object specifier records, see <A HREF=IAC-232.html#MARKER-9-76>"Resolving Object Specifier Records,"</A> which begins on <A HREF=IAC-232.html#MARKER-9-76>page 6-4</A>.<P>
 In addition to object accessor functions, your application can provide up to seven object callback functions:<P>
<UL>
<LI>An <I>object-counting function</I> counts the number of elements of a specified class in a specified container, so that the Apple Event Manager can determine how many elements it must examine to find the element or elements that pass a test. Your application must provide one object-counting function to handle object specifier records that specify tests. (See <A HREF=IAC-248.html#MARKER-9-208>"Writing an Object-Counting Function,"</A> which begins on <A HREF=IAC-248.html#MARKER-9-208>page 6-56</A>.)
<LI>An <I>object-comparison function</I> compares one element either to another element or to a descriptor record and returns either <CODE>TRUE</CODE> or <CODE>FALSE</CODE>. Your application must provide one object-comparison function to handle object specifier records that specify tests. (See <A HREF=IAC-249.html#MARKER-9-212>"Writing an Object-Comparison Function" on page 6-58</A>.)
<LI>A <I>token disposal function</I> disposes of a token after your application calls the <CODE>AEDisposeToken</CODE> function. If your application doesn't provide a token disposal function, the Apple Event Manager uses the <CODE>AEDisposeDesc</CODE> function instead. Your application must provide a token disposal function if it requires more than a call to <CODE>AEDisposeDesc</CODE> to dispose of one of its tokens. This is true, for example, if your application supports marking by modifying its own data structures. (See <A HREF=IAC-282.html#MARKER-9-363>page 6-111</A> for the declaration of a token disposal function.)<A NAME=MARKER-2-204></A>
<LI>An <I>error callback function</I> gives the Apple Event Manager an address to which to write the descriptor record it is currently working with if an error occurs while <CODE>AEResolve</CODE> is attempting to resolve an object specifier record. Your application is not required to provide an error callback function. (See <A HREF=IAC-283.html#MARKER-9-366>page 6-112</A> for the declaration of an error callback function.)
<LI>Three <I>marking callback functions</I> are used by the Apple Event Manager to get a mark token from your application, to mark specific Apple event objects, and to pare down a group of marked Apple event objects. Your application must provide all three marking functions if it supports marking. (See <A HREF=IAC-250.html#MARKER-9-217>"Writing Marking Callback Functions" on page 6-62</A>.)<P>
</UL>
 To make your object callback functions available to the Apple Event Manager, use the <CODE>AESetObjectCallbacks</CODE> function: <A NAME=MARKER-2-393></A><P>
<PRE>
myErr := AESetObjectCallbacks (@MyCompareObjects,
                               @MyCountObjects, @MyDisposeToken,
                               @MyGetMarkToken, @MyMark, 
                               @MyAdjustMarks, @MyGetErrDesc);
</PRE>
 Each parameter to the <CODE>AESetObjectCallbacks</CODE> function consists of either a pointer to the corresponding application-defined function or <CODE>NIL</CODE> if no function is provided. The <CODE>AESetObjectCallbacks</CODE> function sets object callback functions that are available only to your application. To set system object callback functions, which are available to all applications and processes running on the same computer, use the <CODE>AEInstallSpecialHandler</CODE> function as described on <A HREF=IAC-185.html#MARKER-9-602>page 4-96</A>.<P>
 To handle object specifier records that specify tests, your application must provide an object-counting function and an object-comparison function. The Apple Event Manager calls your application's object-counting function to determine the number of Apple event objects in a specified container that need to be tested. The Apple Event Manager calls your application's object-comparison function when it needs to compare one Apple event object to either another Apple event object or to a value in a descriptor record.<P>
 If your application does not provide a token disposal function, the Apple Event Manager uses the <CODE>AEDisposeDesc</CODE> function to dispose of tokens. This function does the job as long as disposing of tokens involves nothing more than simply disposing of a descriptor record. Otherwise, you need to provide custom token disposal function. For example, suppose the data field of a token descriptor record contains a handle to a block that in turn contains references to storage for the Apple event object referred to by the token. In this case, the application can provide a token disposal function that performs the tasks required to dispose of the token and any associated structures. <A NAME=MARKER-9-40></A> <P>
 Whenever more than one Apple event object passes a test, <CODE>AEResolve</CODE> can either return a list of tokens or make use of a target application's ability to mark its own objects. Sometimes a list of tokens can become unmanageably large. For example, if a Get Data event asks for the names and addresses of all customers with a specified zip code who have purchased a specified product, the object accessor function that locates all the customers with the specified zip code might return a list of many thousands of tokens; the elements identified by those tokens would then have to be tested for the specified product. However, if your application uses some method of marking objects, you can choose simply to mark the requested objects rather than returning a list of tokens. <A HREF=IAC-250.html#MARKER-9-218>"Writing Marking Callback Functions" on page 6-62</A> describes how to do this. If your application supports marking by modifying its own data structures, you must provide a token disposal function. <P>
 When one of your application's Apple event handlers calls the <CODE>AEResolve</CODE> function, the handler should pass a value in the <CODE>callbackFlags</CODE> parameter that specifies whether your application supports whose descriptor records or provides marking callback functions. You can add the following constants, as appropriate, to provide a value for the <CODE>callbackFlags</CODE> parameter: <P>
<PRE>
CONST kAEIDoMinimum  =  $0000; {does not handle whose tests or }
                                 { provide marking callbacks}
      kAEIDoWhose    =  $0001; {supports key form formWhose}
      kAEIDoMarking  =  $0004; {provides marking functions}
</PRE>
 For example, this code instructs the Apple Event Manager to call any marking functions previously set with the <CODE>AESetObjectCallbacks</CODE> function while resolving the object specifier record in the <CODE>objectSpecifier</CODE> parameter:<P>
<PRE>
VAR
   objectSpecifier:    AEDesc;
   resultToken:        AEDesc;
   myErr:              OSErr;

myErr := AEResolve(objectSpecifier, kAEIDoMarking, resultToken); 
</PRE>
 If any of the marking callback functions are not installed, <CODE>AEResolve</CODE> returns the error <CODE>errAEHandlerNotFound</CODE>.<P>
<DL>
<DT><B>IMPORTANT</B>
<DD><A NAME=MARKER-9-207></A>If your application doesn't specify <CODE>kAEIDoWhose</CODE>, the Apple Event Manager attempts to resolve all object specifier records of key form <CODE>formTest</CODE>. To do so, the Apple Event Manager uses your application's object-counting and object-comparison functions, and returns a token of type <CODE>typeAEList</CODE>.  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
<DD>If your application does specify <CODE>kAEIDoWhose</CODE>, the Apple Event Manager does not attempt to resolve object specifier records of any key form. In this case, the object-counting and object-comparison functions are never called; your application determines the formats and types of all tokens; and your application must interpret whose descriptor records created by the Apple Event Manager during the resolution of object specifier records. For more information, see <A HREF=IAC-246.html#MARKER-9-186>"Handling Whose Tests,"</A> which begins on <A HREF=IAC-246.html#MARKER-9-186>page 6-47</A>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DL>
<DT><A HREF="IAC-248.html#HEADING248-0">Writing an Object-Counting Function</A>
<DD>
<DT><A HREF="IAC-249.html#HEADING249-0">Writing an Object-Comparison Function</A>
<DD>
<DT><A HREF="IAC-250.html#HEADING250-0">Writing Marking Callback Functions</A>
<DD>
</DL>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-246.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-248.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
