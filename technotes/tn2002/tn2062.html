<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN""http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"> <LINKREL="Stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN2062: Guide to Creating Kiosks on Mac OS X</title><meta name="keywords" content="kiosk, Kiosk, SystemUI, UIMode, user interface mode, Force-Quit,Force Quit, Command-Tab, Key Sequence, keyboard equivalent, SystemUIMode, SetSystemUIMode,GetSystemUIMode, Dock, Suppress, Menubar, AppleMenu, Open Firmware Password,kUIModeNormal, kUIModeContentHidden, kUIModeContentSuppressed,kUIModeAllHidden, kUIOptionAutoShowMenuBar, kUIOptionDisableAppleMenu,kUIOptionDisableProcessSwitch, kUIOptionDisableForce-Quit,kUIOptionDisableSessionTerminate, SetSystemUIMode, Replace Finder, Full Screen,Lock out, Security, Secure, LSUIElement, autodiskmount, eject key"><meta name="Description" content="Technical Note TN2062: This technotediscusses techniques used in creating applications which require kiosk-likefunctionality on MacOS X.  Specifically, this is the ability to disable certainfeatures or properties of the operating system which are normally available tousers. This could include everything from suppressing the dock to preventingthe user from booting off alternate volume or startup disk.  This technotediscusses many of the commonly asked kiosk-related questions."><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR=WHITE><a name="//apple_ref/doc/uid/DTS10003090" title="Guide to Creating Kiosks on Mac OS X"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalnotes/Carbon/idxHumanInterfaceToolbox-date.html">Human Interface Toolbox</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2062</div>
<div id="pageheadsub">Guide to Creating Kiosks on Mac OS X</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --> <CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><TD><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width="300" valign="top" scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width="300"> <img src="images/tnmenutop.gif" alt="" align="bottom" width="300" height="7"></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width="300">                                         <span id="menutitle">                            CONTENTS <BR><BR></span> </td> </tr> <tr bgcolor="#e6e6e6"> <td background="images/tnmenubody.gif" width="300"> <!--begin_toc --> <p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR> <AHREF="#Section2">Features of the SystemUIMode API</A><BR><BR> <AHREF="#Section3">Replacing the Finder</A><BR><BR> <A HREF="#Section4">Enablingthe Open Firmware Password</A><BR><BR> <A HREF="#Section6">Top 20 Commonly asked KioskQuestions</A><BR><BR> <A HREF="#Summary">Summary</A><BR><BR> <AHREF="#references">References</A><BR><BR> <AHREF="#Downloads">Downloadables</A></P> <!-- end_toc --> </td> </tr> <tr> <tdwidth="300" scope="row"> <img src="images/tnmenubottom.gif" alt="" width="300"> </td> </tr></table> </td> <td width="300" valign="top"> <!-- begin_intro_text --><P id=introtext>Developers working in certain markets need to add kioskfeatures to their applications.  That is the ability to lock the user into acertain application or disable certain functionality normally available inthe operating system.</P><P id=introtext>This technote shows several techniques for building kiosks or incorporating kiosk-like behavior into an application.  This technote focuses onMac OS X 10.2 and later because that system introduced key APIs to supportkiosk development.  The text describes which system versions are required foreach technique.</P><!-- end_intro_text --> <!-- begin_date --> <h3 align=center>[Feb 24 2003]</h3><!-- end_date --> </TD>  </TR>  </table>  <!-- end_table_box --> <!-- begin_content --> <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6"><P><B>IMPORTANT:</B><BR>The techniques discussed in this technote is intended only for developers who are working with a verticalmarket which requires kiosk behavior. These techniques should not be used by developers targeting the mass market of regular Mac OS X users.</P></TD></TR></TABLE></CENTER><BR><BR><A NAME=Section1></A><h2>Introduction</H2> <P>Developers working in vertical markets (for example Education) have been creating kiosks or adding kiosk behavior to theirapplications for quite some time.  Specifically, this means the ability to lockthe user into a certain application or disable certain operating systemfunctionality normally available.  Developers requiring kiosk behavior oncomputer systems have often been forced to use "jury-rigged" solutions whichoften were quite hard to maintain in the long term.  With the advent of Mac OS X 10.2,creating kiosks and adding kiosk functionality to an existing application hasbecome much easier to implement and support.</P> <P>This technote will coverseveral techniques required by kiosk developers as well as answer commonlyasked questions by developers of kiosk solutions.</P> <BR><BR><A NAME=Section2></A><h2>Features of the SystemUIMode API</H2> <P>In Mac OS X 10.2 two importantkiosk-related APIs were added to the system <code>SetSystemUIMode</code> and<code>GetSystemUIMode</code>.  Overall the SystemUIMode API provides the followingabilities:</p> <ul><li>control Dock show/hide behavior<BR><BR></li> <li>control menu bar show/hide behavior<BR><BR></li> <li>control which Apple menu elements are active<BR><BR></li> <li>disable process switching through Command-Tab and Command-Shift-Tab keyboard equivalents<BR><BR></li> <li>disable Force Quit window availablevia Command-Option-Escape key equivalents or via the Apple menu<BR><BR></li><li>disable the PowerKey window which is displayed when the Power button ispressed<BR><BR></li></ul><P>Previous to Mac OS X 10.2 and the SystemUIMode API, getting much of thisbehavior on Mac OS X was not possible or was very difficult to accomplish.</P><P>The <code>SetSystemUIMode</code> API lets you specify the user interface mode for thecalling application as well as additional user interface mode options for particularfeatures you want to enable. The functions prototype is listed below as well as in <code>MacApplication.h</code> within the <code>HIToolbox</code> framework.</p><BR><BR><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#e6e6e6"> <pre>OSStatus SetSystemUIMode(            SystemUIMode inMode,            SystemUIOptions inOptions);</pre></td></tr></table></center><BR><BR><P>When controlling or disabling features of Mac OS X system using<code>SetSystemUIMode</code> the <b>requested behaviors are only in effectwhile the process which called </b><code>SetSystemUIMode</code><b> is frontmost</b>. That is, if another application becomes frontmost after<code>SetSystemUIMode</code> is called, the user interface mode requestedwill no longer be in effect.  Also, if the application which called<code>SetSystemUIMode</code> does at some later time become frontmost again,the user interface mode previously established will come back into effect.</P><BR><BR><h3>Available User Interface Modes</h3><P>The table below outlines the user interface modes which you would pass asthe <code>inMode</code> parameter to <code>SetSystemUIMode</code>. Each mode is given along with discussion of if its effect on the system.</p><center><table border="1" cellpadding="10" width="550"><TR> <TD valign="top"><P><b><code>SystemUIMode</code></b></p> </td> <TD valign="top"><P><b>Description</b></p> </td></tr><TR><TD valign="top"> <P><code>kUIModeNormal</code></p> </td><TD valign="top"> <P>This is the normal or default mode for all applications onMac OS X. In this mode, all standard system UI elements are enabled andvisible.</p></td></tr><TR><TD valign="top"><P><code>kUIModeContentSuppressed</code></p> </td><TD valign="top"><P>In this mode, system user interface elements which cover the contentarea of the screen (the area other than the menubar) are hidden. However,these elements may automatically show themselves in response to mouse movementsor other user activity.  An example of this is the dock will be hidden inthis mode but will automatically show itself when the mouse enters into theDock's auto-show region.</p> </td></tr><TR><TD valign="top"> <P><code>kUIModeContentHidden</code></p> </td><TD valign="top"> <P>In this mode, system user interface elements which cover the contentarea of the screen are hidden. Unlike<code>kUIModeContentSuppressed</code>, in this mode user interface elements will notautomatically show themselves.</p> </td></tr><TR><TD valign="top"> <P><code>kUIModeAllHidden</code></p> </td><TD valign="top"> <P>In this mode, all system user interface elements, including themenubar, are hidden. System user interface elements will not automatically showthemselves in this mode.</p> </td></tr></table></center><br><br><CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6"><P><B>IMPORTANT:</B><BR>As of the publishing of this technote (Mac OS X 10.2.x) the<code>kUIModeContentHidden</code> and<code>kUIModeContentSuppressed</code> modes are not recognized by the Dock.  This is due to a bug in Mac OS X (r. 2973242).  The end result is that, in modes <code>kUIModeContentHidden</code> and <code>kUIModeContentSuppressed</code>, the Dock operates the same as in the <code>kUIModeNormalMode</code>.  This problem will be fixed in a future release of Mac OS X.</P></TD></TR></TABLE></CENTER><br><br><h3>Available User Interface Options</h3><P>Along with the user interface modes listed above, you can also specify<code>SystemUIOptions</code>. <code>SystemUIOptions</code> allow enabling ordisabling of specific features while the user interface mode is in effect.  The available<code>SystemUIOptions</code> are listed in the table below.  Some<code>SystemUIOptions</code> are only valid for certain user interface modes as indicated.  The constants given in the table below are what you would pass as the <code>inOptions</code> argument to <code>SetSystemUIMode</code> API.  As mentioned earlier the<code>SystemUIMode</code> and <code>SystemUIOptions</code> specified are<b>only in effect while the process which called <code>SetSystemUIMode</code>is frontmost</b>. </p><center><table border="1" cellpadding="10" width="550"><TR><TD valign="top"> <P><b><code>SystemUIOption</code></b></p> </td><TD valign="top"> <P><b>Description</b></p> </td><TD valign="top"> <P><b>Valid <code>SystemUIModes</code></b></p> </td></tr><TR><TD valign="top"> <P><code>kUIOptionAutoShowMenuBar</code></p> </td><TD valign="top"> <P>The menubar will automatically show itself when the usermoves the mouse into the screen area that would ordinarily be occupied by themenubar.</p> </td><TD valign="top"> <P><code>kUIModeAllHidden</code>.</p> </td></tr><TR><TD valign="top"> <P><code>kUIOptionDisableAppleMenu</code></p> </td><TD valign="top"> <P>Disables all items in the Apple menu.</p> </td><TD valign="top"> <P>All user interface modes.</p> </td></tr><TR><TD valign="top"> <P><code>kUIOptionDisableProcessSwitch</code></p> </td><TD valign="top"> <P>Disables process switching using Command-Tab andCommand-Shift-Tab keyboard equivalents.  Window rotation keys selected in the keyboard preference will also be disabled.</p> </td><TD valign="top"> <P><code>kUIModeContentHidden</code>,<code>kUIModeContentSuppressed</code>, and <code>kUIModeAllHidden</code>.</p></td></tr><TR><TD valign="top"> <P><code>kUIOptionDisableForceQuit</code></p> </td><TD valign="top"> <P>Disables the Force Quit window normally available viaCommand-Option-Escape keyboard equivalent or the Force Quit menu item in the Applemenu.</p> </td><TD valign="top"> <P><code>kUIModeContentHidden</code>,<code>kUIModeContentSuppressed</code>, and <code>kUIModeAllHidden</code>.</p></td></tr><TR><TD valign="top"> <P><code>kUIOptionDisableSessionTerminate</code></p> </td><TD valign="top"> <P>Disables the Power key window that comes up when the power keyis pressed. Also disables Restart, Shut Down, and Log Out menu items in theApple menu.</p> </td><TD valign="top"> <P><code>kUIModeContentHidden</code>,<code>kUIModeContentSuppressed</code>, and <code>kUIModeAllHidden</code>.</p></td></tr></table></center><br><br><P>Note If you attempt to use a user interface option which isn't valid with a particular user interface mode then the user interface option passed will be ignored.  </P><P>In the case of where you want to use multiple <code>SystemUIOptions</code> together youcan bitwise OR the <code>SystemUIOptions</code> constants.  An example ofcalling the <code>SetSystemUIMode</code> with multiple<code>SystemUIOptions</code> is shown below.  In the example the Dock andmenu bar will be hidden.  Also, Command-Tab and Command-Shift-Tab keyboard equivalentsalong with the Force Quit window will be disabled.</p><br><br><CENTER><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"> <pre>error = SetSystemUIMode(kUIModeAllHidden,                  kUIOptionDisableAppleMenu                  | kUIOptionDisableProcessSwitch                  | kUIOptionDisableForceQuit);</pre></td></tr></table></CENTER><br><br><P>Note you can have multiple <code>SystemUIOptions</code> as shown above butyou can only have <b>one</b> <code>SystemUIMode</code> selected.</p><P>A demonstration application is available <a href ="downloads/tn2062_1.hqx">UsingSystemUIMode</a> which demonstrates the abilitiesof the <code>SetSystemUIMode</code> API.  A screen shot of the demonstrationapplication is shown below.  Select various <code>SystemUIModes</code> and<code>SystemUIOptions</code> to see how they affect your system.  Note theapplication only works in OS X 10.2 and later.</P><br><br><CENTER><table border=0 width=550> <TR> <TD> <center><img src="images/tn2062_1.jpg" alt="Screenshot of Demo Application" align=middle></center></td></tr><TR> <TD> <P><B>Figure 1</b>. Screen shot of demo application</p></td></tr></table></CENTER><br><br><P>Using the <code>SetSystemUIMode</code> call various behaviors of the system can be disabled. A kiosk developer using a combination of <code>SystemUIModes</code> and<code>SystemUIOptions</code> should be able to obtain a configuration whichsuits their needs.</P> <P><A HREF="#top">Back to top</A></P> <br><br><A NAME=Section3></A><h2>Replacing the Finder</H2> <P>Since Mac OS X 10.0.x the system has supported theability to launch programs other than Finder as the mainsystem application upon login.  This feature offers kiosk  developers theability of replacing the Finder application with another application.  Forexample, a kiosk developer could launch their kiosk  application as the mainsystem application instead of Finder at login. Any applicationlaunched as the Finder application also gets the added  benefit of beingautomatically relaunched if the application should quit unexpectedly (quit with a non-zero error code).  Thetechnique used to replace the Finder is discussed  in detail in the <a href = "http://developer.apple.com/documentation/macosx/Essentials/SystemOverview/BootingLogin/chapter_4_section_16.html">Replacing the Finder</a> section of <a href = "http://developer.apple.com/documentation/macosx/Essentials/SystemOverview/">Inside Mac OS X: System Overview</a>.</P><P>A installer can programatically replace the Finder by calling<code>system</code> and then the <code>defaults</code> command-line toolusing the techniques <a href = "http://developer.apple.com/documentation/macosx/Essentials/SystemOverview/BootingLogin/chapter_4_section_16.html"> described in System Overview</a>.More information on the <code>system</code> call can be found by typing<code>"man system"</code> into <code>Terminal</code>.  Note you only have toset the Finder setting <b>once</b> and the preferences will be retained for thesystem even after a reboot.</p><P>An installer will be replacing the individual user's Finder setting if<code>defaults</code> is called under the logged in user.  On the other hand, if<code>defaults</code> is called as root then the Finder setting for all userswill be set.  An individual user's Finder setting will override thesetting for all users if both have been set.</P> <P><A HREF="#top">Back to top</A></P> <br><br><A NAME=Section4></A><h2>Enabling Open FirmwarePassword</H2> <P>The Open Firmware password is a security feature available on modern Macintosh systems.  If you enable the Open Firmware password, the computer will execute a secure boot sequence.   Specifically, enablingthe Open Firmware password prevents users from  starting up the computer from avolume other than the chosen  as the startup disk (chosen in the Startup Diskpreference panel within  the System Preferences.) Also, enabling the OpenFirmware Password prevents users from booting into single user mode usingCommand-S key combination at boot time. </P>  <P>There is currently no publicprogrammatic solution to setting the  Open Firmware password (r. 3075615). This means this setting can not be set  by an installer.  However, anadministrator can enable the Open Firmware  password using the "Open FirmwarePassword" application located at:  <a href ="http://www.apple.com/downloads/macosx/apple/openfirmwarepassword.html">http://www.apple.com/downloads/macosx/apple/openfirmwarepassword.html</a></P>  <br><br><CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6"><P><B>IMPORTANT:</B><BR>The Open Firmware Password will be reset if a user changes theamount of the physical memory in the machine and reboots. Systems which require Open Firmware Password level security need to be protected from users gaining physical access to the internals of the computer. </P></TD></TR></TABLE></CENTER><br><br><P><A HREF="#top">Back to top</A></P> <br><br><ANAME=Section6></A><h2>Top 20 Commonly asked Kiosk questions</H2><br><br><A NAME=DisableForceQuit></a><H3>1) How do I disable Force Quit?</H3> <P>Thiscan be accomplished using the <code>SetSystemUIMode</code> call with the<code>kUIOptionDisableForceQuit SystemUIOption</code> set.   This technique isdescribed in more detail in the <a href="#Section2">SystemUIMode  section ofthis technote</a>.  A code snippet below also demonstrates the technique:  </P><br><br><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>error = SetSystemUIMode(               kUIModeContentHidden,               kUIOptionDisableForceQuit);</pre></td></tr></table></center><br><br><P>Note disabling Force Quit using <code>SetSystemUIMode</code> will onlydisable Force Quit so long as the calling application is frontmost.  There is an alternative to disabling the Force Quit completely.  An application can also avoid showing up in the Force Quit window using techniques described in <ahref="#NotShowUpInForceQuit">"How do I prevent my application from beingForce Quit?"</a></P><br><br><A NAME=DisableDock></a><H3>2) How do  I disable/suppress the Dock?</H3> <P>The dock can be disabled/suppressed using the <code>SetSystemUIMode</code> API.  Byselecting  specific user interface modes a developer can control exactly how the Dock isdisabled.  Please  consult the <a href = "#Section2">SystemUIMode section ofthis technote</a> for more details.  If a developer just wants the Dock completelysuppressed while  still showing the menubar they can use the code snippet shownbelow.</P><br><br><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>error = SetSystemUIMode(kUIModeAllHidden, NULL); ShowMenuBar();  //shows the menu bar.</pre> </td></tr></table></center><br><br><P>Note disabling the Dock using this technique will only disable the Dock longas the calling application is frontmost.</P><br><br><A NAME=DisableCommandTab></a><H3>3) How do I disable the Command-Tab orCommand-Shift-Tab process switching keyboard equivalents?</H3> <P>These keyboard equivalentscan be disabled using the <code>SetSystemUIMode</code> call  with the<code>kUIOptionDisableProcessSwitch SystemUIOption</code> set.  This technique was described in more detail in the <a href="#Section2">SystemUIMode section ofthis  technote</a>.  A code snippet below also demonstrates the technique.</P><br><br><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>error = SetSystemUIMode(               kUIModeContentHidden,               kUIOptionDisableProcessSwitch);</pre></td></tr></table></center><br><br><P>Note disabling process switching keyboard equivalents using<code>SetSystemUIMode</code> will only disable the keyboard equivalents so long asthe calling application is frontmost.</P><br><br><A NAME=DisableAppleMenu></a><H3>4) How do I disable the Apple menu (or certain portions of it)?</H3> <P>One can disable the entire Apple menu using the<code>SetSystemUIMode</code>  call with the <code>kUIOptionDisableAppleMenuSystemUIOption</code> set.   This technique was described in more detail in the<a href="#Section2">SystemUIMode section of this technote</a>.  Note disablingthe Apple menu using this  technique will only disable the Apple menu so long asthe calling application is frontmost.   A code snippet below also demonstratesthis technique.</P><br><br><center><table border=0 width = 550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>error = SetSystemUIMode(kUIModeNormal, kUIOptionDisableAppleMenu);</pre></td></tr></table></center><br><br><P>The above technique disables the entire Apple menu.  For disabling morespecific portions of the Apple menu please consult the <a href ="#Section2">SystemUIMode section of this technote.</a></P><br><br><A NAME=NotShowUpInForceQuit></a><H3>5) How do I prevent my application frombeing Force Quit?</H3> <P>One can use the technique described section  <ahref="#DisableForceQuit">"How do I disable Force Quit?"</a> to completely disableForce Quit.  This will prevent Force Quit from activating so long as thecalling application is frontmost.   There is another alternative available ifone isn't capturing  the display using the CGDisplayCapture APIs described in <ahref="../../documentation/Carbon/graphics/OpenGL/OpenGL/chap3/How_to_Crea_en_Context_.html"> How to Create a Full-Screen Context</a>. Thealternative is to not have  an application show up in the Force Quit menu atall.  Thus, when a user invokes the Force Quit menu the application will notshow up in the list.   This can be done by adding the <code>LSUIElement</code>key to the application's Info.plist.  The precise setting required to enablethis is <code>LSUIElement = 1</code>  (string) as illustrated in thePropertyListEditor screen shot below.</P><br><br><CENTER><table border=0 width=550> <TR> <TD> <center><img src="images/tn2062_2.jpg" alt="Info.plist for not showing up in ForceQuit"align=middle></center></td></tr><TR> <TD> <P><B>Figure 2</b>. <code>Info.plist</code> for an application which won't show up in the Force Quit menu.</p></td></tr></table></CENTER><br><br><CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6"><P><B>IMPORTANT:</B><BR>An application using the <code>LSUIElement</code> property in its Info.plist should <b>not</b> use the <a href="#Section2">SetSystemUIMode API</a>.  Also, setting the <code>LSUIElement</code> property prevents the application from showing up in the Dock.</P></TD></TR></TABLE></CENTER><br><br><A NAME=SingleUser></a><H3>6) How do I disable single user mode (Command-S onboot)?</H3> <P>The most effective way to disable single user mode is by enabling the Open Firmware Password of the system.  This can be done using  thetechnique described in the <a href = "#Section4">Enabling Open FirmwarePassword</a> section of this technote.</P><br><br><A NAME=EjectKey></a><H3>7) How do I disable the Eject Key?</H3> <P>There iscurrently no supported way to disable the Eject Key.  You can  however, preventany new inserted media from being mounted.   See thesection: <a href = "#DisableMountingMedia">"How do I prevent new media  (e.g.CDs, DVDs, iPods, USB/Firewire hard drives, etc.) from becoming mounted?"</a>for more details</P><br><br><A NAME=AltBoot></a><H3>8) How do I prevent users from booting off  alternativemedia (bootable CDs, external hard drives, etc.)?</H3> <P>You can preventbooting from other system disks by enabling the  Open Firmware Password of thesystem.  This can be done using  the technique described in the <a href ="#Section4">Enabling Open Firmware password</a>  section of this technote.</P><br><br><A NAME=DisableMountingMedia></a><H3>9) How do I prevent new media (CDs, DVDs,iPods, USB/Firewire hard drives, etc.)  from becoming mounted?</H3> <P>There is currently no public programmatic solution to this problem (r. 2824118).  For the present time administrators can disable new media from becoming active using the Mac Manager application located at: <a href = "http://www.info.apple.com/usen/mm/">http://www.info.apple.com/usen/mm/</a> </P><br><br><A NAME=ForceReboot></a><H3>10) How do I disable Command-Control-Power (forcereboot)?</H3> <P>There is currently no supported way to disable this keyboard equivalent.  Also, the technique of preventing normal reboot discussed in <a href = "#DisableCmdCtlEject">"How do I disable Command-Control-Eject(normal reboot)?"</a> does not work for preventing a force reboot.  Though, a developer can secure the computer during a boot process using the techniques discussed in: <a href = "#AltBoot">"How do I prevent users from booting off  alternativemedia?"</a> and <a href = "#SingleUser">"How do I disable single user mode?"</a></P><br><br><A NAME=FullScreen></a><H3>11) How do I make my application full screen so it takes over the screen?</H3> <P>A commonly used technique is to use the CGDisplay Captureroutines as described in  <a href = "http://developer.apple.com/documentation/Carbon/graphics/OpenGL/OpenGL/chap3/How_to_Crea_en_Context_.html"> How toCreate a Full-Screen Context</a> in the OpenGL documentation.  A simpler solution is to edit the main window of the kiosk application's GUI so it fills the screen. This way as long as other elements ofthe operating system have been disabled the application will remainfrontmost.  Note if you wish to have movable windows you may want to disable desktop switching using the technique described in: <a href="#QuitFinder">"How do I prevent users from clicking on the desktop to switch out of my application?"</a></P><br><br><A Name=QuitFinder></a><H3>12) How do I prevent users from clicking on the desktop to switch out of my application?</H3> <P>One technique is to not allow users access to the desktop at all.  This can be achieved by making a full screen application.  Techniques to create a full screen application are described in <a href = "#FullScreen">"How do I make my application full screen so it takes over the screen?"</a></P><P>If one needs to disable "desktop switching" this can be accomplished by disabling the Finder since the Finder provides the "desktop switching" services along with any hard drives which show up on the desktop.  One technique of disabling the Finder is to replace the Finder using the technique described in the <a href = "#Section3">"Replacing The Finder"</a> section of this technote.   Another method of disabling the Finder is to send it a <code>kAEQuitApplication</code> Apple event.  The below code demonstrates how to quit the Finder using an Apple event. </P><br><br><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><Td><P><B>Listing 2</B>.  Programmatically quitting Finder using an Apple Event.</P></TD></TR><TR><TD BGCOLOR="#E6E6E6"><PRE>OSErr QuitFinder(){    int kFinderProcessSignature = 'MACS';    OSErr            anErr = paramErr;    AppleEvent        tAppleEvent = {typeNull,nil};    AppleEvent      tReply;    AEBuildError    tAEBuildError;    anErr = AEBuildAppleEvent(                kCoreEventClass, kAEQuitApplication,                typeApplSignature, &amp;kFinderProcessSignature,                sizeof(OSType), kAutoGenerateReturnID,                kAnyTransactionID, &amp;tAppleEvent,                &amp;tAEBuildError,"");    if (noErr == anErr)    {        anErr = AESend( &amp;tAppleEvent, &amp;tReply, kAENoReply |                          kAENeverInteract, kAENormalPriority,                          kNoTimeOut, nil, nil );        (void) AEDisposeDesc(&amp;tAppleEvent);    }    return anErr;}int main(int argc, char *argv[]){    OSErr error = QuitFinder();        if (error != noErr)        {printf("Finder quit successfully!\n");}    else        {printf("Finder wouldn't quit!\n");}    return 0;}</PRE></TD></TR></TABLE></CENTER><br><br><P>The above code is also available via the downloadable <A HREF="downloads/tn2062_2.hqx">QuitFinder sample</a></P><br><br><A NAME=PowerKey></a><H3>13) How do I disable Command-H (Hide) and Command-Q (Quit)?</H3> <P>These keyboard equivalents sometimes catch kiosk developers new to Mac OS X.   The method to remove these keyboard equivalents differs based on if a developer is using Carbon or Cocoa.  Complete descriptions of how to override these keyboard equivalents are listed below.</P><P>Disabling behavior in Carbon:<BR>Within Carbon one method of disabling the keyboard equivalents is to delete the menu items providing the keyboard equivalents.   That is deleting the Quit and Hide menu items completely will disable the keyboard equivalents.  Deleting these menu items programmatically can be done by first locating the menu items using <code>GetIndMenuItemWithCommandID</code> passing  <code>kHICommandHide</code> or <code>kHICommandQuit</code> as the <code>inCommandID</code> argument.  Once located a menu item can be removed by calling <code>DeleteMenuItem</code>.  An alternative to removing the menu item completely is to simply remove the keyboard equivalent while still retaining the menu item.  This  can be accomplished by calling <code>SetItemCmd</code> passing zero for the <code>cmdChar</code> argument, once you have already located the appropriate menu item with <code>GetIndMenuItemWithCommandID</code>.  A code snippet below demonstrates both techniques.</P><br><br><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>//Completely remove the Quit menu itemerror = GetIndMenuItemWithCommandID(                   NULL, kHICommandQuit, 1,                   &amp;applicationMenu, &amp;outIndex);DeleteMenuItem(applicationMenu, outIndex);//Disable Command-H keyboard equivalent on the Hide menuerror = GetIndMenuItemWithCommandID(                   NULL, kHICommandHide, 1,                   &amp;applicationMenu, &amp;outIndex);SetItemCmd(applicationMenu, outIndex,0);</pre> </td></tr></table></center><br><br><P>Disabling behavior in Cocoa:<BR>Within Cocoa, a developer can simply edit their program's nib file to remove the Command-Q and Command-H keyboard equivalents from the Quit and Hide menu items.  Another alternative available is to simply remove the Quit and Hide menu items from the program. </P><P>Another technique available to both Carbon and Cocoa is to assign another menu item with a Command-H keyboard equivalent.  If a program has another menu item with a Command-H keyboard equivalent, then that menu item will override the default application hiding behavior of Command-H.  Note this only works for Command-H (hide) and not Command-Q (quit).</P><br><br><A NAME=PowerKey></a><H3>14) How do I disable the window that pops up when Power key or the Control-Eject keyboard equivalent is pressed?</H3> <P>This can be accomplished using the <code>SetSystemUIMode</code> call with the<code>kUIOptionDisableSessionTerminate SystemUIOption</code> set.  This technique was described in more detail in the <a href ="#Section2">SystemUIMode section of this technote</a>.  A code snippet below also demonstrates the technique: </p><br><br><center><table border=0 width=550 CELLPADDING=3> <TR> <TD bgcolor="#E6E6E6"><pre>error = SetSystemUIMode(kUIModeContentHidden,                      kUIOptionDisableSessionTerminate);</pre></td></tr></table></center><br><br><P>Note that disabling the Power key window using <code>SetSystemUIMode</code> will only disable this keyboard equivalent as long as the calling application is frontmost.</P><br><br><A NAME=Sleep></a><H3>15) How do I disable Command-Option-Eject (sleep)?</H3> <P>A kiosk developer can disable system sleep using the I/O Kit APIs.  This can be done by calling <code>IOCancelPowerChange</code> after receiving a power change notification for system sleep.  This technique is illustrated in more detail at: <a href = "http://developer.apple.com/documentation/Darwin/General/IOKitFundamentals/PowerMgmt/chapter_10_section_8.html#BAJIIDEB">Receiving Notification of Power Events</a> in the I/O Kit documentation.  Note this technique does not work in "demand power change" situations such as when the lid of a laptop computer is closed.  </P><br><br><A NAME=DisableCmdCtlOptionEject></a><H3>16) How do I disable Command-Control-Option-Eject (normal shutdown)?</H3> <P>There is currently no supported way to disable this keyboard equivalent.  However, a kiosk developer can prevent the reboot from occurring by returning <code>userCanceledErr</code> to the <code>kAEQuitApplication</code> Apple event.  This technique is discussed in <a href= "#DisableCmdCtlEject">"How do I disable Command-Control-Eject(normal reboot)?"</a></P><br><br><A NAME=DisableCmdCtlEject></a><H3>17) How do I disable Command-Control-Eject (normal reboot)?</H3> <P>There is currently no supported way to disable this keyboard equivalent.  However, a kiosk developer can prevent the reboot from occurring by registering for the <code>kAEQuitApplication</code> Apple Event and returning <code>userCanceledErr</code> to the event.  The technique is shown in the <A HREF="downloads/tn2062_3.hqx">PreventLogoutRestartShutdown</a> downloadable and in the following code snippet.</P><br><br><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><TD><P><B>Listing 3</B>.  Programmatically preventing Logout/Restart/Shutdown.</P></TD></TR><TR><Td BGCOLOR="#E6E6E6"><PRE>OSErr QuitAppleEventHandler( const AppleEvent *appleEvt,                 AppleEvent* reply, UInt32 refcon ){    //returning userCanceledErr to cancel logout    return userCanceledErr;}int main(int argc, char *argv[]){    OSErr   err;    //Installing quit event handler    err = AEInstallEventHandler( kCoreEventClass,           kAEQuitApplication,  NewAEEventHandlerUPP(          (AEEventHandlerProcPtr)QuitAppleEventHandler),            0, false );        if (err != noErr)        ExitToShell();    EventLoop();     return 0;}</PRE></TD></TR></TABLE></CENTER><br><br><P>Note when you disable logout/restart/shutdown using this technique a dialog will be presented to the user indicating your application cancelled the operation.  This technique is also described in <a href = "http://developer.apple.com/documentation/macosx/Essentials/SystemOverview/BootingLogin/chapter_4_section_10.html#BAJIBGGI">Terminating Processes</a> in System Overview.  </P><br><br><A NAME=ScreenShotKeys></a><H3>18) How do I disable the screen capture keys: Command-Shift-3 and Command-Shift-4?</H3> <P>There is currently no supported way to disable these keyboard equivalents.  (r. 3085384)</P><br><br><A NAME=VideoBright></a><H3>19) How do I disable the video brightness keys available on some keyboards?</H3> <P>There is currently no supported way to disable these keys.</P><br><br><A NAME=SoundKeys></a><H3>20) How do I disable the sound volume keys available on some keyboards?</H3><P>There is currently no supported way to disable these keys.</P><P><A HREF="#top">Back to top</A></P><br><br><A NAME=Summary></A><h2>Summary</H2><P>Creating kiosks or adding kiosk-like behavior to an application  hashistorically been very difficult.  However, with the new  features available onMac OS X this process has become much simpler.  One final note: If your kiosk <b>requires</b> behavior which is not covered in any of the above sections of this technote (or is currently listed as unsupported) let us know by sending an email to dts@apple.com.</P> <P><A HREF="#top">Back to top</A></P><br><br><A NAME=references></A><h2>References</H2><center><table border=0 width=550> <TR> <TD><P><a href="../../documentation/macosx/Essentials/SystemOverview/SystemOverview.pdf">Mac OS X System Overview</A> Contains a high level overview of Mac OS X.  Thisis a good starting point with developing for Mac OS X.</P><P><a href="../../qa/qa2001/qa1123.html">QA 1123: Getting List of All Processes onMac OS X</A> contains information on getting a "snapshot" of the BSD processlist</P><P><a href="../../technotes/tn/tn2050.html">TN 2050: Observing Process Lifetimes Without Polling</a> contains information and code on getting notifications whena process launches or terminates.</P></td></tr></table></center><br><br><P><A HREF="#top">Back to top</A></P><br><br><P><A NAME=Downloads></A></P><h2>Downloadables</H2><TABLE BORDER=0 CELLPADDING=3 WIDTH="100%"> <TR> <TD WIDTH=50> <CENTER><A HREF="pdf/tn2062.pdf"><imgsrc="images/acrobatsmall.gif" alt="Acrobat gif" width=22 align=middleheight=23></a></CENTER> </TD> <TD> <P>Acrobat version of this Note (500K)</P> </TD><TD WIDTH=60> <P><A HREF="pdf/tn2062.pdf">Download</A></P> </TD> </TR> <TR> <TDWIDTH=50> <CENTER><A HREF="downloads/tn2062_1.hqx"><imgsrc="images/bluebook.gif" alt="Folder gif" border=0 width=22 align=middleheight=23></A></CENTER> </TD> <TD> <P>Demonstration Application forSetSystemUIMode API. (56K)</P> </TD> <TD WIDTH=60> <P><AHREF="downloads/tn2062_1.hqx">Download</A></P> </TD> </TR> <TR> <TD WIDTH=50><CENTER><A HREF="downloads/tn2062_2.hqx"><img src="images/bluebook.gif"alt="Folder gif" border=0 width=22 align=middle height=23></A></CENTER> </TD><TD> <P>Sample demonstrating quitting Finder. (8K)</P> </TD> <TDWIDTH=60> <P><AHREF="downloads/tn2062_2.hqx">Download</A></P> </TD> </TR> <TR> <TD WIDTH=50><CENTER><A HREF="downloads/tn2062_3.hqx"><img src="images/bluebook.gif"alt="Folder gif" border=0 width=22 align=middle height=23></A></CENTER> </TD><TD> <P>Sample demonstrating how to programmatically prevent logout. (8K)</P> </TD> <TDWIDTH=60> <P><A HREF="downloads/tn2062_3.hqx">Download</A></P> </TD> </TR></table><BR> <BR><P><A HREF="#top">Back to top</A></P><br><br><!-- end_content --></TD> </TR> </table><BR> </CENTER> <!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2002/tn2062.html%3Fid%3DDTS10003090-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2002/tn2062.html%3Fid%3DDTS10003090-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2002/tn2062.html%3Fid%3DDTS10003090-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY> </HTML>