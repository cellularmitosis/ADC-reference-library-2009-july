<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz Composer Custom Patch Programming Guide: Writing Consumer Patches</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Writing Consumer Patches"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004787-CH5" title="Writing Consumer Patches"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004787-CH1-DontLinkElementID_14">Quartz Composer Custom Patch Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../qc_image_proc/qc_image_proc.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../glossary/glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004787-CH5-SW1" title="Writing Consumer Patches"></a><h1>Writing Consumer Patches</h1><p>A consumer patch pulls (or <em>consumes</em>) data from processor and provider patches, operates on the data, and renders the result to a destination, typically a screen but it can be another destination. This chapter discusses some best practices for using OpenGL in a Quartz Composer custom patch and then shows how to create a custom consumer patch that renders an OpenGL texture to a quad.</p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH5-DontLinkElementID_16" title="Figure 4-1Consumer patches render to a destination"></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>Consumer patches render to a destination</p><img src = "../art/consumer_patch.jpg" alt = "Consumer patches render to a destination" ></div><br/><p>You need to know OpenGL programming to understand this chapter. If you don’t know OpenGL, but want to learn, these books provide a good starting point:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="http://www.opengl.org/documentation/red_book/" target="_blank">OpenGL Programming Guide</a></span>, by the OpenGL Architecture Review Board; otherwise known as "The Redbook.”</p></li><li class="li"><p><span class="content_text"><a href="http://www.opengl.org/documentation/blue_book/" target="_blank">OpenGL Reference Manual</a></span>, by the OpenGL Architecture Review Board; otherwise known as "The Bluebook.”</p></li></ul><p>Although these books provide a solid foundation in OpenGL, you’ll also need to read <em><a href="../../OpenGL-MacProgGuide/index.html#//apple_ref/doc/uid/TP40001987" target="_top">OpenGL Programming Guide for Mac OS X</a></em> for details on how to get the best performance on the Macintosh platform using the most recent OpenGL extensions and the Mac OS X OpenGL frameworks.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="WritingConsumerPatches.html#//apple_ref/doc/uid/TP40004787-CH5-SW2">Using OpenGL in a Custom Patch</a>
				
			<br/>
			
        
			
			
				<a href="WritingConsumerPatches.html#//apple_ref/doc/uid/TP40004787-CH5-DontLinkElementID_4">Rotating Square: Rendering a Texture to a Quad</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004787-CH5-SW2" title="Using OpenGL in a Custom Patch"></a><h2>Using OpenGL in a Custom Patch</h2><p>Using OpenGL in a custom patch requires a bit more setup work than what’s needed for patches that don’t use OpenGL, but not much. You need to set the OpenGL context to the execution context of your custom patch. The setup requires two steps:</p><ol class="ol"><li class="li"><p>Include the <code>CGLMacro.h</code> file.</p></li><li class="li"><p>Set the OpenGL context to the execution context of the custom patch using this line of code:</p><div class="codesample"><table><tr><td scope="row"><pre>CGLContextObj cgl_ctx = [context CGLContextObj];<span></span></pre></td></tr></table></div></li></ol><p>The first step is done for you when you use an Xcode project template for Quartz Composer plug-ins. When you include the CGL macro header file, you can then use a local context variable to cache the current renderer. The local cache eliminates the need for OpenGL to perform a global context and renderer lookup for each command it executes, thereby reducing overhead and improving performance.</p><p>The <code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/QCPlugInContext/CGLContextObj" target="_top">CGLContextObj</a></code> method of the <code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInContext" target="_top">QCPlugInContext</a></code> protocol gets  an OpenGL context that you can draw to from within the execution method of your custom patch. (See <em><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/index.html#//apple_ref/doc/uid/TP40004798" target="_top">QCPlugInContext Protocol Reference</a></em>.) After setting the OpenGL context (<code>cgl_ctx</code>), Quartz Composer sends all OpenGL commands to the OpenGL execution context of the custom patch. </p><p>The OpenGL code in your custom patch benefits from any programming techniques that improve the performance of any OpenGL code. In other words, there are no special requirements for OpenGL code that’s part of a custom patch. However, you’ll want to save and restore all state changes except the ones that are part of <code>GL_CURRENT_BIT</code> (RGBA color, color index, normal vector, texture coordinates, and so forth). You may also want to take a look at the chapter “Improving Performance”  in <em><a href="../../OpenGL-MacProgGuide/index.html#//apple_ref/doc/uid/TP40001987" target="_top">OpenGL Programming Guide for Mac OS X</a></em>.</p><a name="//apple_ref/doc/uid/TP40004787-CH5-DontLinkElementID_4" title="Rotating Square: Rendering a Texture to a Quad"></a><h2>Rotating Square: Rendering a Texture to a Quad</h2><p>The Rotating Square custom patch renders a texture to an OpenGL quad that you can animate. It has eight input parameters:</p><ul class="ul"><li class="li"><p><code>Enable</code> is a port that Quartz Composer automatically creates  for a consumer patch.</p></li><li class="li"><p>The next three—<code>X Position</code>, <code>Y Position</code>, and <code>Z Position</code>—control the location of the center of the square.</p></li><li class="li"><p><code>Rotation Angle</code> determines the angle of rotation of the quad.</p></li><li class="li"><p><code>Color</code> is the background color for the quad. </p></li><li class="li"><p><code>Image</code> is converted to a texture and scaled to fit the quad. See <span class="content_text"><a href="../qc_image_proc/qc_image_proc.html#//apple_ref/doc/uid/TP40004787-CH7-SW3">“Getting Images From an Input Port.”</a></span></p></li></ul><p>The resulting patch is shown in <span class="content_text">Figure 4-2</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH5-SW3" title="Figure 4-2The Rotating Square custom patch"></a><p><strong>Figure 4-2&nbsp;&nbsp;</strong>The Rotating Square custom patch</p><img src = "../art/glsquare_patch.jpg" alt = "The Rotating Square custom patch" ></div><br/><p>Follow these steps to create the Rotating Square custom patch:</p><ol class="ol"><li class="li"><p>Open Xcode and choose File > New Project.</p></li><li class="li"><p>In the New Project window, choose Standard Apple Plug-ins > Quartz Composer Plug-in and click Next.</p></li><li class="li"><p>Enter <code>RotatingSquare</code> in the Project Name text field and click Next.</p></li><li class="li"><p>Open the <code>RotatingSquarePlugin.h</code> file.</p><p>Modify the interface file so that it has four dynamic Objective-C properties: x and y values, a color, and an input image. </p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Quartz/Quartz.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface RotatingSquarePlugIn : QCPlugIn<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// Declare four property input ports of type Number with the<span></span></pre></td></tr><tr><td scope="row"><pre>// keys inputX, inputY, inputZ, and inputAngle<span></span></pre></td></tr><tr><td scope="row"><pre>@property double inputX;<span></span></pre></td></tr><tr><td scope="row"><pre>@property double inputY;<span></span></pre></td></tr><tr><td scope="row"><pre>@property double inputZ;<span></span></pre></td></tr><tr><td scope="row"><pre>@property double inputAngle;<span></span></pre></td></tr><tr><td scope="row"><pre>// Declare a property input port of type Color with the key inputColor<span></span></pre></td></tr><tr><td scope="row"><pre>@property(assign) CGColorRef inputColor;<span></span></pre></td></tr><tr><td scope="row"><pre>// Declare a property input port of type Image with the key inputImage<span></span></pre></td></tr><tr><td scope="row"><pre>@property(assign) id&lt;QCPlugInInputImageSource> inputImage;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Save and close the <code>RotatingSquarePlugIn.h</code> file.</p></li><li class="li"><p>Open the <code>RotatingPlugin.m</code> file. To ensure the best performance with OpenGL, make sure the file contains the following statement:</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;OpenGL/CGLMacro.h><span></span></pre></td></tr></table></div><p>You’ll set up the OpenGL context later, in the execute method.</p></li><li class="li"><p>Immediately after the implementation statement, add this directive so that Quartz Composer handles the implementation of the properties:</p><div class="codesample"><table><tr><td scope="row"><pre>@dynamic inputX, inputY, inputZ, inputAngle, inputColor, inputImage;<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a space to separate the words in the name. Then modify the description for the custom patch. </p><p>When you are done, the two <code>#define</code> statements to look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>#define    kQCPlugIn_Name @"Rotating Square"<span></span></pre></td></tr><tr><td scope="row"><pre>#define    kQCPlugIn_Description  @"Renders a colored square that you can animate."<span></span></pre></td></tr></table></div></li><li class="li"><p>Next you’ll write the methods needed to implement the <code>RotatingSquarePlugIn</code> subclass. The <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributes" target="_top">attributes</a></code>  method provided in the template should already look like this:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSDictionary*) attributes<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                kQCPlugIn_Name,QCPlugInAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                kQCPlugIn_Description,QCPlugInAttributeDescriptionKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Modify the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributesForPropertyPortWithKey:" target="_top">attributesForPropertyPortWithKey:</a></code> method so that it returns a dictionary for each input parameter. The port attribute key name is what appears in Quartz Composer as a label for the custom patch port.</p><p>The method should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSDictionary*) attributesForPropertyPortWithKey:(NSString*)key<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputX"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"X Position", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputY"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Y Position", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputZ"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Z Position", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputAngle"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Rotation Angle", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputColor"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Color", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputImage"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>            @"Image", QCPortAttributeNameKey, nil];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return nil;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Make sure the <code>executionMode</code> method returns <code>kQCPlugInExecutionModeConsumer</code> to indicate that the custom patch is a consumer. Among other things, this causes Quartz Composer to add an Enable input port to the resulting patch.</p><div class="codesample"><table><tr><td scope="row"><pre>+ (QCPlugInExecutionMode) executionMode<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return kQCPlugInExecutionModeConsumer;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Make sure that the <code>timeMode</code> returns <code>kQCPlugInTimeModeNone</code>. </p><p>This is the default, so you should not need to make any changes to the provided code.</p><p>This custom patch executes only when the input values change.</p><div class="codesample"><table><tr><td scope="row"><pre>+ (QCPlugInTimeMode) timeMode<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return kQCPlugInTimeModeNone;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the execution method for the execution context. This is where the OpenGL command stream is defined. You need to define the CGL context  here.</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) execute:(id&lt;QCPlugInContext>)context<span></span></pre></td></tr><tr><td scope="row"><pre>            atTime:(NSTimeInterval)time<span></span></pre></td></tr><tr><td scope="row"><pre>            withArguments:(NSDictionary*)arguments<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Define a context and set it. This line causes OpenGL to use macros.<span></span></pre></td></tr><tr><td scope="row"><pre>    CGLContextObj     cgl_ctx = [context CGLContextObj];<span></span></pre></td></tr><tr><td scope="row"><pre>    id&lt;QCPlugInInputImageSource>    image;<span></span></pre></td></tr><tr><td scope="row"><pre>    GLuint            textureName;<span></span></pre></td></tr><tr><td scope="row"><pre>    GLint             saveMode;<span></span></pre></td></tr><tr><td scope="row"><pre>    const CGFloat*    colorComponents;<span></span></pre></td></tr><tr><td scope="row"><pre>    GLenum      error;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if(cgl_ctx == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        return NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Copy the image on the input port to a local variable.<span></span></pre></td></tr><tr><td scope="row"><pre>    image = self.inputImage;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get a texture from the image in the context color space<span></span></pre></td></tr><tr><td scope="row"><pre>    if(image &amp;&amp; [image lockTextureRepresentationWithColorSpace:([image shouldColorMatch] ? [context colorSpace] :<span></span></pre></td></tr><tr><td scope="row"><pre>                        [image imageColorSpace])<span></span></pre></td></tr><tr><td scope="row"><pre>               forBounds:[image imageBounds]])<span></span></pre></td></tr><tr><td scope="row"><pre>        textureName = [image textureName];<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        textureName = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Save and set the modelview matrix.<span></span></pre></td></tr><tr><td scope="row"><pre>    glGetIntegerv(GL_MATRIX_MODE, &amp;saveMode);<span></span></pre></td></tr><tr><td scope="row"><pre>    glMatrixMode(GL_MODELVIEW);<span></span></pre></td></tr><tr><td scope="row"><pre>    glPushMatrix();<span></span></pre></td></tr><tr><td scope="row"><pre>    // Translate the matrix<span></span></pre></td></tr><tr><td scope="row"><pre>    glTranslatef(self.inputX, self.inputY, self.inputZ);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Rotate the matrix<span></span></pre></td></tr><tr><td scope="row"><pre>    glRotatef(self.inputAngle, 0.0, 1.0, 0.0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Bind the texture to a texture unit<span></span></pre></td></tr><tr><td scope="row"><pre>    if(textureName) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [image bindTextureRepresentationToCGLContext:cgl_ctx<span></span></pre></td></tr><tr><td scope="row"><pre>                                         textureUnit:GL_TEXTURE0<span></span></pre></td></tr><tr><td scope="row"><pre>                                normalizeCoordinates:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the color components (RGBA) from the input color port.<span></span></pre></td></tr><tr><td scope="row"><pre>    colorComponents = CGColorGetComponents(self.inputColor);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the color.<span></span></pre></td></tr><tr><td scope="row"><pre>    glColor4f(colorComponents[0], colorComponents[1], colorComponents[2], colorComponents[3]);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Render the textured quad by mapping the texture coordinates to the vertices<span></span></pre></td></tr><tr><td scope="row"><pre>    glBegin(GL_QUADS);<span></span></pre></td></tr><tr><td scope="row"><pre>        glTexCoord2f(1.0, 1.0);<span></span></pre></td></tr><tr><td scope="row"><pre>        glVertex3f(0.5, 0.5, 0); // upper right<span></span></pre></td></tr><tr><td scope="row"><pre>        glTexCoord2f(0.0, 1.0);<span></span></pre></td></tr><tr><td scope="row"><pre>        glVertex3f(-0.5, 0.5, 0); // upper left<span></span></pre></td></tr><tr><td scope="row"><pre>        glTexCoord2f(0.0, 0.0);<span></span></pre></td></tr><tr><td scope="row"><pre>        glVertex3f(-0.5, -0.5, 0); // lower left<span></span></pre></td></tr><tr><td scope="row"><pre>        glTexCoord2f(1.0, 0.0);<span></span></pre></td></tr><tr><td scope="row"><pre>        glVertex3f(0.5, -0.5, 0); // lower right<span></span></pre></td></tr><tr><td scope="row"><pre>    glEnd();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Unbind the texture from the texture unit.<span></span></pre></td></tr><tr><td scope="row"><pre>    if(textureName)<span></span></pre></td></tr><tr><td scope="row"><pre>        [image unbindTextureRepresentationFromCGLContext:cgl_ctx<span></span></pre></td></tr><tr><td scope="row"><pre>                                             textureUnit: GL_TEXTURE0];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Restore the modelview matrix.<span></span></pre></td></tr><tr><td scope="row"><pre>    glMatrixMode(GL_MODELVIEW);<span></span></pre></td></tr><tr><td scope="row"><pre>    glPopMatrix();<span></span></pre></td></tr><tr><td scope="row"><pre>    glMatrixMode(saveMode);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Check for OpenGL errors and log them if there are errors.<span></span></pre></td></tr><tr><td scope="row"><pre>    if(error = glGetError())<span></span></pre></td></tr><tr><td scope="row"><pre>        [context logMessage:@"OpenGL error %04X", error];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Release the texture.<span></span></pre></td></tr><tr><td scope="row"><pre>    if(textureName)<span></span></pre></td></tr><tr><td scope="row"><pre>        [image unlockTextureRepresentation];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return (error ? NO : YES);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Open the <code>Info.plist</code> file and make sure the following key is an entry in the dictionary:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key>QCPlugInClasses&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>RotatingSquarePlugIn&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/array><span></span></pre></td></tr></table></div><p>If you want, customize the bundle identifier. Then save and close the file.</p></li><li class="li"><p>Under Targets, choose Build &amp; Copy. Then, click Build Build &amp; Copy from the Action pop-up menu.</p><p>When you build using this option, Xcode copies the successfully built plug-in to <code>~/Library/Graphics/Quartz Composer Plug-Ins</code>.</p></li><li class="li"><p>Open Quartz Composer and search for the Rotating Square custom patch in the Patch Creator.</p></li><li class="li"><p>Create a composition to test the custom patch. Try setting the color and the positions. Add an interpolation patch to animate the square. To check the image input, you can drag an image directly to the editor and then connect the image to the patch, as shown below.</p><div class="item_figure"><img src = "../art/glsquare_test.jpg" alt = "missing graphic" ></div><p>Keep in mind that if the image is not square, the Rotating Square patch maps the coordinates to fit the image in the square, distorting the image if necessary.</p><div class="item_figure"><img src = "../art/square_image_viewer.jpg" alt = "missing graphic" ></div></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../qc_image_proc/qc_image_proc.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../glossary/glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/WritingConsumerPatches/WritingConsumerPatches.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/WritingConsumerPatches/WritingConsumerPatches.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/WritingConsumerPatches/WritingConsumerPatches.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>