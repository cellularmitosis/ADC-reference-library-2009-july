<!-- legacy work start -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- legacy work end -->


<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)

LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Recording a Sound Resource (IM: S)  (deprecated)</Title>

<!-- legacy work start -->
        <META NAME="Generator" CONTENT="manual">
        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">
        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">
        <META NAME="IndexTitle" CONTENT="Inside Macintosh: Sound (Not Recommended)">
        <meta name="xcode-display" content="render">

        <LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->
        <script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
<!-- legacy work end -->

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME=HEADING27></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Sound-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Sound-2.html"><B>Sound</B></A> / <BR><DD><A HREF="Sound-13.html"><B>Chapter 1 - Introduction to Sound on the Macintosh</B></A> / <A HREF="Sound-22.html"><B>Using Sound on Macintosh Computers</B></A></DL></FONT><P>
<HR>

<!-- legacy work start -->
<script type="text/javascript"> placeWatermark()</script>
<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
<i>Inside Macintosh: Sound</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="../../../referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div>
<!-- legacy work end -->


<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H2><A NAME=MARKER-9-193></A>Recording a Sound Resource<A NAME=MARKER-2-64></A><A NAME=MARKER-9-25></A><A NAME=MARKER-9-58></A></H2>
 You can record sounds from the current input device by using the <CODE>SndRecord</CODE> function. The <CODE>SndRecord</CODE> function presents the sound recording dialog box. When calling <CODE>SndRecord</CODE>, you need to provide a handle to a block of memory where the incoming data should be stored. If you pass the address of a <CODE>NIL</CODE> handle, however, the Sound Input Manager allocates a large block of space in your application heap and resizes it when the recording stops. <A HREF=#MARKER-9-197>Listing 1-4</A> illustrates how to call <CODE>SndRecord</CODE>.<P>
<B>Listing 1-4  <A NAME=MARKER-9-197></A>Recording through the sound recording dialog box</B><P>
<PRE>
PROCEDURE MyRecordThruDialog (VAR mySndHandle: Handle);
VAR
   myErr:      OSErr;
   myCorner:   Point;
BEGIN
   MyGetTopLeftCorner(myCorner);
   mySndHandle := NIL;     {use default memory allocation}
   myErr := SndRecord(NIL, myCorner, siBestQuality, mySndHandle);
   IF (myErr &lt;&gt; noErr) AND (myErr &lt;&gt; userCanceledErr) THEN
      DoError(myErr);
END;
</PRE>
 If the user cancels sound recording, then the <CODE>SndRecord</CODE> function returns the result code <CODE>userCanceledErr</CODE>. The <CODE>MyRecordThruDialog</CODE> procedure defined in <A HREF=#MARKER-9-197>Listing 1-4</A> returns a <CODE>NIL</CODE> sound handle if the user cancels recording.<P>
 If you pass a sound handle that is not <CODE>NIL</CODE> as the fourth parameter to the <CODE>SndRecord</CODE> function, the Sound Input Manager derives the maximum time of recording from the amount of space reserved by that handle. The handle is resized on completion of the recording.<P>
 The first parameter in the call to <CODE>SndRecord</CODE> is the address of a filter procedure that determines how user actions in the dialog box are filtered. In <A HREF=#MARKER-9-197>Listing 1-4</A>, no filter procedure is desired, so the parameter is specified as <CODE>NIL</CODE>. For information on filter procedures, see the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>.<A NAME=MARKER-9-314></A><P>
 The second parameter in the call to <CODE>SndRecord</CODE> is the desired location (in global coordinates) of the upper-left corner of the dialog box. For example, the Sound control panel displays the dialog box near the control panel. Your application might place the dialog box elsewhere (for example in the standard alert position on the main screen). For more information on centering dialog boxes, see the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>.<P>
 The third parameter in the call to <CODE>SndRecord</CODE> specifies the quality of the recording. Currently three values are supported:<P>
<PRE>
CONST
   siBestQuality     = 'best';   {the best quality available}
   siBetterQuality   = 'betr';   {a quality better than good}
   siGoodQuality     = 'good';   {a good quality}
</PRE>
 The precise meanings of these constants are defined by the current sound-input device driver. The constant <CODE>siBestQuality</CODE> indicates that you want the highest quality recorded sound, usually at the expense of increased storage space (possibly because no compression is performed on the sound data). The constant <CODE>siGoodQuality</CODE> indicates that you are willing to sacrifice audio quality if necessary to minimize the amount of storage space required (typically this means that 6:1 compression is performed on the sound data). For most voice recording, you should specify <CODE>siGoodQuality</CODE>. The constant <CODE>siBetterQuality</CODE> defines a quality and storage space combination that is between those provided by the other two constants.<A NAME=MARKER-2-111></A><P>
 You could play the sound recorded using the <CODE>MyRecordThruDialog</CODE> procedure defined in <A HREF=#MARKER-9-197>Listing 1-4</A> by calling <CODE>SndPlay</CODE> and passing it the sound handle <CODE>mySndHandle</CODE>. That handle refers to some data in memory that has the structure of an <CODE>'snd '</CODE> resource, but it is not a handle to an existing resource. To save the recorded data as a resource, you can use the Resource Manager. <A HREF=#MARKER-9-200>Listing 1-5</A> calls the <CODE>MyRecordThruDialog</CODE> procedure and then uses the Resource Manager to save the recorded data as a resource in an open resource file.<P>
<B>Listing 1-5  <A NAME=MARKER-9-200></A>Recording a sound resource</B><P>
<PRE>
PROCEDURE MyRecordSndResource (resFileRefNum: Integer);
CONST
   kMinSysSndRes = 0;               {lowest reserved 'snd ' resource ID}
   kMaxSysSndRes = 8191;            {highest reserved ID}
VAR
   myPrevResFile:       Integer;    {current resource file}
   mySndHandle:         Handle;     {handle to resource data}
   myResID:             LongInt;    {ID of resource}
   myResName:           Str255;     {name of resource}
   myErr:               OSErr;
BEGIN
   myPrevResFile := CurResFile;     {remember current resource file}
   UseResFile(resFileRefNum);       {temporarily switch resource files}
   MyRecordThruDialog(mySndHandle); {record via standard interface}
   IF mySndHandle &lt;&gt; NIL THEN
   BEGIN                            {recording finished successfully}
      REPEAT                        {find acceptable resource ID number}
         myResID := Unique1ID('snd ');
      UNTIL (myResID &lt; kMinSysSndRes) OR (myResID &gt; kMaxSysSndRes);
                              
      MyGetSoundName(myResName);    {get name for sound resource}
                                    {add resource to file}
      AddResource(mySndHandle, 'snd ', myResID, myResName);
      myErr := ResError;
      IF myErr = noErr THEN
      BEGIN
         UpdateResFile(resFileRefNum);    {update resource file}
         myErr := ResError;
      END;
      IF myErr &lt;&gt; noErr THEN 
         DoError(myErr);
   END;
   UseResFile(myPrevResFile);       {restore previous resource file}
END;
</PRE>
 The <CODE>MyRecordSndResource</CODE> procedure defined in <A HREF=#MARKER-9-200>Listing 1-5</A> takes as a parameter the reference number of an open resource file to which you wish to record. The procedure makes that resource file the current resource file and, after recording, reverts to what was previously the active resource file. Note that you should not record to your application's resource fork, because applications that write to their own resource forks cannot be used by multiple users at once over a network. For more information on reference numbers for resource files, see the chapter "Resource Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<P>
 The <CODE>MyRecordSndResource</CODE> procedure first presents the sound recording dialog box by calling the <CODE>MyRecordThruDialog</CODE> procedure defined in <A HREF=#MARKER-9-197>Listing 1-4 on page 1-28</A>. If that procedure returns a valid sound handle, <CODE>MyRecordSndResource</CODE> finds an acceptable resource ID for the resource file and then calls a procedure that returns a name for the resource (perhaps by presenting a dialog box that asks the user to name the sound). Finally, <CODE>MyRecordSndResource</CODE> adds the resource to the specified resource file and updates that file by calling the Resource Manager procedure <CODE>UpdateResFile</CODE>.<A NAME=MARKER-9-33></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Sound-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Sound-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
