<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>OTAccept</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING180></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-179.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-181.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-81.html"><B>Part 2 - Open Transport Reference</B></A><BR><DD><A HREF="NetworkingWOT-127.html"><B>Chapter 22 - Endpoints Reference</B></A> / <A HREF="NetworkingWOT-146.html"><B>Functions</B></A><BR><DL><DD><A HREF="NetworkingWOT-176.html"><B>Establishing Connection</B></A> / </DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING180-0></A>
<H3><A NAME=MARKER-9-208></A>OTAccept</H3>
 Accepts an incoming connection request.<P>
<A NAME=HEADING180-2></A>
<H5>C INTERFACE</H5>
<PRE>
<A NAME=MARKER-11-209></A>OSStatus OTAccept(EndpointRef ref, 
                     EndpointRef resRef, 
                     TCall* call);
</PRE>
<A NAME=HEADING180-4></A>
<H5>C++ INTERFACE</H5>
<PRE>
<A NAME=MARKER-12-210></A>OSStatus TEndpoint::Accept(EndpointRef resRef,
                     TCall* call);
</PRE>
<A NAME=HEADING180-6></A>
<H5>PARAMETERS</H5>
<DL>
<DT><CODE>ref</CODE>
<DD> The endpoint reference of the listening endpoint.<P>
<DT><CODE>resRef</CODE>
<DD> The endpoint reference of the endpoint accepting the connection.<P>
<DT><CODE>call</CODE>
<DD> A pointer to a <A HREF=NetworkingWOT-142.html#MARKER-9-103><CODE>TCall</CODE></A> structure that contains information about the address of the peer requesting the connection, option information, data associated with the connection request, and the connection ID for this connection. <P>
<DT>
<DD> The<CODE> call-&gt;addr.buf</CODE> field points to a buffer that contains the address of the peer that requested the connection. The provider may optionally check this address to ensure you're accepting the right connection. If you do not want to specify a value, set the <CODE>call-&gt;addr.len</CODE> field to 0.<P>
<DT>
<DD> The<CODE> call-&gt;opt.buf</CODE> field points to a buffer that contains option values for this connection. If you do not want to specify any options set the <CODE>call-&gt;opt.len</CODE> field to 0.<P>
<DT>
<DD> The<CODE> call-&gt;udata.buf</CODE> field points to a buffer containing any data to be returned to the endpoint requesting the connection. The <CODE>call-&gt;udata.len</CODE> field specifies the length of the data.<P>
<DT>
<DD> The<CODE> call-&gt;sequence</CODE> field specifies the connection ID of the connection request that you are accepting. This must be the same value that was passed to you by the <CODE>OTListen</CODE> function when you received the connection request.<P>
<DT><I>function result</I>
<DD> An error code. See Discussion.
</DL>
<A NAME=HEADING180-15></A>
<H5>DISCUSSION</H5>
 You use the <CODE>OTAccept</CODE> function to accept a request that you retrieved using the <A HREF=NetworkingWOT-179.html#MARKER-9-205><CODE>OTListen</CODE></A> function. You can accept a connection on either the same or a different endpoint than the one listening for connection request. <P>
<UL>
<P><LI>If you accept the connection on the same endpoint (the values of the <CODE>ref</CODE> and <CODE>resRef</CODE> parameters are the same), there must be no other outstanding connection requests on that endpoint. Otherwise, the call to <CODE>OTAccept</CODE> fails and returns the <CODE>kOTIndOutErr</CODE> result.
<P><LI>If you accept the connection on a different endpoint (the values of the <CODE>ref</CODE> and <CODE>resRef</CODE> parameters are different), you are not required to bind the endpoint accepting the request first. If the endpoint is not bound, the provider binds it to the same address as that of the endpoint receiving the connection request. If you want to bind it explicitly to that address, you must set the <CODE>reqAddr-&gt;qlen</CODE> field to 0.<P>
</UL>
 If you do not wish to accept the connection request, you must call the <A HREF=NetworkingWOT-192.html#MARKER-9-236><CODE>OTSndDisconnect</CODE></A> function.<P>
 If the endpoint is in synchronous mode, the function does not return until the operation is complete. If the endpoint is in asynchronous mode, the <CODE>OTAccept</CODE> function returns immediately with a <CODE>kOTNoError</CODE> result, indicating that processing has begun and that the client will be notified when it is complete. <P>
 When processing is finished and the connection is opened, the provider for the endpoint specified by the <CODE>ref</CODE> parameter calls that endpoint's notifier, passing the event <CODE>T_ACCEPTCOMPLETE</CODE> for the <CODE>code</CODE> parameter and the endpoint reference (<CODE>ref</CODE>) for the <CODE>cookie</CODE> parameter. The provider for the endpoint specified by the <CODE>resRef</CODE> parameter calls that endpoint's notifier, passing <CODE>T_PASSCON</CODE> for the <CODE>code</CODE> parameter and <CODE>resRef </CODE>for the <CODE>cookie</CODE> parameter. If you have accepted the connection on the same endpoint (<CODE>ref</CODE> and <CODE>resRef</CODE> are the same), the provider issues the <CODE>T_ACCEPTCOMPLETE</CODE> event first, and then the <CODE>T_PASSCON</CODE> event. <P>
<DL>
<DT><B>Note</B>
<DD>It is possible, in the case where the listening and accepting endpoints are different, that the accepting endpoint receives a <CODE>T_DATA</CODE> event before receiving the <CODE>T_PASSCON</CODE> event. If this happens, set a flag to defer receiving the data until later. When the <CODE>T_PASSCON</CODE> event is received, check the flag and issue the <CODE>OTRcv</CODE> call if the flag is set. Note that after deferring the handling of the <CODE>T_DATA</CODE> event, your handler will not be notified of this event again, until you read all of the data presently available.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 If you have not installed a notifier, you can poll the endpoint accepting the connection for a change of state to <CODE>T_DATAXFER</CODE>; the change of state happens when the connection is opened.<P>
<A NAME=HEADING180-24></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 In asynchronous mode, it is possible for the endpoint to issue the <CODE>T_ACCEPTCOMPLETE</CODE> event before the <CODE>OTAccept</CODE> function returns the result <CODE>kOTNoError</CODE>.<P>
 Not all endpoints support the sending of data with a connection request. Examine the <CODE>connect</CODE> field of the <CODE>TEndpointInfo</CODE> structure for the endpoint to determine if the endpoint supports the sending of data and the maximum size of the data.<P>
 Calling the <CODE>OTAccept</CODE> function on an endpoint that was bound with a <CODE>qlen</CODE> greater than 1 can result in the result <CODE>kOTLookErr</CODE> being returned because another <CODE>T_LISTEN</CODE> event or <CODE>T_DISCONNECT</CODE> event has arrived. For information on how to handle this situation, see <A HREF=NetworkingWOT-32.html#MARKER-9-47>"Handling Multiple Simultaneous Connections"</A>.<P>
<A NAME=HEADING180-28></A>
<H5>SEE ALSO</H5>
 The <A HREF=NetworkingWOT-151.html#MARKER-9-126><CODE>OTBind</CODE></A> function.<P>
 <A HREF=NetworkingWOT-51.html#MARKER-9-17>"TCP/IP Services"</A><P>
 <A HREF=NetworkingWOT-414.html#MARKER-9-27>"AppleTalk Reference"</A>.<P>
 <A HREF=NetworkingWOT-27.html#MARKER-9-12>Table 4-4</A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-179.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-181.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
