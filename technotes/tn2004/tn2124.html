<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html><head>
<!-- BEGIN META TAG INFO -->
<link rel="home" href="http://developer.apple.com/">
<link rel="find" href="http://developer.apple.com/search/">
<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
<script language="JavaScript" type="text/javascript" src="../../documentation/js/busnav.js"></script>
<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- END META TAG INFO -->
<!-- BEGIN TITLE -->
<title>Technical Note TN2124: Mac OS X Debugging Magic</title>
<!-- END TITLE -->
</head>
<!-- BEGIN BODY OPEN -->
<body bgcolor="#ffffff"><a name="//apple_ref/doc/uid/DTS10003391" title="Mac OS X Debugging Magic"></a>
<!--END BODY OPEN -->
<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->
<a name="top"></a>
<!-- BEGIN LOGO AND SEARCH -->
<!--#include virtual="/includes/adcnavbar"-->
<!-- END LOGO AND SEARCH -->
<!-- START BREADCRUMB -->
<div id="breadcrumb"><table width="680" border="0" cellpadding="0" cellspacing="0"><tr>
<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
<td><img width="340" height="10" src="images/1dot.gif" alt=""></td></tr><tr valign="middle"><td align="left" colspan="2">
<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/DeveloperTools/index.html">Tools</a> &gt; <a href="../../technicalnotes/DeveloperTools/idxCompilersDebuggers-date.html">Compiling & Debugging</a> &gt; 
</td></tr><tr><td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td></tr></table></div>
<!-- END BREADCRUMB -->

<!-- START MAIN CONTENT -->
<!-- START TITLE GRAPHIC AND INTRO-->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top">
<td><h1>
<div id="pagehead">Technical Note TN2124</div>
<div id="pageheadsub">Mac OS X Debugging Magic</div>
</h1></td></tr></table>
<!-- END TITLE GRAPHIC AND INTRO -->
<!-- BEGIN WIDE COLUMN -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td align="left" width="680">
<!-- BEGIN CONTENTS -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td><p>This technote describes a number of 'secret' debugging facilities in Mac OS X, including environment variables, preferences, routines callable from GDB, special files, and so on.  If you're developing for Mac OS X, you should look through this list to see if you're missing out on something that will make your life easier.</p></td></tr><tr><td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td width="680"><ul><li><a href="#SECINTRO">Introduction</a></li><li><a href="#SECBASICS">Basics</a><ul><li><a href="#SECENABLE">Enabling Debugging Facilities</a><ul><li><a href="#SECENV">Environment Variables</a><li><a href="#SECPREFS">Preferences</a><li><a href="#SECFILES">Files</a><li><a href="#SECCALLFUNC">Callable Routines</a></li></ul></li><li><a href="#SECSEEINGOUTPUT">Seeing Debug Output</a><ul><li><a href="#SECCONSOLE">Console Output</a></li></ul></li></ul></li><li><a href="#SECARCHITECTURE">Architecture Considerations</a></li><li><a href="#SECCRASHREPORTER">CrashReporter</a></li><li><a href="#SECBSD">BSD</a><ul><li><a href="#SECCOREDUMPS">Core Dumps</a></li><li><a href="#SECMALLOC">Memory Allocator</a></li><li><a href="#SECMALLOCDEBUG">MallocDebug and ObjectAlloc</a></li><li><a href="#SECGMALLOC">Guarded Memory Allocator</a></li><li><a href="#SECCPLUSPLUS">Standard C++ Library</a></li><li><a href="#SECTOOLS">Command Line Tools</a></li><li><a href="#SECDYLD">Dynamic Linker (dyld)</a><ul><li><a href="#SECDEBUGLIB">Debug Libraries</a><li><a href="#SECJUSTONELIB">Enabling Just One Debug Library</a><li><a href="#DEBUG">Debug Library Versioning</a><li><a href="#SECPROFILELIBRARIES">Profile Libraries</a></li></ul></li><li><a href="#SECNOWINDOWSERVER">Escaping the Window Server</a></li></ul></li><li><a href="#SECDAEMONS">Daemons</a><ul><li><a href="#SECLAUNCHD">launchd</a><ul><li><a href="#SECLAUNCHCTL">launchctl</a><li><a href="#SECLAUNCHDLOGGING">launchd Logging</a><li><a href="#SECLAUNCHDJOBS">Debugging a Particular Job</a></li></ul></li><li><a href="#SECLOOKUPD">lookupd</a></li><li><a href="#SECPRINTING">Printing (CUPS)</a></li></ul></li><li><a href="#SECCORESERVICES">Core Services</a><ul><li><a href="#SECCFM">Code Fragment Manager (CFM)</a></li><li><a href="#SECCF">Core Foundation</a><ul><li><a href="#SECCFNOTIFICATION">CFNotificationCenter</a></li></ul></li><li><a href="#SECCOMPONENT">Component Manager</a></li><li><a href="#SECCSFM">File Manager</a></li><li><a href="#SECFOLDERS">Folder Manager</a></li><li><a href="#SECGESTALT">Gestalt</a></li><li><a href="#SECTHREADING">Threading</a></li><li><a href="#SECWEBSERVICES">Web Services</a></li></ul></li><li><a href="#SECDISKS">Disks and Discs</a><ul><li><a href="#SECDISKARB">Disk Arbitration</a></li><li><a href="#SECDISCRECORDING">Disc Recording</a></li><li><a href="#SECDISKUTILITY">Disk Utility</a></li></ul></li><li><a href="#SECAPPLICATIONSERVICES">ApplicationServices</a><ul><li><a href="#SECAE">Apple Events</a><ul><li><a href="#SECEPPC">Remote Apple Events</a></li></ul></li><li><a href="#SECPROCESSMANAGER">Process Manager</a></li><li><a href="#SECCOREGRAPHICS">Core Graphics</a></li><li><a href="#SECQUICKDRAW">QuickDraw</a></li></ul></li><li><a href="#SECCARBON">Carbon (HIToolbox)</a><ul><li><a href="#SECHLTBPRINTERS">HIToolbox Object Printing Routines</a></li><li><a href="#SECHLTBFLASHERS">HIToolbox Region Flashing</a></li><li><a href="#SECHLTBEVENTDEBUG">HIToolbox Event Debugging</a><ul><li><a href="#SECHLTBEVENTDEBUGENV">EventDebug Environment Variable</a><li><a href="#SECHLTBEVENTTRACE">Event Tracing</a></li></ul></li><li><a href="#SECHLTBEVENTSTATS">HIToolbox Event Statistics</a></li><li><a href="#SECHLTBOTHER">Other HIToolbox Debugging Facilities</a></li></ul></li><li><a href="#SECCOCOA">Cocoa</a><ul><li><a href="#SECOBJECTIVEC">Objective-C</a></li><li><a href="#SECFOUNDATION">Foundation</a></li><li><a href="#SECAPPKIT">AppKit</a><ul><li><a href="#SECAPPKITEVENTS">AppKit Events</a><li><a href="#SECAPPKITVIEWS">AppKit Views</a><li><a href="#SECAPPKITOTHER">Other AppKit Debugging Facilities</a></li></ul></li></ul></li><li><a href="#TNT_HISTORY_TAG">Document Revision History</a></li></ul></td></tr><tr><td colspan="3" scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><A NAME="SECINTRO"></A><H2>Introduction</H2><p>Mac OS X includes a number of debugging facilities added by engineering teams to help develop and debug specific subsystems. Many of these facilities remain in the released system and you can use them to debug your code. This technote describes some of the more broadly useful ones.</p><p>In cases where a debugging facility is documented in another place, there's a short overview of the facility and a link to the existing documentation.</p><p>This is not an exhaustive list: not all debugging facilities are, or will be, documented.</p><div class="notebox"><p><strong>WARNING:</strong> The debugging facilities described in this technote are unsupported. We reserve the right to change or eliminate each facility as dictated by the evolution of Mac OS X; this has happened in the past, and we fully expect it to happen again in the future.  <strong>These facilities are for debugging only: you must not ship a product that relies on the existence or functionality of the facilities described in this technote.</strong></p></div><div class="notebox"><p><strong>IMPORTANT:</strong> This technote is based on Mac OS X 10.4 (with Xcode 2.0 installed) and it is accurate for such a system.  Many of the details covered in this technote vary from release to release; you may encounter minor variations on older or newer systems.</p></div><div class="notebox"><p><strong>Note:</strong> The previous version of this technote was based on Mac OS X 10.3.5 (with Xcode 1.5 installed).  In the process of updating the document, I've retested all of debugging facilities described therein.  Most of the facilities did not change significantly; in that case, I've left the description unmodified.  This means that some of the examples shown are actually from 10.3.5, and may show slightly different results than they would on 10.4.  However, the overall thrust of the example is still accurate.</p><p>If the debugging facility did change significantly in 10.4, I've updated the description to reflect the 10.4 behavior and mentioned the 10.3.x behavior in passing.</p></div><p>This technote covers advanced debugging techniques. If you're just getting started with Mac OS X development, you should consult the following material.</p><ul><li><p>GDB is the fundamental debugger on Mac OS X.  For a full description of GDB, see <A HREF="../../documentation/DeveloperTools/gdb/gdb/gdb_toc.html">Debugging with GDB</A>.</p></li><li><p>Xcode is Apple's integrated development environment (IDE).  It includes a sophisticated graphical debugger, implemented as a wrapper around GDB.  For more information about Xcode, see the <A HREF="../../referencelibrary/DeveloperTools/idxXcode-resource.html">Xcode section</A> of the Apple developer Reference Library.</p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECBASICS"></A><H2>Basics</H2><p>The later sections of this technote describe the debug facilities of Mac OS X in detail.  Many these facilities use similar techniques to enable and disable the facility, and to see its output.  This section describes these common techniques.</p><A NAME="SECENABLE"></A><H3>Enabling Debugging Facilities</H3><p>Some debugging facilities are enabled by default.  However, most facilities must be enabled using one of the following.</p><A NAME="SECENV"></A><H4>Environment Variables</H4><p>In many cases you can enable a debugging facility by setting a particular environment variable.  The easiest way to do this is to launch your application from Terminal, and specify the environment variable on the command line.  <A HREF="#LISTENVSH">Listing 1</A> shows how to set an environment variable in the <code>sh</code> shell; <A HREF="#LISTENVCSH">Listing 2</A> shows the equivalent in <code>csh</code>.</p><A NAME="LISTENVSH"></A><p class="smalltext"><strong>Listing 1:</strong> Setting an environment variable in an sh-compatible shell</p><pre class="sourcecodebox">
$ MallocStackLogging=1 /Applications/TextEdit.app/Contents/MacOS/TextEdit
malloc[1002]: recording stacks using standard recorder
[&hellip;]
</pre><A NAME="LISTENVCSH"></A><p class="smalltext"><strong>Listing 2:</strong> Setting an environment variable in a csh-compatible shell</p><pre class="sourcecodebox">
% setenv MallocStackLogging 1
% /Applications/TextEdit.app/Contents/MacOS/TextEdit
malloc[1004]: recording stacks using standard recorder
[&hellip;]
</pre><div class="notebox"><p><strong>Note:</strong> The default shell in Mac OS X 10.3 and later is <code>bash</code>, an <code>sh</code>-compatible shell.  The default shell in Mac OS X 10.2.x and earlier was <code>tcsh</code>, a <code>csh</code>-compatible shell.  The remainder of this technote assumes that you're using <code>bash</code>.</p></div><div class="notebox"><p><strong>IMPORTANT:</strong> If you're using a <code>csh</code>-compatible shell, don't forget to reset (using the <code>unsetenv</code> command) any debugging environment variables once you've finished debugging.  Otherwise these settings may adversely affect your future commands.</p><p>Alternatively, open two Terminal windows and use the first exclusively for debugging and the second for all other commands.</p></div><p>In addition, you can set environment variables in GDB, as shown in <A HREF="#LISTENVGDB">Listing 3</A>.</p><A NAME="LISTENVGDB"></A><p class="smalltext"><strong>Listing 3:</strong> Setting an environment variable in GDB</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 5.3-20030128 (Apple version gdb-330.1) [&hellip;]
(gdb) set env MallocStackLogging 1
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
malloc[1062]: recording stacks using standard recorder
[&hellip;]
</pre><p>If you're using Xcode to build and debug your application, you can set environment variables using the executable inspector. <A HREF="#FIGXCODEENV">Figure 1</A> shows an example of this.</p><A NAME="FIGXCODEENV"></A><p class="caption"><strong>Figure 1:</strong> Setting environment variables in Xcode</p><p><img  src="images/tn2124_XCodeEnv.png" width="739" height="582" alt="Figure 1, Setting environment variables in Xcode"></p><p>Finally, Mac OS X provides a mechanism for setting environment variables for all processes launched by a specific user.  See <A HREF="../../qa/qa2001/qa1067.html">Technical Q&amp;A QA1067, 'Setting environment variables for user processes'</A> for details.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECPREFS"></A><H4>Preferences</H4><p>You can enable other debugging facilities by setting a preference using the <code>defaults</code> command line tool.  <A HREF="#LISTDEFAULTSWRITE">Listing 4</A> shows how to do this.  This listing sets the <code>NSTraceEvents</code> preference for the TextEdit application (whose bundle identifier is <code>com.apple.TextEdit</code>) to YES.</p><A NAME="LISTDEFAULTSWRITE"></A><p class="smalltext"><strong>Listing 4:</strong> Setting a preference using defaults</p><pre class="sourcecodebox">
$ defaults write com.apple.TextEdit NSTraceEvents YES
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit
2004-08-30 16:47:55.851 TextEdit[1135] timeout = 62998416724.149353 seco&hellip;
2004-08-30 16:47:55.894 TextEdit[1135] got apple event of class 61657674&hellip;
[&hellip;]
</pre><p>Once you're finished debugging, you should delete the preference, also using <code>defaults</code>, as shown in <A HREF="#LISTDEFAULTSDELETE">Listing 5</A>.</p><A NAME="LISTDEFAULTSDELETE"></A><p class="smalltext"><strong>Listing 5:</strong> Deleting a preference using defaults</p><pre class="sourcecodebox">
$ defaults delete com.apple.TextEdit NSTraceEvents
</pre><p>For more information about <code>defaults</code>, consult its <A HREF="x-man-page://1/defaults">man page</A>.</p><p>Cocoa applications also let you set temporary preferences on the command line.  For example, <A HREF="#LISTDEFAULTSTEMPORARY">Listing 6</A> shows how to achieve equivalent results to <A HREF="#LISTDEFAULTSWRITE">Listing 4</A> without modifying any permanent preferences.</p><A NAME="LISTDEFAULTSTEMPORARY"></A><p class="smalltext"><strong>Listing 6:</strong> Temporarily setting a preference</p><pre class="sourcecodebox">
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSTraceEvents YES
2004-10-25 17:28:41.143 TextEdit[5774] timeout = 62993575878.857864 seco&hellip;
2004-10-25 17:28:41.179 TextEdit[5774] got apple event of class 61657674&hellip;
[&hellip;]
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECFILES"></A><H4>Files</H4><p>Certain debugging facilities are enabled by the existence of specific files within the file system.  <A HREF="#LISTTOUCH">Listing 7</A> shows an example of this: creating the file <code>/var/log/do_dnserver_log</code> causes the CFNotificationCenter server (<code>distnoted</code>) to record information about all notifications to the file <code>/var/log/dnserver.log</code>.</p><A NAME="LISTTOUCH"></A><p class="smalltext"><strong>Listing 7:</strong> Create a specific file to enable debugging</p><pre class="sourcecodebox">
$ sudo touch /var/log/do_dnserver_log

[&hellip; now restart &hellip;]

$ cat /var/log/dnserver.log
-------------------------------------------------
[&hellip;] create_client &quot;KernelEventAgent&quot; BFF7FA80 (1203)
[&hellip;] received_message_from &quot;KernelEventAgent&quot; register &quot;DISCONNECT&quot; [&hellip;]
[&hellip;]
</pre><p>For more information about this specific example, see <A HREF="#SECCFNOTIFICATION">CFNotificationCenter</A>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCALLFUNC"></A><H4>Callable Routines</H4><p>Many system frameworks include routines that print debugging information to <code>stderr</code>.  These routines are specifically designed to be callable from within GDB.  <A HREF="#LISTCALLFUNC">Listing 8</A> shows an example of this, in this case calling the <code>GDBComponentList</code> routine to print a list of components and their instances (the equivalent of the <code>thing</code> MacsBug command on traditional Mac OS).</p><A NAME="LISTCALLFUNC"></A><p class="smalltext"><strong>Listing 8:</strong> Calling a debugging routine from GDB</p><pre class="sourcecodebox">
(gdb) call (void) GDBComponentList()
Cnt tRef# (address) Type/SubT/Manu Flags    EntryPnt File Parnt ThingName
  0 10008  0180d540 adec/.mp3/appl 10000000 00000000   -3 00000 (Not loade&hellip;
[&hellip;]
  2 1012c  005c3be0 clok/micr/appl 10000003 8b1586a8    1 00000 (Not loade&hellip;
        Inst:0x850003; Err=0; Storage:0x1fe6f0
        Inst:0x890004; Err=0; Storage:0x1fe6f8
  0 10065  0180fd08 clok/soun/appl 00000005 00000000   -3 00000 (Not loade&hellip;
[&hellip;]
There are 9 component manager files:
        0: refs 2, path [/System/Library/Components/VCH263Codec.component]&hellip;
        1: refs 94, path [/System/Library/QuickTime/QuickTimeComponents.co&hellip;
        2: refs 5, path [/System/Library/Components/IOQTComponents.compone&hellip;
        3: refs 2, path [/System/Library/QuickTime/QuickTimeVR.component],&hellip;
        4: refs 7, path [/System/Library/QuickTime/QuickTimeFirewireDV.com&hellip;
        5: refs 1, path [/System/Library/QuickTime/QuickTimeMPEG4.componen&hellip;
        6: refs 1, path [/System/Library/Components/PDFImporter.component]&hellip;
        7: refs 1, path [/System/Library/QuickTime/ApplePixletVideo.compon&hellip;
        8: refs 1, path [/System/Library/QuickTime/QuickTimeStreaming.comp&hellip;
</pre><p>If you don't see the output from the routine, you may need to look at the console log, as described in the <A HREF="#SECSEEINGOUTPUT">next section</A>.</p><div class="notebox"><p><strong>IMPORTANT:</strong> If you use this technique for your own code, be warned that it doesn't always work for routines that are declared <code>static</code>.  The compiler's interprocedural optimizations may cause a <code>static</code> routine to deviate from standard calling conventions.  In that case, it can't be reliably called by GDB.</p><p>In practice, this only affects Intel code.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECSEEINGOUTPUT"></A><H3>Seeing Debug Output</H3><p>Programs that generate debug output generally do so using one of three different mechanisms.</p><ul><li><p>printing to <code>stderr</code></p></li><li><p>system log</p></li><li><p>kernel trace facility</p></li></ul><p>Printing to <code>stderr</code> is the most commonly used output mechanism.  Given this topic's importance, I cover it in depth in the <A HREF="#SECCONSOLE">next section</A>.</p><p>The other two mechanism are much simpler.  You can view the system log using the Console application (in <code>/Applications/Utilities</code>).  You can learn more about it in the syslog man pages (<A HREF="x-man-page://3/syslog">syslog</A>, <A HREF="x-man-page://5/syslog.conf">syslog.conf</A>, and <A HREF="x-man-page://8/syslogd">syslogd</A>).</p><p>The kernel trace facility is a highly specialized low-latency, high-availability logging mechanism.  In most cases a program that logs to the kernel trace facility also includes a way to view the logs (for example, you can using <A HREF="x-man-page://1/kdump">kdump</A> to print a trace file generated using <A HREF="x-man-page://1/ktrace">ktrace</A>).</p><A NAME="SECCONSOLE"></A><H4>Console Output</H4><p>Many programs, and indeed many system frameworks, print debugging messages to <code>stderr</code>.  The destination for this output is ultimately controlled by the program: it can redirect <code>stderr</code> to whatever destination it choose.  However, in most cases a program does not redirect <code>stderr</code>, so the output goes to the default destination inherited by the program from its launch environment.  This is typically one of the following.</p><ul><li><p>If you launch a GUI application in the normal way (for example, by double clicking the application in the Finder), the system connects its <code>stderr</code> to the console device (<code>/dev/console</code>).  You can view its output using the Console application (in <code>/Applications/Utilities</code>).  Additionally, the output is recorded to the file <code>/Library/Logs/Console/&lt;username&gt;/console.log</code>.</p></li><li><p>If you run a program (be it GUI or non-GUI) from within Terminal, its <code>stderr</code> is connected to your Terminal window; anything the program prints will appear in this window.  This also applies to programs run from GDB within a Terminal window.</p></li><li><p>If you run a program from within Xcode, you can see its <code>stderr</code> output in Xcode's Run Log or Console Log windows (choose the corresponding command from the Debug menu to see the window).</p></li></ul><p>Attaching to a running program (using the <code>attach</code> command in GDB) does not automatically connect the program's <code>stderr</code> to your GDB window. You can do this from within GDB using the trick described in the &quot;Seeing stdout and stderr After Attaching&quot; section of <A HREF="../tn/tn2030.html">Technical Note TN2030, 'GDB for MacsBug Veterans'</A>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECARCHITECTURE"></A><H2>Architecture Considerations</H2><p>The examples shown in this technote are from a PowerPC-based Macintosh computer. However, they work just fine on an Intel-based machine.  The only significant difference relates to parameter passing.  The PowerPC architecture passes parameters in registers, while the Intel architecture passes parameters on the stack.</p><p>On PowerPC, a good rule of thumb is that the first parameter is in GPR3 (General Purpose Register 3), the second parameter is in GPR4, and so on.  The GDB syntax for these is <code>$r3</code>, <code>$r4</code>, and so on.  On return, any function result is in GPR3 (<code>$r3</code>).</p><p>On Intel, there are two rules of thumb.</p><ul><li><p>If you've stopped at the first instruction of a routine, the first parameter is at 4 bytes above the stack pointer, the second parameter is 8 bytes above the stack pointer, and so on.  The GDB syntax is <code>*(int *)($esp+4)</code>, <code>*(int *)($esp+8)</code>, and so on.</p></li><li><p>If you've stopped elsewhere in the routine (after the frame has been created), the first parameter is at 8 bytes above the frame pointer, the second parameter is 12 bytes above the frame pointer, and so on.  The GDB syntax is <code>*(int *)($ebp+8)</code>, <code>*(int *)($ebp+12)</code>, and so on.</p></li></ul><p>In both Intel cases, any function result is in register EAX (<code>$eax</code>).</p><p>If the routine is a C++ member function, there is an implicit first parameter for <code>this</code>.  If the routine is an Objective-C method, there are two implicit first parameters (see <A HREF="#SECCOCOA">Cocoa</A> for details on this).</p><p><A HREF="#LISTPPCPARAMS">Listing 9</A> and <A HREF="#LISTINTELPARAMS">Listing 10</A> show these rules of thumb in action.</p><A NAME="LISTPPCPARAMS"></A><p class="smalltext"><strong>Listing 9:</strong> Parameters on PowerPC</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 6.1-20040303 (Apple version gdb-434) [&hellip;]
(gdb) fb CFStringCreateWithFormat
Function &quot;CFStringCreateWithFormat&quot; not defined.
Breakpoint 1 (CFStringCreateWithFormat) pending.
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
Reading symbols for shared libraries [&hellip;] done
Breakpoint 1 at 0x90741e80
Pending breakpoint 1 - &quot;CFStringCreateWithFormat&quot; resolved

Breakpoint 1, 0x90741e80 in CFStringCreateWithFormat ()
(gdb) # first param is &quot;alloc&quot;
(gdb) p/a $r3
$1 = 0x0
(gdb) # second param is &quot;formatOptions&quot;
(gdb) p/a $r4
$2 = 0x0
(gdb) # third param is &quot;format&quot;
(gdb) p/a $r5
$3 = 0xa0742454 &lt;kCFURLLocalhost+340&gt;
(gdb) call (void) CFShow($r5)
%@%c
(gdb) finish
Run till exit from #0  0x90741e80 in CFStringCreateWithFormat ()
0x9073eaf8 in CFURLCreateWithFileSystemPathRelativeToBase ()
(gdb) # function result
(gdb) p/a $r3
$4 = 0x306a40
(gdb) call (void) CFShow($r3)
/Applications/TextEdit.app/Contents/MacOS/
</pre><A NAME="LISTINTELPARAMS"></A><p class="smalltext"><strong>Listing 10:</strong> Parameters on Intel</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 6.1-20040303 (Apple version gdb-425) [&hellip;]
(gdb) fb CFStringCreateWithFormat
Function &quot;CFStringCreateWithFormat&quot; not defined.
Breakpoint 1 (CFStringCreateWithFormat) pending.
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
Reading symbols for shared libraries [&hellip;] done
Breakpoint 1 at 0x9078f111
Pending breakpoint 1 - &quot;CFStringCreateWithFormat&quot; resolved

Breakpoint 1, 0x9078f111 in CFStringCreateWithFormat ()
(gdb) # first param is &quot;alloc&quot;
(gdb) p/a *(int *)($ebp+8)
$1 = 0x0
(gdb) # second param is &quot;formatOptions&quot;
(gdb) p/a *(int *)($ebp+12)
$2 = 0x0
(gdb) # third param is &quot;format&quot;
(gdb) p/a *(int *)($ebp+16)
$3 = 0xa078bd88 &lt;dyld_func_lookup_pointer+16100&gt;
(gdb) call (void) CFShow($3)
%@%c
(gdb) finish
Run till exit from #0  0x9078f111 in CFStringCreateWithFormat ()
0x9078b6c1 in CFURLCreateWithFileSystemPathRelativeToBase ()
(gdb) # function result
(gdb) p/a $eax
$4 = 0x306ce0
(gdb) call (void) CFShow($eax)
/Applications/TextEdit.app/Contents/MacOS/
(gdb) # Now clear the breakpoint and reset it on
(gdb) # the first instruction of CFStringCreateWithFormat.
(gdb) delete 1
(gdb) # Note the &quot;*&quot; syntax in the following command, which sets the
(gdb) # breakpoint at the first instruction of the routine.
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x9078f10b
(gdb) c
Continuing.

Breakpoint 2, 0x9078f10b in CFStringCreateWithFormat ()
(gdb) # Now we're stopped at the first instruction of CFStringCreateWithFormat.
(gdb) # The stack frame hasn't been created yet.
(gdb) # Print each parameter, this time relative to the stack pointer.
(gdb) p/a *(int *)($esp+4)
$5 = 0x0
(gdb) p/a *(int *)($esp+8)
$7 = 0x0
(gdb) p/a *(int *)($esp+12)
$8 = 0xa078bd88 &lt;dyld_func_lookup_pointer+16100&gt;
(gdb) call (void) CFShow($8)
%@%c
</pre><div class="notebox"><p><strong>IMPORTANT:</strong> These are only rules of thumb.  If the routine has any non-standard parameters, or a non-standard function result, these rules of thumb do no apply, and you should consult the documentation for the details.</p><p>In this context, standard parameters are integers (that fit in a single register), enumerations, and pointers (including pointers to arrays and pointers to functions).  Non-standard parameters are floating point numbers, vectors, structures, and integers bigger than a register.</p><p>For a detailed description of calling conventions for all Mac OS X architectures, see <A HREF="../../documentation/DeveloperTools/Conceptual/LowLevelABI/index.html">Mac OS X ABI Function Call Guide</A>.</p></div><p>Finally, if you're looking for information about specific instructions, be aware that the Help menu in Shark (included in the Xcode developer tools) has both a PowerPC and Intel instruction reference.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCRASHREPORTER"></A><H2>CrashReporter</H2><p>CrashReporter is an invaluable debugging facility that logs information about all programs that crash.  It is described in detail in <A HREF="tn2123.html">Technical Note TN2123, 'CrashReporter'</A>.  CrashReporter is enabled all the time; all you have to do is look at its output.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECBSD"></A><H2>BSD</H2><p>The BSD subsystem implements process, memory, file, and network infrastructure, and thus is critical to all applications on Mac OS X.  BSD implements a number of neat debugging facilities that you can take advantage of.</p><A NAME="SECCOREDUMPS"></A><H3>Core Dumps</H3><p>Core dumps have an undeserved reputation as a primitive debugging facility. In reality they can be very helpful when debugging difficult problems, especially when you can't reproduce the problem locally.</p><p>You can enable core dumps on a system-wide basis by adding the line <code>limit core unlimited</code> to your <code>/etc/launchd.conf</code> file, creating it if necessary, and then restarting.  For more information about this, see the <A HREF="x-man-page://5/launchd.conf">launchd.conf</A> man page.</p><div class="notebox"><p><strong>Note:</strong> Prior to Mac OS X 10.4, you would enable core dumps on a system-wide basis by changing the line &quot;COREDUMPS=-NO-&quot; in <code>/etc/hostconfig</code> to &quot;COREDUMPS=-YES-&quot; and then restarting.</p></div><p>Alternatively, if you run your program from Terminal, you can simply raise the core dump size limit in the shell beforehand.  <A HREF="#LISTCOREDUMP">Listing 11</A> shows an example of this.</p><A NAME="LISTCOREDUMP"></A><p class="smalltext"><strong>Listing 11:</strong> Unlimited core dump size</p><pre class="sourcecodebox">
$ ulimit -c unlimited
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit
[&hellip;]
</pre><p>To test the core dump facility, send your program a <code>SIGABRT</code> using the <code>kill</code> command, as demonstrated by <A HREF="#LISTSIGABRT">Listing 12</A>.</p><A NAME="LISTSIGABRT"></A><p class="smalltext"><strong>Listing 12:</strong> Testing core dumps by sending a SIGABRT</p><pre class="sourcecodebox">
$ ps | grep TextEdit
  374  p1  S+     0:00.58 /Applications/TextEdit.app/Contents/MacOS/TextEdit
  379 std  S+     0:00.01 grep TextEdit
$ kill -ABRT 374
</pre><p>Your application will then quit with a &quot;Abort trap (core dumped)&quot; message.  You can find the core dump in <code>/cores</code>.  You can work out which core dump is which using the <code>otool</code> command.  Finally, you can debug the core dump using GDB with the <code>-c</code> argument.  <A HREF="#LISTCOREDUMP2">Listing 13</A> shows an example of this process.</p><A NAME="LISTCOREDUMP2"></A><p class="smalltext"><strong>Listing 13:</strong> Using core dumps</p><pre class="sourcecodebox">
Abort trap (core dumped)
$ ls -lh /cores
total 296856
-r--------  1 quinn  admin       144M 29 Oct 10:23 core.374
$ otool -c /cores/core.374
/cores/core.374:
Argument strings on the stack at: 0xc0000000
        /Applications/TextEdit.app/Contents/MacOS/TextEdit

        /Applications/TextEdit.app/Contents/MacOS/TextEdit
        TERM_PROGRAM=Apple_Terminal
        TERM=xterm-color
        SHELL=/bin/bash
        TERM_PROGRAM_VERSION=100
        USER=quinn
        __CF_USER_TEXT_ENCODING=0x1F5:0:15
        PATH=/bin:/sbin:/usr/bin:/usr/sbin
        PWD=/Users/quinn
        SHLVL=1
        HOME=/Users/quinn
        LOGNAME=quinn
        SECURITYSESSIONID=20f550
        _=/Applications/TextEdit.app/Contents/MacOS/TextEdit
$ gdb -c /cores/core.374
GNU gdb 5.3-20030128 (Apple version gdb-292) (Sat Sep 20 03:22:27 GMT 2003)
Copyright 2003 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type &quot;show copying&quot; to see the conditions.
There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.
This GDB was configured as &quot;powerpc-apple-darwin&quot;.
Core was generated by `/Applications/TextEdit.app/Contents/MacOS/TextEdit'.
#0  0x900075c8 in ?? ()
(gdb) bt
#0  0x900075c8 in ?? ()
#1  0x90007118 in ?? ()
#2  0x901960bc in ?? ()
#3  0x927d5ecc in ?? ()
#4  0x927dc640 in ?? ()
#5  0x927fe6d0 in ?? ()
#6  0x92dd2a80 in ?? ()
#7  0x92de93fc in ?? ()
#8  0x92dfd730 in ?? ()
#9  0x92eb9a1c in ?? ()
#10 0x00007d98 in ?? ()
#11 0x00007c0c in ?? ()
</pre><p>As you can see from <A HREF="#LISTCOREDUMP2">Listing 13</A>, core dumps do not contain debugger symbols.  If you have a symbol file handy, you can tell GDB to consult it using the <code>add-symbol-file</code> command.  <A HREF="#LISTCOREDUMP3">Listing 14</A> shows how to do this for the system frameworks used by this TextEdit backtrace.</p><A NAME="LISTCOREDUMP3"></A><p class="smalltext"><strong>Listing 14:</strong> Adding symbols</p><pre class="sourcecodebox">
(gdb) add-symbol-file /System/Library/Frameworks/AppKit.framework/AppKit
[&hellip;]
(gdb) add-symbol-file /System/Library/Frameworks/CoreFoundation.framework\
/CoreFoundation
[&hellip;]
(gdb) add-symbol-file /System/Library/Frameworks/System.framework/System
[&hellip;]
#12 0x00007c0c in ?? ()
(gdb) add-symbol-file /System/Library/Frameworks/Carbon.framework/\
Frameworks/HIToolbox.framework/HIToolbox
[&hellip;]
(gdb) bt
#0  0x900075c8 in mach_msg_trap ()
#1  0x90007118 in mach_msg ()
#2  0x90191930 in __CFRunLoopRun ()
#3  0x901960bc in CFRunLoopRunSpecific ()
#4  0x927d5ecc in RunCurrentEventLoopInMode ()
#5  0x927dc640 in ReceiveNextEventCommon ()
#6  0x927fe6d0 in BlockUntilNextEventMatchingListInMode ()
#7  0x92dd2a80 in _DPSNextEvent ()
#8  0x92de93fc in -[NSApplication nextEventMatchingMask:untilDate:inMode:&hellip;
#9  0x92dfd730 in -[NSApplication run] ()
#10 0x92eb9a1c in NSApplicationMain ()
#11 0x00007d98 in ?? ()
#12 0x00007c0c in ?? ()
</pre><div class="notebox"><p><strong>IMPORTANT:</strong> Core dumps are large.  In the example <A HREF="#LISTCOREDUMP2">Listing 13</A>, TextEdit's core dump is 144 MB.  If you have core dumps enabled as a matter of course, make sure that you regularly clean out <code>/cores</code> to avoid filling up your startup disk.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECMALLOC"></A><H3>Memory Allocator</H3><p>The default memory allocator includes a number of debugging facilities that you can enable via environment variables.  These are fully documented in the <A HREF="x-man-page://3/malloc">manual page</A>.  <A HREF="#TABMALLOCENV">Table 1</A> lists some of the more useful ones.</p><A NAME="TABMALLOCENV"></A><p class="smalltext"><strong>Table 1:</strong> Some useful memory allocator environment variables</p><table cellspacing="0" class="graybox"><tr><th>Variable</th><th>Summary</th></tr><tr><td scope="row"><code>MallocScribble</code></td><td>Fill deallocated memory with 0x55</td></tr><tr><td scope="row"><code>MallocPreScribble (10.4 and later)</code></td><td>Fill newly allocated memory with 0xAA</td></tr><tr><td scope="row"><code>MallocGuardEdges</code></td><td>Add guard pages before and after large allocations</td></tr><tr><td scope="row"><code>MallocStackLogging</code></td><td>Record stack logs for each memory block to assist memory debugging tools</td></tr><tr><td scope="row"><code>MallocStackLoggingNoCompact</code></td><td>Record stack logs for all operations to assist memory debugging tools</td></tr></table><div class="notebox"><p><strong>IMPORTANT:</strong> These environment variables do <strong>not</strong> require a special memory library (like <A HREF="#SECMALLOCDEBUG">MallocDebug</A> or the <A HREF="#SECGMALLOC">Guarded Memory Allocator</A>).  In fact, they are supported by the default, non-debug memory allocator, and are, therefore, always available.</p></div><p>The default memory allocator also logs messages if it detects certain common programming problems. For example, if you free a block of memory twice, or free memory that you never allocated, <code>free</code> may print the message shown in <A HREF="#LISTFREEERR">Listing 15</A>.  The number inside square brackets is the process ID.</p><A NAME="LISTFREEERR"></A><p class="smalltext"><strong>Listing 15:</strong> A common message printed by free</p><pre class="sourcecodebox">
*** malloc[4691]: Deallocation of a pointer not malloced: 0x1000;  \
This could be a double free(), or free() called with the middle of \
an allocated block; Try setting environment variable MallocHelp to \
see tools to help debug
</pre><p>You can debug this sort of problem by running your program within GDB and putting a breakpoint on <code>malloc_printf</code>, which is the routine used to print these messages.  Once you hit the breakpoint, you can use GDB's <code>backtrace</code> command to determine the immediate caller.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECMALLOCDEBUG"></A><H3>MallocDebug and ObjectAlloc</H3><p>Mac OS X includes two GUI applications for memory allocation debugging, MallocDebug and ObjectAlloc.  For more information about these tools, see the <A HREF="../../documentation/Performance/Conceptual/ManagingMemory/index.html">Memory Performance</A> document.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECGMALLOC"></A><H3>Guarded Memory Allocator</H3><p>Mac OS X includes a guarded memory allocator, <code>libgmalloc</code>, that you can use during debugging to catch common memory problems, such as buffer overruns and use-after-free.  <A HREF="#LISTGMALLOC">Listing 16</A> shows an example of how to enable it.</p><A NAME="LISTGMALLOC"></A><p class="smalltext"><strong>Listing 16:</strong> Enabling libgmalloc</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 6.1-20040303 (Apple version gdb-434) [&hellip;]
(gdb) set env DYLD_INSERT_LIBRARIES /usr/lib/libgmalloc.dylib
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
Allocations will be placed on word (4 byte) boundaries.
 - Small buffer overruns may not be noticed.
 - Applications using AltiVec instructions may fail.
GuardMalloc-11
Reading symbols for shared libraries [&hellip;]
</pre><p>You can learn more about <code>libgmalloc</code> from its <A HREF="x-man-page://3/libgmalloc">man page</A>.</p><div class="notebox"><p><strong>Note:</strong> In Mac OS X 10.3.x, <code>libgmalloc</code> required that you force a flat namespace (by setting the <code>DYLD_FORCE_FLAT_NAMESPACE</code> environment variable).  This is no longer necessary.</p><p>For information about how using <code>libgmalloc</code> on Mac OS X 10.3.x, see the <code>libgmalloc</code> man page on that system.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCPLUSPLUS"></A><H3>Standard C++ Library</H3><p>The standard C++ library supports a number of debugging features.</p><ul><li><p>Set the <code>_GLIBCXX_DEBUG</code> compile-time variable to enable debug mode in the standard C++ library.  See the <A HREF="../../documentation/DeveloperTools/gcc-3.3/libstdc%2B%2B/debug.html">standard C++ library</A> documentation for the details.</p></li><li><p>In versions prior to GCC 4.0, set the <code>GLIBCPP_FORCE_NEW</code> environment variable to 1 to disable memory caching in the standard C++ library.  This allows you to debug your C++ allocations with the other memory debugging tools (such as the <A HREF="#SECGMALLOC">Guarded Memory Allocator</A>).  See the <A HREF="../../documentation/DeveloperTools/gcc-3.3/libstdc%2B%2B/ext/howto.html">standard C++ library documentation</A> for the details.</p><p>In GCC 4.0 and later this is the default behavior.</p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECTOOLS"></A><H3>Command Line Tools</H3><p>Mac OS X includes a number of cool command line tools for debugging.  I've listed my favorite tools in <A HREF="#TABCOOLTOOLS">Table 2</A>.</p><A NAME="TABCOOLTOOLS"></A><p class="smalltext"><strong>Table 2:</strong> Command line tool highlights</p><table cellspacing="0" class="graybox"><tr><th>Tool</th><th>Documentation</th><th>Summary</th></tr><tr><td scope="row"><code>gdb</code></td><td><A HREF="x-man-page://1/gdb">manual page</A>,<p></p><A HREF="../../documentation/DeveloperTools/gdb/gdb/gdb_toc.html">Debugging with GDB</A></td><td>Command line debugger</td></tr><tr><td scope="row"><code>fs_usage</code></td><td><A HREF="x-man-page://1/fs_usage">manual page</A></td><td>File system trace tool</td></tr><tr><td scope="row"><code>sc_usage</code></td><td><A HREF="x-man-page://1/sc_usage">manual page</A></td><td>System call trace tool</td></tr><tr><td scope="row"><code>latency</code></td><td><A HREF="x-man-page://1/latency">manual page</A></td><td>Scheduling latency debugging tool</td></tr><tr><td scope="row"><code>ktrace</code>, <code>kdump</code></td><td><A HREF="x-man-page://1/ktrace">manual page</A></td><td>Kernel tracing</td></tr><tr><td scope="row"><code>heap</code></td><td><A HREF="x-man-page://1/heap">manual page</A></td><td>Heap dump</td></tr><tr><td scope="row"><code>vmmap</code></td><td><A HREF="x-man-page://1/vmmap">manual page</A></td><td>Address space dump</td></tr><tr><td scope="row"><code>malloc_history</code></td><td><A HREF="x-man-page://1/malloc_history">manual page</A></td><td>Memory allocation history</td></tr><tr><td scope="row"><code>leaks</code></td><td><A HREF="x-man-page://1/leaks">manual page</A></td><td>Leak detection</td></tr><tr><td scope="row"><code>tcpdump</code></td><td><A HREF="x-man-page://1/tcpdump">manual page</A>,<p></p><A HREF="../../qa/qa2001/qa1176.html">Technical Q&amp;A QA1176, 'Getting a Packet Trace'</A></td><td>Network packet trace</td></tr><tr><td scope="row"><code>netstat</code></td><td><A HREF="x-man-page://1/netstat">manual page</A></td><td>Network statistics; <code>netstat -an</code> shows all network connections</td></tr><tr><td scope="row"><code>lsof</code></td><td><A HREF="x-man-page://8/lsof">manual page</A></td><td>List open files</td></tr><tr><td scope="row"><code>PPCExplain</code></td><td>&nbsp;</td><td>PPC mnemonic explained</td></tr></table><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECDYLD"></A><H3>Dynamic Linker (dyld)</H3><p>The Mac OS X dynamic linker (dyld) supports a number of debugging facilities that you can enable via environment variables.  These are fully documented in the <A HREF="x-man-page://1/dyld">manual page</A>.  <A HREF="#TABDYLDENV">Table 3</A> lists some of the more useful variables.</p><A NAME="TABDYLDENV"></A><p class="smalltext"><strong>Table 3:</strong> Dynamic linker environment variables</p><table cellspacing="0" class="graybox"><tr><th>Variable</th><th>Summary</th></tr><tr><td scope="row"><code>DYLD_IMAGE_SUFFIX</code></td><td>Search for libraries with this suffix first</td></tr><tr><td scope="row"><code>DYLD_PRINT_LIBRARIES</code></td><td>Log library loads</td></tr><tr><td scope="row"><code>DYLD_PRINT_LIBRARIES_POST_LAUNCH</code></td><td>As above, but only after <code>main</code> has run</td></tr><tr><td scope="row"><code>DYLD_PREBIND_DEBUG</code></td><td>Print prebinding diagnostics</td></tr><tr><td scope="row"><code>DYLD_PRINT_OPTS</code> (10.4 and later)</td><td>Print launch-time command line arguments</td></tr><tr><td scope="row"><code>DYLD_PRINT_ENV</code> (10.4 and later)</td><td>Print launch-time environment variables</td></tr><tr><td scope="row"><code>DYLD_IGNORE_PREBINDING</code> (10.4 and later)</td><td>Disable prebinding for performance testing</td></tr><tr><td scope="row"><code>DYLD_PRINT_APIS</code> (10.4 and later)</td><td>Log dyld API calls (for example, <A HREF="x-man-page://3/dlopen">dlopen</A>)</td></tr><tr><td scope="row"><code>DYLD_PRINT_BINDINGS</code> (10.4 and later)</td><td>Log symbol bindings</td></tr><tr><td scope="row"><code>DYLD_PRINT_INITIALIZERS</code> (10.4 and later)</td><td>Log image initialization calls</td></tr><tr><td scope="row"><code>DYLD_PRINT_SEGMENTS</code> (10.4 and later)</td><td>Log segment mapping</td></tr><tr><td scope="row"><code>DYLD_PRINT_STATISTICS</code> (10.4 and later)</td><td>Print launch performance statistics</td></tr></table><p>Of these, <code>DYLD_IMAGE_SUFFIX</code> is the most useful because you can use it to enable the system's debug libraries, as described in <A HREF="#SECDEBUGLIB">Debug Libraries</A>.</p><p>If you're loading code dynamically and the code fails to load, you can use the dynamic linker routine <code>NSLinkEditError</code> to get information about what went wrong error.  See the <A HREF="x-man-page://3/NSModule">NSModule</A> documentation for more information about this.  <code>NSLinkEditError</code> works even if you're using a high-level API, like CFBundle, to load the code.</p><p>Additionally, if you're loading code using <A HREF="x-man-page://3/dlopen">dlopen</A>, you can similar information using <A HREF="x-man-page://3/dlerror">dlerror</A>.</p><A NAME="SECDEBUGLIB"></A><H4>Debug Libraries</H4><p>Many Mac OS X frameworks include both a production and a debug variant.  The debug variant has the suffix &quot;_debug&quot;.  For example, the Core Foundation framework's production variant is <code>/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation</code> while its debug variant is <code>/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation_debug</code>.  You can force dyld to load the debug variant of a library (if such a variant exists) by setting the <code>DYLD_IMAGE_SUFFIX</code> environment variable to &quot;_debug&quot;.  <A HREF="#LISTDYLDSUFFIX">Listing 17</A> shows an example of how to do this from within Terminal.</p><A NAME="LISTDYLDSUFFIX"></A><p class="smalltext"><strong>Listing 17:</strong> Using _debug libraries</p><pre class="sourcecodebox">
$ DYLD_IMAGE_SUFFIX=_debug /Applications/TextEdit.app/Contents/MacOS/TextEdit
2004-08-30 18:32:06.051 TextEdit[1393] CFLog (0): Assertions enabled
[&hellip;]
</pre><p>If Terminal doesn't float your boat, you can do the same using the executable inspector in Xcode.  In <A HREF="#FIGXCODEDEBUGLIB">Figure 2</A>, you can see that the &quot;Use &hellip; suffix when loading frameworks&quot; popup has been set to &quot;debug&quot;.</p><A NAME="FIGXCODEDEBUGLIB"></A><p class="caption"><strong>Figure 2:</strong> Enabling debug libraries in Xcode</p><p><img  src="images/tn2124_XcodeDebugLib.png" width="494" height="527" alt="Figure 2, Enabling debug libraries in Xcode"></p><p>The exact behavior of the debug library varies from framework to framework.  Most debug libraries include:</p><ul><li><p>full debug symbols &mdash; This is particularly useful if the source for the framework is included in <A HREF="../../darwin/">Darwin</A>.</p></li><li><p>extra assertions &mdash; These can help pinpoint programming errors on your part.</p></li><li><p>extra debugging facilities &mdash; A number of the debugging facilities described later in this document are only available in the debug library.</p></li></ul><p>I strongly recommend that you use the debug libraries as part of your day-to-day debugging process.</p><div class="notebox"><p><strong>Note:</strong> Unless otherwise stated, the debugging facilities in this technote do not require you to use the debug libraries.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECJUSTONELIB"></A><H4>Enabling Just One Debug Library</H4><p>In some circumstances you might want to enable just one debug library.  For example, let's say you're debugging an Apple event problem, so you want to enabled the &quot;_debug&quot; variant of the AE framework.  However, when you set <code>DYLD_IMAGE_SUFFIX</code> to &quot;_debug&quot;, you discover that using all the debug libraries causes a problem elsewhere in your application.  At this time you just want to focus on debugging the Apple event problem.  What do you do?</p><p>Fortunately there's a simple, albeit somewhat unsubtle, answer: just copy the debug variant over the non-debug variant.  <A HREF="#LISTDYLDRENAME">Listing 18</A> shows an example of this.</p><A NAME="LISTDYLDRENAME"></A><p class="smalltext"><strong>Listing 18:</strong> Activating just the AE debug library</p><pre class="sourcecodebox">
$ cd /System/Library/Frameworks/ApplicationServices.framework/\
Frameworks/AE.framework/Versions/A/
$ sudo cp -n AE AE_original
Password: ********
$ sudo cp AE_debug AE
</pre><p>Once you've done this, you should restart to activate your change.</p><div class="notebox"><p><strong>IMPORTANT:</strong> This technique is useful for debugging but it has a number of negative effects.  For example, the debug library is prebound at a different address from the non-debug library, so prebound programs won't be able to launch prebound, and thus will launch slower.  Therefore, I recommend that you do this only on a dedicated test computer or, if that's not practical, on your main computer while booted from a test system.  Moreover, you should revert to the original library as soon as you've finished debugging.</p></div><p>To revert back to the non-debug library, you can just copy the original library back, as shown in <A HREF="#LISTDYLDUNRENAME">Listing 19</A>.</p><A NAME="LISTDYLDUNRENAME"></A><p class="smalltext"><strong>Listing 19:</strong> Deactivating the AE debug library</p><pre class="sourcecodebox">
$ sudo cp AE_original AE
Password: ********
</pre><div class="notebox"><p><strong>Note:</strong> The reason why I recommend copying the libraries rather than renaming them is that it makes it harder to accidentally overwrite your last copy of a library.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="DEBUG"></A><H4>Debug Library Versioning</H4><p>The debug libraries are installed by the Xcode installer, not by the system installer. The debug libraries are not updated when you update your system software. This makes it very common for your debug libraries to be out of sync with your production libraries (typically the debug libraries are older). This can cause some unexpected incompatibilities.</p><p>For example, if you install Mac OS X 10.4, then install Xcode 2.0, then update your system to Mac OS X 10.4.3, you'll find that you can no longer launch an application with the debug libraries enabled.  This is because, in Mac OS X 10.4.3, Apple added a new routine to the CoreServices framework, and updated the DesktopServicesPriv framework to use that routine.  However, one of these frameworks (CoreServices) has a debug variant and the other (DesktopServicesPriv) does not.  Thus, if you enable debug libraries, you get the debug variant of CoreServices (installed by Xcode 2.0, and thus equivalent to version 10.4) and the production variant of DesktopServicesPriv (software updated to version 10.4.3), and this combination fails to load.</p><p>This problem has always existed on Mac OS X, and Apple is considering how to resolve it <A HREF="rdar://problem/4379270">(r. 4379270)</A>. In the meantime, the most reliable way to use the debug libraries is to set up a dedicated debug partition.  On this partition you should first clean install the desired major OS release, and then install the developer tools associated with that release.  For example, clean install Mac OS X 10.4, and then install Xcode 2.0.  Then disable software updates for that partition.  This ensures that your production and debug libraries start out in sync, and stay in synch.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECPROFILELIBRARIES"></A><H4>Profile Libraries</H4><p>Many libraries also support a profiling variant which has the suffix &quot;_profile&quot;. The profile libraries have many of the same limitations as the debug libraries.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECNOWINDOWSERVER"></A><H3>Escaping the Window Server</H3><p>Under some circumstances it can be helpful to operate without the window server.  For example, if you need to modify the parameters to <code>loginwindow</code> specified in <code>/etc/ttys</code>, it's nice to be able to do it while <code>loginwindow</code> is not running.  Mac OS X provides a convenient way to do this.</p><ol><li><p>In the Accounts panel of System Preferences, click on Login Options. If the text is greyed out, you must first unlock the panel by clicking the lock icon.</p></li><li><p>Change the &quot;Display login window as&quot; setting to &quot;Name and password&quot;.</p></li><li><p>Log out.</p></li><li><p>At the login window, enter &quot;&gt;console&quot; as your user name; <code>loginwindow</code> will quit and you'll be faced with a glass TTY interface displaying the &quot;Login&quot; prompt.</p></li><li><p>Log in using your standard user name and password.</p></li></ol><p>When you're done working at this level, just exit from your shell (using the <code>exit</code> command) and you will return to the standard login window.</p><div class="notebox"><p><strong>IMPORTANT:</strong> This environment is <strong>not</strong> single user mode. Most system daemons are still running; only the GUI components of the system are shut down.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECDAEMONS"></A><H2>Daemons</H2><p>Most system daemons include some sort of debugging facility.  In many cases a daemon's debugging features are described in its man page.  This section describes some of the particularly interesting ones.</p><A NAME="SECLAUNCHD"></A><H3>launchd</H3><p><A HREF="x-man-page://8/launchd">launchd</A> is the first process run by the kernel (Mac OS X 10.4 and later); it is responsible for launching all other processes on the system.  <code>launchd</code> has a number of useful debugging facilities, each described in a subsequent section.</p><A NAME="SECLAUNCHCTL"></A><H4>launchctl</H4><p>You can modify the state of <code>launchd</code> using the <A HREF="x-man-page://1/launchctl">launchctl</A> command.  <code>launchctl</code> supports a number of sub-commands; <A HREF="#TABLAUNCHCTLCOMMANDS">Table 4</A> lists the ones that are most relevant to debugging.</p><A NAME="TABLAUNCHCTLCOMMANDS"></A><p class="smalltext"><strong>Table 4:</strong> Useful launchctl commands</p><table cellspacing="0" class="graybox"><tr><th>Command</th><th>Summary</th></tr><tr><td scope="row"><code>log</code></td><td>Modifies the log level of <code>launchd</code> itself; the syntax of this command is a little tricky; the most useful command is <code>log level debug</code>, which enables all logging; see <A HREF="#SECLAUNCHDLOGGING">launchd Logging</A> for information about how to see this output</td></tr><tr><td scope="row"><code>stdout</code></td><td>Sets the standard output of <code>launchd</code>; this value will be inherited by any process <code>launchd</code> executes</td></tr><tr><td scope="row"><code>stderr</code></td><td>Sets the standard error of <code>launchd</code>; this value will be inherited by any process <code>launchd</code> executes</td></tr><tr><td scope="row"><code>limit</code></td><td>Sets the resource limits of <code>launchd</code>; this value will be inherited by any process <code>launchd</code> executes; the most common usage is <code>limit core unlimited</code>, which enables <A HREF="#SECCOREDUMPS">core dumps</A></td></tr></table><div class="notebox"><p><strong>Note:</strong> The ability to control <code>stdout</code> and <code>stderr</code> is less useful than you might think.  Most program either override <code>stdout</code> and <code>stderr</code> (for example, in GUI programs they point to <code>/dev/console</code>) or don't write anything to them (for example, most daemons log using <A HREF="#SECSEEINGOUTPUT">syslog</A>).</p></div><p>You can make a temporary change by running <code>launchctl</code> with one of these commands as an argument.  This will affect <code>launchd</code> itself, and any process that <code>launchd</code> executes from then on.</p><div class="notebox"><p><strong>IMPORTANT:</strong> To affect the state of the global instance of <code>launchd</code>, you must run <code>launchctl</code> as root (typically using <code>sudo</code>).  If you run <code>launchctl</code> without using <code>sudo</code>, the change affects your per-user instance of <code>launchd</code>.</p></div><p>You can make a persistent change by adding the command to <A HREF="x-man-page://5/launchd.conf">/etc/launchd.conf</A>.  <code>launchd</code> adopts these settings early in the boot process, and so, upon restart, they affect every process on the system.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECLAUNCHDLOGGING"></A><H4>launchd Logging</H4><p><code>launchd</code> logs its actions to the system log under the facility name of &quot;launchd&quot;.  To send all <code>launchd</code> logging output to a file, add the line &quot;launchd.* /var/log/launchd.log&quot; to <code>/etc/syslog.conf</code>.  <A HREF="#LISTLAUNCHDOUTPUT">Listing 20</A> shows one way to do this.</p><A NAME="LISTLAUNCHDOUTPUT"></A><p class="smalltext"><strong>Listing 20:</strong> Logging launchd actions to a file</p><pre class="sourcecodebox">
$ sudo cp /etc/syslog.conf /etc/syslog.conf-orig
Password: ********
$ ( cat /etc/syslog.conf-orig ; echo &quot;launchd.* /var/log/launchd.log&quot; ) | \
sudo cp /dev/stdin /etc/syslog.conf
$ sudo kill -HUP `cat /var/run/syslog.pid`
</pre><p>The <code>/var/log/launchd.log</code> file will typically remain empty because, by default, <code>launchd</code> doesn't generate a lot of syslog output.  You can use <code>launchctl</code> to increase the amount of logging, as shown in <A HREF="#LISTMORELAUNCHDLOGGING">Listing 21</A>.</p><A NAME="LISTMORELAUNCHDLOGGING"></A><p class="smalltext"><strong>Listing 21:</strong> Getting more launchd logging</p><pre class="sourcecodebox">
$ sudo launchctl log level debug
Password: ********
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECLAUNCHDJOBS"></A><H4>Debugging a Particular Job</H4><p>Finally, <code>launchd</code> lets you debug a specific job by modifying properties in its <A HREF="x-man-page://5/launchd.plist">property list file</A>.  <A HREF="#TABLAUNCHDPLISTDEBUG">Table 5</A> lists the properties that are most useful for debugging.</p><A NAME="TABLAUNCHDPLISTDEBUG"></A><p class="smalltext"><strong>Table 5:</strong> Properties useful for debugging</p><table cellspacing="0" class="graybox"><tr><th>Property</th><th>Summary</th></tr><tr><td scope="row"><code>Debug</code></td><td>Enables logging within <code>launchd</code> while it's dealing with this job</td></tr><tr><td scope="row"><code>StandardOutPath</code></td><td>Sets the job's standard output destination</td></tr><tr><td scope="row"><code>StandardErrorPath</code></td><td>Sets the job's standard error destination</td></tr><tr><td scope="row"><code>EnvironmentVariables</code></td><td>Sets environment variables for the job</td></tr><tr><td scope="row"><code>SoftResourceLimits</code>, <code>HardResourceLimits</code></td><td>Sets resource limits for the job; most useful to enable core dumps for just one job</td></tr></table><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECLOOKUPD"></A><H3>lookupd</H3><p>If you're experiencing problems with <code>lookupd</code> (for example, DNS requests are taking a long time), you can enable <code>lookupd</code> debugging with the following steps.</p><ol><li><p>Create the <code>Debug</code> and <code>Trace</code> properties in the local machine's <code>/config/lookupd</code> NetInfo directory.</p></li><li><p>Change the <A HREF="x-man-page://5/syslog.conf">syslog configuration</A> so that NetInfo debugging information (<code>netinfo.debug</code>) is sent to the NetInfo log file (<code>/var/log/netinfo.log</code>).</p></li><li><p>Send a <code>SIGHUP</code> to <code>syslogd</code> to get it to recognize the previous change.</p></li><li><p>Send a <code>SIGHUP</code> to <code>lookupd</code> to get it to recognize the change from step 1.</p></li></ol><p><A HREF="#LISTLOOKUPDDEBUGENABLE">Listing 22</A> shows an example of this.  Once you've done these steps, you can look in <code>/var/log/netinfo.log</code> for the debugging output.  You can also execute <code>lookupd -statistics</code> get statistics from <code>lookupd</code>.</p><A NAME="LISTLOOKUPDDEBUGENABLE"></A><p class="smalltext"><strong>Listing 22:</strong> Enabling lookupd debugging</p><pre class="sourcecodebox">
$ sudo dscl . create /dsRecTypeStandard:Config/lookupd Debug YES
Password: ********
$ sudo dscl . create /dsRecTypeStandard:Config/lookupd Trace YES
$ sudo cp /etc/syslog.conf /etc/syslog.conf-orig
$ sed 's/netinfo.err/netinfo.debug/' /etc/syslog.conf-orig | \
sudo cp /dev/stdin /etc/syslog.conf
$ sudo kill -HUP `cat /var/run/syslog.pid`
$ sudo kill -HUP `cat /var/run/lookupd.pid`
</pre><p><A HREF="#LISTLOOKUPDDEBUGDISABLE">Listing 23</A> shows how to undo these changes.</p><A NAME="LISTLOOKUPDDEBUGDISABLE"></A><p class="smalltext"><strong>Listing 23:</strong> Disabling lookupd debugging</p><pre class="sourcecodebox">
$ sudo dscl . delete /dsRecTypeStandard:Config/lookupd
$ sudo mv /etc/syslog.conf-orig /etc/syslog.conf
$ sudo kill -HUP `cat /var/run/syslog.pid`
$ sudo kill -HUP `cat /var/run/lookupd.pid`
</pre><p>For more information about <code>lookupd</code>, see its <A HREF="x-man-page://8/lookupd">man page</A>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECPRINTING"></A><H3>Printing (CUPS)</H3><p>Mac OS X 10.2 and later uses CUPS (Common UNIX Printing System) as its core printing architecture.  CUPS has a built-in debug logging feature, controlled by the CUPS configuration file (<code>/etc/cups/cupsd.conf</code>).  Within this file the <code>LogLevel</code> directive controls the level of logging, while the <code>ErrorLog</code> directive controls the log destination (the default is <code>/var/log/cups/error_log</code>).  For more information about this file, see the <A HREF="x-man-page://5/cupsd.conf">man page</A>.</p><div class="notebox"><p><strong>IMPORTANT:</strong> After changing this file you must send a <code>SIGHUP</code> to the CUPS daemon for you changes to take effect.  <A HREF="#LISTCUPSRESTART">Listing 24</A> shows one way to do this.</p><A NAME="LISTCUPSRESTART"></A><p class="smalltext"><strong>Listing 24:</strong> Restarting the CUPS daemon</p><pre class="sourcecodebox">
sudo /System/Library/StartupItems/PrintingServices/PrintingServices restart
</pre></div><p>If you're writing a CUPS driver or filter, you can add entries to this log by printing them to <code>stderr</code>.  You must start each line with the logging level of the message, as illustrated by <A HREF="#LISTCUPSLOGGING">Listing 25</A>.</p><A NAME="LISTCUPSLOGGING"></A><p class="smalltext"><strong>Listing 25:</strong> Logging to CUPS</p><pre class="sourcecodebox">
// Debug message

fprintf(stderr, &quot;DEBUG: page_width = %.0f\n&quot;, page_width);

// Warning message

fprintf(stderr, &quot;WARNING: Printer not responding\n&quot;);

// Error message

fprintf(stderr, &quot;ERROR: Lost connection with printer\n&quot;);
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCORESERVICES"></A><H2>Core Services</H2><p>Core Services includes a number of routines (for example, <code>Debugger</code>, <code>DebugStr</code>, and <code>SysBreak</code>) that enter the debugger with a message. If you set the <code>USERBREAK</code> environment variable to 1, these routines will send a <code>SIGINT</code> signal to the current process, which causes you to break into GDB.  Xcode has GUI to enabled this facility (the &quot;Break on Debugger() and DebugStr()&quot; checkbox in the Debugging panel of the executable inspector, as shown in <A HREF="#FIGXCODEDEBUGSTR">Figure 3</A>).</p><A NAME="FIGXCODEDEBUGSTR"></A><p class="caption"><strong>Figure 3:</strong> Setting USERBREAK in Xcode</p><p><img  src="images/tn2124_XcodeDebugStr.png" width="494" height="527" alt="Figure 3, Setting USERBREAK in Xcode"></p><A NAME="SECCFM"></A><H3>Code Fragment Manager (CFM)</H3><p>The CFM compatibility environment on Mac OS X supports two helpful environment variables, <code>CFMDebugBasic</code> and <code>CFMDebugFull</code>, which you can set to 1 to get limited and verbose debug logging, respectively.  This facility is particularly useful for tracking down CFM closure problems, and problems where fragment initialization routines fail.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCF"></A><H3>Core Foundation</H3><p>All variants of the Core Foundation (CF) framework support the <code>CFShow</code> routine, which prints a description of any CF object to <code>stderr</code>.  You can make this call from your own code, however, it's particularly useful when <A HREF="#SECCALLFUNC">called from GDB</A>.  <A HREF="#LISTCALLCFSHOW">Listing 26</A> shows an example of this.</p><A NAME="LISTCALLCFSHOW"></A><p class="smalltext"><strong>Listing 26:</strong> Calling CFShow from GDB</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 5.3-20030128 (Apple version gdb-330.1) [&hellip;]
(gdb) fb CFRunLoopAddSource
No symbol table is loaded.  Use the &quot;file&quot; command.
Breakpoint 1 at 0x0
(gdb) r
[&hellip;]
Breakpoint 1, 0x901b5764 in CFRunLoopAddSource ()
(gdb) call (void) CFShow($r3)
&lt;CFRunLoop 0x116290 [0xa01900e0]&gt;{
    locked = false,
    wait port = 0xf03,
    stopped = false,
    current mode = (none),
    common modes = &lt;CFSet 0x1162c0 [0xa01900e0]&gt;{
        count = 1,
        capacity = 4,
        values = (
            1 : &lt;CFString 0xa0195b38 [0xa01900e0]&gt;{
                contents = &quot;kCFRunLoopDefaultMode&quot;
            }
        )
    },
    common mode items = (null),
    modes = &lt;CFSet 0x116310 [0xa01900e0]&gt;{
        count = 1,
        capacity = 17,
        values = (
            20 : &lt;CFRunLoopMode 0x1163a0 [0xa01900e0]&gt;{
                name = kCFRunLoopDefaultMode,
                locked = false,
                port set = 0x1003,
                sources = (null),
                observers == (null),
                timers = (null)
            },
        )
    }
}
</pre><div class="notebox"><p><strong>IMPORTANT:</strong> If you don't see any output from <code>CFShow</code>, it was probably sent to the console. See <A HREF="#SECSEEINGOUTPUT">Seeing Debug Output</A> for information about how to view this output.</p></div><div class="notebox"><p><strong>Note:</strong> In <A HREF="#LISTCALLCFSHOW">Listing 26</A> I've reformatted the output from <code>CFShow</code> to make it easier to read.</p></div><p>There are a number of other CF routines that you might find useful to call from GDB, including <code>CFGetRetainCount</code>, <code>CFBundleGetMainBundle</code>, and <code>CFRunLoopGetCurrent</code>.</p><p>The Core Foundation framework also has a debug variant that offers extensive debugging assistance.  For example, the non-debug variant of Core Foundation does not check the validity of parameters that you pass to its routines, whereas the debug variant includes full parameter checking.  This can help you track down numerous Core Foundation-related bugs in your code.</p><p>The Core Foundation debug library supports an environment variable called <code>CFZombieLevel</code>.  It interprets this variable as an integer containing a set of flag bits.  <A HREF="#TABCFZOMBIELEVEL">Table 6</A> describes the bits that are currently defined. These can help you track down various CF memory management issues.</p><A NAME="TABCFZOMBIELEVEL"></A><p class="smalltext"><strong>Table 6:</strong> Bit definitions for CFZombieLevel environment variable</p><table cellspacing="0" class="graybox"><tr><th>Bit</th><th>Action</th></tr><tr><td scope="row">0</td><td>scribble deallocated CF memory</td></tr><tr><td scope="row">1</td><td>when scribbling deallocated CF memory, don't scribble object header (<code>CFRuntimeBase</code>)</td></tr><tr><td scope="row">4</td><td>never free memory used to hold CF objects</td></tr><tr><td scope="row">7</td><td>if set, scribble deallocations using bits 8..15, otherwise use 0xFC</td></tr><tr><td scope="row">8..15</td><td>if bit 7 is set, scribble deallocations using this value</td></tr><tr><td scope="row">16</td><td>scribble allocated CF memory</td></tr><tr><td scope="row">23</td><td>if set, scribble allocations using bits 24..31, otherwise use 0xCF</td></tr><tr><td scope="row">24..31</td><td>if bit 16 is set, scribble allocations using this value</td></tr></table><div class="notebox"><p><strong>WARNING:</strong> <code>CFZombieLevel</code> is not currently compatible with custom allocators (created using <code>CFAllocatorCreate</code>) <A HREF="rdar://problem/4158401">(r. 4158401)</A>. If you attempt this combination, your program will crash the first time you deallocate an object with a custom deallocator.</p></div><A NAME="SECCFNOTIFICATION"></A><H4>CFNotificationCenter</H4><p>You can enable CFNotificationCenter logging by creating the file <code>/var/log/do_dnserver_log</code>.  If this file exists and is owned by root, the CFNotificationCenter daemon (<A HREF="x-man-page://8/distnoted">distnoted</A>) will log its activity to <code>/var/log/dnserver.log</code>.  This change takes effect when you relaunch <code>distnoted</code>; the safest way to do this is to restart.</p><p>You can see an example of this in <A HREF="#SECFILES">Files</A>.</p><div class="notebox"><p><strong>Note:</strong> On Mac OS X 10.3.x, the corresponding files were <code>/var/tmp/do_dnserver_log</code> and <code>/var/tmp/dnserver.log</code>.</p><p>Also, Mac OS X 10.3.x supported client-side logging.  If you create the file <code>/var/tmp/do_xnc_log</code>, CFNotificationCenter will log each client's activity in its own file (<code>/var/tmp/xnc_logs/&lt;progname&gt;</code>).  This setting takes effect when you relaunch the program.  Client-side logging is not available in Mac OS X 10.4 and later.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCOMPONENT"></A><H3>Component Manager</H3><p>Component Manager exports a routine, <code>GDBComponentList</code>, that you can call from GDB to print the database of registered components and their instances.  <A HREF="#LISTCALLFUNC">Listing 8</A> gives an example of its use.</p><p>In addition, if you set the <code>ComponentDebug</code> environment variable to 1, Component Manager will print of variety of debug messages.  These may be helpful if something is going wrong with your component, in particular if it fails to load.</p><p>Finally, if a component fails to load, you can use dynamic linker facilities to debug the problem.  See <A HREF="#SECDYLD">Dynamic Linker (dyld)</A> for details.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCSFM"></A><H3>File Manager</H3><p>Core Services File Manager (commonly known as the Carbon File Manager, or just File Manager) is nicely integrated with the <code>fs_usage</code> command line tool.  If you enable the Core Services debug library, <code>fs_usage</code> will not only show primitive BSD file system calls but also the File Manager calls that prompted them.  See the <code>fs_usage</code> <A HREF="x-man-page://1/fs_usage">man page</A> for more details.</p><p>If you set the <code>FilesASDDebug</code> environment variable to 1, File Manager will log its dealings with AppleDouble files on file systems that do not have native support for resource forks and Macintosh metadata.</p><p>If you set the <code>VNDebug</code> environment variable to 1, File Manager will log its interaction with <A HREF="#SECDISKARB">Disk Arbitration</A>.</p><p>File Manager has a number of useful GDB-callable routines.  The most useful, <code>PrintVolumeInfo</code>, prints the volume list.  It takes one parameter that specifies whether to use the File Manager API to enumerate the volumes (1) or to walk an internal data structure (0).  The former results in a nice summary while the latter yields more detailed information.  <A HREF="#LISTPRINTVOLUME">Listing 27</A> shows an example of each.</p><A NAME="LISTPRINTVOLUME"></A><p class="smalltext"><strong>Listing 27:</strong> PrintVolumeInfo in action</p><pre class="sourcecodebox">
(gdb) call (void) PrintVolumeInfo(1)
1:vol=-100      &quot;X2&quot;
2:vol=-101      &quot;X1&quot;
3:vol=-102      &quot;Guy Smiley&quot;
4:vol=-130      &quot;UFS Victim&quot;
5:vol=-105      &quot;Network&quot;
6:returned error -35
(gdb) call (void) PrintVolumeInfo(0)
Volume Information:
        &quot;X2&quot;    mountpoint: &quot;/&quot;
                vRef=-100  volID=-100 diskID=disk0s10
        &quot;X1&quot;    mountpoint: &quot;/Volumes/X1&quot;
                vRef=-101  volID=-101 diskID=disk0s9
        &quot;Guy Smiley&quot;    mountpoint: &quot;/Volumes/Guy Smiley&quot;
                vRef=-102  volID=-102 diskID=disk0s11
        &quot;UFS Victim&quot;    mountpoint: &quot;/Volumes/UFS Victim&quot;
                vRef=-130  volID=-130 diskID=disk3s2
        &quot;Network&quot;       mountpoint: &quot;/Network&quot;
                vRef=-105  volID=-105 diskID=/Network
</pre><p>There are two other GDB-callable routines that are primarily of interest to folks developing VFS plug-ins on Mac OS X.  They allow you to print the directory enumeration cache and the file ID tree, both of which are compatibility structures maintained by the File Manager for non-volfs volumes (see <A HREF="../../qa/qa2001/qa1113.html">Technical Q&amp;A QA1113, 'The &quot;/.vol&quot; directory and &quot;volfs&quot;'</A> for information about volfs).</p><p><code>PrintEnumerationCache</code> prints the directory enumeration cache on the volume.  It takes a single parameter, which is the <code>vRefNum</code> of the volume of interest.</p><p>The file ID tree is maintained centrally by <code>coreservicesd</code>.  To print it, you must first attach to <code>coreservicesd</code> with GDB, then redirect <code>coreservicesd</code>'s <code>stderr</code> to your terminal device (as described in <A HREF="../tn/tn2030.html">Technical Note TN2030, 'GDB for MacsBug Veterans'</A>), then call the routine <code>FileIDTreeStorageServerDump</code> with a single string parameter of &quot;fsnode_all&quot;.  The result is a <code>CFString</code> full of deeply cryptic information.  <A HREF="#LISTFILEIDTREE">Listing 28</A> shows an example of this.</p><A NAME="LISTFILEIDTREE"></A><p class="smalltext"><strong>Listing 28:</strong> Print the file ID tree</p><pre class="sourcecodebox">
$ sudo gdb
Password:********
GNU gdb 6.1-20040303 (Apple version gdb-425) [&hellip;]
(gdb) call (int) close(2)
$1 = 0
(gdb) shell tty
/dev/ttyp2
(gdb) call (int) open(&quot;/dev/ttyp2&quot;, 2)
$2 = 2
(gdb) call (void *) FileIDTreeStorageServerDump(&quot;fsnode_all&quot;)
$3 = (void *) 0x316320
(gdb) call (void) CFShow($3)
Shared universes:
        501(3): mod seed = 2
        Shared segments ([domainID][segmentID](&lt;unused entries&gt;):&lt;address&gt;
                [0][0](32/480):0x200e00
                [1][0](496/16):0x300e00
                [2][0](504/8):0x504b00
        Entries scheduled for removal:
                69000000(108)@1: FSObjectVolumeEntry: vRefNum: -105
        0(5): mod seed = 2
        Shared segments ([domainID][segmentID](&lt;unused entries&gt;):&lt;address&gt;
                [0][0](32/480):0x400c00
                [1][0](496/16):0x500c00
                [2][0](504/8):0x300800
        Entries scheduled for removal:
                69000000(108)@1: FSObjectVolumeEntry: vRefNum: -105
checked-in processes:
        204(0/0x7000040): seed 2(0), idle
        211(0/0x6000040): seed 2(0), idle
        248(501/0x7000040): seed 2(0), idle
        114(501/0x6000040): seed 1(0), idle
        120(501/0x5000040): seed 2(0), idle
        183(0/0x5000040): seed 1(0), idle
No transactions in progress
</pre><div class="notebox"><p><strong>Note:</strong> In Mac OS X 10.3.x, the file ID tree was maintained independently by each process.  On that system, you can just call <code>PrintFileIDTree</code> directly.  It takes a single <code>vRefNum</code> parameter and prints this process's mapping from file IDs to file paths on that volume.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECFOLDERS"></A><H3>Folder Manager</H3><p>The Folder Manager supports a single environment variable, <code>FolderDebug</code>.  If you set this to 1, the Folder Manager will print a number of extra debugging messages.  This facility requires the Core Services debug library.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECGESTALT"></A><H3>Gestalt</H3><p>Core Services exports a three routines&mdash;<code>DebugDumpGestalt</code>, <code>DebugGestalt</code>, and <code>DebugGestaltStr</code>&mdash;that you can call from GDB to view the Gestalt registry.  <A HREF="#LISTGESTALT">Listing 29</A> shows an example of their use.</p><A NAME="LISTGESTALT"></A><p class="smalltext"><strong>Listing 29:</strong> Using the Gestalt debug routines</p><pre class="sourcecodebox">
(gdb) call (void) DebugDumpGestalt()
DebugDumpGestalt
'a/ux': 0x2a65c6ac (proc)
'addr': 0x00000007
[&hellip;]
(gdb) call (void) DebugGestalt(0x766d2020)
'vm  ': 0x00000011
(gdb) call (void) DebugGestaltStr(&quot;vm  &quot;)
'vm  ': 0x00000011
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECTHREADING"></A><H3>Threading</H3><p>The Core Services threading APIs (MP threads and Thread Manager) support an environment variable, <code>ThreadDebug</code>, that enables a few debug messages and a number of internal consistency checks.  This facility requires the Core Services debug library.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECWEBSERVICES"></A><H3>Web Services</H3><p>Web Services supports two helpful environment variables, <code>WSDebug</code> and <code>WSDebugVerbose</code>, which you can set to 1 to get limited and verbose debug logging, respectively.  These variables are effective in the non-debug library, but include even more logging in the debug library.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECDISKS"></A><H2>Disks and Discs</H2><A NAME="SECDISKARB"></A><H3>Disk Arbitration</H3><p>If you append a &quot;-d&quot; to the <code>Command</code> property in <code>/etc/mach_init.d/diskarbitrationd.plist</code> and then restart, Disk Arbitration will log detailed information about its activities to <code>/var/log/diskarbitrationd.log</code>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECDISCRECORDING"></A><H3>Disc Recording</H3><p>If you set the <code>DRVerboseLogging</code> environment variable to 1, Disc Recording will log information to the console.</p><div class="notebox"><p><strong>IMPORTANT:</strong> Due to a bug <A HREF="rdar://problem/4413303">(r. 4413303)</A>, this facility does not work on Mac OS X 10.4.x.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECDISKUTILITY"></A><H3>Disk Utility</H3><p>If you set the <code>DUDebugMenuEnabled</code> preference to 1, Disk Utility will display a Debug menu with a number of helpful commands.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECAPPLICATIONSERVICES"></A><H2>ApplicationServices</H2><A NAME="SECAE"></A><H3>Apple Events</H3><p>The Apple Event Manager has extensive built-in debugging support.  The best way to learn about this support is use GDB to call the <code>GDBPrintHelpDebuggingAppleEvents</code> routine, as shown in <A HREF="#LISTAEDEBUGHELP">Listing 30</A>.</p><A NAME="LISTAEDEBUGHELP"></A><p class="smalltext"><strong>Listing 30:</strong> Apple Event Manager debugging help</p><pre class="sourcecodebox">
(gdb) call (void) GDBPrintHelpDebuggingAppleEvents()
The AppleEvent Manager has been completely rewritten for this
version of Mac OS X.  The internal structure of an AEDesc is
now a pointer to a sparse tree.  If you're having problems
it could be because you're accessing the dataHandle of an
AEDesc directly.

Also of note is that AEGetDescData and AEGetDescDataSize only
work with value descriptors created by AECreateDesc - you cannot
get the data size of an AERecord or AEList, for example.

To print the contents of an AppleEvent from GDB, you can:
  (gdb) call (void) GDBPrintAEDesc(descPtr)

To view all currently installed AppleEvent coercion handlers:
  (gdb) call (void) GDBPrintAECoercionTables()

To view all contents install AppleEvent handlers:
  (gdb) call (void) GDBPrintAEHandlerTables()

Additionally, to log information about AppleEvent manager calls,
you can set environment variables that will produce debugging output
to the console:

  % setenv AEDebug         1            # general debug output
  % setenv AEDebugSends    1            # print sent events
  % setenv AEDebugReceives 1            # print received events and replies
  % setenv AEDebugVerbose  1            # print result information on (most) \
                                          calls (very verbose)
  % setenv AEDebugOSL      1            # print result information from OSL
  % setenv AEDebugFile     /tmp/logfile # send debug output to this file
</pre><div class="notebox"><p><strong>Note:</strong> In the above text, &quot;this version of Mac OS X&quot; refers to Mac OS X 10.2.</p></div><p>Some environment variables&mdash;specifically <code>AEDebug</code>, <code>AEDebugVerbose</code>, <code>AEDebugOSL</code>, and <code>AEDebugFile</code>&mdash;are only supported by the debug library.</p><p>If you are using the debug library, you can also control Apple event debugging by creating three files in <code>/var/tmp</code>.</p><ul><li><p>Creating the file <code>/var/tmp/AEDebug</code> is equivalent to setting the <code>AEDebug</code>, <code>AEDebugSends</code>, <code>AEDebugReceives</code>, <code>AEDebugReceives</code>, and <code>AEDebugOSL</code> environment variables.</p></li><li><p>Creating the file <code>/var/tmp/AEDebug.out</code> is equivalent to setting <code>AEDebugFile</code> to &quot;/var/tmp/AEDebug.out&quot;.</p></li><li><p>Creating the file <code>/var/tmp/AEDebugLogs</code> causes Apple Event Manager to send all of its output to a file named <code>/var/tmp/AELog-&lt;progname&gt;</code>.</p></li></ul><div class="notebox"><p><strong>IMPORTANT:</strong> The last two items only affect the destination of the debugging output.  In order to produce debugging output, you have to enable it using one of the environment variables listed above, or by creating <code>/var/tmp/AEDebug</code>.</p></div><p>If you set the <code>AE_PRINT_XML</code> environment variable to 1 (10.4 and later), <code>GDBPrintAEDesc</code> will print the descriptor as XML (if possible).</p><A NAME="SECEPPC"></A><H4>Remote Apple Events</H4><p>If you're having problems with remote Apple events, you may find it useful to enable logging for the Apple event server process.  To do this, edit <code>/System/Library/LaunchDaemons/eppc.plist</code> and add a &quot;--debug&quot; entry to the <code>ProgramArguments</code> array.  The end result should be a file like the one shown in <A HREF="#LISTEPPC">Listing 31</A>.</p><A NAME="LISTEPPC"></A><p class="smalltext"><strong>Listing 31:</strong> Enabling remote Apple event debugging</p><pre class="sourcecodebox">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; \
&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
        &lt;key&gt;Disabled&lt;/key&gt;
        &lt;true/&gt;
        &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;com.apple.AEServer&lt;/string&gt;
        &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
                &lt;string&gt;/System/Library/Frameworks/ApplicationServices.\
framework/Frameworks/AE.framework/Versions/A/Support/AEServer&lt;/string&gt;
                &lt;string&gt;--debug&lt;/string&gt;
        &lt;/array&gt;
        &lt;key&gt;inetdCompatibility&lt;/key&gt;
        &lt;dict&gt;
                &lt;key&gt;Wait&lt;/key&gt;
                &lt;false/&gt;
        &lt;/dict&gt;
        &lt;key&gt;Sockets&lt;/key&gt;
        &lt;dict&gt;
                &lt;key&gt;Listeners&lt;/key&gt;
                &lt;dict&gt;
                        &lt;key&gt;SockServiceName&lt;/key&gt;
                        &lt;string&gt;eppc&lt;/string&gt;
                        &lt;key&gt;SockType&lt;/key&gt;
                        &lt;string&gt;stream&lt;/string&gt;
                        &lt;key&gt;Bonjour&lt;/key&gt;
                       &lt;true/&gt;
                &lt;/dict&gt;
        &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</pre><p>You must stop and start the Remote Apple Events service for this change to take effect; you can do this in the Sharing panel of System Preferences.   The logging information will appear in the <A HREF="#SECSEEINGOUTPUT">system log</A>.</p><div class="notebox"><p><strong>IMPORTANT:</strong> Because <code>AEServer</code> is launched on demand by <A HREF="x-man-page://8/launchd">launchd</A>, you won't see any log entries until you actually send an Apple event to the machine.  If you still don't see any log entries, restart the server machine and try again.</p></div><div class="notebox"><p><strong>Note:</strong> On Mac OS X 10.3.x the Apple event server was run by <A HREF="x-man-page://8/xinetd">xinetd</A>.  The configuration file was <code>/etc/xinetd.d/eppc</code>.  To enable debugging, uncomment the &quot;server_args&quot; line, and change the parameter value to &quot;--debug&quot;.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECPROCESSMANAGER"></A><H3>Process Manager</H3><p>There are circumstances where you want to debug a process, but you don't want to launch it from within GDB.  For example, if you've ssh'd into a remote computer in order to debug a GUI application, you shouldn't launch it directly from GDB because the application will be in the wrong Mach bootstrap namespace, and thus can't connect to critical services like the pasteboard server.  Normally this isn't a problem: you simply ask the remote user to launch the application for you and then attach to the running application using GDB's <code>attach</code> command.  However, what happens if you want to debug the application's startup procedure?  You end up playing the 'attach race' game, where the user launches the application and you race to attach with GDB.  Not good.</p><p>Process Manager offers a nice solution to this problem.  If you set the <code>INIT_Processes</code> environment variable to 1, Process Manager will delay the application's launch for 15 seconds, giving you time to attach with GDB.  It even logs a nice message (see <A HREF="#LISTINITPROCESSES">Listing 32</A>) to the <A HREF="#SECSEEINGOUTPUT">system log</A> letting you know what it's doing.</p><A NAME="LISTINITPROCESSES"></A><p class="smalltext"><strong>Listing 32:</strong> System log message generated by paused process</p><pre class="sourcecodebox">
Sep  7 14:18:37 guy-smiley QuickTime Player: Blocking on INIT_Processes \
for 15 seconds; attach to pid 4344 if you want.
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCOREGRAPHICS"></A><H3>Core Graphics</H3><p>Quartz Debug has a number of useful debugging features; see <A HREF="../../qa/qa2001/qa1236.html">Technical Q&amp;A QA1236, 'Debugging Graphics with QuartzDebug'</A> for more details.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECQUICKDRAW"></A><H3>QuickDraw</H3><p>QuickDraw exports a number of routines that you can call from GDB to get information about QuickDraw state.  The first three routines&mdash;<code>QDDebugPrintPortInfo</code>, <code>QDDebugPrintCGSInfo</code>, and <code>QDDebugDumpRegion</code>&mdash;print information to <code>stderr</code>.  <A HREF="#LISTQDPRINT">Listing 33</A> shows an example of their use.</p><A NAME="LISTQDPRINT"></A><p class="smalltext"><strong>Listing 33:</strong> QuickDraw printing routines</p><pre class="sourcecodebox">
(gdb) set $window = (void *) FrontWindow()
(gdb) set $port = (void *) GetWindowPort($window)
(gdb) call (int) QDDebugPrintPortInfo($port)
Dumping port 0x435670...
    PixMap:              0x1FE72C
        Base Address:    0xB0028000 [onscreen, buffered]
        RowBytes:        0xFFFF9400
        Bounds:          (0, 0, 106, 352)  (352w x 106h)
        Depth:           0020
    Port bounds:         (0, 0, 106, 352)  (352w x 106h)
    Port shape:          0x1FE798 (0, 0, 106, 352)  (352w x 106h) &hellip;
    Vis rgn:             0x1FE730 (0, 0, 106, 352)  (352w x 106h) &hellip;
    Clip rgn:            0x1FE738 (-32000, -32000, 32000, 32000)  &hellip;
    Fore Color:          0000 0000 0000
    Back Color:          FFFF FFFF FFFF
[&hellip;]
$21 = 0
(gdb) call (int) QDDebugPrintCGSInfo($port)
CGS info for port 0x435670
    CGSWindowID:           19798
    Shape:                 0x59E734 (99, 785, 205, 1137)  (352w x &hellip;
    Vis Region:            0x59E72C (0, 0, 0, 0)  (0w x 0h) [rect]
    Dirty Region:          0x59E730 (0, 0, 0, 0)  (0w x 0h) [rect]
$20 = 0
(gdb) # 0x1FE730 is &quot;Vis rgn&quot; from QDDebugPrintPortInfo
(gdb) set $rgn=0x1FE730
(gdb) call (int)QDDebugDumpRegion($rgn)
Size = 116  Bounds = (0, 0, 106, 352)  (352w x 106h)  NEW FORMAT
0: 2 350
1: 1 351
2: 0 352
104: 1 351
105: 2 350
106:

$21 = 0
</pre><p>The remaining routines are designed to help you visualize regions on screen by flashing the region shape.  <A HREF="#LISTQDFLASH">Listing 34</A> shows how to call these routines; unfortunately you can't see the results in this document, so you'll have to try this yourself.  It assumes that the <code>$port</code> and <code>$rgn</code> convenience variables are set up as per <A HREF="#LISTQDPRINT">Listing 33</A>.</p><A NAME="LISTQDFLASH"></A><p class="smalltext"><strong>Listing 34:</strong> QuickDraw flashing routines</p><pre class="sourcecodebox">
(gdb) call (int) QDDebugFlashRegion($port, $rgn)
$23 = 0
(gdb) call (void) QDDebugFlashClipRgn($port)
(gdb) call (void) QDDebugFlashPortShape($port)
(gdb) call (void) QDDebugFlashVisRgn($port)
(gdb) call (int) QDDebugFlashCGSWindowShape($port)
$24 = 0
(gdb) call (int) QDDebugFlashCGSWindowOpaqueShape($port)
$25 = 0
(gdb) call (int) QDDebugFlashCGSVisRgn($port)
$26 = 0
(gdb) call (int) QDDebugFlashCGSDirtyRgn($port)
$27 = 0
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCARBON"></A><H2>Carbon (HIToolbox)</H2><p>Carbon's HIToolbox includes a wealth of facilities for your debugging convenience.</p><ul><li><p>There is a debug variant of the HIToolbox library that prints debugging messages when it encounters errors.</p></li><li><p>There are numerous HIToolbox routines that you can call from within GDB to <A HREF="#SECHLTBPRINTERS">print information about HIToolbox objects</A> in your process, including events, menus, windows, dialogs, and controls.</p></li><li><p>There are routines to <A HREF="#SECHLTBFLASHERS">flash regions</A> so that can visualize them on screen.</p></li><li><p>This are a variety of facilities to <A HREF="#SECHLTBEVENTTRACE">trace events</A> as they flow through the toolbox.</p></li></ul><A NAME="SECHLTBPRINTERS"></A><H3>HIToolbox Object Printing Routines</H3><p>The following listings show the various HIToolbox object printing routines.</p><p class="smalltext"><strong>Listing 35:</strong> HIToolbox event printing</p><pre class="sourcecodebox">
(gdb) call (int)GDBPrintEventQueue()

Printing event queue 0x7632536c...
RunLoop: 0x40c560
Count: 4 Header: 0x1805010 Head: 0x49faf0 Tail: 0x489d10

EventRef Event Kind           Time       P Cnt Desc
-------- -------------------- ---------- - --- --------------------
  49FAF0 kEventMouseDown       219335.28 H 001 x=879, y=61, button 1
  489530 kEventWindowActivate  219335.46 H 002 0x4350A0 &quot;Untitled 1&quot;
  43A4E0 kEventAppActiveWindo 218971.143 S 002
  489D10 kEventWindowUpdate   219335.473 L 002 0x4A3C10 &quot;Untitled 1 Properties&quot;
$2 = 0
(gdb) # 0x489D10 is the kEventWindowUpdate event from last command
(gdb) call (void) _DebugPrintEvent(0x489D10)
Displaying event 489D10...
   Class           wind
   Kind            1
   When                219335
   Priority        Low
   RetainCount     2
   Queued          Yes
   Info            kEventWindowUpdate, 0x4A3C10 &quot;Untitled 1 Properties&quot;
   Parameters
        param: ----
           type: wind
           size: 4
           data: 004A3C10
                  J&lt;</pre><p class="smalltext"><strong>Listing 36:</strong> HIToolbox menu printing</p><pre class="sourcecodebox">
(gdb) call (void) DebugPrintMenuList()
Index  MenuRef     ID   Title
-----  ----------  ------  -----
    1  0x0041F330  -21629  &lt;Apple&gt;
    2  0x0042EC00     128  QuickTime Player
    3  0x0043C4B0     129  File
    4  0x00445B70     130  Edit
[&hellip;]
&lt;hierarchical menus&gt;
           0x0042CF90     140  Open Recent
(gdb) # 0x0042EC00 is the QuickTime Player menu
(gdb) set $menu=0x0042EC00
(gdb) call (void) DebugPrintMenu($menu)
MenuRef:          0x0042EC00
    Title               : QuickTime Player
    ID                  : 128
    Width               : 0
    Height              : 0
    Enabled             : true
    Attributes          : CondenseSeparators, ReceivedInit
    Modal level         : 0
    Refcount            : 3
    Element             : 0x004435B0
    Item Count          : 12
    Item Icon  Cmd Key   Mark   CmdID E V Text
    ---- ---- -------- -------- ----- - - ----
    0001 0000 0x00 ' ' 0x00 ' '       Y Y About QuickTime Player
    0002 0000 0x00 ' ' 0x00 ' '       N Y -
    0003 0000 0x00 ' ' 0x00 ' '  pref Y Y Preferences
[&hellip;]
HIObject
    Ref count           : 3
    Event Target        : 0x42f040
    Event Handler       : 0x436f10
(gdb) call (void) DebugPrintMenuItem($menu, 1)
Menu: 0x0042EC00 Item: 1 Info:
 Text:                  About QuickTime Player
 Mark:                  &lt;none&gt;
 Cmd Key:               &lt;none&gt;
 Icon:                  &lt;none&gt;
 Style Normal
 Command ID:          0 (0x00000000)
 Modifiers:            0x00
[&hellip;]
</pre><p class="smalltext"><strong>Listing 37:</strong> HIToolbox window and dialog printing</p><pre class="sourcecodebox">
(gdb) call (void) DebugPrintWindowList()

Window      Class    WID  Vis Hil Level Title                 Group
----------  -------- ---- --- --- ----- --------------------- -----------&hellip;
0x004350A0  Document 4ED4  Y   Y      0 Untitled 1            0x76E47A89 &hellip;
0x004A3C10  Document 4EED  Y   N      0 Untitled 1 Properties 0x76E47A89 &hellip;
(gdb) # 0x004350A0 is the &quot;Untitled 1&quot; window
(gdb) set $window=0x004350A0
(gdb) # 0x004A3C10 is the &quot;Untitled 1 Properties&quot; dialog
(gdb) set $dialogWindow=0x004A3C10
(gdb) call (void) DebugPrintWindow($window)
Window 0x004350A0
    Title               : Untitled 1
    Class               : Document
    Group               : 0x76E47A89 &quot;com.apple.HIToolbox.windowgroups.document&quot;
    Scope               : all
    Attributes          : Collapse Box, In WindowMenu
    Visible             : Yes
    Collapsed           : No
    Latent visibility   : &lt;none&gt;
    Highlighted         : Yes
    Structure region    : 1FE80C #0, #0, #106, #352 (#352w x #106h) [non-rect]
[&hellip;]
(gdb) call (void) DebugPrintAllWindowGroups()
Window group tree
-------------------------------------------------------------------------&hellip;
  1  level    0  group 0x76E0BFE9 &quot;com.apple.hitoolbox.windowgroups.root&quot;
  2  level    0    group 0x76E47A89 &quot;com.apple.HIToolbox.windowgroups.doc&hellip;
(gdb) # 0x76E47A89 is the second window group
(gdb) call (void) DebugPrintWindowGroup(0x76E47A89)
WindowGroup 0x76E47A89 &quot;com.apple.HIToolbox.windowgroups.document&quot;
 Attributes:           &lt;none&gt;
 Refcount:             1
 Previous group:       &lt;none&gt;
 Next group:           &lt;none&gt;
 Parent group:         0x76E0BFE9 &quot;com.apple.hitoolbox.windowgroups.root&quot;
[&hellip;]
(gdb) set $dialog = (void *) GetDialogFromWindow($dialogWindow)
(gdb) call (void) GDBShowDialogInfo($dialog)
Dialog:                 0x76ED59A1
 Window:                0x004A3C10 &quot;Untitled 1 Properties&quot;
 TextHandle:            0x0059EC7C
 Default Item:          1
 Cancel Item:           0
 Keyboard Focus Item:   0
 RefCon:                0x06054AB5 (101010101)
</pre><p class="smalltext"><strong>Listing 38:</strong> HIToolbox control printing</p><pre class="sourcecodebox">
(gdb) call (void) GDBShowControlHierarchy($window)
Dumping info for window 0x4A3C10
Window found. Dumping views...
Root 0x4ba260 , ID ''/0, (-32768,-32768,32767,32767), Embedder, Vis, Act,&hellip;
    Control 0x4c24d0 &lt;appl/sbar&gt; ( &quot;&quot; ), ID ''/0, (172,301,226,317), Vis,&hellip;
    Control 0x4c6080 &lt;appl/sbar&gt; ( &quot;&quot; ), ID ''/0, (75,301,142,317), Vis, &hellip;
    Control 0x4c49c0 &lt;appl/push&gt; ( &quot;Delete&quot; ), ID ''/0, (241,220,261,290)&hellip;
    Control 0x4c4790 &lt;appl/push&gt; ( &quot;Edit?&quot; ), ID ''/0, (241,135,261,205),&hellip;
    Control 0x4c17c0 &lt;appl/push&gt; ( &quot;Add?&quot; ), ID ''/0, (241,50,261,120), V&hellip;
    Control 0x4be1d0 &lt;appl/popb&gt; ( &quot;&quot; ), ID ''/0, (12,176,28,316), Vis, A&hellip;
    Control 0x4ba1f0 &lt;appl/popb&gt; ( &quot;&quot; ), ID ''/0, (12,24,28,164), Vis, Ac&hellip;
(gdb) # 0x4c24d0 is first scrollbar control
(gdb) call (void) GDBShowControlInfo(0x4c24d0)
HIScrollBar
    Size                : Auto
    Live Tracking       : No
Control 0x004C24D0 &quot;&quot;
    Control Kind        : 'appl', 'sbar'
    Control ID          : '', 0
    Window              : 0x004A3C10 &quot;Untitled 1 Properties&quot;
    Parent              : 0x004BA260
    Minimum             : 0 (0x00000000)
    Maximum             : 0 (0x00000000)
    Value               : 0 (0x00000000)
[&hellip;]
HIObject
    Ref count           : 1
    Event Target        : 0x4c39a0
    Event Handler       : 0x4c3a10
</pre><p>Finally, you can print the debug information for any HIObject (windows, menus, controls, HIViews, and so on) using <code>HIObjectPrintDebugInfo</code>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECHLTBFLASHERS"></A><H3>HIToolbox Region Flashing</H3><p>The routines shown in <A HREF="#LISTHLTBFLASHERS">Listing 39</A> can be used to flash regions so that you can visualize them on screen; unfortunately you can't see the results in this document, so you'll have to try this yourself.</p><A NAME="LISTHLTBFLASHERS"></A><p class="smalltext"><strong>Listing 39:</strong> HIToolbox region flashing routines</p><pre class="sourcecodebox">
(gdb) call (void) DebugFlashWindowVisRgn($window)
(gdb) call (void) DebugFlashWindowUpdateRgn($window)
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECHLTBEVENTDEBUG"></A><H3>HIToolbox Event Debugging</H3><p>With the advent of Carbon Events, it's often hard to understand the flow of events through the toolbox.  HIToolbox offers two debugging facilities that can help here.</p><A NAME="SECHLTBEVENTDEBUGENV"></A><H4>EventDebug Environment Variable</H4><p>By setting the <code>EventDebug</code> environment variable to 1, you cause HIToolbox to log all events as they flow through the system.  <A HREF="#LISTHLTBEVENTDEBUGENV">Listing 40</A> shows an example of this.</p><A NAME="LISTHLTBEVENTDEBUGENV"></A><p class="smalltext"><strong>Listing 40:</strong> EventDebug output</p><pre class="sourcecodebox">
$ EventDebug=1 /Applications/QuickTime\ Player.app/Contents/MacOS/\
QuickTime\ Player
Event Posted: Queue: 0x763059ae, Event: kEventAppleEvent, 221132.233, S &hellip;
SendEventToEventTarget entered
    Sending Event to 0x4128E0: hiob 2
        Called handler 0x927F3200. Event was handled
        Leaving target 0x4128E0 with result 0
SendEventToEventTarget entered
    Sending Event to 0x41E6F0: hiob 2
        SendEventToEventTarget entered
            Sending Event to 0x41EC30: hiob 2
                SendEventToEventTarget entered
                    Sending Event to 0x41EC30: hiob 2
                        Called handler 0x927F3200. Event was handled
                        Leaving target 0x41EC30 with result 0
                Called handler 0x927FBB50. Event was handled
                Leaving target 0x41EC30 with result 0
        Called handler 0x927F3200. Event was handled
        Leaving target 0x41E6F0 with result 0
[&hellip;]
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECHLTBEVENTTRACE"></A><H4>Event Tracing</H4><p>The <code>EventDebug</code> environment variable produces a lot of output, which can have some negative effects.  Specifically, it slows your program down considerably and it's sometimes hard to find the information you're looking for amongst all the output.</p><p>One solution to this problem is to enable event-by-event tracing.  You can do this by calling the <code>TraceEventByName</code> routine from within GDB.  <A HREF="#LISTTRACEEVENTBYNAME">Listing 41</A> shows an example of this, enabling tracing just for the <code>kEventRawKeyDown</code> event.</p><A NAME="LISTTRACEEVENTBYNAME"></A><p class="smalltext"><strong>Listing 41:</strong> Event tracing</p><pre class="sourcecodebox">
(gdb) call (void) TraceEventByName(&quot;kEventRawKeyDown&quot;)
(gdb) c
Continuing.
Event Posted: Queue: 0x76309338, Event: kEventRawKeyDown, 221443.183, S
SendEventToEventTarget entered
    Sending Event to 0x415750: kEventRawKeyDown
        SendEventToEventTarget entered
            Sending Event to 0x413050: kEventRawKeyDown
                Called handler 0x928CD05C. Event was NOT handled
                Leaving target 0x413050 with result -9874
        SendEventToEventTarget entered
            Sending Event to 0x42DE30: kEventRawKeyDown
                Leaving target 0x42DE30 with result -9874
            Sending Event to 0x4351F0: kEventRawKeyDown
                Leaving target 0x4351F0 with result -9874
            Sending Event to 0x4126F0: kEventRawKeyDown
                Called handler 0x929597E0. Event was NOT handled
                Called handler 0x927F4F40. Event was NOT handled
                Leaving target 0x4126F0 with result -9874
        Leaving target 0x415750 with result -9874
Event Removed: Queue: 0x76309338, Event: kEventRawKeyDown, 221443.183, S
Event Pulled (C): kEventRawKeyDown, 221443.183, S
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECHLTBEVENTSTATS"></A><H3>HIToolbox Event Statistics</H3><p>There are two environment variables that cause HIToolbox to print event statistics.  If you set <code>EventRate</code> to 1, HIToolbox will, every second, print a summary of the events handled that second.  If you set <code>HLTBRecordEventStats</code>, HIToolbox will print a bunch of statistics about event handling when your application quits; this feature requires the debug library.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECHLTBOTHER"></A><H3>Other HIToolbox Debugging Facilities</H3><p>If you set the <code>NSQuitAfterLaunch</code> environment variable to 1, your application will quit as soon as it enters its event loop.  This is useful if you want to measure application launch time, or look for leaks.  This environment variable is also supported by <A HREF="#SECAPPKIT">AppKit</A>.</p><div class="notebox"><p><strong>IMPORTANT:</strong> Starting with Mac OS X 10.4 you must be using the profile version of the HIToolbox framework (<code>HIToolbox_profile</code>) for this to work.</p></div><p>If you set the <code>HLTBPrintKeyMatchingStatus</code> environment variable to 1, HIToolbox will print detailed information about menu item matching.  This feature requires the debug library.</p><p>If you set the <code>TSMEventTracing</code> environment variable to 1, HIToolbox will print detailed information about Text Services Manager (TSM) event processing.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECCOCOA"></A><H2>Cocoa</H2><p>All Cocoa objects (everything derived from <code>NSObject</code>) support a <code>description</code> method that returns an <code>NSString</code> describing the object.  The most convenient way to access this description is via GDB's <code>print-object</code> (or <code>po</code> for short) command, as illustrated by <A HREF="#LISTPRINTOBJECT">Listing 42</A>.</p><A NAME="LISTPRINTOBJECT"></A><p class="smalltext"><strong>Listing 42:</strong> Using GDB's po command</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 6.1-20040303 (Apple version gdb-434) [&hellip;]
(gdb) fb -[NSCFDictionary copyWithZone:]
Function &quot;-[NSCFDictionary copyWithZone:]&quot; not defined.
Breakpoint 1 (-[NSCFDictionary copyWithZone:]) pending.
(gdb) r
[&hellip;]
Breakpoint 1 at 0x928ea1d4
Pending breakpoint 1 - &quot;-[NSCFDictionary copyWithZone:]&quot; resolved

Breakpoint 1, 0x928ea1d4 in -[NSCFDictionary copyWithZone:] ()
(gdb) po $r3
Reading symbols for shared libraries . done
&lt;NSCFDictionary 0x32d6d0&gt;{
copyright = ;
author = ;
OpenPanelFollowsMainWindow = 0;
UseTransitionalDocType = 0;
UseInlineCSS = 0;
[&hellip;]
}
</pre><div class="notebox"><p><strong>Note:</strong> <code>print-object</code> actually calls the <code>debugDescription</code> method of the specified object.  <code>NSObject</code> implements this method by calling through to the <code>description</code> method.  Thus, by default, an object's debug description is the same as its description.  However, you can override <code>debugDescription</code> if you want to decouple these; many Cocoa objects do this.</p></div><A NAME="SECOBJECTIVEC"></A><H3>Objective-C</H3><p>If you set the <code>OBJC_HELP</code> environment variable (10.4 and later), the Objective-C runtime will print out a list of all of the debugging environment variables that it supports.  Some of the more useful ones are shown in <A HREF="#TABOBJCENV">Table 7</A>.</p><A NAME="TABOBJCENV"></A><p class="smalltext"><strong>Table 7:</strong> Useful Objective-C runtime debugging environment variables</p><table cellspacing="0" class="graybox"><tr><th>Variable</th><th>Summary</th></tr><tr><td scope="row"><code>OBJC_PRINT_IMAGES</code></td><td>Log images loaded by runtime</td></tr><tr><td scope="row"><code>OBJC_PRINT_LOAD_METHODS</code></td><td>Log execution of <code>+load</code> methods</td></tr><tr><td scope="row"><code>OBJC_DEBUG_FRAGILE_SUPERCLASSES</code></td><td>Warns if a class's instance variables overlap its superclass's instance variables</td></tr></table><p>If you set the <code>NSObjCMessageLoggingEnabled</code> environment variable to &quot;YES&quot;, the Objective-C runtime will log all dispatched Objective-C messages to a file named <code>/tmp/msgSends-&lt;pid&gt;</code>.</p><p>When debugging Cocoa code at the assembly level, keep in mind the following features of the Objective-C runtime.</p><ul><li><p>The Objective-C compiler adds two implicit parameters to each method.  The first is a pointer to the object being messaged (<code>self</code>).  On PowerPC, this is in register <code>r3</code>.  On Intel, this is in the memory at <code>esp</code> + 4, assuming you've stopped at the first instruction of the method's implementation (for more information about accessing parameters on Intel-based computers, see <A HREF="#SECARCHITECTURE">Architecture Considerations</A>).</p></li><li><p>The second implicit parameter is the method selector.  In Objective-C this is of type <code>SEL</code>; in GDB you can print this as a C string.  On PowerPC, this parameter is in register <code>r4</code>.  On Intel, this is in the memory at <code>esp</code> + 8.</p></li><li><p>The Objective-C runtime dispatches methods via a C function called <code>objc_msgSend</code>.</p></li><li><p>The first word of any Objective-C object (the <code>isa</code> field) is a pointer to the object's class.</p></li></ul><p><A HREF="#LISTOBJCRUNTIME">Listing 43</A> shows an example of how to use this information from GDB.</p><A NAME="LISTOBJCRUNTIME"></A><p class="smalltext"><strong>Listing 43:</strong> Objective-C runtime 'secrets'</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 5.3-20030128 (Apple version gdb-330.1) [&hellip;]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
[&hellip;]
^C
Program received signal SIGINT, Interrupt.
0x900074c8 in mach_msg_trap ()
(gdb) # Set a breakpoint on the Objective-C method dispatcher
(gdb) b objc_msgSend
Breakpoint 1 at 0x908311f4
(gdb) # Continue execution...
(gdb) c
Continuing.

Breakpoint 1, 0x908311f4 in objc_msgSend ()
(gdb) # Hit the breakpoint; dump the first 4 words of the object
(gdb) x/4x $r3
0x10cc10:       0xa0a04e18      0x00000001      0x00000000      0x00000000
(gdb) # Print the selector.
(gdb) x/s $r4
0x9083ed94 &lt;_errDoesntRecognize+884&gt;:    &quot;init&quot;
(gdb) # Want to 'po' object; must disable the breakpoint first
(gdb) dis 1
(gdb) po $r3
&lt;NSAutoreleasePool: 0x10cc10&gt;
(gdb) # Print the 'isa' pointer.
(gdb) po 0xa0a04e18
NSAutoreleasePool
</pre><p>When debugging without symbols, you can use functions from the Objective-C runtime to assist your debugging efforts.  The routines shown in <A HREF="#TABOBJCFUNC">Table 8</A> are particularly useful.</p><A NAME="TABOBJCFUNC"></A><p class="smalltext"><strong>Table 8:</strong> Useful Objective-C runtime functions</p><table cellspacing="0" class="graybox"><tr><th>Function</th><th>Summary</th></tr><tr><td scope="row"><code>id objc_getClass(const char *name);</code></td><td>Get the Objective-C <code>Class</code> object for the given class</td></tr><tr><td scope="row"><code>SEL sel_getUid(const char *str);</code></td><td>Get the Objective-C <code>SEL</code> for the given method name</td></tr><tr><td scope="row"><code>Method class_getInstanceMethod(Class, SEL);</code></td><td>Get the Objective-C <code>IMP</code> for a given method in a given class</td></tr></table><p>Once you have an <code>IMP</code>, you can get a pointer to the method name (useful for double checking that everything worked) from the first word and a pointer to the method implementation from the third word.</p><p><A HREF="#LISTOBJCRUNTIMEDEBUG">Listing 44</A> shows an example of debugging the <code>-[Controller applicationShouldTerminate:]</code> method of TextEdit, even though TextEdit does not ship with symbols.</p><A NAME="LISTOBJCRUNTIMEDEBUG"></A><p class="smalltext"><strong>Listing 44:</strong> Using the Objective-C runtime to debug without symbols</p><pre class="sourcecodebox">
$ gdb /Applications/TextEdit.app
GNU gdb 6.1-20040303 (Apple version gdb-413) [&hellip;]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit
[&hellip;]
^C
Program received signal SIGINT, Interrupt.
0x9000a778 in mach_msg_trap ()
(gdb) # Want to set a breakpoint on -[Controller applicationShouldTerminate:]
(gdb) # but the application has had all of the symbols stripped, so we
(gdb) # can't do it the easy way.
(gdb) info func applicationShouldTerminate
All functions matching regular expression &quot;applicationShouldTerminate&quot;:
(gdb) # Get the Class object for the Controller class
(gdb) call (void *)objc_getClass(&quot;Controller&quot;)
$1 = (void *) 0x1caa8
(gdb) # Get the SEL object for the &quot;applicationShouldTerminate:&quot; method
(gdb) call (void *)sel_getUid(&quot;applicationShouldTerminate:&quot;)
$2 = (void *) 0x909f36a0
(gdb) # Get the IMP for that method of that class
(gdb) call (void *)class_getInstanceMethod($1, $2)
$3 = (void *) 0x325bd8
(gdb) # Dump the IMP
(gdb) x/3x $3
0x325bd8:       0x909f36a0      0x00018ea4      0x0000a7b0
(gdb) # Print the first word, just to make sure everything is copacetic
(gdb) x/s 0x909f36a0
0x909f36a0 &lt;_errNewVars+220620&gt;:         &quot;applicationShouldTerminate:&quot;
(gdb) # The third word is a pointer to code
(gdb) x/8i 0x0000a7b0
0xa7b0: mflr    r0
0xa7b4: stmw    r23,-36(r1)
0xa7b8: lis     r4,2
0xa7bc: stw     r0,8(r1)
0xa7c0: mr      r3,r5
0xa7c4: li      r26,0
0xa7c8: stwu    r1,-112(r1)
0xa7cc: lwz     r4,-15200(r4)
(gdb) # Set a breakpoint on the code
(gdb) b *0x0000a7b0
Breakpoint 1 at 0xa7b0
(gdb) # Resume execution, and then quit the app
(gdb) c
Continuing.
Reading symbols for shared libraries ............ done
Reading symbols for shared libraries . done

Breakpoint 1, 0x0000a7b0 in ?? ()
(gdb) # We've hit our breakpoint; print the parameters, starting
(gdb) # with the implicit &quot;self&quot; and &quot;SEL&quot; parameters that are common
(gdb) # to all methods, followed by the method-specific &quot;app&quot; parameter
(gdb) po $r3
&lt;Controller: 0x328b50&gt;
(gdb) x/s $r4
0x909f36a0 &lt;_errNewVars+220620&gt;:         &quot;applicationShouldTerminate:&quot;
(gdb) po $r5
&lt;NSApplication: 0x3198e0&gt;
</pre><p>You can learn more about the Objective-C runtime functions and data structures by looking through the headers in <code>/usr/include/objc/</code>.</p><div class="notebox"><p><strong>WARNING:</strong> As with many things described in this technote, the inner workings of the Objective-C runtime are private: they have changed in the past, and they will change in the future.  It's fine to use this information for debugging, but do not depend on it in code that you ship to customers.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECFOUNDATION"></A><H3>Foundation</H3><p>Foundation has numerous debugging facilities that are enabled by environment variables.  <A HREF="#TABFOUNDATIONVAR">Table 9</A> highlights some of the more interesting ones; these are all further documented in <code>NSDebug.h</code>.</p><A NAME="TABFOUNDATIONVAR"></A><p class="smalltext"><strong>Table 9:</strong> Environment variables from 'NSDebug.h'</p><table cellspacing="0" class="graybox"><tr><th>Name</th><th>Default</th><th>Action</th></tr><tr><td scope="row"><code>NSZombieEnabled</code></td><td>NO</td><td>If set to YES, deallocated objects are 'zombified'; this allows you to quickly debug problems where you send a message to an object that has already been freed; see below for details</td></tr><tr><td scope="row"><code>NSDeallocateZombies</code></td><td>NO</td><td>If set to YES, the memory for 'zombified' objects is actually freed</td></tr><tr><td scope="row"><code>NSHangOnUncaughtException</code></td><td>NO</td><td>If set to YES, the process will hang, rather than quit, when an uncaught exception is raised</td></tr><tr><td scope="row"><code>NSEnableAutoreleasePool</code></td><td>YES</td><td>If set to NO, autorelease pools do not release objects in the pool when the pool is released</td></tr><tr><td scope="row"><code>NSAutoreleaseFreedObjectCheckEnabled</code></td><td>NO</td><td>If set to YES, autorelease pools will print a message if they try to release an object that has already been freed</td></tr><tr><td scope="row"><code>NSAutoreleaseHighWaterMark</code></td><td>0</td><td>If set to X, autorelease pools will print a message if more than X objects accumulate in the pool</td></tr><tr><td scope="row"><code>NSAutoreleaseHighWaterResolution</code></td><td>0</td><td>If set to Y, a message is logged for every Y objects that accumulate in the pool beyond the high-water mark (X)</td></tr></table><div class="notebox"><p><strong>IMPORTANT:</strong> To enable or disable a Foundation debugging facility, you should set the value of the environment variable to &quot;YES&quot; or &quot;NO&quot;, not 1 or 0 as is the case with other system components.</p></div><p>One of the most common forms of bugs when programming with Cocoa is caused by over-releasing an object.  This typically causes your application to crash, but the crash occurs after the last reference count is released (and you try to message the freed object), which is usually quite removed from the original bug.  <code>NSZombieEnabled</code> is your best bet for debugging this sort of problems because any attempt to interact with a freed object will raise an exception.  <A HREF="#LISTNSZOMBIEEXCEPTION">Listing 45</A> shows an example of the message you'll see in this case.</p><A NAME="LISTNSZOMBIEEXCEPTION"></A><p class="smalltext"><strong>Listing 45:</strong> The effect of NSZombie</p><pre class="sourcecodebox">
$ NSZombieEnabled=YES DragNDropOutlineView
2004-04-30 14:56:28.238 DragNDropOutlineView[803] *** *** Selector \
'_propagateDirtyRectsToOpaqueAncestors' sent to dealloced instance \
0x530540 of class AnimatingOutlineView.
</pre><p>You can use GDB to set a breakpoint on <code>-[_NSZombie methodSignatureForSelector:]</code> to further debug this sort of problem.</p><p>You can enable logging for Foundation's scripting support using the <code>NSScriptingDebugLogLevel</code> preference.  <A HREF="#LISTNSSCRIPTLOG">Listing 46</A> shows an example of this; the log shown is the result of running the trivial AppleScript <code>version of application &quot;TextEdit&quot;</code>.</p><A NAME="LISTNSSCRIPTLOG"></A><p class="smalltext"><strong>Listing 46:</strong> Enabling NSScriptingDebugLogLevel</p><pre class="sourcecodebox">
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSScriptingDebugLogLevel 1
[&hellip;] Suite NSCoreSuite, apple event code 0x3f3f3f3f
[&hellip;] Suite NSTextSuite, apple event code 0x3f3f3f3f
[&hellip;] Suite TextEdit, apple event code 0x74786474
[&hellip;] Command: NSCoreSuite.Get
        Direct Parameter: &lt;NSPropertySpecifier: version&gt;
        Receivers: &lt;NSPropertySpecifier: version&gt;
        Arguments: {}
[&hellip;] Property Value: 1.4
[&hellip;] Result: &lt;NSAppleEventDescriptor: 'utxt'($0031002E0034$)
</pre><p>If you set the <code>NSPrintDynamicClassLoads</code> environment variable to &quot;YES&quot;, Foundation will log a message whenever it loads a class or category dynamically (that is, from a bundle).</p><p>If you set the <code>NSExceptionLoggingEnabled</code> environment variable to &quot;YES&quot;, Foundation will log all exception activity (<code>NSException</code>) to <code>stderr</code>.</p><p>If you set the <code>NSUnbufferedIO</code> environment variable to &quot;YES&quot;, Foundation will use unbuffered I/O for <code>stdout</code> (<code>stderr</code> is unbuffered by default).</p><p>If you set the <code>NSDOLoggingEnabled</code> environment variable to &quot;YES&quot;, Foundation will enable logging for Distributed Objects (<code>NSConnection</code>, <code>NSInvocation</code>, <code>NSDistantObject</code>, and <code>NSConcretePortCoder</code>).</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECAPPKIT"></A><H3>AppKit</H3><p>If you set the <code>NSQuitAfterLaunch</code> environment variable to 1, your application will quit as soon as it enters its event loop.  This is useful if you want to measure application launch time or look for leaks.  This environment variable is also supported by <A HREF="#SECHLTBOTHER">Carbon</A>.</p><A NAME="SECAPPKITEVENTS"></A><H4>AppKit Events</H4><p>If you set the <code>NSTraceEvents</code> preference to YES, AppKit will log information about all events it processes.  <A HREF="#LISTNSTRACEEVENTS">Listing 47</A> shows an example of this.</p><A NAME="LISTNSTRACEEVENTS"></A><p class="smalltext"><strong>Listing 47:</strong> Using NSTraceEvents</p><pre class="sourcecodebox">
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSTraceEvents YES
2004-09-07 16:21:23.334 TextEdit[4520] timeout = 62997727116.666718 seco&hellip;
2004-09-07 16:21:23.341 TextEdit[4520] got apple event of class 61657674&hellip;
2004-09-07 16:21:23.454 TextEdit[4520] still in loop, timeout = 62997727&hellip;
2004-09-07 16:21:23.455 TextEdit[4520] timeout = 62997727116.546562 seco&hellip;
2004-09-07 16:21:27.793 TextEdit[4520] Received event: Kitdefined at: 0.&hellip;
2004-09-07 16:21:27.804 TextEdit[4520]     In Application: NSEvent: type&hellip;
2004-09-07 16:21:27.804 TextEdit[4520] timeout = 62997727112.196404 seco&hellip;
2004-09-07 16:21:27.805 TextEdit[4520] Received event: LMouseDown at: 37&hellip;
2004-09-07 16:21:27.805 TextEdit[4520]     In Application: NSEvent: type&hellip;
2004-09-07 16:21:27.805 TextEdit[4520]     In Window: NSEvent: type=LMou&hellip;
2004-09-07 16:21:27.809 TextEdit[4520]     In Application: NSEvent: type&hellip;
[&hellip;]
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECAPPKITVIEWS"></A><H4>AppKit Views</H4><p>If you set the <code>NSShowAllViews</code> preference to YES, AppKit will draw outlines around each of the views in a window.  <A HREF="#FIGNSSHOWALLVIEWS">Figure 4</A> shows how a standard TextEdit window looks with <code>NSShowAllViews</code> enabled.</p><A NAME="FIGNSSHOWALLVIEWS"></A><p class="caption"><strong>Figure 4:</strong> TextEdit with NSShowAllViews enabled</p><p><img  src="images/tn2124_NSShowAllViews.png" width="475" height="472" alt="Figure 4, TextEdit with NSShowAllViews enabled"></p><p>If you set the <code>NSShowAllDrawing</code> preference to YES, AppKit will flash every rectangle that it draws, much like Quartz Debug.  <A HREF="#FIGNSSHOWALLDRAWING">Figure 5</A> shown an example of what to expect.</p><A NAME="FIGNSSHOWALLDRAWING"></A><p class="caption"><strong>Figure 5:</strong> NSShowAllDrawing in action</p><p><img  src="images/tn2124_NSShowAllDrawing.png" width="475" height="472" alt="Figure 5, NSShowAllDrawing in action"></p><p>You can control the duration of the flash by setting <code>NSShowAllDrawing</code> to a number, which is interpreted as the number of milliseconds to flash; the default is 100 ms.  You can control the color of the flash by setting <code>NSShowAllDrawingColor</code> to a string that holds three floating point numbers, separated by spaces, representing the red, green, and blue color components.  Each number should be a value from 0.0 to 1.0 representing the intensity of that component.  For example, the string &quot;0.0 1.0 1.0&quot; would yield pure cyan.  Alternatively, if you set <code>NSShowAllDrawingColor</code> to &quot;CYCLE&quot;, AppKit will cycle through pure red, pure green, and pure blue.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="SECAPPKITOTHER"></A><H4>Other AppKit Debugging Facilities</H4><p>The <code>NSDragManagerLogLevel</code> preference is a number that controls how much logging AppKit does during drag and drop operations.  Large values give you more logging.  Currently the value of 6 is the maximum effective value.  <A HREF="#LISTNSDRAGMANAGERLOGLEVEL">Listing 48</A> shows an example of how to set this and the kind of output you get when you drag a simple text selection from TextEdit.</p><A NAME="LISTNSDRAGMANAGERLOGLEVEL"></A><p class="smalltext"><strong>Listing 48:</strong> Using NSDragManagerLogLevel</p><pre class="sourcecodebox">
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSDragManagerLogLevel 6
2004-09-07 16:26:42.031 TextEdit[4523] mouseDown location: {29, 389}, ba&hellip;
2004-09-07 16:26:42.033 TextEdit[4523] offset of image lower left relati&hellip;
2004-09-07 16:26:42.033 TextEdit[4523] type NeXT Rich Text Format v1.0 p&hellip;
2004-09-07 16:26:42.034 TextEdit[4523] type NSStringPboardType: data &lt;CF&hellip;
2004-09-07 16:26:42.034 TextEdit[4523] type NeXT plain ascii pasteboard &hellip;
2004-09-07 16:26:42.036 TextEdit[4523] type CorePasteboardFlavorType 0x7&hellip;
2004-09-07 16:26:42.036 TextEdit[4523] type CorePasteboardFlavorType 0x7&hellip;
2004-09-07 16:26:42.049 TextEdit[4523] type CorePasteboardFlavorType 0x5&hellip;
2004-09-07 16:26:42.050 TextEdit[4523] type CorePasteboardFlavorType 0x7&hellip;
[&hellip;]
</pre><p>The <code>NSAccessibilityDebugLogLevel</code> preference is a number that controls how much logging AppKit does during accessibility operations.  Large values give you more logging.  Currently the value of 3 is the maximum effective value.  <A HREF="#LISTNSACCESSIBILITYDEBUGLOGLEVEL">Listing 49</A> shows an example of how to set this and the kind of output you get when you use UIElementInspector (see <A HREF="../../samplecode/UIElementInspector/index.html">Sample Code Project 'UIElementInspector'</A>) to look at TextEdit.</p><A NAME="LISTNSACCESSIBILITYDEBUGLOGLEVEL"></A><p class="smalltext"><strong>Listing 49:</strong> Using NSAccessibilityDebugLogLevel</p><pre class="sourcecodebox">
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSAccessibilityDebugLogLevel 3
2004-09-07 16:36:34.990 TextEdit[4526] creating id&lt;=element table
2004-09-07 16:36:34.990 TextEdit[4526] creating id=&gt;element
2004-09-07 16:36:35.001 TextEdit[4526] Element&lt;=&gt;UniqueId Tables
--- id&lt;=element --- size 1
42 &lt;- (0x1576e0): &lt;NSTextView: 0x1576e0&gt;
    Frame = {{0.00, 0.00}, {460.00, 395.00}}, Bounds = {{0.00, 0.00}, &hellip;
    Horizontally resizable: NO, Vertically resizable: YES
    MinSize = {460.00, 395.00}, MaxSize = {340282346638528859811704183&hellip;
2004-09-07 16:36:35.003 TextEdit[4526] Element&lt;=&gt;UniqueId Tables
[&hellip;]
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNT_HISTORY_TAG"></A><H2>Document Revision History</H2><table cellspacing="0" class="graybox" width="680"><tr><th width="100">Date</th><th width="580">Notes</th></tr><tr><td scope="row">2007-01-10</td><td>Corrected a misspelling.</td></tr><tr><td scope="row">2006-07-25</td><td>&nbsp;</td></tr><tr><td scope="row">2006-04-11</td><td>Added a warning about CFZombieLevel. Corrected bug in Listing 20.</td></tr><tr><td scope="row">2006-03-31</td><td>A general update for Mac OS X 10.4.x on PowerPC- and Intel-based computers.  Added new sections covering the standard C++ library, launchd, lookupd, Disk Utility, Core Graphics, and the Objective-C runtime.</td></tr><tr><td scope="row">2004-12-02</td><td>Collection of Mac OS X debugging hints and tips.</td></tr></table><p><b>Posted:</b> 2007-01-10</p>
<!-- END CONTENTS -->
</td></tr></table>
<!-- END WIDE COLUMN -->
<!-- END MAIN CONTENT -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2004/tn2124.html%3Fid%3DDTS10003391-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2004/tn2124.html%3Fid%3DDTS10003391-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2004/tn2124.html%3Fid%3DDTS10003391-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<!-- START BOTTOM APPLE NAVIGATION -->
<!--#include virtual="/includes/footer"-->
<!-- END BOTTOM APPLE NAVIGATION -->
<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->
</body></html>