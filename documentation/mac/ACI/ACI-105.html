<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Customizing Search Functions</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING105></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-104.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-106.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-99.html"><B>Chapter 7 - Color Manager</B></A> / <A HREF="ACI-104.html"><B>Using the Color Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING105-0></A>
<H2>Customizing Search Functions</H2>
 <A NAME=MARKER-2-47></A>Specialized color applications may need to modify the way in which the Color Manager determines the best-mapping color in a CLUT. A custom search function you provide can implement its own mapping rules. For instance, a color-selection application might want to map all levels of green to a single green on a monitor. <P>
 To do this, you write your own color search function and use the <CODE>AddSearch</CODE> function to install it in the list of search functions that the Color Manager maintains. Then when your application or Color QuickDraw calls the <CODE>Color2Index</CODE> function, the Color Manager calls on your search function to find and return the index for the best-mapping color. Your function should be defined as:<P>
<PRE>
Boolean MySearchProc (RGBColor *rgb, long *position);
</PRE>
 If your search function decides to act on the color, it returns the index of the desired color in the <CODE>position</CODE> parameter, and returns <CODE>true</CODE> for the function value. Otherwise, it should return <CODE>false</CODE> as the function value, and pass the input color back to the Color Manager in the <CODE>rgb</CODE> parameter. The Color Manager then looks to the next search function in the list, and if there are no other custom functions it uses the normal inverse table mechanism.<P>
 The functions are chain elements in a linked list beginning in the <CODE>gdSearchProc</CODE> field of the current <CODE>GDevice</CODE> data structure. Each link is an <CODE>SProcRec</CODE> data structure, which has the format shown below.<P>
<PRE>
struct SProcRec {
   Handle         nxtSrch; /* handle to next sProcRec */
   ColorSearchProcPtrsrchProc;/* pointer to search function */
};
typedef struct SProcRec SProcRec;
</PRE>
 The Color Manager provides functions to add and delete custom functions from the linked list. You can install any number of search functions in the list. The Color Manager gives each function the chance to act or pass on the color until one returns <CODE>true</CODE>. Since each device is a shared resource, you can use the <A NAME=MARKER-2-49></A><CODE>SetClientID</CODE> function to set the <CODE>gdID</CODE> field of the <CODE>GDevice</CODE> data structure to identify your application as the caller to your search functions. When your application is finished mapping colors, it should remove your custom search function, by calling the <A NAME=MARKER-2-50></A><CODE>DelSearch</CODE> function.<P>
 For example, <A HREF=#MARKER-9-51>Listing 7-1</A> shows a function that adds a custom search function before drawing with a user-supplied color.<P>
<B>Listing 7-1  <A NAME=MARKER-9-51></A>Adding and using a custom search function</B><P>
<PRE>
void MyDrawUserColor(void)
{     
   ColorSearchProcPtrMyColorSearch;
   RGBColor       *UserColor;
   Rect           *sampleRect;

   AddSearch(MyColorSearch);
   RGBForeColor(UserColor);
   FrameRect(sampleRect);
   DelSearch(MyColorSearch);
}
</PRE>
 The <CODE>MyColorSearch</CODE> function could entirely replace the Color Manager's search algorithm by accepting the <CODE>RGBColor</CODE> data structure, doing a search, and then returning the index value and <CODE>true</CODE>. It could also merely modify the color and then let the Color Manager perform its inverse table lookup. For example, the <CODE>MyColorSearch</CODE> function could accept the <CODE>RGBColor</CODE>, do an arithmetic add with a gray color to lighten all three components, and then return the <CODE>RGBColor</CODE> data structure in the <CODE>rgb</CODE> <CODE>VAR</CODE> parameter and return <CODE>false</CODE> as the function value. The Color Manager then uses the returned color as the input for its default search.<A NAME=MARKER-2-52></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-104.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-106.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
