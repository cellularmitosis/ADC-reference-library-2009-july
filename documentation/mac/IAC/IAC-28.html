<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating the Section Record and Alias Record(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING28></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-27.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-29.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A> / <A HREF="IAC-26.html"><B>Using the Edition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING28-0></A>
<H2><A NAME=MARKER-9-87></A><A NAME=MARKER-21-88></A>Creating the Section Record and Alias Record</H2>
 Your application is responsible for creating a section record and an alias record for each publisher and subscriber section within an open document.<A NAME=MARKER-21-206></A><P>
 The section record identifies each section as a publisher or subscriber and provides identification for each section. The section record does not contain the data within the section; it describes the attributes of the section. Your application must provide its own method for associating the data within a section with its section record. Your application is also responsible for saving the data in the section.<A NAME=MARKER-2-264></A><P>
 The <CODE>alias</CODE> field of the section record contains a handle to its alias record. The alias record is a reference to the edition container from the document that contains the publisher or subscriber section. You should be familiar with the Alias Manager's conventions for creating alias records and identifying files, folders, and volumes to locate files that have been moved, copied, or restored from backup. For information on the Alias Manager, see <I>Inside Macintosh: Files.</I><A NAME=MARKER-2-303></A><A NAME=MARKER-21-43></A><P>
 When a user saves a document, your application should store all section records and alias records in the document's resource fork. Corresponding section records and alias records should have the same resource ID.<P>
 <A HREF=#MARKER-9-93>Figure 2-9</A> shows a document containing a publisher and subscriber, and the corresponding section records and alias records.<P>
<B>Figure 2-9  <A NAME=MARKER-9-93></A><A NAME=MARKER-21-94></A>A document with a publisher and subscriber and its resource fork</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ED-L-09.jpg"><P>
 A section record contains information to identify the data contained within a section as a publisher or a subscriber, a time stamp to record the last modification of the section, and unique identification for each section. The <CODE>SectionRecord</CODE> data type defines the section record.<A NAME=MARKER-2-41></A><P>
<PRE>
TYPE SectionRecord = 
   RECORD
      version:       SignedByte;    {always 1 in 7.0}
      kind:          SectionType;   {publisher or subscriber}
      mode:          UpdateMode;    {automatic or manual}
      mdDate:        TimeStamp;     {last change in document}
      sectionID:     LongInt;       {application-specific, }
                                    { unique per document}
      refCon:        LongInt;       {application-specific}
      alias:         AliasHandle;   {handle to alias record}

      {The following fields are private and are set up by the }
      { RegisterSection function described later within this }
      { chapter. Do not modify the private fields.}

      subPart:       LongInt;       {private}
      nextSection:   SectionHandle; {private, do not use as a }
                                    { linked list}
      controlBlock:  Handle;        {may be used for comparison }
                                    { only}
      refNum:        EditionRefNum; {private}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE>version</CODE>
<DD> Indicates the version of the section record, currently $01.<A NAME=MARKER-2-186></A>
<DT><CODE>kind</CODE>
<DD> Defines the section type as either publisher or subscriber with the <CODE>stPublisher</CODE> or <CODE>stSubscriber</CODE> constant.<A NAME=MARKER-9-457></A><A NAME=MARKER-21-190></A><A NAME=MARKER-2-258></A>
<DT><CODE>mode</CODE>
<DD> Indicates if editions are updated automatically or manually.<A NAME=MARKER-2-247></A>
<DT><CODE>mdDate</CODE>
<DD> Indicates which version (modification date) of the section's contents is contained within the publisher or subscriber. The <CODE>mdDate</CODE> field is set to 0 when you create a new subscriber section and to the current time when you create a new publisher. Be sure to update this field each time publisher data is modified. The section's modification date is compared to the edition's modification date to determine whether the section and the edition contain the same data. The section modification date is displayed in the publisher and subscriber options dialog boxes. See <A HREF=IAC-31.html#MARKER-9-156>"Closing an Edition" on page 2-28</A> for detailed information.<A NAME=MARKER-2-200></A>
<DT><CODE>sectionID</CODE>
<DD> Provides a unique number for each section within a document. A simple way to implement this is to create a counter for each document that is saved to disk with the document. The counter should start at 1. The section ID is currently used as a tie breaker in the <CODE>GoToPublisherSection</CODE> function when there are multiple publishers to the same edition in a single document. The section ID should not be 0 or -1. See <A HREF=IAC-525.html#MARKER-9-421>"Duplicating Publishers and Subscribers" on page 2-58</A> for information on multiple publishers.<A NAME=MARKER-2-40></A><A NAME=MARKER-21-233></A>
<DT><CODE>refCon</CODE>
<DD> Reference constant available for application-specific use.<A NAME=MARKER-2-234></A>
<DT><CODE>alias</CODE>
<DD> Contains a handle to the alias record for a particular section within a document.<A NAME=MARKER-9-209></A><A NAME=MARKER-2-306></A>
</DL>
 Whenever the user creates a publisher or subscriber, call the <CODE>NewSection</CODE> function to create the section record and the alias record.<A NAME=MARKER-2-210></A><P>
<PRE>
err := NewSection(container, sectionDocument, kind, sectionID,
                  initialMode, sectionH);
</PRE>
 The <CODE>NewSection</CODE> function creates a new section record (either publisher or subscriber), indicates whether editions are updated automatically or manually, sets the modification date, and creates an alias record from the document containing the section to the edition container.<P>
 You can set the <CODE>sectionDocument</CODE> parameter to <CODE>NIL</CODE> if the current document has never been saved. Use the <CODE>AssociateSection</CODE> function to update the alias record of a registered section when the user names or renames a document by choosing Save As from the File menu. If you are creating a subscriber with the <CODE>initialMode</CODE> parameter set to receive new editions automatically, your application receives a Section Read event each time a new edition becomes available for this subscriber.<P>
 If an error is encountered, the <CODE>NewSection</CODE> function returns <CODE>NIL</CODE> in the <CODE>sectionH</CODE> parameter. Otherwise, <CODE>NewSection</CODE> returns a handle to the allocated section record in the <CODE>sectionH</CODE> parameter.<P>
 Set the <CODE>initialMode</CODE> parameter to the update mode for each subscriber and publisher created. You can specify the update mode using these constants:<P>
<PRE>
CONST    sumAutomatic   = 0;     {subscriber receives new }
                                 { editions automatically}
         sumManual      = 1;     {subscriber receives new }
                                 { editions manually}
         pumOnSave      = 0;     {publisher sends new }
                                 { editions on save}
         pumManual      = 1;     {publisher does not send }
                                 { new editions until user }
                                 { request}
</PRE>
 See <A HREF=IAC-319.html#MARKER-9-14>"Using Publisher and Subscriber Options" beginning on page 2-43</A> for detailed information on update modes for publishers and subscribers. See <A HREF=IAC-32.html#MARKER-9-182>Listing 2-4</A> beginning on <A HREF=IAC-32.html#MARKER-9-182>page 2-33</A> for code that uses the <CODE>NewSection</CODE> function to create a publisher. See <A HREF=IAC-33.html#MARKER-9-205>Listing 2-6 on page 2-40</A> for code that uses <CODE>NewSection</CODE> to create a subscriber. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-27.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-29.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
