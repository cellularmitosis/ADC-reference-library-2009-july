<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The Font Directory(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING254></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-253.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-255.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-181.html"><B>Chapter 4 - Font Manager</B></A> / <A HREF="Text-209.html"><B>Font Manager Reference</B></A><BR><DL><DD><A HREF="Text-253.html"><B>The Outline Font ('sfnt') Resource</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING254-0></A>
<H3><A NAME=MARKER-9-469></A><A NAME=MARKER-2-470></A>The Font Directory</H3>
 <A NAME=MARKER-2-449></A>The font directory is a guide to the tables in the outline font resource. It provides you with the information that is needed to efficiently find the other parts of the resource. Each table in the resource has a tag name, a checksum, a location that is defined as an offset in bytes from the first byte of the resource, and a length in bytes. To use the data in a table, you first find the table's tag name in the font directory and then access its data starting at the specified location.<P>
 The font directory consists of an offset component and a variable length array of directory entries, as shown in <A HREF=#MARKER-9-472>Figure 4-17</A>.<P>
<B>Figure 4-17  <A NAME=MARKER-9-472></A>The font directory</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FM-20.jpg">
 The font directory offset component specifies the number of tables in the resource (and thus in the directory component). It contains several values that you can use to optimize searching through the directory components for a tag name:<P>
<UL>
<LI>Version. The version number of the font, given as a 32-bit fixed point number. For version 1.0 of any font, this number is $00010000.
<LI>Number of tables. The number of tables in the outline font resource, not counting the font directory or any subtables in the font. This is an unsigned integer value.
<LI>Search range. An unsigned integer value that is used, along with the entry selector and range shift values, to optimize a binary search through the directory. 
<LI>Entry selector. An unsigned integer value that is used, along with the search range and range shift values, to optimize a binary search through the directory. 
<LI>Range shift. An unsigned integer value that is used, along with the search range and entry selector values, to optimize a binary search through the directory.<P>
</UL>
 The search range, entry selector, and range shift values are used together to construct a binary search through the directory if it is too large for an efficient sequential search. Note, however, that most programs that access kerning data use a linear search and do not make use of these values.<P>
 If a font does contain a large number of tables, you can perform a binary search <BR>of the directory components. You use the range shift value as the initial position in the directory to examine. Compare the tag name of the component at this position with <BR>the one you are searching for. If the target tag name comes before the one you are searching for, search from the beginning of the directory to the range shift position. If the target name comes after the one you are searching for, search from that position to <BR>the end of the directory.<P>
 The font directory table entries are sorted alphabetically by tag name. Each component consists of the following elements:<P>
<UL>
<LI>Tag name. The identifying name for this table, such as <CODE>'cmap'</CODE>.
<LI>Checksum. The checksum for this table, which is the unsigned sum of the long values in the table. This number can be used to verify the integrity of the data in the table. 
<LI>Offset. The offset from the beginning of the outline font resource to the beginning of this table, in bytes.
<LI>Length. The length of this table, in bytes.<P>
</UL>
 <A HREF=#MARKER-9-492>Listing 4-2</A> shows a function that determines the checksum of a given table. <P>
<B>Listing 4-2  <A NAME=MARKER-9-492></A>Calculating the checksum of a given table</B><P>
<PRE>
TYPE
   LongPtr = ^LongInt;

FUNCTION MyCalcTableChecksum (table: LongPtr;
                              lngth: LongInt): LongInt;
VAR
   sum : LongInt;
   mask: LongInt;

BEGIN
   sum := 0;
   WHILE lngth &gt; 0 DO BEGIN
      IF lngth &gt; 3 THEN
         sum := sum + table^
      ELSE BEGIN
         mask := BitShift($FFFFFFFF, 8 * (4 - lngth));
         sum := sum + BitAnd(table^, mask);
         table := LongPtr(ord(table) + 4);
         lngth := lngth - 4;
      END;
   END;
   MyCalcTableChecksum := sum;
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-253.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-255.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
