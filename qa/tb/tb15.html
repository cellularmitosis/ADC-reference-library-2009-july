<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A TB15: Changing the Default Directory for StandardFile Calls</title><meta name="keywords" content="Mac OS 8 changing default directory StandardFile LMGetCurDirStore dialog hook"><meta name="Description" content="Technical Q&amp;A TB15: Q&amp;A details how to programmatically setthe default directory used by StandardFile Calls (LMGetCurDirStore,LMPutCurApRefNum, etc.) by setting up a dialog hook."><meta name="categories" content="Human Interface Toolbox"><meta name="week-posted" content="May 29, 1995 - Jun 2, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002201" title="Changing the Default Directory for StandardFile Calls"></a> <!-- white background --><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A TB15</div>
<div id="pageheadsub">Changing the Default Directory for StandardFile Calls</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER>			<!-- -->						<!-- Document Body --><table cellspacing="0" cellpadding="0" border="0" WIDTH="600"><tr><td align="left" scope="row"><font size="+4">Q</font>  I have been using the StandardFile calls, such as CustomGetFile, CustomPutFile,and so on and changed the directory that they default to. I accomplish this bygetting the current parID and vRefNum and then switching to the folder andvolume I want presented to the user.  I do this by calling routines that Ideveloped which set low-memory globals.<p>I am now using the Apple-developed calls, LMGetCurDirStore(),LMPutCurDirStore(), LMGetCurApRefNum(), and LMPutCurApRefNum(), and I'm havingdifficulty getting the StdFile calls to accept a directory change. It appearsthat the General Controls panel also has options that can affect whichdirectory is defaulted to.</p><p>I want to force the user to see only the directory I present to them. I use amy own application preferences folder under the System Preferences folder asthe home for any document created by my application. Therefore, regardless ofthe General Control settings, I want to go to a specific directory anytimeusers access the New or Open file menu items.</p><p>What is the proper sequence of calls to accomplish this?</p><font size="+4">A</font>  The changes you observed in the StandardFile dialogs with regard to the use ofthe low memory global CurDirStore are the result of a patch we added to theGeneral Controls control panel of System 7.5. This patch was implemented toallow users to control the default directory.<p>With this patch, users can change the behavior of System 7.5 so it is the sameas it was under System 7.0 and 7.1. To do this, they open the General Controlscontrol panel, and under Documents, choose "When opening or saving a document,take me to", then choose "Folder which contains the application".</p><p>Obviously, this user-centered solution is not ideal in your situation. There isone way you can override this new "feature" of System 7.5 programmatically toallow your application to set the default directory used by StandardFile.</p><p>The workaround is to use CustomGetFile and set up a dialog hook, filling in thevalues in the information sent to the dialog hook before you callCustomGetFile. This method is preferable to ensure that your application iscompatible with future revisions of the System software. The code below getsthe vRefNum and dirID of the System's Preferences Folder and defaults to usingthis location each    time CustomGetFile is called. You should be able to usethis on any system which uses CustomGetFile to set up the default directorybefore calling CustomGetFile.</p><pre>/* dialog hook workaround */typedef struct {   StandardFileReply *replyPtr;   FSSpec oldSelection;} SFData, *SFDataPtr;DlgHookYDUPP gDlgHookYDUPP;pascal short MyDlgHook(short item,DialogPtr theDialog,Ptr myDataPtr){ SFDataPtr            sfUserData;   short                foundVRefNum;   long                 foundDirID, refcon;   OSErr                myErr;   /* only for the main dialog box */   refcon = GetWRefCon(theDialog);   if (refcon != sfMainDialogRefCon)   return item;   sfUserData = (SFDataPtr) myDataPtr;   if (item==sfHookFirstCall)     {   return sfHookChangeSelection;    }      return item;   }void TestNewStandardFile (){ SFReply reply;   DialogPtr theDialog;   short item;   StandardFileReply sfReply;   SFData sfUserData;   OSErr err;   Point where = {-1,-1};   short        foundVRefNum;   long         foundDirID, refcon;   sfUserData.replyPtr = &amp;sfReply;   err = FindFolder(kOnSystemDisk, kPreferencesFolderType, kDontCreateFolder,                      &amp;foundVRefNum, &amp;foundDirID);   sfUserData.replyPtr -&gt; sfFile.parID   = foundDirID;   sfUserData.replyPtr -&gt; sfFile.vRefNum = foundVRefNum;   /* just display a custom get file dialog defaulted to the */   /* preferences folder dirID and vRefNum in the dialog hook */   CustomGetFile(nil,-1,nil,&amp;sfReply,700,where,gDlgHookYDUPP,   nil,nil,nil,&amp;sfUserData);} gDlgHookYDUPP = NewDlgHookYDProc(MyDlgHook);/* end of dialog hook workaround */</pre><p>This code sample is a slightly modified version of the dialog-hook example onpage 3-33 of <i>Inside Macintosh:Files</i>. Instead of coding the defaultdirectory into the dialog hook, this code passes the desired target directoryinformation to the Dialog Hook function through the myDataPtr parameter. Thisallows you to default to different directories, depending on which part of yourprogram is using the Dialog Hook. For example, you might want to haveCustomGetFile() default to your Preferences Folder, while CustomPutFile()defaults to the Desktop Folder. You can use the same Dialog Hook as long as yousupply the volume reference number and the directory ID before callingCustomGetFile/CustomPutFile, and you don't have to manipulate low-memoryglobals by calling LMSetCurDirStore and LMSetSFSaveDisk, if you use thistechnique.</p><p>This code works by first obtaining the vRefNum and the dirID for thePreferences folder via the FindFolder call. Then, it assigns the volumereference number and the directory ID to sfUserData. When it callsCustomGetFile(), it includes the address of  sfUserData  as the last parameter(this is the key to the procedure). When CustomGetFile calls the DialogHookroutine, it passes this sfUserData pointer on the stack, making thevolume-reference number and the directory ID obtained with the FindFolder callavailable to the DialogHook.</p><p>In the Dialog Hook function, the sfHookFirstCall constant is a  pseudo-itemthat Standard File sends to your dialog-hook function immediately before itdisplays the CustomGetFile dialog box. The dialog-hook function responds tothis pseudo-item by returning the pseudo-item sfHookChangeSelection. When yourapplication returns this pseudo-item, it is telling Standard File that it wantsit to change the Standard File reply record so that it describes the targetfolder you passed in the myDataPtr field.</p><p>This technique is fairly well-documented on pages 3-21 through 3-40 of<i>Inside Macintosh:Files.</i> Another sample that uses this technique isSettingUpStdFile, which is on the Tool Chest Edition of the Developer CD.</p><p>Don't rely heavily on this technique: the user might not expect the directoryset for standard file to override their preferences set in the general controlpanel. There is also no guarantee that this workaround will continue to workwith future versions of system software.</p><!-- begin_date --><H4 ALIGN=center>[Jun 01 1995]</H4><!-- end_date --></td></tr></table></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/tb/tb15.html%3Fid%3DDTS10002201-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/tb/tb15.html%3Fid%3DDTS10002201-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/tb/tb15.html%3Fid%3DDTS10002201-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>