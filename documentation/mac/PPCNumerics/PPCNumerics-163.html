<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Arithmetic Operations(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING163></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-162.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="PPCNumerics-164.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-144.html"><B>Part 3 - Numerics in PowerPC Assembly Language</B></A><BR><DD><A HREF="PPCNumerics-161.html"><B>Chapter 14 - Assembly-Language Numeric Operations</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING163-0></A>
<H1>Arithmetic Operations</H1>
 <A NAME=MARKER-2-53></A>PowerPC assembly language supports five of the seven IEEE arithmetic operations:<P>
<UL>
<LI>add<A NAME=MARKER-2-34></A>
<LI>subtract<A NAME=MARKER-2-9></A>
<LI>multiply<A NAME=MARKER-2-49></A>
<LI>divide<A NAME=MARKER-2-11></A>
<LI>round-to-integer<P>
</UL>
 Except for the round-to-integer operation, these operations may be performed by a variety of instructions. The instructions that perform arithmetic operations are divided into three categories: arithmetic instructions, multiply-add instructions, and move instructions. (<CODE>fctiw</CODE>, described in <A HREF=PPCNumerics-156.html#MARKER-9-10>Chapter 13, "Assembly-Language Numeric Conversions,"</A> performs the round-to-integer operation.)<P>
<A NAME=HEADING163-8></A>
<H2>Arithmetic Instructions</H2>
 <A NAME=MARKER-2-48></A>There are four arithmetic instructions:
<TABLE BORDER="0" CELLPADDING=3><TD>fadd<TD>Adds two floating-point values.<TR>
<TD>fsub<TD>Subtracts two floating-point values.<TR>
<TD>fmul<TD>Multiplies two floating-point values.<TR>
<TD>fdiv<TD>Divides two floating-point values.</TABLE>
<P>
<DL>
<DT><B>Note</B>
<DD>These instructions might raise floating-point exceptions. See the Motorola <I>PowerPC 601 RISC Microprocessor User's Manual</I> for more information.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Floating-point arithmetic instructions have three operands, all of which are floating-point registers. They are of the form<P>
 <I>instr DST<CODE>,</CODE> SRC1<CODE>,</CODE> SRC2</I> <P>
 Arithmetic instructions are interpreted as<P>
 <I>DST</I> <EM>\xC6 <I>SRC1</I></EM> <I>op SRC2</I> <P>
 where <I>SRC1</I>, <I>SRC2</I>, and <I>DST</I> are floating-point registers and <I>op</I> is some operation.<P>
 Each of these instructions works on both single and double floating-point numbers. There are four versions of each instruction:<P>
<DL>
<DT><I>instr</I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as double format.
<DT><I>instr<CODE>.</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as double format. Record any exceptions raised in the Condition Register.
<DT><I>instr<CODE>s</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as single format.
<DT><I>instr<CODE>s.</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as single format. Record any exceptions raised in the Condition Register.
</DL>
 Note that all exceptions are always recorded in the FPSCR and are sometimes recorded in the Condition Register as well.<P>
 The following example adds two double floating-point numbers and stores the results:<P>
<PRE>
lfd      f1,d(r1)    # load double number into register f1
lfd      f2,d(r2)    # load double number into register f2
fadd     f0,f1,f2    # f0 contains result
stfd     f0,d(r3)    # store result in double format
</PRE>
 And the next example adds two single floating-point numbers and stores the results:<P>
<PRE>
lfs      f1,d(r4)    # load single number into register f1
frsp     f1,f1       # stay single
lfs      f2,d(r5)    # load single number into register f2
frsp     f2,f2       # stay single
fadds.   f0,f1,f2    # result placed in f0 in single format
                     # CR1 reflects any exceptions
stfs     f0,d(r6)    # store result in single format
</PRE>
<A NAME=HEADING163-26></A>
<H2>Multiply-Add Instructions</H2>
 <A NAME=MARKER-2-56></A>There are four multiply-add instructions:
<TABLE BORDER="0" CELLPADDING=3><TD>fmadd<TD>Perform multiply, add.<TR>
<TD>fmsub<TD>Perform multiply, subtract.<TR>
<TD>fnmadd<TD>Perform multiply, add, and negate.<TR>
<TD>fnmsub<TD>Perform multiply, subtract, and negate.</TABLE>
<P>
<DL>
<DT><B>Note</B>
<DD>These instructions might raise floating-point exceptions. See the Motorola <I>PowerPC 601 RISC Microprocessor User's Manual</I> for more information.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 PowerPC assembly language provides the <B>multiply-add instructions</B> to perform more complex operations with at most a single roundoff error rather than the two potential roundoff errors that would result from performing the operations separately.<P>
 The multiply-add instructions take four operands, all of which are floating-point registers:<A NAME=MARKER-2-10></A><P>
 <I>instr   DST<CODE>,</CODE> SRC1<CODE>,</CODE> SRC2<CODE>,</CODE> SRC3</I> <P>
 Multiply-add instructions are interpreted as<P>
 <I>DST</I> <EM>\xC6 </EM>(<I>SRC1</I> <EM></EM> <I>SRC2</I>) \xB1 <I>SRC3</I> <P>
 where <I>SRC1</I>, <I>SRC2</I>, <I>SRC3</I>, and <I>DST</I> are floating-point registers.<P>
 Multiply-add instructions can take one of four forms:<P>
<DL>
<DT><I>instr</I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as double format.
<DT><I>instr<CODE>.</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as double format. Record any exceptions raised in the Condition Register.
<DT><I>instr<CODE>s</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as single format.
<DT><I>instr<CODE>s.</CODE></I> 
<DD> Perform operation specified by <I>instr</I>. Interpret data in floating-point registers as single format. Record any exceptions raised in the Condition Register.
</DL>
 Note that all exceptions are always recorded in the FPSCR and are sometimes recorded in the Condition Register as well.<P>
 The following example multiplies two double-format numbers, adds a third, and stores the result:<P>
<PRE>
lfd      f1,d(r1)    # load double number into register f1
lfd      f2,d(r2)    # load double number into register f2
lfd      f3,d(r3)    # load double number into register f3
fmadd    f0,f1,f2,f3 # f0 = f1  f2 + f3
stfd     f0,d(r4)    # store result as double format
</PRE>
 The following example performs the same operations on single-format numbers:<P>
<PRE>
lfs      f1,d(r5)    # load single number into register f1
frsp     f1,f1       # stay single
lfs      f2,d(r6)    # load single number into register f2
frsp     f2,f2       # stay single
lfs      f3,d(r7)    # load single number into register f3
frsp     f3,f3       # stay single
fmadds.  f0,f1,f2    # f0 = f1  f2 + f3
                     # f0 contains single format number
                     # CR1 reflects any exceptions
stfs     f0,d(r8)    # store result in single format
</PRE>
<A NAME=HEADING163-45></A>
<H2>Move Instructions</H2>
 <A NAME=MARKER-2-60></A>There are four move instructions:
<TABLE BORDER="0" CELLPADDING=3><TD>fabs<TD>Move absolute value of register<A NAME=MARKER-2-18></A>.<TR>
<TD>fmr<TD>Move register value.<TR>
<TD>fneg<TD>Move negative value of register.<TR>
<TD>fnabs<TD>Move negative absolute value of register.</TABLE>
<P>
 Move instructions perform sign manipulations while copying a value from one floating-point register to another. Because they manipulate only the sign bit, they generate no floating-point exceptions. They take two operands, both of which are floating-point registers. They are of the form<P>
 <I>instr   DST<CODE>,</CODE> SRC</I> <P>
 Floating-point move instructions are interpreted as<P>
 <I>DST</I> <EM>\xC6 <I>op</I></EM> <I>SRC</I> <P>
 where <I>SRC</I> and <I>DST</I> are floating-point registers and <I>op</I> is some operation that is performed on the contents of <I>SRC</I>.<P>
 Note that you may copy a value from a register into the same register. For example:<P>
<PRE>
fneg  f1,f1    # f1 has just been negated
</PRE>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="PPCNumerics-162.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="PPCNumerics-164.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
