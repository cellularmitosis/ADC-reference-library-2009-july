<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>ADBOp(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING217></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-216.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-218.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-203.html"><B>Chapter 5 - ADB Manager</B></A> / <A HREF="Devices-208.html"><B>ADB Manager Reference</B></A><BR><DL><DD><A HREF="Devices-213.html"><B>ADB Manager Routines</B></A> / <A HREF="Devices-216.html"><B>Communicating Through the ADB</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING217-0></A>
<H3><A NAME=MARKER-11-211></A><A NAME=MARKER-9-212></A>ADBOp<A NAME=MARKER-2-256></A></H3>
 You can use the <CODE>ADBOp</CODE> function to send a command to an ADB device.<P>
<PRE>
FUNCTION ADBOp (data: Ptr; compRout: ProcPtr; buffer: Ptr; 
                commandNum: Integer): OSErr;
</PRE>
<DL>
<DT><CODE>data</CODE>
<DD> A pointer to an optional data area.
<DT><CODE>compRout</CODE>
<DD> A pointer to a completion routine.
<DT><CODE>buffer</CODE>
<DD> A pointer to a variable-length data buffer. The first byte of the buffer must contain the buffer's length.
<DT><CODE>commandNum</CODE>
<DD> <BR>A command number. The command number is a 1-byte value that encodes the command to be performed, the register the command refers to, and the desired action the target device should perform.
</DL>
<A NAME=HEADING217-7></A>
<H5>DESCRIPTION</H5>
 The <CODE>ADBOp</CODE> function transmits over the bus the command byte whose value is given by the <CODE>commandNum</CODE> parameter. See <A HREF=Devices-205.html#MARKER-9-54>Figure 5-2 on page 5-8</A> for the structure of this command byte. For a Listen command, the ADB Manager also transmits the data pointed to by the <CODE>buffer</CODE> parameter. Upon completion of a Talk command, the area pointed to by the <CODE>buffer</CODE> parameter contains the data returned by the ADB device. The<CODE> ADBOp</CODE> function executes only when the ADB would otherwise be idle; if the bus is busy, the command byte is held in a command queue. If the command queue is full, the <CODE>ADBOp</CODE> function returns an error and the command is not placed in the queue.<P>
 The length of the data buffer pointed to by the <CODE>buffer</CODE> parameter must be contained in its first byte (in the same manner that the first byte of a Pascal string contains the length of the string). The data buffer can include from 0 to 8 bytes of information. For a Listen command, the data buffer should contain any data to be sent to the device. For a Talk  command, the contents of the data buffer are valid only on completion of the command. To verify that the Talk command is completed, you should provide a completion routine when you send the command to an ADB device or simply test the value of the first byte of the data buffer (which contains the length of the buffer).<P>
 The optional data area to which the <CODE>data</CODE> parameter points is intended for storage used by the completion routine pointed to by the <CODE>compRout</CODE> parameter. When you use <CODE>ADBOp</CODE> to send a command, you can optionally supply a completion routine as a parameter. See <A HREF=Devices-227.html#MARKER-9-228>"ADB Command Completion Routines,"</A> beginning on <A HREF=Devices-227.html#MARKER-9-228>page 5-47</A> for details on completion routines.<P>
<A NAME=HEADING217-11></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The <CODE>ADBOp</CODE> function is always executed asynchronously. The result code returned by <CODE>ADBOp</CODE> indicates only whether the ADB command was successfully placed into the ADB command queue, not whether the command itself was successful. A method for interacting with the ADB bus synchronously is illustrated in <A HREF=Devices-206.html#MARKER-9-156>"Communicating With ADB Devices,"</A> beginning on <A HREF=Devices-206.html#MARKER-9-156>page 5-24</A>.<P>
<A NAME=HEADING217-13></A>
<H5><A NAME=MARKER-9-214></A>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The ADB operation block contains some of the information required by the <CODE>ADBOp</CODE> function. You'll need to set up an ADB operation block only if you call <CODE>ADBOp</CODE> from assembly-language. (In Pascal, the ADB operation block is defined by the<CODE> ADBOpBlock</CODE> data type.)<P>
 The registers on entry and exit for <CODE>ADBOp</CODE> are
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT colspan=2>Registers on entry<TR>
<TD>A0<TD>Address of a parameter block of type <CODE>ADBOpBlock</CODE><TR>
<TD>D0<TD>A command number<TR>
<TD colspan=2>Registers on exit<TR>
<TD>D0<TD>Result code</TABLE>
<P>
 The parameter block whose address is passed in register A0 has this structure<P>
<B>:
<TABLE BORDER="0" CELLPADDING=3><TD><EM>--></EM><TD>dataBuffPtr<TD>Ptr<TD>A pointer to a variable-length data buffer. The first byte of the buffer must contain the buffer's length.<TR>
<TD><EM>--></EM><TD>opServiceRtPtr<TD>Ptr<TD>A pointer to a completion routine.<TR>
<TD><EM>--></EM><TD>opDataAreaPtr<TD>Ptr<TD>A pointer to an optional data area.</TABLE>
</B><P>
<A NAME=HEADING217-18></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>errADBOp<TD>-1<TD>Command queue is full. Retry command.</TABLE>
</H5>
<A NAME=HEADING217-19></A>
<H5>SEE ALSO</H5>
 See <A HREF=Devices-206.html#MARKER-9-160>Listing 5-2 on page 5-25</A> for an example of using the <CODE>ADBOp</CODE> function. <A NAME=MARKER-2-215></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-216.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-218.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
