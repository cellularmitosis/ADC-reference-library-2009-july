<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Displaying Messages When the Finder Can't Find  Your Application(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING453></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-452.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-454.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-443.html"><B>Chapter 7 - Finder Interface</B></A> / <A HREF="Toolbox-446.html"><B>Using the Finder Interface</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING453-0></A>
<H2><A NAME=MARKER-9-309></A><A NAME=MARKER-21-310></A>Displaying Messages When the Finder Can't Find <BR>Your Application</H2>
 <A NAME=MARKER-2-311></A><A NAME=MARKER-2-312></A>When the user double-clicks a file or selects it and chooses either the Open or the Print command from the Finder's File menu, the Finder looks for the application whose signature is stored in the file's creator field. The Finder starts up that application and tells it which documents the user wants to open or print. If the Finder cannot find the creator application, it displays an alert box.<P>
 If the document is of file type <CODE>'TEXT'</CODE> or <CODE>'PICT'</CODE> and if the TeachText application is available, an alert box asks the user whether the TeachText application should be <BR>used to open the document. For documents of any other file type, or if the TeachText application is not present, the Finder displays an alert box like the one shown in <BR><A HREF=#MARKER-9-313>Figure 7-9</A>. Your application should store one of two string resources in its documents <BR>to make the alert box message more useful than the default shown in <A HREF=#MARKER-9-313>Figure 7-9</A>.<P>
<B>Figure 7-9  <A NAME=MARKER-9-313></A><A NAME=MARKER-21-314></A>The default application-unavailable alert box</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FI-S-03.jpg"><P>
 <A NAME=MARKER-2-315></A><A NAME=MARKER-2-316></A><A NAME=MARKER-2-317></A><A NAME=MARKER-2-318></A>Before displaying the default message shown in <A HREF=#MARKER-9-313>Figure 7-9</A>, the Finder looks in the <BR>document for one of two special <CODE>'STR '</CODE> resources with resource ID numbers of -16396 and -16397: the missing-application name string and the application-missing message string, respectively. If the Finder can't find the document's creator on any mounted <BR>volume, it looks first for the application-missing message string resource. Provide an <BR>application-missing message string resource if you do not intend for users to open the file. The message should explain why the file can't be opened. If the Finder does not find an application-missing message string resource, it looks for the missing-application name string resource. Provide a missing-application name string resource if you intend for users to open the file. The missing-application name string should be your application's name; the Finder displays it in an alert box to inform the user that your application is needed.<P>
 Supply either the application-missing message string resource or the missing-application name string resource; don't supply both. Supply an application-missing message string resource for documents (such as a preferences file) that your application uses but that users should not open; supply a missing-application name string resource for documents that you intend for users to open with your application.<P>
 Your missing-application name string resource (an <CODE>'STR '</CODE> resource with a resource ID number of -16396) should contain the name of your application. <A HREF=#MARKER-9-319>Listing 7-5</A> on the next page shows a missing-application name string resource for the SurfWriter application.<P>
<B>Listing 7-5  <A NAME=MARKER-9-319></A>Rez input for a missing-application name string resource</B><P>
<PRE>
resource 'STR ' (-16396, purgeable) {  /*the application name*/
   &quot;SurfWriter&quot;
};
</PRE>
 You can store this resource in the resource fork of your application. When your application saves a document for the first time, it should copy the missing-application name string resource from your application's resource fork to the resource fork of the newly created document. <A HREF=#MARKER-9-320>Listing 7-6</A> shows a fragment of an application-defined function called <CODE>DoSaveAsCmd</CODE>, which the application calls when the user chooses the Save As command from the File menu. (For a description of the File Manager routines used here to create, open, and save the resource file, see <I><A HREF="../Files/Files-2.html">Inside Macintosh: Files</A></I>.)<P>
<B>Listing 7-6  <CODE><A NAME=MARKER-9-320></A>Storing a missing-application name string resource in the resource fork of <BR>a document</CODE></B><P>
<PRE>
VAR
   myData:  MyDocRecHnd;   {handle to document record}
   myErr:   OSErr;
   myFile:  Integer;       {file reference number}

{with the DoSaveAsCmd routine: create document's resource fork}
FSpCreateResFile(myData^^.fileFSSpec, 'MYAP', 'TEXT',
                  smSystemScript);
myErr := ResError;
IF myErr = noErr THEN   {open the resource fork}
   myFile := FSpOpenResFile(myData^^.fileFSSpec, fsRdWrPerm);
IF myFile &gt; 0 THEN   {copy the missing-application name string}
   myErr := DoCopyResource('STR ', -16396, gAppsResFile, myFile)
ELSE
   myErr := ResError;
IF myErr = noErr THEN
   myErr := FSClose(myFile);  {close the resource fork}
</PRE>
 <A HREF=#MARKER-9-321>Listing 7-7</A> shows the application-defined function <CODE>DoCopyResource</CODE>, which copies the missing-application name string resource from the application's resource fork into the newly created document's resource fork. (For a description of the Resource Manager routines used here to set, open, and write the resource file, see the chapter "Resource Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.)<P>
<B>Listing 7-7  <A NAME=MARKER-9-321></A>Copying the missing-application name string resource into the resource fork of <BR>a document</B><P>
<PRE>
FUNCTION DoCopyResource (theType: ResType; theID: Integer; 
                         source: Integer; dest: Integer): OSErr;
VAR
   myHandle:   Handle;  {handle to resource to copy}
   myName:     Str255;  {name of resource to copy}
   myType:     ResType; {ignored; used for GetResInfo}
   myID:       Integer; {ignored; used for GetResInfo}

BEGIN
   UseResFile(source);  {set the source resource file}
   myHandle := GetResource(theType, theID);  {open the source}
   IF myHandle &lt;&gt; NIL THEN
   BEGIN
      GetResInfo(myHandle, myID, myType, myName);  {get resource }
                                                   { name}
      DetachResource(myHandle);  {detach resource}
      UseResFile(dest);    {set the destination resource file}
      AddResource(myHandle, theType, theID, myName);
      IF ResError = noErr THEN
         WriteResource(myHandle);   {write resource data}
   END;
   DoCopyResource := ResError;      {return result code}
END;
</PRE>
 If a user tries to open or print one of the application's documents when the application is not present, the Finder specifies the application's name in the alert box, as illustrated in <A HREF=#MARKER-9-322>Figure 7-10</A>.<P>
<B>Figure 7-10  <A NAME=MARKER-9-322></A><A NAME=MARKER-21-323></A>The application-unavailable alert box specifying an application's name</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FI-S-02.jpg"><P>
 Your application-missing message string resource (an <CODE>'STR '</CODE> resource with a <BR>resource ID number of -16397) should explain why the user cannot open or print a document. Use this resource for files--such as your application's preferences file--<BR>that are not intended to be opened or printed by the user. Register a signature (as explained in <A HREF=Toolbox-447.html#MARKER-9-108>"Giving a Signature to Your Application and a Creator and a File Type to Your Documents" beginning on page 7-7</A>) that is different from the signature of your application and set this signature as the creator of files that you don't want your users to open. This ensures that the Finder displays your message instead of launching your application when the user double-clicks these documents.<A NAME=MARKER-2-324></A> <P>
 <A HREF=#MARKER-9-325>Listing 7-8</A> illustrates an application-missing string resource that explains why a user cannot open a preferences file.<P>
<B>Listing 7-8  <A NAME=MARKER-9-325></A>Rez input for an application-missing message string resource</B><P>
<PRE>
resource 'STR ' (-16397, purgeable) {/*the message*/
   &quot;This document describes user preferences for the application &quot;
&quot;SurfWriter. You cannot open or print this document. To be &quot;
&quot;effective, this document must be stored in the Preferences &quot;
&quot;folder in the System Folder.&quot;
};
</PRE>
 <A HREF=#MARKER-9-332>Figure 7-11</A> shows the alert box generated by <A HREF=#MARKER-9-325>Listing 7-8</A>.<A NAME=MARKER-2-326></A><A NAME=MARKER-2-327></A><A NAME=MARKER-2-328></A><A NAME=MARKER-2-329></A><A NAME=MARKER-2-330></A><A NAME=MARKER-2-331></A><P>
<B>Figure 7-11  <A NAME=MARKER-9-332></A><A NAME=MARKER-21-333></A>The application-unavailable alert box with a customized message</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FI-S-05.jpg"><P>
 Note that if your application creates documents of file type <CODE>'TEXT'</CODE> or <CODE>'PICT'</CODE>, if <BR>the TeachText application is available, and if your application is missing when the <BR>user tries to open these documents from the Finder, the Finder always displays the <BR>alert box shown in <A HREF=#MARKER-9-334>Figure 7-12</A>. For these file types, the Finder displays this alert box even if you provide missing-application name string resource or application-missing message string resource.<P>
<B>Figure 7-12  <A NAME=MARKER-9-334></A><A NAME=MARKER-21-335></A>The application-unavailable alert box for <CODE>'TEXT'</CODE> and <CODE>'PICT'</CODE> documents</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FI-S-06.jpg"><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-452.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-454.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
