<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>GLUT - /macx_input.m</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/GraphicsImaging/index.html">Graphics & Imaging</a> &gt; <a href="../../samplecode/GraphicsImaging/idxOpenGL-date.html">OpenGL</a> &gt; <A HREF="javascript:location.replace('index.html');">GLUT</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">GLUT</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/macx_input.m</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/gle/copy.h</option>
<option value="listing2.html">/gle/ex_angle.c</option>
<option value="listing3.html">/gle/ex_cut_round.c</option>
<option value="listing4.html">/gle/ex_raw.c</option>
<option value="listing5.html">/gle/extrude.c</option>
<option value="listing6.html">/gle/extrude.h</option>
<option value="listing7.html">/gle/gle_osx.h</option>
<option value="listing8.html">/gle/gutil.h</option>
<option value="listing9.html">/gle/intersect.c</option>
<option value="listing10.html">/gle/intersect.h</option>
<option value="listing11.html">/gle/port.h</option>
<option value="listing12.html">/gle/rot.h</option>
<option value="listing13.html">/gle/rot_prince.c</option>
<option value="listing14.html">/gle/rotate.c</option>
<option value="listing15.html">/gle/round_cap.c</option>
<option value="listing16.html">/gle/segment.c</option>
<option value="listing17.html">/gle/segment.h</option>
<option value="listing18.html">/gle/texgen.c</option>
<option value="listing19.html">/gle/tube.h</option>
<option value="listing20.html">/gle/tube_gc.h</option>
<option value="listing21.html">/gle/urotate.c</option>
<option value="listing22.html">/gle/view.c</option>
<option value="listing23.html">/gle/vvector.h</option>
<option value="listing24.html">/glsmap/glsmap.h</option>
<option value="listing25.html">/glsmap/glsmapint.h</option>
<option value="listing26.html">/glsmap/smap_buildsmap.c</option>
<option value="listing27.html">/glsmap/smap_context.c</option>
<option value="listing28.html">/glsmap/smap_create.c</option>
<option value="listing29.html">/glsmap/smap_destroy.c</option>
<option value="listing30.html">/glsmap/smap_drawmesh.c</option>
<option value="listing31.html">/glsmap/smap_flag.c</option>
<option value="listing32.html">/glsmap/smap_get.c</option>
<option value="listing33.html">/glsmap/smap_getfunc.c</option>
<option value="listing34.html">/glsmap/smap_gettexdim.c</option>
<option value="listing35.html">/glsmap/smap_gettexobj.c</option>
<option value="listing36.html">/glsmap/smap_getvec.c</option>
<option value="listing37.html">/glsmap/smap_makemesh.c</option>
<option value="listing38.html">/glsmap/smap_nearfar.c</option>
<option value="listing39.html">/glsmap/smap_origin.c</option>
<option value="listing40.html">/glsmap/smap_render.c</option>
<option value="listing41.html">/glsmap/smap_rvec2st.c</option>
<option value="listing42.html">/glsmap/smap_set.c</option>
<option value="listing43.html">/glsmap/smap_setfunc.c</option>
<option value="listing44.html">/glsmap/smap_setvec.c</option>
<option value="listing45.html">/glsmap/smap_texdim.c</option>
<option value="listing46.html">/glsmap/smap_texobj.c</option>
<option value="listing47.html">/glut.h</option>
<option value="listing48.html">/glut_8x13.c</option>
<option value="listing49.html">/glut_9x15.c</option>
<option value="listing50.html">/glut_bitmap.c</option>
<option value="listing51.html">/glut_bwidth.c</option>
<option value="listing52.html">/glut_cindex.c</option>
<option value="listing53.html">/glut_ext.c</option>
<option value="listing54.html">/glut_hel10.c</option>
<option value="listing55.html">/glut_hel12.c</option>
<option value="listing56.html">/glut_hel18.c</option>
<option value="listing57.html">/glut_mroman.c</option>
<option value="listing58.html">/glut_roman.c</option>
<option value="listing59.html">/glut_shapes.c</option>
<option value="listing60.html">/glut_stroke.c</option>
<option value="listing61.html">/glut_swidth.c</option>
<option value="listing62.html">/glut_teapot.c</option>
<option value="listing63.html">/glut_tr10.c</option>
<option value="listing64.html">/glut_tr24.c</option>
<option value="listing65.html">/glut_vidresize.c</option>
<option value="listing66.html">/GLUTApplication.h</option>
<option value="listing67.html">/GLUTApplication.m</option>
<option value="listing68.html">/glutbitmap.h</option>
<option value="listing69.html">/GLUTClipboardController.h</option>
<option value="listing70.html">/GLUTClipboardController.m</option>
<option value="listing71.html">/glutf90.h</option>
<option value="listing72.html">/GLUTMenu.h</option>
<option value="listing73.html">/GLUTMenu.m</option>
<option value="listing74.html">/GLUTMenuItem.h</option>
<option value="listing75.html">/GLUTMenuItem.m</option>
<option value="listing76.html">/GLUTPreferencesController.h</option>
<option value="listing77.html">/GLUTPreferencesController.m</option>
<option value="listing78.html">/glutstroke.h</option>
<option value="listing79.html">/GLUTView.h</option>
<option value="listing80.html">/GLUTView.m</option>
<option value="listing81.html">/GLUTWindow.h</option>
<option value="listing82.html">/GLUTWindow.m</option>
<option value="listing83.html">/HID_Config_Utilities.c</option>
<option value="listing84.html">/HID_Config_Utilities.h</option>
<option value="listing85.html">/HID_Error_Handler.c</option>
<option value="listing86.html">/HID_Error_Handler.h</option>
<option value="listing87.html">/HID_Name_Lookup.c</option>
<option value="listing88.html">/HID_Name_Lookup.h</option>
<option value="listing89.html">/HID_Queue_Utilities.c</option>
<option value="listing90.html">/HID_Queue_Utilities.h</option>
<option value="listing91.html">/HID_Utilities.c</option>
<option value="listing92.html">/HID_Utilities.h</option>
<option value="listing93.html">/HID_Utilities_External.h</option>
<option value="listing94.html">/HID_Utilities_Internal.h</option>
<option value="listing95.html">/libForeground.a</option>
<option value="listing96.html">/macx_cursor.m</option>
<option value="listing97.html">/macx_dials.m</option>
<option value="listing98.html">/macx_dstr.m</option>
<option value="listing99.html">/macx_event.m</option>
<option value="listing100.html">/macx_fortran.m</option>
<option value="listing101.html">/macx_gamemode.m</option>
<option value="listing102.html">/macx_get.m</option>
<option value="listing103.html">/macx_glut.h</option>
<option value="listing104.html">/macx_init.m</option>
<option value="listing105.html">/macx_input.m</option>
<option value="listing106.html">/macx_joy.m</option>
<option value="listing107.html">/macx_key.m</option>
<option value="listing108.html">/macx_menu.m</option>
<option value="listing109.html">/macx_modifier.m</option>
<option value="listing110.html">/macx_overlay.m</option>
<option value="listing111.html">/macx_space.m</option>
<option value="listing112.html">/macx_swap.m</option>
<option value="listing113.html">/macx_tablet.m</option>
<option value="listing114.html">/macx_util.m</option>
<option value="listing115.html">/macx_utilities.h</option>
<option value="listing116.html">/macx_warp.m</option>
<option value="listing117.html">/macx_win.m</option>
<option value="listing118.html">/ReadMe.txt</option></select>
				</p>
				</form>
				<p><strong><a href="glut.zip">Download Sample</a></strong> (&#147;glut.zip&#148;, 374.3K)<BR>
<strong><a href="glut.dmg">Download Sample</a></strong> (&#147;glut.dmg&#148;, 680.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">
/* Copyright (c) Dietmar Planitzer, 1998, 2002 */

/* This program is freely distributable without licensing fees 
   and is provided without guarantee or warrantee expressed or 
   implied. This program is -not- in the public domain. */

#import &quot;macx_glut.h&quot;
#import &quot;GLUTView.h&quot;
#import &lt;IOKit/hid/IOHIDLib.h&gt;
#import &lt;Kernel/IOKit/hidsystem/IOHIDUsageTables.h&gt;


static int    __glutNumMouseButtons = 0;
static BOOL    __glutHaveInputDevices = NO;


void __glutForgetInputDevices(void)
{
   // ensure HID stuff is torn down on app exit
    HIDReleaseDeviceList();
}

/**
 * Builds the global HID list. This list contains all input devices of the
 * following classes:
 *        Mouse
 *        Keyboard / Keypad
 *        Joystick / Gamepad
 * NOTE: This function must be called before any other HID related one.
 */
void __glutCollectInputDevices(void)
{
    UInt32    aUsage[5];
    UInt32    aUsagePage[5];

    // find all
    aUsagePage[0] = 0;
    aUsage[0] = 0;

    HIDUpdateDeviceList(aUsagePage, aUsage, 1); // will do the right thing the first time
}

// This function will set up the input devices only the first time it is called.
void __glutCollectInputDevicesOnce(void)
{
    if(!__glutHaveInputDevices) {
        __glutCollectInputDevices();
        __glutHaveInputDevices = YES;
    }
}

void __glutGetInputDeviceEnumeratorOfClass(int cl, GLUTDeviceEnumerator *enumer)
{
    __glutCollectInputDevicesOnce();

    enumer-&gt;typeDevice = cl; // will sort later
    enumer-&gt;curDevice = HIDGetFirstDevice();
    enumer-&gt;done = (enumer-&gt;curDevice == NULL);
}

pRecDevice __glutGetNextInputDevice(GLUTDeviceEnumerator *enumer)
{
    pRecDevice    dev = enumer-&gt;curDevice;
    UInt32        foundIt = NO;
    SInt32        usagePage[2], usage[2];
    SInt32        numTypes = 0, i;
    if(enumer-&gt;done)
        return NULL;
    
    // scan device list for next device matching the required
    // usage page and usage values
    while(dev) {
        switch (enumer-&gt;typeDevice) {
            case GLUT_MOUSE_DEVICE:
                // find pointing devices
                usagePage[0] = kHIDPage_GenericDesktop;
                usage[0] = kHIDUsage_GD_Mouse;
                numTypes = 1;
                break;
                
            case GLUT_KEYBOARD_DEVICE:
                // find keyboards and keypads
                usagePage[0] = kHIDPage_GenericDesktop;
                usage[0] = kHIDUsage_GD_Keyboard;
                usagePage[1] = kHIDPage_GenericDesktop;
                usage[1] = kHIDUsage_GD_Keypad;
                numTypes = 2;
                break;
                
            case GLUT_JOYSTICK_DEVICE: // ggs: fix me, find all two axis non-relative devices
                // find joysicks and gamepads
                usagePage[0] = kHIDPage_GenericDesktop;
                usage[0] = kHIDUsage_GD_Joystick;
                usagePage[1] = kHIDPage_GenericDesktop;
                usage[1] = kHIDUsage_GD_GamePad;
                numTypes = 2;
                break;
            case GLUT_SPACEBALL_DEVICE:// ggs: fix me, find all 6 axis x, y, z, rx, ry, rz devices
                numTypes = 0;
                break;
   
        }
        for(i = 0; i &lt; numTypes; i++) {
            if((usagePage[i] == dev-&gt;usagePage) &amp;&amp;
               (usage[i] == dev-&gt;usage)) {
            foundIt = YES;
            break;
            }
        }
        // additional check for joysticks
        if ((enumer-&gt;typeDevice == GLUT_JOYSTICK_DEVICE) &amp;&amp; // look also for 2 axis, non-mouse axis devices
            !((kHIDPage_GenericDesktop == dev-&gt;usagePage) &amp;&amp;
            (kHIDUsage_GD_Mouse == dev-&gt;usage)) &amp;&amp;
            (2 &lt;= dev-&gt;axis))
            foundIt = YES;
        // addtional check for spaceballs (note this is only thing that find spaceballs (since above numTypes is 0)
        if ((enumer-&gt;typeDevice == GLUT_SPACEBALL_DEVICE) &amp;&amp; // look only for device with 6 axis or more
            (6 &lt;= dev-&gt;axis))
            foundIt = YES;
        
        // have we found one of the required devices ?
        if(foundIt) {
            enumer-&gt;curDevice = HIDGetNextDevice(dev);
            enumer-&gt;done = (enumer-&gt;curDevice == NULL);
            return dev;
        }
        
        dev = HIDGetNextDevice(dev);
    }
    
    // haven't found any suitable device, though checked all devices
    enumer-&gt;done = YES;
    enumer-&gt;curDevice = NULL;
    return NULL;
}

BOOL __glutIsInputDeviceConnected(pRecDevice device)
{
   pRecDevice pDevice = HIDGetFirstDevice(); // get the first device

   while(pDevice) {
      if(device == pDevice)
         return YES;
      
      pDevice = HIDGetNextDevice(pDevice); // check next device
   }
   return NO;
}

void HIDReportError (char * strError);
void HIDReportErrorNum (char * strError, int numError);

int GetHighestMouseButtonCount ()
{
    int highestButtonCount;
    IOReturn result = kIOReturnSuccess;
    mach_port_t masterPort = 0;
    CFMutableDictionaryRef hiPointingDictionary = NULL;
    io_iterator_t hidObjectIterator = 0;
    io_object_t ioHIDDeviceObject = 0;
    highestButtonCount = 0;

    if (kIOReturnSuccess != IOMasterPort (bootstrap_port, &amp;masterPort))
        HIDReportError (&quot;HIDCreateMultiTypeDeviceList: IOMasterPort error with bootstrap_port.&quot;);
    else
    {
        hiPointingDictionary = IOServiceMatching (&quot;IOHIPointing&quot;);
        result = IOServiceGetMatchingServices (masterPort, hiPointingDictionary, &amp;hidObjectIterator);

        if (0 != hidObjectIterator) 
        {
            while ((ioHIDDeviceObject = IOIteratorNext (hidObjectIterator)))
            {
                int currDeviceButtonCount;
                
                CFTypeRef property = IORegistryEntryCreateCFProperty (ioHIDDeviceObject, CFSTR(kIOHIDPointerButtonCountKey), kCFAllocatorDefault, kNilOptions);
                if (NULL != property)
                {
                    CFNumberGetValue(property, kCFNumberIntType, &amp;currDeviceButtonCount);
                    CFRelease(property);
                
                    if (currDeviceButtonCount &gt; highestButtonCount)
                        highestButtonCount = currDeviceButtonCount;
                }
                
                // dump device object, it is no longer needed
                result = IOObjectRelease (ioHIDDeviceObject);
                if (KERN_SUCCESS != result)
                    HIDReportErrorNum (&quot;IOObjectRelease error with ioHIDDeviceObject.&quot;, result);
            }
            result = IOObjectRelease (hidObjectIterator); // release the iterator
            if (kIOReturnSuccess != result) 
                HIDReportErrorNum (&quot;IOObjectRelease error with hidObjectIterator.&quot;, result);
        }
    }
    
    return highestButtonCount;
}

int __glutGetNumberOfMouseButtons(void)
{
    __glutNumMouseButtons = GetHighestMouseButtonCount();
   
    if(__glutNumMouseButtons == 0) {
        // some pointer devices i.e. some touchpads shipped with laptops don't
        // have a button count property and can return 0 so return 1 in that case
        __glutNumMouseButtons = 1;
    }

    return __glutNumMouseButtons;
}


  /* CENTRY */
  int APIENTRY glutDeviceGet(GLenum param)
  {
    int    ival = 0;
    GLUTAPI_DECLARATIONS
    
    GLUTAPI_BEGIN
      switch(param) {
          case GLUT_HAS_KEYBOARD:
          case GLUT_HAS_MOUSE:
             ival = 1;
          break;
          case GLUT_HAS_JOYSTICK:
              if (__glutGetJoystickNumButtons() || (__glutGetJoystickNumAxis() &gt;= 2)) // if we have buttons or axis
                 ival = 1;
          break;
          case GLUT_NUM_MOUSE_BUTTONS:
                 ival = __glutGetNumberOfMouseButtons();
             break;
          case GLUT_HAS_SPACEBALL:
              if (__glutGetSpaceballNumButtons() || (__glutGetSpaceballNumAxis() == 6)) // if we have buttons or 
                 ival = 1;
          break;
        case GLUT_NUM_SPACEBALL_BUTTONS:
              ival = __glutGetSpaceballNumButtons();
          break;
          case GLUT_HAS_DIAL_AND_BUTTON_BOX:
          case GLUT_HAS_TABLET:
          case GLUT_NUM_BUTTON_BOX_BUTTONS:
          case GLUT_NUM_DIALS:
          case GLUT_NUM_TABLET_BUTTONS:
             ival =  0;
          break;
          case GLUT_JOYSTICK_BUTTONS:
             ival = __glutGetJoystickNumButtons ();
          break;
          case GLUT_JOYSTICK_AXES:
             ival = __glutGetJoystickNumAxis ();
          break;
          case GLUT_DEVICE_IGNORE_KEY_REPEAT:
             ival = [__glutCurrentView ignoreKeyRepeats];
          break;
          case GLUT_DEVICE_KEY_REPEAT:
         ival = __glutGetDeviceKeyRepeat();
          break;
          case GLUT_JOYSTICK_POLL_RATE:
             ival = (int)([__glutCurrentView joystickPollInterval] * 1000.0);
          break;
          default:
              __glutWarning(&quot;invalid glutDeviceGet parameter: %d&quot;, param);
             ival = -1;
          break;
      }
    GLUTAPI_END
    
    return ival;
  }
  /* ENDCENTRY */
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/glut/listing105.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/glut/listing105.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/glut/listing105.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>