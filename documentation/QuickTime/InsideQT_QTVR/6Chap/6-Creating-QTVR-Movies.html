<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime VR: QuickTime VR  Movie Structure</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="QuickTime VR  Movie Structure"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000944-CH209" title="QuickTime VR  Movie Structure"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../VirtualReality-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000589" target="_top">Virtual Reality</a> &gt; <a href="../0Preface/QTVR-preface.html#//apple_ref/doc/uid/TP40000944-CH204-DontLinkElementID_2">QuickTime VR</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../4Chap/4-QTVR-Manager.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../5Chap/5-QTVR-Movie-Controller.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_111" title="QuickTime VR  Movie Structure"></a><h1><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIBDDFI" title="QuickTime VR  Movie Structure"></a>QuickTime VR  Movie Structure</h1><p>This chapter describes the format of the tracks that make up a QuickTime VR movie file. The information in this chapter, combined with the information in <span class="content_text"><a href="../7Chap/7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJJCAGC">“Chapter 7, QTVR Atom Containers,”</a></span> and the overview from <span class="content_text"><a href="../2Chap/2-QTVR-Authoring.html#//apple_ref/doc/uid/TP40000944-CH206-BAJGAGFA">“Chapter 2, QuickTime VR Panoramas and Object Movies,”</a></span> will enable you to add to your application the ability to create QuickTime VR movies. </p><p>The term <em>QuickTime VR file format</em> is used in various sections throughout this chapter, even though it is a bit of a misnomer because the chapter does not describe the details of exactly where data is stored in a file nor does it describe the format of the standard QuickTime movie atoms. That information is available in the <em>QuickTime API Reference</em>, and in the <em>QuickTime File Format</em> (see bibliography). However, you don’t need to know that level of detail in order to create QuickTime VR movies, since QuickTime provides several routines for creating movies. </p><p>The chapter describes the file format supported by the QuickTime VR Manager. It is comprised of one major section: <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIEIHJI">“Elements of a QuickTime VR Movie,”</a></span> which discusses a number of topics that are important in understanding the basic structure of a panoramic movie: </p><ul class="ul"><li class="li"><p>Single-node panoramic movies are explained, followed by a discussion of multinode QuickTime VR movies which can contain any number of object and panoramic nodes. </p></li><li class="li"><p>QTVR tracks are also discussed, in addition to the new type of panorama introduced in QuickTime 5: the cubic panorama. This panorama, represented by six faces of a cube, is designed to extend QuickTime VR’s functionality by enabling the viewer to see all the way up and all the way down. </p></li></ul><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIEIHJI" title="Elements of a QuickTime VR Movie"></a><h2>Elements of a QuickTime VR Movie</h2><p>A QuickTime VR movie is stored on disk in a format known as the <strong>QuickTime VR file format</strong>. Beginning in QuickTime VR 2.0, a QuickTime VR movie could contain one or more nodes. Each node is either a panorama or an object. In addition, a QuickTime VR movie could contain various types of hot spots, including links between any two types of nodes.</p><p>All QuickTime VR movies contain a single <strong>QTVR track</strong>, a special type of QuickTime track that maintains a list of the nodes in the movie. Each individual sample in a QTVR track contains general information and hot spot information for a particular node. </p><p>If a QuickTime VR movie contains any panoramic nodes, that movie also contains a single <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_309"></a><strong>panorama track</strong>, and if it contains any object nodes, it also contains a single <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_310"></a><strong>object track</strong>. The panorama and object tracks contain information specific to the panoramas or objects in the movie. The actual image data for both panoramas and objects is usually stored in standard QuickTime video tracks, hereafter referred to as <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_311"></a><strong>image tracks</strong>. (An image track can also be any type of track that is capable of displaying an image, such as a QuickTime 3D track.) The individual frames in the image track for a panorama make up the diced frames of the original single panoramic image. The frames for the image track of an object represent the many different views of the object. Hot spot image data is stored in parallel video tracks for both panoramas and objects.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF101" title="Single-Node Panoramic Movies"></a><h3>Single-Node Panoramic Movies</h3><p><span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCICFIDG">Figure 5-1</a></span> illustrates the basic structure of a single-node panoramic movie. As you can see, every panoramic movie contains at least three tracks: a QTVR track, a panorama track, and a panorama image track.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_112" title="Figure 5-1The structure of a single-node panoramic movie file"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCICFIDG" title="Figure 5-1The structure of a single-node panoramic movie file"></a><strong>Figure 5-1&nbsp;&nbsp;</strong>The structure of a single-node panoramic movie file</p><img src = "../art/qtvr_l_08.gif" alt = "The structure of a single-node panoramic movie file" width="494" height="124"></div><br/><p>For a single-node panoramic movie, the QTVR track contains just one sample. There is a corresponding sample in the panorama track, whose time and duration are the same as the time and duration of the sample in the QTVR track. The time base of the movie is used to locate the proper video samples in the panorama image track. For a panoramic movie, the video sample for the first diced frame of a node’s panoramic image is located at the same time as the corresponding QTVR and panorama track samples. The total duration of all the video samples is the same as the duration of the corresponding QTVR sample and the panorama sample.</p><p>A panoramic movie can contain an optional hot spot image track and any number of standard QuickTime tracks. A panoramic movie can also contain panoramic image tracks with a lower resolution. The video samples in these low-resolution image tracks must be located at the same time and must have the same total duration as the QTVR track. Likewise, the video samples for a hot spot image track, if one exists, must be located at the same time and must have the same total duration as the QTVR track.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF102" title="Single-Node Object Movies"></a><h3>Single-Node Object Movies</h3><p><span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIIHICG">Figure 5-2</a></span> illustrates the basic structure of a single-node object movie. As you can see, every object movie contains at least three tracks: a QTVR track, an object track, and an object image track.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_113" title="Figure 5-2The structure of a single-node object movie file"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIIHICG" title="Figure 5-2The structure of a single-node object movie file"></a><strong>Figure 5-2&nbsp;&nbsp;</strong>The structure of a single-node object movie file</p><img src = "../art/qtvr_l_07.gif" alt = "The structure of a single-node object movie file" width="477" height="124"></div><br/><p>For a single-node object movie, the QTVR track contains just one sample. There is a corresponding sample in the object track, whose time and duration are the same as the time and duration of the sample in the QTVR track. The time base of the movie is used to locate the proper video samples in the object image track.</p><p>For an object movie, the frame corresponding to the first row and column in the object image array is located at the same time as the corresponding QTVR and object track samples. The total duration of all the video samples is the same as the duration of the corresponding QTVR sample and the object sample.</p><p>In addition to these three required tracks, an object movie can also contain a hot spot image track and any number of standard QuickTime tracks (such as video, sound, and text tracks). A hot spot image track for an object is a QuickTime video track that contains images of colored regions delineating the hot spots; an image in the hot spot image track must be synchronized to match the appropriate image in the object image track. A hot spot image track should be 8 bits deep and can be compressed with any lossless compressor (including temporal compressors). This is also true of panoramas. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_114" title="Note"></a><p><strong>Note:</strong>&nbsp;To assign a single fixed-position hot spot to all views of an object,  you should create a hot spot image track that consists of a single video frame  whose duration is the entire node time.</p></div><p>To play a time-based track with the object movie, you must synchronize the sample data of that track to the start and stop times of a view in the object image track. For example, to play a different sound with each view of an object, you might store a sound track in the movie file with each set of sound samples synchronized to play at the same time as the corresponding object’s view image. (This technique also works for video samples.) Another way to add sound or video is simply to play a sound or video track during the object’s view animation; to do this, you need to add an active track to the object that is equal in duration to the object’s row duration.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_115" title="Important:"></a><p><strong>Important:</strong>&nbsp;In a QuickTime VR movie file, the panorama image tracks and panorama hot spot tracks must be disabled. For an object, the object image tracks must be enabled and the object hot spot tracks must be disabled. </p><p></p></div><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF103" title="Multinode Movies"></a><h3>Multinode Movies</h3><p>A multinode QuickTime VR movie can contain any number of object and panoramic nodes. <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCICHCIA">Figure 5-3</a></span> illustrates the structure of a QuickTime VR movie that contains five nodes (in this case, three panoramic nodes and two object nodes).</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_116" title="Figure 5-3The structure of a multinode movie file"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCICHCIA" title="Figure 5-3The structure of a multinode movie file"></a><strong>Figure 5-3&nbsp;&nbsp;</strong>The structure of a multinode movie file</p><img src = "../art/qtvr_l_09.gif" alt = "The structure of a multinode movie file" width="512" height="217"></div><br/><div class="importantbox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_117" title="Important:"></a><p><strong>Important:</strong>&nbsp;Panoramic tracks and object tracks must never be located at the same time. </p><p></p></div><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF104" title="QTVR Track "></a><h3>QTVR Track </h3><p>A QTVR track is a special type of QuickTime track that maintains a list of all the nodes in a movie. The media type for a QTVR track is <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_312"></a><code>'qtvr'</code>. All the media samples in a QTVR track share a common sample description. This sample description contains the VR world atom container. The track contains one media sample for each node in the movie. Each QuickTime VR media sample contains a node information atom container. </p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF105" title="QuickTime VR Sample Description Structure"></a><h4>QuickTime VR Sample Description Structure</h4><p>Whereas the QuickTime VR media sample is simply the node information itself, all sample descriptions are required by QuickTime to have a certain structure for the first several bytes. The structure for the QuickTime VR sample description is as follows: </p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRSampleDescription {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              size;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              type;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              dataRefIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              data;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRSampleDescription, *QTVRSampleDescriptionPtr,<span></span></pre></td></tr><tr><td scope="row"><pre> **QTVRSampleDescriptionHandle;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>size</code></dt><dd><p>The size, in bytes, of the sample description header structure, including the VR world atom container contained in the <code>data</code> field.</p></dd><dt><code>type</code></dt><dd><p>The sample description type. For QuickTime VR movies, this type should be <code>'qtvr'</code>.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>dataRefIndex</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>data</code></dt><dd><p>The VR world atom container. The sample description structure is extended to hold this atom container.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF106" title="Panorama Tracks"></a><h3>Panorama Tracks</h3><p>A movie’s <strong>panorama track</strong> is a track that contains information about the panoramic nodes in a scene. The media type of the panorama track is <code>'pano'</code>. Each sample in a panorama track corresponds to a single panoramic node. This sample parallels the corresponding sample in the QTVR track. Panorama tracks do not have a sample description (although QuickTime requires that you specify a dummy sample description when you call <code>AddMediaSample</code> to add a sample to a panorama track). The sample itself contains an atom container that includes a panorama sample atom and other optional atoms.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF107" title="Panorama Sample Atom Structure"></a><h4>Panorama Sample Atom Structure</h4><p>A panorama sample atom has an atom type of <code>kQTVRPanoSampleDataAtomType</code> (<code>'pdat'</code>). It describes a single panorama, including track reference indexes of the scene and hot spot tracks and information about the default viewing angles and the source panoramic image. </p><p>The structure of a panorama sample atom is defined by the <code>QTVRPanoSampleAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRPanoSampleAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageRefTrackIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotRefTrackIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageSizeX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageSizeY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              imageNumFramesX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              imageNumFramesY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotSizeX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotSizeY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              hotSpotNumFramesX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              hotSpotNumFramesY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              panoType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRPanoSampleAtom, *QTVRPanoSampleAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>imageRefTrackIndex</code></dt><dd><p>The index of the image track reference. This is the index returned by the <code>AddTrackReference</code> function when the image track is added as a reference to the panorama track. There can be more than one image track for a given panorama track and hence multiple references. (A panorama track might have multiple image tracks if the panoramas have different characteristics, which could occur if the panoramas were shot with different size camera lenses.) The value in this field is 0 if there is no corresponding image track.</p></dd><dt><code>hotSpotRefTrackIndex</code></dt><dd><p>The index of the hot spot track reference.</p></dd><dt><code>minPan</code></dt><dd><p>The minimum pan angle, in degrees. For a full panorama, the value of this field is usually 0.0.</p></dd><dt><code>maxPan</code></dt><dd><p>The maximum pan angle, in degrees. For a full panorama, the value of this field is 360.0.</p></dd><dt><code>minTilt</code></dt><dd><p>The minimum tilt angle, in degrees. For a high-FOV cylindrical panorama, a typical value for this field is –42.5.</p></dd><dt><code>maxTilt</code></dt><dd><p>The maximum tilt angle, in degrees. For a high-FOV cylindrical panorama, a typical value for this field is +42.5.</p></dd><dt><code>minFieldOfView</code></dt><dd><p>The minimum vertical field of view, in degrees. For a high-resolution panorama, a typical value for this field is 5.0. The value in this field is 0 for the default minimum field of view, which is 5 percent of the maximum field of view. </p></dd><dt><code>maxFieldOfView</code></dt><dd><p>The maximum vertical field of view, in degrees. For a high-resolution panorama, a typical value for this field is 85.0. The value in this field is 0 for the default maximum field of view, which is <code>maxTilt</code> – <code>minTilt.</code></p></dd><dt><code>defaultPan</code></dt><dd><p>The default pan angle, in degrees.</p></dd><dt><code>defaultTilt</code></dt><dd><p>The default tilt angle, in degrees.</p></dd><dt><code>defaultFieldOfView</code></dt><dd><p>The default vertical field of view, in degrees.</p></dd><dt><code>imageSizeX</code></dt><dd><p>The width, in pixels, of the panorama stored in the highest resolution image track.</p></dd><dt><code>imageSizeY</code></dt><dd><p>The height, in pixels, of the panorama stored in the highest resolution image track. </p></dd><dt><code>imageNumFramesX</code></dt><dd><p>The number of frames into which the panoramic image is diced horizontally. The width of each frame (which is <code>imageSizeX</code>/<code>imageNumFramesX</code>) should be divisible by 4.</p></dd><dt><code>imageNumFramesY</code></dt><dd><p>The number of frames into which the panoramic image is diced vertically. The height of each frame (which is <code>imageSizeY</code>/<code>imageNumFramesY</code>) should be divisible by 4. </p></dd><dt><code>hotSpotSizeX</code></dt><dd><p>The width, in pixels, of the panorama stored in the highest resolution hot spot image track.</p></dd><dt><code>hotSpotSizeY</code></dt><dd><p>The height, in pixels, of the panorama stored in the highest resolution hot spot image track.</p></dd><dt><code>hotSpotNumFramesX</code></dt><dd><p>The number of frames into which the panoramic image is diced horizontally for the hot spot image track. </p></dd><dt><code>hotSpotNumFramesY</code></dt><dd><p>The number of frames into which the panoramic image is diced vertically for the hot spot image track. </p></dd><dt><code>flags</code></dt><dd><p>A set of panorama flags. <code>kQTVRPanoFlagHorizontal</code> has been superseded by the <code>panoType</code> field. It is only used when the <code>panoType</code> field is <code>nil</code> to indicate a horizontally-oriented cylindrical panorama. </p></dd><dt><code>panoType</code></dt><dd><p>An <code>OSType</code> describing the type of panorama. Types supported are </p><ul class="termdef"><li class="termdef"><p><code><!--a  -->kQTVRHorizontalCylinder<!--/a--></code></p></li><li class="termdef"><p><code><!--a  -->kQTVRVerticalCylinder<!--/a--></code></p></li><li class="termdef"><p><code><!--a  -->kQTVRCube<!--/a--></code></p></li></ul></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><p>The minimum and maximum values in the panorama sample atom describe the physical limits of the panoramic cylindrical image. QuickTime VR allows you to set further constraints on what portion of the image a user can see by calling the <code>QTVRSetConstraints</code> routine. You can also preset image constraints by adding constraint atoms to the panorama sample atom container. The three constraint atom types are <code>kQTVRPanConstraintAtomType</code>, <code>kQTVRTiltConstraintAtomType</code>, and <code>kQTVRFOVConstraintAtomType</code>. Each of these atom types share a common structure defined by the <code>QTVRAngleRangeAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRAngleRangeAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minimumAngle;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maximumAngle;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRAngleRangeAtom, *QTVRAngleRangeAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>minimumAngle</code></dt><dd><p>The minimum angle in the range, in degrees.</p></dd><dt><code>maximumAngle</code></dt><dd><p>The maximum angle in the range, in degrees.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF108" title="Panorama Image Track"></a><h3>Panorama Image Track</h3><p>The actual panoramic image for a panoramic node is contained in a <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_313"></a>panorama image track, which is a standard QuickTime video track. The track reference to this track is stored in the <code>imageRefTrackIndex</code> field of the panorama sample atom.</p><p>Previous versions of QuickTime VR required the original panoramic image to be rotated 90 degrees counterclockwise. This orientation was changed in QuickTime 5 to allow either rotated (the previous requirement) or non-rotated tiles (the preferred orientation).</p><p>The rotated image is diced into smaller frames, and each diced frame is then compressed and added to the video track as a video sample, as shown in <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIFDJFH">Figure 5-4</a></span>. Frames can be compressed using any spatial compressor; however, temporal compression is not allowed for panoramic image tracks.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_118" title="Figure 5-4Creating an image track for a panorama"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIFDJFH" title="Figure 5-4Creating an image track for a panorama"></a><strong>Figure 5-4&nbsp;&nbsp;</strong>Creating an image track for a panorama</p><img src = "../art/audio_controls.gif" alt = "Creating an image track for a panorama" width="424" height="167"></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_119" title="Note"></a><p><strong>Note:</strong>&nbsp;<span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIFDJFH">Figure 5-4</a></span> illustrates that as the pan angle increases,  the tile number increases. </p></div><p>QuickTime 5 does <em>not</em> require the original panoramic image to be rotated 90 degrees counterclockwise, as was the case in previous versions of QuickTime VR. The rotated image is still diced into smaller frames, and each diced frame is then compressed and added to the video track as a video sample, as shown in <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIHBDHE">Figure 5-5</a></span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_120" title="Figure 5-5Creating an image track for a panorama, with the image track  oriented horizontally"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIHBDHE" title="Figure 5-5Creating an image track for a panorama, with the image track  oriented horizontally"></a><strong>Figure 5-5&nbsp;&nbsp;</strong>Creating an image track for a panorama, with the image track  oriented horizontally</p><img src = "../art/qt214.gif" alt = "Creating an image track for a panorama, with the image track  oriented horizontally" width="522" height="417"></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_121" title="Note"></a><p><strong>Note:</strong>&nbsp;As shown in <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIHBDHE">Figure 5-5</a></span>, the opposite of the  previous behavior is exhibited: as the pan angle increases, the tile  number decreases. </p></div><p>In QuickTime 5, a panorama sample atom (which contains information about a single panorama) contains the <code>panoType</code> field, which indicates whether the diced panoramic image is oriented horizontally or vertically.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF109" title="Cylindrical Panoramas"></a><h3>Cylindrical Panoramas</h3><p>The primary change to <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_314"></a>cylindrical panoramas in QuickTime VR is that the panorama, as stored in the image track of the movie, can be oriented horizontally. This means that the panorama does not need to be rotated 90 degrees counterclockwise, as required previously. </p><p>To indicate a horizontal orientation, the field in the <code>VRPanoSampleAtom</code> data structure formerly called <code>reserved1</code> has been renamed <code>panoType</code>. Its type is <code>OSType</code>. The <code>panoType</code> for a horizontally oriented cylinder is <code>kQTVRHorizontalCylinder</code> (<code>‘hcyl’</code>), while a vertical cylinder is <code>kQTVRVerticalCylinder</code> (<code>‘vcyl’</code>). For compatibility with older QuickTime VR files, when the <code>panoType</code> field is <code>nil</code>, then a cylinder is assumed, with the low order bit of the <code>flags</code> field set to 1 to indicate if the cylinder is horizontal and 0 if the cylinder is vertical.</p><p>One consequence of reorienting the panorama horizontally is that, when the panorama is divided into separate tiles, the order of the samples in the file is now the reverse of what it was for vertical cylinders. Since vertical cylinders were rotated 90 degrees counterclockwise, the first tile added to the image track was the right-most tile in the panorama. For unrotated horizontal cylinders, the first tile added to the image track is the left-most tile in the panorama.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIDDHJF" title="Cubic Panoramas "></a><h3>Cubic Panoramas </h3><p>A new type of panorama was introduced in QuickTime 5: the cubic panorama. This panorama in its simplest form is represented by six faces of a cube, thus enabling the viewer to see all the way up and all the way down. The file format and the cubic rendering engine actually allow for more complicated representations, such as special types of cubes with elongated sides or cube faces made up of separate tiles. Atoms that describe the orientation of each face allow for these nonstandard representations. If these atoms are not present, then the simplest representation is assumed. The following describes this simplest representation: a cube with six square sides.</p><p>Tracks in a cubic movie are laid out as they are for cylindrical panoramas. This includes a QTVR track, a panorama track, and an image track. Optionally, there may also be a hot spot track and a fast-start preview track. The image, hot spot, and preview tracks are all standard QuickTime video tracks. </p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF110" title="Image Tracks in Cubic Nodes"></a><h4>Image Tracks in Cubic Nodes</h4><p>For a cubic node the image track contains six samples that correspond to the six square faces of the cube. The same applies to hot spot and preview tracks. The following diagram shows how the order of samples in the track corresponds to the orientation of the cube faces.</p><br/><div><img src = "../art/qt217.gif" alt = "image: ../art/qt217.gif" width="471" height="54"></div><br/><br/><div><img src = "../art/qt218.gif" alt = "image: ../art/qt218.gif" width="165" height="143"></div><br/><p>Note that by default the frames are oriented horizontally. However, arbitrary orientations (90 degrees clockwise, 90 degrees counterclockwise, upside down, and diamond shaped) can be used if specified with the <code>'cufa'</code> atom. Still, the greatest rendering speed is used with horizontally oriented tiles.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF111" title="Panorama Tracks in Cubic Nodes"></a><h3>Panorama Tracks in Cubic Nodes</h3><p>The media sample for a panorama track contains the pano sample atom container. For cubes, some of the fields in the pano sample data atom have special values, which provide compatibility back to QuickTime VR 2.2. The cubic projection engine ignores these fields. They allow one to view cubic movies in older versions of QuickTime VR using the cylindrical engine, although the view will be somewhat incorrect, and the top and bottom faces will not be visible. The special values are shown in <span class="content_text"><a href="../1Chap/1-General-Intro.html#//apple_ref/doc/uid/TP40000944-CH205-TPXREF119">Table 5-1</a></span>.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_122" title="Table 5-1Fields and their special values as represented in the  pano sample data atom, providing backward compatibility  to earlier versions of QuickTime VR"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF119" title="Table 5-1Fields and their special values as represented in the  pano sample data atom, providing backward compatibility  to earlier versions of QuickTime VR"></a><strong>Table 5-1&nbsp;&nbsp;</strong>Fields and their special values as represented in the  pano sample data atom, providing backward compatibility  to earlier versions of QuickTime VR</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p><code>imageNumFramesX </code></p></td><td ><p>4</p></td></tr><tr><td  scope="row"><p><code>imageNumFramesY</code></p></td><td ><p>1</p></td></tr><tr><td  scope="row"><p><code>imageSizeX</code></p></td><td ><p>frame width * 4</p></td></tr><tr><td  scope="row"><p><code>imageSizeY</code></p></td><td ><p>frame height</p></td></tr><tr><td  scope="row"><p><code>minPan</code></p></td><td ><p>0.0</p></td></tr><tr><td  scope="row"><p><code>maxPan</code></p></td><td ><p>360.0</p></td></tr><tr><td  scope="row"><p><code>minTilt</code></p></td><td ><p>-45.0</p></td></tr><tr><td  scope="row"><p><code>maxTilt</code></p></td><td ><p>45.0</p></td></tr><tr><td  scope="row"><p><code>minFieldOfView</code></p></td><td ><p>5.0</p></td></tr><tr><td  scope="row"><p><code>maxFieldOfView</code></p></td><td ><p>90.0</p></td></tr><tr><td  scope="row"><p><code>flags</code></p></td><td ><p>1</p></td></tr></table></div><p>A 1 value in the <code>flags</code> field tells QuickTime VR that the frames are not rotated. QuickTime VR treats this as a four-frame horizontal cylinder. The <code>panoType</code> field (formerly <code>reserved1</code>) must be set to <code>kQTVRCube </code>(<code>'cube'</code>) so that QuickTime can recognize this panorama as a cube.</p><p>Since certain viewing fields in the pano sample data atom are being used for backward compatibility, a new atom must be added to indicate the proper viewing parameters for the cubic image. This atom is the cubic view atom (atom type <code>'cuvw'</code>). The data structure of the cubic view atom is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>struct QTVRCubicViewAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTVRCubicViewAtom    QTVRCubicViewAtom;<span></span></pre></td></tr></table></div><p>The fields are filled in as desired for the cubic image. This atom is ignored by older versions of QuickTime VR. Typical values for the <code>min</code> and <code>max</code> fields are shown in <span class="content_text"><a href="../3Chap/3-QTVR-Programming.html#//apple_ref/doc/uid/TP40000944-CH207-TPXREF120">Table 5-2</a></span>. </p><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_123" title="Table 5-2Values for min and max fields"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF120" title="Table 5-2Values for min and max fields"></a><strong>Table 5-2&nbsp;&nbsp;</strong>Values for min and max fields</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p><code>minPan </code></p></td><td ><p>0.0</p></td></tr><tr><td  scope="row"><p><code>maxPan</code></p></td><td ><p>360.0</p></td></tr><tr><td  scope="row"><p><code>minTilt </code></p></td><td ><p>-90.0</p></td></tr><tr><td  scope="row"><p><code>maxTilt</code></p></td><td ><p>90.0</p></td></tr><tr><td  scope="row"><p><code>minFieldOfView </code></p></td><td ><p>5.0</p></td></tr><tr><td  scope="row"><p><code>maxFieldOfView</code></p></td><td ><p>120.0</p></td></tr></table></div><p>You add the cubic view atom to the pano sample atom container (after adding the pano sample data atom). Then use <code>AddMediaSample</code> to add the atom container to the panorama track.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF112" title="Nonstandard Cubes"></a><h3>Nonstandard Cubes</h3><p>Although the default representation for a cubic panorama is that of six square faces of a cube, it is possible to depart from this standard representation. When doing so, a new atom must be added to the pano sample atom container. The atom type is <code>'cufa'</code>. The atom is an array of data structures of type <code>QTVRCubicFaceData</code>. Each entry in the array describes one face of whatever polyhedron is being defined. <code>QTVRCubicFaceData</code> is defined as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>struct QTVRCubicFaceData {<span></span></pre></td></tr><tr><td scope="row"><pre>    float   orientation[4];<span></span></pre></td></tr><tr><td scope="row"><pre>    float   center[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    float   aspect; // set to 1<span></span></pre></td></tr><tr><td scope="row"><pre>    float   skew; // set to 0<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTVRCubicFaceData    QTVRCubicFaceData;<span></span></pre></td></tr></table></div><p>The following section discusses the mathematical explanation of these data structures.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF122" title="Quaternions"></a><h3>Quaternions</h3><p>Quaternions provide a representation for rotation in three dimensions that has well-behaved computational properties. This allows for the implementation of smooth and continuous interpolation of rotation.</p><p>A quaternion is defined using four floating point values [ <em>w x y z</em> ]. These are calculated from the combination of the three coordinates of the rotation axis and the rotation angle.</p><p>There are four different components to quaternions, which can be represented as </p><br/><div><img src = "../art/iqt_vrquat01.gif" alt = "image: ../art/iqt_vrquat01.gif" width="83" height="21"></div><br/><p>Those components are typically ordered in one of two ways: [<em>w x y z</em>] or [<em>x y z w</em>]. Apple follows the convention of the [<em>w x y z</em>] ordering.</p><p>A quaternion has four components which can be further separated into two subcomponents: scalar, which is the <em>w</em> part, and vector, which is the <em>x, y, z</em> part. </p><br/><div><img src = "../art/iqt_vrquat02.gif" alt = "image: ../art/iqt_vrquat02.gif" width="105" height="41"></div><br/><p>The vector part represents an axis of rotation in 3D. </p><p>Apple uses a right-handed coordinate system which has <em>x</em> pointing to the right, <em>y</em> pointing up, and <em>z</em> coming out of the page, as shown in <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIFJJFH">Figure 5-6</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_124" title="Figure 5-6A reference coordinate system"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIFJJFH" title="Figure 5-6A reference coordinate system"></a><strong>Figure 5-6&nbsp;&nbsp;</strong>A reference coordinate system</p><img src = "../art/iqt_vrquat03.gif" alt = "A reference coordinate system" width="283" height="240"></div><br/><p>With your right hand, if you point your thumb in the direction of the axis, then the rotation will go around in the direction that your fingers are curling. In this case, if you are looking around the <em>y</em> axis, then the rotation will come around toward you. Around the <em>x</em> axis, it will come and rotate downward; then the <em>z</em> axis will rotate counterclockwise. </p><p>In order to use a quaternion, you can specify it with an axis of rotation and an angle. That is encoded into a quaterion in this way:</p><br/><div><img src = "../art/iqt_vrquat04.gif" alt = "image: ../art/iqt_vrquat04.gif" width="199" height="55"></div><br/><p>The cosine of the half-angle is the <em>w</em> component, and the sine of the half-angle of rotation scales the axis of rotation. This yields [<em>w x y z</em>]. </p><p>In most cases, a “normalized” quaternion is used, where the squares of the components add up to one:</p><br/><div><img src = "../art/iqt_vrquat05.gif" alt = "image: ../art/iqt_vrquat05.gif" width="130" height="22"></div><br/><p>Quaternions are used to specify the location of each face in 3-space. </p><p>If you want one face to be straight in front of you, it would be in the standard position––not rotated at all. In that case, there is no rotation. </p><br/><div><img src = "../art/iqt_vrquat06.gif" alt = "image: ../art/iqt_vrquat06.gif" width="113" height="69"></div><br/><p>If you have an image in standard position, it is not rotated at all. The angle of rotation is 0. Half of that angle is still 0, and the cosine would be 1. That produces the <em>w</em> coordinate. Since the sine of 0 is 0, it doesn’t really matter what the axis of rotation is, because it is not being rotated. So you have [<em>1 0 0  0</em>] for the standard position.</p><p>Now if you rotate it 180 degrees about the <em>y</em> axis, this would yield the following:</p><p>Half of 180 is 90, so the cosine of 90 degrees is 0. And if you rotate around the <em>y</em> axis, the y axis would be specified as [<em>0 1 0</em>]. And the sine of half of 180 degrees would be the sine of 90 degrees, which is 1. So you multiply 1 by 0 1 0.</p><br/><div><img src = "../art/iqt_vrquat07.gif" alt = "image: ../art/iqt_vrquat07.gif" width="113" height="45"></div><br/><p>If you just rotate it by 90 degrees to the right about the <em>y</em> axis, you get the following:</p><br/><div><img src = "../art/iqt_vrquat08.gif" alt = "image: ../art/iqt_vrquat08.gif" width="303" height="83"></div><br/><p>You are actually rotating by a negative 90 degrees, because the <em>y</em> axis would normally rotate in a positive direction. </p><p>You could rotate around the positive y axis. For example, if you want to rotate to the right. You can rotate around the positive <em>y</em> axis by - 90 degrees, or rotate about the negative <em>y</em> axis by + 90 degrees. These are equivalent. It all depends on what your orientation is. </p><br/><div><img src = "../art/iqt_vrquat09.gif" alt = "image: ../art/iqt_vrquat09.gif" width="292" height="83"></div><br/><p>Note that you can multiply a quaternion by -1 and it would represent exactly the same orientation. This implies that quaternions are a redundant representation for 3D orientation. Similar kinds of redundant representations are used in 2D and 3D graphics––for example, 3 x 3 matrices in QuickTime and 4 x 4 matrices in 3D. Both of these matrices can be scaled by arbitrary nonzero numbers (not just -1), yet they still represent the same projective transformation.</p><p>For the top, you want to rotate 90 degrees about the <em>x</em> axis. The cosine of half of 90 degrees is equal to the square root of one-half. Now take the <em>x</em> axis which is  [<em>1 0 0</em>] and multiply it all out and you get the following: </p><br/><div><img src = "../art/iqt_vrquat11.gif" alt = "image: ../art/iqt_vrquat11.gif" width="272" height="80"></div><br/><p>Similarly, the bottom is then </p><br/><div><img src = "../art/iqt_vrquat12.gif" alt = "image: ../art/iqt_vrquat12.gif" width="287" height="81"></div><br/><p>When you subdivide a face, you scale its quaternion from the normalized quaternion by a factor that is related to the amount of subdivision.</p><p>Think of a quaternion as a point on a sphere. A <em>unit</em> (normalized) quaternion is like a point on a <em>unit</em> sphere. A <em>larger</em> magnitude quaternion then represents a point on a <em>larger</em> sphere. </p><p>The radius of the sphere is the focal length of the tile (sub-face), normalized to its resolution. When you subdivide a face 2 x 2, it is like you are placing the tiles on a sphere of radius 2, that is, the images are twice as far away as they would be with 1 x 1 tiling. </p><p>You don’t merely scale the quaternion by the normalized focal length, because of the rule for transforming a vector by a quaternion. </p><br/><div><img src = "../art/iqt_vrquat13.gif" alt = "image: ../art/iqt_vrquat13.gif" width="63" height="22"></div><br/><p>where <em>q*</em> is the conjugate of the quaternion q. Since the magnitude of the quaternion is applied twice in this transformation, you need to scale a unit quaternion by </p><br/><div><img src = "../art/iqt_vrquat20.gif" alt = "image: ../art/iqt_vrquat20.gif" width="26" height="23"></div><br/><p>if you want it to scale a vector by <em>S</em> when applying the above transformation. Thus, the quaternion scale factor is the square root of the normalized focal length. </p><p>You normalize the focal length to the height of the tile, specifically</p><br/><div><img src = "../art/iqt_vrquat15.gif" alt = "image: ../art/iqt_vrquat15.gif" width="120" height="56"></div><br/><p>where <em>f</em> and <em>H</em> are measured in units of pixels. The normalized  focal length <img src = "../art/iqt_vrquat21.gif" alt = "image: ../art/iqt_vrquat21.gif" width="9" height="23"> is thus specified in units of image half-height. You do this in order to make the specification <em>resolution-independent</em>. </p><p>The normalized focal length is related to the vertical field of view in a simple way:</p><br/><div><img src = "../art/iqt_vrquat16.gif" alt = "image: ../art/iqt_vrquat16.gif" width="97" height="34"></div><br/><p>where VFOV is the vertical field of view, and cot ( . ) is the cotangent. </p><p>This yields remarkably simple values for the usual tiling schemes:</p><br/><div><img src = "../art/iqt_vrquat17.gif" alt = "image: ../art/iqt_vrquat17.gif" width="132" height="114"></div><br/><p>In summary, sub-tile orientation is specified with scaled quaternions, <em>q</em>, given by </p><br/><div><img src = "../art/iqt_vrquat18.gif" alt = "image: ../art/iqt_vrquat18.gif" width="85" height="26"></div><br/><p>where <img src = "../art/iqt_vrquat21.gif" alt = "image: ../art/iqt_vrquat21.gif" width="9" height="23"> is the normalized focal length and <img src = "../art/iqt_vrquat19.gif" alt = "image: ../art/iqt_vrquat19.gif" width="9" height="21"> is the normalized quaternion. </p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF123" title="Examples for Common Cases"></a><h4>Examples for Common Cases</h4><p>The following tables, <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-TPXREF121">Table 5-3</a></span>, <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIGIGDJ">Table 5-4</a></span> and <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIJFIGH">Table 5-5</a></span>, illustrate some examples for common cases, showing values used to represent six square sides in 1 x1, 2 x 2, and 3 x 3 matrices. </p><p><span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-TPXREF121">Table 5-3</a></span> shows what values QuickTime VR uses for the default representation of six square sides.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_125" title="Table 5-3Values used for representing six square sides in a 1 x 1 matrix"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF121" title="Table 5-3Values used for representing six square sides in a 1 x 1 matrix"></a><strong>Table 5-3&nbsp;&nbsp;</strong>Values used for representing six square sides in a 1 x 1 matrix</caption><tr><th colspan="4" scope="col"><strong><p>       Orientation (quaternion)</p></strong></th><th colspan="2" scope="col"><strong><p>Center</p></strong></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Aspect</p></th><th colspan="2" scope="col"><strong><p>Skew</p></strong></th></tr><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>w</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>z</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th></tr><tr><td  scope="row"><p>+1</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># front</p></td></tr><tr><td  scope="row"><p>+.5</p></td><td ><p>0</p></td><td ><p>-.5</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># right</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># back</p></td></tr><tr><td  scope="row"><p>+.5</p></td><td ><p>0</p></td><td ><p>+.5</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># left</p></td></tr><tr><td  scope="row"><p>+.5</p></td><td ><p>+.5</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># top</p></td></tr><tr><td  scope="row"><p>+.5</p></td><td ><p>-.5</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># bottom</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_126" title="Table 5-4Values used for representing six square sides in a 2 x 2 matrix"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIGIGDJ" title="Table 5-4Values used for representing six square sides in a 2 x 2 matrix"></a><strong>Table 5-4&nbsp;&nbsp;</strong>Values used for representing six square sides in a 2 x 2 matrix</caption><tr><th colspan="4" scope="col"><strong><p>Orientation (quaternion)</p></strong></th><th colspan="2" scope="col"><strong><p>Center</p></strong></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Aspect</p></th><th colspan="2" scope="col"><strong><p>Skew</p></strong></th></tr><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>w</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>z</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th></tr><tr><td  scope="row"><p>2</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># front</p></td></tr><tr><td  scope="row"><p>1</p></td><td ><p>0</p></td><td ><p>-1</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># right</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>0</p></td><td ><p>2</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># back</p></td></tr><tr><td  scope="row"><p>1</p></td><td ><p>0</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># left</p></td></tr><tr><td  scope="row"><p>1</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># top</p></td></tr><tr><td  scope="row"><p>1</p></td><td ><p>-1</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x2</p></td><td ><p>y2</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># bottom</p></td></tr></table></div><p>where {x2, y2} come from the set:</p><p>{ [ -1,-1 ], [ +1, -1 ], [ -1, +1 ], [ +1, -1 ]}</p><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_127" title="Table 5-5Values used for representing six square sides in a 3 x 3 matrix"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIJFIGH" title="Table 5-5Values used for representing six square sides in a 3 x 3 matrix"></a><strong>Table 5-5&nbsp;&nbsp;</strong>Values used for representing six square sides in a 3 x 3 matrix</caption><tr><th colspan="4" scope="col"><strong><p>Orientation (quaternion)</p></strong></th><th colspan="2" scope="col"><strong><p>Center</p></strong></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Aspect</p></th><th colspan="2" scope="col"><strong><p>Skew</p></strong></th></tr><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>w</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>z</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>x</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>y</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th></tr><tr><td  scope="row"><p>3</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># front</p></td></tr><tr><td  scope="row"><p>3/2</p></td><td ><p>0</p></td><td ><p>-3/2</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># right</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>0</p></td><td ><p>3</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># back</p></td></tr><tr><td  scope="row"><p>3/2</p></td><td ><p>0</p></td><td ><p>3/2</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># left</p></td></tr><tr><td  scope="row"><p>3/2</p></td><td ><p>3/2</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># top</p></td></tr><tr><td  scope="row"><p>3/2</p></td><td ><p>-3/2</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>x3</p></td><td ><p>y3</p></td><td ><p>1</p></td><td ><p>0</p></td><td ><p># bottom</p></td></tr></table></div><p>where {x3, y3} come from the set:</p><p>{ [ -2, -2 ], [ 0, -2 ], [ +2, -2 ], [ -2, 0 ], [ 0, 0 ], [ +2, 0 ], [ -2, +2 ], [ 0, +2 ], [ +2, +2 ] }</p><p><span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIFCJBH">Figure 5-7</a></span> clarifies the center values for 1 x 1, 2 x 2, and 3 x 3 subtiling schemes. These values are represented in a resolution-independent format. In particular, the co-ordinates for the center are in units of one-half of the image height, specifically (height - 1)/2, just as with the normalized focal length.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_128" title="Figure 5-7Normalized center coordinates for subtiles"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIFCJBH" title="Figure 5-7Normalized center coordinates for subtiles"></a><strong>Figure 5-7&nbsp;&nbsp;</strong>Normalized center coordinates for subtiles</p><img src = "../art/qtpp3_01.gif" alt = "Normalized center coordinates for subtiles" width="496" height="171"></div><br/><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF113" title="Hot Spot Image Tracks"></a><h3>Hot Spot Image Tracks</h3><p>When a panorama contains hot spots, the movie file contains a <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_315"></a><strong>hot spot image</strong> track, a video track that contains a parallel panorama, with the hot spots designated by colored regions. Each diced frame of the hot spot panoramic image must be compressed with a lossless compressor (such as QuickTime’s graphics compressor). The dimensions of the hot spot panoramic image are usually the same as those of the image track’s panoramic image, but this is not required. The dimensions must, however, have the same aspect ratio as the image track’s panoramic image. A hot spot image track should be 8 bits deep. </p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF114" title="Low-Resolution Image Tracks"></a><h4>Low-Resolution Image Tracks</h4><p>It’s possible to store one or more low-resolution versions of a panoramic image in a movie file; those versions are called <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_316"></a><strong>low-resolution image tracks</strong>. If there is not enough memory at runtime to use the normal image tr ack, QuickTime VR uses a lower resolution image track if one is available. A low-resolution image track contains diced frames just like the higher resolution track. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_129" title="Important:"></a><p><strong>Important:</strong>&nbsp;The panoramic images in the lower resolution image tracks and the hot spot image tracks, if present, must have the same orientation (horizontal or vertical)  as the panorama image track. </p><p></p></div><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF115" title="Track Reference Entry Structure"></a><h4>Track Reference Entry Structure</h4><p>Since there are no fields in the pano sample data atom to indicate the presence of low-resolution image tracks, a separate sibling atom must be added to the panorama sample atom container. The track reference array atom contains an array of track reference entry structures that specify information about any low-resolution image tracks contained in a movie. Its atom type is <code>kQTVRTrackRefArrayAtomType</code>  (<a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_317"></a><code>'tref'</code>). </p><p>A track reference entry structure is defined by the <code>QTVRTrackRefEntry</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRTrackRefEntry {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              trackRefType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              trackResolution;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              trackRefIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRTrackRefEntry;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>trackRefType</code></dt><dd><p>The track reference type. </p></dd><dt><code>trackResolution</code></dt><dd><p>The track resolution. </p></dd><dt><code>trackRefIndex</code></dt><dd><p>The index of the track reference.</p></dd></dl><p>The number of entries in the track reference array atom is determined by dividing the size of the atom by <code>sizeof</code> (<code>QTVRTrackRefEntry</code>).</p><p><code>kQTVRPreviewTrackRes</code> is a special value for the <code>trackResolution</code> field in the <code>QTVRTrackRefEntry</code> structure. This is used to indicate the presence of a special preview image track.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF116" title="Object Tracks"></a><h3>Object Tracks</h3><p>A movie’s <a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_318"></a>object track is a track that contains information about the object nodes in a scene. The media type of the object track is <code>'obje'</code>. Each sample in an object track corresponds to a single object node in the scene. The samples of the object track contain information describing the object images stored in the object image track. </p><p>These object information samples parallel the corresponding node samples in the QTVR track and are equal in time and duration to a particular object node’s image samples in the object’s image track as well as the object node’s hot spot samples in the object’s hot spot track.</p><p>Object tracks do not have a sample description (although QuickTime requires that you specify a dummy sample description when you call <code>AddMediaSample</code> to add a sample to an object track). The sample itself is an atom container that contains a single object sample atom and other optional atoms.</p><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF117" title="Object Sample Atom Structure"></a><h4>Object Sample Atom Structure</h4><p>An object sample atom describes a single object, including information about the default viewing angles and the view settings. The structure of an object sample atom is defined by the <code>QTVRObjectSampleAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRObjectSampleAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              movieType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              viewStateCount;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              defaultViewState;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              mouseDownViewState;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              viewDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              columns;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              rows;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             mouseMotionScale;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultViewCenterH;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultViewCenterV;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             viewRate;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             frameRate;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              animationSettings;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              controlSettings;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRObjectSampleAtom, *QTVRObjectSampleAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>movieType</code></dt><dd><p>The movie controller type. </p></dd><dt><code>viewStateCount</code></dt><dd><p>The number of view states of the object. A view state selects an alternate set of images for an object’s views. The value of this field must be positive.</p></dd><dt><code>defaultViewState</code></dt><dd><p>The 1-based index of the default view state. The default view state image for a given view is displayed when the mouse button is not down.</p></dd><dt><code>mouseDownViewState</code></dt><dd><p>The 1-based index of the mouse-down view state. The mouse-down view state image for a given view is displayed while the user holds the mouse button down and the cursor is over an object movie.</p></dd><dt><code>viewDuration</code></dt><dd><p>The total movie duration of all image frames contained in an object’s view. In an object that uses a single frame to represent a view, the duration is the image track’s sample duration time.</p></dd><dt><code>columns</code></dt><dd><p>The number of columns in the object image array (that is, the number of horizontal positions or increments in the range defined by the minimum and maximum pan values). The value of this field must be positive.</p></dd><dt><code>rows</code></dt><dd><p>The number of rows in the object image array (that is, the number of vertical positions or increments in the range defined by the minimum and maximum tilt values). The value of this field must be positive.</p></dd><dt><code>mouseMotionScale</code></dt><dd><p>The mouse motion scale factor (that is, the number of degrees that an object is panned or tilted when the cursor is dragged the entire width of the VR movie image). The default value is 180.0.</p></dd><dt><code>minPan</code></dt><dd><p>The minimum pan angle, in degrees. The value of this field must be less than the value of the <code>maxPan</code> field.</p></dd><dt><code>maxPan</code></dt><dd><p>The maximum pan angle, in degrees. The value of this field must be greater than the value of the <code>minPan</code> field.</p></dd><dt><code>defaultPan</code></dt><dd><p>The default pan angle, in degrees. This is the pan angle used when the object is first displayed. The value of this field must be greater than or equal to the value of the <code>minPan</code> field and less than or equal to the value of the <code>maxPan</code> field.</p></dd><dt><code>minTilt</code></dt><dd><p>The minimum tilt angle, in degrees. The default value is +90.0. The value of this field must be less than the value of the <code>maxTilt</code> field.</p></dd><dt><code>maxTilt</code></dt><dd><p>The maximum tilt angle, in degrees. The default value is –90.0. The value of this field must be greater than the value of the <code>minTilt</code> field.</p></dd><dt><code>defaultTilt</code></dt><dd><p>The default tilt angle, in degrees. This is the tilt angle used when the object is first displayed. The value of this field must be greater than or equal to the value of the <code>minTilt</code> field and less than or equal to the value of the <code>maxTilt</code> field.</p></dd><dt><code>minFieldOfView</code></dt><dd><p>The minimum field of view to which the object can zoom. The valid range for this field is from 1 to the value of the <code>fieldOfView</code> field. The value of this field must be positive.</p></dd><dt><code>fieldOfView</code></dt><dd><p>The image field of view, in degrees, for the entire object. The value in this field must be greater than or equal to the value of the <code>minFieldOfView</code> field.</p></dd><dt><code>defaultFieldOfView</code></dt><dd><p>The default field of view for the object. This is the field of view used when the object is first displayed. The value in this field must be greater than or equal to the value of the <code>minFieldOfView</code> field and less than or equal to the value of the <code>fieldOfView</code> field.</p></dd><dt><code>defaultViewCenterH</code></dt><dd><p>The default horizontal view center.</p></dd><dt><code>defaultViewCenterV</code></dt><dd><p>The default vertical view center.</p></dd><dt><code>viewRate</code></dt><dd><p>The view rate (that is, the positive or negative rate at which the view animation in the object plays, if view animation is enabled). The value of this field must be from –100.0 through +100.0, inclusive.</p></dd><dt><code>frameRate</code></dt><dd><p>The frame rate (that is, the positive or negative rate at which the frame animation in a view plays, if frame animation is enabled). The value of this field must be from –100.0 through +100.0, inclusive.</p></dd><dt><code>animationSettings</code></dt><dd><p>A set of 32-bit flags that encode information about the animation settings of the object.</p></dd><dt><code>controlSettings</code></dt><dd><p>A set of 32-bit flags that encode information about the control settings of the object.</p></dd></dl><p>The <code>movieType</code> field of the object sample atom structure specifies an object controller type, that is, the user interface to be used to manipulate the object. </p><p>QuickTime VR supports the following controller types:</p><div class="codesample"><table><tr><td scope="row"><pre>enum ObjectUITypes {<span></span></pre></td></tr><tr><td scope="row"><pre>    kGrabberScrollerUI                          = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kOldJoyStickUI                              = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kJoystickUI                                 = 3,<span></span></pre></td></tr><tr><td scope="row"><pre>    kGrabberUI                                  = 4,<span></span></pre></td></tr><tr><td scope="row"><pre>    kAbsoluteUI                                 = 5<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>kGrabberScrollerUI</code></dt><dd><p>The default controller, which displays a hand for dragging and rotation arrows when the cursor is along the edges of the object window.</p></dd><dt><code>kOldJoyStickUI</code></dt><dd><p>A joystick controller, which displays a joystick-like interface for spinning the object. With this controller, the direction of panning is reversed from the direction of the grabber.</p></dd><dt><code>kJoystickUI</code></dt><dd><p>A joystick controller, which displays a joystick-like interface for spinning the object. With this controller, the direction of panning is consistent with the direction of the grabber.</p></dd><dt><code>kGrabberUI</code></dt><dd><p>A grabber-only interface, which displays a hand for dragging but does not display rotation arrows when the cursor is along the edges of the object window.</p></dd><dt><code>kAbsoluteUI</code></dt><dd><p>An absolute controller, which displays a finger for pointing. The absolute controller switches views based on a row-and-column grid mapped into the object window.</p></dd></dl><p>The <code>animationSettings</code> field of the object sample atom is a long integer that specifies a set of animation settings for an object node. Animation settings specify characteristics of the movie while it is playing. Use these constants to specify animation settings:</p><div class="codesample"><table><tr><td scope="row"><pre>enum QTVRAnimationSettings {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectAnimateViewFramesOn              = (1 &lt;&lt; 0),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPalindromeViewFramesOn           = (1 &lt;&lt; 1),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectStartFirstViewFrameOn            = (1 &lt;&lt; 2),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectAnimateViewsOn                   = (1 &lt;&lt; 3),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPalindromeViewsOn                = (1 &lt;&lt; 4),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectSyncViewToFrameRate              = (1 &lt;&lt; 5),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectDontLoopViewFramesOn             = (1 &lt;&lt; 6),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPlayEveryViewFrameOn             = (1 &lt;&lt; 7)<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>kQTVRObjectAnimateViewFramesOn</code></dt><dd><p>If this bit is set, play all frames in the current view state.</p></dd><dt><code>kQTVRObjectPalindromeViewFramesOn</code></dt><dd><p>If this bit is set, play a back-and-forth animation of the frames of the current view state.</p></dd><dt><code>kQTVRObjectStartFirstViewFrameOn</code></dt><dd><p>If this bit is set, play the frame animation starting with the first frame in the view (that is, at the view start time).</p></dd><dt><code>kQTVRObjectAnimateViewsOn</code></dt><dd><p>If this bit is set, play all views of the current object in the default row of views.</p></dd><dt><code>kQTVRObjectPalindromeViewsOn</code></dt><dd><p>If this bit is set, play a back-and-forth animation of all views of the current object in the default row of views.</p></dd><dt><code>kQTVRObjectSyncViewToFrameRate</code></dt><dd><p>If this bit is set, synchronize the view animation to the frame animation and use the same options as for frame animation.</p></dd><dt><code>kQTVRObjectDontLoopViewFramesOn</code></dt><dd><p>If this bit is set, stop playing the frame animation in the current view at the end.</p></dd><dt><code>kQTVRObjectPlayEveryViewFrameOn</code></dt><dd><p>If this bit is set, play every view frame regardless of play rate. The play rate is used to adjust the duration in which a frame appears but no frames are skipped so the rate is not exact.</p></dd></dl><p>The <code>controlSettings</code> field of the object sample atom is a long integer that specifies a set of control settings for an object node. Control settings specify whether the object can wrap during panning and tilting, as well as other features of the node. The control settings are specified using these bit flags:</p><div class="codesample"><table><tr><td scope="row"><pre>enum QTVRControlSettings {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectWrapPanOn                        = (1 &lt;&lt; 0),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectWrapTiltOn                       = (1 &lt;&lt; 1),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectCanZoomOn                        = (1 &lt;&lt; 2),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectReverseHControlOn                = (1 &lt;&lt; 3),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectReverseVControlOn                = (1 &lt;&lt; 4),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectSwapHVControlOn                  = (1 &lt;&lt; 5),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectTranslationOn                    = (1 &lt;&lt; 6)<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>kQTVRObjectWrapPanOn</code></dt><dd><p>If this bit is set, enable wrapping during panning. When this control setting is enabled, the user can wrap around from the current pan constraint maximum value to the pan constraint minimum value (or vice versa) using the mouse or arrow keys.</p></dd><dt><code>kQTVRObjectWrapTiltOn</code></dt><dd><p>If this bit is set, enable wrapping during tilting. When this control setting is enabled, the user can wrap around from the current tilt constraint maximum value to the tilt constraint minimum value (or vice versa) using the mouse or arrow keys.</p></dd><dt><code>kQTVRObjectCanZoomOn</code></dt><dd><p>If this bit is set, enable zooming. When this control setting is enabled, the user can change the current field of view using the zoom-in and zoom-out keys on the keyboard (or using the VR controller buttons).</p></dd><dt><code>kQTVRObjectReverseHControlOn</code></dt><dd><p>If this bit is set, reverse the direction of the horizontal control.</p></dd><dt><code>kQTVRObjectReverseVControlOn</code></dt><dd><p>If this bit is set, reverse the direction of the vertical control.</p></dd><dt><code>kQTVRObjectSwapHVControlOn</code></dt><dd><p>If this bit is set, exchange the horizontal and vertical controls.</p></dd><dt><code>kQTVRObjectTranslationOn</code></dt><dd><p>If this bit is set, enable translation. When this setting is enabled, the user can translate using the mouse when either the translate key is held down or the controller translation mode button is toggled on.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH209-TPXREF118" title="Track References for Object Tracks"></a><h3>Track References for Object Tracks</h3><p>The track references to an object’s image and hot spot tracks are not handled the same way as track references to panoramas. The track reference types are the same (<code>kQTVRImageTrackRefType</code> and <code>kQTVRHotSpotTrackRefAtomType</code>), but the location of the reference indexes is different. There is no entry in the object sample atom for the track reference indexes. Instead, separate atoms using the <code>VRTrackRefEntry</code> structure are stored as siblings to the object sample atom. The types of these atoms are <code>kQTVRImageTrackRefAtomType</code> and <code>kQTVRHotSpotTrackRefAtomType</code>. If either of these atoms is not present, then the reference index to the corresponding track is assumed to be 1. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_130" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>trackResolution</code> field in the <code>VRTrackRefEntry</code>  structure is ignored for object tracks.</p></div><p>The actual views of an object for an object node are contained in an object image track, which is usually a standard QuickTime video track. (An object image track can also be any type of track that is capable of displaying an image, such as a QuickTime 3D track.) </p><p>As described in <span class="content_text"><a href="../2Chap/2-QTVR-Authoring.html#//apple_ref/doc/uid/TP40000944-CH206-BAJGAGFA">“Chapter 2, QuickTime VR Panoramas and Object Movies,,”</a></span> these views are often captured by moving a camera around the object in a defined pattern of pan and tilt angles. The views must then be ordered into an object image array, which is stored as a one-dimensional sequence of frames in the movie’s video track (see <span class="content_text"><a href="6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIJFJFE">Figure 5-8</a></span>).</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH209-DontLinkElementID_131" title="Figure 5-8The structure of an image track for an object"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH209-BCIJFJFE" title="Figure 5-8The structure of an image track for an object"></a><strong>Figure 5-8&nbsp;&nbsp;</strong>The structure of an image track for an object</p><img src = "../art/qtvr_l_03.gif" alt = "The structure of an image track for an object" width="492" height="164"></div><br/><p>For object movies containing frame animation, each animated view in the object image array consists of the animating frames. It is not necessary that each view in the object image array contain the same number of frames, but the view duration of all views in the object movie must be the same.</p><p>For object movies containing alternate view states, alternate view states are stored as separate object image arrays that immediately follow the preceding view state in the object image track. Each state does not need to contain the same number of frames. However, the total movie time of each view state in an object node must be the same.</p><p></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../4Chap/4-QTVR-Manager.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../5Chap/5-QTVR-Movie-Controller.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-06-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/InsideQT_QTVR/6Chap/6-Creating-QTVR-Movies.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/InsideQT_QTVR/6Chap/6-Creating-QTVR-Movies.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/InsideQT_QTVR/6Chap/6-Creating-QTVR-Movies.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>