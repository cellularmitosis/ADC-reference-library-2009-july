<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Handling Events for Your Color Picker</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING42></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-29.html"><B>Chapter 2 - Color Picker Manager</B></A> / <A HREF="ACI-38.html"><B>Writing Your Own Color Pickers</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING42-0></A>
<H2>Handling Events for Your Color Picker</H2>
 <A NAME=MARKER-2-133></A><A NAME=MARKER-2-134></A>The Color Picker Manager sends the <A NAME=MARKER-2-135></A><CODE>kDrawPicker</CODE> request in response to an update event. Your color picker responds to this code by redrawing your color picker, as illustrated in <A HREF=#MARKER-9-136>Listing 2-20</A>.<P>
<B>Listing 2-20  <A NAME=MARKER-9-136></A>Redrawing a color picker</B><P>
<PRE>
pascal ComponentResult MyDrawPicker(PickerStorageHndl storage)
{
   if((*storage)-&gt;visible)  
   {
      MyDrawColorList(storage);
      MyDrawColorEditor(storage,true);
   }
   return noErr;
}
</PRE>
 The Color Picker Manager calls the Event Manager function <CODE>BeginUpdate</CODE> before sending the <CODE>kDrawPicker</CODE> request code and the Event Manager function <CODE>EndUpdate</CODE> after sending the <CODE>kDrawPicker</CODE> request code.<P>
 The Color Picker Manager sends the <A NAME=MARKER-2-137></A><CODE>kEvent</CODE> request code so that your color picker can handle events that the Dialog Manager does not handle. A color picker responds to the <CODE>kEvent</CODE> request code by performing any event processing in addition to or instead of that normally performed by the Dialog Manager. <A HREF=#MARKER-9-138>Listing 2-21</A> illustrates how a color picker can perform such event processing.<P>
<B>Listing 2-21  Responding to events before handing them to the Dialog Manager<A NAME=MARKER-9-138></A></B><P>
<PRE>
pascal ComponentResult MyDoEvent(PickerStorageHndl storage, 
                         EventData *data)
{
   OSErr err = noErr;
   /* initialize so events are not filtered */
   data-&gt;handled = false;
   data-&gt;action = kDidNothing;
   if(data-&gt;event)  
   {
      switch(data-&gt;event-&gt;what)  
      {
         case nullEvent:
            DoIdle(storage,data);
            break;
         case mouseDown:
            err = DoMouseDown(storage,data);
            break;
         case keyDown:
         case autoKey:
            err = DoKeyDown(storage,data);
            break;
         case keyUp:
            err = DoKeyUp(storage,data);
            break;
         case activateEvt:
            if(data-&gt;event-&gt;modifiers &amp; activeFlag)
               ActivatePicker(storage);
            else
               DeactivatePicker(storage);
            break;
      }  
   }
   return err;
}
</PRE>
 The Color Picker Manager sends the <A NAME=MARKER-2-139></A><CODE>kItemHit</CODE> request code to inform your color picker of an event in one of its items. In turn, your color picker responds to the event for the item reported in the <CODE>itemHit</CODE> field of an <CODE>ItemHitData</CODE> record, which is described in <A HREF=#nonexistent-marker>"Color Picker Manager Reference" (page 2-5)</A> in <I>Advanced Color Imaging Reference</I>. <A HREF=#MARKER-9-140>Listing 2-22</A> illustrates how a color picker can perform such event processing.<P>
<B>Listing 2-22  <A NAME=MARKER-9-140></A>Responding to events in color picker items</B><P>
<PRE>
pascal ComponentResult MyItemHit(PickerStorageHndl storage, 
                         ItemHitData *data)
{
   #pragma unused(iMod)
   Handle theItem;
   short iType;
   Rect iBox;

   OSErr err = noErr;
   data-&gt;action = kDidNothing;
   GetDialogItem((*storage)-&gt;port, 
                  (*storage)-&gt;baseItem + data-&gt;itemHit, &amp;iType, 
                  &amp;theItem, &amp;iBox);
   switch(data-&gt;itemHit)  
   {
      case iRedText:
      case iGreenText:
      case iBlueText:
         /* don't udpate everything as the user types each key; 
            update only after the user leaves an edit field */
         if(data-&gt;iMod != kKeyDown &amp;&amp; data-&gt;itemHit != kMouseDown)
            CheckCurrentWorld(storage,data-&gt;itemHit);
         break;
      case iOrigColor:
         err = DoListClick(storage,data);
         break;
      case iNewColor:
         break;
   }  
   return err;
}
</PRE>
 <A NAME=MARKER-2-141></A>The Color Picker Manager sends the <A NAME=MARKER-2-142></A><CODE>kEdit</CODE> request code to inform your color picker that the user has chosen one of the edit commands from the Edit menu (or typed its keyboard equivalent). If your color picker, rather than the Dialog Manager, needs to perform the editing command, your color picker should do so in response to this request code. For example, because the Dialog Manager does not perform the Undo command, your <CODE>MyDoEdit</CODE> function can instead. The editing command is passed to your function in the field <CODE>theEdit</CODE> of the <CODE>EditData</CODE> record pointed to in the <CODE>data</CODE> parameter. <A HREF=#MARKER-9-143>Listing 2-23</A> illustrates how a color picker can respond to this result code.<P>
<B>Listing 2-23  <A NAME=MARKER-9-143></A>Handling events in the color picker's Edit menu</B><P>
<PRE>
pascal ComponentResult MyDoEdit(PickerStorageHndl storage, 
                        EditData *data)
{
   RGBColor rgb;

   switch(data-&gt;theEdit)  
   {
      default:
         /* default behavior is appropriate */
         data-&gt;action = kDidNothing;
         data-&gt;handled = false;
         break;
      case kUndo:
         rgb = (*storage)-&gt;lastRGB;
         (*storage)-&gt;lastRGB = (*storage)-&gt;color.color.rgb;
         (*storage)-&gt;color.color.rgb = rgb;
         /* update the other internal data and then redraw */
         MySetSelectionColor(storage);
         MyUpdateColorText(storage);
         MyDrawColorRects(storage, false);
         data-&gt;action = kColorChanged;
         data-&gt;handled = true;
         break;
   }
   return noErr;
}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
