<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Boot Blocks (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING101></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-99.html"><B>Data Organization on Volumes</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING101-0></A>
<H2><A NAME=MARKER-9-434></A>Boot Blocks</H2>
 <A NAME=MARKER-2-435></A>The first two logical blocks on every Macintosh volume are <B>boot blocks.</B> These blocks contain <B>system startup information:</B> instructions and information necessary to start up (or "boot") a Macintosh computer. This information consists of certain configurable system parameters (such as the capacity of the event queue, the number of open files allowed, and so forth) and is contained in a boot block header. The system startup information also includes actual machine-language instructions that could be used to load and execute the System file. Usually these instructions follow immediately after the boot block header. Generally, however, the boot code stored on disk is ignored in favor of boot code stored in a resource in the System file.<A NAME=MARKER-2-436></A><P>
 The structure of the boot block header can be described by the Pascal <CODE>BootBlkHdr</CODE> <BR>data type.<A NAME=MARKER-2-437></A><P>
<DL>
<DT><B>WARNING</B>
<DD>The format of the boot block header is subject to change. If your application relies on the information presented here, it should check the boot block header version number and react gracefully if that number is greater than that documented here. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 Note that there are two boot block header formats. The current format includes two fields at the end that are not contained in the older format. These fields allow the Operating System to size the System heap relative to the amount of available physical RAM. A boot block header that conforms to the older format sets the size of the System heap absolutely, using values specified in the header itself. You can determine whether a boot block header uses the current or the older format by inspecting a bit in the high-order byte of the <CODE>bbVersion</CODE> field, as explained in its field description.<A NAME=MARKER-2-438></A><P>
<PRE>
TYPE BootBlkHdr   =           {boot block header}
RECORD
   bbID:             Integer; {boot blocks signature}
   bbEntry:          LongInt; {entry point to boot code}
   bbVersion:        Integer; {boot blocks version number}
   bbPageFlags:      Integer; {used internally}
   bbSysName:        Str15;   {System filename}
   bbShellName:      Str15;   {Finder filename}
   bbDbg1Name:       Str15;   {debugger filename}
   bbDbg2Name:       Str15;   {debugger filename}
   bbScreenName:     Str15;   {name of startup screen}
   bbHelloName:      Str15;   {name of startup program}
   bbScrapName:      Str15;   {name of system scrap file}
   bbCntFCBs:        Integer; {number of FCBs to allocate}
   bbCntEvts:        Integer; {number of event queue elements}
   bb128KSHeap:      LongInt; {system heap size on 128K Mac}
   bb256KSHeap:      LongInt; {used internally}
   bbSysHeapSize:    LongInt; {system heap size on all machines}
   filler:           Integer; {reserved}
   bbSysHeapExtra:   LongInt; {additional system heap space}
   bbSysHeapFract:   LongInt; {fraction of RAM for system heap}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><A NAME=MARKER-2-439></A><CODE>bbID</CODE>
<DD> A signature word. For HFS volumes, this field always contains the value $4C4B.
<DT><A NAME=MARKER-2-440></A><CODE>bbEntry</CODE>
<DD> The entry point to the boot code stored in the boot blocks. This <BR>field contains machine-language instructions that translate to <CODE>BRA.S *+$90</CODE> (or <CODE>BRA.S *+$88</CODE>, if the older block header format is used), which jumps to the main boot code following the boot block header. This field is ignored, however, if bit 6 is clear in the high-order byte of the <CODE>bbVersion</CODE> field or if the low-order byte in that field contains $D.
<DT><A NAME=MARKER-2-441></A><CODE>bbVersion</CODE>
<DD> A flag byte and boot block version number. The high-order byte of this field is a flag byte whose bits have the following meanings:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>0-4<TD>Reserved; must be 0<TR>
<TD>&nbsp;<TD>5<TD>Set if relative system heap sizing is to be used<TR>
<TD>&nbsp;<TD>6<TD>Set if the boot code in boot blocks is to be executed<TR>
<TD>&nbsp;<TD>7<TD>Set if new boot block header format is used</TABLE>

<DT>
<DD> If bit 7 is clear, then bits 5 and 6 are ignored and the version number is found in the low-order byte of this field. If that byte contains a value that is less than $15, the Operating System ignores any values in the <CODE>bb128KSHeap</CODE> and bb256KSHeap fields and configures the System heap to the default value contained in the <CODE>bbSysHeapSize</CODE> field. If that byte contains a value that is greater than or equal to $15, the Operating System sets the System heap to the value in <CODE>bbSysHeapSize</CODE>. In addition, the Operating System executes <BR>the boot code in the <CODE>bbEntry</CODE> field only if the low-order byte contains $D.
<DT>
<DD> If bit 7 is set, the Operating System inspects bit 6 to determine whether to execute the boot code contained in the <CODE>bbEntry</CODE> field and bit 5 to determine whether to use relative System heap sizing. If bit 5 is clear, the Operating System sets the System heap to the value<BR> <BR>in <CODE>bbSysHeapSize</CODE>. If bit 5 is set, the System heap is extended by the value in <CODE>bbSysHeapExtra</CODE> plus the fraction of available RAM specified in <CODE>bbSysHeapFract</CODE>.
<DT><A NAME=MARKER-2-145></A><CODE>bbPageFlags</CODE>
<DD> Used internally.
<DT><A NAME=MARKER-2-146></A><CODE>bbSysName</CODE>
<DD> The name of the System file.
<DT><A NAME=MARKER-2-148></A><CODE>bbShellName</CODE>
<DD> The name of the shell file. Usually, the system shell is the Finder.
<DT><A NAME=MARKER-2-149></A><CODE>bbDbg1Name</CODE>
<DD> The name of the first debugger installed during the boot process. Typically this is Macsbug.
<DT><A NAME=MARKER-2-288></A><CODE>bbDbg2Name</CODE>
<DD> The name of the second debugger installed during the boot process. Typically this is Disassembler.
<DT><A NAME=MARKER-2-290></A><CODE>bbScreenName</CODE>
<DD> The name of the file containing the startup screen. Usually this is StartUpScreen.
<DT><A NAME=MARKER-2-448></A><CODE>bbHelloName</CODE>
<DD> The name of the startup program. Usually this is Finder.
<DT><A NAME=MARKER-2-449></A><CODE>bbScrapName</CODE>
<DD> The name of the system scrap file. Usually this is Clipboard.
<DT><A NAME=MARKER-2-38></A><CODE>bbCntFCBs</CODE>
<DD> The number of file control blocks (FCBs) to put in the FCB buffer. In system software version 7.0 and later, this field specifies only the initial number of FCBs in the FCB buffer, because the Operating System can usually resize the FCB buffer if necessary. See <A HREF=Files-110.html#MARKER-9-674>"File Control Blocks" on page 2-81</A> for details on the FCB buffer.
<DT><A NAME=MARKER-2-44></A><CODE>bbCntEvts</CODE>
<DD> The number of event queue elements to allocate. This number determines the maximum number of events that the Event Manager can store at any one time. Usually this field contains the value 20.
<DT><A NAME=MARKER-2-452></A><CODE>bb128KSHeap</CODE>
<DD> The size of the System heap on a Macintosh computer having <BR>128 KB of RAM.
<DT><A NAME=MARKER-2-453></A><CODE>bb256KSHeap</CODE>
<DD> Reserved.
<DT><A NAME=MARKER-2-454></A><CODE>bbSysHeapSize</CODE>
<DD> The size of the System heap on a Macintosh computer having <BR>512 KB or more of RAM. This field might be ignored, as explained in the description of the <CODE>bbVersion</CODE> field.
<DT><CODE>filler</CODE>
<DD> Reserved.
<DT><A NAME=MARKER-2-455></A>bbSysHeapExtra
<DD> The minimum amount of additional System heap space required. If bit 5 of the high-order word of the <CODE>bbVersion</CODE> field is set, this value is added to <CODE>bbSysHeapSize</CODE>.
<DT><A NAME=MARKER-2-456></A>bbSysHeapFract
<DD> The fraction of RAM available to be used for the System heap. If <BR>bit 5 of the high-order word of the <CODE>bbVersion</CODE> field is set, this fraction of available RAM is added to <CODE>bbSysHeapSize</CODE>.<A NAME=MARKER-2-457></A><A NAME=MARKER-2-458></A>
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
