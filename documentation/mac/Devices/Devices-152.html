<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>About SCSI Manager 4.3(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING152></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-151.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-153.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-151.html"><B>Chapter 4 - SCSI Manager 4.3</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING152-0></A>
<H1>About SCSI Manager 4.3</H1>
 The SCSI Manager 4.3 application program interface (API) is modeled on the Common Access Method (CAM) software interface being developed by ANSI committee X3T9. The SCSI Manager 4.3 interface, however, includes Apple-specific differences required for compatibility with the original SCSI Manager and the Macintosh Operating System.<P>
 The <A NAME=MARKER-2-24></A><A NAME=MARKER-2-353></A>CAM specification defines the operation of three functional units--the <A NAME=MARKER-2-354></A>transport (XPT), the <A NAME=MARKER-2-129></A>SCSI interface module (SIM), and the <A NAME=MARKER-2-28></A>host bus adapter (HBA). The XPT is the entry point to SCSI Manager 4.3 and is responsible for passing requests to the appropriate SIM. Each SIM is responsible for managing the HBA for a particular bus. <P>
 In addition to the XPT, SCSI Manager 4.3 includes a SIM for managing the NCR 53C96 SCSI controller used in high-performance Macintosh computers. Other SIM modules and HBA hardware can be added at any time by Apple or third-party developers. For example, a NuBus or PDS expansion card can provide an additional SCSI bus, which device drivers can access through SCSI Manager 4.3 in exactly the same way as the internal bus. <A HREF=#MARKER-9-29>Figure 4-1</A> shows the relationship between device drivers, SCSI Manager 4.3, and the SCSI controller hardware.<P>
<B>Figure 4-1  <A NAME=MARKER-9-29></A><A NAME=MARKER-21-30></A>The SCSI Manager 4.3 architecture</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/SCSI4.3-L-01.jpg"><p>
 The features and capabilities of SCSI Manager 4.3 include<P>
<UL>
<LI><B>SCSI-2 compliance.</B>All mandatory SCSI-2 messages and protocol actions are supported as defined for an initiator. Optional SCSI-2 hardware features, such as fast and wide transfers, are anticipated by the SCSI Manager 4.3 architecture and supported by the interface.<A NAME=MARKER-2-31></A>
<LI><B>Concurrent asynchronous I/O.</B>SCSI Manager 4.3 handles both synchronous and asynchronous I/O requests. In addition, it allows multiple device drivers to issue multiple requests and attempts to overlap the operations as much as possible.
<LI><B>Hardware-independent programming interface.</B>A new hardware-independent interface allows device drivers to work with any SCSI Manager 4.3-compatible host bus adapter (HBA), including those from third-party developers.
<LI><B>Direct memory access (DMA).</B>SCSI Manager 4.3 automatically takes advantage of the DMA capabilities available in high-performance Macintosh models. Direct memory access allows the computer to perform other functions while data bytes are transferred to or from the SCSI bus.
<LI><B>Support for multiple buses.</B>SCSI Manager 4.3 supports any number of SCSI buses, each with a full complement of devices. For example, on Macintosh computers with dual SCSI buses (such as the Power Macintosh 8100/80), up to 14 SCSI devices can be attached. In addition, developers can design NuBus or PDS expansion cards that offer enhanced SCSI bus capabilities.
<LI><B>Support for multiple logical units on each target.</B>SCSI Manager 4.3 allows access to all logical units on a target device. Logical units are treated as separate entities, and I/O requests are queued according to logical unit number (LUN).
<LI><B>Disconnect/reconnect.</B>This capability helps maximize SCSI bus utilization by allowing a device to disconnect and release control of the SCSI bus while it processes a command, then reconnect when it is ready to complete the transaction. This allows a device driver to submit requests to multiple targets so that those requests are executed in parallel. For example, the driver for a disk array can issue a request to one disk, which disconnects, then issue another request to a different disk. The two disks can perform their seek operations simultaneously, reducing the effective seek time.
<LI><B>Parity detection.</B>SCSI Manager 4.3 detects and handles parity errors in data received from a target. For compatibility reasons, this feature can be disabled on a per-transaction basis. (All Macintosh computers generate parity for write operations, but the original SCSI Manager does not detect parity errors in incoming data.)
<LI><B>Autosense.</B>SCSI Manager 4.3 automatically sends a <CODE>REQUEST SENSE</CODE> command in response to a <CODE>CHECK CONDITION</CODE> status and retrieves the sense data. This feature can be disabled.<A NAME=MARKER-2-32></A>
<LI><B>Compatibility.</B>SCSI Manager 4.3 supports all original SCSI Manager functions and TIB instructions, except for <CODE>scComp</CODE> (compare). <P>
</UL>
<A NAME=HEADING152-17></A>
<H2>Transport</H2>
 The SCSI Manager 4.3 transport (XPT) provides the software interface to applications and device drivers, and is responsible for<A NAME=MARKER-2-33></A><P>
<UL>
<LI>providing the means to register host bus adapters, their characteristics, and their respective SCSI interface modules
<LI>routing requests to the proper SCSI interface module
<LI>notifying the caller when a request is complete
<LI>providing the high-level facilities for emulating the original SCSI Manager interface. This consists of maintaining a translation table of SCSI ID numbers and their corresponding host bus adapters, and directing original SCSI Manager requests accordingly
<LI>isolating SCSI interface modules from certain operating system requirements, such as those imposed by the Virtual Memory Manager<P>
</UL>
<A NAME=HEADING152-24></A>
<H2>SCSI Interface Modules</H2>
 A SCSI interface module (SIM) provides the software interface between the transport (XPT) and a host bus adapter (HBA) in SCSI Manager 4.3. The SIM processes and executes SCSI requests directed to it by the XPT and is responsible for handling all aspects of a SCSI transaction, including<P>
<UL>
<LI>maintaining the request queue, including freezing and unfreezing for error handling as necessary, and queuing multiple operations for all logical units on all target devices
<LI>managing the selection, disconnection, reconnection, and data pointers of the SCSI protocol
<LI>assigning tags for tag queuing, if supported
<LI>managing the HBA hardware
<LI>identifying abnormal conditions on the SCSI bus and performing error recovery
<LI>providing a time-out mechanism for tracking SCSI command execution
<LI>emulating original SCSI Manager functions, if supported<P>
</UL>
<A NAME=HEADING152-33></A>
<H2>System Performance</H2>
 In terms of maximum data transfer (bytes-per-second) over the internal SCSI bus, SCSI Manager 4.3 performs similarly to the original SCSI Manager. This aspect of performance is limited by the capability of the SCSI controller hardware and can be improved by adding a faster HBA.<P>
 In terms of overall system performance, the asynchronous capability of SCSI Manager 4.3 can provide significant benefits by allowing application code to regain control of the system while a SCSI transaction is in progress. This concurrency is a key benefit of asynchronous operation. In addition, support for disconnect/reconnect allows applications to initiate multiple I/O requests on multiple targets simultaneously, allowing further increases in throughput.<P>
 Multiple bus systems offer the added benefit of concurrency between buses. If DMA is used for both buses, their data transfer periods can be overlapped as well.<P>
<A NAME=HEADING152-37></A>
<H2>Compatibility</H2>
 All the functions provided by the original SCSI Manager are emulated by the SCSI Manager 4.3 XPT and SIM for the internal SCSI bus. This level of compatibility is optional for third-party SIM/HBA developers. When a SIM registers its HBA with the SCSI Manager 4.3 XPT, the SIM specifies whether or not it is able to emulate the original SCSI Manager functions by setting the <CODE>oldCallCapable</CODE> field of the SIM initialization record.<P>
 When an application or device driver calls the original SCSI Manager function <CODE>SCSIGet</CODE>, the XPT sets a flag preventing any additional <CODE>SCSIGet</CODE> function calls but performs no other action. Upon receipt of a <CODE>SCSISelect</CODE> function call, the XPT issues a <CODE>SCSIOldCall</CODE> request to the appropriate SIM, which places the request in its queue. Once the <CODE>SCSIOldCall</CODE> request begins execution, the SIM emulates subsequent original SCSI Manager function calls passed to it by the XPT. During this emulation, no new requests are processed until the entire transaction is completed and the <CODE>SCSIComplete</CODE> function returns. Any <CODE>SCSIGet</CODE> or <CODE>SCSISelect</CODE> requests received after the start of a <CODE>SCSIOldCall</CODE> request are rejected and return the <CODE>scMgrBusyErr</CODE> code.<P>
 While the original SCSI Manager emulation is in progress, asynchronous requests made by other applications or device drivers (using SCSI Manager 4.3 functions) are queued but do not execute until the emulation is complete. Requests to other SIMs are not affected and continue to execute normally.<P>
 The SCSIReset function resets only those buses that are capable of handling original SCSI Manager functions. The <CODE>SCSIStat</CODE> function returns results as accurate as possible for the SIM/HBA handling the request.<P>
 <A NAME=MARKER-9-270></A>The <CODE>scComp</CODE> (compare) TIB instruction is not supported by SCSI Manager 4.3 because DMA transfers do not permit this type of compare operation. This should pose few compatibility problems because this instruction is rarely used. You can, of course, write your own code to compare data on a SCSI device with data in memory.<P>
<DL>
<DT><B>WARNING</B>
<DD>Applications or device drivers that bypass the SCSI Manager for any part of a transaction are not supported and will interfere with the operation of SCSI Manager 4.3.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>

<HR>
<center>
<A HREF="Devices-151.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-153.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
