<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>OTAlloc</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING161></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-160.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-162.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-81.html"><B>Part 2 - Open Transport Reference</B></A><BR><DD><A HREF="NetworkingWOT-127.html"><B>Chapter 22 - Endpoints Reference</B></A> / <A HREF="NetworkingWOT-146.html"><B>Functions</B></A><BR><DL><DD><A HREF="NetworkingWOT-160.html"><B>Allocating Structures</B></A> / </DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING161-0></A>
<H3><A NAME=MARKER-9-161></A>OTAlloc</H3>
 Allocates an XTI data structure.<P>
<A NAME=HEADING161-2></A>
<H5>C INTERFACE</H5>
<PRE>
<A NAME=MARKER-11-162></A>void* OTAlloc (EndpointRef ref, 
                     OTStructType structType,
                     UInt32 fields, 
                     OSStatus* err);
</PRE>
<A NAME=HEADING161-4></A>
<H5>C++ INTERFACE</H5>
<PRE>
<A NAME=MARKER-12-163></A>void* TEndpoint::Alloc(OTStructType structType,
                     UInt32 fields,
                     OSStatus* err = NULL);
</PRE>
<A NAME=HEADING161-6></A>
<H5>PARAMETERS</H5>
<DL>
<DT><CODE>ref</CODE>
<DD> The endpoint reference of the endpoint for which the data structure is allocated.<P>
<DT><CODE>structType</CODE>
<DD> A 32-bit value specifying the constant name of the structure for which memory is to be allocated. Possible values for the <CODE>structType</CODE> parameter are given by the structure types enumeration <A HREF=NetworkingWOT-135.html#MARKER-9-69></A>.<P>
<DT><CODE>fields</CODE>
<DD> An integer specifying the structure fields for which buffers are to be allocated. <P>
<P>
<DT>
<DD> Each structure that you can specify for <CODE>structType</CODE>, except for <CODE>T_INFO</CODE>, contains at least one field of type <CODE>TNetbuf</CODE>. For each such field, you can use the <CODE>fields</CODE> parameter to specify that the buffer described by <CODE>TNetbuf</CODE> also be allocated. The length of the allocated buffer is at least as large as the size returned for the endpoint by the <CODE>OTGetEndpointInfo</CODE> function. For each buffer allocated, the <CODE>OTAlloc</CODE> function sets the <CODE>maxlen</CODE> field to the length of the buffer and sets the <CODE>len</CODE> field to 0. See Discussion for more information.<P>
<DT>
<DD> You can specify one or more constant names for the <CODE>fields</CODE> parameter. See Discussion for the value and meaning of these names. To specify more than one constant name, use the bitwise <CODE>OR</CODE> operator to combine values.<P>
<DT><CODE>err</CODE>
<DD> A result code. See <A HREF=NetworkingWOT-479.html#MARKER-9-72>Appendix B</A> for more information.
</DL>
<A NAME=HEADING161-13></A>
<H5>DISCUSSION</H5>
 The <CODE>OTAlloc</CODE> function allocates a data structure for use in a subsequent endpoint call. You use the <CODE>structType</CODE> parameter to specify the structure to be allocated and the <CODE>fields</CODE> parameter to specify the substructures to be allocated. Possible field values are given by the following enumeration<P>
<PRE>
<A NAME=MARKER-0-95></A>enum 
{
   T_ADDR   = 0x01,  /* for address information */
   T_OPT    = 0x02,  /* for option information */
   T_UDATA  = 0x04,  /* for data */
   T_ALL    = 0xffff /* for address, option, and data */
};
</PRE>
 If the <CODE>OTAlloc</CODE> function succeeds, it returns a pointer to the desired structure. <P>
 It is easiest to understand what the <CODE>OTAlloc</CODE> function does by considering what you would have to do if you did not use it. If you declared <CODE>structType</CODE> structures as normal data structures, you would have to declare the data structure and then initialize the <CODE>maxlen</CODE> and <CODE>buf</CODE> fields of every <CODE>TNetbuf</CODE> type field contained by the structure. To determine the appropriate size of each buffer, you would have to call the <CODE>OTGetEndpointInfo</CODE> function. <P>
 For example, if you call the <CODE>OTGetProtAddress</CODE> function to get the protocol address of an endpoint, you must pass a parameter of type <CODE>TBind</CODE>. The <CODE>addr.buf</CODE> field of the <CODE>TBind</CODE> structure points to a buffer that is large enough to hold the endpoint's protocol address. To determine how large the buffer has to be, you call the <CODE>OTGetEndpointInfo</CODE> function; then you allocate the memory for the buffer and initialize the <CODE>addr.buf</CODE> field to point to the buffer and initialize the <CODE>addr.maxlen</CODE> field to specify how large the bufferis. The <CODE>OTAlloc</CODE> function does all this work for you. Given the previous example, if you make the call<P>
<PRE>
<A NAME=MARKER-0-95></A>TBind* boundAddr = OTAlloc(T_BIND, T_ADDR);
</PRE>
 the <CODE>OTAlloc</CODE> function allocates the <CODE>TBind</CODE> structure, initializes the <CODE>TNetbuf</CODE> field that is used to describe the endpoint address, and allocates memory for the buffer in which the address is to be stored. All buffers allocated are guaranteed to be of the appropriate size for the kind of endpoint specified by the <CODE>ref</CODE> parameter. <P>
 If the requested structure contains <CODE>TNetbuf</CODE> fields and you do not specify these fields using the <CODE>fields</CODE> parameter, the <CODE>OTAlloc</CODE> function sets the <CODE>maxlen</CODE> and <CODE>len </CODE>fields to 0 and the <CODE>buf</CODE> field to <CODE>NIL</CODE>.<P>
<DL>
<DT><B>Note</B>
<DD>If you just want to allocate a block of memory, consider using the <A HREF=NetworkingWOT-304.html#MARKER-9-33><CODE>OTAllocMem</CODE></A> function.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING161-23></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 If you specify <CODE>T_UDATA</CODE> or <CODE>T_ALL</CODE> for the <CODE>fields</CODE> parameter and the endpoint information structure defines the tsdu or etsdu size for the endpoint to be of infinite length, the <CODE>OTAlloc</CODE> function does not allocate a data buffer for the endpoint.<P>
 The <CODE>OTAlloc</CODE> function is provided mainly for compatibility with XTI. Although using this function along with the <CODE>OTFree</CODE> function can save you coding work, this is at the price of slower performance. In general, you should not allocate and free structures on every call. Instead, you should declare structures that are to be passed as parameters to endpoint functions just as you would any other variables or data structures.<P>
 You must not use the pointer returned by the <CODE>OTAlloc</CODE> function in calls to any other endpoint as other endpoints mayhave different sizes.<P>
<A NAME=HEADING161-27></A>
<H5>SEE ALSO</H5>
 The <A HREF=NetworkingWOT-162.html#MARKER-9-166><CODE>OTFree</CODE></A> function.<P>
 The <A HREF=NetworkingWOT-137.html#MARKER-9-86><CODE>TBind</CODE></A> structure.<P>
 The <A HREF=NetworkingWOT-136.html#MARKER-9-81><CODE>TEndpointInfo</CODE></A> structure. <P>
 The <A HREF=NetworkingWOT-304.html#MARKER-9-33><CODE>OTAllocMem</CODE></A> function  and the <A HREF=NetworkingWOT-305.html#MARKER-9-35><CODE>OTFreeMem</CODE> function </A>.<P>
 <A HREF=NetworkingWOT-27.html#MARKER-9-12>Table 4-4</A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-160.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-162.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
