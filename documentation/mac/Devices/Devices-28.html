<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PBClose(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING28></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-27.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-29.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-10.html"><B>Chapter 1 - Device Manager</B></A> / <A HREF="Devices-17.html"><B>Device Manager Reference</B></A><BR><DL><DD><A HREF="Devices-21.html"><B>Device Manager Functions</B></A> / <A HREF="Devices-22.html"><B>Opening and Closing Device Drivers</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING28-0></A>
<H3><A NAME=MARKER-9-327></A>PBClose</H3>
 <A NAME=MARKER-11-328></A><A NAME=MARKER-2-209></A>You can use the <CODE>PBClose</CODE> function to close an open device driver.<P>
<PRE>
pascal OSErr PBClose(ParmBlkPtr paramBlock, Boolean async); 
</PRE>
<DL>
<DT><CODE>paramBlock</CODE>
<DD> A pointer to an <CODE>IOParam</CODE> structure of the Device Manager parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean value that indicates whether the request is asynchronous. You must set this field to <CODE>false</CODE> because device drivers cannot be closed asynchronously.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD><--<TD>ioResult<TD>OSErr<TD>The device driver's result code.<TR>
<TD>--><TD>ioRefNum<TD>short<TD>The driver reference number.</TABLE>
</B><P>
<A NAME=HEADING28-6></A>
<H5>DESCRIPTION</H5>
 The <CODE>PBClose</CODE> function closes the device driver specified by the <CODE>ioRefNum</CODE> field. The Device Manager waits until the driver is inactive before calling the driver's close routine. When the driver indicates it has processed the close request, the Device Manager unlocks the driver resource if the <A NAME=MARKER-2-257></A><CODE>dRAMBased</CODE> flag is set, and unlocks the device control entry if the <A NAME=MARKER-2-331></A><CODE>dNeedLock</CODE> flag is not set. The Device Manager does not dispose of the device control entry or remove it from the unit table.<P>
 If the driver returns a negative result in register D0, the Device Manager returns this result code in the <CODE>ioResult</CODE> field of the parameter block and does not close the driver.<P>
<DL>
<DT><B>WARNING</B>
<DD>You should not close drivers that other applications may be using, such as a disk driver, the AppleTalk drivers, and so on.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING28-10></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The Device Manager does not queue close requests.<P>
<DL>
<DT><B>WARNING</B>
<DD>Do not call the <CODE>PBClose</CODE> function at interrupt time because if the driver was processing a request when the interrupt occurred the Device Manager may loop indefinitely, waiting for the driver to complete the request.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING28-13></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The trap macro for the <CODE>PBClose</CODE> function is <CODE>_Close</CODE> (0xA001).<P>
 You must set up register A0 with the address of the parameter block. When <CODE>_Close</CODE> returns, register D0 contains the result code. Register D0 is the only register affected by this function.
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT colspan=2>Registers on entry<TR>
<TD>A0<TD>Address of the parameter block</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT colspan=2>Registers on exit<TR>
<TD>D0<TD>Result code</TABLE>
<P>
<A NAME=HEADING28-16></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>badUnitErr<TD>-21<TD>Driver reference number does not match unit table<TR>
<TD>unitEmptyErr<TD>-22<TD>Driver reference number specifies a <CODE>nil</CODE> handle in unit table<TR>
<TD>closErr<TD>-24<TD>Driver unable to complete close request<TR>
<TD>dRemovErr<TD>-25<TD>Attempt to remove an open driver</TABLE>
</H5>
<A NAME=HEADING28-17></A>
<H5>SEE ALSO</H5>
 For information about the high-level function for closing device drivers, see the description of the <CODE>CloseDriver</CODE> function on <A HREF=Devices-27.html#MARKER-9-320>page 1-65</A>. For an example of how to close a device driver using the <CODE>PBClose</CODE> function, see <A HREF=Devices-13.html#MARKER-9-101>Listing 1-2</A> on <A HREF=Devices-13.html#MARKER-9-101>page 1-20</A>.<A NAME=MARKER-2-221></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-27.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-29.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
