<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW565: Name Binding Protocol Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW565: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002582" title="Name Binding Protocol Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/idxHardwareDrivers-date.html" target="_blank">Networking > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW565</div>
<div id="pageheadsub">Name Binding Protocol Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext">										<a href="#Section1">Macintosh NBPLookup badUnitErr conditions</a><BR><BR>					<a href="#Section2">AppleTalk 56 NBP reply packet entity field checks</a><BR><BR>					<a href="#Section3">Name Binding Protocol (NBP) interval and count fields</a><BR><BR>					<a href="#Section4">AppleTalk PLookupName interval and retry values</a><BR><BR>					<a href="#Section5">Don't access the MPW NBP EntityName field directly</a><BR><BR>										<a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>Macintosh NBPLookup badUnitErr conditions</h2><p>Date Written:  11/14/90</p><p>Last reviewed:  2/8/91</p><p>Why am I getting a <code>badUnitErr</code> as a result code from <code>NBPLookup</code>? This error isnot listed as a result code for <code>NBPLookup</code>, nor anywhere in the AppleTalkManager.</p><p>You're probably getting the <code>badUnitErr</code> result because you don't have theAppleTalk drivers open. Since AppleTalk calls are made to a device driver (theAppleTalk driver), you can get back general operating system errors from thedriver.</p><p>See the Macintosh Technical Note "Opening AppleTalk" for a description of howto open the AppleTalk drivers. </p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>AppleTalk 56 NBP reply packet entity field checks</h2><p>Date Written:  6/14/91</p><p>Last reviewed:  6/14/93</p><p>As stated in <i>Inside AppleTalk,</i> each entity field in an NBP reply packetcan be a maximum of 32 characters. In previous versions of AppleTalk, no rangechecking was done on entity field lengths, and often names that were too longwere used, which eventually caused a crash somewhere else in the protocolstack.</p><p>Likewise, a null character in the object field of an entity has never been OK;it just happened to work because no range checking was done. (The only placethat a null can legally be used in an NBP tuple is in the zone name field of anNBP <code>LkUp</code>, <code>FwdReq</code>, or <code>BrRq</code> packet; see page 7-17 of <i>Inside Appletalk</i> formore information.)</p><p>Now, under Appletalk 56, a range check is done on each entity field to ensurethat the length is legal (1&lt;=length&lt;=32). When it finds a packet thatcontains a "corrupt" entity name, that packet is discarded.</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>Name Binding Protocol (NBP) interval and count fields</h2><p>Date Written:  9/13/91</p><p>Last reviewed:  10/8/91</p><p>Is there a limit on the values set in the Name Binding Protocol (NBP) intervaland count fields when used with <code>PLookupName</code> and <code>PConfirmName</code> calls? How do theinterval and count work? If a device is not on the network and I send a<code>PLookupName</code> with interval = 20 and count = 20, will I wait 400 seconds before<code>PLookupName</code> returns?</p><p>Since the interval and count parameters for NBP calls are both 1-byte, thevalues used are limited to the range of 0-255 ($00-$FF). Here's what the valuesdo:</p><ul type="disc">	<li>interval = retransmit interval in 8-tick units. This value is used to set up a VBL task. A value of 0 should not be used because that would mean the VBL task would never be executed and would be removed from the VBL queue.</li>	<li>count = total number of transmit attempts. Each time the interval timer expires, this value is decremented by 1. When it reaches 0, the NBP call completes. So if a value of 0 is used, the packet will be retransmitted 255 times (or transmitted 256 times).</li></ul><p>Three things can happen to make the <code>LookupName</code>, <code>RegisterName</code>, or <code>ConfirmName</code>calls complete:</p><ul type="disc">	<li><code>PKillNBP</code> can be called to abort one of the calls (see <cite>Inside Macintosh</cite> Volume V, page 519).</li>	<li><code>maxToGet</code> matches are returned or the return buffer is filled. Here's how this works: Each time an NBP lookup reply (<code>LkUp-Reply</code>) packet is received, an attempt is made to add all the NBP tuples found in that <code>LkUp-Reply</code> packet to the return buffer. If all the tuples cannot be added to the buffer because there isn't enough room, the call completes with as many tuples as could fit and the <code>numGotten</code> field will contain the number of matches in the buffer. If all the tuples from the <code>LkUp-Reply</code> packet are added to the buffer, <code>numGotten</code> (the number of matches in the buffer) is compared to the value passed in the <code>maxToGet</code> field. If <code>numGotten</code> is greater than or equal to <code>maxToGet</code>, the call completes and the numGotten field will contain the number of matches in the buffer. Since the buffer can fill before <code>maxToGet</code> matches are received and since <code>LkUp-Reply</code> packets can return multiple tuples, you may get more or fewer matches than you asked for with <code>maxToGet</code>.</li>	<li>The count is decremented to 0. You can use this equation to determine how long the call would take to complete this way:</li></ul><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>     IF count = 0 THEN count := 256;</pre>	</TD></TR></TABLE></CENTER><p>The <code>RegisterName</code> and <code>ConfirmName</code> calls always complete after they receive thefirst <code>LkUp-Reply</code> packet to their request, so you could look at them as alwayshaving a <code>maxToGet</code> of 1 (<code>maxToGet</code> is not one of the parameters for those twocalls).</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>AppleTalk PLookupName interval and retry values</h2><p>Date Written:  1/6/92</p><p>Last reviewed:  1/27/92</p><p>What are recommended values for retry interval and retry count when using theAppleTalk NBP call <code>PLookupName</code> on a complicated internet?</p><p>You might want to start with the NBP retry interval and retry count valuesApple uses for its Chooser PRER and RDEV device resource files. The Choosergrabs these values from the PRER's or RDEV's GNRL resource -4096:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Device                      Interval  Count    --------------------------  --------  -----    LaserWriter                   $0B      $05    AppleTalk ImageWriter         $07      $02    AppleShare                    $07      $05</pre>	</TD></TR></TABLE></CENTER><p>Apple's engineering teams found these values to work well in most situations.</p><p>The count value should be based on how likely it is for the device to miss NBPlookup requests. For example, the AppleTalk ImageWriter has a dedicatedprocessor on the LocalTalk option card just to handle AppleTalk, so its countvalue is low; most Macintosh models and LaserWriter printers depend on their680x0 processor to handle AppleTalk along with everything else in the system(the Macintosh IIfx and Macintosh Quadra models are exceptions to this), sotheir count value is higher.</p><p>The interval value should be based on the speed of the network and how manydevices of this type you expect there to be on the network. On a network withvery slow connections (for example, one using a modem bridge), or in caseswhere there are so many devices of a particular type that lots of collisionsoccur during lookups, the interval value should be increased.</p><p>Apple puts these values in a resource because not all networks and devices arealike. You should do the same (put your interval and count in a resource sothat it can be configured).</p><P><A HREF="#top">Back to top</A></P><a name="Section5"></a><h2>Don't access the MPW NBP EntityName field directly</h2><p>Date Written:  1/1/91</p><p>Last reviewed:  6/14/93</p><p>When I fill in the fields of MPW's Name Binding Protocol (NBP) <code>EntityName</code>structure, AppleTalk doesn't recognize the entity, even though I know it's outthere. What's going on?</p><p>The real definition of <code>EntityName</code> is 3 PACKED strings of any length (32 is anexample). No offsets for Asm are specified since each string address must becalculated by adding the length byte to the last string pointer. In Pascal,String(32) will be 34 bytes long since fields never start on an odd byte unlessthey are only one byte long, so this will generate correct-looking interfacesfor Pascal and C, but the interfaces will not be the same. This is OK sincethey are not used.</p><p>The point is that you should never try to access the fields of the <code>EntityName</code>field directly. The only reason the type is defined at all is so that you canallocate <code>EntityName</code> variables that will hold the largest possible <code>EntityName</code>.To fill in an <code>EntityName</code> record, you call the <code>NBPSetEntity</code> routine.</p><P><A NAME=Downloads></A></P>                  <P><A HREF="#top">Back to top</A></P><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_565.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_565.html%3Fid%3DDTS10002582-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_565.html%3Fid%3DDTS10002582-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_565.html%3Fid%3DDTS10002582-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>