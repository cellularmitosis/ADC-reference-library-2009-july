<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!--
This manual is for GNU M4 (version 1.4.6, 24 August 2006),
a package containing an implementation of the m4 macro language.

Copyright C 1989, 1990, 1991, 1992, 1993, 1994, 2004, 2005,
2006 Free Software Foundation, Inc.


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License,
Version 1.2 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts, and no
Back-Cover Texts.  A copy of the license is included in the section
entitled "GNU Free Documentation License."

-->
<!-- Created on September, 23 2007 by texi2html 1.70 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>GNU M4, version 1.4.6: 7. Input control</title>

<meta name="description" content="GNU M4, version 1.4.6: 7. Input control">
<meta name="keywords" content="GNU M4, version 1.4.6: 7. Input control">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.70">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="NOD38"></a>
<a name="SEC37"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="m4_6.html#SEC36" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC38" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4_6.html#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 7. Input control </h1>

<p>This chapter describes various builtin macros for controlling the input
to <code>m4</code>.

</p><table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top" scope="row"><a href="#SEC38">7.1 Deleting whitespace in input</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"></td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC39">7.2 Changing the quote characters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"></td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC40">7.3 Changing comment delimiters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                   Changing the comment delimiters
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC41">7.4 Changing the lexical structure of words</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"></td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC42">7.5 Saving input</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                      Saving input until end of input
</td></tr>
</table>

<hr size="6">
<a name="NOD39"></a>
<a name="SEC38"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC37" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 7.1 Deleting whitespace in input </h2>

<p>The builtin <code>dnl</code> stands for &quot;Discard to Next Line&quot;:

</p><dl>
<dt><u>Builtin:</u> <b>dnl</b>
<a name="IDX37"></a>
</dt>
<dd><p>All characters, up to and including the next newline, are discarded
without performing any macro expansion.

</p><p>The expansion of <code>dnl</code> is void.
</p></dd></dl>

<p>It is often used in connection with <code>define</code>, to remove the
newline that follows the call to <code>define</code>.  Thus

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`foo', `Macro `foo'.')dnl A very simple macro, indeed.
foo
&rArr;Macro foo.
</pre></td></tr></table>
<p>The input up to and including the next newline is discarded, as opposed
to the way comments are treated (see section <a href="m4_2.html#SEC10">Comments</a>).

</p><p>Usually, <code>dnl</code> is immediately followed by an end of line or some
other whitespace.  GNU <code>m4</code> will produce a warning diagnostic if
<code>dnl</code> is followed by an open parenthesis.  In this case, <code>dnl</code>
will collect and process all arguments, looking for a matching close
parenthesis.  All predictable side effects resulting from this
collection will take place.  <code>dnl</code> will return no output.  The
input following the matching close parenthesis up to and including the
next newline, on whatever line containing it, will still be discarded.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">dnl(`args are ignored, but side effects occur',
define(`foo', `like this')) while this text is ignored: undefine(`foo')
error--&gt;m4:stdin:2: Warning: excess arguments to builtin `dnl' ignored
See how `foo' was defined, foo?
&rArr;See how foo was defined, like this?
</pre></td></tr></table>
<p>If the end of file is encountered without a newline character, a
warning is issued and dnl stops consuming input.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`hi', `HI')
&rArr;
m4wrap(`m4wrap(`2 hi
')0 hi dnl 1 hi')
&rArr;
^D
error--&gt;m4: Warning: end of file treated as newline
&rArr;0 HI 2 HI
</pre></td></tr></table>
<hr size="6">
<a name="NOD40"></a>
<a name="SEC39"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC38" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC40" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 7.2 Changing the quote characters </h2>

<p>The default quote delimiters can be changed with the builtin
<code>changequote</code>:

</p><dl>
<dt><u>Builtin:</u> <b>changequote</b><i> ([<var>start</var> = `<samp>`</samp>'], [<var>end</var> = `<samp>'</samp>'])</i>
<a name="IDX38"></a>
</dt>
<dd><p>This sets <var>start</var> as the new begin-quote delimiter and <var>end</var> as the
new end-quote delimiter.  If any of the arguments are missing, the default
quotes (<code>`</code> and <code>'</code>) are used instead of the void arguments.

</p><p>The expansion of <code>changequote</code> is void.
</p></dd></dl>

<table><tr><td scope="row">&nbsp;</td><td><pre class="example">changequote(`[', `]')
&rArr;
define([foo], [Macro [foo].])
&rArr;
foo
&rArr;Macro foo.
</pre></td></tr></table>
<p>The quotation strings can safely contain eight-bit characters.
If no single character is appropriate, <var>start</var> and <var>end</var> can be
of any length.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">changequote(`[[[', `]]]')
&rArr;
define([[[foo]]], [[[Macro [[[[[foo]]]]].]]])
&rArr;
foo
&rArr;Macro [[foo]].
</pre></td></tr></table>
<p>Changing the quotes to the empty strings will effectively disable the
quoting mechanism, leaving no way to quote text.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`foo', `Macro `FOO'.')
&rArr;
changequote(, )
&rArr;
foo
&rArr;Macro `FOO'.
`foo'
&rArr;`Macro `FOO'.'
</pre></td></tr></table>
<p>There is no way in <code>m4</code> to quote a string containing an unmatched
begin-quote, except using <code>changequote</code> to change the current
quotes.

</p><p>If the quotes should be changed from, say, `<samp>[</samp>' to `<samp>[[</samp>',
temporary quote characters have to be defined.  To achieve this, two
calls of <code>changequote</code> must be made, one for the temporary quotes
and one for the new quotes.

</p><p>Macros are recognized in preference to the begin-quote string, so if a
prefix of <var>start</var> can be recognized as a potential macro name, the
quoting mechanism is effectively disabled.  Unless you use
<code>changeword</code> (see section <a href="#SEC41">Changing the lexical structure of words</a>), this means that <var>start</var>
should not begin with a letter or `<samp>_</samp>' (underscore).

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`hi', `HI')
&rArr;
changequote(`q', `Q')
&rArr;
q hi Q hi
&rArr;q HI Q HI
changequote
&rArr;
changequote(`-', `EOF')
&rArr;
- hi EOF hi
&rArr; hi  HI
</pre></td></tr></table>
<p>Quotes are recognized in preference to argument collection.  In
particular, if <var>start</var> is a single `<samp>(</samp>', then argument
collection is effectively disabled.  For portability with other
implementations, it is a good idea to avoid `<samp>(</samp>', `<samp>,</samp>', and
`<samp>)</samp>' as the first character in <var>start</var>.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`echo', `$#:$')
&rArr;
define(`hi', `HI')
&rArr;
changequote(`(',`)')
&rArr;
echo(hi)
&rArr;0::hi
changequote
&rArr;
changequote(`((', `))')
&rArr;
echo(hi)
&rArr;1:HI:
echo((hi))
&rArr;0::hi
changequote
&rArr;
changequote(`,', `)')
&rArr;
echo(hi,hi)bye)
&rArr;1:HIhibye:
</pre></td></tr></table>
<p>If <var>end</var> is a prefix of <var>start</var>, the end-quote will be
recognized in preference to a nested begin-quote.  In particular,
changing the quotes to have the same string for <var>start</var> and
<var>end</var> disables nesting of quotes.  When quote nesting is disabled,
it is impossible to double-quote strings across macro expansions, so
using the same string is not done very often.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`hi', `HI')
&rArr;
changequote(`&quot;&quot;', `&quot;')
&rArr;
&quot;&quot;hi&quot;&quot;&quot;hi&quot;
&rArr;hihi
&quot;&quot;hi&quot; &quot;&quot;hi&quot;
&rArr;hi hi
&quot;&quot;hi&quot;&quot; &quot;hi&quot;
&rArr;hi&quot; &quot;HI&quot;
changequote
&rArr;
`hi`hi'hi'
&rArr;hi`hi'hi
changequote(`&quot;', `&quot;')
&rArr;
&quot;hi&quot;hi&quot;hi&quot;
&rArr;hiHIhi
</pre></td></tr></table>
<p>It is an error if the end of file occurs within a quoted string.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">`dangling quote
^D
error--&gt;m4:stdin:1: ERROR: end of file in string
</pre></td></tr></table>
<hr size="6">
<a name="NOD41"></a>
<a name="SEC40"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC39" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC41" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 7.3 Changing comment delimiters </h2>

<p>The default comment delimiters can be changed with the builtin
macro <code>changecom</code>:

</p><dl>
<dt><u>Builtin:</u> <b>changecom</b><i> ([<var>start</var>], [<var>end</var>])</i>
<a name="IDX39"></a>
</dt>
<dd><p>This sets <var>start</var> as the new begin-comment delimiter and <var>end</var> as
the new end-comment delimiter.  If only one argument is provided,
newline becomes the new end-comment delimiter.  The comment delimiters
can be of any length.  Omitting the first argument, or using the empty
string as the first argument, disables comments.

</p><p>The expansion of <code>changecom</code> is void.
</p></dd></dl>

<table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`comment', `COMMENT')
&rArr;
# A normal comment
&rArr;# A normal comment
changecom(`/*', `*/')
&rArr;
# Not a comment anymore
&rArr;# Not a COMMENT anymore
But: /* this is a comment now */ while this is not a comment
&rArr;But: /* this is a comment now */ while this is not a COMMENT
</pre></td></tr></table>
<a name="IDX40"></a>
<p>Note how comments are copied to the output, much as if they were quoted
strings.  If you want the text inside a comment expanded, quote the
begin-comment delimiter.

</p><p>Calling <code>changecom</code> without any arguments, or with an empty string
for the first argument, disables the commenting mechanism completely.
To restore the original comment start of `<samp>#</samp>', you must explicitly
ask for it.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`comment', `COMMENT')
&rArr;
changecom
&rArr;
# Not a comment anymore
&rArr;# Not a COMMENT anymore
changecom(`#')
&rArr;
# comment again
&rArr;# comment again
</pre></td></tr></table>
<p>The comment strings can safely contain eight-bit characters.

</p><p>Comments are recognized in preference to macros.  However, this is not
compatible with other implementations, where macros and even quoting
takes precedence over comments, so it may change in a future release.
For portability, this means that <var>start</var> should not begin with a
letter or `<samp>_</samp>' (underscore), and that neither the start-quote nor
the start-comment string should be a prefix of the other.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`hi', `HI')
&rArr;
changecom(`q', `Q')
&rArr;
q hi Q hi
&rArr;q hi Q HI
</pre></td></tr></table>
<p>Comments are recognized in preference to argument collection.  In
particular, if <var>start</var> is a single `<samp>(</samp>', then argument
collection is effectively disabled.  For portability with other
implementations, it is a good idea to avoid `<samp>(</samp>', `<samp>,</samp>', and
`<samp>)</samp>' as the first character in <var>start</var>.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`echo', `$#:$')
&rArr;
define(`hi', `HI')
&rArr;
changecom(`(',`)')
&rArr;
echo(hi)
&rArr;0::(hi)
changecom
&rArr;
changecom(`((', `))')
&rArr;
echo(hi)
&rArr;1:HI:
echo((hi))
&rArr;0::((hi))
changecom(`,', `)')
&rArr;
echo(hi,hi)bye)
&rArr;1:HI,hi)bye:
</pre></td></tr></table>
<p>It is an error if the end of file occurs within a comment.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">changecom(`/*', `*/')
&rArr;
/*dangling comment
^D
error--&gt;m4:stdin:1: ERROR: end of file in comment
</pre></td></tr></table>
<hr size="6">
<a name="NOD42"></a>
<a name="SEC41"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC40" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC42" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 7.4 Changing the lexical structure of words </h2>

<blockquote>
<p>The macro <code>changeword</code> and all associated functionality is
experimental.  It is only available if the `<samp>--enable-changeword</samp>'
option was given to <code>configure</code>, at GNU <code>m4</code> installation
time.  The functionality will go away in the future, to be replaced by
other new features that are more efficient at providing the same
capabilities.  <em>Do not rely on it</em>.  Please direct your comments
about it the same way you would do for bugs.
</p></blockquote>

<p>A file being processed by <code>m4</code> is split into quoted strings, words
(potential macro names) and simple tokens (any other single character).
Initially a word is defined by the following regular expression:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">[_a-zA-Z][_a-zA-Z0-9]*
</pre></td></tr></table>
<p>Using <code>changeword</code>, you can change this regular expression:

</p><dl>
<dt><u>Optional builtin:</u> <b>changeword</b><i> (<var>regex</var>)</i>
<a name="IDX41"></a>
</dt>
<dd><p>Changes the regular expression for recognizing macro names to be
<var>regex</var>.  If <var>regex</var> is empty, use
`<samp>[_a-zA-Z][_a-zA-Z0-9]*</samp>'.  <var>regex</var> must obey the constraint
that every prefix of the desired final pattern is also accepted by the
regular expression.  If <var>regex</var> contains grouping parentheses, the
macro invoked is the portion that matched the first group, rather than
the entire matching string.

</p><p>The expansion of <code>changeword</code> is void.
The macro <code>changeword</code> is recognized only with parameters.
</p></dd></dl>

<p>Relaxing the lexical rules of <code>m4</code> might be useful (for example) if
you wanted to apply translations to a file of numbers:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">ifdef(`changeword', `', `errprint(` skipping: no changeword support
')m4exit(`77')')dnl
changeword(`[_a-zA-Z0-9]+')
&rArr;
define(`1', `0')1
&rArr;0
</pre></td></tr></table>
<p>Tightening the lexical rules is less useful, because it will generally
make some of the builtins unavailable.  You could use it to prevent
accidental call of builtins, for example:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">ifdef(`changeword', `', `errprint(` skipping: no changeword support
')m4exit(`77')')dnl
define(`_indir', defn(`indir'))
&rArr;
changeword(`_[_a-zA-Z0-9]*')
&rArr;
esyscmd(`foo')
&rArr;esyscmd(foo)
_indir(`esyscmd', `echo hi')
&rArr;hi
&rArr;
</pre></td></tr></table>
<p>Because <code>m4</code> constructs its words a character at a time, there
is a restriction on the regular expressions that may be passed to
<code>changeword</code>.  This is that if your regular expression accepts
`<samp>foo</samp>', it must also accept `<samp>f</samp>' and `<samp>fo</samp>'.

</p><p><code>changeword</code> has another function.  If the regular expression
supplied contains any grouped subexpressions, then text outside
the first of these is discarded before symbol lookup.  So:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">ifdef(`changeword', `', `errprint(` skipping: no changeword support
')m4exit(`77')')dnl
changecom(`/*', `*/')dnl
define(`foo', `bar')dnl
changeword(`#\([_a-zA-Z0-9]*\)')
&rArr;
#esyscmd(`echo foo \#foo')
&rArr;foo bar
&rArr;
</pre></td></tr></table>
<p><code>m4</code> now requires a `<samp>#</samp>' mark at the beginning of every
macro invocation, so one can use <code>m4</code> to preprocess plain
text without losing various words like `<samp>divert</samp>'.

</p><p>In <code>m4</code>, macro substitution is based on text, while in TeX, it
is based on tokens.  <code>changeword</code> can throw this difference into
relief.  For example, here is the same idea represented in TeX and
<code>m4</code>.  First, the TeX version:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">\def\a{\message{Hello}}
\catcode`\@=0
\catcode`\\=12
@a
@bye
&rArr;Hello
</pre></td></tr></table>

<p>Then, the <code>m4</code> version:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">ifdef(`changeword', `', `errprint(` skipping: no changeword support
')m4exit(`77')')dnl
define(`a', `errprint(`Hello')')dnl
changeword(`@\([_a-zA-Z0-9]*\)')
&rArr;
@a
&rArr;errprint(Hello)
</pre></td></tr></table>
<p>In the TeX example, the first line defines a macro <code>a</code> to
print the message `<samp>Hello</samp>'.  The second line defines <kbd>@</kbd> to
be usable instead of <kbd>\</kbd> as an escape character.  The third line
defines <kbd>\</kbd> to be a normal printing character, not an escape.
The fourth line invokes the macro <code>a</code>.  So, when TeX is run
on this file, it displays the message `<samp>Hello</samp>'.

</p><p>When the <code>m4</code> example is passed through <code>m4</code>, it outputs
`<samp>errprint(Hello)</samp>'.  The reason for this is that TeX does
lexical analysis of macro definition when the macro is <em>defined</em>.
<code>m4</code> just stores the text, postponing the lexical analysis until
the macro is <em>used</em>.

</p><p>You should note that using <code>changeword</code> will slow <code>m4</code> down
by a factor of about seven, once it is changed to something other
than the default regular expression.  You can invoke <code>changeword</code>
with the empty string to restore the default word definition, and regain
the parsing speed.

</p><hr size="6">
<a name="NOD43"></a>
<a name="SEC42"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC41" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 7.5 Saving input </h2>

<p>It is possible to `save' some text until the end of the normal input has
been seen.  Text can be saved, to be read again by <code>m4</code> when the
normal input has been exhausted.  This feature is normally used to
initiate cleanup actions before normal exit, e.g., deleting temporary
files.

</p><p>To save input text, use the builtin <code>m4wrap</code>:

</p><dl>
<dt><u>Builtin:</u> <b>m4wrap</b><i> ([<var>string</var>], &hellip;)</i>
<a name="IDX42"></a>
</dt>
<dd><p>Stores <var>string</var> in a safe place, to be reread when end of input is
reached.  As a GNU extension, additional arguments are
concatenated with a space to the <var>string</var>.

</p><p>The expansion of <code>m4wrap</code> is void.
The macro <code>m4wrap</code> is recognized only with parameters.
</p></dd></dl>

<table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`cleanup', `This is the `cleanup' action.
')
&rArr;
m4wrap(`cleanup')
&rArr;
This is the first and last normal input line.
&rArr;This is the first and last normal input line.
^D
&rArr;This is the cleanup action.
</pre></td></tr></table>
<p>The saved input is only reread when the end of normal input is seen, and
not if <code>m4exit</code> is used to exit <code>m4</code>.

</p><p>It is safe to call <code>m4wrap</code> from saved text, but then the order in
which the saved text is reread is undefined.  If <code>m4wrap</code> is not used
recursively, the saved pieces of text are reread in the opposite order
in which they were saved (LIFO--last in, first out).  However, this
behavior is likely to change in a future release, to match
POSIX, so you should not depend on this order.

</p><p>Here is an example of implementing a factorial function using
<code>m4wrap</code>:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`f', `ifelse(`$1', `0', `Answer: 0!=1
', eval(`$1&gt;1'), `0', `Answer: $2$1=eval(`$2$1')
', `m4wrap(`f(decr(`$1'), `$2$1*')')')')
&rArr;
f(`10')
&rArr;
^D
&rArr;Answer: 10*9*8*7*6*5*4*3*2*1=3628800
</pre></td></tr></table>
<p>Invocations of <code>m4wrap</code> at the same recursion level are
concatenated and rescanned as usual:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">define(`aa', `AA
')
&rArr;
m4wrap(`a')m4wrap(`a')
&rArr;
^D
&rArr;AA
</pre></td></tr></table>

<p>however, the transition between recursion levels behaves like an end of
file condition between two input files.

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">m4wrap(`m4wrap(`)')len(abc')
&rArr;
^D
error--&gt;m4: ERROR: end of file in argument list
</pre></td></tr></table>
<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC37" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="m4_8.html#SEC43" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="m4.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="m4_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="m4_18.html#SEC83" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="m4_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated by <em>System Administrator</em> on <em>September, 23 2007</em> using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.70</em></a>.
 </font>
 <br>

</p>
</body>
</html>
