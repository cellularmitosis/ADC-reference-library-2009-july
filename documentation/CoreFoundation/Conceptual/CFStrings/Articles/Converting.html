<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Strings Programming Guide for Core Foundation: Converting Between String Encodings</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Converting Between String Encodings"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001187" title="Converting Between String Encodings"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000421" target="_top">Core Foundation</a> &gt; <a href="../../../DataManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000421-TP30000445" target="_top">Data Management</a> &gt; <a href="../index.html" target="_top">Strings Programming Guide for Core Foundation</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="MutableStrings.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="ExternalReps.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20001187-CJBEHAAG" title="Converting Between String Encodings"></a><hr /><H1>Converting Between String Encodings</H1><p>String objects give you a number of tools for converting between string encodings. Some routines do the actual conversions while others show which encodings are available and help you chose the best encoding for the current situation.</p><p>If you want to convert between any two non-Unicode encodings, you can use a <code>CFString</code> object as an intermediary. Say you have a string encoded as Windows Latin 1 and you want to encode it as Mac OS Roman. Just convert the string to Unicode first (the <code>CFString</code> object), then convert the string’s contents to the desired encoding.</p><p>Many of the creation and content-accessing functions described in earlier sections of this document include an encoding parameter typed <code>CFStringEncoding</code>. These functions are listed in <span class="content_text"><a href="Converting.html#//apple_ref/doc/uid/20001187-100992-CHDCIBEI">Table 1</a></span>. To specify the encoding of the source or destination string (depending on whether you’re creating a <code>CFString</code> object or accessing its contents), specify the <code>enum</code> value for the desired encoding in this parameter when you call one of these functions. Use the <code>CFStringIsEncodingAvailable</code> function to test for the availability of an “external” encoding on your system before you call a conversion function.</p><a name="//apple_ref/doc/uid/20001187-100992-CHDCIBEI" title="Table 1Encoding-conversion functions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/20001187-100992" title="Table 1Encoding-conversion functions"></a><strong>Table 1&nbsp;&nbsp;</strong>Encoding-conversion functions</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Converts to CFString (Unicode)</p></th></tr><tr><td  scope="row"><p><code>CFStringCreateWithPascalString</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateWithCString</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateWithPascalStringNoCopy</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateWithCStringNoCopy</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateWithBytes</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateFromExternalRepresentation</code></p></td></tr></table></div><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Converts from CFString (Unicode)</p></th></tr><tr><td  scope="row"><p><code>CFStringGetPascalString</code></p></td></tr><tr><td  scope="row"><p><code>CFStringGetCString</code></p></td></tr><tr><td  scope="row"><p><code>CFStringGetPascalStringPtr</code></p></td></tr><tr><td  scope="row"><p><code>CFStringGetCStringPtr</code></p></td></tr><tr><td  scope="row"><p><code>CFStringGetBytes</code></p></td></tr><tr><td  scope="row"><p><code>CFStringCreateExternalRepresentation</code></p></td></tr></table></div><p>A word of caution: not all conversions are guaranteed to be successful. This is particularly true if you are trying to convert a <code>CFString</code> object with characters that map to a variety of character sets. For example, let’s say you have a Unicode string that includes ASCII characters and accented Latin characters. You could convert this string to Mac OS Roman but not to Mac OS Japanese. In these cases, you can specify “lossy” conversion using the <code>CFStringGetBytes</code> function; this kind of conversion substitutes a “loss” character for each character that cannot be converted. The <code>CFStringGetBytes</code> function is described in the next section</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Converting.html#//apple_ref/doc/uid/20001187-101121-CHDBCHAI">The Basic Conversion Routines</a>
				
			<br/>
			
        
			
			
				<a href="Converting.html#//apple_ref/doc/uid/20001187-101274-TPXREF115">Encoding-Conversion Utilities</a>
				
			<br/>
			
        
			
			
				<a href="Converting.html#//apple_ref/doc/uid/20001187-DontLinkElementID_6">Supported Encodings</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001187-101121" title="The Basic Conversion Routines"></a><a name="//apple_ref/doc/uid/20001187-101121-CHDBCHAI" title="The Basic Conversion Routines"></a><h2>The Basic Conversion Routines</h2><p>Among the string object functions that convert the encodings of characters in <code>CFString</code> objects are the two low-level conversion functions, <code>CFStringGetBytes</code> and <code>CFStringCreateWithBytes</code>. As their names suggest, these functions operate on byte buffers of a known size. In addition to performing encoding conversions, they also handle any special characters in a string (such as a BOM) that makes the string suitable for external representation.</p><p>However, the <code>CFStringGetBytes</code> function is particularly useful for encoding conversions because it allows the specification of a <strong>loss</strong> byte. If you specify a character for the loss byte, the function substitutes that character when it cannot convert the Unicode value to the proper character. If you specify 0 for the loss byte, this “lossy conversion” is not allowed and the function returns (indirectly) an partial set of characters when it encounters the first character it cannot convert. All other content-accessing functions of <code>CFString</code> disallow lossy conversion.</p><p><span class="content_text"><a href="Converting.html#//apple_ref/doc/uid/20001187-101168-CHDDAJJG">Listing 1</a></span> illustrates how <code>CFStringGetBytes</code> might be used to convert a string from the system encoding to Windows Latin 1. Note one other feature of the function: it allows you to convert a string into a fixed-size buffer one segment at a time.</p><a name="//apple_ref/doc/uid/20001187-101168-CHDDAJJG" title="Listing 1Converting to a different encoding with CFStringGetBytes"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001187-101168" title="Listing 1Converting to a different encoding with CFStringGetBytes"></a><strong>Listing 1&nbsp;&nbsp;</strong>Converting to a different encoding with CFStringGetBytes</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef str;<span></span></pre></td></tr><tr><td scope="row"><pre>CFRange rangeToProcess;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>str = CFStringCreateWithCString(NULL, "Hello World",<span></span></pre></td></tr><tr><td scope="row"><pre>    kCFStringEncodingMacRoman);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>rangeToProcess = CFRangeMake(0, CFStringGetLength(str));<span></span></pre></td></tr><tr><td scope="row"><pre>while (rangeToProcess.length > 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt8 localBuffer[100];<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex usedBufferLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex numChars = CFStringGetBytes(str, rangeToProcess, kCFStringEncodingWindowsLatin1, ‘?’, FALSE, (UInt8 *)localBuffer, 100, &amp;usedBufferLength);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (numChars == 0) break;   // Failed to convert anything...<span></span></pre></td></tr><tr><td scope="row"><pre>    processCharacters(localBuffer, usedBufferLength);<span></span></pre></td></tr><tr><td scope="row"><pre>    rangeToProcess.location += numChars;<span></span></pre></td></tr><tr><td scope="row"><pre>    rangeToProcess.length -= numChars;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If the size of the string to convert is relatively small, you can take a different approach with the <code>CFStringGetBytes</code> function. With the buffer parameter set to <code>NULL</code> you can call the function to find out two things. If the function result is greater than 0 conversion is possible. And, if conversion is possible, the last parameter (<em>usedBufLen</em>) will contain the number of bytes required for the conversion. With this information you can allocate a buffer of the needed size and convert the string at one shot into the desired encoding. However, if the string is large this technique has its drawbacks; asking for the length could be expensive and the allocation could require a lot of memory.</p><a name="//apple_ref/doc/uid/20001187-101274" title="Encoding-Conversion Utilities"></a><a name="//apple_ref/doc/uid/20001187-101274-TPXREF115" title="Encoding-Conversion Utilities"></a><h2>Encoding-Conversion Utilities</h2><p>Besides the functions that convert between encodings, string objects offer a number of functions that can help you to find out which encodings are available and, of these, which are the best to use in your code.</p><a name="//apple_ref/doc/uid/20001187-DontLinkElementID_3" title="Encoding by characteristic"></a><h3>Encoding by characteristic</h3><p>The <code>CFStringGetSmallestEncoding</code> function determines the smallest encoding that can be used on a particular system (smallest in terms of bytes needed to represent one character). The <code>CFStringGetFastestEncoding</code> function gets the encoding on the current system with the fastest conversion time from Unicode. The <code>CFStringGetSystemEncoding</code> function obtains the encoding used by strings generated by the operating system.</p><a name="//apple_ref/doc/uid/20001187-DontLinkElementID_4" title="Available encodings"></a><h3>Available encodings</h3><p>Use the <code>CFStringIsEncodingAvailable</code> and <code>CFStringGetListOfAvailableEncodings</code> functions to obtain information about encodings available on your system.</p><a name="//apple_ref/doc/uid/20001187-DontLinkElementID_5" title="Mappings to encoding sets"></a><h3>Mappings to encoding sets</h3><p>You can use the <code>CFStringConvertEncodingToWindowsCodepage</code> and <code>CFStringConvertWindowsCodepageToEncoding</code> functions to convert between Windows codepage numbers and <code>CFStringEncoding</code> values. Similar sets of functions exist for Cocoa NSString encoding constants and IANA “charset” identifiers used by MIME encodings.</p><a name="//apple_ref/doc/uid/20001187-DontLinkElementID_6" title="Supported Encodings"></a><h2>Supported Encodings</h2><p>Core Foundation string objects supports conversions between Unicode encodings of CFString objects and a wide range of international, national, and industry encodings. Supported encodings come in two sets, an “internal” set defined in <code>CFString.h</code> by the <code>CFStringBuiltInEncodings</code><code>enum</code>, and an “external” set defined in <code>CFStringEncodingExt.h</code> by the <code>CFStringEncodings</code><code>enum</code>. The encodings in the internal set are guaranteed to be available on all platforms for conversions to and from CFString objects. The built-in encodings (as designated by the constant names in <code>CFStringBuiltInEncodings</code>) include:</p><ul class="simple"><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingMacRoman" target="_top">kCFStringEncodingMacRoman</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingWindowsLatin1" target="_top">kCFStringEncodingWindowsLatin1</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingISOLatin1" target="_top">kCFStringEncodingISOLatin1</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingNextStepLatin" target="_top">kCFStringEncodingNextStepLatin</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingASCII" target="_top">kCFStringEncodingASCII</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingUnicode" target="_top">kCFStringEncodingUnicode</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingUTF8" target="_top">kCFStringEncodingUTF8</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingNonLossyASCII" target="_top">kCFStringEncodingNonLossyASCII</a></code></p></li></ul><p>and on Mac OS X v10.4 and later:</p><ul class="simple"><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingUTF16" target="_top">kCFStringEncodingUTF16</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingUTF16BE" target="_top">kCFStringEncodingUTF16BE</a></code></p></li><li><p><code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingUTF32" target="_top">kCFStringEncodingUTF32</a></code></p></li></ul><p>Conversions using the encodings in the external set are possible only if the underlying system supports the encodings.</p><p>The encodings of string objects parallel those used by the Mac OS 9 Text Encoding Converter. The <code>CFStringEncoding</code> type defines encoding values that are equal to those defined by Mac OS 9 for the equivalent <code>TextEncoding</code> data type. For example, Core Foundation’s <code><a href="../../../Reference/CFStringRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFStringEncodingMacRoman" target="_top">kCFStringEncodingMacRoman</a></code> is the same integer value as <code><a href="../../../../Carbon/Reference/Text_Encodin_sion_Manager/Reference/reference.html#//apple_ref/doc/c_ref/kTextEncodingMacRoman" target="_top">kTextEncodingMacRoman</a></code>. </p><p>String objects also provides special conversion facilities for Cocoa encodings for <code>NSString</code> objects, for Windows code pages, and for IANA registry character set names.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="MutableStrings.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="ExternalReps.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-03-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/Converting.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/Converting.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/Converting.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
