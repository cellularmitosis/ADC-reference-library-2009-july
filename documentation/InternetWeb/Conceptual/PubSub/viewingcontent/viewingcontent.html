<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Publication Subscription Programming Guide: Viewing and Retrieving Content</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Viewing and Retrieving Content"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004945-CH6" title="Viewing and Retrieving Content"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../WebContent-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30001074" target="_top">Web Content</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004945-CH1-DontLinkElementID_24">Publication Subscription Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../subscribing/subscribing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004945-CH6-SW3" title="Viewing and Retrieving Content"></a><h1>Viewing and Retrieving Content</h1><p>After you obtain a feed object, you need to be able to retrieve the information from within it.  Sometimes this information contains not only text, but also files in enclosures or extension XML. The following chapter describes what information is available in an entry and how to access it.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="viewingcontent.html#//apple_ref/doc/uid/TP40004945-CH6-DontLinkElementID_12">Where’s My Entry?</a>
				
			<br/>
			
        
			
			
				<a href="viewingcontent.html#//apple_ref/doc/uid/TP40004945-CH6-SW1">Downloading Enclosures</a>
				
			<br/>
			
        
			
			
				<a href="viewingcontent.html#//apple_ref/doc/uid/TP40004945-CH6-DontLinkElementID_13">Extension XML</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004945-CH6-DontLinkElementID_12" title="Where&acirc;&#128;&#153;s My Entry?"></a><h2>Where’s My Entry?</h2><p>Most feeds contains one or more entries. To retrieve the entries from a feed object, use either the <code>entries</code> property (for an array of entry objects) or the <code>entryEnumeratorSortedBy:</code> method (for an enumerator of entry objects).</p><p>An entry object contains all the information specific to an entry, such as its title, its URL, its authors, its content, and, if necessary, its enclosures. Most of this information is a simple string or URL. However, three of components are a little more complicated.</p><p>In some feed standards, the author contains not only a name but also contains an email address and a homepage (see <span class="content_text"><a href="../UnderstandingFeeds/UnderstandingFeeds.html#//apple_ref/doc/uid/TP40004945-CH3-SW1">“Feed Formats”</a></span>). The author information in Publication Subscription is stored in an author object. An author object represents a name, an email address, a homepage and a link to an <code>ABPerson</code> object.</p><p>The content of an entry is also more complex than a simple string. It often comes in one of two different forms: either plain text, or HTML formatted text. In Publication Subscription the content and the summary of an entry are stored as content objects. A content object contains methods for retrieving the content either as a plain text string or an HTML string. The content is returned in the specified format based on which accessor method is used.</p><p>An enclosure is a way to attach a file to an entry. If an entry contains enclosures, they will be linked to the entry object. For more information about enclosures, read <span class="content_text"><a href="viewingcontent.html#//apple_ref/doc/uid/TP40004945-CH6-SW1">“Downloading Enclosures.”</a></span></p><p>To print out the title and content of every entry in a feed, the code would look like <span class="content_text">Listing 4-1</span>.</p><a name="//apple_ref/doc/uid/TP40004945-CH6-SW4" title="Listing 4-1Accessing every entry in a feed"></a><p class="codesample"><strong>Listing 4-1&nbsp;&nbsp;</strong>Accessing every entry in a feed</p><div class="codesample"><table><tr><td scope="row"><pre>// Retrieve the entries as an unsorted enumerator<span></span></pre></td></tr><tr><td scope="row"><pre>NSEnumerator *entries = [feed entryEnumeratorSortedBy: nil];<span></span></pre></td></tr><tr><td scope="row"><pre>PSEntry *entry;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Go through each entry and print out the title, authors, and content<span></span></pre></td></tr><tr><td scope="row"><pre>while (entry = [entries nextObject]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Entry Title:%@", entry.title);<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Entry Authors:%@", entry.authorsForDisplay);<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Entry Content:%@", entry.content.plainTextString);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Since it follows an observer design pattern, Publication Subscription can also notify your application when any changes occur to a feed. Register with the notification center to be alerted when any change occurs (<code>PSFeedEntriesChangedNotification</code>). When your callback method is invoked, the changed entries are stored as a key-value pair in the user information dictionary of the notification.</p><a name="//apple_ref/doc/uid/TP40004945-CH6-SW1" title="Downloading Enclosures"></a><h2>Downloading Enclosures</h2><p>Some entries may contain links to files as enclosures. Publication Subscription provides features that make it easy to download the files within the enclosure. Each enclosure is stored as a enclosure object in its associated entry object. Because there may be more than one enclosure in an entry, the entry object property <code>enclosures</code> returns an array of enclosure objects. In most cases, this array only contains one object. Each of these objects contains information about the enclosure’s size, URL and MIME type.</p><p>By default, enclosures are not automatically downloaded. You can change this setting on a per-feed basis so that any enclosure from a subscribed feed is downloaded with the entry. <span class="content_text">Listing 4-2</span> shows how to make a feed download its enclosures automatically.</p><a name="//apple_ref/doc/uid/TP40004945-CH6-SW7" title="Listing 4-2Downloading enclosures automatically"></a><p class="codesample"><strong>Listing 4-2&nbsp;&nbsp;</strong>Downloading enclosures automatically</p><div class="codesample"><table><tr><td scope="row"><pre>PSFeedSettings *settings = feed.settings;<span></span></pre></td></tr><tr><td scope="row"><pre>settings.downloadsEnclosures = YES;<span></span></pre></td></tr><tr><td scope="row"><pre>feed.settings = settings;<span></span></pre></td></tr></table></div><p>If you want to download the file in the enclosures individually, send <code>download:</code> to the appropriate enclosure object. The <code>download:</code> method is asynchronous, so it rarely returns an error. Instead, check on the status of the download with the <code>downloadState</code> property. There are six possible states:</p><ul class="simple"><li><p><code>PSEnclosureDownloadDidFail</code></p></li><li><p><code>PSEnclosureDownloadDidFinish</code></p></li><li><p><code>PSEnclosureDownloadIsIdle</code></p></li><li><p><code>PSEnclosureDownloadIsQueued</code></p></li><li><p><code>PSEnclosureDownloadIsActive</code></p></li><li><p><code>PSEnclosureDownloadWasDeleted</code></p></li></ul><p>If the download failed, see what caused the failure by using the <code>downloadError</code> method. If the download is still active, you can check on its progress by using the <code>downloadProgress</code> method. Assuming the download finishes, the location of the downloaded file is available with the <code>downloadedPath</code> property.</p><p>Although the download status can be checked in a synchronous manner, it is recommended that you register for the notification <code>PSEnclosureDownloadStateDidChangeNotification</code> instead. When your callback method is invoked, you can determine the status of the download. <span class="content_text">Listing 4-3</span> shows how to start downloading the file in the enclosure and register for the appropriate notification. <span class="content_text">Listing 4-4</span> shows a callback method for the notification.</p><a name="//apple_ref/doc/uid/TP40004945-CH6-SW5" title="Listing 4-3Downloading an enclosure"></a><p class="codesample"><strong>Listing 4-3&nbsp;&nbsp;</strong>Downloading an enclosure</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Get the enclosures from the current entry, and retrieve the first one<span></span></pre></td></tr><tr><td scope="row"><pre>NSArray *enclosureArray = entry.enclosures;<span></span></pre></td></tr><tr><td scope="row"><pre>enclosure = [enclosureArray objectAtIndex: 0];<span></span></pre></td></tr><tr><td scope="row"><pre>NSError *error;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Download the enclosure<span></span></pre></td></tr><tr><td scope="row"><pre>if (![enclosure download:&amp;error]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"Enclosure download failed: %@", error)<span></span></pre></td></tr><tr><td scope="row"><pre>} else {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Register for any changes to the download's state<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSNotificationCenter defaultCenter]<span></span></pre></td></tr><tr><td scope="row"><pre>            addObserver:self<span></span></pre></td></tr><tr><td scope="row"><pre>            selector:@selector(downloadStateChanged:)<span></span></pre></td></tr><tr><td scope="row"><pre>            name: PSEnclosureDownloadStateDidChangeNotification<span></span></pre></td></tr><tr><td scope="row"><pre>            object: enclosure];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004945-CH6-SW6" title="Listing 4-4Receiving download state changes through notifications"></a><p class="codesample"><strong>Listing 4-4&nbsp;&nbsp;</strong>Receiving download state changes through notifications</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) downloadStateChanged: (NSNotification *) sender {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // See what state change cause the notification to be sent<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (enclosure.downloadState) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // If the download failed, log why and stop receiving notifications<span></span></pre></td></tr><tr><td scope="row"><pre>        case PSEnclosureDownloadStateDidFail:<span></span></pre></td></tr><tr><td scope="row"><pre>            NSLog(@"Enclosure download failed: %@", enclosure.downloadError);<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSNotificationCenter defaultCenter]<span></span></pre></td></tr><tr><td scope="row"><pre>                removeObserver: self<span></span></pre></td></tr><tr><td scope="row"><pre>                name: PSEnclosureDownloadStateDidChangeNotification<span></span></pre></td></tr><tr><td scope="row"><pre>                object: enclosure];<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // If the download succeeded, log the location of the file and stop<span></span></pre></td></tr><tr><td scope="row"><pre>        // receiving notifications<span></span></pre></td></tr><tr><td scope="row"><pre>        case PSEnclosureDownloadStateDidFinish:<span></span></pre></td></tr><tr><td scope="row"><pre>            NSLog(@"Location of downloaded file is: %@", enclosure.downloadedPath);<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSNotificationCenter defaultCenter]<span></span></pre></td></tr><tr><td scope="row"><pre>                removeObserver: self<span></span></pre></td></tr><tr><td scope="row"><pre>                name: PSEnclosureDownloadStateDidChangeNotification<span></span></pre></td></tr><tr><td scope="row"><pre>                object: enclosure];<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case default:<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004945-CH6-DontLinkElementID_13" title="Extension XML"></a><h2>Extension XML</h2><p>Many feeds may also contain extension XML elements. If additional namespaces are used in a feed, use the <code>extensionXMLElementsUsingNamespace:</code> method to return an array of <code>NSXMLElement</code> objects. Pass the namespace URL, not the prefix, to the <code>extensionXMLElementsUsingNamespace:</code> method. If your feed had an entry like that in <span class="content_text"><a href="../UnderstandingFeeds/UnderstandingFeeds.html#//apple_ref/doc/uid/TP40004945-CH3-SW2">Listing 1-3</a></span>, <code>extensionXMLElementsUsingNamespace:</code> returns an array of  four <code>NSXMLElement</code> objects.</p><p><span class="content_text">Listing 4-5</span> shows how to find a specific element in a particular namespace in an entry. In this example, the namespace is the iTunes Podcast.</p><a name="//apple_ref/doc/uid/TP40004945-CH6-SW2" title="Listing 4-5Retrieving extension XML from an entry"></a><p class="codesample"><strong>Listing 4-5&nbsp;&nbsp;</strong>Retrieving extension XML from an entry</p><div class="codesample"><table><tr><td scope="row"><pre>// Find each element using the iTunes Podcast namespace<span></span></pre></td></tr><tr><td scope="row"><pre>for( NSXMLElement *elem in [entry extensionXMLElementsUsingNamespace: @"http://www.itunes.com/dtds/podcast-1.0.dtd"] ) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Check if the element is called "keywords"<span></span></pre></td></tr><tr><td scope="row"><pre>    if (NSOrderedSame == [[elem localName] isEqualToString:@"keywords"]) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // If it is, print the data from the element to the log<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLog(@"keywords:%@", [elem stringValue]);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../subscribing/subscribing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/InternetWeb/Conceptual/PubSub/viewingcontent/viewingcontent.html%3Fid%3DTP40004945-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/InternetWeb/Conceptual/PubSub/viewingcontent/viewingcontent.html%3Fid%3DTP40004945-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/InternetWeb/Conceptual/PubSub/viewingcontent/viewingcontent.html%3Fid%3DTP40004945-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>