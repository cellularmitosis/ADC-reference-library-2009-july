<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Project Builder for Java (Legacy): Developing a JNI Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Developing a JNI Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000933-CH209" title="Developing a JNI Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/Java-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000528" target="_top">Java</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40000933-CH204-TPXREF101">Project Builder for Java (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SwingApplication/SwingApplication.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../DebuggingApplications/DebuggingApplications.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP40000933-CH209-BCIBFEFE" title="Developing a JNI Application"></a><h1>Developing a JNI Application</h1><p>When you need to leverage existing C or Objective-C code in a Java application or need to improve the performance of an application by executing critical parts natively instead of on the Java virtual machine, you use the Java Native Interface (JNI). The JNI provides a way for Java code to communicate with C-based libraries.</p><p>Project Builder provides a template that facilitates the development of JNI-based applications. For an explanation of the elements of that template, including its targets, see <span class="content_text"><a href="../ApplicationDevelopment/ApplicationDevelopment.html#//apple_ref/doc/uid/TP40000933-CH205-BCIFBHAF">“The JNI Application Template.”</a></span></p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="JNIApplication.html#//apple_ref/doc/uid/TP40000933-CH209-TPXREF103">Creating the “Hello, JNI” Application</a>
				
			<br/>
			
        
			
			
				<a href="JNIApplication.html#//apple_ref/doc/uid/TP40000933-CH209-TPXREF104">JNI-Based Examples</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000933-CH209-TPXREF103" title="Creating the &acirc;&#128;&#156;Hello, JNI&acirc;&#128;&#157; Application"></a><h2>Creating the “Hello, JNI” Application</h2><p>The JNI application template provides yet another version of a “Hello, World” application. This one, however, joins the flexibility of Java with the high performance of C code to print the famous greeting on the console. Follow these steps to create a JNI-based application.</p><ol class="ol"><li class="li"><p>Launch Project Builder. It’s located in <code>/Developer/Applications</code>.</p></li><li class="li"><p>Create a Java JNI application project.</p><p>Choose File > New Project, and select Java JNI Application under Java in the template list.</p><div class="item_figure"><img src = "../art/pbajni.gif" alt = "image: ../art/pbajni.gif" width="444" height="347"></div></li><li class="li"><p>Name the project and choose a location for it.</p><p>In the New Java JNI Application pane of the Assistant, enter <code>Hello_JNI</code> in the Project Name text input field, click Choose, and choose a location for the project folder.</p><div class="item_figure"><img src = "../art/pbajnilocation.gif" alt = "image: ../art/pbajnilocation.gif" width="442" height="346"></div></li></ol><p>When done, you should see the Project Builder window, shown in <span class="content_text">Figure 5-1</span>. The files in red are the project’s products, which haven’t been built.</p><br/><div><a name="//apple_ref/doc/uid/TP40000933-CH209-BCIJBICA" title="Figure 5-1The Leverage project in the Project Builder window"></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>The Leverage project in the Project Builder window</p><img src = "../art/pbjni.gif" alt = "The Leverage project in the Project Builder window" width="666" height="374"></div><br/><p>Project Builder generated the source files for the native side and the Java side of the application. They’re shown in <span class="content_text">Listing 5-1</span> and <span class="content_text">Listing 5-2</span>.</p><a name="//apple_ref/doc/uid/TP40000933-CH209-BCIBHGCC" title="Listing 5-1Leveragejnilib.c source file in the Leverage project"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong><code>Leveragejnilib.c</code> source file in the Leverage project</p><div class="codesample"><table><tr><td scope="row"><pre>#include "JNIWrapper.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int shared_function(const char *arg) {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("shared_function called with %s\n", arg);<span></span></pre></td></tr><tr><td scope="row"><pre>    return 42;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>JNIEXPORT jint JNICALL Java_JNIWrapper_native_1method(JNIEnv *env, jobject this, jstring arg) {<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Convert to UTF8 */<span></span></pre></td></tr><tr><td scope="row"><pre>    const char *argutf  = (*env)->GetStringUTFChars(env, arg, JNI_FALSE);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* Call into external dylib function */<span></span></pre></td></tr><tr><td scope="row"><pre>    jint rc = shared_function(argutf);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* Release created UTF8 string. */<span></span></pre></td></tr><tr><td scope="row"><pre>    (*env)->ReleaseStringUTFChars(env, arg, argutf);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return rc;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000933-CH209-BCIJJHIE" title="Listing 5-2JNIWrapper.java source file in the Leverage project"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong><code>JNIWrapper.java</code> source file in the Leverage project</p><div class="codesample"><table><tr><td scope="row"><pre>import java.util.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class JNIWrapper {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    static {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Ensure native JNI library is loaded.<span></span></pre></td></tr><tr><td scope="row"><pre>        System.loadLibrary("Leverage");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public JNIWrapper() {<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("JNIWrapper instance created");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    native int native_method(String arg);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public static void main (String args[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("Started JNIWrapper");<span></span></pre></td></tr><tr><td scope="row"><pre>        JNIWrapper newjni = new JNIWrapper();<span></span></pre></td></tr><tr><td scope="row"><pre>        int result = newjni.native_method("Hello World !");<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("Finished JNIWrapper. Answer is " + result);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Now, make sure the Leverage target is selected, and build and run the application. Several files appear in the project’s build folder. Because this is a JNI application, in addition to the JAR file containing the Java application, you see a JNI library file, which contains the object file for the native function specified in <code>Leveragejnilib.c</code> (<span class="content_text">Figure 5-2</span>). The Header folder contains the <code>JNIWrapper.h</code> file, which is generated by <code>javah</code> from the <code>JNIWrapper.class</code> file.</p><br/><div><a name="//apple_ref/doc/uid/TP40000933-CH209-BCIBHAIF" title="Figure 5-2The build folder of the Leverage project after building the application"></a><p><strong>Figure 5-2&nbsp;&nbsp;</strong>The build folder of the Leverage project after building the application</p><img src = "../art/fndrjnibuild.gif" alt = "The build folder of the Leverage project after building the application" width="287" height="267"></div><br/><a name="//apple_ref/doc/uid/TP40000933-CH209-TPXREF104" title="JNI-Based Examples"></a><h2>JNI-Based Examples</h2><p>The developer tools package includes several examples of JNI-based applications, including a Cocoa/Java application located in <code>/Developer/Examples/Java/AppleDemos/CocoaComponent</code>. Open those projects and examine them to get a glimpse of the power and flexibility that Java and JNI provide.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SwingApplication/SwingApplication.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../DebuggingApplications/DebuggingApplications.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-10-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Java/Conceptual/Project_Builder_for_Java/JNIApplication/JNIApplication.html%3Fid%3DTP40000933-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Java/Conceptual/Project_Builder_for_Java/JNIApplication/JNIApplication.html%3Fid%3DTP40000933-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Java/Conceptual/Project_Builder_for_Java/JNIApplication/JNIApplication.html%3Fid%3DTP40000933-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>