<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Compression and Decompression Guide: How to Compress and Decompress Sequences of Images</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How to Compress and Decompress Sequences of Images"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages" title="How to Compress and Decompress Sequences of Images"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../CompressionDecompression-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000498" target="_top">Compression &amp; Decompression</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000878-IntroductiontoQuickTimeCompressionandDecompressionGuide-DontLinkElementID_145">QuickTime Compression and Decompression Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../F-Chapter/6WorkingwiththeImage.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../H-Chapter/8ICMFunctionsDataTyp.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-SW1" title="How to Compress and Decompress Sequences of Images"></a>
<h1>How to Compress and Decompress Sequences of Images</h1>

<p>This chapter provides a sample program illustrating the processes used to compress and decompress image sequences. The listing is broken up into a main program and a series of functions. Each function is introduced with a discussion of its purpose.</p>
<p>Functions for saving a sequence of images to a disk and for creating, compressing, and drawing a sequence of images are also discussed.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_44">Compressing Sequences</a>
				
			<br/>
			
        
			
			
				<a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_45">Decompressing Sequences</a>
				
			<br/>
			
        
			
			
				<a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_49">Defining Key Frame Rates</a>
				
			<br/>
			
        
			
			
				<a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_50">A Sample Program for Compressing and Decompressing a Sequence of Images</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_44" title="Compressing Sequences"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-CompressingSequences" title="Compressing Sequences"></a>Compressing Sequences</h2>
<p>The Image Compression Manager also provides functions that allow your application to compress and decompress sequences of images, such as might constitute a QuickTime movie. The tools provided by the Image Compression Manager focus on image compression and decompression and on the ordering of the images in a sequence, not on timing considerations. Use the Movie Toolbox to handle all the issues relating to the amount of time each image should be shown on the screen. For information on decompressing image sequences, see the next section, <span class="content_text"><a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DecompressingSequences">Decompressing Sequences</a></span>.</p>
<p>A series of images can be compressed as a sequence if those images share an image description. That is, each image in the sequence must have the same compressor type, pixel depth, color lookup table, and boundary dimensions. To take best advantage of temporal compression, the images should also be related to each other (like frames in a movie), but this relationship is not necessary for them to be grouped as a sequence. If you create a sequence from completely unrelated images, you may not be able to achieve significant temporal compression.</p>
<p>When compressing image sequences, your application must perform several steps in addition to those required for single-frame image compression. This section describes a typical function for compressing an image sequence. Note that much of the setup processing is the same as that performed for single-frame images.</p>
<p>First, determine the parameters for the compression operation. As with single-image compression, the user may specify these parameters in a dialog box you can supply via the standard image-compression dialog component. Your application may choose to give the user the ability to specify such parameters as the compression algorithm, image quality, and so on. Note that image sequences require additional parameters, such as temporal quality.</p>
<p>Your application may give the user the option of specifying a compression algorithm based on an important performance characteristic. For example, the user may be most concerned with size, speed, or accuracy. The Image Compression Manager allows your application to choose the compressor component that meets the specified criterion.</p>
<p>Your application signals its intention to compress an image sequence by issuing the Image Compression Manager&#8217;s <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceBegin" target="_top">CompressSequenceBegin</a></code> function (see <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-WorkingWithSequences"> Working With Sequences</a></span> for more information about this function). At this time your application specifies many of the parameters that govern the sequence-compression operation. When you set the compression parameters and the <code>temporalQuality</code> parameter is not 0, then be sure to set the value of either the  <code>codecFlagUpdatePrevious</code> or  <code>codecFlagUpdatePreviousComp</code> flag to 1 in the <code>flags</code> parameter of the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceBegin" target="_top">CompressSequenceBegin</a></code> function.</p>
<p>Once you have started the sequence, you then compress each image in the sequence by performing the following steps:</p>
<ol class="ol">
<li class="li"><p>Your application must call the Image Compression Manager&#8217;s <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/GetMaxCompressionSize" target="_top">GetMaxCompressionSize</a></code> function to determine the maximum size of the compressed data that will result from the current image (see <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-GettingInformationAboutCompressedData">Getting Information About Compressed Data</a></span> for more information about this function). You provide the specified compression parameters to this function. In response, the Image Compression Manager invokes the appropriate compressor component to determine the number of bytes required to store the largest compressed image in the sequence. Your application should then reserve sufficient memory to accommodate that compressed image. You can use this returned value until you change the settings of the compression parameters.</p></li>
<li class="li"><p>Your application must call the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceFrame" target="_top">CompressSequenceFrame</a></code> function to compress the image (see <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-WorkingWithSequences">Working With Sequences</a></span> for more information about this function). It may be necessary or desirable for your application to change one or more of the compression parameters while processing a sequence. The Image Compression Manager provides several functions that allow your application to modify such parameters as the spatial or temporal quality or the data-unloading function. See <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-ChangingSequenceCompressionParameters">Changing Sequence-Compression Parameters</a></span> for more information about these functions.</p></li>
<li class="li"><p>The Image Compression Manager manages the compression operation and invokes the appropriate compressor. The manager returns the compressed image and its associated image description to your application.</p></li>
<li class="li"><p>Your application is then free to store the compressed image with the others in the sequence.</p></li>
</ol>
<p>After the entire sequence is compressed, you end the process by calling the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceEnd" target="_top">CDSequenceEnd</a></code> function.</p>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_45" title="Decompressing Sequences"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DecompressingSequences" title="Decompressing Sequences"></a>Decompressing Sequences</h2>
<p>The Movie Toolbox handles the details of displaying compressed image sequences that are stored in QuickTime movies. However, if you want to work with sequences in your application, the Image Compression Manager provides tools for decompressing image sequences. As with still-image compression, decompressing sequences requires additional effort on the part of your application. In addition, there are some processing considerations that are particular to sequence decompression. This section describes the steps necessary to decompress an image sequence. Then it discusses several points you should consider before decompressing a sequence.</p>
<p>When decompressing an image sequence, your application must first determine where to display the decompressed sequence. Your application must specify the destination graphics port to the Image Compression Manager. In addition, you may indicate that only a portion of the source image is to be displayed. You describe the desired portion of the image by specifying a rectangle in the coordinate system of the source image. You can determine the size of the source image by examining the image description structure associated with the image (see <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-TheImageDescriptionStructure">The Image Description Structure</a></span> for more information about image description structures).</p>
<p>Your application may also specify that the image is to be mapped into the destination graphics port. The <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceBegin" target="_top">DecompressSequenceBegin</a></code> function allows your application to specify a mapping matrix for the operation.</p>
<p>Your application can invoke additional effects by specifying a mask region or blend matte for the image. Mask regions and mattes control which pixels in the source image are drawn to the destination. Mask regions must be defined in the destination coordinate system. During decompression the Image Compression Manager displays only those pixels in the source image that correspond to bits in the mask that are set to 1. Mattes contain several bits per pixel and are defined in the coordinate system of the source image. Mattes provide a mechanism for blending pixels from source images.</p>
<p>Your application signals its intention to decompress an image sequence by issuing the Image Compression Manager&#8217;s <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceBegin" target="_top">DecompressSequenceBegin</a></code> function. At this time your application specifies many of the parameters that govern the sequence-decompression operation. The Image Compression Manager, in turn, allocates system resources that are necessary for the operation.</p>
<p>Once you have started the sequence, you then decompress each image in the sequence. Call the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceFrame" target="_top">DecompressSequenceFrame</a></code> function to decompress the image. It may be necessary or desirable for your application to change one or more of the decompression parameters while processing a sequence. The Image Compression Manager provides several functions that allow your application to modify such parameters as the accuracy, the transformation matrix, or the data-loading function. See <span class="content_text"><a href="../F-Chapter/6WorkingwiththeImage.html#//apple_ref/doc/uid/TP40000878-WorkingwiththeImageCompressionManager-ChangingSequenceDecompressionParameters">Changing Sequence-Decompression Parameters</a></span> for more information about these functions.</p>
<p>The Image Compression Manager manages the decompression operation and invokes the appropriate compressor component. The manager returns the decompressed image to the location specified by your application and applies any effects you may have specified.</p>
<p>After the entire sequence is decompressed, you end the process by calling the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceEnd" target="_top">CDSequenceEnd</a></code>  function.</p>
<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_46" title="The Basic Functions to Use"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-TheBasicFunctionstoUse" title="The Basic Functions to Use"></a>The Basic Functions to Use</h3>
<p>The basic functions used to compress and decompress a sequence of images include</p>
<ul class="spaceabove">
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetSequenceProgressProc" target="_top">SetSequenceProgressProc</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/GetCSequenceMaxCompressionSize" target="_top">GetCSequenceMaxCompressionSize</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceBeginS" target="_top">DecompressSequenceBeginS</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceFrameWhen" target="_top">DecompressSequenceFrameWhen</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceFrameS" target="_top">DecompressSequenceFrameS</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceFlush" target="_top">CDSequenceFlush</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetDSequenceTimeCode" target="_top">SetDSequenceTimeCode</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceEquivalentImageDescription" target="_top">CDSequenceEquivalentImageDescription</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceNewMemory" target="_top">CDSequenceNewMemory</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceDisposeMemory" target="_top">CDSequenceDisposeMemory</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceInvalidate" target="_top">CDSequenceInvalidate</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/PtInDSequenceData" target="_top">PtInDSequenceData</a></code></p></li>
</ul>
<p>Note that the sequence itself contains no time information, only the order in which images should appear. This book defines several new functions for working with sequences, including functions supporting timecodes and asynchronous decompression.</p>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_47" title="Decompressing Still Images From a Sequence"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DecompressingStillImagesFromaSequence" title="Decompressing Still Images From a Sequence"></a>Decompressing Still Images From a Sequence</h3>
<p>Your application can, of course, decompress individual images from a sequence. When doing so, you must be careful to select only those frames that do not depend on other frames. That is, do not decompress frames from a sequence that has been temporally compressed unless you first decompress all the frames in sequence starting from the preceding key frame (see <span class="content_text"><a href="7HowtoCompressandDec.html#//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DefiningKeyFrameRates">Defining Key Frame Rates</a></span> for more information on key frames in image sequences). In general, you should decompress images from sequences as sequences, rather than as individual frames.</p>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_48" title="Using Screen Buffers and Image Buffers"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-UsingScreenBuffersandImageBuffers" title="Using Screen Buffers and Image Buffers"></a>Using Screen Buffers and Image Buffers</h3>
<p>The use of screen buffers has been discontinued in QuickTime. Use only image buffers. A request for a screen buffer will return an image buffer. Do not request a screen buffer in your application.</p>
<p>The Image Compression Manager uses image buffers when decompressing sequences that have been temporally compressed and therefore contain key frames. Image buffers are especially useful when you want to skip to random frames within a sequence. Random frame access in temporally compressed sequences forces the compressor to decompress all the frames between the nearest preceding key frame and the desired frame. Reconstructing the frame in this manner on the screen can result in jerky sequence display. As an alternative, the compressor can reconstruct the frame in the offscreen image buffer and then copy it to the screen when appropriate. Image buffers are allocated at an appropriate depth and size for the decompressor.</p>
<p>Your application can control the use of the image buffer by the compressor component. For example, you can force the compressor to draw images only to the image buffer, not to the screen. In this manner you can use the image buffer to build up sequences without making the process visible. You can also control when the compressor uses the image buffer. You may need to do this when your program is decompressing directly to the screen and suddenly is prevented from doing so (for example, when your window becomes hidden).</p>


<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_49" title="Defining Key Frame Rates"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DefiningKeyFrameRates" title="Defining Key Frame Rates"></a>Defining Key Frame Rates</h2>
<p>The process of temporal compression involves reducing or eliminating temporal redundancy from an image sequence. Temporal compression is most effective when a sequence contains frames that bear significant similarity to adjacent frames. This is typically true of movies and other video sequences. Reconstructing an individual frame within a sequence that has been temporally compressed requires knowledge of the previous frames. This does not present a problem if your application always plays compressed sequences from the beginning. However, if your application needs to start playing a sequence from a random point, or perhaps backward, the decompressor does not have enough information to decompress the frames.</p>
<p>To alleviate this problem, compressors insert key frames in compressed sequences at regular intervals. <strong>Key</strong> <strong>frames</strong> define starting points for portions of a temporally compressed sequence. Subsequent frames depend on the previous key frame.</p>
<p>At the start of a sequence compression your application can specify a rate at which the compressor is to insert key frames into the compressed data stream. This <strong>key</strong> <strong>frame</strong> <strong>rate</strong> indicates the maximum number of frames you will accept between key frames. The Image Compression Manager picks the best key frames from the source sequence and at the same time enforces the specified key frame rate (the best key frames are those that are least similar to adjacent frames, such as at scene changes; these frames would have the largest compressed images even if they were not selected as key frames).</p>
<p>During sequence compression your application can change the key frame rate by calling the  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetCSequenceKeyFrameRate" target="_top">SetCSequenceKeyFrameRate</a></code> function. By manipulating the parameters for the sequence, you can force the Image Compression Manager to place a key frame at any arbitrary point in a sequence (set the  <code>codecFlagForceKeyFrame</code> flag to 1 in the <code>flags</code> parameter of the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceFrame" target="_top">CompressSequenceFrame</a></code>  function.</p>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_50" title="A Sample Program for Compressing and Decompressing a Sequence of Images"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-ASampleProgramforCompressingandDecompressingaSequenceofImages" title="A Sample Program for Compressing and Decompressing a Sequence of Images"></a>A Sample Program for Compressing and Decompressing a Sequence of Images</h2>
<p>The sample program presented in this section illustrates the processes described in the previous sections. The program has been divided into several functions. Listing 6-1 shows the main program.</p>
<p>The data for each frame is written to the data fork of the disk file, preceded by a long word that contains the number of bytes of data for that frame. A description of the compressed images in the sequence is stored in a  <code>'SEQU'</code> resource in the same file with a resource ID of 128 or 129. This description is simply the image description structure maintained by the Image Compression Manager.</p>
<p>The image for each frame of the sequence is drawn into an offscreen graphics world that the <code>SequenceSave</code> function creates in the <code>currWorld</code> variable. <code>SequenceSave</code>  calls the <code>DrawOneFrame</code> function (described in the next section) to draw each frame&#8217;s image into the <code>currWorld</code> variable. Before any of the frames of the sequence are drawn, the Image Compression Manager is prepared to compress a sequence of images through the <code>CompressSequence</code> function.</p>
<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_164" title="Listing 6-1Compressing and decompressing a sequence of images: The main program"></a>
<p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>Compressing and decompressing a sequence of images: The main program</p>
<div class="codesample"><table><tr><td scope="row"><pre>WindowPtr&#160;&#160;&#160;&#160;&#160;&#160;&#160;displayWindow; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* window in which to display<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sequence */ <span></span></pre></td></tr><tr><td scope="row"><pre>Rect&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;windowRect;    /* rectangle of displayWindow */<span></span></pre></td></tr><tr><td scope="row"><pre>main (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;WindowPtr&#160;&#160;&#160;&#160;&#160;&#160;&#160;displayWindow;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Rect&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;windowRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;InitGraf (&#38;thePort);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;InitFonts ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;InitWindows ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;InitMenus ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;TEInit ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;InitDialogs (nil);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetRect (&#38;windowRect, 0, 0, 256, 256);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OffsetRect (&#38;windowRect,/* middle of screen */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;((qd.screenBits.bounds.right - qd.screenBits.bounds.left) -<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; windowRect.right) / 2,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;((qd.screenBits.bounds.bottom - qd.screenBits.bounds.top) -<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; windowRect.bottom) / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;displayWindow = NewCWindow (nil, &#38;windowRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;"\pImage", true, 0, <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(WindowPtr)-1, true, 0); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (displayWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetPort (displayWindow);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SequenceSave ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SequencePlay ();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_51" title="A Sample Function for Saving a Sequence of Images to a Disk File"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-ASampleFunctionforSavingaSequenceofImagestoaDiskFile" title="A Sample Function for Saving a Sequence of Images to a Disk File"></a>A Sample Function for Saving a Sequence of Images to a Disk File</h3>
<p>The <code>SequenceSave</code> function shown in Listing 6-2 saves a sequence of images to a disk file. This function creates and opens a disk file for the image sequence, calls the <code>CompressSequence</code> function to create and compress the image sequence into the file, and then calls the <code>MakeMyResource</code> function to save the image description resource in the file, so that the sequence can be played back later. For details on <code>CompressSequence</code>, see the next section.</p>
<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_165" title="Listing 6-2Saving a sequence of images to a disk file"></a>
<p class="codesample"><strong>Listing 6-2&nbsp;&nbsp;</strong>Saving a sequence of images to a disk file</p>
<div class="codesample"><table><tr><td scope="row"><pre>void SequenceSave (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;filePos; <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;StandardFileReply&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fileReply;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dfRef = 0; <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ImageDescriptionHandle&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;description = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;StandardPutFile ("\p", "\pSequence File", &#38;fileReply);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (fileReply.sfGood)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (! (fileReply.sfReplacing))<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSpCreate (&#38;fileReply.sfFile, 'SEQM', 'SEQU',<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fileReply.sfScript); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSpCreate");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSpOpenDF (&#38;fileReply.sfFile, fsWrPerm, &#38;dfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSpOpenDF");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = SetFPos (dfRef, fsFromStart, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pSetFPos");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CompressSequence (&#38;dfRef, &#38;description);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = GetFPos (dfRef, &#38;filePos);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pGetFPos");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = SetEOF (dfRef, filePos);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pSetEOF");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FSClose (dfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FlushVol (nil, fileReply.sfFile.vRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MakeMyResource (fileReply, description);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (description != nil)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DisposeHandle ((Handle) description);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void MakeMyResource ( StandardFileReply fileReply,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ImageDescriptionHandle description) <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;&#160;&#160;&#160;&#160;error;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;rfRef;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Handle&#160;&#160;&#160;&#160;&#160;&#160;sequResource;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;FSpCreateResFile (&#38;fileReply.sfFile, 'SEQM', 'SEQU',<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fileReply.sfScript);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = ResError();<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (error != dupFNErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSpCreateResFile");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;rfRef = FSpOpenResFile (&#38;fileReply.sfFile, fsRdWrPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (ResError (), "\pFSpOpenResFile");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetResLoad (false);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;sequResource = Get1Resource ('SEQU', 128);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (sequResource)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;RmveResource (sequResource);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetResLoad (true);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;sequResource = (Handle) description;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = HandToHand (&#38;sequResource);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (error, "\pHandToHand");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;AddResource (sequResource,'SEQU', 128, "\p");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (ResError (), "\pAddResource");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;UpdateResFile (rfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (ResError (), "\pUpdateResFile");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CloseResFile (rfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_52" title="A Sample Function for Creating, Compressing, and Drawing a Sequence of Images"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-ASampleFunctionforCreatingCompressingandDrawingaSequenceofImages" title="A Sample Function for Creating, Compressing, and Drawing a Sequence of Images"></a>A Sample Function for Creating, Compressing, and Drawing a Sequence of Images</h3>
<p>Listing 6-3 shows the  <code>CompressSequence</code> function, which creates and then compresses the image sequence. <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceBegin" target="_top">CompressSequenceBegin</a></code> informs the Image Compression Manager which compressor (of type  <code>codectype</code> ) to use, what the desired compression quality is, the key frame rate, the portion of the image to compress (in this example, the entire image is compressed), and the image to be compressed (in this example, the pixel map, of type <code><!--a target="_top" -->PixMap<!--/a--></code>, in the <code>currWorld</code> variable).</p>
<p><code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceBegin" target="_top">CompressSequenceBegin</a></code> returns a unique number that identifies the sequence for subsequent image-compression routines, and it initializes a new image description structure, which is stored in the handle referenced by the <code>description</code> local variable.</p>
<p>Using a loop, the <code>DrawOneFrame</code> function draws each frame until the last frame is drawn, at which time the function returns the value of <code>false</code>. Each frame that it draws is copied to the window so that it can be seen during the compression sequence.</p>
<p>The  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceFrame" target="_top">CompressSequenceFrame</a></code> function is used to compress each frame&#8217;s image. <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceFrame" target="_top">CompressSequenceFrame</a></code> tells the Image Compression Manager</p>
<ul class="spaceabove">
<li class="li"><p>which image to compress (in this case, the pixel map of the <code>currWorld</code> variable)</p></li>
<li class="li"><p>the portion of that image to compress (in this case, all of it)</p></li>
<li class="li"><p>whether to update the previous frame&#8217;s buffer for frame differencing</p></li>
<li class="li"><p>the address of the buffer that&#8217;s to receive the compressed image data</p></li>
</ul>
<p>In updating the previous frame&#8217;s buffer for frame differencing, the Image Compression Manager control flag  <code>codecFlagUpdatePrevious</code> copies the uncompressed image to the previous frame&#8217;s buffer; contrast this with the <code>codecFlagUpdatePreviousComp</code> flag, which copies the compressed image to the previous frame&#8217;s buffer. The more lossy the compression, the more the difference between the compressed and uncompressed images.</p>
<p>The <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CompressSequenceBegin" target="_top">CompressSequenceBegin</a></code> function returns a rating of the similarity between the current frame and the previous frame, but this example ignores this rating. After each frame is compressed, the number of bytes in the compressed image data is written to the disk file, followed by the compressed image data itself.</p>
<p>After all the images in the sequence have been compressed, the  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceEnd" target="_top">CDSequenceEnd</a></code> function is called to tell the Image Compression Manager that the sequence is over. The data fork of the file is closed, and the image description is written to a <code>'SEQU'</code> resource.</p>
<p>The <code>DrawOneFrame</code> function draws one frame of the sequence with QuickDraw. The frame&#8217;s image is drawn into the rectangle specified by the <code>destRect</code> parameter. The image is a set of <strong>color</strong> <strong>ramps</strong> in which the shading goes from light to dark in smooth increments. The color ramps fill the destination rectangle and the current frame number centered within the destination rectangle over the ramps.</p>
<p>The <code>PaintImage</code> function paints a series of vertical color ramps into the rectangle specified by the <code>destRect</code> parameter into the current color graphics port. This is done through a nested loop. The outer loop iterates only twice, and half of the ramps are drawn in the first iteration and half in the second. The inner loop iterates over all the steps in a ramp.</p>
<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_166" title="Listing 6-3Creating and compressing an image sequence"></a>
<p class="codesample"><strong>Listing 6-3&nbsp;&nbsp;</strong>Creating and compressing an image sequence</p>
<div class="codesample"><table><tr><td scope="row"><pre>void CompressSequence (short* dfRef, ImageDescriptionHandle* description)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;GWorldPtr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;currWorld = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;PixMapHandle&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;currPixMap;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CGrafPtr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;savedPort;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;GDHandle&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;savedDevice;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Handle&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;buffer = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bufferAddr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compressedSize;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dataLen;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Rect&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;imageRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ImageSequence&#160;&#160;&#160;&#160;&#160;&#160;&#160;sequenceID = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;frameNum;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CodecType&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecKind = 'rle ';<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;GetGWorld (&#38;savedPort, &#38;savedDevice);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;imageRect = savedPort-&#62;portRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = NewGWorld (&#38;currWorld, 32, &#38;imageRect, nil, nil, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (error, "\pNewGWorld");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetGWorld (currWorld, nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;currPixMap = currWorld-&#62;portPixMap;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;LockPixels (currPixMap);<span></span></pre></td></tr><tr><td scope="row"><pre>/*&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Allocate an embryonic image description structure and the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Image Compression Manager will resize.<span></span></pre></td></tr><tr><td scope="row"><pre>*/<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;*description = (ImageDescriptionHandle) NewHandle (4);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = CompressSequenceBegin (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;sequenceID,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;currPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;/* tell ICM to allocate previous <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160; image buffer */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;imageRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;imageRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;/* let ICM choose pixel depth */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecKind,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(CompressorComponent) anyCodec,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecNormalQuality,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* spatial quality */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecNormalQuality,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* temporal quality */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;5,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;/* at least 1 key frame every <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160; 5 frames */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* use default color table */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecFlagUpdatePrevious,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*description );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (error, "\pCompressSequenceBegin");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = GetMaxCompressionSize(<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;currPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;imageRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* let ICM choose pixel depth */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecNormalQuality,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* spatial quality */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecKind,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(CompressorComponent) anyCodec,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;compressedSize );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (error, "\pGetMaxCompressionSize");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;buffer = NewHandle(compressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (MemError(), "\pNewHandle buffer");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;MoveHHi (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;HLock (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;bufferAddr = StripAddress (*buffer);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;for (frameNum = 1; frameNum &#60;= 10; frameNum++)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DrawFrame (&#38;imageRect, frameNum);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = CompressSequenceFrame (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sequenceID,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;currPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;imageRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecFlagUpdatePrevious,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bufferAddr,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;compressedSize,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pCompressSequenceFrame");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dataLen = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSWrite (*dfRef, &#38;dataLen, &#38;compressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSWrite length");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSWrite (*dfRef, &#38;compressedSize, bufferAddr);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSWrite buffer");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CDSequenceEnd (sequenceID);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;DisposeGWorld (currWorld);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetGWorld (savedPort,savedDevice);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (buffer) DisposeHandle ( buffer );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>void DrawFrame (const Rect *imageRect, long frameNum)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Str255 numStr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ForeColor( redColor );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;PaintRect( imageRect );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ForeColor( blueColor );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;NumToString (frameNum, numStr);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;MoveTo ( imageRect-&#62;right / 2, imageRect-&#62;bottom / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;TextSize ( imageRect-&#62;bottom / 3);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;DrawString (numStr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_53" title="A Sample Function for Decompressing and Playing Back a Sequence From a Disk File"></a>
<h3><a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-ASampleFunctionforDecompressingandPlayingBackaSequenceFromaDiskFile" title="A Sample Function for Decompressing and Playing Back a Sequence From a Disk File"></a>A Sample Function for Decompressing and Playing Back a Sequence From a Disk File</h3>
<p>The <code>SequencePlay</code> function, shown in Listing 6-4, plays back a sequence of images from a disk file that was created by the <code>SequenceSave</code> function.</p>
<p>The <code>SequencePlay</code> function begins by grabbing the image description structure from the file that the user specified from a <code>'SEQU'</code> resource ID 128. This structure is needed to decompress the images in the file.</p>
<p>Before these compressed images are read, the Image Compression Manager is told to prepare to decompress a sequence of images through the  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceBegin" target="_top">DecompressSequenceBegin</a></code> function. This routine tells the Image Compression Manager</p>
<ul class="spaceabove">
<li class="li"><p>how the images were compressed with the image description structure</p></li>
<li class="li"><p>where to display the decompressed image (the current port in this example)</p></li>
<li class="li"><p>what part of the image to decompress (all of it)</p></li>
<li class="li"><p>what transfer mode to use when displaying the image (<code>srcCopy</code> )</p></li>
<li class="li"><p>whether to buffer the image for frame differences</p></li>
</ul>
<p>A loop iterates for each frame in the file. For each frame, a long word with the number of bytes in the frame is read from the file, and then that many bytes are read from the file into a compressed-image buffer. This buffer is passed to <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceFrame" target="_top">DecompressSequenceFrame</a></code>, which decompresses the image to the screen (the destination doesn&#8217;t have to be the screen, but it is in this example). The loop iterates until the end of the file has been reached.</p>
<a name="//apple_ref/doc/uid/TP40000878-HowtoCompressandDecompressSequencesofImages-DontLinkElementID_167" title="Listing 6-4Playing back a sequence of images from a disk file"></a>
<p class="codesample"><strong>Listing 6-4&nbsp;&nbsp;</strong>Playing back a sequence of images from a disk file</p>
<div class="codesample"><table><tr><td scope="row"><pre>void SequencePlay (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ImageDescriptionHandle&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;description;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compressedSize;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Handle &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;buffer = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bufferAddr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long    &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dataLen;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lastTicks;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ImageSequence &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sequenceID;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Rect &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;imageRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;StandardFileReply&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fileReply;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SFTypeList &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;typeList = {'SEQU',0,0,0};<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dfRef = 0;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* sequence data fork */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rfRef = 0;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* sequence resource fork */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;StandardGetFile (nil, 1, typeList, &#38;fileReply);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (!fileReply.sfGood) return;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;rfRef = FSpOpenResFile (&#38;fileReply.sfFile, fsRdPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (ResError (), "\pFSpOpenResFile");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;description = (ImageDescriptionHandle)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Get1Resource ('SEQU', 128); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (ResError (), "\pGet1Resource");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;DetachResource ((Handle) description );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;HNoPurge ((Handle) description );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CloseResFile (rfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = FSpOpenDF (&#38;fileReply.sfFile, fsRdPerm, &#38;dfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (error, "\pFSpOpenDF");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;buffer = NewHandle (4);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CheckError (MemError (), "\pNewHandle buffer");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;SetRect (&#38;imageRect, 0, 0, (**description).width,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (**description).height); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;error = DecompressSequenceBegin (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;sequenceID,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;description,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* use the current port */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* go to screen */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;imageRect,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* no matrix */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ditherCopy,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* no mask region */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecFlagUseImageBuffer,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecNormalQuality,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* accuracy */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(CompressorComponent) anyCodec);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;while (true)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dataLen = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSRead (dfRef, &#38;dataLen, &#38;compressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (error == eofErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError( error, "\pFSRead" );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (compressedSize &#62; GetHandleSize (buffer))<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HUnlock (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetHandleSize (buffer, compressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (MemError(), "\pSetHandleSize");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HLock (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bufferAddr = StripAddress (*buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = FSRead (dfRef, &#38;compressedSize, bufferAddr);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pFSRead");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error = DecompressSequenceFrame (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sequenceID, <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bufferAddr, <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0, &#160;// flags <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil );<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CheckError (error, "\pDecompressSequenceFrame");<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Delay (30, &#38;lastTicks);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CDSequenceEnd (sequenceID);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (dfRef) FSClose (dfRef);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (buffer) DisposeHandle (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (description) DisposeHandle ((Handle)description);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>






        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../F-Chapter/6WorkingwiththeImage.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../H-Chapter/8ICMFunctionsDataTyp.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/G-Chapter/7HowtoCompressandDec.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/G-Chapter/7HowtoCompressandDec.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/G-Chapter/7HowtoCompressandDec.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>