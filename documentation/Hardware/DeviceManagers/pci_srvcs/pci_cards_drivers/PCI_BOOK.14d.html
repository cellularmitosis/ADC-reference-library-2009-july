<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> PrepareMemoryForIO11</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.149.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.14c.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.14e.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="RoH.RoutineHeading"><A NAME="pgfId=3536"> </A><A NAME="14187"> </A>PrepareMemoryForIO</H1><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=18746"> </A>OSStatus</CODE><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=18752"> </A>PrepareMemoryForIO (IOPreparationTable *theIOPreparationTable);</CODE><DL COMPACT><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=18756"> </A><TT CLASS="cv">--&gt; theIOPreparationTable</TT><A NAME="&lt;cv&gt;PrepareMemoryForIO&lt;n&gt; function"> </A></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3540"> </A> Pointer to an <TT CLASS="cv">IOPreparationTable</TT> structure</DD></DL COMPACT><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3541"> </A>DESCRIPTION</H5><P CLASS="T1.Text1"><A NAME="pgfId=3542"> </A><TT CLASS="cv">PrepareMemoryForIO</TT> coordinates data transfers between devices and one or more memory ranges with the operating system, the main processor caches, and other data buffers. Preparation includes ensuring that physical memory remains assigned to the memory ranges until <TT CLASS="cv">CheckpointIO</TT> relinquishes it. Depending on the I/O direction and data path coherence that are specified, Mac&nbsp;OS manipulates the contents of the processor's caches, if any, and may make parts of the ranges noncacheable.</P><P CLASS="T1.Text1"><A NAME="pgfId=3543"> </A>A native driver can call <TT CLASS="cv">PrepareMemoryForIO</TT> from its <TT CLASS="cv">DoDriverIO</TT> handler. The <TT CLASS="cv">DoDriverIO</TT> entry point is discussed in <A HREF="PCI_BOOK.bd.html#15604" CLASS="XRef">DoDriverIO Entry Point</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3547"> </A>The driver or other software must perform I/O preparation before permitting data movement. For operations with block-oriented devices, preparation is best done just before moving the data, typically by the driver. For operations upon buffers such as memory shared between the main processor and a coprocessor, frame buffers, or buffers internal to a driver, preparation is best performed when the buffer is allocated. This technique is discussed more fully in <A HREF="PCI_BOOK.151.html#23581" CLASS="XRef">Multiple Transfers</A>. The PCI Card Device Driver Kit contains code samples that use <TT CLASS="cv">PrepareMemoryForIO</TT>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3554"> </A>Calls to <TT CLASS="cv">PrepareMemoryForIO</TT> should be matched with calls to <TT CLASS="cv">CheckpointIO</TT>, even if the I/O operation was aborted. In addition to applying finishing operations to the memory range, <TT CLASS="cv">CheckpointIO</TT> deallocates resources used in preparing the range.</P><P CLASS="T1.Text1"><A NAME="pgfId=3555"> </A>The <TT CLASS="cv">IOPreparationTable</TT> must remain allocated until the last <TT CLASS="cv">CheckPointIO</TT> is called. </P></DIV><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3556"> </A>EXECUTION CONTEXT</H5><P CLASS="T1.Text1"><A NAME="pgfId=3557"> </A><TT CLASS="cv">PrepareMemoryForIO</TT> may be called only at task level from a driver's <TT CLASS="cv">DoDriverIO</TT> routine or from a subroutine called by <TT CLASS="cv">DoDriverIO</TT>.</P></DIV><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3571"> </A>RESULT CODES</H5><TABLE border=1 cellpadding=3><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3560"> </A>noErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3562"> </A>0</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3564"> </A>No error</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3566"> </A>paramErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3568"> </A>-50</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3570"> </A>Bad parameter</FONT></TD></TR></TABLE></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.149.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.14c.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.14e.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>