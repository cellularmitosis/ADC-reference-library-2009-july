<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> How QuickTime Handles Compressed Audio</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: QuickTime Reference</I><P>| <A HREF="refQTAudio.4.htm">Previous</A> | <A HREF="refQTAudio.1.htm">Chapter Contents</A> | <A HREF="refQTAudio.htm">Chapter Top</A> | <A HREF="refQTAudio.6.htm">Next</A> | <!-- QTnavbar end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=16839"> </A>How QuickTime Handles Compressed Audio</H1><P CLASS="T1.Text1"><A NAME="pgfId=16346"> </A>QuickTime 3 defines version 1 of the <TT CLASS="cv">SoundDescription</TT> sample description record. Note that for purposes of this discussion, a QuickTime sound sample description chunk describes the format of a collection of audio samples.</P><P CLASS="T1.Text1"><A NAME="pgfId=16344"> </A>The existing description is shown in <A HREF="refQTAudio.5.htm#30535" CLASS="XRef">Listing&nbsp;1</A> for reference.</P><P CLASS="L.Listing"><A NAME="pgfId=15791"> </A>Listing&nbsp;1 <A NAME="30535"> </A>The original SoundDescription sample description</P><CODE CLASS="Cv.Code"><A NAME="pgfId=21387"> </A>struct SoundDescription {<BR>&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;descSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* total size of SoundDescription<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including extra data */<BR>&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataFormat;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* sound format */<BR>&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resvd1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* reserved for apple use. set to zero */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resvd2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* reserved for apple use. set to zero */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataRefIndex;<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* which version is this data */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;revlevel;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* what version of that codec did this */<BR>&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vendor;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* whose  codec compressed this data */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numChannels;&nbsp;&nbsp;&nbsp;&nbsp;/* number of channels of sound */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sampleSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* number of bits per sample */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compressionID;&nbsp;&nbsp;/* unused. set to zero. */<BR>&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;packetSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* unused. set to zero. */<BR>&nbsp;&nbsp;&nbsp;&nbsp;UnsignedFixed sampleRate;&nbsp;&nbsp;&nbsp;/* sample rate sound is captured at */<BR>};<BR>typedef struct SoundDescription SoundDescription;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=15794"> </A>Version 1 of this record includes four extra fields to store information about compression ratios. It also defines how other extensions are added to the <TT CLASS="cv">SoundDescription</TT> record.</P><CODE CLASS="Cv.Code"><A NAME="pgfId=21391"> </A>struct SoundDescriptionV1 {<BR>&nbsp;&nbsp;&nbsp;&nbsp;// original fields<BR>&nbsp;&nbsp;&nbsp;&nbsp;SoundDescription &nbsp;&nbsp;&nbsp;desc;<BR>&nbsp;&nbsp;&nbsp;&nbsp;// fixed compression ratio information<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;samplesPerPacket;<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;bytesPerPacket;<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;bytesPerFrame;<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;bytesPerSample;<BR>&nbsp;&nbsp;&nbsp;&nbsp;// additional atom-based fields -- <BR>&nbsp;&nbsp;&nbsp;&nbsp;// ([long size, long type, some data], repeat)<BR>};<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=15796"> </A>The version 1 sound description is a superset of the version 0 sound description. The new fields are taken directly from the <TT CLASS="cv">CompressionInfo</TT> structure currently used by the Sound Manager to describe the compression ratio of fixed ratio audio compression algorithms. They are described in detail in <I CLASS="italics">Inside Macintosh: Sound.</I> If these fields are not used, they are set to 0. File readers only need to check to see if <TT CLASS="cv">samplesPerPacket</TT> is 0. The fields have been added to support compression algorithms which can be run at different compression ratios and to support more generic parsing of QuickTime sound tracks </P><P><B>Important</B><BR><A NAME="pgfId=15797"> </A>It is necessary to know the compression ratio to rechunk or flatten the media. In the past, the only way to know the compression ratio was to directly query the audio decompressor. If this process was running on a computer without the decompressor (such as a server), it would not have enough information to correctly rechunk the audio.s</P><P CLASS="T1.Text1"><A NAME="pgfId=15798"> </A>All other additions to the <TT CLASS="cv">SoundDescription</TT> record are made using QT atoms. That means one or more atoms can be appended to the end of the SoundDescription record using the standard [size, type] mechanism used throughout the QuickTime movie resource architecture.</P><H2 CLASS="H3.Heading3TOC"><A HREF="refQTAudio.6.htm#pgfId=15799" CLASS="Hypertext">Extensions to the SoundDescription Record</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="refQTAudio.7.htm#pgfId=15805" CLASS="Hypertext">Constants for Additional Audio Compression Formats</A></H2><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: QuickTime Reference</I><P>| <A HREF="refQTAudio.4.htm">Previous</A> | <A HREF="refQTAudio.1.htm">Chapter Contents</A> | <A HREF="refQTAudio.htm">Chapter Top</A> | <A HREF="refQTAudio.6.htm">Next</A> | <!-- QTnavbar end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>