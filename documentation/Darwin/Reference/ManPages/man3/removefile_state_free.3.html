<html><head><title>Mac OS X
 Manual Page For removefile_state_free(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/removefile_state_free" title="Mac OS X
 Manual Page for removefile_state_free(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/removefile_state_free"; name=removefile_state_free(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
REMOVEFILE(3)            BSD Library Functions Manual            <!-- a -->REMOVEFILE(3)<!-- /a -->

<b>NAME</b>
     <b>removefile</b>, <b>removefile_state_alloc</b>, <b>removefile_state_free</b>, <b>removefile_state_get</b>, <b>removefile_state_set</b>
     -- remove files or directories

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;removefile.h&gt;</b>

     <u>int</u>
     <b>removefile</b>(<u>const</u> <u>char</u> <u>*path</u>, <u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>removefile</u><b>_</b><u>flags</u><b>_</b><u>t</u> <u>flags</u>);

     <u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u>
     <b>removefile_state_alloc</b>(<u>void</u>);

     <u>int</u>
     <b>removefile_state_free</b>(<u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>);

     <u>int</u>
     <b>removefile_state_get</b>(<u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>uint32</u><b>_</b><u>t</u> <u>key</u>, <u>void</u> <u>*</u> <u>dst</u>);

     <u>int</u>
     <b>removefile_state_set</b>(<u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>uint32</u><b>_</b><u>t</u> <u>key</u>, <u>const</u> <u>void</u> <u>*</u> <u>value</u>);

<b>DESCRIPTION</b>
     These functions are used to remove a file or directory.  Various levels of overwriting may be specified
     to prevent other people from recovering any information about the file.

     The <b>removefile_state_alloc</b>() function initializes a <u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> object (which is an opaque data
     type).  This object can be passed to <b>removefile</b>().  <b>removefile_state_get</b>() and <b>removefile_state_set</b>()
     can be used to manipulate the state (see below).  The <b>removefile_state_free</b>() function is used to deal-<font color="#ffffff" class="whiteout">locate&nbsp;deallocate</font>
     locate the object and its contents.

     The <b>removefile</b>() function removes files and directories located at the named <u>path</u> filesystem location.
     The named <u>path</u> location can be specified as either an absolute path or relative to the working direc-<font color="#ffffff" class="whiteout">tory&nbsp;directory</font>
     tory of the calling process.  If the <u>state</u> parameter is the return value from <b>removefile_state_alloc</b>(),
     then <b>removefile</b>() will use the information from the state object; if it is NULL, then <b>removefile</b>() will
     work normally, but less control will be available to the caller.  The <u>flags</u> parameter controls deletion
     options:

     REMOVEFILE_RECURSIVE       If the <u>path</u> location is a directory, then recursively delete the entire
                                directory.

     REMOVEFILE_KEEP_PARENT     The file or directory at the <u>path</u> location is not deleted.  If specified in
                                conjunction with REMOVEFILE_RECURSIVE, then all of the contents of the
                                directory at <u>path</u> location will be deleted, but not the directory itself.

     REMOVEFILE_SECURE_7_PASS   Overwrite the file with 7 US DoD compliant passes (0xF6, 0x00,  0xFF,  ran-<font color="#ffffff" class="whiteout">dom,&nbsp;random,</font>
                                dom, 0x00, 0xFF, random)

     REMOVEFILE_SECURE_35_PASS  Overwrite the file using 35-pass Gutmann algorithm.

     REMOVEFILE_SECURE_1_PASS   Overwrite with a single pass of random data

     The <b>removefile_state_get</b>() and <b>removefile_state_set</b>() functions can be used to manipulate the
     <u>removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> object returned by <b>removefile_state_alloc</b>().  In both functions, the <u>dst</u> or the
     <u>value</u> parameter's type depends on the <u>key</u> parameter that is passed in.

     REMOVEFILE_STATE_CONFIRM_CALLBACK  Get or set the callback function of type <u>removefile</u><b>_</b><u>callback</u><b>_</b><u>t</u> to be
                                        called prior to file deletion.

     REMOVEFILE_STATE_CONFIRM_CONTEXT   Get or set any parameters of type <u>void</u> <u>*</u> that are needed for the
                                        confirm callback function.

     REMOVEFILE_STATE_ERROR_CALLBACK    Get or set the callback function of type <u>removefile</u><b>_</b><u>callback</u><b>_</b><u>t</u> to be
                                        called when an error is detected.

     REMOVEFILE_STATE_ERROR_CONTEXT     Get or set any parameters of type <u>void</u> <u>*</u> that are needed for the
                                        error callback function.

     REMOVEFILE_STATE_ERRNO             Get or set the current errno of type <u>int</u>

     REMOVEFILE_STATE_STATUS_CALLBACK   Get or set the callback function of type <u>removefile</u><b>_</b><u>callback</u><b>_</b><u>t</u> to be
                                        called subsequent to file deletion.

     REMOVEFILE_STATE_STATUS_CONTEXT    Get or set any parameters of type <u>void</u> <u>*</u> that are needed for the
                                        status callback function.

     The <u>removefile</u><b>_</b><u>callback</u><b>_</b><u>t</u> function pointer is defined as the following:

     <u>int</u> <u>(*removefile</u><b>_</b><u>callback</u><b>_</b><u>t)</u> <u>(removefile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state,</u> <u>const</u> <u>char</u> <u>*path</u>, <u>void</u> <u>*context)</u>

     The return value of the callback function is given as:

     REMOVEFILE_PROCEED  File is deleted and <b>removefile</b>() continues operation as normal.

     REMOVEFILE_SKIP     Current file is not deleted and <b>removefile</b>() continues operation as normal.

     REMOVEFILE_STOP     Current file is not deleted and <b>removefile</b>() exits without continuing further.

<b>RETURN</b> <b>VALUES</b>
     The family of <b>removefile</b>() functions returns less than 0 on error, and 0 on success.

<b>ERRORS</b>
     <b>removefile</b>() will fail if:

     [EACCES]           The <u>path</u> location specifies a file or directory for which the calling process does
                        not have proper permissions.

     [EINVAL]           A callback returned an invalid return value (not REMOVEFILE_PROCEED, REMOVE-<font color="#ffffff" class="whiteout">FILE_SKIP,&nbsp;REMOVEFILE_SKIP,</font>
                        FILE_SKIP, or REMOVEFILE_STOP)

     [EMLINK]           The <u>path</u> location refers to a symbolic link.

     [ENAMETOOLONG]     The resource fork name of the file exceeds the maximum allowed length.

     [ENOMEM]           A memory allocation failed.

     [ENOTEMPTY]        The <u>path</u> location specifies a directory that contains an immutable file which cannot
                        be deleted.

     [EPERM]            The <u>path</u> location specifies an immutable file that cannot be deleted.

     In addition, both functions may return an error from an underlying library or system call.

<b>NOTES</b>
     Write protected files owned by another process cannot be removed by <b>removefile</b>(), regardless of the
     permissions on the directory containing the file.

     If multiple of the REMOVEFILE_SECURE_1_PASS, REMOVEFILE_SECURE_7_PASS, and REMOVEFILE_SECURE_35_PASS
     flags are specified, <b>removefile</b>() will proceed using the flag that specifies the highest number of
     overwriting passes.

<b>EXAMPLES</b>
           /* Initialize a state variable */
           removefile_state_t s;
           s = removefile_state_alloc();
           /* Recursively remove all files and directories while keeping parent tmp directory. */
           removefile("/tmp", s, REMOVEFILE_RECURSIVE | REMOVEFILE_KEEP_PARENT);
           /* Release the state variable */
           <!-- a -->removefile_state_free(s)<!-- /a -->;

           /* A more complex way to call removefile() -- define a callback function */
           int removefile_status_callback(removefile_state_t state, const char * path, void * context) {
              fprintf(stderr, "File deleted: %s", path);
              return REMOVEFILE_PROCEED;
           }
           /* Initialize a state variable */
           s = removefile_state_alloc();
           /* Set callback function properties */
           removefile_state_set(s, REMOVEFILE_STATE_CONFIRM_CALLBACK, removefile_confirm_callback);
           removefile_state_set(s, REMOVEFILE_STATE_CONFIRM_CONTEXT, NULL);
           /* Recursively remove all files and directories while keeping parent tmp directory,
              calling a confirm callback prior to each file deletion. */
           removefile("/tmp", s, REMOVEFILE_RECURSIVE | REMOVEFILE_KEEP_PARENT);
           /* Release the state variable. */
           <!-- a -->removefile_state_free(s)<!-- /a -->;

<b>SEE</b> <b>ALSO</b>
     <a href="../man1/srm.1.html#//apple_ref/doc/man/1/srm">srm(1)</a>, <a href="../man1/unlink.1.html#//apple_ref/doc/man/1/unlink">unlink(1)</a>

<b>HISTORY</b>
     The <b>removefile</b>() API was introduced in Mac OS X 10.5.

BSD                               May 4, 2007                              BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/removefile_state_free.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/removefile_state_free.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/removefile_state_free.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
