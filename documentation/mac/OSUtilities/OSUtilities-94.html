<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>About the Date, Time, and Measurement Utilities (IM: U)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING94></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="OSUtilities-93.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="OSUtilities-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="OSUtilities-222.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="OSUtilities-95.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="OSUtilities-2.html"><B>Operating System Utilities</B></A> / <BR><DD><A HREF="OSUtilities-93.html"><B>Chapter 4 - Date, Time, and Measurement Utilities</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING94-0></A>
<H1>About the Date, Time, and Measurement Utilities</H1>
 You can use the Date, Time, and Measurement Utilities to manipulate the date-time information and geographic location data used by a Macintosh computer. A Macintosh computer contains a battery-operated <A NAME=MARKER-0-42></A><B>clock chip </B>that maintains<P>
<UL>
<LI>the current date-time information
<LI>the geographic location and related time-zone information<P>
</UL>
 The date-time information is stored in a 4-byte value located on the clock chip.The geographic location and related time-zone information is stored in extended parameter RAM. For information on extended parameter RAM, see the chapter "Parameter RAM Utilities" in this book.<P>
 You can use the routines provided by the Date, Time, and Measurement Utilities to manipulate this information. Specifically, the Date, Time, and Measurement Utilities provide routines that you can use to<P>
<UL>
<LI>get the current date and time
<LI>set the current date and time, if necessary
<LI>convert between internal date-time structures
<LI>get and set the geographic location and time-zone information
<LI>determine the current measurement system
<LI>determine the number of elapsed microseconds since system startup<P>
</UL>
 The following sections give an overview of these utilities. <P>
<A NAME=HEADING94-13></A>
<H2><A NAME=MARKER-9-9></A>Date and Time</H2>
 A Macintosh computer contains a battery-operated <A NAME=MARKER-6-10></A>clock chip that maintains the current date-time information. This date-time information is expressed, using 4 bytes, as the number of seconds elapsed since midnight, January 1, 1904. At system startup the date-time information is copied into low memory and is accessible through the system global variable <CODE>Time</CODE>. System software updates the value of the global variable <CODE>Time</CODE> each second. Doing this is faster than manipulating the clock chip directly.<P>
 The Date, Time, and Measurement Utilities provide four data structures that you can use to access date-time information. You can access date-time information through <P>
<UL>
<LI>a <A NAME=MARKER-6-11></A><B>standard date-time value</B> that consists of a 32-bit long integer indicating the total number of seconds elapsed since midnight, January 1, 1904
<LI>a <A NAME=MARKER-6-12></A><B>date-time record</B> that contains fields to indicate the year, month, day, hour, minute, second, and day of the week
<LI>a <A NAME=MARKER-6-13></A><B>long date-time record</B> that extends the date-time record format by adding fields for era, day of the year, week of the year, and morning/evening designations (for example, A.M. and P.M.)
<LI>a <A NAME=MARKER-2-90></A><B>long date-time value</B> that consists of a 64-bit integer, in SANE <CODE>comp</CODE> (computational) format, which also maintains the total number of seconds relative to midnight on January 1, 1904<P>
</UL>
 <A NAME=MARKER-2-15></A>To access date-time information as a date and time, you can use a date-time record or a long date-time record. A date-time record is defined by a data structure of type <CODE>DateTimeRec</CODE><P>
<PRE>
TYPE DateTimeRec =
RECORD
   year:       Integer;    {year, ranging from 1904 to 2040}
   month:      Integer;    {month, 1 = January and 12 = December}
   day:        Integer;    {day, from 1 to 31}
   hour:       Integer;    {hour, from 0 to 23}
   minute:     Integer;    {minute, from 0 to 59}
   second:     Integer;    {second, from 0 to 59}
   dayOfWeek:  Integer;    {day of the week, 1 = Sunday, }
                           { 7 = Saturday}
END;
</PRE>
 The <CODE>year</CODE> field contains the year of the date, ranging from 1904 to 2040. The <CODE>month</CODE> field contains the month of the year, where a value of 1 equals January and 12 equals December. The <CODE>day</CODE> field contains the number of the day, ranging from day 1 to day 31. The <CODE>hour</CODE> field contains the hour, where the value of 0 equals midnight and 23 equals 11 P.M. The <CODE>minute</CODE> field contains the number of minutes, ranging from 0 to 59 minutes. The <CODE>second</CODE> field contains the number of seconds, ranging from 0 to 59 seconds. The <CODE>dayOfWeek</CODE> field specifies the name of the day; a value of 1 equals Sunday and a value of 7 equals Saturday. For additional information about the fields in a date-time record, see <A HREF=OSUtilities-98.html#MARKER-9-85>"The Date-Time Record" beginning on page 4-23</A>.<P>
<DL>
<DT><B>Note</B>
<DD>The date-time record can be used to hold date and time values only for a Gregorian calendar. The long date-time record, described next, can be used for a Gregorian calendar as well as other calendar systems.<EM></EM>   <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 Because the values in a date-time record are simply a translation of the long integer containing the number of seconds since midnight, January 1, 1904, the data structure suffers the same limitation as the long integer representation: after the long integer has reached its maximum value of $FFFFFFFF, it resets to 0. Therefore, the date-time record can track dates and times only between midnight on January 1, 1904 and 6:28:15 A.M. on February 6, 2040.<A NAME=MARKER-2-72></A><P>
 <A NAME=MARKER-2-20></A><A NAME=MARKER-2-45></A>For some applications, this range might be inadequate. For example, a hotel management application might need to let managers book reservations for customers who think ahead to 2050, or a history multimedia application might need to track dates in the first century <EM>B.C</EM>. If your application needs to track dates and times beyond the range supported by the date-time record, you must use a long date-time record. A long date-time record is defined by a data structure of type <CODE>LongDateRec</CODE><P>
<PRE>
TYPE LongDateRec =
RECORD
   CASE Integer OF
   0:
      (era:       Integer;    {era}
      year:       Integer;    {year, from 30081 B.C. to 29940 A.D}
      month:      Integer;    {month, 1 = January and }
                              { 12 = December}
      day:        Integer;    {day, from 1 to 31}
      hour:       Integer;    {hour, from 0 to 23}
      minute:     Integer;    {minute, from 0 to 59}
      second:     Integer;    {second, from 0 to 59}
      dayOfWeek:  Integer;    {day of the week, 1= Sunday, }
                              { 7 = Saturday}
      dayOfYear:  Integer;    {day of the year, 1 to 365}
      weekOfYear: Integer;    {week of the year, 1 to 52}
      pm:         Integer;    {which half of day--0 for }
                              { morning, 1 for evening}
      res1:       Integer;    {reserved}
      res2:       Integer;    {reserved}
      res3:       Integer);   {reserved}
   1:
                              {index by LongDateField}
      (list:      ARRAY [0..13] OF Integer);
   2:
      (eraAlt:    Integer;    {era}
                              {date-time record}
      oldDate:    DateTimeRec);
                              
END;
</PRE>
 You can use a long date-time record for three purposes: to access a date and time, to specify which of the fields in a long date-time record to verify, and to convert a date and time represented by a date-time record into a date and time represented by a long date-time record. <P>
<DL>
<DT><B>IMPORTANT</B>
<DD><A NAME=MARKER-9-19></A>The long date-time record covers a much longer time span (30,000 B.C. to 30,000 A.D.) than the date-time record. In addition, the long date-time record allows conversions to different calendar systems, such as a lunar calendar. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 A long date time-record includes all of the fields available in a date-time record in addition to fields that describe the era, day of the year, week of the year, and morning /evening designations (for example, A.M. and P.M.). <A NAME=MARKER-2-161></A>The <CODE>era</CODE> field contains the era: a value of 0 represents A.D., and -1 represents <EM>B.C. </EM>The <CODE>dayOfYear</CODE> field contains a number that represents a day of a year. For example, the value 300 equals the 300th day of a year. The <CODE>weekOfYear</CODE> field contains a week number. The <CODE>pm</CODE> field contains the morning or evening half of the 24-hour day cycle, where a value of 0 represents the morning (for example, A.M.) and 1 represents the evening (for example, P.M.).<P>
 The <CODE>list</CODE> field contains an array of values that indicate which of the fields in a long date-time record need to be verified.<P>
 The <CODE>eraAlt</CODE> field, which indicates the era, and the <CODE>oldDate</CODE> field, which contains a date-time record, are used only for conversion from a date-time record to a long date-time record. For additional information about the fields in the long date-time record, see <A HREF=OSUtilities-100.html#MARKER-9-92>"The Long Date-Time Record" beginning on page 4-26</A>.<P>
 Note that if you specify, in either record, a value in the <CODE>month</CODE>, <CODE>day</CODE>, <CODE>hour</CODE>, <CODE>minute</CODE>, or <CODE>second</CODE> field that exceeds the maximum value allowed for that field (for example, a value larger than 23 for the <CODE>hour</CODE> field), the result is a wraparound to a future date and time when you modify the date-time format. Suppose you set the <CODE>year</CODE> field in a date-time record to a value greater than 2040, for example 2045. When you modify the date-time format, you get a value of 1909, because the value 2045 caused a wraparound to 1904 plus 5, the number of years over 2040. See <A HREF=OSUtilities-95.html#MARKER-9-58>"Calculating Dates" beginning on page 4-14</A> to see how you can use a wraparound to calculate and retrieve information about a specific date.<A NAME=MARKER-2-15></A><A NAME=MARKER-2-21></A><P>
<DL>
<DT><B>Note</B>
<DD>To present a date and time value as a date and time text string, you need to use the Text Utilities routines. For a complete description of these routines, see <I><A HREF="../Text/Text-2.html">Inside Macintosh: Text.</A> <EM></EM></I>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 <A NAME=MARKER-2-23></A><A NAME=MARKER-2-65></A>A user can set the current date-time information by using the General Controls control panel, the Date &amp; Time control panel, or the Alarm Clock. After the user sets the new date and time, this new date and time is written to the clock chip, and the global variable <CODE>Time</CODE> is updated to reflect the new date and time. <A HREF=#MARKER-9-25>Figure 4-1</A> illustrates how a user might change the date, using the Date &amp; Time control panel.<P>
<B>Figure 4-1  <A NAME=MARKER-9-25></A>The Date &amp; Time control panel</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/DTMU-S-01.jpg"><P>
<A NAME=HEADING94-37></A>
<H2><A NAME=MARKER-2-26></A><A NAME=MARKER-2-27></A>Geographic Location and Time Zone</H2>
 Geographic location and related time-zone information are stored in the Macintosh parameter RAM (extended parameter RAM). System software provides routines that allow you to read this information and, if necessary, make changes to it and then store the new settings in the parameter RAM (extended parameter RAM).<P>
 You can read and store values for <P>
<UL>
<LI>latitude
<LI>longitude
<LI>daylight saving time (DST)
<LI>Greenwich mean time (GMT)<P>
</UL>
 <A NAME=MARKER-2-28></A>The Map control panel allows the user to get geographic location and time-zone information. <A HREF=#MARKER-9-29>Figure 4-2</A> shows the Map control panel. <P>
<B>Figure 4-2  <A NAME=MARKER-9-29></A>The Map control panel</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/DTMU-S-02.jpg"><P>
 The Map control panel specifies latitude and longitude, computation of Greenwich mean time for international time specification (shown as the Time Zone information), and computation of the distance and time difference between the current location (in this case, the location of the user's computer is Cupertino, California) and an arbitrary city (in this case, Copenhagen, Denmark).<P>
 See <A HREF=OSUtilities-95.html#MARKER-9-68>"Handling Geographic Location and Time-Zone Data" beginning on page 4-18</A>, to see how you can use Date, Time, and Measurement Utilities routines to work with the geographic location and time-zone information.<P>
<A NAME=HEADING94-49></A>
<H2><A NAME=MARKER-2-27></A>System of Measurement</H2>
 <A NAME=MARKER-2-31></A>The Date, Time, and Measurement Utilities provide a routine (the <CODE>IsMetric</CODE> function) that you can use to determine the type of measurement used by the current script system. The system software supports two types of measurement systems:<P>
<UL>
<LI>the International System of Units (also called the metric system)--for example centimeters, kilometers, milligrams, degrees Celsius, and so on.
<LI>the English system of measurement (also called the British or British imperial system)--for example, inches, miles, ounces, degrees Fahrenheit, and so on.<P>
</UL>
 The measurement information is stored in the numeric-format resource (resource type <CODE>'itl0'</CODE>) of a script system. The <CODE>IsMetric</CODE> function determines whether the current script system uses the International System of Units or the English system of measurement by examining the '<CODE>itl0</CODE>' resource. <A HREF=#MARKER-9-32>Figure 4-3</A> depicts the window ResEdit displays for a numeric-format resource. Note that in the bottom of the figure the metric box is unchecked, indicating that the script system associated with this '<CODE>itl0</CODE>' resource uses the English system of measurement.<P>
<B>Figure 4-3  <A NAME=MARKER-9-32></A>The numeric-format resource (resource type '<EM>it10</EM>')</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/DTMU-S-03.jpg"><P>
<A NAME=HEADING94-56></A>
<H2>Time Measurement</H2>
 The Date, Time, and Measurement Utilities provide a routine (the <CODE>Microseconds</CODE> procedure) that you can use to measure the number of microseconds that have elapsed since system startup. The <CODE>Microseconds</CODE> procedure is not effected by any user-specified changes to the date and time information, that is, a user can modify the current date-time information without effecting the value returned by the <CODE>Microseconds</CODE> procedure.<P>
 The number of microseconds elapsed is returned in a 64-bit unsigned integer, specified by the unsigned wide record. An unsigned wide record is defined by a data structure of type <CODE>UnsignedWide.</CODE><P>
<PRE>
TYPE UnsignedWide =
PACKED RECORD
   hi:   LongInt;          {high-order 32 bits}
   lo:   LongInt;          {low-order 32 bits}
END;
</PRE>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="OSUtilities-93.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="OSUtilities-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="OSUtilities-222.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="OSUtilities-95.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="OSUtilities-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
