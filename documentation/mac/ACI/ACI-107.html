<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Managing the Device CLUT</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING107></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-106.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-108.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-99.html"><B>Chapter 7 - Color Manager</B></A> / <A HREF="ACI-104.html"><B>Using the Color Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING107-0></A>
<H2>Managing the Device CLUT</H2>
 The Color Manager functions that directly modify a device CLUT should be used with care, because in a multitasking environment, changes to a device CLUT affect colors used by the system software and other application windows.<P>
<DL>
<DT><B>Note</B>
<DD>The Color Manager functions described next are designed to operate on a single <CODE>GDevice</CODE> data structure. The Palette Manager can perform most of these operations across multiple <CODE>GDevice</CODE> data structures. Since the Palette Manager provides more general and portable functionality, applications should use Palette Manager functions whenever possible.<EM></EM><A NAME=MARKER-2-57></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Use the <CODE>SetEntries</CODE> function to change any of the entries in a device's CLUT. <CODE>SetEntries</CODE> changes the <CODE>CTSeed</CODE> field value, so the Color Manager knows to rebuild the inverse table.<P>
 The <A NAME=MARKER-2-59></A><CODE>SaveEntries</CODE> and <A NAME=MARKER-2-60></A><CODE>RestoreEntries</CODE> functions can make temporary changes to the color table under very specialized circumstances (for example, from a color selection dialog box within an application). Applications don't need these functions under normal circumstances. For example, if you use the Palette Manager functions <CODE>GetEntryColor</CODE> and <CODE>SetEntryColor</CODE> on a palette, rather than directly changing a device's color table, the Palette Manager ensures that colors used by other applications and the system are not affected.<P>
 You can use the <CODE>SaveEntries</CODE> function to copy any combination of <CODE>ColorSpec</CODE> data structures into a color table. <CODE>RestoreEntries</CODE> replaces the table created by <CODE>SaveEntries</CODE> in the graphics device. Unlike <CODE>SetEntries</CODE>, these functions don't perform invalidations of the device's color table, so they avoid causing invalidations of cached data structures. If you use these functions, your application must take responsibility for rebuilding and restoring auxiliary structures as necessary.<P>
 By convention, when using <CODE>SetEntries</CODE> or <CODE>RestoreEntries</CODE>, you should store white at color table position 0, and black in the last color table position available, whether it is 1, 3, 15, or 255. The Palette Manager also enforces this convention. The most commonly found CLUT contains 256 entries, but a 4-entry CLUT can illustrate setting entry values more concisely. Here's a <CODE>CSpecArray</CODE> data structure called <CODE>MyColors</CODE> containing four RGB color values:
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><B>Table 7-2 A sample <CODE>CSpecArray</CODE> data structure</B></CAPTION>
<TH>Value<TH>Red<TH>Green<TH>Blue<TR>
<TD>0<TD>FFFF<TD>FFFF<TD>FFFF<TR>
<TD>1<TD>FFFF<TD>0000<TD>0000<TR>
<TD>2<TD>8888<TD>8888<TD>8888<TR>
<TD>3<TD>0000<TD>0000<TD>0000</TABLE>
<P>
 Then you could use the <A NAME=MARKER-2-61></A><CODE>SetEntries</CODE> function to fill the four entries of the CLUT starting at 0 with white at the first entry, a bright red at the second, a gray at the third, and black at the last entry:<P>
<PRE>
SetEntries(0, 4, MyColors);
</PRE>
 Color Manager functions maintain special information in device color tables. Using the <A NAME=MARKER-2-62></A><CODE>ProtectEntry</CODE> and <A NAME=MARKER-2-63></A><CODE>ReserveEntry</CODE> functions, an entry may be protected, which prevents <CODE>SetEntries</CODE> from further changing the entry, or reserved, which makes the entry unavailable to be mapped by the <CODE>RGBForeColor</CODE> and <CODE>RGBBackColor</CODE> functions. Functions that change the device table (<CODE>SetEntries</CODE>, <CODE>ProtectEntry</CODE>, and <CODE>ReserveEntry</CODE>, but not <CODE>RestoreEntries</CODE>) perform the appropriate invalidations of QuickDraw data structures. Your application must then redraw where necessary.<P>
 Use the <A NAME=MARKER-2-64></A><CODE>RealColor</CODE> function to determine whether a particular color exists in a color table. <CODE>RealColor</CODE> determines whether any color in the CLUT for the current <CODE>GDevice</CODE> data structure matches the given color to the resolution of the device's inverse table. For example, if the device's inverse table is set to a resolution of 4 (the default), <CODE>RealColor</CODE> returns <CODE>true</CODE> if any color in the CLUT exactly matches the top four bits of each component. You could make <CODE>RealColor</CODE> match to the top 5 bits by rebuilding the inverse table: call <CODE>MakeITable</CODE> with a <CODE>res</CODE> parameter value of 5.<P>
 The <A NAME=MARKER-2-65></A><CODE>Color2Index</CODE> function returns the index in the current device's CLUT that is the best match to the requested color. The <CODE>Index2Color</CODE> function performs the opposite function--it returns the color of a particular index value. These functions can be useful when making copies of the screen frame buffer. Use the <A NAME=MARKER-2-66></A><CODE>GetSubTable</CODE> function to obtain a set of indexes <CODE>for</CODE> a CLUT; it calls the <CODE>Color2Index</CODE> function for each input color.<A NAME=MARKER-2-67></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-106.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-108.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
