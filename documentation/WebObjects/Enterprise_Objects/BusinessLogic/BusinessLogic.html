<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Enterprise Objects Programming Guide: Business Logic</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Business Logic"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001011-CH204" title="Business Logic"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../About/About.html#//apple_ref/doc/uid/TP30001011-CH201-DontLinkElementID_1">WebObjects Enterprise Objects Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../EnterpriseObjects/EnterpriseObjects.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Geography/Geography.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_10" title="Business Logic"></a><h1><a name="//apple_ref/doc/uid/TP30001011-CH204-TP1" title="Business Logic"></a>Business Logic</h1><p>After you design and build enterprise object classes as discussed in <span class="content_text"><a href="../EnterpriseObjects/EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-TP1">“Business Objects,”</a></span> you need to add <strong>business logic</strong> to some of those classes. The applications you build with Enterprise Objects derive most of their value from the business logic—or business rules—you build into them. Business rules make data relevant and the implementation of business logic is perhaps the most important task when building data-driven applications.</p><p>Many database application development environments force you to implement business logic<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_156"></a> in all the wrong places, such as in the data source itself or intermixed within user interface code. Implementing business logic in these places makes it less reusable, harder to maintain, and makes it less adaptable to changing business needs. These and other consequences of implementing business logic in the wrong places are described in <span class="content_text"><a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30001011-CH202-CACCBFIB">“Why Enterprise Objects?.”</a></span></p><p>This chapter describes the best place to implement business logic—in reusable, portable, data source–independent Java objects called enterprise objects<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_157"></a>. It consists mostly of specific tasks that you commonly perform when adding business logic to Enterprise Objects applications. It includes these sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-TPXREF139">“Custom Classes”</a></span> discusses why you need to generate class files for enterprise objects to which you want to add custom business logic.</p></li><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-TPXREF140">“Providing Initial Values”</a></span> teaches you how to provide values to enterprise object instances immediately upon creation.</p></li><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-TPXREF141">“Adding Validation”</a></span> teaches you how to validate properties and other state in enterprise object classes.</p></li><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-TPXREF143">“Writing Business Methods”</a></span> teaches you how to write business methods that return values based on an enterprise object’s data.</p></li><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-CBGJCJAC">“Manipulating Relationships”</a></span> teaches you how to use enterprise objects in relationships.</p></li><li class="li"><p><span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-CDBCJAIA">“Building a Reusable Framework”</a></span> teaches you how to build a reusable framework of business logic that can be shared among applications.</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH204-TPXREF139" title="Custom Classes"></a><h2>Custom Classes</h2><p>The first step in implementing business logic in an enterprise object is assigning a custom class<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_158"></a> to an entity and generating a Java class file for that entity that will contain the custom business logic. As described in <span class="content_text"><a href="../EnterpriseObjects/EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHBDFHF">“Implementing an Enterprise Object,”</a></span> by default all enterprise objects are assigned to the class <code>com.webobjects.eocontrol.EOGenericRecord</code>. For many enterprise objects, this is sufficient. However, if you want to implement business logic in an enterprise object, you must assign that enterprise object to a custom subclass of EOGenericRecord or EOCustomObject.</p><p>The assignment of classes to enterprise objects happens in EOModeler. You assign entities class names by selecting the root of the entity tree while in table mode and editing class names in the table.</p><p>It’s recommended that you supply fully qualified class names but this isn’t strictly required. So while you could specify Document as the class name for the Document entity, it’s best to specify a fully-qualified name such as <code>com.mycompany.Document</code> instead.</p><p>Once you assign a class to an entity, you need to generate a Java class file for that entity. To do this, simply select the entity in the tree view and choose Generate Java Files from the Property menu. Class file generation is discussed in more detail in <span class="content_text"><a href="../EnterpriseObjects/EnterpriseObjects.html#//apple_ref/doc/uid/TP30001011-CH203-CEHCHHFC">“Generating Source Files.”</a></span> In the save dialog that appears, choose your project directory or the directory of a business logic framework. See <span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-CDBCJAIA">“Building a Reusable Framework”</a></span> for more information on building a framework that you can use to share the same business logic classes among many applications.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-TPXREF140" title="Providing Initial Values"></a><h2>Providing Initial Values</h2><p>One of the most common business rules is to assign initial<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_159"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_160"></a> values to newly inserted records. For example, when a user creates a new record, you may want to immediately populate a field in that record called <code>creationDate</code>.</p><p>To do this, simply override the method <code>awakeFromInsertion</code> in an enterprise object class:</p><div class="codesample"><table><tr><td scope="row"><pre>public void awakeFromInsertion(EOEditingContext context) {<span></span></pre></td></tr><tr><td scope="row"><pre>    super.awakeFromInsertion(context);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (creationDate() == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>        setCreationDate(new NSTimestamp());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This method sets the <code>creationDate</code> attribute to the current time. (Determining if the attribute is <code>null</code> is not usually necessary except in three-tier Java Client applications.)</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_11" title="Important:"></a><p><strong>Important:</strong>&nbsp;Always invoke <code>super</code> when overriding methods in Enterprise Objects.</p><p></p></div><p><code>awakeFromInsertion</code> is automatically invoked immediately after an enterprise object class is instantiated and inserted into an editing context. You use this method to set default values in enterprise objects that represent new data. </p><p>For enterprise objects that represent existing data (data that’s already stored in a data source), you can use the method <code>awakeFromFetch<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_161"></a></code> to provide additional initialization. This method is sent to an enterprise object that has just been created from a database row and initialized with database values.</p><p>You may wonder why it’s not recommended to initialize an enterprise object’s values in an object’s constructor. An enterprise object’s constructor<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_162"></a> represents the earliest state in the life of a particular object. <em>The state of an enterprise object at the point of construction is not complete; the object is not fully initialized.</em> It may not yet have been inserted into an editing context and it might not even have been assigned a global ID. You don’t ever want to manipulate an enterprise object that isn’t in an editing context or that doesn’t have a global ID.</p><p>Therefore, any logic you add in an enterprise object’s constructor may fail or be invalidated while the object finishes initializing. By providing custom logic in <code>awakeFromInsertion</code> or <code>awakeFromFetch</code>, however, you are guaranteed that an enterprise object is fully initialized.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-TPXREF141" title="Adding Validation"></a><h2>Adding Validation</h2><p>Another common requirement of business logic is that it validates<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_163"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_164"></a> all data that users enter, both to ensure that the data will work with other business rules and also to ensure the integrity of stored data. Enterprise Objects provides many different hooks to validate data. When you provide certain validation methods in your business logic classes, Enterprise Objects automatically invokes them to validate your data.</p><p>The EOValidation interface in the control layer defines these validation methods:</p><ul class="ul"><li class="li"><p><code>validateClientUpdate</code></p></li><li class="li"><p><code>validateForDelete</code></p></li><li class="li"><p><code>validateForInsert</code></p></li><li class="li"><p><code>validateForSave</code></p></li><li class="li"><p><code>validateForUpdate</code></p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH204-TPXREF142" title="Validating Before Certain Operations"></a><h3>Validating Before Certain Operations</h3><p>Some of these methods are invoked during certain Enterprise Objects operations, and by overriding them in your business logic classes, you can implement custom validation rules. When an application performs one of these operations on an editing context (save, delete, insert, or update objects), the editing context in which the operation is invoked sends a validation message to its enterprise objects. Based on the result returned from those enterprise objects, the operation is either allowed to continue or is refused.</p><p>For example, if you implement <code>validateForSave<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_165"></a></code> in a particular enterprise object class, when a user attempts to save changes to a particular enterprise object (thereby invoking <code>saveChanges<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_166"></a></code> on the object’s editing context), that object’s editing context first asks the enterprise object if it’s in a consistent state to save. It does this by invoking <code>validateForSave</code>. If <code>validateForSave</code> doesn’t throw an NSValidation.ValidationException<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_167"></a>, the operation is allowed to continue. However, if <code>validateForSave</code> throws an NSValidation.ValidationException, the save operation is not allowed to continue.</p><p>It’s up to you to decide what constitutes a valid enterprise object. In this example, you could write custom business logic in <code>validateForSave</code> that makes sure the enterprise object’s data is valid based on your application’s business rules.</p><p>All classes that implement the EOEnterpriseObject interface include a default implementation of the <code>validateFor</code><em>Operation</em><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_168"></a> methods. The default implementation of <code>validateForDelete</code>, for example, validates that an enterprise object’s relationships conform to their specified referential integrity rules.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_12" title="Important:"></a><p><strong>Important:</strong>&nbsp;Because all enterprise object classes inherit default implementations of the <code>validateFor</code><em>Operation</em> methods, you must invoke super’s implementation before performing custom validation logic.</p><p></p></div><p>The default implementations of <code>validateForSave</code>, <code>validateForInsert</code>, and <code>validateForUpdate</code> invoke <code>validateValueForKey</code> for each of an object’s class properties. See <span class="content_text"><a href="BusinessLogic.html#//apple_ref/doc/uid/TP30001011-CH204-CDBDAGCE">“Validating Individual Properties”</a></span> for more information on <code>validateValueForKey</code>.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-CDBDAGCE" title="Validating Individual Properties"></a><h3>Validating Individual Properties</h3><p>In addition to the validation that occurs before certain operations are allowed to proceed, you can also validate the individual properties of an enterprise object. The EOValidation interface defines another validation method, <code>validateValueForKey<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_169"></a></code>. The default implementation of <code>validateValueForKey</code> searches for and invokes methods of the form <code>validate</code><em>Key</em> in enterprise object classes. You implement a <code>validate</code><em>Key</em> method for each property of an enterprise object you want to validate.</p><p>For example, it’s common to want to validate a zip code field to make sure that a user entered five numbers (for zip codes in the United States). In an enterprise object class in which the <code>zipcode</code> field exists, you add this method:</p><div class="codesample"><table><tr><td scope="row"><pre>public Object validateZipcode(Object zipcode) throws        NSValidation.ValidationException {<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((Number)zipcode.length() > 5) {<span></span></pre></td></tr><tr><td scope="row"><pre>        throw new NSValidation.ValidationException("Invalid zipcode.");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>    else return zipcode;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When a user tries to assign a value to the zipcode property of an enterprise object, the default implementation of <code>validateValueForKey</code> invokes <code>validateZipcode</code>. Based on the result of that method, the user-entered value is either allowed to be assigned to the property or refused. Immediately before invoking <code>validate</code><em>Key</em> methods, the default implementation of <code>validateValueForKey</code> validates the property against constraints specified in the data model, such as <code>null</code> constraints and referential integrity rules.</p><p>Another common use of <code>validateValueForKey</code> is to coerce user-entered data and return the coerced value. For example, users may enter a phone number in a text field in a form. That text field is bound to the <code>phoneNumber</code> attribute of an enterprise object. Rather than force users to enter the phone number in a particular format, such as with dash or period separators, you can let them enter a number in any format. Then, in the <code>validatePhoneNumber</code> method, you can coerce that number into the format you want and return the coerced string rather than the user-entered string.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-TPXREF143" title="Writing Business Methods"></a><h2>Writing Business Methods</h2><p>The properties of a given enterprise object (its attributes and relationships) do not usually provide all the values or data an application needs to be useful. To be of any value to your business, you usually need to add custom business logic<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_170"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_171"></a> in an application. The data in database tables usually stores raw business data. In order to make meaningful results from that data, you need to write business logic, usually in the form of business methods.</p><p>A business method in an enterprise object class returns a value based on data in the enterprise object’s properties. In the Real Estate model, you could write a business method to return the number of listings above a certain selling price that were sold by a particular agent. </p><p>This business method seeks information regarding a particular agent, so it should be implemented in the Agent business logic class. The method requires an Agent enterprise object and uses an Agent’s <code>listings</code> relationship and two attributes of a Listing enterprise object, <code>isSold</code> and <code>sellingPrice</code>, to determine the desired business information. Examples of this method appear in <span class="content_text">Listing 4-1</span>, which assumes Listing is an EOGenericRecord subclass and in <span class="content_text">Listing 4-2</span>, which assumes Listing is an EOCustomObject subclass.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_13" title="Listing 3-1Business method to determine information about the properties sold by a particular agent (assuming EOGenericRecord)"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH204-CBGGDAEG" title="Listing 3-1Business method to determine information about the properties sold by a particular agent (assuming EOGenericRecord)"></a><strong>Listing 3-1&nbsp;&nbsp;</strong>Business method to determine information about the properties sold by a particular agent (assuming EOGenericRecord)</p><div class="codesample"><table><tr><td scope="row"><pre>public int listingsSoldAbovePrice(String targetSellingPrice) {<span></span></pre></td></tr><tr><td scope="row"><pre>     int hitCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     NSArray listings = listings();<span></span></pre></td></tr><tr><td scope="row"><pre>     java.util.Enumeration enum = listings.objectEnumerator();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     while (enum.hasMoreElements()) {<span></span></pre></td></tr><tr><td scope="row"><pre>       webobjectsexamples.realestate.common.Listing listing = (webobjectsexamples.realestate.common.Listing)enum.nextElement();<span></span></pre></td></tr><tr><td scope="row"><pre>       int isSold = ((Integer)listing.valueForKey("isSold")).intValue();<span></span></pre></td></tr><tr><td scope="row"><pre>       int sellingPrice = ((Integer)listing.valueForKey("sellingPrice")).intValue();<span></span></pre></td></tr><tr><td scope="row"><pre>       if ((isSold == 1) &amp;&amp; (targetSellingPrice >= sellingPrice)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        hitCount++;<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return hitCount;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p></p><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_14" title="Listing 3-2Business method to determine information about the properties sold by a particular agent (assuming EOCustomObject)"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH204-CBGIAHAB" title="Listing 3-2Business method to determine information about the properties sold by a particular agent (assuming EOCustomObject)"></a><strong>Listing 3-2&nbsp;&nbsp;</strong>Business method to determine information about the properties sold by a particular agent (assuming EOCustomObject)</p><div class="codesample"><table><tr><td scope="row"><pre>public int listingsSoldAbovePrice(BigDecimal targetSellingPrice) {<span></span></pre></td></tr><tr><td scope="row"><pre>     int hitCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     NSArray listings = listings();<span></span></pre></td></tr><tr><td scope="row"><pre>     java.util.Enumeration enum = listings.objectEnumerator();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     while (enum.hasMoreElements()) {<span></span></pre></td></tr><tr><td scope="row"><pre>       webobjectsexamples.realestate.common.Listing listing = (webobjectsexamples.realestate.common.Listing)enum.nextElement();<span></span></pre></td></tr><tr><td scope="row"><pre>       Boolean isSold = listing.isSold();<span></span></pre></td></tr><tr><td scope="row"><pre>       int sellingPrice = (listing.sellingPrice()).intValue();<span></span></pre></td></tr><tr><td scope="row"><pre>       if ((isSold) &amp;&amp; (targetSellingPrice.intValue() >= sellingPrice)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        hitCount++;<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return hitCount;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Within the Enterprise Objects frameworks, there are a number of other mechanisms you can use to derive business data. At the model level, you can specify custom read and write formats<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_172"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_173"></a> for particular attributes to coerce their values when they are read from the database and written back to the database. Also at the model level, you can define derived attributes<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_174"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_175"></a> that use custom SQL you write to derive business data. Both of these techniques are discussed in <em><a href="../../UsingEOModeler/index.html#//apple_ref/doc/uid/TP30001018" target="_top">EOModeler User Guide</a></em><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_176"></a>.</p><p>The Foundation framework also provides mechanisms that help you write business logic<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_177"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_178"></a>. The class NSArray.Operator provides a number of operators that provide common information about a set of business data. These operators are listed in <span class="content_text">Table 4-1</span>.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_15" title="Table 3-1NSArray operators"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30001011-CH204-CBGHDCDH" title="Table 3-1NSArray operators"></a><strong>Table 3-1&nbsp;&nbsp;</strong>NSArray operators</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Operator</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Operator description</p></th></tr><tr><td  scope="row"><p><code>count</code></p></td><td ><p>Returns the number of elements in an array.</p></td></tr><tr><td  scope="row"><p><code>max</code></p></td><td ><p>Returns the element in the array with the highest value.</p></td></tr><tr><td  scope="row"><p><code>min</code></p></td><td ><p>Returns the element in the array with the lowest value.</p></td></tr><tr><td  scope="row"><p><code>avg</code></p></td><td ><p>Returns the average of the values in the array.</p></td></tr><tr><td  scope="row"><p><code>sum</code></p></td><td ><p>Returns the sum of the values in the array.</p></td></tr></table></div><p>In the Real Estate business logic framework (located in <code>/Developer/Examples/JavaWebObjects/Frameworks/JavaRealEstate</code>), the <code>webobjectsexamples.realestate.server.Agent</code> class includes a method that uses the <code>@avg</code> operator. It is shown in <span class="content_text">Listing 4-3</span>.</p><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_16" title="Listing 3-3A business method using an NSArray operator"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH204-CBGDDJHB" title="Listing 3-3A business method using an NSArray operator"></a><strong>Listing 3-3&nbsp;&nbsp;</strong>A business method using an NSArray operator</p><div class="codesample"><table><tr><td scope="row"><pre>public Number averageRating() {<span></span></pre></td></tr><tr><td scope="row"><pre>    if (_averageRating == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>    _averageRating = (Number)(ratings().valueForKey("@avg.rating.rating"));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return _averageRating;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Each of the operators requires an array of objects whose data type is a <code>java.lang.Number</code> (which includes the concrete classes <code>java.lang.Integer</code> and <code>java.lang.BigDecimal</code>). As shown in <span class="content_text">Listing 4-3</span>, you use the operators within an invocation of the key-value coding method <code>valueForKey</code>. All the operators except <code>@count</code> require you to specify both an array of objects and the element within the array on which to apply the operator. </p><a name="//apple_ref/doc/uid/TP30001011-CH204-CBGJCJAC" title="Manipulating Relationships"></a><h2>Manipulating Relationships</h2><p>Enterprise Objects makes working with relationships<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_179"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_180"></a> rather simple. All you need is two enterprise objects in the same editing context to manipulate relationships programmatically. Were you to perform the same kind of task in other database development environments, you’d likely have to write many lines of SQL to relate a record in one table with a record in another table. With Enterprise Objects, however, a single method invocation does this for you.</p><p>Say you have an enterprise object representing a Document entity and a relationship in that entity called <code>writers</code>, which represents the authors of the document. To associate a new Writer record with the Document record, you simply create an enterprise object for the writer and then add it to the relationship with this code:<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_181"></a></p><div class="codesample"><table><tr><td scope="row"><pre>document.addObjectToBothSidesOfRelationshipWithKey(writer, "writers");<span></span></pre></td></tr></table></div><p>The first argument in the method invocation represents the Writer object. The second argument corresponds to the name of the relationship in the Document entity. If the relationship (in this case <code>writers</code>) is modeled with an inverse relationship, this method also adds the object to the other side of the relationship.</p><p>In addition to adding records in a relationship, you’ll likely also need to remove them. Fortunately, Enterprise Objects provides another method that does all the work for you<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_182"></a>: </p><div class="codesample"><table><tr><td scope="row"><pre>document.removeObjectFromBothSidesOfRelationshipWithKey(writer, "writers");<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001011-CH204-CDBCJAIA" title="Building a Reusable Framework"></a><h2>Building a Reusable Framework</h2><p>Well-designed enterprise objects<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_183"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_184"></a> are reusable. That is, if you do not use SQL, access layer<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_185"></a> classes (besides EOUtilities), or WebObjects classes (<code>com.webobjects.appserver</code>) in enterprise object classes, your enterprise objects will be reusable. </p><p>The best way for multiple applications to share the same business logic is to build a framework. This framework holds custom Java classes generated by EOModeler and <code>.eomodeld</code> files. By using a framework, changes to enterprise object classes in that framework and to the model are picked up by all applications that use the framework.</p><p>To build a framework, make a new project of type WebObjects Framework (see the document <em>Project Builder for WebObjects Developers</em> for more information on project types). Then, add business logic classes and other resources to it. </p><p>The only tricky part is assigning classes and resources to the correct targets<a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_186"></a><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_187"></a>. Model files and server-side business logic classes should be assigned to the Application Server target, while client-side business logic classes should be assigned to the Web Server target. If you’re not building a three-tier desktop application, you’ll only have server-side business logic classes. See the document <em>Project Builder for WebObjects Developers</em><a name="//apple_ref/doc/uid/TP30001011-CH204-DontLinkElementID_188"></a> for more information on targets in WebObjects projects.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../EnterpriseObjects/EnterpriseObjects.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Geography/Geography.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Enterprise_Objects/BusinessLogic/BusinessLogic.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Enterprise_Objects/BusinessLogic/BusinessLogic.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Enterprise_Objects/BusinessLogic/BusinessLogic.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>