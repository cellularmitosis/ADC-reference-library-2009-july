<html><head><title>Mac OS X
 Manual Page For pkgMkIndex(ntcl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/ntcl/pkgMkIndex" title="Mac OS X
 Manual Page for pkgMkIndex(ntcl)"><a name="//apple_ref/doc/man/n/pkgMkIndex" title="Mac OS X
 Manual Page for pkgMkIndex(ntcl)"><!-- headerDoc=man; indexgroup=Section ntcl; uid="//apple_ref/doc/man/ntcl/pkgMkIndex"; name=pkgMkIndex(ntcl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
pkg_mkIndex(n)                              Tcl Built-In Commands                             <a href="pkg_mkIndex.ntcl.html#//apple_ref/doc/man/n/pkg_mkIndex">pkg_mkIndex(n)</a>



____________________________________________________________________________________________________________

<b>NAME</b>
       pkg_mkIndex - Build an index for automatic loading of packages

<b>SYNOPSIS</b>
       <b>pkg_mkIndex</b> <b>?</b><u>-direct</u>?  ?<u>-lazy</u>?  ?<u>-load</u> <u>pkgPat</u>? ?<u>-verbose</u>? <u>dir</u> ?<u>pattern</u> <u>pattern</u> <u>...</u>?                   |
____________________________________________________________________________________________________________


<b>DESCRIPTION</b>
       <b>Pkg_mkIndex</b>  is  a  utility procedure that is part of the standard Tcl library.  It is used to create
       index files that allow packages to be loaded automatically when <b>package</b>  <b>require</b>  commands  are  exe-<font color="#ffffff" class="whiteout">cuted.&nbsp;executed.</font>
       cuted.  To use <b>pkg_mkIndex</b>, follow these steps:

       [1]    Create  the  <!-- a -->package(s)<!-- /a -->.   Each  package may consist of one or more Tcl script files or binary
              files.  Binary files must be suitable for loading with the <b>load</b> command with  a  single  argu-<font color="#ffffff" class="whiteout">ment;&nbsp;argument;</font>
              ment;  for example, if the file is <b>test.so</b> it must be possible to load this file with the com-<font color="#ffffff" class="whiteout">mand&nbsp;command</font>
              mand <b>load</b> <b>test.so</b>.  Each script file must contain a <b>package</b> <b>provide</b>  command  to  declare  the
              package and version number, and each binary file must contain a call to <b>Tcl_PkgProvide</b>.

       [2]    Create  the index by invoking <b>pkg_mkIndex</b>.  The <u>dir</u> argument gives the name of a directory and
              each <u>pattern</u> argument is a <b>glob</b>-style pattern that selects script or binary files in <u>dir</u>.  The |
              default pattern is <b>*.tcl</b> and <b>*.[info</b> <b>sharedlibextension]</b>.
              <b>Pkg_mkIndex</b>  will  create  a  file  <b>pkgIndex.tcl</b> in <u>dir</u> with package information about all the
              files given by the <u>pattern</u> arguments.  It does this by loading each file into a  slave  inter-<font color="#ffffff" class="whiteout">preter&nbsp;interpreter</font>
              preter  and  seeing what packages and new commands appear (this is why it is essential to have
              <b>package</b> <b>provide</b> commands or <b>Tcl_PkgProvide</b> calls in the files, as described  above).   If  you
              have  a package split among scripts and binary files, or if you have dependencies among files,
              you may have to use the <b>-load</b> option or adjust the order in which  <b>pkg_mkIndex</b>  processes  the
              files.  See COMPLEX CASES below.


       [3]    Install the package as a subdirectory of one of the directories given by the <b>tcl_pkgPath</b> vari-<font color="#ffffff" class="whiteout">able.&nbsp;variable.</font>
              able.  If <b>$tcl_pkgPath</b> contains more than one  directory,  machine-dependent  packages  (e.g.,
              those  that  contain  binary  shared  libraries)  should normally be installed under the first
              directory and machine-independent packages (e.g., those that contain only Tcl scripts)  should
              be installed under the second directory.  The subdirectory should include the package's script
              and/or binary files as well as the <b>pkgIndex.tcl</b> file.  As long as the package is installed  as
              a  subdirectory  of  a directory in <b>$tcl_pkgPath</b> it will automatically be found during <b>package</b>
              <b>require</b> commands.
              If you install the package anywhere else, then you must ensure that the  directory  containing
              the  package  is  in  the <b>auto_path</b> global variable or an immediate subdirectory of one of the
              directories in <b>auto_path</b>.  <b>Auto_path</b> contains a list of directories that are searched by  both
              the  auto-loader  and  the  package  loader; by default it includes <b>$tcl_pkgPath</b>.  The package
              loader also checks all of the subdirectories of the directories in <b>auto_path</b>.  You can  add  a
              directory  to  <b>auto_path</b>  explicitly in your application, or you can add the directory to your
              <b>TCLLIBPATH</b> environment variable:  if this environment variable  is  present,  Tcl  initializes
              <b>auto_path</b> from it during application startup.

       [4]    Once the above steps have been taken, all you need to do to use a package is to invoke <b>package</b>
              <b>require</b>.  For example, if versions 2.1, 2.3, and 3.1 of package  <b>Test</b>  have  been  indexed  by
              <b>pkg_mkIndex</b>,  the command <b>package</b> <b>require</b> <b>Test</b> will make version 3.1 available and the command
              <b>package</b> <b>require</b> <b>-exact</b> <b>Test</b> <b>2.1</b> will make version 2.1 available.  There may be  many  versions
              of  a package in the various index files in <b>auto_path</b>, but only one will actually be loaded in
              a given interpreter, based on the first call to <b>package</b>  <b>require</b>.   Different  versions  of  a
              package may be loaded in different interpreters.


<b>OPTIONS</b>
       The optional switches are:

       <b>-direct</b>        The generated index will implement direct loading of the package upon <b>package</b> <b>require</b>.
                      This is the default.

       <b>-lazy</b>          The generated index will manage to delay loading the package until the use of  one  of
                      the  commands  provided by the package, instead of loading it immediately upon <b>package</b>
                      <b>require</b>.

       <b>-load</b> <u>pkgPat</u>   The index process will pre-load any packages that exist in the current interpreter and
                      match <u>pkgPat</u> into the slave interpreter used to generate the index.  The pattern match
                      uses string match rules, but without making  case  distinctions.   See  COMPLEX  CASES
                      below.

       <b>-verbose</b>       Generate  output  during  the  indexing  process.  Output is via the <b>tclLog</b> procedure,
                      which by default prints to stderr.

       <b>--</b>             End of the flags, in case <u>dir</u> begins with a dash.


<b>PACKAGES</b> <b>AND</b> <b>THE</b> <b>AUTO-LOADER</b>
       The package management facilities overlap somewhat with the auto-loader, in  that  both  arrange  for
       files  to be loaded on-demand.  However, package management is a higher-level mechanism that uses the
       auto-loader for the last step in the loading process.  It is generally better to index a package with
       <b>pkg_mkIndex</b> rather than <b>auto_mkindex</b> because the package mechanism provides version control:  several
       versions of a package can be made available in the index files,  with  different  applications  using
       different  versions based on <b>package</b> <b>require</b> commands.  In contrast, <b>auto_mkindex</b> does not understand
       versions so it can only handle a single version of each package.  It is probably not a good  idea  to
       index  a  given  package  with  both <b>pkg_mkIndex</b> and <b>auto_mkindex</b>.  If you use <b>pkg_mkIndex</b> to index a
       package, its commands cannot be invoked until <b>package</b> <b>require</b> has been used to select a version;   in
       contrast,  packages  indexed with <b>auto_mkindex</b> can be used immediately since there is no version con-<font color="#ffffff" class="whiteout">trol.&nbsp;control.</font>
       trol.


<b>HOW</b> <b>IT</b> <b>WORKS</b>
       <b>Pkg_mkIndex</b> depends on the <b>package</b> <b>unknown</b> command, the  <b>package</b>  <b>ifneeded</b>  command,  and  the  auto-<font color="#ffffff" class="whiteout">loader.&nbsp;autoloader.</font>
       loader.   The first time a <b>package</b> <b>require</b> command is invoked, the <b>package</b> <b>unknown</b> script is invoked.
       This is set by Tcl initialization to a script that evaluates all of the  <b>pkgIndex.tcl</b>  files  in  the
       <b>auto_path</b>.   The <b>pkgIndex.tcl</b> files contain <b>package</b> <b>ifneeded</b> commands for each version of each avail-<font color="#ffffff" class="whiteout">able&nbsp;available</font>
       able package;  these commands invoke <b>package</b> <b>provide</b> commands to announce  the  availability  of  the
       package,  and they setup auto-loader information to load the files of the package.  If the <u>-lazy</u> flag |
       was provided when the <b>pkgIndex.tcl</b> was generated, a given file of a given version of a given  package
       isn't  actually  loaded  until  the  first time one of its commands is invoked.  Thus, after invoking
       <b>package</b> <b>require</b> you may not see the package's commands in the interpreter, but you will  be  able  to
       invoke the commands and they will be auto-loaded.


<b>DIRECT</b> <b>LOADING</b>                                                                                               |
       Some  packages, for instance packages which use namespaces and export commands or those which require |
       special initialization, might select that their package files  be  loaded  immediately  upon  <b>package</b> |
       <b>require</b> instead of delaying the actual loading to the first use of one of the package's command. This |
       is the default mode when generating the package index.  It can be overridden by specifying the  <u>-lazy</u> |
       argument.


<b>COMPLEX</b> <b>CASES</b>
       Most  complex  cases  of  dependencies among scripts and binary files, and packages being split among
       scripts and binary files are handled OK.  However, you may have to adjust the order  in  which  files
       are processed by <b>pkg_mkIndex</b>.  These issues are described in detail below.

       If each script or file contains one package, and packages are only contained in one file, then things
       are easy.  You simply specify all files to be indexed in any order with some glob patterns.

       In general, it is OK for scripts to have dependencies on other packages.  If scripts contain  <b>package</b>
       <b>require</b>  commands,  these are stubbed out in the interpreter used to process the scripts, so these do
       not cause problems.  If scripts call into other packages in global code, these calls are handled by a
       stub  <b>unknown</b>  command.  However, if scripts make variable references to other package's variables in
       global code, these will cause errors.  That is also bad coding style.

       If binary files have dependencies on other packages, things can become tricky because it is not  pos-<font color="#ffffff" class="whiteout">sible&nbsp;possible</font>
       sible  to  stub out C-level APIs such as <b>Tcl_PkgRequire</b> API when loading a binary file.  For example,
       suppose the BLT package requires Tk, and expresses this with a call to <b>Tcl_PkgRequire</b> in its <b>Blt_Init</b>
       routine.   To  support  this, you must run <b>pkg_mkIndex</b> in an interpreter that has Tk loaded.  You can
       achieve this with the <b>-load</b> <u>pkgPat</u> option.  If you specify this option,  <b>pkg_mkIndex</b>  will  load  any
       packages  listed by <b>info</b> <b>loaded</b> and that match <u>pkgPat</u> into the interpreter used to process files.  In
       most cases this will satisfy the <b>Tcl_PkgRequire</b> calls made by binary files.

       If you are indexing two binary files and one depends on the other, you should specify  the  one  that
       has  dependencies  last.  This way the one without dependencies will get loaded and indexed, and then
       the package it provides will be available when the second file is processed.  You may  also  need  to
       load  the  first  package  into the temporary interpreter used to create the index by using the <b>-load</b>
       flag; it won't hurt to specify package patterns that are not yet loaded.

       If you have a package that is split across scripts and a binary file, then you should avoid the <b>-load</b>
       flag.  The  problem is that if you load a package before computing the index it masks any other files
       that provide part of the same package.  If you must use <b>-load</b>, then  you  must  specify  the  scripts
       first; otherwise the package loaded from the binary file may mask the package defined by the scripts.


<b>SEE</b> <b>ALSO</b>
       <a href="package.ntcl.html#//apple_ref/doc/man/n/package">package(n)</a>


<b>KEYWORDS</b>
       auto-load, index, package, version



Tcl                                                  8.3                                      <a href="pkg_mkIndex.ntcl.html#//apple_ref/doc/man/n/pkg_mkIndex">pkg_mkIndex(n)</a>
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/mann/pkgMkIndex.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/mann/pkgMkIndex.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/mann/pkgMkIndex.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
