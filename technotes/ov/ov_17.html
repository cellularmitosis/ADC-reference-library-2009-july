<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OV17: MultiFinder Revisited:  The 6.0 System</title><meta name="keywords" content="Mac OS 8 multifinder 6 MFTempHandles _MFTopMem childDiedEvents"><meta name="Description" content="Technical Note OV17: This Technical Note describes severalof the features found in MultiFinder 6.0 and answers a fewcommonly-asked questions such as: Is _WaitNextEvent availablewithout MultiFinder; What are MFTempHandles; and Mouse-movedevent confusion. Multifinder's SIZE resource and Open/Quitfunctions for applications are also discussed.">                                       <meta name="categories" content="Overview"><meta name="week-posted" content="Aug 1, 1988 - Aug 5, 1988"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002615" title="MultiFinder Revisited:  The 6.0 System"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OV17</div>
<div id="pageheadsub">MultiFinder Revisited:  The 6.0 System</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">_WaitNextEvent is Always Available</A><BR><BR><A HREF="#Section3">_MFTopMem</A><BR><BR><A HREF="#Section4">MFTempHandles Are Not Handles</A><BR><BR><A HREF="#Section5">Mouse-Moved Event Confusion</A><BR><BR><A HREF="#Section6">New MultiFinder Features</A><BR><BR><A HREF="#References">References</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note describes several new features found in MultiFinder 6.0 andanswers a few more commonly-asked questions.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Aug 01 1988]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->        <A NAME=Section1></A><h2>How Can I Tell If MultiFinder is Present?</h2><p>Once again, you cannot.  Previous Technical Notes discuss how to check for thenew services available with MultiFinder (i.e., <code>_WaitNextEvent</code> and thetemporary memory allocation calls).</p><p>Currently, since an application cannot tell if MultiFinder is present, theapplication also cannot know how a sublaunch will behave (see M.PS.SubLaunching).  Unfortunately, the two possible sublaunch behaviors are radically different; with MultiFinder the <code>_Launch</code> trap returns to the application and without MultiFinder it does not.  For most applications, however, these differences in sublaunch behavior should not matter. Hopefully, the <code>_Launch</code> trap will be improved in a futureSystem Software release.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></P><h2>_WaitNextEvent is Always Available</h2><p>In System 6.0 and later, <code>_WaitNextEvent</code> is present whether or notMultiFinder is present.  Calling <code>_WaitNextEvent</code> without MultiFinder installed is virtually identical to calling it with MultiFinder installed. Your application can still "sleep" for a specified time and be notified if the cursor location is outside a specified region.  The only difference when MultiFinder is not installed, is that your application is not suspended or resumed. If your application requires System 6.0 or later, DTS recommends calling <code>_WaitNextEvent</code> instead of <code>_GetNextEvent</code> in your main event loop.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>_MFTopMem</h2><p>The <i>Programmer's Guide to MultiFinder</i> incorrectly documents <code>_MFTopMem</code> on page E-1.  It does not return a pointer to the top of your application's memory partition as it is documented.  It does, however, return a pointer to the top of the addressableRAM space in the machine, and is documented correctly on page 3-15 of the manual.  Note that earlier releases of this manual referred to this call as <code>_MFMemTop</code>.</p><a name="Section4"></a><P><A HREF="#top">Back to top</A></P><h2>MFTempHandles Are Not Handles</h2><p>The MultiFinder temporary memory allocation call, <code>_MFTempNewHandle</code>,currently does not return a "true" <code>Handle</code> in the sense that it can beused interchangeably with a <code>Handle</code> obtained from a call to <code>_NewHandle</code>.  Specifically, you cannot pass a <code>Handle</code> obtained from a call to <code>_MFTempNewHandle</code>to any Memory Manager routine or Toolbox routine which, in turn, passes it to the Memory Manager (either directly or indirectly).  Like a true <code>Handle</code>,however, you can still dereference a <code>Handle</code> obtained from <code>_MFTempNewHandle</code>.  You should treat a <code>Handle</code> from <code>_MFTempNewHandle</code> in the same way you would a fake <code>Handle</code> (i.e., a <code>Handle</code> not obtained from the Memory Manager--see M.OV.CompatibilityWhy).  This restriction on the use of MultiFinder temporary memory may not apply in future System Software releases.</p><a name="Section5"></a><P><A HREF="#top">Back to top</A></P><h2>Mouse-Moved Event Confusion</h2><p>There has been some confusion over the <code>mouseRgn</code> parameter to<code>_WaitNextEvent</code>, and under what circumstances it returns a mouse-movedevent.  Most of the confusion is caused by the word "moved."  Many applicationshave assumed that mouse-moved events are generated only when the mouse actuallyleaves the mouse region.  In System 6.0 and later, <code>_WaitNextEvent</code>returns a mouse-moved event whenever the cursor is outside the mouse region.Thus, when an application receives a mouse-moved event, it should compute a newmouse region based upon the new cursor location before calling<code>_WaitNextEvent</code> again, otherwise <code>_WaitNextEvent</code> continues toreturn mouse-moved events until the user moves the cursor back inside the mouseregion or until a new mouse region is specified.</p><a name="Section6"></a><P><A HREF="#top">Back to top</A></P><h2>New MultiFinder Features</h2><h3>Open Document and Quit</h3><p>In System 6.0 and later, MultiFinder adds the ability to open applicationdocuments from the Finder when the owner application is already open.  For themoment, MultiFinder accomplishes this by simulating a mouse-down event in theapplication's menu item for opening files.  The application usually responds bycalling <code>_SFGetFile</code>, which MultiFinder short circuits into returningthe document opened in the Finder layer.  This is similar to the way thatMultiFinder triggers applications to quit when the user selects Shut Down orRestart from the Finder's Special menu.</p><p>In future System Software releases, this mechanism will probably change to amore straightforward method of notifying the application that it needs to opena document or to quit.</p><p>How does MultiFinder find the Open item?  By default, MultiFinder looks for aFile menu with an item named Open..., Open ..., Open..., etc.  Of course, someapplications do not have a File menu or they name their Open item somethingdifferent (i.e., Open Document).  To compensate for this difference,MultiFinder <b>first</b> looks in the application's resource fork for<code>'mstr'</code> or <code>'mst#'</code> resources in the range of 100-103.  An<code>'mstr'</code> resource has the same format as an <code>'STR '</code> resource (aPascal string) and contains the name of the menu or menu item for whichMultiFinder should look.  An <code>'mst#' </code>resource has the same format as an<code>'STR#' </code>resource (a list of Pascal strings) and contains a set of namesfor the menu or menu item for which MultiFinder should look.  MultiFinder usesthis same mechanism to locate the application's Quit command.  Table 1documents these resource IDs and their meanings.</p><p><img src="images/ov_17_001.gif" alt="Table 1" width=424 height=100></p><p align=center><B>Table 1</b>. Resource IDs and Meanings</p><p>As always, be careful to avoid any "clever" tricks that rely upon thisinformation; MultiFinder will <b>not</b> always work this way.</p><h3>Additions to the 'SIZE' Resource</h3><p>The <code>'SIZE'</code> resource has four new flags (<code>onlyBackground</code>,<code>getFrontClicks</code>, <code>acceptChildDiedEvents</code>, and <code>is32BitCompatible</code>) which communicate information about an application to MultiFinder. Figure 1 illustrates the locations of these new flags. Setting both the <code>onlyBackground</code> flag and the <code>canBackground</code> flag informs MultiFinder that an application is a "faceless background task," that is, it has no user interface (i.e., no windows and no ports) and should only be run in the background.  An example of a faceless background task is the System Software application Backgrounder.</p><p align=center><img src="images/ov_17_002.gif" alt="Figure 1" width=320 height=191></p><p align=center><B>Figure 1</b>. 'SIZE' Resource Flag Bits</p><p>An application can set the <code>getFrontClicks</code> flag if it wants to receivethe mouse-up and mouse-down events when the user brings the application's layerto the front.  Typically, the user merely wants to bring an application to thefront, so it may not be desirable to move the insertion point or start drawingimmediately after coming to the foreground.  If <code>getFrontClicks</code> is set,the mouse click is passed to the application.  If <code>getFrontClicks</code> isset and a click is made in the content region of the background application'sfrontmost window, then the application receives a click in the content regionof that window.</p><p>Clicking on a window that is behind another window within the same layer causesthe usual event processing (i.e., the mouse-down event is visible to the application), for which the application calls <code>_SelectWindow</code>, to bring the window forward.  This is true whether or not the bit is set.  Ordinarily, these events are not passed to the application, so setting the <code>getFrontClicks</code> flag is usually not appropriate.  The Finder, however, is one example of an application which has the <code>getFrontClicks</code> flag set.</p><p>The <code>acceptChildDiedEvents</code> flag is used by SADE to get notificationwhen an application it launched quits or crashes.  A <code>childDiedEvent</code> isanother MultiFinder <code>app4Evt</code> with a message field of the event recordwhich Figure 2 illustrates.</p><p align=center><img src="images/ov_17_003.gif" alt="Figure 2" width=352 height=24></p><p align=center><B>Figure 2.</b> Message Field of childDiedEvent</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Your application does not receive <code>childDiedEvent</code> eventsunless the user is running MultiFinder 6.1b7 (shipped with SADE 1.0) or 6.1b9.  The MultiFinder which comes with System 6.0.x (and earlier) does not send these events. Your application should not depend on these events for its operation--they are documented for debugger use only.  In addition, developers may <b>not distribute</b> MultiFinder 6.1bx to customers, even if licensed to distribute Apple's Macintosh System Software.</p></TD></TR></TABLE></CENTER><BR><p>The <code>Status</code> parameter in the message field is a system error code ifthe application crashed or zero if it quit normally.  The <code>where</code> fieldof the event record contains the process identifier (pid) of the quittingprocess.  The <code>_Launch</code> trap returns the pid of the newly createdapplication in <code>D0</code> if the call to <code>_Launch</code> succeeds (if<code>D0</code> is negative, it contains an OS error code).</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR> Future versions of System Software may operate only in 32-bit modeon machines with 68020 or newer CPUs, and applications which are not 32-bitclean will not function correctly on these machines.</p></TD></TR></TABLE></CENTER><BR><p>The <code>is32BitCompatible</code> bit will be used in future systems to warn usersthat running an application which does not have the bit set may <b>crash</b> their system, if itis running in 32-bit mode.  Developers should <b>not</b> set this bit unless they have thoroughly tested their applications on a 32-bit system.  Currently, the only 32-bit system available for testing is A/UX, so running under A/UX should be considered the "litmus test" for 32-bit compatibility until newer System Software is available.  Note, however, that the <code>is32BitCompatible</code> bit does <b>not</b> have to be set to run an application under the current version of A/UX.</p><a name="References"></a><P><A HREF="#top">Back to top</A></P><h2>References</h2><p>   Programmer's Guide to MultiFinder</p><p>   MultiFinder Development Package</p><p>   <A HREF = "ov_04.html">M.OV.CompatibilityWhy</a></p><p>   <A HREF = "../tb/tb_14.html">M.TB.MultiFinder</a></p><p>   <A HREF = "../tb/tb_28.html">M.TB.MultiFinder1Bug</a></p><p>   <A HREF = "../tb/tb_35.html">M.TB.MultiFinderMisc</a></p><p>   <A HREF = "ov_11.html">M.OV.32BitClean</a></p> <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (140K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ov_17.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ov/ov_17.html%3Fid%3DDTS10002615-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ov/ov_17.html%3Fid%3DDTS10002615-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ov/ov_17.html%3Fid%3DDTS10002615-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></html>