<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Direct to Web Guide: Direct to Web Architecture</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Direct to Web Architecture"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2" title="Direct to Web Architecture"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_4-TPXREF101">WebObjects Direct to Web Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../WalkThrough/WalkThrough.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Customizing/Customizing.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF101" title="Direct to Web Architecture"></a><h1>Direct to Web Architecture</h1><p>The Direct to Web framework works together with the WebObjects framework to generate web pages for nine database tasks including querying, editing, and listing. To do this, Direct to Web uses a task-specific component called a <em>Direct to Web template</em> that can perform the task on any entity. Direct to Web also translates the information that the Enterprise Objects Framework provides about the entity into values the Direct to Web template needs to render the page.</p><p>This chapter discusses the Direct to Web architecture and how Direct to Web generates a page. More specifically, it describes</p><ul class="ul"><li class="li"><p>the different types of components that Direct to Web uses to render the pages</p></li><li class="li"><p>the <em>Direct to Web context</em>, an instance of the D2WContext class that resolves the bindings in the Direct to Web template’s binding file</p></li><li class="li"><p>the <em>Direct to Web factory</em>, an instance of the D2W class that creates the Direct to Web pages</p></li><li class="li"><p>how Direct to Web generates a query page</p></li><li class="li"><p>the Direct to Web rule system, which contains application configuration information</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF102">Direct to Web Components</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF103">Direct to Web Templates</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF104">Direct to Web Reusable Components</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF105">Property-Level Components</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF106">Direct to Web Component Organization</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF107">The Direct to Web Context</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF113">The Direct to Web Factory</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJHEDBJ">Rendering a Direct to Web Page: An Example</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF115">Rendering the Direct to Web Template</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF116">Setting the Property Key</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF117">Resolving Keys That Depend on the Property</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ">The Rule System</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF102" title="Direct to Web Components"></a><h2>Direct to Web Components</h2><p>Direct to Web provides nine types of Web pages to perform the tasks shown in Table 1. See <span class="content_text"><a href="../WalkThrough/WalkThrough.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_5-BABIGHDG">“Dynamically Generated Pages”</a></span> for more information about these tasks.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF121" title="Table 2-1Direct to Web tasks"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Direct to Web tasks</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Task</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p>Query</p></td><td ><p>Allows the user to construct a query for a particular entity.</p></td></tr><tr><td  scope="row"><p>Query All</p></td><td ><p>Displays all entities and lets the user construct queries on their attributes.</p></td></tr><tr><td  scope="row"><p>Inspect</p></td><td ><p>Displays a single record of a given entity.</p></td></tr><tr><td  scope="row"><p>Edit</p></td><td ><p>Displays a single record of a given entity and allows the user to change the record and save it to the database.</p></td></tr><tr><td  scope="row"><p>List</p></td><td ><p>Displays several records of a particular entity in tabular form.</p></td></tr><tr><td  scope="row"><p>Select</p></td><td ><p>Displays several records of a particular entity in tabular form and allows the user to choose one of them.</p></td></tr><tr><td  scope="row"><p>Edit relationship</p></td><td ><p>Adds and removes objects from a relationship.</p></td></tr><tr><td  scope="row"><p>Confirm</p></td><td ><p>Prompts the user to confirm that a record should be deleted.</p></td></tr><tr><td  scope="row"><p>Error</p></td><td ><p>Displays information related to exceptions and other errors.</p></td></tr></table></div><p>To render these pages, Direct to Web uses three types of components: Direct to Web templates, Direct to Web reusable components, and property-level components.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF103" title="Direct to Web Templates"></a><h2>Direct to Web Templates</h2><p>Direct to Web generates the task Web pages using instances of the D2WPage class (itself a descendent of the WOComponent class) called Direct to Web templates. A Direct to Web template defines the basic layout for the task’s user interface. Direct to Web includes 29 templates: nine for the Basic look, ten for the Neutral look, and ten for the WebObjects look. For more information about looks, see <span class="content_text"><a href="../WalkThrough/WalkThrough.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_5-BCIIEJHC">“The Different Looks for WebObjects Applications.”</a></span> The Direct to Web templates are listed in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJIADGC">Table 2-2</a></span>.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJIADGC" title="Table 2-2Direct to Web Templates"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>Direct to Web Templates</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Task</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Basic Look</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Neutral Look</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>WebObjects Look</p></th></tr><tr><td  scope="row"><p>Confirm</p></td><td ><p>BASConfirmPage</p></td><td ><p>NEUConfirmPage</p></td><td ><p>WOLConfirmPage</p></td></tr><tr><td  scope="row"><p>Edit relationship</p></td><td ><p>BASEditRelationshipPage</p></td><td ><p>NEUEditRelationshipPage</p></td><td ><p>WOLEditRelationship- Page</p></td></tr><tr><td  scope="row"><p>Error</p></td><td ><p>BASErrorPage</p></td><td ><p>NEUErrorPage</p></td><td ><p>WOLErrorPage</p></td></tr><tr><td  scope="row"><p>Edit, Inspect</p></td><td ><p>BASInspectPage</p></td><td ><p>NEUInspectPage</p></td><td ><p>WOLInspectPage</p></td></tr><tr><td  scope="row"><p>List, Select</p></td><td ><p>BASListPage</p></td><td ><p>NEUListPage</p></td><td ><p>WOLListPage</p></td></tr><tr><td  scope="row"><p>List</p></td><td ><p>BASMasterDetailPage</p></td><td ><p>NEUMasterDetailPage</p></td><td ><p>WOLMasterDetailPage</p></td></tr><tr><td  scope="row"><p>List, Select</p></td><td ><p>BASPlainListPage</p></td><td ><p>NEUPlainListPage</p></td><td ><p>WOLPlainListPage</p></td></tr><tr><td  scope="row"><p>Query all</p></td><td ><p>BASQueryAllEntitiesPage</p></td><td ><p>NEUQueryAllEntitiesPage</p></td><td ><p>WOLQueryAllEntities- Page</p></td></tr><tr><td  scope="row"><p>Query</p></td><td ><p>BASQueryPage</p></td><td ><p>NEUQueryPage</p></td><td ><p>WOLQueryPage</p></td></tr><tr><td  scope="row"><p>Edit, Inspect</p></td><td ><p></p></td><td ><p>NEUTabInspectPage</p></td><td ><p>WOLTabInspectPage</p></td></tr></table></div><p>Some Direct to Web templates perform multiple tasks. For example, an InspectPage template also edits. For some tasks, there are multiple Direct to Web templates in a given look that you can use. For example, you can use a ListPage, a PlainListPage, or a MasterDetailPage template to perform the list task.</p><p>Like any other WOComponent, a Direct to Web template has an HTML template (<code>.html</code> ) file and a bindings (<code>.wod</code> ) file. What differentiates a Direct to Web template from other components is that it resolves its bindings with the help of the Direct to Web framework at runtime.</p><p>Note that a Direct to Web template is different from a component’s HTML template (<code>.html</code> ) file: a Direct to Web template is a special type of component while an HTML template is a file containing the HTML code that defines a component’s appearance.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF104" title="Direct to Web Reusable Components"></a><h2>Direct to Web Reusable Components</h2><p>Some Direct to Web templates can be viewed as implementing more than one task:</p><ul class="ul"><li class="li"><p>A MasterDetailPage template consists of a select component at the top and an edit component at the bottom.</p></li><li class="li"><p>An EditRelationshipPage template consists of a select component at the top and query, select, and edit components at the bottom.</p></li></ul><p>Direct to Web displays these subcomponents with Direct to Web templates. For example, a NEUMasterDetailPage displays its select component using a NEUListPage and its edit component with a NEUInspectPage. However, the Direct to Web templates are not designed to be nested directly within other Direct to Web templates. To permit nesting, Direct to Web uses another type of component called a <em>Direct to Web reusable component</em>, which acts as an interface between the outer template and the inner template. There are five types of Direct to Web reusable components; they are listed in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGBHCH">Table 2-3</a></span>.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGBHCH" title="Table 2-3Reusable components"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-3&nbsp;&nbsp;</strong>Reusable components</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Task</p></th></tr><tr><td  scope="row"><p>D2WEdit</p></td><td ><p>Edit</p></td></tr><tr><td  scope="row"><p>D2WInspect</p></td><td ><p>Inspect</p></td></tr><tr><td  scope="row"><p>D2WList</p></td><td ><p>List</p></td></tr><tr><td  scope="row"><p>D2WQuery</p></td><td ><p>Query</p></td></tr><tr><td  scope="row"><p>D2WSelect</p></td><td ><p>Select</p></td></tr></table></div><p><span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJIAICH">Table 2-4</a></span> shows how the reusable components are used in the Direct to Web templates containing multiple tasks. The remaining templates do not contain Direct to Web reusable components.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJIAICH" title="Table 2-4Direct to Web templates and reusable components"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-4&nbsp;&nbsp;</strong>Direct to Web templates and reusable components</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Direct to Web Template</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Direct to Web Reusable Components Used</p></th></tr><tr><td  scope="row"><p>BASMasterDetailPageNEUMasterDetailPageWOLMasterDetailPage</p></td><td ><p>D2WSelect, D2WEdit</p></td></tr><tr><td  scope="row"><p>BASEditRelationshipPageNEUEditRelationshipPageWOLEditRelationshipPage</p></td><td ><p>D2WSelect, D2WQuery, D2WEdit</p></td></tr></table></div><p>In addition to allowing the nesting of Direct to Web templates, Direct to Web reusable components can also be embedded in your own components; they are available on a palette in WebObjects Builder. See the <em>Direct to Web Reference</em> for more information about the individual Direct to Web reusable components.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF105" title="Property-Level Components"></a><h2>Property-Level Components</h2><p>Direct to Web uses <em>property-level components</em> to display, query, and edit individual properties of an entity. A property is an attribute or relationship of an entity. Direct to Web defines components for manipulating strings, dates, numbers, to-one relationships, to-many relationships, and other objects. For example, <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGAGEE">Table 2-5</a></span> lists some property-level components; these components work with numbers.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGAGEE" title="Table 2-5Number property-level components (java.lang.Number, java.math.BigDecimal)"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-5&nbsp;&nbsp;</strong>Number property-level components (java.lang.Number, java.math.BigDecimal)</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Display</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Edit</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Query</p></th></tr><tr><td  scope="row"><p>D2WDisplayNumber</p></td><td ><p>D2WEditNumber</p></td><td ><p>D2WQueryNumberOperator</p></td></tr><tr><td  scope="row"><p>D2WDisplayStyledNumber</p></td><td ><p></p></td><td ><p>D2WQueryNumberRange</p></td></tr><tr><td  scope="row"><p>D2WDisplayBoolean</p></td><td ><p>D2WEditBoolean</p></td><td ><p>D2WQueryBoolean</p></td></tr></table></div><p>At runtime when a template displays a property, Direct to Web chooses which property-level component should display the property. The choice depends on the property’s data type and how you configure the application with the Web Assistant.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF106" title="Direct to Web Component Organization"></a><h2>Direct to Web Component Organization</h2><p><span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJJHJGE">Figure 2-1</a></span> shows the components in an edit page for the Customer entity in the Neutral look, with only the attritubutes <code>firstName</code>, <code>lastName</code>, and <code>agent</code> showing. The top-level component is a Direct to Web template called <code>NEUInspectPage.wo</code>. It contains the project’s <code>PageWrapper.wo</code> component, which defines the overall layout of the page. The <code>PageWrapper.wo</code> component contains the <code>MenuHeader.wo</code> component, which defines the Direct to Web navigation menu. See <span class="content_text"><a href="../WalkThrough/WalkThrough.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_5-BABHDECG">“The Structure of a Direct to Web Project”</a></span> for more information about <code>PageWrapper.wo</code> and <code>MenuHeader.wo</code>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJJHJGE" title="Figure 2-1Edit page component organization"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Edit page component organization</p><img src = "../art/editpagecomponents.gif" alt = "Edit page component organization" width="414" height="243"></div><br/><p>The <code>PageWrapper.wo</code> component content comes from the NEUInspectPage Direct to Web template. This content includes HTML input elements for the visible attributes of an entity. Each attribute appears in a separate property-level component that depends on the attribute’s type. The <code>firstName</code> and <code>lastName</code> attributes are displayed using D2WEditString components. The <code>agent</code> relationship displays using a D2WEditToOneFault component.</p><p>Pages with nested Direct to Web templates contain Direct to Web reusable components. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGACCI">Figure 2-2</a></span> shows a master detail page in the Neutral look. The <code>NEUMasterDetailPage.wo</code> Direct to Web template contains <code>PageWrapper.wo</code> which in turn, contains <code>MenuHeader.wo</code>. <code>NEUMasterDetailPage.wo</code> also contains two reusable components that act as interfaces to the templates they display: a D2WSelect component and a D2WEdit component. Each of these components is actually a WOSwitchComponent that displays a template—the D2WSelect component displays a NEUListPage Direct to Web template and the D2WEdit component displays a NEUInspectPage Direct to Web template.</p><br/><div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJGACCI" title="Figure 2-2Master-detail page component organization"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>Master-detail page component organization</p><img src = "../art/masterdetailpagecomponents.gif" alt = "Master-detail page component organization" width="410" height="244"></div><br/><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF107" title="The Direct to Web Context"></a><h2>The Direct to Web Context</h2><p>As mentioned earlier, a Direct to Web template is rendered using runtime information about the entities it displays. To translate that information into something you can bind to the template’s dynamic elements, Direct to Web uses an instance of the D2WContext class called the Direct to Web context. This object has two functions: it maintains a <em>state dictionary</em> that holds the state of a Direct to Web template as it renders, and it provides values that you can bind directly to attributes of dynamic elements. Each instance of a Direct to Web template has an associated Direct to Web context.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF108" title="Maintaining State"></a><h3>Maintaining State</h3><p>As the Direct to Web template changes state as it is rendered, the Direct to Web context changes state with it. Specifically, the Direct to Web context uses an NSDictionary containing</p><ul class="spaceabove"><li class="li"><p>the current task</p></li><li class="li"><p>the current entity</p></li><li class="li"><p>the current property (attribute or relationship)</p></li></ul><p>The task and the entity remain constant while the template renders (with the exception of the query all template, for which only the task remains constant). The property does not stay constant, however. Consider an edit page. It displays the entity name and the entity’s visible properties. To display the properties, the Direct to Web template iterates through them using a WORepetition. As it iterates, the Direct to Web context updates the information about the current property in its dictionary.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF109" title="Providing Binding Values"></a><h3>Providing Binding Values</h3><p>Each Direct to Web template has a Direct to Web context called <code>d2wContext</code>, which implements the EOKeyValueCoding interface. Thus you can bind directly to keys that the context responds to. For example, <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJJIDGC">Listing 2-1</a></span> shows the bindings file for a Direct to Web template that displays the name of the entity.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJJIDGC" title="Listing 2-1Bindings file for a Direct to Web template"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Bindings file for a Direct to Web template</p><div class="codesample"><table><tr><td scope="row"><pre>String1: WOString {<span></span></pre></td></tr><tr><td scope="row"><pre>    value = d2wContext.entity.name;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>The Direct to Web context determines the values for the keys (<code>d2wContext.entity.name</code> for example) in one of three ways:</p><ul class="spaceabove"><li class="li"><p>it looks it up in its state dictionary</p></li><li class="li"><p>it accesses application configuration information. (The Web Assistant is the primary way to modify the application configuration.)</p></li><li class="li"><p>it derives values from the state and configuration information</p></li></ul><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF110" title="Resolving Keys With the State Dictionary"></a><h4>Resolving Keys With the State Dictionary</h4><p>The state dictionary contains the following entries:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description of Value</p></th></tr><tr><td  scope="row"><p><code>task</code></p></td><td ><p>A string representing the current task.</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p>An EOEntity representing the current entity.</p></td></tr><tr><td  scope="row"><p><code>propertyKey</code></p></td><td ><p>A string representing the key of the current property.</p></td></tr><tr><td  scope="row"><p><code>attribute</code></p></td><td ><p>An EOAttribute representing the current attribute (<code>null</code> if the current property is a relationship.)</p></td></tr><tr><td  scope="row"><p><code>relationship</code></p></td><td ><p>An EORelationship representing the current relationship (<code>null</code> if the current property is an attribute.)</p></td></tr></table></div><p>If the dictionary contains the key the template needs, the Direct to Web context resolves the key by returning the value in the dictionary. Otherwise the Direct to Web context resolves the key using one of the other ways.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF111" title="Resolving Keys With the Application Configuration"></a><h4>Resolving Keys With the Application Configuration</h4><p>Some keys can only be resolved using the application configuration information, which is stored as a database of rules. For example, a rule to determine the property-level component for the <code>dateReleased</code> attribute might be “If the task is ‘edit’, the entity name is ‘Customer’, and the property key is ‘lastName’ then the value for the <code>componentName</code> key is ‘D2WEditString’.”</p><p>The Direct to Web context uses the <em>rule engine</em> to resolve keys that aren’t in its dictionary. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJFFEFB">Figure 2-3</a></span> shows how the rule engine relates to the Direct to Web context. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ">“The Rule System”</a></span> contains detailed information on how the rule engine works.</p><br/><div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJFFEFB" title="Figure 2-3Direct to Web Architecture"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>Direct to Web Architecture</p><img src = "../art/architecture.gif" alt = "Direct to Web Architecture" width="293" height="232"></div><br/><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF112" title="Resolving Derived Values"></a><h4>Resolving Derived Values</h4><p>The rule engine also provides objects that have methods that derive values from the Direct to Web context’s state dictionary. An example of a derived value is the name displayed for a property: a method converts a property name like <code>lastName</code> to a display string “Last Name”. Using derived values is discussed in more detail in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ">“The Rule System.”</a></span></p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF113" title="The Direct to Web Factory"></a><h2>The Direct to Web Factory</h2><p>Direct to Web pages are created by the Direct to Web factory, an instance of the D2W class (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJFFEFB">Figure 2-3</a></span>). This object creates pages by instantiating a Direct to Web context and a Direct to Web template for each page. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJHEDBJ">“Rendering a Direct to Web Page: An Example,”</a></span> shows how the factory generates a query page.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJHEDBJ" title="Rendering a Direct to Web Page: An Example"></a><h2>Rendering a Direct to Web Page: An Example</h2><p>This section describes how the components, the Direct to Web context, and the Direct to Web factory interact while creating and rendering a query page for the Customer entity. This example begins with the user viewing a query all page in the Basic look and clicking a hyperlink labeled “more..” in the Customer row, which links to the query page. The query all page is rendered using a <code>BASQueryAllEntitiesPage.wo</code> template.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF114" title="Creating the Query Page"></a><h3>Creating the Query Page</h3><p>When the user clicks the hyperlink, the hyperlink invokes the <code>showRegularQueryAction</code> method defined in the D2WQueryAllEntitiesPage class, the superclass of the BASQueryAllEntitiesPage class. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDGBED">Listing 2-2</a></span> shows the implementation of the <code>showRegularQueryAction</code> method.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDGBED" title="Listing 2-2D2WQueryAllEntitiesPage.showReqularQueryAction"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>D2WQueryAllEntitiesPage.showReqularQueryAction</p><div class="codesample"><table><tr><td scope="row"><pre>publicWOComponent showRegularQueryAction()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QueryPageInterface newQueryPage= D2W.factory().queryPageForEntityNamed<span></span></pre></td></tr><tr><td scope="row"><pre>        (entity().name(), session());<span></span></pre></td></tr><tr><td scope="row"><pre>    return (WOComponent)newQueryPage;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The Direct to Web factory object creates a Direct to Web context and initializes its NSDictionary by setting the value for the <code>task</code> key to “query” and the value for the <code>entity</code> key to the Customer EOEntity.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF122" title="Table 2-6Initial Direct to Web context dictionary"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-6&nbsp;&nbsp;</strong>Initial Direct to Web context dictionary</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p><code>task</code></p></td><td ><p>“query”</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p>&lt;EOEntity Customer></p></td></tr></table></div><p>To determine which Direct to Web template to create, the Direct to Web factory asks the Direct to Web context for the value of the <code>pageName</code> key. Since this key is neither in the dictionary nor a derived value from the dictionary, the Direct to Web context enlists the aid of the rule engine. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJBFIGF">Listing 2-3</a></span> shows the rules that resolve the key.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJBFIGF" title="Listing 2-3Rules used to resolve the pageName key"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Rules used to resolve the pageName key</p><div class="codesample"><table><tr><td scope="row"><pre>((look= "BasicLook") and (task = "query")) => pageName = "BASQueryPage"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>*true* => look = "BasicLook"<span></span></pre></td></tr></table></div><p>A rule has a left-hand side and a right-hand side separated by “=>”. The left-hand side specifies a condition that must be met for the rule to be a candidate to “fire,” or resolve a key. The right-hand side specifies the key-value assignment that takes place when the rule fires. Since the left-hand side for the second rule is true, the rule always fires when the Direct to Web context wants the value for the <code>look</code> key. </p><p>There are three sources for the rules that the rule engine uses:</p><ul class="spaceabove"><li class="li"><p><strong>The Direct to Web framework</strong> defines rules that determine the default application behavior.</p></li><li class="li"><p><strong>You</strong> can write your own rules that override the framework’s defaults rules.</p></li><li class="li"><p><strong>The Web Assistant</strong> generates rules involving the specific application information. These rules are generated automatically as you configure the application with the Web Assistant; you don’t have to write them.</p></li></ul><p>See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ">“The Rule System”</a></span> for more information about rules.</p><p>The two rules that resolve the <code>pageName</code> key (defined in the Direct to Web Framework) fire and the Direct to Web context returns “BASQueryPage” as the value for the <code>pageName</code> key.</p><p>Knowing the template name, the Direct to Web factory object creates a page using the <code>WOComponent.pageWithName</code> method. Then it attaches the Direct to Web context to the newly generated page.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF115" title="Rendering the Direct to Web Template"></a><h2>Rendering the Direct to Web Template</h2><p>Now the WebObjects framework begins to render the template. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BFFDJBGH">Listing 2-4</a></span> shows excerpts from the HTML template for the BASQueryPage Direct to Web template; the listed portions of the file are discussed in this example. <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJCFBFA">Listing 2-5</a></span> shows the corresponding sections in the bindings file.</p><p>First, the Direct to Web template displays the page wrapper. To do so, it needs to resolve the WOComponentName binding for the PageWrapper WOSwitchComponent (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJCFBFA">Listing 2-5</a></span>). A WOSwitchComponent displays a nested component that has the name specified by its WOComponentName binding, which in this case is bound to the <code>d2wContext.pageWrapperName</code> key. Since the Direct to Web Context can’t find it in its dictionary, it invokes the rule engine to resolve the key, which fires the rule:</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> pageWrapperName = "PageWrapper"<span></span></pre></td></tr></table></div><p>The Direct to Web context returns “PageWrapper” for the WOComponentName binding and the WOSwitchComponent displays the application’s <code>PageWrapper.wo</code> component. The template continues to render, resolving its keys in a similar way.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BFFDJBGH" title="Listing 2-4BASQueryPage.html excerpts"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>BASQueryPage.html excerpts</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;WEBOBJECTNAME=PageWrapper><span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;WEBOBJECT NAME=ResourceRepetition><span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>        ... &lt;WEBOBJECT NAME=ResourceLabel>:... &lt;/WEBOBJECT><span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;WEBOBJECT NAME=ResourceInputRepresentation>&lt;/WEBOBJECT><span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/WEBOBJECT><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/WEBOBJECT><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJCFBFA" title="Listing 2-5BASQueryPage.wod excerpts"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>BASQueryPage.wod excerpts</p><div class="codesample"><table><tr><td scope="row"><pre>PageWrapper:WOSwitchComponent {<span></span></pre></td></tr><tr><td scope="row"><pre>    WOComponentName = pageWrapperName;<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ResourceInputRepresentation:WOSwitchComponent {<span></span></pre></td></tr><tr><td scope="row"><pre>    WOComponentName = d2wContext.componentName;<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ResourceLabel: WOString {<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    value = d2wContext.displayNameForProperty;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ResourceRepetition: WORepetition{<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    item = d2wContext.propertyKey;<span></span></pre></td></tr><tr><td scope="row"><pre>    list = d2wContext.displayPropertyKeys;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF116" title="Setting the Property Key"></a><h2>Setting the Property Key</h2><p>When the template begins to render the query fields for the entity’s attributes and relationships (like the agent and contact info) it encounters the WORepetition labeled <code>ResourceRepetition</code>. See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BFFDJBGH">Listing 2-4</a></span> and <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJCFBFA">Listing 2-5</a></span>. The WORepetition’s <code>list</code> attribute is bound to <code>d2wContext.displayPropertyKeys</code>. Since <code>displayPropertyKeys</code> is not in its dictionary, the Direct to Web context resolves the key using the rule engine, which causes the following rule to fire:</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> displayPropertyKeys = "defaultPropertyKeysFromEntity"<span></span></pre></td></tr></table></div><p>The <code>defaultPropertyKeysFromEntity</code> key refers to a method that derives a value based on the Direct to Web context’s dictionary. See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ">“The Rule System”</a></span> for more information about the how derived values are handled. The <code>defaultPropertyKeysFromEntity</code> method returns an NSArray containing the Customer entity’s property keys, which resolves the WORepetition’s <code>list</code> binding.</p><p>As the repetition iterates, it sets the <code>item</code> attribute for each of the objects in the list. The first object is the string “agent”. Since <code>item</code> is bound to <code>d2wContext.propertyKey</code>, the Direct to Web context sets the value for <code>propertyKey</code> in its dictionary to “agent”. At the same time, it sets the value for the <code>attribute</code> key to <code>null</code> and the value for the <code>relationship</code> key to the <code><!--a  -->agent<!--/a--></code> EORelationship, since a Customer’s <code>agent</code> property is a relationship and not an attribute. Now the Direct to Web Context dictionary contains the information listed in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJHAHHJ">Table 2-7</a></span>.</p><p></p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJHAHHJ" title="Table 2-7Direct to Web context dictionary after setting propertyKey"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-7&nbsp;&nbsp;</strong>Direct to Web context dictionary after setting propertyKey</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p><code>task</code></p></td><td ><p>“query”</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p>&lt;EOEntity Customer></p></td></tr><tr><td  scope="row"><p><code>propertyKey</code></p></td><td ><p>“agent”</p></td></tr><tr><td  scope="row"><p><code>attribute</code></p></td><td ><p><code>null</code></p></td></tr><tr><td  scope="row"><p><code>relationship</code></p></td><td ><p>&lt;EORelationship agent></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF117" title="Resolving Keys That Depend on the Property"></a><h2>Resolving Keys That Depend on the Property</h2><p>As the WebObjects framework continues to render the <code>ResourceRepetition</code> WORepetition, it encounters the <code>ResourceLabel</code> WOString. See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BFFDJBGH">Listing 2-4</a></span>. The <code>value</code> attribute is bound to <code>d2wContext.displayNameForProperty</code>. This causes the following rule to fire:</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> displayNameForProperty = "defaultDisplayNameForProperty"<span></span></pre></td></tr></table></div><p>The derived value for the <code>defaultDisplayNameForProperty</code> key is implemented by a method that capitalizes the property key in the context’s dictionary, inserts spaces between words with mixed case, and returns the resulting name “Agent”, which the template displays.</p><p>Next, the template displays the property-level component that queries for the <code>agent</code> relationship. Since this component is known only at runtime, the Direct to Web template displays it with a WOSwitchComponent called <code>ResourceInputRepresentation</code>. See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJCFBFA">Listing 2-5</a></span>. The WOSwitchComponent’s <code>WOComponentName</code> attribute is bound to <code>d2wContext.componentName</code>. When the context evaluates this key, the following rule fires:</p><div class="codesample"><table><tr><td scope="row"><pre>((task= "query") and (propertyType = "r")<span></span></pre></td></tr><tr><td scope="row"><pre>    and (not (relationship.isToMany= (java.math.BigDecimal)"1"))<span></span></pre></td></tr><tr><td scope="row"><pre>    => componentName = "D2WQueryToOneField"<span></span></pre></td></tr></table></div><p>Thus the WOSwitchComponent displays a <code>D2WQueryToOneField.wo</code> reusable component from the DirectToWeb framework.</p><p>The rest of the template renders in a similar way.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDAABJ" title="The Rule System"></a><h2>The Rule System</h2><p>Direct to Web stores its configuration in the form of rules. The following is an example of a rule:</p><div class="codesample"><table><tr><td scope="row"><pre>((task= "query") and (not (attribute = null))<span></span></pre></td></tr><tr><td scope="row"><pre>    and (attribute.valueClassName= "java.lang.String")<span></span></pre></td></tr><tr><td scope="row"><pre>    => componentName = "D2WQueryStringComponent"<span></span></pre></td></tr></table></div><p>A rule consists of five parts, of which three are shown in the example:</p><ul class="ul"><li class="li"><p><strong>a left-hand side</strong>, which is separated from the right-hand side by “=>”</p><p>The left-hand side specifies a condition that must be true for the rule to be a candidate to fire. In this case, the task must be “query”, the attribute must not be <code>null</code> and its value must be a Java String.</p></li><li class="li"><p><strong>a right-hand-side key</strong> (<code>componentName</code> in this case)</p><p>The right-hand-side key must match the key the Direct to Web context is seeking for the rule to be a candidate to fire. </p></li><li class="li"><p><strong>a right-hand-side value</strong> (”D2WQueryStringComponent” in this case)</p><p>The right-hand-side value specifies the value for the right-hand-side key when the rule fires. It can be a constant value (as in this case) or a value computed by a method.</p></li><li class="li"><p><strong>a priority</strong></p><p>The priority helps Direct to Web decide which rule should fire when there are several candidates. See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJBCIGD">“Deciding Which Candidate Should Fire”</a></span> for more information about the rule priority.</p></li><li class="li"><p><strong>an assignment class specifier</strong></p><p>The assignment class sets the value for the right-hand-side key when the rule fires. The default assignment class, Assignment, defined in the Direct to Web framework, assigns a constant value like “D2WQueryStringComponent”. When the right-hand-side value is derived using a method, the assignment class specifies a class that contains the method.</p></li></ul><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJBCIGD" title="Deciding Which Candidate Should Fire"></a><h3>Deciding Which Candidate Should Fire</h3><p>When the Direct to Web context asks for the value for a key, there are typically several rules that can fire. For example, consider the following rules to resolve the <code>componentName</code> key:</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> componentName = "D2WUneditable"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>(task = "inspect") =>componentName = "D2WDisplayString"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>((task = "inspect") and<span></span></pre></td></tr><tr><td scope="row"><pre>    (attribute.valueClassName= "com.webobjects.foundation.NSTimestamp"))<span></span></pre></td></tr><tr><td scope="row"><pre>    => componentName = "D2WDisplayDate"<span></span></pre></td></tr></table></div><p>The left-hand side of the first rule is always true. Such rules are useful for providing “fallback” values when all other rules fail to fire. Note that if the left-hand side for the third rule is true, all three rules are candidates for firing. The rule engine must choose which rule will fire.</p><p>To make the choice, Direct to Web employs a priority system. Each rule has a priority. The single rule with the highest priority fires. By convention, the following priorities are used in Direct to Web.</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Priority</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p>0-10</p></td><td ><p>Reserved for Direct to Web framework and fallback rules</p></td></tr><tr><td  scope="row"><p>100-105</p></td><td ><p>WebAssistant rules</p></td></tr></table></div><p>If two or more rules have the same priority, the rule with the most specific left-hand side (applying to the least number of cases) fires. Direct to Web measures how specific a rule is by counting the number of clauses joined by an <em>and</em> operator; the more clauses the rule has, the more specific it is. Clauses joined by the <em>or</em> operator count as a single clause.</p><p>If two or more rules have the same priority and are equally specific, Direct to Web arbitrarily chooses one.</p><p>The rule system resolves keys recursively. In other words, the rule system can resolve a rule based on the outcome of another rule. Consider a rule for the <code>pageName</code> key:</p><div class="codesample"><table><tr><td scope="row"><pre>((look= "BasicLook") and (task = "query")) => pageName = "BASQueryPage"<span></span></pre></td></tr></table></div><p>The <code>look</code> key is defined by a rule like this:</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> look = "BasicLook"<span></span></pre></td></tr></table></div><p>To resolve the <code>pageName</code> key, the rule engine asks the Direct to Web context for values for the <code>look</code> and the <code>task</code> keys. The Direct to Web context then invokes the rule engine to resolve the <code>look</code> key. This extra step isn’t necessary for the task key; it’s already in the Direct to Web context’s local dictionary. Although recursive rules are powerful, they can hamper Direct to Web’s performance.</p><p>To see the rules that fire as Direct to Web renders pages, run your application with the switch <code>-D2WTraceRuleFiringEnabled YES</code>.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF118" title="Rules and the Web Assistant"></a><h3>Rules and the Web Assistant</h3><p>The Web Assistant defines rules that pertain to specific entities and properties in your application, unlike the rules from the Direct to Web framework. These rules have a priority of 100, which override the default rules in the Direct to Web framework. Consequently, if you want to define your own default rules that the Web Assistant can override, you need to specify them with a priority between 11 and 99.</p><p>When you click Update in the Web Assistant window, the settings are compared to the settings on the server and the appropriate rules are added or deleted from the rule database in memory. When you click Save in the Web Assistant window, the rule database is stored in the application’s <code>user.d2wmodel</code> file.</p><p>To build the Web Assistant’s list of available task pages and property-level components, Direct to Web uses the rule system differently from when it renders a page. Instead of firing the single best candidate rule to find a particular key, Direct to Web asks for all rules that can resolve the key given the state of the Direct to Web context and collects the resulting values into a list that the Web Assistant presents to you. Two special keys are handled this way: <code>pageAvailable</code> for collecting task pages and <code>componentAvailable</code> for collecting property-level components.</p><p>If you want to see which rules the Web Assistant creates and deletes at runtime, you can run your application with the switch <code>-D2WTraceRuleModificationsEnabled YES</code>.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF119" title="Rule Firing Cache"></a><h3>Rule Firing Cache</h3><p>When a rule fires, its right-hand-side value is cached to improve Direct to Web’s rendering performance. Once the value is cached, subsequent requests for the key may cause the rule engine to access the cache to resolve its value instead of finding a rule to fire. The cache is retained for the life of the application or until you click Update, Save, or Revert in the Web Assistant.</p><p>It is important to note that the right-hand-side value is cached based on the values of a collection of keys that does not necessarily include all of the keys on the left-hand side of the rule. Only the values of a list of <em>significant keys</em> and the right-hand-side key are used to uniquely identify the cache entry. By default, the significant keys are</p><ul class="spaceabove"><li class="li"><p>task</p></li><li class="li"><p>entity</p></li><li class="li"><p>propertyKey</p></li><li class="li"><p>configuration</p></li></ul><p>The configuration key refers to the named configuration of the current page. You can add to this list using the D2W class’s <code>newSignificantKey</code> method.</p><p>Consider this rule:</p><div class="codesample"><table><tr><td scope="row"><pre>((task= "edit") and (entity.name = "Customer")<span></span></pre></td></tr><tr><td scope="row"><pre>    and (propertyKey = "agent"))<span></span></pre></td></tr><tr><td scope="row"><pre>    => componentName = "D2WEditToOneRelationship"<span></span></pre></td></tr></table></div><p>When it fires, Direct to Web creates the cache entry described in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDJGCD">Table 2-8</a></span>.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-BAJDJGCD" title="Table 2-8Example of Cached Rule"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-8&nbsp;&nbsp;</strong>Example of Cached Rule</caption><tr><td  scope="row"><p><code>task</code></p></td><td ><p>“edit”</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p><code>&lt;EOEntity Customer></code></p></td></tr><tr><td  scope="row"><p><code>propertyKey</code></p></td><td ><p>“agent”</p></td></tr><tr><td  scope="row"><p><code>configuration</code></p></td><td ><p><code>null</code></p></td></tr><tr><td  scope="row"><p><code>key</code></p></td><td ><p><code>componentName</code></p></td></tr><tr><td  scope="row"><p><code>value</code></p></td><td ><p>“D2WEditToOneRelationship”</p></td></tr></table></div><p>If the Direct to Web context is asked for the value of the <code>componentName</code> key again, and the context’s values for <code>task</code>, <code>entity</code>, <code>propertyKey</code>, and <code>configuration</code> are unchanged, this rule does not fire. Instead, the rule system uses the cached value. On the other hand, if the value of any of these keys changes, the cache entry no longer applies and the rule engine must find a rule to fire to resolve the <code>componentName</code> key.</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF120" title="Caching Gotchas "></a><h4>Caching Gotchas </h4><p>If you watch the rules as they fire (with <code>-D2WTraceRuleFiringEnabled YES</code>), you may find rules that fire when you expect Direct to Web to use the values in the cache. Or rules you expect to fire don’t appear because Direct to Web gets the values from the cache.</p><p>To see how a rule might fire when you expect its value to be cached, consider the rule that resolves the <code>look</code> key, which defines whether the application is using the Basic look, the Neutral look, or the WebObjects look. Suppose the rule is</p><div class="codesample"><table><tr><td scope="row"><pre>*true*=> look = "NeutralLook"<span></span></pre></td></tr></table></div><p>The first time this rule fires is when the Direct to Web factory asks for the name of the Direct to Web template to display the QueryAll page. The following cache entry is created:</p><p></p><p></p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF123" title="Table 2-9Example of Cached Rule First Time it Fires"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-9&nbsp;&nbsp;</strong>Example of Cached Rule First Time it Fires</caption><tr><td  scope="row"><p><code>task</code></p></td><td ><p>“queryAll”</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p>null</p></td></tr><tr><td  scope="row"><p><code>propertyKey</code></p></td><td ><p>null</p></td></tr><tr><td  scope="row"><p><code>configuration</code></p></td><td ><p><code>null</code></p></td></tr><tr><td  scope="row"><p><code>key</code></p></td><td ><p>look</p></td></tr><tr><td  scope="row"><p><code>value</code></p></td><td ><p>“NeutralLook”</p></td></tr></table></div><p>Note that the <code>entity</code> key is <code><!--a  -->null<!--/a--></code>. The next time Direct to Web asks for the <code>look</code> key is when it wants to know the background color for the Query form table. The entity is still <code>null</code> so Direct to Web gets the value from the cache.</p><p>Now the QueryAll template begins to iterate through the entities. It sets the first entity to the Administrator EOEntity. This time the <code>entity</code> key is no longer <code>null</code> so the old cache entry does not apply. Consequently, the rule engine fires the <code>look</code> rule again.</p><p>What is more difficult to debug is when the rule engine resolves a key using the cache when you expect a rule to fire. This happens when the outcome of the rule depends on a key that is not cached (that is, not in the list of significant keys). This can arise in an application that has different behavior depending on the user’s access privileges.</p><p>Consider an online real estate database application that behaves differently based on the user’s access privileges. In particular, the real estate agent (access level 1) sees the AgentListListing template and the customer (access level 3) sees the CustomerListListing template. You can set this up with these rules:</p><div class="codesample"><table><tr><td scope="row"><pre>((task= "list") and (entity = "Listing") and (session.user.accessLevel= 1))<span></span></pre></td></tr><tr><td scope="row"><pre>    => pageName = "AgentListListing"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>((task = "list") and (entity= "Listing") and (session.user.accessLevel = 3))<span></span></pre></td></tr><tr><td scope="row"><pre>    => pageName = "CustomerListListing"<span></span></pre></td></tr></table></div><p>Suppose the real estate agent logs into the application and accesses the list page. Direct to Web creates this cache entry:</p><a name="//apple_ref/doc/uid/TP30001015-DontLinkChapterID_2-TPXREF124" title="Table 2-10Cached Rule for Real Estate Agent Login"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-10&nbsp;&nbsp;</strong>Cached Rule for Real Estate Agent Login</caption><tr><td  scope="row"><p><code>task</code></p></td><td ><p>“list”</p></td></tr><tr><td  scope="row"><p><code>entity</code></p></td><td ><p>&lt;EOEntity Listing></p></td></tr><tr><td  scope="row"><p><code>propertyKey</code></p></td><td ><p>null</p></td></tr><tr><td  scope="row"><p><code>configuration</code></p></td><td ><p><code>null</code></p></td></tr><tr><td  scope="row"><p><code>key</code></p></td><td ><p>pageName</p></td></tr><tr><td  scope="row"><p><code>value</code></p></td><td ><p>“AgentListListing”</p></td></tr></table></div><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>task</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>entity</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>propertyKey</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>configuration</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>value</p></th></tr><tr><td  scope="row"><p>“list”</p></td><td ><p><code>&lt;EOEntityListing></code></p></td><td ><p><code><!--a  -->null<!--/a--></code></p></td><td ><p><code>null</code></p></td><td ><p><code>pageName</code></p></td><td ><p>“AgentListListing”</p></td></tr></table></div><p>Later a customer logs on and accesses the list page. Instead of showing the customer list page, Direct to Web displays the real estate agent’s list page, which is an obvious security violation. This happens because the second rule never fires. Instead, the cache entry from the first rule resolves the value for the <code>pageName</code> key.</p><p>To fix the application, you need to add <code>session.user.accessLevel</code> to the list of significant keys using the D2W class’s <code>newSignificantKey</code> method. For example, <code>D2W.factory().newSignificantKey("session.user.accessLevel");</code>.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../WalkThrough/WalkThrough.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Customizing/Customizing.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Developing_With_D2W/Architecture/Architecture.html%3Fid%3DTP30001015-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Developing_With_D2W/Architecture/Architecture.html%3Fid%3DTP30001015-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Developing_With_D2W/Architecture/Architecture.html%3Fid%3DTP30001015-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>