<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN2052: ChooseMovieClock and Video Output Components</title><meta name="keywords" content=""><meta name="Description" content="Technical Note TN2052: This Technote discusses the  ChooseMovieClockAPI introduced in QuickTime 6."><meta name="categories" content="QuickTime"><meta name="week-posted" content="May 6, 2002 - May 10, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003083" title="ChooseMovieClock and Video Output Components"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalnotes/QuickTime/idxDesignGuidelines-date.html">Design Guidelines</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2052</div>
<div id="pageheadsub">ChooseMovieClock and Video Output Components</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>    <TR>       <td align="left"> <!-- begin_header_box -->         <table width="600" cellpadding="0" cellspacing="0" border="0">          <tr>             <td width=300 valign="top" align=left scope="row">               <table border="0" width="300" cellpadding="0" cellspacing="0">                <tr>                   <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">                     CONTENTS <br>                    <br>                    </span> </td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc -->                     <p id="menutext"> <A HREF="#Section1">Who's your Master Clock?</A><BR>                      <BR>                      <A HREF="#Section2">The ChooseMovieClock API</A><BR>                      <BR>                      <A HREF="#Section3">Associated Components - <BR>                      The Video Output Component Clock</A><BR>                      <BR>                      <A HREF="#Section4">Using the associated Video Output Clock</A><BR>                      <BR>                      <A HREF="#Section5">Associated Components - <BR>                      Sound Output component</A><BR>                      <BR>                      <A HREF="#Section6">Using the associated Sound Output Component</A><BR>                      <BR>                      <A HREF="#Section7">Switching back to the Default Sound                       Output Component</A><BR>                      <BR>                      <A HREF="#Section8">Choosing the Clock</A><BR>                      <BR>                      <A HREF="#Section9">Using the Video Output Component Clock</A><BR>                      <BR>                      <A HREF="#Section10">Switching back to the Default Clock</A><BR>                      <BR>                      <A HREF="#Section11">Caveats</A><BR>                      <BR>                      <A HREF="#Section12">Sample Code</A><BR>                      <BR>                      <A HREF="#References">References</A><BR>                      <BR>                      <A HREF="#Downloads">Downloadables</A></P>                    <!-- end_toc --> </td>                </tr>                <tr>                   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                   </td>                </tr>              </table>            </td>            <td width=300 valign="top" align=left> <!-- begin_intro_text -->               <p id="introtext">This technote discusses the <code>ChooseMovieClock</code>                 API introduced in QuickTime 6.</P>              <p id="introtext">It explains how this call should be used with                 Video Output Components and in instances where <code>SetMovieMasterClock</code>                 was previously being used to reset a movie's clock.</P>              <p id="introtext">This information is primarily for developers                 using Video Output Component or modifying a movie's master                 clock by calling <code>SetMovieMasterClock</code>. </P>              <!-- end_intro_text --> <!-- begin_date -->               <h3 align=center>[May 07 2002]</h3>              <!-- end_date --> </TD>          </TR>        </TABLE>        <!-- end_table_box --> <BR>        <BR>        <hr width=500 align=center>        <BR>        <BR>        <!-- begin_content -->                         <A NAME=Section1></A>        <h2>Who's your Master Clock?</h2>        <p> Clock components provide time related services, and are used by the           Movie Toolbox for time-bases. A movie master clock is what drives a           movie's time-base.</p>        <p>A time-base defines a movie's current time value and the rate at which           time passes for the movie. The rate specifies the speed and direction           in which time travels in a movie. A time-base also contains a reference           to a clock which provides timing for the time-base. See <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/INMAC/QT/iqMovieToolbox.3.htm" target="_blank">Time           and the Movie Toolbox</a> for more information.</p>        <p>When an application opens a movie containing a sound track, QuickTime           will use the "sound clock" as the movie master clock. This "sound clock"           is a clock component provided directly by the selected           audio output device, or - if the audio output device doesn't provide           one - a clock that simply watches the samples go by on their way out           to the hardware, and derives a clock from that. </p>        <p> In other words, if you play a movie containing audio and video media,           the video will play at whatever rate the audio hardware is playing.           If the movie lacks a sound track, QuickTime will use the system clock           as the movie master clock. </p>        <p> We'll call the Clock QuickTime chooses via this process the Default           Clock.</p>        <P><A HREF="#top">Back to top</A></P>        <BR>        <BR>                                <a name="Section2"></a>         <h2>The ChooseMovieClock API</h2>        <p> <code>ChooseMovieClock</code> will assign a default clock to a movie.           If you have changed a movie's master clock with <code>SetMovieMasterClock</code>,           or would like to reset a movie's clock, use the <code>ChooseMovieClock</code>           API. </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>    void ChooseMovieClock( Movie m, long flags );</pre>                <UL>                  <LI><b><CODE>m</CODE></b> - The movie for this operation. Your                     application obtains this movie identifier from such functions                     as <code>NewMovie</code>, <code>NewMovieFromFile</code>, and                     <code>NewMovieFromHandle</code>.<BR>                    <BR>                  </LI>                  <LI><B><CODE>flags</CODE></B> - Currently not used. Must be                     set to 0.<BR>                    <BR>                  </LI>                </UL>              </TD>            </TR>          </TABLE>        </CENTER>        <BR>        <BR>                <P><A HREF="#top">Back to top</A></P>        <BR>        <BR>                <a name="Section3"></a>         <h2>Associated Components - The Video Output Component Clock</h2>                        <p> A Video Output Clock is the clock component associated with a specific           video output component. This clock allows the time-base used by a QuickTime           movie to be driven by a specific output hardware device's clock, in           order to synchronize video and sound when the output device is in use.         </p>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                        <a name="Section4"></a>         <h2>Using the Video Output Component Clock</h2>        <p> An application can ask for the clock component associated with the           video output component and use this clock as a movie's master clock.         </p>        <p> When using a Video Output Component, you can get an Instance of the           Clock Component associated with the Video Output Component by calling           <code>QTVideoOutputGetClock</code>. </p>        <p> Once you have this Clock Instance, it can be associated with a Movie           by calling <code>SetMovieMasterClock</code>. Because a change to the           display mode could affect a clock component, your application should           call <code>QTVideoOutputGetClock</code> only between calls to <code>QTVideoOutputBegin</code>           and <code>QTVideoOutputEnd</code>. </p>        <p> When you want to reset the movie master clock back to the default clock,           use <code>ChooseMovieClock</code>. </p>        <p> If you were previously using <code>SetMovieMasterClock</code> to reset           a movies clock to the default clock, you should change to the new <code>ChooseMovieClock</code>           method. </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>ChooseMovieClock(myMovie, 0);</pre>              </TD>            </TR>          </TABLE>        </CENTER>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                <a name="Section5"></a>         <h2>Associated Components - Sound Output Component</h2>                <p> A Sound Output Component is a software module that identifies, controls,           and plays audio on a specific hardware device. Video Output Components           in addition to having a Clock Component can have a Sound Output Component           associated with them. </p>        <p> Developers can change the Sound Output Component used by a Media Handler           by calling <code>MediaSetSoundOutputComponent</code>. This allows choosing           between using the audio device associated with a video output device,           another sound output device installed on the system, or the default           sound output device. </p>        <p> It should be noted that calling <code>MediaSetSoundOutputComponent</code>           can change the movie master clock. </p>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                <a name="Section6"></a>         <h2>Using the Sound Output Component associated with the Video Output           Component</h2>        <p> To find the Sound Output Components associated with a Video Output           Component use <code>QTVideoOutputGetIndSoundOutput</code>. Once the           Component is retrieved, call <code>MediaSetSoundOutputComponent</code>           to set the sound output component for a media handler. </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>Component theSoundOut = 0;ComponentInstance theVOutClock = NULL;UnsignedFixed theSupportedAudioRate, myWantedAudioRate = eAudioRate48khz;    ...// Does this Video Output Component have a// Sound Output Component associated with it?if (ComponentFunctionImplemented(theInstance,        kQTVideoOutputGetIndSoundOutputSelect)) {    // Get the first sound output component associated    // with the video output component    err = QTVideoOutputGetIndSoundOutput(inVOComponentInstance,                 1, &amp;theSoundOut);    if (err || 0 == theSoundOut) goto bail;    // Not all sound output components support all sample    // rates, use GetSoundOutputInfo with the siSampleRateAvailable    // selector and figure it out    theSupportedAudioRate = MyChooseAudioRate(myWantedAudioRate,                                                theSoundOut);    // Set the sample rate for the audio output    err = SoundComponentSetInfo((ComponentInstance)theSoundOut,                     NULL, siSampleRate, (void *)theSupportedAudioRate);    if (err) goto bail;    // For each audio tracks media set the sound output component    for (i = 0;i &lt; theNumberAudioTracks; i++) {        err = MediaSetSoundOutputComponent(inAudioMediaHandlers[i],                                                        theSoundOut);        if (err) goto bail;    }}// Use the Video Output Clock as the Master Clock// Set up the video output clock after sound or it// gets set back to the default clockif (ComponentFunctionImplemented(inVOComponentInstance,                                  kQTVideoOutputGetClockSelect)) {    err = QTVideoOutputGetClock(inVOComponentInstance, &amp;theVOutClock);    if (err || NULL == theVOutClock) goto bail;    SetMovieMasterClock(inMovie, (Component)theVOutClock, NULL);}</pre>              </TD>            </TR>          </TABLE>        </CENTER>        <P><A HREF="#top">Back to top</A></P>                        <BR><BR>                                <a name="Section7"></a>         <h2>Switching back to the Default Sound Output Component</h2>        <p> To switch back to the Default Sound Output Component, use <code>MediaSetSoundOutputComponent</code>           and pass in NULL for the Component parameter. </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>// Set the Sound Output back to the Default Sound Outputfor (i = 0;i &lt; theNumberAudioTracks; i++) {    err = MediaSetSoundOutputComponent(theAudioMediaHandler[i], NULL);    if (err) goto bail;}// Switch back to the default clockChooseMovieClock(myMovie, 0);</pre>              </TD>            </TR>          </TABLE>        </CENTER>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                                <a name="Section8"></a>         <h2>Choosing the Clock</h2>        <p> As mentioned in the above section <a href="#Section5">Associated Components           - Sound Output Component</a>, choosing a Sound Output Component will           reset the master clock. Therefore, once you choose the Sound Output           Component, you should then set up the movie's master clock. You can           either use the Video Output Clock (a logical choice when using a Video           Output Component), or you could chose the default clock to provide audio           and video sync for a movie. </p>        <p> When using the Video Output Clock, be sure to set the movie's clock           back to the default clock before calling <code>QTVideoOutputEnd</code>.         </p>        <P><A HREF="#top">Back to top</A></P>                        <BR><BR>                        <a name="Section9"></a>         <h2>Using the Video Output Component Clock</h2>        <p> If you want to use the Video Output Clock, call <code>SetMovieMasterClock</code>           and pass in the Video Output Clock Instance. </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>// Use the Video Output Clock as the Master Clock// Set up the video output clock after sound or it// gets set back to the default clockif (ComponentFunctionImplemented(theVOComponentInstance,                                  kQTVideoOutputGetClockSelect)) {    err = QTVideoOutputGetClock(gVOComponentInstance, &amp;theVOutClock);    if (err || NULL == theVOutClock) goto bail;    SetMovieMasterClock(myMovie, (Component)theVOutClock, NULL);}</pre>              </TD>            </TR>          </TABLE>        </CENTER>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                        <a name="Section10"></a>         <h2>Switching back to the Default Clock</h2>        <p> When choosing or switching to the Default Clock, use <code>ChooseMovieClock</code>.         </p>        <CENTER>          <TABLE BORDER=0 CELLPADDING=5 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                 <pre>// Use the default clockChooseMovieClock(myMovie, 0);</pre>              </TD>            </TR>          </TABLE>        </CENTER>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                <a name="Section11"></a>         <h2>Caveats</h2>        <p> Remember, not all sound devices have clocks, and not all video output           components have clock components associated with them, so be sure to           check. </p>        <p> <code>SetMovieMasterClock</code> and <code>ChooseMovieClock</code>           will cancel each other out; the last API called is the one that sets           the clock. </p>        <p> <code>MediaSetSoundOutputComponent</code> can change the movie master           clock. Therefore, setting the Movie Master Clock to the Video Output           Clock MUST be done after setting up the Sound Output Device or it gets           set back to the default clock. </p>        <P><A HREF="#top">Back to top</A></P>                        <BR><BR>                        <a name="Section12"></a>         <h2>Sample Code</h2>        <blockquote>           <p><a href="http://developer.apple.com/samplecode/Sample_Code/QuickTime/Capturing/SimpleVideoOut.htm" target="_blank">SimpleVideoOut</a></p>          <p><a href="http://developer.apple.com/samplecode/Sample_Code/QuickTime/Capturing/SoftVideoOutputComponent.htm" target="_blank">SoftVideoOutputComponent             / SoftCodec Transfer Codec</a></p>        </blockquote>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                <a name="References"></a>         <h2>References</h2>        <blockquote>          <p> <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/RM/rmVidOutComp.htm" target="_blank">Video             Output Components</a></p>          <p> <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/REF/refVidOutComp.16.htm" target="_blank">Transfer             Codecs for Video Output Components</a></p>          <p> <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/REF/refImageComp.7.htm" target="_blank">Accelerated             Video Support</a></p>          <p> <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/INMAC/INTROS/xxIntroductions.e.htm" target="_blank">Time             and the Movie Toolbox</a></p>          <p> <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/INMAC/QTC/imClockComp.2.htm" target="_blank">About             Clock Components</a></p>        </blockquote>        <P><A HREF="#top">Back to top</A></P>                <BR><BR>                <A NAME=Downloads></A>        <H2>Downloadables</H2>        <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">          <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>            </TD>            <td align="left">               <P>Acrobat version of this Note (52K)</P>            </TD>            <td width=60 align=left>               <P><A HREF="pdf/tn2052.pdf">Download</A></P>            </TD>          </TR>        </TABLE>        <BR>        <P><A HREF="#top">Back to top</A></P>      </TD>    </TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2052.html%3Fid%3DDTS10003083-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2052.html%3Fid%3DDTS10003083-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2052.html%3Fid%3DDTS10003083-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>