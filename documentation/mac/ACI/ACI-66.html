<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Matching Colors to Displays Using ColorSync With QuickDraw Operations</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING66></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-65.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-67.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-55.html"><B>Chapter 4 - Developing ColorSync-Supportive Applications</B></A> / <A HREF="ACI-60.html"><B>Developing Your ColorSync-Supportive Application</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING66-0></A>
<H2><A NAME=MARKER-2-99></A>Matching Colors to Displays Using ColorSync With QuickDraw Operations</H2>
 To provide your user with images and pictures showing consistent colors across displays,<A NAME=MARKER-2-69></A> your application can use the ColorSync Manager to match the colors in the user's pictures and documents with the colors available on the user's current display. If a color cannot be reproduced on the current system's display, the ColorSync Manager maps the color to the color gamut of the display according to the specifications defined by the profiles. <P>
 The ColorSync Manager provides two high-level functions that use QuickDraw that your application can call to draw a color picture to the current display. One function, <A NAME=MARKER-11-70></A><CODE>NCMDrawMatchedPicture</CODE>, uses the source profile embedded in the picture to match the picture's colors to the display's gamut defined by the system profile. The other function, <A NAME=MARKER-11-71></A><CODE>NCMBeginMatching</CODE>, uses the source and destination profiles you specify to match the colors of the source image to the colors of the device for which it is destined. <P>
 On all systems, the current display device's profile should be configured as the <A NAME=MARKER-2-72></A>system profile. The ColorSync System Profile control panel allows the user to configure the current display's profile as the system profile. Because the ColorSync Manager recognizes the system profile as that of the current display, you can specify <CODE>NULL</CODE> to indicate the system profile instead of explicitly giving a profile reference. Passing <CODE>NULL</CODE> as a profile reference to the ColorSync Manager functions directs the ColorSync Manager to use the system profile. <P>
 The following sections describe how to use these high-level matching functions, which automatically perform color matching in a manner acceptable to most applications. <A HREF=#MARKER-9-73>Listing 4-4</A> shows sample code that performs color matching to a display in different ways using the high-level functions. <P>
 However, if your application needs a finer level of control over color matching, you can use the low-level ColorSync Manager color-matching functions, described in<A HREF=ACI-68.html#MARKER-9-83>"Matching Colors Using the Low-Level Functions" (page 4-27)</A> to match the colors of a bitmap, a pixel map, or a list of colors. <P>
<A NAME=HEADING66-6></A>
<H3>Matching Colors in a Picture Containing an Embedded Profile or Profile Identifier</H3>
 If a user copies a picture that includes a profile or profile identifier into one of your application's documents, your application can use the ColorSync Manager's high-level function <CODE>NCMDrawMatchedPicture</CODE> to match the colors in that picture to the display on which you draw it. <P>
 As the picture is drawn, the <CODE>NCMDrawMatchedPicture</CODE> function automatically matches all colors to the color gamut of the display device, using the destination profile passed in the <CODE>dst</CODE> parameter. To use this function, you identify only the profile for the display device. The function acknowledges color-matching picture comments embedded in the picture and uses embedded profiles and profile identifiers. The source profile for the device on which the image was created should be embedded in the QuickDraw picture whose handle you pass to the function; the <CODE>NCMDrawMatchedPicture</CODE> function uses the embedded source profile, if it exists. If the source profile is not embedded, the function uses the current system profile as the source profile.<P>
 A picture may have more than one profile embedded, and may embed profile identifiers that refer to, and possibly modify, embedded profiles or profiles on disk. If the profiles and profile identifiers are embedded correctly, the <CODE>NCMDrawMatchedPicture</CODE> function will use them successively, as they are encountered.<P>
 By specifying <CODE>NULL</CODE> as the destination profile when you use this function, you are assured that the system profile--that is, the profile for the main screen--is used as the destination profile. Alternatively, your application can call the <CODE>CMGetSystemProfile</CODE> function to obtain a reference to the profile and specify the system profile explicitly; the portion of code that calls the <CODE>NCMDrawMatchedPicture</CODE> function in <A HREF=#MARKER-9-73>Listing 4-4</A> handles use of the system profile this way.<P>
<A NAME=HEADING66-11></A>
<H4> Considerations</H4>
 For embedded profiles (and profile identifiers) to operate correctly, the currently effective profile must be terminated by a picture comment of <CODE>kind</CODE> <CODE>cmEndProfile</CODE> after drawing operations using that profile are performed. If a picture comment was not specified to end the profile, the profile will remain in effect until the next embedded profile is introduced with a picture comment of <CODE>kind cmBeginProfile</CODE>. However, use of the next profile might not be the intended action. It is good practice to always pair use of the <CODE>cmBeginProfile</CODE> and <CODE>cmEndProfile</CODE> picture comments. When the ColorSync Manager encounters an <CODE>cmEndProfile</CODE> picture comment, it restores use of the system profile for matching until it encounters another <CODE>cmBeginProfile</CODE> picture comment.<P>
<DL>
<DT><B>Note</B>
<DD>Profile identifiers are also stored with picture comments. For more information on profile identifiers, see <A HREF=ACI-69.html#MARKER-9-91>"Embedding Profiles and Profile Identifiers" (page 4-32)</A> and <A HREF=ACI-77.html#MARKER-9-178>"Searching for a Profile That Matches a Profile Identifier" (page 4-75)</A>.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 If your application allows a user to modify an image that you color-matched using the <CODE>NCMDrawMatchedPicture</CODE> function, your application must either embed the system profile in the picture file or convert and match the colors of the modified image to the colors of the source profile. The method you choose is specific to your application.<P>
<A NAME=HEADING66-15></A>
<H3>Matching Colors as Your User Draws a Picture </H3>
 To use Color QuickDraw functions to draw a document with colors matched to a display, your application can simply use the <CODE>NCMBeginMatching</CODE> function before calling Color QuickDraw functions, and then conclude its drawing with the <CODE>CMEndMatching</CODE> function. Color QuickDraw drawing functions are described in <a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><I>Inside Macintosh: Imaging With QuickDraw</I>.</a><P>
 To use the <CODE>NCMBeginMatching</CODE> function, you must specify both the source and destination profiles. The <CODE>NCMBeginMatching</CODE> function returns a reference to the color-matching session in its myRef parameter. You then pass the reference to the <CODE>CMEndMatching</CODE> function to terminate color matching, as shown in <A HREF=#MARKER-9-73>Listing 4-4</A>. <P>
<B>Listing 4-4  <A NAME=MARKER-9-73></A>Two methods of color matching to a display</B><P>
<PRE>
void MyMatchingToDisplays (void)
{
   CMError     cmErr;
   CMProfileRefsysProf;
   CMProfileReftargProf;
   PicHandle   hPICT;
   Rect        rcPICT;
   CMMatchRef  matchRef;
   /* use the system profile as the destination profile for the
      NCMDrawMatchedPicture function */
   cmErr = MyGetPict(&amp;hPICT, &amp;rcPICT);
   if (cmErr == noErr)
   {
      cmErr = CMGetSystemProfile(&amp;sysProf);
   }
   if (cmErr == noErr)
   {
      NCMDrawMatchedPicture(hPICT, sysProf, &amp;rcPICT);
      
      KillPicture(hPICT);
      (void) CMCloseProfile(sysProf);
   }
   /* use the system profile as the source profile and another profile as the
   destination profile for the NCMBeginMatching and CMEndMatching functions */
   cmErr = CMGetSystemProfile(&amp;sysProf);

   if (cmErr == noErr)
   {
      cmErr = MyGetImageTargetProfile(&amp;targProf);
   }

   if (cmErr == noErr)
   {
      cmErr = NCMBeginMatching(sysProf, targProf, &amp;matchRef);
      (void) CMCloseProfile(sysProf);
      (void) CMCloseProfile(targProf);
   }

   if (cmErr == noErr)
   {
      MyDoDrawing();

      CMEndMatching(matchRef);
   }  
}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-65.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-67.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
