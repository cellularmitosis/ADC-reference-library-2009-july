<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note QD535: Picture Utility Q&amp;As</title><meta name="keywords" content="Mac OS 8 Picture Utilities package quickdraw questions GetPictInfo"><meta name="Description" content="Technical Note QD535: This Technical Note contains a collectionof archived Q&amp;As relating to Picture Utilities--questionssent the Developer Support Center (DSC) along with answersfrom the DSC engineers. Archived Q&amp;As include: GetPictInfoand QuickTime compressed PICT files; NewPalette doesn't useCTab2Palette to create a palette; Spooling PixMaps to disk;and Getting the color usage from a picture under System 6.">                                       <meta name="categories" content="QuickDraw"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002741" title="Picture Utility Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QD535</div>
<div id="pageheadsub">Picture Utility Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;As can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><H2>GetPictInfo and QuickTime compressed PICT files</h2><p>Date Written:  2/24/92</p><p>Last reviewed:  8/1/92</p><p>Is it my imagination, or does <code>GetPictInfo</code> return a bit depth of 1 on QuickTimecompressed PICT files?</p><p>Yep! This is what's happening: The Picture Utilities Package doesn't know ofthe QuickTime Compressed Pixmap opcode (0x8200), so it just skips over the opcode's data; then it finds the <code>PacksBitRect</code> opcode containing the black-and-white pseudo-alert that you get when you draw the picture on a machine that doesn't have QuickTime installed, and <code>GetPictInfo</code> reports back this alert.</p><p>Trivia: When QuickTime is installed, it displays the compressed image and thenignores the following <code>PacksBitRect</code> since QuickTime knows it's only the black-and-white alert.</p><P><A HREF="#top">Back to top</A></p><H2>NewPalette doesn't use CTab2Palette to create a palette</h2><p>Date Written:  3/12/92</p><p>Last reviewed:  6/14/93</p><p>I'm using the Picture Utilities Package to extract the color table from apicture. After getting the color table, I use <code>NewPalette</code> to construct a palettefrom the color table (usage = tolerant, tolerance = 0). After I do this, theRGB values in the palette don't always exactly match the RGB values in thesource color table, causing my program to fail. If I use <code>NewPalette</code> without asource color table, and then use <code>CTab2Palette</code> to copy the colors over (againwith usage = tolerant, tolerance = 0), the colors match exactly.</p><p>It turns out that NewPalette doesn't use <code>CTab2Palette</code>, but copies the RGBfields in a strange way that's causing the problems you're seeing. NewPalettecopies the high byte in each color table RGB entry into both the high byte andthe low byte of the corresponding palette entry. Thus, if the color table entryfor red was $F000, it becomes $F0F0. This of course makes no difference toQuickDraw since the low byte isn't displayed, but if your program expects thelow byte to match, that's where your problem exists. <code>CTab2Palette</code> is different,in that it doesn't copy the high byte into the low byte unless the pmAnimatedbit is set.</p><p>The best solution for your code isn't to compare the entire RGB value whencomparing colors, but rather to compare the high byte of each RGB componentseparately. If this isn't possible, the next best solution is for you to usethe workaround that you've already discovered with CTab2Palette.</p><p>It's unlikely that the Palette Manager is going to change in the future forsomething like this. In fact, we would almost call it a "feature" since otherdevelopers may even depend on it.</p><P><A HREF="#top">Back to top</A></p><H2>Spooling PixMaps to disk</h2><p>Date Written:  6/10/91</p><p>Last reviewed:  10/22/91</p><p>Do you have sample code for spooling <code>PixMaps</code> to disk in PICT format? Should Iwrite the PICT opcodes to the file myself?</p><p>Apple recommends that you do not try to write the PICT opcodes yourself.Instead, replace the <code>PutPicProc</code> bottleneck proc, as shown in the ColorQuickDraw chapter of <i>Inside Macintosh</i> Volume V on page V-89.</p><p>Two additional samples can be found in the sample code contained in theDeveloper CDs. Look for: "Tools &amp; Apps: Graphics and Imaging: PICT Stuff."One is a program and the other is an FKEY; both dump the main screen to disk asa PICT. The FKEY is a more complete sample in the sense that it works in blackand white as well as Macintosh color computers, but the other is a smaller andsimpler sample.</p><P><A HREF="#top">Back to top</A></p><H2>Getting the color usage from a picture under System 6</h2><p>Date Written:  6/8/92</p><p>Last reviewed:  9/15/92</p><p>Do you know how I can obtain the color table of a picture when using a systemversion that happens to be less than 7.0? The Picture Utilites package seems to be only implemented in System 7.0.</p><p>You're correct; the Picture Utilities package is implemented only under System 7. However, it's possible to write code to duplicate its functionality under System 6. Basically, what you wantto do is parse a picture, looking at the colors used for the different objects. How you deal with the colors is up to you.</p><p>What you do is replace the QuickDraw bottlenecks in a <code>GrafPort</code> with proceduresof your own; in all the bottlenecks for QuickDraw primitives, you can just record the current color as having been used for an object. When you get a <code>StdBits</code> opcode, you'll have to parse the pixmaps, looking through the image and recording all the colors used. As a shortcut, you could just record all the colors in the color table of the pixmap,if it's an indexed pixel image. After collecting this list of colors and any information on how often they are used, it's up to you to boil this down into useful information, depending on how you want to use it.</p><a name="Downloads"></a>         <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (44K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qd_535.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qd/qd_535.html%3Fid%3DDTS10002741-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qd/qd_535.html%3Fid%3DDTS10002741-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qd/qd_535.html%3Fid%3DDTS10002741-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>