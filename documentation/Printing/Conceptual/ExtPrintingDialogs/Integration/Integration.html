<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Extending Printing Dialogs: Integration Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Integration Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000979-CH208" title="Integration Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000432" target="_top">Printing</a> &gt; <a href="../../../Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP30000432-TP30000494" target="_top">Carbon</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30000979-CH201-TP9">Extending Printing Dialogs</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Custom/Custom.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Utilities/Utilities.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000979-CH208-TP9" title="Integration Tasks"></a><h1>Integration Tasks</h1><p>Your printing dialog extension is taking shape, and now you’re wondering how to integrate it with your other software. This chapter shows you how applications and printer modules deploy and communicate with their printing dialog extensions.</p><p>The first two sections <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-TPXREF169">“Integrating With an Application”</a></span> and <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-TPXREF168">“Integrating With a Printer Module”</a></span> describe tasks that include installation, localization, and registration.</p><p>The last section <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-TPXREF174">“Accessing Ticket Data”</a></span> desribes data communication tasks.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF169" title="Integrating With an Application"></a><h2>Integrating With an Application</h2><p>A printing dialog extension hosted by an application should be packaged inside the application bundle, and should be localized for the same languages and regions as the application. The host and plug-in share settings data using several different printing APIs.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF170" title="Installation"></a><h3>Installation</h3><p>You should install an application-hosted printing dialog extension somewhere inside the application bundle.</p><p>If you want to locate the plug-in at runtime using the function <code>CFBundleCopyBuiltInPlugInsURL</code>, you should install it inside a subfolder named PlugIns, as illustrated in <span class="content_text">Figure 7-1</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000979-CH208-BCICEDJH" title="Figure 7-1A plug-in installed inside an application bundle"></a><p><strong>Figure 7-1&nbsp;&nbsp;</strong>A plug-in installed inside an application bundle</p><img src = "../Art/app_bundle.gif" alt = "A plug-in installed inside an application bundle" width="583" height="256"></div><br/><p>In the sample project, the target AppUsingSheets has a build phase called Copy Files that installs the plug-in in this manner.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF176" title="Localization"></a><h3>Localization</h3><p>If you localize a printing dialog extension for a specific language or region, make sure the application has an <code>.lproj</code> directory for the same locale.</p><p>For example, the application bundle in <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-BCICEDJH">Figure 7-1</a></span> contains directories named <code>English.lproj</code> for both the application and the printing dialog extension.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF171" title="Registration"></a><h3>Registration</h3><p>An application needs to register its printing dialog extension with Core Foundation Plug-in Services. Registration should be done once, prior to displaying the printing dialog for the first time.</p><p><span class="content_text">Listing 7-1</span> implements a function that an application can use to register a printing dialog extension.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF162" title="Listing 7-1Locating and registering a printing dialog extension"></a><p class="codesample"><strong>Listing 7-1&nbsp;&nbsp;</strong>Locating and registering a printing dialog extension</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyRegisterPDE (CFStringRef plugin)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = kPMInvalidPDEContext;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFURLRef pluginsURL = CFBundleCopyBuiltInPlugInsURL (<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        CFBundleGetMainBundle());<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (pluginsURL != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFURLRef myPluginURL = CFURLCreateCopyAppendingPathComponent (<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            pluginsURL,<span></span></pre></td></tr><tr><td scope="row"><pre>            plugin,<span></span></pre></td></tr><tr><td scope="row"><pre>            false);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (myPluginURL != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            if (CFPlugInCreate (NULL, myPluginURL) != NULL) {<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            CFRelease (myPluginURL);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease (pluginsURL);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing 7-1</span> does:</p><ol class="ol"><li class="li"><p>Receives a string that names a printing dialog extension bundle, such as <code>"PDEPrint.plugin"</code>.</p></li><li class="li"><p>Gets a Core Foundation URL that specifies the location of the folder that contains the bundle.</p></li><li class="li"><p>Appends the bundle name to this URL, and returns a new URL—a fully qualified path to the printing dialog extension.</p></li><li class="li"><p>Registers the plug-in with Core Foundation Plug-in Services. The function <code><a href="../../../../CoreFoundation/Reference/CFPlugInRef/Reference/reference.html#//apple_ref/doc/c_ref/CFPlugInCreate" target="_top">CFPlugInCreate</a></code> takes two arguments—an optional allocation function, and a fully qualified path.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000979-CH208-DontLinkElementID_15" title="Note"></a><p><strong>Note:</strong>&nbsp; In this example, the CFPlugIn object returned by <code>CFPlugInCreate</code> is never explicitly released.</p></div><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF173" title="Data Retrieval"></a><h3>Data Retrieval</h3><p>All printing dialog extensions store their private settings data in a job ticket, as described in <span class="content_text"><a href="../Custom/Custom.html#//apple_ref/doc/uid/TP30000979-CH207-TPXREF130">“Synchronizing User Settings With a Ticket.”</a></span> Because applications do not have direct access to tickets, a host application must query a <code>PMPageFormat</code> or <code>PMPrintSettings </code>object to retrieve the data.</p><p>The section <span class="content_text"><a href="../Custom/Custom.html#//apple_ref/doc/uid/TP30000979-CH207-TPXREF170">“Defining Custom Ticket Keys”</a></span> explains how an application-hosted printing dialog extension needs to define the keys it uses to store its extended data in a ticket. To retrieve this data later, an application must supply the same 4-byte code found at the end of the ticket key. For example, if the ticket key ends with <code>PRDX</code> then the application must use the 4-byte code<code> PRDX</code>. The bytes must be ASCII characters in the range 0x20-0x7F.</p><p><span class="content_text">Listing 7-2</span> illustrates how an application retrieves data from a <code>PMPrintSettings</code> object.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-BCIHHAEJ" title="Listing 7-2Retrieving extended data from a print settings ticket"></a><p class="codesample"><strong>Listing 7-2&nbsp;&nbsp;</strong>Retrieving extended data from a print settings ticket</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyGetPDEData (<span></span></pre></td></tr><tr><td scope="row"><pre>    PMPrintSettings printSettings,<span></span></pre></td></tr><tr><td scope="row"><pre>    MySettings *mysettingsP<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 bufferSize = sizeof(*mysettingsP);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    UInt32 extendedDataSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    result = PMGetPrintSettingsExtendedData (<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                printSettings,<span></span></pre></td></tr><tr><td scope="row"><pre>                kMyBundleCreatorCode, <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                &amp;extendedDataSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPMDontWantData);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (result == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (bufferSize == extendedDataSize)<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            result = PMGetPrintSettingsExtendedData (<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                printSettings,<span></span></pre></td></tr><tr><td scope="row"><pre>                kMyBundleCreatorCode,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPMDontWantSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                mysettingsP);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            result = kPMInvalidPDEContext;<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing 7-2</span> does:</p><ol class="ol"><li class="li"><p>Declares an integer whose value is the expected number of bytes.</p></li><li class="li"><p>Checks for the existence of your extended data. On return, <code>bufferSize</code> contains the actual number of bytes of extended data in the ticket.</p></li><li class="li"><p>Provides the 4-byte code used to find the data.</p></li><li class="li"><p>Checks to see if the actual byte count is equal to the expected byte count. If so, the ticket contains your data.</p></li><li class="li"><p>Copies the data directly into the caller’s buffer.</p></li><li class="li"><p>Sets the result code to indicate an exception. Another course of action might be to return default settings.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF168" title="Integrating With a Printer Module"></a><h2>Integrating With a Printer Module</h2><p>For printing dialog extensions hosted by printer modules, the integration tasks are conceptually similar to those discussed in <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-TPXREF169">“Integrating With an Application.”</a></span> However, there are some important differences in the way these tasks are performed.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF175" title="Installation"></a><h3>Installation</h3><p>The Mac OS X printing system expects all printer modules, and their printing dialog extensions, to reside in <code>/Library/Printers/</code> or in one of its subfolders. For housekeeping purposes, printer vendors generally place all their vendor-specific files in a subfolder.</p><p>If a printing dialog extension is used by a single printer module, it’s a good idea to install it in a PlugIns folder inside the printer module bundle.</p><p>Custom printing dialog extensions that implement PostScript features should reside in <code>/Library/Printers/PPD Plugins</code>/. For more information about using printing dialog extensions to implement PostScript features, see <span class="content_text"><a href="../Project/Project.html#//apple_ref/doc/uid/TP30000979-CH205-CJBBDDGH">“Registering PPD Main Keywords”</a></span> and <span class="content_text"><a href="../Custom/Custom.html#//apple_ref/doc/uid/TP30000979-CH207-CACBHDBD">“Handling PostScript Features.”</a></span></p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF177" title="Registration"></a><h3>Registration</h3><p>At runtime, the printing system asks a printer module for the location of each of its printing dialog extensions relative to the base path <code>/Library/Printers/</code>. </p><p>All printer modules must supply a callback function of type <code>PMCreatePrintingDialogExtensionsPathsProcPtr</code> that provides these locations. The printing system calls this function after it loads your printer module.</p><p>With this information, the printing system performs two important services:</p><ul class="spaceabove"><li class="li"><p>It registers each extension with Core Foundation Plug-in Services.</p></li><li class="li"><p>It remembers the custom extensions that must be loaded for the default printer when the Print dialog is displayed.</p></li></ul><p><span class="content_text">Listing 7-3</span> shows how to write a function that creates an empty array, inserts a single path expression, and passes the array to the printing system.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-BCIIBICI" title="Listing 7-3Providing the locations of the printing dialog extensions hosted by a printer module"></a><p class="codesample"><strong>Listing 7-3&nbsp;&nbsp;</strong>Providing the locations of the printing dialog extensions hosted by a printer module</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyCreatePrintingDialogExtensionsPaths<span></span></pre></td></tr><tr><td scope="row"><pre>(<span></span></pre></td></tr><tr><td scope="row"><pre>    PMContext pmContext,<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayRef *pdePaths<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableArrayRef cfArray = CFArrayCreateMutable (<span></span></pre></td></tr><tr><td scope="row"><pre>        CFAllocatorGetDefault(), 0, &amp;kCFTypeArrayCallBacks);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( cfArray != NULL &amp;&amp; pdePaths != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFArrayAppendValue (cfArray,<span></span></pre></td></tr><tr><td scope="row"><pre>            CFSTR("MyPrinterCo/PrintQuality.plugin"));<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        status = memFullErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *pdePaths = cfArray;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    return (status);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing 7-3</span> does:</p><ol class="ol"><li class="li"><p>Creates a mutable array of variable size with zero entries. Core Foundation arrays may contain references to mixed types, but in this case the printing system expects an array of strings.</p></li><li class="li"><p>Appends to the array a relative path expression—note the absence of a leading <code>"/"</code>. The implied full path specifies the location of a custom printing dialog extension that’s associated with this printer module.</p></li><li class="li"><p>Passes the array back to the printing system, which is responsible for releasing the array and its contents when it is no longer needed.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF172" title="Data Retrieval"></a><h3>Data Retrieval</h3><p>Printer modules have direct access to tickets, and can easily find the printer settings placed there by printing dialog extensions.</p><p>For each ticket item, the printer module and its printing dialog extension must agree on the ticket type, the key, and the data type of the item. This agreement ensures that the printer module can locate and retrieve its data.</p><p>The section <span class="content_text"><a href="../Custom/Custom.html#//apple_ref/doc/uid/TP30000979-CH207-TPXREF170">“Defining Custom Ticket Keys”</a></span> explains how ticket keys for data items that represent custom printing features are defined.</p><p>The section <span class="content_text"><a href="Integration.html#//apple_ref/doc/uid/TP30000979-CH208-TPXREF143">“Getting a Ticket Value”</a></span> explains in greater detail how printer modules retrieve data from a ticket.</p><p>Mac OS X applications can print without using dialogs, so your printing dialog extension might never get called. Consequently, printer modules should be prepared to handle missing ticket items and supply appropriate default values as needed.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000979-CH208-DontLinkElementID_16" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X version 10.2 and later, printing dialog extensions that use tickets to pass data to a printer module are limited to the following Core Foundation base types to represent the data—CFString, CFBoolean, CFDictionary, CFNumber (integer only), and CFArray.</p></div><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF174" title="Accessing Ticket Data"></a><h2>Accessing Ticket Data</h2><p>This section explains how printing plug-ins—including printing dialog extensions—can access their custom data in a ticket.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF144" title="Setting a Ticket Value"></a><h3>Setting a Ticket Value</h3><p>Ticket Services provides a number of functions for setting items in a ticket based on the item’s data type, such as <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketSetSInt32" target="_top">PMTicketSetSInt32</a></code> and <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketSetCFString" target="_top">PMTicketSetCFString</a></code>. You should use the appropriate <code>PMTicketSet</code> function for the data type you are setting.</p><p>If you call the appropriate <code><!--a-->PMTicketSet<!--/a--></code>function and the item does not exist, a new one is added to the ticket. If the item already exists, its value is updated. If the item is locked and can’t be updated, the status <code>kPMItemIsLocked</code> is returned. Items can be locked by clients. You can check the locked state of a ticket by calling the function <code>PMTicketGetLockedState.</code></p><p>The first four parameters of every <code><!--a-->PMTicketSet<!--/a--></code> function are the following:</p><ol class="ol"><li class="li"><p>The ticket (<code>PMTicketRef</code>) in which to put the data.</p></li><li class="li"><p>A string (<code>CFStringRef</code>) that specifies the client ID.</p><p>You should provide a string that uniquely identifies your plug-in, such as its bundle identifier.</p></li><li class="li"><p>A string (<code>CFStringRef</code>) that specifies the key for this ticket item.</p><p>When available, you should provide one of the keys defined in the Carbon Printing Manager for ticket items. If you supply a custom key, you should avoid using the same key in different parts of the job ticket. Otherwise, you may not be able to retrieve the item later, due to the search semantics. The ticket is searched from the job ticket level down (page format, print settings, and so forth). <code><!--a-->PMTicketGet<!--/a--></code>functions return the value for the first instance of the key. </p></li><li class="li"><p>The item data.</p><p>The last parameter to every <code><!--a-->PMTicketSet<!--/a--></code> function is a <code>Boolean</code> that specifies whether the item is locked (<code>TRUE</code>) or unlocked (<code>FALSE</code>).</p></li></ol><p><span class="content_text">Listing 7-4</span> shows how to use a <code>PMTicketSet</code> function to insert or update an item (a key-value pair) in a ticket. In this case, the item is unlocked (<code>kPMUnlocked</code>) and the client setting the item is identified by the constant <code>kMyPrinterModuleID</code>.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-BCIJEJDJ" title="Listing 7-4Setting an integer value in a ticket"></a><p class="codesample"><strong>Listing 7-4&nbsp;&nbsp;</strong>Setting an integer value in a ticket</p><div class="codesample"><table><tr><td scope="row"><pre>#define kMyPrinterModuleID CFSTR("com.mycompany.myprintermodule")<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = PMTicketSetSInt32 (<span></span></pre></td></tr><tr><td scope="row"><pre>    ticketRef,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMyPrinterModuleID,<span></span></pre></td></tr><tr><td scope="row"><pre>    kPMQualityKey,<span></span></pre></td></tr><tr><td scope="row"><pre>    qualityValue,<span></span></pre></td></tr><tr><td scope="row"><pre>    kPMUnlocked<span></span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF143" title="Getting a Ticket Value"></a><h3>Getting a Ticket Value</h3><p>As a convenience for developers, Ticket Services provides a number of <code></code><code>PMTicketGet</code> functions for specific types of ticket data—for example, <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketGetSInt32" target="_top">PMTicketGetSInt32</a></code> and <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketGetCFString" target="_top">PMTicketGetCFString</a></code>. You can also use the generic function <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketGetItem" target="_top">PMTicketGetItem</a></code>.</p><p>The first four parameters of every <code><!--a-->PMTicketGet<!--/a--></code> function specify</p><ul class="spaceabove"><li class="li"><p>the ticket reference (<code>PMTicketRef</code>)</p></li><li class="li"><p>the document number (<code>UInt32</code>) associated with the item</p></li><li class="li"><p>the page number (<code>UInt32</code>) associated with the item</p></li><li class="li"><p>the lookup key (<code>CFStringRef</code>) for the item</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP30000979-CH208-DontLinkElementID_17" title="Note"></a><p><strong>Note:</strong>&nbsp; Ticket Services currently does not use the document and page parameters. Instead, you should pass the constant <code>kPMTopLevel</code> for each parameter.</p></div><p>The other parameters in a <code><!--a-->PMTicketGet<!--/a--></code> function are specific to the data you are fetching. You need to specify a pointer to the storage for the data to be fetched by the function.</p><p><span class="content_text">Listing 7-5</span> shows how a printing dialog extension hosted by a printer module can get a <code>CFString</code> value stored in a print settings ticket.</p><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF145" title="Listing 7-5Getting a CFString value in a print settings ticket"></a><p class="codesample"><strong>Listing 7-5&nbsp;&nbsp;</strong>Getting a <code>CFString</code> value in a print settings ticket</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef myCFString;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = PMTicketGetCFString (printSettingsTicket,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMTopLevel,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMTopLevel,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kMyTicketKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myCFString);<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 7-6</span> shows how to retrieve the unadjusted paper rectangle from a paper info ticket that’s inside a print settings ticket. First, you need to call the function <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketGetTicket" target="_top">PMTicketGetTicket</a></code> to retrieve the paper info ticket from the print settings ticket. If there isn’t an error when you retrieve the paper info ticket, use the function <code><a href="../../../Reference/TicketServices_Ref/Reference/reference.html#//apple_ref/doc/c_ref/PMTicketGetPMRect" target="_top">PMTicketGetPMRect</a></code> to get the value. </p><a name="//apple_ref/doc/uid/TP30000979-CH208-BCIJCGFB" title="Listing 7-6Getting the unadjusted page rectangle in a paper info ticket"></a><p class="codesample"><strong>Listing 7-6&nbsp;&nbsp;</strong>Getting the unadjusted page rectangle in a paper info ticket</p><div class="codesample"><table><tr><td scope="row"><pre>PMRect unadjustedPage;<span></span></pre></td></tr><tr><td scope="row"><pre>PMTicketRef paperInfoTicket = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = PMTicketGetTicket (printSettingsTicket,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMPaperInfoTicket,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMTopLevel,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;paperInfoTicket);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if (result == noErr &amp;&amp; paperInfoTicket != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        result = PMTicketGetPMRect (paperInfoTicket,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMTopLevel,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMTopLevel,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPMUnadjustedPageRectKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;unadjustedPage);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000979-CH208-TPXREF34" title="Further Reading"></a><h3>Further Reading</h3><p>For more information about the functions in Ticket Services, see <em><a href="../../../Reference/TicketServices_Ref/index.html#//apple_ref/doc/uid/TP30000980" target="_top">Ticket Services Reference</a></em>.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Custom/Custom.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Utilities/Utilities.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-10-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Integration/Integration.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Integration/Integration.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Integration/Integration.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>