<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Tree-Based XML Programming Guide for Cocoa: Creating an XML Document Object</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating an XML Document Object"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001255" title="Creating an XML Document Object"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DataManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000445" target="_top">Data Management</a> &gt; <a href="../index.html" target="_top">Tree-Based XML Programming Guide for Cocoa</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="NSXMLDataModel.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="WritingXML.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40001255-BCIGHBDI" title="Creating an XML Document Object"></a><hr /><H1>Creating an XML Document Object</H1><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_81"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_82"></a><p>You can create an object representing an XML document—that is, an instance of NSXMLDocument—in one of two general ways. Using NSXML, you can either parse an XML source and create a tree structure representative of the contents, or you can create an XML document programmatically.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="CreatingXMLDoc.html#//apple_ref/doc/uid/TP40001255-96843-BCICACAD">Creating a Document Object From Existing XML</a>
				
			<br/>
			
        
			
			
				<a href="CreatingXMLDoc.html#//apple_ref/doc/uid/TP40001255-96936">Creating a New XML Document</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001255-96843" title="Creating a Document Object From Existing XML"></a><a name="//apple_ref/doc/uid/TP40001255-96843-BCICACAD" title="Creating a Document Object From Existing XML"></a><h2>Creating a Document Object From Existing XML</h2><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_83"></a><p>The NSXMLDocument<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_84"></a> class lets you create a document instance from XML markup text in one of several forms: as a string object, as an NSData object, and as a URL-designated file (remote or local). The following initializers of NSXMLDocument (corresponding to these forms) also include parameters for input-handling options and for obtaining information about initialization errors:</p><ul class="simple"><li><p><code>initWithXMLString:options:error:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_85"></a></code></p></li><li><p><code>initWithData:options:error:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_86"></a></code></p></li><li><p><code>initWithContentsOfURL:options:error:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_87"></a></code></p></li></ul><p><span class="content_text">Listing 1</span> shows how you might create an NSXMLDocument instance from an absolute path to a local XML file. </p><a name="//apple_ref/doc/uid/TP40001255-102246-BCIHFGAB" title="Listing 1Creating a document from a file URL (local file)"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001255-102246" title="Listing 1Creating a document from a file URL (local file)"></a><strong>Listing 1&nbsp;&nbsp;</strong>Creating a document from a file URL (local file)</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)createXMLDocumentFromFile:(NSString *)file {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSXMLDocument *xmlDoc;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSError *err=nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSURL *furl = [NSURL fileURLWithPath:file];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!furl) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLog(@"Can't create an URL from file %@.", file);<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlDoc = [[NSXMLDocument alloc] initWithContentsOfURL:furl<span></span></pre></td></tr><tr><td scope="row"><pre>            options:(NSXMLNodePreserveWhitespace|NSXMLNodePreserveCDATA)<span></span></pre></td></tr><tr><td scope="row"><pre>            error:&amp;err];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (xmlDoc == nil) {<span></span></pre></td></tr><tr><td scope="row"><pre>        xmlDoc = [[NSXMLDocument alloc] initWithContentsOfURL:furl<span></span></pre></td></tr><tr><td scope="row"><pre>                    options:NSXMLDocumentTidyXML<span></span></pre></td></tr><tr><td scope="row"><pre>                    error:&amp;err];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (xmlDoc == nil)  {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (err) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [self handleError:err];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (err) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [self handleError:err];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If initialization<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_88"></a> fails, the NSXMLDocument <code>init</code> method directly returns <code>nil</code> and most likely returns by indirection an NSError<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_89"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_90"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_91"></a> reporting a parsing or connection error. If failure is due to a parsing error, you can try to recover (as in <span class="content_text">Listing 1</span>) by initializing the document with the <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentTidyXML" target="_top">NSXMLDocumentTidyXML</a></code> option; this option reformats the document prior to parsing to ensure that it is well-formed. However, it does have side effects, such as removing leading and trailing spaces; see the NSXMLDocument reference documentation for details.</p><p>If an NSXMLDocument <code>init</code> method indirectly returns an NSError object in its third parameter, you can display an alert dialog to inform the user about the error. However, NSError objects created for parsing errors or warnings might not contain much helpful information. Most NSError objects encapsulate errors or warnings emitted by the parser when documents are not well-formed; these can also be connection errors from attempts to access XML at a remote locations using <code>initWithContentsOfURL:options:error:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_92"></a></code>.</p><p>You set initialization<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_93"></a> options in the second parameter of the three NSXMLDocument initializers discussed above; if you want to specify multiple options, use a bitwise-OR expression. The initialization options cover three categories of input-handling:</p><ul class="ul"><li class="li"><p><strong>Preservation<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_94"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_95"></a></strong>. The <code>enum</code> constants beginning with <code>NSXMLNodePreserve</code> support document fidelity. They allow you to ensure that aspects of the string XML input—for instance, quoting style of attribute values, CDATA sections, attribute and namespace order—remain the same when XML text is written out from the NSXMLDocument object. If you do not specify a preservation option for an aspect, NSXMLDocument handles it in a predetermined manner. For example, when NSXMLDocument reads in and parses an XML document, it normally strips white-space characters used in formatting (including tabs and carriage returns); however, if you specify <code><a href="../../../Reference/Foundation/Classes/NSXMLNode_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLNodePreserveWhitespace" target="_top">NSXMLNodePreserveWhitespace</a></code> these characters are kept hidden in the internal representation of the XML document. (“Hidden” means the white-space characters are retained for the output of the document, but are not visible within the tree representation.) Note that white space in text nodes is always preserved, and is not affected by the <code><a href="../../../Reference/Foundation/Classes/NSXMLNode_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLNodePreserveWhitespace" target="_top">NSXMLNodePreserveWhitespace</a></code> option.</p></li><li class="li"><p><strong>Tidiness<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_96"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_97"></a></strong>. The <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentTidyHTML" target="_top">NSXMLDocumentTidyHTML</a></code><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_98"></a> and <code>NSXMLDocumentTidyXML </code><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_99"></a> options correct any malformed parts of a source HTML or XML document, respectively, before creating the internal representation of the document. Tidying maintains document content, but not necessarily maintain white space or the order of constructs in the document. Entities and character references are always resolved to their text or unicode character.If the source is HTML and <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentTidyHTML" target="_top">NSXMLDocumentTidyHTML</a></code> is specified, NSXMLDocument attempts to convert it to XHTML<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_100"></a>; corrections take into account the HTML context. If the source is XML and <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentTidyXML" target="_top">NSXMLDocumentTidyXML</a></code> is specified, NSXMLDocument attempts to fix any defects to make it well-formed.</p></li><li class="li"><p><strong>Validation<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_101"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_102"></a></strong>. The <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentValidate" target="_top">NSXMLDocumentValidate</a></code><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_103"></a> option validates the source XML document against its associated schema. That schema can be defined through a DTD (internal or external) or XML Schema<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_104"></a>. The validator reports reasons for document invalidity indirectly through the NSError parameter. To validate against an XML Schema, you must identify the schema document through a combination of namespace, <code>xmlns:xsi</code>, and <code>xsi:schemaLocation</code> attribute declarations in the root element. The URI value of the namespace must match one of the values in the location-namespace tuples in the <code>xsi:schemaLocation</code> declaration. Here is an example:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;MyRootElement xmlns="http://www.example.com/foo"<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<span></span></pre></td></tr><tr><td scope="row"><pre>    xsi:schemaLocation=<span></span></pre></td></tr><tr><td scope="row"><pre>        "http://www.example.com/foo http://www.example.com/foo.xsd<span></span></pre></td></tr><tr><td scope="row"><pre>        http://www.w3.org/1999/xhtml http://www.w3.org/1999/xhtml.xsd"><span></span></pre></td></tr></table></div><p>For information on how you specify the location of schema definitions on the web, see the W3C XML Schema recommendation (<span class="content_text"><a href="http://www.w3.org/TR/xmlschema-1/" target="_blank">http://www.w3.org/TR/xmlschema-1/</a></span>). A schema should be physically installed on a Mac OS X system at <code>/System/Library/Schemas/</code><em>elementName</em><code>.xsd</code>.</p></li><li class="li"><p><strong>XInclude<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_105"></a></strong>. If the <code><a href="../../../Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSXMLDocumentXInclude" target="_top">NSXMLDocumentXInclude</a></code><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_106"></a> option is specified, the parser replaces <code>xsi:include</code> elements that refer to other XML documents (or parts of documents) with the referenced content. By default this option is turned on so your application can query and edit the nodes that define inclusions.</p></li></ul><p>These <code>enum</code> constants are defined in <code>NSXMLNodeOptions.h</code>. For specific information about the initialization options, check the reference documentation for NSXMLDocument.</p><a name="//apple_ref/doc/uid/TP40001255-96936" title="Creating a New XML Document"></a><h2>Creating a New XML Document</h2><p>Sometimes you might want to create an XML document that is entirely new, without there being any original source file or website page. You may want to manipulate all of the nodes in a tree structure—adding, removing, and relocating them—and let NSXML take care of the formatting details when the document is written to a file. </p><p>The <code>initWithRootElement:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_107"></a></code> initializer of NSXMLDocument<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_108"></a> allows you to do this. An NSXMLDocument object has two defining kinds of data: a set of document-global attributes<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_109"></a> and a root element. Once you have the root element<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_110"></a> you can construct the rest of the document’s tree representation by adding child nodes of various types to parent nodes at various levels.</p><p><span class="content_text">Listing 2</span> shows an example of creating a brand-new XML document object.</p><a name="//apple_ref/doc/uid/TP40001255-97194-BCIDBBGI" title="Listing 2Creating an NSXMLDocument instance representing a new document"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001255-97194" title="Listing 2Creating an NSXMLDocument instance representing a new document"></a><strong>Listing 2&nbsp;&nbsp;</strong>Creating an NSXMLDocument instance representing a new document</p><div class="codesample"><table><tr><td scope="row"><pre>NSXMLElement *root =<span></span></pre></td></tr><tr><td scope="row"><pre>    (NSXMLElement *)[NSXMLNode elementWithName:@"addresses"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSXMLDocument *xmlDoc = [[NSXMLDocument alloc] initWithRootElement:root];<span></span></pre></td></tr><tr><td scope="row"><pre>[xmlDoc setVersion:@"1.0"];<span></span></pre></td></tr><tr><td scope="row"><pre>[xmlDoc setCharacterEncoding:@"UTF-8"];<span></span></pre></td></tr><tr><td scope="row"><pre>[root addChild:[NSXMLNode commentWithStringValue:@"Hello world!"]];<span></span></pre></td></tr></table></div><p>This fragment of code uses methods of NSXMLDocument to set the <code>version<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_111"></a></code> and <code>encoding<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_112"></a></code> attributes of the XML declaration of the document. You could also set the standalone, URI<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_113"></a>, and MIME-type attributes using the corresponding NSXMLDocument “setter” methods. You may associate a Document Type Definition with the NSXMLDocument object through the <code>setDTD:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_114"></a></code> method. NSXMLDocument also allows you to specify the document’s output format (using <code>setDocumentContentKind:<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_115"></a></code>) as HTML, XHTML, text, or (the default) XML. For example, the following lists the different handlings of the <code>&lt;br></code> element:</p><ul class="ul"><li class="li"><p>XML: <code>&lt;br>&lt;/br></code></p></li><li class="li"><p>XHTML: <code>&lt;br /></code></p></li><li class="li"><p>HTML: <code>&lt;br></code></p></li><li class="li"><p>Plain text: nothing</p></li></ul><p>Once you create an XML document object and set its attributes, you can start adding content to it—that is, the elements, attributes, and other nodes that make up an XML document—through the appropriate methods of NSXMLElement<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_116"></a> and NSXMLNode<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_117"></a>.<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_118"></a><a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_119"></a></p><p>If the XML document has a schema associated with it—defined either with a DTD or XML Schema<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_120"></a> —you might want to validate<a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_121"></a> the document periodically. To validate a document, send the <code>validateAndReturnError: <a name="//apple_ref/doc/uid/TP40001255-DontLinkElementID_122"></a></code> message to the NSXMLDocument object. If the operation is not valid, the method returns <code>NO</code>; the reasons for invalidity are returned by indirection in the method’s NSError parameter.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="NSXMLDataModel.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="WritingXML.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/NSXML_Concepts/Articles/CreatingXMLDoc.html%3Fid%3DTP40001269-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/NSXML_Concepts/Articles/CreatingXMLDoc.html%3Fid%3DTP40001269-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/NSXML_Concepts/Articles/CreatingXMLDoc.html%3Fid%3DTP40001269-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
