<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note DV505: CD-ROM Q&amp;As</title><meta name="keywords" content="Mac OS 8 CD-ROM drivers File Sharing dirNFErr foreign access"><meta name="Description" content="Technical Note DV505: This Technical Note contains a collectionof archived Q&amp;As relating to CD-ROMs--questions sent theDeveloper Support Center (DSC) along with answers from theDSC engineers. Archived questions include CD-ROM driversand Foreign File Access, reading audio data off an audioCD, reading single-session photo CDs, File-Sharing, identifyinga CD_ROM in the volume queue, removing invalid boot blocks,and discerning the cause of a -120 dirNFErr when using aHigh Sierra CD-ROM.">                                      <meta name="categories" content="Devices"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002415" title="CD-ROM Q&As"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxMassStorageDevices-date.html" target="_blank">Hardware & Drivers > Storage</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note DV505</div>
<div id="pageheadsub">CD-ROM Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><A HREF="#Section1">CD-ROM drivers and Photo CD or Foreign File Access</A><BR><BR><A HREF="#Section2">Original AppleCD SC can't read Photo CD discs</A><BR><BR><A HREF="#Section3">Reading audio data off an audio CD</A><BR><BR><A HREF="#Section4">CD-ROM and File Sharing</A><BR><BR><A HREF="#Section5">File Sharing and CD-ROM discs</A><BR><BR><A HREF="#Section6">Using the Macintosh ISO 9660 FST with another drive</A><BR><BR><A HREF="#Section7">Identifying a CD-ROM in the drive queue or volume queue</A><BR><BR><A HREF="#Section8">-120 (dirNFErr) on a Macintosh</A><BR><BR><A HREF="#Section9">Avoiding invalid boot blocks on a CD-ROM</A><BR><BR><A HREF="#Section10">Why does my CD-ROM take so long to mount?</A><BR><BR><A HREF="#downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;As can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 19 1993]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><A NAME=Section1></A><h2>CD-ROM drivers and Photo CD or Foreign File Access</h2><p>I'm writing a CD-ROM driver. Is there a developer's kit that explains how touse the Foreign File Access extensions for mounting ISO 9660, High Sierra, and audio CDs?</p><p>___</p><p>A CD-ROM driver doesn't have to worry about using Foreign File Access and allits file system translators. That stuff all happens at the file system level,via the toExtFS hook. The only thing a driver need do is to post a mount eventfor an inserted disk.</p><p>Foreign File Access is designed to be media-independent. It doesn't make anycalls to the driver except the standard Read and Write calls. The Audio CDAccess file system translator does assume that the volume in question is aCD-ROM drive, and issues a ReadTOC call to the driver. If the ReadTOC callfails, then Audio CD Access knows it isn't an audio CD. Neither the High SierraFile Access nor the ISO 9660 File Access file system translator assumesanything about the drive in question. You can build an ISO 9660 conformingfloppy, and it will be correctly handled.</p><p>Photo CD Access requires special knowledge about the format of Photo CDs. Ifthe CD is a multisession CD, then Photo CD Access uses some new driver calls,documented in the Macintosh Technical Note "CD-ROM Driver Calls," to access theadditional sessions. Single-session Photo CD discs are supported on all existing Apple CD-ROM drives.</p><p>So, the big picture when writing a CD-ROM driver is: Don't worry about ForeignFile Access. It just does reads and writes. Support the ReadTOC driver call,since Audio CD Access assumes that call exists. If you want to support PhotoCD, look at the new driver calls and call Kodak at 1-800-242-2424, ext. 53, formore information. Get the AppleCD SC Developer's Guide and Apple CD-ROMHandbook, both published by Addison-Wesley. The first has the original driver callsdocumented; the second has information about how to press CD-ROMs.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></P><h2>Original AppleCD SC can't read Photo CD discs</h2><p>Date Written:  10/7/92</p><p>Last reviewed:  6/14/93</p><p>I read that Photo CD discs can be read by the AppleCD SC Plus and the AppleCD150. Does this mean a plain vanilla AppleCD SC can't read them? Is this a hardware limitation, or will there be a software fix?</p><p>___</p><p>Apple erroneously reported that the original AppleCD SC could not readsingle-session Photo CD discs. This turns out not to be the case; all ofApple's CD-ROM drives can read single-session Photo CD discs.</p><p>Two levels of support are available for Kodak Photo CDs: the ability to readthe first session on the Photo CD itself, and the ability to deal with morethan just the initial session of a multisession CD. The AppleCD 300i is thefirst CD-ROM player from Apple to support multisession Photo CDs. For detailsabout both support levels, check the Tech Info Library on AppleLink.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>Reading audio data off an audio CD</h2><p>Date Written:  6/5/92</p><p>Last reviewed:  6/14/93</p><p>Is it possible to read data from an audio CD? I have tried to read an amount ofdata from a track with FSRead. FSRead returned an error status of noErr, but nobytes have been read in. Am I doing something wrong?</p><p>___</p><p>The AppleCD 300 can read data from an audio CD, but the AppleCD SC, the AppleCDSC Plus, and the AppleCD 150 cannot. The files you see on an audio CD aremerely placeholders for the tracks on an audio CD; they contain no data (if youdo a Get Info on them, you will see that they are 0 bytes long).</p><a name="Section4"></a><P><A HREF="#top">Back to top</A></P><h2>CD-ROM and File Sharing</h2><p>Date Written:  10/15/91</p><p>Last reviewed:  12/2/92</p><p>How do I make a single CD-ROM drive visible to users over the network? When Iconnect the CD-ROM drive to a machine running System 7.0 with File Sharingturned on, the CD-ROM drive doesn't show up in the volume list at startup.</p><p>___</p><p>Unless a CD is specifically mastered to be compatible with File Sharing, itwon't be sharable. It doesn't work as it does for hard drives because not allCDs are in HFS format and have the appropriate directory information that FileSharing requires. The easiest way to determine whether or not the CD you haveis sharable is to go to your System 7 machine that has File Sharing turned on,try selecting the disc, and then select Sharing from the File menu. It willtell you if the disc can't be shared. This may be the most likely reason whyyou couldn't see the CD from a remote workstation. However, if that's not thereason, it may be one that follows.</p><p>Folders from a CD-ROM disc can be shared the same way as a folder on a localhard disk. However, to be shared, the CD-ROM must be inserted before FileSharing is turned on. To switch between CD-ROMs, File Sharing must first beturned off, the new CD-ROM inserted, and File Sharing turned back on.</p><p>If you insert a CD-ROM while File Sharing is on, you can eject and insert thedisc, but you can't share it. If a CD-ROM is inserted while the Macintosh isstarting up (File Sharing already having been turned on), then you have to turnFile Sharing off to eject it.</p><a name="Section5"></a><P><A HREF="#top">Back to top</A></P><h2>File Sharing and CD-ROM discs</h2><p>Date Written:  9/24/91</p><p>Last reviewed:  6/14/93</p><p>When I tried to disconnect (unmount) a CD-ROM in System 7.0, I got the message,"Can't put away. Disk is being shared." However, File Sharing status shows novolumes/folders shared. Restarting the Macintosh fixes the problem.</p><p>___</p><p>When File Sharing starts up, it takes a snapshot of the volumes available onthe current desktop. All volumes (excluding floppies, which cannot be shared)are implicitly shared. This occurs even if no one is connected to your system,and you have not explicitly shared any folders/volumes via the Sharing menu.</p><p>The reason for this is that when you start File Sharing, you are making allvolumes on the machine available to the owner from anywhere on the network.Therefore, your CD-ROM, and any other removable media, such as removable harddrives and optical drives, are now being shared for the owner and can't beremoved or unmounted.</p><p>If you make a volume available to your system after File Sharing has beenstarted, that volume won't be available to the owner unless you explicitlyshare it via the Sharing menu. Therefore, once you start File Sharing either bybooting with it active, or through the Sharing Setup control panel, you canmount and unmount new volumes as often as you like until they are explicitly shared.</p><p>If you wish to remove a volume that has been implicitly shared from yourdesktop, turn File Sharing off, remove the volume, and then turn File Sharingback on without restarting your system.</p><p>Restarting your Macintosh works because your CD-ROM ejects at restart, FileSharing is reset, and then you reinsert the CD-ROM.</p><p>(This Q&amp;A was stolen from AppleLink's Tech Info Library because developersask this question frequently.)</p><a name="Section6"></a><P><A HREF="#top">Back to top</A></P><h2>Using the Macintosh ISO 9660 FST with another drive</h2><p>Date Written:  8/8/91</p><p>Last reviewed:  8/1/92</p><p>How can I write an extension to the CD-ROM driver, such as a 'ufob' like theISO 9660 module, or how can I use the 9660 with some other kind of drive?</p><p>___</p><p>You can use the ISO 9660 File System Translator with any type of drive. Theonly requirement is that the drive contain a file system in the ISO format. Thefile system just doesn't care. The file system on the Macintosh looks somethinglike this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>     Application (could be the Finder)                   |                   V              File Manager               /       \  HFS Volume  /         \    Some Other Format Volume             /           \           (HFS)  External File System (FFA, AppleShare)             |            |             | ISO, High Sierra, Audio CD             |   File System Translators             |            |             |            |       Block Oriented Device Driver    (CD-ROM, Hard Disk, Floppy Disk, etc.)                   ||                   \/              Data on Disk</pre>	</TD></TR></TABLE></CENTER>              <p>Basically, what's going on is if HFS doesn't recognize a volume it passescontrol on to the External File System hook, which tries to decode the volumeformat of the unrecognized disk. You can think of the ISO FST as a decoder forForeign File Access that "knows" what ISO disks look like. It in turn makescalls to the low-level driver associated with the device in question. The netresult is that you can use FFA with any block-oriented device. All that needsto be written is a driver.</p><p>That's the good news. Writing a Foreign File System or even an FST is anincredibly difficult procedure. Because the documentation is so poor and themechanisms so convolved, it's so hairy that DTS is unable to support it.</p><a name="Section7"></a><P><A HREF="#top">Back to top</A></P><h2>Identifying a CD-ROM in the drive queue or volume queue</h2><p>Date Written:  11/17/89</p><p>Last reviewed:  8/1/92</p><p>What is a reliable way to tell which element in the drive queue or volume queueis a CD-ROM? I am trying to write a routine that prompts a user to insertspecific volumes by name and ejects any that may be in the drive.</p><p>___</p><p>For a CD in High Sierra, ISO 9660, or audio-only formats, you can usePBHGetVInfo to check for the ioVFSID (file system ID).</p><p>High Sierra disks always have an FSID of 0x4242.</p><p>ISO 9660 disks always have an FSID of 0x4147.</p><p>Audio CDs always have an FSID of 0x4A48.</p><p>You should also check for a hardware locked device by checking the ioVAtrbfield. The bits for this are defined on page 167 of <i>Inside Macintosh</i> Volume IV.</p><p>For the AppleCD SC drive, you can call the driver with a PBstatus call of 97.csParam+1 contains bits corresponding to each of the eight possible SCSI IDs.SCSI ID 0 is the rightmost bit. A bit is set if an AppleCD SC drive exists atthat SCSI ID. See the <i>AppleCD SC Developer's Guide,</i> for further details.</p><a name="Section8"></a><P><A HREF="#top">Back to top</A></P><h2>-120 (dirNFErr) on a Macintosh</h2><p>Date Written:  11/17/89</p><p>Last reviewed:  12/2/92</p><p>Why do I get a -120 (dirNFErr) on a High Sierra CD-ROM, but not on an HFS CD?</p><p>___</p><p>Your program is probably saving directory IDs as a 16-bit quantity. DirectoryIDs are 32-bit values. On most HFS disks, this doesn't matter; you must havemany, many files on a disk to get a directory ID that is a long value. Becauseof the implementation of our support for High Sierra and ISO 9660 CDs, thedirectory ID is always a long value.</p><a name="Section9"></a><P><A HREF="#top">Back to top</A></P><h2>Avoiding invalid boot blocks on a CD-ROM</h2><p>Date Written:  11/17/89</p><p>Last reviewed:  12/2/92</p><p>How do I make sure that my CD-ROM doesn't contain invalid boot blocks?</p><p>___</p><p>The normal way of pressing a Macintosh HFS CD-ROM is by making an image copy ofa hard disk. Unfortunately, this means that the boot blocks are copied as well. The startup code for a hard disk isn't the same as for a CD-ROM (for example, a CD-ROM starts up in 2048-byte block mode, whereas hard disks start up in 512-byte block mode.)</p><p>To invalidate the boot blocks, use a volume editor to zero out the first 2 bytes on the volume.. (These contain $4C4B ("LK") if the boot blocks are present.) By zeroing out these bytes, the Macintosh will not try to use the invalid boot blocks that have been copied from the hard disk.</p><p>X-Ref:</p><p>File Manager</p><a name="Section10"></a><P><A HREF="#top">Back to top</A></P><h2>Why does my CD-ROM take so long to mount?</h2><p>Date Written:  11/17/89</p><p>Last reviewed:  6/14/93</p><p>Why does my CD-ROM take so long to mount?</p><p>___</p><p>Slow loading can happen in several ways. For example, slow loading happens ifyou (or the CD-ROM mastering company) forgot to unmount the hard disk volumebefore making a copy for mastering. Whenever an HFS disk is mounted, a bit isset in the volume's header, and it's cleared again when you unmount the disk orshut down the Macintosh normally. The purpose of this bit is a "crash flag"--ifthe Mac dies abnormally, leaving the bit set, at the next boot the Mac willrecheck the integrity of the file structure and desktop of the disk, just incase something got corrupted during the crash. So if you master from a harddisk that has the bit set because you didn't unmount it, the Mac will thinkyour CD-ROM is potentially crashed every time you load it, and will spend a lotof time rechecking <i>everything</i> on the CD.</p><P><A HREF="#top">Back to top</A></P>         <a name="downloads"></a>         <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center>                                    <img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (60K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/dv_505.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/dv/dv_505.html%3Fid%3DDTS10002415-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/dv/dv_505.html%3Fid%3DDTS10002415-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/dv/dv_505.html%3Fid%3DDTS10002415-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML>