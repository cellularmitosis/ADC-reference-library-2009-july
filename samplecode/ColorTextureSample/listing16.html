<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ColorTextureSample - /Source/Misc.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">ColorTextureSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ColorTextureSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/Misc.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Source/3DMF.c</option>
<option value="listing2.html">/Source/Events.c</option>
<option value="listing3.html">/Source/Headers/3dmf.h</option>
<option value="listing4.html">/Source/Headers/main.h</option>
<option value="listing5.html">/Source/Headers/misc.h</option>
<option value="listing6.html">/Source/Headers/myevents.h</option>
<option value="listing7.html">/Source/Headers/MyGlobals.h</option>
<option value="listing8.html">/Source/Headers/mymenus.h</option>
<option value="listing9.html">/Source/Headers/mywindows.h</option>
<option value="listing10.html">/Source/Headers/objects.h</option>
<option value="listing11.html">/Source/Headers/process.h</option>
<option value="listing12.html">/Source/Headers/QD3D_Support.h</option>
<option value="listing13.html">/Source/Headers/Structs.h</option>
<option value="listing14.html">/Source/Main.c</option>
<option value="listing15.html">/Source/Menus.c</option>
<option value="listing16.html">/Source/Misc.c</option>
<option value="listing17.html">/Source/Objects.c</option>
<option value="listing18.html">/Source/Process.c</option>
<option value="listing19.html">/Source/QD3D_Support.c</option>
<option value="listing20.html">/Source/Windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="ColorTextureSample.zip">Download Sample</a></strong> (&#147;ColorTextureSample.zip&#148;, 64.9K)<BR>
<strong><a href="ColorTextureSample.dmg">Download Sample</a></strong> (&#147;ColorTextureSample.dmg&#148;, 128.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/****************************//*      MISC ROUTINES       *//* (c)1995 Pangea Software  *//* By Brian Greenstone      *//****************************//***************//* EXTERNALS   *//***************/#include &lt;QD3D.h&gt;#include &lt;QD3DErrors.h&gt;#include &lt;timer.h&gt;#include &lt;math.h&gt;#include &lt;Events.h&gt;#include  &quot;myglobals.h&quot;#include  &quot;misc.h&quot;#include  &quot;main.h&quot;extern  EventRecord  gTheEvent;/****************************//*    CONSTANTS             *//****************************/#define    ERROR_ALERT_ID    401/**********************//*     VARIABLES      *//**********************/KeyMap gKeyMap,gOldKeyMap;unsigned long  gTick = 0;unsigned long seed0 = 0, seed1 = 0, seed2 = 0;/****************** DO SYSTEM ERROR ***************/void ShowSystemErr(long err){Str255    numStr;  NumToString(err, numStr);  DoAlert (numStr);  CleanQuit();}/*********************** DO ALERT *******************/void DoAlert(Str255 s){  ParamText(s,NIL_STRING,NIL_STRING,NIL_STRING);  NoteAlert(ERROR_ALERT_ID,NIL_POINTER);}    /*********************** DO FATAL ALERT *******************/void DoFatalAlert(Str255 s){  ParamText(s,NIL_STRING,NIL_STRING,NIL_STRING);  NoteAlert(ERROR_ALERT_ID,NIL_POINTER);  CleanQuit();}/************ CLEAN QUIT ***************/void CleanQuit(void){  ExitToShell();}/********************** WAIT **********************/void Wait(long ticks){long  start;    start = TickCount();  while (TickCount()-start &lt; ticks)    ; }/**************************** LOAD A FILE *******************/Handle  LoadAFile(Str255 fileName, short volumeRefNum, long *fileSize){OSErr    iErr;short    fRefNum;Handle    fileHandle;          /*  OPEN THE FILE */          iErr = FSOpen(fileName,volumeRefNum,&amp;fRefNum);      // open file          if (iErr != noErr)    DoFatalAlert(&quot;\pCant Open File!&quot;);                        /* GET MEMORY FOR FILE */              if  (GetEOF(fRefNum,fileSize) != noErr)      // get size of text file    DoFatalAlert(&quot;\pError reading File!&quot;);  if ((fileHandle = NewHandle(*fileSize)) == NIL_POINTER)    DoFatalAlert (&quot;\pNo Memory for File!&quot;);  HLock(fileHandle);          /*  READ THE DATA */          iErr = FSRead(fRefNum,fileSize,*fileHandle);  if (iErr != noErr)    DoFatalAlert (&quot;\pError Reading File!&quot;);              /*  CLOSE THE FILE */          iErr = FSClose(fRefNum);  if (iErr != noErr)    DoFatalAlert (&quot;\pCant close file!&quot;);    return (fileHandle);  }/***************** NUM TO HEX *****************///// NumToHex - fixed length, returns a C string//unsigned char *NumToHex(unsigned short n){static unsigned char format[] = &quot;0xXXXX&quot;;        // Declare format static so we can return a pointer to it.char *conv = &quot;0123456789ABCDEF&quot;;short i;  for (i = 0; i &lt; 4; n &gt;&gt;= 4, ++i)      format[5 - i] = conv[n &amp; 0xf];  return format;}/***************** NUM TO HEX 2 **************///// NumToHex2 -- allows variable length, returns a ++PASCAL++ string.//unsigned char *NumToHex2(unsigned long n, short digits){static unsigned char format[] = &quot;\p$XXXXXXXX&quot;;        // Declare format static so we can return a pointer to itchar *conv = &quot;0123456789ABCDEF&quot;;unsigned long i;  if (digits &gt; 8 || digits &lt; 0)      digits = 8;  format[0] = digits + 1;              // adjust length byte of output string  for (i = 0; i &lt; digits; n &gt;&gt;= 4, ++i)      format[(digits + 1) - i] = conv[n &amp; 0xf];  return format;}/*************** NUM TO DECIMAL *****************///// NumToDecimal --  returns a ++PASCAL++ string.//unsigned char *NumToDec(unsigned long n){static unsigned char format[] = &quot;\pXXXXXXXX&quot;;        // Declare format static so we can return a pointer to itchar *conv = &quot;0123456789&quot;;short     i,digits;unsigned long temp;  if (n &lt; 10)                    // fix digits    digits = 1;  else if (n &lt; 100)    digits = 2;  else if (n &lt; 1000)    digits = 3;  else if (n &lt; 10000)    digits = 4;  else if (n &lt; 100000)    digits = 5;  else    digits = 6;  format[0] = digits;                // adjust length byte of output string  for (i = 0; i &lt; digits; ++i)  {    temp = n/10;    format[digits-i] = conv[n-(temp*10)];    n = n/10;  }  return format;}/*************** ABSOLUTE ********************/float Absolute(float f){  if (f &lt; 0)    return(-f);  else    return(f);}/******************** REGULATE SPEED  ***************/void RegulateSpeed(long speed){  while ((TickCount() - gTick) &lt; speed)      // wait for 1 tick    ;  gTick = TickCount();              // remember current time}/******************** MY RANDOM LONG **********************///// My own random number generator that returns a LONG//// NOTE: call this instead of MyRandomShort if the value is going to be//    masked or if it just doesnt matter since this version is quicker//    without the 0xffff at the end.//unsigned long MyRandomLong(void){  return seed2 ^= (((seed1 ^= (seed2&gt;&gt;5)*1568397607UL)&gt;&gt;7)+                   (seed0 = (seed0+1)*3141592621UL))*2435386481UL;} /**************** SET MY RANDOM SEED *******************/void SetMyRandomSeed(unsigned long seed){  seed0 = seed;  seed1 = 0;  seed2 = 0;  }/************************* RANDOM RANGE *************************/unsigned short  RandomRange(unsigned short min, unsigned short max){register  unsigned short    qdRdm;              // treat return value as 0-65536register  unsigned long    range, t;  qdRdm = MyRandomLong()&amp;0xffff;  range = max+1 - min;  t = (qdRdm * range)&gt;&gt;16;                 // now 0 &lt;= t &lt;= range    return( t+min );}/******************* FLOAT TO STRING *******************/void FloatToString(float num, Str255 string){Str255  sf;long  n,i,f;  n = (long)(num*1000);      // shift decimal place down 4 places, then truncate the rest  i = n/1000;            // get integer part  f = n%1000;            // get remainder/fractional part  if (f &lt; 0)    f = -f;  if ((i==0) &amp;&amp; (num &lt; 0))    // special case if (-), but integer is 0  {    string[0] = 2;    string[1] = '-';    string[2] = '0';  }  else    NumToString(i,string);    // make integer into string      NumToString(f,sf);        // make fraction into string    string[++string[0]] = '.';    // add &quot;.&quot; into string  for (i = 0; i &lt; sf[0]; i++)  {    string[++string[0]] = sf[i+1];  // copy fraction into string  }}/****************** ALLOC HANDLE ********************/Handle  AllocHandle(long size){Handle  hand;OSErr  err;  hand = NewHandle(size);              // alloc in APPL  if (hand == nil)  {    hand = TempNewHandle(size,&amp;err);      // try TEMP mem    if (hand == nil)    {      return(NewHandleSys(size));      // use SYS        }    else      return(hand);              // use TEMP  }  else    return(hand);                // use APPL}/****************** ALLOC PTR ********************/Ptr  AllocPtr(long size){Ptr  pr;  pr = NewPtr(size);            // alloc in APPL  if (pr == nil)  {    return(NewPtrSys(size));      // alloc in SYS  }  else    return(pr);}/***************** ANGLE TO VECTOR ******************///// Returns a normalized 2D vector based on a radian angle//void AngleToVector(float angle, TQ3Vector2D *theVector){  theVector-&gt;x = -sin(angle);  theVector-&gt;y = -cos(angle);}/************************** VECTORS ARE CLOSE ENOUGH ****************************/Boolean VectorsAreCloseEnough(TQ3Vector3D *v1, TQ3Vector3D *v2){  if (fabs(v1-&gt;x - v2-&gt;x) &lt; 0.04)    if (fabs(v1-&gt;y - v2-&gt;y) &lt; 0.04)      if (fabs(v1-&gt;z - v2-&gt;z) &lt; 0.04)        return(true);  return(false);}/************************** POINTS ARE CLOSE ENOUGH ****************************/Boolean PointsAreCloseEnough(TQ3Point3D *v1, TQ3Point3D *v2){  if (fabs(v1-&gt;x - v2-&gt;x) &lt; 0.04)    if (fabs(v1-&gt;y - v2-&gt;y) &lt; 0.04)      if (fabs(v1-&gt;z - v2-&gt;z) &lt; 0.04)        return(true);  return(false);}/************************** UVS ARE CLOSE ENOUGH ****************************/Boolean UVsAreCloseEnough(TQ3Param2D *v1, TQ3Param2D *v2){  if (fabs(v1-&gt;u - v2-&gt;u) &lt; 0.01)    if (fabs(v1-&gt;v - v2-&gt;v) &lt; 0.01)      return(true);  return(false);}/************* COPY PSTR **********************/void CopyPStr(ConstStr255Param  inSourceStr, StringPtr  outDestStr){short  dataLen = inSourceStr[0] + 1;    BlockMoveData(inSourceStr, outDestStr, dataLen);  outDestStr[0] = dataLen - 1;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ColorTextureSample/listing16.html%3Fid%3DDTS10000131-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ColorTextureSample/listing16.html%3Fid%3DDTS10000131-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ColorTextureSample/listing16.html%3Fid%3DDTS10000131-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>