<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Sync Services Programming Guide: Using a Session Driver</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using a Session Driver"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40003600" title="Using a Session Driver"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../Syncing-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP40001899" target="_top">Syncing</a> &gt; <a href="../index.html" target="_top">Sync Services Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="Formatting.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="UsingCoreData.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40003600-SW4" title="Using a Session Driver"></a><hr /><H1>Using a Session Driver</H1><div class="importantbox"><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_26" title="Important:"></a><p><strong>Important:</strong>&nbsp;<code>ISyncSessionDriver</code> is available in Mac OS X version v10.5 and later.</p><p></p></div><p><code>ISyncSessionDriver</code> is a class that encapsulates the entire syncing process including setting up clients, registering schemas, and managing sync sessions. Applications can optionally use an <code>ISyncSessionDriver</code> object to manage their sync sessions instead of creating <code>ISyncClient</code> and <code>ISyncSession</code> objects directly. <code>ISyncSessionDriver</code> works well for typical applications that have a local data store and that push and pull records during every sync. <code>ISyncSessionDriver</code> uses a delegation model where application-specific objects implement some required and some optional methods.</p><p>The application supplies two objects to the driver to help control a sync session. The responsibility of the <strong>data source</strong> is to provide client information and maintain local records—the data source conforms to the <code>ISyncSessionDriverDataSource</code> protocol. The responsibility of the <strong>delegate</strong> is to optionally intervene during the syncing process and perform application-specific tasks. By default, the data source and delegate are the same object. Explicitly set the delegate object if you want a separate object to control a sync session.</p><p>The following sections describe the data source and delegate methods in the sequence they are invoked in a typical application. The process involves creating a driver, setting a delegate, and starting a sync session. Some of the data source methods are required and some are optional. All of the delegate methods are optional. The driver sends a series of messages to the data source and delegate:</p><ol class="ol"><li class="li"><p>The driver requests information from the data source, such as the client identifier and client description property list before starting a sync session.</p></li><li class="li"><p>The driver requests changes to local records from the data source during the pushing phase.</p></li><li class="li"><p>The driver sends server-side changes to the data source during the pulling phase.</p></li><li class="li"><p>The driver can notify the delegate before and after each phase during the syncing process. For example, notify the delegate when the pulling phase is done or when a session is about to be canceled.</p></li></ol><p>The data source and delegate are also responsible for identifying client-side errors and notifying the driver. They can cancel a sync session at any time. Read <span class="content_text"><a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW1">“Handling Errors”</a></span> for details.</p><p>An <code>ISyncSessionDriver</code> object can be used for multiple sync sessions—typically, there's one <code>ISyncSessionDriver</code> object per application.</p><p>Read <em><a href="../../../Reference/ISyncSessionDriverDataSource_Protocol/index.html#//apple_ref/doc/uid/TP40004601" target="_top">ISyncSessionDriverDataSource Protocol Reference</a></em> and <em><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/index.html#//apple_ref/doc/uid/TP40004415" target="_top">ISyncSessionDriver Class Reference</a></em> for a complete description of the data source and delegate methods. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-DontLinkElementID_1">Creating a Driver</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW2">Starting a Sync Session</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-DontLinkElementID_2">Providing Client Information</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-DontLinkElementID_7">Negotiating</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-DontLinkElementID_8">Pushing</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-DontLinkElementID_12">Pulling</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW3">Customizing Sync Behavior</a>
				
			<br/>
			
        
			
			
				<a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW1">Handling Errors</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_1" title="Creating a Driver"></a><h2>Creating a Driver</h2><p>First you create an <code>ISyncSessionDriver</code> object and set its data source as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    // Create an ISyncSessionDriver object<span></span></pre></td></tr><tr><td scope="row"><pre>    sessionDriver = [[ISyncSessionDriver sessionDriverWithDataSource:myDataSource] retain];<span></span></pre></td></tr></table></div><p>If you do not set the delegate using the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/setDelegate:" target="_top">setDelegate:</a></code> method, the data source and delegate are the same object.</p><p>Some data source methods are required. For example, a data source must provide a client identifier and client description property list in order for an <code>ISyncSessionDriver</code> object to create an <code>ISyncClient</code> object. The <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/clm/ISyncSessionDriver/sessionDriverWithDataSource:" target="_top">sessionDriverWithDataSource:</a></code> method raises an exception if required methods are not implemented. The following sections cover the different data source methods in detail.</p><a name="//apple_ref/doc/uid/TP40003600-SW2" title="Starting a Sync Session"></a><h2>Starting a Sync Session</h2><p>You start a sync session by sending either <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> or <code><!--a target="_top" -->startAsynchronousSync<!--/a--></code> to an <code>ISyncSessionDriver</code> object. The following code fragment uses <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    // Begin a sync session.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSError *syncError;<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL syncSuccess = [sessionDriver sync];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (syncSuccess == NO){<span></span></pre></td></tr><tr><td scope="row"><pre>        syncError = [sessionDriver error];<span></span></pre></td></tr><tr><td scope="row"><pre>        NSAlert *theAlert = [NSAlert alertWithError:syncError];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theAlert runModal];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>The <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> method sends a series of messages to the data source and delegate to create the client and session objects. The data source is required to implement some methods invoked during pushing and pulling, and the delegate can optionally implement other callback methods during the entire process.</p><p>The <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> method returns <code>NO</code> if an error occurs in either the sync session or the application. How you handle the error is application dependent. Typically, you log or display the error message and set the next preferred sync mode accordingly. See <span class="content_text"><a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW1">“Handling Errors”</a></span> for more details.</p><p>Optionally, use the <code><!--a target="_top" -->startAsynchronousSync<!--/a--></code> method if you need to sync asynchronously. In this case, you might implement the delegate methods to get notification when the sync session finishes or cancels.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_2" title="Providing Client Information"></a><h2>Providing Client Information</h2><p>The driver takes care of the details of registering schemas and clients with the sync engine so you don't have to. The driver sends the following messages to the data source to register the client and any schemas.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_3" title="Providing a Client Identifier"></a><h3>Providing a Client Identifier</h3><p>A data source must provide a client identifier—a unique string that identifies your application—by implementing the <code><!--a target="_top" -->clientIdentifier<!--/a--></code> method. Typically, the client identifier is a reverse DNS-style string that identifies your organization and application as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSString *)clientIdentifier<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return @"com.mycompany.SimpleStickies";<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_4" title="Providing a Client Description"></a><h3>Providing a Client Description</h3><p>A data source must provide a client description property list by implementing the <code><!--a target="_top" -->clientDescriptionURL<!--/a--></code> method. In this sample code, the <code>ClientDescription.plist</code> file is located in the application <code>Resources</code> directory:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSURL *)clientDescriptionURL<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"ClientDescription" ofType:@"plist"]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The client description property list contains additional information about the client as well as the entities and properties that it syncs. The entities and properties may be a subset of the entities and properties defined in the schemas. See <span class="content_text"><a href="RegisteringClients.html#//apple_ref/doc/uid/TP40001155-137693">“Client Description Properties”</a></span> for a complete description of the client description property list.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_5" title="Providing Schemas"></a><h3>Providing Schemas</h3><p>The data source must implement the <code><!--a target="_top" -->schemaBundleURLs<!--/a--></code> method to return an array of NSURL objects containing the paths to the schemas. In this sample code, the schema called <code>Stickies.syncschema</code> is located in the application's <code>Resource</code> directory:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSArray *)schemaBundleURLs {<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSArray arrayWithObject:[NSURL fileURLWithPath:<span></span></pre></td></tr><tr><td scope="row"><pre>        [[[NSBundle mainBundle] resourcePath] stringByAppendingPathComponent:@"Stickies.syncschema"]]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This method is invoked once before each sync session starts so it should return the paths to all the schemas used by your application. See <span class="content_text"><a href="SchemaDesign.html#//apple_ref/doc/uid/TP40001153-CJBEHAAG">“Creating a Sync Schema”</a></span> for how to create your own schema or extend an existing schema.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_6" title="Providing Entity Names"></a><h3>Providing Entity Names</h3><p>The driver needs to know which entities from the client description property list you intend to push and pull during this sync session. The data source may optionally implement the <code><!--a target="_top" -->entityNamesToSync<!--/a--></code> method to return a subset of the entities declared in the client description property list. If the data source does not implement this method, the default is to sync all entities in the client description property list. The implementation of this method simply returns an NSArray object (containing NSString objects) and is application-specific.</p><p>The data source can optionally implement the <code><!--a target="_top" -->entityNamesToPull<!--/a--></code> method to specify a subset of entities to pull. Implement this method only if the entities are different from those returned by the <code><!--a target="_top" -->entityNamesToSync<!--/a--></code> method or declared in the client description property list.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_7" title="Negotiating"></a><h2>Negotiating</h2><p>All clients need to negotiate a sync mode before pushing and pulling records. The driver checks to see whether the data source prefers a particular sync mode.</p><p>The data source must implement the <code><!--a target="_top" -->preferredSyncModeForEntityName:<!--/a--></code> method. You may return a different result for each entity name that is passed as a parameter to this method. It is therefore the responsibility of the application to remember the previous sync mode and track errors per entity name if applicable. This method may return one of the constants described in <em><a href="../../../Reference/ISyncSessionDriverDataSource_Protocol/index.html#//apple_ref/doc/uid/TP40004601" target="_top">ISyncSessionDriverDataSource Protocol Reference</a></em>.</p><p>For example, when you first sync you might want to request a slow sync and thereafter, a fast sync. However, if you failed to save records during the last sync, you might request a refresh or slow sync. The data source maintains the state of its local records and tracks changes so it can make the appropriate request; otherwise, it should always request a slow sync.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_8" title="Pushing"></a><h2>Pushing</h2><p>What methods are invoked during the pushing phase depends on how the data source tracks changes to local records and what the current sync mode is.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_9" title="Pushing Changes"></a><h3>Pushing Changes</h3><p>During a slow or refresh sync, the driver requests all the client records so that it can compare them with the records in the truth database and resolve conflicts. Therefore, the data source is required to implement the <code><!--a target="_top" -->recordsForEntityName:moreComing:error:<!--/a--></code> method to return all records. Records are expected to be a dictionary representation. Read <code><a href="SessionManagement.html#//apple_ref/doc/uid/TP40001162-160583">“Pushing Records”</a></code> for a description of a sync record.</p><p>During a fast sync, the driver sends a request to the data source for all changes to local records. If the data source tracks changes to individual properties then it can push just the changes. To do this the data source implements the <code><!--a target="_top" -->changesForEntityName:moreComing:error:<!--/a--></code> method to return an array of ISyncChange objects that describe the changes. See <em><a href="../../../Reference/SyncServicesFramework/Classes/ISyncChange_Class/index.html#//apple_ref/doc/uid/TP40004409" target="_top">ISyncChange Class Reference</a></em> for how to create these objects. </p><p>Otherwise, if the data source knows only which records changed, it pushes all the changed records and the sync engine compares the old records with the new records to apply changes to individual properties. The data source implements the <code><!--a target="_top" -->changedRecordsForEntityName:moreComing:error:<!--/a--></code> method to return the changed records. Records are expected to be a dictionary representation. Read <span class="content_text"><a href="SessionManagement.html#//apple_ref/doc/uid/TP40001162-160583">“Pushing Records”</a></span> for a description of a sync record.</p><p>The data source is required to implement one of these methods if the <code><!--a target="_top" -->preferredSyncModeForEntityName:<!--/a--></code> method may return <code>ISyncSessionDriverModeFast</code>.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_10" title="Pushing Deletions"></a><h3>Pushing Deletions</h3><p>During a fast sync, the driver also requests the record identifiers for records that were deleted. The data source can either pass back deletion changes using an <code><!--a target="_top" -->ISyncChange<!--/a--></code> object returned by the <code><!--a target="_top" -->changesForEntityName:moreComing:error:<!--/a--></code> method, or implement the <code><!--a target="_top" -->identifiersForRecordsToDeleteForEntityName:moreComing:error:<!--/a--></code> method to return the record identifiers. </p><p>The <code><!--a target="_top" -->identifiersForRecordsToDeleteForEntityName:moreComing:error:<!--/a--></code> method is optional.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_11" title="Batching"></a><h3>Batching</h3><p>All the pushing methods support batching. Set the value referenced by the the <code>moreComing:</code> parameter to <code>YES</code> if you want to batch changes or records. The method is invoked repeatedly until the <code>moreComing:</code> parameter is set to <code>NO</code>.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_12" title="Pulling"></a><h2>Pulling</h2><p>Typically, the data source just needs to apply changes during the pulling phase, but the data source can also reformat records and change record identifiers.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_13" title="Applying Changes"></a><h3>Applying Changes</h3><p>Typically, the driver sends changes to the data source during the pulling phase. Changes may include deletions, additions, and changes to existing records. Therefore, the data source is required to implement the <code><!--a target="_top" -->applyChange:forEntityName:remappedRecordId:formattedRecord:error:<!--/a--></code> method. The implementation should send the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncChange_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncChange/type" target="_top">type</a></code> ISyncChange method to the <code>applyChange:</code> parameter to determine the type of change as in this sample code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (ISyncSessionDriverChangeResult)applyChange:(ISyncChange *)change<span></span></pre></td></tr><tr><td scope="row"><pre>                                forEntityName:(NSString *)entityName<span></span></pre></td></tr><tr><td scope="row"><pre>                     remappedRecordIdentifier:(NSString **)outRecordIdentifier<span></span></pre></td></tr><tr><td scope="row"><pre>                              formattedRecord:(NSDictionary **)outRecord<span></span></pre></td></tr><tr><td scope="row"><pre>                                        error:(NSError **)outError<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Delete a record<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([change type] == ISyncChangeTypeDelete){<span></span></pre></td></tr><tr><td scope="row"><pre>        ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Add a record<span></span></pre></td></tr><tr><td scope="row"><pre>    else if ([change type] == ISyncChangeTypeAdd){<span></span></pre></td></tr><tr><td scope="row"><pre>        ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    // Change a record<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return ISyncSessionDriverChangeAccepted;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>How you apply the changes to your local records is application dependent. See <em><a href="../../../Reference/SyncServicesFramework/Classes/ISyncChange_Class/index.html#//apple_ref/doc/uid/TP40004409" target="_top">ISyncChange Class Reference</a></em> for other methods the data source can use to get the changes.</p><p>This method returns one of the change constants described in <em><a href="../../../Reference/ISyncSessionDriverDataSource_Protocol/index.html#//apple_ref/doc/uid/TP40004601" target="_top">ISyncSessionDriverDataSource Protocol Reference</a></em> to notify the driver if the change is successfully applied. Otherwise, the local records can become out of sync with the truth database and the client should slow sync the next time it syncs.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_14" title="Deleting All Records"></a><h3>Deleting All Records</h3><p>Occasionally, the driver requests that the data source delete all local records—for example, when due to other circumstances the client must pull the truth. Therefore, the data source is required to implement the <code><!--a target="_top" -->deleteAllRecordsForEntityName:error:<!--/a--></code> method.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_15" title="Formatting"></a><h3>Formatting</h3><p>When pulling records from the sync engine, the client can optionally change the format of property values without the sync engine interpreting the reformatting as changes to the values and mistakenly syncing the changes to other clients. Use the <code>formattedRecord:</code> parameter in the <code><!--a target="_top" -->applyChange:forEntityName:remappedRecordId:formattedRecord:error:<!--/a--></code> method to specify an alternate format for a record. Read <span class="content_text"><a href="Formatting.html#//apple_ref/doc/uid/TP40001152-CJBEJBHH">“Formatting Records”</a></span> for more details.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_16" title="Changing Record Identifiers"></a><h3>Changing Record Identifiers</h3><p>Occasionally a client needs to change the local record identifiers supplied by the sync engine, especially if the local data store uses its own record identifiers. If the data source knows the preferred record identifier when the <code><!--a target="_top" -->applyChange:forEntityName:remappedRecordId:formattedRecord:error:<!--/a--></code> method is invoked, it can use the <code>remappedRecordId:</code> parameter to pass back the new record identifier. </p><p>Otherwise, the data source can change the record identifiers later by sending <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSession_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSession/clientChangedRecordIdentifiers:" target="_top">clientChangedRecordIdentifiers:</a></code> to the ISyncSession object as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>[[syncDriver session] clientChangedRecordIdentifiers:oldToNewDictionary];<span></span></pre></td></tr></table></div><p>The <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/session" target="_top">session</a></code> method returns <code>nil</code> if the sync session is finished. Therefore, invoke this method before a sync session is finished. Read <span class="content_text"><a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW3">“Customizing Sync Behavior”</a></span> for methods the delegate can implement to do this.</p><a name="//apple_ref/doc/uid/TP40003600-DontLinkElementID_17" title="Handling Sync Alerts"></a><h3>Handling Sync Alerts</h3><p>The session driver can optionally handle sync alerts for you. A sync alert is an invitation to join a sync session with other clients that you observe. You specify the types of clients to observe in the client description property list. By default a session driver does not handle sync alerts. Send <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/setHandlesSyncAlerts:" target="_top">setHandlesSyncAlerts:</a></code> to the session driver passing <code>YES</code> as the parameter to turn on this feature.</p><p>If the session driver handles sync alerts, then it registers a sync alert handler and receives notifications for requests to join sync sessions. When the session driver receives a request, it initiates a sync session. It uses the <code><!--a target="_top" -->startAsynchronousSync<!--/a--></code> not the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> method to start the sync session so it doesn’t sync in the main thread.</p><p>If you prefer to handle sync alerts yourself, then you typically implement the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/sessionDriver:didRegisterClientAndReturnError:" target="_top">sessionDriver:didRegisterClientAndReturnError:</a></code> delegate method to set your own handler.</p><a name="//apple_ref/doc/uid/TP40003600-SW3" title="Customizing Sync Behavior"></a><h2>Customizing Sync Behavior</h2><p>The delegate can implement any number of optional callback methods to intervene during the phases of a sync session. A client might do this to execute local database operations or monitor the progress of a sync session.</p><p>For example, the delegate might implement the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/sessionDriver:didRegisterClientAndReturnError:" target="_top">sessionDriver:didRegisterClientAndReturnError:</a></code> method to set up an application-specific sync alert handler. Read <span class="content_text"><a href="AlertHandlers.html#//apple_ref/doc/uid/TP40001159-BAJEAIEE">“Syncing With Other Clients”</a></span> for details on joining sync sessions.</p><p>The delegate might implement the <code><!--a target="_top" -->sessionDriver:didPullAndReturnError:<!--/a--></code> method to resolve relationships between local records after a pulling phase.</p><p>The delegate might implement the <code><!--a target="_top" -->sessionDriver:willFinishSessionAndReturnError:<!--/a--></code> method to save local changes and change record identifiers once they are known (typical actions if you are using a relational database to store your records).</p><p>Similarly the delegate might implement the <code><!--a target="_top" -->sessionDriverWillCancelSession:<!--/a--></code> method to revert the local records to the state before the sync session started.</p><a name="//apple_ref/doc/uid/TP40003600-SW1" title="Handling Errors"></a><h2>Handling Errors</h2><p>Syncing records is a complex process. Errors can occur at every level during this process including client-side errors that corrupt the local data store. </p><p>Most of the delegate and data source methods invoked by the driver during a sync session have an <code>...Error:</code> or <code>error:</code> parameter that your object can use to pass back descriptions of the error that occurred. When implementing these methods, you should return <code>NO</code> if an error occurred and set the <code>...Error:</code> or <code>error:</code> parameter accordingly. Other methods that have an <code>...Error:</code> or <code>error:</code> parameter may return <code>ISyncSessionDriverChangeError</code> to indicate an error.</p><p>If an error occurs, the driver prematurely cancels the sync session. Eventually, an <code>NSError</code> object is passed back to the method that originally started the sync session. For example, the <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/sync" target="_top">sync</a></code> method returns <code>NO</code> if an error occurred in either Sync Services, the data source, or the delegate. Use the  <code><a href="../../../Reference/SyncServicesFramework/Classes/ISyncSessionDriver_Class/Reference/Reference.html#//apple_ref/occ/instm/ISyncSessionDriver/lastError" target="_top">lastError</a></code> method to get and handle the error. For example, the code fragment in <span class="content_text"><a href="ControllingSyncSessions.html#//apple_ref/doc/uid/TP40003600-SW2">“Starting a Sync Session”</a></span> displays an alert panel.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="Formatting.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="UsingCoreData.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/SyncServices/Articles/ControllingSyncSessions.html%3Fid%3DTP40001178-5.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/SyncServices/Articles/ControllingSyncSessions.html%3Fid%3DTP40001178-5.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/SyncServices/Articles/ControllingSyncSessions.html%3Fid%3DTP40001178-5.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
