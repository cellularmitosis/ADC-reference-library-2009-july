<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> PCI Boot Sequence</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.86.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.87.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.89.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H1.Heading1"><A NAME="pgfId=3309"> </A>PCI Boot Sequence</H1><P CLASS="T1.Text1"><A NAME="pgfId=3311"> </A><A NAME="marker=3310"> </A>To better explain the concepts and mechanisms for finding, initializing, and replacing PCI drivers, below is a short description of the PCI boot sequence. The boot sequence applies to machines built prior to the introduction of the NewWorld architecture in the iMac and later Power Macintosh G3 computers. The boot sequence is similar for all Macintosh computers, however the steps are not identical. For information about the steps in the NewWorld boot sequence, see <A HREF="PCI_BOOK.25.html#27578" CLASS="XRef">Introduction to the NewWorld Architecture</A> and <A HREF="PCI_BOOK.4b.html#14179" CLASS="XRef">Startup Sequence in the NewWorld Architecture</A>.</P><OL><LI CLASS="N/.NList=1"><A NAME="pgfId=3312"> </A>Hardware is reset.</LI><LI CLASS="N.NList"><A NAME="pgfId=3313"> </A>Open Firmware creates the device tree. This device tree is composed of all the devices found by the Open Firmware code, including all properties associated with those devices.</LI><LI CLASS="N.NList"><A NAME="pgfId=3314"> </A>The Name Registry device tree is created by copying the Macintosh-relevant nodes and properties from the Open Firmware device tree.</LI><LI CLASS="N.NList"><A NAME="pgfId=3315"> </A>The Code Fragment Manager and the interrupt tree are initialized.</LI><LI CLASS="N.NList"><A NAME="pgfId=3316"> </A>Device properties that are persistent across system startups and are located in NVRAM are restored to their proper location in the Name Registry device tree.</LI><LI CLASS="N.NList"><A NAME="pgfId=3317"> </A>The Name Registry device tree is searched for PCI expansion ROM device drivers associated with device nodes. </LI><LI CLASS="N.NList"><A NAME="pgfId=3318"> </A>PCI expansion ROM device drivers required for booting are loaded and initialized. </LI><LI CLASS="N.NList"><A NAME="pgfId=3319"> </A>If a PCI ROM device driver is marked as <TT CLASS="cv">kDriverIsLoadedUponDiscovery</TT>, the driver is installed in the Device Manager unit table.</LI><LI CLASS="N.NList"><A NAME="pgfId=3320"> </A>If a PCI ROM device driver is marked as <TT CLASS="cv">kDriverIsOpenedUponLoad</TT>, the driver is initialized and opened, and the <TT CLASS="cv">driver-ref</TT> property is created for the driver's device node.</LI><LI CLASS="N.NList"><A NAME="pgfId=3322"> </A><A NAME="17485"> </A>The Display Manager is initialized.</LI><LI CLASS="N.NList"><A NAME="pgfId=3895"> </A>The ATA Manager is initialized.</LI><LI CLASS="N.NList"><A NAME="pgfId=3323"> </A>The SCSI Manager is initialized.</LI><LI CLASS="N.NList"><A NAME="pgfId=3324"> </A>The File Manager and Resource Manager are initialized.</LI><LI CLASS="N.NList"><A NAME="pgfId=3325"> </A>Device properties that are persistent across system startups and located in the Preferences folder in the System Folder are restored to their proper location in the Name Registry device tree.</LI></OL><P CLASS="T1.Text1"><A NAME="pgfId=3326"> </A>Device drivers under family expert control are processed next. The following steps load disk-based experts and disk-based drivers:</P><OL><LI CLASS="N/.NList=1"><A NAME="pgfId=3327"> </A>Scan the Extensions folder for drivers (file type <TT CLASS="cv">'ndrv'</TT>), updating the Registry with new versions of drivers as appropriate. For each driver added or updated in the tree, a driver description property is added or updated as well.</LI><LI CLASS="N.NList"><A NAME="pgfId=3328"> </A>For each driver that is replaced, and already open, use the driver replacement mechanism.</LI><LI CLASS="N.NList"><A NAME="pgfId=3329"> </A>Run <TT CLASS="cv">'INIT'</TT> resources for virtual devices. Virtual devices are discussed in <A HREF="PCI_BOOK.103.html#32686" CLASS="XRef">Real and Virtual Devices</A>.</LI><LI CLASS="N.NList"><A NAME="pgfId=3333"> </A>Scan the Extensions folder for experts; load, initialize, and run each expert.</LI><LI CLASS="N.NList"><A NAME="pgfId=3334"> </A>Run experts to scan the registry, using the driver description property associated with each node to determine which families the devices belong to. </LI><LI CLASS="N.NList"><A NAME="pgfId=3335"> </A>Load and initialize appropriate devices based on family characteristics.</LI></OL><P CLASS="T1.Text1"><A NAME="pgfId=3336"> </A>At that point all devices in use by the system and family subsystems are initialized. Uninitialized and unopened devices or services that may be used by client applications are located, initialized, and opened at the time that a client makes a request for the devices or services.<A NAME="marker=3337"> </A></P><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=14217"> </A>Note</B></p><P CLASS="Note"><A NAME="pgfId=3338"> </A>Native device drivers are ordered to switch from low-power to high-power mode when their devices are opened. </P></blockquote></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.86.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.87.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.89.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>