<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN2030: GDB for MacsBug Veterans</title><meta name="keywords" content="GDB, MacsBug, Debugging, Mac OS X, Project Builder"><meta name="Description" content="Technical Note TN2030:     This technote shows how to translateyour experience with MacsBug    into a working knowledgeof the GNU source-level debugger (GDB) as    used on MacOS X. The focus is on using GDB as an assembly-level    toolfor debugging programs for which you don't have source (for   example, debugging crashes inside Carbon itself) or forwhich the    source is inaccessible (for example, debugginga crash that only    occurs at a customer's site). However,many of the tricks you learn    here will also be usefulfor more mundane source-level debugging."><meta name="categories" content="Overview and Platforms and Tools"><meta name="week-posted" content="Oct 15, 2001 - Oct 19, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003067" title="GDB for MacsBug Veterans"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/DeveloperTools/index.html">Tools</a> &gt; <a href="../../technicalnotes/DeveloperTools/idxCompilersDebuggers-date.html">Compiling & Debugging</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2030</div>
<div id="pageheadsub">GDB for MacsBug Veterans</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><P><!-- end_titles_information 1 --> </P><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR>                           <BR>                           <A HREF="#Section2">MacsBug to GDB                           Reference</A><BR>                           <BR>                           <A HREF="#Section3">Hints and Tips</A><BR>                           <BR>                           <A HREF="#Summary">Summary</A><BR>                           <BR>                           <A HREF="#references">References</A><BR>                           <BR>                                                      <A HREF="#Downloads">Downloadables</A></P>                                                                         <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table><BR>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text -->                                    <P id=introtext>This technote shows how to                  translate your experience with MacsBug into a                  working knowledge of the GNU source-level debugger                  (GDB) as used on Mac OS X. The focus is on using                  GDB as an assembly-level tool for debugging                  programs for which you don't have source (for                  example, debugging crashes inside Carbon itself) or                  for which the source is inaccessible (for example,                  debugging a crash that only occurs at a customer's                  site). However, many of the tricks you learn here                  will also be useful for more mundane source-level                  debugging.</P>                                    <P id=introtext>This technote is primarily directed                  at application developers (and other developers of                  user space code) who are familiar with MacsBug and                  want a quick introduction to GDB. If you're not                  already familiar with MacsBug, you probably should                  skip this technote and go straight to the <A HREF="#references">GDB                  manual</A>. If you're developing kernel code (for                  example, an IOKit driver) you will find most of                  this technote useful but you must also learn the                  two-machine debugging techniques described in                  <a href="http://developer.apple.com/documentation/Darwin/kernel.html">other                  Apple documentation</A>.</P>                  <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 18 2001]</h3><!-- end_date -->                </TD>             </TR>          </table><BR>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->                  <P><A NAME=Section1></A></P>                  <H2>Introduction</H2>                  <P>The first step in a successful transition from MacsBug to         GDB is...</P>                  <CENTER><img src="images/tn2030_1.gif" width=366 height=100 align=bottom alt="Don't Panic"></CENTER>                  <P>If you're used to MacsBug, learning GDB won't be that         hard. And while you'll miss some of MacsBug's nicer features         (the <CODE>showpath</CODE> 'dcmd' for example) you'll be         impressed by some of the cool things that GDB can do for you         (future break is one of my favorites). So, let's get         started.</P>                  <H3>About GDB</H3>                  <P>The GNU source-level debugger (GDB) is the primary         debugging tool on Mac OS X. Whenever you debug on Mac OS X,         you are using GDB in one form or another.</P>                  <UL>            <LI>GDB is available as a standard command-line tool            (<CODE>gdb</CODE>) that you can run from Terminal.</LI>                        <LI>Project Builder provides a graphical front end to            GDB's commonly-used debugging facilities. However, there            are cases where you might want to enter GDB commands            directly, either by starting GDB from the command line or            by entering commands at Project Builder's GDB            prompt.</LI>                        <LI>The CodeWarrior source-level debugger is currently            layered on top of GDB (although there is no direct access            to GDB from within CodeWarrior).</LI>         </UL>                  <P>This technote concentrates on using GDB from the command         line. This is in line with the overall goal of exploring GDB         as an assembly-level debugging tool.</P>                  <P>While it is possible to define macros to make GDB behave         like MacsBug (for an amazing example, check out the         <A HREF="#MacsBugGDBPlugin">MacsBug GDB plug-in</A>), that's         not a good long-term choice in my opinion. Mac OS X is the         long-term direction of Apple, and GDB will be the core         debugger on Mac OS X for the foreseeable future. It behooves         you to learn GDB now rather than later.</P>                  <P>GDB, as its full name suggests, is primarily a         source-level debugger. This has its pros and cons. There's         no denying that source-level debugging is easier and its         absence in MacsBug has always been sorely missed. However,         GDB's focus on source-level debugging means that it isn't a         great assembly-level debugger. It is, however, good enough         to get the job done.</P>                  <H3>Conventions Used In This Technote</H3>                  <P>Throughout this technote the following styles have         special meaning.</P>                  <UL>            <LI><CODE>Monospace text</CODE> indicates a GDB or            MacsBug command, or text output by the computer.</LI>                        <LI><B><CODE>Bold monospace text</CODE></B> indicates            commands entered by the user.</LI>                        <LI><I><CODE>Italic monospace text</CODE></I> indicates            comments.</LI>                        <LI>A backslash (\) at the end of a line indicates that            the line is continued on the next line.</LI>                        <LI><CODE>^X</CODE> indicates that you should enter a            control character (for example, the notation ^C means you            should hold down the control key and press the C            key).</LI>                        <LI>In debugger command descriptions, meta variables are            shown in angle brackets. For example, <CODE>DM            &lt;addr&gt;</CODE> indicates that you should substitute            an address for <CODE>&lt;addr&gt;</CODE>.</LI>         </UL>                  <H3>GDB Basics</H3>                  <P>When you break into MacsBug on traditional Mac OS you         stop the entire computer. This is not the case with GDB on         Macs OS X. When you break into GDB you stop only the process         that you're debugging. This allows you to look up source         code and documentation while you're debugging.</P>                  <P>There are two basic ways of targeting the process you         want to debug.</P>                  <UL>            <LI>Attach to the process after it's started running</LI>                        <LI>Run your program from within GDB.</LI>         </UL>                  <P>The first approach has the advantage that you can start         debugging a program after it's been executing for some time.         You don't need to know in advance that this is a debugging         session. You can start debugging when you notice the program         misbehaving. The disadvantage of this approach is that you         have to jump through some hoops to see the program's output         to <CODE>stdout</CODE> and <CODE>stderr</CODE>. The         technique for doing this is explained <A HREF="#SeeingStdout">later         in this document</A>.</P>                  <P>The second approach lets you see your program's output to         <CODE>stdout</CODE> and <CODE>stderr</CODE> easily. You         should use it when you're actively debugging a problem.</P>                  <H4><A NAME=Attaching></A>Attaching to a Running         Process</H4>                  <P>Listing 1 shows how to attach GDB to a running process.         You start by launching Terminal and running GDB from the         command line (<B><CODE>gdb</CODE></B>). Once you've started         GDB you can either attach by name or by BSD process ID.         First you should try attaching by name (<B><CODE>attach         BBEdit</CODE></B>). This can fail for a variety of         reasons--in this example it failed because the application         is a CFM binary--in which case you should attach by BSD         process ID. You can find the BSD process ID using GDB's         <CODE>shell</CODE> command to execute the <CODE>ps</CODE>         command line tool. This example uses <CODE>grep</CODE> to         search the output (which would be rather large otherwise).         The first column of numbers is the BSD process ID. You can         use that BSD process ID to attach to the process         (<B><CODE>attach 795</CODE></B>).</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 1</B>. Attaching to a running                  process</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>[localhost:~] quinn% <B>gdb</B>[... output omitted ...](gdb) <B>attach BBEdit</B>Unable to locate process named &quot;BBEdit&quot;.(gdb) <B>shell ps auxww | grep BBEdit</B>quinn   823   [...] -csh -c ps auxww | grep BBEdit (tcsh)quinn   795   [...] /Volumes/YipYip/MyApplications/BBEdit [...](gdb) <B>attach 795</B>[... output omitted ...](gdb)</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  A BSD process ID (PID) is the BSD way of                  identifying a process. It is not the same as a                  Carbon Process Serial Number (PSN), although there                  are routines to map between the two in                  "Processes.h".</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  To attach to a running application either it must                  by owned by you or you must have root                  privileges.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  The <CODE>attach</CODE> command supports Tab                  completion. If you type a partial process name and                  press Tab, GDB will complete the full name.</P>               </TD>            </TR>         </table><BR></CENTER>                  <H4><A NAME=RunningWithinGDB></A>Running Your Program From         Within GDB</H4>                  <P>Running a program from within GDB requires different         actions depending on the program's binary format. For Mach-O         programs you can simply enter the path to the executable on         the command line as you launch GDB. This is shown in Listing         2. GDB will stop after reading the program's symbols. You         can then set breakpoints, or just run the program         (<B><CODE>r</CODE></B>).</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 2</B>. Running a Mach-O program                  under GDB</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>[localhost:~] quinn% <B>gdb /Applications/TextEdit.app/\Contents/MacOS/TextEdit</B>[... output omitted ...](gdb) <B>r</B></pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  You must enter the path to the executable, not the                  package. For example, enter                  "/Applications/TextEdit.app/Contents/MacOS/TextEdit"                  and not "/Applications/TextEdit.app".</P>               </TD>            </TR>         </table><BR></CENTER>                  <P>If your program is built as a CFM binary you must do a         little more work. Rather than pointing GDB at the         application itself, you must point it at the CFM loader         program (LaunchCFMApp) that is responsible for loading and         running the CFM application. Listing 3 shows how this is         done. You must enter the path to the CFM binary (again, this         is the executable, not the package) as an argument to the         run (<CODE>r</CODE>) command. This tells LaunchCFMApp which         CFM application you want to launch.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 3</B>. Running a CFM program                  under GDB</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>[localhost:~] quinn% <B>gdb /System/Library/Frameworks/\Carbon.framework/Versions/A/Support/LaunchCFMApp</B>[... output omitted ...](gdb) <B>r /Applications/Internet\ Explorer/\Internet\ Explorer.app/Contents/MacOS/Internet\ Explorer</B></pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <H4>Breaking into GDB and Entering Commands</H4>                  <P>To stop your program in the debugger, just switch to the         appropriate Terminal window and enter ^C. All the threads in         your program will stop and GDB will present you with the         <CODE>(gdb)</CODE> prompt. Your program will immediately         stop responding to events (if you trying to click on one of         its windows you will get the spinning rainbow beach ball         cursor of death&#153;). You can continue executing your         program with the continue command (<B><CODE>c</CODE></B>).         Listing 4 shows this entire process.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 4</B>. Stopping and continuing                  a program</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>^CProgram received signal SIGINT, Interrupt.0x700009a8 in mach_msg_overwrite_trap ()(gdb) <B>c</B>Continuing.</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <P>When you see the GDB prompt you can enter GDB commands.         GDB accepts commands in much the same way as MacsBug. You         type the name of the command followed by any command         arguments and then press Return to execute the command. Like         MacsBug, GDB supports command line <A HREF="#Editing">editing         and history</A>. You can also press Return to re-execute the         previous command. However, there are two significant         differences from the basic MacsBug command loop.</P>                  <UL>            <LI>MacsBug commands tend to be short and cryptic. GDB            commands, on the other hand, are long and explanatory.            Fortunately, you don't have to type the entire command.            Any unambiguous abbreviation of the command will do. For            example, the full command to see the registers is            <CODE>info registers</CODE>. A more succinct abbreviation            is <CODE>info reg</CODE>. However, if you really hate            typing you can abbreviate this all the way down to            <CODE>i r</CODE>. GDB has special logic that allows one            letter commands to work properly even if they are            ambiguous. For example, even though <CODE>c</CODE> is the            first letter of many commands, it is always interpreted            as (the very commonly used) <CODE>continue</CODE>            command. Finally, pressing Tab will autocomplete an            unambiguous command and pressing Tab twice will list            alternatives for an ambiguous command.</LI>                        <LI>In MacsBug you can type an expression on the command            line and MacsBug will evaluate it and display the result.            GDB requires you to do something with the expression. If            you want to see its value, simply print it using the            <CODE>print</CODE> command (or <CODE>p</CODE> for short).            Unlike MacsBug, the print command only displays the            results in one format at a time. To control that format,            append a '/' and a format specifier ('o' for octal, 'x'            for hex, 'd' for decimal, 'u' for unsigned decimal, 't'            for binary, 'f' for float, 'a' for address, 'c' for            char). You can also append a size qualifier ('b' for 1            byte, 'h' for 2 bytes, 'w' for 4 bytes, 'g' for 8            bytes).</LI>         </UL>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-power</CODE></P>               </TD>               <td align="left">                  <P><CODE>^C</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>G</CODE> or <CODE>command-G</CODE></P>               </TD>               <td align="left">                  <P><CODE>c</CODE> [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>HELP &lt;command&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>help &lt;command&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>apropos &lt;regex&gt;</CODE>                  [3]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;expr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>p/x &lt;expr&gt;</CODE> [4]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>You must enter <CODE>^C</CODE> in the Terminal window            in which you're running GDB.</LI>                        <LI><CODE>c</CODE> is short for            <CODE>continue</CODE>.</LI>                        <LI><CODE>apropos</CODE> will print all GDB help entries            that match the regular expression. This is really useful            if you're totally lost. For example, lets say you want            change the default radix for numbers input and printed by            GDB. <CODE>help radix</CODE> is no help at all, but            <CODE>apropos radix</CODE> is very useful.</LI>                        <LI><CODE>p</CODE> is short for <CODE>print</CODE>, while            <CODE>/x</CODE> specifies that the number should be            printed in hex. You can use any of the format specifiers            listed above.</LI>         </OL>                  <H4>Stopping Debugging</H4>                  <P>You can stop debugging in a variety of ways.</P>                  <UL>            <LI>Quit your program -- GDB continues to run but is no            longer attached to your program</LI>                        <LI>Detach from your program (using GDB's            <CODE>detach</CODE> command) -- GDB will keep running but            the connection between it and your program is            broken.</LI>                        <LI>Force quit your program (using GDB's            <CODE>kill</CODE> command) -- This is akin to the MacsBug            <CODE>ES</CODE> command. Your program dies but GDB keeps            running.</LI>                        <LI>Quit GDB (using GDB's <CODE>quit</CODE> command) --            If you quit GDB while it's still attached to your            program, GDB will either force quit it (if you ran the            program from within GDB) or detach from it (if you            attached to it) before quitting.</LI>         </UL>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>ES</CODE></P>               </TD>               <td align="left">                  <P><CODE>kill</CODE></P>               </TD>            </TR>         </table><BR>                  <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=Section2></A></P>                  <H2>MacsBug To GDB Reference</H2>                  <P>The following sections describe the GDB equivalent for         various MacsBug constructs. The sections are structured         along similar lines to the MacsBug online help.</P>                  <H3><A NAME=Editing></A>Editing</H3>                  <P>GDB supports command-line editing in much the same way as         MacsBug, but of course all the key bindings are different.         You can configure the GDB key bindings--see the <A HREF="#references">GDB         manual</A> for more information on this--but the default         configuration is described below.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>left arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>left arrow</CODE> or <CODE>^B</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>right arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>right arrow</CODE> or ^F</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>option-left arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>escape B</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>option-right arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>escape F</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>option-delete</CODE></P>               </TD>               <td align="left">                  <P><CODE>escape delete</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-left arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>^A</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-right arrow</CODE></P>               </TD>               <td align="left">                  <P><CODE>^E</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-delete</CODE></P>               </TD>               <td align="left">                  <P><CODE>^U</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-V</CODE></P>               </TD>               <td align="left">                  <P><CODE>up arrow</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>command-B</CODE></P>               </TD>               <td align="left">                  <P><CODE>down arrow</CODE></P>               </TD>            </TR>         </table><BR>                  <H3>Selecting Procedure Names</H3>                  <P>Like MacsBug, GDB is smart enough to find some symbols         even if the program wasn't compiled with debugger symbols.         You can learn more about accessing symbols in the <A HREF="#Symbols">Symbols</A>         section later in this document.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P>command-D or command-;</P>               </TD>               <td align="left">                  <P>Tab Tab [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P>info func &lt;regex&gt; [2]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>The first Tab tries to complete the symbol; if there            is no unambiguous completion, the second Tab lists the            alternatives.</LI>                        <LI>This lists all the functions whose names match the            &lt;regex&gt;. Using an overly general regular expression            (for example, <CODE>info func .*</CODE>) can take a very            long time if your program uses large system frameworks            (for example, the Carbon framework).</LI>         </OL>                  <H3>Values</H3>                  <P>For an experienced MacsBug user GDB values are hard to         get used to. You must remember to use $ in front of any         register names you use. By default a numeric constant is in         decimal (not hex), and you must prefix hex numbers with 0x         and not $ ($ is used for registers, the <A HREF="#ValueHistory">value         history</A> and GDB <A HREF="#playmem">convenience         variables</A>). There's also no support for unit suffixes         (K, M, G, and &szlig;). Finally, $_ behaves much the same as         "<CODE>.</CODE>" in MacsBug (it's the last address examined         by "<CODE>x</CODE>"), while $__ is like         "<CODE>.^</CODE>".</P>                  <P><A NAME=ValueHistory></A>One nice feature of GDB is the         value history. Every time you print an expression GDB prints         the value of the expression along with a dollars sign ($)         and a number. You can use this dollars sign and number         combination to recall the value in subsequent expressions.         You can see an example of this in Listing 5.</P>                  <P>GDB also supports convenience variables, which are         discussed in more detail <A HREF="#playmem">later in this         technote</A>.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;register&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>$&lt;register&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>$&lt;hexnum&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>0x&lt;hexnum&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>#&lt;decnum&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&lt;decnum&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>K</CODE>, <CODE>M</CODE>, <CODE>G</CODE>                  and <CODE>&szlig;</CODE> (postfix)</P>               </TD>               <td align="left">                  <P>not supported</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>.</CODE></P>               </TD>               <td align="left">                  <P><CODE>$_</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&#133;</CODE> (option-;)</P>               </TD>               <td align="left">                  <P>not supported</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>:</CODE></P>               </TD>               <td align="left">                  <P>not supported</P>               </TD>            </TR>         </table><BR>                           <CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  GDB does let you change the default input and                  output radix. Type <CODE>apropos radix</CODE> for                  details.</P>               </TD>            </TR>         </table><BR>         </CENTER>                  <H3>Expressions and Operators</H3>                  <P>GDB uses a C-like syntax for its expressions, so it         shouldn't be hard for you to pick up. One big difference         between this and MacsBug is that each GDB expression has an         associated type. For example, GDB knows that the type of         <CODE>argv</CODE> is a pointer to a pointer to a character.         If you use it in an expression, GDB can work out the type of         the result--GDB knows that <CODE>**argv</CODE> is a         character. Thus, MacsBug's naive implementation of the         indirection operation (@ or ^) is replaced by the GDB's         C-like operator (*) which carries type information with it.         This means that you usually don't need MacsBug's size         postfix operators (<CODE>.B</CODE>, <CODE>.W</CODE>, and         <CODE>.L</CODE>) because GDB already knows the right size of         an indirection. If necessary you can override GDB's type         information by using a cast. Some examples of this are shown         in Listing 5.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 5</B>. Using casts in                  expressions.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre> <I>$r3 is an integer, but you can cast it.</I>(gdb) <B>p/x *(char *)$r3</B>$6 = 0x0(gdb) <B>p/x *(short *)$r3</B>$7 = 0x3(gdb) <B>p/x *(int *)$r3</B>$8 = 0x3e360 <I>You can also use the brace notation when printing.</I>(gdb) <B>p/x {char}$r3</B>$9 = 0x0(gdb) <B>p/x {short}$r3</B>$10 = 0x3(gdb) <B>p/x {long}$r3</B>$11 = 0x3e360 <I>Accessing the value history.</I>(gdb) <B>p/x $11</B>$12 = 0x3e360</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  GDB's indirection operation (*) is more lenient                  that an ANSI C compiler in that it will let you                  treat an integer value as a pointer. So an                  expression like *0x01000 works in GDB, but wouldn't                  work in C without a cast.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  GDB's expression syntax is actually dependent on                  the language you're debugging. However, when you're                  debugging without source the default C-like syntax                  applies.</P>               </TD>            </TR>         </table><BR></CENTER>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>+</CODE></P>               </TD>               <td align="left">                  <P><CODE>+</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>-</CODE></P>               </TD>               <td align="left">                  <P><CODE>-</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>*</CODE></P>               </TD>               <td align="left">                  <P><CODE>*</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>/</CODE> or <CODE>&#247;</CODE></P>               </TD>               <td align="left">                  <P><CODE>/</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MOD</CODE></P>               </TD>               <td align="left">                  <P><CODE>%</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>AND</CODE> or <CODE>&amp;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&amp;</CODE> or <CODE>&amp;&amp;</CODE>                  [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>OR</CODE> or <CODE>|</CODE></P>               </TD>               <td align="left">                  <P><CODE>|</CODE> or <CODE>||</CODE>                  [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>NOT</CODE> or <CODE>!</CODE></P>               </TD>               <td align="left">                  <P><CODE>~</CODE> or <CODE>!</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>XOR</CODE></P>               </TD>               <td align="left">                  <P><CODE>^</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;&lt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&lt;&lt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&gt;&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&gt;&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>=</CODE> or <CODE>==</CODE></P>               </TD>               <td align="left">                  <P><CODE>==</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;&gt;</CODE> or <CODE>!=</CODE> or                  <CODE>&ne;</CODE></P>               </TD>               <td align="left">                  <P><CODE>!=</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&lt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;=</CODE></P>               </TD>               <td align="left">                  <P><CODE>&lt;=</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&gt;=</CODE></P>               </TD>               <td align="left">                  <P><CODE>&gt;=</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>@</CODE> (prefix) or <CODE>^</CODE>                  (postfix)</P>               </TD>               <td align="left">                  <P><CODE>*</CODE> (prefix)</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>.B</CODE></P>               </TD>               <td align="left">                  <P>not supported [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>.W</CODE></P>               </TD>               <td align="left">                  <P>not supported [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>.L</CODE></P>               </TD>               <td align="left">                  <P>not supported [2]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>MacsBug makes no distinction between bitwise and            logical operators (AND and &amp; are identical). GDB            supports both types, with the standard C syntax.</LI>                        <LI>You can achieve the same effect with a cast, as shown            in Listing 5.</LI>         </OL>                  <H3>Flow Control</H3>                  <P>GDB has much the same flow control facilities as MacsBug.         Note that the commands with a trailing 'i' (the 'i' stands         for instruction) work at the assembly level and step one         instruction at a time. You must use these variants when         debugging without source. When stepping one instruction at a         time, you might want to use the <CODE>display</CODE> command         (as shown in Listing 6) to display the current instruction         after each command. Alternatively, activate the <A HREF="#MacsBugGDBPlugin">MacsBug         GDB plug-in</A>.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 6</B>. Using                  <CODE>display</CODE> when stepping through                  instructions</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>Breakpoint 1, 0x70268f8c in HLock ()(gdb) <B>display/i $pc</B>2: x/i $pc  0x70268f8c &lt;HLock&gt;: mflr    r0(gdb) <B>si</B>0x70268f90 in HLock ()2: x/i $pc  0x70268f90 &lt;HLock+4&gt;:       stw     r0,8(r1)(gdb) <B>si</B>0x70268f94 in HLock ()2: x/i $pc  0x70268f94 &lt;HLock+8&gt;:       stwu    r1,-64(r1)(gdb) </pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200" HEIGHT=12>                  <P ALIGN=left>MacsBug</P>               </TH>               <TH HEIGHT=12>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>G</CODE> or <CODE>command-G</CODE></P>               </TD>               <td align="left">                  <P><CODE>continue</CODE> or <CODE>c</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>G &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>jump *&lt;addr&gt;</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>GG</CODE></P>               </TD>               <td align="left">                  <P><CODE>delete</CODE> [2]<BR>                  <CODE>continue</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>GTP &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>tbreak *&lt;addr&gt;<BR>                  continue</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>S</CODE> or <CODE>command-S</CODE></P>               </TD>               <td align="left">                  <P><CODE>step</CODE> or <CODE>s</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>stepi</CODE> or <CODE>si</CODE>                  [3] [4]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SO</CODE> or <CODE>T</CODE> or                  <CODE>command-T</CODE></P>               </TD>               <td align="left">                  <P><CODE>next</CODE> or <CODE>n</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>nexti</CODE> or <CODE>ni</CODE>                  [3] [4]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MRP</CODE></P>               </TD>               <td align="left">                  <P><CODE>finish</CODE> [5]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>tbreak *$lr<BR>                  continue</CODE> [6]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI><A NAME=StarExplanation></A>Because GDB's primary            focus is source-level debugging, the arguments to            commands like <CODE>jump</CODE> are normally a function            name, or a line number within a source file. If you want            to use an address, you have to prefix it with '*'. This            convention is used by a number of commands.</LI>                        <LI><CODE>delete</CODE> removes all breakpoints. You have            to confirm this action unless you turn off confirmation            using <CODE>set confirm off</CODE>.</LI>                        <LI>Commands ending with 'i' operate one instruction at a            time.</LI>                        <LI>You should use <CODE>si</CODE> for stepping through            normal instructions. Only use <CODE>ni</CODE> for            instructions that specifically call a function (typically            the <CODE>bl</CODE> instruction). Using <CODE>ni</CODE>            for other instructions can have weird side effects; for            example, if the current PC is at a <CODE>mflr</CODE>            instruction, <CODE>ni</CODE> mistakenly works like a            magic return [2787251].</LI>                        <LI><CODE>finish</CODE> works properly only if you have            source for the current routine.</LI>                        <LI>This assumes that the return address is still in            LR.</LI>         </OL>                  <H3>Breakpoints, A-Trap Breaks, and TVector Breaks</H3>                  <P>GDB has comprehensive support for breakpoint. In addition         to the MacsBug equivalent commands listed below, you also         have the <CODE>fb</CODE> (future break) command which allows         you to set a breakpoint on a symbol that isn't yet loaded.         The breakpoint will be set when the code containing the         symbol is loaded. This is a very useful technique for         setting a breakpoint in a dynamically loaded plug-in.</P>                  <P>You can create thread-specific breakpoints. These         breakpoints only trigger if a particular thread executes the         specified code. See the section on <A HREF="#Threads">threads</A>         later in this technote for an example of how to do this.</P>                  <P>Another cool GDB feature is that you can enable and         disable breakpoints without actually deleting them (using         the <CODE>enable</CODE> and <CODE>disable</CODE> commands).         This lets you run your program for a time without disrupting         your breakpoint state.</P>                  <P>A final cool feature of GDB breakpoints is the ability to         save breakpoints to a file (using the         <CODE>save-breakpoints</CODE> command) and restore them         later (using the <CODE>source</CODE> command). This makes it         easy to retain your breakpoint state between GDB         sessions.</P>                  <P>GDB has no support for A-traps because there's no trap         dispatcher in Mac OS X. Furthermore, there's no support for         TVector breaks because TVectors are a CFM construct and GDB         knows very little about CFM. This isn't a problem though:         you can use normal breakpoints instead of A-trap and TVector         breaks.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRP &lt;function&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>b &lt;function&gt;</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRP &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>b *&lt;addr&gt;</CODE> [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRP &lt;addr&gt;                  &lt;condition&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>b *&lt;addr&gt; if                  &lt;condition&gt;</CODE> [3]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRP &lt;addr&gt; &lt;count&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>b *&lt;addr&gt;<BR>                  ignore $bpnum &lt;count&gt;</CODE> [4]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRP &lt;addr&gt; ;                  &lt;statement&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>b *&lt;addr&gt;<BR>                  command $bpnum<BR>                  &gt; &lt;statement&gt;<BR>                  &gt; end</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRC &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>clear *&lt;addr&gt;</CODE> [5]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRC</CODE></P>               </TD>               <td align="left">                  <P><CODE>delete</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>BRD</CODE></P>               </TD>               <td align="left">                  <P><CODE>info break</CODE></P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>If you break at the beginning of a function you can            use <CODE>tbreak $lr</CODE> followed by <CODE>c</CODE> to            step out of the function.</LI>                        <LI>As described in the <A HREF="#StarExplanation">previous            section</A>, if you want to set a breakpoint on a            specific address, you have to use the "*" syntax. For            example, to break on the address $12345678, you use the            command <CODE>b *0x12345678</CODE>.</LI>                        <LI>You can use the <CODE>condition</CODE> command to            change the condition associated with a breakpoint at any            time.</LI>                        <LI><CODE>$bpnum</CODE> is a convenience variable that            returns the number of the last breakpoint created.            Convenience variables have no direct analogue in MacsBug.            They are explained in detail in the <A HREF="#references">GDB            manual</A>. Convenience variables can be helpful in            places where you'd use MacsBug's <A HREF="#playmem"><CODE>playmem</CODE></A>.</LI>                        <LI>It's normally easier to clear a breakpoint by number            (using <CODE>delete &lt;x&gt;</CODE>, where            <CODE>&lt;x&gt;</CODE> is the breakpoint number) than by            address. If you can't remember the breakpoint number, the            <CODE>info break</CODE> command prints it for each            breakpoint.</LI>         </OL>                  <H3>Watch Points</H3>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>WP</CODE></P>               </TD>               <td align="left">                  <P>not supported [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>WPC</CODE></P>               </TD>               <td align="left">                  <P>not supported [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>WPD</CODE></P>               </TD>               <td align="left">                  <P>not supported [1]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>GDB does support watchpoints (use <CODE>apropos            watch</CODE> to learn about the commands) but this            support does not currently work on Mac OS X            [2762873]. Then again, my experience with            watchpoints under MacsBug is that they were kind of flaky.            Until GDB's watchpoint support is fixed you have to find            random memory corruption the hard way (by applying            conditional breakpoints to get a rough idea of who's            responsible and then stepping through code).</LI>         </OL>                  <H3>Disassembly</H3>                  <P>For a MacsBug user, GDB's <CODE>disassemble</CODE>         command is hard to get used to: if you only supply one         argument, it disassembles the entire function containing the         address specified by the argument. To disassemble something         smaller than a function you have to use two arguments to         specify a range of addresses. Alternatively, if you just         want to disassemble a few instructions, the examine         (<CODE>x</CODE>) command with the instruction format         modifier (<CODE>/i</CODE>) is easier.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>ILP &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>x/8i &lt;addr&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>ILP &lt;addr&gt; &lt;len&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>disas &lt;addr&gt;                  &lt;addr&gt;+&lt;len&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>IPP PC</CODE></P>               </TD>               <td align="left">                  <P><CODE>disas $pc-20 $pc+20</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>x/20i $pc-40</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>IRP &lt;function&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>disas &lt;function&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DHP &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P>not supported; you can use <A HREF="#playmem"><CODE>playmem</CODE></A>                  to work around this</P>               </TD>            </TR>         </table><BR>                  <H3>Emulator</H3>                  <P>What emulator?</P>                  <H3>Heaps</H3>                  <P>There is no direct support for debugging heap zones in         GDB. However, you can call heap checking functions in         various memory management libraries. For example, Listing 7         shows how to call some of the debug functions in the System         framework memory library.</P>                  <CENTER id=p1><TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  This technique is not without its perils. See                  <A HREF="#Calling">The Dangers of Calling                  Functions</A> for details.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 7</B>. Using <CODE>call</CODE>                  for heap debugging</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre> <I>Prints the list of heap zones, ala MacsBug &quot;HZ&quot;.</I>(gdb) <B>call (void) malloc_zone_print(0, 0)</B>Scalable zone 0x5010: inUse=10056(2815KB) small=10027(1227KB) [...]5 regions:Region [0x5000-0x45000, 256KB]  In_use=2472Region [0x1387000-0x13c7000, 256KB]     In_use=4110Region [0x13f8000-0x1438000, 256KB]     In_use=1647Region [0x154a000-0x158a000, 256KB]     In_use=1064Region [0x16a3000-0x16e3000, 256KB]     In_use=734Free in last zone 26898Scalable zone 0xf4f010: inUse=645(85KB) small=645(85KB) [...]1 regions:Region [0xf4f000-0xf8f000, 256KB]       In_use=645Free in last zone 158402 <I>Prints a detailed dump of each zone, ala MacsBug &quot;HD&quot;. If youjust want to dump one zone, supply it at the first parameter.</I>(gdb) <B>call (void) malloc_zone_print(0, 1)</B>Scalable zone 0x5010: inUse=10056(2815KB) small=10027(1227KB) [...]5 regions:Region [0x5000-0x45000, 256KB]  In_use=2472        Sizes in use: 16[282] 32[1136] 48[344] 64[183] 80[130] [...]Region [0x1387000-0x13c7000, 256KB]     In_use=4110        Sizes in use: 16[360] 32[2041] 48[1088] 64[172] 80[228] [...]Region [0x13f8000-0x1438000, 256KB]     In_use=1647        Sizes in use: 16[316] 32[590] 48[211] 64[108] 80[75] [...]Region [0x154a000-0x158a000, 256KB]     In_use=1064        Sizes in use: 16[281] 32[330] 48[127] 64[65] 80[51] [...]Region [0x16a3000-0x16e3000, 256KB]     In_use=734        Sizes in use: 16[46] 32[225] 48[72] 64[26] 80[17] [...]Free Sizes: &gt;=1024[5] 592[1] 576[1] 400[1] 32[2] 16[8]Free in last zone 26898Scalable zone 0xf4f010: inUse=645(85KB) small=645(85KB)  [...]1 regions:Region [0xf4f000-0xf8f000, 256KB]       In_use=645        Sizes in use: 16[1] 32[373] 48[122] 64[47] 80[34] [...]Free Sizes: &gt;=1024[3] 768[1] 160[1] 128[1] 80[4] 64[2] 16[23]Free in last zone 158402 <I>Determines which zone a pointer is in.</I>(gdb) <B>call (void) malloc_zone_print_ptr_info(0x16a3000)</B>ptr 0x16a3000 in registered zone 0x5010 <I>Checks all heap zones (or a specific zone if you supplyit as a parameter), ala MacsBug &quot;HC ALL&quot;.</I>(gdb) <B>call (int) malloc_zone_check(0)</B>$18 = 1 <I>Deliberately destroy our heap.</I>(gdb) <B>call (void) memset(0x16a3000, 0, 256)</B> <I>Recheck the heap. Houston control, we have a problem.</I>(gdb) <B>call (int) malloc_zone_check(0)</B>*** malloc[988]: invariant broken at region end: ptr=0x16a3010 [...]*** malloc[988]: Region 4 incorrect szone_check_all() counter=3*** malloc[988]: error: Check: region incorrect$19 = 0</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  Remember that GDB might not be the right tool for                  debugging heap problems. Mac OS X has a number of                  really cool heap debugging tools that are                  independent of GDB. Check out <a href="http://developer.apple.com/documentation/macosx/Essentials/devessentials.html">Inside                  Mac OS X: Performance</A> for details.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  The zones shown in Listing 7 are not Memory Manager                  zones but a different concept (with the same name)                  supported by the System framework memory library.                  Memory Manager zones are not supported under                  Carbon.</P>               </TD>            </TR>         </table><BR></CENTER>                  <H3><A NAME=Symbols></A>Symbols</H3>                  <P>GDB, being a source-level debugger, has a gazillion         commands to control how symbols are handled. Type         <CODE>apropos symbol</CODE> to see them all. Their         description is beyond the scope of this document. The         <A HREF="#references">GDB manual</A> has all the gory         details.</P>                  <H3>Stack</H3>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SC</CODE> or <CODE>SC6</CODE></P>               </TD>               <td align="left">                  <P><CODE>bt</CODE> [1] [2]                  [3]</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI><CODE>bt</CODE> is short for            <CODE>backtrace</CODE>.</LI>                        <LI>GDB has no equivalent for SC7 but you rarely need it            because virtually all Mac OS X code is written in a            high-level language and thus <CODE>bt</CODE> works            (almost) always.</LI>                        <LI>By default <CODE>bt</CODE> crawls the current            thread's stack. There are commands to work with different            threads within your process. For example, you can use            <CODE>thread apply all bt</CODE> to get a backtrace of            all threads. See the discussion on <A HREF="#Threads">threads</A>            later in this document for more details.</LI>         </OL>                  <H3>Memory</H3>                  <P>GDB's <CODE>x</CODE> (examine) command is the direct         equivalent of MacsBug's <CODE>DM</CODE> command.         <CODE>x</CODE> works much like <CODE>print</CODE> in that         you can append a '/' and then a format specifier ('o' for         octal, 'x' for hex, 'd' for decimal, 'u' for unsigned         decimal, 't' for binary, 'f' for float, 'a' for address, 'c'         for char) and optionally a size qualifier ('b' for 1 byte,         'h' for 2 bytes, 'w' for 4 bytes, 'g' for 8 bytes). The x         command supports two additional format qualifiers that         aren't supported by <CODE>print</CODE> ('s' for string, 'i'         for instruction). It also supports a repeat counter. Listing         8 shows some examples of using the <CODE>x</CODE>         command.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 8</B>. Some examples of using                  the <CODE>x</CODE> command.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre> <I>Stop at SetMenuItemText.  $r5 is the itemString parameter.</I>Breakpoint 1, 0x738087cc in SetMenuItemText () <I>Print itemString as a C string.  This usually works pretty well.</I>(gdb) <B>x/s $r5</B>0xbffff1e8:      &quot;\005Close&quot; <I>Print itemString as a sequence of characters. Note the use of 'c' as a format qualifier and 5 as a repeat count.</I>(gdb) <B>x/5c $r5+1</B>0xbffff1e9:     67 'C'  108 'l' 111 'o' 115 's' 101 'e' <I>Print the first byte of itemString as binary.</I>(gdb) <B>x/tb $r5</B>0xbffff1e8:     00000101 <I>And the first half word.</I>(gdb) <B>x/th $r5</B>0xbffff1e8:     0000010101000011 <I>And the first word.</I>(gdb) <B>x/tw $r5</B>0xbffff1e8:     00000101010000110110110001101111 <I>Note how both the format specifier and size qualifier are 'sticky'.</I>(gdb) <B>x/t $r5</B>0xbffff1e8:     00000101010000110110110001101111(gdb) <B>x $r5</B>0xbffff1e8:     00000101010000110110110001101111 Print the first word as hex.(gdb) <B>x/xw $r5</B>0xbffff1e8:     0x05436c6f <I>Hitting return on the blank line repeats the previous command. Like MacsBug this continues dumping the next memory location.</I>(gdb)0xbffff1ec:     0x73650000 <I>You can use the 'i' format specifier to disassemble. The repeat count is especially useful in this case.</I>(gdb) <B>x/i $pc</B>0x738087cc &lt;SetMenuItemText+20&gt;:        stw     r3,120(r30)(gdb) <B>x/4i $pc</B>0x738087cc &lt;SetMenuItemText+20&gt;:        stw     r3,120(r30)0x738087d0 &lt;SetMenuItemText+24&gt;:        mr      r0,r40x738087d4 &lt;SetMenuItemText+28&gt;:        stw     r5,128(r30)0x738087d8 &lt;SetMenuItemText+32&gt;:        sth     r0,124(r30)</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DM &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>x/8xb &lt;addr&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DMA &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>x/4c &lt;addr&gt;</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DM &lt;addr&gt; &lt;type&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>p {&lt;type&gt;}&lt;addr&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DM &lt;addr&gt; pstring</CODE></P>               </TD>               <td align="left">                  <P><CODE>x/s &lt;addr&gt;</CODE> [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>TMP &lt;template&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>info type &lt;regex&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SB &lt;addr&gt; &lt;val&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>set *((char *) &lt;addr&gt;) =                  &lt;val&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SW &lt;addr&gt; &lt;val&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>set *((short *) &lt;addr&gt;) =                  &lt;val&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SL &lt;addr&gt; &lt;val&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>set *((int *) &lt;addr&gt;) =                  &lt;val&gt;</CODE></P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>This is actually a pretty lame substitute for DMA.            See the MacsBug GDB plug-in for a user-defined command            that implements this properly.</LI>                        <LI>This actually prints a C string, but it works pretty            well most of the time for pstrings. <CODE>x/8c            &lt;addr&gt;</CODE> is not a good substitute because it's            hard to read the separate characters as a string.            Probably the best way print a pstring is with a            user-defined command.</LI>         </OL>                  <H3>Registers</H3>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&lt;register&gt;=&lt;value&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>set $&lt;register&gt; =                  &lt;value&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>TD</CODE></P>               </TD>               <td align="left">                  <P><CODE>info reg</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>TF</CODE> or <CODE>TV</CODE></P>               </TD>               <td align="left">                  <P><CODE>info all-reg</CODE></P>               </TD>            </TR>         </table><BR>                  <H3>Macros</H3>                  <P>GDB supports user-defined commands that are much more         powerful than MacsBug macros. User-defined commands can span         multiple lines, and can include control flow statements like         <CODE>if</CODE> and <CODE>while</CODE> (see the <A HREF="#references">GDB         manual</A> for details on these). They can't, however, be         used in expressions, which is sometimes inconvenient.</P>                  <P>You can use the <CODE>source</CODE> command to run a file         containing GDB commands as if you'd typed them in at the         prompt. GDB automatically sources the ".gdbinit" file in         your home directory and the current directory when you start         it. This allows you to define persistent user-defined         commands, much like adding a macro to your MacsBug "Debugger         Prefs" file.</P>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MC &lt;name&gt;                  &lt;expansion&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>define &lt;name&gt;<BR>                  &gt; &lt;expansion&gt;<BR>                  &gt; end</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>&reg;1</CODE> through                  <CODE>&reg;9</CODE></P>               </TD>               <td align="left">                  <P><CODE>$arg0</CODE> through <CODE>$arg9</CODE>,                  <CODE>$argc</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MCC</CODE></P>               </TD>               <td align="left">                  <P>no equivalent</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MCD &lt;name&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>help user-defined</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>show user</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>show user &lt;name&gt;</CODE></P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>You can provide help for your user-defined commands            using the <CODE>document</CODE> command. This is            especially useful if you need help remember how to use            some complex command you put in your ".gdbinit" file six            months ago. See the <A HREF="#references">GDB manual</A>            for details.</LI>         </OL>                  <H3>Miscellaneous</H3>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>ES</CODE></P>               </TD>               <td align="left">                  <P><CODE>kill</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>WH &lt;addr&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>p/a &lt;addr&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>info sym &lt;addr&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>FILL &lt;addr&gt; &lt;num&gt; \<BR>                  &lt;val&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void) memset(&lt;addr&gt;,                  &lt;val&gt;, &lt;num&gt;)</CODE> [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SHOW</CODE></P>               </TD>               <td align="left">                  <P>you can probably achieve the results you need                  with <CODE>display</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>DV</CODE></P>               </TD>               <td align="left">                  <P><CODE>show version</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>STOPIF</CODE></P>               </TD>               <td align="left">                  <P>GDB supports real <CODE>if</CODE> and                  <CODE>while</CODE> statements, see the <A HREF="#references">GDB                  manual</A></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>HELP &lt;command&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>help &lt;command&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>apropos &lt;regex&gt;</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>HELP &lt;template&gt;</CODE></P>               </TD>               <td align="left">                  <P><CODE>ptype &lt;type&gt;</CODE></P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>This technique is not without its perils. See            <A HREF="#Calling">The Dangers of Calling Functions</A>            for details.</LI>         </OL>                  <H3>DCMDs</H3>                  <CENTER id=p1><TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  This section makes heavy use of GDB's ability to                  call arbitrary functions within a process. Many of                  these functions were specifically designed to                  support debugging. The list of functions changes                  over time. To see the latest list, search for all                  functions containing "DebugPrint" or "GDB" (use                  <CODE>info func DebugPrint</CODE> and <CODE>info                  func GDB</CODE>).</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  This technique is not without its perils. See                  <A HREF="#Calling">The Dangers of Calling                  Functions</A> for details.</P>               </TD>            </TR>         </table><BR></CENTER>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="200">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>AEDesc</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  GDBPrintHelpDebuggingAppleEvents()</CODE>                  [1]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>Evt</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  GDBPrintEventQueue()</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>Zap</CODE></P>               </TD>               <td align="left">                  <P>see discussion of <CODE>MallocScribble</CODE>                  environment variable in <a href="http://developer.apple.com/documentation/macosx/Essentials/devessentials.html">Inside                  Mac OS X: Performance</A></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>Leaks</CODE></P>               </TD>               <td align="left">                  <P>see discussion of MallocDebug application and                  <CODE>leaks</CODE> command line tool in <a href="http://developer.apple.com/documentation/macosx/Essentials/devessentials.html">Inside                  Mac OS X: Performance</A></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>Layers</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  DebugPrintAllWindowGroups()<BR>                  call (void)                  DebugPrintWindowGroup(&lt;group&gt;)</CODE>                  [2]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>THING</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void) GDBComponentList()</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>FRAGS</CODE></P>               </TD>               <td align="left">                  <P><CODE>info target</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>info cfm</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>info dyld</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>info sharedlibrary</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>ECHO</CODE> or <CODE>PRINTF</CODE></P>               </TD>               <td align="left">                  <P><CODE>echo</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>output</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>print</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>printf</CODE></P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>EBBE</CODE></P>               </TD>               <td align="left">                  <P>not need because $0 through $FFF are not mapped                  for normal applications</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>MLIST</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void) DebugPrintMenuList()<BR>                  call (void) DebugPrintMenu(&lt;menu&gt;)</CODE>                  [3]<BR>                  <CODE>call (void) DebugPrintMenuItem(&lt;menu&gt;,                  &lt;item&gt;)</CODE> [3]</P>               </TD>            </TR>            <TR>               <td width=200 align=left>                  <P><CODE>SCREAM</CODE></P>               </TD>               <td align="left">                  <P>see the discussion on <A HREF="#Threads">threads</A>                  later in this document</P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>This prints out information about how to display            Apple event descriptors. The instructions vary depending            on the system version.</LI>                        <LI>You can determine <CODE>&lt;group&gt;</CODE> by            looking through the list of groups displayed by            <CODE>DebugPrintAllWindowGroups</CODE>.</LI>                        <LI>You can determine <CODE>&lt;menu&gt;</CODE> by            looking through the list of menus displayed by            <CODE>DebugPrintMenuList</CODE>.</LI>         </OL>                  <H3>Other Cool Stuff</H3>                  <TABLE BORDER=1 WIDTH="100%">            <TR>               <TH WIDTH="340">                  <P ALIGN=left>MacsBug</P>               </TH>               <TH>                  <P ALIGN=left>GDB</P>               </TH>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>WINDLIST</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void) DebugPrintWindowList()<BR>                  call (void)                  DebugPrintPlatformWindowList()</CODE></P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>DM &lt;port&gt; GrafPort</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  QDDebugPrintPortInfo(&lt;port&gt;)<BR>                  call (void)                  QDDebugPrintCGSInfo(&lt;port&gt;)</CODE>                  [1]</P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>DM &lt;window&gt; WindowRecord</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  DebugPrintWindow(&lt;window&gt;)</CODE></P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>DM &lt;control&gt;^                  ControlRecord</CODE></P>               </TD>               <td valign=top align=left>                  <P><CODE>call (void)                  GDBShowControlInfo(&lt;control&gt;)</CODE></P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P></P>               </TD>               <td align="left">                  <P><CODE>call (void)                  GDBShowControlHierarchy(&lt;window&gt;)</CODE></P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>PLAYMEM</CODE></P>               </TD>               <td align="left">                  <P>see <A HREF="#playmem">below</A></P>               </TD>            </TR>            <TR>               <td width=340 align=left>                  <P><CODE>&copy;&lt;func&gt;(&lt;param&gt;...)</CODE></P>               </TD>               <td align="left">                  <P><CODE>call (&lt;resulttype&gt;)                  &lt;func&gt;(&lt;param&gt;...)</CODE></P>               </TD>            </TR>         </table><BR>                  <P><B>Notes:</B></P>                  <OL>            <LI>You can determine the current port by calling            <CODE>GetQDGlobalsThePort</CODE>.</LI>         </OL>                  <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=Section3></A></P>                  <H2>Hints and Tips</H2>                  <P>This section contains miscellaneous hints and tips for         using GDB as an assembly-level debugger.</P>                  <H3><A NAME=SeeingStdout></A>Seeing stdout and stderr After         Attaching</H3>                  <P>If you <A HREF="#Attaching">attach GDB to a process</A>         (as opposed to starting the process from within GDB), you         won't be able to see anything that the process prints to         <CODE>stdout</CODE> or <CODE>stderr</CODE>. Programs         launched by the Finder typically have <CODE>stdout</CODE>         and <CODE>stderr</CODE> connected to "/dev/console", so the         information they print goes to the console. You can view         this by launching the Console application (in the Utilities         folder), however, it's inconvenient to have to look in a         separate window. Another alternative is to connect the         process's <CODE>stdout</CODE> or <CODE>stderr</CODE> to the         terminal device for GDB's Terminal window. Listing 9 shows         how to do this.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 9</B>. Connecting                  <CODE>stdout</CODE> and <CODE>stderr</CODE> to                  GDB's terminal device.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>(gdb) <B>attach 795</B>[... output omitted ...](gdb) <B>call (void) DebugPrintMenuList()</B> <I>No output )-:</I> <I>Close the stdout and stderr file descriptors.</I>(gdb) <B>call (void) close(1)</B>(gdb) <B>call (void) close(2)</B> <I>Determine the name of the terminal device for GDB itself.</I>(gdb) <B>shell tty</B>/dev/ttyp1 <I>Reopen stdout and stderr, but connected to GDB's terminal.</I> <I>The function results should be 1 and 2; if not, something</I> <I>is horribly wrong</I>.(gdb) <B>call (int) open(&quot;/dev/ttyp1&quot;, 2, 0)</B>$1 = 1(gdb) <B>call (int) open(&quot;/dev/ttyp1&quot;, 2, 0)</B>$2 = 2 <I>Try the DebugPrintMenuList again.</I>(gdb) <B>call (void) DebugPrintMenuList()</B> <I>Yay output!</I>Index MenuRef     ID  Title----- ---------- ---- -----&lt;regular menus&gt;00001 0x767725D3 -21629 Ed00002 0x76772627 1128 &lt;Apple&gt;00003 0x767726CF 1129 File00004 0x76772567 1130 Edit[... remaining output omitted ...]</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <H3><A NAME=RemoteDebugging></A>Remote Debugging</H3>                  <P>One of the nice features of GDB is that you can debug         your application across any TCP/IP network (including the         public Internet). You do this by logging into the remote         machine, running GDB on that machine, and then attaching to         the application you want to debug. This has two key         advantages.</P>                  <UL>            <LI>You can debug programs at remote sites; it no longer            matters if you can't reproduce the problem in your            office!</LI>                        <LI>You can debug things that are disrupted by the            debugger's user interface. Two interesting examples of            this are application suspend/resuming handling and Drag            Manager callbacks.</LI>         </UL>                  <P>Remote debugging has some caveats of which you should be         aware. Firstly, you must enable remote login on the remote         machine. The easiest way to do this is to check the Allow         Remote Login checkbox in the Sharing panel of System         Preferences. You can then log in to that machine by         launching Terminal on your local machine and using the         <CODE>ssh</CODE> command line program to log into the remote         machine. Obviously you have to have the user name and         password of an account on the remote machine. Once you have         logged into the remote machine you can use GDB in much the         same way as you would normally. Listing 10 shows an example         of this.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  Mac OS X 10.0 did not support <CODE>ssh</CODE>; you                  must use <CODE>telnet</CODE> instead. For more                  information on these commands, type <CODE>man                  ssh</CODE> and <CODE>man telnet</CODE> at the                  command line.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 10</B>. Using <CODE>ssh</CODE>                  to log in to a remote machine.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>[localhost:~] quinn% <B>ssh puppy.apple.com</B>quinn@puppy.apple.com's password:Welcome to Darwin!puppy&gt; <B>gdb</B>GNU gdb 5.0-20001113 (Apple version gdb-200) (Mon Sep  3 02:43:52 GMT 2001) (UI_OUT)Copyright 2000 Free Software Foundation, Inc.GDB is free software, covered by the GNU General Public License, and you arewelcome to change it and/or distribute copies of it under certain conditions.Type &quot;show copying&quot; to see the conditions.There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.This GDB was configured as &quot;powerpc-apple-macos10&quot;.(gdb) </pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR></CENTER>                  <P>Don't run a GUI application from within GDB when logged         in remotely. A GUI application needs to connect to system         services which aren't available if you run it from a remote         login session. If you need to debug a GUI application, have         the remote user launch the application from the Finder, then         start GDB in your <CODE>ssh</CODE> session and <A HREF="#Attaching">attach         to the running application</A>.</P>                  <H3>DebugStr</H3>                  <P>Mac OS X supports the standard <CODE>DebugStr</CODE> and         <CODE>Debugger</CODE> system calls. However, their default         behavior is to just print a message to <CODE>stderr</CODE>         and continue. You must take special steps if you want these         calls to stop program execution. Specifically, these         routines only stop in the debugger if you have set the         <CODE>USERBREAK</CODE> environment variable to 1. You can         set this environment variable in a number of ways.</P>                  <UL>            <LI>Command line -- Type the following shell command            before running GDB: <CODE>setenv USERBREAK 1</CODE>. You            must <A HREF="#RunningWithinGDB">run your application            from within GDB</A> for this to be effective.</LI>                        <LI>Within GDB -- Enter the following GDB command before            running your application: <CODE>set env USERBREAK            1</CODE>. You must <A HREF="#RunningWithinGDB">run your            application from within GDB</A> for this to be            effective.</LI>                        <LI>Programmatically -- You can set the            <CODE>USERBREAK</CODE> environment variable from within            your own program using the following C statement:            <CODE>setenv("USERBREAK", "1", true)</CODE>. You must do            this before any other part of your program calls            <CODE>DebugStr</CODE> or <CODE>Debugger</CODE>. Also,            this only works if you call the standard C library            <CODE>setenv</CODE> routine (in System framework); for            MSL CFM applications this means you should call the            Mach-O version of this function via CFBundle.</LI>         </UL>                  <P>Finally, the underlying mechanism used to stop your         program in the debugger when you call <CODE>DebugStr</CODE>         is the <CODE>raise</CODE> system call (part of System         framework). You can explicitly cause your program to stop         regardless of the setting of <CODE>USERBREAK</CODE> by         calling <CODE>raise(SIGINT)</CODE>.</P>                  <H3><A NAME=Calling></A>The Dangers of Calling         Functions</H3>                  <P>GDB, like MacsBug, lets you call functions within the         application you're debugging. Also like MacsBug, this         technique has its dangers. You should be aware of the         following things.</P>                  <UL>            <LI>The function executes within the context of your            program. If your program has crashed, there's no            guarantee that it will be in a fit state to execute the            function.</LI>                        <LI>You have to be very careful if you call a function            that has intricate dependencies. For example, if your            program has a mutex that protects a critical data            structure and you break into GDB while that mutex is            held, don't try to call a function that needs to acquire            the mutex.</LI>                        <LI>The function you call executes in the context of the            current thread (the thread displayed by <CODE>info            thread</CODE>). Other threads are not blocked while the            function executes. You can block them explicitly using            the <CODE>thread suspend</CODE> and <CODE>thread            resume</CODE> commands, but this may cause more problems            than it solves.</LI>                        <LI>You should be especially careful calling functions            that are not preemptive safe. For example, calling            <CODE>NewWindow</CODE> would be a mistake because the            call will execute in the context of a preemptive thread            and will access data structures that aren't preemptive            safe.</LI>         </UL>                  <H3><A NAME=MacsBugGDBPlugin></A>MacsBug GDB Plug-in</H3>                  <P>No technote on GDB for MacsBug users would be complete         without mentioning the MacsBug GDB plug-in. This plug-in         extends GDB to support a subset of the MacsBug commands and         a MacsBug-like user interface. The plug-in is installed as         part of the Mac OS X 10.1 developer tools in the         "/usr/libexec/gdb/plugins/MacsBug/" directory. You can learn         more about the plug-in from the documentation in that         directory.</P>                  <P>To activate the plug-in, take the following steps.</P>                  <OL>            <LI>Start GDB from the command line.</LI>                        <LI>Enter the command <CODE>source            /usr/libexec/gdb/plugins/MacsBug/gdbinit-MacsBug</CODE>.            You will find that most MacsBug commands are available            (in addition to the standard GDB commands). Type            <CODE><VAR>help MacsBug</VAR></CODE> for more online help            on these commands.</LI>                        <LI>To start the user interface, enter the command            <CODE>mb on</CODE>. The user interface will display "Not            Running" until you attach to the application you wish to            debug. Use normal GDB commands to <A HREF="#Attaching">attach</A>.</LI>         </OL>                  <CENTER id=p1><TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>IMPORTANT:</B><BR>                  The MacsBug-like user interface requires a terminal                  window of at least 44 rows and 80 columns. You may                  need to resize your Terminal window for the user                  interface to start. This and other terminal                  considerations are discussed in the plug-in's                  documentation.</P>               </TD>            </TR>         </table><BR>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=500>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  If you want to always activate the plug-in, just                  add the above commands to the ".gdbinit" file in                  your home directory.</P>               </TD>            </TR>         </table><BR></CENTER>                  <P>The plug-in is especially useful when doing assembly         language debugger because it maintains a lot of useful state         on the screen (the current registers, a disassembly of the         instructions around the current PC, and so on).</P>                  <H3><A NAME=playmem></A>Playmem</H3>                  <P>One nice feature of MacsBug is that it allocates a small         region of memory (512 bytes) and sets the symbol         <CODE>playmem</CODE> to point to it. You can use this memory         for all sorts of nasty debugging hacks. GDB has no dedicated         <CODE>playmem</CODE>, but you can easily create your own, as         shown in Listing 11. These commands create a 512 byte block         of zeroed memory and set the convenience variable         <CODE>$playmem</CODE> to point to it.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 11</B>. Creating                  <CODE>playmem</CODE>.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre>(gdb) <B>call (void *) calloc(1, 512)</B>$1 = (void *) 0x1ed11b0(gdb) <B>set $playmem = $</B>(gdb) <B>p/a $playmem</B>$2 = 0x1ed11b0</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <P>Once you have a block of play memory you can use it for a         variety of tricky things. For example, you can use it to         simulate the MacsBug <CODE>DHP</CODE> command, as shown in         Listing 11.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 12</B>. Simulating MacsBug's                  <CODE>DHP</CODE> command using                  <CODE>playmem</CODE>.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre> <I>Create a mydhp user-defined command.</I>(gdb) <B>define mydhp</B>Type commands for definition of &quot;mydhp&quot;.End with a line saying just &quot;end&quot;.&gt;<B>set *(int *)$playmem = $arg0</B>&gt;<B>x/i $playmem</B>&gt;<B>end</B> <I>Use the newly created command.</I>(gdb) <B>mydhp 0x4e800020</B>0x1ed11b0:      blr</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <P>This is just one example of the use of convenience         variables. You can do many other cools things with them. To         create a convenience variable, just name it (don't forget to         prefix it with $) on the left of a set expression (as shown         in Listing 11). To see the value of a convenience variable,         just <CODE>print</CODE> it. To see all convenience         variables, use the <CODE>show convenience</CODE> command.         You can learn more about convenience variables in the         <A HREF="#references">GDB manual</A>.</P>                  <H3><A NAME=Threads></A>Threads</H3>                  <P>GDB provides a number of commands to support debugging         threads. Listing 13 shows an example of their use.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>            <TR>               <td align="left">                  <P>&nbsp;<B>Listing 13</B>. Thread debugging                  commands.</P>                                    <TABLE BORDER=0 CELLPADDING=5 WIDTH=470>                     <TR>                        <td bgcolor="#E6E6E6" align=left>                           <pre> <I>Show information about the current thread.</I>(gdb) <B>info thread</B>Thread 0x1903 has current state &quot;WAITING&quot;Thread 0x1903 has a suspend count of 0. <I>Show a list of all threads.</I>(gdb) <B>info threads</B>  3 process 665 thread 0x1b03  0x700009a8 in mach_msg_overwrite_trap ()  2 process 665 thread 0x1a03  0x70059d58 in semaphore_wait_signal_trap ()* 1 process 665 thread 0x1903  0x700009a8 in mach_msg_overwrite_trap () <I>Get information about a specific thread.</I>(gdb) <B>info thread 3</B>Thread 0x1b03 has current state &quot;WAITING&quot;Thread 0x1b03 has a suspend count of 1. <I>Make another thread the current thread and then backtrace that thread, and then switch back to the previous thread.</I>(gdb) <B>thread 3</B>[Switching to thread 3 (process 665 thread 0x1b03)]#0  0x700009a8 in mach_msg_overwrite_trap ()(gdb) <B>bt</B>#0  0x700009a8 in mach_msg_overwrite_trap ()#1  0x700058d4 in mach_msg_overwrite ()#2  0x700279a0 in thread_suspend ()#3  0x70027934 in _pthread_become_available ()#4  0x70027658 in pthread_exit ()#5  0x700150f8 in _pthread_body ()#6  0x00000000 in ?? ()(gdb) <B>thread 1</B>[Switching to thread 1 (process 665 thread 0x1903)]#0  0x700009a8 in mach_msg_overwrite_trap () <I>Apply a command to all threads. In this example, we &quot;backtrace&quot; every thread.</I>(gdb) <B>thread apply all bt</B>Thread 3 (process 665 thread 0x1b03):#0  0x700009a8 in mach_msg_overwrite_trap ()#1  0x700058d4 in mach_msg_overwrite ()#2  0x700279a0 in thread_suspend ()[... remaining output omitted ...]Thread 2 (process 665 thread 0x1a03):#0  0x70059d58 in semaphore_wait_signal_trap ()#1  0x70016300 in semaphore_wait_signal ()#2  0x70016168 in _pthread_cond_wait ()[... remaining output omitted ...]Thread 1 (process 665 thread 0x1903):#0  0x700009a8 in mach_msg_overwrite_trap ()#1  0x70006e34 in mach_msg ()#2  0x7017ab20 in __CFRunLoopRun ()[... remaining output omitted ...]                            <I>Create a thread-specific breakpoint.</I>(gdb) <B>break HandToHand thread 1</B>Breakpoint 1 at 0x7025e844</pre>                        </TD>                     </TR>                  </table><BR>               </TD>            </TR>         </table><BR>         </CENTER>                  <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=Summary></A></P>                  <H2>Summary</H2>                  <P>GDB is your friend. Learn to love GDB. Soon you will         forget your infatuation with MacsBug.</P>         <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=references></A></P>                  <H2>References</H2>                  <P>Richard Stallman et al, <a href="http://developer.apple.com/documentation/DeveloperTools/gdb/gdb/gdb_toc.html">Debugging         with GDB</A>, Free Software Foundation, March 2000</P>                  <P>Apple Computer, <a href="http://developer.apple.com/tools/debuggers/MacsBug/Documentation/MacsBugRef_6.2.pdf">MacsBug         Reference and Debugging Guide</A>, Addison-Wesley, 1990</P>                  <P><a href="http://developer.apple.com/documentation/macosx/Essentials/devessentials.html">Inside         Mac OS X: Performance</A></P>                  <P><A HREF="http://lists.apple.com/mailman/listinfo/projectbuilder-users/">projectbuilder-users         Mailing List</A> -- The Apple GDB team hang out on this         mailing list.</P>                  <P><A HREF="#top">Back to top</A></P>                                                      <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <CENTER><img src="images/acrobatsmall.gif" alt="Acrobat gif" width=22 align=middle height=23></CENTER>               </TD>               <td align="left">                  <P>Acrobat version of this Note (120K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn2030.pdf">Download</A></P>               </TD>            </TR>         </table><BR>         <BR>                           <P><A HREF="#top">Back to top</A></P>      </TD>   </TR></table><BR></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2030.html%3Fid%3DDTS10003067-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2030.html%3Fid%3DDTS10003067-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2030.html%3Fid%3DDTS10003067-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>