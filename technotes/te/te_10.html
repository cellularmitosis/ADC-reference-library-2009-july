<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TE10: Script Manager Print Action Routine</title>                                       <meta name="categories" content="Text"><meta name="week-posted" content="Oct 26, 1987 - Nov 6, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002818" title="Script Manager Print Action Routine"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TE10</div>
<div id="pageheadsub">Script Manager Print Action Routine</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">General Notes</A><BR><BR><A HREF="#Section2">When To Call the Print Action Routine</A><BR><BR><A HREF="#Section3">Calling the Print Action Routine</A><BR><BR><A HREF="#Section4">Print Action Routine Verbs</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This technical note describes how Print Drivers can access the Script ManagerPrint Action routine to print unconventional text, such as Japanese or Arabic.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Mar 01 1988]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>General Notes</h2><p>Scripts such as Japanese or Arabic modify the normal QuickDraw text handling inorder to represent text properly. On the screen, this is done by trapping<code>StdText</code> and <code>StdTxtMeasure</code>, and transforming the text beforeprinting. For example, for Hebrew or Arabic the text might be reversed, sincetext normally goes from right to left in those scripts.</p><p>Print drivers require slightly different handling, for two reasons:</p><ol type="1" start="1">	<li>A print driver might not call the standard QuickDraw procedures. For example, the LaserWriter writes directly in PostScript instead.</li>	<li>A print driver might need to format the text, for accurate line-layout. In this case, the text needs to be transformed before the driver performs line-layout. If the driver is spooling the text, and will replay the text a second time, the text cannot be transformed a second time, since that wouldruin the appearance.</li></ol><p>For example, the ImageWriter driver calls QuickDraw procedures twice, once tospool and once to unwind the spooling. The text must be transformed whenspooling, so that line layout can be done, but when unwinding, thetransformation must be turned off completely.</p><p>Note that some drivers, such as the LaserWriter, use QuickDraw re-entrantly:the application program calls a QuickDraw routine, which is directed to thedriver's <code>grafProcs</code>, which in turn call QuickDraw internally to put upstatus messages on the screen. The Print Action procedure handles the textproperly so that the text transformations are enabled during the re-entrantcalls, so that the status messages will be properly formatted.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><h2>When To Call the Print Action Routine</h2><p>The Script Manager Print Action routine allows the print driver to beindependent of the particular scripts being used. The printing driver shouldcall this routine whenever it changes the <code>grafProcs</code> in the printing<code>grafPort</code>. The Print Action routine will then substitute<code>grafProcs</code> of its own in the <code>grafProcs</code> record, saving theoriginal routine addresses.</p><p>The Print Action routine will actually call a Print Action routine for eachscript system that is currently installed. Each of the script Print Actionroutines will do the appropriate tasks for its system.</p><P><A HREF="#top">Back to top</A></p><a name="Section3"></a><h2>Calling the Print Action Routine</h2><p>To call the Print Action routine, the driver should use the following code:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>intlGlobals    equ    $ba0    ; international globalsprintActionOff    equ    $16    ; offset to PrintAction proc ptr; get procedure pointer to call    tst.w    Rom85                ; on a Macintosh + or better?    blt.s    @PrintActionDone        ; no, skip    move.l    intlGlobals,d2        ; get international globals    ble.s    @PrintActionDone        ; not there, skip    move.l    d2,a0                ; in address register    move.l    printActionOff(a0),d2    ; get print action address    beq.s    @PrintActionDone        ; not there, skip    move.l    d2,a0                ; in address register; set up arguments to call    move.l    &lt;myPort&gt;,d0            ; pass the port    move.w    &lt;myVerb&gt;,d1            ; pass the verb    jsr    (a0)                ; call the procedure</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></p><a name="Section4"></a><h2>Print Action Routine Verbs</h2><p>There are currently three verbs to pass to the Print Action routine.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    paUnwindText        equ    -1    paSpoolText        equ    1</pre>	</TD></TR></TABLE></CENTER><p>Use the <code>paUnwind</code> verb to ensure that the text is not transformedbefore your <code>StdText</code> procedure receives the text. This verb is usedwhen playing back stored text that has already been transformed.</p><p>The other two verbs (<code>paNoQuickDraw</code> and <code>paSpoolText</code>) are usedto ensure that the text is transformed before your <code>StdText</code> procedurereceives the text. The <code>paSpoolText</code> verb is used when your driver willuse QuickDraw to image the text in the printing <code>grafPort</code>. The<code>paNoQuickDraw</code> verb is used when the text is not drawn into theprinting port by going through QuickDraw (e.g. the LaserWriter). In that casesome languages (e.g. Japanese) which use an extended font structure may need torecast the text calls as <code>CopyBits</code> calls.</p><p>As mentioned above, some applications may call QuickDraw from within thedriver, as when a status window is updated. During any <code>StdTxtMeasure</code>calls in the driver during the application's call to <code>StdText</code>, the portis checked against the printer port. If they match, then the text is nottransformed. Otherwise, the text is transformed.</p><p>The solutions adopted by the Print Action routine assume that the print driverdoes not measure or draw text except within calls to <code>StdTxtMeasure</code> or<code>StdText</code>. If your driver does text buffering (as for line layout), makesure that any measurements are performed within these two calls. For example,you might buffer both the text and its screen width as measured by QuickDraw.</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P>The Script Manager </p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/te_10.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/te/te_10.html%3Fid%3DDTS10002818-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/te/te_10.html%3Fid%3DDTS10002818-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/te/te_10.html%3Fid%3DDTS10002818-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>