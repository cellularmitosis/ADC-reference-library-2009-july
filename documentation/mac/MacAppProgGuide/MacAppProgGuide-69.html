<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Dialog Boxes and Controls (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING69></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-68.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-70.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-63.html"><B>Chapter 8 - Displaying, Manipulating, and Printing Data</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING69-0></A>
<H1><A NAME=MARKER-9-268></A>Dialog Boxes and Controls</H1>
 A <B><A NAME=MARKER-2-269></A>dialog box</B> is a special type of window used in Macintosh applications to display information and receive input from the user. A <B><A NAME=MARKER-2-270></A>control</B> is a user interface item, such as a radio button or checkbox, that commonly appears in a dialog box.<P>
 In MacApp, a dialog box is just another type of window, containing its own hierarchy of views. MacApp supplies the <CODE>TDialogView</CODE> class for building a dialog box, as well as a number of view classes to represent Macintosh Control Manager controls, such as buttons and checkboxes. The <CODE>TDialogView</CODE> class automatically creates a <CODE>TDialogBehavior</CODE> object to supply dialog-box behavior. The dialog behavior object works with the dialog view to validate view data when the dialog box is closed.<P>
 MacApp also provides a behavior class that supports tabbing between fields. This behavior works in any window but is most commonly used in dialog boxes. The tabbing support allows a data-entry view to validate its data when a user tabs to another field. Tabbing is described in <A HREF=#MARKER-9-301>"Tabbing Between Views," beginning on page 243</A>.<P>
 As with other windows in MacApp, you can use a view resource to define a window and view hierarchy for a dialog box. You can then create the window with <CODE>NewTemplateWindow</CODE> and display it as either a modal or modeless dialog box.<P>
<A NAME=HEADING69-5></A>
<H2><A NAME=MARKER-9-271></A>Modal Versus Modeless Dialog Boxes</H2>
 <A NAME=MARKER-2-272></A>A <B>modal dialog box</B> is one that, once opened, does not allow a user to perform any other program task until the dialog has been dismissed. A <B>modeless dialog box</B> is one that does not interfere with other program operations--for example, it may be open in the background while a user works in a different window. Modal and modeless dialog boxes may be similar in appearance--for example, both may contain buttons and text-entry fields, have a title bar, and be movable.<P>
 A modal dialog box usually has one or more buttons that serve as dismissers, such as an OK button and a Cancel button. The user clicks the OK button to dismiss the dialog and accept its action. The user clicks the cancel button to dismiss the dialog without accepting any changes. If the user types Command-period or presses the Escape key, the result is the same as clicking the Cancel button--that is, the dialog is dismissed without any changes.<P>
 A modeless dialog box may also include buttons, but is commonly dismissed by clicking its close box.<P>
 The default button is indicated by a 3-pixel black border. Pressing the Return key specifies the same action as clicking the default button and normally dismisses the dialog box. Depending on the function performed by the dialog, the default button may be the OK button, the Cancel button, or another button.<A NAME=MARKER-2-273></A><A NAME=MARKER-2-274></A><P>
<A NAME=HEADING69-10></A>
<H3>Creating a Dialog Box</H3>
 MacApp uses the <A NAME=MARKER-2-275></A><CODE>TDialogView</CODE> class for both modal and modeless dialog boxes. <CODE>TDialogView</CODE> is not a large or complicated class. Its main contributions are to supply fields that identify the default and cancel views in a dialog box and to call the <A NAME=MARKER-2-276></A><CODE>SetDialogItems</CODE> method of its window from its <A NAME=MARKER-2-277></A><CODE>DoPostCreate</CODE> method. The <CODE>SetDialogItems</CODE> method creates a <A NAME=MARKER-2-278></A><CODE>TDialogBehavior</CODE> object and adds it to the window's behavior list. When you construct a view hierarchy for a dialog box, you use a <CODE>TDialogView</CODE> object as the superview for the dialog box's control-item views.<P>
 You typically define a subclass of <CODE>TDialogView</CODE> to<P>
<UL>
<LI>override the <CODE>DoEvent</CODE> or <CODE>DoKeyEvent</CODE> methods to provide special event handling
<LI>override the <CODE>DoPostCreate</CODE> method to take care of initial settings that can't be handled in a view resource<P>
</UL>
<DL>
<DT><B>IMPORTANT</B>
<DD>If you override the <CODE>DoPostCreate</CODE> method in a subclass of <CODE>TDialogView</CODE>, your version should call <CODE>Inherited</CODE>, which calls the window's <CODE>SetDialogItems</CODE> method to create a dialog behavior for the view. If your <CODE>DoPostCreate</CODE> method doesn't call <CODE>Inherited</CODE>, it should either call its window's <CODE>SetDialogItems</CODE> method, or supply its window with a dialog behavior directly.<EM></EM><A NAME=MARKER-2-279></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING69-16></A>
<H3><A NAME=MARKER-2-280></A>Displaying a Modal Dialog</H3>
 The <A NAME=MARKER-2-281></A><CODE>TDialogBehavior</CODE> class handles certain tasks that are most commonly required of a modal dialog, including<P>
<UL>
<LI>supplying a method, <CODE>PoseModally</CODE>, to display a dialog modally
<LI>handling a Command-period or Escape keypress as a click in the cancel view (typically the Cancel button), which dismisses the dialog box without accepting any changes
<LI>handling an Enter or Return keypress as a click in the default view (typically the OK button), which dismisses the dialog box and accepts any changes<P>
</UL>
 The <CODE>PoseModally</CODE> method sets the behavior's <A NAME=MARKER-2-282></A><CODE>fModal</CODE> field to <CODE>TRUE</CODE> and processes events in its own event loop until the dialog box is dismissed. You can use a view-editing program to define any control item in the dialog window as a dismisser. When <A NAME=MARKER-2-283></A><CODE>PoseModally</CODE> processes an event from a dismisser control, it terminates its event loop and returns control to the caller. The return value of <CODE>PoseModally</CODE> is the ID of the item that caused the dismissal.<P>
<DL>
<DT><B>Note</B>
<DD>When you call <CODE>PoseModally</CODE> to display a dialog window modally, you must call the window's <CODE>Close</CODE> method after the dialog box is dismissed.<EM></EM><A NAME=MARKER-2-284></A><A NAME=MARKER-2-285></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING69-23></A>
<H2>Adding Controls to Dialog Boxes</H2>
 Most of the items in a dialog box are controls such as buttons, checkboxes, and text-entry fields. MacApp defines the <CODE>TControl</CODE> class, a descendant of <CODE>TView</CODE>, for creating these kinds of items. Each control object has these properties:<P>
<UL>
<LI>It can determine whether it contains a mouse click.
<LI>It can track the mouse without creating a command object. 
<LI>It can be dimmed, highlighted, and flashed.
<LI>It can be adorned with one of the standard adornments, such as a rectangular frame.
<LI>It can have an associated text style for displaying a label, if it has one.<P>
</UL>
<A NAME=HEADING69-30></A>
<H2>Control View Classes</H2>
 <A NAME=MARKER-2-286></A>MacApp defines subclasses of <CODE>TControl</CODE> to support standard control items:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-287></A>TButton</CODE>
<DD> Implements a Control Manager button
<DT><CODE><A NAME=MARKER-2-288></A>TCheckBox</CODE> 
<DD> Implements a Control Manager checkbox
<DT><CODE><A NAME=MARKER-2-289></A>TRadio</CODE>
<DD> Implements a Control Manager radio button
<DT><CODE><A NAME=MARKER-2-290></A>TScrollBar</CODE> 
<DD> Implements a Control Manager scroll bar
<DT><CODE><A NAME=MARKER-2-291></A>TScrollerScrollBar</CODE>
<DD> Subclass of <CODE>TScrollBar</CODE> that is associated with one or more <CODE>TScroller</CODE> view objects
<DT><CODE><A NAME=MARKER-2-292></A>TCluster</CODE>
<DD> Provides a label for a group of controls; understands an <CODE>mRadioHit</CODE> message from a subview and therefore can respond to a mouse click on a radio button by turning off all other radio buttons in the cluster
<DT><CODE><A NAME=MARKER-2-293></A>TIcon</CODE>
<DD> Displays an icon; can operate as a button, if desired
<DT><CODE><A NAME=MARKER-2-294></A>TPicture</CODE>
<DD> Displays a picture; can operate as a button, if desired
<DT><CODE><A NAME=MARKER-2-295></A>TPopup</CODE>
<DD> Implements a pop-up menu
<DT><CODE><A NAME=MARKER-2-296></A>TStaticText</CODE>
<DD> Implements a static text item that can serve as a basic form of button if enabled, but whose text cannot be edited
<DT><CODE>TEditText</CODE> 
<DD> Implements a text item that can be edited
<DT><CODE><A NAME=MARKER-2-139></A>TNumberText</CODE> 
<DD> Implements a view to accept and validate numeric data
</DL>
 You can read more about these classes in the <I>MacApp Class and Method Reference</I>.<P>
<A NAME=HEADING69-45></A>
<H2><A NAME=MARKER-9-299></A>Control Object Events</H2>
 <A NAME=MARKER-2-300></A>When a user clicks in a control view, MacApp calls the control view object's <CODE>DoEvent</CODE> method. The interface to this method is defined as follows:<P>
<PRE>
virtual void DoEvent(EventNumber eventNumber,
                  TEventHandler* source,
                  TEvent* event  );
</PRE>
 The <CODE>eventNumber</CODE> parameter is the ID of the event. Constants for control object event numbers are defined in the UMacAppGlobals unit. Some examples are<P>
<PRE>
const EventNumber mOKHit = 1; // Click OK button.
const EventNumber mCancelHit = 2;// Click Cancel button.
const EventNumber mButtonHit = 3;// Click any button.
const EventNumber mCheckBoxHit = 4;// Click checkbox.
</PRE>
 <A HREF=MacAppProgGuide-108.html#MARKER-9-1>Table 19-1</A> contains a more complete listing of these event constants, and <A HREF=MacAppProgGuide-106.html#MARKER-9-20>Chapter 19, "Working With Dialog Boxes and Controls,"</A> provides recipes for processing the specified events.<P>
<A NAME=HEADING69-51></A>
<H2><A NAME=MARKER-9-301></A>Tabbing Between Views</H2>
 <A NAME=MARKER-2-302></A>MacApp provides the <A NAME=MARKER-2-303></A><CODE>TMultiWindowTabber</CODE> behavior class to support tabbing between views. It supports tabbing within any view, not just views based on <CODE>TDialogView</CODE>. The <CODE>TMultiWindowTabber</CODE> class is called <I>multiwindow</I> because it operates correctly in an environment with multiple windows open, including any number of floating windows. <I>Multiwindow</I> does <I>not</I> refer to support for tabbing between views in multiple windows, because that is not a standard feature of the Macintosh user interface.<P>
 The <CODE>IApplication</CODE> method creates an instance of <CODE>TMultiWindowTabber</CODE> and adds it to the application object's behavior list. You don't need to create your own tabber behavior objects--the application's tabber object will support correct tabbing in your dialog views or other views.<P>
 Tabbing is accomplished by iterating over a view's list of subviews, looking for the current target and the next subview that wants to become the target object. The order of tabbing depends on the order of the subviews in the list.<P>
 The <CODE>TMultiWindowTabber</CODE> class descends from the <A NAME=MARKER-2-304></A><CODE>TTabber</CODE> class. <CODE>TTabber</CODE> is an abstract behavior class that intercepts the Tab key and calls its own <CODE>Tab</CODE> method. The <CODE>Tab</CODE> method calls <CODE>FindTargets</CODE>, which does nothing in <CODE>TTabber</CODE> but is overridden in <CODE>TMultiWindowTabber</CODE>. If you need specialized tab handling, you can define your own subclass of either <CODE>TTabber</CODE> or <CODE>TMultiWindowTabber</CODE>.<P>
 MacApp also provides the <CODE>TLetterTabber</CODE> class for tabbing between the mailer view and the main content view of a document with an attached mailer. <CODE>TLetterTabber</CODE> is described in <A HREF=MacAppProgGuide-62.html#MARKER-9-201>"PowerTalk Mailers," beginning on page 192</A>.<A NAME=MARKER-2-305></A><P>
<A NAME=HEADING69-57></A>
<H2><A NAME=MARKER-9-306></A>Validating Dialog-Box Data</H2>
 <A NAME=MARKER-2-307></A>If your application uses a dialog box for data entry, you may need to validate data when the user attempts to move from one entry field to another or when the user attempts to close the dialog box.<P>
<A NAME=HEADING69-59></A>
<H3>Validating Data When a User Changes Fields in a Dialog Box</H3>
 When a user attempts to change the field in a dialog box by tabbing or by clicking the mouse, MacApp calls <A NAME=MARKER-2-308></A><CODE>BecomeTarget</CODE>, a method of <CODE>TEventHandler</CODE>, to set the new target object. Data validation occurs as part of the process of setting a new target object.<P>
 The <CODE>BecomeTarget</CODE> method calls the <CODE>ResignTarget</CODE> method of the current target object. For a <CODE>TEditText</CODE> view or a <CODE>TNumberText</CODE> view, this results in a call to the view's <A NAME=MARKER-2-311></A><CODE>GetValidationError</CODE> method, which validates the current data.<P>
 If the data in the field is invalid, <CODE>GetValidationError</CODE> returns a nonzero value. For a <CODE>TEditText</CODE> view or a <CODE>TNumberText</CODE> view, this results in a call to the view's <CODE>ValidationFailed</CODE> method, which notifies the user of the invalid data.<P>
<DL>
<DT><B>Note</B>
<DD>To clarify the previous discussion, some method calls were omitted.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 When you define a subclass of MacApp's <CODE>TEditText</CODE> or <CODE>TNumberText</CODE> classes, you can override <CODE>GetValidationError</CODE> to do special checking and override <CODE>ValidationFailed</CODE> to put up the desired error alert.<P>
<A NAME=HEADING69-65></A>
<H3><A NAME=MARKER-9-312></A>Validating Data When a User Accepts Changes to a Dialog Box</H3>
 When a user accepts changes to a modal data-entry dialog box, usually by clicking the OK button, the <CODE>TDialogBehavior</CODE> object's <CODE>Dismiss</CODE> method is called. This method calls the dialog view's <A NAME=MARKER-2-313></A><CODE>IsHierarchyValid</CODE> method.<P>
 The <CODE>IsHierarchyValid</CODE> method calls the <CODE>IsValid</CODE> method for each subview in the hierarchy. The <CODE>IsValid</CODE> method in turn calls <CODE>GetValidationError</CODE>, which is described in the previous section. Thus each control view in the dialog's view hierarchy has a chance to validate its data. If <CODE>GetValidationError</CODE> returns a nonzero value, <CODE>IsValid</CODE> calls <CODE>ValidationFailed</CODE>, which is also described in the previous section.<P>
 Good program design calls for a minimum of modal dialogs, and your application may often use a modeless dialog for data entry. To validate data when a user closes a modeless dialog, you can subclass <CODE>TDialogView</CODE> and override the <CODE>Close</CODE> method to call <CODE>IsHierarchyValid</CODE> directly, as shown in this code fragment from the DemoDialogs sample application:<P>
<PRE>
void TMonthlyDialog::Close()// Override.
{
   // Give text-entry fields a chance to validate their data.
   if (this-&gt;IsHierarchyValid())
   {
      // Store validated data. (Not shown.)
      .
      .
      .
      // Perform other closing tasks.
      Inherited::Close();
   }
   else
      // Silent failure--don't close dialog box.
      Failure(noErr, 0);
}
</PRE>
 When <CODE>IsHierarchyValid</CODE> returns <CODE>FALSE</CODE>, the dialog field with the invalid data has already displayed an error message, if appropriate, telling the user why the data is invalid. The call to <CODE>Failure</CODE> ensures that the modeless dialog box is not closed. MacApp's failure handling is described in <A HREF=MacAppProgGuide-25.html#MARKER-9-21>Chapter 3, "Core Technologies."</A><A NAME=MARKER-2-314></A><A NAME=MARKER-2-315></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-68.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-70.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
