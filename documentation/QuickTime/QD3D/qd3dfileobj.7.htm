<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Creating a File Object</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3106"> </A>Creating a File Object</H1><P CLASS="T1.Text1"><A NAME="pgfId=3108"> </A><A NAME="marker=3107"> </A>To access the data in a piece of storage that conforms to the 3DMF standard (such as a file on disk or a block of memory on the Clipboard), you need to create a new storage object, create a new file object, and attach the file object to the storage object. Thereafter, you can open the file object and read the data in it or write data to it. <A HREF="qd3dfileobj.7.htm#13338" CLASS="XRef">Listing&nbsp;4</A> illustrates how to create storage and file objects and attach them to one another.</P><P CLASS="T1.Text1"><A NAME="pgfId=3115"> </A>The <TT CLASS="cv">MyGetInputFile</TT> function defined in <A HREF="qd3dfileobj.7.htm#13338" CLASS="XRef">Listing&nbsp;4</A> calls the application- defined routine <TT CLASS="cv">MyGetInputFileName</TT> to get the name of the disk file to open. Then it calls <TT CLASS="cv">Q3FSSpecStorage_New</TT> to create a new storage object associated with that disk file and <TT CLASS="cv">Q3File_New</TT> to create a new file object. If both creation calls complete successfully, <TT CLASS="cv">MyGetInputFile</TT> calls <TT CLASS="cv">Q3File_SetStorage</TT> to attach the file object to the storage object.</P><P CLASS="Note"><A NAME="pgfId=3119"> </A>See the chapter <A HREF="qd3dstorageobj.htm#14588" CLASS="XRef">&quot;Storage Objects&quot;</A> for complete details on creating storage objects. </P><P CLASS="L.Listing"><A NAME="pgfId=3124"> </A>Listing&nbsp;4<A NAME="13338"> </A>Creating a new file object</P><CODE CLASS="Cv.Code"><A NAME="pgfId=11620"> </A>TQ3FileObject MyGetInputFile (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3FileObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myFileObj;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3StorageObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myStorageObj;<BR>&nbsp;&nbsp;&nbsp;&nbsp;OSType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myFileType;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FSSpec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myFSSpec;<BR></CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=11626"> </A>&nbsp;&nbsp;&nbsp;&nbsp;if (MyGetInputFileName(&amp;myFSSpec) == kQ3False)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(NULL);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Create new storage object and new file object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if(((myStorageObj = Q3FSSpecStorage_New(&amp;myFSSpec)) == NULL) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| ((myFileObj = Q3File_New()) == NULL)) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (myStorageObj) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(myStorageObj);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(NULL);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Set the storage for the file object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3File_SetStorage(myFileObj, myStorageObj);<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(myStorageObj);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;return (myFileObj);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3128"> </A><A NAME="marker=11628"> </A>Notice that the call to <TT CLASS="cv">Q3File_SetStorage</TT> is followed immediately by a call to <TT CLASS="cv">Q3Object_Dispose</TT>. The call to <TT CLASS="cv">Q3File_SetStorage</TT> increases the reference count of the storage object, and the call to <TT CLASS="cv">Q3Object_Dispose</TT> simply decreases that count.<A NAME="marker=3129"> </A></P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>