<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PT08: A/UX 2.0 Compatibility Guidelines</title>                                       <meta name="categories" content="Platforms and Tools"><meta name="week-posted" content="Mar 27, 1989 - Apr 7, 1989"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002663" title="A/UX 2.0 Compatibility Guidelines"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PT08</div>
<div id="pageheadsub">A/UX 2.0 Compatibility Guidelines</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">General Compatibility Issues</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext"></p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1989]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><p>A/UX 2.0 and 2.0.1 significantly improves support for Macintosh applicationsfrom  version 1.1. The major components of the 2.0 Toolbox environmentinclude:</p><ul type="disc">	<li>System Software derived from 6.0.5</li>	<li>A/UX MultiFinder version 6.9</li>	<li>32-Bit QuickDraw</li>	<li>File Manager access to UNIX, HFS, and AppleShare volumes</li>	<li>Sound Manager</li>	<li>Serial Manager</li>	<li>Notification Manager</li>	<li>Slot Manager</li></ul><p>Most MultiFinder-compatible Macintosh applications and utilities should workunmodified under A/UX 2.0.  Complete details concerning the A/UX Toolbox may befound in the <i>A/UX Toolbox: Macintosh ROM Interface</i> manual which is partof the A/UX documentation set; however, there are some additional subtleaspects of the A/UX environment of which developers should be aware.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><h2>General Compatibility Issues</h2><p>The following items do not form a definitive list.  Rather, they are indicativeof common problems Apple encountered with applications while testing them underA/UX 2.0.</p><h3>Do Not Access Hardware Directly</h3><p>UNIX is a protected environment where the kernel arbitrates all hardwareaccess.  Applications should use the appropriate Macintosh Toolbox manager whenit is available.  Hardware developers may need to write a custom A/UX devicedriver to provide access to special hardware.  Details on A/UX device drivers,including sample driver source code, is contained in the A/UX Device Driver Kitavailable from APDA.</p><h3>Do Not Depend Upon How Things Work</h3><p>Some applications rely on internal operating system details.  This reliance hasalways been a bad idea, but applications are particularly likely to be bittenunder A/UX because the internals are different.  Following are some specificcases of which to be aware:</p><p><i>Event Manager</i></p><p>Some applications depend upon being able to access the event queue directly andpatch into the <code>_PostEvent</code> mechanism.  Under A/UX, the event queue isin the kernel and is not accessible to applications. Use if possible existingsupported trap calls, instead of trying to access the event queue.</p><p><i>Memory Manager</i></p><p>Some applications work because the Macintosh OS uses a roving allocationscheme.  Such applications free memory then use that memory in subsequenttraps.  A/UX is much more likely to reuse that memory immediately after it isfreed (i.e., before the application can use it) than the Macintosh OS.</p><h3>A/UX-Specific System Files</h3><p>Some system files are A/UX specific and cannot be interchanged with theMacintosh environment.  These files include the System file, Finder,MultiFinder, AppleShare, MacTCP and Patch files.</p><h3>Privileged Instructions</h3><p>Since privileged microprocessor instructions must be emulated in software, theyexecute much slower under A/UX than the Macintosh OS; therefore, usingprivileged instructions degrades application performance.  Avoid a privilegedinstruction where a non-privileged instruction does just as well.  For example,the non-privileged instruction <code>MOVE &lt;ea&gt;,CCR </code>can be used inalmost all cases instead of the privileged instruction <code>MOVE&lt;ea&gt;,SR</code>.</p><h3>Personal System Folders</h3><p>Under A/UX, a user has the option to use a public System Folder("<code>/mac/sys/System Folder</code>") which may be shared and changed by allusers or employ a private System Folder to allow custom configurations.  Whenthe user logs in, A/UX makes two checks for the existence of a private SystemFolder.  First, the environment variable <code>TBSYSTEM</code> may be set to thefull UNIX path of a directory to use as the System Folder.  Second, if<code>TBSYSTEM</code> is not set, the user's home directory is checked for asubdirectory named "<code>System Folder</code>".  If neither of these conditionsare met, the public System Folder is used.  Once a particular directory isselected, it becomes the "blessed" folder as long as the user remains loggedin.</p><p>If an application has an installer utility, it should not place required filesin the active System Folder; rather, it should use the System Folder only forconfiguration data.  Required files should be kept with the application.</p><h3>File Manager</h3><p>The A/UX File Manager provides access to: UNIX reg.volumes, HFS volumes, MFS volumes, and AppleShare volumes.  UNIX volumes may bea Berkeley 4.2 File System (UFS), a System V File System (SVFS) or a NetworkFile System (NFS(TM)) volume.  In addition, since HFS is used as the foundationof the 2.0 File Manager, other external file systems following the Macintoshcompatibility guidelines should work correctly under the A/UX environment.  Infact, access to UNIX file systems is provided through a Macintosh external filesystem.</p><p><i>HFS Volumes</i></p><p>A/UX 2.0 allows only one HFS partition per volume; volumes with more than onesuch partition are not usable.  In addition, HFS SCSI devices are onlyaccessible to A/UX if they were accessible to the Macintosh OS when the systembooted, and they have a valid partition map.  Note that in the case of HFSCD-ROM discs, only the drive needs to be accessible, no volume needs to be inthe drive.</p><p><i>UNIX Volumes (/)</i></p><p>Different physical UNIX volumes (including NFS volumes) appear to Macintoshapplications as a <b>single</b> Macintosh volume named <code>/</code>.  Movingfiles within the single logical volume <code>/ </code>using <code>_PBCatMove</code> canfail with a <code>badMoveErr</code> if the move would cross physical volumes.  Italso means the free space reported on <code>/ </code>may not be an accuratereflection of the space available for a file operation.  The<code>_AUXDispatch</code> trap, documented in the <i>A/UX Toolbox:  Macintosh ROMInterface</i> manual, with the <code>AUX_FS_FREE_SPACE</code> selector, can be usedto accurately determine the free space on the underlying physical volume.</p><p>The <code>/ </code>volume always appears as the boot volume and <b>always</b>contains the "blessed" folder.</p><p><i>Filenames</i></p><p>UNIX file systems, unlike Macintosh file systems, are <b>case sensitive</b>.Applications should be consistent in the use of case to avoid confusion.  Forexample, the filenames "<code>Foobar Preferences</code>" and "<code>foobarpreferences</code>" are two distinct filenames to UNIX.  The A/UX 2.0 FileManager mediates this a bit.  It first attempts a case sensitive filenamelookup, and if that fails, it then tries a case insensitive lookup.  Thedisadvantage is that not only is this slower, but also the File Manager mayfail to correctly identify a single file from a group of files whose namesdiffer only in case.  Note that the <code>_Create</code> trap is an exception andonly performs a <b>case sensitive</b> lookup when it checks for the existenceof a file, thus an application may create "<code>Foo</code>" in the same directorywhich already contains "<code>foo</code>".</p><p>Not all UNIX file systems support 31-character filenames.  The UFS file systemon which A/UX 2.0 is based, supports 255-character filenames, but the olderSystem V file systems used on A/UX 1.x systems only support 14-characterfilenames.  Since these older systems are supported under A/UX 2.0, users maymount them as part of <code>/</code>.  While the File Manager continues to allowuse of 31-character filenames, remember that the underlying file system maytruncate the name.  For example, on an SVFS volume, the name<code>ThisNameWillBeTruncated</code> becomes <code>ThisNameWillBe</code>.  This alsomeans names like <code>ThisNameWillBeTruncated</code> and<code>ThisNameWillBeTruncatedAlso</code> may not be unique.  You can avoid problemsby ensuring that static filenames used by application code are unique in thefirst 14 characters.</p><h3>UNIX Volume Pathnames</h3><p>The slash (/) character is used by UNIX as a pathname separator.  Its use issimilar, but not identical, to that of the colon (:) in Macintosh file systems.This similarity can lead to ambiguity; for example, "<code>Font/DA Mover</code>"might be interpreted as "<code>:Font:DA Mover</code>".  Again, the File Managerattempts to arbitrate.  It accepts <b>both</b> UNIX and HFS style pathnames,and if it is trying to parse a pathname according to UNIX semantics and failsto locate a particular path component in the UNIX file system, it translatesall slashes to underlines (_) and treats the string as a single name (e.g.,"<code>Font/DA Mover</code>" becomes "<code>Font_DA Mover</code>").</p><p>If you must generate a full or relative pathname, it is best to use a colon asa pathname delimiter because this reduces the chance of ambiguity.</p><h3>End-Of-Line Treatment</h3><p>UNIX and Macintosh use different end-of-line characters (newline and carriagereturn, respectively).  To allow both UNIX and Macintosh tools to manipulatefiles of type "TEXT," the A/UX File Manager transparently translates thesecharacters when dealing with files residing on the <code>/ </code>volume.  Carriagereturns are translated into new lines upon <code>_PBWrite</code> and new lines aretranslated into carriage returns upon <code>_PBRead</code>.  Hence, Toolboxapplications always see "<code>TEXT</code>" data in Macintosh format and UNIXapplications always see "<code>TEXT</code>" data in UNIX format.  To facilitatethis transparency, it is important that applications set the file typeimmediately after a call to <code>_Create</code> (using either <code>_SetFileInfo</code>or <code>_SetCatInfo</code>).</p><h3>File Permissions</h3><p>Unlike AppleShare, UNIX file systems associate access permissions with files aswell as directories.  Directory permissions are mapped onto correspondingAppleShare file permission values and returned by <code>_GetDirAccess</code>.  Forunreadable files, the File Manager returns a special type and creator pair,namely  creator "A/UX" and type "FILE" for data files, and type "EXEC" forexecutable files.</p><h3>HFS-Specific File Information for UNIX Volumes</h3><p>UNIX file systems lack certain HFS file attributes such as directory IDs andFinder information, which means files created outside of the Toolboxenvironment do not intrinsically have such attributes.  When necessary, suchinformation is provided by the File Manager through the use of a database inthe blessed folder.  When building its database, the File Manager synthesizestype and creator information for these UNIX files from the file's contents.</p><p>Directory IDs may, under some circumstances, change.  For instance, if aparticular UNIX volume is sometimes mounted in different areas of the <code>/</code>volume, the IDs for its directories change according to where it ismounted.</p><p>The File Manager tries to keep all files of type "<code>TEXT</code>" in "pure" UNIXformat; consequently, if an application creates a file of type "<code>TEXT</code>"that has no resource information, then the type and creator association ismaintained strictly through the database.</p><h3>Miscellaneous UNIX Volume Details</h3><p>The following caveats apply only to file accesses to the <code>/ </code>volume:</p><p><code>_Allocate</code> and <code>_AllocContig</code> do nothing; applications shoulduse <code>_SetEOF</code> instead.</p><p>Do not directly access VCBs and FCBs.  The UNIX external file system does notuse these structures internally.  Applications can use the File Manager callsinstead (e.g. <code>_GetFCBInfo</code>).</p><p>UNIX activity outside of the Toolbox environment may modify the <code>/</code>volume.  The A/UX File Manager regularly changes the reported modificationtime of the / volume (as returned by <code>_GetVolInfo</code>) to stimulateapplications to check if a directory they are displaying needs to be updated.Be sure to check for change the modification time of the particular directorybefore updating an application's display.</p><p>Almost all File Manager traps intended for <code>/ </code>may move or purgememory. The following list contains traps that could, now or in the futureinvolve the Memory Manager to move memory (note that <code>_Read</code> and<code>_Write</code> do not cause any Memory Manager activity):</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        _MountVol                          _OpenWD        _SetDir        _DirCreate        _GetCatInfo        _SetCatInfo        _CatMove        _GetDirAccess        _GetFileInfo        _SetFileInfo        _Open        _OpenRF        _Create        _Delete        _ReName</pre>	</TD></TR></TABLE></CENTER>(if HFS-bit is set, as this implicitly involves a<code>_SetDir</code> )<CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        _SetFilLock        _RstFilLock</pre>	</TD></TR></TABLE></CENTER><p><i>Inside Macintosh</i>, Volume V-380, The File Manager, states that an<code>_Open</code> (and <code>_OpenRF</code>) call using <code>fsWrPerm</code> and<code>fsRdWrPerm</code> is retried as <code>fsRdPerm</code> in the case of read-onlyfolders.  Under A/UX 2.0, such calls return <code>fLckdErr</code> if the user doesnot have write permission for the particular file.  Also, if that file resideson a UNIX file system which has been mounted as read-only, a <code>vLckdErr</code>is returned instead of <code>fLckdErr</code>.  Both these problems are corrected inA/UX 2.0.1.</p><h3>Virtual Memory</h3><p>The A/UX 2.0 Toolbox is a virtual memory environment and is currently limitedto 16 MB.  The size of the environment defaults to the size of physical memory,but can be set at login time using the <code>TBMEMORY</code> environment variable.For example, a value for <code>TBMEMORY</code> of 10m results in a 10MB toolboxvirtual memory environment.</p><u></u><h3>24-Bit Environment</h3><p>A/UX 2.0 provides a 24-bit, single application environment which may allow someapplications which are not 32-bit clean to run under A/UX.  Applications arestill subject to limitations regarding direct hardware access and use ofprivileged instructions, but this environment may allow users to continue usingolder versions of software.  Developers must not depend upon this environmentfor future development.  In this 24-bit environment, virtual memory is limitedto 8 MB.</p><h3>Slot Manager</h3><p>When A/UX 2.0 boots it checks each NuBus card. If the card contains a<code>PrimaryInit</code> (and a <code>SecondaryInit</code>) record, A/UX tries toexecute the code. If this code does not follow the general A/UX guidelines (not32-bit clean, it calls traps not supported...) then the kernel gets a panicmessage and the whole system hangs.</p><p>If the PrimaryInit and the SecondaryInit are not present, A/UX assumes that thecard initializes itself or does not require initialization. Test for A/UX using<code>Gestalt </code>if the <code>PrimaryInit</code> contains code that will not workunder A/UX.</p><h3>Video Driver</h3><p>A/UX 2.0 only supports well-behaved video driver control codes. The supportedcalls are documented in <code>/usr/include/mac/video.h</code>. The driver does asanity check of the passed control calls. If the call is not supported oraccepted, the control call is never sent to the video card.</p><p>The only Apple MacOS video driver control code not supported by the A/UX videodriver is the <code>GetGamma, csCode 4</code>. <code>SetGamma</code>, <code>csCode8</code>, is supported from A/UX 2.0.1 forward.</p><p>Developers interested to apply for control calls that are accepted under A/UXshould contact MACDTS. The request should provide information about what csCodenumber the developer would like to have assigned, what functionality thecontrol code contains, and what possible side effects this video control codehas on the system.</p><h3>Sound Manager</h3><p>MacOS 6.0.7 supports the new <code>_SoundDispatch</code> trap starting from 6.0.7forward. This trap is not implemented under A/UX 2.0.1 - even if the basicSystem release is 6.0.7. This means that programs which only test for Systemrelease level for <code>_SoundDispatch</code> availability will break with A/UX2.0.1. Always test for the availability of the <code>_SoundDispatch </code>trapitself.</p><h3>SCSI Manager</h3><p>A/UX 2.0(.1) does not support the SCSI Manager. Thus the <code>_SCSIDispatch</code>trap is not implemented.</p><h3>Script Manager  </h3><p>Starting with A/UX 2.0.1 all the Script Manager  functionality  and traps aresupported.</p><h3>Vertical Retrace Manager</h3><p><code>_AttachVBL and _DoVBLTask</code> traps are not implemented. These traps have todo with managing independent VBL queues for each video device. The A/UX kernelisolates the application from these devices  - it handles the interruptsdirectly, and provides virtual vertical retrace interrupts via Unix signals.</p><p><code>_AttachVBL</code> and <code>_DoVBLTask</code> are mostly used by system levelsoftware and interrupt handlers. Also the low memory global <code>jDoVBLTask</code>is not  initialized.</p><h3>A/UX Startup process and MacOS Systems</h3><p>A/UX is booted from a special A/UX Startup application from MacOS. Some mayhave problems to actually boot A/UX from the Macintosh environment. The problemhas to do with the A/UX Startup program and the Startup tools. These tools(launch, fsck, etc.) consist of position dependent code because they are compiledwith the A/UX C compiler and moved to the A/UX Startup environment.</p><p>Because the base address of these tools are <code>0x9FC00</code> (about 639k) itmeans that any INITs or other patches which increase the system heap above thislimit will break the A/UX Startup shell and the tools. It can't either bechanged out in the field. The only realistic workaround for the moment is touse the A/UX installed MacOS System when booting the computer for A/UX uselater. This problem is subject to change in future.</p><a name="References"></a><P><A HREF="#top">Back to top</A></p><h2>References</h2><P>   A/UX Toolbox:  Macintosh ROM Interface</p><P>   Inside Macintosh, Volume V, Compatibility Guidelines</p><P>   Inside Macintosh, Volume V, The File Manager</p><P>   <A HREF = "../ov/ov_04.html">M.OV.CompatibilityWhy</a></p><P>   d e v e l o p, January 1990, "Compatibility:  Rules for the Road"</p><P>   UNIX Review, June 1990, "UNIX as a Platform for Macintosh Applications"</p><P>   A/UX Device Driver Kit (APDA)</p><P>   Designing Cards and Drivers for Macintosh II and Macintosh SE , SecondEdition</p><P>NFS is a trademark of Sun Microsystems, Inc.</p><P>UNIX is a registered trademark of AT&amp;T</p>         <a name=Downloads></A>                  <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pt_08.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pt/pt_08.html%3Fid%3DDTS10002663-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pt/pt_08.html%3Fid%3DDTS10002663-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pt/pt_08.html%3Fid%3DDTS10002663-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>