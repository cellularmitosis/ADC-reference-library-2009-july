<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>File Control Blocks (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING110></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-109.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-111.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-107.html"><B>Data Organization in Memory</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING110-0></A>
<H2><A NAME=MARKER-9-674></A>File Control Blocks</H2>
 <A NAME=MARKER-2-675></A>Each time a file is opened, the File Manager reads that file's catalog entry and builds a <B>file control block</B> (FCB) in the FCB buffer, which contains information about all access paths. The FCB buffer is a block in the system heap; the first word contains the length <BR>of the buffer, and the remainder of the buffer is used to hold FCBs for open files.<P>
 The initial size of the FCB buffer is determined by the system startup information stored on a volume. Beginning in system software version 7.0, the File Manager attempts to resize the FCB buffer whenever the existing buffer is filled.<A NAME=MARKER-2-676></A><P>
 You can find the beginning of any particular FCB by adding the size of all preceding FCBs to the size of the FCB buffer length word (that is, 2). This offset from the head of the FCB buffer is used as the file reference number of the corresponding open file. Because the current size of an FCB is 94 bytes, the first few valid file reference numbers are 2, 96, 190, 284, 378, 472, and so on. The maximum size of an expandable FCB buffer is 32,535 bytes, so there is an absolute limit of 342 FCBs in the FCB buffer.<A NAME=MARKER-2-60></A><P>
<DL>
<DT><B>Note</B>
<DD>The size and structure of an FCB will be different in future versions of Macintosh system software. To be safe, you should get information from the FCB allocated for an open file by calling the File Manager function <CODE>PBGetFCBInfo</CODE>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 When you close a file (for example, by calling <CODE>FSClose</CODE>), the FCB for that file is cleared, and the File Manager may use that space to hold the FCB for a file that is opened at a later time. Consequently, it is important that you do not attempt to close a file more <BR>than once; you may inadvertently close a file that was opened by the system or by another application.<A NAME=MARKER-2-678></A><P>
<DL>
<DT><B>WARNING</B>
<DD>Closing a volume's catalog file (perhaps by inadvertently calling <CODE>FSClose</CODE> or <CODE>PBClose</CODE> twice with the same file reference number) may result in damage to the volume's file system and loss of data.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 The structure of a file control block is defined by the <CODE>FCB</CODE> data type.<P>
<PRE>
TYPE FCB    =                 {file control block}
RECORD
   fcbFlNum:      LongInt;    {file ID}
   fcbFlags:      Integer;    {file flags}
   fcbSBlk:       Integer;    {reserved}
   fcbEOF:        LongInt;    {logical end-of-file}
   fcbPLen:       LongInt;    {physical end-of-file}
   fcbCrPs:       LongInt;    {current file mark position}
   fcbVPtr:       Ptr;        {pointer to volume control block}
   fcbBfAdr:      Ptr;        {pointer to access path buffer}
   fcbFlPos:      Integer;    {reserved}
   fcbClmpSize:   LongInt;    {file clump size}
   fcbBTCBPtr:    Ptr;        {pointer to B*-tree control block}
   fcbExtRec:     ExtDataRec; {first three file extents}
   fcbFType:      LongInt;    {file's four Finder type bytes}
   fcbCatPos:     LongInt;    {catalog hint for use on close}
   fcbDirID:      LongInt;    {file's parent directory ID}
   fcbCName:      String[31]; {name of file}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-679></A>fcbFlNum</CODE>
<DD> The file ID of this file.
<DT><CODE><A NAME=MARKER-2-680></A>fcbFlags</CODE>
<DD> Flags describing the status of the file. Currently the following bits are defined:<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>0-7<TD>Reserved<TR>
<TD>&nbsp;<TD>8<TD>Set if data can be written to the file<TR>
<TD>&nbsp;<TD>9<TD>Set if this FCB describes a resource fork<TR>
<TD>&nbsp;<TD>10<TD>Set if the file has a locked byte range<TR>
<TD>&nbsp;<TD>11<TD>Reserved<TR>
<TD>&nbsp;<TD>12<TD>Set if the file has shared write permissions<TR>
<TD>&nbsp;<TD>13<TD>Set if the file is locked (write-protected)<TR>
<TD>&nbsp;<TD>14<TD>Set if the file's clump size is specified in the FCB<TR>
<TD>&nbsp;<TD>15<TD>Set if the file has changed since it was last flushed</TABLE>
</CODE>
<DT><CODE><A NAME=MARKER-2-681></A>fcbSBlk</CODE>
<DD> Reserved.
<DT><CODE><A NAME=MARKER-2-682></A>fcbEOF</CODE>
<DD> The logical end-of-file of the file.
<DT><CODE><A NAME=MARKER-2-683></A>fcbPLen</CODE>
<DD> The physical end-of-file of the file.
<DT><CODE><A NAME=MARKER-2-684></A>fcbCrPs</CODE>
<DD> The position of the mark.
<DT><CODE><A NAME=MARKER-2-685></A>fcbVPtr</CODE>
<DD> A pointer to the volume control block of the volume containing <BR>the file.
<DT><CODE><A NAME=MARKER-2-686></A>fcbBfAdr</CODE>
<DD> A pointer to the file's access path buffer.
<DT><CODE><A NAME=MARKER-2-687></A>fcbFlPos</CODE>
<DD> Reserved.
<DT><CODE><A NAME=MARKER-2-688></A>fcbClmpSize</CODE>
<DD> The clump size of the file.
<DT><CODE><A NAME=MARKER-2-689></A>fcbBTCBPtr</CODE>
<DD> A pointer to the file's B*-tree control block.
<DT><CODE><A NAME=MARKER-2-690></A>fcbExtRec</CODE>
<DD> An extent record (12 bytes) containing the first three extents of <BR>the file.
<DT><CODE><A NAME=MARKER-2-691></A>fcbFType</CODE>
<DD> The file's Finder type.
<DT><CODE><A NAME=MARKER-2-692></A>fcbCatPos</CODE>
<DD> A catalog hint, used when you close the file.
<DT><CODE><A NAME=MARKER-2-693></A>fcbDirID</CODE>
<DD> The file's parent directory ID.
<DT><CODE><A NAME=MARKER-2-694></A>fcbCName</CODE>
<DD> The file's name (as contained in the volume catalog file).<A NAME=MARKER-2-695></A><A NAME=MARKER-2-696></A>
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-109.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-111.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
