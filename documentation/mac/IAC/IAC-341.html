<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Supplying Alternative Create and Send Functions(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING341></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-340.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-342.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-331.html"><B>Chapter 10 - Scripting Components</B></A> / <A HREF="IAC-333.html"><B>Using Scripting Component Routines</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING341-0></A>
<H2><A NAME=MARKER-9-149></A>Supplying Alternative Create and Send Functions</H2>
 Every scripting component calls a <B>create function</B> whenever it creates an Apple event during script execution, and a <B>send function</B> whenever it sends an Apple event. Scripting components that use Apple events during script compilation, including AppleScript, also call create and send functions during compilation. <A NAME=MARKER-2-150></A><P>
 Some scripting components may provide routines that allow your application to set or get the pointers to the create and send functions used by that scripting component. If your application does not set alternative send and create functions, the scripting component uses the standard Apple Event Manager functions <CODE>AESend</CODE> and <CODE>AECreateAppleEvent</CODE>, which it calls with its own default parameters.<P>
 A scripting component that supports the routines you can use to set or get alternative create and send functions has the <CODE>kOSASupportsAESending</CODE> bit set in its component description record. For more information about using the Component Manager to find a scripting component that supports specific routines, see <A HREF=IAC-332.html#MARKER-9-70>"Connecting to a Scripting Component,"</A> which begins on <A HREF=IAC-332.html#MARKER-9-70>page 10-3</A>.<P>
 When a scripting component calls your alternative send or create function, the A5 register is set up for your application, and your application is the current process. <P>
<A NAME=HEADING341-5></A>
<H3><A NAME=MARKER-9-151></A>Alternative Create Functions</H3>
 A scripting component that allows your application to set or get its create function uses a pointer to identify the current create function.<P>
<PRE>
TYPE AECreateAppleEventProcPtr = ProcPtr;
</PRE>
 A pointer of type <CODE>AECreateAppleEventProcPtr</CODE> points to a <CODE>MyAECreateProc</CODE> function that takes the same parameters as the <CODE>AECreate</CODE> function plus a reference constant. <A NAME=MARKER-2-152></A><P>
<PRE>
FUNCTION MyAECreateProc (theAEEventClass: AEEventClass; 
                         theAEEventID: AEEventID; 
                         target: AEAddressDesc; 
                         returnID: Integer; 
                         transactionID: LongInt; 
                         VAR result: AppleEvent;
                         refCon: LongInt): OSErr; 
</PRE>
 Your application can use an alternative create function to gain control over the creation and addressing of Apple events. This can be useful, for example, if your application needs to add its own transaction code to the event.<P>
 To set an alternative create function, call <CODE>OSASetCreateProc</CODE>; to get the current create function, call <CODE>OSAGetCreateProc</CODE>. If you do not set an alternative create function for a scripting component, it uses the standard Apple Event Manager function <CODE>AECreateAppleEvent</CODE>, which it calls with its own default parameters.<P>
 Your alternative create function can in turn call the scripting component's default create function. To do this, your application can call <CODE>OSAGetCreateProc</CODE> before calling <CODE>OSASetCreateProc</CODE> to set the alternative create function, then call the default create function directly when necessary. <A NAME=MARKER-2-153></A><P>
<A NAME=HEADING341-13></A>
<H3><A NAME=MARKER-9-154></A>Alternative Send Functions</H3>
 A scripting component that allows your application to set or get its send function uses a pointer to identify the current send function. <A NAME=MARKER-2-155></A><P>
<PRE>
TYPE AESendProcPtr = ProcPtr;
</PRE>
 A pointer of type <CODE>AESendProcPtr</CODE> points to a <CODE>MyAESendProc</CODE> function that takes the same parameters as the <CODE>AECreate</CODE> function plus a reference constant. <A NAME=MARKER-2-190></A><P>
<PRE>
FUNCTION MyAESendProc (theAppleEvent: AppleEvent; 
                       VAR reply: AppleEvent; 
                       sendMode: AESendMode; 
                       sendPriority: AESendPriority; 
                       timeOutInTicks: LongInt; 
                       idleProc: IdleProcPtr; 
                       filterProc: EventFilterProcPtr;
                       refCon: LongInt): OSErr; 
</PRE>
 Your application can use an alternative send function to perform almost any action instead of or in addition to sending Apple events. For example, it can modify Apple events before sending them, save copies of Apple events before sending them, or substitute some other specialized mechanism for sending Apple events. <P>
 To set an alternative send function, call <CODE>OSASetSendProc</CODE>; to get the current send function, call <CODE>OSAGetSendProc</CODE>. If you do not set an alternative send function for a scripting component, it uses the standard Apple Event Manager function <CODE>AESend</CODE>, which it calls with its own default parameters.<P>
 Your alternative send function can in turn call the scripting component's default send function. To do this, your application can call <CODE>OSAGetSendProc</CODE> before calling <CODE>OSASetSendProc</CODE> to set the alternative send function, then call the default send function directly when necessary. <P>
 After a scripting component successfully calls a send function, the scripting component proceeds with script execution. If a call to a send function is not successful, the scripting component returns <CODE>errOSAScriptError</CODE>, and a subsequent call to <CODE>OSAScriptError</CODE> with <CODE>kOSAErrorNumber</CODE> in the <CODE>selector</CODE> parameter returns <CODE>errAEEventNotHandled</CODE>. <P>
 Multithreaded applications need to allow other threads to execute while one thread is waiting for the response to an Apple event. You can accomplish this by supplying an idle function for your alternative send function that allows threads to be switched and by setting the <CODE>kAEQueueReply</CODE> flag in the <CODE>sendMode</CODE> parameter of the send function. However, if the call to the send function specifies the <CODE>kAENoReply</CODE> flag, be careful not to override it, because the user may have explicitly requested that no reply be returned or the <CODE>'aete'</CODE> resource may indicate that the application cannot reply to that event. <P>
<DL>
<DT><B>Note</B>
<DD>The Apple Event Manager calls an idle function only after an Apple event has been sent, whereas a scripting component calls an active function at regular intervals throughout script compilation and execution. Thus, to give time to multiple threads, you may want to provide an alternative active function in addition to an alternative send function and an idle function.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Some scripting components (including the current version of AppleScript) can execute only one script at a time per component instance. For this reason, a multithreaded application must provide a separate component instance for each script that it compiles or executes while it is also compiling or executing other scripts.<P>
 You should follow the rules for setting <CODE>sendMode</CODE> flags described in the chapter "Creating and Sending Apple Events" in this book when you set flags for the <CODE>sendMode</CODE> parameter of an alternative send function. Keep these additional guidelines in mind:<P>
<UL>
<LI>If the target application is on the local computer, you can set the <CODE>kAECanInteract</CODE> and <CODE>kAECanSwitchLayer</CODE> flags.
<LI>If the target application is on the local computer and the user has requested no reply, set the <CODE>kAENoReply</CODE>, <CODE>kAECanInteract</CODE>, and <CODE>kAECanSwitchLayer</CODE> flags.
<LI>If the target application is on a remote computer, set the <CODE>kAENeverInteract</CODE> flag and do not set the <CODE>kAECanSwitchLayer</CODE> flag. <A NAME=MARKER-2-157></A> <A NAME=MARKER-2-158></A><P>
</UL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-340.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-342.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
