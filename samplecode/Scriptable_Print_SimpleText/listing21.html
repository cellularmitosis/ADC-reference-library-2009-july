<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Scriptable Print SimpleText - /ScriptablePrinting.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; <A HREF="javascript:location.replace('index.html');">Scriptable Print SimpleText</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Scriptable Print SimpleText</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ScriptablePrinting.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/AboutBox.c</option>
<option value="listing2.html">/AboutBox.h</option>
<option value="listing3.html">/AboutBox.r</option>
<option value="listing4.html">/aete.r</option>
<option value="listing5.html">/AGFile.h</option>
<option value="listing6.html">/Clipboard.c</option>
<option value="listing7.html">/Clipboard.h</option>
<option value="listing8.html">/Clipboard.r</option>
<option value="listing9.html">/CoercePrGeneral.h</option>
<option value="listing10.html">/ExtendPrintRecord.c</option>
<option value="listing11.html">/ExtendPrintRecord.h</option>
<option value="listing12.html">/Localize.r</option>
<option value="listing13.html">/MacIncludes.h</option>
<option value="listing14.html">/MovieFile.c</option>
<option value="listing15.html">/MovieFile.h</option>
<option value="listing16.html">/MovieFile.r</option>
<option value="listing17.html">/PICTFile.c</option>
<option value="listing18.html">/PICTFile.h</option>
<option value="listing19.html">/PICTFile.r</option>
<option value="listing20.html">/PrintAETypes.h</option>
<option value="listing21.html">/ScriptablePrinting.c</option>
<option value="listing22.html">/ScriptablePrinting.h</option>
<option value="listing23.html">/SimpleText.c</option>
<option value="listing24.html">/SimpleText.h</option>
<option value="listing25.html">/SimpleText.r</option>
<option value="listing26.html">/TextDrag.c</option>
<option value="listing27.html">/TextFile.a</option>
<option value="listing28.html">/TextFile.c</option>
<option value="listing29.html">/TextFile.h</option>
<option value="listing30.html">/TextFile.r</option>
<option value="listing31.html">/ThreeDMetafile.c</option>
<option value="listing32.html">/ThreeDMetafile.h</option>
<option value="listing33.html">/ThreeDMetafile.r</option></select>
				</p>
				</form>
				<p><strong><a href="Scriptable_Print_SimpleText.zip">Download Sample</a></strong> (&#147;Scriptable_Print_SimpleText.zip&#148;, 212.5K)<BR>
<strong><a href="Scriptable_Print_SimpleText.dmg">Download Sample</a></strong> (&#147;Scriptable_Print_SimpleText.dmg&#148;, 290.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/***  File:    ScriptablePrinting.c****  Functions defined in Technote 11xx**** Copyright 1999 Apple Computer. All rights reserved.****  You may incorporate this sample code into your applications without**  restriction, though the sample code has been provided &quot;AS IS&quot; and the**  responsibility for its operation is 100% yours. However, what you are**  not permitted to do is to redistribute the source as &quot;DSC Sample Code&quot;**  after having made changes. If you're going to re-distribute the source,**  we require that you make it clear in the source that the code was**  descended from Apple Sample Code, but that you've made changes.*/#include &lt;Printing.h&gt;#include &lt;AppleEvents.h&gt;#include &quot;ScriptablePrinting.h&quot;#include &quot;ExtendPrintRecord.h&quot;#include &quot;CoercePrGeneral.h&quot;OSStatus getPrintRecordFromEvent(const AppleEvent *inAppleEvent,                THPrint    *hPrintP)/*  Given a print event Apple Event descriptor inAppleEvent,  look for the optional print setting parameter.  If this parameter exists, then coerce it into a print  record and place the handle to the print record into  *hPrintP. If the optional parameter does not exist  or it cannot be converted, then a non-zero error code  is returned and *hPrintP is set to NULL*/{  OSStatus  err = noErr;  AEDesc    optionalDesc = {};  AEDesc    printRecordDesc = {};    AECoercionHandlerUPP handler = NULL;  long refCon;  Boolean typeIsDesc;  PrOpen();  err = PrError();  if(err == noErr) {    err = AEGetParamDesc(inAppleEvent, keyAEPropData, typeAERecord, &amp;optionalDesc);    if (err == noErr) {      // if you want to call PrGeneral directly, comment out this call,      // and set err to errAEHandlerNotFound. This will simulate the      // case when Desktop Printing is not running, so the coercion      // handler has not been loaded. See the Technote for more details.      err = AEGetCoercionHandler(typeAERecord, kPrintRecordAEType,                     &amp;handler, &amp;refCon, &amp;typeIsDesc, true);      if (err == noErr) {        err = AECoerceDesc(&amp;optionalDesc, kPrintRecordAEType, &amp;printRecordDesc);      } else if (err == errAEHandlerNotFound) {        /*  If desktop printing is not enabled,          the handler won't be installed. This          is not fatal, since we can call the          driver's PrGeneral call directly.          It's better to use the coercion handler,          but if we can't find it, this is a          good fallback to use         */        PrCoerceStruct  coerceData;                coerceData.iOpCode = kPrCoerceOp;        coerceData.iError = noErr;        coerceData.lReserved = 0;        coerceData.fromDesc = &amp;optionalDesc;        coerceData.toType = kPrintRecordAEType;        coerceData.toDesc = &amp;printRecordDesc;        PrGeneral((Ptr)&amp;coerceData);        err = coerceData.iError;      }    }  }  if (err == noErr) {    OSErr  tempErr;    *hPrintP = (THPrint) printRecordDesc.dataHandle;    err = HandToHand((Handle *)hPrintP);    tempErr = AEDisposeDesc(&amp;printRecordDesc);    if (err == noErr) err = tempErr;  } else {    *hPrintP = NULL;  }    err = AEDisposeDesc(&amp;optionalDesc);    PrClose();  return err;}OSStatus getPrintJobPrintRec(THPrint docPrintRec,              THPrint settingsPrintRec,              THPrint *jobPrintRecP)/*  The caller passes in the print record stored with a  document, docPrintRec, as well as the print record  obtained from the print event, settingsPrintRec.  This function creates a new print record that combines  the formatting information from docPrintRec with  the print time settings in settingsPrintRec and  places the new print record into *jobPrintRecP.  On entry, settingsPrintRec can be NULL in which  case docPrintRec is duplicated and returned in  *jobPrintRecP. In either case, if a new print  record can not be created, this function sets  *jobPrintRecP to NULL and returns a non-zero error  code.*/{  OSStatus  err = noErr;  THPrint    jobPrintRec = docPrintRec;    err = HandToHand((Handle *)&amp;jobPrintRec);  if ((err == noErr) &amp;&amp; (settingsPrintRec != NULL)) {    /*  Both print records must be extended when      calling PrJobMerge in order to get a full      merge. The scripted print settings print      record is extended by the coercion so      nothing need be done to it here.    */    err = extendPrValidate(docPrintRec);  // from TN 1161        if (err == noErr) {      PrJobMerge(settingsPrintRec, jobPrintRec);      err = PrError();    }  } else {    jobPrintRec = NULL;  }    if (err != noErr) {    if (jobPrintRec != NULL) {      DisposeHandle((Handle) jobPrintRec);      jobPrintRec = NULL;    }  }    *jobPrintRecP = jobPrintRec;    return err;}OSStatus getPrintJobShowDialog(const AppleEvent *inAppleEvent,                Boolean  *showDialog)/*  Given a print Apple Event, look for the optional parameter  saying whether or not the application should show the  PrJobDialog. While an apple event with the &quot;print settings&quot;  parameter COULD have most of the items that will be needed  to print the job, it's possible that the user or scripter  will   want to present the dialog to handle printer-specific  settings. An application should not prevent the user from  doing so, so this function is needed. The application should  default to showing the dialog if the parameter is not  specified.*/{  OSStatus  err = noErr;  AEDesc    showDesc = {};    err = AEGetParamDesc(inAppleEvent, kPrintDialogAEType,            typeBoolean, &amp;showDesc);  if (err == noErr) {    *showDialog = **(showDesc.dataHandle);  }  if (err == errAEDescNotFound) {    /*  not having the descriptor is okay.      It just means we default to showing.    */    *showDialog = true;    err = noErr;  }    return err;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Scriptable_Print_SimpleText/listing21.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Scriptable_Print_SimpleText/listing21.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Scriptable_Print_SimpleText/listing21.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>