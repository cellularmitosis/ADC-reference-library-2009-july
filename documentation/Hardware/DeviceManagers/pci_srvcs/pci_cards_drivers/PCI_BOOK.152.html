<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Reducing Memory Usage</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.149.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.151.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.153.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=3684"> </A><A NAME="13104"> </A>Reducing Memory Usage</H1><P CLASS="T1.Text1"><A NAME="pgfId=3685"> </A><TT CLASS="cv">PrepareMemoryForIO</TT> normally keeps its own copy of the mapping tables in addition to the tables the driver has allocated. Hence, memory usage can be reduced if the driver shares its mapping tables with the operating system. The <TT CLASS="cv">kIOShareMappingTables</TT> option specifies that <TT CLASS="cv">PrepareMemoryForIO</TT> can use the driver's mapping tables rather than maintain its own copies. The shared mapping tables must be located in logical memory that cannot page fault until the final <TT CLASS="cv">CheckpointIO</TT> call finishes (that is, the memory is locked). In addition, the mapping tables must remain allocated and the entries unaltered until after the final <TT CLASS="cv">CheckpointIO</TT> call. It is not necessary for the driver to provide both tables.</P><P CLASS="T1.Text1"><A NAME="pgfId=3686"> </A>A full-sized mapping table contains as many entries as there are pages in the client buffer. However, the driver can use a smaller table if it calls <TT CLASS="cv">PrepareMemoryForIO</TT> more than once for a given client buffer. This technique is discussed in <A HREF="PCI_BOOK.155.html#28479" CLASS="XRef">Partial Preparation</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3690"> </A>The <TT CLASS="cv">granularity</TT> specification can reduce memory usage in the event of a partial preparation. Granularity is discussed in <A HREF="PCI_BOOK.155.html#28479" CLASS="XRef">Partial Preparation</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3694"> </A>Certain DMA transactions require both mapping tables. However, the size of the logical mapping table can be easily reduced. The <TT CLASS="cv">kIOMinimalLogicalMapping</TT> option is discussed in <A HREF="PCI_BOOK.154.html#37753" CLASS="XRef">DMA Alignment Requirements</A>.</P><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.149.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.151.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.153.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>