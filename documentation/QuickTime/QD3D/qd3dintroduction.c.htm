<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Configuring a Window</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3853"> </A>Configuring a Window</H1><P CLASS="T1.Text1"><A NAME="pgfId=3856"> </A><A NAME="marker=3854"> </A><A NAME="marker=3855"> </A>Usually, you'll want to display the two-dimensional image of a three-dimensional model in a window. To do this, it's useful to define a custom window information structure that holds all the information about the QuickDraw&nbsp;3D objects that are associated with the window. In the simplest cases, this information includes the model itself, the view, the illumination shading to be applied, and the desired styles of rendering the model. You might define a window information structure like this:<A NAME="marker=3857"> </A></P><CODE CLASS="Cv.Code"><A NAME="pgfId=11021"> </A>struct WindowInfo {<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3ViewObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3GroupObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3ShaderObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;illumination;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3StyleObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interpolation;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3StyleObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backfacing;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3StyleObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fillstyle;<BR>};<BR>typedef struct WindowInfo WindowInfo, *WindowInfoPtr, **WindowInfoHandle;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3859"> </A>A standard way to attach an application-defined data structure (such as the <TT CLASS="cv">WindowInfo</TT> structure) to a window is to set a handle to that structure as the window's reference constant. This technique is used in <A HREF="qd3dintroduction.c.htm#22280" CLASS="XRef">Listing&nbsp;5</A>.</P><P CLASS="Note"><A NAME="pgfId=3864"> </A><A NAME="17484"> </A>For a more complete description of using a window's reference constant to maintain window-specific information, see the discussion of document records in <I CLASS="italics">Inside Macintosh: Overview</I>. </P><P CLASS="L.Listing"><A NAME="pgfId=3869"> </A>Listing&nbsp;5<A NAME="22280"> </A>Creating a new window and attaching a window information structure</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=11025"> </A>void MyNewWindow (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;WindowPtr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myWindow;<BR>&nbsp;&nbsp;&nbsp;&nbsp;Rect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myBounds = {42, 4, 442, 604};<BR>&nbsp;&nbsp;&nbsp;&nbsp;WindowInfoHandle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myWinfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Create new window.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWindow = NewCWindow(0L, &amp;myBounds, &quot;\pWindow!&quot;, 1, documentProc,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(WindowPtr) -1, true, 0L);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myWindow == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SetPort(myWindow);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=11031"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Create storage for the new window and attach it to window.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWinfo = (WindowInfoHandle) NewHandle(sizeof(WindowInfo));<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myWinfo == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SetWRefCon(myWindow, (long) myWinfo);<BR>&nbsp;&nbsp;&nbsp;&nbsp;HLock((Handle) myWinfo);<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Create a new view.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).view = MyNewView(myWindow);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).view == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Create model to display.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).model = MyNewModel();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*see Listing&nbsp;0-4*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).model == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Configure an illumination shader.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).illumination = Q3PhongIllumination_New();<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).illumination == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Configure the rendering styles.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).interpolation =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3InterpolationStyle_New(kQ3InterpolationStyleNone);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).interpolation == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).backfacing =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3BackfacingStyle_New(kQ3BackfacingStyleRemoveBackfacing);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).backfacing == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(**myWinfo).fillstyle = Q3FillStyle_New(kQ3FillStyleFilled);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if ((**myWinfo).fillstyle == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;HUnlock((Handle) myWinfo);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;return;<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=11037"> </A>bail:<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*If failed for any reason, then close the window.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myWinfo != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisposeHandle((Handle) myWinfo);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myWindow != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisposeWindow(myWindow);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3876"> </A><A NAME="marker=11039"> </A>The <TT CLASS="cv">MyNewWindow</TT> function creates a new window and a new window information structure, attaches the structure to the window, and then fills out several fields of that structure. In particular, <TT CLASS="cv">MyNewWindow</TT> creates a new illumination shader that implements a Phong illumination model. You need an illumination shader for a view's lights to have any effect. (See the chapter <A HREF="qd3dshading.htm#20942" CLASS="XRef">&quot;Shader Objects&quot;</A> for complete information on the available illumination shaders.) Then <TT CLASS="cv">MyNewWindow</TT> disables interpolation between vertices of faces, removes unseen backfaces of objects in the model, and sets the renderer to render filled faces on those objects. These settings are actually passed to the renderer by <I CLASS="italics">submitting</I> the styles during rendering. See <A HREF="qd3dintroduction.11.htm#11412" CLASS="XRef">&quot;Rendering a Model&quot;</A> for details.</P><P CLASS="Note"><A NAME="pgfId=5750"> </A>The <TT CLASS="cv">MyNewWindow</TT> function can leak memory. Your application should use a different error-recovery strategy than is used in <A HREF="qd3dintroduction.c.htm#22280" CLASS="XRef">Listing&nbsp;5</A>. <A NAME="marker=5761"> </A><A NAME="marker=5769"> </A></P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>