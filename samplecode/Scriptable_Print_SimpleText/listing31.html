<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Scriptable Print SimpleText - /ThreeDMetafile.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; <A HREF="javascript:location.replace('index.html');">Scriptable Print SimpleText</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Scriptable Print SimpleText</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ThreeDMetafile.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/AboutBox.c</option>
<option value="listing2.html">/AboutBox.h</option>
<option value="listing3.html">/AboutBox.r</option>
<option value="listing4.html">/aete.r</option>
<option value="listing5.html">/AGFile.h</option>
<option value="listing6.html">/Clipboard.c</option>
<option value="listing7.html">/Clipboard.h</option>
<option value="listing8.html">/Clipboard.r</option>
<option value="listing9.html">/CoercePrGeneral.h</option>
<option value="listing10.html">/ExtendPrintRecord.c</option>
<option value="listing11.html">/ExtendPrintRecord.h</option>
<option value="listing12.html">/Localize.r</option>
<option value="listing13.html">/MacIncludes.h</option>
<option value="listing14.html">/MovieFile.c</option>
<option value="listing15.html">/MovieFile.h</option>
<option value="listing16.html">/MovieFile.r</option>
<option value="listing17.html">/PICTFile.c</option>
<option value="listing18.html">/PICTFile.h</option>
<option value="listing19.html">/PICTFile.r</option>
<option value="listing20.html">/PrintAETypes.h</option>
<option value="listing21.html">/ScriptablePrinting.c</option>
<option value="listing22.html">/ScriptablePrinting.h</option>
<option value="listing23.html">/SimpleText.c</option>
<option value="listing24.html">/SimpleText.h</option>
<option value="listing25.html">/SimpleText.r</option>
<option value="listing26.html">/TextDrag.c</option>
<option value="listing27.html">/TextFile.a</option>
<option value="listing28.html">/TextFile.c</option>
<option value="listing29.html">/TextFile.h</option>
<option value="listing30.html">/TextFile.r</option>
<option value="listing31.html">/ThreeDMetafile.c</option>
<option value="listing32.html">/ThreeDMetafile.h</option>
<option value="listing33.html">/ThreeDMetafile.r</option></select>
				</p>
				</form>
				<p><strong><a href="Scriptable_Print_SimpleText.zip">Download Sample</a></strong> (&#147;Scriptable_Print_SimpleText.zip&#148;, 212.5K)<BR>
<strong><a href="Scriptable_Print_SimpleText.dmg">Download Sample</a></strong> (&#147;Scriptable_Print_SimpleText.dmg&#148;, 290.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    ThreeDMetafile.c  Contains:  3D viewer support for SimpleText  Version:  SimpleText 1.4 or later** Copyright 1994-1996 Apple Computer. All rights reserved.****  You may incorporate this sample code into your applications without**  restriction, though the sample code has been provided &quot;AS IS&quot; and the**  responsibility for its operation is 100% yours.  However, what you are**  not permitted to do is to redistribute the source as &quot;DSC Sample Code&quot;**  after having made changes. If you're going to re-distribute the source,**  we require that you make it clear in the source that the code was**  descended from Apple Sample Code, but that you've made changes.*/#include &quot;MacIncludes.h&quot;#include &lt;String.h&gt;#include &quot;ThreeDMetafile.h&quot;static GlobalEntry  gProcPointers[] =  {  {uppViewerLibNewProcInfo, nil},  {uppViewerLibDisposeProcInfo, nil},  {uppViewerLibUseFileProcInfo, nil},  {uppViewerLibUseDataProcInfo, nil},    {uppViewerLibWriteFileProcInfo, nil},  {uppViewerLibWriteDataProcInfo, nil},    {uppViewerLibDrawProcInfo, nil},  {uppViewerLibGetPictProcInfo, nil},  {uppViewerLibGetButtonRectProcInfo, nil},  {uppViewerLibGetDimensionProcInfo, nil},  {uppViewerLibSetFlagsProcInfo, nil},  {uppViewerLibGetFlagsProcInfo, nil},  {uppViewerLibSetBoundsProcInfo, nil},  {uppViewerLibGetBoundsProcInfo, nil},  {uppViewerLibSetPortProcInfo, nil},  {uppViewerLibGetPortProcInfo, nil},  {uppViewerLibEventProcInfo, nil},  {uppViewerLibAdjustCursorProcInfo, nil},  {uppViewerLibGetStateProcInfo, nil},  {uppViewerLibClearProcInfo, nil},  {uppViewerLibCutProcInfo, nil},  {uppViewerLibCopyProcInfo, nil},  {uppViewerLibPasteProcInfo, nil}  };    // --------------------------------------------------------------------------------------------------------------// PRIVATE ROUTINES// --------------------------------------------------------------------------------------------------------------/* rather than include the whole StdCLib, I'll just define it here */static int strcmp(const char * str1, const char * str2){  const  unsigned char* p1 = (unsigned char *) str1;  const  unsigned char* p2 = (unsigned char *) str2;  unsigned char    c1, c2;    while ((c1 = *p1++) == (c2 = *p2++))    if (!c1)      return(0);  return(c1 - c2);}static UniversalProcPtr MakeARoutineDescriptor(void *theProc, ProcInfoType theProcInfo)/*  The Symantec compiler doesn't like jumping into staticly done routine descriptors,  so we have to actually allocate them as pointers.  Sigh.*/{  RoutineDescriptor rd = BUILD_ROUTINE_DESCRIPTOR(0, nil);    Ptr  newPtr;    rd.routineRecords[0].procInfo = theProcInfo;  rd.routineRecords[0].procDescriptor = theProc;  rd.routineRecords[0].ISA = kPowerPCISA + kPowerPCRTA;  newPtr = NewPtrClear(sizeof(rd));  if (newPtr)    BlockMove(&amp;rd, newPtr, sizeof(rd));  return((UniversalProcPtr) newPtr);  } // MakeARoutineDescriptor// --------------------------------------------------------------------------------------------------------------static void FillInEntryPoints(void){  long        result;    if (     (Gestalt('qd3d', &amp;result) == noErr) &amp;&amp;     (Gestalt('sysa', &amp;result) == noErr) &amp;&amp; (result == 2)     )    {    CFragSymbolClass  symClass;    CFragConnectionID  connID;    Ptr         mainAddr;    Str255        errName;    long        procID = 0;        if (GetSharedLibrary(&quot;\pQD3DViewerLib&quot;, 'pwpc', 1, &amp;connID, &amp;mainAddr, errName) == noErr)      {      FindSymbol(connID, &quot;\pQ3ViewerNew&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerDispose&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);            FindSymbol(connID, &quot;\pQ3ViewerUseFile&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerUseData&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerWriteFile&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerWriteData&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerDraw&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetPict&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetButtonRect&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetDimension&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerSetFlags&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetFlags&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerSetBounds&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetBounds&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerSetPort&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetPort&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerEvent&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerAdjustCursor&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerGetState&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerClear&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerCut&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerCopy&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      FindSymbol(connID, &quot;\pQ3ViewerPaste&quot;, (Ptr*)&amp;gProcPointers[procID++].entry, &amp;symClass);      }        // build the routine descriptors    {    short  i;        for (i = 0; i &lt; procID; ++i)      gProcPointers[i].entry = MakeARoutineDescriptor(gProcPointers[i].entry, gProcPointers[i].info);    }        // as long as it isn't NIL, we're OK    if (gProcPointers[0].entry)      gMachineInfo.haveThreeD = true;    }} // FillInEntryPoints// --------------------------------------------------------------------------------------------------------------// OOP INTERFACE ROUTINES// --------------------------------------------------------------------------------------------------------------static OSErr ThreeDCloseWindow(      WindowRef pWindow,       WindowDataPtr pData){#pragma unused (pWindow)  ViewerLib_Dispose( ((ThreeDDataPtr)pData)-&gt;viewerObject);  return(noErr);  } // ThreeDCloseWindow// --------------------------------------------------------------------------------------------------------------static OSErr ThreeDGetBalloon(      WindowRef pWindow,       WindowDataPtr pData,       Point *localMouse,      short * returnedBalloonIndex,       Rect *returnedRectangle){#pragma unused (pWindow, pData, localMouse, returnedBalloonIndex, returnedRectangle)  *returnedBalloonIndex = iDidTheBalloon;    return(noErr);  } // ThreeDGetBalloon// --------------------------------------------------------------------------------------------------------------static Boolean  ThreeDFilterEvent(      WindowRef pWindow,       WindowDataPtr pData,       EventRecord *pEvent){#pragma unused (pWindow)    if (pEvent-&gt;what == activateEvt)    {    if (pEvent-&gt;modifiers &amp; activeFlag)      ViewerLib_SetFlags(((ThreeDDataPtr)pData)-&gt;viewerObject, ViewerLib_GetFlags(((ThreeDDataPtr)pData)-&gt;viewerObject) | kQ3ViewerActive);    else      ViewerLib_SetFlags(((ThreeDDataPtr)pData)-&gt;viewerObject, ViewerLib_GetFlags(((ThreeDDataPtr)pData)-&gt;viewerObject) &amp; ~kQ3ViewerActive);    }      return((Boolean)ViewerLib_Event (((ThreeDDataPtr)pData)-&gt;viewerObject, pEvent));  } // ThreeDFilterEvent// --------------------------------------------------------------------------------------------------------------static OSErr ThreeDAdjustCursor(WindowRef pWindow, WindowDataPtr pData, Point *localMouse, Rect *globalRect){#pragma unused (pWindow, globalRect)  OSErr anErr = noErr;  ViewerLib_AdjustCursor(((ThreeDDataPtr)pData)-&gt;viewerObject, localMouse);    return(eActionAlreadyHandled);  } // ThreeDAdjustCursor// --------------------------------------------------------------------------------------------------------------static OSErr ThreeDGetCoachRectangle(WindowRef pWindow, WindowDataPtr pData, Rect *pRect, Ptr name){#pragma unused (pWindow)  OSErr anErr = fnfErr;    if (strcmp(name, &quot;Camera&quot;) == 0)    anErr = ViewerLib_GetButtonRect(((ThreeDDataPtr)pData)-&gt;viewerObject, kQ3ViewerButtonCamera, pRect);  if (strcmp(name, &quot;Truck&quot;) == 0)    anErr = ViewerLib_GetButtonRect(((ThreeDDataPtr)pData)-&gt;viewerObject, kQ3ViewerButtonTruck, pRect);  if (strcmp(name, &quot;Orbit&quot;) == 0)    anErr = ViewerLib_GetButtonRect(((ThreeDDataPtr)pData)-&gt;viewerObject, kQ3ViewerButtonOrbit, pRect);  if (strcmp(name, &quot;Zoom&quot;) == 0)    anErr = ViewerLib_GetButtonRect(((ThreeDDataPtr)pData)-&gt;viewerObject, kQ3ViewerButtonZoom, pRect);  if (strcmp(name, &quot;Dolly&quot;) == 0)    anErr = ViewerLib_GetButtonRect(((ThreeDDataPtr)pData)-&gt;viewerObject, kQ3ViewerButtonDolly, pRect);        return(anErr);  } // ThreeDGetCoachRectangle// --------------------------------------------------------------------------------------------------------------void ThreeDGetFileTypes(    OSType * pFileTypes,    OSType * pDocumentTypes,    short * numTypes){  if (!gMachineInfo.haveThreeD)    FillInEntryPoints();      if (gMachineInfo.haveThreeD)    {    pFileTypes[*numTypes]     = '3DMF';    pDocumentTypes[*numTypes]   = kThreeDWindow;    (*numTypes)++;    }  } // ThreeDGetFileTypes// --------------------------------------------------------------------------------------------------------------static OSErr  ThreeDUpdateWindow(WindowRef pWindow, WindowDataPtr pData){#pragma unused (pWindow)    ViewerLib_Draw(((ThreeDDataPtr)pData)-&gt;viewerObject);    return(noErr);  } // ThreeDUpdateWindow// --------------------------------------------------------------------------------------------------------------static OSErr  ThreeDAdjustMenus(WindowRef pWindow, WindowDataPtr pData){#pragma unused (pWindow)  OSErr anErr = noErr;    if (ViewerLib_GetState(((ThreeDDataPtr)pData)-&gt;viewerObject) )     EnableCommand(cCopy);  return(anErr);  } // ThreeDAdjustMenus// --------------------------------------------------------------------------------------------------------------static OSErr  ThreeDCommand(WindowRef pWindow, WindowDataPtr pData, short commandID, long menuResult){#pragma unused (menuResult)  OSErr            anErr = noErr;  ViewerObject         theViewer = ((ThreeDDataPtr)pData)-&gt;viewerObject;    SetPort((GrafPtr) GetWindowPort(pWindow));      switch (commandID)     {    case cCopy:      anErr = ViewerLib_Copy(theViewer);      if (anErr == noErr)        anErr = eActionAlreadyHandled;      break;    } // switch (commandID)      return(anErr);  } // ThreeDCommand// --------------------------------------------------------------------------------------------------------------static OSErr  ThreeDMakeWindow(      WindowRef pWindow,      WindowDataPtr pData){  OSErr            anErr = noErr;  ViewerObject        viewerObj;  pData-&gt;pCloseWindow     = (CloseWindowProc)      ThreeDCloseWindow;  pData-&gt;pFilterEvent     = (FilterEventProc)      ThreeDFilterEvent;  pData-&gt;pGetBalloon       = (GetBalloonProc)      ThreeDGetBalloon;  pData-&gt;pUpdateWindow     = (UpdateWindowProc)    ThreeDUpdateWindow;  pData-&gt;pAdjustMenus     = (AdjustMenusProc)      ThreeDAdjustMenus;  pData-&gt;pCommand         = (CommandProc)        ThreeDCommand;  pData-&gt;pAdjustCursor     = (AdjustCursorProc)    ThreeDAdjustCursor;  pData-&gt;pGetCoachRectangle  = (GetCoachRectangleProc)  ThreeDGetCoachRectangle;  pData-&gt;dragWindowAligned  = 0;  viewerObj = ViewerLib_New((CGrafPtr )pWindow,  &amp;pData-&gt;contentRect,  kQ3ViewerDefault | kQ3ViewerDraggingOff);   if (viewerObj == 0)    {    anErr = memFullErr;    }  else    {    anErr = ViewerLib_UseFile(viewerObj, pData-&gt;dataRefNum);    if (anErr == noErr)      ((ThreeDDataPtr)pData)-&gt;viewerObject = viewerObj;    else      ViewerLib_Dispose(viewerObj);        }    return(anErr);  } // ThreeDMakeWindow// --------------------------------------------------------------------------------------------------------------OSErr  ThreeDPreflightWindow(PreflightPtr pPreflightData){    pPreflightData-&gt;continueWithOpen   = true;  pPreflightData-&gt;makeProcPtr     = ThreeDMakeWindow;  pPreflightData-&gt;resourceID      = kThreeDWindowID;  pPreflightData-&gt;storageSize     = sizeof(ThreeDDataRecord);  return(noErr);  } // ThreeDPreflightWindow</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Scriptable_Print_SimpleText/listing31.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Scriptable_Print_SimpleText/listing31.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Scriptable_Print_SimpleText/listing31.html%3Fid%3DDTS10000305-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>