<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>qtmovietrack - /QTMovieTrack.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/QuickTime/index.html">QuickTime</a> &gt; <a href="../../samplecode/QuickTime/idxMovieBasics-date.html">Movie Basics</a> &gt; <A HREF="javascript:location.replace('index.html');">qtmovietrack</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">qtmovietrack</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/QTMovieTrack.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Application Files/ComApplication.c</option>
<option value="listing2.html">/Application Files/ComApplication.h</option>
<option value="listing3.html">/Application Files/ComResource.h</option>
<option value="listing4.html">/Common Files/ComFramework.c</option>
<option value="listing5.html">/Common Files/ComFramework.h</option>
<option value="listing6.html">/Common Files/MacFramework.c</option>
<option value="listing7.html">/Common Files/MacFramework.h</option>
<option value="listing8.html">/Common Files/MacPrefix.h</option>
<option value="listing9.html">/Common Files/QTUtilities.c</option>
<option value="listing10.html">/Common Files/QTUtilities.h</option>
<option value="listing11.html">/Common Files/WinFramework.c</option>
<option value="listing12.html">/Common Files/WinFramework.h</option>
<option value="listing13.html">/Common Files/WinPrefix.h</option>
<option value="listing14.html">/QTMovieTrack.c</option>
<option value="listing15.html">/QTMovieTrack.h</option></select>
				</p>
				</form>
				<p><strong><a href="qtmovietrack.zip">Download Sample</a></strong> (&#147;qtmovietrack.zip&#148;, 139.0K)<BR>
<strong><a href="qtmovietrack.dmg">Download Sample</a></strong> (&#147;qtmovietrack.dmg&#148;, 213.3K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">//////////////  File:    QTMovieTrack.c////  Contains:  Sample code for working with QuickTime movie tracks.////  Written by:  Tim Monroe////  Copyright:  &copy; 2000 by Apple Computer, Inc., all rights reserved.////  Change History (most recent first)://     //     &lt;4&gt;     05/11/00  rtm    made a few UI tweaks//     &lt;3&gt;     05/08/00  rtm    added child rectangle previewing button//     &lt;2&gt;     05/06/00  rtm    added user interface for specifying options//     &lt;1&gt;     05/04/00  rtm    first file//////  This sample code shows how to add a &quot;movie track&quot; to an existing QuickTime movie; a movie track//  is a track that specifies another movie that is to be embedded into the existing movie. The existing//  movie will be called the &quot;parent movie&quot; or the &quot;containing movie&quot;; the embedded movie will be called//  the &quot;child movie&quot;, the &quot;embedded movie&quot;, or the &quot;movie-in-movie&quot;.////  A movie track is added using standard Movie Toolbox routines. The sample description is generic. The//  media sample data consists of an atom container that contains one or more child atoms. The child atom//  of type kMovieMediaDataReference is required. All other child atoms are optional. The movie media//  handler will use intelligent default values for any missing atoms.////////////////////////// header files////////////#include &quot;QTMovieTrack.h&quot;////////////// global variables////////////extern short         gAppResFile;            // file reference number for this application's resource fileextern ModalFilterUPP    gModalFilterUPP;          // UPP to our custom dialog event filterRGBColor          gWhite = {0xffff, 0xffff, 0xffff};RGBColor          gDGray = {0x7777, 0x7777, 0x7777};RGBColor          gBlack = {0x0000, 0x0000, 0x0000};////////////// QTMIM_AddFileAsMovieTrack// Elicit a movie file from the user and add it to a parent movie as a child movie.////////////OSErr QTMIM_AddFileAsMovieTrack (WindowObject theWindowObject){  FSSpec          myFSSpec;  OSType           myTypeList[] = {kQTFileTypeMovie};  short          myNumTypes = 1;  QTFrameFileFilterUPP  myFileFilterUPP = NULL;  AliasHandle        myAlias = NULL;  OSErr          myErr = noErr;#if TARGET_OS_MAC  myNumTypes = 0;#endif  // elicit a movie file from the user  myFileFilterUPP = QTFrame_GetFileFilterUPP((ProcPtr)QTMIM_FilterFiles);  myErr = QTFrame_GetOneFileWithPreview(myNumTypes, (QTFrameTypeListPtr)myTypeList, &amp;myFSSpec, myFileFilterUPP);  if (myErr != noErr)    goto bail;  // create an alias to the selected file  myErr = NewAliasMinimal(&amp;myFSSpec, &amp;myAlias);  if (myErr != noErr)    goto bail;  // add the movie file as a movie track to the parent movie  myErr = QTMIM_AddMovieTrack(theWindowObject, rAliasType, (Handle)myAlias);bail:  if (myFileFilterUPP != NULL)    DisposeNavObjectFilterUPP(myFileFilterUPP);  if (myAlias != NULL)    DisposeHandle((Handle)myAlias);  return(myErr);}////////////// QTMIM_AddURLAsMovieTrack// Elicit a URL from the user and add it to a parent movie as a child movie.////////////OSErr QTMIM_AddURLAsMovieTrack (WindowObject theWindowObject){  char      *myURL = NULL;  Handle      myHandle = NULL;  Size      mySize = 0;  OSErr      myErr = noErr;  // elicit a URL from the user  myURL = QTMIM_GetURLFromUser();  if (myURL == NULL)    goto bail;      // get the size of the URL, plus the terminating null byte  mySize = (Size)strlen(myURL) + 1;  if (mySize == 0)    goto bail;    // allocate a new handle  myHandle = NewHandleClear(mySize);    if (myHandle == NULL)    goto bail;  // copy the URL into the handle  BlockMove(myURL, *myHandle, mySize);  // add the URL as a movie track to the parent movie  myErr = QTMIM_AddMovieTrack(theWindowObject, URLDataHandlerSubType, myHandle);bail:  free(myURL);    if (myHandle != NULL)    DisposeHandle(myHandle);  return(myErr);}////////////// QTMIM_AddMovieTrack// Add, to the specified parent movie, a movie track for the movie having the specified data reference.////////////OSErr QTMIM_AddMovieTrack (WindowObject theWindowObject, OSType theDataRefType, Handle theDataRef){  Movie           myMovie = NULL;      // the parent movie  Track          myTrack = NULL;      // the movie track  Media          myMedia = NULL;      // the movie track's media  OSErr          myErr = paramErr;    if ((theWindowObject == NULL) || (theDataRef == NULL))    goto bail;      myMovie = (**theWindowObject).fMovie;      // create the movie track and media  myTrack = NewMovieTrack(myMovie, FixRatio(kChildMovieWidth, 1), FixRatio(kChildMovieHeight, 1), kFullVolume);  myErr = GetMoviesError();  if (myErr != noErr)    goto bail;      myMedia = NewTrackMedia(myTrack, MovieMediaType, kMovieTimeScale, NULL, 0);  myErr = GetMoviesError();  if (myErr != noErr)    goto bail;  // create the media sample(s)  myErr = BeginMediaEdits(myMedia);  if (myErr != noErr)    goto bail;  myErr = QTMIM_AddMovieTrackSampleToMedia(theWindowObject, myMedia, theDataRefType, theDataRef);  if (myErr != noErr)    goto bail;  myErr = EndMediaEdits(myMedia);  if (myErr != noErr)    goto bail;    // add the media to the track  myErr = InsertMediaIntoTrack(myTrack, 0, 0, GetMediaDuration(myMedia), fixed1);bail:  return(myErr);}////////////// QTMIM_AddMovieTrackSampleToMedia// Add a sample to the specified media.////////////OSErr QTMIM_AddMovieTrackSampleToMedia (WindowObject theWindowObject, Media theMedia, OSType theDataRefType, Handle theDataRef){  ApplicationDataHdl      myAppData = NULL;  QTAtomContainer        mySample = NULL;  QTAtom            myRegionAtom;  SampleDescriptionHandle    myImageDesc = NULL;  Ptr              myData = NULL;  OSType            myType;  Boolean            myBoolean;  UInt8            myLoop;  UInt32            myValue;  OSErr            myErr = paramErr;    //////////  //  // retrieve the application data; it determines what kind of atoms we create  //  //////////    myAppData = (ApplicationDataHdl)QTFrame_GetAppDataFromWindowObject(theWindowObject);  if (myAppData == NULL)    return(myErr);  //////////  //  // create a new atom container and add an atom of type kMovieMediaDataReference  //  //////////  // create a new atom container to hold the sample data  myErr = QTNewAtomContainer(&amp;mySample);  if (myErr != noErr)    goto bail;  // concatenate the specified data reference type and data reference into a single block of data  myData = NewPtrClear(sizeof(OSType) + GetHandleSize(theDataRef));  if (myData == NULL)    goto bail;    // convert the data to big-endian format  myType = EndianU32_NtoB(theDataRefType);    BlockMove(&amp;myType, myData, sizeof(OSType));  BlockMove(*theDataRef, myData + sizeof(OSType), GetHandleSize(theDataRef));    // add an atom of type kMovieMediaDataReference to the atom container  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaDataReference, 1, 1, GetPtrSize(myData), myData, NULL);  if (myErr != noErr)    goto bail;  //////////  //  // add an auto-start atom  //  //////////  myBoolean = (**myAppData).fAutoPlayChild;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaAutoPlay, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;    //////////  //  // add a frame-stepping atom  //  //////////  myBoolean = (**myAppData).fFrameStepChild;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaEnableFrameStepping, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;    //////////  //  // add a looping atom, if requested  //  //////////  if ((**myAppData).fLoopingOn) {    // add an atom of type kMovieMediaLoop to the atom container    myLoop = (**myAppData).fLoopingState;    myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaLoop, 1, 1, sizeof(myLoop), &amp;myLoop, NULL);    if (myErr != noErr)      goto bail;  }    //////////  //  // set the slaving characteristics of the child movie  //  //////////    myBoolean = (**myAppData).fSlaveTimebase;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaSlaveTime, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;    myBoolean = (**myAppData).fSlaveAudio;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaSlaveAudio, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;    myBoolean = (**myAppData).fSlaveGraphicsMode;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaSlaveGraphicsMode, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;  myBoolean = (**myAppData).fSlaveDuration;  myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaSlaveTrackDuration, 1, 1, sizeof(myBoolean), &amp;myBoolean, NULL);  if (myErr != noErr)    goto bail;    //////////  //  // set the spatial characteristics of the child movie, if requested  //  //////////  if ((**myAppData).fCustomRectOn || (**myAppData).fScalingOn) {    // add an atom of type kMovieMediaRegionAtom to the atom container    myErr = QTInsertChild(mySample, kParentAtomIsContainer, kMovieMediaRegionAtom, 1, 1, 0, NULL, &amp;myRegionAtom);    if (myErr != noErr)      goto bail;  }    if (myRegionAtom != 0) {        if ((**myAppData).fCustomRectOn) {      // set the child movie's rectangle      QTAtom      myRectAtom;            myErr = QTInsertChild(mySample, myRegionAtom, kMovieMediaRectangleAtom, 1, 1, 0, NULL, &amp;myRectAtom);      if (myRectAtom != 0) {        if ((**myAppData).fTopAndLeftOn) {          myValue = EndianU32_NtoB((**myAppData).fTop);          myErr = QTInsertChild(mySample, myRectAtom, kMovieMediaTop, 1, 1, sizeof(myValue), &amp;myValue, NULL);                  myValue = EndianU32_NtoB((**myAppData).fLeft);          myErr = QTInsertChild(mySample, myRectAtom, kMovieMediaLeft, 1, 1, sizeof(myValue), &amp;myValue, NULL);        }                if ((**myAppData).fHeightAndWidthOn) {          myValue = EndianU32_NtoB((**myAppData).fHeight);          myErr = QTInsertChild(mySample, myRectAtom, kMovieMediaHeight, 1, 1, sizeof(myValue), &amp;myValue, NULL);                  myValue = EndianU32_NtoB((**myAppData).fWidth);          myErr = QTInsertChild(mySample, myRectAtom, kMovieMediaWidth, 1, 1, sizeof(myValue), &amp;myValue, NULL);        }      }    }        // set the scaling characteristics of the child movie    if ((**myAppData).fScalingOn) {      // add an atom of type kMovieMediaSpatialAdjustment to the atom container      myValue = EndianU32_NtoB((**myAppData).fScalingType);      myErr = QTInsertChild(mySample, myRegionAtom, kMovieMediaSpatialAdjustment, 1, 1, sizeof(myValue), &amp;myValue, NULL);      if (myErr != noErr)        goto bail;    }  }    //////////  //  // create the media sample  //  //////////  // create a sample description  myImageDesc = (SampleDescriptionHandle)NewHandleClear(sizeof(SampleDescription));  if (myImageDesc == NULL)    goto bail;  (**myImageDesc).descSize = sizeof(SampleDescription);  (**myImageDesc).dataFormat = MovieMediaType;  myErr = AddMediaSample(  theMedia,               mySample,              0,                                  // no offset in data              GetHandleSize((Handle)mySample),               GetMovieDuration(GetTrackMovie(GetMediaTrack(theMedia))),      // frame duration              myImageDesc,               1,                                  // one sample              0,                                  // self-contained samples              NULL);bail:  if (myData != NULL)    DisposePtr(myData);  if (myImageDesc != NULL)    DisposeHandle((Handle)myImageDesc);  if (mySample != NULL)    QTDisposeAtomContainer(mySample);  return(myErr);}////////////// QTMIM_GetURLFromUser// Display a dialog box to elicit a URL from the user; return a C string that contains the text in the// dialog box when the user clicks the OK button; otherwise, return NULL.//// The caller is responsible for disposing of the pointer returned by this function (by calling free).////////////char *QTMIM_GetURLFromUser (void){  short       myItem;  short       mySavedResFile;  GrafPtr      mySavedPort;  DialogPtr    myDialog = NULL;  short      myItemKind;  Handle      myItemHandle;  Rect      myItemRect;  Str255      myString;  char      *myURL = NULL;  OSErr      myErr = noErr;  //////////  //  // save the current resource file and graphics port  //  //////////  mySavedResFile = CurResFile();  GetPort(&amp;mySavedPort);  // set the application's resource file  UseResFile(gAppResFile);  //////////  //  // create the dialog box in which the user will enter a URL  //  //////////  myDialog = GetNewDialog(kURLBoxResourceID, NULL, (WindowPtr)-1L);  if (myDialog == NULL)    goto bail;#if TARGET_API_MAC_CARBON      SetPortDialogPort(myDialog);#else  MacSetPort(myDialog);#endif    SetDialogDefaultItem(myDialog, kURLBoxItemOK);  SetDialogCancelItem(myDialog, kURLBoxItemCancel);    MacShowWindow(GetDialogWindow(myDialog));    //////////  //  // display and handle events in the dialog box until the user clicks OK or Cancel  //  //////////    do {    ModalDialog(gModalFilterUPP, &amp;myItem);  } while ((myItem != kURLBoxItemOK) &amp;&amp; (myItem != kURLBoxItemCancel));    //////////  //  // handle the selected button  //  //////////    if (myItem != kURLBoxItemOK) {    myErr = userCanceledErr;    goto bail;  }    // retrieve the edited text  GetDialogItem(myDialog, kURLBoxItemEditBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  GetDialogItemText(myItemHandle, myString);  myURL = QTUtils_ConvertPascalToCString(myString);  bail:  // restore the previous resource file and graphics port  MacSetPort(mySavedPort);  UseResFile(mySavedResFile);    if (myDialog != NULL)    DisposeDialog(myDialog);  return(myURL);}////////////// QTMIM_ShowPropertiesDialogBox// Display the Movie Track Properties dialog box and process the user's selections.////////////OSErr QTMIM_ShowPropertiesDialogBox (WindowObject theWindowObject){  ApplicationDataHdl    myAppData = NULL;  short           myItem;  short           mySavedResFile;  GrafPtr          mySavedPort;  DialogPtr        myDialog = NULL;  short          myItemKind;  Handle          myItemHandle;  Rect          myItemRect;  SInt16          myValue;  SInt16          myIndex;  Str255          myString;  UserItemUPP        myUserItemProcUPP = NULL;      // UPP to our custom dialog user item procedure  OSErr          myErr = paramErr;      if (theWindowObject == NULL)    return(myErr);  myAppData = (ApplicationDataHdl)QTFrame_GetAppDataFromWindowObject(theWindowObject);  if (myAppData == NULL)    return(myErr);      myUserItemProcUPP = NewUserItemUPP(QTMIM_UserItemProcedure);  //////////  //  // save the current resource file and graphics port  //  //////////  mySavedResFile = CurResFile();  GetPort(&amp;mySavedPort);  // set the application's resource file  UseResFile(gAppResFile);  //////////  //  // create the dialog box   //  //////////  myDialog = GetNewDialog(kPropsBoxResourceID, NULL, (WindowPtr)-1L);  if (myDialog == NULL)    goto bail;  MacSetPort(GetDialogPort(myDialog));    // set user-item procedures  GetDialogItem(myDialog, kSlaveOptionsUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetDialogItem(myDialog, kSlaveOptionsUserItem, myItemKind, (Handle)myUserItemProcUPP, &amp;myItemRect);    GetDialogItem(myDialog, kLoopingOptionsUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetDialogItem(myDialog, kLoopingOptionsUserItem, myItemKind, (Handle)myUserItemProcUPP, &amp;myItemRect);    GetDialogItem(myDialog, kScalingOptionsUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetDialogItem(myDialog, kScalingOptionsUserItem, myItemKind, (Handle)myUserItemProcUPP, &amp;myItemRect);    GetDialogItem(myDialog, kRectangleOptionsUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetDialogItem(myDialog, kRectangleOptionsUserItem, myItemKind, (Handle)myUserItemProcUPP, &amp;myItemRect);    GetDialogItem(myDialog, kCommentBoxUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetDialogItem(myDialog, kCommentBoxUserItem, myItemKind, (Handle)myUserItemProcUPP, &amp;myItemRect);    SetDialogDefaultItem(myDialog, kPropsItemOK);  SetDialogCancelItem(myDialog, kPropsItemCancel);    // set default values  GetDialogItem(myDialog, kPropsAutoPlayChild, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 0);    GetDialogItem(myDialog, kFrameStepChild, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 0);    GetDialogItem(myDialog, kScalingOptionFill, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 1);    GetDialogItem(myDialog, kPropsNoLooping, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 1);    GetDialogItem(myDialog, kUseTrackBoxRadio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 1);    // disable rectangle specifiers  GetDialogItem(myDialog, kTopAndLeftCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  HiliteControl((ControlHandle)myItemHandle, 255);    GetDialogItem(myDialog, kHeightAndWidthCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  HiliteControl((ControlHandle)myItemHandle, 255);    GetDialogItem(myDialog, kLoopingOptionsCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 1);    GetDialogItem(myDialog, kScalingOptionsCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  SetControlValue((ControlHandle)myItemHandle, 1);    MacShowWindow(GetDialogWindow(myDialog));    QTMIM_ShowComment(myDialog, kDefaultCommentItem);    //////////  //  // display and handle events in the dialog box until the user clicks OK or Cancel  //  //////////    do {    ModalDialog(gModalFilterUPP, &amp;myItem);        // erase any existing comment    QTMIM_ShowComment(myDialog, kEraseCommentFieldItem);        switch (myItem) {      // handle clicks on check boxes      case kPropsSlaveTimebase:      case kPropsSlaveAudio:      case kPropsSlaveGraphicsMode:      case kPropsSlaveDuration:      case kPropsAutoPlayChild:      case kFrameStepChild:      case kScalingOptionsCheckBox:      case kTopAndLeftCheckBox:      case kHeightAndWidthCheckBox:      case kLoopingOptionsCheckBox:        GetDialogItem(myDialog, myItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);        myValue = 1 - GetControlValue((ControlHandle)myItemHandle);          if (myValue == 1)          QTMIM_ShowComment(myDialog, myItem);        SetControlValue((ControlHandle)myItemHandle, myValue);                if (myItem == kScalingOptionsCheckBox) {          myValue = GetControlValue((ControlHandle)myItemHandle);                    for (myIndex = kScalingOptionClip; myIndex &lt;= kScalingOptionScroll; myIndex++) {            GetDialogItem(myDialog, myIndex, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);            HiliteControl((ControlHandle)myItemHandle, myValue ? 0 : 255);          }        }                if (myItem == kLoopingOptionsCheckBox) {          myValue = GetControlValue((ControlHandle)myItemHandle);                    for (myIndex = kPropsNoLooping; myIndex &lt;= kPropsPalindromeLooping; myIndex++) {            GetDialogItem(myDialog, myIndex, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);            HiliteControl((ControlHandle)myItemHandle, myValue ? 0 : 255);          }        }                break;              // handle clicks in radio button groups      case kPropsNoLooping:      case kPropsNormalLooping:      case kPropsPalindromeLooping:        for (myIndex = kPropsNoLooping; myIndex &lt;= kPropsPalindromeLooping; myIndex++) {          GetDialogItem(myDialog, myIndex, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          if (myItem == myIndex)            SetControlValue((ControlHandle)myItemHandle, 1);            else            SetControlValue((ControlHandle)myItemHandle, 0);          }                QTMIM_ShowComment(myDialog, myItem);        break;              case kScalingOptionClip:      case kScalingOptionFill:      case kScalingOptionMeet:      case kScalingOptionSlice:      case kScalingOptionScroll:        for (myIndex = kScalingOptionClip; myIndex &lt;= kScalingOptionScroll; myIndex++) {          GetDialogItem(myDialog, myIndex, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          if (myItem == myIndex)            SetControlValue((ControlHandle)myItemHandle, 1);            else            SetControlValue((ControlHandle)myItemHandle, 0);          }                QTMIM_ShowComment(myDialog, myItem);        break;              case kUseTrackBoxRadio:      case kUseRectangleRadio:        for (myIndex = kUseTrackBoxRadio; myIndex &lt;= kUseRectangleRadio; myIndex++) {          GetDialogItem(myDialog, myIndex, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          if (myItem == myIndex)            SetControlValue((ControlHandle)myItemHandle, 1);            else            SetControlValue((ControlHandle)myItemHandle, 0);                      GetDialogItem(myDialog, kUseRectangleRadio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          myValue = GetControlValue((ControlHandle)myItemHandle);                    // enable or disable rectangle specifiers          GetDialogItem(myDialog, kTopAndLeftCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          HiliteControl((ControlHandle)myItemHandle, myValue ? 0 : 255);                  GetDialogItem(myDialog, kHeightAndWidthCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);          HiliteControl((ControlHandle)myItemHandle, myValue ? 0 : 255);        }                QTMIM_ShowComment(myDialog, myItem);        break;              // handle clicks in buttons      case kShowChildOnParent:        QTMIM_ShowChildRectOnParent(myDialog, theWindowObject);        break;    }        // if OK button clicked, make sure we've got all the info we need    if (myItem == kPropsItemOK) {      // if &quot;Use Rectangle&quot; is selected, make sure either T/L or H/W is also selected      GetDialogItem(myDialog, kUseRectangleRadio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);      if (GetControlValue((ControlHandle)myItemHandle) == 1) {        Boolean    myTopLeftChecked = false;        Boolean    myHeightWidthChecked = false;              GetDialogItem(myDialog, kTopAndLeftCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);        myTopLeftChecked = (Boolean)GetControlValue((ControlHandle)myItemHandle);        GetDialogItem(myDialog, kHeightAndWidthCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);        myHeightWidthChecked = (Boolean)GetControlValue((ControlHandle)myItemHandle);        if (!myTopLeftChecked &amp;&amp; !myHeightWidthChecked) {          // show warning and don't exit the dialog box          QTMIM_ShowComment(myDialog, kNeedTLOrHWItem);          QTFrame_Beep();          myItem = kPropsBogusItem;        }      }    }      } while ((myItem != kPropsItemOK) &amp;&amp; (myItem != kPropsItemCancel));    //////////  //  // handle the selected button  //  //////////    if (myItem != kPropsItemOK) {    myErr = userCanceledErr;    goto bail;  }    // read the values from the dialog box items into a data structure    // slaving options  GetDialogItem(myDialog, kPropsSlaveTimebase, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fSlaveTimebase = GetControlValue((ControlHandle)myItemHandle);  GetDialogItem(myDialog, kPropsSlaveAudio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fSlaveAudio = GetControlValue((ControlHandle)myItemHandle);  GetDialogItem(myDialog, kPropsSlaveGraphicsMode, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fSlaveGraphicsMode = GetControlValue((ControlHandle)myItemHandle);  GetDialogItem(myDialog, kPropsSlaveDuration, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fSlaveDuration = GetControlValue((ControlHandle)myItemHandle);  // scaling type  GetDialogItem(myDialog, kScalingOptionsCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fScalingOn = GetControlValue((ControlHandle)myItemHandle);  if ((**myAppData).fScalingOn) {    GetDialogItem(myDialog, kScalingOptionClip, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fScalingType = kMovieMediaFitClipIfNecessary;          GetDialogItem(myDialog, kScalingOptionFill, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fScalingType = kMovieMediaFitFill;          GetDialogItem(myDialog, kScalingOptionMeet, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fScalingType = kMovieMediaFitMeet;          GetDialogItem(myDialog, kScalingOptionSlice, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fScalingType = kMovieMediaFitSlice;          GetDialogItem(myDialog, kScalingOptionScroll, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fScalingType = kMovieMediaFitScroll;  } else {    (**myAppData).fScalingType = kMovieMediaFitNone;  }  // looping type  GetDialogItem(myDialog, kLoopingOptionsCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fLoopingOn = GetControlValue((ControlHandle)myItemHandle);  if ((**myAppData).fLoopingOn) {    GetDialogItem(myDialog, kPropsNoLooping, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fLoopingState = kMIMNoLooping;          GetDialogItem(myDialog, kPropsNormalLooping, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fLoopingState = kMIMNormalLooping;          GetDialogItem(myDialog, kPropsPalindromeLooping, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    if (GetControlValue((ControlHandle)myItemHandle))      (**myAppData).fLoopingState = kMIMPalindromeLooping;  } else {    (**myAppData).fLoopingState = kMIMNoLooping;  }  // autoplay option  GetDialogItem(myDialog, kPropsAutoPlayChild, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fAutoPlayChild = GetControlValue((ControlHandle)myItemHandle);  // frame-stepping option  GetDialogItem(myDialog, kFrameStepChild, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fFrameStepChild = GetControlValue((ControlHandle)myItemHandle);  // media rectangle  GetDialogItem(myDialog, kUseRectangleRadio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  (**myAppData).fCustomRectOn = GetControlValue((ControlHandle)myItemHandle);  if ((**myAppData).fCustomRectOn) {    GetDialogItem(myDialog, kTopAndLeftCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    (**myAppData).fTopAndLeftOn = GetControlValue((ControlHandle)myItemHandle);    GetDialogItem(myDialog, kHeightAndWidthCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    (**myAppData).fHeightAndWidthOn = GetControlValue((ControlHandle)myItemHandle);    GetDialogItem(myDialog, kTopEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    GetDialogItemText(myItemHandle, myString);    StringToNum(myString, &amp;(**myAppData).fTop);    GetDialogItem(myDialog, kLeftEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    GetDialogItemText(myItemHandle, myString);    StringToNum(myString, &amp;(**myAppData).fLeft);    GetDialogItem(myDialog, kHeightEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    GetDialogItemText(myItemHandle, myString);    StringToNum(myString, &amp;(**myAppData).fHeight);    GetDialogItem(myDialog, kWidthEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    GetDialogItemText(myItemHandle, myString);    StringToNum(myString, &amp;(**myAppData).fWidth);  }    myErr = noErr;  bail:  // restore the previous resource file and graphics port  MacSetPort(mySavedPort);  UseResFile(mySavedResFile);    if (myDialog != NULL)    DisposeDialog(myDialog);      DisposeUserItemUPP(myUserItemProcUPP);  return(myErr);}////////////// QTMIM_UserItemProcedure// A user-item procedure to draw boxes.////////////PASCAL_RTN void QTMIM_UserItemProcedure (DialogPtr theDialog, short theItem){  short          myItemKind;  Handle          myItemHandle = NULL;  Rect          myItemRect;  GrafPtr          mySavedPort;  PenState        myPenState;  OSErr          myErr = noErr;    GetPort(&amp;mySavedPort);#if TARGET_API_MAC_CARBON      SetPortDialogPort(theDialog);#else  MacSetPort(theDialog);#endif    // get the rectangle surrounding the user item  GetDialogItem(theDialog, theItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    GetPenState(&amp;myPenState);  // draw some bevels around the rectangle  MacOffsetRect(&amp;myItemRect, 1, 1);  RGBForeColor(&amp;gWhite);  MacFrameRect(&amp;myItemRect);  MacOffsetRect(&amp;myItemRect, -1, -1);  RGBForeColor(&amp;gDGray);  MacFrameRect(&amp;myItemRect);  if (theItem == kRectangleOptionsUserItem) {    RGBForeColor(&amp;gDGray);    MoveTo(myItemRect.left, myItemRect.top + ((myItemRect.bottom - myItemRect.top) / 2));    Line((myItemRect.right - myItemRect.left) - 2, 0);    RGBForeColor(&amp;gWhite);    MoveTo(myItemRect.left + 1, myItemRect.top + ((myItemRect.bottom - myItemRect.top) / 2) + 1);    Line((myItemRect.right - myItemRect.left) - 3, 0);  }  SetPenState(&amp;myPenState);  RGBForeColor(&amp;gBlack);  MacSetPort(mySavedPort);}////////////// QTMIM_ShowComment// Print a comment in the Movie Track Properies dialog box.////////////void QTMIM_ShowComment (DialogPtr theDialog, short theItem){  short          myTextSize;  short          myItemKind;  Handle          myItemHandle = NULL;  Rect          myItemRect;  Str255          myString;  GrafPtr         mySavedPort;  OSErr          myErr = noErr;  #if TARGET_OS_MAC      myTextSize = 10;#endif#if TARGET_OS_WIN32      myTextSize = 8;#endif  GetPort(&amp;mySavedPort);#if TARGET_API_MAC_CARBON      SetPortDialogPort(theDialog);#else  MacSetPort(theDialog);#endif  GetIndString(myString, kCommentStringResID, theItem);    // get the rectangle surrounding the comment user item  GetDialogItem(theDialog, kCommentBoxUserItem, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  MacInsetRect(&amp;myItemRect, 2, 2);  EraseRect(&amp;myItemRect);  MacInsetRect(&amp;myItemRect, -2, -2);  TextSize(myTextSize);  TextFont(1);  TextFace(0);    MoveTo(myItemRect.left + 5, myItemRect.bottom - 6);  DrawString(myString);    TextSize(12);  TextFont(0);  TextFace(0);    MacSetPort(mySavedPort);}////////////// QTMIM_ShowChildRectOnParent// Show the currently selected child rectangle on the parent.////////////void QTMIM_ShowChildRectOnParent (DialogPtr theDialog, WindowObject theWindowObject){  short        myItemKind;  Handle        myItemHandle = NULL;  Rect        myItemRect;  Rect        myChildRect;  GrafPtr       mySavedPort;  MovieController    myMC = NULL;    GetPort(&amp;mySavedPort);  MacSetPort(QTFrame_GetPortFromWindowReference(QTFrame_GetFrontMovieWindow()));  myMC = QTFrame_GetMCFromFrontWindow();  if (myMC == NULL)    goto bail;    if (theWindowObject == NULL)    goto bail;    // redraw the current movie frame (to erase any existing child rectangle)  MCDoAction(myMC, mcActionDraw, (void *)QTFrame_GetWindowFromWindowReference(QTFrame_GetFrontMovieWindow()));    RGBForeColor(&amp;gDGray);    // set the default rectangle  MacSetRect(&amp;myChildRect, 0, 0, kChildMovieWidth, kChildMovieHeight);  // get the current child rectangle option  GetDialogItem(theDialog, kUseTrackBoxRadio, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);  if (GetControlValue((ControlHandle)myItemHandle) == 1) {    // the &quot;Use Track Box&quot; option is selected; just use the default values defined above  } else {    // the &quot;Use Rectangle&quot; option is selected    Boolean      myTopLeftChecked = false;    Boolean      myHeightWidthChecked = false;    Str255      myString;    long      myPos;      GetDialogItem(theDialog, kTopAndLeftCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    myTopLeftChecked = (Boolean)GetControlValue((ControlHandle)myItemHandle);    GetDialogItem(theDialog, kHeightAndWidthCheckBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);    myHeightWidthChecked = (Boolean)GetControlValue((ControlHandle)myItemHandle);    if (!myTopLeftChecked &amp;&amp; !myHeightWidthChecked) {      // show warning and don't exit the dialog box      QTMIM_ShowComment(theDialog, kNeedTLOrHWItem);      QTFrame_Beep();      goto bail;    }    if (myTopLeftChecked) {      // get the Top and Left values      GetDialogItem(theDialog, kTopEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);      GetDialogItemText(myItemHandle, myString);      StringToNum(myString, &amp;myPos);      myChildRect.top = (short)myPos;      myChildRect.bottom += myChildRect.top;      GetDialogItem(theDialog, kLeftEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);      GetDialogItemText(myItemHandle, myString);      StringToNum(myString, &amp;myPos);      myChildRect.left = (short)myPos;      myChildRect.right += myChildRect.left;    }      if (myHeightWidthChecked) {      // get the Height and Width values      GetDialogItem(theDialog, kHeightEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);      GetDialogItemText(myItemHandle, myString);      StringToNum(myString, &amp;myPos);      myChildRect.bottom = myChildRect.top + (short)myPos;      GetDialogItem(theDialog, kWidthEditTextBox, &amp;myItemKind, &amp;myItemHandle, &amp;myItemRect);      GetDialogItemText(myItemHandle, myString);      StringToNum(myString, &amp;myPos);      myChildRect.right = myChildRect.left + (short)myPos;    }  }  if (!EmptyRect(&amp;myChildRect)) {    Rect      myMovieRect;    RgnHandle    myClipRegion = NULL;        // clip the child rectangle to the movie rectangle    myClipRegion = NewRgn();    if (myClipRegion != NULL) {      GetClip(myClipRegion);      GetMovieBox((**theWindowObject).fMovie, &amp;myMovieRect);      ClipRect(&amp;myMovieRect);      PaintRect(&amp;myChildRect);      SetClip(myClipRegion);      DisposeRgn(myClipRegion);    }        QTMIM_ShowComment(theDialog, kShowChildOnParent);  } else {    QTMIM_ShowComment(theDialog, kEmptyRectWarning);    QTFrame_Beep();  }    bail:  RGBForeColor(&amp;gBlack);  MacSetPort(mySavedPort);}////////////// QTMIM_FilterFiles// Filter files for a file-opening dialog box.////////////#if TARGET_OS_MACPASCAL_RTN Boolean QTMIM_FilterFiles (AEDesc *theItem, void *theInfo, void *theCallBackUD, NavFilterModes theFilterMode){#pragma unused(theCallBackUD, theFilterMode)  NavFileOrFolderInfo    *myInfo = (NavFileOrFolderInfo *)theInfo;    if (theItem-&gt;descriptorType == typeFSS) {    if (!myInfo-&gt;isFolder) {      if (myInfo-&gt;fileAndFolder.fileInfo.finderInfo.fdType == kQTFileTypeMovie)        return(true);      // if we got to here, it's a file we cannot open      return(false);        }  }    // if we got to here, it's a folder or non-HFS object  return(true);}#endif#if TARGET_OS_WIN32PASCAL_RTN Boolean QTMIM_FilterFiles (CInfoPBPtr thePBPtr){#pragma unused(thePBPtr)  return(false);}#endif</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/qtmovietrack/listing14.html%3Fid%3DDTS10000786-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/qtmovietrack/listing14.html%3Fid%3DDTS10000786-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/qtmovietrack/listing14.html%3Fid%3DDTS10000786-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>