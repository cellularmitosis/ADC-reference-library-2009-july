<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PLookupName(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING78></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-77.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-79.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-61.html"><B>Chapter 3 - Name-Binding Protocol (NBP)</B></A> / <A HREF="Networking-66.html"><B>NBP Reference</B></A><BR><DL><DD><A HREF="Networking-72.html"><B>Routines</B></A> / <A HREF="Networking-76.html"><B>Handling Name and Address Requests</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING78-0></A>
<H3><A NAME=MARKER-9-132></A>PLookupName</H3>
 <A NAME=MARKER-11-133></A>The <A NAME=MARKER-2-99></A><CODE>PLookupName<A NAME=MARKER-2-111></A></CODE> function returns the names and addresses of all the network-visible entities that match a name that you supply, which can include wildcard characters.<P>
<PRE>
FUNCTION PLookupName (thePBptr: MPPPBPtr; async: Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to an MPP parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean that specifies whether the function should be executed asynchronously or synchronously. Specify <CODE>TRUE</CODE> for asynchronous execution.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result.<TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .MPP driver reference number. <TR>
<TD>--><TD>csCode<TD>Integer<TD>Always <CODE>lookupName</CODE>. <TR>
<TD>--><TD>interval<TD>Byte<TD>The retry interval.<TR>
<TD><-><TD>count<TD>Byte<TD>The retry count.<TR>
<TD>--><TD>entityPtr<TD>Ptr<TD>A pointer to an entity name.<TR>
<TD>--><TD>retBuffPtr<TD>Ptr<TD>A pointer to the return data buffer.<TR>
<TD>--><TD>retBuffSize<TD>Integer<TD>The return buffer size in bytes. <TR>
<TD>--><TD>maxToGet<TD>Integer<TD>The maximum number of matches to get.<TR>
<TD><--<TD>numGotten<TD>Integer<TD>The number of addresses found and returned.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>ioCompletion</CODE>
<DD> A pointer to a completion routine that you can provide. When you execute a function asynchronously, the .MPP driver calls your completion routine when it completes execution of the function if you specify a pointer to the routine as the value of this field. Specify <CODE>NIL</CODE> for this field if you do not wish to provide a completion routine. If you execute a function synchronously, the .MPP driver ignores the <CODE>ioCompletion</CODE> field. For information about completion routines, see the chapter "Introduction to AppleTalk" in this book. 
<DT><CODE>ioResult</CODE>
<DD> The result of the function. When you execute the function asynchro-<BR>nously, the function sets this field to 1 and returns a function result of <CODE>noErr</CODE> as soon as the function begins execution. When the function completes execution, it sets the <CODE>ioResult</CODE> field to the actual result code.
<DT><CODE>ioRefNum</CODE>
<DD> The .MPP driver reference number. The MPW interface fills in <BR>this field. 
<DT><CODE>csCode</CODE>
<DD> The command code of the .MPP command to be executed. The MPW interface fills in this field.
<DT><CODE>interval</CODE>
<DD> The retry interval to be used by NBP when it looks on the internet for matching names. The retry interval value specifies how long the function is to wait between retries in 8-tick units. The retry interval equals the <CODE>interval</CODE> field value <EM></EM> 8 ticks. A value of 7 for the <CODE>interval</CODE> field is usually sufficient (7 <EM></EM> 8 = 56 ticks equals approxi-<BR>mately 1 second). However, on a large network, you should base the interval value on the speed of the network and how many devices of this type you expect to be on the network.
<DT><CODE><A NAME=MARKER-2-100></A>count</CODE>
<DD> The retry count to be used by NBP when it looks on the internet <BR>for matching names. Its value specifies the number of times <CODE>PLookupName</CODE> is to retry the operation. A retry count of 3 or 4 is usually sufficient. However, on a large network, you should base the value on how likely it is for the type of device to miss the NBP request. For example, the AppleTalk ImageWriter has a dedicated processor on the LocalTalk option card to handle AppleTalk processing, so the retry count for a device of this type can be low, whereas most Macintosh systems and LaserWriter printers depend on their shared processor to handle all system processing, so <BR>a retry count for a device of these types should be higher. The <CODE>PLookupName</CODE> function decrements this field each time it looks <BR>for names.
<DT><CODE><A NAME=MARKER-2-101></A>entityPtr</CODE>
<DD> A pointer to an entity name in the format shown in <A HREF=Networking-65.html#MARKER-9-51>Figure 3-5 on page 3-11</A>. You can use the <CODE>NBPSetEntity</CODE> procedure to prepare the entity name record. 
<DT><CODE><A NAME=MARKER-2-11></A>retBuffPtr</CODE>
<DD> A pointer to a buffer you provide into which the <CODE>PLookupName</CODE> function puts the names and addresses that it finds. Each matching tuple takes a maximum of 104 bytes, and you use the <CODE>maxToGet</CODE> field to specify the maximum number of tuples to be returned.
<DT><CODE><A NAME=MARKER-2-165></A>retBuffSize</CODE>
<DD> The size of the buffer you are providing. 
<DT><CODE><A NAME=MARKER-2-9></A>maxToGet</CODE>
<DD> The maximum number of matches to be returned.
<DT><CODE><A NAME=MARKER-2-167></A>numGotten</CODE>
<DD> The actual number of matches that <CODE>PLookupName</CODE> returned. The <CODE>PLookupName</CODE> function updates this field each time it receives an NBP returned packet and adds names to the return buffer. If there is space remaining in the buffer, NBP may return more matches than the number specified by <CODE>maxToGet</CODE>. If <CODE>numGotten</CODE> is greater than or equal to <CODE>maxToGet</CODE>, there may be additional matches. In this case, you should increase the size of the buffer pointed to by <CODE>retBuffPtr</CODE> and call the <CODE>PLookupName</CODE> function again. 
</DL>
<A NAME=HEADING78-17></A>
<H5>DESCRIPTION</H5>
 Before you can send data to another entity, you must have the network address of <BR>that entity. The <CODE>PLookupName</CODE> function returns the names and addresses of any network-visible entities whose names match the entity name you specify. The entity name can include any of the wildcard characters given in Table 3-1 on <A HREF=Networking-65.html#MARKER-9-2>page 3-12</A>.<A NAME=MARKER-2-154></A><P>
 The <CODE>PLookupName</CODE> function completes execution when the number of matches <BR>returned is equal to or greater than the number in the <CODE>maxToGet</CODE> field, the function exceeds the retry count, the buffer overflows, or the request is canceled through the <BR><CODE>PKillNBP</CODE> function.  <P>
 The number of matches returned can be greater than the number specified in the <CODE>maxToGet</CODE> field under the following circumstances: A single lookup request or retry can return more than one match in a reply packet. If there is space remaining in the buffer and NBP receives a packet containing multiple matches, <CODE>PLookupName</CODE> will return <BR>as many of the matches as fit in the buffer. If this occurs, you should increase the size <BR>of the buffer and call the <CODE>PLookupName</CODE> function again to ensure that you obtain all of <BR>the matches. <P>
 If all of the tuples returned in a reply packet do not fit in the buffer, then the function completes with as many tuples as can fit. Whether NBP returns more or fewer matches than you specify as the value of <CODE>maxToGet</CODE>, the value of <CODE>numGotten</CODE> reflects the actual number of tuples that <CODE>PLookupName</CODE> writes to the return buffer. <P>
 Because the function updates the <CODE>numGotten</CODE> field each time it receives a returned packet containing one or more matches and writes those name and address pairs to <BR>the return buffer, you can start reading the names in the buffer and displaying them <BR>for the user before the function completes execution. <P>
 The tuples in the buffer are in the format used in the NBP names table, as shown in <A HREF=Networking-65.html#MARKER-9-56>Figure 3-6 on page 3-12</A>. Because the object, type, and zone names in this format are <BR>of arbitrary length, you cannot use Pascal to read these tuples. Use the <CODE>NBPExtract</CODE> function to read tuples from the buffer. <P>
<A NAME=HEADING78-24></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Memory used for the entity name record and the return buffer belongs to <CODE>PLookupName</CODE> until the function completes execution and must be nonrelocatable. <P>
<A NAME=HEADING78-26></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>PLookupName</CODE> function from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>lookupName</CODE> in the <CODE>csCode</CODE> field of the parameter block. To execute the <CODE>_Control</CODE> trap asynchronously, include the value <CODE>,ASYNC</CODE> in the operand field. To execute this function from assembly language, you must also specify the driver reference number. <P>
<A NAME=HEADING78-28></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>tooManyReqs<TD>-1097<TD>Too many concurrent requests; wait a few minutes, then try the request again<TR>
<TD>reqAborted<TD>-1105<TD>Request canceled</TABLE>
</H5>
<A NAME=HEADING78-29></A>
<H5>SEE ALSO</H5>
 To read tuples from the buffer, use the <CODE>NBPExtract</CODE> function, described next. <P>
 To create the entity name record, use the <CODE>NBPSetEntity</CODE> procedure, described on <A HREF=Networking-77.html#MARKER-9-125>page 3-27</A>.<P>
 To check that a network-visible entity whose name and address you already know is still available on the network, use the <CODE>PConfirmName</CODE> function, described on <A HREF=Networking-80.html#MARKER-9-155>page 3-32</A>.<P>
 To cancel a name lookup request, use the <CODE>PKillNBP</CODE> function, described on <A HREF=Networking-82.html#MARKER-9-169>page 3-36</A>.<A NAME=MARKER-2-20></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-77.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-79.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
