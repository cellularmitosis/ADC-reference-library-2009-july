<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Import and Export Guide: Movie Data Exchange Components</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Movie Data Exchange Components"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents" title="Movie Data Exchange Components"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../ImportExport-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000523" target="_top">Import &amp; Export</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000903-IntroductiontoQuickTimeImportandExportGuide-DontLinkElementID_4">QuickTime Import and Export Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../E-Chapter/5GraphicsExporterCom.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../G-Chapter/7CreatingaMovieDataE.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-SW1" title="Movie Data Exchange Components"></a>
<h1>Movie Data Exchange Components</h1>

<p>This chapter provides background information about movie data exchange components. After reading this chapter, you should understand why these components exist and whether you need to create or use one.</p>
<p>Movie data exchange components allow applications to place various types of data into a QuickTime movie or extract data from a movie in a specified format. Movie data import components translate foreign (that is, nonmovie) data formats into QuickTime movie data format. For example, a movie data import component might convert images from a paint application into frames in a QuickTime movie.</p>
<p>Conversely, movie data export components convert movie data into other formats, so that the data can be used by other applications. As an example, a movie data export component might allow an application to extract the sound track from a QuickTime movie in AIFF format. The extracted sound track may then be manipulated by applications that are not QuickTime-aware.</p>
<p>Applications use the services of movie data exchange components by calling the Movie Toolbox. Figure 5-1 shows the relationship between the Movie Toolbox and movie data import components while Figure 5-2 shows how movie data export components fit into the picture.</p>
<p>If you are writing a media handler that works with a new type of data, you will probably need to use one or more data exchange components to facilitate the importing and exporting of data to QuickTime movies.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_17" title="Figure 5-1The Movie Toolbox, movie data import components, and your application"></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>The Movie Toolbox, movie data import components, and your application</p><img src = "../Art/imDataExchange-1.jpg" alt = "The Movie Toolbox, movie data import components, and your application" ></div><br/>
<br/><div><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_18" title="Figure 5-2The Movie Toolbox, movie data export components, and your application"></a><p><strong>Figure 5-2&nbsp;&nbsp;</strong>The Movie Toolbox, movie data export components, and your application</p><img src = "../Art/imDataExchange-2.jpg" alt = "The Movie Toolbox, movie data export components, and your application" ></div><br/>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-SavingandRestoringSettings">Saving and Restoring Settings</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-MovieExporterPresets">Movie Exporter Presets</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImplementingMovieDataExchangeComponents">Implementing Movie Data Exchange Components</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-StandardCompressionComponentsandSettings">Standard Compression Components and Settings</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingText">Exporting Text</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TimeStamps">Time Stamps</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TextDescriptors">Text Descriptors</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-MIMETypeList">MIME Type List</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImportingText">Importing Text</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImportingInPlace">Importing In Place</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-AudioCDImportComponent">Audio CD Import Component</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DVVideoImportandExportComponents">DV Video Import and Export Components</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingDVDatafromanApplication">Exporting DV Data from an Application</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingDatafromSourcesOtherThanMovies">Exporting Data from Sources Other Than Movies</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DeterminingWhatKindofTracksaComponentSupports">Determining What Kind of Tracks a Component Supports</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-UsingaMovieDataExportComponenttoExportAudio">Using a Movie Data Export Component to Export Audio</a>
				
			<br/>
			
        
			
			
				<a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-UsingaMovieDataExportComponenttoExportVideo">Using a Movie Data Export Component to Export Video</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-SavingandRestoringSettings" title="Saving and Restoring Settings"></a>
<h2>Saving and Restoring Settings</h2>
<p>QuickTime has always provided many support mechanisms for importing media from other formats into QuickTime movies, as well as exporting from QuickTime movies to other media formats. Importing and exporting are handled by movie data exchange components.</p>
<p>You write import and export components to allow a user to perform importing and exporting, respectively. Your component provides a routine that presents a dialog box for the user to change options. For an import component, you need to implement <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportDoUserDialog" target="_top">MovieImportDoUserDialog</a></code>; for an export component, you must implement <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportDoUserDialog" target="_top">MovieExportDoUserDialog</a></code>. For example, the text import component presents a dialog box with options for setting the font, size, and style of the text media it will add to the movie. The WAVE audio export component presents the standard sound compression dialog box, so that sample rate and sample size can be specified for the generated WAVE file.</p>
<p>QuickTime lets you retrieve the current settings from the still-open import or export component. In addition, you can restore a component’s current settings to previously-retrieved settings. The restoration does not involve any user interface. This may be advantageous for application developers who want to provide preferences for the last settings used or want to perform batch importing or exporting, using previously-established settings.</p>
<p>QuickTime makes it possible for your application to retrieve and store the settings of import and export components without having to present the user with a user interface, such as a settings dialog box, to accomplish the task.</p>
<p>Two scenarios illustrate how saved settings can be useful. In the first scenario, an application presents an importer or exporter component’s configuration dialog the first time that component is used and then saves the settings so they can be restored without the user having to go fill out the configuration dialog again. In another scenario, an application might use settings to implement preset configurations that the user often wants.</p>
<p>QuickTime enables movie export components to associate resources that hold one or more named presets for that exporter. The dialog accessible through <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/ConvertMovieToFile" target="_top">ConvertMovieToFile</a></code> automatically builds a menu of all presets for the currently selected exporter allowing a user to export without having to go through the exporter’s custom dialog.</p>
<p>It is also possible to include component resources that serve as named presets to be used with the export component. These resources include the same kind of settings just described. See  <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-MovieExporterPresets">“Movie Exporter Presets.”</a></span></p>
<p>For information about using the save-and-restore component settings mechanism, refer to the section <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImplementingMovieDataExchangeComponents">“Implementing Movie Data Exchange Components.”</a></span></p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-MovieExporterPresets" title="Movie Exporter Presets"></a>
<h2>Movie Exporter Presets</h2>
<p>The <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/ConvertMovieToFile" target="_top">ConvertMovieToFile</a></code> function retrieves preset information and includes an additional popup menu showing presets for the currently selected exporter. Current preset component resources include <code><!--a target="_top" -->'stg#'<!--/a--></code> and <code><!--a target="_top" -->'sttg'<!--/a--></code>.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImplementingMovieDataExchangeComponents" title="Implementing Movie Data Exchange Components"></a>
<h2>Implementing Movie Data Exchange Components</h2>
<p>The following section discusses how you can implement component routines to save and restore component settings available in QuickTime.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-StandardCompressionComponentsandSettings" title="Standard Compression Components and Settings"></a>
<h2>Standard Compression Components and Settings</h2>
<p>QuickTime includes two settings-related component calls to both the video and sound Standard Compression components: <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCGetSettingsAsAtomContainer" target="_top">SCGetSettingsAsAtomContainer</a></code> and <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCGetSettingsAsAtomContainer" target="_top">SCGetSettingsAsAtomContainer</a></code> These may also be useful for implementing movie data exchange components. The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCGetSettingsAsAtomContainer" target="_top">SCGetSettingsAsAtomContainer</a></code> routine returns a QT atom container with the current configuration of the particular compression component. <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCSetSettingsFromAtomContainer" target="_top">SCSetSettingsFromAtomContainer</a></code> resets the compression component’s current configuration. Applications that want to save settings for standard compression components should use these calls.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingText" title="Exporting Text"></a>
<h2>Exporting Text</h2>
<p>The text export and import components provide features that make it easier to work with the data in a text track in a QuickTime movie. <strong></strong> <strong>Text</strong> <strong>descriptors</strong> are formatting commands that you can embed within a text file. <strong></strong> <strong>Time</strong> <strong>stamps</strong> describe a text sample’s starting time and duration.</p>
<p>The text export and import components make it easier to edit and format text using an external tool, such as a text editor or word processor. When you export text from a text track, you can optionally export text descriptors and time stamps for the text. You can open the text file in a word processor and make changes to the text, style, color, and time stamps. You can then import the edited text to a text track where all the timing, style, color and time stamp information will be present.</p>
<p>When you export text, you control whether text descriptors and time stamps are to be exported by selecting the appropriate options in the text export settings dialog box, shown in Figure 5-3. To display this dialog box programmatically, you call the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportDoUserDialog" target="_top">MovieExportDoUserDialog</a></code> function.</p>
<p>Based on the options you specify in the text export settings dialog box, the text export component is assigned one of three text export option constants: <code>kMovieExportTextOnly</code>, <code>kMovieExportAbsoluteTime</code>, or <code>kMovieExportRelativeTime</code>.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_19" title="Figure 5-3Text export settings dialog box"></a><p><strong>Figure 5-3&nbsp;&nbsp;</strong>Text export settings dialog box</p><img src = "../Art/refDataExchange-1.jpg" alt = "Text export settings dialog box" ></div><br/>
<p>If you choose “Show Text Only,” the text component is assigned the export option constant <code>kMovieExportTextOnly</code>. In this case, the text component exports only text samples, without text descriptors or time stamps. This option is useful when you want to export only the text from a movie and you do not intend to import the text back into a movie.</p>
<p>If you select “Show Text, Descriptors, and Time,” the text component is assigned one of two export option constants, depending on the format you specify for time stamps:</p>
<ul class="ul">
<li class="li"><p>If you specify time stamps to be relative to the start of the movie, the text component is assigned the export option constant <code>kMovieExportAbsoluteTime</code>. In this case, time stamps are calculated relative to the start of the movie. For example, in exported text with absolute time stamps, the time stamp [00:00:04.000] indicates that a text sample begins 4 seconds after the start of the movie.</p></li>
<li class="li"><p>If you specify time stamps to be relative to the sample, the text component is assigned the export option constant <code>kMovieExportRelativeTime</code>. In this case, the time stamp for each sample is calculated relative to the end of the previous sample. For example, in exported text with relative time stamps, the time stamp [00:00:04.000] indicates that a text sample begins 4 seconds after the beginning of the previous sample. In other words, the previous sample lasts 4 seconds.</p></li>
</ul>
<p>In both cases, text export component exports text, along with both text descriptors and time stamps. For more information about time stamps, see <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TimeStamps">“Time Stamps.”</a></span></p>
<p>The text export component provides two functions you can use to access the component’s text export option programmatically. To retrieve the current value of the text export option, you call <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/TextExportGetSettings" target="_top">TextExportGetSettings</a></code>. To set the value of the text export option, you call <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/TextExportSetSettings" target="_top">TextExportSetSettings</a></code>.</p>
<p>The Text Export Settings dialog box also allows you to specify the time scale the text component uses to specify the fractional part of a time stamp. The value should be between 1 and 10000, inclusive. The text export component provides two functions you can use to access the component’s time scale programmatically. To retrieve the time scale, call <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/TextExportGetTimeFraction" target="_top">TextExportGetTimeFraction</a></code>. To set the time scale, call <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/TextExportSetTimeFraction" target="_top">TextExportSetTimeFraction</a></code>.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TimeStamps" title="Time Stamps"></a>
<h2>Time Stamps</h2>
<p>When you export text and text descriptors from a text track, the text component also exports a time stamp for each sample. The time stamp indicates the starting and ending time of the sample, either relative to the start of the movie (<code>kMovieExportAbsoluteTime</code>) or to the end of the previous sample (<code>kMovieExportRelativeTime</code>). On import, the time stamps maintain the timing positions of the text samples relative to other media in the movie.</p>
<p>The format of a time stamp is</p>

<div class="codesample"><table><tr><td scope="row"><pre>[HH:MM:SS.xxx]<span></span></pre></td></tr></table></div>

<p>where <code>HH</code> represents the number of hours, <code>MM</code> represents the number of minutes, <code>SS</code> represents the number of seconds, and <code>xxx</code> represents the mantissa (the fractional part of a second). The mantissa is expressed in the time scale of the text track. For example, if the time scale of the text track is 600, the time stamp [00:00:07.300] is interpreted as 7.5 seconds. If the time scale of the text track is 10, the time stamp [00:00:07.5] is also interpreted as 7.5 seconds. The maximum time scale for a text track is 10000.</p>
<p>When a text export component exports a text sample, it first exports the time stamp, followed by a return character. Then, it exports the sample’s text and text descriptors. If a text sample does not contain any text, the text component exports the time stamp and return character, but no text.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TextDescriptors" title="Text Descriptors"></a>
<h2>Text Descriptors</h2>
<p>A text descriptor is a formatting command that describes the text that follows it. Exporting text with text descriptors allows you to edit text from a text track, including its formatting, in an external program, such as a text editor or word processor. When you import the edited text, the formatting you specified with the text descriptors is preserved. This provides an easy way to localize movies for different languages, correct spelling, change styles, or modify text behavior.</p>
<p>A text descriptor has the format { <em>descriptor</em> }. For example, the text descriptor <code>{bold}</code> sets the text style in the current text sample and all subsequent text samples. Some text descriptors, such as <code>{bold}</code>, have no parameters. Other text descriptors have one or more parameters. For text descriptors with parameters, the descriptor is followed by a colon and its parameters, separated by commas. You can specify text descriptors using either uppercase or lowercase characters, with or without spaces separating the parameters:</p>
<p>{<em>descriptor:</em> <em>parameter1,</em> ..., <em>parameterN</em> }</p>
<p>For example, the text descriptor <code>{font</code>:<code>New</code> <code>York}</code> sets the text font in the current text sample and all subsequent text samples to the New York font. The New York font is applied to all text until a second <code>{font</code>:<code>}</code> text descriptor is issued.</p>
<p>A text stream that contains text descriptors and time stamps should always begin with the text descriptor <code>{QTtext}</code>, followed by any number of text descriptors in any order. If the text import component detects a typographical error inside a descriptor while importing a text file, it may generate partial results or an error message stating that the text file cannot be converted.</p>
<p>When text with text descriptors is imported into a track, the information represented by the descriptors is stored in a text display data structure (type <code><!--a target="_top" -->TextDisplayData<!--/a--></code>). Text descriptors whose possible values are <code>on</code> and <code>off</code> are used to set flags in the <code>displayFlags</code> field of the text display data structure. Each sample in the text track has a corresponding text display data structure that contains the text attributes of the sample. For more information, see <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TextDisplayDataStructure">“Text Display Data Structure.”</a></span></p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-MIMETypeList" title="MIME Type List"></a>
<h2>MIME Type List</h2>
<p>The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportGetMIMETypeList" target="_top">MovieImportGetMIMETypeList</a></code> function returns a list of the MIME types supported by a movie import component. This list is contained in the QT atom container described in this section. For more information about QT atom containers, see the QuickTime Atom documentation.</p>
<p>At the top level of the atom container are three atoms for each supported MIME type. The atoms whose IDs are 1 describe the first supported MIME type, the atoms whose IDs are 2 describe the second supported MIME type, and so on.</p>
<p>An atom of type <code>kMimeInfoMimeTypeTag</code> contains a string that identifies the MIME type, such as <code>image/jpeg</code> or <code>image/x-jpeg</code>.</p>
<p>The atom of type <code>kMimeInfoFileExtensionTag</code> contains a string that specifies likely file extensions for files of this MIME type, such as <code>jpg</code>, <code>jpe</code>, and <code>jpeg</code>. If there is more than one extension, the extensions are separated by commas.</p>
<p>The atom of type <code>kMimeInfoDescriptionTag</code> contains a string describing the MIME type for end users, such as “JPEG Image.”</p>
<p>These atom types contain neither a Pascal nor a C string. The atom types are simply ASCII characters; an atom’s size is the number of characters. For best performance, include a public component resource of type <code>'mime'</code> and ID 1 with your exporter.</p>
<p>Figure 5-4 illustrates a MIME type list.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_20" title="Figure 5-4A MIME type list"></a><p><strong>Figure 5-4&nbsp;&nbsp;</strong>A MIME type list</p><img src = "../Art/refDataExchange-3.jpg" alt = "A MIME type list" ></div><br/>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-TextDisplayDataStructure" title="Text Display Data Structure"></a>
<h3>Text Display Data Structure</h3>
<p>The <code>TextDisplay</code> data structure contains formatting information for a text sample. When the text export component exports a text sample, it uses the information in this structure to generate the appropriate text descriptors for the sample. Likewise, when the text import component imports a text sample, it sets the appropriate fields in the text display data structure based on the sample’s text descriptors.</p>

<div class="codesample"><table><tr><td scope="row"><pre>struct TextDisplayData {<span></span></pre></td></tr><tr><td scope="row"><pre>    long                    displayFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                    textJustification;<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor            bgColor;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect                    textBox;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                   beginHilite;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                   endHilite;<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor            hiliteColor;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean               doHiliteColor;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt8                   filler;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue           scrollDelayDur;<span></span></pre></td></tr><tr><td scope="row"><pre>    Point                   dropShadowOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                   dropShadowTransparency;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct TextDisplayData TextDisplayData;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>displayFlags</code></p></td>
<td ><p>Contains flags that represent the values of the following text descriptors: <code>doNotDisplay,</code> <code>doNotAutoScale,</code> <code>clipToTextBox,</code><code>useMovieBackColor,</code> <code>shrinkTextBox,</code> <code>scrollIn,</code> <code>scrollOut,</code> <code>horizontalScroll,</code> <code>reverseScroll,</code> <code>continuousScroll,</code> <code>flowHorizontal,</code> <code>dropShadow,</code> <code>anti-alias,</code> <code>keyedText,</code> <code>inverseHilite,</code> <code>continuousKaraoke,</code> and <code>textColorHilite.</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>textJustification</code></p></td>
<td ><p>Specifies the alignment of the text in the text box. Possible values are <code>teFlushDefault,</code> <code>teCenter,</code> <code>teFlushRight,</code> and <code>teFlushLeft.</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>bgColor</code></p></td>
<td ><p>Specifies the background color of the rectangle specified by the <code>textBox</code> field. The background color is specified as an RGB color value.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>textBox</code></p></td>
<td ><p>Specifies the rectangle of the text box.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>beginHilite</code></p></td>
<td ><p>Specifies the one-based index of the first character in the sample to highlight.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>endHilite</code></p></td>
<td ><p>Specifies the one-based index of the last character in the sample to highlight.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>doHiliteColor</code></p></td>
<td ><p>Specifies whether to use the color specified by the <code>hiliteColor</code> field for highlighting. If the value of this field is <code>true,</code> the highlight color is used for highlighting. If the value of this field is <code>false,</code> reverse video is used for highlighting.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>filler</code></p></td>
<td ><p>Reserved.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>scrollDelayDur</code></p></td>
<td ><p>Specifies a scroll delay. The scroll delay is specified as the number of units of delay in the text track's time scale. For example, if the time scale is 600, a scroll delay of 600 causes the sample text to be delayed one second. In order for this field to take effect, scrolling must be enabled.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>dropShadowOffset</code></p></td>
<td ><p>Specifies an offset for the drop shadow. For example, if the point specified is (3,4), the drop shadow is offset 3 pixels to the right and 4 pixels down. In order for this field to take effect, drop shadowing must be enabled.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>dropShadowTransparency</code></p></td>
<td ><p>Specifies the intensity of the drop shadow as a value between 0 and 255. In order for this field to take effect, drop shadowing must be enabled.</p></td>
</tr>

</table></div>


<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImportingText" title="Importing Text"></a>
<h2>Importing Text</h2>
<p>When you import text, you can override the text descriptors in the text file by specifying options in the Text Import Settings dialog box, shown in Figure 5-5.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_21" title="Figure 5-5Text import settings dialog box"></a><p><strong>Figure 5-5&nbsp;&nbsp;</strong>Text import settings dialog box</p><img src = "../Art/refDataExchange-2.gif" alt = "Text import settings dialog box" width="355" height="204"></div><br/>
<p>On import, the settings specified in the dialog box are applied to all imported samples. To display this dialog box programmatically, you can call the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportDoUserDialog" target="_top">MovieImportDoUserDialog</a></code> function.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImportingInPlace" title="Importing In Place"></a>
<h2>Importing In Place</h2>
<p>Some movie data import components can create a movie from a file without having to write to a separate disk file. Examples include MPEG, AIFF, DV, and AVI import components; data in files of these types can be played directly by the appropriate media handler components without any data conversion. In such cases it is inappropriate for the user to have to specify a destination file, because there is no need for such a file.</p>
<p>If your import component can operate in this manner, set the <code>canMovieImportInPlace</code> flag to 1 in your component flags when you register your component. The standard file dialog box uses this flag to determine how to import files. The <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code> and <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromFile" target="_top">NewMovieFromFile</a></code> functions use this flag to open some kinds of files as movies.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-AudioCDImportComponent" title="Audio CD Import Component"></a>
<h2>Audio CD Import Component</h2>
<p>QuickTime includes an audio CD import component. This movie import component allows users to open audio CD tracks from the QuickTime standard file preview dialog box, then convert and save the audio as a movie.</p>
<p>When you open an audio track on an Apple CD-ROM drive (or equivalent), the Open button changes to a Convert button. When you click Convert, the audio CD import options dialog box appears. Use this dialog box to configure the sound settings. You can specify the sample rate, sample size, and channel settings. You can also select the portion of the track that you want to convert.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DVVideoImportandExportComponents" title="DV Video Import and Export Components"></a>
<h2>DV Video Import and Export Components</h2>
<p>QuickTime includes movie data exchange components for DV video.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DVMovieImportComponent" title="DV Movie Import Component"></a>
<h3>DV Movie Import Component</h3>
<p>The DV movie import component converts a file containing DV video data into a QuickTime movie. The input file must be a Mac OS file of type <code>'dvc!'</code> or a Windows file with the <code></code>.dv file extension. The output file contains a QuickTime movie with two tracks:</p>
<ul class="spaceabove">
<li class="li"><p>A video track whose samples are of type <code>kDVNTSCCodecType</code> for NTSC video data or <code>kDVCPALCodecType</code> for PAL video data.</p></li>
<li class="li"><p>A sound track whose samples are of type <code>kDVAudioFormat</code>.</p></li>
</ul>
<p>The data is converted in place, as described in <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ImportingInPlace">“Importing In Place,”</a></span> and the import operation typically takes less than a second. Because both tracks in the QuickTime file refer to the same data, flattening the file creates a file that is twice the size of the original DV data.</p>
<p>You can perform the same operations on the resulting QuickTime movie (including playback, editing, and stepping) that you can for other QuickTime movies. Because video and audio are interleaved in the underlying data, applications for editing movies should make it possible to create a separate file that contains only the audio data for the movie.</p>
<p>This can be done by calling the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/ConvertMovieToFile" target="_top">ConvertMovieToFile</a></code> function and specifying <code>kQTFileTypeAIFF</code> as the destination file format.</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DVMovieExportComponent" title="DV Movie Export Component"></a>
<h3>DV Movie Export Component</h3>
<p>The DV movie export component converts a file containing a QuickTime movie to a file containing DV data for the movie.</p>
<p>The input file must contain a video track; the DV movie export component cannot convert a movie that contains only audio.</p>
<p>If the video track in the QuickTime movie is already in DV format, the DV movie export component does not recompress the video. This makes it possible to edit DV video in QuickTime and then export it without any loss of video quality due to recompression.</p>


<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingDVDatafromanApplication" title="Exporting DV Data from an Application"></a>
<h2>Exporting DV Data from an Application</h2>
<p>An application can export DV data without creating a QuickTime movie file by using a callback procedure to supply media data, as described in <span class="content_text"><a href="6MovieDataExchangeCo.html#//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingDatafromSourcesOtherThanMovies">“Exporting Data from Sources Other Than Movies.”</a></span></p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingDatafromSourcesOtherThanMovies" title="Exporting Data from Sources Other Than Movies"></a>
<h2>Exporting Data from Sources Other Than Movies</h2>
<p>A movie data export component can be written to export data from sources other than QuickTime movies. To do this, the software that exports data must implement callback functions that provide services to the movie data export component. The callback functions and other functions that support this feature are described in this section.</p>
<p>The export component’s <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> routine performs data exporting. When executed, that routine makes callbacks to retrieve characteristics, called properties, and media data from each data source. Characteristics for a video data source might include the width, height, and image compression settings to be used; the media data would be the image description and image data corresponding to a particular movie time. A sound data source would have sound-related characteristics and sound sample data.</p>
<p>Follow these basic steps to export data:</p>
<ul class="ul">
<li class="li"><p>Find an exporter for the format that implements <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code>.</p></li>
<li class="li"><p>Open that export component.</p></li>
<li class="li"><p>For each data source, call the export component’s <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportAddDataSource" target="_top">MovieExportAddDataSource</a></code> to provide the property and data callbacks that the exporter should call during export.</p></li>
<li class="li"><p>Call <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> to perform the export.</p></li>
</ul>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DeterminingWhatKindofTracksaComponentSupports" title="Determining What Kind of Tracks a Component Supports"></a>
<h2>Determining What Kind of Tracks a Component Supports</h2>
<p>The following code sample can be used to determine which track types a given movie export component supports.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-InstantiatingtheDataExportComponent" title="Instantiating the Data Export Component"></a>
<h3>Instantiating the Data Export Component</h3>
<p>The first step in using a movie data export component to create an AIFF file is instantiating an AIFF data export component. An example of this is shown in Listing 5-1.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_22" title="Listing 5-1Instantiating a data export component"></a>
<p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Instantiating a data export component</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTAtomContainer container = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>ComponentDescription cd;<span></span></pre></td></tr><tr><td scope="row"><pre>long count, i;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentType = MovieExportType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentSubType = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentManufacturer = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlags = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlagsMask = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>GetComponentPublicResourceList(kQTMovieExportTrackInfoResourceType, 1, 0, &amp;cd, nil, nil, &amp;container);<span></span></pre></td></tr><tr><td scope="row"><pre>count = QTCountChildrenOfType(container, kParentAtomIsContainer, OSTypeConst('comp'));<span></span></pre></td></tr><tr><td scope="row"><pre>for (i=1; i&lt;=count; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom compAtom, trkResourceAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>    Component c;<span></span></pre></td></tr><tr><td scope="row"><pre>    compAtom = QTFindChildByIndex(container, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        OSTypeConst('comp'), i, (long*)&amp;c);<span></span></pre></td></tr><tr><td scope="row"><pre>    trkResourceAtom = QTFindChildByID(container, compAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTMovieExportTrackInfoResourceType, 1, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (trkResourceAtom) {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTMovieExportSourceRecord **trkResource = (QTMovieExportSourceRecord**)<span></span></pre></td></tr><tr><td scope="row"><pre>            NewHandle(0);<span></span></pre></td></tr><tr><td scope="row"><pre>        long j;<span></span></pre></td></tr><tr><td scope="row"><pre>        Boolean wantsSound = false, wantsVideo = false, wantsText = false,<span></span></pre></td></tr><tr><td scope="row"><pre>            wantsMIDI = false;<span></span></pre></td></tr><tr><td scope="row"><pre>        QTCopyAtomDataToHandle(container, trkResourceAtom, (Handle)trkResource);<span></span></pre></td></tr><tr><td scope="row"><pre>        for (j=0; j&lt;(**trkResource).count; j++) {<span></span></pre></td></tr><tr><td scope="row"><pre>            OSType mType = (**trkResource).sourceArray[j].mediaType;<span></span></pre></td></tr><tr><td scope="row"><pre>            long flags = (**trkResource).sourceArray[j].flags;<span></span></pre></td></tr><tr><td scope="row"><pre>            wantsSound = wantsSound ||<span></span></pre></td></tr><tr><td scope="row"><pre>                ((mType == SoundMediaType) &amp;&amp; (flags &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTMovieExportSourceInfoIsMediaType));<span></span></pre></td></tr><tr><td scope="row"><pre>            wantsVideo = wantsVideo ||<span></span></pre></td></tr><tr><td scope="row"><pre>                (((mType == VideoMediaType) &amp;&amp; (flags &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTMovieExportSourceInfoIsMediaType)) ||<span></span></pre></td></tr><tr><td scope="row"><pre>                ((mType == VisualMediaCharacteristic) &amp;&amp; (flags &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTMovieExportSourceInfoIsMediaCharacteristic)));<span></span></pre></td></tr><tr><td scope="row"><pre>            wantsText = wantsText ||<span></span></pre></td></tr><tr><td scope="row"><pre>                ((mType == TextMediaType) &amp;&amp; (flags &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTMovieExportSourceInfoIsMediaType));<span></span></pre></td></tr><tr><td scope="row"><pre>            wantsMIDI = wantsMIDI ||<span></span></pre></td></tr><tr><td scope="row"><pre>                ((mType == MusicMediaType) &amp;&amp; (flags &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTMovieExportSourceInfoIsMediaType));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        if (wantsSound || wantsVideo) {<span></span></pre></td></tr><tr><td scope="row"><pre>            ComponentDescription cd;<span></span></pre></td></tr><tr><td scope="row"><pre>            char cc[5];<span></span></pre></td></tr><tr><td scope="row"><pre>            GetComponentInfo(c, &amp;cd, nil, nil, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>            cc[0] = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>            *(long *)&amp;cc[1] = cd.componentSubType;<span></span></pre></td></tr><tr><td scope="row"><pre>            DebugStr((StringPtr)cc);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle((Handle)trkResource);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>QTDisposeAtomContainer(container);<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-UsingaMovieDataExportComponenttoExportAudio" title="Using a Movie Data Export Component to Export Audio"></a>
<h2>Using a Movie Data Export Component to Export Audio</h2>
<p>Listing 1-2 illustrates how to use a movie data export component to export audio data to an AIFF file.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_23" title="Listing 5-2Exporting audio data to an AIFF file"></a>
<p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>Exporting audio data to an AIFF file</p>
<div class="codesample"><table><tr><td scope="row"><pre>ComponentDescription cd;<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportComponent ci;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentType = MovieExportType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentSubType = 'AIFF';<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentManufacturer = SoundMediaType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlags = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlagsMask = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>ci = OpenComponent(FindNextComponent(nil, &amp;cd));<span></span></pre></td></tr></table></div>

<p>Note that the <code>componentManufacturer</code> field holds the <code></code></p>
<p><code>SoundMediaType</code> if the movie contains sampled sound or <code>'musi'</code> if it contains MIDI music. If you pass a zero in this field, QuickTime will use the first exporter that can create the desired type of output. This will not always produce the desired result, as a component that creates AIFF output from MIDI requires different input that a component that creates AIFF output from sampled sound.</p>
<p>Note that you use the <code>canMovieExportFromProcedures</code> flag to limit the search to exporters that support the <code></code> <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> component call This is important since not all exporters implement this routine.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ConfiguringtheDataExportComponent" title="Configuring the Data Export Component"></a>
<h3>Configuring the Data Export Component</h3>
<p>Once an AIFF movie data export component has been instantiated, it must be configured to open a single output audio stream. Listing 5-3 is an example of creating an output audio stream by calling <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportAddDataSource" target="_top">MovieExportAddDataSource</a></code>. In this example, <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportAddDataSource" target="_top">MovieExportAddDataSource</a></code> also provides the callback functions for supplying media data.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_24" title="Listing 5-3Configuring the audio export component"></a>
<p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>Configuring the audio export component</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define kMySampleRate 22050<span></span></pre></td></tr><tr><td scope="row"><pre>#define kSoundBufferSize 1024<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Ptr soundData;<span></span></pre></td></tr><tr><td scope="row"><pre>    SoundDescriptionHandle soundDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>    long trackID;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>MyReferenceRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>MyReferenceRecord myRef;<span></span></pre></td></tr><tr><td scope="row"><pre>SoundDescriptionPtr sdp;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.soundData = NewPtr(kSoundBufferSize);<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.soundDescription = NewHandleClear(sizeof(SoundDescription));<span></span></pre></td></tr><tr><td scope="row"><pre>sdp = *myRef.soundDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>sdp->descSize = sizeof(SoundDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>sdp->dataFormat = k8BitOffsetBinaryFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>sdp->numChannels = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>sdp->sampleSize = 8;<span></span></pre></td></tr><tr><td scope="row"><pre>sdp->sampleRate = kMySampleRate &lt;&lt; 16;<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportAddDataSource(ci, SoundMediaType, kMySampleRate,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myRef.trackID, getSoundTrackPropertyProc,<span></span></pre></td></tr><tr><td scope="row"><pre>        getSoundTrackDataProc, &amp;myRef);<span></span></pre></td></tr></table></div>

<p>On the Macintosh, the getSoundTrackPropertyProc and getSoundTrackDataProc routines should be universal procedure pointers (UPPs).</p>

<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ExportingtheData" title="Exporting the Data"></a>
<h3>Exporting the Data</h3>
<p>The export operation takes place when all of the required output tracks have been created. Typical code is shown in Listing 5-4.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_25" title="Listing 5-4Exporting from procedures to a data reference"></a>
<p class="codesample"><strong>Listing 5-4&nbsp;&nbsp;</strong>Exporting from procedures to a data reference</p>
<div class="codesample"><table><tr><td scope="row"><pre>StandardFileReply reply;<span></span></pre></td></tr><tr><td scope="row"><pre>Handle dataRef;<span></span></pre></td></tr><tr><td scope="row"><pre>// get output file from user<span></span></pre></td></tr><tr><td scope="row"><pre>QTNewAlias(&amp;reply.sfFile, (AliasHandle *)&amp;dataRef, true);<span></span></pre></td></tr><tr><td scope="row"><pre>// make up a data reference<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportFromProceduresToDataRef(ci, dataRef, rAliasType);<span></span></pre></td></tr></table></div>

<p><code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> calls the two functions specified in <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportAddDataSource" target="_top">MovieExportAddDataSource</a></code> to obtain data to generate the output file. The first function returns information about the output track’s properties, including the sample rate and supported media. If no value is returned for a particular property, the exporter specifies a default value based on the source data format. In the example in Listing 5-5, the output sample rate is set at 32000 Hz, with all other properties left unspecified.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_26" title="Listing 5-5Obtaining output track information"></a>
<p class="codesample"><strong>Listing 5-5&nbsp;&nbsp;</strong>Obtaining output track information</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal OSErr getSoundTrackDataProc(void *refcon, long trackID,<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType propertyType, void *propertyValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (propertyType)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case scSoundSampleRateType:<span></span></pre></td></tr><tr><td scope="row"><pre>            *(Fixed *)propertyValue = 32000L &lt;&lt; 16;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            err = paramErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The second function provides data to be exported.</p>
<p>Listing 5-6 shows a block of sound data (silence) returned for each export request. The export operation ends when this function returns <code>eofErr</code>.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_27" title="Listing 5-6Providing output track information to the export component"></a>
<p class="codesample"><strong>Listing 5-6&nbsp;&nbsp;</strong>Providing output track information to the export component</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal OSErr getSoundTrack(void *refCon,<span></span></pre></td></tr><tr><td scope="row"><pre>        MovieExportGetDataParams *params)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MyReferenceRecord *myRef = (MyReferenceRecord *)refCon;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (params->requestedTime > kMySampleRate * 10)<span></span></pre></td></tr><tr><td scope="row"><pre>        return eofErr;                  // end of data after 10 seconds<span></span></pre></td></tr><tr><td scope="row"><pre>    params->dataPtr = myRef->soundData;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->dataSize = kSoundBufferSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->actualTime = params->requestedTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->sampleCount = kSoundBufferSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->durationPerSample = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->descType = SoundMediaType;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->descSeed = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->desc = (SampleDescriptionHandle)myRef->soundDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-UsingaMovieDataExportComponenttoExportVideo" title="Using a Movie Data Export Component to Export Video"></a>
<h2>Using a Movie Data Export Component to Export Video</h2>
<p>Using a movie data export component to create a QuickTime movie file is similar in many respects to creating an AIFF file, as shown in the previous example. Media data is handled differently in each case, however.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-InstantiatingtheVideoExportComponent" title="Instantiating the Video Export Component"></a>
<h3>Instantiating the Video Export Component</h3>
<p>Listing 5-7 illustrates the first step, instantiating the movie data export component for video data.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_28" title="Listing 5-7Instantiating a movie data export component"></a>
<p class="codesample"><strong>Listing 5-7&nbsp;&nbsp;</strong>Instantiating a movie data export component</p>
<div class="codesample"><table><tr><td scope="row"><pre>ComponentDescription cd;<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportComponent ci;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentType = MovieExportType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentSubType = 'MooV';<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentManufacturer = 'appl';<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlags = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlagsMask = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>ci = OpenComponent(FindNextComponent(nil, &amp;cd));<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-ConfiguringtheVideoExportComponent" title="Configuring the Video Export Component"></a>
<h3>Configuring the Video Export Component</h3>
<p>Listing 5-8 illustrates the next step: configuring the data export component to create a single output video track. The call to <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportAddDataSource" target="_top">MovieExportAddDataSource</a></code> provides the callback functions for supplying media data.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_29" title="Listing 5-8Configuring the movie data export component"></a>
<p class="codesample"><strong>Listing 5-8&nbsp;&nbsp;</strong>Configuring the movie data export component</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define kMySampleRate 2997      // 29.97 fps<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMyFrameDuration 100    // one frame at 29.97 fps<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    GWorldPtr gw;               // temporary GWorld we use during export<span></span></pre></td></tr><tr><td scope="row"><pre>    ImageDescriptionHandle imageDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>    long trackID;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>MyReferenceRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>MyReferenceRecord myRef;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.gw = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.imageDescription = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportAddDataSource(ci, VideoMediaType, kMySampleRate,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myRef.trackID, getVideoPropertyProc,<span></span></pre></td></tr><tr><td scope="row"><pre>        getVideoDataProc, &amp;myRef);<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-UsingtheComponent" title="Using the Component"></a>
<h3>Using the Component</h3>
<p>The foregoing process should be repeated for as many video and sound sources as will be exported. However, it’s important to realize that not all exporters supporting export from procedures can export an arbitrary number of sources. For the case where an exporter supports fewer sources than the application needs to export, the application must precomposite the video sources or mix the sound sources before providing them to the exporter. The export code was shown previously in Listing 1-4.</p>
<p>The <code>getVideoPropertyProc</code> function returns information about the output track’s properties (for example, the compression format). If the function doesn’t return a value for a particular property, the exporter will choose a default value based (usually) on the source data format. In Listing 5-9, dimensions are set to 160x120 and the compression format is set to JPEG. All other properties are unspecified.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_30" title="Listing 5-9Setting dimensions and compression format"></a>
<p class="codesample"><strong>Listing 5-9&nbsp;&nbsp;</strong>Setting dimensions and compression format</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal OSErr getVideoPropertyProc(void *refcon, long trackID,<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType propertyType, void *propertyValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (propertyType) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case meWidth:<span></span></pre></td></tr><tr><td scope="row"><pre>            *(Fixed *)propertyValue = 160L &lt;&lt; 16;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case meHeight:<span></span></pre></td></tr><tr><td scope="row"><pre>            *(Fixed *)propertyValue = 120L &lt;&lt; 16;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case scSpatialSettingsType:<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>            SCSpatialSettings *ss = propertyValue;<span></span></pre></td></tr><tr><td scope="row"><pre>            ss->codecType = kJPEGCodecType;<span></span></pre></td></tr><tr><td scope="row"><pre>            ss->codec = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            ss->depth = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            ss->spatialQuality = codecNormalQuality;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            err = paramErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The <code>videoGetDataProc</code> <code>function</code> provides video frames to the export operation. In the example in Listing 5-10, the same blank frame is returned for each request. The export operation ends when this function returns <code>eofErr</code>. Any data allocated by <code>videoGetDataProc</code> <code>must</code> be disposed of after the export operation is complete.</p>
<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DontLinkElementID_31" title="Listing 5-10Providing video frames for export"></a>
<p class="codesample"><strong>Listing 5-10&nbsp;&nbsp;</strong>Providing video frames for export</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal OSErr getVideoDataProc(void *refCon,<span></span></pre></td></tr><tr><td scope="row"><pre>        MovieExportGetDataParams *params)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    MyReferenceRecord *myRef = (MyReferenceRecord *)refCon;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeRecord tr;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (params->requestedTime > kMySampleRate * 10)<span></span></pre></td></tr><tr><td scope="row"><pre>        return eofErr;// end of data after 10 seconds<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!myRef->gw) {<span></span></pre></td></tr><tr><td scope="row"><pre>        Rect r;<span></span></pre></td></tr><tr><td scope="row"><pre>        CGrafPtr savePort;<span></span></pre></td></tr><tr><td scope="row"><pre>        GDHandle saveGD;<span></span></pre></td></tr><tr><td scope="row"><pre>        SetRect(&amp;r, 0, 0, 320, 240);<span></span></pre></td></tr><tr><td scope="row"><pre>        NewGWorld(&amp;myRef->gw, 32, &amp;r, nil, nil, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>        LockPixels(myRef ->gw->portPixMap);<span></span></pre></td></tr><tr><td scope="row"><pre>        MakeImageDescriptionForPixMap(myRef->gw->portPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;myRef->imageDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>        GetGWorld(&amp;savePort, &amp;saveGD);<span></span></pre></td></tr><tr><td scope="row"><pre>        SetGWorld(myRef->gw, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>        EraseRect(&amp;r);<span></span></pre></td></tr><tr><td scope="row"><pre>        SetGWorld(savePort, saveGD);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    params->dataPtr = GetPixBaseAddr(myRef->gw->portPixMap);<span></span></pre></td></tr><tr><td scope="row"><pre>    params->dataSize = (**myRef->imageDescription).dataSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->actualTime = params->requestedTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->descType = VideoMediaType;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->descSeed = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->desc = (SampleDescriptionHandle)<span></span></pre></td></tr><tr><td scope="row"><pre>                    myRef->imageDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->durationPerSample = kMyFrameDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    params->sampleFlags = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000903-MovieDataExchangeComponents-DeterminingtheDataSourcesSupportedbyanExportComponent" title="Determining the Data Sources Supported by an Export Component"></a>
<h3>Determining the Data Sources Supported by an Export Component</h3>
<p>The number and kind of data sources supported varies from one exporter to another. In the foregoing examples, AIFF only supports sound data sources while the QuickTime movie exporter accepts both sound and video data sources. Furthermore, an exporter may require at least one data source of some type. In others, it may accept 0 to some maximum number of data sources of a particular type.</p>
<p>Because the kinds and number of data sources supported varies from exporter to exporter, and may change with new versions of a particular exporter, there needs to be a way for a client of an exporter to determine this information. In QuickTime, a procedure-supporting exporter has a public component resource that provides this information.</p>





        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../E-Chapter/5GraphicsExporterCom.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../G-Chapter/7CreatingaMovieDataE.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/ImportExport/DataExchange/F-Chapter/6MovieDataExchangeCo.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/ImportExport/DataExchange/F-Chapter/6MovieDataExchangeCo.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/ImportExport/DataExchange/F-Chapter/6MovieDataExchangeCo.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>