<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Adding Items to a Menu(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING102></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-101.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-103.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-89.html"><B>Chapter 3 - Menu Manager</B></A> / <A HREF="Toolbox-97.html"><B>Using the Menu Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING102-0></A>
<H2><A NAME=MARKER-9-343></A>Adding Items to a Menu</H2>
 <A NAME=MARKER-9-162></A>Usually you define a menu and all its items in a <CODE>'MENU'</CODE> resource. Occasionally you might need to add items to a menu after you've created it. After creating a menu (using <CODE>NewMenu</CODE>, <CODE>GetMenu</CODE>, or <CODE>GetNewMBar</CODE>), you can add items to it using the <CODE>AppendMenu</CODE>, <CODE>InsertMenuItem</CODE>, <CODE>AppendResMenu</CODE>, or <CODE>InsertResMenu</CODE> procedure.<A NAME=MARKER-2-345></A> <A NAME=MARKER-2-525></A><P>
 You can use <CODE>AppendResMenu</CODE> or <CODE>InsertResMenu</CODE> to add items that consist of resource names to a menu. For example, you can use the <CODE>AppendResMenu</CODE> procedure to add fonts to your application's Font menu or to add all of the desktop items from the Apple Menu Items folder to your application's Apple menu. These are common instances when you'll need to add items not already defined in a <CODE>'MENU'</CODE> resource to a menu. See <A HREF=#MARKER-9-370>"Adding Fonts to a Menu" on page 3-71</A> and <A HREF=#MARKER-9-363>"Adding Items to the Apple Menu" on page 3-70</A> for information on adding names of resources to menus.<P>
 If you add items to your application's Help menu, you'll need to use <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> to add the additional items. This section discusses how to add items using the <CODE>AppendMenu</CODE> and <CODE>InsertMenuItem</CODE> procedures, and <A HREF=#MARKER-9-353>"Adding Items to the Help Menu" on page 3-69</A> shows a specific example of adding items to the Help menu. <P>
 If you need to add items other than the names of resources to a previously created menu, you can use the <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> procedure. You can use <CODE>AppendMenu</CODE> to add items to the end of a menu; note that you can add items to only the end of the menu when using <CODE>AppendMenu</CODE>. Use <CODE>InsertMenuItem</CODE> to add items after any given item in a menu. When you add items to a menu using <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE>, you can specify the same characteristics for menu items that are available to you when defining <CODE>'MENU'</CODE> resources.<P>
 You specify a handle to the menu record of the menu to which you want to add the item or items, and you specify a string describing the items to add as parameters to the <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> procedure. The string you pass to these procedures should consist of the text and any characteristics of the menu items. You can specify a hyphen as the menu item text to create a divider line. You can also use various metacharacters in the text string to separate menu items and to specify certain characteristics of the menu items. The metacharacters aren't displayed in the menu.<P>
 <A NAME=MARKER-2-347></A>Here is a list of the metacharacters you can use in the text string that you specify to the <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> procedure:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Metacharacter<TH>Description<TR>
<TD><CODE>;</CODE> or Return<TD>Separates menu items.<TR>
<TD>^<TD>When followed by an icon number, defines the icon for the item. If the keyboard equivalent field contains $1C, this number is interpreted as a script code.<TR>
<TD>!<TD>When followed by a character, defines the mark for the item. If the keyboard equivalent field contains $1B, this value is interpreted as <BR>the menu ID of a submenu of this menu item.<TR>
<TD>&lt;<TD>When followed by one or more of the characters B, I, U, O, and S, defines the character style of the item to Bold, Italic, Underline, Outline, or Shadow, respectively.<TR>
<TD>/<TD>When followed by a character, defines the keyboard equivalent for the item. When followed by $1B, specifies that this menu item has a submenu. To specify that the menu item has a script code, small icon, or reduced icon, use the <CODE>SetItemCmd</CODE> procedure to set the keyboard equivalent field to $1C, $1D, or $1E, respectively.<TR>
<TD>(<TD>Defines the menu item as disabled.</TABLE>
<P>
 You can specify any, all, or none of these metacharacters in the text string to define the characteristics of a menu item. Note that the metacharacters that you specify aren't displayed in the menu item. (To use any of these metacharacters in the text of a menu item, first use <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE>, specifying at least one character as the item's text. Then use the <CODE>SetMenuItemText</CODE> procedure to set the item's text to the desired string.) <A NAME=MARKER-2-348></A><P>
<DL>
<DT><B>Note</B>
<DD>If you add menu items using the <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> procedure, you should define the text and any marks or keyboard equivalents in resources for easier localization.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A HREF=#MARKER-9-350>Listing 3-13</A> shows a string list ('STR#') resource that stores the text of the menu items used in the next examples.<A NAME=MARKER-2-349></A><P>
<B>Listing 3-13  <A NAME=MARKER-9-350></A>Rez input for text of menu items</B><P>
<PRE>
resource 'STR#' (300, &quot;Text for appended menu items&quot;) {
   {
   /*[1]*/
   &quot;Just Text&quot;;
   /*[2]*/
   &quot;Pick a Color...&quot;;
   /*[3]*/
   &quot;(^2!=Everything&lt;B/E&quot;;
   }
);
</PRE>
 Here's code that uses the <CODE>AppendMenu</CODE> procedure to append a menu item with no specific characteristics other than its text to the menu identified by the menu handle in the <CODE>myMenu</CODE> variable. The text for the menu item is "Just Text" as stored in the 'STR#' resource with resource ID 300.<P>
<PRE>
VAR
   myMenu:     MenuHandle;
   itemString: Str255;
   myMenu := GetMenuHandle(mLibrary);
   GetIndString(itemString, 300, 1);
   AppendMenu(myMenu, itemString);
</PRE>
 To insert an item after a given menu item, use the <CODE>InsertMenuItem</CODE> procedure. For example, this code inserts the menu item Pick a Color after the menu item with the item number specified by the <CODE>iRed</CODE> constant. The text for the new menu item consists of the string "Pick a Color..." as stored in the 'STR#' resource with resource ID 300.<P>
<PRE>
VAR
   myMenu:     MenuHandle;
   itemString: Str255;
   myMenu := GetMenuHandle(mColors);
   GetIndString(itemString, 300, 2);
   InsertMenuItem(myMenu, itemString, iRed);
</PRE>
 If you do not explicitly specify a value for an item characteristic in the text string that you pass to <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE>, the procedure assigns the default value for that characteristic. The Menu Manager defines the default item characteristics as no icon, no marking character, no keyboard equivalent, and plain text style. <CODE>AppendMenu</CODE> and <CODE>InsertMenuItem</CODE> enable the added menu items unless you specify otherwise.<P>
 This code appends a menu item with the text "Everything" to the menu identified by the menu handle in the <CODE>myMenu</CODE> variable. The text and other characteristics of this menu item are stored in the 'STR#' resource shown in <A HREF=#MARKER-9-350>Listing 3-13</A>. It also specifies that this menu item is disabled, has an icon with resource ID 258 (2 + 256), and has the "=" character as a marking character; the style of the text is Bold; and the menu item has a keyboard equivalent of Command-E. <P>
<PRE>
VAR
   myMenu:     MenuHandle;
   itemString: Str255;

   myMenu := GetMenuHandle(mLibrary);
   GetIndString(itemString, 300, 3);
   AppendMenu(myMenu, itemString);
</PRE>
 This code appends multiple items to the Edit menu using <CODE>AppendMenu</CODE>:<P>
<PRE>
VAR
   myMenu:     MenuHandle;

   myMenu := GetMenuHandle(mEdit);
   AppendMenu(myMenu, 'Undo/Z;-;Cut/X;Copy/C;Paste/V'); 
</PRE>
 The <CODE>InsertMenuItem</CODE> procedure differs from <CODE>AppendMenu</CODE> in how it handles the given text string when the text string specifies multiple items. The <CODE>InsertMenuItem</CODE> procedure inserts the items in the reverse of their order in the text string. For example, this code inserts menu items into the Edit menu using <CODE>InsertMenuItem</CODE> and is equivalent to the previous example:<P>
<PRE>
VAR
   myMenu:     MenuHandle;

   myMenu := GetMenuHandle(mEdit);
   InsertMenuItem(myMenu, 'Paste/V';Copy/C;Cut/X;-;Undo/Z',0);
</PRE>
 Once you've added a menu item to a menu, you can change any of its characteristics using Menu Manager routines, as described in <A HREF=Toolbox-101.html#MARKER-9-289>"Changing the Appearance of Items in a Menu" on page 3-59</A>. <A NAME=MARKER-2-437></A><A NAME=MARKER-2-352></A><P>
<A NAME=HEADING102-26></A>
<H3><A NAME=MARKER-9-353></A>Adding Items to the Help Menu</H3>
 <A NAME=MARKER-2-499></A>You add items to the Help menu by using the <CODE>HMGetHelpMenuHandle</CODE> function and either the <CODE>AppendMenu</CODE> or <CODE>InsertMenuItem</CODE> procedure. <A NAME=MARKER-2-355></A><P>
 The <CODE>HMGetHelpMenuHandle</CODE> function returns a copy of the handle to the menu record of your application's Help menu. Do not use the <CODE>GetMenuHandle</CODE> function to get a handle to the Help menu, because <CODE>GetMenuHandle</CODE> returns a handle to the global Help menu, not the Help menu that is specific to your application. Once you have a handle to the Help menu that is specific to your application, you can add items to it using the <CODE>AppendMenu</CODE> procedure or other Menu Manager routines. For example, <A HREF=#MARKER-9-356>Listing 3-14</A> adds the menu item displayed in <A HREF=Toolbox-93.html#MARKER-9-172>Figure 3-19 on page 3-35</A>.<P>
<B>Listing 3-14  <A NAME=MARKER-9-356></A>Adding an item to the Help menu<A NAME=MARKER-2-357></A></B><P>
<PRE>
PROCEDURE MyAddHelpItem;
VAR
   myMenu:     MenuHandle;
   myErr:      OSErr;
   itemString: Str255;
BEGIN
   myErr := HMGetHelpMenuHandle(myMenu);
   IF myErr = noErr THEN
      IF myMenu &lt;&gt; NIL THEN
      BEGIN
         {get the string (with index kSurfHelp) from the 'STR#' }
         { resource with resource ID kMyStrings}
         GetIndString(itemString, kMyStrings, kSurfHelp);
         AppendMenu(myMenu, itemString);
      END;
END;
</PRE>
 When you add items to the Help menu, the Help Manager automatically adds a divider between the end of the standard Help menu items and your items. <P>
 Be sure to use an <CODE>'hmnu'</CODE> resource and specify the <CODE>kHMHelpMenuID</CODE> constant as the resource ID to provide help balloons for items you've added to the Help menu. (The Help Manager automatically creates the help balloons for the Help menu title and the standard Help menu items.) See the chapter "Help Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I> for specific information on the <CODE>'hmnu'</CODE> resource.<A NAME=MARKER-9-449></A><A NAME=MARKER-9-332></A><P>
 The Help Manager automatically processes the event when a user chooses any of the standard menu items in the Help menu. The Help Manager automatically enables and disables help when the user chooses Show Balloons or Hide Balloons from the Help menu. The setting of Balloon Help is global and affects all applications. See <A HREF=Toolbox-104.html#MARKER-9-427>"Handling the Help Menu" on page 3-83</A> for information on responding to the user when the user chooses one of your appended items. <A NAME=MARKER-2-360></A><A NAME=MARKER-2-361></A><A NAME=MARKER-2-362></A><P>
<A NAME=HEADING102-34></A>
<H3><A NAME=MARKER-9-363></A>Adding Items to the Apple Menu</H3>
 <A NAME=MARKER-2-364></A><A NAME=MARKER-2-365></A>To insert the items contained in the Apple Menu Items folder into your application's Apple menu, use the <CODE>AppendResMenu</CODE> or <CODE>InsertResMenu</CODE> procedure and specify <CODE>'DRVR'</CODE> as the resource type. Doing so causes this procedure to automatically add all items in the Apple Menu Items folder to the specified menu. <P>
 The user can place any desktop object in the Apple Menu Items folder. When the user places an item in this folder, the system software automatically adds it to the list of items in the Apple menu of all open applications.<P>
 After inserting the Apple menu into your application's menu bar (by using <CODE>GetNewMBar</CODE> or <CODE>GetMenu</CODE> and <CODE>InsertMenu</CODE>), your application can add items to it. <A HREF=#MARKER-9-367>Listing 3-15</A> shows code that uses <CODE>GetMenuHandle</CODE> to get a handle to the application's Apple menu. The code then uses the <CODE>AppendResMenu</CODE> procedure, specifying that <CODE>AppendResMenu</CODE> should add all desktop items in the Apple Menu Items folder to the application's Apple menu.<P>
<B>Listing 3-15  <A NAME=MARKER-9-367></A>Adding menu items to the Apple menu</B><P>
<PRE>
VAR
   myMenu:           MenuHandle;

   myMenu := GetMenuHandle(mApple);
   IF myMenu &lt;&gt; NIL THEN
      AppendResMenu(myMenu, 'DRVR');{add desktop items in the }
                                    { Apple Menu Items folder }
                                    { to the Apple menu}
</PRE>
 <A HREF=#MARKER-9-376>Listing 3-16 on page 3-72</A> shows a complete sample that sets up an application's menu bar, adds items to the Apple menu, adds items to the Font menu, and then updates the appearance of the menu bar. <A NAME=MARKER-2-368></A><A NAME=MARKER-2-369></A><P>
<A NAME=HEADING102-41></A>
<H3><A NAME=MARKER-9-370></A>Adding Fonts to a Menu</H3>
 <A NAME=MARKER-2-371></A><A NAME=MARKER-2-372></A>If your application provides a Font menu, you typically include the description of the menu in a <CODE>'MENU'</CODE> resource, include a description of your menu bar in an <CODE>'MBAR'</CODE> resource, and use <CODE>GetNewMBar</CODE> to create your menu bar and all menus in the menu bar. Once you've created the menu, you can use <CODE>AppendResMenu</CODE> to add the names of all font resources in the Fonts folder of the System Folder (or in system software versions earlier than 7.1, in the System file) as menu items in your application's Font menu. (You can also use <CODE>InsertResMenu</CODE> to insert the fonts into your menu.) <A NAME=MARKER-2-580></A><P>
 <A HREF=#MARKER-9-376>Listing 3-16</A> on the next page shows how to add names of font resources in the Fonts folder to an application's Font menu. The <CODE>AppendResMenu</CODE> procedure adds all resources of the specified type to a given menu. If you specify the resource type <CODE>'FONT'</CODE> or <CODE>'FOND'</CODE>, the Menu Manager adds all resources of type<DFN> <CODE>'FOND'</CODE></DFN> and <CODE>'FONT'</CODE> to the menu. (<CODE>'NFNT'</CODE> and <CODE>'sfnt'</CODE> resources are specified through <CODE>'FOND'</CODE> resources.)<A NAME=MARKER-2-374></A><A NAME=MARKER-2-375></A><P>
 The <CODE>AppendResMenu</CODE> and <CODE>InsertResMenu</CODE> procedures perform special processing for any font resources they find that have font numbers greater than $4000. The Menu Manager automatically sets the keyboard equivalent field of the menu item to $1C and stores the script code in the icon field of the menu item for any such <CODE>'FOND'</CODE> resource. The Menu Manager displays a font name in its corresponding script if the script system for that font is installed.<P>
<B>Listing 3-16  <A NAME=MARKER-9-376></A>Adding font names to a menu<A NAME=MARKER-2-377></A></B><P>
<PRE>
PROCEDURE MyMakeAllMenus; 
VAR
   menu:                MenuHandle;
   menuBar:             Handle;
 BEGIN
                        {read menus in &amp; create new menu list}
   menuBar := GetNewMBar(rMenuBar);    
   IF menuBar = NIL THEN
      EXIT(MyMakeAllMenus);
   SetMenuBar(menuBar); {insert menus into the current menu list}
   DisposHandle(menuBar);
   myMenu := GetMenuHandle(mApple);
   IF myMenu &lt;&gt; NIL THEN                  {add desktop items in }
      AppendResMenu(myMenu, 'DRVR');      { Apple Menu Items }
                                          { folder to Apple menu}
   myMenu := GetMenuHandle(mFont);
   IF myMenu &lt;&gt; NIL THEN               
      AppendResMenu(myMenu, 'FONT');      {add font names to the }
         { Font menu--this adds all bitmapped and TrueType fonts }
         { in the Fonts folder to the Font menu}
   MyAddHelpItem;       {add app-specific item to Help menu}
   MyAdjustMenus;       {adjust menu items}
   DrawMenuBar;         {draw the menu bar}
 END; 
</PRE>
 Your application should indicate the current font to the user by placing the appropriate mark next to the text of the menu item that lists the font name. (<A HREF=Toolbox-101.html#MARKER-9-313>"Changing the Mark of Menu Items" on page 3-63</A> explains how to add marks to and remove marks from menu items; <A HREF=Toolbox-93.html#MARKER-9-154>Figure 3-13 on page 3-32</A> and <A HREF=Toolbox-93.html#MARKER-9-155>Figure 3-14 on page 3-32</A> show examples of typical Font menus.) <P>
 If your application allows the user to change the font style or font size of text, you should provide separate Size and Style menus. See <A HREF=Toolbox-104.html#MARKER-9-433>"Handling a Size Menu" beginning on page 3-84</A> for information on providing a Size menu in your application. <A NAME=MARKER-2-378></A><A NAME=MARKER-2-379></A><A NAME=MARKER-2-380></A><A NAME=MARKER-2-381></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-101.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-103.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
