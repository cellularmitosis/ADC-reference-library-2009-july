<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime VR: QTVR Atom Containers</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="QTVR Atom Containers"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000944-CH211" title="QTVR Atom Containers"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../VirtualReality-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000589" target="_top">Virtual Reality</a> &gt; <a href="../0Preface/QTVR-preface.html#//apple_ref/doc/uid/TP40000944-CH204-DontLinkElementID_2">QuickTime VR</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../5Chap/5-QTVR-Movie-Controller.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AppA/appendix_a.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_132" title="QTVR Atom Containers"></a><h1><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJJCAGC" title="QTVR Atom Containers"></a>QTVR Atom Containers</h1><p>This chapter describes in detail the VR world and node information atom containers. These two atom containers can be obtained by calling the QuickTime VR Manager routines <code>QTVRGetVRWorld</code> and <code>QTVRGetNodeInfo</code>. Those routines are described in this chapter. </p><p>If you are unfamiliar with QuickTime atoms and atom containers, you should read the <em>QuickTime File Format</em> specification (see bibliography). The specification describes in detail how QuickTime uses <strong>QT atom</strong> and <strong>atom containers</strong>, which are tree-structured hierarchies of QT atoms, to provide a basic structure for storing information in QuickTime.</p><p>You need to know about the various atoms contained in the VR world and node information atom containers if you want to extract information from a QuickTime VR file that cannot be obtained using VR Manager functions. For instance, there is no QuickTime VR Manager function that returns the name of a given node; however, you can easily get a node’s name by reading the information in the atoms in the atom container returned by the <code>QTVRGetNodeInfo</code> function.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_133" title="Note"></a><p><strong>Note:</strong>&nbsp;In general, you don’t need to know about the format of atoms  or atom containers simply to use the functions provided by the  QuickTime VR Manager.</p></div><p>This chapter is divided into the following major sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJCIIGD">“Overview of Atom Containers”</a></span> describes the QuickTime atom container, a tree structured hierarchy of QT atoms used for storing information in QuickTime files. </p></li><li class="li"><p><span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJEIGGI">“Getting the Name of a Node”</a></span> discusses <a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_319"></a>how you can use standard QuickTime atom container functions to retrieve the information in a node header atom.</p></li><li class="li"><p><span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJGIJCI">“Adding Custom Atoms in a QuickTime VR Movie”</a></span><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_320"></a><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_321"></a> describes how you can add custom atoms to either the VR world or node information atom containers. </p></li><li class="li"><p><span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJEEEFC">“Required Atoms for Wired Actions”</a></span> discusses what atoms must be included in the QuickTime VR file to support wired actions.</p></li></ul><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJCIIGD" title="Overview of Atom Containers"></a><h2>Overview of Atom Containers</h2><p>A QuickTime atom container is a basic structure for storing information in QuickTime files. An atom container is a tree structured hierarchy of QT atoms. By definition, only the <strong>leaf atoms</strong> in the hierarchy contain data. Intermediate atoms serve as <strong>parent atoms</strong> that contain any number of child atoms, which may in turn be either leaf atoms or more parent atoms. Each parent’s child atom is uniquely identified by its <strong>atom type</strong> and <strong>atom ID</strong>. The atom container itself is considered the parent of the highest level atoms. </p><p>Many atom types contained in the VR world and node information atom containers are unique within their container. For example, each has a single header atom. Most of the parent atoms within an atom container are unique as well, such as the node parent atom in the VR world atom container or the hot spot parent atom in the node information atom container. For these one time only atoms, the atom ID is always set to 1. Unless otherwise mentioned in the descriptions of the atoms that follow, assume that the atom ID is 1.</p><p>Many of the atom structures contain two version fields, <code>majorVersion</code> and <code>minorVersion</code>. The values of these fields correspond to the constants <code>kQTVRMajorVersion</code> and <code>kQTVRMinorVersion</code> found in the header file <code>QuickTimeVRFormat.h</code>. For QuickTime 2.0 files, these values are 2 and 0.</p><p>QuickTime provides many routines for creating and accessing atom containers. Those are described in the <em>QuickTime API Reference</em>. </p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF101" title="The String Atom and the String Encoding Atom"></a><h3>The String Atom and the String Encoding Atom</h3><p>Some of the leaf atoms within the VR world and node information atom containers contain fields that specify the ID of <a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_322"></a><strong>string atoms</strong> that are siblings of the leaf atom. For example, the VR world header atom contains a field for the name of the scene. The string atom is a leaf atom whose atom type is <code>kQTVRStringAtomType </code>(<code>'vrsg'</code><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_323"></a>)<code>.</code> Its atom ID is that specified by the referring leaf atom. </p><p>A string atom contains a string. The structure of a string atom is defined by the <code>QTVRStringAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRStringAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              stringUsage;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              stringLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned char                       theString[4];<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRStringAtom, *QTVRStringAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>stringUsage</code></dt><dd><p>The string usage. This field is unused.</p></dd><dt><code>stringLength</code></dt><dd><p>The length, in bytes, of the string.</p></dd><dt><code>theString</code></dt><dd><p>The string. The string atom structure is extended to hold this string.</p></dd></dl><p>Each string atom may also have a sibling leaf atom called the <a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_324"></a><strong>string encoding atom</strong>. The string encoding atom’s atom type is <code>kQTVRStringEncodingAtomType</code> (<code>'vrse'</code>). Its atom ID is the same as that of the corresponding string atom. The string encoding atom contains a single variable, <code>TextEncoding</code>, a <code>UInt32</code>, as defined in the header file <code>TextCommon.h</code>. The value of <code>TextEncoding</code> is handed, along with the string, to the routine <code>QTTextToNativeText</code> for conversion for display on the current machine. The routine <code>QTTextToNativeText</code> is found in the header file <code>Movies.h.</code></p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_134" title="Note"></a><p><strong>Note:</strong>&nbsp;The header file <code>TextCommon.h</code> contains constants and routines for generating and handling text encodings. </p></div><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJBBGDI" title="VR World Atom Container"></a><h3>VR World Atom Container</h3><p>The VR world atom container (VR world for short) includes such information as the name for the entire scene, the default node ID, and default imaging properties, as well as a list of the nodes contained in the QTVR track. </p><p>A VR world can also contain custom scene information. QuickTime VR ignores any atom types that it doesn’t recognize, but you can extract those atoms from the VR world using standard QuickTime atom functions.</p><p>The structure of the VR world atom container is shown in <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJIBJFA">Figure 7-1</a></span>. The component atoms are defined and their structures are shown in the sections that follow. </p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_135" title="Figure 7-1Structure of the VR world atom container "></a><p><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJIBJFA" title="Figure 7-1Structure of the VR world atom container "></a><strong>Figure 7-1&nbsp;&nbsp;</strong>Structure of the VR world atom container </p><img src = "../art/qtvr_l_10.gif" alt = "Structure of the VR world atom container" width="151" height="386"></div><br/><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF102" title="VR World Header Atom Structure"></a><h4>VR World Header Atom Structure</h4><p>The VR world header atom is a leaf atom. Its atom type is <code>kQTVRWorldHeaderAtomType</code> (<a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_325"></a><code>'vrsc'</code>). It contains the name of the scene and the default node ID to be used when the file is first opened as well as fields reserved for future use. </p><p>The structure of a VR world header atom is defined by the <code>QTVRWorldHeaderAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRWorldHeaderAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              defaultNodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              vrWorldFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRWorldHeaderAtom, *QTVRWorldHeaderAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>nameAtomID</code></dt><dd><p>The ID of the string atom that contains the name of the scene. That atom should be a sibling of the VR world header atom. The value of this field is 0 if no name string atom exists.</p></dd><dt><code>defaultNodeID</code></dt><dd><p>The ID of the default node (that is, the node to be displayed when the file is first opened).</p></dd><dt><code>vrWorldFlags</code></dt><dd><p>A set of flags for the VR world. This field is unused.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF103" title="Imaging Parent Atom"></a><h4>Imaging Parent Atom</h4><p>The imaging parent atom is the parent atom of one or more node-specific imaging atoms. Its atom type is <code>kQTVRImagingParentAtomType ('imgp').</code> Only panoramas have an imaging atom defined. </p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF104" title="Panorama-Imaging Atom "></a><h4>Panorama-Imaging Atom </h4><p>A panorama-imaging atom describes the default imaging characteristics for all the panoramic nodes in a scene. This atom overrides QuickTime VR’s own defaults. </p><p>The panorama-imaging atom has an atom type of <code>kQTVRPanoImagingAtomType</code> (<a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_326"></a><code>'impn'</code>). Generally, there is one panorama-imaging atom for each imaging mode, so the atom ID, while it must be unique for each atom, is ignored. QuickTime VR iterates through all the panorama-imaging atoms. </p><p>The structure of a panorama-imaging atom is defined by the <code>QTVRPanoImagingAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRPanoImagingAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingMode;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              correction;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              quality;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              directDraw;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingProperties[6];<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRPanoImagingAtom, *VRPanoImagingAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>imagingMode</code></dt><dd><p>The imaging mode to which the default values apply. Only <code>kQTVRStatic</code> and <code>kQTVRMotion</code> are allowed here.</p></dd><dt><code>imagingValidFlags</code></dt><dd><p>A set of flags that indicate which imaging property fields in this structure are valid. </p></dd><dt><code><!--a  -->correction<!--/a--></code></dt><dd><p>The default correction mode for panoramic nodes. This can be either <code>kQTVRNoCorrection</code>, <code>kQTVRPartialCorrection</code>, or <code>kQTVRFullCorrection</code>. </p></dd><dt><code><!--a  -->quality<!--/a--></code></dt><dd><p>The default imaging quality for panoramic nodes. </p></dd><dt><code>directDraw</code></dt><dd><p>The default direct-drawing property for panoramic nodes. This can be <code>true</code> or <code>false</code>.</p></dd><dt><code>imagingProperties</code></dt><dd><p>Reserved for future panorama-imaging properties.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><p>The <code>imagingValidFlags</code> field in the panorama-imaging atom structure specifies which imaging property fields in that structure are valid. You can use these bit flags to specify a value for that field:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidCorrection                        = 1 &lt;&lt; 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidQuality                           = 1 &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidDirectDraw                        = 1 &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidFirstExtraProperty                = 1 &lt;&lt; 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>kQTVRValidCorrection</code></dt><dd><p>If this bit is set, the field holds a default correction mode.</p></dd><dt><code>kQTVRValidQuality</code></dt><dd><p>If this bit is set, the field holds a default imaging quality.</p></dd><dt><code>kQTVRValidDirectDraw</code></dt><dd><p>If this bit is set, the field holds a default direct-drawing property.</p></dd><dt><code>kQTVRValidFirstExtraProperty</code></dt><dd><p>If this bit is set, the first element in the array in the field holds a default imaging property. As new imaging properties are added, they will be stored in this array. </p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF105" title="Node Parent Atom"></a><h3>Node Parent Atom</h3><p>The node parent atom is the parent of one or more node ID atoms. The atom type of the node parent atom is <code>kQTVRNodeParentAtomType</code> (<code>'vrnp'</code>) and the atom type of the each node ID atom is <code>kQTVRNodeIDAtomType</code> (<code>'vrni'</code>). </p><p>There is one node ID atom for each node in the file. The atom ID of the node ID atom is the node ID of the node. The node ID atom is the parent of the node location atom. The node location atom is the only child atom defined for the node ID atom. Its atom type is <code>kQTVRNodeLocationAtomType </code>(<code>'nloc'</code>)<code>. </code></p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF106" title="Node Location Atom Structure"></a><h3>Node Location Atom Structure</h3><p>The node location atom is the only child atom defined for the node ID atom. Its atom type is<code> kQTVRNodeLocationAtomType </code>(<code>'nloc'</code>)<code>.</code> A node location atom describes the type of a node and its location. </p><p>The structure of a node location atom is defined by the <code>QTVRNodeLocationAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRNodeLocationAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              nodeType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              locationFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              locationData;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRNodeLocationAtom, *QTVRNodeLocationAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>nodeType</code></dt><dd><p>The node type. This field should contain either <code>kQTVRPanoramaType</code> or <code>kQTVRObjectType</code>.</p></dd><dt><code>locationFlags</code></dt><dd><p>The location flags. This field must contain the value <code>kQTVRSameFile</code>, indicating that the node is to be found in the current file. In future, these flags may indicate that the node is in a different file or at some URL location. </p></dd><dt><code>locationData</code></dt><dd><p>The location of the node data. When the <code>locationFlags</code> field is <code>kQTVRSameFile</code>, this field should be 0. The nodes are found in the file in the same order that they are found in the node list.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF107" title="Custom Cursor Atoms "></a><h3>Custom Cursor Atoms </h3><p>The hot spot information atom, discussed in <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJHHGFA">“Hot Spot Information Atom,”</a></span> allows you to indicate custom cursor IDs for particular hot spots that replace the default cursors used by QuickTime VR. QuickTime VR allows you to store your custom cursors in the VR world of the movie file. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_136" title="Note"></a><p><strong>Note:</strong>&nbsp;If you’re using the Mac OS, you could store your custom cursors in the resource fork of the movie file. However, this would not work on any other platform (such as Windows), so storing cursors in the resource fork of the movie file is not recommended.</p></div><p>The cursor parent atom is the parent of all of the custom cursor atoms stored in the VR world. Its atom type is <code>kQTVRCursorParentAtomType</code> (<code>'vrcp'</code>). The child atoms of the cursor parent are either cursor atoms or color cursor atoms. Their atom types are <code>kQTVRCursorAtomType </code>(<code>'CURS'</code>) and <code>kQTVRColorCursorAtomType </code>(<code>'crsr'</code>). These atoms are stored exactly as cursors or color cursors would be stored as a resource. </p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF108" title="Node Information Atom Container"></a><h3>Node Information Atom Container</h3><p>The node information atom container includes general information about the node such as the node’s type, ID, and name. The node information atom container also contains the list of hot spot atoms for the node. A QuickTime VR movie contains one node information atom container for each node in the file. The routine <code>QTVRGetNodeInfo</code> allows you to obtain the node information atom container for the current node or for any other node in the movie.</p><p><span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJHEBEC">Figure 7-2</a></span> shows the structure of the node information atom container.</p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_137" title="Figure 7-2Structure of the node information atom container "></a><p><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJHEBEC" title="Figure 7-2Structure of the node information atom container "></a><strong>Figure 7-2&nbsp;&nbsp;</strong>Structure of the node information atom container </p><img src = "../art/qtvr_l_11.gif" alt = "Structure of the node information atom container" width="221" height="386"></div><br/><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF109" title="Node Header Atom Structure"></a><h4>Node Header Atom Structure</h4><p>A node header atom is a leaf atom that describes the type and ID of a node, as well as other information about the node. Its atom type is <code>kQTVRNodeHeaderAtomType</code> (<code>'ndhd'</code>). </p><p>The structure of a node header atom is defined by the <code>QTVRNodeHeaderAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRNodeHeaderAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              nodeType;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            commentAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRNodeHeaderAtom, *VRNodeHeaderAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>nodeType</code></dt><dd><p>The node type. This field should contain either <code>kQTVRPanoramaType</code> or <code>kQTVRObjectType</code>.</p></dd><dt><code>nodeID</code></dt><dd><p>The node ID.</p></dd><dt><code>nameAtomID</code></dt><dd><p>The ID of the string atom that contains the name of the node. This atom should be a sibling of the node header atom. The value of this field is 0 if no name string atom exists.</p></dd><dt><code>commentAtomID</code></dt><dd><p>The ID of the string atom that contains a comment for the node. This atom should be a sibling of the node header atom. The value of this field is 0 if no comment string atom exists.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF110" title="Hot Spot Parent Atom"></a><h4>Hot Spot Parent Atom</h4><p>The hot spot parent atom is the parent for all hot spot atoms for the node. The atom type of the hot spot parent atom is <code>kQTVRHotSpotParentAtomType</code> (<code>'hspa'</code>) and the atom type of the each hot spot atom is <code>kQTVRHotSpotAtomType</code> (<code>'hots'</code>)<code>.</code> Note that the atom ID of each hot spot atom is <em>not</em> the hot spot ID for the corresponding hot spot. The hot spot ID is determined by its color index value as it is stored in the hot spot image track. </p><p>The hot spot track is an 8-bit video track which contains color information that indicates hot spots. </p><p>Each hot spot atom is the parent of a number of atoms that contain information about each hot spot.</p><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJHHGFA" title="Hot Spot Information Atom "></a><h4>Hot Spot Information Atom </h4><p>The hot spot information atom contains general information about a hot spot. Its atom type is <code>kQTVRHotSpotInfoAtomType</code> (<code>'hsin'</code>). Every hot spot atom should have a hot spot information atom as a child. </p><p>The structure of a hot spot information atom is defined by the <code>QTVRHotSpotInfoAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRHotSpotInfoAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              hotSpotType;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            commentAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32                              cursorID[3];<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          bestViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect                                hotSpotRect;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRHotSpotInfoAtom, *QTVRHotSpotInfoAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>hotSpotType</code></dt><dd><p>The hot spot type. This type specifies which other information atoms—if any—are siblings to this one. QuickTime VR recognizes three types: <code>kQTVRHotSpotLinkType</code>, <code>kQTVRHotSpotURLType</code>, and <code>kQTVRHotSpotUndefinedType</code>.</p></dd><dt><code>nameAtomID</code></dt><dd><p>The ID of the string atom that contains the name of the hot spot. This atom should be a sibling of the hot spot information atom. This string is displayed in the QuickTime VR control bar when the mouse is moved over the hot spot.</p></dd><dt><code>commentAtomID</code></dt><dd><p>The ID of the string atom that contains a comment for the hot spot. This atom should be a sibling of the hot spot information atom. The value of this field is 0 if no comment string atom exists.</p></dd><dt><code><!--a  -->cursorID<!--/a--></code></dt><dd><p>An array of three IDs for custom hot spot cursors (that is, cursors that override the default hot spot cursors provided by QuickTime VR). The first ID (<code>cursorID[0]</code>) specifies the cursor that is displayed when it is in the hot spot. The second ID (<code>cursorID[1]</code>) specifies the cursor that is displayed when it is in the hot spot and the mouse button is down. The third ID (<code>cursorID[2]</code>) specifies the cursor that is displayed when it is in the hot spot and the mouse button is released. To retain the default cursor for any of these operations, set the corresponding cursor ID to 0. Custom cursors should be stored in the VR world atom container, as described in <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJBBGDI">“VR World Atom Container.”</a></span> </p></dd><dt><code>bestPan</code></dt><dd><p>The best pan angle for viewing this hot spot.</p></dd><dt><code>bestTilt</code></dt><dd><p>The best tilt angle for viewing this hot spot.</p></dd><dt><code>bestFOV</code></dt><dd><p>The best field of view for viewing this hot spot.</p></dd><dt><code>bestViewCenter</code></dt><dd><p>The best view center for viewing this hot spot; applies only to object nodes.</p></dd><dt><code>hotSpotRect</code></dt><dd><p>The boundary box for this hot spot, specified as the number of pixels in full panoramic space. This field is valid only for panoramic nodes.</p></dd><dt><code>flags</code></dt><dd><p>A set of hot spot flags. This field is unused.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_138" title="Note"></a><p><strong>Note:</strong>&nbsp;In QuickTime VR movie files, all angular values are stored as 32-bit floating-point values that specify degrees. In addition, all floating-point values conform to the IEEE Standard 754 for binary floating-point arithmetic, in big-endian format.</p></div><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF111" title="Specific Information Atoms"></a><h4>Specific Information Atoms</h4><p>Depending on the value of the <code>hotSpotType</code> field in the hot spot info atom there may also be a type specific information atom. The atom type of the type-specific atom is the hot spot type. </p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF112" title="Link Hot Spot Atom"></a><h4>Link Hot Spot Atom</h4><p>The link hot spot atom specifies information for hot spots of type <code>kQTVRHotSpotLinkType</code> (<code>'link'</code><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_327"></a>)<code>.</code> Its atom type is thus <code>'link'.</code>  The link hot spot atom contains specific information about a link hot spot. </p><p>The structure of a link hot spot atom is defined by the <code>QTVRLinkHotSpotAtom</code> data type:</p><div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRLinkHotSpotAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              toNodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              fromValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          fromViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              toValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          toViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             distance;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRLinkHotSpotAtom, *VRLinkHotSpotAtomPtr;<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>majorVersion</code></dt><dd><p>The major version number of the file format.</p></dd><dt><code>minorVersion</code></dt><dd><p>The minor version number of the file format.</p></dd><dt><code>toNodeID</code></dt><dd><p>The ID of the destination node (that is, the node to which this hot spot is linked).</p></dd><dt><code>fromValidFlags</code></dt><dd><p>A set of flags that indicate which source node view settings are valid. </p></dd><dt><code>fromPan</code></dt><dd><p>The preferred from-pan angle at the source node (that is, the node containing the hot spot).</p></dd><dt><code>fromTilt</code></dt><dd><p>The preferred from-tilt angle at the source node.</p></dd><dt><code>fromFOV</code></dt><dd><p>The preferred from-field of view at the source node.</p></dd><dt><code>fromViewCenter</code></dt><dd><p>The preferred from-view center at the source node.</p></dd><dt><code>toValidFlags</code></dt><dd><p>A set of flags that indicate which destination node view settings are valid. </p></dd><dt><code>toPan</code></dt><dd><p>The pan angle to use when displaying the destination node.</p></dd><dt><code>toTilt</code></dt><dd><p>The tilt angle to use when displaying the destination node.</p></dd><dt><code>toFOV</code></dt><dd><p>The field of view to use when displaying the destination node.</p></dd><dt><code>toViewCenter</code></dt><dd><p>The view center to use when displaying the destination node.</p></dd><dt><code>distance</code></dt><dd><p>The distance between the source node and the destination node.</p></dd><dt><code>flags</code></dt><dd><p>A set of link hot spot flags. This field is unused and should be set to 0.</p></dd><dt><code>reserved1</code></dt><dd><p>Reserved. This field must be 0.</p></dd><dt><code>reserved2</code></dt><dd><p>Reserved. This field must be 0.</p></dd></dl><p>Certain fields in the link hot spot atom are not used by QuickTime VR. The <code>fromValidFlags</code> field is generally set to 0 and the <code>from</code> fields are not used. However, these fields could be quite useful if you have created a transition movie from one node to another. The <code>from</code> angles can be used to swing the current view of the source node to align with the first frame of the transition movie. The <code>distance</code> field is intended for use with 3D applications, but is also not used by QuickTime VR.</p><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF113" title="Link Hot Spot Valid Flags"></a><h5>Link Hot Spot Valid Flags</h5><p>The <code>toValidFlags</code> field in the link hot spot atom structure specifies which view settings are to be used when moving to a destination node from a hot spot. You can use these bit flags to specify a value for that field:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidPan                               = 1 &lt;&lt; 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidTilt                              = 1 &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidFOV                               = 1 &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidViewCenter                        = 1 &lt;&lt; 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><dl class="termdef">	<dt><code>kQTVRValidPan</code></dt><dd><p>If this bit is set, the destination pan angle is used.</p></dd><dt><code>kQTVRValidTilt</code></dt><dd><p>If this bit is set, the destination tilt angle is used.</p></dd><dt><code>kQTVRValidFOV</code></dt><dd><p>If this bit is set, the destination field of view is used.</p></dd><dt><code>kQTVRValidViewCenter</code></dt><dd><p>If this bit is set, the destination view center is used.</p></dd></dl><a name="//apple_ref/doc/uid/TP40000944-CH211-TPXREF114" title="URL Hot Spot Atom"></a><h3>URL Hot Spot Atom</h3><p>The URL hot spot atom has an atom type of <code>kQTVRHotSpotURLType</code> (<a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_328"></a><code>'url '</code>). The URL hot spot atom contains a URL string for a particular Web location (for example, <code>http://quicktimevr.apple.com</code>). QuickTime VR automatically links to this URL when the hot spot is clicked.</p><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJEIGGI" title="Getting the Name of a Node"></a><h2>Getting the Name of a Node</h2><p><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_329"></a>You can use standard QuickTime atom container functions to retrieve the information in a node header atom. For example, the <code>MyGetNodeName</code> function defined in <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJDGBFI">Listing 7-1</a></span> returns the name of a node, given its node ID.<a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_330"></a><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_331"></a></p><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_139" title="Listing 7-1Getting a node&acirc;&#128;&#153;s name"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJDGBFI" title="Listing 7-1Getting a node&acirc;&#128;&#153;s name"></a><strong>Listing 7-1&nbsp;&nbsp;</strong>Getting a node’s name</p><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_332"></a><div class="codesample"><table><tr><td scope="row"><pre>OSErr MyGetNodeName (QTVRInstance theInstance, UInt32 theNodeID,<span></span></pre></td></tr><tr><td scope="row"><pre>                        StringPtr theStringPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                   theErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         theNodeInfo;<span></span></pre></td></tr><tr><td scope="row"><pre>    VRNodeHeaderAtomPtr     theNodeHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom                  theNodeHeaderAtom = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //Get the node information atom container.<span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = QTVRGetNodeInfo(theInstance, theNodeID, &amp;theNodeInfo);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //Get the node header atom.<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!theErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        theNodeHeaderAtom = QTFindChildByID(theNodeInfo,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kQTVRNodeHeaderAtomType, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theNodeHeaderAtom != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTLockContainer(theNodeInfo);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        //Get a pointer to the node header atom data.<span></span></pre></td></tr><tr><td scope="row"><pre>        theErr = QTGetAtomDataPtr(theNodeInfo, theNodeHeaderAtom, nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (Ptr *)&amp;theNodeHeader);<span></span></pre></td></tr><tr><td scope="row"><pre>        //See if there is a name atom.<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!theErr &amp;&amp; theNodeHeader->nameAtomID != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            QTAtom theNameAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>            theNameAtom = QTFindChildByID(theNodeInfo,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         kQTVRStringAtomType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         theNodeHeader->nameAtomID, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>            if (theNameAtom != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                VRStringAtomPtr theStringAtomPtr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            //Get a pointer to the name atom data; copy it into the string.<span></span></pre></td></tr><tr><td scope="row"><pre>                theErr = QTGetAtomDataPtr(theNodeInfo, theNameAtom, nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         (Ptr *)&amp;theStringAtomPtr);<span></span></pre></td></tr><tr><td scope="row"><pre>                if (!theErr) {<span></span></pre></td></tr><tr><td scope="row"><pre>                    short theLen = theStringAtomPtr->stringLength;<span></span></pre></td></tr><tr><td scope="row"><pre>                    if (theLen > 255)<span></span></pre></td></tr><tr><td scope="row"><pre>                        theLen = 255;<span></span></pre></td></tr><tr><td scope="row"><pre>                    BlockMove(theStringAtomPtr->string, &amp;theStringPtr[1],<span></span></pre></td></tr><tr><td scope="row"><pre>                                theLen);<span></span></pre></td></tr><tr><td scope="row"><pre>                    theStringPtr[0] = theLen;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        QTUnlockContainer(theNodeInfo);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(theNodeInfo);<span></span></pre></td></tr><tr><td scope="row"><pre>    return(theErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>MyGetNodeName </code>function defined in <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJDGBFI">Listing 7-1</a></span> retrieves the node information atom container (by calling <code>QTVRGetNodeInfo</code>) and then looks inside that container for the node header atom with atom ID 1. If it finds one, it locks the container and then gets a pointer to the node header atom data. The desired information, the node name, is contained in the string atom whose atom ID is specified by the <code>nameAtomID </code>field of the node header structure. </p><p>Accordingly, the <code>MyGetNodeName </code>function then calls <code>QTFindChildByID </code>once again to find that string atom. If the string atom is found, <code>MyGetNodeName </code>calls <code>QTGetAtomDataPtr </code>to get a pointer to the string atom data. Finally, <code>MyGetNodeName </code>copies the string data into the appropriate location and cleans up after itself before returning.</p><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJGIJCI" title="Adding Custom Atoms in a QuickTime VR Movie"></a><h2>Adding Custom Atoms in a QuickTime VR Movie</h2><p>If you author a QuickTime VR movie, you may choose to add custom atoms to either the VR world or node information atom containers. Those atoms can be extracted within an application to provide additional information that the application may use.</p><p>Information that pertains to the entire scene might be stored in a custom atom within the VR world atom container. Node-specific information could be stored in the individual node information atom containers or as sibling atoms to the node location atoms within the VR world. </p><p>Custom hot spot atoms should be stored as siblings to the hot spot information atoms in the node information atom container. Generally, its atom type is the same as the custom hot spot type. You can set up an intercept procedure in your application in order to process clicks on the custom hot spots. </p><p>If you use custom atoms, you should install your hot spot intercept procedure when you open the movie. <span class="content_text"><a href="7-QTVR-atoms-file-format.html#//apple_ref/doc/uid/TP40000944-CH211-BAJIACGF">Listing 7-2</a></span> is an example of such an intercept procedure. </p><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_140" title="Listing 7-2Typical hot spot intercept procedure"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJIACGF" title="Listing 7-2Typical hot spot intercept procedure"></a><strong>Listing 7-2&nbsp;&nbsp;</strong>Typical hot spot intercept procedure</p><div class="codesample"><table><tr><td scope="row"><pre>QTVRInterceptProc MyProc = NewQTVRInterceptProc (MyHotSpot);<span></span></pre></td></tr><tr><td scope="row"><pre>QTVRInstallInterceptProc (qtvr, kQTVRTriggerHotSpotSelector, myProc, 0, 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal void MyHotSpot (QTVRInstance qtvr, QTVRInterceptPtr qtvrMsg,<span></span></pre></td></tr><tr><td scope="row"><pre>                        SInt32 refCon, Boolean *cancel)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 hotSpotID = (UInt32) qtvrMsg->parameter[0];<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer nodeInfo = (QTAtomContainer) qtvrMsg->parameter[1];<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom hotSpotAtom = (QTAtom) qtvrMsg->parameter[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType hotSpotType;<span></span></pre></td></tr><tr><td scope="row"><pre>    CustomData myCustomData;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom myAtom;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTVRGetHotSpotType (qtvr, hotSpotID, &amp;hotSpotType);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (hotSpotType != kMyAtomType) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // It's our type of hot spot - don't let anyone else handle it<span></span></pre></td></tr><tr><td scope="row"><pre>    *cancel = true;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Find our custom atom<span></span></pre></td></tr><tr><td scope="row"><pre>    myAtom = QTFindChildByID (nodeInfo, hotSpotAtom, kMyAtomType, 1, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myAtom != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>        // Copy the custom data into our structure<span></span></pre></td></tr><tr><td scope="row"><pre>        err = QTCopyAtomDataToPtr (nodeInfo, myAtom, false,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 sizeof(CustomData), &amp;myCustomData, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            // Do something with it<span></span></pre></td></tr><tr><td scope="row"><pre>            DoMyHotSpotStuff (hotSpotID, &amp;myCustomData);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Your intercept procedure is called for clicks on any hot spot. You should check to see if it is your type of hot spot and if so, extract the custom hot spot atom and do whatever is appropriate for your hot spot type (<code>DoMyHotSpotStuff</code>).</p><p>When you no longer need the intercept procedure you should call <code>QTVRInstallInterceptProc</code> again with the same selector and a <code>nil</code> procedure pointer and then call <code>DisposeRoutineDescriptor</code> on <code>myProc</code>. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_141" title="Note"></a><p><strong>Note:</strong>&nbsp;Apple reserves all hot spot and atom types with lowercase letters. Your custom hot spot type should contain all uppercase letters.<a name="//apple_ref/doc/uid/TP40000944-CH211-DontLinkElementID_333"></a></p></div><a name="//apple_ref/doc/uid/TP40000944-CH211-BAJEEEFC" title="Required Atoms for Wired Actions"></a><h2>Required Atoms for Wired Actions</h2><p>Certain actions on a QuickTime VR movie can trigger wired actions if the appropriate event handler atoms have been added to the file. This section  discusses what atoms must be included in the QuickTime VR file to support  wired actions. </p><p>As with sprite tracks, the presence of a certain atom in the media property atom container of the QTVR track enables the handling of wired actions. This atom is of type <code>kSpriteTrackPropertyHasActions</code>, which has a single Boolean value that must be set to <code>true</code>.</p><p>When certain events occur and the appropriate event handler atom is found in the QTVR file, then that atom is passed to QuickTime to perform any actions specified in the atom. The event handler atoms themselves must be added to the node information atom container in the QTVR track. There are two types of event handlers for QTVR nodes: global and hot spot specific. The currently supported global event handlers are <code>kQTEventFrameLoaded</code> and <code>kQTEventIdle</code>. The event handler atoms for these are located at the root level of the node information atom container. A global event handler atom’s type is set to the event type and its ID is set to 1.</p><p>Hot spot–specific event handler atoms are located in the specific hot spot atom as a sibling to the hot spot info atom. For these atoms, the atom type is always <code>kQTEventType</code> and the ID is the <code>event</code> type. Supported hot spot–specific event types are <code>kQTEventMouseClick</code>, <code>kQTEventMouseClickEnd</code>, <code>kQTEventMouseClickEndTriggerButton</code>, and <code>kQTEventMouseEnter</code>, <code>kQTEventMouseExit</code>.</p><p>The specific actions that cause these events to be generated are described as follows:</p><dl class="termdef">	<dt><code>kQTEventFrameLoaded </code>(<code>'fram'</code>)</dt><dd><p>Generated when a node is entered, before any application-installed entering-node procedure is called (this event processing is considered part of the node setup that occurs before the application’s routine is called).</p></dd><dt><code>kQTEventIdle </code>(<code>'idle'</code>)</dt><dd><p>Generated every n ticks, where n is defined by the contents of the </p></dd><dt><code>kSpriteTrackPropertyQTIdleEventsFrequency</code></dt><dd><p> atom (</p></dd><dt><code>SInt32</code></dt><dd><p>) in the media property atom container. When appropriate, this event is triggered before any normal idle processing occurs for the QuickTime VR movie.</p></dd><dt><code>kQTEventMouseClick </code>(<code>'clik'</code>)</dt><dd><p>Generated when the mouse goes down over a hot spot.</p></dd><dt><code>kQTEventMouseClickEnd </code>(<code>'cend'</code>)</dt><dd><p>Generated when the mouse goes up after a <code>kQTEventMouseClick</code> is generated, regardless of whether the mouse is still over the hot spot originally clicked. This event occurs prior to QuickTime VR’s normal mouse-up processing.</p></dd><dt><code>kQTEventMouseClickEndTriggerButton </code>(<code>'trig'</code>)</dt><dd><p>Generated when a click end triggers a hot spot (using the same criterion as used by QuickTime VR in 2.1 for link/url hot spot execution). This event occurs prior to QuickTime  VR’s normal hot spot–trigger processing.</p></dd><dt><code>kQTEventMouseEnter </code>(<code>'entr'</code>)<code>, kQTEventMouseExit </code>(<code>'exit'</code>)</dt><dd><p>These two events are generated when the mouse rolls into or out of a hot spot, respectively. These events occur whether or not the mouse is down and whether or not the movie is being panned. These events occur after any application-installed MouseOverHotSpotProc is called, and will be cancelled if the return value from the application’s routine indicates that QuickTimeVR’s normal over-hotspot processing should not take place.</p></dd></dl><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../5Chap/5-QTVR-Movie-Controller.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AppA/appendix_a.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-06-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/InsideQT_QTVR/7Chap/7-QTVR-atoms-file-format.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/InsideQT_QTVR/7Chap/7-QTVR-atoms-file-format.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/InsideQT_QTVR/7Chap/7-QTVR-atoms-file-format.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>