<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Extending Printing Dialogs: Utility Functions</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Utility Functions"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000979-CH209" title="Utility Functions"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000432" target="_top">Printing</a> &gt; <a href="../../../Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP30000432-TP30000494" target="_top">Carbon</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30000979-CH201-TP9">Extending Printing Dialogs</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Integration/Integration.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PMPlugIn/PMPlugIn.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000979-CH209-TP1" title="Utility Functions"></a><h1>Utility Functions</h1><p>In your custom code, you might need to embed a control in a dialog pane, get a ticket reference, or implement a help event handler.</p><p>This appendix explains how to perform these tasks. You should be able to use this sample code in a real-world project with little or no modification.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Utilities.html#//apple_ref/doc/uid/TP30000979-CH209-CJADIDJC">Embedding a Nib-Based Control</a>
				
			<br/>
			
        
			
			
				<a href="Utilities.html#//apple_ref/doc/uid/TP30000979-CH209-CJABDCCF">Getting a Ticket Reference</a>
				
			<br/>
			
        
			
			
				<a href="Utilities.html#//apple_ref/doc/uid/TP30000979-CH209-TPXREF169">Handling the Help Event in a Printing Dialog</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000979-CH209-CJADIDJC" title="Embedding a Nib-Based Control"></a><h2>Embedding a Nib-Based Control</h2><p><span class="content_text">Listing A-1</span> implements a function that embeds a nib-based control inside the dialog pane provided by the printing system. </p><p>This function takes three parameters—a nib-based window, a Carbon container control (called a user pane), and the ID of the nib-based control being embedded.</p><p>During execution, this function</p><ul class="ul"><li class="li"><p>gets a reference to the nib-based control</p></li><li class="li"><p>positions the control with respect to the dialog window</p></li><li class="li"><p>embeds the control inside the dialog user pane</p></li><li class="li"><p>returns a reference to the control being embedded</p></li></ul><a name="//apple_ref/doc/uid/TP30000979-CH209-BBCBJJJJ" title="Listing A-1Embedding a nib-based control inside a dialog pane"></a><p class="codesample"><strong>Listing A-1&nbsp;&nbsp;</strong>Embedding a nib-based control inside a dialog pane</p><div class="codesample"><table><tr><td scope="row"><pre>extern OSStatus MyEmbedControl (<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowRef nibWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef userPane,<span></span></pre></td></tr><tr><td scope="row"><pre>    const ControlID *controlID,<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef* outControl<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef control = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *outControl = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    result = GetControlByID (nibWindow, controlID, &amp;control);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (result == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        SInt16 dh, dv;<span></span></pre></td></tr><tr><td scope="row"><pre>        Rect nibFrame, controlFrame, paneFrame;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        (void) GetWindowBounds (nibWindow, kWindowContentRgn, &amp;nibFrame);<span></span></pre></td></tr><tr><td scope="row"><pre>        (void) GetControlBounds (userPane, &amp;paneFrame);<span></span></pre></td></tr><tr><td scope="row"><pre>        (void) GetControlBounds (control, &amp;controlFrame);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        dh = ((paneFrame.right - paneFrame.left) -<span></span></pre></td></tr><tr><td scope="row"><pre>                (nibFrame.right - nibFrame.left))/2;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (dh &lt; 0) dh = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        dv = ((paneFrame.bottom - paneFrame.top) -<span></span></pre></td></tr><tr><td scope="row"><pre>                (nibFrame.bottom - nibFrame.top))/2;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (dv &lt; 0) dv = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        OffsetRect (<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            &amp;controlFrame,<span></span></pre></td></tr><tr><td scope="row"><pre>            paneFrame.left + dh,<span></span></pre></td></tr><tr><td scope="row"><pre>            paneFrame.top + dv<span></span></pre></td></tr><tr><td scope="row"><pre>        );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        (void) SetControlBounds (control, &amp;controlFrame);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        result = SetControlVisibility (control, TRUE, FALSE);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (result == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            result = EmbedControl (control, userPane);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if (result == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                *outControl = control;<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing A-1</span> does:</p><ol class="ol"><li class="li"><p>Gets a reference to the desired control. This control already exists in the nib window that contains your custom interface.</p></li><li class="li"><p>Finds the delta needed to position the control such that the nib-based interface is horizontally center-aligned inside the dialog pane.Finds the delta needed to position the control such that the nib-based interface is vertically center-aligned inside the dialog pane.</p></li><li class="li"><p>Adjusts the coordinates of the top-left corner of the control, so that the control is positioned correctly with respect to the dialog pane.</p></li><li class="li"><p>Makes sure the control is visible if the dialog pane is displayed.</p></li><li class="li"><p>Embeds the control inside the dialog pane. As a side effect, the printing system now owns the control reference—your printing dialog extension should not release it.</p></li><li class="li"><p>Passes the embedded control back to the caller.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000979-CH209-DontLinkElementID_30" title="Note"></a><p><strong>Note:</strong>&nbsp; A printing dialog is a Carbon window, and the position of a graphics object inside the window is specified using local QuickDraw coordinates.</p></div><a name="//apple_ref/doc/uid/TP30000979-CH209-CJABDCCF" title="Getting a Ticket Reference"></a><h2>Getting a Ticket Reference</h2><p>To get a ticket reference, you need to implement a function that calls <code>PMSessionGetData</code> for the session object associated with the current print job.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000979-CH209-DontLinkElementID_31" title="Warning"></a><p><strong>Warning:</strong>&nbsp; The printing system retains ownership of the ticket reference you obtain, and it could become invalid later. For this reason, you should use the reference for the task at hand and then discard it. Do not save or retain the reference in your context.</p></div><p><span class="content_text">Table A-1</span> lists the four standard ticket identifiers defined for use by printing dialog extensions.</p><a name="//apple_ref/doc/uid/TP30000979-CH209-BBCFBEEB" title="Table A-1Ticket identifiers used by printing dialog extensions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table A-1&nbsp;&nbsp;</strong>Ticket identifiers used by printing dialog extensions</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Identifier (CFStringRef)</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Ticket</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th></tr><tr><td  scope="row"><p><code>kPDE_PMPrintSettingsRef</code></p></td><td ><p>Print settings </p></td><td ><p>Used by application and printer module printing dialog extensions.</p></td></tr><tr><td  scope="row"><p><code>kPDE_PMPageFormatRef</code></p></td><td ><p>Page format</p></td><td ><p>Used by application and printer module printing dialog extensions.</p></td></tr><tr><td  scope="row"><p><code>kPDE_PMJobTemplateRef</code></p></td><td ><p>Job template </p></td><td ><p>Available only during some printer module printing dialog extension routines.</p></td></tr><tr><td  scope="row"><p><code>kPDE_PMPrinterInfoRef</code></p></td><td ><p>Printer info </p></td><td ><p>Available only during some printer module printing dialog extension routines.</p></td></tr></table></div><p><span class="content_text">Listing A-2</span> illustrates how to write a function that constructs and passes back a ticket reference.</p><a name="//apple_ref/doc/uid/TP30000979-CH209-BBCDFBEF" title="Listing A-2A utility function that gets a ticket reference"></a><p class="codesample"><strong>Listing A-2&nbsp;&nbsp;</strong>A utility function that gets a ticket reference</p><div class="codesample"><table><tr><td scope="row"><pre>extern OSStatus MyGetTicket<span></span></pre></td></tr><tr><td scope="row"><pre>(<span></span></pre></td></tr><tr><td scope="row"><pre>    PMPrintSession  session,<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef     ticketID,<span></span></pre></td></tr><tr><td scope="row"><pre>    PMTicketRef*    ticketPtr<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFTypeRef type = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    PMTicketRef ticket = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *ticketPtr = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    result = PMSessionGetDataFromSession (session, ticketID, &amp;type);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (result == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (CFNumberGetValue (<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            (CFNumberRef) type, kCFNumberSInt32Type, (void*) &amp;ticket))<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            *ticketPtr = ticket;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else {<span></span></pre></td></tr><tr><td scope="row"><pre>            result = kPMInvalidValue;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing A-2</span> does:</p><ol class="ol"><li class="li"><p>Searches the printing session object for a specialized job ticket. The value passed back is a generic object reference. The printing system provides the session object when it calls the sync function.</p></li><li class="li"><p>Gets a numeric value that represents an opaque ticket reference. This function returns <code>true</code> if the operation was successful.</p></li><li class="li"><p>Passes back the ticket reference to the caller.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH209-TPXREF169" title="Handling the Help Event in a Printing Dialog"></a><h2>Handling the Help Event in a Printing Dialog</h2><p>This section explains how your printing dialog extension can override the default behavior of the help button in a printing dialog. Of course, you don’t want to override the help button unless your pane is visible.</p><p>The tasks are straightforward:</p><ul class="ul"><li class="li"><p>Add a field for a handler reference to the context described in <span class="content_text"><a href="../Core/Core.html#//apple_ref/doc/uid/TP30000979-CH206-CIHHEAGC">“Defining a Context.”</a></span></p></li><li class="li"><p>In the open function described in <span class="content_text"><a href="../Core/Core.html#//apple_ref/doc/uid/TP30000979-CH206-BBCCGGBH">“Open,”</a></span> install a Carbon event handler that handles the command event associated with the help button. Save the handler reference in the context.</p></li><li class="li"><p>In the close function described in <span class="content_text"><a href="../Core/Core.html#//apple_ref/doc/uid/TP30000979-CH206-BBCJJHII">“Close,”</a></span> remove the handler to restore the default behavior of the help button.</p></li></ul><a name="//apple_ref/doc/uid/TP30000979-CH209-TPXREF165" title="Handling a Window Command Event"></a><h3>Handling a Window Command Event</h3><p><span class="content_text">Listing A-3</span> shows how to implement a Carbon event handler that detects and handles a help-button click in a printing dialog. The installing function—described in <span class="content_text"><a href="Utilities.html#//apple_ref/doc/uid/TP30000979-CH209-TPXREF166">“Installing a Help Event Handler”</a></span>—configures this handler for command events only.</p><a name="//apple_ref/doc/uid/TP30000979-CH209-BCIHIGAC" title="Listing A-3An event handler for the help event in a printing dialog"></a><p class="codesample"><strong>Listing A-3&nbsp;&nbsp;</strong>An event handler for the help event in a printing dialog</p><div class="codesample"><table><tr><td scope="row"><pre>static OSStatus MyHandleHelpEvent<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>(<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerCallRef call,<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRef event,<span></span></pre></td></tr><tr><td scope="row"><pre>    void *userData<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    HICommand commandStruct;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = eventNotHandledErr;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetEventParameter (<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        event, kEventParamDirectObject,<span></span></pre></td></tr><tr><td scope="row"><pre>        typeHICommand, NULL, sizeof(HICommand),<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, &amp;commandStruct<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (commandStruct.commandID == 'help') {<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        result = MyDisplayHelp();<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing A-3</span> does:</p><ol class="ol"><li class="li"><p>Declares the name and parameters for a Carbon event handler of type <code>EventHandlerProcPtr</code>. In this implementation, <code>event</code> is the only parameter actually used.</p></li><li class="li"><p>Declares a data structure for a command event. See the Carbon Event Manager reference for details.</p></li><li class="li"><p>Initializes the return code. The usual default value <code>noErr</code> is not appropriate here, because in this context <code>noErr</code> means “event handled”.</p></li><li class="li"><p>Retrieves the event data. Since this handler is installed at the window level, the event could contain one of several different commands.</p></li><li class="li"><p>Checks the command signature to see if the help button was clicked.</p></li><li class="li"><p>Calls a custom function you implement to display the help book for your application or printer module.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH209-TPXREF166" title="Installing a Help Event Handler"></a><h3>Installing a Help Event Handler</h3><p><span class="content_text">Listing A-4</span> shows how to write a function that installs a help event handler, specifying the printing dialog as the event target.</p><a name="//apple_ref/doc/uid/TP30000979-CH209-BCIJIIFJ" title="Listing A-4Installing a help event handler"></a><p class="codesample"><strong>Listing A-4&nbsp;&nbsp;</strong>Installing a help event handler</p><div class="codesample"><table><tr><td scope="row"><pre>#define kMyNumberOfEventTypes   1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>extern OSStatus MyInstallHelpEventHandler<span></span></pre></td></tr><tr><td scope="row"><pre>(<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowRef inWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerRef *outHandler<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    static const EventTypeSpec sEventTypes [kMyNumberOfEventTypes] =<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassCommand, kEventCommandProcess }<span></span></pre></td></tr><tr><td scope="row"><pre>    };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerRef handler = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerUPP handlerUPP = NewEventHandlerUPP (MyHandleHelpEvent);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    result = InstallWindowEventHandler (<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        inWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>        handlerUPP,<span></span></pre></td></tr><tr><td scope="row"><pre>        kMyNumberOfEventTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>        sEventTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;handler<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *outHandler = handler;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing A-4</span> does:</p><ol class="ol"><li class="li"><p>Defines an array of event type specifiers. This array represents the set of event types you want to handle. In this case, you need to handle only one type.</p></li><li class="li"><p>Creates the universal procedure pointer used by the Carbon Event Manager to call your event handler.</p></li><li class="li"><p>Installs the handler. On return, <code>context->handler</code> contains the <code>EventHandlerRef</code> used later to remove the event handler.</p></li><li class="li"><p>Stores this handler reference in the context.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH209-TPXREF171" title="Removing a Help Event Handler"></a><h3>Removing a Help Event Handler</h3><p><span class="content_text">Listing A-5</span> shows how to write a function that removes the help event handler described in <span class="content_text"><a href="Utilities.html#//apple_ref/doc/uid/TP30000979-CH209-TPXREF166">“Installing a Help Event Handler.”</a></span></p><a name="//apple_ref/doc/uid/TP30000979-CH209-BBAIIDED" title="Listing A-5Removing a help event handler"></a><p class="codesample"><strong>Listing A-5&nbsp;&nbsp;</strong>Removing a help event handler</p><div class="codesample"><table><tr><td scope="row"><pre>extern OSStatus MyRemoveHelpEventHandler (<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerRef *helpHandlerP,<span></span></pre></td></tr><tr><td scope="row"><pre>    EventHandlerUPP *helpHandlerUPP<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (*helpHandlerP != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        result = RemoveEventHandler (*helpHandlerP);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        *helpHandlerP = NULL;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (*helpHandlerUPP != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeEventHandlerUPP (*helpHandlerUPP);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        *helpHandlerUPP = NULL;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing A-4</span> does:</p><ol class="ol"><li class="li"><p>Removes the help event handler.</p></li><li class="li"><p>Deletes the reference to the handler in your context.</p></li><li class="li"><p>Deallocates the UPP used by the Carbon Event Manager to call your help event handler.</p></li><li class="li"><p>Deletes the reference to this UPP in your context.</p></li></ol><a name="//apple_ref/doc/uid/TP30000979-CH209-TPXREF34" title="Further Reading"></a><h3>Further Reading</h3><p>For more information about the Carbon event model and writing Carbon event handlers, and see <em><a href="../../../../Carbon/Conceptual/Carbon_Event_Manager/index.html#//apple_ref/doc/uid/TP30000989" target="_top">Carbon Event Manager Programming Guide</a></em>.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Integration/Integration.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PMPlugIn/PMPlugIn.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-10-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Utilities/Utilities.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Utilities/Utilities.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Printing/Conceptual/ExtPrintingDialogs/Utilities/Utilities.html%3Fid%3DTP30000979-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>