<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QTMTB37: QuickTime CFM Error -2804</title><meta name="keywords" content="Mac OS 8 QuickTime CFM Error -2804 weak linking libraries"><meta name="Description" content="Technical Q&amp;A QTMTB37: Q&amp;A gives a possible reason for theCFM error -2804 : QuickTimeLib.xcoff, which occurs when usingMPW to try and link to the import-library QuickTimeLib.xcoffso as to use the toolbox function TransformRect. Q&amp;A providesa note concerning weak linking and QuickTime, which includescode that checks for the QuickTime libraries from withinan application."><meta name="categories" content="QuickTime Movie Toolbox"><meta name="week-posted" content="May 1, 1995 - May 5, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002007" title="QuickTime CFM Error -2804"></a> <!-- white background --><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/idxMovieBasics-date.html" target="_blank">QuickTime > Movie Basics</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QTMTB37</div>
<div id="pageheadsub">QuickTime CFM Error -2804</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER>			<!-- -->						<!-- Document Body --><table cellspacing="0" cellpadding="0" border="0" WIDTH="600"><tr><td align="left" scope="row"><font size="+4">Q</font>  I am using MPW on a PowerMac 8100/80 AV with System 7.5 andQuickTime 2.0, and I am developing a component which uses the MovieToolbox'sTransformRect routine. The linker flags unresolved external symbols for theTransformRect function. Linking the component with the import-libraryQuickTimeLib.xcoff (from ETO #15) satisfies the linker. I get a CFM error of - 2804,with an error string of "QuickTimeLib.xcoff", which I believe suggests that theCFM cannot find the implementation of the QuickTimeLib.<p>What's causing this error, and what can I do to eliminate it?</p><font size="+4">A</font>  It's possible that this is happening because you don't have the QuickTime PowerPlug extension installed. PowerPlug is actually the CFM for the few nativefunctions we have for QuickTime (mostly codecs and compression/decompressionfunctions). PowerPlug is included with QuickTime 2.0, so you should have itavailable.<p>The following is a note relating to weak linking and QuickTime. It includescode that shows how to query for the availability of the library from withinthe application itself.</p><p><u>QuickTime CFM PowerPlug Libraries, Availability, Weak Links</u></p><p>The Code Fragment Manager supports the concept of "soft" or "weak" linking. Ifa library is soft-linked, the Process Manager runs your application, even ifthe library is missing. As a result, the application continues to function whena particular library it calls is not installed.  The application can disableareas of functionality based on the current availability of libraries.</p><p>MPW PowerPC tools includes MakePEF, a tool with an additional flag thatspecifies when exported symbols are weak. In this case, the runtimearchitecture tries to resolve the CFM library, but it doesn't fail if it can't.You can specify that the library has weak linking by adding a tilde (~)character at the end of the - l option to MakePEF. For example, to soft-link to QuickTimeLib, do this:</p><pre>    MakePEF -l QuickTimeLib.xcoff=QuickTimeLib~ ...</pre><p>You can also mark CFM libraries that have weak linking in the MetrowerksPowerPC environment.</p><p>Your client program can test for the presence of the CFM library and disableall functionality that depends on it. (for example, if no QuickTime CFMlibraries are present, you can disable "Play Movies").</p><p>This technique has one drawback -- it does not prevent a problem when a usermoves the library after it registers with Gestalt, since the library registersonly once, and there is no way to de-register it. There is no direct solutionto this problem, but there is an alternative way to determine if the library isloaded -- check the address of one of the library's functions before callingit. In <i>Inside Macintosh</i>, this technique is illustrated in the followingexample:</p><pre>extern int printf (char *, ...);// ...if (printf == kUnresolvedSymbolAddress)        DebugStr(&quot;\printf is not available.&quot;);else    printf(&quot;Hello, world!\n&quot;);QuickTime also has a new Gestalt selector to determine whetherit's safe to call a weak- linked library (gestaltQuickTimeFeatures).This function shows how to initialize QuickTimefor 68K and PowerPC Macs:Boolean    InitQuickTime(void){    long         qtVersion;    OSErr         anErr;#ifdef powerc    long         qtFeatures;#endif    anErr = Gestalt(gestaltQuickTime, &amp;qtVersion);    if (anErr != noErr)        return false;        // no QT present#ifdef powerc// Test if the library is registered.    anErr = Gestalt(gestaltQuickTimeFeatures, &amp;qtFeatures);    if ( !( (anErr == noErr)  &amp;&amp;  (qtFeatures &amp;    (1 &lt;&lt; gestaltPPCQuickTimeLibPresent))       )) // not true          return false;#endif    anErr = EnterMovies();    if ( anErr == noErr)        return true;    else        return false;        // problems initializing QuickTime}</pre><p>Both QuickTime Gestalt selectors are tested for in the PowerPC case. You needto test for the presence of both QuickTime and the QuickTime library. If theapplication is unable to load the CFM library due to lack of space, theapplication might mysteriously die later, so it's important to always checkthat the libraries are loaded and available.</p><!-- begin_date --><H4 ALIGN=center>[May 01 1995]</H4><!-- end_date --></td></tr></table></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qtmtb/qtmtb37.html%3Fid%3DDTS10002007-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qtmtb/qtmtb37.html%3Fid%3DDTS10002007-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qtmtb/qtmtb37.html%3Fid%3DDTS10002007-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>