<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OV16: Gestalt &amp; _SysEnvirons - A Never-Ending Story</title><meta name="keywords" content="Mac OS 7 Gestalt _SysEnvirons calls gestaltMachineType gestaltHardwareAttr gestaltHasSCSI "><meta name="Description" content="Technical Note OV16: This Technical Note discusses the latestchanges and improvements to the _Gestalt and _SysEnvironscalls. Technical Note documents the gestaltMachineType selectorand its response values. Also documented is the gestaltHardwareAttrselector, paying close attention to bits 3,4 and 7 whichhave been known to cause confusion. Documented last are the_SysEnvirons calls where making these calls from a high levellanguage is described.">                                       <meta name="categories" content="Overview"><meta name="week-posted" content="Apr 27, 1987 - May 1, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002614" title="Gestalt & _SysEnvirons - A Never-Ending Story"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OV16</div>
<div id="pageheadsub">Gestalt &amp; _SysEnvirons - A Never-Ending Story</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">_Gestalt</A><BR><BR><A HREF="#Section3">Additional Gestalt Response Values</A><BR><BR><A HREF="#Section4">gestaltHardwareAttr Selector</A><BR><BR><A HREF="#Section5">SysEnvirons</A><BR><BR><A HREF="#Section6">Calling _SysEnvirons From a High-Level Language</A><BR><BR><A HREF="#Section7">Additional _SysEnvirons Constants</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Changes">Change History</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note discusses the latest changes and improvements to the<code>_Gestalt</code> and <code>_SysEnvirons</code> calls.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Sep 01 1994]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->        <A NAME=Section1></A><h2>Introduction</h2><p>Previous versions of this Note provided the latest documentation on newinformation the <code>_SysEnvirons</CODE> trap could return. Developer Support Center (DSC)will continue to revise this Note to provide this information; however, as the<code>_Gestalt</CODE> trap is now the preferred method for determining information about amachine environment, this Note will also provide up-to-date information on<code>_Gestalt</CODE> selectors.</p><a name="Section2"></a> <P><A HREF="#top">Back to top</A></P><h2>_Gestalt</h2><p>This Note now documents <code>_Gestalt</CODE> selectors and return values added since therelease of <i>Inside Macintosh</i> Volume VI. Please note that this is supplemental information; for the complete description of <code>_Gestalt</CODE> and its use, please refer to <i>Inside Macintosh</i> Volume VI.</p><p>The Macintosh LC II is identical to the Macintosh LC except for the presence ofan MC68030 processor, so under System 7.0.1 it returns the <i>same</i><code>gestaltMachineType</code> response as the Macintosh LC (that is, 19). However, underSystem 7.1 and later, the LC II responds to a <code>gestaltMachineType</code> selector withthe value 37. Thus, there are two cases when you are on an LC II: under System7.0.1, you will get a <code>gestaltMachineType</code> response of gestaltMacLC (19), butgestaltProcessorType will return <code>gestalt68030</code>; under future system software,gestaltMachineType will return <code>gestaltMacLCII</code> (37). The processor will, ofcourse, still be a 68030.</p><p>There is a similar difficulty with the PowerBook 145. This is essentially aPowerBook 140 with a 25-MHz 68030 processor. Under System 7.0.1, it returns the gestaltMachineType response of <code>gestaltPowerBook140</code> (25); under System 7.1 and all later system software versions, the value returned is gestaltPowerBook145 (54).</p><p>Developers are reminded that the gestaltMachineType selector is forinformational purposes only and should not be used as a basis for programmatic decisions. As always, developers are encouraged to test for the specific features they need and not to rely on any particular machine having a particular set of features. This requirement becomes even more important given that the PowerBook 520 and 540 and their color variants, are all identified using the same gestalt selector ID.  To distinguish between the two model types, use the new Power Manager call, <code>MaximumProcessorSpeed</code> as documented in the developer notes for the PowerBook 520/540.</p><p>In the future, existing Gestalt ID's will be reused and it will not be possibleto distinguish Macintosh models by Gestalt machine ID.  Typically, the only difference between Macintosh models will be in software bundling.  To go along with this change, STR# (-13695) which has traditionally stored the Macintosh name, will be altered so that each string becomes &lt;sp&gt;&lt;sp&gt;Macintosh.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The <i>Macintosh PowerBook 100 Developer Notes</i> and the<i>Macintosh PowerBook 140/170 Developer Notes</i>, available on the <i>Developer CD Series</i> discincorrectly document <code>gestaltMachineType</code> response values for the Macintosh PowerBook computers. The following values are, and have always been, the correct values.</P></TD></TR></TABLE></CENTER><BR><a name="Section3"></a> <P><A HREF="#top">Back to top</A></P><h2>Additional Gestalt Response Values</h2><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>{ gestaltMachineType response values }gestaltMacLC        = 19;    { Macintosh LC }gestaltQuadra900    = 20;    { Macintosh Quadra 900 }gestaltPowerBook170    = 21;    { Macintosh PowerBook 170 }gestaltQuadra700    = 22;    { Macintosh Quadra 700 }gestaltClassicII    = 23;    { Macintosh Classic II }gestaltPerforma200    = 23;    { Macintosh Performa 200 }gestaltPowerBook100    = 24;    { Macintosh PowerBook 100 }gestaltPowerBook140    = 25;    { Macintosh PowerBook 140 }gestaltQuadra950    = 26;    { Macintosh Quadra 950}gestaltMacLCIII        = 27;    { Macintosh LC III }gestaltPerforma450    = 27;    { Macintosh Performa 450 }gestaltPowerBookDuo210     = 29;    { Macintosh PowerBook Duo 210 }gestaltMacCentris650    = 30;    { Macintosh Centris 650 }gestaltPowerBookDuo230     = 32;    { Macintosh PowerBook Duo 230 }gestaltPowerBook180     = 33;    { Macintosh PowerBook 180 }gestaltPowerBook160     = 34;    { Macintosh PowerBook 160 }gestaltMacQuadra800    = 35;    { Macintosh Quadra 800 }gestaltMacQuadra650    = 36;    { Macintosh Quadra 650 }gestaltMacLCII        = 37;    { Macintosh LC II }gestaltPerforma40x    = 37;    { Macintosh Performa 40x }gestaltPerforma430    = 37;    { Macintosh Performa 430 }gestaltPowerBookDuo250    = 38;    { Macintosh PowerBook Duo 250 }gestaltPowerMac9150    = 39;    { Power Macintosh 9150 }gestaltPowerMac8100_110    = 40;    { Power Macintosh 8100/110 }gestaltMacIIvi         = 44;    { Macintosh IIvi }gestaltMacIIvm         = 45;    { Macintosh IIvm }gestaltPerforma600         = 45;    { Macintosh Performa 600 }gestaltMacIIvx         = 48;    { Macintosh IIvx }gestaltMacColorClassic    = 49;    { Macintosh Color Classic }gestaltPerforma250    = 49;    { Macintosh Performa 250 }gestaltPowerBook165c    = 50;    { Macintosh PowerBook 165c }gestaltMacCentris610    = 52;    { Macintosh Centris 610 }gestaltMacQuadra610    = 53;    { Macintosh Quadra 610 }gestaltPowerBook145    = 54;    { Macintosh PowerBook 145 &amp; 145b}gestaltMacLC520        = 56;    { Macintosh LC 520 }gestaltMacCentris660AV    = 60;    { Macintosh Centris 660AV }gestaltPerforma46x    = 62;    { Macintosh Performa 46x }gestaltPowerMac8100_80    = 65;    { Power Macintosh 8100/80 }gestaltPowerBook180c    = 71;    { Macintosh PowerBook 180c }gestaltPowerBook520_540    = 72;    { Macintosh PowerBook 520/520c/540/540c }gestaltPowerMac6100_60    = 75;    { Power Macintosh 6100/60 }gestaltPowerBookDuo270c    = 77;    { Macintosh PowerBook Duo 270c }gestaltMacQuadra840AV    = 78;    { Macintosh Quadra 840AV }gestaltMacLC550        = 80;    { Macintosh LC 550 }gestaltPerforma550    = 80;    { Macintosh Performa 550 }gestaltPerforma560    = 80;    { Macintosh Performa 560 }gestaltPowerBook165    = 84;    { Macintosh PowerBook 165 }gestaltMacTV        = 88;    { Macintosh TV }gestaltMacLC475        = 89;    { Macintosh LC 475 }gestaltPerforma47x    = 89;    { Macintosh Performa 47x }gestaltMacLC575        = 92;    { Macintosh LC 575 }gestaltPerforma57x    = 92;    { Macintosh Performa 57x }gestaltMacQuadra605    = 94;    { Macintosh Quadra 605 }gestaltMacQuadra630    = 98;    { Macintosh Quadra 630 - see LC 630 }gestaltMacLC630        = 98;    { Macintosh LC 630 - see Quadra 630 }gestaltPerforma63x    = 98;    { Macintosh Performa 63x }gestaltPowerBookDuo280    = 102;    { Macintosh PowerBook Duo 280 }gestaltPowerBookDuo280c    = 103;    { Macintosh PowerBook Duo 280c }gestaltPowerMac7100_66    = 112;    { Power Macintosh 7100/66 }gestaltPowerBook150    = 115;    { Macintosh PowerBook 150 }gestaltPowerMacQuadra700    = 116;    { Quadra 700 &amp; Power PC Upgrade Card }gestaltPowerMacQuadra900    = 117;    { Quadra 900 &amp; Power PC Upgrade Card }gestaltPowerMacQuadra950    = 118;    { Quadra 950 &amp; Power PC Upgrade Card }gestaltPowerMacCentris610    = 119;    { Centris 610 &amp; Power PC Upgrade Card }gestaltPowerMacCentris650    = 120;    { Centris 650 &amp; Power PC Upgrade Card }gestaltPowerMacQuadra610    = 121;    { Quadra 610 &amp; Power PC Upgrade Card }gestaltPowerMacQuadra650    = 122;    { Quadra 650 &amp; Power PC Upgrade Card }gestaltPowerMacQuadra800    = 123;    { Quadra 800 &amp; Power PC Upgrade Card }{ new gestaltKeyboardType response values including those for the PowerBook models }gestaltPwrBookADBKbd    = 12;    { PowerBook Keyboard }gestaltPwrBookISOADBKbd    = 13;    { PowerBook Keyboard (ISO) }gestaltAppleAdjustKeypad    = 14;    { Apple Adjustable Keypad }gestaltAppleAdjustADBKbd    = 15;    { Apple Adjustable Keyboard }        { includes US, ISO, and Japanese }</pre>	</TD></TR></TABLE></CENTER><a name="Section4"></a> <P><A HREF="#top">Back to top</A></P><h2>gestaltHardwareAttr Selector</h2><p>The <code>gestaltHardwareAttr</code> selector has been a source of confusion fordevelopers since originally documented in <i>Inside Macintosh </i>Volume V.This section will try to reduce that confusion and also introduce additionalinformation returned by the selector. But be warned that use of this selectorfor anything other than informational purposes should be deemed a compatibilityrisk. In other words, if you are dependent on the information returned by thisselector to function on existing computers, you will almost certainly haveproblems on future systems.</p><p>The reason for this is that <code>gestaltHardwareAttr</code> returns very low-levelhardware information. If you need to use this information, it implies that youare too hardware dependent. So be very careful about using this information.</p><p>The principal source of confusion is bit 7, described as <code>gestaltHasSCSI</code>. What this bit really means is the machine is equipped with SCSI based on the 53C80 chip, which was introduced in the Macintosh Plus. This bit will be zero on the Macintosh IIfx and the Macintosh Quadra computers because they have a different low-level SCSI implementation. The Macintosh IIfx has a 53C80 compatible chip that also supports SCSI DMA. It reports this information using bit 6 of the <code>gestaltHardwareAttr</code> response. The Macintosh Quadra computers have yet another SCSI implementation based on the 53C96 chip and so report different information (see below).</p><p>Another source of confusion is bit 4 (<code>gestaltHasSCC</code>). The MacintoshIIfx and Macintosh Quadra 900 have intelligent I/O processors (IOPs) that normally isolate the hardware and make direct access to the SCC impossible. Normally, these machines will report that they do not have an SCC, implying, correctly, that were you to attempt to access it directly, you would fail. However, if the user has used the Compatibility Switch control panel to enable compatibility mode, <code>gestaltHasSCC</code> will report true, indicating that you may access the SCC directly. But remember that doing so means you are doing direct hardware access and that there may be a day when you can't access the SCC under any circumstances.</p><p>One other source of confusion is bit 3 (<code>gestaltHasASC</code>). This flag wasoriginally created to determine if the machine has the Apple Sound Chip, which was built into the Macintosh II. In the future, there will be new sound hardware that will not necessarily be the Apple Sound Chip. The question then arises whether this flag should be set when the new sound hardware is not an Apple Sound Chip. For example, if Apple were to build a Macintosh with a DSP chip instead of the Apple Sound Chip, should the <code>gestaltHasASC</code> flag be set?</p><p>Some Developers have been assuming that the <code>gestaltHasASC</code> flagdetermines if <code>SndStartFilePlay</code> or <code>SndPlayDoubleBuffer</code> are supported. This is abad assumption. Currently these two Sound Manager functions are supported onlyon Macintosh computers that have the Apple Sound Chip, but this will change. AMacintosh Classic does not have the Apple Sound Chip but may support these twoSound Manager Functions. Additionally, the imaginary Macintosh of the future(containing a DSP) may or may not have the <code>gestaltHasASC</code> flag set, but will certainly have the ability to support SndStartFilePlay orSndPlayDoubleBuffer.</p><h3>New <code>gestaltHardwareAttr</code> Values for Macintosh Quadra Computers</h3><p>Below are the new bits supported by the Macintosh Quadra computers. Any other bitsremain undocumented and subject to change.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>gestaltHasSCSI961    = 21;{ 53C96 SCSI controller on internal bus }gestaltHasSCSI962    = 22;{ 53C96 SCSI controller on external bus }</pre>	</TD></TR></TABLE></CENTER><h3>A Better Method to Detect (Adjustable) Keyboard Type</h3><p>As documented in <i>Inside</i> <i>Macintosh</i> Volume VI, Gestalt simplyidentifies the last keyboard that was typed on.  Confusion can arise when theApple Adjustable Keyboard is attached.  Gestalt can return the identifier foreither the keypad or the keyboard, depending on which device was most recentlyused.  As such, Gestalt is useful for determining which keyboard a given eventcame from, but may not identify all of the keyboards that are attached.  Thesame problem would occur if one were to attach multiple keyboards of differenttypes to any Macintosh and restart the system.</p><p>For Adjustable Keyboards there are some additional concerns - <code>Gestalt</code> returnsthe same value for all three variants of the Adjustable keyboard - US standard,International (ISO), and Japanese.  For all three types of keyboards theresponse is 0x0F.  There is also a known problem with some early releases ofSystem Software such that using <code>Gestalt</code> to identify an adjustable keyboardfailed with error -5550.  For these reasons, an alternate method foridentifying keyboard devices is provided below.</p><p>To obtain information on all keyboards attached to the machine, you can ask theADB (Apple Desktop Bus) directly.  The basic algorithm would is to:</p><UL><li>Call <code>CountADBs</code> to determine the number of ADB devices that are attached.</li><li>For each device, <code>GetIndADB</code> and check the <code>origADBAddr</code> fieldto determine whether it is a keyboard device (<code>origADBAddr</code> == 0x02).</li><li>For keyboard devices, the <code>devType</code> field is the keyboard devicetype.  Refer to <i>Inside</i> <i>Macintosh</i> Volume V for more specifics onthese two calls.</li></ul><p>Note that the <code>devType</code> field response do not exactly equate to thosereturned by <code>Gestalt</code>.  The following list shows the gestalt responses and the<code>devType</code> field responses.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>GestaltName            Gestalt response    devTypegestaltMacKbd            1            0x03gestaltMacAndPad        2            0x13gestaltMacPlusKbd        3            0x0BgestaltExtADBKbd        4            0x02gestaltStdADBKbd        5            0x01gestaltPrtblADBKbd        6            0x06gestaltPrtblISOKbd        7            0x07gestaltStdISOADBKbd        8            0x04gestaltExtISOADBKbd        9            0x05gestaltADBKbdII            10            0x08gestaltADBISOKbdII        11            0x09gestaltPwrBookADBKbd        12            0x0CgestaltPwrBookISOADBKbd        13            0x0DgestaltAppleAdjustKeypad    14,            0x0EgestaltAppleAdjustADBKbd    15,            0x10gestaltAppleAdjustADBISOKbd    15,            0x11gestaltAppleAdjustJapanADBKbd    15,        0x12</pre>	</TD></TR></TABLE></CENTER><h3>Non-existent Gestalt Selector - 'icon'</h3><p><i>Inside Macintosh - More Macintosh Toolbox</i> volume, page 5-7, specifies thatthe <code>gestaltIconUtilitiesAttr - 'icon'</code> gestalt selector can be used to determine whether the icon utilities are present under System 7.x.   Note that this selector is included in the <code>GestaltEqu</code> files.  It turns out that this selector is not implemented until System Software v7.1.2.  To check for the existence of these utilities, use the <code>TrapAvailable</code> code to check for the <code>_IconDispatch</code> (0xABC9) trap.  The TrapAvailable code is presented in <i>Inside Macintosh</i> VI 3-8, and as sample code in many of the snippets on the Developer CD.</p><a name="Section5"></a> <P><A HREF="#top">Back to top</A></P><h2>SysEnvirons</h2><p><code>_SysEnvirons</CODE> was the standard way to determine the features available on agiven machine. The preferred method to get this information is now <code>_Gestalt</CODE>;information on <code>_SysEnvirons</CODE> is now provided only for backward compatibility.</p><p>As originally conceived, <code>_SysEnvirons</CODE> would check the versionRequestedparameter to determine what level of information you were prepared to handle,but this technique means updating <code>_SysEnvirons</CODE> for every new hardware productApple produces. With system software version 6.0, <code>_SysEnvirons</CODE> introducedversion 2 of environsVersion to provide information about new hardware as weintroduce it; this new version returns the same SysEnvRec as version 1.</p><p>Beginning with system software version 6.0.1, Apple releases a new version of<code>_SysEnvirons</CODE> only when engineering makes changes to its structure (that is,when they add new fields to SysEnvRec); all existing versions return accurateinformation about the machine environment even if part of that information wasnot originally defined for the version you request. For example, if you call<code>_SysEnvirons</CODE> with versionRequested = 1 on a Macintosh IIfx, it returns amachineType of envMacIIfx even though this machine type originally was notdefined for version 1 of the call.</p><p>You should use version 2 of <code>_SysEnvirons</CODE> until Apple releases a newer version.MPW 3.0 defines a constant curSysEnvVers, which can be used to minimize theneed for source code revisions when <code>_SysEnvirons</CODE> evolves. Regardless of theversion used, however, your software should be prepared to handle unexpectedvalues and should not make assumptions about functionality based on currentexpectations. For example, if your software currently requires a Macintosh II,testing for machineType &gt;= envMacII may result in your software trying torun on a machine that does not support the features it requires, so test forspecific functionality (that is, hasFPU, hasColorQD, and so on).</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>This test for specific functionality is particularly true ofFPUs (floating-point units). Some CPUs, such as the Macintosh IIsi, may haveoptional, user-installed FPUs; therefore, an application should not assume thatany Macintosh with a microprocessor greater than a 68000 (for example, 68020,68030, or 68040) has an FPU (68881/68882 or built-in for the 68040). If anapplication makes a conditional branch to execute floating-point instructions directly, then it should first explicitly check for the presence of the FPU.</P></TD></TR></TABLE></CENTER><BR><p>You should always check the environsVersion when returning from <code>_SysEnvirons</CODE>since the glue always returns as much information as possible, withenvironsVersion indicating the highest version available, even if the callreturns an envSelTooBig (-5502) error.</p><a name="Section6"></a> <P><A HREF="#top">Back to top</A></P><h2>Calling _SysEnvirons From a High-Level Language</h2><p>Due to a documentation error in <i>Inside Macintosh</i> Volume V, DSC stillreceives questions about how to call <code>_SysEnvirons</CODE> properly from Pascal and C.<i>Inside Macintosh</i> defines the Pascal interface to <code>_SysEnvirons</CODE> as follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION SysEnvirons (versRequested: INTEGER; VAR theWorld: SysEnvRecPtr) : OSErr;</pre>	</TD></TR></TABLE></CENTER><p>Because <code>theWorld</code> is passed by reference (as a VAR parameter), it is not correctto pass a <code>SysEnvRecPtr</code> in the second argument. Pascal would then generate a pointer to this pointer and pass that to the <code>_SysEnvirons</CODE> trap in A0. (The assembly-language information is essentially correct; <code>_SysEnvirons</CODE> really does want a pointer to a SysEnvRec in A0.) The correct Pascal interface to <code>_SysEnvirons</CODE> is therefore:</p><p>In this case, Pascal pushes a pointer to <code>theWorld</code> on the stack. The Pascalinterface glue then pops this pointer off the stack directly into A0 and calls<code>_SysEnvirons</CODE>. Everything is copacetic.</p><p>C programmers should recognize their corresponding interface:</p><p><i>Inside Macintosh</i> defines the type <code>SysEnvPtr</code> = <code>^SysEnvRec</code>. It also sometimes refers to this type as <code>SysEnvRecPtr</code>. The inconsistency is insignificant because in reality MPW does not define any such type, under either name; therefore, it is never needed.</p><p><i>Inside Macintosh</i> also states that "all of the Toolbox Managers must beinitialized before calling SysEnvirons." This statement is not necessarily true. Startup documents (INITs), for instance, may wish to call <code>_SysEnvirons</CODE> without initializing any of the Toolbox Managers. Keep in mind that the <code>atDrvrVersNum</code> field returns a zero result if the AppleTalk drivers are not initialized. The system version, machine type, processor type, and other key data return normally.</p><a name="Section7"></a> <P><A HREF="#top">Back to top</A></P><h2>Additional _SysEnvirons Constants</h2><p>The following are new <code>_SysEnvirons</code> constants that are not documentedin <i>Inside Macintosh</i>; however, you should refer to <i>Inside Macintosh </i>Volume V, Chapter 1, Compatibility Guidelines, for the rest of the story. The machine type <code>_SysEnvirons</code> constants for the various Macintosh models are two lessthan those for the 'mach' <code>Gestalt</code> selector listed above. The previous list of machine type constants for  <code>_SysEnvirons</code> has been removed to simplify the update of this Technote.</p><h3>processor</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>env68030        = 4;    { MC68030 processor }env68040        = 5;    { MC68040 processor }</pre>	</TD></TR></TABLE></CENTER><h3>keyBoardType</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>envPrtblADBKbd        = 6;    { Portable Keyboard }envPrtblISOKbd        = 7;    { Portable Keyboard (ISO) }envStdISOADBKbd        = 8;    { Apple Standard Keyboard (ISO) }envExtISOADBKbd        = 9;    { Apple Extended Keyboard (ISO) }envADBKbdII        = 10;    { Apple Keyboard II }envADBISOKbdII        = 11;    { Apple Keyboard II (ISO) }envPwrBkADBKbd        = 12;    { PowerBook Keyboard }envPwrBkISOKbd        = 13;    { PowerBook Keyboard (ISO) }envAppleAdjustKeypad    = 14;    { Apple Adjustable Keypad }envAppleAdjustADBKbd    = 15;    { Apple Adjustable Keyboard }        { includes US, ISO, and Japanese }</pre>	</TD></TR></TABLE></CENTER><a name="References"></a> <P><A HREF="#top">Back to top</A></P><h2>References</h2><p><i>Inside Macintosh</i>, Volumes V and VI, Compatibility Guidelines</p><P>&nbsp;<A NAME=Changes></A></P>                   <P><A HREF="#top">Back to top</A></P><h2>Change History</H2>                  <P>Add this section if there are changes. If you're writing         a new technote, then you can remove this section.</P>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-September-1994</P>               </TD>               <td align="left">                  <P>Added information on the <code>gestaltMachineType</code>selector for the Power PC Upgrade card installed on the various Quadra andCentris systems.  Added the selectors for the known Performa models.  Removedthe machine type <code>SysEnvirons</code> list.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-April-1994</P>               </TD>               <td align="left">                  <P>Added information on the <code>gestaltMachineType</code>selector for the new Power Macintosh's, for the PowerBook Duo 280 and 280c, for the Quadra 630, for the PowerBook 150, and for the PowerBook 520, the 520c, the 540, and the 540c. Added note that the all of the PowerBook 520/540 computers are identified using the same gestalt ID.Added note that the <code>gestaltIconUtilitiesAttr</code> Gestalt selector described in <i>Inside Macintosh - More Macintosh Toolbox</i> volume 5-7 is not actually implemented. Corrected information on the identification of the Adjustable Keyboards.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1993</P>               </TD>               <td align="left">                  <P>Added information on the <code>gestaltMachineType</code>selector for the Macintosh Quadra 605, 610, 650, and 840AV, Macintosh Centris660AV, Macintosh PowerBook 145b, 165, and 180c, Macintosh Duo 250, and 270c,Macintosh TV, and Macintosh LC 475, 550 and 575.  Added new selectors for theadjustable keyboards plus a discussion on how to identify keyboards.</P>               </TD>            </TR>                        <TR>               <td width=100 align=left>                  <P ALIGN=center>01-May-1997</P>               </TD>               <td align="left">                  <P>Added information on the <code>gestaltMachineType</code>selector for the Macintosh Color Classic, Macintosh LC III, Macintosh PowerBook165c, Macintosh Centris 610 and 650, and Macintosh Quadra 800.</P>               </TD>            </TR>            </table>             <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (68K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ov_16.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ov/ov_16.html%3Fid%3DDTS10002614-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ov/ov_16.html%3Fid%3DDTS10002614-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ov/ov_16.html%3Fid%3DDTS10002614-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></html>