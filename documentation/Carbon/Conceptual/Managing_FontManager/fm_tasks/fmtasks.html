<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Managing Fonts: QuickDraw (Not Recommended): Managing Fonts: QuickDraw Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Managing Fonts: QuickDraw Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000222" title="Managing Fonts: QuickDraw Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../fm_intro/fmintro.html#//apple_ref/doc/uid/TP30000219-DontLinkElementID_83">Managing Fonts: QuickDraw (Not Recommended)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../fm_concepts/fmconcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../fm_revhistory/fmdocrevhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
QuickDraw is deprecated in Mac OS X version 10.5 and later. Use Core Text instead for Mac OS X v10.5 and later, as described in <em><a href="../../CoreText_Programming/index.html#//apple_ref/doc/uid/TP40005533" target="_top">Core Text Programming Guide</a></em>. For applications that must run on Mac OS X v10.4 and earlier, use Apple Type Services (ATS), as described in <em><a href="../../ATS_Concepts/index.html#//apple_ref/doc/uid/TP30000981" target="_top">Apple Type Services for Fonts Programming Guide</a></em>.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_86" title="Managing Fonts: QuickDraw Tasks"></a><h1><a name="//apple_ref/doc/uid/TP30000982-TP30000222-TPXREF101" title="Managing Fonts: QuickDraw Tasks"></a>Managing Fonts: QuickDraw Tasks</h1><p>This chapter provides instructions and code samples for the most common tasks you can accomplish with the Font Manager such as enumerating fonts, getting font display information, and handling the standard Font menu. It also provides information on making existing applications Carbon-compliant. </p><p>Several sections show examples of code that is no longer supported under Carbon and equivalent implementations that use Carbon-compliant font access and data management functions. In particular, see <span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BCIJEDDA">“Enumerating Font Families and Fonts”</a></span> and <span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BAJHCHDH">“Handling the Standard Font Menu.”</a></span></p><p>The code samples assume you are developing your application in Mac OS using CarbonLib. All code samples are in C.</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCCCGEI">“Initializing the Font Manager”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCHFHGD">“Accessing Font Data”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BCIJEDDA">“Enumerating Font Families and Fonts”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BCICBBDG">“Converting Between Font and Font Family Data”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BAJHCHDH">“Handling the Standard Font Menu”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCIDEIE">“Adding Font Sizes to the Menu”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCIJGDE">“Activating and Deactivating Fonts”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCIHHCJ">“Storing a Font Name in a Document”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCDIJJD">“Getting Font Measurement Information”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCHGHGB">“Favoring Outline or Bitmapped Fonts”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCFDIIE">“Preserving the Shapes of Glyphs”</a></span></p></li><li class="li"><p><span class="content_text"><a href="fmtasks.html#//apple_ref/doc/uid/TP30000982-TP30000222-BBCJCHBB">“Using Fractional Glyph Widths and Font Scaling”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCCCGEI" title="Initializing the Font Manager "></a><h2>Initializing the Font Manager </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_264"></a><p>You do not need to initialize the Font Manager in Carbon. As a result, the function <code><!--a-->InitFonts<!--/a--></code> is not supported in Carbon.</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCHFHGD" title="Accessing Font Data"></a><h2>Accessing Font Data</h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_265"></a><p>You should no longer use the Resource Manager routines to access the contents of the data stored in the font <strong>suitcase files</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_266"></a> of standard Mac OS resource fork–based fonts, including <code>'FOND'</code>, <code>'FONT'</code>, <code>'NFNT'</code>, <code>'sfnt'</code>, and <code>'typ1'</code> resources. </p><p>To access other font resource data, you should use the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontContainer" target="_top">FMGetFontContainer</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_267"></a>. This function gets the location of the file that contains the data. You then pass the file reference or specification to the Resource Manager or File Manager to obtain the information you need. You should not assume that the <strong>resource identifier</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_268"></a> of a font family resource determines the QuickDraw identifier of the font family obtained with <code><a href="../../../Reference/Resource_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetResInfo" target="_top">GetResInfo</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_269"></a>.</p><p>To access the individual <code>'sfnt'</code> tables that you need, you should use the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontTable" target="_top">FMGetFontTable</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_270"></a>. This function gets the requested table and copies it into a caller-provided buffer. You may want to first use the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontTableDirectory" target="_top">FMGetFontTableDirectory</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_271"></a> to get the <code>'sfnt'</code> directory and parse it to determine which tables are available.</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIJEDDA" title="Enumerating Font Families and Fonts"></a><h2>Enumerating Font Families and Fonts</h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_272"></a><p>There are two categories of iterators available to you: font family iterators and font iterators<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_273"></a>. A font family iterator enumerates fonts that are associated with a font family. When you enumerate font families, you also use a font family instance iterator to access all instances of a particular font family. </p><p>A font iterator enumerates outline fonts without regard to family. You must use a font iterator to enumerate fonts that are not associated with a font family, such as a data–fork font in Mac OS 9. In Mac OS X, every font is a member of at least one font family.</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-TPXREF102" title="Platform Considerations"></a><h3>Platform Considerations</h3><p>In theory, you can use Font Manager<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_274"></a> iterators to enumerate all fonts available on the system. In practice, there are a number of issues you need to consider when enumerating fonts and font families. </p><p>You cannot use a font iterator to enumerate the bitmapped <code>'FONT'</code>/<code>'NFNT'</code> font resources traditionally used with QuickDraw-based applications. Instead, you must use a font family instance iterator followed by a font family iterator to obtain each of the outline and bitmapped font resources that comprise the font family. If the font family instance iterator returns an invalid font object, then you can assume the particular style and size for the font family reference is a bitmapped font.</p><p>In Mac OS X, the font family iterator and font family instance iterator have been extended to support non–resource–based fonts, such as the Windows TrueType (<code>'.ttf'</code>/<code>'.ttc'</code>) and OpenType PostScript (<code>'.otf'</code>) fonts. Note that in Mac OS 9, you can still gain access to these fonts through a standard font iterator or font object data access function of the Font Manager.</p><p>In Mac OS 9 (with or without CarbonLib) data-fork fonts do not belong to any family and the operating system does not synthesize a font family reference, so you cannot enumerate these fonts with a font family iterator. </p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-TPXREF103" title="Enumerating Font Family Data"></a><h3>Enumerating Font Family Data</h3><p>To enumerate font family data, do the following:</p><ul class="spaceabove"><li class="li"><p>Set up a filter if you want to restrict iteration to specific criteria. This is optional.</p></li><li class="li"><p>Create iterators. To access both the font family and individual font data, you need to create a font family iterator and a font instance iterator. </p></li><li class="li"><p>Get font and font family information.</p></li><li class="li"><p>Dispose of the iterators.</p></li></ul><p><span class="content_text">Listing 3-1</span> shows a function <code><!--a-->MyGetFontInformation<!--/a--></code> that iterates through the fonts registered with the system. Your application would need to add code that does something with the font information it retrieves. Error-handling code has been omitted to make the sample function more readable. Following this listing is a detailed explanation for each line of code that has a numbered comment.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_275"></a></p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_87" title="Listing 2-1Getting font family and font instance information"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIIJHCA" title="Listing 2-1Getting font family and font instance information"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Getting font family and font instance information</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_276"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_277"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_278"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_279"></a><div class="codesample"><table><tr><td scope="row"><pre>void MyGetFontInformation (WindowRef window, FMGeneration myGeneration)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFontFamilyIterator                   myFontFamilyIterator;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFontFamily                           myFontFamily;<span></span></pre></td></tr><tr><td scope="row"><pre>     OSStatus                               status1 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>     OSStatus                               status2 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFontFamilyInstanceIterator           myInstanceIterator;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFont                                 myFont;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFontStyle                            myStyle;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFontSize                             mySize;<span></span></pre></td></tr><tr><td scope="row"><pre>     Str255                                 myFontString;<span></span></pre></td></tr><tr><td scope="row"><pre>     FMFilter                               myFilter;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     myFilter.format = kFMCurrentFilterFormat;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>     myFilter.selector = kFMGenerationFilterSelector;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>     myFilter.filter.generationFilter = myGeneration;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    FMCreateFontFamilyIterator (&amp;myFilter, NULL, kFMGlobalIterationScope,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontFamilyIterator);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    while (status1 == 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        status1 = FMGetNextFontFamily (&amp;myFontFamilyIterator,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myFontFamily);<span></span></pre></td></tr><tr><td scope="row"><pre>        // Your code here.<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        FMCreateFontFamilyInstanceIterator (myFontFamily,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        &amp;myInstanceIterator);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        while (status2 == 0)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                status2 = FMGetNextFontFamilyInstance (&amp;myInstanceIterator,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;myFont, &amp;myStyle, &amp;mySize);<span></span></pre></td></tr><tr><td scope="row"><pre>                // Your code here.<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        status2 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>        FMDisposeFontFamilyInstanceIterator (&amp;myInstanceIterator);  <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    FMDisposeFontFamilyIterator (&amp;myFontFamilyIterator);  <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_280"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_281"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_282"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_283"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_284"></a>code does:</p><ol class="ol"><li class="li"><p>Sets filter options. You can use filter options to restrict the iteration to specified criteria. If you don’t want to restrict iteration, you don’t need to set filter options. Pass <code>NULL</code> instead. The current filter format is the only one you can specify right now.</p></li><li class="li"><p>Specifies to use a generation filter.</p></li><li class="li"><p>Restricts iteration to fonts of a specified generation.</p></li><li class="li"><p>Creates a font family iterator. The global scope options specifies to iterate through all fonts registered with the system. Use <code>kFMLocalIterationScope</code> to restrict the iteration only to the fonts accessible to your application.</p></li><li class="li"><p>Insert code that does something with the font family information. For example, you can get the string associated with the font family by calling the function <code>FMGetFontFamilyName<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_285"></a> (myFontFamily, myFontString);</code></p></li><li class="li"><p>Creates a font family instance iterator.</p></li><li class="li"><p>Insert code that does something with the font family instance information.</p></li><li class="li"><p>Disposes of the contents of the iterator before creating another the next time through the loop.</p></li><li class="li"><p>Disposes of the font family iterator.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_286"></a></p></li></ol><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCEAGGJ" title="Enumerating Font Data"></a><h3>Enumerating Font Data</h3><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_287"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_288"></a><p>If you want to enumerate outline fonts without regard to family, you can use a font iterator. <span class="content_text">Listing 3-2</span> shows a <code><!--a-->MyGetFontObjects<!--/a--></code> function that iterates through fonts accessible to your application, and gets font format information for each font. Error-handling code has been omitted to make the sample function more readable. Following this listing is a detailed explanation for each line of code that has a numbered comment.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_289"></a></p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_88" title="Listing 2-2Getting information about a font"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIGGAGJ" title="Listing 2-2Getting information about a font"></a><strong>Listing 2-2&nbsp;&nbsp;</strong>Getting information about a font</p><div class="codesample"><table><tr><td scope="row"><pre>void MyGetFontObjects()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    FMFontIterator                  myFontIterator;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                        status = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    FMFont                          myFont;<span></span></pre></td></tr><tr><td scope="row"><pre>    FourCharCode                    myFormat;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = FMCreateFontIterator (NULL, NULL, kFMLocalIterationScope,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;myFontIterator);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    while (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        status = FMGetNextFont (&amp;myFontIterator, &amp;myFont);<span></span></pre></td></tr><tr><td scope="row"><pre>        status = FMGetFontFormat (myFont, &amp;myFormat);   <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    status = FMDisposeFontIterator (&amp;myFontIterator);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_290"></a> does:</p><ol class="ol"><li class="li"><p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_291"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_292"></a>Creates a font iterator. The first parameter is <code>NULL</code> because we are not filtering font information. The second parameter is <code>NULL</code> because we are not using a custom filer function. The constant <code>kFMLocalIterationScope</code> specifies to apply the iterator only to those fonts accessible to your application. Pass an uninitialized font iterator.</p></li><li class="li"><p>Gets the font format. <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_293"></a>This is one possible thing you could so with the font information. You could replace this line with code that does something else with the font information.</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_294"></a>Disposes of the contents of the font iterator<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_295"></a>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000982-TP30000222-TPXREF104" title="Rewriting Resource-Based Code "></a><h3>Rewriting Resource-Based Code </h3><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_296"></a><p>The following source code is an example of how to rewrite a standard QuickDraw enumeration of font families and fonts using the new Font Manger<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_297"></a> functions. <span class="content_text">Listing 3-3</span> is the old resource-based code and <span class="content_text">Listing 3-4</span> is the equivalent implementation using the new font access and data management functions. You can compare the old and new code samples to see how you can make your already-existing applications Carbon-compliant. Following each listing is a detailed explanation for each line of code that has a numbered comment.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_298"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_299"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_300"></a></p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_89" title="Listing 2-3Enumerating font families and fonts using resource-based functions"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCFCHIH" title="Listing 2-3Enumerating font families and fonts using resource-based functions"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Enumerating font families and fonts using resource-based functions</p><div class="codesample"><table><tr><td scope="row"><pre>SInt16  index;<span></span></pre></td></tr><tr><td scope="row"><pre>short   savedResFile;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>savedResFile = CurResFile();<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>index = CountResources (kFONDResourceType);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while (index > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        Handle              fontRecHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>        Handle              outlineFontHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>        AsscEntry           entry;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        fontRecHandle = (FontRecHdl) GetIndResource('FOND', index);<span></span></pre></td></tr><tr><td scope="row"><pre>        while (fontRecHandle)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                GetResInfo ((Handle) fontRecHandle, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                             NULL, rsrcName);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                count = ((FontAssoc*)(*fontRecHandle +<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof (FamRec)))->numAssoc + 1;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                entry = (AsscEntry*)(*fontRecHandle + sizeof(FamRec) +<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof(FamRec) + sizeof(FontAssoc));<span></span></pre></td></tr><tr><td scope="row"><pre>                while ( count-- > 0 )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                    if (entry->fontSize == 0)<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            UseResFile (HomeResFile((Handle)<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    fontRecHandle));<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                            fontHandle = Get1Resource('sfnt',<span></span></pre></td></tr><tr><td scope="row"><pre>                                                entry->fontID);<span></span></pre></td></tr><tr><td scope="row"><pre>                            if (fontHandle != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>                                        ...<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    entry++;<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                fontRecHandle = (FontFamilyRecordHdl)<span></span></pre></td></tr><tr><td scope="row"><pre>                                    GetNextFOND((Handle) fontRecHandle);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        index--;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>UseResFile (savedResFile);<span>// 8</span></pre></td></tr></table></div><p>Here’s what <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_301"></a>the code does<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_302"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_303"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_304"></a>:</p><ol class="ol"><li class="li"><p>Calls the Resource Manager function <code><a href="../../../Reference/Resource_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CurResFile" target="_top">CurResFile</a></code> to get the file reference number of the current resource file. You need to save the file reference number so you can restore it later.</p></li><li class="li"><p>Calls the Resource Manager function <code><a href="../../../Reference/Resource_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CountResources" target="_top">CountResources</a></code> to obtain the number of font families. This is the number of iterations you need to do.</p></li><li class="li"><p>Calls the Resource Manager function <code><a href="../../../Reference/Resource_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetResInfo" target="_top">GetResInfo</a></code> to get the font family identifier.</p></li><li class="li"><p>Gets the values needed to walk through the font association table.</p></li><li class="li"><p>Checks for an outline font. A font size of 0 represents an outline font.</p></li><li class="li"><p>Gets the resource ID. An <code>'sfnt'</code> resource ID is unique only within the font file. </p></li><li class="li"><p>Increments <code>entry</code> so we can get the next entry of the font association table.</p></li><li class="li"><p>Calls the Resource Manager function <code><a href="../../../Reference/Resource_Manager/Reference/reference.html#//apple_ref/doc/c_ref/UseResFile" target="_top">UseResFile</a></code> to restore the original resource file.</p></li></ol><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_90" title="Listing 2-4Enumerating font families and fonts using Carbon-compliant functions"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCGADAA" title="Listing 2-4Enumerating font families and fonts using Carbon-compliant functions"></a><strong>Listing 2-4&nbsp;&nbsp;</strong>Enumerating font families and fonts using Carbon-compliant functions</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_305"></a><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>FMFontFamilyIterator            fontFamilyIterator;<span></span></pre></td></tr><tr><td scope="row"><pre>FMFontFamilyInstanceIterator    fontFamilyInstanceIterator;<span></span></pre></td></tr><tr><td scope="row"><pre>FMFontFamily                    fontFamily;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = FMCreateFontFamilyInstanceIterator (0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;fontFamilyInstanceIterator);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>status = FMCreateFontFamilyIterator (NULL, NULL, kFMLocalIterationScope,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        &amp;fontFamilyIterator);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while ( (status = FMGetNextFontFamily (&amp;fontFamilyIterator, &amp;fontFamily))<span></span></pre></td></tr><tr><td scope="row"><pre>                                        == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        FMFont                          font;<span></span></pre></td></tr><tr><td scope="row"><pre>        FMFontStyle                     fontStyle;<span></span></pre></td></tr><tr><td scope="row"><pre>        FMFontSize                      fontSize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        status = FMResetFontFamilyInstanceIterator (fontFamily,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;fontFamilyInstanceIterator);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        while ( (status =<span></span></pre></td></tr><tr><td scope="row"><pre>                FMGetNextFontFamilyInstance(<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;fontFamilyInstanceIterator, &amp;font,<span></span></pre></td></tr><tr><td scope="row"><pre>                             &amp;fontStyle, &amp;fontSize)) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( fontSize == 0 )<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                    ...<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if (status != noErr &amp;&amp; status != kFMIterationCompleted) {<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>FMDisposeFontFamilyIterator (&amp;fontFamilyIterator);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>FMDisposeFontFamilyInstanceIterator (&amp;fontFamilyInstanceIterator);<span></span></pre></td></tr></table></div><p>Here’s what the<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_306"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_307"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_308"></a> code does<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_309"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_310"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_311"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_312"></a>:</p><ol class="ol"><li class="li"><p>Creates a dummy instance iterator to avoid creating and destroying it in the loop.</p></li><li class="li"><p>Creates an iterator to enumerate the font families.</p></li><li class="li"><p>Points the instance iterator to the current font family.</p></li><li class="li"><p>Checks for a font size of 0. A font size of 0 represents an outline font.</p></li><li class="li"><p>Checks to see if there is an error as a result of the iteration. You should add your error-handling code after the <code>if</code> statement.</p></li><li class="li"><p>Disposes of the iterators.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_313"></a></p></li></ol><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCICBBDG" title="Converting Between Font and Font Family Data"></a><h2>Converting Between Font and Font Family Data</h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_314"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_315"></a><p>A <strong>font reference</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_316"></a> is an index to a <strong>font object</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_317"></a>, which is a specific outline font without regard to font family. A <strong>font family instance</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_318"></a> is a reference to a font family paired with a QuickDraw style. At times it can be useful to find a font family of which a font object is a member, or to find the font that is associated with a font family and style. To accomplish these conversions, you can use the functions <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyInstanceFromFont" target="_top">FMGetFontFamilyInstanceFromFont</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_319"></a> and <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFromFontFamilyInstance" target="_top">FMGetFontFromFontFamilyInstance</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_320"></a>.</p><p>These functions are not inverses of each other, because a font object can be a member of more than one font family. This means if you call the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFromFontFamilyInstance" target="_top">FMGetFontFromFontFamilyInstance</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_321"></a> and then call the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyInstanceFromFont" target="_top">FMGetFontFamilyInstanceFromFont</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_322"></a>, you will not necessarily get the <strong>font family reference</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_323"></a> you supplied when you called <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFromFontFamilyInstance" target="_top">FMGetFontFromFontFamilyInstance</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_324"></a>.</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BAJHCHDH" title="Handling the Standard Font Menu"></a><h2>Handling the Standard Font Menu</h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_325"></a><p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_326"></a>The functions in the Resource Manager for creating a standard Font menu continue to work with CarbonLib and Mac OS X for resource–fork–based fonts, but you should use the new functions in the Menu Manager that support all font formats available through the new Carbon-compliant functions. <span class="content_text">Table 3-1</span> lists the functions you should use to replace the resource-based functions.</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_327"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_91" title="Table 2-1Replacements for resource-based functions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-TPXREF105" title="Table 2-1Replacements for resource-based functions"></a><strong>Table 2-1&nbsp;&nbsp;</strong>Replacements for resource-based functions</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Instead of</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use this</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Menu_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/AppendResMenu" target="_top">AppendResMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_328"></a></p></td><td ><p><code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_329"></a></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Menu_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/InsertFontResMenu" target="_top">InsertFontResMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_330"></a></p></td><td ><p><code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_331"></a></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Menu_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/InsertIntlResMenu" target="_top">InsertIntlResMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_332"></a></p></td><td ><p><code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_333"></a></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Menu_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetMenuItemText" target="_top">GetMenuItemText</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_334"></a> and <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetFNum" target="_top">GetFNum</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_335"></a></p></td><td ><p><code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetFontFamilyFromMenuSelection" target="_top">GetFontFamilyFromMenuSelection</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_336"></a></p></td></tr></table></div><p>The Menu Manager provides your application with a standard user interface for soliciting font choices from the user. To create a menu that displays font names, you should use the Menu Manager function <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code>. The <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code> function adds the names of all font objects in the font database as items in the Font menu. This ensures that any changes to the font database do not affect your application and that the display of items in the Font menu is not dependent on how fonts are stored in system software.</p><p>The Menu Manager function <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetFontFamilyFromMenuSelection" target="_top">GetFontFamilyFromMenuSelection</a></code> finds the font family reference and style from menu identifier and menu item number returned by the function <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/MenuSelect" target="_top">MenuSelect</a></code>. For more information on the functions <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateStandardFontMenu" target="_top">CreateStandardFontMenu</a></code>, <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/UpdateStandardFontMenu" target="_top">UpdateStandardFontMenu</a></code>, and <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetFontFamilyFromMenuSelection" target="_top">GetFontFamilyFromMenuSelection</a></code>, see the Menu Manager documentation.</p><p>The following source code is an example of how to rewrite a standard event handler for the Font menu using the Font Manager data structures <code>FMFontFamily</code> and <code>FMFontStyle</code>. <span class="content_text">Listing 3-5</span> is the resource -based code and <span class="content_text">Listing 3-6</span> is the equivalent implementation using the Font Manger data structures. <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_337"></a></p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_92" title="Listing 2-5A standard event handler for the Font menu using resource-based functions"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIDBIHF" title="Listing 2-5A standard event handler for the Font menu using resource-based functions"></a><strong>Listing 2-5&nbsp;&nbsp;</strong>A standard event handler for the Font menu using resource-based functions</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_338"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_339"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_340"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_341"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_342"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_343"></a><div class="codesample"><table><tr><td scope="row"><pre>MenuHandle      menu;<span></span></pre></td></tr><tr><td scope="row"><pre>SInt16          menuID;<span></span></pre></td></tr><tr><td scope="row"><pre>SInt16          menuItem;<span></span></pre></td></tr><tr><td scope="row"><pre>Str255          menuItemText;<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>menuResult = MenuSelect (theEvent->where);<span></span></pre></td></tr><tr><td scope="row"><pre>menuID = HiWord (menuResult);<span></span></pre></td></tr><tr><td scope="row"><pre>menuItem = LoWord (menuResult);<span></span></pre></td></tr><tr><td scope="row"><pre>if ( menuID == kFontMenuResID )<span></span></pre></td></tr><tr><td scope="row"><pre>   {<span></span></pre></td></tr><tr><td scope="row"><pre>        menu = GetMenuHandle (menuID);<span></span></pre></td></tr><tr><td scope="row"><pre>        GetMenuItemText (menu, menuItem, menuItemText);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( status == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                TextFont (GetFNum (menuItemText));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Compare the resource-based code sample in <span class="content_text">Listing 3-5</span> with the code sample in <span class="content_text">Listing 3-6</span> to see how to make an existing application Carbon-compliant.</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_93" title="Listing 2-6A standard event handler for the Font menu using Carbon-compliant functions"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIGGFFG" title="Listing 2-6A standard event handler for the Font menu using Carbon-compliant functions"></a><strong>Listing 2-6&nbsp;&nbsp;</strong>A standard event handler for the Font menu using Carbon-compliant functions</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_344"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_345"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_346"></a><div class="codesample"><table><tr><td scope="row"><pre>MenuRef         menu;<span></span></pre></td></tr><tr><td scope="row"><pre>MenuID          menuID;<span></span></pre></td></tr><tr><td scope="row"><pre>MenuItemIndex   menuItem;<span></span></pre></td></tr><tr><td scope="row"><pre>FMFontFamily    fontFamily;<span></span></pre></td></tr><tr><td scope="row"><pre>FMFontStyle     style;<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>menuResult = MenuSelect (theEvent->where);<span></span></pre></td></tr><tr><td scope="row"><pre>menuID = HiWord (menuResult);<span></span></pre></td></tr><tr><td scope="row"><pre>menuItem = LoWord (menuResult);<span></span></pre></td></tr><tr><td scope="row"><pre>if ( menuID == kFontMenuResID )<span></span></pre></td></tr><tr><td scope="row"><pre>   {<span></span></pre></td></tr><tr><td scope="row"><pre>        menu = GetMenuHandle (menuID);<span></span></pre></td></tr><tr><td scope="row"><pre>        status = GetFontFamilyFromMenuSelection (menu, menuItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;fontFamily, &amp;style);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( status == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                TextFont (fontFamily);<span></span></pre></td></tr><tr><td scope="row"><pre>                TextFace (style);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCIDEIE" title="Adding Font Sizes to the Menu "></a><h2>Adding Font Sizes to the Menu </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_347"></a><p>When you use the Menu Manager<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_348"></a> to add font sizes to a menu, make sure that you construct the menu so that it displays appropriate sizes for both bitmapped and outline fonts. Keep the following guidelines in mind:</p><ul class="ul"><li class="li"><p>Support all possible font sizes. The maximum point size on the QuickDraw coordinate plane is 32,767 points.</p></li><li class="li"><p>Provide a short list of the most useful font sizes. For the menu that your application uses to display font sizes, you shouldn't predefine a static list of sizes available to the user or allow the default to be every possible font size, because outline fonts can produce thousands of sizes. </p></li><li class="li"><p>Provide a method of increasing or decreasing the font size by one point at a time. You can add Larger and Smaller commands, which make choosing slightly different sizes for outline fonts easier for the user. Also, the user should be able to choose any possible point size at any time in a simple manner. </p></li><li class="li"><p>Place a check next to the current size.</p></li><li class="li"><p>Display available font sizes in outline style. You can determine which bitmapped fonts are available by using the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/RealFont" target="_top">RealFont</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_349"></a>. <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/RealFont" target="_top">RealFont</a></code> returns <code>TRUE</code> if the font is available in the requested point size and <code>FALSE</code> if it is not. For outline fonts, the <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/RealFont" target="_top">RealFont</a></code> function returns <code>TRUE</code> for almost any size. The font designer may set a lower limit to the point sizes at which an outline font looks acceptable. If the size requested is smaller than this lower limit, the <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/RealFont" target="_top">RealFont</a></code> function returns <code>FALSE</code>.</p></li></ul><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCIJGDE" title="Activating and Deactivating Fonts"></a><h2>Activating and Deactivating Fonts</h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_350"></a><p>You use the functions <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMActivateFonts" target="_top">FMActivateFonts</a></code> and <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMDeactivateFonts" target="_top">FMDeactivateFonts</a></code> to activate or deactivate fonts. Fonts are activated and deactivated in groups defined by their representation in the file system as font suitcase files or other font file formats supported by the Font Manager. In order to activate or deactivate fonts, they must be of a format supported by the Font Manager. </p><p>By activating and deactivating fonts, you can control which fonts are available to your users. In a publication environment, font control facilitates handling large sets of fonts. It can minimize font mismatch problems or assure users have access to special fonts needed for their work. </p><p><span class="content_text">Listing 3-7</span> shows how to activate and deactivate fonts that are in an application bundle. The code assumes the fonts you want to activate are located in the Resources folder in the application bundle. Following the listing is a detailed explanation for each line of code that has a numbered comment.</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_94" title="Listing 2-7Code to activate and deactivate fonts in an application bundle"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCBEJFE" title="Listing 2-7Code to activate and deactivate fonts in an application bundle"></a><strong>Listing 2-7&nbsp;&nbsp;</strong>Code to activate and deactivate fonts in an application bundle</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_351"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_352"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_353"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_354"></a><div class="codesample"><table><tr><td scope="row"><pre>CFBundleRef     myAppBundle = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>CFURLRef        myAppResourcesURL = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>FSRef           myResourceDirRef;<span></span></pre></td></tr><tr><td scope="row"><pre>FSSpec          myResourceDirSpec;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myAppBundle = CFBundleGetMainBundle (myAppBundle);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if (NULL != myAppBundle)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    myAppResourcesURL = CFBundleCopyResourcesDirectoryURL (myAppBundle);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    if (NULL != myAppResourcesURL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        (void) CFURLGetFSRef (myAppResourcesURL, &amp;myResourceDirRef);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        status = FSGetCatalogInfo (&amp;myResourceDirRef, kFSCatInfoNone, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    NULL, &amp;myResourceDirSpec, NULL);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        if ( noErr == status )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = FMActivateFonts (&amp;myResourceDirSpec, NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kFMLocalActivationContext);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// Your code here to obtain the FSSpec.<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>status = FMDeactivateFonts (&amp;myResourceDirSpec, NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        kFMDefaultOptions);<span>// 7</span></pre></td></tr></table></div><p>Here’s what the code<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_355"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_356"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_357"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_358"></a> does:</p><ol class="ol"><li class="li"><p>Calls the Core Foundation Bundle Services function <code><a href="../../../../CoreFoundation/Reference/CFBundleRef/Reference/reference.html#//apple_ref/doc/c_ref/CFBundleGetMainBundle" target="_top">CFBundleGetMainBundle</a></code> to obtain the reference for the application bundle.</p></li><li class="li"><p>Calls the Core Foundation Bundle Services function <code><!--a-->CFBundleCopyResroucesDirectoryURL<!--/a--></code> to get the URL of the Resources folder located in the application bundle. The fonts should be stored in this bundle. To activate fonts, you need a pointer to the file specification of the file that contains the font data you want to activate. The next few lines of code covert the URL to an <code>FSSpec</code>.</p></li><li class="li"><p>Calls the Core Foundation URL Services function <code><a href="../../../../CoreFoundation/Reference/CFURLRef/Reference/reference.html#//apple_ref/doc/c_ref/CFURLGetFSRef" target="_top">CFURLGetFSRef</a></code> to get the file system reference (<code>FSRef</code>) associated with the URL of the Resources folder. </p></li><li class="li"><p>Calls the File Manager function <code><a href="../../../Reference/File_Manager/Reference/reference.html#//apple_ref/doc/c_ref/FSGetCatalogInfo" target="_top">FSGetCatalogInfo</a></code> to get the <code>FSRef</code> associated with the <code>FSSpec</code>. </p></li><li class="li"><p>Calls the Font Manager function to activate the fonts in the local activation context. This provides the current application with access to the fonts, but other applications do not have access to them. If you want to activate fonts so they are available to other applications, use the constant <code>kFMGlobalActivationContext</code> instead of <code>kFMLocalActivationContext</code>.</p></li><li class="li"><p>Before you can deactivate fonts, you need to obtain the <code>FSSpec</code>. You can either follow the steps above to obtain the URL and convert it to an <code>FSSpec</code>, or you can write your code so that it caches the <code>FSSpec </code>or the URL of the Resources folder located in the application bundle.</p></li><li class="li"><p>Calls the Font Manager function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMDeactivateFonts" target="_top">FMDeactivateFonts</a></code> to deactivate the fonts. You should deactivate locally activated fonts when you no longer need them. If you’ve activated the fonts globally you may want to leave them active.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_359"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_360"></a></p></li></ol><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCIHHCJ" title="Storing a Font Name in a Document  "></a><h2>Storing a Font Name in a Document  </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_361"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_362"></a><p>When presenting a font to a user, you should always refer to a font by name rather than by font family reference. If you have stored the name of the font in the document, you can find its font family reference by calling the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyFromName" target="_top">FMGetFontFamilyFromName</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_363"></a>. However, if the font is not present in the system software when the user opens the document, the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyFromName" target="_top">FMGetFontFamilyFromName</a></code> returns <code>kFMInvalidFontFamilyErr<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_364"></a></code>. </p><p>Storing a font name is the most reliable method of finding a font, because the name does not change from one computer system to another. If you want to make sure that the version of the font is the same on different computer systems, you can use the FontSync function <code><!--a-->FNSFontReferenceMatch<!--/a--></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_365"></a> to compare the two fonts. See the FontSync documentation for more information.</p><p>If the font versions are different, you should offer users the option of substituting for the font temporarily (until they can find the proper version of the font) or permanently (with another font that is currently available).</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCDIJJD" title="Getting Font Measurement Information "></a><h2>Getting Font Measurement Information </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_366"></a><p>You sometimes need to get font measurement information for the current font in the current graphics port. The Font Manager provides two functions for this purpose: <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FontMetrics" target="_top">FontMetrics</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_367"></a> and <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/OutlineMetrics" target="_top">OutlineMetrics</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_368"></a>. In addition, you can get font measurement information by calling the QuickDraw function <code><a href="../../../Reference/QuickDraw_Text/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetFontInfo" target="_top">GetFontInfo</a></code>. You can use this information when arranging the glyphs of one font or several fonts on a line or to calculate adjustments needed when font size or style changes.</p><p>The function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FontMetrics" target="_top">FontMetrics</a></code> can be used on any kind of font, whether bitmapped or outline. It returns the ascent and descent measurements, the width of the largest glyph in the font, and the leading measurements. The <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FontMetrics" target="_top">FontMetrics</a></code> function returns these measurements in a font metrics structure, which allows fractional widths. (By contrast, the QuickDraw function <code><a href="../../../Reference/QuickDraw_Text/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetFontInfo" target="_top">GetFontInfo</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_369"></a> returns integer widths.) In addition to these four measurements, the font metrics structure includes a handle to the global width table, which in turn contains a handle to the font family resource for the current text font. </p><p><span class="content_text">Listing 3-8</span> shows a sample function <code><!--a-->MyGetFontMetrics<!--/a--></code>. The function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FontMetrics" target="_top">FontMetrics</a></code> checks font metrics for the font associated with the current graphics port. Following this listing is a detailed explanation for each line of code that has a numbered comment.</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_95" title="Listing 2-8Getting font metrics for the font in the current graphics port"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BAJJCFAJ" title="Listing 2-8Getting font metrics for the font in the current graphics port"></a><strong>Listing 2-8&nbsp;&nbsp;</strong>Getting font metrics for the font in the current graphics port</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_370"></a><div class="codesample"><table><tr><td scope="row"><pre>void MyGetFontMetrics ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  FMetricRecPtr     myFontMetrics;<span></span></pre></td></tr><tr><td scope="row"><pre>  Fixed             myAscentFixed;<span></span></pre></td></tr><tr><td scope="row"><pre>  Fixed             myDescentFixed;<span></span></pre></td></tr><tr><td scope="row"><pre>  Fixed             myLeadingFixed;<span></span></pre></td></tr><tr><td scope="row"><pre>  Fixed             myMaxWidthFixed;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  FontMetrics (&amp;myFontMetrics);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>  myAscentFixed   = myFontMetrics.ascent;<span></span></pre></td></tr><tr><td scope="row"><pre>  myDescentFixed  = myFontMetrics.descent;<span></span></pre></td></tr><tr><td scope="row"><pre>  myLeadingFixed  = myFontMetrics.leading;<span></span></pre></td></tr><tr><td scope="row"><pre>  myMaxWidthFixed = myFontMetrics.widMax;<span></span></pre></td></tr><tr><td scope="row"><pre> // Your code here.<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Gets the metrics for the font associated with the graphics port.</p></li><li class="li"><p>Insert you code here to do something with the metrics information.</p></li></ol><p>The function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/OutlineMetrics" target="_top">OutlineMetrics</a></code> returns measurements for glyphs to be displayed in an outline font. The function returns an error if the font in the current graphics port is any other kind of font. (You can call the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/IsOutline" target="_top">IsOutline</a></code> to find out whether the Font Manager would choose an outline font for the current graphics port.) These measurements include the <strong>maximum y-value</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_371"></a>, <strong>minimum y-value</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_372"></a>, <strong>advance width</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_373"></a>, <strong>left-side bearing</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_374"></a>, and <strong>bounding box</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_375"></a>.</p><p>For a font of a non-Roman script system that uses an associated font, the font measurements reflect combined values from the current font and the associated font. This is to accommodate the script system’s automatic display of Roman characters in the associated font instead of the current font. <a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_376"></a></p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCHGHGB" title="Favoring Outline or Bitmapped Fonts  "></a><h2>Favoring Outline or Bitmapped Fonts  </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_377"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_378"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_379"></a><p>When a document uses a font that is available as both an outline font and a bitmapped font, the Font Manager must choose which kind of font to use. Its default behavior is to use the bitmapped font when your application opens the document. This behavior avoids problems with documents that were created on a computer system on which outline fonts were not available. See <span class="content_text"><a href="../fm_concepts/fmconcepts.html#//apple_ref/doc/uid/TP30000982-TP30000221-BAJFHIBE">“How the Font Manager Responds to a Font Request”</a></span> for more information.</p><p>You can change this default behavior by calling the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetOutlinePreferred" target="_top">SetOutlinePreferred</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_380"></a>. If you call <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetOutlinePreferred" target="_top">SetOutlinePreferred</a></code> with the <code>outlinePreferred</code> parameter set to <code>TRUE</code>, the Font Manager chooses outline fonts over bitmapped fonts when both are available.</p><p>The <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetOutlinePreferred" target="_top">GetOutlinePreferred</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_381"></a> function returns a <code>Boolean</code> value that indicates which kind of font the Font Manager has been set to favor. You should call this function and save the value that it returns with your documents. Then, when the user opens a document in your application, you can call the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetOutlinePreferred" target="_top">SetOutlinePreferred</a></code> with that value to ensure that the same fonts are used.</p><p>If only one kind of font is available, the Font Manager chooses that kind of font to use in the document, no matter which kind of font is favored. You can determine whether the font being used in the current graphics port is an outline font by calling the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/IsOutline" target="_top">IsOutline</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_382"></a>.</p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCFDIIE" title="Preserving the Shapes of Glyphs "></a><h2>Preserving the Shapes of Glyphs </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_383"></a><p>Most glyphs in an alphabetic font fit between the <strong>ascent line</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_384"></a> and the <strong>descent line</strong><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_385"></a>, which roughly mark (respectively) the tops of the lowercase ascenders and the bottoms of the descenders. Bitmapped fonts always fit between the ascent line and descent line. One aim of outline fonts is to provide glyphs that are more accurate renditions of the original typeface design, and there are glyphs in some typefaces that exceed the ascent or descent line (or both). An example of this type of glyph is an uppercase letter with a diacritical mark: “N” with a tilde produces “Ñ”. Many languages use glyphs that extend beyond the ascent line or descent line.</p><p>However, these glyphs may disturb the line spacing in a line or a paragraph. The glyph that exceeds the ascent line on one line may cross the descent line of the line above it, where it may overwrite a glyph that has a descender. You can determine whether glyphs from outline fonts exceed the ascent and descent lines by using the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/OutlineMetrics" target="_top">OutlineMetrics</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_386"></a>. <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/OutlineMetrics" target="_top">OutlineMetrics</a></code> returns the maximum and minimum y-values for whatever glyphs you choose. You can get the values of the ascent and descent lines using the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FontMetrics" target="_top">FontMetrics</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_387"></a>. If a glyph’s maximum or minimum y-value is greater than, respectively, the ascent or descent line, you can opt for one of two paths of action: you can change the way that your application handles line spacing to accommodate the glyph, or you can change the height of the glyph. </p><p>The Font Manager’s default behavior is to change the height of the glyph, providing compatibility with bitmapped fonts, which are scaled between the ascent and descent lines. <span class="content_text">Figure 3-1</span> shows the difference between an "Ñ" scaled to fit in the same amount of space as an "N" and a preserved "Ñ". The tilde on the preserved "Ñ" clearly exceeds the ascent line.</p><br/><div><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_96" title="Figure 2-1The difference between a scaled glyph and a preserved glyph"></a><p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BCIFIJBJ" title="Figure 2-1The difference between a scaled glyph and a preserved glyph"></a><strong>Figure 2-1&nbsp;&nbsp;</strong>The difference between a scaled glyph and a preserved glyph</p><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_388"></a><img src = "../art/fm17.gif" alt = "The difference between a scaled glyph and a preserved glyph" width="255" height="110"></div><br/><p>You can change this default behavior by calling the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetPreserveGlyph" target="_top">SetPreserveGlyph</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_389"></a>. If you call <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetPreserveGlyph" target="_top">SetPreserveGlyph</a></code> with the <code>preserveGlyph</code> parameter set to <code>TRUE</code>, the Font Manager preserves the shape of the glyph intended by the font designer. </p><p>The function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetPreserveGlyph" target="_top">GetPreserveGlyph</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_390"></a> returns a <code>Boolean</code> value that indicates whether or not the Font Manager has been set to preserve the shapes of glyphs from outline fonts. You should call this function and save the value that it returns with your documents. Then, when the user opens a document in your application, you can call <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetPreserveGlyph" target="_top">SetPreserveGlyph</a></code> with that value to ensure that glyphs are scaled appropriately.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_391"></a></p><a name="//apple_ref/doc/uid/TP30000982-TP30000222-BBCJCHBB" title="Using Fractional Glyph Widths and Font Scaling  "></a><h2>Using Fractional Glyph Widths and Font Scaling  </h2><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_392"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_393"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_394"></a><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_395"></a><p>Using fractional glyph widths allows the Font Manager to place glyphs on the screen in a manner that closely matches the eventual placement of glyphs on a page printed by high-resolution printers. (See <span class="content_text"><a href="../fm_concepts/fmconcepts.html#//apple_ref/doc/uid/TP30000982-TP30000221-BAJBBCAD">“How the Font Manager Calculates Glyph Widths”</a></span>).</p><p>You can enable the use of fractional glyph widths with the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetFractEnable" target="_top">SetFractEnable</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_396"></a>. If you set the parameter <code>fractEnable</code> to <code>TRUE</code>, the Font Manager uses fractional glyph widths. </p><p>When a bitmapped font is not available in a specific size, the Font Manager can compute scaling factors for QuickDraw to use to create a bitmap of the requested size. You can set the Font Manager to compute scaling factors for bitmapped fonts by using the function <code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetFScaleDisable" target="_top">SetFScaleDisable</a></code><a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_397"></a>. If you set the <code>fontScaleDisable</code> parameter of this function to <code>TRUE</code>, the Font Manager disables font scaling. </p><p>When font scaling is disabled, the Font Manager responds to a request for a font size that is not available by returning a bitmapped<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_398"></a> font with the requested widths, which may mean that their height is smaller than the requested size. If you set it to <code>FALSE</code>, the Font Manager computes scaling factors for bitmapped fonts and QuickDraw scales the glyph bitmaps. The Font Manager always scales an outline font.</p><p>For more information fractional glyph widths and font scaling, see the QuickDraw documentation.<a name="//apple_ref/doc/uid/TP30000222-DontLinkElementID_399"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../fm_concepts/fmconcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../fm_revhistory/fmdocrevhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/Managing_FontManager/fm_tasks/fmtasks.html%3Fid%3DTP30000982-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/Managing_FontManager/fm_tasks/fmtasks.html%3Fid%3DTP30000982-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/Managing_FontManager/fm_tasks/fmtasks.html%3Fid%3DTP30000982-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>