<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>OpenGL Shader Builder User Guide: Building Shaders</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Building Shaders"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40006476-CH3" title="Building Shaders"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../OpenGL-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000549" target="_top">OpenGL</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40006476-CH1-DontLinkElementID_4">OpenGL Shader Builder User Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../UserInterface/UserInterface.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40006476-CH3-SW1" title="Building Shaders"></a><h1>Building Shaders</h1><p>This chapter explains how to use OpenGL Shader Builder to set up projects, add shader code, add resources, and modify variables. Before reading this chapter, you should already be familiar with OpenGL and know how to write at least one of the following:</p><ul class="ul"><li class="li"><p>ARB fragment and vertex programs. See the OpenGL extensions <span class="content_text"><a href="http://oss.sgi.com/projects/ogl-sample/registry/ARB/fragment_program.txt" target="_blank">GL_ARB_fragment_program</a></span> and <span class="content_text"><a href="http://oss.sgi.com/projects/ogl-sample/registry/ARB/vertex_program.txt" target="_blank">GL_ARB_vertex_program</a></span>.</p></li><li class="li"><p>GLSL fragment and vertex shaders. See <span class="content_text"><a href="http://www.opengl.org/registry/doc/GLSLangSpec.Full.1.20.8.pdf" target="_blank">OpenGL Shading Language (PDF)</a></span>.</p></li></ul><p>OpenGL Shader Builder also supports geometry shaders, a recent addition to the OpenGL specification (see the OpenGL Extension <span class="content_text"><a href="http://www.opengl.org/registry/specs/NV/geometry_shader4.txt" target="_blank">GL_NV_geometry_shader4</a></span>). Geometry shaders are not supported on all graphics cards. But because the Apple software renderer steps in as a fallback when necessary, you can use OpenGL Shader Builder to develop them.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW4">Creating and Saving Projects</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW3">Creating and Saving a Layout</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW2">Adding Textures</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW5">Using Alternate Texture Views</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW10">Modifying Uniform Variables</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW6">Building Shaders</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW7">Checking Shader Performance</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW8">Troubleshooting Errors</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40006476-CH3-SW4" title="Creating and Saving Projects"></a><h2>Creating and Saving Projects</h2><p>A <strong>project</strong> is the set of resources that make up one program—vertex, fragment, and geometry source files, and textures. As with any development environment, you can name and save projects. You can also have more than one project open at a time.</p><p>When you launch OpenGL Shader Builder, it opens to an empty, untitled project. To save the project, choose File > Save Project and enter a project name. A project can contain as many source files and textures as you’d like. Using the checkboxes in the file list, you can select which source files to make active.</p><a name="//apple_ref/doc/uid/TP40006476-CH3-SW3" title="Creating and Saving a Layout"></a><h2>Creating and Saving a Layout</h2><p>A <strong>layout</strong> specifies the location and number of windows that you want OpenGL Shader Builder to provide when you open new and existing projects. </p><p>To create and save a layout:</p><ol class="ol"><li class="li"><p>Launch OpenGL Shader Builder.</p></li><li class="li"><p>Double-click each tab whose view you want to open in a separate window. </p></li><li class="li"><p>Arrange the windows to suit your preference.</p></li><li class="li"><p>Choose Window > Save Layout.</p></li></ol><p>Whenever you launch OpenGL Shader Builder, it automatically sets up the environment for you using your preferred layout.</p><a name="//apple_ref/doc/uid/TP40006476-CH3-SW2" title="Adding Textures"></a><h2>Adding Textures</h2><p>To add a texture to the Textures view, drag the texture file to an image well. You can add any of these texture targets: <code>1D</code>, <code>2D</code>, <code>RECTANGLE</code>, <code>SHADOW_1D</code>, <code>SHADOW_2D</code>, and <code>SHADOW_RECTANGLE</code>.</p><p>To add a <code>3D</code> texture, you drag all the necessary files to an image well. The number of images in this texture target must be a power of 2 (2, 4, 8, 16, 32, and so on). Otherwise, OpenGL Shader Builder inserts a default image in the <em>z</em> direction.</p><p>You can also drag <code>CUBE_MAP</code> textures to an image well, but because this texture targets require more than one file, you’ll first need to name the files so that OpenGL Shader Builder can place them properly. <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW11">Figure 2-1</a></span> shows the layout that OpenGL Shader Builder uses for cube maps.</p><br/><div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW11" title="Figure 2-1Cube face layout for a cube map"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Cube face layout for a cube map</p><img src = "../Art/cube_map_layout.jpg" alt = "Cube face layout for a cube map" ></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/TP40006476-CH3-DontLinkElementID_6" title="Tip"></a><p><strong>Tip:</strong>&nbsp;When adding cube maps or textures, after you add one image file to the image well, you can then drag other images to the individual faces that OpenGL Shader Builder automatically generates.</p></div><p>To add a cube map :</p><ol class="ol"><li class="li"><p>Name each texture file using a convention that specifies the location within the cube map or 3D texture.</p><p>For cube maps, you can use any of the conventions listed in <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW9">Table 2-1</a></span>. For example, if the base filename for a cube map is <code>mycube</code>, you could name the texture files: <code>mycube_back</code>, <code>mycube_down</code>, <code>mycube_forward</code>, <code>mycube_left</code>, <code>mycube_right</code>, and <code>mycube_up</code>.</p></li><li class="li"><p>In the Finder, select the texture files and drag them to an image well.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40006476-CH3-DontLinkElementID_7" title="Tip"></a><p><strong>Tip:</strong>&nbsp;If you name the cube map files correctly and place them in the same directory, you need to drag only one file in that directory to the  view on the left side. OpenGL Shader Builder then reads all files in entire directory and places all the images for you.</p></div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW9" title="Table 2-1Naming conventions that map texture files to cube faces in a cube map"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Naming conventions that map texture files to cube faces in a cube map</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>X+ face</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>X– face</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Y+ face</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Y– face</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Z+ face</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Z– face</p></th></tr><tr><td  scope="row"><p><code>posx</code></p></td><td ><p><code>negx</code></p></td><td ><p><code>posy</code></p></td><td ><p><code>negy</code></p></td><td ><p><code>posz</code></p></td><td ><p><code>negz</code></p></td></tr><tr><td  scope="row"><p><code>xpos</code></p></td><td ><p><code>xneg</code></p></td><td ><p><code>ypos</code></p></td><td ><p><code>yneg</code></p></td><td ><p><code>zpos</code></p></td><td ><p><code>zneg</code></p></td></tr><tr><td  scope="row"><p><code>right</code></p></td><td ><p><code>left</code></p></td><td ><p><code>top</code></p></td><td ><p><code>down</code></p></td><td ><p><code>front</code></p></td><td ><p><code>back</code></p></td></tr><tr><td  scope="row"><p><code>rt</code></p></td><td ><p><code>lf</code></p></td><td ><p><code>up</code></p></td><td ><p><code>dn</code></p></td><td ><p><code>ft</code></p></td><td ><p><code>bk</code></p></td></tr><tr><td  scope="row"><p><code>+x</code></p></td><td ><p><code>–x</code></p></td><td ><p><code>+y</code></p></td><td ><p><code>–y</code></p></td><td ><p><code>+z</code></p></td><td ><p><code>–z</code></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW5" title="Using Alternate Texture Views"></a><h2>Using Alternate Texture Views</h2><p>OpenGL Shader Builder provides two ways for you to view textures. The default view shows the texture data simply as a flat representation. The alternate view shows how the texture appears when applied to a target, using the filter and wrap modes that you choose. The alternate view is especially useful if you are unsure of how a particular filter or wrap mode will affect the outcome. You might also find the alternate view helpful to visualize 3D and cube maps.</p><p>The alternate view is particularly useful for cube maps. The default view in <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW13">Figure 2-2</a></span> shows the “unfolded” cube,  while the alternate view in <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW14">Figure 2-3</a></span> projects the cube faces in three dimensions.</p><p>To see the alternate view, double-click the texture.</p><br/><div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW13" title="Figure 2-2The default view for a cube map"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>The default view for a cube map</p><img src = "../Art/cubemap_unfolded.jpg" alt = "The default view for a cube map" ></div><br/><p>If you have not supplied multiple files for a cube map or 3D texture or if you’ve not used a location-based naming convention (see <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW2">“Adding Textures”</a></span>), you’ll notice rectangles with a number or letters in them when you switch to alternate view.</p><br/><div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW14" title="Figure 2-3The alternate view for a cube map"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>The alternate view for a cube map</p><img src = "../Art/cubemap_projected.jpg" alt = "The alternate view for a cube map" ></div><br/><a name="//apple_ref/doc/uid/TP40006476-CH3-SW10" title="Modifying Uniform Variables"></a><h2>Modifying Uniform Variables</h2><p>OpenGL Shader Builder automatically lists uniform variables from your source code in the Symbols view. How these uniform variable are displayed depend on the type of program. GLSL shaders use  a shared symbol table for a single program object, so you’ll see the uniform variables appear in a single list . In contrast, ARB fragment and vertex programs have their own symbol table per pipeline state which are separated by local and environment variables per stage. Therefore ARB local and environment variables appear in separate lists.</p><p>The controls for a variable reflect that variable’s data type, no matter how complex the type (see <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP40006476-CH3-SW12">Figure 2-4</a></span>). You can use the controls to manually change a value, or you can select Animate to automatically vary a uniform from one value to another. No matter which you choose, you will get immediate feedback by looking at the Render view as long as the auto compile and auto link options are enabled.</p><br/><div><a name="//apple_ref/doc/uid/TP40006476-CH3-SW12" title="Figure 2-4Controls for a matrix structure"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>Controls for a matrix structure</p><img src = "../Art/symbols_glsl_2.jpg" alt = "Controls for a matrix structure" ></div><br/><a name="//apple_ref/doc/uid/TP40006476-CH3-SW6" title="Building Shaders"></a><h2>Building Shaders</h2><p>To build a shader and make sure it runs correctly, follow these steps:</p><ol class="ol"><li class="li"><p>Open OpenGL Shader Builder.</p></li><li class="li"><p>Add shader source code.</p><p>If you’ve already written the shader source files, click Add Shaders. Then, navigate to the files you want to add to the file list and choose them.</p><p>If you want to enter the source code, choose File > New and then choose the type of shader you want to write. A source code file opens in its own window. You can modify the default code provided in the template. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40006476-CH3-DontLinkElementID_8" title="Tip"></a><p><strong>Tip:</strong>&nbsp;You can drag existing source files to the program list.</p></div></li><li class="li"><p>Check the Link Log to make sure the programs linked successfully. You might also want to check the link results.</p><p>By default, OpenGL Shader Builder has automatic linking enabled. If you disabled this feature, you’ll need to enable it or click the Link button.</p><p>If the link fails, check to make sure that you added all necessary source files. For example, if you add a fragment or geometry program without adding the associated vertex program, linking fails.</p></li><li class="li"><p>In the Textures view, add any textures that are appropriate for your shader.</p><p>You’ll most likely want to replace the default texture.</p></li><li class="li"><p>In the Symbol view, animate one or more of the uniform variables.</p></li><li class="li"><p>In the Render view, choose a geometry from the pop-up menu.</p><p>You can drag the pointer to move the rendered image.</p></li></ol><p>After your shader is running, you may want to benchmark its performance.</p><a name="//apple_ref/doc/uid/TP40006476-CH3-SW7" title="Checking Shader Performance"></a><h2>Checking Shader Performance</h2><p>It’s a good idea to check the frame rate of your shader before and after you make adjustments to the code. You can measure the frame rate by following these steps:</p><ol class="ol"><li class="li"><p>In the Render view, click Benchmark.</p><p>A benchmark window opens.</p></li><li class="li"><p>Enter the number of seconds for the benchmark test. Then, click Run.</p><p>Note the elapsed time and the frames per second.</p></li></ol><p>If you find the frame rate is much lower than you’d like, check to see if you are performing: </p><ul class="ul"><li class="li"><p>Tasks inside a loop, such as setting state, that should really be performed outside the loop</p></li><li class="li"><p>Complex calculations, such as arcsin. You can improve performance by pre-calculating results and storing them in a texture. Then, when you need a result, perform a texture look-up operation instead of the complex calculation.</p></li></ul><p>After you are certain that your shader performs well in isolation, you should add it to your OpenGL application. Then, use OpenGL Profiler to make sure that your shader and the surrounding OpenGL application run as optimally as possible.</p><p>For information identifying and solving performance issues with OpenGL applications, see <em><a href="../../OpenGLProfilerUserGuide/index.html#//apple_ref/doc/uid/TP40006475" target="_top">OpenGL Profiler User Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP40006476-CH3-SW8" title="Troubleshooting Errors"></a><h2>Troubleshooting Errors</h2><p>Shaders can have validation errors for a number of reasons. You’ll want to be familiar with the OpenGL extensions that apply to the type of GPU program you are writing, because each extension outlines the conditions that can cause such errors. This section provides guidelines for a few of the common errors.</p><ul class="ul"><li class="li"><p>Make sure that your code sets uniform variables for samplers  at validation time. </p></li><li class="li"><p>If your code depends on support for certain features, make sure you add a directive to require the appropriate extension, otherwise your code won’t parse. </p></li><li class="li"><p>If a geometry shader fails, check to see whether any of the following apply:</p><ul class="nested"><li class="nested li"><p>The geometry program has no associated vertex program for supplying varying variables.</p></li><li class="nested li"><p>You used the wrong input or output types. Geometry shaders use fixed input and output primitive types.</p></li><li class="nested li"><p>The value of <code>GEOMETRY_VERTICES_OUT_EXT</code> is <code>0</code>.</p></li></ul></li></ul><p>You can sometimes troubleshoot errors by examining well-written code and comparing it to our own. You may want to look at the following:</p><ul class="ul"><li class="li"><p>The shaders in <code>/Developer/Examples/OpenGL</code>, which are available after installing the Developer Tools that come with Mac OS X.</p></li><li class="li"><p>The <em><a href="../../../../../samplecode/GLSLShowpiece/index.html#//apple_ref/doc/uid/DTS10003935" target="_top">GLSLShowpiece</a></em> and other sample code that’s available through the <span class="content_text"><a href="http://developer.apple.com/samplecode/GraphicsImaging/idxOpenGL-date.html" target="_top">ADC Reference Library</a></span>.</p></li><li class="li"><p>Sample code that’s available on <span class="content_text"><a href="http://www.opengl.org/code/" target="_blank">http://www.opengl.org/</a></span>.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../UserInterface/UserInterface.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-23<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/OpenGLShaderBuilderUserGuide/Tasks/Tasks.html%3Fid%3DTP40006476-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/OpenGLShaderBuilderUserGuide/Tasks/Tasks.html%3Fid%3DTP40006476-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/OpenGLShaderBuilderUserGuide/Tasks/Tasks.html%3Fid%3DTP40006476-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>