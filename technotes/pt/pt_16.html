<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PT16: InitGraf with MPW Assembly</title>                                       <meta name="categories" content="Platforms and Tools"><meta name="week-posted" content="Jan 30, 1989 - Feb 3, 1989"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002670" title="InitGraf with MPW Assembly"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTools-date.html">Tools</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/DeveloperTools/idxCompilersDebuggers-date.html" target="_blank">Tools > Compiling & Debugging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PT16</div>
<div id="pageheadsub">InitGraf with MPW Assembly</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">In the Beginning...</A><BR><BR><A HREF="#Section2">Here and Now</A><BR><BR><A HREF="#Section3">An Example...</A><BR><BR><A HREF="#Section4">Truth or Consequences</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">The Macintosh Programmer's Workshop (MPW) requires assembly-languageprogrammers to allocate their own QuickDraw global variables rather than usethe default record as indicated in <i>Inside Macintosh</i>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Feb 01 1989]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>In the Beginning...</h2><p>Early Macintosh assembly-language development systems automatically allocated aset of QuickDraw global variables (a QuickDraw record) on the application'sstack.  The assembly-language note in <i>Inside Macintosh</i>, I-163 indicatesthat the programmer should use the following code to specify that automaticallyallocated record to <code>_InitGraf</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        PEA        -4(A5)</pre>	</TD></TR></TABLE></CENTER><a name="Section2"></a> <P><A HREF="#top">Back to top</A></p><h2>Here and Now</h2><p>Despite the note in <i>Inside Macintosh</i>, MPW does not automaticallyallocate a set of QuickDraw global variables for the programmer; it is theresponsibility of the programmer to allocate this record for QuickDraw's use.</p><a name="Section3"></a> <P><A HREF="#top">Back to top</A></p><h2>An Example...</h2><p>Here is an example of creating a QuickDraw global variables template taken fromSample.a, V1.01, which is distributed with MPW 3.0 and on Developer TechnicalSupport's sample source code disk:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    QDGlobals    RECORD    0,DECREMENT    GrafPort    DS.L    1    White        DS.B    8    Black        DS.B    8    Gray        DS.B    8    LtGray        DS.B    8    DkGray        DS.B    8    Arrow        DS.B    cursRec    ScreenBits    DS.B    BitMap    RandSeed    DS.L    1            ORG    -GrafSize</pre>	</TD></TR></TABLE></CENTER><p>Here is an example, again from Sample.a, of how to use the above template.</p><p>First we use the template to allocate an occurrence of our record:</p><p>Next we set up for and make our call:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        PEA        QD.GrafPort</pre>	</TD></TR></TABLE></CENTER><p>The declaration of <code>QD</code> with a <code>DS</code> creates an occurrence of ourrecord in the application's global variable space and the assembler implicitlyprovides the reference to <code>A5</code> as the base register .</p><a name="Section4"></a> <P><A HREF="#top">Back to top</A></p><h2>Truth or Consequences</h2><p>If you use the MPW assembler and also use the code specified by the note in<i>Inside Macintosh</i>, you are telling QuickDraw (by calling<code>_InitGraf</code>) to use an inappropriate area of memory as global variablesspace.  QuickDraw will happily initialize this area of memory to the correctvalues for its use, but in doing so, it will also be blasting information thatis probably important to some other part of the system.</p><a name="References"></a> <P><A HREF="#top">Back to top</A></p><h2>References</h2><P>   <i>Inside Macintosh</i>, Volume I-135, QuickDraw</p>         <a name=Downloads></A>                  <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pt_16.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pt/pt_16.html%3Fid%3DDTS10002670-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pt/pt_16.html%3Fid%3DDTS10002670-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pt/pt_16.html%3Fid%3DDTS10002670-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>