<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> FindDriverCandidates9</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.de.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.e0.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.e2.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H2 CLASS="RoH.RoutineHeading"><A NAME="pgfId=3415"> </A><A NAME="14808"> </A>FindDriverCandidates<A NAME="marker=4510"> </A></H2><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=15059"> </A>OSErr FindDriverCandidates (<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegEntryIDPtr deviceID,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ptr *propBasedDriver,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegPropertyValueSize *propBasedDriverSize,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringPtr deviceName,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DriverType *propBasedDriverType,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Boolean *gotPropBasedDriver,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileBasedDriverRecordPtr fileBasedDrivers,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount *nFileBasedDrivers);</CODE><DL COMPACT><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15063"> </A><TT CLASS="cv">deviceID</TT><A NAME="42309"> </A></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3419"> </A>Name Registry ID of target device.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15073"> </A><TT CLASS="cv">propBasedDriver</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3420"> </A> Address of property-based driver.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15083"> </A><TT CLASS="cv">propBasedDriverSize</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=4481"> </A> Size of property-based driver.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15093"> </A><TT CLASS="cv">deviceName</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=4482"> </A>Returned name of the device.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15102"> </A><TT CLASS="cv">propBasedDriverType</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3423"> </A> Type of property-based driver.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15112"> </A><TT CLASS="cv">gotPropBasedDriver</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3424"> </A> Value is <TT CLASS="cv">true</TT> if property-based driver was found.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15122"> </A><TT CLASS="cv">fileBasedDrivers</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3425"> </A> List of sorted file-based driver records.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15132"> </A><TT CLASS="cv">nFileBasedDrivers</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3426"> </A> Count of file-based driver records.</DD></DL COMPACT><DIV><H6 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3427"> </A>DESCRIPTION</H6><P CLASS="T1.Text1"><A NAME="pgfId=3428"> </A>Given the name entry ID of a device, <TT CLASS="cv">FindDriverCandidates</TT> constructs a list of file-based drivers that match the device name or one of the device-compatible names. The list is sorted from best match to least favorable match. Drivers that match the device name are listed before drivers that match a compatible name. Each of these groups are further sorted by version numbers, using the <A HREF="PCI_BOOK.f0.html#41749" CLASS="XRef"><TT CLASS="cv">HigherDriverVersion</TT></A> service. Property-based drivers are always matched using the device name and are returned separately from file-based drivers. An I/O expert can determine a property-based driver's ranking using the <TT CLASS="cv">HigherDriverVersion</TT> service. </P><P CLASS="T1.Text1"><A NAME="pgfId=3432"> </A>If a <TT CLASS="cv">nil</TT> list output buffer is passed, only the count of matched file-based drivers is returned. An I/O expert can call <TT CLASS="cv">FindDriverCandidates</TT> first with a <TT CLASS="cv">nil</TT> buffer, allocate a buffer large enough for the list, and then call <TT CLASS="cv">FindDriverCandidates</TT> again with the appropriately sized buffer.</P><P CLASS="T1.Text1"><A NAME="pgfId=3433"> </A>If a <TT CLASS="cv">nil</TT> value is passed in <TT CLASS="cv">deviceID</TT>, all drivers from the Extensions folder are returned. When using this option, pass <TT CLASS="cv">nil</TT> values for all parameters except <TT CLASS="cv">fileBasedDrivers</TT> and <TT CLASS="cv">nFileBasedDrivers</TT>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3434"> </A>The list of matched drivers consists of an array of file-based driver records: </P><CODE CLASS="Cv.Code"><A NAME="pgfId=15144"> </A>struct FileBasedDriverRecord {<BR>&nbsp;&nbsp;&nbsp;&nbsp;FSSpec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theSpec;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* file specification */<BR>&nbsp;&nbsp;&nbsp;&nbsp;DriverType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theType;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* nameInfoStr &amp; version <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number */<BR>&nbsp;&nbsp;&nbsp;&nbsp;Boolean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compatibleProp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* true if matched using a<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compatible name */<BR>&nbsp;&nbsp;&nbsp;&nbsp;UInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pad[3];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* alignment*/<BR>};</CODE><br><br><CODE CLASS="Cv.Code"><A NAME="pgfId=15148"> </A>typedef struct FileBasedDriverRecord <BR>FileBasedDriverRecord,*FileBasedDriverRecordPtr;</CODE><P CLASS="T1.Text1"><A NAME="pgfId=3437"> </A>A file-based driver consists of a file specification, the driver's type, and whether the driver was matched using the device name or a compatible device name.</P><P CLASS="T1.Text1"><A NAME="pgfId=3441"> </A>An I/O expert can use the program logic summarized in <A HREF="PCI_BOOK.e1.html#31629" CLASS="XRef">Listing&nbsp;9-1</A> to cycle through a list of file-based candidates.</P><P CLASS="L.Listing"><B><A NAME="pgfId=3443"> </A>Listing&nbsp;9-1	<A NAME="31629"> </A>Finding file-based driver candidates</B></P><CODE CLASS="Cv.Code"><A NAME="pgfId=16052"> </A>FindDriverCandidates();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* get list of candidates for a device */<BR>&nbsp;&nbsp;&nbsp;&nbsp;while (Candidates in the list)<BR>   {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetDriverFromFile ( FSSpec_in_Record, &amp;driverConnectionID );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (InitializeThisDriver(Candidate) != NoErr))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* unhold this failed driver's memory */<BR>&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* and close its CFM connection */<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnloadTheDriver  ( driverConnectionID );<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* advance to next position in the list */<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetNextCandidate();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* driver loaded and initialized */<BR>    }</CODE><br><br><FONT CLASS="TbT2.TblText2"><A NAME="pgfId=3467"> </A>RESULT CODES</FONT><TABLE border=1 cellpadding=3><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3450"> </A>noErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3452"> </A>0</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3454"> </A>No error</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><CODE CLASS="TbCv.TblCode"><A NAME="pgfId=3456"> </A>fnfErr</CODE></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3458"> </A>-43</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3460"> </A>File not found</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="3"><FONT CLASS="TbT2.TblText2"><A NAME="pgfId=3462"> </A>All CFM errors (see <I CLASS="italics">Inside Macintosh: PowerPC System Software</I>)</FONT></TD></TR></TABLE></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.de.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.e0.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.e2.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>