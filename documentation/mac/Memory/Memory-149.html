<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MyPurgeProc (IM: M)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING149></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Memory-148.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-150.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Memory-2.html"><B>Memory</B></A> / <BR><DD><A HREF="Memory-56.html"><B>Chapter 2 - Memory Manager</B></A> / <A HREF="Memory-60.html"><B>Memory Manager Reference</B></A><BR><DL><DD><A HREF="Memory-145.html"><B>Application-Defined Routines</B></A> / <A HREF="Memory-148.html"><B>Purge-Warning Procedures</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING149-0></A>
<H3>MyPurgeProc</H3>
 A purge-warning procedure should have the following form:<P>
<PRE>
PROCEDURE MyPurgeProc (h: Handle);
</PRE>
<DL>
<DT><CODE>h</CODE>
<DD> A handle to the block that is about to be purged.
</DL>
<A NAME=HEADING149-4></A>
<H5>DESCRIPTION</H5>
 Whenever the Memory Manager needs to purge a block from the application heap, it first calls any application-defined purge-warning procedure that you have installed. The purge-warning procedure can, if necessary, save the contents of that block or otherwise respond to the warning.<P>
 Your purge-warning procedure is called during a memory-allocation request. As a result, you should not call any routines that might cause memory to be moved or purged. In particular, if you save the data of the block in a file, the file should already be open when your purge-warning procedure is called, and you should write the data synchronously.<P>
 You should not dispose of or change the purgeable status of the block whose handle is passed to your procedure.<P>
 To install a purge-warning procedure, you need to assign its address to the <CODE>purgeProc</CODE> field of the associated zone header.<P>
<DL>
<DT><B>Note</B>
<DD>If you call the Resource Manager procedure <CODE>SetResPurge</CODE> with the parameter <CODE>TRUE</CODE>, any existing purge-warning procedure is replaced <BR>by a purge-warning procedure installed by the Resource Manager. <BR>You can execute both warning procedures by calling <CODE>SetResPurge</CODE>, saving the existing value of the <CODE>purgeProc</CODE> field of the zone <BR>header, and then reinstalling your purge-warning procedure. <BR>Your purge-warning procedure should call the Resource Manager's purge-warning procedure internally.<EM></EM><A NAME=MARKER-2-524></A><A NAME=MARKER-2-525></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING149-10></A>
<H5>SPECIAL CONSIDERATIONS<A NAME=MARKER-2-526></A></H5>
 Your purge-warning procedure might be called at a time when the system is attempting to allocate memory and the value in the A5 register is not correct. If your function accesses your application's A5 world or makes any trap calls, you need to set up and later restore the A5 register by calling <CODE>SetCurrentA5</CODE> and <CODE>SetA5</CODE>.<A NAME=MARKER-2-527></A><A NAME=MARKER-2-528></A><A NAME=MARKER-2-529></A><A NAME=MARKER-2-530></A><P>
 Because of the optimizations performed by some compilers, the actual work of the purge-warning procedure and the setting and restoring of the A5 register might have to be placed in separate procedures.<P>
 Your purge-warning procedure is called for <I>every</I> handle that is about to be purged <BR>(not necessarily for every purgeable handle in your heap, however). Your procedure should be able to determine quickly whether the handle it is passed is one whose associated data needs to be saved or otherwise processed.<P>
<A NAME=HEADING149-14></A>
<H5>SEE ALSO</H5>
 See <A HREF=Memory-58.html#MARKER-9-168>"Installing a Purge-Warning Procedure" on page 2-16</A> for a definition of a sample purge-warning procedure and for instructions on installing the procedure.<A NAME=MARKER-2-531></A><A NAME=MARKER-2-532></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Memory-148.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-150.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Memory-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
