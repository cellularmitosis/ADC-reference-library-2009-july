<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>GLUT - /macx_init.m</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/GraphicsImaging/index.html">Graphics & Imaging</a> &gt; <a href="../../samplecode/GraphicsImaging/idxOpenGL-date.html">OpenGL</a> &gt; <A HREF="javascript:location.replace('index.html');">GLUT</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">GLUT</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/macx_init.m</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/gle/copy.h</option>
<option value="listing2.html">/gle/ex_angle.c</option>
<option value="listing3.html">/gle/ex_cut_round.c</option>
<option value="listing4.html">/gle/ex_raw.c</option>
<option value="listing5.html">/gle/extrude.c</option>
<option value="listing6.html">/gle/extrude.h</option>
<option value="listing7.html">/gle/gle_osx.h</option>
<option value="listing8.html">/gle/gutil.h</option>
<option value="listing9.html">/gle/intersect.c</option>
<option value="listing10.html">/gle/intersect.h</option>
<option value="listing11.html">/gle/port.h</option>
<option value="listing12.html">/gle/rot.h</option>
<option value="listing13.html">/gle/rot_prince.c</option>
<option value="listing14.html">/gle/rotate.c</option>
<option value="listing15.html">/gle/round_cap.c</option>
<option value="listing16.html">/gle/segment.c</option>
<option value="listing17.html">/gle/segment.h</option>
<option value="listing18.html">/gle/texgen.c</option>
<option value="listing19.html">/gle/tube.h</option>
<option value="listing20.html">/gle/tube_gc.h</option>
<option value="listing21.html">/gle/urotate.c</option>
<option value="listing22.html">/gle/view.c</option>
<option value="listing23.html">/gle/vvector.h</option>
<option value="listing24.html">/glsmap/glsmap.h</option>
<option value="listing25.html">/glsmap/glsmapint.h</option>
<option value="listing26.html">/glsmap/smap_buildsmap.c</option>
<option value="listing27.html">/glsmap/smap_context.c</option>
<option value="listing28.html">/glsmap/smap_create.c</option>
<option value="listing29.html">/glsmap/smap_destroy.c</option>
<option value="listing30.html">/glsmap/smap_drawmesh.c</option>
<option value="listing31.html">/glsmap/smap_flag.c</option>
<option value="listing32.html">/glsmap/smap_get.c</option>
<option value="listing33.html">/glsmap/smap_getfunc.c</option>
<option value="listing34.html">/glsmap/smap_gettexdim.c</option>
<option value="listing35.html">/glsmap/smap_gettexobj.c</option>
<option value="listing36.html">/glsmap/smap_getvec.c</option>
<option value="listing37.html">/glsmap/smap_makemesh.c</option>
<option value="listing38.html">/glsmap/smap_nearfar.c</option>
<option value="listing39.html">/glsmap/smap_origin.c</option>
<option value="listing40.html">/glsmap/smap_render.c</option>
<option value="listing41.html">/glsmap/smap_rvec2st.c</option>
<option value="listing42.html">/glsmap/smap_set.c</option>
<option value="listing43.html">/glsmap/smap_setfunc.c</option>
<option value="listing44.html">/glsmap/smap_setvec.c</option>
<option value="listing45.html">/glsmap/smap_texdim.c</option>
<option value="listing46.html">/glsmap/smap_texobj.c</option>
<option value="listing47.html">/glut.h</option>
<option value="listing48.html">/glut_8x13.c</option>
<option value="listing49.html">/glut_9x15.c</option>
<option value="listing50.html">/glut_bitmap.c</option>
<option value="listing51.html">/glut_bwidth.c</option>
<option value="listing52.html">/glut_cindex.c</option>
<option value="listing53.html">/glut_ext.c</option>
<option value="listing54.html">/glut_hel10.c</option>
<option value="listing55.html">/glut_hel12.c</option>
<option value="listing56.html">/glut_hel18.c</option>
<option value="listing57.html">/glut_mroman.c</option>
<option value="listing58.html">/glut_roman.c</option>
<option value="listing59.html">/glut_shapes.c</option>
<option value="listing60.html">/glut_stroke.c</option>
<option value="listing61.html">/glut_swidth.c</option>
<option value="listing62.html">/glut_teapot.c</option>
<option value="listing63.html">/glut_tr10.c</option>
<option value="listing64.html">/glut_tr24.c</option>
<option value="listing65.html">/glut_vidresize.c</option>
<option value="listing66.html">/GLUTApplication.h</option>
<option value="listing67.html">/GLUTApplication.m</option>
<option value="listing68.html">/glutbitmap.h</option>
<option value="listing69.html">/GLUTClipboardController.h</option>
<option value="listing70.html">/GLUTClipboardController.m</option>
<option value="listing71.html">/glutf90.h</option>
<option value="listing72.html">/GLUTMenu.h</option>
<option value="listing73.html">/GLUTMenu.m</option>
<option value="listing74.html">/GLUTMenuItem.h</option>
<option value="listing75.html">/GLUTMenuItem.m</option>
<option value="listing76.html">/GLUTPreferencesController.h</option>
<option value="listing77.html">/GLUTPreferencesController.m</option>
<option value="listing78.html">/glutstroke.h</option>
<option value="listing79.html">/GLUTView.h</option>
<option value="listing80.html">/GLUTView.m</option>
<option value="listing81.html">/GLUTWindow.h</option>
<option value="listing82.html">/GLUTWindow.m</option>
<option value="listing83.html">/HID_Config_Utilities.c</option>
<option value="listing84.html">/HID_Config_Utilities.h</option>
<option value="listing85.html">/HID_Error_Handler.c</option>
<option value="listing86.html">/HID_Error_Handler.h</option>
<option value="listing87.html">/HID_Name_Lookup.c</option>
<option value="listing88.html">/HID_Name_Lookup.h</option>
<option value="listing89.html">/HID_Queue_Utilities.c</option>
<option value="listing90.html">/HID_Queue_Utilities.h</option>
<option value="listing91.html">/HID_Utilities.c</option>
<option value="listing92.html">/HID_Utilities.h</option>
<option value="listing93.html">/HID_Utilities_External.h</option>
<option value="listing94.html">/HID_Utilities_Internal.h</option>
<option value="listing95.html">/libForeground.a</option>
<option value="listing96.html">/macx_cursor.m</option>
<option value="listing97.html">/macx_dials.m</option>
<option value="listing98.html">/macx_dstr.m</option>
<option value="listing99.html">/macx_event.m</option>
<option value="listing100.html">/macx_fortran.m</option>
<option value="listing101.html">/macx_gamemode.m</option>
<option value="listing102.html">/macx_get.m</option>
<option value="listing103.html">/macx_glut.h</option>
<option value="listing104.html">/macx_init.m</option>
<option value="listing105.html">/macx_input.m</option>
<option value="listing106.html">/macx_joy.m</option>
<option value="listing107.html">/macx_key.m</option>
<option value="listing108.html">/macx_menu.m</option>
<option value="listing109.html">/macx_modifier.m</option>
<option value="listing110.html">/macx_overlay.m</option>
<option value="listing111.html">/macx_space.m</option>
<option value="listing112.html">/macx_swap.m</option>
<option value="listing113.html">/macx_tablet.m</option>
<option value="listing114.html">/macx_util.m</option>
<option value="listing115.html">/macx_utilities.h</option>
<option value="listing116.html">/macx_warp.m</option>
<option value="listing117.html">/macx_win.m</option>
<option value="listing118.html">/ReadMe.txt</option></select>
				</p>
				</form>
				<p><strong><a href="glut.zip">Download Sample</a></strong> (&#147;glut.zip&#148;, 374.3K)<BR>
<strong><a href="glut.dmg">Download Sample</a></strong> (&#147;glut.dmg&#148;, 680.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">
/* Copyright (c) Mark J. Kilgard, 1994. */
/* Copyright (c) Dietmar Planitzer, 1998, 2002 - 2003 */

/* This program is freely distributable without licensing fees 
   and is provided without guarantee or warrantee expressed or 
   implied. This program is -not- in the public domain. */

#import &lt;unistd.h&gt;
#import &quot;macx_glut.h&quot;
#import &quot;GLUTApplication.h&quot;
// HID device stuff
#import &quot;HID_Utilities_External.h&quot;
#import &lt;IOKit/hid/IOHIDLib.h&gt;
#import &lt;Kernel/IOKit/hidsystem/IOHIDUsageTables.h&gt;



/* GLUT globals */
int              __glutArgc = 0;
char **          __glutArgv = NULL;
int              __glutScreenHeight;
int              __glutScreenWidth;
BOOL             __glutIconic = kIconic;
BOOL             __glutDebug = kDebug;
unsigned int     __glutDisplayMode = (GLUT_RGB | GLUT_SINGLE | GLUT_DEPTH);
int              __glutInitWidth = kInitWidth;
int              __glutInitHeight = kInitHeight;
int              __glutInitX = kInitX;
int              __glutInitY = kInitY;
BOOL             __glutDisableGrabbing = NO;
BOOL             __glutDisablePrinting = NO;
NSTimeInterval   __glutStartupTime = 0.0;
int              __glutDefaultColorSize = 16; // Default is ARGB1555.
BOOL             __glutUseInitWD = kUseInitWD;
BOOL             __glutInitWindowSizeCalled = NO;
BOOL             __glutInitWindowPositionCalled = NO;

static void    removeArgs(int *argcp, char **argv, int numToRemove);
static int    ReadInteger(char *string, char **NextString);
static int    XParseGeometry(char *string, int *x, int *y, unsigned int *width, unsigned int *height);


/* 
 * Bitmask returned by XParseGeometry().  Each bit tells if the corresponding
 * value (x, y, width, height) was found in the parsed string.
 */
#define NoValue        0x0000
#define XValue      0x0001
#define YValue        0x0002
#define WidthValue    0x0004
#define HeightValue    0x0008
#define AllValues     0x000F
#define XNegative     0x0010
#define YNegative     0x0020


/* GLUT's central atexit() handler */
static void __glutShutdown(void)
{
   // the following is needed to ensure auto-release pools work for releasing existing objects
   GLUTAPI_DECLARATIONS
   GLUTAPI_BEGIN

   __glutCloseDownGameMode();
   __glutForgetInputDevices();
   __glutResetKeyboard();

   GLUTAPI_END
}

/* CENTRY */
void APIENTRY glutInit(int *argcp, char **argv)
{
   char *        geometry = NULL;
   int            i;
   int          preserveSuppliedX = 0, preserveSuppliedY = 0;
   int          preserveSuppliedWidth = 0, preserveSuppliedHeight = 0;
   
   GLUTAPI_DECLARATIONS
     
   if (NSApp != nil) {
      __glutWarning(&quot;glutInit being called a second time.&quot;);
      return;
   }
   
   atexit(__glutShutdown); // set up shutdown routine
   __glutSetForeground ();    
   
   GLUTAPI_BEGIN

      /* Initialize our application instance */
   NSApp = [GLUTApplication sharedApplication];
   if (![NSBundle loadNibNamed:@&quot;GLUT&quot; owner:NSApp]) {
      __glutFatalError(&quot;glutInit can't open GLUT.nib&quot;); // will exit
   }

   /* Jump through a couple hoops to preserve any user-specified initial
    * position or size because the call to __glutLoadPrefs will overwrite
    * them.  Although the GLUT spec does not specifically require this, there
    * isn't any reason that we shouldn't support it, as this is the behavior
    * on most other platforms (and it makes sense to try and use the desired
    * size).  Futhermore, note that doing this here still allows the user to
    * override the window size with a -geometry and also doesn't preclude a
    * forced window size if the glutInitWindow*() functions are called after
    * the glutInit() call. */
   if ( __glutInitWindowPositionCalled == YES ) {
       preserveSuppliedX = __glutInitX;
       preserveSuppliedY = __glutInitY;
   }
   if ( __glutInitWindowSizeCalled == YES ) {
       preserveSuppliedWidth = __glutInitWidth;
       preserveSuppliedHeight = __glutInitHeight;
   }
   
   __glutLoadPrefs (); // ensure prefs are loaded from file
      
   /* Light the hoops on fire this time (restore program specified
    * parameters). */
   if ( __glutInitWindowPositionCalled == YES ) {
      __glutInitX = preserveSuppliedX;
      __glutInitY = preserveSuppliedY;
      __glutInitWindowPositionCalled = NO;
   }
   if ( __glutInitWindowSizeCalled == YES ) {
      __glutInitWidth = preserveSuppliedWidth;
      __glutInitHeight = preserveSuppliedHeight;
      __glutInitWindowSizeCalled = NO;
   }
   
      /* Make private copy of command line arguments. */
   __glutArgc = *argcp;
   __glutArgv = (char **) malloc(__glutArgc * sizeof(char *));
   if(!__glutArgv)
      __glutFatalError(&quot;out of memory.&quot;); // will exit
   for(i = 0; i &lt; __glutArgc; i++) {
        __glutArgv[i] = __glutStrdup(argv[i]);
        if(!__glutArgv[i])
            __glutFatalError(&quot;out of memory.&quot;); // will exit
    }
    
        /* parse arguments for standard options */
    for(i = 1; i &lt; __glutArgc; i++) {
        if(!strcmp(__glutArgv[i], &quot;-useMacOSCoords&quot;)) {
            __glutUseMacOSCoords = YES;
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-useWorkingDir&quot;)) {
            __glutUseInitWD = YES;
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-useExtendedDesktop&quot;)) {
            __glutUseExtendedDesktop = YES;
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-display&quot;)) {
            __glutWarning(&quot;-display option invalid for MacOS X glut (X Windows only).&quot;);
            if(__glutArgv[i + 1][0] != '-')
                i++;
            removeArgs(argcp, &amp;argv[1], 2);
        } else if(!strcmp(__glutArgv[i], &quot;-geometry&quot;)) {
            if(++i &gt;= __glutArgc)
                __glutFatalError(&quot;follow -geometry option with geometry parameter.&quot;);
            geometry = __glutArgv[i];
            removeArgs(argcp, &amp;argv[1], 2);
        } else if(!strcmp(__glutArgv[i], &quot;-direct&quot;)) {
            __glutWarning(&quot;-direct option invalid for MacOS X glut.&quot;);
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-indirect&quot;)) {
            __glutWarning(&quot;-indirect option invalid for MacOS X glut.&quot;);
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-iconic&quot;)) {
            __glutIconic = YES;
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-gldebug&quot;)) {
            __glutDebug = GL_TRUE;
            removeArgs(argcp, &amp;argv[1], 1);
        } else if(!strcmp(__glutArgv[i], &quot;-sync&quot;)) { // X protocal syncing
            __glutWarning(&quot;-sync option invalid for MacOS X glut.&quot;);
            removeArgs(argcp, &amp;argv[1], 1);
      } else if(!strcmp(__glutArgv[i], &quot;-nograb&quot;)) {
         __glutDisableGrabbing = YES;
         removeArgs(argcp, &amp;argv[1], 1);
      } else if(!strcmp(__glutArgv[i], &quot;-noprint&quot;)) {
         __glutDisablePrinting = YES;
         removeArgs(argcp, &amp;argv[1], 1);
      } else if(!strcmp(__glutArgv[i], &quot;-menuIdleInterval&quot;)) {
            __glutIdleTimeInterval = strtod(__glutArgv[++i], NULL);
         if(__glutIdleTimeInterval == 0.0) {
            __glutIdleTimeInterval = GLUT_DEFAULT_IDLE_INTERVAL;
         } else if(__glutIdleTimeInterval &lt; 0.001) {
            __glutIdleTimeInterval = 0.001;    // 1000Hz
         } else if(__glutIdleTimeInterval &gt; 1.0) {
            __glutIdleTimeInterval = 1.0;        // 1Hz
         }
            removeArgs(argcp, &amp;argv[1], 2);
      } else if(!strcmp(__glutArgv[i], &quot;-fadeInterval&quot;)) {
            __glutGameModeFadeInterval = strtod(__glutArgv[++i], NULL);
         if(__glutGameModeFadeInterval == 0.0) {
            __glutGameModeFadeInterval = GLUT_DEFAULT_FADE_INTERVAL;
         } else if(__glutGameModeFadeInterval &lt; 0.1) {
            __glutGameModeFadeInterval = 0.1;    // 1/4 second
         } else if(__glutGameModeFadeInterval &gt; 5.0) {
            __glutGameModeFadeInterval = 5.0;    // 5 seconds
         }
            removeArgs(argcp, &amp;argv[1], 2);
        } else if(!strcmp(__glutArgv[i], &quot;-captureSingleDisplay&quot;)) {
            __glutCaptureAllDisplays = NO;
        } else if(!strcmp(__glutArgv[i], &quot;-syncToVBL&quot;)) {
            __glutSyncToVBL = YES;
        } else if (!strncmp(__glutArgv[i], &quot;-psn_&quot;, 5)) {
         // Some funky Finder thing.
         removeArgs(argcp, &amp;argv[1], 1);
      } else {
            /* Stop processing args when you hit an unknown one. */
            break;
        }
    }

    // Try and determine if this is an app with a full bundle structure that contains resources.
    // If so, chdir to that resource directory so normal fopen() and the like functions will work
    // without having to find the resource path explicitly.
    if (NO == __glutUseInitWD) {
        NSString * bundlePath = [[NSBundle mainBundle] bundlePath];
        NSArray * bundlePathArray = [[NSFileManager defaultManager] directoryContentsAtPath:bundlePath];
        if ((nil != bundlePathArray) &amp;&amp; ([bundlePathArray containsObject:@&quot;Contents&quot;])) {
            NSString * contentsPath = [bundlePath stringByAppendingPathComponent:@&quot;Contents&quot;];
            NSArray * contentsPathArray = [[NSFileManager defaultManager] directoryContentsAtPath:contentsPath];
            if ((nil != contentsPath) &amp;&amp; ([contentsPathArray containsObject:@&quot;MacOS&quot;]) &amp;&amp; ([contentsPathArray containsObject:@&quot;Resources&quot;])) {
                NSString * finalResourcesPath = [contentsPath stringByAppendingPathComponent:@&quot;Resources&quot;];
                NSArray * finalResourcesPathArray = [[NSFileManager defaultManager] directoryContentsAtPath:finalResourcesPath];
                if ((nil != finalResourcesPath) &amp;&amp; (0 &lt; [finalResourcesPathArray count]) &amp;&amp; ((1 &lt; [finalResourcesPathArray count]) || (![[finalResourcesPathArray objectAtIndex:0] isEqual:@&quot;English.lproj&quot;]))) {
                    chdir([[[NSBundle mainBundle] resourcePath] fileSystemRepresentation]);
                }
            }
        }
    }
   
   /* Force the creation of our input device list now. Doing this at a
      latter time screws up mouse down detection... */
   if (__glutGetNumberOfMouseButtons() &lt; 3) { /* if we have less than a 3 button mouse we should emulate one */
        __glutEmulateMouseButtons = YES;
    }
    
        /* set default window management options */
    if (NO == __glutUseExtendedDesktop) {
        NSScreen * screenWithMenubar = [[NSScreen screens] objectAtIndex: 0];
        __glutScreenWidth = (int) [screenWithMenubar frame].size.width;
        __glutScreenHeight = (int) [screenWithMenubar frame].size.height;
        __glutDefaultColorSize = NSBitsPerPixelFromDepth([screenWithMenubar depth]);
        // Pick the closest depth to 16 or 32.
        if (__glutDefaultColorSize &lt;= 16)
            __glutDefaultColorSize = 16;
        else
            __glutDefaultColorSize = 32;
    } else { // look at all screens
        NSEnumerator *enumerator = [[NSScreen screens] objectEnumerator];
        NSScreen *    screen = nil;
        float left = 0, right = 0, top = 0, bottom = 0, colorSize = 16;
        while (nil != (screen = (NSScreen *)[enumerator nextObject])) {
            if([screen frame].origin.x &lt; left)
                left = [screen frame].origin.x;
            if([screen frame].origin.y &lt; top)
                top = [screen frame].origin.y;
            if(([screen frame].origin.x + [screen frame].size.width) &gt; right)
                right = ([screen frame].origin.x + [screen frame].size.width);
            if(([screen frame].origin.y + [screen frame].size.height) &gt; bottom)
                bottom = ([screen frame].origin.y + [screen frame].size.height);
            if (NSBitsPerPixelFromDepth([screen depth]) &gt; colorSize) // pick deepest depth   ggs: this does not support deep displays currently
                colorSize = 32;
        }
        __glutScreenWidth = right - left;
        __glutScreenHeight = bottom - top;
        __glutDefaultColorSize = colorSize;
    }
    
   if(geometry) {
      int    flags, x = 0, y = 0, width = 0, height = 0;
      
      flags = XParseGeometry(geometry, &amp;x, &amp;y, (unsigned int *) &amp;width, (unsigned int *) &amp;height);
      if(WidthValue &amp; flags) {
                /* Careful because X does not allow zero or negative width windows */
            if(width &gt; 0)
                __glutInitWidth = width;
      }
      if(HeightValue &amp; flags) {
                /* Careful because X does not allow zero or negative height windows */
            if(height &gt; 0)
                __glutInitHeight = height;
      }
      glutInitWindowSize(__glutInitWidth, __glutInitHeight);
      
      if(XValue &amp; flags) {
         if (NO == __glutUseMacOSCoords) {
            if(XNegative &amp; flags)
                x = __glutScreenWidth + x - __glutInitWidth;
            if(x &gt;= 0)
                __glutInitX = x;
         } else
            __glutInitX = x;
      }
      if(YValue &amp; flags) {
         if (NO == __glutUseMacOSCoords) {
            if(YNegative &amp; flags)
                y = __glutScreenHeight + y - __glutInitHeight;
            if(y &gt;= 0)
                __glutInitY = y;
         } else
            __glutInitY = y;
         
      }
      glutInitWindowPosition(__glutInitX, __glutInitY);
   }
   __glutStartupTime = [NSDate timeIntervalSinceReferenceDate];
   
   /* check if GLUT_FPS env var is set */
   {
      const char *fps = getenv(&quot;GLUT_FPS&quot;);
      
      if (fps) {
         sscanf(fps, &quot;%d&quot;, (int *) &amp;__glutFPS);
         if (__glutFPS &lt;= 0)
            __glutFPS = 5000;  /* 5000 milliseconds */
      }
   }
   GLUTAPI_END
}

void __glutEngineInit (void) // inits glut engine based on current values
{
    // only thing that needs to be reset
    if (NO == __glutUseInitWD) {
        NSArray * fileArray = [[NSFileManager defaultManager] directoryContentsAtPath:[[NSBundle mainBundle] resourcePath]];
        // if there is a directory and it has more than one item or the only item is NOT named Contents
        if ((nil != fileArray) &amp;&amp; (0 &lt; [fileArray count]) &amp;&amp; ((1 &lt; [fileArray count]) || (![[fileArray objectAtIndex:0] isEqual:@&quot;Contents&quot;])))
            chdir([[[NSBundle mainBundle] resourcePath] fileSystemRepresentation]);
    }
    // reset screen width height and depth
    if (NO == __glutUseExtendedDesktop) {
        NSScreen * screenWithMenubar = [[NSScreen screens] objectAtIndex: 0];
        __glutScreenWidth = (int) [screenWithMenubar frame].size.width;
        __glutScreenHeight = (int) [screenWithMenubar frame].size.height;
        __glutDefaultColorSize = NSBitsPerPixelFromDepth([screenWithMenubar depth]);
        // Pick the closest depth to 16 or 32.
        if (__glutDefaultColorSize &lt;= 16)
            __glutDefaultColorSize = 16;
        else
            __glutDefaultColorSize = 32;
    } else { // look at all screens
        NSEnumerator *enumerator = [[NSScreen screens] objectEnumerator];
        NSScreen *    screen = nil;
        float left = 0, right = 0, top = 0, bottom = 0, colorSize = 16;
        while (nil != (screen = (NSScreen *)[enumerator nextObject])) {
            if([screen frame].origin.x &lt; left)
                left = [screen frame].origin.x;
            if([screen frame].origin.y &lt; top)
                top = [screen frame].origin.y;
            if(([screen frame].origin.x + [screen frame].size.width) &gt; right)
                right = ([screen frame].origin.x + [screen frame].size.width);
            if(([screen frame].origin.y + [screen frame].size.height) &gt; bottom)
                bottom = ([screen frame].origin.y + [screen frame].size.height);
            if (NSBitsPerPixelFromDepth([screen depth]) &gt; colorSize) // pick deepest depth   ggs: this does not support deep displays currently
                colorSize = 32;
        }
        __glutInitWindowSizeCalled = true;
        __glutScreenWidth = right - left;
        __glutScreenHeight = bottom - top;
        __glutDefaultColorSize = colorSize;
    }
}


void APIENTRY glutInitWindowPosition(int x, int y)
{
   __glutInitX = x;
   __glutInitY = y;
   __glutInitWindowPositionCalled = true;
}

void APIENTRY glutInitWindowSize(int width, int height)
{
   __glutInitWidth = width;
   __glutInitHeight = height;
   
   if(width &lt;= 0)
      __glutInitWidth = 300;
   if(height &lt;= 0)
      __glutInitHeight = 300;
   __glutInitWindowSizeCalled = true;
}

void APIENTRY  glutInitDisplayMode(unsigned int mask)
{
   __glutDisplayMode = mask;
}
/* ENDCENTRY */


static void removeArgs(int *argcp, char **argv, int numToRemove)
{
    int i, j;

    for(i = 0, j = numToRemove; argv[j]; i++, j++)
        argv[i] = argv[j];

    argv[i] = NULL;
    *argcp -= numToRemove;
}


/* the following function was lifted from the X sources as indicated. */

/* Copyright     Massachusetts Institute of Technology  1985, 1986, 1987 */
/* $XConsortium: XParseGeom.c,v 11.18 91/02/21 17:23:05 rws Exp $ */

/*
Permission to use, copy, modify, distribute, and sell this software and its
documentation for any purpose is hereby granted without fee, provided that
the above copyright notice appear in all copies and that both that
copyright notice and this permission notice appear in supporting
documentation, and that the name of M.I.T. not be used in advertising or
publicity pertaining to distribution of the software without specific,
written prior permission.  M.I.T. makes no representations about the
suitability of this software for any purpose.  It is provided &quot;as is&quot;
without express or implied warranty.
*/

/*
 *    XParseGeometry parses strings of the form
 *   &quot;=&lt;width&gt;x&lt;height&gt;{+-}&lt;xoffset&gt;{+-}&lt;yoffset&gt;&quot;, where
 *   width, height, xoffset, and yoffset are unsigned integers.
 *   Example:  &quot;=80x24+300-49&quot;
 *   The equal sign is optional.
 *   It returns a bitmask that indicates which of the four values
 *   were actually found in the string.  For each value found,
 *   the corresponding argument is updated;  for each value
 *   not found, the corresponding argument is left unchanged. 
 */

static int ReadInteger(char *string, char **NextString)
{
    register int Result = 0;
    int Sign = 1;
    
    if (*string == '+')
    string++;
    else if (*string == '-')
    {
    string++;
    Sign = -1;
    }
    for (; (*string &gt;= '0') &amp;&amp; (*string &lt;= '9'); string++)
    {
    Result = (Result * 10) + (*string - '0');
    }
    *NextString = string;
    if (Sign &gt;= 0)
    return (Result);
    else
    return (-Result);
}

static int XParseGeometry(char *string, int *x, int *y, unsigned int *width, unsigned int *height)
{
    int                    mask = NoValue;
    register char *    strind;
    unsigned int        tempWidth = 0, tempHeight = 0;
    int                    tempX = 0, tempY = 0;
    char *                nextCharacter;
    
    if ( (string == NULL) || (*string == '\0')) return(mask);
    if (*string == '=')
        string++;  /* ignore possible '=' at beg of geometry spec */
    
    strind = (char *)string;
    if (*strind != '+' &amp;&amp; *strind != '-' &amp;&amp; *strind != 'x') {
        tempWidth = ReadInteger(strind, &amp;nextCharacter);
        if (strind == nextCharacter) 
            return (0);
        strind = nextCharacter;
        mask |= WidthValue;
    }
    
    if (*strind == 'x' || *strind == 'X') {    
        strind++;
        tempHeight = ReadInteger(strind, &amp;nextCharacter);
        if (strind == nextCharacter)
            return (0);
        strind = nextCharacter;
        mask |= HeightValue;
    }
    
    if ((*strind == '+') || (*strind == '-')) {
        if (*strind == '-') {
              strind++;
            tempX = -ReadInteger(strind, &amp;nextCharacter);
            if (strind == nextCharacter)
                return (0);
            strind = nextCharacter;
            mask |= XNegative;
        
        }
        else
        {    strind++;
            tempX = ReadInteger(strind, &amp;nextCharacter);
            if (strind == nextCharacter)
                return(0);
            strind = nextCharacter;
        }
        mask |= XValue;
        if ((*strind == '+') || (*strind == '-')) {
            if (*strind == '-') {
                strind++;
                tempY = -ReadInteger(strind, &amp;nextCharacter);
                if (strind == nextCharacter)
                        return(0);
                strind = nextCharacter;
                mask |= YNegative;
            
            }
            else
            {
                strind++;
                tempY = ReadInteger(strind, &amp;nextCharacter);
                if (strind == nextCharacter)
                        return(0);
                strind = nextCharacter;
            }
            mask |= YValue;
        }
    }
    
    /* If strind isn't at the end of the string the it's an invalid
        geometry specification. */

    if (*strind != '\0') return (0);

    if (mask &amp; XValue)
        *x = tempX;
     if (mask &amp; YValue)
        *y = tempY;
    if (mask &amp; WidthValue)
            *width = tempWidth;
    if (mask &amp; HeightValue)
            *height = tempHeight;
    return (mask);
}
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/glut/listing104.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/glut/listing104.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/glut/listing104.html%3Fid%3DDTS10000528-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>