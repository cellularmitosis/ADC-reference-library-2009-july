<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Custom_HIView_Tutorial - /0_Tutorial/Value and State.html</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxHumanInterfaceToolbox-date.html">Human Interface Toolbox</a> &gt; <A HREF="javascript:location.replace('index.html');">Custom_HIView_Tutorial</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Custom_HIView_Tutorial</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/0_Tutorial/Value and State.html</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/0_ Tutorial Start Here.html</option>
<option value="listing2.html">/0_Tutorial/Conclusion.html</option>
<option value="listing3.html">/0_Tutorial/Custom Cursor.html</option>
<option value="listing4.html">/0_Tutorial/Drag and Drop.html</option>
<option value="listing5.html">/0_Tutorial/Minimum Requirements.html</option>
<option value="listing6.html">/0_Tutorial/Skeleton Tester.html</option>
<option value="listing7.html">/0_Tutorial/Tracking.html</option>
<option value="listing8.html">/0_Tutorial/Value and State.html</option>
<option value="listing9.html">/1_Definition_Registration_Drawing/HICustomView.c</option>
<option value="listing10.html">/1_Definition_Registration_Drawing/HICustomView.h</option>
<option value="listing11.html">/1_Definition_Registration_Drawing/HICustomView_Tester.c</option>
<option value="listing12.html">/1_Definition_Registration_Drawing/HICustomView_Tester.h</option>
<option value="listing13.html">/1_Definition_Registration_Drawing/main.c</option>
<option value="listing14.html">/2_Value_State/HICustomView.c</option>
<option value="listing15.html">/2_Value_State/HICustomView.h</option>
<option value="listing16.html">/2_Value_State/HICustomView_Tester.c</option>
<option value="listing17.html">/2_Value_State/HICustomView_Tester.h</option>
<option value="listing18.html">/2_Value_State/main.c</option>
<option value="listing19.html">/3_Basic_Tracking/HICustomView.c</option>
<option value="listing20.html">/3_Basic_Tracking/HICustomView.h</option>
<option value="listing21.html">/3_Basic_Tracking/HICustomView_Tester.c</option>
<option value="listing22.html">/3_Basic_Tracking/HICustomView_Tester.h</option>
<option value="listing23.html">/3_Basic_Tracking/main.c</option>
<option value="listing24.html">/4_Custom_Tracking/HICustomView.c</option>
<option value="listing25.html">/4_Custom_Tracking/HICustomView.h</option>
<option value="listing26.html">/4_Custom_Tracking/HICustomView_Tester.c</option>
<option value="listing27.html">/4_Custom_Tracking/HICustomView_Tester.h</option>
<option value="listing28.html">/4_Custom_Tracking/main.c</option>
<option value="listing29.html">/5_Tracking_Area/HICustomView.c</option>
<option value="listing30.html">/5_Tracking_Area/HICustomView.h</option>
<option value="listing31.html">/5_Tracking_Area/HICustomView_Tester.c</option>
<option value="listing32.html">/5_Tracking_Area/HICustomView_Tester.h</option>
<option value="listing33.html">/5_Tracking_Area/main.c</option>
<option value="listing34.html">/6_Drag_and_Dropping/HICustomView.c</option>
<option value="listing35.html">/6_Drag_and_Dropping/HICustomView.h</option>
<option value="listing36.html">/6_Drag_and_Dropping/HICustomView_Tester.c</option>
<option value="listing37.html">/6_Drag_and_Dropping/HICustomView_Tester.h</option>
<option value="listing38.html">/6_Drag_and_Dropping/main.c</option></select>
				</p>
				</form>
				<p><strong><a href="Custom_HIView_Tutorial.zip">Download Sample</a></strong> (&#147;Custom_HIView_Tutorial.zip&#148;, 1012.9K)<BR>
<strong><a href="Custom_HIView_Tutorial.dmg">Download Sample</a></strong> (&#147;Custom_HIView_Tutorial.dmg&#148;, 1.24M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;
        &quot;http://www.w3.org/MarkUp/Wilbur/HTML32.dtd&quot;&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
  &lt;title&gt;Support for Value and State&lt;/title&gt;
  &lt;meta name=&quot;generator&quot; content=&quot;BBEdit 8.2&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt;
&lt;!--
.mybox {
  background-color: #F7F7F7;
  margin: 4px;
  padding: 4px;
  border: 1px solid #999999;
}
--&gt;
&lt;!--
.mycodebox {
  background-color: #F1F5F9;
  margin: 4px;
  padding: 4px;
  border: 1px solid #999999;
}
--&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;
Tutorial: Writing a custom HIView
&lt;/h1&gt;

&lt;h2&gt;
B) Implementing support for value and state
&lt;/h2&gt;

&lt;p&gt;
Supporting the changes of value or state is, again, very easy.
&lt;/p&gt;

&lt;p&gt;
In the kEventControlDraw code above, the same thing (a circle) is drawn no matter what the value of the HIView is. We can just replace the line:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
 CGContextAddArc(context, cx, cy, minDim, 0, 2 * pi, true);
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
with:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
 // having some fun with geometric shapes based on the value of the custom view
 UInt32 i, n = GetControl32BitValue(myData-&gt;view);
 switch (n)
    {
    case 0: CGContextAddArc(context, cx, cy, minDim, 0, 2 * pi, true); break;
    case 1: CGContextAddEllipseInRect(context, CGRectInset(bounds, bounds.size.width * 0.4, 0)); break;
    default:
  {
  float deltangle = pi / n, angle = 0, r = minDim / 2;
  CGContextMoveToPoint(context, cx + minDim, cy);
  for (i = 0; i &lt; n; i++)
     {
     angle += deltangle;
     CGContextAddLineToPoint(context, cx + r * cos(angle), cy + r * sin(angle));
     angle += deltangle;
     CGContextAddLineToPoint(context, cx + minDim * cos(angle), cy + minDim * sin(angle));
     }
  CGContextAddLineToPoint(context, cx + minDim, cy);
  }
    }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And we will get the following display for value 17:
&lt;/p&gt;

&lt;img src=&quot;../0_Tutorial/Picture%202.png&quot; alt=&quot;&quot; width=&quot;536&quot; height=&quot;469&quot;&gt;

&lt;p&gt;
For the states (active, enable, hilite), we just change the color settings:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
 // setting our colors according to state: IsControlEnabled, IsControlActive, IsControlHilited
 if (!IsControlEnabled(myData-&gt;view))
    {
    CGContextSetRGBFillColor(context, 0.3, 0.3, 0.3, 0.8);
    CGContextSetRGBStrokeColor(context, 0.5, 0.5, 0.5, 0.8);
    }
 else if (!IsControlActive(myData-&gt;view))
    {
    CGContextSetRGBFillColor(context, 0.7, 0.7, 0.7, 0.8);
    CGContextSetRGBStrokeColor(context, 0.8, 0.8, 0.8, 0.8);
    }
 else if (!IsControlHilited(myData-&gt;view))
    {
    CGContextSetRGBFillColor(context, 1, 0, 0, 0.8);
    CGContextSetRGBStrokeColor(context, 0, 0, 1, 0.8);
    }
 else
    {
    CGContextSetRGBFillColor(context, 0.7, 0, 0, 0.8);
    CGContextSetRGBStrokeColor(context, 0, 0, 0.7, 0.8);
    }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And we will get the following display when the HIView is disabled:
&lt;/p&gt;

&lt;img src=&quot;../0_Tutorial/Picture%203.png&quot; alt=&quot;&quot; width=&quot;535&quot; height=&quot;469&quot;&gt;

&lt;p&gt;
The last thing we have to do is to generate a redraw event whenever the custom HIView&rsquo;s value or state changes.
&lt;/p&gt;

&lt;div class=&quot;mybox&quot;&gt;
&lt;strong&gt;Note: This is a radical change from the old style controls if you have been working with them in the past. Most APIs such as SetControlValue, HiliteControl, SetControlMaximum could and would most of the time redraw the control immediately. This meant that if you were calling those 3 APIs in a row for example, the control would be redrawn 3 times in a row. This was generating flicker and was detrimental to the overall performance. In the new world of HIViews, all those APIs just change the private data of the HIView and it is the responsibility of the HIView to issue a redraw event if there is a need for it: for example, changing the maximum value from 100 to 50 when the current value is 25 may need a redrawing (as the slider or scrollbar do) or not (as an indeterminate progress bar). The APIs to call to request a redraw event are HIViewSetNeedsDisplay and its variant forms.
&lt;/strong&gt;&lt;/div&gt;

&lt;p&gt;
To be alerted of any change of the value or state, we just intercept 2 more Carbon Events: kEventControlValueFieldChanged and kEventControlHiliteChanged. So we change the static EventTypeSpec kFactoryEvents[] declaration in the function GetHICustomViewClass to:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
static EventTypeSpec kFactoryEvents[] =
  {
     { kEventClassHIObject, kEventHIObjectConstruct },
     { kEventClassHIObject, kEventHIObjectDestruct },
     { kEventClassControl, kEventControlDraw },
     { kEventClassControl, kEventControlValueFieldChanged },
     { kEventClassControl, kEventControlHiliteChanged }
  };
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And we add 2 more cases in our case kEventClassControl switch in the function Internal_HICustomViewHandler:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
case kEventControlValueFieldChanged:
case kEventControlHiliteChanged:
  {
  // just asking for a redraw
  HIViewSetNeedsDisplay(myData-&gt;view, true);
  break;
  }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
That&rsquo;s it for the support of value and state, it&rsquo;s all in the kEventControlDraw handler which is really the center piece of your custom HIView. You can test the custom HIView for this step by using the project located in the folder &ldquo;2_Value_State&rdquo;, and you will see that now, all the Tester controls from the &ldquo;SetNeedsDisplay true&rdquo; push button to the &ldquo;Active&rdquo; check box have an immediate effect on the display of the custom HIView.
&lt;/p&gt;

&lt;br&gt;

&lt;a href=&quot;../0_Tutorial/Tracking.html&quot;&gt;Next Page
&lt;/a&gt;

&lt;br&gt;
&lt;br&gt;

&lt;a href=&quot;../0_Tutorial/Minimum%20Requirements.html&quot;&gt;Previous Page
&lt;/a&gt;

&lt;br&gt;
&lt;br&gt;

&lt;a href=&quot;../0_%20Tutorial%20Start%20Here.html&quot;&gt;Return to Main Page
&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Custom_HIView_Tutorial/listing8.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Custom_HIView_Tutorial/listing8.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Custom_HIView_Tutorial/listing8.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>