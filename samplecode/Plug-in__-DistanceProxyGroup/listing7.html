<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Plug-in  -DistanceProxyGroup - /src/dpg.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Plug-in  -DistanceProxyGroup</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Plug-in  -DistanceProxyGroup</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/src/dpg.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/DPGPre.h</option>
<option value="listing2.html">/header/dpg.h</option>
<option value="listing3.html">/header/DPGGroup.h</option>
<option value="listing4.html">/header/dpgIO.h</option>
<option value="listing5.html">/header/dpgMemory.h</option>
<option value="listing6.html">/header/dpgSortedArray.h</option>
<option value="listing7.html">/src/dpg.c</option>
<option value="listing8.html">/src/dpgIO.c</option>
<option value="listing9.html">/src/dpgMemory.c</option>
<option value="listing10.html">/src/dpgSortedArray.c</option>
<option value="listing11.html">/src/dpgStubs.c</option></select>
				</p>
				</form>
				<p><strong><a href="Plug-in__-DistanceProxyGroup.zip">Download Sample</a></strong> (&#147;Plug-in__-DistanceProxyGroup.zip&#148;, 42.1K)<BR>
<strong><a href="Plug-in__-DistanceProxyGroup.dmg">Download Sample</a></strong> (&#147;Plug-in__-DistanceProxyGroup.dmg&#148;, 102.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/****************************************************************************** **                                       ** **   Module:    dpg.c                            ** **                                      ** **                                      **                                   ** **                                      ** **   Copyright (C) 1996-1996 Apple Computer, Inc.  All rights reserved.   ** **                                      ** **                                      ** *****************************************************************************/#include &quot;DPGGroup.h&quot;#include &quot;QD3D.h&quot;#include &quot;QD3DCamera.h&quot;#include &quot;QD3DMath.h&quot;#include &quot;QD3DView.h&quot;#include &quot;QD3DExtension.h&quot;#include &quot;QD3DGroup.h&quot;#include &quot;dpg.h&quot;#include &quot;dpgIO.h&quot;#include &quot;dpgMemory.h&quot;#include &quot;dpgSortedArray.h&quot;typedef struct TQ3DPGData{  TQ3Point3D     refPt;  unsigned long   flag;} TQ3DPGData;static unsigned long EgSharedLibrary = NULL;OSErr      DPGInitialize(const CFragInitBlock *initBlock);TQ3Status   DPGExit(void);  /****************************************************************************** **     **    Static Prototypes **     *****************************************************************************/static TQ3XFunctionPointer exDistanceProxyGroup_MetaHandler(  TQ3XMethodType    methodType);static TQ3Boolean exDistanceProxyGroup_AcceptObject(  TQ3GroupObject    group,  TQ3Object      object);static TQ3GroupPosition exDistanceProxyGroup_AddObject(  TQ3GroupObject    group,  TQ3Object      object);  static TQ3GroupPosition exDistanceProxyGroup_AddObjectBefore(  TQ3GroupObject    group,  TQ3GroupPosition  position,  TQ3Object      object);  static TQ3GroupPosition exDistanceProxyGroup_AddObjectAfter(  TQ3GroupObject    group,  TQ3GroupPosition  position,  TQ3Object      object);static TQ3Status exDistanceProxyGroup_SetPositionObject(  TQ3GroupObject    group,  TQ3GroupPosition  position,  TQ3Object      object);  static TQ3Object exDistanceProxyGroup_RemovePosition(  TQ3GroupObject    group,  TQ3GroupPosition  position);static long exiDistanceProxyGroup_CompareDistance(  float        *key,  TQ3DistanceData    *data);  static TQ3Status exDistanceProxyGroup_AddDistance(  TQ3GroupObject              group,  TQ3DistanceProxyDisplayGroupPrivate    *gPriv,  TQ3GroupPosition            position,  float                  distance);static TQ3Boolean exDistanceProxyGroup_Find(  TQ3GroupObject    group,  TQ3GroupPosition  position);static TQ3Status exDistanceProxyGroup_CalculateDistance(  TQ3ViewObject            view,  TQ3DistanceProxyDisplayGroupPrivate  *gPriv);static TQ3Boolean exDistanceProxyGroup_Visible(  TQ3DistanceProxyDisplayGroupPrivate  *gPriv,  TQ3GroupPosition          position);static TQ3Status exDistanceProxyGroup_ProcessIO(  TQ3GroupObject            group,  TQ3DistanceProxyDisplayGroupPrivate  *gPriv);/****************************************************************************** **     **    Globals **     *****************************************************************************/TQ3XObjectClass EgDistanceProxyDisplayGroupClass;/****************************************************************************** **     **    DistanceProxy Group Routines **     *****************************************************************************/static TQ3Status iDPG_New(  TQ3GroupObject              group,  TQ3DistanceProxyDisplayGroupPrivate    *gPriv,  const TQ3DPGData            *gData){  group; /* Unused */      gPriv-&gt;d      = 0.0;  gPriv-&gt;refPt    = gData-&gt;refPt;  gPriv-&gt;flag      = gData-&gt;flag;      gPriv-&gt;distTblCnt  = 0;  gPriv-&gt;distTbl    = NULL;  gPriv-&gt;distIOTbl  = 0;  gPriv-&gt;distIOTblCnt  = NULL;  return kQ3Success;}static TQ3Status iDPG_Copy(  TQ3GroupObject            fromGroup,  TQ3DistanceProxyDisplayGroupPrivate  *fromPriv,  TQ3GroupObject            toGroup,  TQ3DistanceProxyDisplayGroupPrivate  *toPriv){  register long i;    toPriv-&gt;refPt      = fromPriv-&gt;refPt;  toPriv-&gt;flag      = fromPriv-&gt;flag;  toPriv-&gt;position     = NULL;    toPriv-&gt;distTbl      = NULL;  toPriv-&gt;distTblCnt    = 0;    toPriv-&gt;distIOTblCnt   = 0;  toPriv-&gt;distIOTbl     = dpgAlloc(sizeof(TQ3DistanceIOData)*fromPriv-&gt;distTblCnt);  if (!toPriv-&gt;distIOTbl) {    return kQ3Failure;  }    toPriv-&gt;distIOTblCnt   = fromPriv-&gt;distTblCnt;    for (i=0;i &lt; fromPriv-&gt;distTblCnt;i++) {    TQ3GroupPosition position;    register long index;        for (      Q3Group_GetFirstPosition(fromGroup, &amp;position), index = 0;       position != NULL;       index++)    {      if (position == fromPriv-&gt;distTbl[i].position)      {        toPriv-&gt;distIOTbl[i].distance = fromPriv-&gt;distTbl[i].distance;        toPriv-&gt;distIOTbl[i].index    = index;        break;      }      Q3Group_GetNextPosition(fromGroup, &amp;position);    }  }    return exDistanceProxyGroup_ProcessIO(toGroup, toPriv);  }static long exDistanceProxyGroup_CompareDistance(  float      *key,  TQ3DistanceData  *data){  float val = *key - data-&gt;distance;    if (fabs(val) &lt; ((float)1.19209290e-07))     return 0;    if (val &gt; 0.0)      return  1;  return -1;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_Register() * *  Comments:  Registers the class. *\*===========================================================================*/TQ3Status exDistanceProxyGroup_Register(  void){  TQ3ObjectType objectType = kQ3DisplayGroupTypeDistanceProxy;    EgDistanceProxyDisplayGroupClass =    Q3XObjectHierarchy_RegisterClass(      kQ3GroupTypeDisplay,      &amp;objectType,       &quot;Apple Computer Inc.:Display Group:DistanceProxyDisplayGroup&quot;,      exDistanceProxyGroup_MetaHandler,      NULL,      0,      sizeof(TQ3DistanceProxyDisplayGroupPrivate));    if (EgDistanceProxyDisplayGroupClass == NULL)    return kQ3Failure;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_New() * *  Comments:  Constructor *\*===========================================================================*/TQ3GroupObject exDistanceProxyGroup_New(  TQ3Point3D     *refPt,  unsigned long   flag){  TQ3DPGData data;    data.refPt = *refPt;  data.flag  = flag;    return    Q3XObjectHierarchy_NewObject(      EgDistanceProxyDisplayGroupClass,      (void *) &amp;data);}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_SetDistance() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_SetDistance(  TQ3GroupObject              group,  TQ3DistanceProxyDisplayGroupPrivate    *gPriv,  TQ3GroupPosition            position,  float                  distance){  unsigned long    index;  TQ3DistanceData   data;    data.position = position;  data.distance = distance;    /* set private position data */  {    TQ3DPGPositionPrivate *pPriv;    pPriv = DPG_POSITION_GETPRIVATE(group, position);    pPriv-&gt;flag   = kQ3True;    pPriv-&gt;distance = distance;  }    /* insertion sort */    if (dpgSortedArray_Search(      (void *)&amp;distance,      gPriv-&gt;distTbl,      gPriv-&gt;distTblCnt,      sizeof(TQ3DistanceData),      (dpgCompareFunction) exDistanceProxyGroup_CompareDistance,      &amp;index) == kQ3True)  {    /* duplicate distance, replace with new one */    TQ3Object       object;    TQ3GroupPosition   oldPosition;        oldPosition = gPriv-&gt;distTbl[index].position;        /* call DefaultRemovePosition */    {      TQ3XGroupRemovePositionMethod   method;      TQ3XObjectClass          objectClass;          objectClass = Q3XObjectHierarchy_FindClassByType(kQ3GroupTypeDisplay);          method = (TQ3XGroupRemovePositionMethod) Q3XObjectClass_GetMethod(                            objectClass,                             kQ3XMethodType_GroupRemovePosition);      object = (*method)(group, oldPosition);    }        if(object)      Q3Object_Dispose(object);        gPriv-&gt;distTbl[index] = data;        return kQ3Success;  }  else {    /* insert new data */        gPriv-&gt;distTbl = dpgRealloc(              gPriv-&gt;distTbl,               sizeof(TQ3DistanceData) * (gPriv-&gt;distTblCnt+1));    if (gPriv-&gt;distTbl == NULL)    {      return kQ3Failure;    }    dpgSortedArray_InsertElement(      gPriv-&gt;distTbl,       gPriv-&gt;distTblCnt,       sizeof(TQ3DistanceData),      &amp;data,      index);          gPriv-&gt;distTblCnt++;  }  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_AcceptObject() * *  Comments:   *\*===========================================================================*/static TQ3Boolean exDistanceProxyGroup_AcceptObject(  TQ3GroupObject    group,  TQ3Object      object){    group; /* Unused */  return Q3Object_IsDrawable(object);}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_AddObjectDistance() * *  Comments:   *\*===========================================================================*/TQ3GroupPosition exDistanceProxyGroup_AddObjectDistance(  TQ3GroupObject    group,  TQ3Object      object,  float        distance){  TQ3GroupPosition           position;  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  gPriv = DPG_GETPRIVATE(group);  /*position = EiGroup_DefaultAddObject(group, object);*/  {    TQ3XGroupAddObjectMethod   method;    TQ3XObjectClass        objectClass;        objectClass = Q3XObjectHierarchy_FindClassByType(kQ3GroupTypeDisplay);    method = (TQ3XGroupAddObjectMethod) Q3XObjectClass_GetMethod(                        objectClass,                         kQ3XMethodType_GroupAddObject);    position = (*method)(group, object);  }    exDistanceProxyGroup_SetDistance(group, gPriv, position, distance);    return position;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_SetFlag() * *  Comments:   *\*===========================================================================*/TQ3Status exDistanceProxyGroup_SetFlag(  TQ3GroupObject    group,  TQ3DPGFlag       flag){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  gPriv = DPG_GETPRIVATE(group);  gPriv-&gt;flag = flag;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_GetFlag() * *  Comments:   *\*===========================================================================*/TQ3Status exDistanceProxyGroup_GetFlag(  TQ3GroupObject    group,  TQ3DPGFlag       *flag){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  gPriv = DPG_GETPRIVATE(group);  *flag = gPriv-&gt;flag;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_SetReferencePoint() * *  Comments:   *\*===========================================================================*/TQ3Status exDistanceProxyGroup_SetReferencePoint(  TQ3GroupObject    group,  TQ3Point3D       *refPt){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  gPriv = DPG_GETPRIVATE(group);  gPriv-&gt;refPt = *refPt;;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_GetReferencePoint() * *  Comments:   *\*===========================================================================*/TQ3Status exDistanceProxyGroup_GetReferencePoint(  TQ3GroupObject    group,  TQ3Point3D       *refPt){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  gPriv = DPG_GETPRIVATE(group);  *refPt = gPriv-&gt;refPt;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_SetDistanceAtPosition() * *  Comments:   *\*===========================================================================*/TQ3Boolean exDistanceProxyGroup_SetDistanceAtPosition(  TQ3GroupObject    group,  TQ3GroupPosition  position,  float        distance){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  unsigned long             index;  TQ3DPGPositionPrivate         *pPriv;  gPriv = DPG_GETPRIVATE(group);    pPriv = DPG_POSITION_GETPRIVATE(group, position);  if (pPriv-&gt;flag)   {        pPriv-&gt;distance = distance;        /* now fix up the distance table */    if (dpgSortedArray_Search(        (void *)&amp;pPriv-&gt;distance,        gPriv-&gt;distTbl,        gPriv-&gt;distTblCnt,        sizeof(TQ3DistanceData),        (dpgCompareFunction) exDistanceProxyGroup_CompareDistance,        &amp;index) == kQ3True)    {      /* found it, now get rid of it */      dpgSortedArray_DeleteElement(        gPriv-&gt;distTbl,        gPriv-&gt;distTblCnt,        sizeof(TQ3DistanceData),        NULL,        index);          gPriv-&gt;distTblCnt--;            if (dpgSortedArray_Search(          (void *)&amp;distance,          gPriv-&gt;distTbl,          gPriv-&gt;distTblCnt,          sizeof(TQ3DistanceData),          (dpgCompareFunction) exDistanceProxyGroup_CompareDistance,          &amp;index) == kQ3False)      {        TQ3DistanceData   data;              data.position = position;        data.distance = distance;        dpgSortedArray_InsertElement(          gPriv-&gt;distTbl,           gPriv-&gt;distTblCnt,           sizeof(TQ3DistanceData),          &amp;data,          index);      }                gPriv-&gt;distTblCnt++;    }        return kQ3True;  }  return kQ3False;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_GetDistanceAtPosition() * *  Comments:   *\*===========================================================================*/TQ3Boolean exDistanceProxyGroup_GetDistanceAtPosition(  TQ3GroupObject    group,  TQ3GroupPosition  position,  float        *distance){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  TQ3DPGPositionPrivate         *pPriv;  gPriv = DPG_GETPRIVATE(group);  pPriv = DPG_POSITION_GETPRIVATE(group, position);  *distance = 0.0;    if (pPriv-&gt;flag)  {    *distance = pPriv-&gt;distance;    return kQ3True;  }    return kQ3False;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_RemovePosition() * *  Comments:   *\*===========================================================================*/static TQ3Object exDistanceProxyGroup_RemovePosition(  TQ3GroupObject    group,  TQ3GroupPosition  position){  unsigned long   index;  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  TQ3DPGPositionPrivate         *pPriv;  gPriv = DPG_GETPRIVATE(group);  pPriv = DPG_POSITION_GETPRIVATE(group, position);  if (pPriv-&gt;flag)  {    /* now remove distance entry */          if (dpgSortedArray_Search(      (void *)&amp;pPriv-&gt;distance,      gPriv-&gt;distTbl,      gPriv-&gt;distTblCnt,      sizeof(TQ3DistanceData),      (dpgCompareFunction) exDistanceProxyGroup_CompareDistance,      &amp;index) == kQ3True)    {      dpgSortedArray_DeleteElement(        gPriv-&gt;distTbl,        gPriv-&gt;distTblCnt,        sizeof(TQ3DistanceData),        NULL,        index);          gPriv-&gt;distTblCnt--;          dpgSortedArray_Resize(          (void **) &amp;gPriv-&gt;distTbl,          gPriv-&gt;distTblCnt,          sizeof(TQ3DistanceData));    }                  }  /* call DefaultRemovePosition */  {    TQ3XGroupRemovePositionMethod method;    TQ3XObjectClass        objectClass;        objectClass = Q3XObjectHierarchy_FindClassByType(kQ3GroupTypeDisplay);        method = (TQ3XGroupRemovePositionMethod) Q3XObjectClass_GetMethod(                          objectClass,                           kQ3XMethodType_GroupRemovePosition);    return (*method)(group, position);  }}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_EndRead() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_EndRead(  TQ3GroupObject  group){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;    gPriv = DPG_GETPRIVATE(group);      exDistanceProxyGroup_ProcessIO(group, gPriv);  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_StartState() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_StartState(  TQ3GroupObject  group,  TQ3ViewObject  view){  TQ3DisplayGroupState state;  Q3DisplayGroup_GetState(group, &amp;state);    if ((state &amp; kQ3DisplayGroupStateMaskIsInline) == 0)  {    if (Q3Push_Submit(view) == kQ3Failure)      return kQ3Failure;  }  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_EndState() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_EndState(  TQ3GroupObject  group,  TQ3ViewObject  view){  TQ3DisplayGroupState state;  Q3DisplayGroup_GetState(group, &amp;state);  if ((state &amp; kQ3DisplayGroupStateMaskIsInline) == 0)  {    if (Q3Pop_Submit(view) == kQ3Failure)      return kQ3Failure;  }  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_StartIterate() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_StartIterate(  TQ3GroupObject      group,  TQ3GroupPosition    *position,  TQ3Object        *object,  TQ3ViewObject      view){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  TQ3Status status;    gPriv = DPG_GETPRIVATE(group);  /* calculate current distance */  if (exDistanceProxyGroup_CalculateDistance(view, gPriv) == kQ3Failure)    return kQ3Failure;    *position = NULL;  *object    = NULL;    status = Q3Group_GetFirstPosition(group, position);  /* find first visible object */      while ((status != kQ3Failure) &amp;&amp;      *position &amp;&amp;      exDistanceProxyGroup_Find(group, *position) == kQ3False)   {    status = Q3Group_GetNextPosition(group, position);  }      if (status == kQ3Failure) {    *position = NULL;    return kQ3Failure;  }  /* nothing to draw */  if (*position == NULL)    return kQ3Success;    if (Q3Group_GetPositionObject(group, *position, object) == kQ3Failure)    return kQ3Failure;    if (exDistanceProxyGroup_StartState(group, view) == kQ3Failure)  {    Q3Object_Dispose(*object);    *object = NULL;    return kQ3Failure;  }  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_EndIterate() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_EndIterate(  TQ3GroupObject      group,  TQ3GroupPosition    *position,  TQ3Object        *object,  TQ3ViewObject      view){  TQ3Status status;  if (*object != NULL)  {    Q3Object_Dispose(*object);    *object = NULL;    status = Q3Group_GetNextPosition(group, position);    while (  (status == kQ3Success) &amp;&amp;         *position &amp;&amp;         (exDistanceProxyGroup_Find(group, *position) == kQ3False))     {      status = Q3Group_GetNextPosition(group, position);    }        if (*position == NULL || status == kQ3Failure)    {      return exDistanceProxyGroup_EndState(group, view);    }      return Q3Group_GetPositionObject(group, *position, object);  }    *position = NULL;  return exDistanceProxyGroup_EndState(group, view);}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_CalculateDistance() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_CalculateDistance(  TQ3ViewObject            view,  TQ3DistanceProxyDisplayGroupPrivate  *gPriv){  TQ3CameraObject   camera;  TQ3CameraPlacement  placement;  TQ3Matrix4x4    matrix;  TQ3Point3D      transPt;    Q3View_GetCamera (view, &amp;camera);  if (!camera)    return kQ3Failure;      Q3Camera_GetPlacement(camera, &amp;placement);  Q3Object_Dispose(camera);    if (Q3View_GetLocalToWorldMatrixState(view, &amp;matrix) == kQ3Failure)    return kQ3Failure;      Q3Point3D_Transform(&amp;gPriv-&gt;refPt, &amp;matrix, &amp;transPt);    /* found the distance */  gPriv-&gt;d = Q3Point3D_Distance(&amp;placement.cameraLocation, &amp;transPt);  /* now find the position to draw */    {      register long highElem  = gPriv-&gt;distTblCnt - 1;    register long midElem  = highElem / 2;    register long lowElem  = 0;    register long direction  = 1;      register TQ3DistanceData  *distTbl;        distTbl = gPriv-&gt;distTbl;    /* d &gt;= MAX distance so use last object */    if (gPriv-&gt;d &gt;= distTbl[highElem].distance &amp;&amp; gPriv-&gt;flag != kQ3DPG_ClipWhenFar)    {      gPriv-&gt;position = distTbl[highElem].position;      return kQ3Success;    }    /* d &lt; MIN distance so use first object */    if (gPriv-&gt;d &lt; distTbl[0].distance &amp;&amp; gPriv-&gt;flag != kQ3DPG_HideWhenNear)    {      gPriv-&gt;position = distTbl[0].position;      return kQ3Success;    }        /* d is in range, find the right object */    while (highElem &gt;= lowElem)    {      direction = gPriv-&gt;d - distTbl[midElem].distance;            if ((direction == 0) ||        (gPriv-&gt;d &gt;= distTbl[midElem-1].distance &amp;&amp;          gPriv-&gt;d &lt; distTbl[midElem].distance))      {        gPriv-&gt;position = distTbl[midElem].position;        return kQ3Success;      }              if (direction &gt; 0)        lowElem  = midElem + 1;      else        highElem = midElem - 1;              midElem = (highElem + lowElem) &gt;&gt; 1;    }  }  return kQ3Failure;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_Find() * *  Comments:   *\*===========================================================================*/static TQ3Boolean exDistanceProxyGroup_Find(  TQ3GroupObject      group,  TQ3GroupPosition    position){  TQ3DistanceProxyDisplayGroupPrivate  *gPriv;  TQ3DPGPositionPrivate         *pPriv;  gPriv = DPG_GETPRIVATE(group);  pPriv = DPG_POSITION_GETPRIVATE(group, position);  if (pPriv-&gt;flag == kQ3False)  {    /* it's a object that doesn't have a distance     ** assume it want to be drawn     */    return kQ3True;  }    if (position == gPriv-&gt;position)    return kQ3True;  else    return kQ3False;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_ProcessIO() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_ProcessIO(  TQ3GroupObject            group,  TQ3DistanceProxyDisplayGroupPrivate  *gPriv){  if (gPriv-&gt;distIOTbl)   {    TQ3GroupPosition position;    unsigned long index = 0;    unsigned long cnt   = 0;        for (Q3Group_GetFirstPosition(group, &amp;position); position != NULL;cnt++)    {      if (gPriv-&gt;distIOTbl[index].index == cnt)       {        if (exDistanceProxyGroup_SetDistance(          group,           gPriv,           position,           gPriv-&gt;distIOTbl[index].distance) == kQ3Failure)        {          gPriv-&gt;distTblCnt = 0;          dpgFree(gPriv-&gt;distTbl);          gPriv-&gt;distTbl = NULL;          return kQ3Failure;        }        index++;      }      Q3Group_GetNextPosition(group, &amp;position);    }       dpgFree(gPriv-&gt;distIOTbl);        gPriv-&gt;distIOTbl   = NULL;    gPriv-&gt;distIOTblCnt = 0;  }  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_PositionNew() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_PositionNew(  TQ3DPGPositionPrivate  *gPos,  TQ3Object        object,  const TQ3Boolean    *initData){  object; /* XXX Unused */    if (initData == NULL)    gPos-&gt;flag = kQ3False;  else    gPos-&gt;flag = *initData;    gPos-&gt;distance = 0.0;    return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_PositionCopy() * *  Comments:   *\*===========================================================================*/static TQ3Status exDistanceProxyGroup_PositionCopy(  TQ3DPGPositionPrivate  *srcGPos,  TQ3DPGPositionPrivate  *dstGPos){  *dstGPos = *srcGPos;  return kQ3Success;}/*===========================================================================*\ * *  Routine:  exDistanceProxyGroup_MetaHandler() * *  Comments:   *\*===========================================================================*/static TQ3XFunctionPointer exDistanceProxyGroup_MetaHandler(  TQ3XMethodType    methodType){  switch (methodType) {    case kQ3XMethodTypeObjectNew:      return (TQ3XFunctionPointer) iDPG_New;    case kQ3XMethodTypeObjectDuplicate:      return (TQ3XFunctionPointer) iDPG_Copy;    case kQ3XMethodTypeObjectRead:      return (TQ3XFunctionPointer) exDistanceProxyGroup_Read;    case kQ3XMethodTypeObjectTraverse:      return (TQ3XFunctionPointer) exDistanceProxyGroup_Traverse;    case kQ3XMethodTypeObjectWrite:              return (TQ3XFunctionPointer) exDistanceProxyGroup_Write;      case kQ3XMethodType_GroupAcceptObject:      return (TQ3XFunctionPointer) exDistanceProxyGroup_AcceptObject;    case kQ3XMethodType_GroupRemovePosition:      return (TQ3XFunctionPointer) exDistanceProxyGroup_RemovePosition;        case kQ3XMethodType_GroupStartIterate:      return (TQ3XFunctionPointer) exDistanceProxyGroup_StartIterate;    case kQ3XMethodType_GroupEndIterate:      return (TQ3XFunctionPointer) exDistanceProxyGroup_EndIterate;      case kQ3XMethodType_GroupEndRead:      return (TQ3XFunctionPointer) exDistanceProxyGroup_EndRead;      case kQ3XMethodType_GroupPositionSize:      return (TQ3XFunctionPointer)   sizeof(TQ3DPGPositionPrivate);    case kQ3XMethodType_GroupPositionNew:      return (TQ3XFunctionPointer)   exDistanceProxyGroup_PositionNew;    case kQ3XMethodType_GroupPositionCopy:      return (TQ3XFunctionPointer)   exDistanceProxyGroup_PositionCopy;        case kQ3XMethodTypeObjectIsDrawable:      return (TQ3XFunctionPointer) kQ3True;        default:      return (TQ3XFunctionPointer) NULL;  }}#if defined(OS_WIN32) &amp;&amp; OS_WIN32  /*===========================================================================*\   *   *  Routine:  DllMain()   *   *  Comments:  The Win32 extension entry point   *  \*===========================================================================*/  BOOL WINAPI _CRT_INIT(    HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved);  BOOL WINAPI DllMain(    HINSTANCE  hinstDLL,    DWORD    fdwReason,    LPVOID    lpvReserved)  {    TQ3XSharedLibraryInfo  sharedLibraryInfo;        if ((fdwReason == DLL_PROCESS_ATTACH) || (fdwReason == DLL_THREAD_ATTACH))      if (!_CRT_INIT(hinstDLL, fdwReason, lpvReserved))        return (FALSE);    if (fdwReason == DLL_PROCESS_ATTACH)    {      sharedLibraryInfo.registerFunction = exDistanceProxyGroup_Register;      sharedLibraryInfo.sharedLibrary = (unsigned long)hinstDLL;      if (Q3XSharedLibrary_Register(&amp;sharedLibraryInfo) == kQ3Success)         return TRUE;      else        return FALSE;    }    else if (fdwReason == DLL_PROCESS_DETACH || fdwReason == DLL_THREAD_DETACH)      if (!_CRT_INIT(hinstDLL, fdwReason, lpvReserved))        return (FALSE);    if (fdwReason == DLL_PROCESS_DETACH)    {      Q3XSharedLibrary_Unregister( (unsigned long)hinstDLL);      return TRUE;    }    return (TRUE);  }#endif /* OS_WIN32 */#if defined(OS_MACINTOSH) &amp;&amp; OS_MACINTOSHOSErr  DPGInitialize(const CFragInitBlock *  initBlock){  TQ3XSharedLibraryInfo  sharedLibraryInfo;      sharedLibraryInfo.registerFunction = exDistanceProxyGroup_Register;  sharedLibraryInfo.sharedLibrary = (unsigned long)initBlock-&gt;connectionID;  Q3XSharedLibrary_Register(&amp;sharedLibraryInfo);    EgSharedLibrary = (unsigned long)initBlock-&gt;connectionID;  return noErr;}TQ3Status DPGExit(void){  if( EgSharedLibrary != NULL ) {    Q3XSharedLibrary_Unregister(EgSharedLibrary);    EgSharedLibrary = NULL;  }      return kQ3Success;}#endif#if 0/* outdated */long DPG_Init(  void){    if (!Q3IsInitialized()) {      if (Q3Initialize() == kQ3Failure)    {      return 1;    }  }    if (exDistanceProxyGroup_Register() == kQ3Failure)  {    return 1;  }  return 0;}long DPG_Exit(  void){    return 0;}#endif</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Plug-in__-DistanceProxyGroup/listing7.html%3Fid%3DDTS10000121-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Plug-in__-DistanceProxyGroup/listing7.html%3Fid%3DDTS10000121-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Plug-in__-DistanceProxyGroup/listing7.html%3Fid%3DDTS10000121-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>