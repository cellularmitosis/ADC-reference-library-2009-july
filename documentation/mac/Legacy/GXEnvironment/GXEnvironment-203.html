<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Reading Collections From and Writing Collections to Disk(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING203></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-202.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-204.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-182.html"><B>Chapter 5 - Collection Manager</B></A> / <A HREF="GXEnvironment-188.html"><B>Using the Collection Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING203-0></A>
<H2><A NAME=MARKER-9-92></A>Reading Collections From and Writing Collections to Disk</H2>
 <A NAME=MARKER-2-93></A><A NAME=MARKER-2-94></A>The Collection Manager provides a number of methods for storing collections on disk:<P>
<UL>
<LI><A NAME=MARKER-2-95></A>You can store the collection's contents as a collection (<CODE>'cltn'</CODE>) resource and read the information into a collection object using the <CODE>GetNewCollection</CODE> function. For more information about the <CODE>'cltn'</CODE> resource, see <A HREF=GXEnvironment-272.html#MARKER-9-284>"The Collection Resource" beginning on page 5-102</A>, and for more information about the <CODE>GetNewCollection</CODE> function, see the description of that function on <A HREF=GXEnvironment-267.html#MARKER-9-269>page 5-99</A>. For an example of reading a collection object from a collection resource, see the next section, <A HREF=GXEnvironment-204.html#MARKER-9-100>"Reading a Collection From a Collection Resource."</A>
<LI>You can flatten a collection using the <CODE>FlattenCollection</CODE> function and provide a callback function that writes the blocks of flattened data to a file. You can unflatten this collection using the <CODE>UnflattenCollection</CODE> function, providing a callback function that reads blocks of data from the file. For more information about these functions, see <A HREF=GXEnvironment-202.html#MARKER-9-86>"Flattening and Unflattening a Collection" beginning on page 5-37</A> and the description of the <CODE>FlattenCollection</CODE> function on <A HREF=GXEnvironment-256.html#MARKER-9-235>page 5-88</A> and the description of the <CODE>UnflattenCollection</CODE> function on <A HREF=GXEnvironment-258.html#MARKER-9-242>page 5-90</A>.
<LI>You can flatten a collection to a handle using the <CODE>FlattenCollectionToHdl</CODE> function and write the contents of the handle to the resource fork of a file (using the Macintosh function <CODE>AddResource</CODE>) or to the data fork of a file (using the Macintosh function <CODE>FSWrite</CODE>). You can then read the contents of this file into a handle (using the Macintosh functions <CODE>GetResource</CODE> or <CODE>FSRead</CODE>) and unflatten the result using the <CODE>UnflattenCollectionFromHdl</CODE> function.<P>
</UL>
<DL>
<DT><B>IMPORTANT</B>
<DD>Although you may create a resource containing a flattened collection using the <CODE>FlattenCollectionToHdl</CODE> and <CODE>AddResource</CODE> functions, you cannot recreate the collection from this resource using the <CODE>GetNewCollection</CODE> function. The resource format created by the <CODE>FlattenCollectionToHdl</CODE> and <CODE>AddResource</CODE> functions is incompatible with the resource format expected by the <CODE>GetNewCollection</CODE> function.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 <A HREF=#MARKER-9-96>Listing 5-22</A> shows how to flatten a collection to a handle and then write the contents of the handle to the resource fork of a disk file.<P>
<B>Listing 5-22  <A NAME=MARKER-9-96></A>Flattening a collection to a disk file as a resource</B><P>
<PRE>
OSErr anErr;
Handle flattened;

/* write the collection out as a resource */

flattened = NewHandle(0);
anErr = FlattenCollectionToHdl(myCollection, flattened);

if (anErr == noErr) {
   AddResource(flattened, myType, myID, myName);
   anErr = ResError();
}
</PRE>
 <A HREF=#MARKER-9-97>Listing 5-23</A> shows how to flatten a collection to a handle and then write the contents of the handle to the data fork of a disk file.<P>
<B>Listing 5-23  <A NAME=MARKER-9-97></A>Flattening a collection to a data fork of a disk file</B><P>
<PRE>
OSErr anErr;
Handle flattened;
long theSize;

/* write the collection out to the data fork */

flattened = NewHandle(0);
anErr = FlattenCollectionToHdl(myCollection, flattened);

if (anErr == noErr) {
   theSize = GetHandleSize(flattened);
   anErr = FSWrite(refNum, theSize, *flattened);
}
</PRE>
 <A HREF=#MARKER-9-98>Listing 5-24</A> shows how to read a flattened collection from the resource fork of a disk file into a block of memory referenced by a Macintosh Memory Manager handle and then unflatten the information in that block of memory into a collection object.<P>
<B>Listing 5-24  <A NAME=MARKER-9-98></A>Unflattening a collection from a disk file as a resource</B><P>
<PRE>
Handle flattened;
Collection myCollection;

if (myCollection = NewCollection()) {

   /* read the collection in as a resource */

   flattened = GetResource(myType, myID);

   if ((anErr = ResError()) == noErr) {
   anErr = UnflattenCollectionFromHdl(myCollection, flattened);
   ReleaseResource(flattened);
   if (anErr == noErr)
      anErr = ResError();
   }
}
</PRE>
 <A HREF=#MARKER-9-99>Listing 5-25</A> shows how to read a flattened collection from the data fork of a disk file into a block of memory referenced by a Macintosh Memory Manager handle and then unflatten the information in that block of memory into a collection object.<P>
<B>Listing 5-25  <A NAME=MARKER-9-99></A>Unflattening a collection from the data fork of a disk file</B><P>
<PRE>
OSErr anErr;
Handle flattened;
Collection myCollection;

if (myCollection = NewCollection()) {

   /* read the collection in from the data fork */

   flattened = NewHandle(theSize);

   if ((anErr = MemError()) == noErr) {
      if ((anErr = FSRead(refNum, theSize, *flattened)) == noErr)
         anErr = UnflattenCollectionFromHdl(myCollection,
                                            flattened);
      DisposHandle(flattened);

   }
}
</PRE>
 To unflatten a collection using <A HREF=#MARKER-9-99>Listing 5-25</A>, you must know the size of the collection before you can unflatten it. If you don't know the size of the collection, you unflatten a collection using the callback function mechanism described in <A HREF=GXEnvironment-202.html#MARKER-9-86>"Flattening and Unflattening a Collection" beginning on page 5-37</A>.<P>
 For more information about the <CODE>FlattenCollectionToHdl</CODE> function and the <CODE>UnflattenCollectionFromHdl</CODE> function, see <A HREF=GXEnvironment-202.html#MARKER-9-86>"Flattening and Unflattening a Collection" beginning on page 5-37</A> as well as the descriptions of these functions starting on <A HREF=GXEnvironment-264.html#MARKER-9-262>page 5-97</A>.<P>
 For information about the Macintosh functions <CODE>AddResource</CODE> and <CODE>GetResource</CODE>, see the chapter "Resource Manager" in <I><A HREF="../../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>. For information about the Macintosh functions <CODE>FSRead</CODE> and <CODE>FSWrite</CODE>, see the chapter "File Manager" in <I><A HREF="../../Files/Files-2.html">Inside Macintosh: Files</A></I>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-202.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-204.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
