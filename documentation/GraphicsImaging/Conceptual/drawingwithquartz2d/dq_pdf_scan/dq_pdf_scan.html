<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz 2D Programming Guide: PDF Document Parsing</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="PDF Document Parsing"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001066-CH220" title="PDF Document Parsing"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../dq_intro/dq_intro.html#//apple_ref/doc/uid/TP30001066-CH201-TPXREF101">Quartz 2D Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_pdf/dq_pdf.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_ps_convert/dq_ps_convert.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001066-CH220-TPXREF101" title="PDF Document Parsing"></a><h1>PDF Document Parsing</h1><p>Quartz provides functions that let you inspect the PDF document structure and the content stream. Inspecting the document structure lets you read the entries in the document catalog and the contents associated with each entry. By recursively traversing the catalog, you can inspect the entire document. </p><p>A PDF content stream is just what its name suggests—a sequential stream of data such as <code>'BT 12 /F71 Tf (draw this text) Tj . . . '</code> where PDF operators and their descriptors are mixed with the actual PDF content. Inspecting the content stream requires that you access it sequentially. The functions for parsing PDF content streams are available starting in Mac OS X v10.4.</p><p>This chapter shows how to examine the structure of a PDF document and parse the contents of a PDF document.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-CJBDCGCB">Inspecting PDF Document Structure</a>
				
			<br/>
			
        
			
			
				<a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-DontLinkElementID_32">Parsing PDF Content</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001066-CH220-CJBDCGCB" title="Inspecting PDF Document Structure"></a><h2>Inspecting PDF Document Structure</h2><p>PDF files may contain multiple pages of images and text. You can use Quartz to access the metadata at the document and page levels as well as objects on a PDF page. This section provides a very brief introduction to the metadata you can access.</p><p>A PDF document object (<code>CGPDFDocument</code>) contains all the information that relates to a PDF document, including its catalog and contents. The entries in the catalog recursively describe the contents of the PDF document. You can access the contents of a PDF document catalog by calling the function <code>CGPDFDocumentGetCatalog</code>.</p><p>A PDF page object (<code>CGPDFPage</code>) represents a page in a PDF document and contains information that relates to a specific page, including the page dictionary and page contents. You can obtain a page dictionary by calling the function <code>CGPDFPageGetDictionary</code>.</p><p><span class="content_text">Figure 14-1</span> shows some of the metadata for a PDF document displayed by the Voyeur sample application. After you install the Xcode Tools CD, you can find the Xcode project for this application in:</p><p><code>/Developer/Examples/Quartz/PDF/Voyeur</code></p><p>The metadata shown in the figure describes the two images—the text and the image of the rooster—that make up the PDF file displayed in <span class="content_text"><a href="../dq_pdf/dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-CJBFGIAI">Figure 13-2</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH220-CJBGHIII" title="Figure 14-1Metadata for two images in a PDF file"></a><p><strong>Figure 14-1&nbsp;&nbsp;</strong>Metadata for two images in a PDF file</p><img src = "../Art/pdf_outline.gif" alt = "Metadata for two images in a PDF file" width="433" height="329"></div><br/><p>You can obtain much more useful information by accessing PDF metadata. The items in <span class="content_text">Figure 14-1</span> are just a sample. For example, you can check to see if a PDF has thumbnail images (shown in <span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-CJBHCIEB">Figure 14-2</a></span>) using the code shown in <span class="content_text">Listing 14-1</span>.</p><a name="//apple_ref/doc/uid/TP30001066-CH220-CJBGHHEE" title="Listing 14-1Code that gets a thumbnail view of a PDF"></a><p class="codesample"><strong>Listing 14-1&nbsp;&nbsp;</strong>Code that gets a thumbnail view of a PDF</p><div class="codesample"><table><tr><td scope="row"><pre>CGPDFDictionaryRef d;<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFStreamRef stream; // represents a sequence of bytes<span></span></pre></td></tr><tr><td scope="row"><pre>d = CGPDFPageGetDictionary(page);<span></span></pre></td></tr><tr><td scope="row"><pre>// check for thumbnail data<span></span></pre></td></tr><tr><td scope="row"><pre>if (CGPDFDictionaryGetStream (d, “Thumb”, &amp;stream)){<span></span></pre></td></tr><tr><td scope="row"><pre>    // get the data if it exists<span></span></pre></td></tr><tr><td scope="row"><pre>    data = CGPDFStreamCopyData (stream, &amp;format);<span></span></pre></td></tr></table></div><p>Quartz performs all the decryption and decoding of the data stream for you.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH220-CJBHCIEB" title="Figure 14-2Thumbnail images"></a><p><strong>Figure 14-2&nbsp;&nbsp;</strong>Thumbnail images</p><img src = "../Art/thumbs.gif" alt = "Thumbnail images" width="76" height="366"></div><br/><p>Quartz provides a number of functions that you can use to obtain individual values for items in the PDF metadata. You use the function <code>CGPDFObjectGetValue</code>, passing a <code>CGPDFObjectRef</code>, a PDF object type (<code>kCGPDFObjectTypeBoolean</code>, <code>kCGPDFObjectTypeInteger</code>, and so forth), and storage for the value. On return, the storage is filled with the value.</p><p>There are numerous other functions you can use to traverse the hierarchy of a PDF file to access the various nodes and their children. For example, the <code>CGPDFArray</code> functions (<code>CGPDFArrayGetBoolean</code>, <code>CGPDFArrayGetDictionary</code>, <code>CGPDFArrayGetInteger</code>, and so forth) let you access arrays of values to retrieve values of specific types. You can find out more about how to use these functions by looking at the Voyeur Xcode project and reading the PDF specification.</p><a name="//apple_ref/doc/uid/TP30001066-CH220-DontLinkElementID_32" title="Parsing PDF Content"></a><h2>Parsing PDF Content</h2><p>The PDF content stream contains operators that signify parts of a PDF content stream that may be of interest to your application. An operator either marks a single point or a sequence. An operator is specified as a tag that has a property list or an object associated with it. A tag specifies what the point or content sequence represents. A property list is a dictionary that contains key-value pairs specified by the PDF content creator. When you parse a PDF content stream, your application looks for any markers of interest, inspects the tag, property list, or object associated with the marker, and then performs any further processing that’s appropriate. Consult the <em>PDF Reference</em> for a complete list of PDF operators.</p><p>You use a CGPDFScanner object (<code><a href="../../../Reference/CGPDFScanner/Reference/reference.html#//apple_ref/c/tdef/CGPDFScannerRef" target="_top">CGPDFScannerRef</a></code> data type) to parse a PDF content stream. The CGPDFScanner invokes callbacks for any operator in the stream for which you have registered a callback.</p><p>You perform the following tasks to parse a content stream:</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJDABJE">“Write Callbacks for Operators.”</a></span> You need to write callbacks only for the operators you want to handle. </p></li><li class="li"><p><span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJHBBIE">“Create and Set Up the Operator Table.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJGFGHI">“Open the PDF Document.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJEBHJJ">“Scan the Content Stream For Each Page.”</a></span></p></li></ol><p>When it’s appropriate to do so, you need to make sure the you release the scanner, content stream, and operator table. </p><p>The following sections show how to parse a content stream to find <strong>marked-content operators</strong> (see <span class="content_text">Table 14-1</span>). Marked content operators represent only some of the PDF operators used in PDF content. When you write your own code, you’d look for the PDF operators appropriate for your application.</p><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJEDHID" title="Table 14-1Marked content operators represent some of the PDF operators that you can parse "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 14-1&nbsp;&nbsp;</strong>Marked content operators represent some of the PDF operators that you can parse </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Operator</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>MP</code></p></td><td ><p>A <strong>m</strong>arked <strong>p</strong>oint that has a tag associated with it.</p></td></tr><tr><td  scope="row"><p><code>DP</code></p></td><td ><p>A marked point that has a tag and a property list or object associated with it.</p></td></tr><tr><td  scope="row"><p><code>BMC</code></p></td><td ><p>Signals the start of a marked-content sequence (<strong>b</strong>egin <strong>m</strong>arked <strong>c</strong>ontent) and is paired with the <code>EMC</code> marker that signals the end of the sequence. Has a tag associated with it.</p></td></tr><tr><td  scope="row"><p><code>BDC</code></p></td><td ><p>Signals the start of a marked-content sequence and is paired with the <code>EMC</code> marker that signals the end of the sequence. Has a tag and a property list or object associated with it.</p></td></tr><tr><td  scope="row"><p><code>EMC</code></p></td><td ><p>Signals the end of a marked-content sequence (<strong>e</strong>nd <strong>m</strong>arked <strong>c</strong>ontent) that begins with a <code>BMC</code> or a <code>BDC</code> marker. This operator does not have a tag associated with it.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJDABJE" title="Write Callbacks for Operators"></a><h3>Write Callbacks for Operators</h3><p>When Quartz invokes your callback for a PDF operators, it passes a CGPDFScanner object and a pointer to any information needed by your callback. Typically, your callback retrieves any items associated with the operator. For example, the callback for the <code>MP</code> operator that’s shown in <span class="content_text">Listing 14-2</span> calls the function <code><a href="../../../Reference/CGPDFScanner/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFScannerPopName" target="_top">CGPDFScannerPopName</a></code> to retrieve the character string associated with the operator from the stack. If the code in the listing successfully retrieves the name from the scanner stack, it prints the name.</p><p>Quartz has an assortment of <code>CGPDFScannerPop</code> functions for retrieving objects, Boolean values, names, numbers, strings, arrays, dictionaries, and streams. Each function returns a Boolean value to indicate whether the item is retrieved successfully. </p><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJBCEFE" title="Listing 14-2A callback for the MP operator"></a><p class="codesample"><strong>Listing 14-2&nbsp;&nbsp;</strong>A callback for the MP operator</p><div class="codesample"><table><tr><td scope="row"><pre>static void<span></span></pre></td></tr><tr><td scope="row"><pre>op_MP (CGPDFScannerRef s, void *info)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    const char *name;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (!CGPDFScannerPopName(s, &amp;name))<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    printf("MP /%s\n", name);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJHBBIE" title="Create and Set Up the Operator Table"></a><h3>Create and Set Up the Operator Table</h3><p>A <code>CGPDFOperatorTable</code> object to stores PDF operator callback functions that you write. The function <code><a href="../../../Reference/CGPDFOperatorTable/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFOperatorTableCreate" target="_top">CGPDFOperatorTableCreate</a></code> creates an operator table, as shown in <span class="content_text">Listing 14-3</span>. After you create an operator table, you call the function <code><a href="../../../Reference/CGPDFOperatorTable/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFOperatorTableSetCallback" target="_top">CGPDFOperatorTableSetCallback</a></code> for each callback you want to add to the table. You pass the table, the string that specifies the PDF operator, and a pointer to callback function you write to handle that operator. You can name the callbacks whatever you’d like. Just make sure that the callback name you pass to the function <code><a href="../../../Reference/CGPDFOperatorTable/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFOperatorTableSetCallback" target="_top">CGPDFOperatorTableSetCallback</a></code> isn’t misspelled.</p><p>The code in <span class="content_text">Listing 14-3</span> sets a callback for each of the marked-content operators listed in <span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJEDHID">Table 14-1</a></span>. Your application would set callbacks only for those operators of interest. PDF operator strings are defined in the PDF Reference from Adobe.</p><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJIAJJC" title="Listing 14-3Code that creates and sets callbacks for an operator table"></a><p class="codesample"><strong>Listing 14-3&nbsp;&nbsp;</strong>Code that creates and sets callbacks for an operator table</p><div class="codesample"><table><tr><td scope="row"><pre>CGPDFOperatorTableRef myTable;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myTable = CGPDFOperatorTableCreate();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFOperatorTableSetCallback (myTable, "MP", &amp;op_MP);<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFOperatorTableSetCallback (myTable, "DP", &amp;op_DP);<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFOperatorTableSetCallback (myTable, "BMC", &amp;op_BMC);<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFOperatorTableSetCallback (myTable, "BDC", &amp;op_BDC);<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFOperatorTableSetCallback (myTable, "EMC", &amp;op_EMC);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJGFGHI" title="Open the PDF Document"></a><h3>Open the PDF Document</h3><p>Before you can scan the content of a PDF document, you need to open it. <span class="content_text">Listing 14-4</span> shows a code fragment that creates a CGPDFDocument object from a URL supplied to the code. Note that the listing is a code fragment, so that not all variables are declared. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJBBFGF" title="Listing 14-4Code that opens a PDF document from a URL"></a><p class="codesample"><strong>Listing 14-4&nbsp;&nbsp;</strong>Code that opens a PDF document from a URL</p><div class="codesample"><table><tr><td scope="row"><pre>CGPDFDocumentRef myDocument;<span></span></pre></td></tr><tr><td scope="row"><pre>myDocument = CGPDFDocumentCreateWithURL(url);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>if (myDocument == NULL) {<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        error ("can't open `%s'.", filename);<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease (url);<span></span></pre></td></tr><tr><td scope="row"><pre>        return EXIT_FAILURE;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease (url);<span></span></pre></td></tr><tr><td scope="row"><pre>if (CGPDFDocumentIsEncrypted (myDocument)) {<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (!CGPDFDocumentUnlockWithPassword (myDocument, "")) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf ("Enter password: ");<span></span></pre></td></tr><tr><td scope="row"><pre>        fflush (stdout);<span></span></pre></td></tr><tr><td scope="row"><pre>        password = fgets(buffer, sizeof(buffer), stdin);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (password != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>            buffer[strlen(buffer) - 1] = '\0';<span></span></pre></td></tr><tr><td scope="row"><pre>            if (!CGPDFDocumentUnlockWithPassword (myDocument, password))<span></span></pre></td></tr><tr><td scope="row"><pre>                error("invalid password.");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>if (!CGPDFDocumentIsUnlocked (myDocument)) {<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        error("can't unlock `%s'.", filename);<span></span></pre></td></tr><tr><td scope="row"><pre>        CGPDFDocumentRelease(myDocument);<span></span></pre></td></tr><tr><td scope="row"><pre>        return EXIT_FAILURE;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> if (CGPDFDocumentGetNumberOfPages(document) == 0) {<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        CGPDFDocumentRelease(document);<span></span></pre></td></tr><tr><td scope="row"><pre>        return EXIT_FAILURE;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates a CGPDFDocument object from a URL supplied to the code.</p></li><li class="li"><p>Checks to make sure that a CGPDFDocument object is created. If not, the code exits because it makes no sense to continue without a document.</p></li><li class="li"><p>Checks whether the document is encrypted. If the document is encrypted, the code attempts to open is using a blank password. If that fails, the code asks the user for a password and attempts to unlock the document with the password.</p></li><li class="li"><p>Checks whether the document is unlocked. Otherwise, the code exits.</p></li><li class="li"><p>Checks to make sure the document has at least one page. Otherwise, the code exits.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJEBHJJ" title="Scan the Content Stream For Each Page"></a><h3>Scan the Content Stream For Each Page</h3><p>The code fragment in <span class="content_text">Listing 14-5</span> scans each page in a document. When the scanner encounters one of the PDF operators for which you registered a callback, Quartz invokes your callback. A detailed explanation for each numbered line of code follows the listing. </p><a name="//apple_ref/doc/uid/TP30001066-CH220-BAJFDIDA" title="Listing 14-5Code that scans each page of a document"></a><p class="codesample"><strong>Listing 14-5&nbsp;&nbsp;</strong>Code that scans each page of a document</p><div class="codesample"><table><tr><td scope="row"><pre>int k;<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFPageRef myPage;<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFScannerRef myScanner;<span></span></pre></td></tr><tr><td scope="row"><pre>CGPDFContentStreamRef myContentStream;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>numOfPages = CGPDFDocumentGetNumberOfPages (myDocument);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>for (k = 0; k &lt; numOfPages; k++) {<span></span></pre></td></tr><tr><td scope="row"><pre>    myPage = CGPDFDocumentGetPage (myDocument, k + 1 );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    myContentStream = CGPDFContentStreamCreateWithPage (myPage);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    myScanner = CGPDFScannerCreate (myContentStream, myTable, NULL);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    CGPDFScannerScan (myScanner);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    CGPDFPageRelease (myPage);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    CGPDFScannerRelease (myScanner);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    CGPDFContentStreamRelease (myContentStream);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr><tr><td scope="row"><pre> CGPDFOperatorTableRelease(myTable);<span>// 9</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Gets the number of pages in the document that you previously opened. See <span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJGFGHI">“Open the PDF Document.”</a></span></p></li><li class="li"><p>Retrieves a page to scan. Page number start at <code>1</code>.</p></li><li class="li"><p>Creates a content stream for the page. </p></li><li class="li"><p>Creates a scanner for the content stream. You must pass the content stream and the operator table that you previously created and set with callbacks. See <span class="content_text"><a href="dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJHBBIE">“Create and Set Up the Operator Table.”</a></span> You can also optionally pass any data that your callbacks need.</p></li><li class="li"><p>Parses the content stream associated with the scanner. Quartz invokes your callback each time it encounters one of the operators for which you provided a callback.</p></li><li class="li"><p>Releases the page.</p></li><li class="li"><p>Releases the scanner.</p></li><li class="li"><p>Releases the content stream.</p></li><li class="li"><p>Releases the operator table after scanning all the pages in the PDF.</p></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_pdf/dq_pdf.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_ps_convert/dq_ps_convert.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf_scan/dq_pdf_scan.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf_scan/dq_pdf_scan.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf_scan/dq_pdf_scan.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>