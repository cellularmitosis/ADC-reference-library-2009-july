<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW520: AppleTalk Overview Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW520: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002574" title="AppleTalk Overview Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW520</div>
<div id="pageheadsub">AppleTalk Overview Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"> <a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>Documentation for creating an AppleTalk-aware network device</h2><p>Date Written:  1/12/93</p><p>Last reviewed:  6/14/93</p><p>Where can I find information for creating an AppleTalk-aware network device?</p><p>The <i>Inside AppleTalk</i> reference provides much of the protocol informationrequired for your device to communicate with networked Macintosh systems.Inside AppleTalk is available from APDA (#C0078LL/B).</p><p>For writing hardware device drivers, the <i>Macintosh AppleTalk ConnectionsProgrammer's Guide</i> discusses information on writing ADEVs and <code>'atlk'</code> anddriver resources. This guide helps one to understand the workings of the LinkAccess Protocol Manager, and how packets are handled to make sure they go outthrough the right port.</p><p>Apple doesn't provide information about the hardware design of anAppleTalk-aware device. In addition, information concerning the hardware layerof LocalTalk hasn't been made available other than that provided in <i>InsideAppleTalk.</i> The best source of information on this subject probably is fromthe Internet or some other N&amp;C development community. For Ethernetcompatible devices, some of the information that you'll need can be obtainedfrom the developer notes available from the vendors of Ethernet chips, such asNational Semiconductor, Inc., manufacturer of the SONIC chip.</p><p>Another useful tool for developing such a product is a network sniffer, so thatyou can watch the packet exchange between devices, and compare the exchangewith a similar AppleTalk device. This will help in determining whether yourdevice has correctly implemented the protocol. You can probably find productinformation regarding the various sniffers available by looking on the Redgateicon on AppleLink or in your favorite product catalog.</p><p><h2>Broadcasting to all internet nodes</h2><p>Date Written:  9/22/92</p><p>Last reviewed:  6/14/93</p><p>I want to send a Broadcast to all the nodes on an internet, whether EtherTalkor LocalTalk, when my application comes up. I'm not sure which AppleTalkprotocol to use. I tried using ALAP and DDP but couldn't get either to work.</p><p>Unfortunately, you can't broadcast to an entire AppleTalk internet. In order tolimit network overload, broadcast packets are localized. On AppleTalk, theydon't extend over zones and, on Ethernet, they don't cross bridges. What youmight do, however, is something roughly like the following:</p><p>Server side:</p><p>1. Initialize your application by creating a socket in the "server" addressrange:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>   ioParam.ioNamePtr = &quot;\p.MPP&quot;;   ioParam.ioMisc = (Ptr) 0x80000000;  /* Server flag */</pre>	</TD></TR></TABLE></CENTER><p>2. Create an ATP socket:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>   POpenATPSkt(&amp;atpParam, 0); /* Synchronous */</pre>	</TD></TR></TABLE></CENTER><p>3. Register your name. The NBP <code>objStr</code> should be the name of the system yourapplication is running on. You can use <code>GetString</code>(-16413) to get the system nameon System 7 (or -16096 to get the Chooser name). The NBP <code>typeString</code> should be aname unique to your application. Note: be sure to remove the name before yourapplication terminates. If you get error -1027 (nbpDuplicate), a previousinstance of your application terminated without removing the name. Just call<code>PRemoveName</code> and try again.</p><p>4. Your server should now post an <code>ATPRead</code> and wait for messages.</p><p>Client side:</p><p>The "client" is the part of your application that looks for servers. Thealgorithm is, roughly, as follows:</p><ol type="1">	<li>Use <code>GetZoneList</code> to get a complete list of AppleTalk zones. Make sure you handle the "no zones" case correctly.</li>	<li>For each zone, use <code>PLookupName</code> to get a list of servers with the NPB <code>typeStr</code> that the "server side" registered.</li>	<li>For each found entity, use <code>NBPExtract</code> to get the entity name and the addrBlock. The entity name gives you the "human readable" text that identifies the network zone and system name, while the <code>addrBlock</code> lets you send ATP messages to the other system.</li></ol><p>The AppleTalk program interface is described in <i>Inside Macintosh</i> VolumesV and VI. Use these as your primary reference, referring to <i>InsideMacintosh</i> Volume II only when necessary.</p><p>Note that you have to figure on at least 15 seconds per zone. This means that,if you're trying this algorithm on some huge network (like the Appleengineering network), your application will probably need over a half-hour toprobe every zone. The reason for mentioning this is that some applications areusing network-uniqueness as a form of user license enforcement. If you do this,it would be unfair to the honest user to stall the application for a half-hourto check for duplicates.</p><p>Another application use would be for systems that maintain a central server,such as for a database, that handles many clients. Here, you probably shouldask the user for the zone:node of the server, remember this in yourapplication's preference file, and look for that server.</p><p>One other thing: In writing this type of program, the <code>SetSelfSend</code> capability isextremely helpful: that way, you can debug both server and client functions onone machine - indeed in one application. Even if you don't normally use<code>SetSelfSend</code>, make sure your application handles it as it is a global state forall AppleTalk connections on the machine.</p><p><h2>How to get the User and Computer names used by AppleTalk</h2><p>Date Written:  11/27/91</p><p>Last reviewed:  6/14/93<b></b>I'd like to use the same names that the system uses to identify itself on theAppleTalk network in my program. Where can I find those names?</p><p>The names used by the system for network services are stored in two <code>'STR '</code>resources in the System file. Your program can retrieve those names with theResource Manager's <code>GetString</code> function.</p><p>Only one of the names is available in systems before System 7: the name set bythe Chooser desk accessory. That name is stored in <code>'STR '</code> resource ID -16096.With System 7, the Sharing Setup control panel lets the user assign two namesfor network services: the Owner name and the Computer name.</p><p>The Owner name is the name stored in <code>'STR '</code> resource ID -16096; it identifiesthe user of the Macintosh. The Owner name is used by System 7 for two primarypurposes: to identify the owner of the system when accessing the systemremotely through System 7 file sharing or through the user identity dialog usedby the PPC Toolbox (and Apple Event Manager), and to serve as the default username when logging on to other file servers with the Chooser.</p><p>The Computer name (also known as the Flagship name) is the name stored in <code>'STR'</code> resource ID -16413; it identifies the Macintosh. The Computer name is thename used by system network services to identify themselves on the AppleTalknetwork. For example, if your system's Computer name is "PizzaBox," the PPCToolbox registers the name "PizzaBox:PPCToolBox@*" when you start programlinking, and file sharing registers the name "PizzaBox:AFPServer@*" when youstart file sharing.</p><p><h2>Which AppleTalk routines can &amp; can't be called at interrupt time</h2><p>Date Written:  6/19/91</p><p>Last reviewed:  6/14/93</p><p>Can any AppleTalk routines be called at interrupt time? Inside Macintosh saysthat <code>DDPWrite</code> and <code>DDPRead</code> can't be called from interrupts. If all higher-levelAppleTalk protocols are based on DDP, it seems that they all would not work.</p><p>The AppleTalk routines you can't call at interrupt time are the originalAppleTalk Pascal Interfaces listed in Inside Macintosh Volume II; these arealso known as the "Alternate Interface" AppleTalk routines, or <code>ABPasIntf</code>.</p><p>The Alternate Interface routines cannot be called at interrupt time becausethey allocate the memory structures needed to make the equivalent assemblylanguage AppleTalk call. For example, when the <code>NBPLookup</code> routine is called,it's passed a handle to an <code>ABusRecord</code>. NBPLookup then has to allocate anMPPParamBlock and move the parameters from the ABusRecord into the newlyallocated MPPParamBlock. Then NBPLookup makes a LookupName call, passing it theMPPParamBlock. When LookupName completes, NBPLookup must move results into theABusRecord and release the memory used by the MPPParamBlock. Since memory isallocated and released within the routine, it cannot be called at interrupttime.</p><p>With that out of the way, the calls you can make at interrupt time (with somerestrictions listed below) are what Apple calls the "Preferred Interface"AppleTalk routines. Most of the Preferred Interface routines are listed on page562 of Inside Macintosh Volume V. There are a few additional calls that wereadded after the publication of Inside Macintosh Volume V; they're documented inthe AppleTalk chapter of Inside Macintosh Volume VI.</p><p>The Preferred Interface AppleTalk routines can be made at interrupt time aslong as:</p><ul type="disc">	<li>You make them asynchronously with a completion routine (that is, the asynch parameter must be TRUE and you must provide a pointer to the completion routine in the ioCompletion field of the call's parameter block). Making a call asynchronously and polling ioResult immediately afterward within the same interrupt-time code (which is basically the same as making the call synchronously) is not the same as using a completion routine.</li>	<li>They are not listed as routines that may move or purge memory. The Preferred Interface routines do not allocate or dispose of any memory, since they're just high-level ways to make the assembly language AppleTalk calls and are not built upon the old Alternate Interface routines.</li></ul><p>X-Ref:</p>Macintosh Technical Note <A HREF = "nw_05.html">"Using the High-Level AppleTalk Routines"</a><p>Macintosh Technical Note <A HREF = "nw_02.html">"AppleTalk Interface Update"</a><p>Macintosh Technical Note <A HREF = "nw_07.html">"Avoid Use of Network Events"</a><p><p><h2>AppleTalk and INITs</h2><p>Date Written:  9/5/91</p><p>Last reviewed:  6/14/93</p><p>Does AppleTalk work the same with an INIT as with an application? I'm usingonly Name Binding Protocol (NBP) and Datagram Delivery Protocol (DDP) stuff.</p><p>Yes! Responder is an example of an INIT that utilizes the NBP to register aMacintosh on the network. NBP requires DDP, so it is also present. AppleTalk isloaded before any INITs, which makes it available to them.</p><p><h2>Install AppleTalk with Installer instead of drag-installing</h2><p>Date Written:  12/3/91</p><p>Last reviewed:  6/14/93</p><p>We have problems using AppleTalk version 56 on a Macintosh Plus under System 6.The problems go away when we drop AppleTalk version 52 into the System Folder.What's going on?</p><p>AppleTalk version 56 isn't working for you because you just copied theAppleTalk file into the System Folder of your Macintosh with the Finder (thisis known as a "drag-install"). All versions of AppleTalk from version 53 upthrough the current version must be installed by an Installer script. If youdrag-install those versions of AppleTalk, several very important systemresources won't be copied into the System file and AppleTalk won't work.</p><p>Apple software products that require AppleTalk version 53 or greater alwaysinclude the Installer and Installer script that copy all system resourcesneeded correctly. Apple also supplies the source to an Installer script thatyou can use if you license AppleTalk to ship with your products. See the"AppleTalk Licensing Disk 3.2" folder on the latest Developer CD for a look atthe Installer script code. As usual, you'll need to contact Software Licensingat AppleLink address SW.LICENSE if you want to ship AppleTalk with yourproducts.</p><p><h2>Preferred AppleTalk calls and AppleTalk version</h2><p>Date Written:  1/8/92</p><p>Last reviewed: 6/14/93</p><p>Do I need AppleTalk version 48 to call AppleTalk routines using the preferredAppleTalk interface?</p><p>The preferred AppleTalk routines don't require AppleTalk version 48. You canmake any of the AppleTalk calls listed in <i>Inside Macintosh</i> Volume IIfrom a Macintosh Plus. To make .XPP driver calls listed in Inside MacintoshVolume V, you'll need to use AppleTalk version 48. To make the new AppleTalkcalls listed in <i>Inside Macintosh</i> Volume VI (and the Macintosh TechnicalNote "AppleTalk Phase 2 on the Macintosh"), you'll need version 53 or later. Tomake ADSP calls to the .DSP driver, you'll need to either install ADSP or useAppleTalk version 56 or later which includes the .DSP driver.</p><p><h2>Using AppleTalk self-send mode</h2><p>Date Written:  4/20/92</p><p>Last reviewed:  6/14/93</p><p>What's the recommended method for allowing an AppleTalk node to send packets toitself using AppleTalk's self-send mode (intranode delivery), assumingcustomers are running various versions of AppleTalk? There used to be a controlpanel called <code>SetSelfSend</code> that would turn on AppleTalk self-send mode at startuptime. Should we use that control panel or should we use the PSetSelfSendfunction in our program to set the self-send flag ourselves?</p><p>AppleTalk self-send mode requires AppleTalk version 48 or greater. You cancheck the AppleTalk version with Gestalt or <code>SysEnvirons</code>. All Macintosh modelsexcept for the Macintosh XL, 128, 512, and Plus have AppleTalk version 48 orgreater in ROM.</p><p>The <code>SetSelfSend</code> control panel is still available on the Developer CD Seriesdisc (Tools &amp; Apps:Intriguing Inits/cdevs/DAs:Pete'shacks-Moof!:SetSelfSend). However, we don't recommend it as a solution if youneed to use self-send mode in your program. Instead, you should use the<code>PSetSelfSend</code> function to turn self-send mode on with your program.</p><p>AppleTalk's self-send mode presents a problem. Any changes made to the state ofself-send will affect all other programs that use AppleTalk. That is, self-sendmode is global to the system. Because of this, programs using self-send shouldfollow these guidelines:</p><ul type="disc">	<li>If you need self-send for only a brief period of time (for example, to perform a <code>PLookupName</code> on your own node), you should turn it on with <code>PSetSelfSend</code> (saving the current setting returned in <code>oldSelfFlag</code>), make the call(s) that require self-send, and restore self-send to its previous state.</li>	<li>If you need self-send for an extended period of time (for example, the life of your application) in which your program will give up time to other programs, you should turn self-send on and leave it on - do not restore it to its previous state! Since other programs running on your system (that aren't well-behaved) may turn off self-send at any time, programs that require self-send should periodically check to make sure it's still on with either <code>PSetSelfSend</code> or <code>PGetAppleTalkInfo</code>. Apple's system software has no compatibility problems with self-send -- that is, it doesn't care if it's on or off -- so leaving it on won't hurt anything.</li></ul><p><h2>Documentation describing AppleTalk 56 and 57 differences</h2><p>Date Written:  8/14/92</p><p>Last reviewed:  6/14/93</p><p>What are the differences between AppleTalk 56 and 57 in terms of features, bugfixes, interface, and any technical changes related to driver interfaces?</p><p>The primary difference between the two versions of AppleTalk involves supportfor AppleTalk Remote Access, and multinodes. "Multinode" is the capability fora workstation to acquire a node ID separate from that of the workstation usernode. AppleTalk Remote Access uses a multinode to provide services for theremote connection via the modem. For more information concerning thedifferences between the two revisions, there are two documents that you shouldread. The Macintosh Technical Note "AppleTalk, the Rest of the Story" (formerly#311, "What's New With AppleTalk Phase 2") explains many of the changes. Youcan also read the release notes, located on the Developer CD by this path:</p><p>    Dev.CD Aug 92: Tools &amp; Apps: Networking &amp; Communications: AppleTalkRelease Notes:</p>    AppleTalk 56--&gt;57 Changes <p><p>This document discusses many of the bug fixes implemented in the new release.</p><p><h2>Different AppleTalk versions OK for nodes</h2><p>Date Written:  8/14/92</p><p>Last reviewed:  6/14/93</p><p>Is it OK for different nodes to run different versions of AppleTalk on anetwork?</p><p>You don't need to run the same version of AppleTalk for each node on thenetwork. However, AppleTalk versions 53 and greater support AppleTalk Phase 2,so if you're working on an application that depends on the Phase 2 support (forinstance, using the NBP wildcard character "~"), you'll need to use AppleTalkversion 53 or later for all nodes running that application.</p>                                   <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_520.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_520.html%3Fid%3DDTS10002574-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_520.html%3Fid%3DDTS10002574-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_520.html%3Fid%3DDTS10002574-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>