<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>RAVE Starter Samples - /RAVE CommonCode/RAVE Utilities.cp</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">RAVE Starter Samples</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">RAVE Starter Samples</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/RAVE CommonCode/RAVE Utilities.cp</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/CallBack Sample/Gouraud Callback.cp</option>
<option value="listing2.html">/Gouraud Sample/Gouraud Triangle.cp</option>
<option value="listing3.html">/RAVE CommonCode/Common Stuff.h</option>
<option value="listing4.html">/RAVE CommonCode/RAVE Utilities.cp</option>
<option value="listing5.html">/RAVE CommonCode/RAVE Utilities.h</option>
<option value="listing6.html">/Texture Sample/Texture Triangle.cp</option></select>
				</p>
				</form>
				<p><strong><a href="RAVE_Starter_Samples.zip">Download Sample</a></strong> (&#147;RAVE_Starter_Samples.zip&#148;, 49.3K)<BR>
<strong><a href="RAVE_Starter_Samples.dmg">Download Sample</a></strong> (&#147;RAVE_Starter_Samples.dmg&#148;, 110.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    RAVE Utilities.cp  Contains:  RAVE Utilities defines a number of useful functions for working with RAVE,        including functions to find the deepest GDevice, loading textures from a PICT        resource, and so on. Essentially, it defines a number of pieces of common code        that were useful to many of my projects.  Written by: Timothy Carroll    Copyright:  Copyright &copy;1996-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/15/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#include &lt;fp.h&gt;#include &quot;Rave Utilities.h&quot;#include &quot;common stuff.h&quot;#include &lt;Memory.h&gt;#include &lt;Resources.h&gt;/*****************************************************************************LOOKUP TABLESI use SIN and COS in a number of places, and we don't need perfect precision,so we generate a set of lookup tables on 0.5 degree increments.  Most of the3D math routines use these lookups to generate matrices.*****************************************************************************/float gSinArray[721]; // [720] = [0]float gCosArray[721]; // [720] = [0]OSStatus InitializeLookups(void){  int loop;    for (loop = 0; loop &lt; 720; loop++)  {    double angle = (loop * 0.5)/57.296;        gSinArray[loop] = sin (angle);    gCosArray[loop] = cos (angle);  }    gSinArray[720] = gSinArray[0];  gCosArray[720] = gCosArray[0];    return noErr;}/*****************************************************************************RAVE ENGINE FUNCTIONS  FindTextureMappingEngine walks the list of available engines and returnsthe first engine capable of Texture Mapping that will run on the device.GetListOfEngines creates a handle filled with references to all enginesavailable to the application that run on the GDevice passed in the routine.Pass in NULL to find all engines.*****************************************************************************/ TQAEngine  *FindTextureMappingEngine (TQADevice *device){  TQAEngine     *engine = NULL;  TQAError    theQAErr = kQANoErr;  unsigned long  features;    engine = QADeviceGetFirstEngine (device);    while (engine != NULL)  {    theQAErr = QAEngineGestalt (engine,                  kQAGestalt_OptionalFeatures,                   &amp;features);                      if ((theQAErr == kQANoErr) &amp;&amp; (features &amp; kQAOptional_Texture))      return engine;          engine = QADeviceGetNextEngine (device, engine);  }    // Failed to find an engine that supports texture mapping  return NULL;}OSStatus  GetListOfEngines (GDHandle screen, Handle *list, long *number){  OSStatus  theErr = noErr;  TQAError  theQAErr = kQANoErr;    long    loop, tempCount;  Handle    tempList;    // We need a device structure to build the list of engines.  // We only need to set it up if we were passed a GDevice.  TQADevice  device, *devicePtr = NULL;  TQAEngine  *engine;    if (screen)  {    device.deviceType = kQADeviceGDevice;    device.device.gDevice = screen;    devicePtr = &amp;device;  }  // We walk the list of engines twice.  First, we count the number// of engines, and allocate a handle large enough to hold the// engine references.  Second, we walk the list a second time and// stuff the handle.// The software engine should always be available, so I consider// a count of 0 to be an error.  tempCount = 0;  engine = QADeviceGetFirstEngine (devicePtr);  while (engine != NULL)  {    tempCount++;    engine = QADeviceGetNextEngine (devicePtr, engine);  }    if (tempCount == 0)    SIGNAL_ERROR (&quot;\pERROR: No Engines available for this GDevice&quot;)   // Allocate a handle for the list.  tempList = NewHandle (tempCount * sizeof (TQAEngine *));  theErr = MemError();  FAIL_OSERR (theErr, &quot;\pError:Unable to allocate a handle for the engine list&quot;)  FAIL_NIL(tempList, &quot;\pError:Unable to allocate a handle for the engine list&quot;)// Walk the list again and stuff the references into the handle  engine = QADeviceGetFirstEngine (devicePtr);    for (loop = 0; loop &lt; tempCount; loop++)  {    (*(TQAEngine ***)tempList)[loop] = engine;    engine = QADeviceGetNextEngine (devicePtr, engine);  }  // Everything went successfully, fill in the list and count and return no error;  *list = tempList;  *number = tempCount;    goto cleanup;error:// If an error occurred, clear the list and return the error.  if (theErr == noErr)    theErr = paramErr;      if (tempList)    DisposeHandle (tempList);        *list = NULL;  *number = 0;cleanup:    return theErr;}TQATexture  *LoadTextureFromPictResource (TQAEngine *engine, short pictID){  TQAError    theQAErr = kQANoErr;  OSStatus    theErr = noErr;  TQAImage    image;  TQATexture    *texture= NULL;    PicHandle    picture = NULL;  Rect      pictRect;  GWorldPtr    pictWorld = NULL;  PixMapHandle  pictPix = NULL;    CGrafPtr    savePort = NULL;  GDHandle    saveDevice = NULL;  // Load the texture from the resource;    picture = GetPicture (pictID);  theErr = ResError();  FAIL_NIL (picture, &quot;\pERROR: Failed to load the texture resource&quot;)  FAIL_OSERR (theErr,&quot;\pERROR: Failed to load the texture resource&quot;)  // for now, we assume that the PICT is a valid size -- that is,// it should be a power of 2 in both dimensions.  // Create a 32-bit GWorld to hold the pix map data.  pictRect = (**picture).picFrame;  OffsetRect (&amp;pictRect, -pictRect.left, -pictRect.top);    theErr = NewGWorld(&amp;pictWorld, 32, &amp;pictRect, NULL, NULL, NULL);  FAIL_OSERR (theErr, &quot;\pERROR:Couldn't create the texture gworld&quot;)  FAIL_NIL (pictWorld,&quot;\pERROR:Couldn't create the texture gworld&quot;)    pictPix = GetGWorldPixMap (pictWorld);  FAIL_NIL (pictPix, &quot;\pERROR:Couldn't retrieve the texture PixMap&quot;)  FAIL_FALSE (LockPixels (pictPix),&quot;\pERROR:Couldn't lock the texture PixMap&quot;)  // Draw the picture into the GWorld  GetGWorld (&amp;savePort, &amp;saveDevice);  SetGWorld (pictWorld, NULL);  DrawPicture(picture, &amp;pictRect);  SetGWorld (savePort, saveDevice);// Fill in the image structure to describe our GWorld and create the texture  image.width = pictRect.right;  image.height = pictRect.bottom;  image.rowBytes = (**pictPix).rowBytes &amp; 0x3FFF;  image.pixmap = GetPixBaseAddr (pictPix);  // Create the texture and detach it so that the engine is responsible for it  theQAErr = QATextureNew (engine,kQATexture_None ,kQAPixel_RGB32,&amp;image, &amp;texture);  if (theQAErr != kQANoErr) SIGNAL_ERROR (&quot;\pError: RAVE failed to allocate the texture&quot;)    theQAErr = QATextureDetach (engine, texture);   if (theQAErr != kQANoErr) SIGNAL_ERROR (&quot;\pError: RAVE failed to detach the texture&quot;)  // We're done -- jump to the cleanup code and return.  goto cleanup;  error:// We hit an error, so we need to make sure we cleanup // everything and return a NULL texture  if (texture != NULL)    QATextureDelete (engine, texture);  texture = NULL;  cleanup:  if (picture != NULL)    ReleaseResource ((Handle) picture);  if (pictWorld != NULL)    DisposeGWorld (pictWorld);    return texture;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/RAVE_Starter_Samples/listing4.html%3Fid%3DDTS10000155-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/RAVE_Starter_Samples/listing4.html%3Fid%3DDTS10000155-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/RAVE_Starter_Samples/listing4.html%3Fid%3DDTS10000155-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>