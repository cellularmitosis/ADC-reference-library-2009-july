<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MyMultipleMoviesApp - /MyMovieStuff.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; <A HREF="javascript:location.replace('index.html');">MyMultipleMoviesApp</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/index.html" target="_blank">Reference Library > QuickTime</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MyMultipleMoviesApp</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MyMovieStuff.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/BetterFlattenMovie.c</option>
<option value="listing2.html">/BetterFlattenMovie.h</option>
<option value="listing3.html">/MyApplication Shell (2.0).c</option>
<option value="listing4.html">/MyApplication Shell (2.0).h</option>
<option value="listing5.html">/MyApplication.c</option>
<option value="listing6.html">/MyApplication.h</option>
<option value="listing7.html">/MyMovieStuff.c</option>
<option value="listing8.html">/MyMovieStuff.h</option></select>
				</p>
				</form>
				<p><strong><a href="MyMultipleMoviesApp.zip">Download Sample</a></strong> (&#147;MyMultipleMoviesApp.zip&#148;, 20.5K)<BR>
<strong><a href="MyMultipleMoviesApp.dmg">Download Sample</a></strong> (&#147;MyMultipleMoviesApp.dmg&#148;, 76.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    MyMovieStuff.c    Contains:  My Application Shell.  Written by:  John Wang  Copyright:  &copy; 1994 by Apple Computer, Inc., all rights reserved.  Change History (most recent first):    &lt;1&gt;    03/14/94  JW    Re-Created for Universal Headers.  To Do:  */#ifdef THINK_C#define    applec#endif#include  &lt;Types.h&gt;#include  &lt;Memory.h&gt;#include  &lt;QuickDraw.h&gt;#include  &lt;Palettes.h&gt;#include  &lt;QDOffscreen.h&gt;#include  &lt;Errors.h&gt;#include  &lt;Fonts.h&gt;#include  &lt;Dialogs.h&gt;#include  &lt;Windows.h&gt;#include  &lt;Menus.h&gt;#include  &lt;Events.h&gt;#include  &lt;Desk.h&gt;#include  &lt;DiskInit.h&gt;#include  &lt;OSUtils.h&gt;#include  &lt;Resources.h&gt;#include  &lt;ToolUtils.h&gt;#include  &lt;AppleEvents.h&gt;#include  &lt;EPPC.h&gt;#include  &lt;GestaltEqu.h&gt;#include  &lt;Processes.h&gt;#include  &lt;Balloons.h&gt;#include  &lt;Aliases.h&gt;#include  &lt;MixedMode.h&gt;#include  &lt;Scrap.h&gt;#include  &lt;LowMem.h&gt;#include  &lt;Movies.h&gt;#include  &quot;MyApplication Shell (2.0).h&quot;#include  &quot;MyApplication.h&quot;#include  &quot;BetterFlattenMovie.h&quot;#include  &quot;MyMovieStuff.h&quot;/* ------------------------------------------------------------------------- */void adjustMoviesMenu(WindowPtr theWindow){  WindowInfoHandle  myWinfo;  FSSpec        theFSSpec;  short        theRefNum;  MenuHandle      myMenu;  short        movieCount;  Handle        movieResource;  short        movieID;  ResType        movieType;  Str255        movieName;  short        i;    //  Delete old menu if it exists.  if (myMenu = GetMHandle(kMENU_MOVIES)) {    DeleteMenu(kMENU_MOVIES);    DisposeMenu(myMenu);  }  //  If a window is passed, then update the menu for it.  if (IsMyWindow(theWindow)) {    myWinfo = (WindowInfoHandle) GetWRefCon(theWindow);    theFSSpec = (**myWinfo).theFSSpec;    theRefNum = (**myWinfo).refNum;    myMenu = NewMenu(kMENU_MOVIES, theFSSpec.name);    InsertMenu(myMenu, 0);        //  Add resource fork movies into menu.    if (theRefNum != -1) {      movieCount = Count1Resources('moov');      for (i=1; i&lt;=movieCount; i++) {        movieResource = Get1IndResource('moov', i);        GetResInfo(movieResource, &amp;movieID, &amp;movieType, movieName);        if (movieName[0] == 0) {          NumToString(movieID, &amp;movieName[23]);          movieName[0] = movieName[23] + 23;          BlockMove(&quot;Resource Fork Movie ID#&quot;, &amp;movieName[1], 23);        }        AppendMenu(myMenu, movieName);        ReleaseResource(movieResource);      }    }        //  Add single fork movies into menu.    if (CountMoviesInDataFork(&amp;theFSSpec, &amp;movieCount) == noErr) {      for (i=0; i&lt;movieCount; i++) {        NumToString(i+1, &amp;movieName[19]);        movieName[0] = movieName[19] + 19;        BlockMove(&quot;Single Fork Movie #&quot;, &amp;movieName[1], 19);        AppendMenu(myMenu, movieName);      }    }  }  //  Update MenuBar.  DrawMenuBar();}void SelectThisMovie(short item){  OSErr        err;  WindowPtr      frontWindow;  WindowInfoHandle  myWinfo;  short        resCount, dataCount;  Handle        movieResource;  short        movieID;  ResType        movieType;  long         controllerFlags;  Rect        movieBounds;  short        i, xoffset, yoffset;  Str255        junkStr;  short        myRefNum;  Movie        tempMovie;  short        tempResId;  long        tempMovieOffset;    if ((frontWindow = FrontWindow()) == nil)    return;      if (IsMyWindow(frontWindow)) {    myWinfo = (WindowInfoHandle) GetWRefCon(frontWindow);    //  Get rid of old movie    if ((**myWinfo).theMC != nil)      DisposeMovieController((**myWinfo).theMC);    if ((**myWinfo).theMovie != nil)      DisposeMovie((**myWinfo).theMovie);    (**myWinfo).theMovie = nil;    (**myWinfo).theMC = nil;    (**myWinfo).moviename[0] = 0;    (**myWinfo).resId = -1;    (**myWinfo).movieOffset = -1;    //  Invalidate window.    InvalRect(&amp;(frontWindow-&gt;portRect));        //  Count the number of movies in resource fork and data fork    resCount = Count1Resources('moov');    CountMoviesInDataFork(&amp;((**myWinfo).theFSSpec), &amp;dataCount);    //  Find which movie to play.    if (item &lt;= resCount) {      movieResource = Get1IndResource('moov', item);      GetResInfo(movieResource, &amp;tempResId, &amp;movieType, (**myWinfo).moviename);      ReleaseResource(movieResource);      err = NewMovieFromFile(&amp;tempMovie, (**myWinfo).refNum, &amp;tempResId, nil,                newMovieActive, (Boolean *) 0);      (**myWinfo).theMovie = tempMovie;      (**myWinfo).resId = tempResId;      if (err) {        Alert(kALERT_CANTOPEN, nil);        return;      }    } else {      item = item-resCount;      err = SearchMoviesInDataFork(&amp;((**myWinfo).theFSSpec), item, &amp;tempMovieOffset);      (**myWinfo).movieOffset = tempMovieOffset;      if (err) {        Alert(kALERT_CANTOPEN, nil);        return;      }      if (FSpOpenDF(&amp;((**myWinfo).theFSSpec), fsRdPerm, &amp;myRefNum) == noErr) {        err = NewMovieFromDataFork(&amp;tempMovie, myRefNum, (**myWinfo).movieOffset, newMovieActive, nil);        (**myWinfo).theMovie = tempMovie;        FSClose(myRefNum);        if (err) {          Alert(kALERT_CANTOPEN, nil);          return;        }      }    }        //  Set the movie box into middle of window.    SetMovieGWorld((**myWinfo).theMovie, (CGrafPtr) frontWindow, 0);    GetMovieBox((**myWinfo).theMovie, &amp;movieBounds);    OffsetRect(&amp;movieBounds, -movieBounds.left, -movieBounds.top);    SetMovieBox((**myWinfo).theMovie, &amp;movieBounds);    xoffset = (frontWindow-&gt;portRect.right - frontWindow-&gt;portRect.left           - movieBounds.right + movieBounds.left) / 2;    yoffset = (frontWindow-&gt;portRect.bottom - frontWindow-&gt;portRect.top           - movieBounds.bottom + movieBounds.top) / 2;    OffsetRect(&amp;movieBounds, xoffset, yoffset);    (**myWinfo).theMC = NewMovieController((**myWinfo).theMovie, &amp;movieBounds, mcTopLeftMovie);      //  Tell the controller to attach a movie's CLUT to the window as appropriate.    MCDoAction((**myWinfo).theMC, mcActionGetFlags, &amp;controllerFlags);    MCDoAction((**myWinfo).theMC, mcActionSetFlags, (void *)(controllerFlags | mcFlagsUseWindowPalette));      //  Allow the controller to accept keyboard events.    MCDoAction((**myWinfo).theMC, mcActionSetKeysEnabled, (void *)true);  }  }void getNewMovie(Movie *theMovie, Str255 *movieName){  StandardFileReply    reply;  SFTypeList        types;  short          refNum, resId;    *theMovie = nil;    types[0] = 'MooV';  StandardGetFilePreview(nil, 1, types, &amp;reply);  if (!reply.sfGood) return;    //  Read movie atom of source movie.  if (OpenMovieFile(&amp;reply.sfFile, &amp;refNum, fsRdPerm)) {    SysBeep(50);    return;  }  resId = 0;  (*movieName)[0] = 0;  if (NewMovieFromFile(theMovie, refNum, &amp;resId, *movieName, 0, (Boolean *) 0)) {    SysBeep(50);    *theMovie = nil;    return;  }  if ((*movieName)[0] == 0)    BlockMove(reply.sfFile.name, *movieName, reply.sfFile.name[0]+1);  CloseMovieFile(refNum);}void Mac_AddMovieResAtom(short *docRefNum, FSSpec *docFSSpec){  Movie          theMovie;  Str255          movieName;  short          resId;  getNewMovie(&amp;theMovie, &amp;movieName);    if (theMovie != nil) {    resId = 0;    AddMovieResource(theMovie, *docRefNum, &amp;resId, movieName);    DisposeMovie(theMovie);  }}void Mac_AddMovieAll(short *docRefNum, FSSpec *docFSSpec){  Movie          theMovie;  Str255          movieName;  getNewMovie(&amp;theMovie, &amp;movieName);    if (theMovie != nil) {    CloseMovieFile(*docRefNum);    BetterFlattenMovie(theMovie, 0, docFSSpec, 'WnG1', smSystemScript, 0, nil, movieName);    OpenMovieFile(docFSSpec, docRefNum, fsRdWrPerm);    DisposeMovie(theMovie);  }}void Cross_AddMovieAll(short *docRefNum, FSSpec *docFSSpec){  Movie          theMovie;  Str255          movieName;  getNewMovie(&amp;theMovie, &amp;movieName);    if (theMovie != nil) {    CloseMovieFile(*docRefNum);    BetterFlattenMovieData(theMovie, flattenAddMovieToDataFork, docFSSpec, 'WnG1', smSystemScript, 0);    OpenMovieFile(docFSSpec, docRefNum, fsRdWrPerm);    DisposeMovie(theMovie);  }}void Both_AddMovieAll(short *docRefNum, FSSpec *docFSSpec){  Movie          theMovie;  Str255          movieName;  getNewMovie(&amp;theMovie, &amp;movieName);    if (theMovie != nil) {    CloseMovieFile(*docRefNum);    BetterFlattenMovie(theMovie, flattenAddMovieToDataFork, docFSSpec, 'WnG1', smSystemScript, 0, nil, movieName);    OpenMovieFile(docFSSpec, docRefNum, fsRdWrPerm);    DisposeMovie(theMovie);  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MyMultipleMoviesApp/listing7.html%3Fid%3DDTS10000329-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MyMultipleMoviesApp/listing7.html%3Fid%3DDTS10000329-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MyMultipleMoviesApp/listing7.html%3Fid%3DDTS10000329-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>