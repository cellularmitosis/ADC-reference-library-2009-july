<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Responding to Disk-Inserted Events (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING373></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-372.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-374.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-367.html"><B>Chapter 5 - Disk Initialization Manager</B></A> / <A HREF="Files-372.html"><B>Using the Disk Initialization Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING373-0></A>
<H2><A NAME=MARKER-2-44></A><A NAME=MARKER-2-45></A>Responding to Disk-Inserted Events</H2>
 When the user inserts a disk, the Operating System attempts to mount the volume on the disk by calling the File Manager function <CODE>PBMountVol</CODE>. If the volume is successfully mounted, an icon representing the disk appears on the desktop. The Operating System then generates a disk-inserted event. If the user is interacting with a standard file dialog box, the Standard File Package intercepts the disk-inserted event and handles it. Otherwise, the event is left in the event queue for your application to retrieve.<A NAME=MARKER-2-46></A><P>
 Your application must either mask out disk-inserted events or process them by checking to see whether the inserted disk is invalid. If you mask out such events, then each disk-inserted event needlessly occupies a position in the event queue until the user brings an application that can handle such events to the foreground or until your application invokes the Standard File Package. Also, displaying the disk initialization dialog box long after the disk has been inserted is likely to confuse the user. However, you might wish to mask out disk-inserted events when you create modal dialog boxes in which you process events with <CODE>WaitNextEvent</CODE> rather than <CODE>ModalDialog</CODE>. That way, your application can process disk-inserted events as soon as the modal dialog box closes.<A NAME=MARKER-2-47></A><P>
<DL>
<DT><B>Note</B>
<DD>By default, the Dialog Manager's <CODE>ModalDialog</CODE> procedure automatically masks out disk-inserted events so that your application can handle them when dialog boxes close. If you wish to accept disk-inserted events in a modal dialog box in which you call <CODE>ModalDialog</CODE>, you must supply a filter procedure for the dialog box. See the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> for information on how to write a filter procedure.<EM></EM><A NAME=MARKER-2-48></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Because handling disk-inserted events is easy, there is no good reason for your application to mask out the events in its main event loop. <A HREF=#MARKER-9-49>Listing 5-1</A> defines a <BR>procedure that your application can call when it receives a disk-inserted event.<P>
<B>Listing 5-1  <A NAME=MARKER-9-49></A>Responding to disk-inserted events</B><P>
<PRE>
PROCEDURE DoDiskEvent (myEvent: EventRecord);
VAR
   myPoint:    Point;
   myErr:      OSErr;
BEGIN
   IF HiWord(myEvent.message) &lt;&gt; noErr THEN
      BEGIN                            {attempt to mount was unsuccessful}
         DILoad;                       {load Disk Initialization Manager}
         SetPt(myPoint, 120, 120);     {set top left of dialog box}
         myErr := DIBadMount(myPoint, myEvent.message);
                                       {notify the user}
         DIUnload;                     {unload Disk Initialization Manager}
      END
   ELSE                                {attempt to mount was successful}
      ;                                {do other processing}
END;
</PRE>
 The DoDiskEvent procedure in <A HREF=#MARKER-9-49>Listing 5-1</A> checks the high word of the event message to see if the disk is mounted properly. If it has not been mounted, DoDiskEvent calls the Disk Initialization Manager's <CODE>DIBadMount</CODE> function, which displays the disk initialization dialog box. Before doing so, DoDiskEvent calls <CODE>DILoad</CODE> to ensure that the Disk Initialization Manager and its dialog box are loaded into memory. If you did not call <CODE>DILoad</CODE> and the user started up with a floppy system startup disk, the Operating System might require that the user reinsert the system disk and might then attempt to initialize that disk. In <A HREF=#MARKER-9-49>Listing 5-1</A>, if the user did start up with a floppy system startup disk on a single floppy-drive system, the <CODE>DILoad</CODE> procedure requests that the user insert the system disk so that it can read the necessary resources, and then it ejects that disk so that the user can again put the disk to be initialized into the drive. After calling <CODE>DIBadMount</CODE> to handle the uninitialized disk, DoDiskEvent calls <CODE>DIUnload</CODE> to release the resources <CODE>DILoad</CODE> read into memory.<A NAME=MARKER-2-50></A><A NAME=MARKER-2-51></A><A NAME=MARKER-8-9></A><P>
 Beginning with system software version 7.0, the first parameter to <CODE>DIBadMount</CODE> is ignored, and the disk initialization dialog box is automatically centered on the screen.<A NAME=MARKER-2-53></A><A NAME=MARKER-2-54></A><P>
 The procedure in <A HREF=#MARKER-9-49>Listing 5-1</A> ignores the result code returned by <CODE>DIBadMount</CODE> because ordinarily it does not concern your application. If an error does occur during initialization, <CODE>DIBadMount</CODE> informs the user and ejects the disk.<A NAME=MARKER-2-55></A><A NAME=MARKER-2-56></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-372.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-374.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
