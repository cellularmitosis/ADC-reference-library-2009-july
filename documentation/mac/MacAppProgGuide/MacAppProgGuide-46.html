<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MacApp's Menu Management (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING46></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-45.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-47.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-40.html"><B>Chapter 5 - Events and Commands</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING46-0></A>
<H1><A NAME=MARKER-2-232></A>MacApp's Menu Management</H1>
 MacApp supplies many facilities to help your application display menus and respond to menu commands. You can read more about these topics in <BR><A HREF=MacAppProgGuide-14.html#MARKER-9-19>Chapter 1, "MacApp Overview,"</A> and in <A HREF=MacAppProgGuide-85.html#MARKER-9-27>Chapter 12, "Working With Menus."</A> This section provides detailed information on MacApp's menu management, command-numbering system, and optimized menu setup.<P>
<A NAME=HEADING46-2></A>
<H2>Components of MacApp Menu Management</H2>
 The components of MacApp's menu management work together to supply two important features:<P>
<UL>
<LI>a command-numbering system that is independent of the placement of menus and menu items
<LI>a framework for optimizing menu setup<P>
</UL>
 MacApp doesn't have a single menu manager object but rather a number of related global objects and global routines for working with menus. The following objects are created and initialized in the global routine <CODE>InitUMenuMgr</CODE>, which is called from <CODE>DoInitUMacApp</CODE>:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-233></A>gCmdTable</CODE>
<DD> This table stores entries consisting of a menu command number and its associated menu ID and menu item number. For example, the entry for the New menu command from the File menu has the command number <CODE>cNew</CODE>, the menu ID number <CODE>mFile</CODE>, and the item number 1.
<DT><CODE><A NAME=MARKER-2-234></A>gMenuBarManager</CODE>
<DD> This object manages the installation of menu bars.
<DT><CODE><A NAME=MARKER-2-235></A>gMenuIDList</CODE>
<DD> This object stores a list of menu IDs and their associated resource IDs, sorted by resource ID. For example, for the File menu MacApp uses <CODE>mFile</CODE> as both the menu ID and the resource ID.
<DT><CODE><A NAME=MARKER-2-236></A>gMenuTable</CODE>
<DD> This table stores menu resource handles for the menus managed by MacApp.
</DL>
 MacApp also supplies global routines to modify the appearance of menu items, including setting the text or style of a menu command, checking or unchecking a menu command, setting an icon for a menu command, and so on. Some of these routines are supplied by the <CODE><A NAME=MARKER-2-237></A>TMenuBarManager</CODE> class, which is described in <A HREF=MacAppProgGuide-85.html#MARKER-9-27>Chapter 12, "Working With Menus."</A><P>
<A NAME=HEADING46-12></A>
<H2><A NAME=MARKER-2-238></A><A NAME=MARKER-9-239></A>MacApp's Command-Numbering System</H2>
 MacApp's command-numbering mechanism associates command numbers with menu items. When a user chooses a menu command, MacApp passes the command number for that item to your application. You create a command object to perform a specified action based on the command number.<P>
 You assign a unique command number of type <CODE><A NAME=MARKER-2-240></A>CommandNumber</CODE> to each menu command. Negative numbers and positive numbers up to 999 are reserved by MacApp. To associate a command number with a menu item, you define a menu resource of the <CODE>'CMNU'</CODE> resource type. The <CODE>'CMNU'</CODE> type is similar to the <CODE>'MENU'</CODE> type, but for each menu item it contains an additional field that specifies a command number. The following line from MacApp's default File menu <CODE>'CMNU'</CODE> resource associates the <CODE>cNew</CODE> command number with the New menu command:<P>
<PRE>
&quot;New&quot;,noIcon, &quot;N&quot;,noMark, plain, cNew;
</PRE>
 The fields in this line specify the following menu information:<P>
<UL>
<LI>"New" is the name of the menu item.
<LI>No icon is drawn on the menu for this item.
<LI>Command-N is a keyboard equivalent for choosing this menu item.
<LI>The menu item does not have an initial checkmark.
<LI>The menu item text style is plain text.
<LI>The command number associated with the New menu command is defined by the constant <A NAME=MARKER-2-241></A>cNew.<P>
</UL>
 MacApp's menu management provides a number of global routines for working with command numbers in your application:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-242></A>CommandEnabled<B></B></CODE>
<DD> Tells you if the menu item with the specified command number is currently enabled.
<DT><CODE><A NAME=MARKER-2-243></A>CommandFromMenuItem</CODE>
<DD> Returns the command number for the specified menu ID and item number.
<DT><CODE><A NAME=MARKER-2-244></A>CommandToMenuItem</CODE>
<DD> Returns the menu ID and item number for the specified command number.
<DT><CODE><A NAME=MARKER-2-245></A>CommandToName<B></B></CODE>
<DD> Returns the text of the menu item for the specified command number.
</DL>
 You can read about these and other menu routines in the <I>MacApp Class and Method Reference</I>.<P>
<DL>
<DT><B>Note</B>
<DD>The <CODE>CommandToMenuItem</CODE> and <CODE>CommandFromMenuItem</CODE> routines work regardless of whether the command is actually installed in the menu bar. This allows MacApp to use a special <CODE>'CMNU'</CODE> resource (see <A HREF=MacAppProgGuide-86.html#MARKER-9-40>"The Buzzwords 'CMNU' Resource," beginning on page 305</A>) to specify words or phrases to be displayed in the Undo menu item for an operation that isn't specified by a menu command.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING46-30></A>
<H3>Creating Menu Numbers on the Fly</H3>
 Sometimes the items to be displayed on a menu cannot be determined until runtime. For example, many applications use a menu to display the names of the open windows or the available fonts, which cannot be known until the program is running. Since you cannot assign a command number for the items ahead of time, MacApp generates a command number using this formula:<P>
<PRE>
CommandNumber = -(256 * menu + item)
</PRE>
 These command numbers are always negative. For an example of how a Font menu uses these command numbers, see the DemoText sample application.<P>
<A NAME=HEADING46-34></A>
<H2><A NAME=MARKER-2-246></A>Optimized Menu Setup</H2>
 An application must maintain the proper state for its menus and menu items. Depending on the active window, a menu may need to be enabled or disabled, or it may need to have items added or removed. A menu item may need to be checked or unchecked, enabled or disabled.<P>
 MacApp automatically performs menu setup by calling the <CODE>DoSetupMenus</CODE> method for objects in the target chain whenever your application's menus may have changed. Each object enables the menu commands it handles. It can also check or uncheck menu items and set the text for its commands.<P>
 Applications that don't use MacApp perform menu setup through Toolbox calls such as <CODE><A NAME=MARKER-2-247></A>SetItem</CODE>, <CODE><A NAME=MARKER-2-248></A>SetItemStyle</CODE>, and <CODE><A NAME=MARKER-2-249></A>CheckItem</CODE>. Each of these routines in turn calls <CODE><A NAME=MARKER-2-250></A>CalcMenuSize</CODE>, because the width or height of the menu may have changed. Repeatedly recalculating the height and width of menus is inefficient at best. MacApp's menu management optimizes menu setup by performing all setup at one time and making just one call to <CODE>CalcMenuSize</CODE> at the end of the setup process.<A NAME=MARKER-2-251></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-45.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-47.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
