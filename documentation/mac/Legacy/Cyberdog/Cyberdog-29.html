<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Implementing Your Cyberdog Part Extension(Cyberdog)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING29></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Cyberdog-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Cyberdog-2.html"><B>Cyberdog Programmer's Kit</B></A> / <A HREF="Cyberdog-20.html"><B>Part 2 - Programming in Cyberdog</B></A><BR><DD><A HREF="Cyberdog-28.html"><B>Chapter 4 - Creating a Cyberdog Display Part</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING29-0></A>
<H1><A NAME=MARKER-9-21></A>Implementing Your Cyberdog Part Extension</H1>
 <A NAME=MARKER-2-22></A>A Cyberdog display part is associated with a Cyberdog part extension. An extension is an OpenDoc object that provides additional capabilities or behaviors. The Cyberdog part extension allows Cyberdog to send messages to your display part. This extension defines methods that implement Cyberdog behaviors, such as opening the location represented by a Cyberdog item. <P>
 You create a Cyberdog part extension subclass from the CyberPartExtension class. The CyberPartExtension class is an indirect subclass of the <CODE>ODExtension</CODE> OpenDoc class. The CyberPartExtension class is a SOM class. The following sections show you how to define a CyberPartExtension subclass and override its methods.<P>
 To implement a Cyberdog part extension, you typically take these actions:<P>
<UL>
<LI>Override the <CODE>somInit</CODE> method if you use additional fields. 
<LI>Override the <CODE>OpenCyberItem</CODE> method to open your display part in the way you specify. Cyberdog calls this method to notify a part that it is being opened by a Cyberdog item rather than some other way, such as being restored from disk. 
<LI>Override the <CODE>GetCyberItemWindow</CODE> method if you want your display part's window to be selected when the same Cyberdog item is redisplayed. Cyberdog calls this method to locate a window that is already displaying the Cyberdog item. For example, if the user double clicks on a Cyberdog item in the notebook and then repeats the action, your override of the <CODE>GetCyberItemWindow</CODE> method can return the window in which the item is currently displayed. If you do not override this method, the item appears in a new window each time it is displayed. <P>
</UL>
 You may also wish to provide a way for your SOM part extension object to obtain a reference to the C++ display part object, which is a technique used in the text-viewer example.<P>
 <A HREF=#MARKER-9-23>Listing 4-1</A> shows the SOM class definition of the text-viewer's part extension subclass.<P>
<B>Listing 4-1  <A NAME=MARKER-9-23></A>The text-viewer sample's part extension class definition</B><P>
<PRE>
module Apple {
   interface som_CybTxtViewerCyberExt : CyberPartExtension
   {
      void     SetBasePart(in somToken basePart);
      somToken GetBasePart(); 
       
   #ifdef __SOMIDL__
      implementation
      {
      functionprefix = som_CybTxtViewerCyberExt__;
   
      override:
         somInit,
         OpenCyberItem,
         GetCyberItemWindow,
         BaseRemoved;
         
      releaseorder:
         SetBasePart,
         GetBasePart;
         
      majorversion = 1; minorversion = 0;
   
   #ifdef __PRIVATE__
      somToken fBasePart;
   #endif
      };
   #endif
   };
};
</PRE>
 The <CODE>BaseRemoved</CODE>, <CODE>SetBasePart</CODE>, and <CODE>GetBasePart</CODE> methods and the fBasePart field are used to associate a SOM part extension object with a C++ display part object, as described in the following section. <P>
<A NAME=HEADING29-12></A>
<H2><A NAME=MARKER-9-24></A>Associating a Part Extension With a Display Part</H2>
 You may find it convenient to implement the tasks performed by SOM-class methods in methods of a C++ class. For example, the text-viewer uses a straightforward technique to associate a Cyberdog part extension subclass, which is a SOM class, with the C++ implementation of a Cyberdog display part class, <CODE>CybTxtViewer</CODE>. The <CODE>CybTxtViewer</CODE> C++ class implements the text-viewer part's behavior. <P>
 The SOM class contains a field, <CODE>fBasePart</CODE>, which points to the associated C++ object. The SOM class provides the <CODE>SetBasePart</CODE> and <CODE>GetBasePart</CODE> methods, which respectively set and retrieve the value of this field. The text-viewer part calls the extension's <CODE>SetBasePart</CODE> method when it creates the part extension object to associate the C++ display part object with the extension. See <A HREF=Cyberdog-30.html#MARKER-9-46>Listing 4-13 (page 128)</A>.<P>
 <A HREF=#MARKER-9-25>Listing 4-2</A> shows an override of the <CODE>somInit</CODE> method, which initializes the fBasePart field to kODNULL. Note that the <CODE>somInit</CODE> method's inherited method is also invoked.<P>
<B>Listing 4-2  <A NAME=MARKER-9-25></A>The <CODE>somInit</CODE> method of the text-viewer's part extension </B><P>
<PRE>
SOM_Scope void  SOMLINK som_CybTxtViewerCyberExt__somInit
                        (Apple_som_CybTxtViewerCyberExt *somSelf)
{
   ... 
   Apple_som_CybTxtViewerCyberExt_parent_CyberPartExtension_somInit
                                             (somSelf);
   somThis-&gt;fBasePart = kODNULL;
}
</PRE>
 The <CODE>SetBasePart</CODE> method sets the fBasePart field with the contents of the basePart parameter, as follows:<P>
<PRE>
somThis-&gt;fBasePart = basePart;
</PRE>
 The <CODE>GetBasePart</CODE> method retrieves the contents of the fBasePart field:<P>
<PRE>
return somThis-&gt;fBasePart;
</PRE>
 The extension class overrides the <CODE>ODExtension</CODE>::<CODE>BaseRemoved</CODE> method to reset the <CODE>fBasePart</CODE> field to kODNULL when the associated C++ object no longer exists, as shown in <A HREF=#MARKER-9-26>Listing 4-3</A>. The inherited <CODE>BaseRemoved</CODE> method is then called.<P>
<B>Listing 4-3  <A NAME=MARKER-9-26></A>The <CODE>BaseRemoved</CODE> method of the text-viewer's part extension</B><P>
<PRE>
SOM_Scope void  SOMLINK som_CybTxtViewerCyberExt__BaseRemoved
                        (Apple_som_CybTxtViewerCyberExt *somSelf, 
                         Environment *ev)
{
...
SOM_TRY
   somThis-&gt;fBasePart = kODNULL;
   Apple_som_CybTxtViewerCyberExt_parent_CyberPartExtension_BaseRemoved
                                             (somSelf,ev);
SOM_CATCH_ALL
SOM_ENDTRY
}
</PRE>
<A NAME=HEADING29-25></A>
<H2><A NAME=MARKER-9-27></A>Overriding Cyberdog Part Extension Methods</H2>
 To implement a Cyberdog part extension class, you typically override the <CODE><A NAME=MARKER-2-28></A>OpenCyberItem</CODE> method. You must override the <CODE>somInit</CODE> method if you define fields. See <A HREF=#MARKER-9-25>Listing 4-2 (page 118)</A>. You override the <CODE>GetCyberItemWindow</CODE> method if you want your display part's window to be selected when the same Cyberdog item is redisplayed. <P>
 In the text-viewer example, the methods defined in the SOM part extension subclass pass control to the corresponding methods in the C++ text-viewer part class. <A HREF=#MARKER-9-29>Listing 4-4</A> shows an override of the <CODE>OpenCyberItem</CODE> method that calls its inherited <CODE>OpenCyberItem</CODE> method and then calls the text-viewer part's <CODE>OpenCyberItem</CODE> method. <P>
<B>Listing 4-4  <A NAME=MARKER-9-29></A>The <CODE>OpenCyberItem</CODE> method of the text-viewer's part extension </B><P>
<PRE>
SOM_Scope void  SOMLINK som_CybTxtViewerCyberExt__OpenCyberItem(
                        Apple_som_CybTxtViewerCyberExt *somSelf,
                        Environment *ev,
                        CyberItem* item,
                        ODPart* openerPart,
                        ParameterSet* openParams)
{
... 
SOM_TRY
Apple_som_CybTxtViewerCyberExt_parent_CyberPartExtension_OpenCyberItem
                        (somSelf,ev,item,openerPart,openParams);
   CybTxtViewer* realPart = (CybTxtViewer*) somThis-&gt;fBasePart;
   if (realPart)
      realPart-&gt;OpenCyberItem(ev, item, openerPart, openParams);
SOM_CATCH_ALL
SOM_ENDTRY
}
</PRE>
 <A HREF=#MARKER-9-31>Listing 4-5</A> shows an override of the <CODE>GetCyberItemWindow</CODE> method that calls the text-viewer part's <CODE>GetCyberItemWindow</CODE> method. <P>
<B>Listing 4-5  <A NAME=MARKER-9-31></A>The <CODE>GetCyberItemWindow</CODE> method of the part extension </B><P>
<PRE>
SOM_Scope ODWindow*  SOMLINK som_CybTxtViewerCyberExt__GetCyberItemWindow
      (Apple_som_CybTxtViewerCyberExt *somSelf, 
       Environment *ev,
       CyberItem* item)
{
   ...
   ODWindow* result; 
   ODVolatile(result);
   
   SOM_TRY
      CybTxtViewer* realPart = (CybTxtViewer*) somThis-&gt;fBasePart;
      if (realPart)
          return realPart-&gt;GetCyberItemWindow(ev, item);
   SOM_CATCH_ALL
       result = kODNULL;
   SOM_ENDTRY
   return result;
}
</PRE>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Cyberdog-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Cyberdog-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>   
