<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Native Driver Package</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.b6.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b6.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b8.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3543"> </A><A NAME="40882"> </A>Native Driver Package</H1><P CLASS="T1.Text1"><A NAME="pgfId=3544"> </A>The driver model in the second generation of Power Macintosh defines a new driver packaging format. This package may contain generic drivers that have the generic driver call interface or may contain device family drivers that have call interfaces specific to the device family.</P><P CLASS="T1.Text1"><A NAME="pgfId=3546"> </A>The <A NAME="marker=3545"> </A>Native Driver package is a CFM code fragment. It may reside in the Macintosh ROM, in an expansion ROM, or in the data fork of a file. File-based native driver code fragments contain no resource fork and have a file type of <TT CLASS="cv">'ndrv'</TT>. The DLL ignores the file's creator; by specifying a custom creator value registered with Apple, you can use this value to distinguish one driver from another. For a discussion of this technique, see <A HREF="PCI_BOOK.1b8.html#14739" CLASS="XRef">Using NVRAM to Store Name Registry Properties</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3550"> </A>The Native Driver package may house various types of drivers. The driver is expected to support services defined for the particular device family. One predefined driver type is a generic type and is called <A NAME="marker=3551"> </A><TT CLASS="cv">'ndrv'</TT> (not to be confused with the Native Driver file type <TT CLASS="cv">'ndrv'</TT>).</P><P CLASS="T1.Text1"><A NAME="pgfId=3552"> </A>The Native Driver package requires that at least one symbol be defined and exported by the CFM's export mechanism. This symbol must be named <TT CLASS="cv">TheDriverDescription</TT>; it is a data structure that describes the driver's type, functionality, and characteristics.</P><P CLASS="T1.Text1"><A NAME="pgfId=3553"> </A>Depending on the type of driver, additional symbols must be exported. The generic driver must export a single code entry point, <A NAME="marker=3554"> </A><TT CLASS="cv">DoDriverIO</TT>, which is passed to all driver I/O requests. <TT CLASS="cv">DoDriverIO</TT> must respond to the <TT CLASS="cv">kOpenCommand</TT>, <TT CLASS="cv">kCloseCommand</TT>, <TT CLASS="cv">kReadCommand</TT>, <TT CLASS="cv">kWriteCommand</TT>, <TT CLASS="cv">kControlCommand</TT>, <TT CLASS="cv">kStatusCommand</TT>, <TT CLASS="cv">kKillIOCommand</TT>, <TT CLASS="cv">kInitializeCommand</TT>, <TT CLASS="cv">kFinalizeCommand</TT>, <TT CLASS="cv">kReplaceCommand</TT>, and <TT CLASS="cv">kSupersededCommand</TT> commands. Native drivers must also keep track of I/O permissions for each instance of multiple open actions and return error codes if permissions are violated. Other driver types that support device families must export the symbols and entry points defined by the device family or device expert.</P><DIV><blockquote><p CLASS="ImportantHead"><b><A NAME="pgfId=16628"> </A>IMPORTANT</b></p><P CLASS="I.Important"><A NAME="pgfId=3555"> </A>Native drivers must handle a new type of error return code, <TT CLASS="cv">OSStatus</TT>. This data type is described in <A HREF="PCI_BOOK.7f.html#34984" CLASS="XRef">Error Returns</A>. </P></blockquote></DIV><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.b8.html#pgfId=3563" CLASS="Hypertext">Driver Description Structure</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.b9.html#pgfId=3587" CLASS="Hypertext">Driver Type Structure</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.ba.html#pgfId=3599" CLASS="Hypertext">Driver Run-Time Structure</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.bb.html#pgfId=3615" CLASS="Hypertext">Driver Services Structure</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.bc.html#pgfId=3623" CLASS="Hypertext">Driver Services Information Structure</A></H2><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.b6.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b6.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b8.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>