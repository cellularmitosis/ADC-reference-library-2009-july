<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PS510: Process Manager Q&amp;As</title>    <meta name="keywords" content="Mac OS 8 Process Manager launchApplication canBackground ResErrProc multilaunch"><meta name="Description" content="Technical Note PS510: This Technical Note contains a collectionof archived Q&amp;As relating to the Process Manager--questionssent the Developer Support Center (DSC) along with answersfrom the DSC engineers. Archived Q&amp;As include: LaunchApplicationand problem of applications not getting any processor timeif the canBackground bit is not set; resource error procedure(ResErrProc) and error - 192 (resNotFound) every time a resourceis released; How to keep Process Manager from closing fileswhen app quits; and  How to tell if Macintosh Process Manageris present.">                                       <meta name="categories" content="Processes"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002654" title="Process Manager Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxProcessManagement-date.html" target="_blank">Carbon > Process Management</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PS510</div>
<div id="pageheadsub">Process Manager Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">LaunchApplication and canBackground bit</A><BR><BR><A HREF="#Section2">Process Manager and ResErrProc</A><BR><BR><A HREF="#Section3">How to keep Process Manager from <BR>closing files when app quits</A><BR><BR><A HREF="#Section4">How to tell if Macintosh Process Manager is present</A><BR><BR><A HREF="#Section5">Code snippet to check for high-level event support <BR>in a process</A><BR><BR><A HREF="#Section6">Launching a Macintosh application</A><BR><BR><A HREF="#Section7">Changing the 'SIZE' -1 resource multilaunch bit at run time</A><BR><BR><A HREF="#Section8">System 7 and MultiFinder's "puppet strings"</A><BR><BR><A HREF="#Section9">Background applications and alerts</A><BR><BR><A HREF="#Section10">Process Manager saves and restores the 68881/882 registers</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;As can be found on the <A HREF = "../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>LaunchApplication and canBackground bit</h2><p>Date Written:   3/26/93</p><p>Last reviewed: 6/24/93</p><p>When I use <code>LaunchApplication</code> with the <code>launchDontSwitch</code> bit set in the<code>launchControlFlags</code> field for an application that doesn't have the <code>canBackground</code>size resource bit set, <code>LaunchApplication</code> returns 0 (<code>noErr</code>) but the applicationdoesn't launch. What gives?</p><p><code>LaunchApplication</code> doesn't return an error in this case because the applicationactually <i>is</i> launched. But, since it doesn't have the <code>canBackground</code> bitset, and it was launched into the background, it never gets any processor time,which means that it doesn't initialize anything and isn't added to the processmenu. If you double click an application that's been launched like this, itwill bounce forward and get processor time, initialize itself and be added tothe process menu as usual.</p><p>You can verify this by using an application that lists current processes, tosee whether the application is indeed listed as running, but it will never gettime unless it's manually brought forward by the user.</p><p>We've entered this as a bug in our database. Hopefully we'll be able to addressit in the future.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><h2>Process Manager and ResErrProc</h2><p>Date Written:   3/30/93</p><p>Last reviewed: 7/2/93</p><p>I've installed a resource error procedure (<code>ResErrProc</code>) but it gets called withan error -192 (<code>resNotFound</code>) every time I release a resource. Why is this happening and what can I do to fix it?</p><p>If you install a <code>ResErrProc</code>, the Process Manager switches it out when switchingto another application. The problem you're having is that the Process Managerdoesn't switch it out while in Process Manager code itself. If you break intothe debugger in your <code>ResErrProc</code> and examine register A5, you'll find it's notyour A5; it is in fact the Process Manager's.</p><p>What has happened is that the Process Manager has patched <code>ReleaseResource</code> forits own mysterious purposes. An error occurs, which the Process Managerbelieves it can ignore, but because your <code>ResErrProc</code> is still installed, it getscalled and reports the error. To avoid this, when your <code>ResErrProc</code> gets called,check to see whether register A5 is equal to the low-memory global CurrentA5.If the values aren't equal, you can assume your application wasn't responsiblefor the error, so you can ignore it. The code might look like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void MyResErrorProc (void){    long    A5;    A5 = SetCurrentA5 ();    if (A5 == *(long *)CurrentA5)  /* If they're equal, we're in current app code */        Debugger();                /* ...or whatever you want to do here */    else                           /* Not in current app code */        SetA5 (A5);                /* Restore old A5 */    return;}</pre>	</TD></TR></TABLE></CENTER><p>Similar problems can occur if you make calls that make other Resource Managercalls. The secondary calls may produce errors that are inconsequential to theprimary call, but your <code>ResErrProc</code> gets called anyway. This makes <code>ResErrProcs</code> oflimited use, so use any information reported by a <code>ResErrProc</code> carefully.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><h2>How to keep Process Manager from closing files when app quits</h2><p>Date Written:  8/24/92</p><p>Last reviewed:  6/14/93</p><p>Somehow System 7 keeps track of which application opened a file, so that it canclose files left open if the application crashes. Well, I need to defeat thismechanism to keep the Macintosh Operating System from closing a file after auser quits our application. How do I do that?</p><p>The Process Manager keeps track of the files opened by an application. Sinceapplications are normally supposed to close the files they open, but manydon't, Apple decided to let the Process Manager do the job for those that don'tdo it themselves. You aren't the first to complain about this behavior sincethere are several valid cases for leaving a file open. Anyway, there are twoways to work around this.</p><p>If this first method will work for you, you should use it since it doesn'tinvolve patching anything. Let your application launch a small facelessbackground application (FBA) whose purpose is to open files for you.Communicate with the FBA through Apple events to:</p><ul type="circle">	<li>tell it what files to open for you and have it return the file reference number (or any errors).</li>	<li>tell it what files to close for you.</li>	<li>ask it what files are open.</li>	<li>tell it to quit.</li></ul><p>Use <code>MaxLongInt</code> for the FBA's sleep value passed to <code>WaitNextEvent</code> so it won'tuse any system time until you ask it to do something - it'll wake up when itreceives an Apple event. Your application can find out if the FBA is alreadyrunning (and get its process serial number for the address of Apple events) bylooking for the FBA with the Process Manager's <code>GetProcessInformation</code> function.</p><p>An FBA is the recommended method. The other method is to patch <code>_Close</code> with anINIT to keep the Process Manager from closing certain files.</p><p>A couple of examples that might help you with the FBA can be found on theDeveloper CD. They're called <A HREF = "downloads/aedaemon.hqx"><code>AEDaemon</code></a> and <code>AEInteraction</code> Sample.</p><a name="Section4"></a><P><A HREF="#top">Back to top</A></p><h2>How to tell if Macintosh Process Manager is present</h2><p>Date Written:  1/21/91</p><p>Last reviewed:  6/14/93</p><p>What is the proper way to tell if the Process Manager is present?</p><p>The System 7 Process Manager is available if a <code>Gestalt</code> call with the selector<code>gestaltOSAttr</code> returns <code>noErr</code> and the <code>gestaltLaunchControl</code> bit is set in theresponse. This is documented on page 29-17 of <i>Inside Macintosh</i> Volume VI.</p><a name="Section5"></a><P><A HREF="#top">Back to top</A></p><h2>Code snippet to check for high-level event support in a process</h2><p>Date Written:  11/12/90</p><p>Last reviewed:  6/14/93</p><p>How can I find out if a specific process is running on my system and if itsupports high-level System 7 events?</p><p>You can check to see if a specific process supports high-level events with codesimilar to this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Program Test;USES  Types,  Processes;Var  err: OSErr;  myPSN: ProcessSerialNumber;  myPInfoRec: ProcessInfoRec;  myPName: Str255;  myProcessSignature: OSType;BEGIN  myPSN.highLongOfPSN := 0; { start at beginning of process list }  myPSN.lowLongOfPSN := kNoProcess;  myPInfoRec.processInfoLength := sizeOf(ProcessInfoRec);  myPInfoRec.processName := @myPName;  myPInfoRec.processAppSpec := NIL;  myProcessSignature := 'MACS'; { looking for the Finder's signature }  WHILE (GetNextProcess(myPSN) = noErr) DO    IF GetProcessInformation(myPSN, myPInfoRec) = noErr      THEN        IF (myPInfoRec.processSignature = myProcessSignature) AND          (BAND(myPInfoRec.processMode, modeHighLevelEventAware) &lt;&gt; 0)            THEN              Writeln(myPInfoRec.processName^, ' is high level event aware.');END.</pre>	</TD></TR></TABLE></CENTER><a name="Section6"></a><h2>Launching a Macintosh application</h2><p>Date Written:  4/30/91</p><p>Last reviewed:  6/14/93</p><p>Under MultiFinder or Macintosh System 7, is there a way to set a flag toterminate the current application before launching a different application?Under standard Finder, the launcher quits before the launchee starts. However,under MultiFinder or System 7, they both must stay in memory for a brief timeuntil control returns to the launcher and it hits the <code>ExitToShell</code>. Because mostof our programs are set to use 1 MB, we need 2 MB of memory available for ashort time.</p><p>Two distinct cases are involved here: the System 7.0 case and the pre-System 7.0 case.</p><p>In System 7.0 there is a new way to launch applications. The function is called(appropriately enough) <code>LaunchApplication</code>. The function and its new extendedparameter block are documented in the Process Management chapter of <i>InsideMacintosh</i> Volume VI.</p><p>You can determine whether your system software has the new Launch Controlcapabilities by using <code>Gestalt</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr myOSErr;long response;myOSErr = Gestalt(gestaltOSAttr, &amp;response);if (noErr != myOSErr)   /* If an OSErr occurs we must be pre-System 7.0 */  /* Handle pre-System 7.0 case */if BTst(response, gestaltLaunchFullFileSpec)  /* Handle System 7.0 case */else  /* Handle pre-System 7.0 case */</pre>	</TD></TR></TABLE></CENTER><p>The above code assumes that you are developing with interfaces and librariesbased on MPW 3.2, as those interfaces and libraries support <code>Gestalt</code> even onsystem software versions that don't implement the <code>Gestalt</code> trap.</p><p>The portion of the Process Management chapter of <i>Inside Macintosh</i> VolumeVI that will interest you is the description of the <code>launchControlFlags</code> field ofthe parameter block. Here's what the Process Management chapter has to say:</p><p>"When you use the <code>LaunchApplication</code> function, you specify the launch options inthe <code>launchControlFlags</code> field of the launch parameter block. These are theconstants you can specify in the <code>launchControlFlags</code> field.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>CONST  launchContinue = $4000;  launchNoFileFlags = $0800;  launchUseMinimum = $0400;  launchDontSwitch = $0200;  launchAllow24Bit = $0100;  launchInhibitDaemon = $0080;</pre>	</TD></TR></TABLE></CENTER><p>Set the launchContinue flag if you want your application to continue after thespecified application is launched. If you do not set this flag,<code>LaunchApplication</code> terminates your application after launching the specifiedapplication, even if the launch fails."</p><p>In other words, you have to request that your launching application continue ifyou use <code>LaunchApplication</code> - the default is to do precisely what you want. Notethat clearing the <code>launchContinue</code> flag is effectively the same as following the<code>LaunchApplication</code> call with an <code>ExitToShell</code> call. Because applications shouldnot terminate within an Apple event handler, they must set the <code>launchContinue</code>flag when calling <code>LaunchApplication</code> from within an Apple event handler.</p><p>This leaves the pre-System 7.0 case. System 4.1 and later versions allow forthe use of an extended Launch parameter block also, but it is somewhatdifferent from that of System 7.0. The complete details can be found in theMacintosh Technical Note "Sub(Launching) From a High-Level Language." You'llneed to use the extended version of the parameter block and specify a launchrather than a sublaunch.</p><p>Unfortunately, the launching application does in fact <i>not</i> quit until thelaunchee has come up. It sounds like you will have to launch a tiny utilityapplication that then turns around and launches your real target.</p><p>A good example of how all of this works in the System 7.0 case can be found in the <A HREF = "../ic/downloads/procdoggie-1a6.hqx">ProcDoggie 1.0a6</a> sample code, which is in the Sample Code folder on the System 7.0 February 1991 beta CD-ROM. Among other things, it demonstrates how to launch, and how to handle or send the required AppleEvents (<code>'oapp'</code> or <code>'odoc'</code>).</p><a name="Section7"></a><P><A HREF="#top">Back to top</A></p><h2>Changing the 'SIZE' -1 resource multilaunch bit at run time</h2><p>Date Written:  1/6/92</p><p>Last reviewed:  6/14/93</p><p>Can an application change its own <code>'SIZE'</code> -1 resource to make it multilaunch,after the user personalizes it, so the application does a once-only write toitself? If we change the <code>'SIZE'</code> -1 resource immediately after personalizationand update the resource file, can other users on the network double-click theapplication before the very first user (who personalized it) quits?</p><p>You may certainly modify the <code>'SIZE'</code> -1 resource in your application at runtime. The only reason for not modifying the application file is that usuallykeeping a preferences file is much better for the user. Your situation leavesyou no choice but to modify the app file itself. Unless you were to never storeback into your app and create a preferences file for the initial configuration....</p><p>If you change your multilaunch bit, the application will need to quit before you can multilaunch it. When a single launch app is launched, it is opened with read/write exclusive privileges instead of multiuser privileges. So, no one else will be able to open the file to see that it is multilaunch until after you have quit. But, once you restart your application, it will be multilaunchable from then on.</p><a name="Section8"></a><P><A HREF="#top">Back to top</A></p><h2>System 7 and MultiFinder's "puppet strings"</h2><p>Date Written:  8/30/91</p><p>Last reviewed:  6/14/93</p><p>When my application is running, it relies on the MultiFinder's "puppet strings"(which choose Open from the application's File menu and suppress the <code>SFGetFile</code> dialog) to open a document that was double-clicked in the Finder. Why doesn't this work under System 7? The high-level event-aware bit in my <code>'SIZE'</code> resource is clear.</p><p>System 7 will not pull puppet strings for an application that makes use of the System 7 Standard File routines, such as <code>StandardGetFile</code> and <code>CustomGetFile</code>, nor will it pull them if the application's high-level event-aware bit is set.</p><p>If you update an older application to take advantage of any System 7 features,be sure to also add support for the <code>'odoc'</code> and other required Apple events.</p><a name="Section9"></a><P><A HREF="#top">Back to top</A></p><h2>Background applications and alerts</h2><p>Date Written:  5/4/90</p><p>Last reviewed:  6/14/93</p><p>My application, running in the background, detects an error condition and putsup an alert; but only part of the alert is visible (other windows cover most ofit). When I switch back to my application, the full alert becomes visible butthe "OK" is not highlighted and often the icon is not shown either. Is theresomething I can do to prevent this?</p><p>Applications running in the background should not be putting up alerts. Inaddition to the problems and complications you have already noted, under System7.0 the user has the ability to hide a background application's window set andyour alert would not be seen at the time you expect it to.</p><p>There is, however, a mechanism in place that your background application canand should use: the Notification Manager. Documented in <i>Inside Macintosh</i>Volume VI, this manager allows a background process to notify the user thatthere is an alert, message, or situation pending in the background that needsto be taken care of. The user can then bring your application forward and youcan present your alert as the foreground application.</p><a name="Section10"></a><P><A HREF="#top">Back to top</A></p><h2>Process Manager saves and restores the 68881/882 registers</h2><p>Date Written:  5/3/89</p><p>Last reviewed:  6/14/93</p><p>Does the Process Manager save and restore the 68881/882 registers and statewhen it switches between applications?</p><p>Yes. As far as your application is concerned, it has the FPU to itself. Theonly time you need to worry about saving and restoring the FPU's state is whenyou are doing floating point operations at interrupt time, such as in a VBL orcompletion routine. Watch out for calls to the Sound Manager, since it will usefloating-point operations internally.</p><a name=Downloads></A>                  <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (33K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ps_510.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ps/ps_510.html%3Fid%3DDTS10002654-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ps/ps_510.html%3Fid%3DDTS10002654-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ps/ps_510.html%3Fid%3DDTS10002654-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>