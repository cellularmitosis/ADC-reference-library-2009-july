<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Core Image Programming Guide: Packaging Filters as Image Units</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Packaging Filters as Image Units"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001185-CH208" title="Packaging Filters as Image Units"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../ci_intro/ci_intro.html#//apple_ref/doc/uid/TP30001185-CH201-TPXREF101">Core Image Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ci_custom_filters/ci_custom_filters.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ci_revhistory/ci_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001185-CH208-SW12" title="Packaging Filters as Image Units"></a><h1>Packaging Filters as Image Units</h1><p>An image unit represents the plug-in architecture for Core Image filters. Image units use the <code>NSBundle</code> class as the packaging mechanism to allow you to make the filters that you create available to other applications. An image unit can contain filters that are executable or nonexecutable. (See <span class="content_text"><a href="../ci_concepts/ci_concepts.html#//apple_ref/doc/uid/TP30001185-CH202-BCIGFIEI">“Executable and Nonexecutable Filters”</a></span> for details.)</p><p>To create an image unit from a custom filter, you must perform the following tasks:</p><ol class="ol"><li class="li"><p>Write the filter by following the instructions in <span class="content_text"><a href="../ci_custom_filters/ci_custom_filters.html#//apple_ref/doc/uid/TP30001185-CH207-CJBEDHHH">“Creating a Custom Filter.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW7">“Create an Image Unit Project in Xcode.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW11">“Add Your Filter Files to the Project.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW5">“Customize the Load Method.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW8">“Modify the Description Property List.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW13">“Build and Test the Image Unit”</a></span></p></li></ol><p>After reading this chapter, you may also want to read <em><a href="../../ImageUnitTutorial/index.html#//apple_ref/doc/uid/TP40004531" target="_top">Image Unit Tutorial</a></em> for in-depth information on writing kernels and creating image units.</p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW14" title="Before You Get Started"></a><h2>Before You Get Started</h2><p>Go to the image unit sample provided with the developer tools. See Developer > Examples > Quartz > Core Image > CIDemoImageUnit. The directory should have the files shown in <span class="content_text">Figure 4-1</span>. When you create an image unit, you should have similar files. This image unit contains one filter, FunHouseMirror. Each filter in an image unit typically has three files: an interface file for the filter class, the associated implementation file, and a kernel file. As you can see in the figure, this is true for the FunHouseMirror filter: <code>FunHouseMirrorFilter.h</code>, <code>FunHouseMirrorFilter.m</code>, and <code>funHouseMirror.cikernel</code>.</p><p>Each image unit should also have interface and implementation files for the <code>CIPlugInRegistration</code> protocol. In the figure, see <code>MyPlugInLoader.h</code> and <code>MyPlugInLoader.m</code>. The other important file that you’ll need to modify is the <code>Description.plist</code> file.</p><p>Now that you know a bit about the files in an image unit project, you’re ready to create one.</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH208-SW6" title="Figure 4-1The files in CIDemoImageUnit"></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>The files in CIDemoImageUnit</p><img src = "../art/demo_image_unit.jpg" alt = "The files in CIDemoImageUnit" ></div><br/><a name="//apple_ref/doc/uid/TP30001185-CH208-SW7" title="Create an Image Unit Project in Xcode"></a><h2>Create an Image Unit Project in Xcode</h2><p>Xcode provides a template for creating image units. After you create an image unit project, you’ll have most of the files you need to get started and the project will be linked to the appropriate frameworks.</p><p>Follow these steps to create an image unit project in Xcode:</p><ol class="ol"><li class="li"><p>Launch Xcode and choose File > New Project.</p></li><li class="li"><p>In the New Project window, choose Image Unit Plug-in for Objective C, located under Standard Apple Plug-ins, as shown in <span class="content_text">Figure 4-2</span>. Then click Next.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001185-CH208-SW2" title="Figure 4-2The image unit template in the New Project window"></a><p><strong>Figure 4-2&nbsp;&nbsp;</strong>The image unit template in the New Project window</p><img src = "../art/new_image_unit.gif" alt = "The image unit template in the New Project window" width="382" height="325"></div></li><li class="li"><p>Name the image unit project and click Finish. </p><p>The project window opens and looks similar to what’s shown in <span class="content_text">Figure 4-3</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001185-CH208-SW9" title="Figure 4-3The project window for a new image unit project"></a><p><strong>Figure 4-3&nbsp;&nbsp;</strong>The project window for a new image unit project</p><img src = "../art/projwind_for_iu.gif" alt = "The project window for a new image unit project" width="502" height="337"></div></li></ol><p>Notice that Xcode automatically creates a kernel file called <code>MyKernelFilter.cikernel</code> and interface and implementation files for the <code>CIPlugInRegistration</code> protocol. You might want to rename the  <code>CIPlugInRegistration</code> protocol files so they are <code>MyPlugInLoader</code> just so that’s it’s easy to remember what’s in the file. The <code>MyKernelFilter.cikernel</code> file is a sample kernel file. But if you’ve already created a filter you won’t need this file, so you can delete it. You’ll add your own to the project in just a moment.</p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW5" title="Customize the Load Method"></a><h2>Customize the Load Method</h2><p>Open the file that implements the <code>CIPlugInRegistration</code> protocol. In it you’ll find a <code>load</code> method, as shown in <span class="content_text">Listing 4-1</span>. You have the option to add code to this method to perform any initialization that’s needed, such as a registration check. The method returns <code>true</code> if the filter is loaded successfully. If you don’t need any custom initialization, you can leave the load method as it is. </p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW4" title="Listing 4-1The load method provided by the image unit template"></a><p class="codesample"><strong>Listing 4-1&nbsp;&nbsp;</strong>The load method provided by the image unit template</p><div class="codesample"><table><tr><td scope="row"><pre>-(BOOL)load:(void*)host<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // custom image unit initialization code goes here<span></span></pre></td></tr><tr><td scope="row"><pre>    return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If you want, you can write an <code>unload</code> method to perform any cleanup tasks that might be required by your filter. </p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW11" title="Add Your Filter Files to the Project"></a><h2>Add Your Filter Files to the Project</h2><p>Add the filter files you created previously to the image unit project. Recall that you’ll need the interface and implementation files for each filter and the associated kernel file. If you haven’t written the filter yet, see <span class="content_text"><a href="../ci_custom_filters/ci_custom_filters.html#//apple_ref/doc/uid/TP30001185-CH207-TPXREF101">“Creating Custom Filters.”</a></span> </p><p>Keep in mind that you can package more than one filter in an image unit, and you can have as many kernel files as are appropriate for your filters. Just make sure that you include all the filter and kernel files that you want to package.</p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW8" title="Modify the Description Property List"></a><h2>Modify the Description Property List</h2><p>For executable filters, only the version number, filter class, and filter name are read from the <code>Description.plist</code> file. You provide a list of attributes for the filter in your code (see <span class="content_text"><a href="../ci_custom_filters/ci_custom_filters.html#//apple_ref/doc/uid/TP30001185-CH207-SW1">“Write a Custom Attributes Method”</a></span>). You need to check the <code>Description.plist</code> file provided in the image unit template to make sure the filter name is correct and to enter the version number. </p><p>For CPU–nonexecutable filters, the image unit host reads the <code>Description.plist</code> file to obtain information about the filter attributes listed in<span class="content_text">Table 4-1</span>. You need to modify the <code>Description.plist</code> file so that it contains the appropriate information. (For information about filter keys, see also <em><a href="../../../Reference/CoreImagingRef/index.html#//apple_ref/doc/uid/TP40001171" target="_top">Core Image Reference Collection</a></em>.)</p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW3" title="Table 4-1Keys in the filter description property list"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 4-1&nbsp;&nbsp;</strong>Keys in the filter description property list</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Associated values</p></th></tr><tr><td  scope="row"><p><code>CIPlugInFilterList</code></p></td><td ><p>A dictionary of filter dictionaries. If this key is present, it indicates that there is at least one Core Image filter defined in the image unit.</p></td></tr><tr><td  scope="row"><p><code>CIFilterDisplayName</code></p></td><td ><p>The localized filter name available in the <code>Description.strings</code> file.</p></td></tr><tr><td  scope="row"><p><code>CIFilterClass</code></p></td><td ><p>The class name in the binary that contains the filter implementation, if available.</p></td></tr><tr><td  scope="row"><p><code>CIKernelFile</code></p></td><td ><p>The filename of the filter kernel in the bundle, if available. Use this key to define a nonexecutable filter.</p></td></tr><tr><td  scope="row"><p><code>CIFilterAttributes</code></p></td><td ><p>A dictionary of attributes that describe the filter. This is the same as the attributes dictionary that you provided when you wrote the filter. </p></td></tr><tr><td  scope="row"><p><code>CIInputs</code></p></td><td ><p>An array of input keys and associated attributes. The input keys must be in the same order as the parameters of the kernel function. Each attribute must contain its parameter class (see <span class="content_text"><a href="ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW1">Table 4-2</a></span>) and name.</p></td></tr><tr><td  scope="row"><p><code>CIOutputs</code></p></td><td ><p>Reserved for future use.</p></td></tr><tr><td  scope="row"><p><code>CIHasCustomInterface</code></p></td><td ><p>None. Use this key to specify that the filter has a custom user interface. The host provides a view for the user interface.</p></td></tr><tr><td  scope="row"><p><code>CIPlugInVersion</code></p></td><td ><p>The version of the CIPlugIn architecture, which is 1.0.</p></td></tr></table></div><p><span class="content_text">Table 4-2</span> lists the input parameter classes and the value associated with each class. For a nonexecutable filter, you provide the parameter class for each input and output parameter.</p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW1" title="Table 4-2Input parameter classes and expected values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 4-2&nbsp;&nbsp;</strong>Input parameter classes and expected values</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Input parameter class</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Associated value</p></th></tr><tr><td  scope="row"><p>CIColor</p></td><td ><p>A string that specifies a color.</p></td></tr><tr><td  scope="row"><p>CIVector</p></td><td ><p>A string that specifies a vector. See <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIVector_Class/Reference/Reference.html#//apple_ref/occ/clm/CIVector/vectorWithString:" target="_top">vectorWithString:</a></code>.</p></td></tr><tr><td  scope="row"><p>CIImage</p></td><td ><p>An <code>NSString</code> object that describes either the relative path of the image to the bundle or the absolute path of the image.</p></td></tr><tr><td  scope="row"><p>All scalar types</p></td><td ><p>An <code>NSNumber</code> value.</p></td></tr></table></div><p><span class="content_text">Figure 4-4</span> shows the contents of a <code>description.plist</code> file for a color generator filter. You may want to use the Property List Editor to modify a <code>description.plist</code> file. The Property List Editor application is located in <code>Developer/Applications/Utilities/</code>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH208-SW10" title="Figure 4-4A description property list for a sample filter"></a><p><strong>Figure 4-4&nbsp;&nbsp;</strong>A description property list for a sample filter</p><img src = "../art/description_plist.gif" alt = "A description property list for a sample filter" width="337" height="478"></div><br/><a name="//apple_ref/doc/uid/TP30001185-CH208-SW13" title="Build and Test the Image Unit"></a><h2>Build and Test the Image Unit</h2><p>Even before you started creating the image unit, you should have tested the kernel code to make sure that it works properly. (See <span class="content_text"><a href="../ci_custom_filters/ci_custom_filters.html#//apple_ref/doc/uid/TP30001185-CH207-BCICGCJF">“Use Quartz Composer to Test the Kernel Routine.”</a></span>) After you successfully build the image unit, you’ll want to copy it to the following directory:</p><ul class="ul"><li class="li"><p><code>/Library/Graphics/Image Units</code> and <code>~/Library/Graphics/Image Units</code></p></li></ul><p>Then, you should try loading the image unit from an application and using the filter (or filters) that are packaged in the unit. See <span class="content_text"><a href="../ci_tasks/ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-SW2">“Loading Image Units,”</a></span> <span class="content_text"><a href="../ci_tasks/ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJFBJDI">“Getting a List of Filters and Attributes,”</a></span> and <span class="content_text"><a href="../ci_tasks/ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDDCEE">“Processing an Image.”</a></span></p><a name="//apple_ref/doc/uid/TP30001185-CH208-SW15" title="See Also"></a><h2>See Also</h2><ul class="ul"><li class="li"><p><em><a href="../../ImageUnitTutorial/index.html#//apple_ref/doc/uid/TP40004531" target="_top">Image Unit Tutorial</a></em> which provides step-by-step instructions for writing a variety of kernels and packaging them as image units.</p></li><li class="li"><p>CIDemoImageUnit is a sample image unit Xcode project which is available after you install the developer tools on your hard disk, in Developer > Examples > Quartz > Core Image.</p></li><li class="li"><p><em><a href="../../../../../samplecode/CIAnnotation/index.html#//apple_ref/doc/uid/DTS10003682" target="_top">CIAnnotation</a></em>  is a compositing and painting sample application that contains two custom image units. It is  available from the<span class="content_text"><a href="http://developer.apple.com/samplecode/GraphicsImaging/idxQuartz-date.html#doclist" target="_top">ADC Reference Library</a></span>  (<span class="content_text"><a href="../../../../../samplecode/GraphicsImaging/idxQuartz-date.html#//apple_ref/doc/uid/TP30000925-TP30000424-TP30000559" target="_top">Sample Code > Graphics &amp; Imaging > Quartz</a></span>.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ci_custom_filters/ci_custom_filters.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ci_revhistory/ci_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_image_units/ci_image_units.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_image_units/ci_image_units.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_image_units/ci_image_units.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>