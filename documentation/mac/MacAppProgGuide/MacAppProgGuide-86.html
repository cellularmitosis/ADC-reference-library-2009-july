<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Overview (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING86></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-85.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-87.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-85.html"><B>Chapter 12 - Working With Menus</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING86-0></A>
<H1><A NAME=MARKER-8-28></A>Overview</H1>
 In a Macintosh application, users activate many tasks by choosing a command from a menu. Most Macintosh applications provide at least these three standard menus: the Apple menu, the File menu, and the Edit menu. If you include the Apple menu, two more menus appear automatically on your application's menu bar: the Macintosh Menu Manager adds the Application menu, and the Help Manager adds the Help menu.<P>
 With MacApp, you specify menus and menu items in your resource definition file, using two types of resources:<P>
<UL>
<LI>The <CODE>'MBAR'</CODE> resource type tells MacApp which menus to display in the menu bar.
<LI>The <CODE>'CMNU'</CODE> resource type specifies the items in a menu and associates each item with a command number.<P>
</UL>
 When your application is launched, MacApp's Menu Manager reads your <CODE>'MBAR'</CODE> and <CODE>'CMNU'</CODE> resources and builds tables to store the information found in them. MacApp uses this menu data to manage your application's menus and to respond to user menu choices.<P>
 MacApp provides default versions of several menus in its resource definition files, including the File and Edit menus. Your application can use MacApp's default menu resources, modify MacApp's resources, or create its own menu resources.<P>
 MacApp also provides the <CODE>TMenuView</CODE> class and its <CODE>TTearOffMenuView</CODE> subclass to help your application implement tear off menus.<B></B><P>
<A NAME=HEADING86-8></A>
<H2><A NAME=MARKER-9-29></A><A NAME=MARKER-8-30></A>Working With Menu Resources</H2>
 This section describes how to specify your application's menus using menu resources.<P>
<A NAME=HEADING86-10></A>
<H3><A NAME=MARKER-9-31></A><A NAME=MARKER-2-33></A>MacApp Menu ID Constants</H3>
 MacApp defines menu constants that you can use in both your code files and your resource definition files. Several of these constants are shown in <A HREF=#MARKER-9-1>Table 12-1</A>.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-1></A><B>Table 12-1 Menu ID constants</B></CAPTION>
<TH>Menu name<TH>Menu ID constant<TH>Value <TR>
<TD>Apple<TD><CODE><A NAME=MARKER-2-2></A>mApple</CODE><TD><CODE>1</CODE><TR>
<TD>File<TD><CODE><A NAME=MARKER-2-3></A>mFile</CODE><TD><CODE>2</CODE><TR>
<TD>Edit<TD><CODE><A NAME=MARKER-2-4></A>mEdit</CODE><TD><CODE>3</CODE><TR>
<TD>(MacApp manages menus between <CODE>mFirstMenu</CODE> and <CODE>mLastMenu)</CODE><TD><CODE><A NAME=MARKER-2-5></A>mFirstMenu</CODE><TD><CODE>1</CODE><TR>
<TD>(don't define a Menu ID greater than this)<TD><CODE><A NAME=MARKER-2-6></A>mLastMenu</CODE><TD><CODE>63</CODE><TR>
<TD>(the Buzzwords menu doesn't appear in your menu bar; it is used to supply text for certain Undo menu items)<TD><CODE><A NAME=MARKER-2-7></A>mBuzzwords</CODE><TD><CODE>128</CODE></TABLE>
<P>
 The <CODE>mApple</CODE>, <CODE>mFile</CODE>, and <CODE>mEdit</CODE> constants are used in <CODE>'MBAR</CODE>' resources. The <CODE>mFirstMenu</CODE> and <CODE>mLastMenu</CODE> constants are used by MacApp when processing menu commands. The <CODE>mBuzzwords</CODE> constant is the ID for a special menu that is described in <A HREF=#MARKER-9-40>"The Buzzwords 'CMNU' Resource," beginning on page 305</A>.<P>
<A NAME=HEADING86-13></A>
<H3><A NAME=MARKER-2-36></A>The Menu Bar Manager</H3>
 The <CODE>TMenuBarManager</CODE> class manages menu-bar operations and provides routines to add menu items, add help menu items, delete menu items, and make changes to the application's menu bar. The application object creates a menu-bar manager object in the <CODE>IApplication</CODE> method. Your application can access it through the global variable <CODE>gMenuBarManager</CODE>.<P>
<A NAME=HEADING86-15></A>
<H3><A NAME=MARKER-2-34></A>The 'MBAR' Resource</H3>
 You use an <CODE>'MBAR'</CODE> resource to specify the menus that appear in your application's menu bar. The menu-bar resource stores a menu ID for each application menu that should appear in the menu bar. MacApp's predefined menu ID constants are shown in <A HREF=#MARKER-9-1>Table 12-1</A>. The value of a menu ID for a menu handled by MacApp must be in the range specified by <CODE>mApple</CODE> and <CODE>mLastMenu</CODE> (that is, from 1 to 63).<P>
 The following is a typical menu-bar resource, taken from the IconEdit sample application. It includes the three standard menus--Apple, File, and Edit--as well as an Icon menu for specifying icon operations:<P>
<PRE>
resource 'MBAR' (kMBarDisplayed,
#if qNames
&quot;IconEdit&quot;,
#endif
purgeable) 
{
    {mApple; mFile; mEdit; mIcon} 
};
</PRE>
 The definition for <CODE>mIcon</CODE> is found in the file <CODE>IconEdit.r</CODE>:<P>
<PRE>
#define mIcon4
</PRE>
 MacApp defines four constants used in constructing <CODE>'MBAR'</CODE> resources:<P>
<DL>
<DT><CODE>kMBarDisplayed</CODE>
<DD> You create one <CODE>'MBAR'</CODE> resource with this ID. MacApp reads the resource and installs the specified menus in your application's menu bar.
<DT><CODE>kMBarNotDisplayed</CODE>
<DD> <BR>You can create one <CODE>'MBAR'</CODE> resource with this ID. MacApp reads in the resource but does not automatically display it. You can call on the menu-bar manager to change to the menu bar specified by this resource.
<DT><CODE>kMBarHierarchical</CODE>
<DD> You supply one <CODE>'MBAR'</CODE> resource with this ID for each hierarchical menu in your application (see <A HREF=MacAppProgGuide-87.html#MARKER-9-83>page 316</A>).
<DT><CODE>kMBarDebug</CODE>
<DD> MacApp uses this constant to define a debug <CODE>'MBAR'</CODE> resource. The Debug menu supplies menu commands for options such as turning performance monitoring on or off and displaying a window of debug flags you can modify.
</DL>
 For information on how to build a debug version of your application, see <A HREF=MacAppProgGuide-152.html#MARKER-9-30>"Common Command-Line Options," beginning on page 678</A> in <A HREF=MacAppProgGuide-148.html#MARKER-9-10>Appendix A</A>.<A NAME=MARKER-2-35></A><P>
<A NAME=HEADING86-27></A>
<H3><A NAME=MARKER-2-36></A><A NAME=MARKER-9-37></A>Defining Menu Contents With a 'CMNU' Resource</H3>
 A <CODE>'CMNU'</CODE> resource specifies the items that appear in a menu and contains a list of attributes for each menu item. These attributes specify<P>
<UL>
<LI>the item name that will appear in the menu
<LI>the icon, if any, that should appear next to the item name in the menu
<LI>the keyboard equivalent, if any, for the menu item
<LI>the mark, if any, that the item may have
<LI>the text style in which the menu item is written
<LI>the command constant MacApp should associate with the menu item<P>
</UL>
 <A HREF=#MARKER-9-8>Table 12-2</A> shows the MacApp constants that help you fill in this information. 
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-8></A><B>Table 12-2 Menu item constants</B></CAPTION>
<TH>Constant name<TH>Effect on menu item<TR>
<TD><CODE>noIcon</CODE><TD>No icon shown<TR>
<TD><CODE>noKey</CODE><TD>No key equivalent<TR>
<TD><CODE>noMark</CODE><TD>No mark<TR>
<TD><CODE>check</CODE><TD>Mark with check<TR>
<TD><CODE>plain</CODE><TD>Plain text</TABLE>
<P>
 The following <CODE>'CMNU'</CODE> resource describes MacApp's default Edit menu:<P>
<PRE>
resource 'CMNU' (mEdit,
#if qNames
&quot;mEdit&quot;,
#endif
purgeable) {
   mEdit,
   textMenuProc,
   EnablingManagedByMacApp,
   enabled,
   &quot;Edit&quot;,
   {
   &quot;Undo&quot;,     noIcon, &quot;Z&quot;,noMark, plain, cUndo;
   &quot;-&quot;,        noIcon, noKey,noMark, plain, nocommand;
   &quot;Cut&quot;,      noIcon, &quot;X&quot;,noMark, plain, cCut;
   &quot;Copy&quot;,     noIcon, &quot;C&quot;,noMark, plain, cCopy;
   &quot;Paste&quot;,    noIcon, &quot;V&quot;,noMark, plain, cPaste;
   &quot;Clear&quot;,    noIcon, noKey,noMark, plain, cClear;
   &quot;Select All&quot;,noIcon, &quot;A&quot;,noMark, plain, cSelectAll;
   &quot;-&quot;,        noIcon, noKey,noMark, plain, nocommand;
   &quot;Show Clipboard&quot;,noIcon,noKey,noMark, plain, cShowClipboard
   }
};
</PRE>
 In the <CODE>'CMNU'</CODE> description above<P>
<UL>
<LI>Each menu item has a command number constant associated with it. For example, the Cut menu item is associated with the constant <CODE>cCut</CODE>. Command-number constants always begin with a lowercase <CODE>c</CODE>. MacApp defines these constants in both a resource definition file (<CODE>MacAppTypes.r</CODE>) and a code header file (<CODE>UMacAppGlobals.h</CODE>). Negative numbers and positive numbers up to 999 are reserved by MacApp.<P>
When you define your own command-number constants, use the same value in both your code file and resource file; otherwise, a user menu choice may result in the wrong command being performed or in nothing happening at all.
<LI>The two items with a hyphen instead of a command name are menu separators, which appear as dotted lines in the onscreen menu.
<LI>To associate an icon with a menu item, you specify a resource ID constant in place of the <CODE>noIcon</CODE> value shown in the <CODE>'CMNU'</CODE> description. The resource ID should identify an <CODE>'ICON'</CODE> resource, describing an actual icon bitmap.
<LI>To associate a keyboard equivalent with a menu item, you add the key to your <CODE>'CMNU'</CODE> resource. For example, the Paste command in the example uses <CODE>V</CODE> to indicate that Paste can be specified by pressing the Command and V keys simultaneously.
<LI>To associate a text style with a menu item, you replace the word <CODE>plain</CODE> in the sample with one of the following style constants, which are defined in the file <CODE>Types.r</CODE> and also in <CODE>Types.h</CODE>:<P>
<pre><CODE>bold</CODE> , <CODE>italic</CODE>, <CODE>underline</CODE>, <CODE>outline</CODE>, <CODE>shadow</CODE>, <CODE>condense</CODE>, <CODE>extend<A NAME=MARKER-2-38></A></CODE></pre><P>
</UL>
<A NAME=HEADING86-46></A>
<H3><A NAME=MARKER-2-39></A><A NAME=MARKER-9-40></A>The Buzzwords 'CMNU' Resource</H3>
 MacApp helps automate the process of implementing undoable commands by supplying text for the Undo menu item. For example, after a user performs a Paste operation, MacApp puts the words "Undo Paste" in the Edit menu. MacApp can put the word "Paste" in the menu because the Paste menu command is defined in the <CODE>'CMNU'</CODE> resource for the Edit menu.<P>
 However, some commands that can be undone, such as drawing with the mouse, may not be listed in any menu. To display "Undo Drawing" in the menu when a drawing command can be undone, you have to inform MacApp of the name to associate with the command number for drawing. You supply this information in a <CODE>'CMNU'</CODE> resource called the <B>Buzzwords menu.</B><P>
 The Buzzwords menu has the same format as other <CODE>'CMNU'</CODE> resources, but it always has a resource ID of 128 (defined by the constant <CODE>mBuzzwords</CODE>) and a menu title of Buzzwords. The Buzzwords menu never appears in your application's menu bar--you use it only to supply information to MacApp.<P>
 The following is the Buzzwords <CODE>'CMNU'</CODE> resource from the IconEdit sample application. Note that each entry contains a buzzword phrase and a command-number constant. For example, the word "Drawing" is associated with the constant <CODE>cDrawCommand</CODE>. This tells MacApp to show the menu phrase "Undo Drawing" for a drawing command.<P>
<PRE>
resource 'CMNU' (mBuzzwords) {
   mBuzzwords,
   textMenuProc,
   allEnabled,
   enabled,
   &quot;Buzzwords&quot;,
    {
      &quot;Page Setup Change&quot;, noIcon, noKey, noMark, plain,
                                       cChangePrinterStyle;
      &quot;Drawing&quot;, noIcon, noKey, noMark, plain, cDrawCommand;
      &quot;Set Color&quot;, noIcon, noKey, noMark, plain, cSetColor
   }
};
</PRE>
<A NAME=HEADING86-52></A>
<H2><A NAME=MARKER-9-41></A><A NAME=MARKER-2-42></A>Enabling and Disabling Menu Items</H2>
 If a menu command is currently available, the menu item for that choice should be enabled. If a menu command is not currently available, the menu item should be disabled and its text dimmed. For example, if nothing in the active view is selected, the Cut command on the Edit menu is normally disabled and its text is dimmed.<P>
 MacApp calls <CODE>gApplication-&gt;<A NAME=MARKER-2-43></A>SetupTheMenus</CODE> whenever the status of menu items might need to be updated, including when the user clicks in the menu bar or when a key event is received. The <CODE>SetupTheMenus</CODE> method first disables each menu item on each menu MacApp manages (the Apple menu is managed by the system), then calls the <A NAME=MARKER-2-44></A><CODE>HandleSetupMenus</CODE> method of the current target object. <P>
 The <CODE>HandleSetupMenus</CODE> method causes the <CODE>DoSetupMenus</CODE> method to be called for each behavior object and event handler in the target chain, giving each object a chance to enable the menu items it can handle. When this process is finished, only those menu items that can be handled by objects in the current target chain are enabled.<P>
 <A HREF=#MARKER-9-45>Figure 12-1</A> shows how event-handler objects and behavior objects in the target chain enable menu items.<P>
<B>Figure 12-1  <A NAME=MARKER-9-45></A>Enabling menu items</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-002.gif"><P>
 The <A NAME=MARKER-2-46></A><CODE>DoSetupMenus</CODE> method is inherited by classes that descend from the <CODE>TEventHandler</CODE> class and by classes that descend from the <CODE>TBehavior</CODE> class. When you define a class that descends from one of these classes, you override the <CODE>DoSetupMenus</CODE> method to enable the menu items your class can handle. <P>
 You enable a specific menu item by calling the <CODE>Enable</CODE> routine and passing the command constant associated with the menu item. For example:<P>
<PRE>
void TYourClass::DoSetupMenus()
{
   Inherited::DoSetupMenus();
   Enable(cMyCommand, TRUE);
}
</PRE>
 The <CODE>Enable</CODE> routine is used to enable or disable the menu item with the specified command number. You can also enable menu items with the <CODE>EnableCheck</CODE> routine, which enables the item and adds a checkmark next to it.<P>
<DL>
<DT><B>Note</B>
<DD>You don't normally need to disable menu items in a <CODE>DoSetupMenus</CODE> method, because MacApp disables all items before calling <CODE>DoSetupMenus</CODE>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 To enable menu items with a behavior object, you define a subclass of <CODE>TBehavior</CODE> and override the <CODE>DoSetupMenus</CODE> method. Your application creates an instance of the new behavior class and associates it with an event-handler object by calling the <CODE>AddBehavior</CODE> method of the event handler. You also override methods such as <CODE>DoMenuCommand</CODE> or <CODE>DoKeyEvent</CODE> in your behavior class to handle the menu choices you have enabled.<A NAME=MARKER-2-47></A><A NAME=MARKER-2-48></A><P>
<A NAME=HEADING86-65></A>
<H2><A NAME=MARKER-9-49></A><A NAME=MARKER-2-50></A>Processing a Menu Choice</H2>
 Once you have defined menu resources to describe your application's menus, MacApp takes care of displaying the menus and dispatching user menu choices.<P>
 When a user chooses a menu command, MacApp calls the <CODE>HandleMenuCommand</CODE> method of the current target object, passing the command number associated with the menu choice. If the target object or a behavior object attached to it can't handle the choice, it passes it on to the next object in the target chain. If no object in the target chain handles the menu choice, it is ignored. This process is shown in <A HREF=MacAppProgGuide-42.html#MARKER-9-95>Figure 5-4 on page 110</A>.<P>
 You use event-handler objects and behavior objects to respond to menu choices. These classes are described in <A HREF=MacAppProgGuide-40.html#MARKER-9-19>Chapter 5, "Events and Commands."</A><P>
 Certain objects in an application typically handle specific menu commands:<P>
<UL>
<LI>The application object handles the About command, as well as the New, Open, and Quit commands in the File menu. In debug versions, the application object also handles performance monitor commands and debug menu commands.
<LI>The Clipboard manager object handles the Show Clipboard and Hide Clipboard commands.
<LI>Document objects handle the Save, Save As, Save a Copy, and Revert to Saved commands in the file menu. A <CODE>TEditionDocument</CODE> object knows how to handle Create Publisher, Subscribe to, Publisher Options, Subscriber Options, Show Borders, Hide Borders, and Stop All Editions commands.
<LI>For applications that support AppleTalk mailers, a letter (based on the <CODE>TLetter</CODE> or <CODE>TFileBasedLetter</CODE> class) works with the document object (based on <CODE>TMailableDocument</CODE>) to handle the Mail menu commands Add Mailer, Send, Reply, and Forward. The application object (based on the <CODE>TMailingApplication</CODE> class) handles Open Next Letter.
<LI>Window objects usually handle the Close command, but in certain circumstances the application object can close the frontmost window.
<LI>View objects typically handle commands that modify the display of information on the screen, such as Cut, Copy, Clear, Paste, and Select All.
<LI>The <CODE>TStdPrintHandler</CODE> behavior object handles the Print, Print One, Page Setup, and Show Page Breaks commands from the File menu.
<LI>Any command-handler object, working together with the application object, can handle the Undo menu command.<A NAME=MARKER-2-51></A><P>
</UL>
<A NAME=HEADING86-78></A>
<H3><A NAME=MARKER-2-52></A>Changing Menus From Your Application</H3>
 MacApp provides routines to change the appearance of menus while your application is running:<P>
<DL>
<DT><CODE>SetCommandName</CODE>
<DD> The <A NAME=MARKER-2-53></A><CODE>SetCommandName</CODE> routine changes a menu item's text.
<DT><CODE>SetStyle</CODE>
<DD> The <A NAME=MARKER-2-54></A><CODE>SetStyle</CODE> routine changes a menu item's font style.
<DT><CODE>SetCommandIcon</CODE>
<DD> The <A NAME=MARKER-2-55></A><CODE>SetCommandIcon</CODE> routine displays a menu item icon.
<DT><CODE>EnableCheck</CODE>
<DD> The <A NAME=MARKER-2-56></A><CODE>EnableCheck</CODE> routine checks or unchecks a menu item, and also enables or disables it.
</DL>
 You can read about these routines in the <I>MacApp Class and Method Reference</I>.<A NAME=MARKER-2-57></A><P>
<A NAME=HEADING86-85></A>
<H3><A NAME=MARKER-2-58></A>Working With Pop-Up Menus</H3>
 Pop-up menus are useful for presenting a list of choices. For example, you might use a pop-up menu to set the baud rate in a modem-setup dialog box or to choose the line spacing in a word-processing program.<P>
 A pop-up menu appears as a rectangle with a 1-pixel border and a 1-pixel drop shadow. Pop-up menus are identified by a downward-pointing triangle that appears in the pop-up box. The title of the pop-up menu appears next to the pop-up box. <A HREF=#MARKER-9-59>Figure 12-2</A> shows a simple pop-up menu. <P>
<B>Figure 12-2  <A NAME=MARKER-9-59></A>Simple pop-up menu</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-005.gif"><P>
 To open a pop-up menu, the user presses the mouse button while the cursor is over the pop-up title or pop-up box. The menu "pops up," displaying the items in the menu with the current item highlighted. As the user drags the cursor through the menu, the item under the cursor is highlighted. When the user releases the mouse button, the highlighted item becomes the current item.<P>
 <A HREF=#MARKER-9-60>Figure 12-3</A> shows a pop-up menu in its closed and open states.<B> </B>You can read more about pop-up menus in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> and in the <I>Macintosh Human Interface Guidelines</I>.<P>
<!--<B>Figure 12-3  <A NAME=MARKER-9-60></A>A pop-up menu in its closed and open states</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-006.gif">--><P>
<A NAME=HEADING86-94></A>
<H3><A NAME=MARKER-2-61></A>The TPopup Class</H3>
 You implement a pop-up menu with the MacApp class <CODE>TPopup</CODE> or with a subclass you define. The <CODE>TPopup</CODE> class is a subclass of <CODE>TControl</CODE>, which is in turn a descendant of <CODE>TView</CODE>. The <CODE>TPopup</CODE> class defines these fields:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-62></A>fStrListID</CODE> <CODE>/<A NAME=MARKER-2-63></A>fIndex<BR></CODE>Specifies the pop-up menu's title in a string resource list (<CODE>'STR#'</CODE>).
<DD>
<DT><CODE><A NAME=MARKER-2-64></A>fMenuID</CODE>
<DD> Specifies a resource ID of a <CODE>'MENU'</CODE> or <CODE>'CMNU'</CODE> resource for the pop-up menu.
<DT><CODE><A NAME=MARKER-2-65></A>fCurrentItem</CODE>
<DD> Specifies the currently chosen menu item.
<DT><CODE><A NAME=MARKER-2-66></A><A NAME=MARKER-9-67></A>fItemOffset</CODE> 
<DD> Stores the width of the pop-up title area (from the left edge of the view to the pop-up menu view).
</DL>
 <A HREF=#MARKER-9-68>Figure 12-4</A> shows how a pop-up menu view is drawn. When a <CODE>TPopup</CODE> object is created, its pop-up menu view is initialized and installed in the specified superview. The menu title is drawn starting at <CODE>fItemOffset</CODE>, using the justification specified by the <CODE>fTitleJust</CODE> field (the default is left justified). The pop-up selector is drawn to the right of <CODE>fItemOffset</CODE>, with its width and height determined by the menu dimensions.<P>
<B>Figure 12-4  <A NAME=MARKER-9-68></A>A pop-up menu view</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-007.gif"><P>
<A NAME=HEADING86-103></A>
<H3><A NAME=MARKER-2-69></A><A NAME=MARKER-9-70></A>Responding to a User Menu Choice</H3>
 When a user clicks a pop-up menu, a mouse-down event is sent to the window containing the view. The <CODE>DoMouseCommand</CODE> method of the <CODE>TCtlMgr</CODE> ancestor of <CODE>TPopup</CODE> tracks the mouse by calling the Toolbox routine <CODE>TrackControl</CODE>. If the user selects an item in the pop-up menu, <CODE>DoMouseCommand</CODE> sets the pop-up's <CODE>fLongVal</CODE> field to the number of the selected menu item, then calls <CODE>HandleEvent</CODE>, passing an event constant. This results in a call to the pop-up's <CODE>DoEvent</CODE> method.<P>
 The event constant passed to <CODE>HandleEvent</CODE> comes from the pop-up's <CODE>fEventNumber</CODE> field (defined in the <CODE>TCtlMgr</CODE> parent class of <CODE>TPopup</CODE>). For a pop-up menu, it defaults to <CODE>mPopupHit</CODE>. The <CODE>TPopup</CODE> class doesn't override <CODE>DoEvent</CODE>, so to respond to a user menu choice, you can either define a subclass of <CODE>TPopup</CODE> and override the <CODE>DoEvent</CODE> method, or override <CODE>DoEvent</CODE> in the view class of the pop-up's superview.<P>
 For example, for a pop-up menu displayed in a dialog view, you can override the <CODE>DoEvent</CODE> method of the dialog view, as shown in the following code sample:<P>
<PRE>
void TTestDialogView::DoEvent(EventNumbereventNumber,
                        TEventHandler*source,
                        TEvent*     event) // Override.
{
   // If the event concerns our pop-up menu...
   if((eventNumber == mPopupHit) &amp;&amp; (source == fMyPopup))
   {
      // Get the command number associated with the selected
      // pop-up menu item.
      aCommandNumber = ((TPopup*)source)-&gt;GetCurrentCommand();
      switch (aCommandNumber)
      {
         // If it's a command number we're interested in, process it.
         case cMyCommand:
               // Code to respond to the command constant.
         .
         .
         .
      } // End switch.
   }      break;
}  // TTestDialogView::DoEvent
</PRE>
 The <CODE>GetCurrentCommand</CODE> method calls <CODE>CommandFromMenuItem</CODE> to get a command number for the chosen pop-up menu item. If you have defined your pop-up menu with a <CODE>'CMNU'</CODE> resource, as described on <A HREF=#MARKER-9-37>page 303</A>, you can associate command constants with pop-up menu items, just as you would with items on a standard menu.<A NAME=MARKER-2-71></A><A NAME=MARKER-2-72></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-85.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-87.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
