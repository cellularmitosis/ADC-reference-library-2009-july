<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime File Format Specification: Media Data Atom Types</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Media Data Atom Types"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000939-CH205" title="Media Data Atom Types"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> &gt; <a href="../../../../reference/QuickTime/index.html#//apple_ref/doc/uid/TP30001281-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../reference/QuickTime/idxFileFormatSpecification-date.html#//apple_ref/doc/uid/TP30001281-TP30000433-TP30000509" target="_top">File Format Specification</a> &gt; <a href="../QTFFPreface/qtffPreface.html#//apple_ref/doc/uid/TP40000939-CH202-TPXREF101">QuickTime File Format Specification</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../QTFFChap2/qtff2.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../QTFFChap4/qtff4.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000939-CH205-SW1" title="Media Data Atom Types"></a><h1><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCBGDG" title="Media Data Atom Types"></a>Media Data Atom Types</h1>
<p>QuickTime uses atoms of different types to
store different types of media data—video media atoms for video
data, sound media atoms for audio data, and so on. This chapter discusses
in detail each of these different media data atom types.</p>
<p>If you are a QuickTime application or tool developer, you’ll
want to read this chapter in order to understand the fundamentals
of how QuickTime uses atoms for storage of different media data.
For the latest updates and postings, be sure to see <span class="content_text"><a href="../../../../referencelibrary/QuickTime/index.html" target="_top">Apple's QuickTime developer website</a></span>.</p>
<p>This chapter is divided into the following major sections:</p>
<ul class="ul"><li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-74522">“Video Media”</a></span> describes video media, which is used to store
compressed and uncompressed image data in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-75770">“Sound Media”</a></span> discusses sound media used to store compressed
and uncompressed audio data in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69831">“Timecode Media”</a></span> describes time code media used to store time
code data in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69835">“Text Media”</a></span> discusses text media used to store text data
in QuickTime movies. </p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69839">“Music Media”</a></span> discusses music media used to store note-based
audio data, such as MIDI data, in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124205">“MPEG-1 Media”</a></span> discusses
MPEG-1 media used to store MPEG-1 video and MPEG-1 multiplexed audio/video streams
in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69847">“Sprite Media”</a></span> discusses sprite media used to store character-based
animation data in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69855">“Tween Media”</a></span> discusses tween media used to store pairs of
values to be interpolated between in QuickTime movies.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69859">“Modifier Tracks”</a></span> discusses the capabilities of modifier tracks. </p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69894">“Track References”</a></span> describes a feature of QuickTime that allows
you to relate a movie’s tracks to one another. </p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69863">“3D Media”</a></span> discusses briefly how QuickTime movies store
3D image data in a base media.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69871">“Hint Media”</a></span> describes the additions to the QuickTime file
format for streaming QuickTime movies over the Internet.</p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69877">“VR Media”</a></span> describes the QuickTime VR world and node information
atom containers, as well as cubic panoramas, which are new to QuickTime
VR 3.0. </p></li>
<li class="li"><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69881">“Movie Media”</a></span> discusses movie media which is used to encapsulate
embedded movies within QuickTime movies. </p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-74522" title="Video Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBACAB" title="Video Media"></a><h2>Video Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_400"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_401"></a>Video
media is used to store compressed and uncompressed image data in
QuickTime movies. It has a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_402"></a>'<code>vide</code>'. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-74550" title="Video Sample Description"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGICBJ" title="Video Sample Description"></a><h3>Video Sample Description</h3>
<p>The video <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_403"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_404"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_405"></a>sample
description contains information that defines how to interpret <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_406"></a>video media data. A
video sample description begins with the four fields described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-61112">“General Structure of a Sample Description.”</a></span> </p>
<p>The data format field of a video sample description indicates
the type of compression that was used to compress the image data,
or the color space representation of uncompressed video data. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-118502">Table 3-1</a></span> shows
some of the formats supported. The list is not exhaustive, and is
subject to addition.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_407"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-118502" title="Table 3-1Some image compression formats"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF101" title="Table 3-1Some image compression formats"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Some image compression formats</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Compression type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_408"></a><code>'cvid'</code></p></td>
<td ><p>Cinepak</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_409"></a><code>'jpeg'</code></p></td>
<td ><p>JPEG</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_410"></a><code>'smc '</code></p></td>
<td ><p>Graphics</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_411"></a><code>'rle '</code></p></td>
<td ><p>Animation</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_412"></a><code>'rpza'</code></p></td>
<td ><p>Apple video</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_413"></a><code>'kpcd'</code></p></td>
<td ><p>Kodak Photo CD</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'png '</code></p></td>
<td ><p>Portable Network Graphics </p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_414"></a><code>'mjpa'</code></p></td>
<td ><p>Motion-JPEG (format A)</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_415"></a><code>'mjpb'</code></p></td>
<td ><p>Motion-JPEG (format B)</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_416"></a><code>'SVQ1'</code></p></td>
<td ><p>Sorenson video, version 1</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'SVQ3'</code></p></td>
<td ><p>Sorenson video 3</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'mp4v'</code></p></td>
<td ><p>MPEG-4 video</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'dvc '</code></p></td>
<td ><p>NTSC DV-25 video</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'dvcp'</code></p></td>
<td ><p>PAL DV-25 video</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'gif '</code></p></td>
<td ><p>Compuserve Graphics Interchange Format</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'h263'</code></p></td>
<td ><p>H.263 video</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'tiff'</code></p></td>
<td ><p>Tagged Image File Format</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_417"></a><code>'raw '</code></p></td>
<td ><p>Uncompressed RGB</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'2vuY&#8242;</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 8-bit-per-component 4:2:2</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'yuv2'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 8-bit-per-component 4:2:2</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'v308'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 8-bit-per-component 4:4:4</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'v408'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 8-bit-per-component 4:4:4:4</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'v216'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 10, 12, 14, or 16-bit-per-component 4:2:2</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'v410'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 10-bit-per-component 4:4:4</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'v210'</code></p></td>
<td ><p>Uncompressed Y&#8242;CbCr, 10-bit-per-component 4:2:2</p></td>
</tr>

</table></div>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_418"></a>video
media sample description adds the following fields to the general sample description. </p>
<dl class="termdef">	<dt>Version</dt>
<dd><p>A 16-bit integer indicating the version number of the
compressed data. This is set to 0, unless a compressor has changed
its data format.</p></dd>
<dt>Revision level</dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd>
<dt>Vendor</dt>
<dd><p>A 32-bit integer that specifies the developer of the
compressor that generated the compressed data. Often this field
contains <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_419"></a>'<code>appl</code>' to
indicate Apple Computer, Inc.</p></dd>
<dt>Temporal quality</dt>
<dd><p>A 32-bit integer containing a value from 0 to 1023 indicating
the degree of temporal compression.</p></dd>
<dt>Spatial quality</dt>
<dd><p>A 32-bit integer containing a value from 0 to 1024 indicating
the degree of spatial compression.</p></dd>
<dt>Width</dt>
<dd><p>A 16-bit integer that specifies the width of the source
image in pixels.</p></dd>
<dt>Height</dt>
<dd><p>A 16-bit integer that specifies the height of the source
image in pixels.</p></dd>
<dt>Horizontal resolution</dt>
<dd><p>A 32-bit fixed-point number containing the horizontal
resolution of the image in pixels per inch.</p></dd>
<dt>Vertical resolution</dt>
<dd><p>A 32-bit fixed-point number containing the vertical
resolution of the image in pixels per inch.</p></dd>
<dt>Data size</dt>
<dd><p>A 32-bit integer that must be set to 0.</p></dd>
<dt>Frame count</dt>
<dd><p>A 16-bit integer that indicates how many frames of compressed
data are stored in each sample. Usually set to 1.</p></dd>
<dt>Compressor name</dt>
<dd><p>A 32-byte Pascal string containing the name of the compressor
that created the image, such as <code>"jpeg"</code>.</p></dd>
<dt>Depth</dt>
<dd><p>A 16-bit integer that indicates the pixel depth of the
compressed image. Values of 1, 2, 4, 8 ,16, 24, and 32 indicate
the depth of color images. The value 32 should be used only if the
image contains an alpha channel. Values of 34, 36, and 40 indicate
2-, 4-, and 8-bit grayscale, respectively, for grayscale images.</p></dd>
<dt>Color table ID</dt>
<dd><p>A 16-bit integer that identifies which color table to
use. If this field is set to –1, the default color table should
be used for the specified depth. For all depths below 16 bits per
pixel, this indicates a standard Macintosh color table for the specified
depth. Depths of 16, 24, and 32 have no color table.</p><p>If the
color table ID is set to 0, a color table is contained within the
sample description itself. The color table immediately follows the
color table ID field in the sample description. See <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25533">“Color Table Atoms”</a></span> for a complete description
of a color table.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-124342" title="Video Sample Description Extensions"></a><h4>Video
Sample Description Extensions</h4>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_420"></a>Video
sample descriptions can be extended by appending other atoms. These
atoms are placed after the color table, if one is present. These
extensions to the sample description may contain display hints for
the decompressor or may simply carry additional information associated
with the images. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124374">Table 3-2</a></span> lists the currently defined extensions to video sample
descriptions.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-124374" title="Table 3-2Video sample description extensions"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF102" title="Table 3-2Video sample description extensions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-2&nbsp;&nbsp;</strong>Video sample description extensions</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Extension type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_421"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_422"></a><code>'gama'</code></p></td>
<td ><p>A 32-bit fixed-point number indicating the gamma level
at which the image was captured. The decompressor can use this value
to gamma-correct at display time.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_423"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_424"></a><code>'fiel'</code></p></td>
<td ><p>Two 8-bit integers that define field handling. This information
is used by applications to modify decompressed image data or by decompressor
components to determine field display order. This extension is mandatory
for all uncompressed Y&#8242;CbCr data formats.The first byte specifies
the field count, and may be set to 1 or 2. A value of 1 is used
for progressive-scan images; a value of 2 indicates interlaced images. When
the field count is 2, the second byte specifies the field ordering:
which field contains the topmost scan-line, which field should be
displayed earliest, and which is stored first in each sample. Each sample
consists of two distinct compressed images, each coding one field:
the field with the topmost scan-line, T, and the other field, B. The
following defines the permitted variants:0 – There is only one
field. 1 – T is displayed earliest, T is stored first in the file. 6
– B is displayed earliest, B is stored first in the file.9 –
B is displayed earliest, T is stored first in the file.14 – T
is displayed earliest, B is stored first in the file. </p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_425"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_426"></a><code>'mjqt'</code></p></td>
<td ><p>The default quantization table for a Motion-JPEG data
stream.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_427"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_428"></a><code>'mjht'</code></p></td>
<td ><p>The default Huffman table for a Motion-JPEG data stream.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'esds'</code></p></td>
<td ><p>An MPEG-4 elementary stream descriptor atom. This extension is
required for MPEG-4 video. For details, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124774">“MPEG-4 Elementary Stream Descriptor ('esds') Atom.”</a></span></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'pasp'</code></p></td>
<td ><p>Pixel aspect ratio. This extension is mandatory for video
formats that use non-square pixels. For details, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124550">“Pixel Aspect Ratio ('pasp').”</a></span></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'colr'</code></p></td>
<td ><p>Color parameters—an image description extension required
for all uncompressed Y&#8242;CbCr video types. For details, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-125526">“Color Parameter Atoms ('colr').”</a></span></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'clap'</code></p></td>
<td ><p>Clean aperture—spatial relationship of Y&#8242;CbCr components relative
to a canonical image center. This allows accurate alignment for
compositing of video images captured using different systems. This
is a mandatory extension for all uncompressed Y&#8242;CbCr data formats.
For details, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-125850">“Clean Aperture ('clap').”</a></span></p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-124550" title="Pixel Aspect Ratio (&#39;pasp&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCFBBEC" title="Pixel Aspect Ratio (&#39;pasp&#39;)"></a><h5>Pixel Aspect Ratio ('pasp')</h5>
<p>This extension specifies the height-to-width ratio of pixels
found in the video sample. This is a required extension for MPEG-4
and uncompressed Y&#8242;CbCr video formats when non-square pixels are
used. It is optional when square pixels are used.</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the pixel aspect
ratio atom.</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit field containing the four-character
code <code>'pasp'</code>.</p></dd>
<dt>hSpacing</dt>
<dd><p>An unsigned 32-bit integer specifying the horizontal
spacing of pixels, such as luma sampling instants for Y&#8242;CbCr or
YUV video.</p></dd>
<dt>vSpacing</dt>
<dd><p>An unsigned 32-bit integer specifying the vertical spacing
of pixels, such as video picture lines.</p></dd></dl>
<p>The units of measure for the <code><!--a  -->hSpacing<!--/a--></code> and <code><!--a  -->vSpacing<!--/a--></code> parameters
are not specified, as only the ratio matters. The units of measure
for height and width must be the same, however.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-124652" title="Table 3-3Common pixel aspect ratios"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-3&nbsp;&nbsp;</strong>Common pixel aspect ratios</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>hSpacing  </p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>vSpacing </p></th>
</tr>


<tr>
<td  scope="row"><p>4:3 square pixels (composite NTSC or PAL)</p></td>
<td ><p>1</p></td>
<td ><p>1</p></td>
</tr>
<tr>
<td  scope="row"><p>4:3 non-square 525 (NTSC)</p></td>
<td ><p>10</p></td>
<td ><p>11</p></td>
</tr>
<tr>
<td  scope="row"><p>4:3 non-square 625 (PAL)</p></td>
<td ><p>59</p></td>
<td ><p>54</p></td>
</tr>
<tr>
<td  scope="row"><p>16:9 analog (composite NTSC or PAL)</p></td>
<td ><p>4</p></td>
<td ><p>3</p></td>
</tr>
<tr>
<td  scope="row"><p>16:9 digital 525 (NTSC)</p></td>
<td ><p>40</p></td>
<td ><p>33</p></td>
</tr>
<tr>
<td  scope="row"><p>16:9 digital 625 (PAL)</p></td>
<td ><p>118</p></td>
<td ><p>81</p></td>
</tr>
<tr>
<td  scope="row"><p>1920x1035 HDTV (per SMPTE 260M-1992)</p></td>
<td ><p>113</p></td>
<td ><p>118</p></td>
</tr>
<tr>
<td  scope="row"><p>1920x1035 HDTV (per SMPTE RP 187-1995)</p></td>
<td ><p>1018</p></td>
<td ><p>1062</p></td>
</tr>
<tr>
<td  scope="row"><p>1920x1080 HDTV or 1280x720 HDTV</p></td>
<td ><p>1</p></td>
<td ><p>1</p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-124774" title="MPEG-4 Elementary Stream Descriptor Atom (&#39;esds&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBHABF" title="MPEG-4 Elementary Stream Descriptor Atom (&#39;esds&#39;)"></a><h5>MPEG-4 Elementary Stream Descriptor Atom ('esds')</h5>
<p>This atom contains an MPEG-4 elementary stream descriptor atom. This
is a required extension to the video sample description for MPEG-4
video. This extension appears in video sample descriptions only
when the codec type is <code>'mp4v'</code>.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_41" title="Note"></a><p><strong>Note:</strong>&nbsp;The elementary
stream descriptor which this atom contains is defined in the MPEG-4
specification ISO/IEC FDIS 14496-1.</p></div>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the elementary
stream descriptor atom.</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit field containing the four-character
code <code>'esds'</code></p></dd>
<dt>Version</dt>
<dd><p>An unsigned 8-bit integer set to zero.</p></dd>
<dt>Flags</dt>
<dd><p>A 24-bit field reserved for flags, currently set to
zero.</p></dd>
<dt>Elementary Stream Descriptor</dt>
<dd><p>An elementary stream descriptor for MPEG-4 video, as
defined in the MPEG-4 specification ISO/IEC 14496-1 and subject
to the restrictions for storage in MPEG-4 files specified in ISO/IEC
14496-14.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-125526" title="Color Parameter Atoms (&#39;colr&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGIECA" title="Color Parameter Atoms (&#39;colr&#39;)"></a><h5>Color Parameter Atoms ('colr')</h5>
<p>This atom is a required extension for uncompressed Y&#8242;CbCr
data formats. The <code>'colr'</code> extension
is used to map the numerical values of pixels in the file to a common representation
of color in which images can be correctly compared, combined, and displayed.
The common representation is the CIE XYZ tristimulus values (defined
in Publication CIE No. 15.2).</p>
<p>Use of a common representation also allows you to correctly
map between Y&#8242;CbCr and RGB color spaces and to correctly compensate
for gamma on different systems. </p>
<p>The <code>'colr'</code> extension supersedes
the previously defined <code>'gama'</code> Image
Description extension. Writers of QuickTime files should never write
both into an Image Description, and readers of QuickTime files should
ignore <code>'gama'</code> if <code>'colr'</code> is
present.</p>
<p>The <code>'colr'</code> extension is designed
to work for multiple imaging applications such as video and print.
Each application, driven by its own set of historical and economic
realities, has its own set of parameters needed to map from pixel
values to CIE XYZ.</p>
<p>The CIE XYZ representation is mapped to various stored Y&#8242;CbCr
formats using a common set of transfer functions and matrixes. The transfer
function coefficients and matrix values are stored as indexes into
a table of canonical references. This provides support for multiple
video systems while limiting the scope of possible values to a set
of recognized standards.</p>
<p>The <code>'colr'</code> atom contains four
fields: a color parameter type and three indexes. The indexes are
to a table of primaries, a table of transfer function coefficients,
and a table of matrixes.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-142951" title="Figure 3-1Color atom"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>Color atom</p><img src = "../art/qtff_13.jpg" alt = "Color atom" ></div><br/>
<p>The table of matrixes specifies the matrix used during the
translation, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143931">Figure 3-2</a></span>.</p>
<dl class="termdef">	<dt>Color parameter type</dt>
<dd><p>A 32-bit field containing a four-character code for
the color parameter type. The currently defined types are <code>'nclc' </code>for
video, and <code>'prof'</code> for print. The color parameter type distinguishes between print and video mappings.</p><p>If
the color parameter type is <code>'prof'</code>, then
this field is followed by an ICC profile. This is the color model
used by Apple’s ColorSync. The contents of this type are not defined
in this document. Contact Apple Computer for more information on
the <code>'prof'</code> type <code>'colr'</code> extension.</p><p>If
the color parameter type is <code>'nclc' </code>then
this atom contains the following fields:</p></dd>
<dt>Primaries index</dt>
<dd><p>A 16-bit unsigned integer containing an index into a
table specifying the CIE 1931 xy chromaticity coordinates of the
white point and the red, green, and blue primaries. The table of primaries specifies the white point and the red,
green, and blue primary color points for a video system.</p></dd>
<dt>Transfer function index</dt>
<dd><p>A 16-bit unsigned integer containing an index into a
table specifying the nonlinear transfer function coefficients used
to translate between RGB color space values and Y&#8242;CbCr values. The table of transfer function coefficients specifies the
nonlinear function coefficients used to translate between the stored
Y&#8242;CbCr values and a video capture or display system, as shown in
<span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143931">Figure 3-2</a></span>.</p></dd>
<dt>Matrix index</dt>
<dd><p>A 16-bit unsigned integer containing an index into a
table specifying the transformation matrix coefficients used to
translate between RGB color space values and Y&#8242;CbCr values. The table of matrixes specifies the matrix used during the
translation, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143931">Figure 3-2</a></span>.</p></dd></dl>
<p>The transfer function and matrix are used as shown in the
following diagram.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143931" title="Figure 3-2Transfer between RGB and Y&amp;#8242;CbCr color spaces"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBCHEG" title="Figure 3-2Transfer between RGB and Y&amp;#8242;CbCr color spaces"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong>Transfer between RGB and Y&#8242;CbCr color
spaces</p><img src = "../art/qtff_14.jpg" alt = "Transfer between RGB and Y&#8242;CbCr color spaces" ></div><br/>
<p>The Y&#8242;CbCr values stored in a file are normalized to a range
of [0,1]for Y&#8242; and [-0.5, +0.5] for Cb and Cr when performing these
operations. The normalized values are then scaled to the proper
bit depth for a particular Y&#8242;CbCr format before storage in the file. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143966" title="Figure 3-3The normalized values are shown using the symbol E with a subscript for Y&amp;#8242;, Cb, or Cr:"></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>The normalized values are shown using
the symbol E with a subscript for Y&#8242;, Cb, or Cr:</p>
<img src = "../art/qtff_15.gif" alt = "The normalized values are shown using the symbol E with a subscript for Y&#8242;, Cb, or Cr:" width="152" height="61"></div><br/>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_42" title="Note"></a><p><strong>Note:</strong>&nbsp;The symbols used
for these values are not intended to correspond to the use of these
same symbols in other standards. In particular, "E" should
not be interpreted as voltage. </p></div>
<p>These normalized values can be mapped onto the stored integer
values of a particular compression type's Y&#8242;, Cb, and Cr components
using two different schemes, which we will call Scheme A and Scheme
B.</p>
<div class="warningbox"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_43" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;

Other, slightly different encoding/mapping schemes
exist in the video industry, and data encoded using these schemes
must be converted to one of the QuickTime schemes defined here.</p><p></p><div class="clear"></div></div>
<p>Scheme A uses "Wide-Range" mapping (full scale)
with unsigned Y&#8242; and twos-complement Cb and Cr values. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143827" title="Figure 3-4Equations for stored Y&amp;#8242;CbCr values of bit-depth of n in scheme A"></a><p><strong>Figure 3-4&nbsp;&nbsp;</strong>Equations for stored Y&#8242;CbCr values
of bit-depth of <code>n</code> in scheme A</p>
<img src = "../art/qtff_16.gif" alt = "Equations for stored Y&#8242;CbCr values of bit-depth of n in scheme A" width="153" height="64"></div><br/>
<p>This maps normalized values to stored values so that, for
example, 8-bit unsigned values for Y&#8242; go from 0-255 as the normalized
value goes from 0 to 1, and 8-bit signed valued for Cb and Cr go
from  -127 to +127 as the normalized values go from -0.5 to +0.5. </p>
<div class="warningbox"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_44" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
In specifications such as ITU-R BT.601-4, JFIF 1.02,
and SPIFF (Rec. ITU-T T.84), the symbols Cb and Cr are used to describe
offset binary integers, not twos-complement signed integers shown here.</p><p></p><div class="clear"></div></div>
<p>Scheme B uses "Video-Range" mapping with unsigned
Y&#8242; and offset binary Cb and Cr values.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_45" title="Note"></a><p><strong>Note:</strong>&nbsp;Scheme B comes
from digital video industry specifications such as Rec. ITU-R BT.
601-4. All standard digital video tape formats (e.g., SMPTE D-1,
SMPTE D-5) and all standard digital video links (e.g., SMPTE 259M-1997
serial digital video) use this scheme. Professional video storage
and processing equipment from vendors such as Abekas, Accom, and
SGI also use this scheme. MPEG-2, DVC and many other codecs specify
source Y&#8242;CbCr pixels using this scheme.</p></div>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143693" title="Figure 3-5Equations for stored Y&amp;#8242;CbCr values of bit-depth n in scheme B"></a><p><strong>Figure 3-5&nbsp;&nbsp;</strong>Equations for stored Y&#8242;CbCr values
of bit-depth <code>n</code> in scheme B</p>
<img src = "../art/qtff_17.gif" alt = "Equations for stored Y&#8242;CbCr values of bit-depth n in scheme B" width="217" height="64"></div><br/>
<p>This maps the normalized values to stored values so that,
for example, 8-bit unsigned values for Y&#8242; go from 16–235 as the
normalized value goes from 0 to1, and 8-bit unsigned valued for
Cb and Cr go from 16–240 as the normalized values go from -0.5 to
+0.5. </p>
<p>For 10-bit samples, Y&#8242; has a range of 64 to 940 as the normalized
value goes from 0 to 1, and Cb and Cr have the range of 65–960 as
the normalized values go from –0.5 to +0.5.</p>
<p>Y&#8242; is an unsigned integer. Cb and Cr are offset binary integers.</p>
<p>Certain Y&#8242;, Cb, and Cr component values v are reserved as
synchronization signals and must not appear in a buffer. For n = 8
bits, these are values 0 and 255. For n = 10 bits, these are values
0, 1, 2, 3, 1020, 1021, 1022, and 1023. The writer of a QuickTime
image is responsible for omitting these values. The reader of a
QuickTime image may assume that they are not present.</p>
<p>The remaining component values that fall outside the mapping
for scheme B (1-15 and 241-254 for n = 8 bits and 4–63 and 961–1019
for n = 10 bits) accommodate occasional filter undershoot and overshoot
in image processing. In some applications, these values are used
to carry other information (e.g., transparency). The writer of a
QuickTime image may use these values and the reader of a QuickTime
image must expect these values.</p>
<p>The following tables show the primary values, transfer functions,
and matrixes indicated by the index entries in the <code><!--a-->'colr'<!--/a--></code> atom.</p>
<p>The R, G, and B values below are tristimulus values (such
as candelas/meter^2), whose relationship to CIE XYZ values can be
derived from the primaries and white point specified in the table,
using the method described in SMPTE RP 177-1993. In this instance, the
R, G, and B values are normalized to the range [0,1].</p><a name="//apple_ref/doc/uid/TP40000939-CH205-142486" title="Table 3-4Table of primaries, index and values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-4&nbsp;&nbsp;</strong>Table of primaries, index and values</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Index</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Values</p></th>
</tr>


<tr>
<td  scope="row"><p>0</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>1</p></td>
<td ><p>Recommendation ITU-R BT.709-2, SMPTE 274M-1995, and SMPTE
296M-1997
white x = 0.3127 y = 0.3290 (CIE III. D65)
red     x=0.640   y = 0.330
green x = 0.300   y = 0.600
blue   x = 0.150   y = 0.060</p></td>
</tr>
<tr>
<td  scope="row"><p>2</p></td>
<td ><p>Primary values are unknown</p></td>
</tr>
<tr>
<td  scope="row"><p>3–4</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>5</p></td>
<td ><p>SMPTE RP 145-1993, SMPTE170M-1994, 293M-1996, 240M-1995,
and SMPTE 274M-1995
white x = 0.3127 y = 0.3290 (CIE III. D65)
red     x = 0.64   y = 0.33
green x = 0.29   y = 0.60
blue   x = 0.15   y = 0.06</p></td>
</tr>
<tr>
<td  scope="row"><p>6</p></td>
<td ><p>ITU-R BT.709-2, SMPTE 274M-1995, and SMPTE 296M-1997
white x = 0.3127 y = 0.3290 (CIE III. D65)
red     x = 0.630   y = 0.340
green x = 0.310   y = 0.595
blue   x = 0.155   y = 0.070</p></td>
</tr>
<tr>
<td  scope="row"><p>7–65535</p></td>
<td ><p>Reserved</p></td>
</tr>

</table></div>
<p>The transfer functions below are used as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143931">Figure 3-2</a></span>.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-143241" title="Table 3-5Table of transfer function index and values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-5&nbsp;&nbsp;</strong>Table of transfer function index and
values</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Index</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Video Standards</p></th>
</tr>


<tr>
<td  scope="row"><p>0</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>1</p></td>
<td ><p>Recommendation ITU-R BT.709-2, SMPTE 274M-1995, 296M-1997,
293M-1996, 170M-1994
See below for transfer function equations.</p></td>
</tr>
<tr>
<td  scope="row"><p>2</p></td>
<td ><p>Coefficient values are unknown</p></td>
</tr>
<tr>
<td  scope="row"><p>3–6</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>7</p></td>
<td ><p>Recommendation SMPTE 240M-1995 and 274M-1995
See below for transfer function equations.</p></td>
</tr>
<tr>
<td  scope="row"><p>8–65535</p></td>
<td ><p>Reserved</p></td>
</tr>

</table></div>
<p>The MPEG-2 sequence display extension <code><!--a  -->transfer_characteristics<!--/a--></code> defines
a code 6 whose transfer function is identical to that in code 1.
QuickTime writers should map 6 to 1 when converting from <code><!--a  -->transfer_characteristics<!--/a--></code> to <code><!--a  -->transferFunction<!--/a--></code>.</p>
<p>Recommendation ITU-R BT.470-4 specified an "assumed gamma
value of the receiver for which the primary signals are pre-corrected"
as 2.2 for NTSC and 2.8 for PAL systems. This information is both
incomplete and obsolete. Modern 525- and 625-line digital and NTSC/PAL
systems use the transfer function with code 1 below.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143300" title="Figure 3-6Equations for index code 1"></a><p><strong>Figure 3-6&nbsp;&nbsp;</strong>Equations for index code 1</p>
<img src = "../art/qtff_18.gif" alt = "Equations for index code 1" width="245" height="37"></div><br/>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143332" title="Figure 3-7Equations for index code 7"></a><p><strong>Figure 3-7&nbsp;&nbsp;</strong>Equations for index code 7</p>
<img src = "../art/qtff_19.gif" alt = "Equations for index code 7" width="259" height="37"></div><br/>
<p>The matrix values are shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143516">Table 3-6</a></span> and in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143608">Figure 3-8</a></span>, <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143635">Figure 3-9</a></span>, and <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-143660">Figure 3-10</a></span>. These figures show a formula for obtaining the normalized
value of Y&#8242; in the range [0,1]. You can derive the formula for normalized
values of Cb and Cr as follows:</p>
<p>If the equation for normalized Y&#8242; has the form:</p>
<p><img src = "../art/qtff_20.gif" alt = "image: ../art/qtff_20.gif" width="194" height="12"></p>
<p>Then the formulas for normalized Cb and Cr are:</p>
<p></p>
<p><img src = "../art/qtff_21.gif" alt = "image: ../art/qtff_21.gif" width="165" height="37"></p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-143516" title="Table 3-6Table of matrix index and values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-6&nbsp;&nbsp;</strong>Table of matrix index and values</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Index</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Video Standard</p></th>
</tr>


<tr>
<td  scope="row"><p>0</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>1</p></td>
<td ><p>Recommendation ITU-R BT.709-2 (1125/60/2:1 only), SMPTE
274M-1995, 296M-1997
See below for matrix values.</p></td>
</tr>
<tr>
<td  scope="row"><p>2</p></td>
<td ><p>Coefficient values are unknown</p></td>
</tr>
<tr>
<td  scope="row"><p>3–5</p></td>
<td ><p>Reserved</p></td>
</tr>
<tr>
<td  scope="row"><p>6</p></td>
<td ><p>Recommendation ITU-R BT.601-4 and BT.470-4 System B and
G, SMPTE 170M-1994, 293M-1996
See below for matrix values</p></td>
</tr>
<tr>
<td  scope="row"><p>7</p></td>
<td ><p>SMPTE 240M-1995, 274M-1995
See below for matrix values</p></td>
</tr>
<tr>
<td  scope="row"><p>8–65535</p></td>
<td ><p>Reserved</p></td>
</tr>

</table></div><p></p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143608" title="Figure 3-8Matrix values for index code 1"></a><p><strong>Figure 3-8&nbsp;&nbsp;</strong>Matrix values for index code 1</p>
<img src = "../art/qtff_22.gif" alt = "Matrix values for index code 1" width="229" height="12"></div><br/>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143635" title="Figure 3-9Matrix values for index code 6"></a><p><strong>Figure 3-9&nbsp;&nbsp;</strong>Matrix values for index code 6</p>
<img src = "../art/qtff_23.gif" alt = "Matrix values for index code 6" width="210" height="12"></div><br/>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-143660" title="Figure 3-10Matrix values for index code 7"></a><p><strong>Figure 3-10&nbsp;&nbsp;</strong>Matrix values for index code 7</p>
<img src = "../art/qtff_24.gif" alt = "Matrix values for index code 7" width="210" height="12"></div><br/>
<a name="//apple_ref/doc/uid/TP40000939-CH205-125850" title="Clean Aperture (&#39;clap&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEJHAG" title="Clean Aperture (&#39;clap&#39;)"></a><h5>Clean Aperture ('clap')</h5>
<p>The clean aperture extension defines the relationship between
the pixels in a stored image and a canonical rectangular region
of a video system from which it was captured or to which it will
be displayed. This can be used to correlate pixel locations in two
or more images—possibly recorded using different systems—for
accurate compositing. This is necessary because different video
digitizer devices can digitize different regions of the incoming
video signal, causing pixel misalignment between images. In particular,
a stored image may contain “edge” data outside the canonical
display area for a given system.</p>
<p>The clean aperture is either coincident with the stored image
or a subset of the stored image; if it is a subset, it may be centered
on the stored image, or it may be offset positively or negatively
from the stored image center.</p>
<p>The clean aperture extension contains a width in pixels, a
height in picture lines, and a horizontal and vertical offset between
the stored image center and a canonical image center for the given
video system. The width is typically the width of the canonical
clean aperture for a video system divided by the pixel aspect ratio
of the stored data. The offsets also take into account any “overscan”
in the stored image. The height and width must be positive values,
but the offsets may be positive, negative, or zero. </p>
<p>These values are given as ratios of two 32-bit numbers, so
that applications can calculate precise values with minimum roundoff
error. For whole values, the value should be stored in the numerator
field while the denominator field is set to 1.</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>A 32-bit unsigned integer containing the size of the <code>'clap'</code> atom.</p></dd>
<dt>Type</dt>
<dd><p>A 32-bit unsigned integer containing the four-character
code <code>'clap'</code>.</p></dd>
<dt>apertureWidth_N (numerator)</dt>
<dd><p>A 32-bit signed integer containing either the width
of the clean aperture in pixels or the numerator portion of a fractional
width.</p></dd>
<dt>apertureWidth_D (denominator)</dt>
<dd><p>A 32-bit signed integer containing either the denominator
portion of a fractional width or the number 1.</p></dd>
<dt>apertureHeight_N (numerator)</dt>
<dd><p>A 32-bit signed integer containing either the height
of the clean aperture in picture lines or the numerator portion
of a fractional height.</p></dd>
<dt>apertureHeight_D (denominator)</dt>
<dd><p>A 32-bit signed integer containing either the denominator
portion of a fractional height or the number 1.</p></dd>
<dt>horizOff_N (numerator)</dt>
<dd><p>A 32-bit signed integer containing either the horizontal
offset of the clean aperture center minus  (width–1)/2 or the
numerator portion of a fractional offset. This value is typically
zero.</p></dd>
<dt>horizOff_D (denominator)</dt>
<dd><p>A 32-bit signed integer containing either the denominator
portion of the horizontal offset or the number 1.</p></dd>
<dt>vertOff_N (numerator)</dt>
<dd><p>A 32-bit signed integer containing either the vertical
offset of the clean aperture center minus  (height–1)/2 or the
numerator portion of a fractional offset. This value is typically
zero.</p></dd>
<dt>vertOff_D (denominator)</dt>
<dd><p>A 32-bit signed integer containing either the denominator
portion of the vertical offset or the number 1.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-119395" title="Video Sample Data"></a><h3>Video
Sample Data</h3>
<p>The format of the data stored in video samples is completely
dependent on the type of the compression used, as indicated in the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_429"></a>video
sample description. The following sections discuss some of the video
encoding schemes supported by QuickTime.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-75189" title="Uncompressed RGB"></a><h4>Uncompressed RGB</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_430"></a>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_431"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_432"></a>Uncompressed
RGB data is stored in a variety of different formats. The format
used depends on the depth field of the video sample description.
For all depths, the image data is padded on each scan line to ensure
that each scan line begins on an even byte boundary. </p>
<ul class="spaceabove"><li class="li"><p>For depths of 1, 2, 4, and 8, the values stored
are indexes into the color table specified in the color table ID
field. </p></li>
<li class="li"><p>For a depth of 16, the pixels are stored as 5-5-5 RGB values
with the high bit of each 16-bit integer set to 0. </p></li>
<li class="li"><p>For a depth of 24, the pixels are stored packed together in
RGB order. </p></li>
<li class="li"><p>For a depth of 32, the pixels are stored with an 8-bit alpha
channel, followed by 8-bit RGB components. </p></li></ul>
<p>RGB data can be stored in composite or planar format. Composite
format stores the RGB data for each pixel contiguously, while planar
format stores the R, G, and B data separately, so the RGB information
for a given pixel is found using the same offset into multiple tables. For
example, the data for two pixels could be represented in composite
format as RGB-RGB or in planar format as RR-GG-BB.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-75231" title="Uncompressed Y&amp;#8242;CbCr (including yuv2)"></a><h4>Uncompressed
Y&#8242;CbCr (including yuv2)</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_433"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_434"></a>
<p>The Y&#8242;CbCr color space is widely used for digital video. In
this data format, luminance is stored as a single value (Y), and
chrominance information is stored as two color-difference components
(Cb and Cr). Cb is the difference between the blue component and
a reference value; Cr is the difference between the red component
and a reference value. </p>
<p>This is commonly referred to as “YUV” format, with “U”
standing-in for Cb and “V” standing-in for Cr. This usage is
not strictly correct, as YUV, YIC, and Y&#8242;CbCr are distinct color
models for PAL, NTSC, and digital video, but most Y&#8242;CbCr data formats
and codecs are described or even named as some variant of “YUV.”</p>
<p>The values of Y, Cb, and Cr can be represented using a variety
of bit depths, trading off accuracy for file size. Similarly, the chrominance
values can be sub-sampled, recording only one pixel’s color value
out of two, for example, or averaging the color value of adjacent
pixels. This sub-sampling is a form of compression, but if no additional
lossy compression is performed on the sampled video, it is still referred
to as “uncompressed” Y&#8242;CbCr video. In addition, a fourth component
can be added to Y&#8242;CbCr video to record an alpha channel.</p>
<p>The number of components (Y&#8242;CbCr with or without alpha) and
any sub-sampling are denoted using ratios of three or four numbers,
such as 4:2:2 to indicate 4 bits of Y to 2 bits each of Cb and Cr
(chroma sub-sampling), or 4:4:4 for equal storage of Y, Cb, and
Cr (no sub-sampling), or 4:4:4:4 for Y&#8242;CbCr plus alpha with no sub-sampling.
The ratios do not typically denote actual bit depths.</p>
<p>Uncompressed Y&#8242;CbCr video data is typically stored as follows:</p>
<ul class="spaceabove"><li class="li"><p>Y&#8242;, Cb, and Cr components of each line are stored
spatially left to right and temporally from earliest to latest.</p></li>
<li class="li"><p>The lines of a field or frame are stored spatially top to
bottom and temporally earliest to latest.</p></li>
<li class="li"><p>Y&#8242; is an unsigned integer. Cb and Cr are twos-complement
signed integers.</p></li></ul>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_435"></a>yuv2
stream, for example, is encoded in a series of 4-byte packets. Each
packet represents two adjacent pixels on the same scan line. The
bytes within each packet are ordered as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>    y0 u y1 v<span></span></pre></td></tr></table></div>
<p><code>y0</code> is the luminance
value for the left pixel; <code>y1</code> the
luminance for the right pixel. <code>u</code> and <code>v </code>are chromatic
values that are shared by both pixels. </p>
<p>Accurate conversion between RGB and Y&#8242;CbCr color spaces requires
a computation for each component of each pixel. An example conversion from
yuv2 into RGB is represented by the following equations:</p>
<p>		r = 1.402 * v + y + .5</p>
<p>		g = y - .7143 * v - .3437 * u + .5</p>
<p>		b = 1.77 * u + y + .5</p>
<p>The r, g, and b values range from 0 to 255.</p>
<p>The coefficients in these equations are derived from matrix
operations and depend on the reference values used for the primary
colors and for white. QuickTime uses canonical values for these
reference coefficients based on published standards. The sample description
extension for Y&#8242;CbCr formats includes a <code>'colr'</code> atom,
which contains indexes into a table of canonical references. This
provides support for multiple video standards without opening the
door to data entry errors for stored coefficient values. Refer to
the published standards for the formulas and methods used to derive
conversion coefficients from the table entries.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-75303" title="JPEG"></a><h4>JPEG</h4>
<p>QuickTime stores <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_436"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_437"></a>JPEG images according
to the rules described in the ISO JPEG specification, document number
DIS 10918-1. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-122142" title="MPEG-4 Video"></a><h4>MPEG-4
Video</h4>
<p>MPEG-4 video uses the <code>'mp4v'</code> data
format. The sample description requires the elementary stream descriptor
(<code>'esds'</code>) extension to the standard
video sample description. If non-square pixels are used, the pixel
aspect ratio (<code>'pasp'</code>) extension is
also required. For details on these extensions, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124550">“Pixel Aspect Ratio ('pasp')”</a></span> and <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-124774">“MPEG-4 Elementary Stream Descriptor Atom ('esds').”</a></span></p>
<p>MPEG-4 video conforms to ISO/IEC documents 14496-1/2000(E)
and 14496-2:1999/Amd.1:2000(E).</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-75319" title="Motion-JPEG"></a><h4>Motion-JPEG</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_438"></a>
<p>Motion-JPEG (M-JPEG) is a variant of the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_439"></a>ISO JPEG specification for
use with digital video streams. Instead of compressing an entire
image into a single bitstream, Motion-JPEG compresses each video
field separately, returning the resulting JPEG bitstreams consecutively
in a single frame.</p>
<p>There are two flavors of Motion-JPEG currently in use. These
two formats differ based on their use of markers. Motion-JPEG format
A supports markers; Motion-JPEG format B does not. The following
paragraphs describe how QuickTime stores Motion-JPEG sample data. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-75739">Figure 3-11</a></span> shows
an example of Motion-JPEG A dual-field sample data. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-75754">Figure 3-12</a></span> shows
an example of Motion- JPEG B dual-field sample data. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-75739" title="Figure 3-11Motion-JPEG A dual-field sample data"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCFDEAA" title="Figure 3-11Motion-JPEG A dual-field sample data"></a><p><strong>Figure 3-11&nbsp;&nbsp;</strong>Motion-JPEG A dual-field sample data</p>
<img src = "../art/qt_l_216.jpg" alt = "Motion-JPEG A dual-field sample data" ></div><br/>
<p>Each field of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_440"></a>Motion-JPEG
format A fully complies with the ISO JPEG specification, and therefore
supports <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_441"></a>application
markers. QuickTime uses the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_442"></a>APP1
marker to store control information, as follows (all of the fields
are 32-bit integers):</p>
<dl class="termdef">	<dt>Reserved </dt>
<dd><p>Unpredictable; should be set to 0.</p></dd>
<dt>Tag </dt>
<dd><p>Identifies the data type; this field must be set to <code>'mjpg'</code>.</p></dd>
<dt>Field size </dt>
<dd><p>The actual size of the image data for this field, in
bytes.</p></dd>
<dt>Padded field size </dt>
<dd><p>Contains the size of the image data, including pad bytes.
Some video hardware may append pad bytes to the image data; this
field, along with the field size field, allows you to compute how
many pad bytes were added.</p></dd>
<dt>Offset to next field </dt>
<dd><p>The offset, in bytes, from the start of the field data
to the start of the next field in the bitstream. This field should
be set to 0 in the last field’s marker data.</p></dd>
<dt>Quantization table offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the quantization table marker. If this field is set to 0,
check the image description for a default quantization table.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_443"></a>Huffman
table offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the Huffman table marker. If this field is set to 0, check
the image description for a default Huffman table.</p></dd>
<dt>Start of frame offset</dt>
<dd><p>The offset from the start of the field data to
the start of image marker. This field should never be set to 0.</p></dd>
<dt>Start of scan offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the start of the scan marker. This field should never be
set to 0.</p></dd>
<dt>Start of data offset</dt>
<dd><p>The offset, in bytes, from the start of the field data
to the start of the data stream. Typically, this immediately follows
the start of scan data.</p></dd></dl>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_46" title="Note"></a><p><strong>Note:</strong>&nbsp;The last two
fields have been added since the original Motion-JPEG specification,
and so they may be missing from some Motion-JPEG A files. You should
check the length of the APP1 marker before using the start of scan
offset and start of data offset fields.</p></div>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_444"></a>Motion-JPEG
format B does not support markers. In place of the marker, therefore, QuickTime
inserts a header at the beginning of the bitstream. Again, all of
the fields are 32-bit integers.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-75754" title="Figure 3-12Motion-JPEG B dual-field sample data"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBEFCG" title="Figure 3-12Motion-JPEG B dual-field sample data"></a><p><strong>Figure 3-12&nbsp;&nbsp;</strong>Motion-JPEG B dual-field sample data</p>
<img src = "../art/qt_l_215.jpg" alt = "Motion-JPEG B dual-field sample data" ></div><br/>
<dl class="termdef">	<dt>Reserved </dt>
<dd><p>Unpredictable; should be set to 0.</p></dd>
<dt>Tag</dt>
<dd><p>The data type; this field must be set to <code>'mjpg'</code>.</p></dd>
<dt>Field size </dt>
<dd><p>The actual size of the image data for this field, in
bytes.</p></dd>
<dt>Padded field size</dt>
<dd><p>The size of the image data, including pad bytes. Some
video hardware may append pad bytes to the image data; this field,
along with the field size field, allows you to compute how many
pad bytes were added.</p></dd>
<dt>Offset to next field </dt>
<dd><p>The offset, in bytes, from the start of the field data
to the start of the next field in the bitstream. This field should
be set to 0 in the second field’s header data.</p></dd>
<dt>Quantization table offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the quantization table. If this field is set to 0, check
the image description for a default quantization table.</p></dd>
<dt>Huffman table offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the Huffman table. If this field is set to 0, check the
image description for a default Huffman table.</p></dd>
<dt>Start of frame offset</dt>
<dd><p>The offset from the start of the field data to
the field’s image data. This field should never be set to 0.</p></dd>
<dt>Start of scan offset</dt>
<dd><p>The offset, in bytes, from the start of the field
data to the start of scan data. </p></dd>
<dt>Start of data offset</dt>
<dd><p>The offset, in bytes, from the start of the field data
to the start of the data stream. Typically, this immediately follows
the start of scan data.</p></dd></dl>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_47" title="Note"></a><p><strong>Note:</strong>&nbsp;The last two
fields were “reserved, must be set to zero” in the original Motion-JPEG
specification.</p></div>
<p>The Motion-JPEG format B header must be a multiple of 16 in
size. When you add pad bytes to the header, set them to 0.</p>
<p>Because Motion-JPEG format B does not support markers, the
JPEG bitstream does not have null bytes (0x00) inserted after data
bytes that are set to 0xFF. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-75770" title="Sound Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGEBEH" title="Sound Media"></a><h2>Sound Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_445"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_446"></a>Sound media
is used to store compressed and uncompressed audio data in QuickTime movies.
It has a media type of '<code>soun</code>'.
This section describes the sound sample description and the storage
format of sound files using various data formats.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57317" title="Sound Sample Descriptions"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGGHJH" title="Sound Sample Descriptions"></a><h3>Sound Sample Descriptions</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_447"></a>sound
sample description contains information that defines how to interpret
sound media data. This sample description is based on the standard
sample description, as described in <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_448"></a><span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field contains the format of the audio data This
may specify a compression format or one of several uncompressed
audio formats. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-131395">Table 3-7</a></span> shows a list of some supported sound formats.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-131395" title="Table 3-7Partial list of supported QuickTime audio formats."></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCDGHEF" title="Table 3-7Partial list of supported QuickTime audio formats."></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-7&nbsp;&nbsp;</strong>Partial list of supported QuickTime
audio formats.</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Format</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>4-Character
code</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>Not specified</p></td>
<td ><p>0x00000000</p></td>
<td ><p>This format descriptor should not be used, but may be
found in some files. Samples are assumed to be stored in either <code>'raw
'</code> or <code>'twos'</code> format, depending
on the sample size field in the sound description.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSoundNotCompressed</code></p></td>
<td ><p><code>'NONE'</code></p></td>
<td ><p>This format descriptor should not be used, but may be
found in some files. Samples are assumed to be stored in either <code>'raw
'</code> or <code>'twos'</code> format, depending
on the sample size field in the sound description.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>k8BitOffsetBinaryFormat</code></p></td>
<td ><p><code>'raw '</code></p></td>
<td ><p>Samples are stored uncompressed, in offset-binary format
(values range from 0 to 255; 128 is silence). These are stored as
8-bit offset binaries. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>k16BitBigEndianFormat</code></p></td>
<td ><p><code>'twos'</code></p></td>
<td ><p>Samples are stored uncompressed, in two’s-complement
format (sample values range from -128 to 127 for 8-bit audio, and -32768
to 32767 for 1- bit audio; 0 is always silence). These samples are
stored in 16-bit big-endian format. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>k16BitLittleEndianFormat</code></p></td>
<td ><p><code>'sowt'</code></p></td>
<td ><p>16-bit little-endian, twos-complement</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMACE3Compression</code></p></td>
<td ><p> '<code>MAC3</code> '</p></td>
<td ><p>Samples have been compressed using MACE 3:1. (Obsolete.)</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMACE6Compression</code></p></td>
<td ><p> '<code>MAC6</code> '</p></td>
<td ><p>Samples have been compressed using MACE 6:1. (Obsolete.)</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kIMACompression</code></p></td>
<td ><p><code>'ima4'</code></p></td>
<td ><p>Samples have been compressed using IMA 4:1.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kFloat32Format</code></p></td>
<td ><p><code>'fl32'</code></p></td>
<td ><p>32-bit floating point</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kFloat64Format</code></p></td>
<td ><p><code>'fl64'</code></p></td>
<td ><p>64-bit floating point</p></td>
</tr>
<tr>
<td  scope="row"><p><code>k24BitFormat</code></p></td>
<td ><p><code>'in24'</code></p></td>
<td ><p>24-bit integer</p></td>
</tr>
<tr>
<td  scope="row"><p><code>k32BitFormat</code></p></td>
<td ><p><code>'in32'</code></p></td>
<td ><p>32-bit integer</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kULawCompression</code></p></td>
<td ><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_449"></a><code>'ulaw'</code></p></td>
<td ><p>uLaw 2:1</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kALawCompression</code></p></td>
<td ><p><code>'alaw'</code></p></td>
<td ><p>uLaw 2:1</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMicrosoftADPCMFormat</code></p></td>
<td ><p><code>0x6D730002</code></p></td>
<td ><p>Microsoft ADPCM-ACM code 2</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kDVIIntelIMAFormat</code></p></td>
<td ><p><code>0x6D730011</code></p></td>
<td ><p>DVI/Intel IMAADPCM-ACM code 17</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kDVAudioFormat</code></p></td>
<td ><p><code>'dvca'</code></p></td>
<td ><p>DV Audio</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kQDesignCompression</code></p></td>
<td ><p><code>'QDMC'</code></p></td>
<td ><p>QDesign music</p></td>
</tr>
<tr>
<td  scope="row"><p><code><!--a  -->kQDesign2Compression<!--/a--></code></p></td>
<td ><p><code>'QDM2'</code></p></td>
<td ><p>QDesign music version 2 </p></td>
</tr>
<tr>
<td  scope="row"><p><code>kQUALCOMMCompression</code></p></td>
<td ><p><code>'Qclp'</code></p></td>
<td ><p>QUALCOMM PureVoice</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMPEGLayer3Format</code></p></td>
<td ><p><code>0x6D730055</code></p></td>
<td ><p>MPEG-1 layer 3, CBR only (pre-QT4.1)</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kFullMPEGLay3Format</code></p></td>
<td ><p><code>'.mp3'</code></p></td>
<td ><p>MPEG-1 layer 3, CBR &amp; VBR (QT4.1 and later)</p></td>
</tr>
<tr>
<td  scope="row"><p><code><!--a  -->kMPEG4AudioFormat<!--/a--></code></p></td>
<td ><p><code>'mp4a'</code></p></td>
<td ><p>MPEG-4 audio</p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-130736" title="Sound Sample Description (Version 0)"></a><h4>Sound
Sample Description (Version 0)</h4>
<p>There are currently two versions of the sound sample description,
version 0 and version 1. Version 0 supports only uncompressed audio
in raw (<code>'raw '</code>) or twos-complement
(<code>'twos'</code>) format, although these are
sometimes incorrectly specified as either <code><!--a-->'NONE'<!--/a--></code> or
0x00000000.</p>
<dl class="termdef">	<dt>Version </dt>
<dd><p>A 16-bit integer that holds the sample description version
(currently 0 or 1).</p></dd>
<dt>Revision level </dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd>
<dt>Vendor </dt>
<dd><p>A 32-bit integer that must be set to 0.</p></dd>
<dt>Number of channels</dt>
<dd><p>A 16-bit integer that indicates the number of
sound channels used by the sound sample. Set to 1 for monaural sounds,
2 for stereo sounds. Higher numbers of channels are not supported.</p></dd>
<dt>Sample size (bits)</dt>
<dd><p>A 16-bit integer that specifies the number of bits in
each uncompressed sound sample. Allowable values are 8 or 16. Formats
using more than 16 bits per sample set this field to 16 and use
sound description version 1.</p></dd>
<dt>Compression ID</dt>
<dd><p>A 16-bit integer that must be set to 0 for version 0
sound descriptions. This may be set to –2 for some version 1 sound
descriptions; see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-133178">“Redefined Sample Tables.”</a></span></p></dd>
<dt>Packet size</dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd>
<dt>Sample rate</dt>
<dd><p>A 32-bit unsigned fixed-point number (16.16) that indicates
the rate at which the sound samples were obtained. The integer portion
of this number should match the media’s time scale. Many older
version 0 files have values of 22254.5454 or 11127.2727, but most
files have integer values, such as 44100. Sample rates greater than
2^16 are not supported.</p></dd></dl>
<p>Version 0 of the sound description format assumes uncompressed
audio in <code>'raw '</code> or <code>'twos'</code> format,
1 or 2 channels, 8 or 16 bits per sample, and a compression ID of
0.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128916" title="Sound Sample Description (Version 1)"></a><h4>Sound
Sample Description (Version 1)</h4>
<p>The version field in the sample description is set to 1 for
this version of the sound description structure. In version 1 of
the sound description, introduced in QuickTime 3, the sound description
record is extended by 4 fields, each 4 bytes long, and includes
the ability to add atoms to the sound description. </p>
<p>These added fields are used to support out-of-band configuration
settings for decompression and to allow some parsing of compressed
QuickTime sound tracks without requiring the services of a decompressor.</p>
<p>These fields introduce the idea of a <strong>packet</strong>.
For uncompressed audio, a packet is a sample from a single channel.
For compressed audio, this field has no real meaning; by convention,
it is treated as 1/number-of-channels.</p>
<p>These fields also introduce the idea of a <strong>frame</strong>.
For uncompressed audio, a frame is one sample from each channel.
For compressed audio, a frame is a compressed group of samples whose
format is dependent on the compressor.</p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_48" title="Important:"></a><p><strong>Important:</strong>&nbsp;
The value of all these fields has different meaning for
compressed and uncompressed audio. The meaning may not be easily
deducible from the field name.</p><p></p></div>
<p>The four new fields are:</p>
<ul class="spaceabove"><li class="li"><p>Samples per packet––the number of uncompressed
frames generated by a compressed frame (an uncompressed frame is
one sample from each channel). This is also the frame duration,
expressed in the media’s timescale, where the timescale is equal
to the sample rate. For uncompressed formats, this field is always
1.</p></li>
<li class="li"><p>Bytes per packet––for uncompressed audio, the number of
bytes in a sample for a single channel. This replaces the older <em>sampleSize</em> field,
which is set to 16.</p><p>This value is calculated by dividing the
frame size by the number of channels. The same calculation is performed
to calculate the value of this field for compressed audio, but the
result of the calculation is not generally meaningful for compressed
audio.</p></li>
<li class="li"><p>Bytes per frame––the number of bytes in a frame: for uncompressed
audio, an uncompressed frame; for compressed audio, a compressed
frame. This can be calculated by multiplying the bytes per packet
field by the number of channels.</p></li>
<li class="li"><p>Bytes per sample––the size of an uncompressed sample in
bytes. This is set to 1 for 8-bit audio, 2 for all other cases,
even if the sample size is greater than 2 bytes.</p></li></ul>
<p>When capturing or compressing audio using the QuickTime API,
the value of these fields can be obtained by calling the Apple Sound
Manager’s <code>GetCompression</code> function. Historically,
the value returned for the bytes per frame field was not always
reliable, however, so this field was set by multiplying bytes per
packet by the number of channels.</p>
<p>To facilitate playback on devices that support only one or two
channels of audio in <code>'raw '</code> or <code>'twos'</code> format
(such as most early Macintosh and Windows computers), all other uncompressed
audio formats are treated as compressed formats, allowing a simple “decompressor”
component to perform the necessary format conversion during playback. The
audio samples are treated as opaque compressed frames for these
data types, and the fields for sample size and bytes per sample
are not meaningful.</p>
<p>The new fields correspond to the <code>CompressionInfo</code> structure
used by the Macintosh Sound Manager (which uses 16-bit values) to
describe the compression ratio of fixed ratio audio compression
algorithms. If these fields are not used, they are set to 0. File
readers only need to check to see if <code>samplesPerPacket</code> is
0. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-133178" title="Redefined Sample Tables"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBJEGJ" title="Redefined Sample Tables"></a><h5>Redefined Sample Tables</h5>
<p>If the compression ID in the sample description is set to
–2, the sound track uses redefined sample tables optimized for
compressed audio.</p>
<p>Unlike video media, the data structures for QuickTime sound
media were originally designed for uncompressed samples. The extended
version 1 sound description structure provides a great deal of support
for compressed audio, but it does not deal directly with the sample
table atoms that point to the media data. </p>
<p>The ordinary sample tables do not point to compressed frames,
which are the fundamental units of compressed audio data. Instead,
they appear to point to individual uncompressed audio samples, each
one byte in size, within the compressed frames. When used with the QuickTime
API, QuickTime compensates for this fiction in a largely transparent
manner, but attempting to parse the sound samples using the original
sample tables alone can be quite complicated.</p>
<p>With the introduction of support for the playback of variable
bit-rate (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_450"></a>VBR)
audio in QuickTime 4.1, the contents of a number of these fields
were redefined, so that a frame of compressed audio is treated as
a single media sample. The sample-to-chunk and chunk offset atoms
point to compressed frames, and the sample size table documents
the size of the frames. The size is constant for CBR audio, but
can vary for VBR.</p>
<p>The time-to-sample table documents the duration of the frames. If
the time scale is set to the sampling rate, which is typical, the
duration equals the number of uncompressed samples in each frame,
which is usually constant even for VBR (it is common to use a fixed frame
duration). If a different media timescale is used, it is necessary
to convert from timescale units to sampling rate units to calculate
the number of samples.</p>
<p>This change in the meaning of the sample tables allows you
to use the tables accurately to find compressed frames.</p>
<p>To indicate that this new meaning is used, a version 1 sound
description is used and the compression ID field is set to –2.
The <code>samplesPerPacket</code> field and
the <code>bytesPerSample</code> field are
not necessarily meaningful for variable bit rate audio, but these
fields should be set correctly in cases where the values are constant; the
other two new fields ( <code>bytesPerPacket</code> and <code>bytesPerFrame</code>)
are reserved and should be set to 0.</p>
<p>If the compression ID field is set to zero, the sample tables
describe uncompressed audio samples and cannot be used directly
to find and manipulate compressed audio frames. QuickTime has built-in
support that allows programmers to act as if these sample tables pointed
to uncompressed 1-byte audio samples. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134013" title="Sound Sample Description Extensions"></a><h4>Sound
Sample Description Extensions</h4>
<p>Version 1 of the sound sample description also defines how
extensions are added to the <code>SoundDescription</code> record.</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct SoundDescriptionV1 {<span></span></pre></td></tr><tr><td scope="row"><pre>    // original fields<span></span></pre></td></tr><tr><td scope="row"><pre>    SoundDescription    desc;<span></span></pre></td></tr><tr><td scope="row"><pre>    // fixed compression ratio information<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long   samplesPerPacket;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long   bytesPerPacket;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long   bytesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long   bytesPerSample;<span></span></pre></td></tr><tr><td scope="row"><pre>    // optional, additional atom-based fields --<span></span></pre></td></tr><tr><td scope="row"><pre>    // ([long size, long type, some data], repeat)<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<p>All extensions to the <code>SoundDescription</code> record
are made using atoms. That means one or more atoms can be appended
to the end of the <code>SoundDescription</code> record
using the standard [size, type] mechanism used throughout the QuickTime
movie architecture.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134106" title="siSlopeAndIntercept Atom"></a><h5>siSlopeAndIntercept
Atom</h5>
<p>One possible extension to the <code>SoundDescription</code> record
is the <code>siSlopeAndIntercept</code> atom, which contains <code>slope</code>, <code>intercept</code>, <code>minClip</code>,
and <code>maxClip</code> parameters.</p>
<p>At runtime, the contents of the type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_451"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_452"></a><code>siSlopeAndIntercept</code> and <code>siDecompressorSettings</code> atoms
are provided to the decompressor component through the standard <code>SetInfo</code> mechanism
of the Sound Manager. </p>
<div class="codesample"><table><tr><td scope="row"><pre>struct SoundSlopeAndInterceptRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>    Float64                 slope;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float64                 intercept;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float64                 minClip;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float64                 maxClip;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct SoundSlopeAndInterceptRecord SoundSlopeAndInterceptRecord;<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134202" title="siDecompressionParam atom (&#39;wave&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGBFIG" title="siDecompressionParam atom (&#39;wave&#39;)"></a><h5>siDecompressionParam atom ('wave')</h5>
<p>A second extension is the <code>siDecompressionParam</code> atom,
which provides the ability to store data specific to a given audio
decompressor in the <code>SoundDescription</code> record.
Some <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_453"></a>audio decompression
algorithms, such as Microsoft’s ADPCM, require a set of out-of-band values
to configure the decompressor. These are stored in an atom of type <code>siDecompressionParam</code>. </p>
<p>This atom contains other atoms with audio decompressor settings and
is a required extension to the sound sample description for MPEG-4
audio. A <code>'wave'</code> chunk
for <code>'mp4a'</code> typically
contains (in order) at least a <code>'frma'</code> atom,
an <code>'mp4a'</code> atom, an <code>'esds'</code> atom,
and a terminator atom. </p>
<p>The contents of other <code>siDecompressionParam</code> atoms are
dependent on the audio decompressor. </p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the decompression parameters
atom.</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit field containing the four-character
code <code>'wave'</code>.</p></dd>
<dt>Extension atoms</dt>
<dd><p>Atoms containing the necessary out-of-band decompression
parameters for the sound decompressor. For MPEG-4 audio (<code>'mp4a'</code>),
this includes elementary stream descriptor (<code>'esds'</code>),
format (<code>'frma'</code>), and terminator (0x00000000)
atoms.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134337" title="Format atom (&#39;frma&#39;)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEDCGI" title="Format atom (&#39;frma&#39;)"></a><h5>Format atom ('frma')</h5>
<p>This atom shows the data format of the stored sound media. </p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the format
atom.</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit field containing the four-character
code <code>'frma'</code>.</p></dd>
<dt>Data format</dt>
<dd><p>The value of this field is copied from the data-format
field of the Sample Description Entry.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134413" title="Terminator atom (0x00000000)"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCIIJJ" title="Terminator atom (0x00000000)"></a><h5>Terminator atom (0x00000000)</h5>
<p>This atom is present to indicate the end of the sound description.
It contains no data, and has a type field of zero (0x00000000) instead
of a four-character code.</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the decompression parameters
atom (always set to 8).</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit integer set to zero (0x00000000).
This is a rare instance in which the type field is <em>not</em> a
four-character ASCII code.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-134463" title="MPEG-4 Elementary Stream Descriptor (&#39;esds&#39;) Atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCHDJJF" title="MPEG-4 Elementary Stream Descriptor (&#39;esds&#39;) Atom"></a><h5>MPEG-4 Elementary Stream Descriptor ('esds')
Atom</h5>
<p>This atom is a required extension to the sound sample description
for MPEG-4 audio. This atom contains an elementary stream descriptor,
which is defined in ISO/IEC FDIS 14496.</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>An unsigned 32-bit integer holding the size of the elementary
stream descriptor atom</p></dd>
<dt>Type</dt>
<dd><p>An unsigned 32-bit field containing the four-character
code <code>'esds'</code></p></dd>
<dt>Version</dt>
<dd><p>An unsigned 32-bit field set to zero.</p></dd>
<dt>Elementary Stream Descriptor</dt>
<dd><p>An elementary stream descriptor for MPEG-4 audio, as
defined in the MPEG-4 specification ISO/IEC 14496.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128085" title="Sound Sample Data"></a><h3>Sound Sample Data</h3><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_454"></a>
<p>The format of data stored in sound samples is completely dependent
on the type of the compressed data stored in the sound sample description.
The following sections discuss some of the formats supported by
QuickTime.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128546" title="Uncompressed 8-Bit Sound"></a><h4>Uncompressed
8-Bit Sound</h4>
<p>Eight-bit audio is stored in offset-binary encodings. If the
data is in stereo, the left and right channels are interleaved.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128560" title="Uncompressed 16-Bit Sound"></a><h4>Uncompressed
16-Bit Sound</h4>
<p>Sixteen-bit audio may be stored in two’s-complement encodings.
If the data is in stereo, the left and right channels are interleaved.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128574" title="IMA, uLaw, and aLaw"></a><h4>IMA,
uLaw, and aLaw</h4>
<ul class="spaceabove"><li class="li"><p>IMA 4:1</p><p>The IMA encoding scheme is based
on a standard developed by the International Multimedia Association
for pulse code modulation (PCM) audio compression. QuickTime uses
a slight variation of the format to allow for random access. IMA
is a 16-bit audio format which supports 4:1 compression. It is defined
as follows: </p><div class="codesample"><table><tr><td scope="row"><pre>kIMACompression = FOUR_CHAR_CODE('ima4'), /*IMA 4:1*/<span></span></pre></td></tr></table></div></li></ul>
<ul class="spaceabove"><li class="li"><p>uLaw 2:1 and aLaw 2:1</p><p>The uLaw (mu-law)
encoding scheme is used on North American and Japanese phone systems,
and is coming into use for voice data interchange, and in PBXs,
voice-mail systems, and Internet talk radio (via MIME). In uLaw
encoding, 14 bits of linear sample data are reduced to 8 bits of
logarithmic data.</p><p>The aLaw encoding scheme is used in
Europe and the rest of the world.</p><p>The kULawCompression
and the kALawCompression formats are typically found in <code>.au</code> formats. </p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128643" title="Floating-Point Formats"></a><h4>Floating-Point
Formats</h4>
<p>Both <code>kFloat32Format</code> and <code>kFloat64Format</code> are
floating-point uncompressed formats. Depending upon codec-specific
data associated with the sample description, the floating-point
values may be in big-endian (network) or little-endian (Intel) byte
order. This differs from the 16-bit formats, where there is a single
format for each endian layout.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128657" title="24- and 32-Bit Integer Formats"></a><h4>24-
and 32-Bit Integer Formats</h4>
<p>Both <code>k24BitFormat</code> and <code>k32BitFormat</code> are
integer uncompressed formats. Depending upon codec-specific data
associated with the sample description, the floating-point values
may be in big-endian (network) or little-endian (Intel) byte order.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128671" title="kMicrosoftADPCMFormat and kDVIIntelIMAFormat Sound Codecs"></a><h4>kMicrosoftADPCMFormat
and kDVIIntelIMAFormat Sound Codecs</h4>
<p>The <code>kMicrosoftADPCMFormat</code> and
the <code>kDVIIntelIMAFormat</code> codec
provide QuickTime interoperability with AVI and WAV files. The four-character
codes used by Microsoft for their formats are numeric. To construct
a QuickTime-supported codec format of this type, the Microsoft numeric
ID is taken to generate a four-character code of the form <code>'msxx'</code> where <em>xx</em> takes
on the numeric ID.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128689" title="kDVAudioFormat Sound Codec"></a><h4>kDVAudioFormat
Sound Codec</h4>
<p>The DV audio sound codec, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_455"></a><code>kDVAudioFormat</code>,
decodes audio found in a DV stream. Since a DV frame contains both
video and audio, this codec knows how to skip video portions of the
frame and only retrieve the audio portions. Likewise, the video
codec skips the audio portions and renders only the image.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128705" title="kQDesignCompression Sound Codec"></a><h4>kQDesignCompression
Sound Codec</h4>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_456"></a><code>kQDesignCompression</code> sound
codec is the QDesign 1 (pre-QuickTime 4) format. Note that there
is also a QDesign 2 format whose four-character code is <code>'QDM2'</code>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128725" title="MPEG-1 Layer 3 (MP3) Codecs"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCFDECJ" title="MPEG-1 Layer 3 (MP3) Codecs"></a><h4>MPEG-1 Layer 3 (MP3) Codecs</h4>
<p>The QuickTime <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_457"></a>MPEG
layer 3 (MP3) codecs come in two particular flavors, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-131395">Table 3-7</a></span>. The
first (<code>kMPEGLayer3Format</code>)
is used exclusively in the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_458"></a>constant bitrate (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_459"></a>CBR) case
(pre-QuickTime 4). The other (<code>kFullMPEGLay3Format</code>)
is used in both the CBR and variable bitrate (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_460"></a>VBR) cases. Note that
they are the same codec underneath. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128759" title="MPEG-4 Audio"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-CJBEBFBD" title="MPEG-4 Audio"></a><h4>MPEG-4 Audio</h4>
<p>MPEG-4 audio is stored as a sound track with data format <code>'mp4a'</code> and
certain additions to the sound sample description and sound track
atom. Specifically:</p>
<ul class="spaceabove"><li class="li"><p>The compression ID is set to -2 and redefined
sample tables are used (see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-133178">“Redefined Sample Tables”</a></span>).</p></li>
<li class="li"><p>The sound sample description includes an <code><!--a  -->siDecompressionParam<!--/a--></code> atom
(see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-134202">“siDecompressionParam atom ('wave')”</a></span>). The <code><!--a  -->siDecompressionParam<!--/a--></code> atom
includes:</p><ul class="nested"><li class="nested li"><p>An MPEG-4 elementary stream descriptor
extension atom (see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-134463">“MPEG-4 Elementary Stream Descriptor ('esds') Atom”</a></span>).</p></li>
<li class="nested li"><p>The inclusion of a format atom is strongly recommended. See <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-134337">“Format atom ('frma').”</a></span></p></li>
<li class="nested li"><p>The last atom in the <code><!--a  -->siDecompressionParam<!--/a--></code> atom
must be a terminator atom. See <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-134413">“Terminator atom (0x00000000).”</a></span> </p></li></ul></li>
<li class="li"><p>Other atoms may be present as well; unknown atoms should be
ignored.</p></li></ul>
<p>The audio data is stored as an elementary MPEG-4 audio stream,
as defined in ISO/IEC specification 14496-1.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-128825" title="Formats Not Currently in Use:MACE 3:1 and 6:1"></a><h4>Formats
Not Currently in Use:MACE 3:1 and 6:1</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_461"></a>
<p>These compression formats are obsolete: MACE 3:1 and 6:1.</p>
<p>These are 8-bit sound codec formats, defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>kMACE3Compression = FOUR_CHAR_CODE('MAC3'), /*MACE 3:1*/<span></span></pre></td></tr><tr><td scope="row"><pre>kMACE6Compression = FOUR_CHAR_CODE('MAC6'), /*MACE 6:1*/<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69831" title="Timecode Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGABGG" title="Timecode Media"></a><h2>Timecode Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_462"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_463"></a>Timecode
media is used to store time code data in QuickTime movies. It has
a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_464"></a><code>'tmcd'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57409" title="Timecode Sample Description"></a><h3>Timecode
Sample Description</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_465"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_466"></a>timecode
sample description contains information that defines how to interpret
time code media data. This sample description is based on the standard
sample description header, as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'tmcd'</code>. </p>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_467"></a>timecode
media handler also adds some of its own fields to the sample description.</p>
<dl class="termdef">	<dt>Reserved</dt>
<dd><p>A 32-bit integer that is reserved for future use. Set
this field to 0. </p></dd>
<dt>Flags</dt>
<dd><p>A 32-bit integer containing flags that identify some
timecode characteristics. The following flags are defined.</p><p>Drop
frame</p><p>Indicates whether the timecode is drop frame.
Set it to 1 if the timecode is drop frame. This flag’s value is
0x0001.</p><p>24 hour max	</p><p>Indicates whether the
timecode wraps after 24 hours. Set it to 1 if the timecode wraps.
This flag’s value is 0x0002.</p><p>Negative times OK</p><p>Indicates
whether negative time values are allowed. Set it to 1 if the timecode
supports negative values. This flag’s value is 0x0004.</p><p>Counter	</p><p>Indicates
whether the time value corresponds to a tape counter value. Set
it to 1 if the timecode values are tape counter values. This flag’s
value is 0x0008.</p></dd>
<dt>Time scale</dt>
<dd><p>A 32-bit integer that specifies the time scale for interpreting
the frame duration field.</p></dd>
<dt>Frame duration</dt>
<dd><p>A 32-bit integer that indicates how long each frame
lasts in real time. </p></dd>
<dt>Number of frames</dt>
<dd><p>An 8-bit integer that contains the number of frames
per second for the timecode format. If the time is a counter, this
is the number of frames for each counter tick.</p></dd>
<dt>Reserved</dt>
<dd><p>A 24-bit quantity that must be set to 0.</p></dd>
<dt>Source reference</dt>
<dd><p>A user data atom containing information about the source
tape. The only currently used user data list entry is the <code>'name'</code> type.
This entry contains a text item specifying the name of the source
tape.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57415" title="Timecode Media Information Atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBEAGJ" title="Timecode Media Information Atom"></a><h3>Timecode Media Information Atom</h3>
<p>The timecode media also requires a media <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_468"></a>information atom.
This atom contains information governing how the timecode text is
displayed. This media information atom is stored in a base media
information atom (see <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25658">“Base Media Information Atoms”</a></span> for
more information). The type of the timecode media information atom
is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_469"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_470"></a><code>'tcmi'</code>. </p>
<p>The timecode media information atom contains the following
fields:</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>A 32-bit integer that specifies the number of bytes
in this time code media information atom.</p></dd>
<dt>Type</dt>
<dd><p>A 32-bit integer that identifies the atom type; this
field must be set to <code>'tcmi'</code>.</p></dd>
<dt>Version</dt>
<dd><p>A 1-byte specification of the version of this timecode
media information atom.</p></dd>
<dt>Flags</dt>
<dd><p>A 3-byte space for timecode media information flags.
Set this field to 0.</p></dd>
<dt>Text font</dt>
<dd><p>A 16-bit integer that indicates the font to use. Set
this field to 0 to use the system font. If the font name field contains
a valid name, ignore this field.</p></dd>
<dt>Text face</dt>
<dd><p>A 16-bit integer that indicates the font’s style.
Set this field to 0 for normal text. You can enable other style
options by using one or more of the following bit masks:</p><p>						0x0001	
		Bold</p><p>				0x0002 			Italic</p><p>				0x0004	
				Underline</p><p>				0x0008	 		Outline</p><p>				0x0010	
		Shadow</p><p>				0x0020	 		Condense</p><p>				0x0040	
		Extend</p></dd>
<dt>Text size</dt>
<dd><p>A 16-bit integer that specifies the point size of the
time code text.</p></dd>
<dt>Text color</dt>
<dd><p>A 48-bit RGB color value for the timecode text.</p></dd>
<dt>Background color</dt>
<dd><p>A 48-bit RGB background color for the timecode text.</p></dd>
<dt>Font name</dt>
<dd><p>A Pascal string specifying the name of the timecode
text’s font.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57421" title="Timecode Sample Data"></a><h4>Timecode
Sample Data</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_471"></a>
<p>There are two different sample data formats used by timecode
media.</p>
<p>If the Counter flag is set to 1 in the timecode sample description,
the sample data is a counter value. Each sample contains a 32-bit
integer counter value. </p>
<p>If the Counter flag is set to 0 in the timecode sample description,
the sample data format is a timecode record, as follows.</p>
<dl class="termdef">	<dt>Hours</dt>
<dd><p>An 8-bit unsigned integer that indicates the starting
number of hours.</p></dd>
<dt>Negative</dt>
<dd><p>A 1-bit value indicating the time’s sign. If bit is
set to 1, the timecode record value is negative.</p></dd>
<dt>Minutes</dt>
<dd><p>A 7-bit integer that contains the starting number of
minutes.</p></dd>
<dt>Seconds</dt>
<dd><p>An 8-bit unsigned integer indicating the starting number
of seconds.</p></dd>
<dt>Frames</dt>
<dd><p>An 8-bit unsigned integer that specifies the starting
number of frames. This field’s value cannot exceed the value of
the number of frames field in the timecode sample description.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69835" title="Text Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCJAJEA" title="Text Media"></a><h2>Text Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_472"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_473"></a>Text
media is used to store text data in QuickTime movies. It has a media
type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_474"></a><code>'text'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57428" title="Text Sample Description"></a><h3>Text
Sample Description</h3>
<p>The text <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_475"></a>sample description contains
information that defines how to interpret text media data. This
sample description is based on the standard sample description header,
as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'text'</code>. </p>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_476"></a>text
media handler also adds some of its own fields to the sample description.</p>
<dl class="termdef">	<dt>Display flags</dt>
<dd><p>A 32-bit integer containing flags that describe how
the text should be drawn. The following flags are defined.</p><p>Don’t
auto scale</p><p>Controls text scaling. If this flag is set
to 1, the text media handler reflows the text instead of scaling
when the track is scaled. This flag’s value is 0x0002.</p><p>Use
movie background color</p><p>Controls background color. If
this flag is set to 1, the text media handler ignores the background
color field in the text sample description and uses the movie’s
background color instead. This flag’s value is 0x0008.</p><p>Scroll
in	</p><p>Controls text scrolling. If this flag is set to
1, the text media handler scrolls the text until the last of the
text is in view. This flag’s value is 0x0020.</p><p>Scroll
out	</p><p>Controls text scrolling. If this flag is set to
1, the text media handler scrolls the text until the last of the
text is gone. This flag’s value is 0x0040.</p><p>Horizontal
scroll</p><p>Controls text scrolling. If this flag is set
to 1, the text media handler scrolls the text horizontally; otherwise,
it scrolls the text vertically. This flag’s value is 0x0080.</p><p>Reverse
scroll	</p><p>Controls text scrolling. If this flag is set
to 1, the text media handler scrolls down (if scrolling vertically)
or backward (if scrolling horizontally; note that horizontal scrolling
also depends upon text justification). This flag’s value is 0x0100.</p><p>Continuous
scroll</p><p>Controls text scrolling. If this flag is set
to 1, the text media handler displays new samples by scrolling out
the old ones. This flag’s value is 0x0200.</p><p>Drop shadow	</p><p>Controls
drop shadow. If this flag is set to 1, the text media handler displays the
text with a drop shadow. This flag’s value is 0x1000.</p><p>Anti-alias	</p><p>Controls
anti-aliasing. If this flag is set to 1, the text media handler
uses anti-aliasing when drawing text. This flag’s value is 0x2000.</p><p>Key
text	</p><p>Controls background color. If this flag is set
to 1, the text media handler does not display the background color,
so that the text overlay background tracks. This flag’s value
is 0x4000.</p></dd>
<dt>Text justification</dt>
<dd><p>A 32-bit integer that indicates how the text should
be aligned. Set this field to 0 for left-justified text, to 1 for
centered text, and to –1 for right-justified text.</p></dd>
<dt>Background color</dt>
<dd><p>A 48-bit RGB color that specifies the text’s background
color.</p></dd>
<dt>Default text box</dt>
<dd><p>A 64-bit rectangle that specifies an area to receive
text (top, left, bottom, right). Typically this field is set to
all zeros.</p></dd>
<dt>Reserved</dt>
<dd><p>A 64-bit value that must be set to 0.</p></dd>
<dt>Font number</dt>
<dd><p>A 16-bit value that must be set to 0.</p></dd>
<dt>Font face</dt>
<dd><p>A 16-bit integer that indicates the font’s style.
Set this field to 0 for normal text. You can enable other style
options by using one or more of the following bit masks:</p><p>0x0001	
Bold</p><p>0x0002 	Italic</p><p>0x0004 	Underline</p><p>0x0008	
Outline</p><p>0x0010	 Shadow</p><p>0x0020	 Condense</p><p>0x0040	
Extend</p></dd>
<dt>Reserved</dt>
<dd><p>An 8-bit value that must be set to 0.</p></dd>
<dt>Reserved</dt>
<dd><p>A 16-bit value that must be set to 0.</p></dd>
<dt>Foreground color</dt>
<dd><p>A 48-bit RGB color that specifies the text’s foreground
color.</p></dd>
<dt>Text name</dt>
<dd><p>A Pascal string specifying the name of the font to use
to display the text.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57434" title="Text Sample Data"></a><h3>Text Sample
Data</h3><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_477"></a>
<p>The format of the text data is a 16-bit length word followed
by the actual text. The length word specifies the number of bytes
of text, not including the length word itself. Following the text,
there may be one or more atoms containing additional information
for drawing and searching the text. </p>
<p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-82360">Table 3-8</a></span> lists the currently defined text sample extensions.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-82360" title="Table 3-8Text sample extensions"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF103" title="Table 3-8Text sample extensions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-8&nbsp;&nbsp;</strong>Text sample extensions</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Text sample extension</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><code>'styl'</code></p></td>
<td ><p>Style information for the text. Allows you to override
the default style in the sample description or to define more than one
style for a sample. The data is a TextEdit style scrap.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'ftab'</code></p></td>
<td ><p>Table of font names. Each table entry contains a font
number (stored in a 16-bit integer) and a font name (stored in a
Pascal string).This atom is required if the <code>'styl'</code> atom
is present. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'hlit'</code></p></td>
<td ><p>Highlight information. The atom data consists of two
32-bit integers. The first contains the starting offset for the highlighted
text, and the second has the ending offset. A highlight sample can
be in a key frame or in a differenced frame. When it’s used in
a differenced frame, the sample should contain a zero-length piece
of text.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'hclr'</code></p></td>
<td ><p>Highlight color. This atom specifies the 48-bit RGB color
to use for highlighting.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'drpo'</code></p></td>
<td ><p>Drop shadow offset. When the display flags indicate drop shadow
style, this atom can be used to override the default drop shadow
placement. The data consists of two 16-bit integers. The first indicates
the horizontal displacement of the drop shadow, in pixels; the second,
the vertical displacement.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'drpt'</code></p></td>
<td ><p>Drop shadow transparency. The data is a 16-bit integer between
0 and 256 indicating the degree of transparency of the drop shadow.
A value of 256 makes the drop shadow completely opaque.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'imag'</code></p></td>
<td ><p>Image font data. This atom contains two more atoms. An <code>'idat'</code> atom
contains compressed image data to be used to draw the text when
the required fonts are not available. An <code>'idsc'</code> atom
contains a video sample description describing the format of the
compressed image data.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'metr'</code></p></td>
<td ><p>Image font highlighting. This atom contains metric information that
governs highlighting when an <code>'imag'</code> atom
is used for drawing. </p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57441" title="Hypertext and Wired Text"></a><h3>Hypertext
and Wired Text</h3>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_478"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_479"></a>Hypertext
is used as an action that takes you to a Web URL; like a Web URL,
it appears blue and underlined. Hypertext is stored in a text track
sample atom stream as type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_480"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_481"></a><code>'htxt'</code>. The
same mechanism is used to store wired actions linked to text strings.
A text string can be wired to act as a hypertext link when clicked
or to perform any defined QuickTime wired action when clicked. For
details on wired actions, see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57782">“Wired Action Grammar.”</a></span></p>
<p>The data stored is a <code>QTAtomContainer</code>.
The root atom of hypertext in this container is a wired-text atom of
type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_482"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_483"></a><code>'wtxt'</code>.
This is the parent for all individual hypertext objects. </p>
<p>For each hypertext item, the parent atom is of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_484"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_485"></a><code>'htxt'</code>.
This is the atom container atom type. Two children of this atom
that define the offset of the hypertext in the text stream are</p>
<div class="codesample"><table><tr><td scope="row"><pre>kRangeStart         strt // unsigned long<span></span></pre></td></tr><tr><td scope="row"><pre>kRangeEnd           end  // unsigned long<span></span></pre></td></tr></table></div>
<p>Child atoms of the parent atom are the events of type <code>kQTEventType</code> and
the ID of the event type. The children of these event atoms follow
the same format as other wired events.</p>
<div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>kQTEventType, (kQTEventMouseClick, kQTEventMouseClickEnd,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTEventMouseClickEndTriggerButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTEventMouseEnter, kQTEventMouseExit)<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>kTextWiredObjectsAtomType, 1<span></span></pre></td></tr><tr><td scope="row"><pre>    kHyperTextItemAtomType, 1..n<span></span></pre></td></tr><tr><td scope="row"><pre>         kRangeStart, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            long<span></span></pre></td></tr><tr><td scope="row"><pre>        kRangeEnd, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            long<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kAction     // The known range of track movie sprite actions<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69839" title="Music Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCJIGHH" title="Music Media"></a><h2>Music Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_486"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_487"></a>Music
media is used to store note-based audio data, such as MIDI data,
in QuickTime movies. It has a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_488"></a><code>'musi'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57445" title="Music Sample Description"></a><h3>Music
Sample Description</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_489"></a>music
sample description uses the standard sample description header,
as described in the section <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'musi'</code>. The music
media handler adds an additional 32-bit integer field to the sample
description containing flags. Currently no flags are defined, and
this field should be set to 0.</p>
<p>Following the flags field, there may be appended data in the
QuickTime music format. This data consists of part-to-instrument
mappings in the form of General events containing note requests.
One note request event should be present for each part that will
be used in the sample data.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57451" title="Music Sample Data"></a><h3>Music
Sample Data</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_490"></a>sample
data for music samples consists entirely of data in the QuickTime
music format. Typically, up to 30 seconds of notes are grouped into
a single sample.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-124205" title="MPEG-1 Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGIJJI" title="MPEG-1 Media"></a><h2>MPEG-1 Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_491"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_492"></a>MPEG-1 media
is used to store MPEG-1 video streams, MPEG-1, layer 2 audio streams, and
multiplexed MPEG-1 audio and video streams in QuickTime movies.
It has a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_493"></a><code>'MPEG'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-124239" title="MPEG-1 Sample Description"></a><h3>MPEG-1
Sample Description</h3>
<p>The MPEG-1 sample description uses the standard sample description
header, as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'MPEG'</code>. The MPEG-1 media handler
adds no additional fields to the sample description.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_49" title="Note"></a><p><strong>Note:</strong>&nbsp;This data format
is not used for MPEG-1, layer 3 audio, however (see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-128725">“MPEG-1 Layer 3 (MP3) Codecs”</a></span>).</p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57463" title="MPEG-1 Sample Data"></a><h3>MPEG-1
Sample Data</h3>
<p>Each sample in an MPEG-1 media is an entire MPEG-1 stream.
This means that a single MPEG-1 sample may be several hundred megabytes
in size. The MPEG-1 encoding used by QuickTime corresponds to the
ISO standard, as described in ISO document CD 11172.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69847" title="Sprite Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCIFHAH" title="Sprite Media"></a><h2>Sprite Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_494"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_495"></a>Sprite
media is used to store character-based animation data in QuickTime
movies. It has a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_496"></a><code>'sprt'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57469" title="Sprite Sample Description"></a><h3>Sprite
Sample Description</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_497"></a>sprite
sample description uses the standard sample description header,
as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25691">“Sample Description Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_498"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_499"></a><code>'sprt'</code>.
The sprite media handler adds no additional fields to the sample
description.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57475" title="Sprite Sample Data"></a><h3>Sprite
Sample Data</h3>
<p>All sprite samples are stored in QT atom structures. The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_500"></a>sprite media
uses both key frames and differenced frames. The key frames contain
all of the sprite’s image data, and the initial settings for each
of the sprite’s properties. </p>
<p>A key frame always contains a shared data atom of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_501"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_502"></a><code>'dflt'</code>.
This atom contains data to be shared between the sprites, consisting
mainly of image data and sample descriptions. The shared data atom
contains a single sprite image container atom, with an atom type value
of <code>'imct'</code> and an ID value
of 1. </p>
<p>The sprite image container atom stores one or more sprite
image atoms of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_503"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_504"></a><code>'imag'</code>. Each
sprite image atom contains an image sample description immediately
followed by the sprite’s compressed image data. The sprite image
atoms should have ID numbers starting at 1 and counting consecutively
upward.</p>
<p>The key frame also must contain definitions for each sprite
in atoms of type <code>'sprt'</code>.
Sprite atoms should have ID numbers start at 1 and count consecutively
upward. Each sprite atom contains a list of properties. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-82911">Table 3-9</a></span> shows
all currently defined sprite properties.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-82911" title="Table 3-9Sprite properties"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF104" title="Table 3-9Sprite properties"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-9&nbsp;&nbsp;</strong>Sprite properties</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property name</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kSpritePropertyMatrix</code></p></td>
<td ><p>1</p></td>
<td ><p>Describes the sprite’s location and scaling within
its sprite world or sprite track. By modifying a sprite’s matrix,
you can modify the sprite’s location so that it appears to move
in a smooth path on the screen or so that it jumps from one place
to another. You can modify a sprite’s size, so that it shrinks,
grows, or stretches. Depending on which image compressor is used
to create the sprite images, other transformations, such as rotation,
may be supported as well. Translation-only matrices provide the best
performance.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpritePropertyVisible</code></p></td>
<td ><p>4</p></td>
<td ><p>Specifies whether or not the sprite is visible. To make
a sprite visible, you set the sprite’s visible property to <code>true</code>.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpritePropertyLayer</code></p></td>
<td ><p>5</p></td>
<td ><p>Contains a 16-bit integer value specifying the layer
into which the sprite is to be drawn. Sprites with lower layer numbers
appear in front of sprites with higher layer numbers. To designate
a sprite as a background sprite, you should assign it the special layer
number <code>kBackgroundSpriteLayerNum</code>.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpritePropertyGraphicsMode</code></p></td>
<td ><p>6</p></td>
<td ><p>Specifies a graphics mode and blend color that indicates
how to blend a sprite with any sprites behind it and with the background.
To set a sprite’s graphics mode, you call <code>SetSpriteProperty</code>,
passing a pointer to a <code>ModifierTrackGraphicsModeRecord</code> structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpritePropertyActionHandlingSpriteID</code></p></td>
<td ><p>8</p></td>
<td ><p>Specifies another sprite by ID that delegates QT events. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpritePropertyImageIndex</code></p></td>
<td ><p>100</p></td>
<td ><p>Contains the atom ID of the sprite’s image atom.</p></td>
</tr>

</table></div>
<p>The override sample differs from the key frame sample in two
ways. First, the override sample does not contain a shared data
atom. All shared data must appear in the key frame. Second, only
those sprite properties that change need to be specified. If none
of a sprite’s properties change in a given frame, then the sprite
does not need an atom in the differenced frame. </p>
<p>The override sample can be used in one of two ways: combined,
as with video key frames, to construct the current frame; or the
current frame can be derived by combining only the key frame and
the current override sample.</p>
<p>Refer to the section <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57492">“Sprite Track Media Format”</a></span> for
information on how override samples are indicated in the file, using <code>kSpriteTrackPropertySampleFormat</code> and
the default behavior of the <code>kKeyFrameAndSingleOverride</code> format. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57481" title="Sprite Track Properties"></a><h2>Sprite
Track Properties</h2>
<p>In addition to defining properties for individual sprites,
you can also define properties that apply to an entire <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_505"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_506"></a>sprite
track. These properties may override default behavior or provide hints
to the sprite media handler. The following sprite track properties
are supported:</p>
<ul class="ul"><li class="li"><p>The <code>kSpriteTrackPropertyBackgroundColor</code> property
specifies a background color for the sprite track. The background
color is used for any area that is not covered by regular sprites
or background sprites. If you do not specify a background color,
the sprite track uses black as the default background color.</p></li>
<li class="li"><p>The <code>kSpriteTrackPropertyOffscreenBitDepth</code> property
specifies a preferred bit depth for the sprite track’s offscreen
buffer. The allowable values are 8 and 16. To save memory, you should
set the value of this property to the minimum depth needed. If you
do not specify a bit depth, the sprite track allocates an offscreen
buffer with the depth of the deepest intersecting monitor. </p></li>
<li class="li"><p>The <code>kSpriteTrackPropertySampleFormat</code> property
specifies the sample format for the sprite track. If you do not
specify a sample format, the sprite track uses the default format, <code>kKeyFrameAndSingleOverride</code>. </p></li></ul>
<p>To specify sprite track properties, you create a single QT
atom container and add a leaf atom for each property you want to
specify. To add the properties to a sprite track, you call the media
handler function <code>SetMediaPropertyAtom</code>.
To retrieve a sprite track’s properties, you call the media handler
function <code>GetMediaPropertyAtom</code>.</p>
<p>The sprite track properties and their corresponding data types
are listed in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-82993">Table 3-10</a></span>.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-82993" title="Table 3-10Sprite track properties"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF105" title="Table 3-10Sprite track properties"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-10&nbsp;&nbsp;</strong>Sprite track properties</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Atom type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Atom ID</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Leaf data type</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyBackgroundColor</code></p></td>
<td ><p>1</p></td>
<td ><p><code>RGBColor</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyOffscreenBitDepth</code></p></td>
<td ><p>1</p></td>
<td ><p><code>unsigned short</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertySampleFormat</code></p></td>
<td ><p>1</p></td>
<td ><p><code>long</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyHasActions</code></p></td>
<td ><p>1</p></td>
<td ><p><code>Boolean</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyQTIdleEventsFrequency</code></p></td>
<td ><p>1</p></td>
<td ><p><code>UInt32</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyVisible</code></p></td>
<td ><p>1</p></td>
<td ><p><code>Boolean</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kSpriteTrackPropertyScaleSpritesToScaleWorld</code></p></td>
<td ><p>1</p></td>
<td ><p><code>Boolean</code></p></td>
</tr>

</table></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_50" title="Note"></a><p><strong>Note:</strong>&nbsp;When pasting
portions of two different tracks together, the Movie Toolbox checks
to see that all sprite track properties match. If, in fact, they
do match, the paste results in a single sprite track instead of
two.</p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57492" title="Sprite Track Media Format"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCHIEJD" title="Sprite Track Media Format"></a><h2>Sprite Track Media Format</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_507"></a>sprite
track media format is hierarchical and based on QT atoms and atom
containers. A sprite track is defined by one or more key frame samples,
each followed by any number of override samples. A key frame sample
and its subsequent override samples define a scene in the sprite
track. A key frame sample is a QT atom container that contains atoms defining
the sprites in the scene and their initial properties. The override
samples are other QT atom containers that contain atoms that modify
sprite properties, thereby animating the sprites in the scene. In
addition to defining properties for individual sprites, you can also
define properties that apply to an entire sprite track.</p>
<p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69341">Figure 3-13</a></span> shows the high-level structure of a sprite track
key frame sample. Each atom in the atom container is represented
by its atom type, atom ID, and, if it is a leaf atom, the type of
its data. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69341" title="Figure 3-13A key frame sample atom container"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCHIDF" title="Figure 3-13A key frame sample atom container"></a><p><strong>Figure 3-13&nbsp;&nbsp;</strong>A key frame sample atom container</p>
<img src = "../art/qtml_03.gif" alt = "A key frame sample atom container" width="518" height="188"></div><br/>
<p>The QT atom container contains one child atom for each sprite
in the key frame sample. Each sprite atom has a type of <code>kSpriteAtomType</code>.
The sprite IDs are numbered from 1 to the number of sprites defined
by the key frame sample (<code>numSprites</code>). </p>
<p>Each sprite atom contains leaf atoms that define the properties
of the sprite, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69345">Figure 3-14</a></span>. For example, the <code>kSpritePropertyLayer</code> property
defines a sprite’s layer. Each sprite property atom has an atom
type that corresponds to the property and an ID of 1.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69345" title="Figure 3-14Atoms that describe a sprite and its properties"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCHHHIE" title="Figure 3-14Atoms that describe a sprite and its properties"></a><p><strong>Figure 3-14&nbsp;&nbsp;</strong>Atoms that describe a sprite and
its properties</p><img src = "../art/qtml_11.gif" alt = "Atoms that describe a sprite and its properties" width="520" height="180"></div><br/>
<p>In addition to the sprite atoms, the QT atom container contains
one atom of type <code>kSpriteSharedDataAtomType</code> with
an ID of 1. The atoms contained by the shared data atom describe
data that is shared by all sprites. The shared data atom contains
one atom of type <code>kSpriteImagesContainerAtomType</code> with an ID of 1
(<span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69349">Figure 3-15</a></span>). </p>
<p>The image container atom contains one atom of type <code>kImageAtomType</code> for
each image in the key frame sample. The image atom IDs are numbered
from 1 to the number of images (<code>numImages</code>).
Each image atom contains a leaf atom that holds the image data (type <code>kSpriteImageDataAtomType</code>)
and an optional leaf atom (type <code>kSpriteNameAtomType</code>)
that holds the name of the image.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69349" title="Figure 3-15Atoms that describe sprite images"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCHDFFH" title="Figure 3-15Atoms that describe sprite images"></a><p><strong>Figure 3-15&nbsp;&nbsp;</strong>Atoms that describe sprite images</p>
<img src = "../art/qtml_17.gif" alt = "Atoms that describe sprite images" width="495" height="271"></div><br/>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57497" title="Sprite Media Format Atoms"></a><h3>Sprite
Media Format Atoms</h3>
<p>The sprite track’s sample format enables you to store the
atoms necessary to describe action lists that are executed in response
to QuickTime events. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57765">“QT Atom Container Description Key”</a></span> defines a grammar for
constructing valid action sprite samples, which may include complex
expressions. </p>
<p>Both key frame samples and override samples support the sprite
action atoms. Override samples override actions at the QuickTime
event level. In effect, what you do by overriding is to completely
replace one event handler and all its actions with another. The sprite
track’s <code>kSpriteTrackPropertySampleFormat</code> property
has no effect on how actions are performed. The behavior is similar
to the default <code>kKeyFrameAndSingleOverride</code> format where,
if in a given override sample there is no handler for the event,
the key frame’s handler is used, if there is one.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57502" title="Sprite Media Format Extensions"></a><h3>Sprite
Media Format Extensions</h3>
<p>This section describes some of the atom types and IDs used
to extend the sprite track’s media format, thus enabling action
sprite capabilities. </p>
<p>A complete description of the grammar for sprite media handler
samples, including action sprite extensions, is included in the
section <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57770">“Sprite Media Handler Track Properties QT Atom Container Format.”</a></span></p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_51" title="Important:"></a><p><strong>Important:</strong>&nbsp;
Some sprite track property atoms were added in QuickTime
4. In particular, you must set the <code>kSpriteTrackPropertyHasActions</code> track
property in order for your sprite actions to be executed.</p><p></p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57516" title="Sprite Track Property Atoms "></a><h3>Sprite
Track Property Atoms </h3>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_508"></a>The following constants represent atom types for sprite
track properties. These atoms are applied to the whole track, not just to
a single sample. </p>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_52" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_509"></a><code><!--a  -->kSpriteTrackPropertyHasActions<!--/a--></code></dt>
<dd><p>You must add an atom of this type with its leaf
data set to <code>true</code> if you
want the movie controller to execute the actions in your sprite
track’s media. The atom’s leaf data is of type <code>Boolean</code>.
The default value is <code>false</code>,
so it is very important to add an atom of this type if you want
interactivity to take place.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_510"></a><code><!--a  -->kSpriteTrackPropertyQTIdleEventsFrequency<!--/a--></code></dt>
<dd><p>You must add an atom of this type if you want
the sprites in your sprite track to receive <code>kQTEventIdle</code> QuickTime
events. The atom’s leaf data is of type <code>UInt32</code>.
The value is the mimimum number of ticks that must pass before the
next <code>QTIdle</code> event is
sent. Each tick is 1/60th of one second. To specify “Idle as fast
as possible,” set the value to 0. The default value is <code>kNoQTIdleEvents</code>,
which means don’t send any idle events. </p><p>It is possible
that for small idle event frequencies, the movie will not be able to
keep up, in which case idle events will be sent as fast as possible.</p><p>Since
sending idle events takes up some time, it is best to specify the
largest frequency that produces the results that you desire, or <code>kNoQTIdleEvents</code> if you
do not need them.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_511"></a><code><!--a  -->kSpriteTrackPropertyVisible<!--/a--></code></dt>
<dd><p>You can cause the entire sprite track to be invisible
by setting the value of this <code>Boolean</code> property
to <code>false</code>. This is useful
for using a sprite track as a hidden button track—for example,
placing an invisible sprite track over a video track would allow
the characters in the video to be clickable. The default value is
visible (<code>true</code>).</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_512"></a><code><!--a  -->kSpriteTrackPropertyScaleSpritesToScaleWorld<!--/a--></code></dt>
<dd><p>You can cause each sprite to be rescaled when
the sprite track is resized by setting the value of this <code>Boolean</code> property
to <code>true</code>. Setting this
property can improve the drawing performance and quality of a scaled
sprite track. This is particularly useful for sprite images compressed
with codecs that are resolution-independent, such as the Curve codec.
The default value for this property is <code>false</code>.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57548" title="Atom Types"></a><h2>Atom
Types</h2>
<p>The following constants represent atom types for sprite media:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteAtomType                     = 'sprt',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImagesContainerAtomType      = 'imct',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageAtomType                = 'imag',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageDataAtomType            = 'imda',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageDataRefAtomType         = 'imre',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageDataRefTypeAtomType     = 'imrt',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageGroupIDAtomType         = 'imgr',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageRegistrationAtomType    = 'imrg',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageDefaultImageIndexAtomType ='defi',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteSharedDataAtomType           = 'dflt',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteNameAtomType                 = 'name',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageNameAtomType            = 'name',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteUsesImageIDsAtomType         = 'uses',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteBehaviorsAtomType            = 'beha',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteImageBehaviorAtomType        = 'imag',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteCursorBehaviorAtomType       = 'crsr',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteStatusStringsBehaviorAtomType = 'sstr',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteVariablesContainerAtomType    = 'vars',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteStringVariableAtomType        = 'strv',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteFloatingPointVariableAtomType = 'flov'<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteSharedDataAtomType           = 'dflt',<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteURLLinkAtomType              = 'url '<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyMatrix               = 1<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyVisible              = 4<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyLayer                = 5<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyGraphicsMode         = 6<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyImageIndex           = 100<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyBackgroundColor      = 101<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertyOffscreenBitDepth    = 102<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpritePropertySampleFormat         = 103<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_53" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kSpriteAtomType<!--/a--></code></dt>
<dd><p>The atom is a parent atom that describes a sprite. It
contains atoms that describe properties of the sprite. Optionally,
it may also include an atom of type <code>kSpriteNameAtomType</code> that
defines the name of the sprite.</p></dd>
<dt><code><!--a  -->kSpriteImagesContainerAtomType<!--/a--></code></dt>
<dd><p>The atom is a parent atom that contains atoms
of type <code>kSpriteImageAtomType</code>.</p></dd>
<dt><code><!--a  -->kSpriteImageAtomType<!--/a--></code></dt>
<dd><p>The atom is a parent atom that contains an atom
of type <code>kSpriteImageDataAtomType</code>.
Optionally, it may also include an atom of type <code>kSpriteNameAtomType</code> that
defines the name of the image.</p></dd>
<dt><code><!--a  -->kSpriteImageDataAtomType<!--/a--></code></dt>
<dd><p>The atom is a leaf atom that contains image data.</p></dd>
<dt><code><!--a  -->kSpriteSharedDataAtomType<!--/a--></code></dt>
<dd><p>The atom is a parent atom that contains shared
sprite data, such as an atom container of type <code>kSpriteImagesContainerAtomType</code>.</p></dd>
<dt><code><!--a  -->kSpriteNameAtomType<!--/a--></code></dt>
<dd><p>The atom is a leaf atom that contains the name
of a sprite or an image. The leaf data is composed of one or more
ASCII characters.</p></dd>
<dt><code><!--a  -->kSpritePropertyImageIndex<!--/a--></code></dt>
<dd><p>A leaf atom containing the image index property
which is of type <code>short</code>. This
atom is a child atom of <code>kSpriteAtom</code>.</p></dd>
<dt><code><!--a  -->kSpritePropertyLayer<!--/a--></code></dt>
<dd><p>A leaf atom containing the layer property which
is of type <code>short</code>. This
atom is a child atom of <code>kSpriteAtom</code>.</p></dd>
<dt><code><!--a  -->kSpritePropertyMatrix<!--/a--></code></dt>
<dd><p>A leaf atom containing the matrix property which
is of type <code>MatrixRecord</code>. This
atom is a child atom of <code>kSpriteAtom</code>.</p></dd>
<dt><code><!--a  -->kSpritePropertyVisible<!--/a--></code></dt>
<dd><p>A leaf atom containing the visible property which
is of type <code>short</code>. This atom
is a child atom of <code>kSpriteAtom</code>.</p></dd>
<dt><code><!--a  -->kSpritePropertyGraphicsMode<!--/a--></code></dt>
<dd><p>A leaf atom containing the graphics mode property
which is of type <code>ModifyerTrackGraphicsModeRecord</code>.
This atom is a child atom of <code>kSpriteAtom</code>.</p></dd>
<dt><code><!--a  -->kSpritePropertyBackgroundColor<!--/a--></code></dt>
<dd><p>A leaf atom containing the background color property
which is of type <code>RGBColor</code>.
This atom is used in a sprite track’s <code>MediaPropertyAtom</code> atom container.</p></dd>
<dt><code><!--a  -->kSpritePropertyOffscreenBitDepth<!--/a--></code></dt>
<dd><p>A leaf atom containing the preferred offscreen
bitdepth which is of type <code>short</code>.
This atom is used in a sprite track’s <code>MediaPropertyAtom</code> atom container.</p></dd>
<dt><code><!--a  -->kSpritePropertySampleFormat<!--/a--></code></dt>
<dd><p>A leaf atom containing the sample format property,
which is of type <code>short</code>. This
atom is used in a sprite track’s <code>MediaPropertyAtom</code> atom
container.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_513"></a><code><!--a  -->kSpriteImageRegistrationAtomType<!--/a--></code></dt>
<dd><p>Sprite images have a default registration point
of 0, 0. To specify a different point, add an atom of type <code>kSpriteImageRegistrationAtomType</code> as
a child atom of the <code>kSpriteImageAtomType</code> and
set its leaf data to a <code>FixedPoint</code> value with
the desired registration point.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_514"></a><code><!--a  -->kSpriteImageGroupIDAtomType<!--/a--></code></dt>
<dd><p>You must assign group IDs to sets of equivalent
images in your key frame sample. For example, if the sample contains
ten images where the first two images are equivalent, and the last
eight images are equivalent, then you could assign a group ID of
1000 to the first two images, and a group ID of 1001 to the last
eight images. This divides the images in the sample into two sets.
The actual ID does not matter, it just needs to be a unique positive integer.</p><p>Each
image in a sprite media key frame sample is assigned to a group.
Add an atom of type <code>kSpriteImageGroupIDAtomType</code> as
a child of the <code>kSpriteImageAtomType</code> atom
and set its leaf data to a long containing the group ID. </p><div class="importantboxdef"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_54" title="Important:"></a><p><strong>Important:</strong>&nbsp;
You must assign group IDs to your sprite sample if
you want a sprite to display images with non-equivalent image descriptions
(i.e., images with different dimensions).</p><p></p></div></dd></dl>
<p>For each of the following atom types (added to QuickTime 4)––except <code>kSpriteBehaviorsAtomType</code>––you
fill in the structure <code>QTSpriteButtonBehaviorStruct</code>,
which contains a value for each of the four states. </p>
<dl class="termdef">	<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_515"></a><code><!--a  -->kSpriteBehaviorsAtomType<!--/a--></code></dt>
<dd><p>This is the parent atom of <code>kSpriteImageBehaviorAtomType</code>, <code>kSpriteCursorBehaviorAtomType</code>,
and <code>kSpriteStatusStringsBehaviorAtomType</code>. </p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_516"></a><code><!--a  -->kSpriteImageBehaviorAtomType<!--/a--></code></dt>
<dd><p>Specifies the <code>imageIndex</code>. </p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_517"></a><code><!--a  -->kSpriteCursorBehaviorAtomType<!--/a--></code></dt>
<dd><p>Specifies the <code>cursorID</code>. </p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_518"></a><code><!--a  -->kSpriteStatusStringsBehaviorAtomType<!--/a--></code></dt>
<dd><p>Specifies an ID of a string variable contained
in a sprite track to display in the status area of the browser. </p><div class="noteboxdef"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_55" title="Note"></a><p><strong>Note:</strong>&nbsp;All sprite media—specifically
the leaf data in the QT atom containers for sample and sprite track
properties—should be written in big-endian format.</p></p></div></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_519"></a><code><!--a  -->kSpriteUsesImageIDsAtomType<!--/a--></code></dt>
<dd><p>This atom allows a sprite to specify which images
it uses—in other words, the subset of images that its <code>imageIndex</code> property
can refer to. </p><p>You add an atom of type <code>kSpriteUsesImageIDsAtomType</code> as
a child of a <code>kSpriteAtomType</code> atom,
setting its leaf data to an array of QT atom IDs. This array contains
the IDs of the images used, not the indices.</p></dd></dl>
<p>Although QuickTime does not currently use this atom internally,
tools that edit sprite media can use the information provided to
optimize certain operations, such as cut, copy, and paste. </p>
<dl class="termdef">	<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_520"></a><code><!--a  -->kSpriteImageRegistrationAtomType<!--/a--></code></dt>
<dd><p>Sprite images have a default registration point
of 0, 0. To specify a different point, you add an atom of type <code>kSpriteImageRegistrationAtomType</code> as
a child atom of the <code>kSpriteImageAtomType</code> and
set its leaf data to a <code>FixedPoint</code> value
with the desired registration point.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_521"></a><code><!--a  -->kSpriteImageGroupIDAtomType<!--/a--></code></dt>
<dd><p>You must assign group IDs to sets of equivalent
images in your key frame sample. For example, if the sample contains
ten images where the first two images are equivalent, and the last
eight images are equivalent, then you could assign a group ID of
1000 to the first two images, and a group ID of 1001 to the last
eight images. This divides the images in the sample into two sets.
The actual ID does not matter; it just needs to be a unique positive integer.</p><p>Each
image in a sprite media key frame sample is assigned to a group.
You add an atom of type <code>kSpriteImageGroupIDAtomType</code> as
a child of the <code>kSpriteImageAtomType</code> atom
and set its leaf data to a long containing the group ID. </p><div class="importantboxdef"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_56" title="Important:"></a><p><strong>Important:</strong>&nbsp;
You must assign group IDs to your sprite sample if
you want a sprite to display images with non-equivalent image descriptions
(that is, images with different dimensions).</p><p></p></div></dd></dl>
<p>You use the following atom types, which were added to QuickTime
4, to specify that an image is referenced and how to access it.</p>
<dl class="termdef">	<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_522"></a><code>kSpriteImageDataRefAtomType </code></dt>
<dd><p>Add this atom as a child of the <code>kSpriteImageAtomType</code> atom
instead of a <code>kSpriteImageDataAtomType</code>.
Its ID should be 1. Its data should contain the data reference (similar
to the <code>dataRef</code> parameter
of <code>GetDataHandler</code>).</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_523"></a><code>kSpriteImageDataRefTypeAtomType </code></dt>
<dd><p>Add this atom as a child of the <code>kSpriteImageAtomType</code> atom.
Its ID should be 1. Its data should contain the data reference type
(similar to the <code>dataRefType</code> parameter
of <code>GetDataHandler</code>).</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_524"></a><code>kSpriteImageDefaultImageIndexAtomType </code></dt>
<dd><p>You may optionally add this atom as a child of
the <code>kSpriteImageAtomType</code> atom.
Its ID should be 1. Its data should contain a <code>short</code>,
which specifies an image index of a traditional image to use while
waiting for the referenced image to load. </p></dd></dl>
<p></p>
<p>The following constants represent formats of a sprite track.
The value of the constant indicates how override samples in a sprite
track should be interpreted. You set a sprite track’s format by
creating a <code>kSpriteTrackPropertySampleFormat</code> atom.</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kKeyFrameAndSingleOverride      = 1L &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kKeyFrameAndAllOverrides        = 1L &lt;&lt; 2<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_57" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kKeyFrameAndSingleOverride<!--/a--></code></dt>
<dd><p>The current state of the sprite track is defined
by the most recent key frame sample and the current override sample.
This is the default format.</p></dd>
<dt><code><!--a  -->kKeyFrameAndAllOverrides<!--/a--></code></dt>
<dd><p>The current state of the sprite track is defined
by the most recent key frame sample and all subsequent override
samples up to and including the current override sample.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57753" title="Sprite Button Behaviors"></a><h2>Sprite
Button Behaviors</h2>
<p>In QuickTime 4 and later, sprites in a sprite track can specify
simple button behaviors. These behaviors can control the sprite’s
image, the system cursor, and the status message displayed in a
Web browser. They also provide a shortcut for a common set of actions
that may result in more efficient QuickTime movies.</p>
<p>Button behaviors can be added to a sprite. These behaviors
are intended to make the common task of creating buttons in a sprite
track easy—you basically just fill in a template. </p>
<p>Three types of behaviors are available; you may choose one
or more behaviors. Each change a type of property associated with
a button and are triggered by the mouse states <code>notOverNotPressed</code>, <code>overNotPressed</code>, <code>overPressed</code>,
and <code>notOverPressed</code>. The
three properties changed are: </p>
<ul class="ul"><li class="li"><p>The sprite’s <code>imageIndex</code>value</p></li>
<li class="li"><p>The ID of a cursor to be displayed</p></li>
<li class="li"><p>The ID of a status string variable displayed in the URL status
area of a Web browser. </p></li></ul>
<p>Setting a property’s value to –1 means don’t change
it. </p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_58" title="Note"></a><p><strong>Note:</strong>&nbsp;The cursor is
automatically set back to the default system cursor when leaving
a sprite.</p></div>
<p>The sprite track handles letting one sprite act as an active
button at a time.</p>
<p>The behaviors are added at the beginning of the sprite’s
list of actions, so they may be overridden by actions if desired.</p>
<p>To use the behaviors, you fill in the new atoms as follows,
using the description key specified in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57765">“QT Atom Container Description Key”</a></span>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>kSpriteAtomType<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteBehaviorsAtomType>, 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteImageBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteCursorBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteStatusStringsBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57765" title="QT Atom Container Description Key"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEJBGE" title="QT Atom Container Description Key"></a><h2>QT Atom Container Description Key</h2>
<p>Because QT atom container–based data structures are widely
used in QuickTime, a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_525"></a>description key is
presented here. Its usage is illustrated in the following sections, <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57770">“Sprite Media Handler Track Properties QT Atom Container Format”</a></span> and <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57776">“Sprite Media Handler Sample QT Atom Container Formats.”</a></span> </p>
<div class="codesample"><table><tr><td scope="row"><pre>[(QTAtomFormatName)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    atomType_1, id, index<span></span></pre></td></tr><tr><td scope="row"><pre>        data<span></span></pre></td></tr><tr><td scope="row"><pre>    atomType_n, id, index<span></span></pre></td></tr><tr><td scope="row"><pre>        data<span></span></pre></td></tr></table></div>
<p>The atoms may be required or optional:</p>
<div class="codesample"><table><tr><td scope="row"><pre> // optional atom<span></span></pre></td></tr><tr><td scope="row"><pre> // required atom<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;atomType><span></span></pre></td></tr><tr><td scope="row"><pre>atomType<span></span></pre></td></tr></table></div>
<p>The atom ID may be a number if it is required to be a constant,
or it may be a list of valid atom IDs, indicating that multiple
atoms of this type are allowed.</p>
<div class="codesample"><table><tr><td scope="row"><pre>3               // one atom with id of 3<span></span></pre></td></tr><tr><td scope="row"><pre>(1..3)          // three atoms with id's of 1, 2, and 3<span></span></pre></td></tr><tr><td scope="row"><pre>(1, 5, 7)       // three atoms with id's of 1, 5, and 7<span></span></pre></td></tr><tr><td scope="row"><pre>(anyUniqueIDs)  // multiple atoms each with a unique id<span></span></pre></td></tr></table></div>
<p>The atom index may be a 1 if only one atom of this type is
allowed, or it may be a range from 1 to some constant or variable.</p>
<div class="codesample"><table><tr><td scope="row"><pre>1               // one atom of this type is allowed, index is always  1<span></span></pre></td></tr><tr><td scope="row"><pre>(1..3)          // three atoms with indexes 1, 2, and 3<span></span></pre></td></tr><tr><td scope="row"><pre>(1..numAtoms)   // numAtoms atoms with indexes of 1 to numAtoms<span></span></pre></td></tr></table></div>
<p>The data may be leaf data in which its data type is listed
inside of brackets [], or it may be a nested tree of atoms.</p>
<div class="codesample"><table><tr><td scope="row"><pre>[theDataType]   // leaf data of type theDataType<span></span></pre></td></tr><tr><td scope="row"><pre>childAtoms      // a nested tree of atoms<span></span></pre></td></tr></table></div>
<p>Nested <code>QTAtom</code> format
definitions [(AtomFormatName)] may appear in a definition.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57770" title="Sprite Media Handler Track Properties QT Atom Container Format"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCIEIED" title="Sprite Media Handler Track Properties QT Atom Container Format"></a><h2>Sprite Media Handler Track Properties QT
Atom Container Format</h2>
<div class="codesample"><table><tr><td scope="row"><pre>[(SpriteTrackProperties)]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyBackgroundColor, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [RGBColor]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyOffscreenBitDepth, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [short]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertySampleFormat, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [long]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyScaleSpritesToScaleWorld, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [Boolean]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyHasActions, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [Boolean]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyVisible, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [Boolean]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kSpriteTrackPropertyQTIdleEventsFrequency, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>        [UInt32]<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57776" title="Sprite Media Handler Sample QT Atom Container Formats"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEFDFC" title="Sprite Media Handler Sample QT Atom Container Formats"></a><h2>Sprite Media Handler Sample QT Atom Container
Formats</h2>
<div class="codesample"><table><tr><td scope="row"><pre>[(SpriteKeySample)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    [(SpritePropertyAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>    [(SpriteImageAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(SpriteOverrideSample)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    [(SpritePropertyAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(SpriteImageAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteSharedDataAtomType, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteVariablesContainerAtomType>, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;kSpriteStringVariableAtomType>, (1..n) ID is  SpriteTrack<span></span></pre></td></tr><tr><td scope="row"><pre>                            Variable ID to be set<span></span></pre></td></tr><tr><td scope="row"><pre>                                                [CString]<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;kSpriteFloatingPointVariableAtomType>, (1..n)  ID is<span></span></pre></td></tr><tr><td scope="row"><pre>                            SpriteTrack Variable ID to be set<span></span></pre></td></tr><tr><td scope="row"><pre>                                                [float]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        kSpriteImagesContainerAtomType, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            kSpriteImageAtomType, theImageID, (1 .. numImages)<span></span></pre></td></tr><tr><td scope="row"><pre>                kSpriteImageDataAtomType, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>                    [ImageData is ImageDescriptionHandle prepended  to<span></span></pre></td></tr><tr><td scope="row"><pre>                                                            image  data]<span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;kSpriteImageRegistrationAtomType, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>                    [FixedPoint]<span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;kSpriteImageNameAtomType, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>                    [pString]<span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;kSpriteImageGroupIDAtomType, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>                    [long]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(SpritePropertyAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kQTEventFrameLoaded>, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        [(ActionListAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kCommentAtomType>, (anyUniqueIDs), (1..numComments)<span></span></pre></td></tr><tr><td scope="row"><pre>            [CString]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kSpriteAtomType, theSpriteID, (1 .. numSprites)<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpritePropertyMatrix, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [MatrixRecord]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpritePropertyVisible, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [short]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpritePropertyLayer, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [short]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpritePropertyImageIndex, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [short]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpritePropertyGraphicsMode, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [ModifierTrackGraphicsModeRecord]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteUsesImageIDsAtomType, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [array of QTAtomID's, one per image used]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteBehaviorsAtomType>, 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteImageBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteCursorBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kSpriteStatusStringsBehaviorAtomType><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTSpriteButtonBehaviorStruct]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;[(SpriteActionAtoms)]><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(SpriteActionAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTEventType, theQTEventType, (1 .. numEventTypes)<span></span></pre></td></tr><tr><td scope="row"><pre>            [(ActionListAtoms)] //see the next section Wired Action<span></span></pre></td></tr><tr><td scope="row"><pre>                                //Grammar for a description<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;kCommentAtomType>, (anyUniqueIDs), (1..numComments)<span></span></pre></td></tr><tr><td scope="row"><pre>                [CString]<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57782" title="Wired Action Grammar"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEBAFF" title="Wired Action Grammar"></a><h2>Wired Action Grammar</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_526"></a>wired
action grammar shown in this section allows QT event handlers to
be expressed in a QuickTime movie. The sprite, text, VR, 3D, and
Flash media handlers all support the embedding of QT event handlers
in their media samples. </p>
<div class="codesample"><table><tr><td scope="row"><pre>[(ActionListAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    kAction, (anyUniqueIDs), (1..numActions)<span></span></pre></td></tr><tr><td scope="row"><pre>        kWhichAction    1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [long whichActionConstant]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kActionParameter>  (anyUniqueIDs), (1..numParameters)<span></span></pre></td></tr><tr><td scope="row"><pre>            [(parameterData)] ( whichActionConstant, paramIndex  )<span></span></pre></td></tr><tr><td scope="row"><pre>    // either leaf data or child atoms<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kActionFlags>  parameterID,  (1..numParamsWithFlags)<span></span></pre></td></tr><tr><td scope="row"><pre>            [long actionFlags]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kActionParameterMinValue>  parameterID,  (1.. numParamsWithMin)<span></span></pre></td></tr><tr><td scope="row"><pre>            [data depends on param type]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kActionParameterMaxValue>  parameterID,  (1.. numParamsWithMax)<span></span></pre></td></tr><tr><td scope="row"><pre>            [data depends on param type]<span></span></pre></td></tr><tr><td scope="row"><pre>        [(ActionTargetAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kCommentAtomType>, (anyUniqueIDs), (1..numComments)<span></span></pre></td></tr><tr><td scope="row"><pre>            [CString]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(ActionTargetAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kActionTarget><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetMovie><span></span></pre></td></tr><tr><td scope="row"><pre>            [no data]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kTargetChildMovieTrackName><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;PString childMovieTrackName><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kTargetChildMovieTrack><span></span></pre></td></tr><tr><td scope="row"><pre>        [IDlong childMovieTrackID]<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kTargetChildMovieTrackIndex><span></span></pre></td></tr><tr><td scope="row"><pre>            [long childMovieTrackIndex]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetChildMovieMovieName><span></span></pre></td></tr><tr><td scope="row"><pre>            [PString childMovieName]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetChildMovieMovieID><span></span></pre></td></tr><tr><td scope="row"><pre>            [long childMovieID]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetTrackName><span></span></pre></td></tr><tr><td scope="row"><pre>            [PString trackName]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetTrackType><span></span></pre></td></tr><tr><td scope="row"><pre>            [OSType trackType]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetTrackIndex><span></span></pre></td></tr><tr><td scope="row"><pre>            [long trackIndex]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetTrackID><span></span></pre></td></tr><tr><td scope="row"><pre>            [long trackID]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetSpriteName><span></span></pre></td></tr><tr><td scope="row"><pre>            [PString spriteName]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetSpriteIndex><span></span></pre></td></tr><tr><td scope="row"><pre>            [short spriteIndex]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetSpriteID><span></span></pre></td></tr><tr><td scope="row"><pre>            [QTAtomID spriteIID]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetQD3DNamedObjectName><span></span></pre></td></tr><tr><td scope="row"><pre>            [CString objectName]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(kExpressionAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    kExpressionContainerAtomType, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kOperatorAtomType, theOperatorType, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            kOperandAtomType, (anyUniqueIDs), (1..numOperands)<span></span></pre></td></tr><tr><td scope="row"><pre>                [(OperandAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        OR<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kOperandAtomType, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [(OperandAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>[(ActionTargetAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kActionTarget><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetMovieName><span></span></pre></td></tr><tr><td scope="row"><pre>            [Pstring MovieName]<span></span></pre></td></tr><tr><td scope="row"><pre>        OR<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetMovieID><span></span></pre></td></tr><tr><td scope="row"><pre>            [long MovieID]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(OperandAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kOperandExpression> 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        [(kExpressionAtoms)]        // allows for recursion<span></span></pre></td></tr><tr><td scope="row"><pre>    OR<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kOperandConstant> 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        [ float theConstant ]<span></span></pre></td></tr><tr><td scope="row"><pre>    OR<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kOperandSpriteTrackVariable> 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        [(ActionTargetAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionParameter, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [QTAtomID spriteVariableID]<span></span></pre></td></tr><tr><td scope="row"><pre>    OR<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kOperandKeyIsDown> 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionParameter, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [UInt16 modifierKeys]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionParameter, 2, 2<span></span></pre></td></tr><tr><td scope="row"><pre>            [UInt8 asciiCharCode]<span></span></pre></td></tr><tr><td scope="row"><pre>    OR<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kOperandRandom> 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionParameter, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [short minimum]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionParameter, 2, 2<span></span></pre></td></tr><tr><td scope="row"><pre>            [short maximum]<span></span></pre></td></tr><tr><td scope="row"><pre>    OR<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;any other operand atom type><span></span></pre></td></tr><tr><td scope="row"><pre>        [(ActionTargetAtoms)]<span></span></pre></td></tr></table></div>
<p>The format for parameter data depends on the action and parameter
index. </p>
<p>In most cases, the <code>kActionParameter</code> atom
is a leaf atom containing data; for a few parameters, it contains
child atoms.</p>
<p><code>whichAction</code> corresponds
to the action type that is specified by the leaf data of a <code>kWhichAction</code> atom.</p>
<p><code>paramIndex</code> is the
index of the parameter’s <code>kActionParameter</code> atom.</p>
<div class="codesample"><table><tr><td scope="row"><pre>[(parameterData)] ( whichAction, paramIndex ) =<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetVolume:<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short volume<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetRate<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Fixed rate<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetLoopingFlags<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     long loopingFlags<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieGoToTime<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     TimeValue time<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieGoToTimeByName<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Str255 timeName<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieGoToBeginning<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieGoToEnd<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieStepForward<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieStepBackward<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetSelection<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     TimeValue startTime<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     TimeValue endTime<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetSelectionByName<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Str255 startTimeName<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     Str255 endTimeName<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMoviePlaySelection<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Boolean selectionOnly<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieSetLanguage<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     long language<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMovieChanged<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetVolume<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short volume<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetBalance<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short balance<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetEnabled<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Boolean enabled<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetMatrix<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     MatrixRecord matrix<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetLayer<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short layer<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTrackSetClip<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     RgnHandle clip<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteSetMatrix<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     MatrixRecord matrix<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteSetImageIndex<span></span></pre></td></tr><tr><td scope="row"><pre>        parm1:      short imageIndex<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteSetVisible<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short visible<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteSetLayer<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     short layer<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteSetGraphicsMode<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     ModifierTrackGraphicsModeRecord graphicsMode<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpritePassMouseToCodec<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteClickOnCodec<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Point localLoc<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteTranslate<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Fixed x<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     Fixed y<span></span></pre></td></tr><tr><td scope="row"><pre>        param3:     Boolean isRelative<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteScale<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Fixed xScale<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     Fixed yScale<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteRotate<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Fixed degrees<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteStretch<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Fixed p1x<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     Fixed p1y<span></span></pre></td></tr><tr><td scope="row"><pre>        param3:     Fixed p2x<span></span></pre></td></tr><tr><td scope="row"><pre>        param4:     Fixed p2y<span></span></pre></td></tr><tr><td scope="row"><pre>        param5:     Fixed p3x<span></span></pre></td></tr><tr><td scope="row"><pre>        param6:     Fixed p3y<span></span></pre></td></tr><tr><td scope="row"><pre>        param7:     Fixed p4x<span></span></pre></td></tr><tr><td scope="row"><pre>        param8:     Fixed p4y<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionQTVRSetPanAngle<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     float panAngle<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionQTVRSetTiltAngle<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     float tileAngle<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionQTVRSetFieldOfView<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     float fieldOfView<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionQTVRShowDefaultView<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionQTVRGoToNodeID<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     UInt32 nodeID<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMusicPlayNote<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     long sampleDescIndex<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     long partNumber<span></span></pre></td></tr><tr><td scope="row"><pre>        param3:     long delay<span></span></pre></td></tr><tr><td scope="row"><pre>        param4:     long pitch<span></span></pre></td></tr><tr><td scope="row"><pre>        param5:     long velocity<span></span></pre></td></tr><tr><td scope="row"><pre>        param6:     long duration<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionMusicSetController<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     long sampleDescIndex<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     long partNumber<span></span></pre></td></tr><tr><td scope="row"><pre>        param3:     long delay<span></span></pre></td></tr><tr><td scope="row"><pre>        param4:     long controller<span></span></pre></td></tr><tr><td scope="row"><pre>        param5:     long value<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionCase<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     [(CaseStatementActionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionWhile<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     [(WhileStatementActionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionGoToURL<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     CString urlLink<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSendQTEventToSprite<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     [(SpriteTargetAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     QTEventRecord theEvent<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionDebugStr<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Str255 theMessageString<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionPushCurrentTime<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionPushCurrentTimeWithLabel<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Str255 theLabel<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionPopAndGotoTopTime<span></span></pre></td></tr><tr><td scope="row"><pre>        no params<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionPopAndGotoLabeledTime<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     Str255 theLabel<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionSpriteTrackSetVariable<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     QTAtomID variableID<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     float value<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    kActionApplicationNumberAndString<span></span></pre></td></tr><tr><td scope="row"><pre>        param1:     long aNumber<span></span></pre></td></tr><tr><td scope="row"><pre>        param2:     Str255 aString<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>Both [(CaseStatementActionAtoms)] and [(WhileStatementActionAtoms)]
are child atoms of a <code>kActionParameter</code> <code>1</code>, <code>1</code> atom. </p>
<div class="codesample"><table><tr><td scope="row"><pre>[(CaseStatementActionAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    kConditionalAtomType, (anyUniqueIDs), (1..numCases)<span></span></pre></td></tr><tr><td scope="row"><pre>        [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionListAtomType 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [(ActionListAtoms)] // may contain nested conditional  actions<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[(WhileStatementActionAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    kConditionalAtomType, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        [(kExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionListAtomType 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [(ActionListAtoms)] // may contain nested conditional  actions<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69851" title="Flash Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGCDAE" title="Flash Media"></a><h2>Flash Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_527"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_528"></a>Flash is a
vector-based graphics and animation technology designed for the
Internet. As an authoring tool, Flash lets content authors and developers
create a wide range of interactive vector animations. The files
exported by this tool are called SWF (pronounced “swiff”) files.
SWF files are commonly played back using Macromedia’s ShockWave
plug-in. In an effort to establish Flash as an industrywide standard,
Macromedia has published the SWF File Format and made the specification
publicly available on its website at <code>http://www.macromedia.com/software/flash/open/spec/</code>.</p>
<p>The Flash media handler, introduced in QuickTime 4, allows
a Macromedia Flash SWF 3.0 file to be treated as a track within
a QuickTime movie. Thus, QuickTime 4 extends the SWF file format,
enabling the execution of any of its wired actions. See <span class="content_text"><a href="../QTFFChap5/qtff5.html#//apple_ref/doc/uid/TP40000939-CH207-19293">“Adding Wired Actions To a Flash Track”</a></span> for
an example of how to add wired actions. </p>
<p>Because a QuickTime movie may contain any number of tracks,
multiple SWF tracks may be added to the same movie. The Flash media
handler also provides support for an optimized case using the alpha
channel graphics mode, which allows a Flash track to be composited
cleanly over other tracks.</p>
<p>QuickTime supports all Flash actions except for the Flash
load movie action. For example, when a Flash track in a QuickTime
movie contains an action that goes to a particular Flash frame,
QuickTime converts this to a wired action that goes to the QuickTime
movie time in the corresponding Flash frame.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_59" title="Note"></a><p><strong>Note:</strong>&nbsp;As a time-based
media playback format, QuickTime may drop frames when necessary
to maintain its schedule. As a consequence, frames of a SWF file
may be dropped during playback. If this is not satisfactory for
your application, you can set the playback mode of the movie to Play
All Frames, which will emulate the playback mode of ShockWave. QuickTime’s
SWF file importer sets the Play All Frames mode automatically when
adding a SWF file to an empty movie. </p></div>
<p>QuickTime support for Flash 3.0 also includes the <code>DoFSCommand</code> mechanism.
This allows JavaScript routines with a specific function prototype
to be invoked with parameters passed from the Flash track. Refer
to Macromedia’s Flash 3 documentation for more details on how
to author a <code>.SWF</code> 3.0
file with a Flash <code>FSCommand</code>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69855" title="Tween Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBJJHE" title="Tween Media"></a><h2>Tween Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_529"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_530"></a>Tween
media is used to store pairs of values to be interpolated between
in QuickTime movies. These interpolated values modify the playback
of other media types by using track references and track input maps.
For example, a tween media could generate gradually changing relative
volume levels to cause an audio track to fade out. It has a media
type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_531"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_532"></a><code>'twen'</code>. </p>
<p>Every <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_533"></a>tween
operation is based on a collection of one or more values from which
a range of output values can be algorithmically derived. Each tween
is assigned a time duration, and an output value can be generated
for any time value within the duration. In the simplest kind of
tween operation, a pair of values is provided as input and values
between the two values are generated as output.</p>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_534"></a>tween
track is a special <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_535"></a>track
in a movie that is used exclusively as a modifier track. The data
it contains, known as <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_536"></a>tween
data, is used to generate values that modify the playback of other
tracks, usually by interpolating values. The tween media handler
sends these values to other media handlers; it never presents data.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57794" title="Tween Sample Description"></a><h3>Tween
Sample Description</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_537"></a>tween
sample description uses the standard sample description header,
as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25685">“Sample Table Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'twen'</code>. The tween
media handler adds no additional fields to the sample description.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57800" title="Tween Sample Data"></a><h3>Tween
Sample Data</h3>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_538"></a>Tween
sample data is stored in QT atom structures. </p>
<p>At the root level, there are one or more tween entry atoms;
these atoms have an atom type value of <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_539"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_540"></a>'twen'</code>.
Each tween entry atom completely describes one interpolation operation. These
atoms should be consecutively numbered starting at 1, using the
atom ID field. </p>
<p>Each tween entry atom contains several more atoms that describe
how to perform the interpolation. The atom ID field in each of these
atoms must be set to 1.</p>
<ul class="spaceabove"><li class="li"><p>Tween start atom (atom type is <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_541"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_542"></a>'twst'</code>).
This atom specifies the time at which the interpolation is to start.
The time is expressed in the media’s time coordinate system. If this
atom is not present, the starting offset is assumed to be 0.</p></li>
<li class="li"><p>Tween duration atom (atom type is <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_543"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_544"></a>'twdu'</code>).
This atom specifies how long the interpolation is to last. The time
is expressed in the media’s time coordinate system. If this atom
is not present, the duration is assumed to be the length of the
sample.</p></li>
<li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_545"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_546"></a>Tween
data atom (atom type is <code>'twdt'</code>).
This atom contains the actual values for the interpolation. The
contents depend on the value of the tween type atom.</p></li>
<li class="li"><p>Tween type atom (atom type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_547"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_548"></a><code>'twnt'</code>).
Describes the type of interpolation to perform. </p></li></ul><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-84978">Table 3-11</a></span> shows
all currently defined tween types. All tween types are currently supported
using linear interpolation. </p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_549"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-84978" title="Table 3-11Tween type values"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF106" title="Table 3-11Tween type values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-11&nbsp;&nbsp;</strong>Tween type values</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Tween type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Tween data</p></th>
</tr>


<tr>
<td  scope="row"><p>16-bit integer</p></td>
<td ><p>1</p></td>
<td ><p>Two 16-bit integers.</p></td>
</tr>
<tr>
<td  scope="row"><p>32-bit integer</p></td>
<td ><p>2</p></td>
<td ><p>Two 32-bit integers.</p></td>
</tr>
<tr>
<td  scope="row"><p>32-bit fixed-point</p></td>
<td ><p>3</p></td>
<td ><p>Two 32-bit fixed-point numbers. </p></td>
</tr>
<tr>
<td  scope="row"><p>Point: two 16-bit integers</p></td>
<td ><p>4</p></td>
<td ><p>Two points.</p></td>
</tr>
<tr>
<td  scope="row"><p>Rectangle: four 16-bit integers</p></td>
<td ><p>5</p></td>
<td ><p>Two rectangles.</p></td>
</tr>
<tr>
<td  scope="row"><p>QuickDraw region</p></td>
<td ><p>6</p></td>
<td ><p>Two rectangles and a region. The tween entry atom must contain a <code>'qdrg'</code> atom
with an atom ID value of 1. The region is transformed through the resulting
matrices.</p></td>
</tr>
<tr>
<td  scope="row"><p>Matrix</p></td>
<td ><p>7</p></td>
<td ><p>Two matrices.</p></td>
</tr>
<tr>
<td  scope="row"><p>RGB color: three 16-bit integers</p></td>
<td ><p>8</p></td>
<td ><p>Two RGB colors.</p></td>
</tr>
<tr>
<td  scope="row"><p>Graphics mode with RGB color</p></td>
<td ><p>9</p></td>
<td ><p>Two graphics modes with RGB color. Only the RGB color
is interpolated. The graphics modes must be the same.</p></td>
</tr>

</table></div>
<p>Each tween <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_550"></a>type is distinguished
from other types by these characteristics:</p>
<ul class="spaceabove"><li class="li"><p>Input values or structures of a particular type</p></li>
<li class="li"><p>A particular number of input values or structures (most often
one or two)</p></li>
<li class="li"><p>Output values or structures of a particular type</p></li>
<li class="li"><p>A particular algorithm used to derive the output values</p></li></ul>
<p>Tween operations for each tween type are performed by a tween
component that is specific to that type or, for a number of tween
types that are native to QuickTime, by QuickTime itself. Movies
and applications that use tweening do not need to specify the tween component
to use; QuickTime identifies a tween type by its tween type identifier
and automatically routes its data to the correct tween component
or to QuickTime.</p>
<p>When a movie contains a tween track, the tween media handler
invokes the necessary component (or built-in QuickTime code) for
tween operations and delivers the results to another media handler.
The receiving media handler can then use the values it receives
to modify its playback. For example, the data in a tween track can
be used to alter the volume of a sound track.</p>
<p>Tweening can also be used outside of movies by applications
or other software that can use the values it generates.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57805" title="Tween Type Categories"></a><h3>Tween Type
Categories</h3><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_551"></a>
<p>Each of the tween types supported by QuickTime belongs to
one of these categories:</p>
<ul class="spaceabove"><li class="li"><p>Numeric tween types, which have pairs of numeric
values, such as long integers, as input. For these types, linear
interpolation is used to generate output values.</p></li>
<li class="li"><p>QuickDraw tween types, most of which have pairs of QuickDraw
structures, such as points or rectangles, as input. For these types,
one or more structure elements are interpolated, such as the <code>h</code> and <code>v</code> values
for points, and each element that is interpolated is interpolated
separately from others.</p></li>
<li class="li"><p>3D tween types, which have a QuickDraw 3D structure such as <code>TQ3Matrix4x4</code> or <code>TQ3RotateAboutAxisTransformData</code> as
input. For these types, a specific 3D transformation is performed
on the data to generate output.</p></li>
<li class="li"><p>The polygon tween type, which takes three four-sided polygons
as input. One polygon (such as the bounds for a sprite or track)
is transformed, and the two others specify the start and end of
the range of polygons into which the tween operation maps it. You
can use the output (a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_552"></a><code>MatrixRecord</code> data
structure) to map the source polygon into any intermediate polygon.
The intermediate polygon is interpolated from the start and end polygons
for each particular time in the tween duration.</p></li>
<li class="li"><p>Path tween types, whichhave as input a QuickTime vector data stream
for a path. Four of the path tween types also have as input a percentage
of path’s length; for these types, either a point on the path
or a  data structure is returned. Two other path tween types treat the
path as a function: one returns the <code>y</code> value
of the point on the path with a given <code>x</code> value,
and the other returns the <code>x</code> value
of the point on the path with a given <code>y</code> value.</p></li>
<li class="li"><p>The list tween type, which has as input a QT atom container that
contains leaf atoms of a specified atom type. For this tween type
category, the duration of the tween operation is divided by the
number of leaf atoms of the specified type. For time points within
the first time division, the data for the first leaf atom is returned;
for the second time division, the data for the second leaf atom
is returned; and so on. The resulting tween operation proceeds in
discrete steps (one step for each leaf atom), instead of the relatively
continuous tweening produced by other tween type categories.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57812" title="Tween QT Atom Container"></a><h3>Tween
QT Atom Container</h3>
<p>The characteristics of a tween are specified by the atoms
in a tween QT atom container.</p>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_553"></a>tween
QT atom container can contain the atoms described in the following
sections. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57818" title="General Tween Atoms"></a><h4>General 
Tween Atoms</h4><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_554"></a>
<ul class="spaceabove"><li class="li"><p><code>kTweenEntry</code></p><p>Specifies
a tween atom, which can be either a single tween atom, a tween atom
in a tween sequence, or an interpolation tween atom.</p><p>Its
parent is the tween QT atom container (which you specify with the
constant <code>kParentAtomIsContainer</code>).</p><p>The
index of a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_555"></a><code>kTweenEntry</code> atom
specifies when it was added to the QT atom containe<code>r</code>; the
first added has the index 1, the second 2, and so on. The ID of
a <code>kTweenEntry</code> atom can
be any ID that is unique among the <code>kTweenEntry</code> atoms
contained in the same QuickTime atom container.</p><p>This
atom is a parent atom. It must contain the following child atoms:</p><ul class="nested">
<li class="nested li"><p>A <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_556"></a>kTweenType</code> atom
that specifies the tween type.</p></li>
<li class="nested li"><p>One or more <code>kTweenData</code> atoms
that contain the data for the tween atom. Each <code>kTweenData</code> atom
can contain different data to be processed by the tween component,
and a tween component can process data from only one <code>kTweenData</code> atom
a time. For example, an application can use a list tween to animate
sprites. The <code>kTweenEntry</code> atom
for the tween atom could contain three sets of animation data, one for
moving the sprite from left to right, one for moving the sprite
from right to left, and one for moving the sprite from top to bottom.
In this case, the <code>kTweenEntry</code> atom for
the tween atom would contain three <code>kTweenData</code> atoms,
one for each data set. The application specifies the desired data
set by specifying the ID of the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_557"></a><code>kTweenData</code> atom to
use.</p><p>A <code>kTweenEntry</code> atom
can contain any of the following optional child atoms:</p></li>
<li class="nested li"><p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_558"></a><code>kTweenStartOffset</code> atom
that specifies a time interval, beginning at the start of the tween
media sample, after which the tween operation begins. If this atom
is not included, the tween operation begins at the start of the
tween media sample.</p></li>
<li class="nested li"><p>A <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_559"></a>kTweenDuration</code> atom
that specifies the duration of the tween operation. If this atom
is not included, the duration of the tween operation is the duration
of the media sample that contains it.</p><p>If a <code>kTweenEntry</code> atom
specifies a path tween, it can contain the following optional child
atom:</p></li>
<li class="nested li"><p>A <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_560"></a>kTweenFlags</code> atom
containing flags that control the tween operation. If this atom is
not included, no flags are set.</p><p>Note that <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_561"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_562"></a>interpolation
tween tracks are tween tracks that modify other tween tracks. The
output of an interpolation tween track must be a time value, and
the time values generated are used in place of the input time values
of the tween track being modified. </p><p>If a <code>kTweenEntry</code> atom
specifies an interpolation tween track, it must contain the following
child atoms:</p></li>
<li class="nested li"><p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_563"></a><code>kTweenInterpolationID</code> atom
for each <code>kTweenData</code> atom
to be interpolated. The ID of each <code>kTweenInterpolationID</code> atom
must match the ID of the <code>kTweenData</code> atom
to be interpolated. The data for a <code>kTweenInterpolationID</code> atom
specifies a <code>kTweenEntry</code> atom
that contains the interpolation tween track to use for the <code>kTweenData</code> atom. </p><p>If
this atom specifies an interpolation tween track, it can contain
either of the following optional child atoms:</p></li>
<li class="nested li"><p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_564"></a><code>kTweenOutputMin</code> atom
that specifies the minimum output value of the interpolation tween
atom. The value of this atom is used only if there is also a <code>kTweenOutputMax</code> atom
with the same parent. If this atom is not included and there is
a <code>kTweenOutputMax</code> atom
with the same parent, the tween component uses <code>0</code> as
the minimum value when scaling output values of the interpolation
tween track.</p></li>
<li class="nested li"><p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_565"></a><code>kTweenOutputMax</code> atom
that specifies the maximum output value of the interpolation tween
atom. If this atom is not included, the tween component does not
scale the output values of the interpolation tween track.</p></li></ul></li>
<li class="li"><p><code>kTweenStartOffset</code></p><p>For
a tween atom in a tween track of a QuickTime movie, specifies a
time offset from the start of the tween media sample to the start
of the tween atom. The time units are the units used for the tween
track.</p><p>Its parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenStartOffset </code>atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>TimeValue</code>.</p><p>This
atom is optional. If it is not included, the tween operation begins
at the start of the tween media sample.</p></li>
<li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_566"></a><code>kTweenDuration</code></p><p>Specifies
the duration of a tween operation. When a QuickTime movie includes
a tween track, the time units for the duration are those of the
tween track. If a tween component is used outside of a movie, the
application using the tween data determines how the duration value
and values returned by the component are interpreted.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenDuration</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>TimeValue</code>.</p><p>This
atom is optional. If it is not included, the duration of the tween
operation is the duration of the media sample that contains it.</p></li>
<li class="li"><p><code>kTweenData</code></p><p>Contains
data for a tween atom.</p><p>Its parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain any number of <code>kTweenData</code> atoms. </p><p>The
index of a <code>kTweenData</code> atom
specifies when it was added to the <code>kTweenEntry</code> atom; the
first added has the index 1, the second 2, and so on. The ID of
a <code>kTweenData</code> atom can be
any ID that is unique among the <code>kTweenData</code> atoms
contained in the same <code>kTweenEntry</code> atom.</p><p>At
least one <code>kTweenData</code> atom
is required in a <code>kTweenEntry</code> atom.</p><p>For
single tween atoms, a <code>kTweenData</code> atom
is a leaf atom. It can contain data of any type.</p><p>For
polygon tween atoms, a <code>kTweenData</code> atom
is a leaf atom. The data type of its data is <code>Fixed[27]</code>,
which specifies three polygons.</p><p>For path tweens, a <code>kTweenData</code> atom
is a leaf atom. The data type of its data is <code>Handle</code>, which
contains a QuickTime vector.</p><p>In interpolation tween
atoms, a <code>kTweenData</code> atom
is a leaf atom. It can contain data of any type. An interpolation
tween atom can be any tween atoms other than a list tween atom that
returns a time value.</p><p>In list tween atoms, a <code>kTweenData</code> atom
is a parent atom that must contain the following child atoms:</p><ul class="nested">
<li class="nested li"><p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_567"></a><code>kListElementType</code> atom
that specifies the atom type of the elements of the tween atom.</p></li>
<li class="nested li"><p>One or more leaf atoms of the type specified by the <code>kListElementType</code> atom.
The data for each atom is the result of a list tween operation.</p></li></ul></li>
<li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_568"></a><code>kNameAtom</code></p><p>Specifies
the name of a tween atom. The name, which is optional, is not used
by tween components, but it can be used by applications or other
software.</p><p>Its parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kNameAtom</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. Its data type is <code>String</code>.</p><p>This
atom is optional. If it is not included, the tween atom does not
have a name.</p></li>
<li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_569"></a><code>kTweenType</code></p><p>Specifies
the tween type (the data type of the data for the tween operation).</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenType </code>atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>OSType</code>.</p><p>This
atom is required.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57825" title="Path Tween Atoms"></a><h5>Path Tween Atoms</h5><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_570"></a>
<ul class="spaceabove"><li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_571"></a><code>kTweenFlags</code></p><p>Contains
flags that control the tween operation. One flag that controls path
tween atoms is defined:</p><ul class="nested"><li class="nested li"><p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_572"></a><code>kTweenReturnDelta</code> flag
applies only to path tween atoms (tweens of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_573"></a><code>kTweenTypePathToFixedPoint</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_574"></a><code>kTweenTypePathToMatrixTranslation</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_575"></a><code>kTweenTypePathToMatrixTranslationAndRotation</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_576"></a><code>kTweenTypePathXtoY</code>,
or <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_577"></a><code>kTweenTypePathYtoX</code>).
If the flag is set, the tween component returns the change in value
from the last time it was invoked. If the flag is not set, or if
the tween component has not previously been invoked, the tween component
returns the normal result for the tween atom.</p><p>Its parent atom
is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenFlags </code>atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>Long</code>.</p><p>This
atom is optional. If it is not included, no flags are set.</p></li></ul></li>
<li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_578"></a><code>kInitialRotationAtom</code></p><p>Specifies
an initial angle of rotation for a path tween atom of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_579"></a><code>kTweenTypePathToMatrixRotation</code>, <code>kTweenTypePathToMatrixTranslation</code>,
or <code>kTweenTypePathToMatrixTranslationAndRotation</code>.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_580"></a><code>kInitialRotationAtom</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. Its data type is <code>Fixed</code>.</p><p>This
atom is optional. If it is not included, no initial rotation of
the tween atom is performed.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57831" title="List Tween Atoms"></a><h5>List Tween Atoms</h5><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_581"></a>
<ul class="spaceabove"><li class="li"><p><code>kListElementType</code></p><p>Specifies
the atom type of the elements in a list tween atom.</p><p>Its
parent atom is a <code>kTweenData</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kListElementType</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. Its data type is <code>QTAtomType</code>.</p><p>This
atom is required in the <code>kTweenData</code> atom
for a list tween atom.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57837" title="3D Tween Atoms"></a><h5>3D
Tween Atoms</h5>
<ul class="spaceabove"><li class="li"><p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_582"></a><code>kTween3dInitialCondition</code></p><p>Specifies
an initial transform for a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_583"></a>3D
tween atom whose tween type is one of the following: <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_584"></a><code>kTweenType3dCameraData</code>,<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_585"></a><code> kTweenType3dMatrix</code>,<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_586"></a><code> kTweenType3dQuaternion</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_587"></a><code>kTweenType3dRotate</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_588"></a><code>kTweenType3dRotateAboutAxis</code>,<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_589"></a><code> kTweenType3dRotateAboutAxis</code>, <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_590"></a><code>kTweenType3dRotateAboutPoint</code>,<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_591"></a><code> kTweenType3dRotateAboutVector</code>,<code> <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_592"></a>kTweenType3dScale</code>,<code> </code>or<code> kTweenType3dTranslate</code>.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_593"></a><code>kTween3dInitialCondition</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is as follows:</p><ul class="nested"><li class="nested li"><p>For a <code>kTweenType3dCameraData</code> tween,
its data type is <code>TQ3CameraData</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dMatrix</code> tween,
its data type is <code>TQ3Matrix4x4</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dQuaternion</code> tween,
its data type is <code>TQ3Quaternion</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dRotate</code> tween,
its data type is <code>TQ3RotateTransformData</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dRotateAboutAxis</code> tween,
its data type is <code>TQ3RotateAboutAxisTransformData</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dRotateAboutPoint</code> tween,
its data type is <code>TQ3RotateAboutPointTransformData</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dRotateAboutVector</code> tween,
its data type is <code>TQ3PlaneEquation</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dScale</code> tween,
its data type is <code>TQ3Vector3D</code>.</p></li>
<li class="nested li"><p>For a <code>kTweenType3dTranslate</code> tween,
its data type is <code>TQ3Vector3D</code>.</p><p>This
atom is optional. For each tween type, the default value is the
data structure that specifies an identity transform, that is, a
transform that does not alter the 3D data.</p></li></ul></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57842" title="Interpolation Tween Atoms"></a><h5>Interpolation
Tween Atoms</h5>
<ul class="spaceabove"><li class="li"><p><code>kTweenOutputMax</code></p><p>Specifies
the maximum output value of an <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_594"></a>interpolation tween atom.
If a <code>kTweenOutputMax</code> atom
is included for an interpolation tween, output values for the tween
atom are scaled to be within the minimum and maximum values. The
minimum value is either the value of the <code>kTweenOutputMin</code> atom
or, if there is no <code>kTweenOutputMin</code> atom,
0. For example, if an interpolation tween atom has values between
0 and 4, and it has <code>kTweenOutputMin</code> and <code>kTweenOutputMax</code> atoms
with values 1 and 2, respectively, a value of 0 (the minimum value
before scaling) is scaled to 1 (the minimum specified by the <code>kTweenOutputMin</code> atom),
a value of 4 (the maximum value before scaling) is scaled to 2 (the
maximum specified by the <code>kTweenOutputMax</code> atom),
and a value of 3 (three-quarters of the way between the maximum
and minimum values before scaling) is scaled to 1.75 (three-quarters
of the way between the values of the <code>kTweenOutputMin</code> and <code>kTweenOutputMax</code> atoms).</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenOutputMax</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>Fixed</code>.</p><p>This
atom is optional. If it is not included, QuickTime does not scale
interpolation tween values.</p></li>
<li class="li"><p><code>kTweenOutputMin</code></p><p>Specifies
the minimum output value of an interpolation tween atom. If both <code>kTweenOutputMin</code> and <code>kTweenOutputMax</code> atoms
are included for an interpolation tween atom, output values for
the tween atom are scaled to be within the minimum and maximum values.
For example, if an interpolation tween atom has values between 0 and
4, and it has <code>kTweenOutputMin</code> and <code>kTweenOutputMax</code> atoms
with values 1 and 2, respectively, a value of 0 (the minimum value
before scaling) is scaled to 1 (the minimum specified by the <code>kTweenOutputMin</code> atom),
a value of 4 (the maximum value before scaling) is scaled to 2 (the
maximum specified by the <code>kTweenOutputMax</code> atom),
and a value of 3 (three-quarters of the way between the maximum
and minimum values before scaling) is scaled to 1.75 (three-quarters
of the way between the values of the <code>kTweenOutputMin</code> and <code>kTweenOutputMax</code> atoms).</p><p>If
a <code>kTweenOutputMin</code> atom
is included but a <code>kTweenOutputMax</code> atom
is not, QuickTime does not scale interpolation tween values.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenOutputMin </code>atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>Fixed</code>.</p><p>This
atom is optional. If it is not included but a <code>kTweenOutputMax</code> atom
is, the tween component uses <code>0</code> as
the minimum value for scaling values of an interpolation tween atom.</p></li>
<li class="li"><p><code>kTweenInterpolationID</code></p><p>Specifies
an interpolation tween atom to use for a specified <code>kTweenData</code> atom.
There can be any number of <code>kTweenInterpolationID</code> atoms
for a tween atom, one for each <code>kTweenData</code> atom
to be interpolated. </p><p>Its parent atom is a <code>kTweenEntry</code> atom.</p><p>The
index of a <code>kTweenInterpolationID</code> atom
specifies when it was added to the <code>kTweenEntry</code> atom;
the first added has the index 1, the second 2, and so on. The ID
of a <code>kTweenInterpolationID</code> atom
must match the atom ID of the <code>kTweenData</code> atom
to be interpolated, and be unique among the <code>kTweenInterpolationID</code> atoms
contained in the same <code>kTweenEntry</code> atom.</p><p>This
atom is a leaf atom. The data type of its data is <code>QTAtomID</code>.</p><p>This
atom is required for an interpolation tween atom.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57847" title="Region Tween Atoms"></a><h5>Region
Tween Atoms</h5>
<ul class="spaceabove"><li class="li"><p><code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_595"></a>kTweenPictureData</code></p><p>Contains
the data for a QuickDraw picture. Used only by a <code>kTweenTypeQDRegion</code> atom.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenPictureData</code> or <code>kTweenRegionData</code> atom. The
ID of this atom is always 1. The index of this atom is always 1.</p><p>This
atom is a leaf atom. The data type of its data is <code>Picture</code>.</p><p>Either
a <code>kTweenPictureData</code> or <code>kTweenRegionData</code> atom
is required for a kTweenTypeQDRegion atom.</p></li>
<li class="li"><p><code>kTweenRegionData</code></p><p>Contains
the data for a QuickDraw region. Used only by a <code>kTweenTypeQDRegion</code> atom.</p><p>Its
parent atom is a <code>kTweenEntry</code> atom.</p><p>A <code>kTweenEntry</code> atom
can contain only one <code>kTweenRegionData </code>or <code>kTweenPictureData</code> atom.
The ID of this atom is always 1. The index of this atom is always
1.</p><p>This atom is a leaf atom. The data type of its data
is <code>Region</code>.</p><p>Either
a <code>kTweenPictureData</code> or <code>kTweenRegionData</code> atom
is required for a <code>kTweenTypeQDRegion</code> tween.</p></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57852" title="Sequence Tween Atoms"></a><h5>Sequence
Tween Atoms</h5>
<ul class="spaceabove"><li class="li"><p><code>kTweenSequenceElement</code></p><p>Specifies
an entry in a tween <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_596"></a>sequence.</p><p>Its
parent is the tween QT atom container (which you specify with the
constant <code>kParentAtomIsContainer</code>).</p><p>The
ID of a <code>kTweenSequenceElement</code> atom
must be unique among the <code>kTweenSequenceElement</code> atoms
in the same QT atom container. The index of a <code>kTweenSequenceElement</code> atom
specifies its order in the sequence; the first entry in the sequence
has the index 1, the second 2, and so on.</p><p>This atom
is a leaf atom. The data type of its data is <code>TweenSequenceEntryRecord</code>,
a data structure that contains the following fields:</p></li></ul>
<dl class="termdef">	<dt><code>endPercent</code></dt>
<dd><p>A value of type <code>Fixed</code> that
specifies the point in the duration of the tween media sample at
which the sequence entry ends. This is expressed as a percentage;
for example, if the value is 75.0, the sequence entry ends after three-quarters
of the total duration of the tween media sample have elapsed. The
sequence entry begins after the end of the previous sequence entry
or, for the first entry in the sequence, at the beginning of the
tween media sample.</p></dd>
<dt><code>tweenAtomID</code></dt>
<dd><p>A value of type <code>QTAtomID</code> that
specifies the <code>kTweenEntry</code> atom
containing the tween for the sequence element. The <code>kTweenEntry</code> atom
and the <code>kTweenSequenceElement</code> atom
must both be a child atoms of the same tween QT atom container.</p></dd>
<dt><code>dataAtomID</code></dt>
<dd><p>A value of type <code>QTAtomID</code> that
specifies the <code>kTweenData</code> atom
containing the data for the tween. This atom must be a child atom
of the atom specified by the <code>tweenAtomID</code> field.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69859" title="Modifier Tracks"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCDGHB" title="Modifier Tracks"></a><h2>Modifier Tracks</h2>
<p>The addition of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_597"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_598"></a>modifier
tracks in QuickTime 2.1 introduced the capability for creating dynamic
movies. (A modifier track sends data to another track; by comparison, a
track reference is an association.) For example, instead of playing
video in a normal way, a video track could send its image data to
a sprite track. The sprite track then could use that video data
to replace the image of one of its sprites. When the movie is played,
the video track appears as a sprite. </p>
<p>Modifier tracks are not a new type of track. Instead, they
are a new way of using the data in existing tracks. A modifier track
does not present its data, but sends it to another track that uses
the data to modify how it presents its own data. Any track can be
either a sender or a presenter, but not both. Previously, all tracks
were presenters.</p>
<p>Another use of modifier tracks is to store a series of sound
volume levels, which is what occurs when you work with a tween track.
These sound levels can be sent to a sound track as it plays to dynamically
adjust the volume. A similar use of modifier tracks is to store location
and size information. This data can be sent to a video track to
cause it to move and resize as it plays.</p>
<p>Because a modifier track can send its data to more than one
track, you can easily synchronize actions between multiple tracks.
For example, a single modifier track containing matrices as its
samples can make two separate video tracks follow the same path.</p>
<p>See <span class="content_text"><a href="../QTFFChap5/qtff5.html#//apple_ref/doc/uid/TP40000939-CH207-19285">“Creating Movies With Modifier Tracks”</a></span> for
more information about using modifier tracks. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57857" title="Limitations of Spatial Modifier Tracks"></a><h3>Limitations
of Spatial Modifier Tracks</h3>
<p>A modifier track may cause a track to move outside of its
original boundary regions. This may present problems, since applications
do not expect the dimensions or location of a QuickTime movie to
change over time. </p>
<p>To ensure that a movie maintains a constant location and size,
the Movie Toolbox limits the area in which a spatially modified
track can be displayed. A movie’s “natural” shape is defined
by the region returned by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_599"></a><code>GetMovieBoundsRgn</code> function.
The toolbox clips all spatially modified tracks against the region
returned by <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_600"></a><code>GetMovieBoundsRgn</code>.
This means that a track can move outside of its initial boundary
regions, but it cannot move beyond the combined initial boundary
regions of all tracks in the movie. Areas uncovered by a moving
track are handled by the toolbox in the same way as areas uncovered
by tracks with empty edits. </p>
<p>If a track has to move through a larger area than that defined
by the movie’s boundary region, the movie’s boundary region
can be enlarged to any desired size by creating a spatial track
(such as a video track) of the desired size but with no data. As
long as the track is enabled, it contributes to the boundary regions
of the movie.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69894" title="Track References"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCIBFHE" title="Track References"></a><h2>Track References</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_601"></a>Although
QuickTime has always allowed the creation of movies that contain
more than one track, it has not been able to specify relationships
between those tracks. <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_602"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_603"></a>Track references
are a feature of QuickTime that allows you to relate a movie’s
tracks to one another. The QuickTime track-reference mechanism supports
many-to-many relationships. That is, any movie track may contain
one or more track references, and any track may be related to one
or more other tracks in the movie.</p>
<p>Track references can be useful in a variety of ways. For example,
track references can be used to relate timecode tracks to other
movie tracks. You can use track references to identify relationships
between video and sound tracks—identifying the track that contains dialog
and the track that contains background sounds, for example. Another
use of track references is to associate one or more text tracks
that contain subtitles with the appropriate audio track or tracks.</p>
<p>Track references are also used to create chapter lists, as
described in the next section.</p>
<p>Every movie track contains a list of its track references.
Each track reference identifies another related track. That related
track is identified by its track identifier. The track reference
itself contains information that allows you to classify the references
by type. This type information is stored in an <code>OSType</code> data
type. You are free to specify any type value you want. Note, however,
that Apple has reserved all lowercase type values.</p>
<p>You may create as many track references as you want, and you
may create more than one reference of a given type. Each track reference
of a given type is assigned an index value. The index values start
at 1 for each different reference type. The Movie Toolbox maintains these
index values, so that they always start at 1 and count by 1.</p>
<p>Using the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_604"></a><code>AddTrackReference</code> function,
you can relate one track to another. The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_605"></a><code>DeleteTrackReference</code> function
will remove that relationship. The <code>SetTrackReference</code> and <code>GetTrackReference</code> functions
allow you to modify an existing track reference so that it identifies
a different track. The <code>GetNextTrackReferenceType</code> and <code>GetTrackReferenceCount</code> functions
allow you to scan all of a track’s track references. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57863" title="Chapter Lists"></a><h2>Chapter
Lists</h2>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_606"></a>chapter list
provides a set of named entry points into a movie, allowing the
user to jump to a preselected point in the movie from a convenient
pop-up list.</p>
<p>The movie controller automatically recognizes a chapter list
and will  create a pop-up list from it. When the user makes a selection
from the pop-up, the controller will jump to the appropriate point
in the movie. Note that if the movie is sized so that the controller
is too narrow to display the chapter names, the pop-up list will
not appear.</p>
<p>To create a chapter list, you must create a text track with
one sample for each chapter. The display time for each sample corresponds
to the point in the movie that marks the beginning of that chapter.
You must also create a track reference of type <code>'chap'</code> from
an enabled track of the movie to the text track. It is the <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_607"></a>'chap'</code> track
reference that makes the text track into a chapter list. The track
containing the reference can be of any type (audio, video, MPEG,
and so on), but it must be enabled for the chapter list to be recognized.</p>
<p>Given an enabled track <code>myVideoTrack</code>,
for example, you can use the <code>AddTrackReference</code> function
to create the chapter reference:</p>
<div class="codesample"><table><tr><td scope="row"><pre>    AddTrackReference( myVideoTrack, theTextTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>        kTrackReferenceChapterList,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;addedIndex );<span></span></pre></td></tr></table></div>
<p><code>kTrackReferenceChapterList</code> is
defined in <code>Movies.h</code>.
It has the value <code>'chap'</code>.</p>
<p>The text track that constitutes the chapter list does not
need to be enabled, and normally is not. If it is enabled, the text
track will be displayed as part of the movie, just like any other text
track, in addition to functioning as a chapter list.</p>
<p>If more than one enabled track includes a <code>'chap'</code> track
reference, QuickTime uses the first chapter list that it finds.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69863" title="3D Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCBJFE" title="3D Media"></a><h2>3D Media</h2>
<p>QuickTime movies store <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_608"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_609"></a>3D image data in
a base media. This media has a media type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_610"></a><code>'qd3d'</code>. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57869" title="3D Sample Description"></a><h3>3D
Sample Description</h3>
<p>The 3D sample description uses the standard sample description
header, as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25685">“Sample Table Atoms.”</a></span> </p>
<p>The data format field in the sample description is always
set to <code>'qd3d'</code>. The 3D
media handler adds no additional fields to the sample description.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57875" title="3D Sample Data"></a><h3>3D
Sample Data</h3>
<p>The 3D samples are stored in the 3D Metafile format developed
for QuickDraw 3D.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69867" title="Streaming Media"></a><h2>Streaming
Media</h2>
<p>QuickTime movies store streaming data in a streaming media
track. This media has a media type of <code>'strm'</code>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57881" title="Streaming Media Sample Description"></a><h3>Streaming
Media Sample Description</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_611"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_612"></a>streaming
media sample description contains information that defines how to interpret
streaming media data. This sample description is based on the standard
sample description header, as described in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-25685">“Sample Table Atoms.”</a></span></p>
<p>The streaming media sample description is documented in the
QuickTime header file <code>QTSMovie.h</code>,
as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-85107">Listing 3-1</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-85107" title="Listing 3-1Streaming media sample description"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEBAGB" title="Listing 3-1Streaming media sample description"></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>Streaming media sample description</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct QTSSampleDescription {<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            descSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            dataFormat;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            resvd1;     /* set to 0*/<span></span></pre></td></tr><tr><td scope="row"><pre>    short                           resvd2;     /* set to 0*/<span></span></pre></td></tr><tr><td scope="row"><pre>    short                           dataRefIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                          version;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                          resvd3;     /* set to 0*/<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32                          flags;<span></span></pre></td></tr><tr><td scope="row"><pre>                                                /* qt atoms follow:*/<span></span></pre></td></tr><tr><td scope="row"><pre>                                    /* long size, long type, some  data*/<span></span></pre></td></tr><tr><td scope="row"><pre>                                                /* repeat as necessary*/<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTSSampleDescription     QTSSampleDescription;<span></span></pre></td></tr></table></div>
<p>The sample format depends on the <code>dataFormat</code> field
of the <code>QTSSampleDescription</code>.
The <code>dataFormat</code> field
can be any value you specify. The currently defined values are <code>'rtsp'</code> and <code>'sdp
'</code>.</p>
<p>If <code>'rtsp'</code>, the
sample can be just an rtsp URL. It can also be any value that you
can put in a <code>.rtsp</code> file,
as defined at</p>
<p><code>http://streaming.apple.com/qtstreaming/documentation/userdocs/rtsptags.htm</code> </p>
<p>If <code>'sdp '</code>, then
the sample is an SDP file. This would be used to receive a multicast broadcast.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69871" title="Hint Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCIAEB" title="Hint Media"></a><h2>Hint Media</h2><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_613"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_614"></a>
<p>The QuickTime file format supports streaming of media data
over a network as well as local playback. The process of sending
protocol data units is time-based, just like the display of time-based
data, and is therefore suitably described by a time-based format.
A QuickTime file or movie that supports streaming includes information
about the data units to stream. This information is included in
additional tracks of the movie called <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_615"></a>hint tracks.</p>
<p>Hint tracks contain instructions for a streaming server which
assist in the formation of packets. These instructions may contain
immediate data for the server to send (for example, header information)
or reference segments of the media data. These instructions are
encoded in the QuickTime file in the same way that editing or presentation
information is encoded in a QuickTime file for local playback.</p>
<p>Instead of editing or presentation information, information
is provided which allows a server to packetize the media data in
a manner suitable for streaming, using a specific network transport.</p>
<p>The same media data is used in a QuickTime file which contains
hints, whether it is for local playback, or streaming over a number
of different transport types.  Separate hint tracks for different
transport types may be included within the same file and the media
will play over all such transport types without making any additional
copies of the media itself. In addition, existing media can be easily
made streamable by the addition of appropriate hint tracks for specific
transports. The media data itself need not be recast or reformatted in
any way.</p>
<p>Typically, hinting is performed by media packetizer components.
QuickTime selects an appropriate media packetizer for each track
and routes each packetizer's output through an Apple-provided packet
builder to create a hint track. One hint track is created for each streamable
track in the movie.</p>
<p>Hint tracks are quite small compared with audio or video tracks.
A movie that contains hint tracks can be played from a local disk
or streamed over HTTP, similar to any other QuickTime movie. Hint
tracks are only used when streaming a movie over a real-time media
streaming protocol, such as RTP.</p>
<p>Support for streaming in the QuickTime file format is based
upon the following considerations:</p>
<ul class="ul"><li class="li"><p>Media data represented as a set of network-independent
standard QuickTime tracks, which may be played or edited, as normal. </p></li>
<li class="li"><p>A common declaration and base structure for server hint tracks;
this common format is protocol independent, but contains the declarations
of which protocols are described in the server tracks. </p></li>
<li class="li"><p>A specific design of the server hint tracks for each protocol
which may be transmitted; all these designs use the same basic structure. </p></li></ul>
<p>The resulting streams, sent by the servers under the direction
of hint tracks, do not need to contain any trace of QuickTime information.
This approach does not require that QuickTime, or its structures
or declaration style, be used either in the data on the wire or in
the decoding station. For example, a QuickTime file using H.261
video and DVI audio, streamed under Real-Time Protocol (RTP), results
in a packet stream which is fully compliant with the IETF specifications
for packing those codings into RTP.</p>
<p>Hint tracks are built and flagged, so that when the movie
is viewed directly (not streamed), they are ignored.</p>
<p>The next section describes a generic format for streaming
hints to be stored in a QuickTime movie. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57887" title="Adding Hint Tracks to a Movie"></a><h3>Adding
Hint Tracks to a Movie</h3>
<p>To store packetization hints, one or more hint tracks are
added to a movie. Each hint track contains hints for at least one
actual media track to be streamed. A streamed media track may have
more than one hint track. For example, it might have a separate
hint track for the different packet sizes the server supports, or
it might have different hint tracks for different protocols. It
is not required that all media tracks have corresponding hint tracks
in a movie.</p>
<p>The sample time of a hint sample corresponds to the sample
time of the media contained in the packets generated by that hint
sample. The hint sample may also contain a transmission time for
each packet. (The format for the hint sample is specific to the
hint track type.)</p>
<p>The hint track may have a different time scale than its referenced
media tracks.</p>
<p>The <code>flags</code> field
in the track header atom (<code>'tkhd'</code>)
must be set to 0x000000, indicating that the track is inactive and
is not part of the movie, preview, or poster.</p>
<p>The <code>subType</code> field
of the handler description atom (<code>'hdlr'</code>)
contains <code>'hint'</code>, indicating
that the media type is packetization hints.</p>
<p>Note that if a QuickTime media track is edited, any previously
stored packetization hints may become invalid. Comparing the modification
dates of the media track and the hint track is one way to determine
this scenario, but it is far from being foolproof. Since the hint track
keeps track of which original track media samples and sample descriptions
to play at specific times, changes that affect those parts of the
original track or media make those hints invalid. Changes to a movie
that do not invalidate existing hint tracks include flattening (when
there are no edit lists), and adding new tracks. Changes that invalidate hint
tracks include: </p>
<ul class="spaceabove"><li class="li"><p>Flattening (when there are edit lists)</p></li>
<li class="li"><p>Adding or deleting samples</p></li>
<li class="li"><p>Changing a track’s time scale</p></li>
<li class="li"><p>Changing sample descriptions </p><div class="warningbox"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_60" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
Hint tracks are marked as inactive, so calling the <code>FlattenMovie </code>function
with the <code>flattenActiveTracksOnly</code> bit
set deletes all hint tracks from a movie.</p><p></p><div class="clear"></div></div></li></ul>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57902" title="Packetization Hint Media Header Atom"></a><h3>Packetization
Hint Media Header Atom</h3>
<p>In QuickTime movies, the media information atom (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_616"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_617"></a><code>'minf'</code>)
contains header data specific to the media. For hint tracks, the
media header is a base media information atom (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_618"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_619"></a><code>'gmhd'</code>). The
hint track must contain the base media information atom.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57907" title="Hint Track User Data Atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCDIEDE" title="Hint Track User Data Atom"></a><h3>Hint Track User Data Atom</h3>
<p>Each hint track may contain track user <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_620"></a>data atoms that apply
to only to the corresponding hint track. There are currently two
such atoms defined.</p>
<ul class="spaceabove"><li class="li"><p>User data atom type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_621"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_622"></a><code>'hinf'</code>. </p></li></ul>
<p>This contains statistics for the hint track. The <code>'hinf'</code> atom
contains child atoms as defined in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-85342">Table 3-12</a></span>. In some cases, there
are both 32-bit and 64-bit counters available. Any unknown types
should be ignored.</p>
<ul class="spaceabove"><li class="li"><p>User data atom type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_623"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_624"></a><code>'hnti'</code>. </p></li></ul>
<p>This may contain child atoms. Child atoms that start with <code>'sdp
'</code> (note, again, the space) contain SDP text
for this track. Text from these child atoms must be inserted into
the proper place in the SDP text for the movie, after any common
SDP text. This is analogous to the movie-level <code>'hnti'</code> atom.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57913" title="Movie Hint Info Atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCFBEIJ" title="Movie Hint Info Atom"></a><h3>Movie Hint Info Atom</h3>
<p>A movie may contain an <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_625"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_626"></a><code>'hnti'</code> movie
user data atom, which may contain one or more child atoms. The child
atom contents start with 4 bytes that specify the transport and
4 bytes that specify the type of data contained in the rest of the
child atom. Currently, the only defined transport is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_627"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_628"></a><code>'rtp
'</code> (note the space) and the only content data
type defined is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_629"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_630"></a><code>'sdp
'</code> (note the space). Child atoms whose transport
or type combinations you don’t recognize should be skipped. </p>
<p>The text in an atom of type <code>'rtp sdp
'</code> should be inserted (in the proper place)
into the SDP information generated from this file (for example,
by a streaming server) before any SDP information for specific tracks. </p><p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-85342">Table 3-12</a></span> describes the type and values of the <code>'hnti'</code> atom.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-85342" title="Table 3-12The &#39;hinf&#39; atom type containing child atoms"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGFDEH" title="Table 3-12The &#39;hinf&#39; atom type containing child atoms"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-12&nbsp;&nbsp;</strong>The <code>'hinf' </code>atom
type containing child atoms</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><code>'trpY&#8242;</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The total number of bytes that will be sent, including
12-byte RTP headers, but not including any network headers. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'totl'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>4-byte version of <code>'trpY&#8242;</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'nump'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The total number of network packets that will be sent
(if the application knows there is a 28-byte network header, it
can multiply 28 by this number and add it to the <code>'trpY&#8242;</code> value
to get the true number of bytes sent. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'npck'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>4-byte version of <code>'nump'</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'tpyl'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The total number of bytes that will be sent, not including
12-byte RTP headers. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'tpaY&#8242;</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>4-byte version of <code>'tpyl'</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>'maxr'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The maximum data rate. This atom contains two numbers:
g, followed by m (both 32-bit values). g is the granularity, in
milliseconds. m is the maximum data rate given that granularity.
For example, if g is 1 second, then m is the maximum data rate over
any 1 second. There may be multiple <code>'maxr'</code> atoms,
with different values for g. The maximum data rate calculation does
not include any network headers (but does include 12-byte RTP headers). </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'dmed'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The number of bytes from the media track to be sent.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>'dimm'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The number of bytes of immediate data to be sent. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'drep'</code></p></td>
<td ><p>8 bytes</p></td>
<td ><p>The number of bytes of repeated data to be sent. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'tmin'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>The smallest relative transmission time, in milliseconds. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'tmax'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>The largest relative transmission time, in milliseconds. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'pmax'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>The largest packet, in bytes; includes 12-byte RTP header. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'dmax'</code></p></td>
<td ><p>4 bytes</p></td>
<td ><p>The largest packet duration, in milliseconds. </p></td>
</tr>
<tr>
<td  scope="row"><p><code>'payt'</code></p></td>
<td ><p>Variable</p></td>
<td ><p>The payload type, which includes payload number (32-bits)
followed by <code>rtpmap</code> payload string
(Pascal string). </p></td>
</tr>

</table></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_61" title="Note"></a><p><strong>Note:</strong>&nbsp;Any of the atoms
shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-85342">Table 3-12</a></span> may or may not be present. These atoms are not guaranteed.</p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57926" title="Finding an Original Media Track From a Hint Track"></a><h2>Finding
an Original Media Track From a Hint Track</h2>
<p>Like any other QuickTime track, hint tracks can contain track
reference atoms. Exactly one of these must be of track reference
type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_631"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_632"></a><code>'hint'</code>,
and its internal list must contain at least one track ID, which
is the track ID of the original media track. Like other track reference
atoms, there may be empty references in this list, indicated by
a track ID of 0. For hint tracks that refer to more than one track,
the index number (starting at 1, and including any 0 entries) is
used in the media track reference index field in some of the packet
data table entry modes.</p>
<p>For example, if you have MPEG-1 video at track ID 11 and MPEG-1
layer 2 audio at track ID 12, and you are creating a RTP hint track
that encapsulates these in an MPEG-2 transport, you need to refer
to both tracks. You can also assume that there are some empty entries
and other track references in your hint track atom reference atom’s
list. So it might look like this: 11, 0, 0, 14, 0, 12, 0. When you
are assembling packets from audio and video tracks 11 and 12, you
use their list indexes (1 and 6) in the media track ref index field.</p>
<p>If you have only one <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_633"></a>media track listed in
your hint track reference, you may simply use a 0 in the media track
ref index field.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57931" title="RTP Hint Tracks"></a><h2>RTP
Hint Tracks</h2>
<p>RTP hint tracks contain information that allows a streaming
server to create RTP streams from a QuickTime movie, without requiring
the server to know anything about the media type, compression, or
payload format.</p>
<p>In RTP, each media stream, such as an audio or video track,
is sent as a separate RTP stream. Consequently, each media track
in the movie has an associated RTP hint track containing the data
necessary to packetize it for RTP transport, and each hint track
contains a track reference back to its associated media track.</p>
<p>Media tracks that do not have an associated RTP hint track
cannot be streamed over RTP and should be ignored by RTP streaming
servers.</p>
<p>It is possible for a media track to have more than one associated
hint track. The hint track contains information such as the packet
size and time scale in the hint track’s sample description. This
minimizes the runtime server load, but in order to support multiple packet
sizes it is necessary to have multiple RTP hint tracks for each
media track, each with different a packet size. A similar mechanism
could be used to provide hint tracks for multiple protocols in the
future.</p>
<p>It is also possible for a single hint track to refer to more
than one media stream. For example, audio and video MPEG elementary
streams could be multiplexed into a single systems stream RTP payload
format, and a single hint track would contain the necessary information
to combine both elementary streams into a single series of RTP packets.</p>
<p>This is the exception rather than the rule, however. In general,
multiplexing is achieved by using IP’s port-level multiplexing,
not by interleaving the data from multiple streams into a single
RTP session.</p>
<p>The hint track is related to each base media track by a track
reference declaration. The sample description for RTP declares the
maximum packet size that this hint track will generate. Partial
session description (SDP) information is stored in the track’s
user data atom.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-90969" title="Hint Sample Data Format"></a><h2>Hint
Sample Data Format</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_634"></a>sample description
atom (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_635"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_636"></a><code>'stsd'</code>)
contains information about the hint track samples. It specifies
the data format (note that currently only RTP data format is defined)
and the data reference to use (if more than one is defined) to
locate the hint track sample data. It also contains some general
information about this hint track, such as the hint track version number,
the maximum packet size allowed by this hint track, and the RTP
time scale. It may contain additional information, such as the random
offsets to add to the RTP time stamp and sequence number.</p>
<p>The sample description atom can contain a table of sample
descriptions to accommodate media that are encoded in multiple formats,
but a hint track can be expected to have a single sample description
at this time.</p>
<p>The sample description for hint tracks is defined in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-91003">Table 3-13</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-91003" title="Table 3-13Hint track sample description"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF107" title="Table 3-13Hint track sample description"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-13&nbsp;&nbsp;</strong>Hint track sample description</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Size</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>Data format</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>Reserved</p></td>
<td ><p>6</p></td>
</tr>
<tr>
<td  scope="row"><p>Data reference index</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Hint track version</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Last compatible hint track version</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Max packet size</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>Additional data table</p></td>
<td ><p>variable</p></td>
</tr>

</table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_62" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Size</dt>
<dd><p>A 32-bit integer specifying the size of this sample
description in bytes.</p></dd>
<dt>Data format</dt>
<dd><p>A four-character code indicating the data format of
the hint track samples. Only <code>'rtp '</code> is
currently defined. Note that the fourth character in <code>'rtp
'</code> is an ASCII blank space (0x20). Do not attempt
to packetize data whose format you do not recognize.</p></dd>
<dt>Reserved</dt>
<dd><p>Six bytes that must be set to 0.</p></dd>
<dt>Data reference index</dt>
<dd><p>This field indirectly specifies where to find
the hint track sample data. The data reference is a file or resource
specified by the data reference atom (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_637"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_638"></a><code>'dref'</code>)
inside the data information atom (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_639"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_640"></a><code>'dinf'</code>)
of the hint track. The data information atom can contain a table
of data references, and the data reference index is a 16-bit integer
that tells you which entry in that table should be used. Normally,
the hint track has a single data reference, and this index entry
is set to 0.</p></dd>
<dt>Hint track version</dt>
<dd><p>A 16-bit unsigned integer indicating the version
of the hint track specification. This is currently set to 1.</p></dd>
<dt>Last compatible hint track version</dt>
<dd><p>A 16-bit unsigned integer indicating the oldest
hint track version with which this hint track is backward-compatible.
If your application understands the hint track version specified
by this field, it can work with this hint track.</p></dd>
<dt>Max packet size</dt>
<dd><p>A 32-bit integer indicating the packet size limit,
in bytes, used when creating this hint track. The largest packet
generated by this hint track will be no larger than this limit.</p></dd>
<dt>Additional data table</dt>
<dd><p>A table of variable length containing additional
information. Additional information is formatted as a series of
tagged entries.</p><p>This field always contains a tagged
entry indicating the RTP time scale for RTP data. All other tagged
entries are optional.</p><p>Three data tags are currently
defined for RTP data. One tag is defined for use with any type of
data. You can create additional tags. Tags are identified using
four-character codes. Tags using all lowercase letters are reserved
by Apple. Ignore any tagged data you do not understand.</p><p>Table
entries are structured like atoms. The structure of table entries
is shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-91263">Table 3-14</a></span>.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-91263" title="Table 3-14The structure of table entries"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF108" title="Table 3-14The structure of table entries"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-14&nbsp;&nbsp;</strong>The structure of table entries</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Format</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Entry length</p></td>
<td ><p>32-bit integer</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>Data tag</p></td>
<td ><p>4-char code</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>Data</p></td>
<td ><p>Variable</p></td>
<td ><p>Entry length - 8</p></td>
</tr>

</table></div></dd></dl>
<p>Tagged entries for the <code>'rtp '</code> data
format are defined as follows:</p>
<dl class="termdef">	<dt><code>'tims'</code></dt>
<dd><p>A 32-bit integer specifying the RTP time scale. This
entry is required for RTP data.</p></dd>
<dt><code>'tsro'</code></dt>
<dd><p>A 32-bit integer specifying the offset to add to the
stored time stamp when sending RTP packets. If this entry is not
present, a random offset should be used, as specified by the IETF.
If this entry is 0, use an offset of 0 (no offset).</p></dd>
<dt><code>'snro'</code></dt>
<dd><p>A 32-bit integer specifying the offset to add to the
sequence number when sending RTP packets. If this entry is not present,
a random offset should be used, as specified by the IETF. If this
entry is 0, use an offset of 0 (no offset).</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-91386" title="Packetization Hint Sample Data for Data Format &#39;rtp &#39;"></a><h2>Packetization
Hint Sample Data for Data Format 'rtp '</h2>
<p>This section describes the sample data for the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_641"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_642"></a><code>'rtp
' </code>format. The <code>'rtp '</code> format
assumes that the server is sending data using <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_643"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_644"></a>Real-Time
Transport Protocol (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_645"></a>RTP).
This format also assumes that the server “knows” about RTP headers
but does not require that the server know anything about specific
media headers, including media headers defined in various IETF drafts.</p>
<p>Each sample in the hint track will generate one or more RTP
packets. Each entry in the sample data table in a hint track sample
corresponds to a single RTP packet. Samples in the hint track may
or may not correspond exactly to samples in the media track. Data
in the hint track sample is byte aligned, but not 32-bit aligned.</p>
<p>The RTP timestamps of all packets in a hint sample are the
same as the hint sample time. In other words, packets that do not
have the same RTP timestamp cannot be placed in the same hint sample.</p>
<p>The RTP hint track time scale should be reasonably chosen
so that there is adequate spacing between samples (as well as adequate
spacing between transmission times for packets within a sample).</p>
<p>The packetization hint sample data contains the following
data elements.</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Packetization hint sample data</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Entry count</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Reserved</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Packet entry table</p></td>
<td ><p>Variable</p></td>
</tr>
<tr>
<td  scope="row"><p>Additional data</p></td>
<td ><p>Variable</p></td>
</tr>

</table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_63" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Entry count</dt>
<dd><p>A 16-bit unsigned integer indicating the number of packet
entries in the table. Each entry in the table corresponds to a packet.
Multiple entries in a single sample indicate that the media sample
had to be split into multiple packets. A sample with an entry count
of 0 is reserved and, if encountered, must be skipped. </p></dd>
<dt>Reserved </dt>
<dd><p>Two bytes that must be set to 0. </p></dd>
<dt>Packet entry table </dt>
<dd><p>A variable length table containing packet entries. Packet
entries are defined below. </p></dd>
<dt>Additional data </dt>
<dd><p>A variable length field containing data pointed to by
the entries in the data table.</p></dd></dl>
<p>The packet entry contains the following data elements.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Packet entry</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Relative packet transmission time</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>RTP header info</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>RTP sequence number</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Flags</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Entry count</p></td>
<td ><p>2</p></td>
</tr>
<tr>
<td  scope="row"><p>Extra information TLVs</p></td>
<td ><p>0 or variable</p></td>
</tr>
<tr>
<td  scope="row"><p>Data table</p></td>
<td ><p>variable</p></td>
</tr>

</table></div>
<dl class="termdef">	<dt>Relative packet transmission
time </dt>
<dd><p>A 32-bit signed integer value, indicating the time,
in the hint track’s time scale, to send this packet relative to
the hint sample’s actual time. Negative values mean that the packet
will be sent earlier than real time, which is useful for smoothing
the data rate. Positive values are useful for repeating packets
at later times. Within each hint sample track, each packet time stamp
must be non-decreasing. </p></dd></dl>
<dl class="termdef">	<dt>RTP header info </dt>
<dd><p>A 16-bit integer specifying various values to be set
in the RTP header. The bits of the field are defined as follows.</p><br/><div>
<img src = "../art/qtff_l_t1.gif" alt = "image: ../art/qtff_l_t1.gif" width="257" height="34"></div><br/></dd></dl>
<dl class="termdef">	<dt>The RTP header information
field contains the following elements.</dt>
<dd><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bit#</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>P</p></td>
<td ><p>2</p></td>
<td ><p>A 1-bit number corresponding to the padding (P) bit in the
RTP header. This bit should probably not be set, since a server
that needs different packet padding would need to unpad and repad
the packet itself. </p></td>
</tr>
<tr>
<td  scope="row"><p>X</p></td>
<td ><p>3</p></td>
<td ><p>A 1-bit number corresponding to the extension (X) bit in
the RTP header. This bit should probably not be set, since a server
that needs to send its own RTP extension would either not be able
to, or would be forced to replace any extensions from the hint track. </p></td>
</tr>
<tr>
<td  scope="row"><p>M</p></td>
<td ><p>8</p></td>
<td ><p>A 1-bit number corresponding to the marker (M) bit in the
RTP header. </p></td>
</tr>
<tr>
<td  scope="row"><p>Payload type</p></td>
<td ><p>9-15</p></td>
<td ><p>A 7-bit number corresponding to the payload type (PT)
field of the RTP header. </p></td>
</tr>

</table></div></dd></dl>
<p>All undefined bits are reserved and must be set to zero. Note
that the location of the defined bits are in the same bit location
as in the RTP header.</p>
<dl class="termdef">	<dt>RTP sequence number</dt>
<dd><p>A 16-bit integer specifying the RTP sequence number
for this packet. The RTP server adds a random offset to this sequence
number before transmitting the packet. This field allows re-transmission
of packets––for example, the same packet can be assembled with
the same sequence number and a different (later) packet transmission
time. A text sample with a duration of 5 minutes can be retransmitted
every 10 seconds, so that clients that miss the original sample
transmission (perhaps they started playing the movie in the middle)
will be refreshed after a maximum of 10 seconds. </p></dd>
<dt>Flags</dt>
<dd><p>A 16-bit field indicating certain attributes for this
packet. Defined bits are:</p></dd></dl>
<br/><div><img src = "../art/qtff_l_t2.gif" alt = "image: ../art/qtff_l_t2.gif" width="125" height="34"></div><br/>
<p>The RTP header information field contains the following elements. </p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bit#</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>X</p></td>
<td ><p>13</p></td>
<td ><p>A 1-bit number indicating that this packet contains an
Extra information TLV data table. </p></td>
</tr>
<tr>
<td  scope="row"><p>B</p></td>
<td ><p>14</p></td>
<td ><p>A 1-bit number indicating that this packet contains data
that is part of a b-frame. A server that is having difficulty being able
to send all the packets in real time may discard packets that have
this bit set, until it catches up with the clock. </p></td>
</tr>
<tr>
<td  scope="row"><p>R</p></td>
<td ><p>15</p></td>
<td ><p>A 1-bit number indicating that this is a repeat packet:
the data has been defined in a previous packet. A server may choose
to skip repeat packets to help it catch up when it is behind in
its transmission of packets. All repeated packets for a given packet
must live in the same hint sample.</p></td>
</tr>

</table></div>
<p>All undefined bits are reserved and must be set to 0.</p>
<dl class="termdef">	<dt>Entry count</dt>
<dd><p>A 16-bit unsigned integer specifying the number of entries
in the data table. </p></dd>
<dt>Extra information TLVs</dt>
<dd><p>The extra information TLVs are only present if
and only if the X bit is set in the flags field above. This provides
a way of extending the hint track format without changing the version,
while allowing backward compatibility.</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Extra information TLVs</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Extra information size</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV size</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV type</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV data</p></td>
<td ><p>Padded to 4-byte boundary(int(TLV Size -8 +3) / 4 * 4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV size</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV type</p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV data</p></td>
<td ><p>Padded to 4-byte boundary(int(TLV Size -8 +3) / 4 * 4</p></td>
</tr>
<tr>
<td  scope="row"><p>TLV size and so forth</p></td>
<td ><p>...</p></td>
</tr>

</table></div></dd>
<dt>Extra information size</dt>
<dd><p>A 32-bit number that is the total size of all
extra information TLVs in this packet, including the 4 bytes used
for this field. An empty Extra information TLVs table would just
be the extra information size, having the value 4. (In this case,
it would be more efficient simply to not set the X bit and save
4 bytes just to represent the empty table.) </p></dd>
<dt>TLV size</dt>
<dd><p>A 32-bit number that is the total size of this one TLV
entry, including 4 bytes for the size, 4 bytes for the type, and
any data bytes, but not including padding required to align to the
next 4 byte boundary. </p></dd>
<dt>TLV type</dt>
<dd><p>A 32-bit tag (a four-character <code>OSType</code>)
identifying the TLV. Servers must ignore TLV types that they do
not recognize. Note that TLV types containing all lowercase letters
are reserved by Apple Computer. </p></dd>
<dt>TLV data</dt>
<dd><p>The data for the TLV. </p></dd></dl>
<p>In order to support MPEG (and other data types) whose RTP
timestamp is not monotonically increasing and directly calculated
from the sample timestamp, the following TLV type is defined:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Size</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Type </p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data Description</p></th>
</tr>


<tr>
<td  scope="row"><p>12</p></td>
<td ><p> <code>'rtpo'</code></p></td>
<td ><p>A signed 32-bit integer to be added to the
RTP timestamp, which is derived from the hint sample timestamp.</p></td>
</tr>

</table></div>
<dl class="termdef">	<dt>Data table </dt>
<dd><p>A table that defines the data to be put in the payload
portion of the RTP packet. This table defines various places the
data can be retrieved.</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data table entry</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Bytes</p></th>
</tr>


<tr>
<td  scope="row"><p>Data source</p></td>
<td ><p> 1</p></td>
</tr>
<tr>
<td  scope="row"><p>Data</p></td>
<td ><p>15</p></td>
</tr>

</table></div></dd></dl>
<p>The data source field of the entry table indicates how the
other 15 bytes of the entry are to be interpreted. Values of 0 through
4 are defined. The various data table formats are defined below.</p>
<p>Although there are various schemes, note that the entries
in the various schemes are the same size, 16 bytes long. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-110401" title="No-Op Data Mode"></a><h3>No-Op
Data Mode</h3>
<p>The data table entry has the following format for no-op mode:</p>
<br/><div><img src = "../art/qtff_l_t3.gif" alt = "image: ../art/qtff_l_t3.gif" width="242" height="47"></div><br/>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_64" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Data source = 0</dt>
<dd><p>A value of 0 indicates that this data table entry is
to be ignored.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-110313" title="Immediate Data Mode"></a><h3>Immediate
Data Mode</h3>
<p>The data table entry has the following format for immediate
mode: </p>
<br/><div><img src = "../art/qtff_l_t4.gif" alt = "image: ../art/qtff_l_t4.gif" width="242" height="155"></div><br/>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_65" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Data source = 1 </dt>
<dd><p>A value of 1 indicates that the data is to be
immediately taken from the bytes of data that follow. </p></dd>
<dt>Immediate length </dt>
<dd><p>An 8-bit integer indicating the number of bytes
to take from the data that follows. Legal values range from 0 to
14. </p></dd>
<dt>Immediate data </dt>
<dd><p>14 bytes of data to place into the payload portion of
the packet. Only the first number of bytes indicated by the immediate
length field is used. </p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-110091" title="Sample Mode"></a><h3>Sample
Mode</h3>
<p>The data table entry has the following format for sample mode.</p>
<br/><div><img src = "../art/qtff_l_t5.gif" alt = "image: ../art/qtff_l_t5.gif" width="242" height="155"></div><br/>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_66" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Data source = 2</dt>
<dd><p>A value of 2 indicates that the data is to be taken
from a track’s sample data. </p></dd>
<dt>Track ref index </dt>
<dd><p>A value that indicates which track the sample data will
come from. A value of 0 means that there is exactly one media
track referenced, so use that. Values from 1 to 127 are indexes
into the hint track reference atom entries, indicating which original
media track the sample is to be read from. A value of -1 means the
hint track itself, that is, get the sample from the same track as
the hint sample you are currently parsing. </p></dd>
<dt>Length </dt>
<dd><p>A 16-bit integer specifying the number of bytes in the
sample to copy. </p></dd>
<dt>Sample number </dt>
<dd><p>A 32-bit integer specifying sample number of the track. </p></dd>
<dt>Offset </dt>
<dd><p>A 32-bit integer specifying the offset from the start
of the sample from which to start copying. If you are referencing
samples in the hint track, this will generally points into the Additional
Data area. </p></dd>
<dt>Bytes per compression block </dt>
<dd><p>A 16-bit unsigned integer specifying the number
of bytes that results from compressing the number of samples in
the Samples per compression block field. A value of 0 is equivalent
to a value of 1. </p></dd>
<dt>Samples per compression block </dt>
<dd><p>A 16-bit unsigned integer specifying the uncompressed
samples per compression block. A value of 0 is equivalent to a value
of 1. </p></dd></dl>
<p></p>
<p>If the bytes per compression block and/or the samples per
compression block is greater than 1, than this ratio is used to
translate a sample number into an actual byte offset. </p>
<p>This ratio mode is typically used for compressed audio tracks.
Note that for QuickTime sound tracks, the bytes per compression
block also factors in the number of sound channels in that stream,
so a QuickTime stereo sound stream’s BPCB would be twice that
of a mono stream of the same sound format.</p>
<p>(CB = NS * BPCB / SPCB) </p>
<p>where CB = compressed bytes, NS = number of samples, BPCB
= bytes per compression block, and SPCB = samples per compression
block. </p>
<p>An example:</p>
<p>A GSM compression block is typically 160 samples packed into
33 bytes.</p>
<p>So, BPCB = 33 and SPCB = 160.</p>
<p>The hint sample requests 33 bytes of data starting at the
161st media sample. Assume that the first QuickTime chunk contains
at least 320 samples. So after determining that this data will come
from chunk 1, and knowing where chunk 1 starts, you must use this ratio
to adjust the offset into the file where the requested samples will
be found:</p>
<div class="codesample"><table><tr><td scope="row"><pre>chunk_number = 1; /* calculated by walking the sample-to-chunk atom  */<span></span></pre></td></tr><tr><td scope="row"><pre>first_sample_in_this_chunk = 1; /* also calculated from that atom  */<span></span></pre></td></tr><tr><td scope="row"><pre>chunk_offset = chunk_offsets[chunk_number]; /* from the stco atom  */<span></span></pre></td></tr><tr><td scope="row"><pre>data_offset = (sample_number - first_sample_in_this_chunk) * BPCB  / SPCB;<span></span></pre></td></tr><tr><td scope="row"><pre>read_from_file(chunk_offset + data_offset, length); /* read our  data */<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-109946" title="Sample Description Mode"></a><h3>Sample
Description Mode</h3>
<p>The data table entry has the following format for sample description
mode:</p>
<br/><div><img src = "../art/qtff_l_t6.gif" alt = "image: ../art/qtff_l_t6.gif" width="242" height="169"></div><br/>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_67" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt>Data source = 3 </dt>
<dd><p>A value of 3 indicates that the data is to be taken
from the media track's sample description table. </p></dd>
<dt>Track ref index </dt>
<dd><p>A value that indicates which track the sample description
will come from. A value of 0 means that there is exactly one hint
track reference, so use that. Values from 1 to 127 are indexes into
the hint track reference atom entries, indicating which original
media track the sample is to be read from. A value of -1 means the
hint track itself, that is, get the sample description from the same
track as the hint sample you are currently parsing. </p></dd>
<dt>Length </dt>
<dd><p>A 16-bit integer specifying the number of bytes to copy. </p></dd>
<dt>Sample description index</dt>
<dd><p>A 32-bit integer specifying the index into the
media's sample description table. </p></dd>
<dt>Offset </dt>
<dd><p>A 32-bit integer specifying the offset from the start
of the sample description from which to start copying. </p></dd>
<dt>Reserved </dt>
<dd><p>Four bytes that must be set to 0. </p></dd>
<dt>Additional data </dt>
<dd><p>A variable length field containing data pointed to by
hint track sample mode entries in the data table. </p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69877" title="VR Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCEBCIH" title="VR Media"></a><h2>VR Media</h2>
<p>This section describes the QuickTime <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_646"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_647"></a>VR world and node
information atom containers, which can be obtained by calling the
QuickTime VR Manager routines <code>QTVRGetVRWorld</code> and <code>QTVRGetNodeInfo</code>.
Those routines, as well as a complete discussion of QuickTime VR
and how your application can create <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_648"></a>QuickTime VR movies,
are described in detail in <em><a href="../../InsideQT_QTVR/index.html#//apple_ref/doc/uid/TP40000944" target="_top">QuickTime VR</a></em>. </p>
<p>Many atom types contained in the VR world and node information
atom containers are unique within their container. For example,
each has a single header atom. Most parent atoms within an atom
container are unique as well, such as the node parent atom in the
VR world atom container or the hot spot parent atom in the node
information atom container. For these one-time-only atoms, the atom
ID is always set to 1. Unless otherwise mentioned in the descriptions
of the atoms that follow, assume that the atom ID is 1.</p>
<p>Note that many atom structures contain two version fields, <code>majorVersion</code> and <code>minorVersion</code>.
The values of these fields correspond to the constants <code>kQTVRMajorVersion</code> and <code>kQTVRMinorVersion</code> found
in the header file <code>QuickTimeVRFormat.h</code>.
For QuickTime 2.0 files, these values are 2 and 0.</p>
<p>QuickTime provides a number of routines for both creating
and accessing atom containers. </p>
<p>Some of the leaf atoms within the VR world and node information
atom containers contain fields that specify the ID of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_649"></a>string atoms that are
siblings of the leaf atom. For example, the VR world header atom
contains a field for the name of the scene. The string atom is a
leaf atom whose atom type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_650"></a><code>kQTVRStringAtomType </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_651"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_652"></a><code>'vrsg'</code>)<code>.</code> Its
atom ID is that specified by the referring leaf atom. </p>
<p>A string atom contains a string. The structure of a string
atom is defined by the <code>QTVRStringAtom</code> data
type.</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRStringAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              stringUsage;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              stringLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned char                       theString[4];<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRStringAtom, *QTVRStringAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_68" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>stringUsage</code></dt>
<dd><p>The string usage. This field is unused.</p></dd>
<dt><code>stringLength</code></dt>
<dd><p>The length, in bytes, of the string.</p></dd>
<dt><code>theString</code></dt>
<dd><p>The string. The string atom structure is extended to
hold this string.</p></dd></dl>
<p>Each string atom may also have a sibling leaf atom, called
the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_653"></a>string
encoding atom. The string encoding atom’s atom type is <code>kQTVRStringEncodingAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_654"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_655"></a><code>'vrse'</code>).
Its atom ID is the same as that of the corresponding string atom.
The string encoding atom contains a single variable, <code>TextEncoding</code>,
a <code>UInt32</code>, as defined
in the header file <code>TextCommon.h</code>.
The value of <code>TextEncoding</code> is
handed, along with the string, to the routine <code>QTTextToNativeText</code> for
conversion for display on the current machine. The routine <code>QTTextToNativeText</code> is found
in the header file <code>Movies.h.</code></p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_69" title="Note"></a><p><strong>Note:</strong>&nbsp;The header file <code>TextCommon.h</code> contains
constants and routines for generating and handling text encodings. </p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57980" title="VR World Atom Container"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGBDDJ" title="VR World Atom Container"></a><h3>VR World Atom Container</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_656"></a>VR
world atom container (VR world for short) includes such information
as the name for the entire scene, the default node ID, and default
imaging properties, as well as a list of the nodes contained in
the QTVR track. </p>
<p>A VR world can also contain custom scene information. QuickTime
VR ignores any atom types that it doesn’t recognize, but you can
extract those atoms from the VR world using standard QuickTime atom
functions.</p>
<p>The structure of the VR world atom container is shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69353">Figure 3-16</a></span>. The
component atoms are defined and their structures are shown in the
sections that follow. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69353" title="Figure 3-16Structure of the VR world atom container "></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCDHAF" title="Figure 3-16Structure of the VR world atom container "></a><p><strong>Figure 3-16&nbsp;&nbsp;</strong>Structure of the VR world atom container </p>
<img src = "../art/qtvr_l_10.gif" alt = "Structure of the VR world atom container" width="151" height="386"></div><br/>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57985" title="VR World Header Atom Structure"></a><h4>VR
World Header Atom Structure</h4>
<p>The VR world header atom is a leaf atom. Its atom type is <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_657"></a>kQTVRWorldHeaderAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_658"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_659"></a><code>'vrsc'</code>).
It contains the name of the scene and the default node ID to be
used when the file is first opened as well as fields reserved for
future use. </p>
<p>The structure of a VR world header atom is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_660"></a><code>QTVRWorldHeaderAtom</code> data
type.</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRWorldHeaderAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              defaultNodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              vrWorldFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRWorldHeaderAtom, *QTVRWorldHeaderAtomPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_70" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>nameAtomID</code></dt>
<dd><p>The ID of the string atom that contains the name of
the scene. That atom should be a sibling of the VR world header
atom. The value of this field is 0 if no name string atom exists.</p></dd>
<dt><code>defaultNodeID</code></dt>
<dd><p>The ID of the default node (that is, the node to be
displayed when the file is first opened).</p></dd>
<dt><code>vrWorldFlags</code></dt>
<dd><p>A set of flags for the VR world. This field is unused.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57990" title="Imaging Parent Atom"></a><h4>Imaging
Parent Atom</h4>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_661"></a>imaging
parent atom is the parent atom of one or more node-specific imaging
atoms. Its atom type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_662"></a><code>kQTVRImagingParentAtomType
('imgp').</code> Only panoramas have an imaging atom
defined. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-57996" title="Panorama-Imaging Atom "></a><h4>Panorama-Imaging
Atom </h4>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_663"></a>panorama-imaging
atom describes the default imaging characteristics for all the panoramic
nodes in a scene. This atom overrides QuickTime VR’s own defaults. </p>
<p>The panorama-imaging atom has an atom type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_664"></a><code>kQTVRPanoImagingAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_665"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_666"></a><code>'impn'</code>). Generally,
there is one panorama-imaging atom for each imaging mode, so the
atom ID, while it must be unique for each atom, is ignored. QuickTime
VR iterates through all the panorama-imaging atoms. </p>
<p>The structure of a panorama-imaging atom is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_667"></a><code>QTVRPanoImagingAtom</code> data type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRPanoImagingAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingMode;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              correction;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              quality;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              directDraw;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imagingProperties[6];<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRPanoImagingAtom, *VRPanoImagingAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_71" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>imagingMode</code></dt>
<dd><p>The imaging mode to which the default values apply.
Only <code>kQTVRStatic</code> and <code>kQTVRMotion</code> are
allowed here.</p></dd>
<dt><code>imagingValidFlags</code></dt>
<dd><p>A set of flags that indicate which imaging property
fields in this structure are valid. </p></dd>
<dt><code>correction</code></dt>
<dd><p>The default correction mode for panoramic nodes. This
can be either <code>kQTVRNoCorrection</code>, <code>kQTVRPartialCorrection</code>,
or <code>kQTVRFullCorrection</code>. </p></dd>
<dt><code>quality</code></dt>
<dd><p>The default imaging quality for panoramic nodes. </p></dd>
<dt><code>directDraw</code></dt>
<dd><p>The default direct-drawing property for panoramic nodes.
This can be <code>true</code> or <code>false</code>.</p></dd>
<dt><code>imagingProperties</code></dt>
<dd><p>Reserved for future panorama-imaging properties.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<p>The <code>imagingValidFlags</code> field
in the panorama-imaging atom structure specifies which imaging property
fields in that structure are valid. You can use these bit flags
to specify a value for that field:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidCorrection                        = 1 &lt;&lt; 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidQuality                           = 1 &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidDirectDraw                        = 1 &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidFirstExtraProperty                = 1 &lt;&lt; 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_72" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kQTVRValidCorrection<!--/a--></code></dt>
<dd><p>The default correction mode for panorama-imaging properties. If this bit is set, the <code>correction</code> field
holds a default correction mode.</p></dd>
<dt><code><!--a  -->kQTVRValidQuality<!--/a--></code></dt>
<dd><p>The default imaging quality for panorama-imaging properties. If this bit is set, the <code>quality</code> field
holds a default imaging quality.</p></dd>
<dt><code><!--a  -->kQTVRValidDirectDraw<!--/a--></code></dt>
<dd><p>The default direct-draw quality for panorama-imaging properties. If this bit is set, the <code>directDraw</code> field
holds a default direct-drawing property.</p></dd>
<dt><code><!--a  -->kQTVRValidFirstExtraProperty<!--/a--></code></dt>
<dd><p>The default imaging property for panorama-imaging properties. If this bit is set, the first element in the array
in the <code>imagingProperties</code> field holds
a default imaging property. As new imaging properties are added, they
will be stored in this array. </p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58026" title="Node Parent Atom"></a><h2>Node
Parent Atom</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_668"></a>node
parent atom is the parent of one or more node ID atoms. The atom
type of the node parent atom is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_669"></a><code>kQTVRNodeParentAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_670"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_671"></a><code>'vrnp'</code>)
and the atom type of the each node ID atom is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_672"></a><code>kQTVRNodeIDAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_673"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_674"></a><code>'vrni'</code>). </p>
<p>There is one node ID atom for each node in the file. The atom
ID of the node ID atom is the node ID of the node. The node ID atom
is the parent of the node location atom. The node location atom
is the only child atom defined for the node ID atom. Its atom type
is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_675"></a><code>kQTVRNodeLocationAtomType </code>(<code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_676"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_677"></a>'nloc'</code>)<code>. </code></p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58032" title="Node Location Atom Structure"></a><h2>Node
Location Atom Structure</h2>
<p>The node location atom is the only child atom defined for
the node ID atom. Its atom type is<code> kQTVRNodeLocationAtomType </code>(<code>'nloc'</code>)<code>.</code> A
node location atom describes the type of a node and its location. </p>
<p>The structure of a node location atom is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_678"></a><code>QTVRNodeLocationAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRNodeLocationAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              nodeType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              locationFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              locationData;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRNodeLocationAtom, *QTVRNodeLocationAtomPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_73" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>nodeType</code></dt>
<dd><p>The node type. This field should contain either <code>kQTVRPanoramaType</code> or <code>kQTVRObjectType</code>.</p></dd>
<dt><code>locationFlags</code></dt>
<dd><p>The location flags. This field must contain the value <code>kQTVRSameFile</code>, indicating
that the node is to be found in the current file. In future, these flags
may indicate that the node is in a different file or at some URL
location. </p></dd>
<dt><code>locationData</code></dt>
<dd><p>The location of the node data. When the <code>locationFlags</code> field
is <code>kQTVRSameFile</code>, this
field should be 0. The nodes are found in the file in the same order
that they are found in the node list.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58037" title="Custom Cursor Atoms "></a><h2>Custom
Cursor Atoms </h2>
<p>The hot spot information atom, discussed in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-58066">“Hot Spot Information Atom,”</a></span>
allows you to indicate <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_679"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_680"></a>custom
cursor IDs for particular hot spots that replace the default cursors
used by QuickTime VR. QuickTime VR allows you to store your custom
cursors in the VR world of the movie file. </p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_74" title="Note"></a><p><strong>Note:</strong>&nbsp;If you’re using
the Mac OS, you could store your custom cursors in the resource
fork of the movie file. However, this would not work on any other
platform (such as Windows), so storing cursors in the resource fork
of the movie file is not recommended.</p></div>
<p>The cursor parent atom is the parent of all of the custom
cursor atoms stored in the VR world. Its <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_681"></a>atom
type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_682"></a><code>kQTVRCursorParentAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_683"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_684"></a><code>'vrcp'</code>).
The child atoms of the cursor parent are either cursor atoms or
color cursor atoms. Their atom types are <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_685"></a><code>kQTVRCursorAtomType </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_686"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_687"></a><code>'CURS'</code>)
and <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_688"></a><code>kQTVRColorCursorAtomType </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_689"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_690"></a><code>'crsr'</code>).
These atoms are stored exactly as cursors or color cursors would
be stored as a resource. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58049" title="Node Information Atom Container"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCICFCI" title="Node Information Atom Container"></a><h2>Node Information Atom Container</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_691"></a>node
information atom container includes general information about the
node such as the node’s type, ID, and name. The node information
atom container also contains the list of hot spot atoms for the
node. A QuickTime VR movie contains one node information atom container
for each node in the file. The routine <code>QTVRGetNodeInfo</code> allows
you to obtain the node information atom container for the current
node or for any other node in the movie.</p>
<p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69357">Figure 3-17</a></span> shows the structure of the node information atom
container. </p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69357" title="Figure 3-17Structure of the node information atom container "></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCIIBJD" title="Figure 3-17Structure of the node information atom container "></a><p><strong>Figure 3-17&nbsp;&nbsp;</strong>Structure of the node information
atom container </p><img src = "../art/qtvr_l_11.gif" alt = "Structure of the node information atom container" width="221" height="386"></div><br/>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58055" title="Node Header Atom Structure"></a><h3>Node
Header Atom Structure</h3>
<p>A node header atom is a leaf atom that describes the type
and ID of a node, as well as other information about the node. Its
atom type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_692"></a><code>kQTVRNodeHeaderAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_693"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_694"></a><code>'ndhd'</code>). </p>
<p>The structure of a node header atom is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_695"></a><code>QTVRNodeHeaderAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRNodeHeaderAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              nodeType;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            commentAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRNodeHeaderAtom, *VRNodeHeaderAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_75" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>nodeType</code></dt>
<dd><p>The node type. This field should contain either <code>kQTVRPanoramaType</code> or <code>kQTVRObjectType</code>.</p></dd>
<dt><code>nodeID</code></dt>
<dd><p>The node ID.</p></dd>
<dt><code>nameAtomID</code></dt>
<dd><p>The ID of the string atom that contains the name of
the node. This atom should be a sibling of the node header atom.
The value of this field is 0 if no name string atom exists.</p></dd>
<dt><code>commentAtomID</code></dt>
<dd><p>The ID of the string atom that contains a comment for
the node. This atom should be a sibling of the node header atom.
The value of this field is 0 if no comment string atom exists.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58060" title="Hot Spot Parent Atom"></a><h3>Hot
Spot Parent Atom</h3>
<p>The hot spot parent atom is the parent for all <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_696"></a>hot
spot atoms for the node. The atom type of the hot spot parent atom
is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_697"></a><code>kQTVRHotSpotParentAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_698"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_699"></a><code>'hspa'</code>)
and the atom type of the each hot spot atom is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_700"></a><code>kQTVRHotSpotAtomType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_701"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_702"></a><code>'hots'</code>)<code>.</code> The
atom ID of each hot spot atom is the hot spot ID for the corresponding
hot spot. The hot spot ID is determined by its color index value
as it is stored in the hot spot image track. </p>
<p>The hot spot track is an 8-bit video track that contains color
information that indicates hot spots. For more information, refer
to Programming With QuickTime VR.</p>
<p>Each <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_703"></a>hot
spot atom is the parent of a number of atoms that contain information
about each hot spot.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58066" title="Hot Spot Information Atom "></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCJEAHJ" title="Hot Spot Information Atom "></a><h3>Hot Spot Information Atom </h3>
<p>The hot spot information atom contains general information
about a hot spot. Its atom type is <code>kQTVRHotSpotInfoAtomType</code> (<code>'hsin'</code>).
Every hot spot atom should have a hot spot information atom as a
child. </p>
<p>The structure of a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_704"></a>hot spot information atom
is defined by the <code>QTVRHotSpotInfoAtom</code> data type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRHotSpotInfoAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              hotSpotType;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            nameAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID                            commentAtomID;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32                              cursorID[3];<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             bestFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          bestViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect                                hotSpotRect;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRHotSpotInfoAtom, *QTVRHotSpotInfoAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_76" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>hotSpotType</code></dt>
<dd><p>The hot spot type. This type specifies which other information
atoms—if any—are siblings to this one. QuickTime VR recognizes
three types: <code>kQTVRHotSpotLinkType</code>, <code>kQTVRHotSpotURLType</code>,
and <code>kQTVRHotSpotUndefinedType</code>.</p></dd>
<dt><code>nameAtomID</code></dt>
<dd><p>The ID of the string atom that contains the name of
the hot spot. This atom should be a sibling of the hot spot information
atom. This string is displayed in the QuickTime VR controller bar
when the mouse is moved over the hot spot.</p></dd>
<dt><code>commentAtomID</code></dt>
<dd><p>The ID of the string atom that contains a comment for
the hot spot. This atom should be a sibling of the hot spot information
atom. The value of this field is 0 if no comment string atom exists.</p></dd>
<dt><code>cursorID</code></dt>
<dd><p>An array of three IDs for custom hot spot cursors (that
is, cursors that override the default hot spot cursors provided
by QuickTime VR). The first ID (<code>cursorID[0]</code>)
specifies the cursor that is displayed when it is in the hot spot.
The second ID (<code>cursorID[1]</code>)
specifies the cursor that is displayed when it is in the hot spot
and the mouse button is down. The third ID (<code>cursorID[2]</code>)
specifies the cursor that is displayed when it is in the hot spot and
the mouse button is released. To retain the default cursor for any
of these operations, set the corresponding cursor ID to 0. Custom
cursors should be stored in the VR world atom container, as described
in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-57980">“VR World Atom Container.”</a></span> </p></dd>
<dt><code>bestPan</code></dt>
<dd><p>The best pan angle for viewing this hot spot.</p></dd>
<dt><code>bestTilt</code></dt>
<dd><p>The best tilt angle for viewing this hot spot.</p></dd>
<dt><code>bestFOV</code></dt>
<dd><p>The best field of view for viewing this hot spot.</p></dd>
<dt><code>bestViewCenter</code></dt>
<dd><p>The best view center for viewing this hot spot; applies
only to object nodes.</p></dd>
<dt><code>hotSpotRect</code></dt>
<dd><p>The boundary box for this hot spot, specified as the
number of pixels in full panoramic space. This field is valid only
for panoramic nodes.</p></dd>
<dt><code>flags</code></dt>
<dd><p>A set of hot spot flags. This field is unused.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_77" title="Note"></a><p><strong>Note:</strong>&nbsp;In QuickTime
VR movie files, all angular values are stored as 32-bit floating-point
values that specify degrees. In addition, all floating-point values
conform to the IEEE Standard 754 for binary floating-point arithmetic,
in big-endian format.</p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58078" title="Specific Information Atoms"></a><h3>Specific
Information Atoms</h3>
<p>Depending on the value of the <code>hotSpotType</code> field
in the hot spot info atom there may also be a type specific information
atom. The atom type of the type-specific atom is the hot spot type. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58083" title="Link Hot Spot Atom"></a><h3>Link
Hot Spot Atom</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_705"></a>link
hot spot atom specifies information for hot spots of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_706"></a><code>kQTVRHotSpotLinkType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_707"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_708"></a><code>'link'</code>)<code>.</code> Its
atom type is thus <code>'link'.</code> The
link hot spot atom contains specific information about a link hot
spot. </p>
<p>The structure of a link hot spot atom is defined by the <code>QTVRLinkHotSpotAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRLinkHotSpotAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              toNodeID;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              fromValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fromFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          fromViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              toValidFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             toFOV;<span></span></pre></td></tr><tr><td scope="row"><pre>    FloatPoint                          toViewCenter;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             distance;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRLinkHotSpotAtom, *VRLinkHotSpotAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_78" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>toNodeID</code></dt>
<dd><p>The ID of the destination node (that is, the node to
which this hot spot is linked).</p></dd>
<dt><code>fromValidFlags</code></dt>
<dd><p>A set of flags that indicate which source node view
settings are valid. </p></dd>
<dt><code>fromPan</code></dt>
<dd><p>The preferred from-pan angle at the source node (that
is, the node containing the hot spot).</p></dd>
<dt><code>fromTilt</code></dt>
<dd><p>The preferred from-tilt angle at the source node.</p></dd>
<dt><code>fromFOV</code></dt>
<dd><p>The preferred from-field of view at the source node.</p></dd>
<dt><code>fromViewCenter</code></dt>
<dd><p>The preferred from-view center at the source node.</p></dd>
<dt><code>toValidFlags</code></dt>
<dd><p>A set of flags that indicate which destination node
view settings are valid. </p></dd>
<dt><code>toPan</code></dt>
<dd><p>The pan angle to use when displaying the destination
node.</p></dd>
<dt><code>toTilt</code></dt>
<dd><p>The tilt angle to use when displaying the destination
node.</p></dd>
<dt><code>toFOV</code></dt>
<dd><p>The field of view to use when displaying the destination
node.</p></dd>
<dt><code>toViewCenter</code></dt>
<dd><p>The view center to use when displaying the destination
node.</p></dd>
<dt><code>distance</code></dt>
<dd><p>The distance between the source node and the destination
node.</p></dd>
<dt><code>flags</code></dt>
<dd><p>A set of link hot spot flags. This field is unused and
should be set to 0.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd></dl>
<p>Certain fields in the link hot spot atom are not used by QuickTime
VR. The <code>fromValidFlags</code> field
is generally set to 0 and the other <code>from</code> fields
are not used. However, these fields could be quite useful if you
have created a transition movie from one node to another. The <code>from</code> angles
can be used to swing the current view of the source node to align
with the first frame of the transition movie. The <code>distance</code> field
is intended for use with 3D applications, but is also not used by
QuickTime VR.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58089" title="Link Hot Spot Valid Flags"></a><h4>Link
Hot Spot Valid Flags</h4>
<p>The <code>toValidFlags</code> field
in the link hot spot atom structure specifies which view settings
are to be used when moving to a destination node from a hot spot.
You can use these bit flags to specify a value for that field:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidPan                               = 1 &lt;&lt; 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidTilt                              = 1 &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidFOV                               = 1 &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRValidViewCenter                        = 1 &lt;&lt; 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_79" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kQTVRValidPan<!--/a--></code></dt>
<dd><p>The setting for using the destination pan angle.</p></dd>
<dt><code><!--a  -->kQTVRValidTilt<!--/a--></code></dt>
<dd><p>The setting for using the destination tilt angle.</p></dd>
<dt><code><!--a  -->kQTVRValidFOV<!--/a--></code></dt>
<dd><p>The setting for using the destination field of view.</p></dd>
<dt><code><!--a  -->kQTVRValidViewCenter<!--/a--></code></dt>
<dd><p>The setting for using the destination view center.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-88659" title="URL Hot Spot Atom"></a><h2>URL
Hot Spot Atom</h2>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_709"></a>URL
hot spot atom has an atom type of <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_710"></a><code>kQTVRHotSpotURLType</code> (<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_711"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_712"></a><code>'url
'</code>). The URL hot spot atom contains a URL string
for a particular Web location (for example, <code>http://quicktimevr.apple.com</code>).
QuickTime VR automatically links to this URL when the hot spot is
clicked. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58124" title="Support for Wired Actions"></a><h2>Support
for Wired Actions</h2>
<p>Certain actions on a QuickTime VR movie can trigger wired
actions if the appropriate event handler atoms have been added to
the file. This section discusses what atoms must be included in
the QuickTime VR file to support <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_713"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_714"></a>wired
actions.</p>
<p>As with sprite tracks, the presence of a certain atom in the
media property atom container of the QTVR track enables the handling
of wired actions. This atom is of type <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_715"></a><code>kSpriteTrackPropertyHasActions</code>,
which has a single Boolean value that must be set to <code>true</code>.</p>
<p>When certain events occur and the appropriate event handler
atom is found in the QTVR file, then that atom is passed to QuickTime
to perform any actions specified in the atom. The event handler
atoms themselves must be added to the node information atom container
in the QTVR track. There are two types of event handlers for QTVR
nodes: global and hot spot specific. The currently supported global
event handlers are <code>kQTEventFrameLoaded</code> and <code>kQTEventIdle</code>.
The event handler atoms for these are located at the root level
of the node information atom container. A global event handler atom’s
type is set to the event type and its ID is set to 1.</p>
<p>Hot spot–specific event handler atoms are located in the
specific hot spot atom as a sibling to the hot spot info atom. For
these atoms, the atom type is always <code>kQTEventType</code> and
the ID is the <code>event</code> type.
Supported hot spot–specific event types are <code>kQTEventMouseClick</code>, <code>kQTEventMouseClickEnd</code>, <code>kQTEventMouseClickEndTriggerButton</code>,
and <code>kQTEventMouseEnter</code>, <code>kQTEventMouseExit</code>.</p>
<p>The specific actions that cause these events to be generated
are described as follows:</p>
<dl class="termdef">	<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_716"></a><code>kQTEventFrameLoaded </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_717"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_718"></a><code>'fram'</code>)</dt>
<dd><p>A wired action that is generated when a node is entered, before any application-installed entering-node
procedure is called (this event processing is considered part of
the node setup that occurs before the application’s routine is
called).</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_719"></a><code>kQTEventIdle </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_720"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_721"></a><code>'idle'</code>)</dt>
<dd><p>A wired action that is generated every n ticks, where n is defined by
the contents of the <code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_722"></a>kSpriteTrackPropertyQTIdleEventsFrequency</code> atom
(<code>SInt32</code>) in the media property
atom container. When appropriate, this event is triggered before any
normal idle processing occurs for the QuickTime VR movie.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_723"></a><code>kQTEventMouseClick </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_724"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_725"></a><code>'clik'</code>)</dt>
<dd><p>A wired action that is generated when the mouse goes down over a hot
spot.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_726"></a><code>kQTEventMouseClickEnd </code>(<code>'cend'</code>)</dt>
<dd><p>A wired action that is generated when the mouse goes up after a <code>kQTEventMouseClick</code> is generated,
regardless of whether the mouse is still over the hot spot originally
clicked. This event occurs prior to QuickTime VR’s normal mouse-up
processing.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_727"></a><code>kQTEventMouseClickEndTriggerButton </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_728"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_729"></a><code>'trig'</code>)</dt>
<dd><p>A wired action that is generated when a click end triggers a hot spot
(using the same criterion as used by QuickTime VR in 2.1 for link/url
hot spot execution). This event occurs prior to QuickTime 
VR’s normal hot spot–trigger processing.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_730"></a><code>kQTEventMouseEnter </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_731"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_732"></a><code>'entr'</code>)<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_733"></a><code>,
kQTEventMouseExit </code>(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_734"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_735"></a><code>'exit'</code>)</dt>
<dd><p>Wired action that are generated when the mouse
rolls into or out of a hot spot, respectively. These events occur
whether or not the mouse is down and whether or not the movie is
being panned. These events occur after any application-installed <code>MouseOverHotSpotProc</code> is
called, and will be cancelled if the return value from the application’s
routine indicates that QuickTimeVR’s normal over–hot spot processing
should not take place.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58130" title="QuickTime VR File Format"></a><h2>QuickTime
VR File Format</h2>
<p>A QuickTime VR movie is stored on disk in a format known as
the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_736"></a>QuickTime
VR file format. Beginning in QuickTime VR 2.0, a QuickTime VR movie
could contain one or more nodes. Each node is either a panorama
or an object. In addition, a QuickTime VR movie could contain various
types of hot spots, including links between any two types of nodes.</p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_80" title="Important:"></a><p><strong>Important:</strong>&nbsp;
This section describes the file format supported by
version 2.1 of the QuickTime VR Manager. </p><p></p></div>
<p>All QuickTime VR movies contain a single <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_737"></a>QTVR track, a special type of QuickTime
track that maintains a list of the nodes in the movie. Each individual
sample in a QTVR track contains general information and hot spot
information for a particular node. </p>
<p>If a QuickTime VR movie contains any panoramic nodes, that
movie also contains a single <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_738"></a>panorama track, and if it contains
any object nodes, it also contains a single <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_739"></a>object track. The panorama and object
tracks contain information specific to the panoramas or objects in
the movie. The actual image data for both panoramas and objects
is usually stored in standard QuickTime video tracks, hereafter
referred to as <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_740"></a>image
tracks. (An image track can also be any type of track that is capable
of displaying an image, such as a QuickTime 3D track.) The individual
frames in the image track for a panorama make up the diced frames
of the original single panoramic image. The frames for the image
track of an object represent the many different views of the object.
Hot spot image data is stored in parallel video tracks for both
panoramas and objects.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58144" title="Single-Node Panoramic Movies"></a><h3>Single-Node
Panoramic Movies</h3>
<p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69361">Figure 3-18</a></span> illustrates the basic structure of a single-node
panoramic movie. As you can see, every panoramic movie contains
at least three tracks: a QTVR track, a panorama track, and a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_741"></a>panorama image
track.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69361" title="Figure 3-18The structure of a single-node panoramic movie file"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCGFIAC" title="Figure 3-18The structure of a single-node panoramic movie file"></a><p><strong>Figure 3-18&nbsp;&nbsp;</strong>The structure of a single-node panoramic
movie file</p><img src = "../art/qtvr_l_08.gif" alt = "The structure of a single-node panoramic movie file" width="521" height="120"></div><br/>
<p>For a single-node panoramic movie, the QTVR track contains
just one sample. There is a corresponding sample in the panorama
track, whose time and duration are the same as the time and duration
of the sample in the QTVR track. The time base of the movie is used
to locate the proper video samples in the panorama image track.
For a panoramic movie, the video sample for the first diced frame
of a node’s panoramic image is located at the same time as the
corresponding QTVR and panorama track samples. The total duration
of all the video samples is the same as the duration of the corresponding
QTVR sample and the panorama sample.</p>
<p>A panoramic movie can contain an optional hot spot image track
and any number of standard QuickTime tracks. A panoramic movie can
also contain panoramic image tracks with a lower resolution. The
video samples in these low-resolution image tracks must be located
at the same time and must have the same total duration as the QTVR
track. Likewise, the video samples for a hot spot image track, if
one exists, must be located at the same time and must have the same
total duration as the QTVR track.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58149" title="Single-Node Object Movies"></a><h3>Single-Node
Object Movies</h3>
<p><span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69365">Figure 3-19</a></span> illustrates the basic structure of a single-node
object movie. As you can see, every object movie contains at least
three tracks: a QTVR track, an object track, and an object image
track.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69365" title="Figure 3-19The structure of a single-node object movie file"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCBCDEH" title="Figure 3-19The structure of a single-node object movie file"></a><p><strong>Figure 3-19&nbsp;&nbsp;</strong>The structure of a single-node object
movie file</p><img src = "../art/qtvr_l_07.gif" alt = "The structure of a single-node object movie file" width="506" height="120"></div><br/>
<p>For a single-node object movie, the QTVR track contains just
one sample. There is a corresponding sample in the object track,
whose time and duration are the same as the time and duration of
the sample in the QTVR track. The time base of the movie is used
to locate the proper video samples in the object image track.</p>
<p>For an object movie, the frame corresponding to the first
row and column in the object image array is located at the same
time as the corresponding QTVR and object track samples. The total
duration of all the video samples is the same as the duration of
the corresponding QTVR sample and the object sample.</p>
<p>In addition to these three required tracks, an object movie
can also contain a hot spot image track and any number of standard
QuickTime tracks (such as video, sound, and text tracks). A hot
spot image track for an object is a QuickTime video track that contains images
of colored regions delineating the hot spots; an image in the hot
spot image track must be synchronized to match the appropriate image
in the object image track. A hot spot image track should be 8 bits
deep and can be compressed with any lossless compressor (including
temporal compressors). This is also true of panoramas. </p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_81" title="Note"></a><p><strong>Note:</strong>&nbsp;To assign a single
fixed-position hot spot to all views of an object, you should create
a hot spot image track that consists of a single video frame whose
duration is the entire node time.</p></div>
<p>To play a time-based track with the object movie, you must
synchronize the sample data of that track to the start and stop
times of a view in the object image track. For example, to play
a different sound with each view of an object, you might store a
sound track in the movie file with each set of sound samples synchronized
to play at the same time as the corresponding object’s view image.
(This technique also works for video samples.) Another way to add
sound or video is simply to play a sound or video track during the object’s
view animation; to do this, you need to add an active track to the
object that is equal in duration to the object’s row duration.</p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_82" title="Important:"></a><p><strong>Important:</strong>&nbsp;
In a QuickTime VR movie file, the panorama image tracks
and panorama hot spot tracks must be disabled. For an object, the
object image tracks must be enabled and the object hot spot tracks must
be disabled.</p><p></p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58166" title="Multinode Movies"></a><h3>Multinode
Movies</h3>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_742"></a>multinode
QuickTime VR movie can contain any number of object and panoramic <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_743"></a>nodes. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69369">Figure 3-20</a></span> illustrates the structure
of a QuickTime VR movie that contains five nodes (in this case,
three panoramic nodes and two object nodes).</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69369" title="Figure 3-20The structure of a multinode movie file"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCAIBJ" title="Figure 3-20The structure of a multinode movie file"></a><p><strong>Figure 3-20&nbsp;&nbsp;</strong>The structure of a multinode movie
file</p><img src = "../art/qtvr_l_09.gif" alt = "The structure of a multinode movie file" width="511" height="228"></div><br/>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_83" title="Important:"></a><p><strong>Important:</strong>&nbsp;
Panoramic tracks and object tracks must never be located
at the same time.</p><p></p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58176" title="QTVR Track "></a><h2>QTVR
Track </h2>
<p>A QTVR track is a special type of QuickTime track that maintains
a list of all the nodes in a movie. The media type for a QTVR track
is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_744"></a><code>'qtvr'</code>.
All the media samples in a QTVR track share a common sample description.
This sample description contains the VR world atom container. The
track contains one media sample for each node in the movie. Each QuickTime
VR media sample contains a node information atom container. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58181" title="QuickTime VR Sample Description Structure"></a><h3>QuickTime
VR Sample Description Structure</h3>
<p>Whereas the QuickTime VR media sample is simply the node information
itself, all sample descriptions are required by QuickTime to have
a certain structure for the first several bytes. The structure for
the QuickTime VR sample description is as follows: </p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRSampleDescription {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              size;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              type;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              dataRefIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              data;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRSampleDescription, *QTVRSampleDescriptionPtr, **QTVRSampleDescriptionHandle;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_84" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>size</code></dt>
<dd><p>The size, in bytes, of the sample description header
structure, including the VR world atom container contained in the <code>data</code> field.</p></dd>
<dt><code>type</code></dt>
<dd><p>The sample description type. For QuickTime VR movies,
this type should be <code>'qtvr'</code>.</p></dd>
<dt><code>reserved1</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>dataRefIndex</code></dt>
<dd><p>Reserved. This field must be 0.</p></dd>
<dt><code>data</code></dt>
<dd><p>The VR world atom container. The sample description
structure is extended to hold this atom container.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58187" title="Panorama Tracks "></a><h2>Panorama
Tracks </h2><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_745"></a>
<p>A movie’s panorama track is a track that contains information
about the panoramic nodes in a scene. The media type of the panorama
track is <code>'pano'</code>. Each
sample in a panorama track corresponds to a single panoramic node.
This sample parallels the corresponding sample in the QTVR track.
Panorama tracks do not have a sample description (although QuickTime
requires that you specify a dummy sample description when you call <code>AddMediaSample</code> to
add a sample to a panorama track). The sample itself contains an
atom container that includes a panorama sample atom and other optional
atoms. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58194" title="Panorama Sample Atom Structure"></a><h3>Panorama
Sample Atom Structure</h3>
<p>A panorama sample atom has an atom type of <code>kQTVRPanoSampleDataAtomType</code> (<code>'pdat'</code>).
It describes a single panorama, including track reference indexes
of the scene and hot spot tracks and information about the default
viewing angles and the source panoramic image. </p>
<p>The structure of a panorama sample atom is defined by the <code>QTVRPanoSampleAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRPanoSampleAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageRefTrackIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotRefTrackIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageSizeX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              imageSizeY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              imageNumFramesX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              imageNumFramesY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotSizeX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              hotSpotSizeY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              hotSpotNumFramesX;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              hotSpotNumFramesY;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              flags;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                              panoType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRPanoSampleAtom, *VRPanoSampleAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_85" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>imageRefTrackIndex</code></dt>
<dd><p>The index of the image track reference. This is the
index returned by the <code>AddTrackReference</code> function
when the image track is added as a reference to the panorama track.
There can be more than one image track for a given panorama track
and hence multiple references. (A panorama track might have multiple
image tracks if the panoramas have different characteristics, which
could occur if the panoramas were shot with different size camera lenses.)
The value in this field is 0 if there is no corresponding image
track.</p></dd>
<dt><code>hotSpotRefTrackIndex</code></dt>
<dd><p><code>
</code>The index of the hot spot track reference.</p></dd>
<dt><code>minPan</code></dt>
<dd><p>The minimum pan angle, in degrees. For a full panorama,
the value of this field is usually 0.0.</p></dd>
<dt><code>maxPan</code></dt>
<dd><p>The maximum pan angle, in degrees. For a full panorama,
the value of this field is usually 360.0.</p></dd>
<dt><code>minTilt</code></dt>
<dd><p>The minimum tilt angle, in degrees. For a high-resolution
panorama, a typical value for this field is –42.5.</p></dd>
<dt><code>maxTilt</code></dt>
<dd><p>The maximum tilt angle, in degrees. For a high-resolution
panorama, a typical value for this field is +42.5.</p></dd>
<dt><code>minFieldOfView</code></dt>
<dd><p>The minimum vertical field of view, in degrees. For
a high-resolution panorama, a typical value for this field is 5.0.
The value in this field is 0 for the default minimum field of view,
which is 5 percent of the maximum field of view. </p></dd>
<dt><code>maxFieldOfView</code></dt>
<dd><p>The maximum vertical field of view, in degrees. For
a high-resolution panorama, a typical value for this field is 85.0.
The value in this field is 0 for the default maximum field of view,
which is <code>maxTilt</code> – <code>minTilt.</code></p></dd>
<dt><code>defaultPan</code></dt>
<dd><p>The default pan angle, in degrees.</p></dd>
<dt><code>defaultTilt</code></dt>
<dd><p>The default tilt angle, in degrees.</p></dd>
<dt><code>defaultFieldOfView</code></dt>
<dd><p>The default vertical field of view, in degrees.</p></dd>
<dt><code>imageSizeX</code></dt>
<dd><p>The width, in pixels, of the panorama stored in the
highest resolution image track.</p></dd>
<dt><code>imageSizeY</code></dt>
<dd><p>The height, in pixels, of the panorama stored in the
highest resolution image track. </p></dd>
<dt><code>imageNumFramesX</code></dt>
<dd><p>The number of frames into which the panoramic image
is diced horizontally. The width of each frame (which is <code>imageSizeX</code>/<code>imageNumFramesX</code>)
should be divisible by 4.</p></dd>
<dt><code>imageNumFramesY</code></dt>
<dd><p>The number of frames into which the panoramic image
is diced vertically. The height of each frame (which is <code>imageSizeY</code>/<code>imageNumFramesY</code>)
should be divisible by 4. </p></dd>
<dt><code>hotSpotSizeX</code></dt>
<dd><p>The width, in pixels, of the panorama stored in the
highest resolution hot spot image track.</p></dd>
<dt><code>hotSpotSizeY</code></dt>
<dd><p>The height, in pixels, of the panorama stored in the
highest resolution hot spot image track.</p></dd>
<dt><code>hotSpotNumFramesX</code></dt>
<dd><p>The number of frames into which the panoramic image
is diced horizontally for the hot spot image track. </p></dd>
<dt><code>hotSpotNumFramesY</code></dt>
<dd><p>The number of frames into which the panoramic image
is diced vertically for the hot spot image track. </p></dd>
<dt><code>flags</code></dt>
<dd><p>A set of panorama flags. <code>kQTVRPanoFlagHorizontal</code> has
been superseded by the <code>panoType</code> field.
It is only used when the <code>panoType</code> field
is <code>nil</code> to indicate a
horizontally-oriented cylindrical panorama. <code>kQTVRPanoFlagAlwaysWrap</code> is set
if the panorama should wrap horizontally, regardless of whether
or not the pan range is 360 degrees. Note that these flags are currently
supported only under Mac OS X. </p></dd>
<dt><code>panoType</code></dt>
<dd><p>An <code>OSType</code> describing
the type of panorama. Types supported are </p><p><code> 
  kQTVRHorizontalCylinder</code> </p><p>  
     <code>kQTVRVerticalCylinder</code> </p><p> 
      <code>kQTVRCube</code></p></dd>
<dt><code>reserved2</code></dt>
<dd><p>Reserved. This field must be 0.</p><div class="importantboxdef"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_86" title="Important:"></a><p><strong>Important:</strong>&nbsp;
A new flag has been added to the flags field of the <code>QTVRPanoSampleAtom</code> data structure.
This flag controls how panoramas wrap horizontally. If <code>kQTVRPanoFlagAlwaysWrap</code> is
set, then the panorama wraps horizontally, regardless of the number
of degrees in the panorama. If the flag is not set, then the panorama
wraps only when the panorama range is 360 degrees. This is the default behavior. </p><p></p></div></dd></dl>
<p>The minimum and maximum values in the panorama sample atom
describe the physical limits of the panoramic image. QuickTime VR
allows you to set further constraints on what portion of the image
a user can see by calling the <code>QTVRSetConstraints</code> routine.
You can also preset image constraints by adding constraint atoms
to the panorama sample atom container. The three constraint atom
types are <code>kQTVRPanConstraintAtomType</code>, <code>kQTVRTiltConstraintAtomType</code>,
and <code>kQTVRFOVConstraintAtomType</code>.
Each of these atom types share a common structure defined by the <code>QTVRAngleRangeAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRAngleRangeAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minimumAngle;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maximumAngle;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRAngleRangeAtom, *QTVRAngleRangeAtomPtr;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_87" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>minimumAngle</code></dt>
<dd><p>The minimum angle in the range, in degrees.</p></dd>
<dt><code>maximumAngle</code></dt>
<dd><p>The maximum angle in the range, in degrees.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58209" title="Panorama Image Track"></a><h3>Panorama
Image Track</h3>
<p>The actual panoramic image for a panoramic node is contained
in a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_746"></a>panorama
image track, which is a standard QuickTime video track. The track
reference to this track is stored in the <code>imageRefTrackIndex</code> field
of the panorama sample atom.</p>
<p>QuickTime VR 2.1 required the original panoramic image to
be rotated 90 degrees counterclockwise. This orientation has changed
in QuickTime VR 2.2, however, as discussed later in this section.</p>
<p>The rotated image is diced into smaller frames, and each diced
frame is then compressed and added to the video track as a video
sample, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69373">Figure 3-21</a></span>. Frames can be compressed using any spatial compressor;
however, temporal compression is not allowed for panoramic image
tracks.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69373" title="Figure 3-21Creating an image track for a panorama"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCJCBDC" title="Figure 3-21Creating an image track for a panorama"></a><p><strong>Figure 3-21&nbsp;&nbsp;</strong>Creating an image track for a panorama</p>
<img src = "../art/qtvr_ls_05.gif" alt = "Creating an image track for a panorama" width="323" height="441"></div><br/>
<p>QuickTime VR 2.2 does not require the original panoramic image
to be rotated 90 degrees counterclockwise, as was the case in QuickTime
VR 2.1. The rotated image is still diced into smaller frames, and
each diced frame is then compressed and added to the video track as
a video sample, as shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69377">Figure 3-22</a></span>.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69377" title="Figure 3-22Creating an image track for a panorama, with the image track oriented horizontally"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCHFEIA" title="Figure 3-22Creating an image track for a panorama, with the image track oriented horizontally"></a><p><strong>Figure 3-22&nbsp;&nbsp;</strong>Creating an image track for a panorama,
with the image track oriented horizontally</p><img src = "../art/qt_l_214.gif" alt = "Creating an image track for a panorama, with the image track oriented horizontally" width="478" height="405"></div><br/>
<p>In QuickTime 3.0, a panorama sample atom (which contains information
about a single panorama) contains the <code>panoType</code> field,
which indicates whether the diced panoramic image is oriented horizontally
or vertically.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58215" title="Cylindrical Panoramas"></a><h3>Cylindrical
Panoramas</h3>
<p>The primary change to <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_747"></a>cylindrical panoramas in QuickTime
VR 2.2 is that the panorama, as stored in the image track of the
movie, can be oriented horizontally. This means that the panorama
does not need to be rotated 90 degrees counterclockwise, as required previously. </p>
<p>To indicate a horizontal orientation, the field in the <code>VRPanoSampleAtom</code> data
structure formerly called <code>reserved1</code> has
been renamed <code>panoType</code>.
Its type is <code>OSType</code>. The <code>panoType</code> field value for a
horizontally oriented cylinder is <code>kQTVRHorizontalCylinder</code> (<code>'hcyl'</code>),
while a vertical cylinder is <code>kQTVRVerticalCylinder</code> (<code>'vcyl'</code>).
For compatibility with older QuickTime VR files, when the <code>panoType</code> field
is <code>nil</code>, then a cylinder
is assumed, with the low order bit of the flags field set to 1 to
indicate if the cylinder is horizontal and 0 if the cylinder is
vertical.</p>
<p>One consequence of reorienting the panorama horizontally is
that, when the panorama is divided into separate tiles, the order
of the samples in the file is now the reverse of what it was for
vertical cylinders. Since vertical cylinders were rotated 90 degrees counterclockwise,
the first tile added to the image track was the rightmost tile
in the panorama. For unrotated horizontal cylinders, the first tile
added to the image track is the left-most tile in the panorama.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58221" title="Cubic Panoramas "></a><h2>Cubic
Panoramas </h2>
<p>A new type of panorama was introduced in the current version
of QuickTime: the cubic panorama. This panorama in its simplest
form is represented by six faces of a cube, thus enabling the viewer
to see all the way up and all the way down. The file format and
the cubic rendering engine actually allow for more complicated representations,
such as special types of cubes with elongated sides or cube faces
made up of separate tiles. Atoms that describe the orientation of
each face allow for these nonstandard representations. If these
atoms are not present, then the simplest representation is assumed.
The following describes this simplest representation: a cube with
six square sides.</p>
<p>Tracks in a cubic movie are laid out as they are for cylindrical <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_748"></a>panoramas. This includes
a QTVR track, a panorama track, and an image track. Optionally,
there may also be a hot spot track and a fast-start preview track.
The image, hot spot, and preview tracks are all standard QuickTime
video tracks. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58227" title="Image Tracks in Cubic Nodes"></a><h3>Image
Tracks in Cubic Nodes</h3>
<p>For a cubic node the image track contains six samples that
correspond to the six square faces of the cube. The same applies
to hot spot and preview tracks. The following diagram shows how
the order of samples in the track corresponds to the orientation
of the cube faces:</p>
<br/><div><img src = "../art/qt_l_217.gif" alt = "image: ../art/qt_l_217.gif" width="472" height="54"></div><br/>
<br/><div><img src = "../art/qt_l_218.gif" alt = "image: ../art/qt_l_218.gif" width="165" height="143"></div><br/>
<p>Note that the frames are oriented horizontally. There is no
provision for frames that are rotated 90 counterclockwise as there
are for cylindrical panoramas.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58233" title="Panorama Tracks in Cubic Nodes"></a><h2>Panorama
Tracks in Cubic Nodes</h2>
<p>The media sample for a panorama track contains the pano sample
atom container. For cubes, some of the fields in the pano sample
data atom have special values, which provide compatibility back
to QuickTime VR 2.2. The cubic projection engine ignores these fields. They
allow one to view cubic movies in older versions of QuickTime VR
using the cylindrical engine, although the view will be somewhat
incorrect, and the top and bottom faces will not be visible. The
special values are shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-88990">Table 3-15</a></span>.</p><a name="//apple_ref/doc/uid/TP40000939-CH205-88990" title="Table 3-15Fields and their special values as represented in the pano sample data atom, providing backward compatibility to QuickTime VR 2.2"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF109" title="Table 3-15Fields and their special values as represented in the pano sample data atom, providing backward compatibility to QuickTime VR 2.2"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-15&nbsp;&nbsp;</strong>Fields and their special values as
represented in the pano sample data atom, providing backward compatibility
to QuickTime VR 2.2</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
</tr>


<tr>
<td  scope="row"><p><code>imageNumFramesX </code></p></td>
<td ><p>4</p></td>
</tr>
<tr>
<td  scope="row"><p><code>imageNumFramesY</code></p></td>
<td ><p>1</p></td>
</tr>
<tr>
<td  scope="row"><p><code>imageSizeX</code></p></td>
<td ><p>Frame width * 4</p></td>
</tr>
<tr>
<td  scope="row"><p><code>imageSizeY</code></p></td>
<td ><p>Frame height</p></td>
</tr>
<tr>
<td  scope="row"><p><code>minPan</code></p></td>
<td ><p>0.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxPan</code></p></td>
<td ><p>360.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>minTilt</code></p></td>
<td ><p>-45.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxTilt</code></p></td>
<td ><p>45.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>minFieldOfView</code></p></td>
<td ><p>5.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxFieldOfView</code></p></td>
<td ><p>90.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>flags</code></p></td>
<td ><p>1</p></td>
</tr>

</table></div>
<p>A 1 value in the flags field tells QuickTime VR 2.2 that the
frames are not rotated. QuickTime VR 2.2 treats this as a four-frame
horizontal cylinder. The <code>panoType</code> field (formerly <code>reserved1</code>)
must be set to <code>kQTVRCube </code>(<code>'cube'</code>)
so that QuickTime VR 3.0 can recognize this panorama as a cube.</p>
<p>Since certain viewing fields in the pano sample data atom
are being used for backward compatibility, a new atom must be added
to indicate the proper viewing parameters for the cubic image. This
atom is the cubic view atom (atom type <code>'cuvw'</code>).
The data structure of the cubic view atom is as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct QTVRCubicViewAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         maxFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTVRCubicViewAtom    QTVRCubicViewAtom;<span></span></pre></td></tr></table></div>
<p>The fields are filled in as desired for the cubic image. This
atom is ignored by older versions of QuickTime VR. Typical
minimum and maximum field values 
are shown in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-89207">Table 3-16</a></span>. </p><a name="//apple_ref/doc/uid/TP40000939-CH205-89207" title="Table 3-16Values for min and max fields "></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF110" title="Table 3-16Values for min and max fields "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-16&nbsp;&nbsp;</strong>Values for min and max fields </caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
</tr>


<tr>
<td  scope="row"><p><code>minPan </code></p></td>
<td ><p>0.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxPan</code></p></td>
<td ><p>360.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>minTilt </code></p></td>
<td ><p>-90.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxTilt</code></p></td>
<td ><p>90.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>minFieldOfView </code></p></td>
<td ><p>5.0</p></td>
</tr>
<tr>
<td  scope="row"><p><code>maxFieldOfView</code></p></td>
<td ><p>120.0</p></td>
</tr>

</table></div>
<p>You add the cubic view atom to the pano sample atom container
(after adding the pano sample data atom). Then use <code>AddMediaSample</code> to
add the atom container to the panorama track.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58239" title="Nonstandard Cubes"></a><h2>Nonstandard
Cubes</h2>
<p>Although the default representation for a cubic panorama is
that of six square faces of a cube, it is possible to depart from
this standard representation. When doing so, a new atom must be
added to the pano sample atom container. The atom type is <code>'cufa'</code>.
The atom is an array of data structures of type <code>QTVRCubicFaceData</code>.
Each entry in the array describes one face of whatever polyhedron
is being defined. <code>QTVRCubicFaceData</code> is
defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct QTVRCubicFaceData {<span></span></pre></td></tr><tr><td scope="row"><pre>    float   orientation[4];<span></span></pre></td></tr><tr><td scope="row"><pre>    float   center[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    float   aspect;<span></span></pre></td></tr><tr><td scope="row"><pre>    float   skew;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTVRCubicFaceData    QTVRCubicFaceData;<span></span></pre></td></tr></table></div>
<p>The mathematical explanation of these data structures is beyond
the scope of this document but will be described in a separate Apple
Technote. <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-89442">Table 3-17</a></span> shows what values QuickTime VR uses for the default
representation of six square sides. </p><a name="//apple_ref/doc/uid/TP40000939-CH205-89442" title="Table 3-17Values used for representing six square sides"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-TPXREF111" title="Table 3-17Values used for representing six square sides"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 3-17&nbsp;&nbsp;</strong>Values used for representing six square
sides</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Orientation</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Orientation</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Orientation</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Orientation</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Center</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Center</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Aspect</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Skew</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Side</p></th>
</tr>


<tr>
<td  scope="row"><p>1</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># front</p></td>
</tr>
<tr>
<td  scope="row"><p>–.5</p></td>
<td ><p>0</p></td>
<td ><p>.5</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># right</p></td>
</tr>
<tr>
<td  scope="row"><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># back</p></td>
</tr>
<tr>
<td  scope="row"><p>.5</p></td>
<td ><p>0</p></td>
<td ><p>.5</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># left</p></td>
</tr>
<tr>
<td  scope="row"><p>.5</p></td>
<td ><p>.5</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># top</p></td>
</tr>
<tr>
<td  scope="row"><p>–.5</p></td>
<td ><p>.5</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>0</p></td>
<td ><p>1</p></td>
<td ><p>0</p></td>
<td ><p># bottom</p></td>
</tr>

</table></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58245" title="Hot Spot Image Tracks"></a><h2>Hot
Spot Image Tracks</h2>
<p>When a panorama contains hot spots, the movie file contains
a <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_749"></a>hot spot
image track, a video track that contains a parallel panorama, with
the hot spots designated by colored regions. Each diced frame of
the hot spot panoramic image must be compressed with a lossless
compressor (such as QuickTime’s graphics compressor). The dimensions
of the hot spot panoramic image are usually the same as those of
the image track’s panoramic image, but this is not required. The
dimensions must, however, have the same aspect ratio as the image
track’s panoramic image. A hot spot image track should be 8 bits
deep. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58250" title="Low-Resolution Image Tracks"></a><h3>Low-Resolution
Image Tracks</h3>
<p>It’s possible to store one or more low-resolution versions
of a panoramic image in a movie file; those versions are called
low-resolution <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_750"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_751"></a>image
tracks. If there is not enough memory at runtime to use the normal
image track, QuickTime VR uses a lower resolution image track if
one is available. A low-resolution image track contains diced frames
just like the higher resolution track, but the reconstructed panoramic
image is half the height and half the width of the higher resolution
image. </p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_88" title="Important:"></a><p><strong>Important:</strong>&nbsp;
The panoramic images in the lower resolution image
tracks and the hot spot image tracks, if present, must have the
same orientation (horizontal or vertical) 
as the panorama image track.</p><p></p></div>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58262" title="Track Reference Entry Structure"></a><h3>Track
Reference Entry Structure</h3>
<p>Since there are no fields in the pano sample data atom to
indicate the presence of low-resolution image tracks, a separate
sibling atom must be added to the panorama sample atom container.
The track reference array atom contains an array of track reference entry
structures that specify information about any low-resolution image
tracks contained in a movie. Its atom type is <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_752"></a><code>kQTVRTrackRefArrayAtomType</code> 
(<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_753"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_754"></a><code>'tref'</code>). </p>
<p>A track reference entry structure is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_755"></a><code>QTVRTrackRefEntry</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct QTVRTrackRefEntry {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              trackRefType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              trackResolution;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              trackRefIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTVRTrackRefEntry;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_89" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>trackRefType</code></dt>
<dd><p>The track reference type. </p></dd>
<dt><code>trackResolution</code></dt>
<dd><p>The track resolution. </p></dd>
<dt><code>trackRefIndex</code></dt>
<dd><p>The index of the track reference.</p></dd></dl>
<p>The number of entries in the track reference array atom is
determined by dividing the size of the atom by <code>sizeof</code> (<code>QTVRTrackRefEntry</code>).</p>
<p><code>kQTVRPreviewTrackRes</code> is
a special value for the <code>trackResolution</code> field
in the <code>QTVRTrackRefEntry</code> structure.
This is used to indicate the presence of a special preview image
track.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58267" title="Object Tracks "></a><h2>Object
Tracks </h2><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_756"></a>
<p>A movie’s object track is a track that contains information
about the object nodes in a scene. The media type of the object
track is <code>'<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_757"></a>obje'</code>.
Each sample in an object track corresponds to a single object node
in the scene. The samples of the object track contain information describing
the object images stored in the object image track. </p>
<p>These object information samples parallel the corresponding
node samples in the QTVR track and are equal in time and duration
to a particular object node’s image samples in the object’s
image track as well as the object node’s hot spot samples in the
object’s hot spot track.</p>
<p>Object tracks do not have a sample description (although QuickTime
requires that you specify a dummy sample description when you call <code>AddMediaSample</code> to
add a sample to an object track). The sample itself is an atom container
that contains a single object sample atom and other optional atoms.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58274" title="Object Sample Atom Structure"></a><h3>Object
Sample Atom Structure</h3>
<p> object sample atom describes a single object, including information
about the default viewing angles and the view settings. The structure
of an object sample atom is defined by the <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_758"></a><code>QTVRObjectSampleAtom</code> data
type:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct VRObjectSampleAtom {<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              majorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              minorVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              movieType;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              viewStateCount;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              defaultViewState;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16                              mouseDownViewState;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              viewDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              columns;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              rows;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             mouseMotionScale;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultPan;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             maxTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultTilt;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             minFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             fieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultFieldOfView;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultViewCenterH;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             defaultViewCenterV;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             viewRate;<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32                             frameRate;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              animationSettings;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                              controlSettings;<span></span></pre></td></tr><tr><td scope="row"><pre>} VRObjectSampleAtom, *VRObjectSampleAtomPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr><tr><td scope="row"><pre>QT<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_90" title="Field descriptions"></a><h5>Field descriptions</h5>
<dt><code>majorVersion</code></dt>
<dd><p>The major version number of the file format.</p></dd>
<dt><code>minorVersion</code></dt>
<dd><p>The minor version number of the file format.</p></dd>
<dt><code>movieType</code></dt>
<dd><p>The movie controller type. </p></dd>
<dt><code>viewStateCount</code></dt>
<dd><p>The number of view states of the object. A view state
selects an alternate set of images for an object’s views. The
value of this field must be positive.</p></dd>
<dt><code>defaultViewState</code></dt>
<dd><p>The 1-based index of the default view state. The default
view state image for a given view is displayed when the mouse button
is not down.</p></dd>
<dt><code>mouseDownViewState</code></dt>
<dd><p>The 1-based index of the mouse-down view state. The
mouse-down view state image for a given view is displayed while
the user holds the mouse button down and the cursor is over an object
movie.</p></dd>
<dt><code>viewDuration</code></dt>
<dd><p>The total movie duration of all image frames contained
in an object’s view. In an object that uses a single frame to
represent a view, the duration is the image track’s sample duration
time.</p></dd>
<dt><code>columns</code></dt>
<dd><p>The number of columns in the object image array (that
is, the number of horizontal positions or increments in the range
defined by the minimum and maximum pan values). The value of this
field must be positive.</p></dd>
<dt><code>rows</code></dt>
<dd><p>The number of rows in the object image array (that is,
the number of vertical positions or increments in the range defined
by the minimum and maximum tilt values). The value of this field
must be positive.</p></dd>
<dt><code>mouseMotionScale</code></dt>
<dd><p>The mouse motion scale factor (that is, the number of
degrees that an object is panned or tilted when the cursor is dragged
the entire width of the VR movie image). The default value is 180.0.</p></dd>
<dt><code>minPan</code></dt>
<dd><p>The minimum pan angle, in degrees. The value of this
field must be less than the value of the <code>maxPan</code> field.</p></dd>
<dt><code>maxPan</code></dt>
<dd><p>The maximum pan angle, in degrees. The value of this
field must be greater than the value of the <code>minPan</code> field.</p></dd>
<dt><code>defaultPan</code></dt>
<dd><p>The default pan angle, in degrees. This is the pan angle
used when the object is first displayed. The value of this field
must be greater than or equal to the value of the <code>minPan</code> field
and less than or equal to the value of the <code>maxPan</code> field.</p></dd>
<dt><code>minTilt</code></dt>
<dd><p>The minimum tilt angle, in degrees. The default value
is +90.0. The value of this field must be less than the value of
the <code>maxTilt</code> field.</p></dd>
<dt><code>maxTilt</code></dt>
<dd><p>The maximum tilt angle, in degrees. The default value
is –90.0. The value of this field must be greater than the value
of the <code>minTilt</code> field.</p></dd>
<dt><code>defaultTilt</code></dt>
<dd><p>The default tilt angle, in degrees. This is the tilt
angle used when the object is first displayed. The value of this
field must be greater than or equal to the value of the <code>minTilt</code> field
and less than or equal to the value of the <code>maxTilt</code> field.</p></dd>
<dt><code>minFieldOfView</code></dt>
<dd><p>The minimum field of view to which the object can zoom.
The valid range for this field is from 1 to the value of the <code>fieldOfView</code> field.
The value of this field must be positive.</p></dd>
<dt><code>fieldOfView</code></dt>
<dd><p>The image field of view, in degrees, for the entire
object. The value in this field must be greater than or equal to
the value of the <code>minFieldOfView</code> field.</p></dd>
<dt><code>defaultFieldOfView</code></dt>
<dd><p>The default field of view for the object. This
is the field of view used when the object is first displayed. The
value in this field must be greater than or equal to the value of
the <code>minFieldOfView</code> field
and less than or equal to the value of the <code>fieldOfView</code> field.</p></dd>
<dt><code>defaultViewCenterH</code></dt>
<dd><p>The default horizontal view center.</p></dd>
<dt><code>defaultViewCenterV</code></dt>
<dd><p>The default vertical view center.</p></dd>
<dt><code>viewRate</code></dt>
<dd><p>The view rate (that is, the positive or negative rate
at which the view animation in the object plays, if view animation
is enabled). The value of this field must be from –100.0 through
+100.0, inclusive.</p></dd>
<dt><code>frameRate</code></dt>
<dd><p>The frame rate (that is, the positive or negative rate
at which the frame animation in a view plays, if frame animation
is enabled). The value of this field must be from –100.0 through
+100.0, inclusive.</p></dd>
<dt><code>animationSettings</code></dt>
<dd><p>A set of 32-bit flags that encode information about
the animation settings of the object.</p></dd>
<dt><code>controlSettings</code></dt>
<dd><p>A set of 32-bit flags that encode information about
the control settings of the object.</p></dd></dl>
<p>The <code>movieType</code> field
of the object sample atom structure specifies an object controller
type, that is, the user interface to be used to manipulate the object. </p>
<p>QuickTime VR supports the following controller types:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum ObjectUITypes {<span></span></pre></td></tr><tr><td scope="row"><pre>    kGrabberScrollerUI                          = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kOldJoyStickUI                              = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kJoystickUI                                 = 3,<span></span></pre></td></tr><tr><td scope="row"><pre>    kGrabberUI                                  = 4,<span></span></pre></td></tr><tr><td scope="row"><pre>    kAbsoluteUI                                 = 5<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_91" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kGrabberScrollerUI<!--/a--></code></dt>
<dd><p>The default controller, which displays a hand for dragging
and rotation arrows when the cursor is along the edges of the object
window.</p></dd>
<dt><code><!--a  -->kOldJoyStickUI<!--/a--></code></dt>
<dd><p>A joystick controller, which displays a joystick-like
interface for spinning the object. With this controller, the direction
of panning is reversed from the direction of the grabber.</p></dd>
<dt><code><!--a  -->kJoystickUI<!--/a--></code></dt>
<dd><p>A joystick controller, which displays a joystick-like
interface for spinning the object. With this controller, the direction
of panning is consistent with the direction of the grabber.</p></dd>
<dt><code><!--a  -->kGrabberUI<!--/a--></code></dt>
<dd><p>A grabber-only interface, which displays a hand for
dragging but does not display rotation arrows when the cursor is
along the edges of the object window.</p></dd>
<dt><code><!--a  -->kAbsoluteUI<!--/a--></code></dt>
<dd><p>An absolute controller, which displays a finger for
pointing. The absolute controller switches views based on a row-and-column
grid mapped into the object window.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-89641" title="Animation Settings"></a><h4>Animation
Settings</h4>
<p>The <code>animationSettings</code> field
of the object sample atom is a long integer that specifies a set of
animation settings for an object node. Animation settings specify
characteristics of the movie while it is playing. Use these constants
to specify animation settings:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum QTVRAnimationSettings {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectAnimateViewFramesOn              = (1 &lt;&lt; 0),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPalindromeViewFramesOn           = (1 &lt;&lt; 1),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectStartFirstViewFrameOn            = (1 &lt;&lt; 2),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectAnimateViewsOn                   = (1 &lt;&lt; 3),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPalindromeViewsOn                = (1 &lt;&lt; 4),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectSyncViewToFrameRate              = (1 &lt;&lt; 5),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectDontLoopViewFramesOn             = (1 &lt;&lt; 6),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectPlayEveryViewFrameOn             = (1 &lt;&lt; 7)<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_92" title="Constant descriptions"></a><h5>Constant descriptions</h5>
<dt><code><!--a  -->kQTVRObjectAnimateViewFramesOn<!--/a--></code></dt>
<dd><p>The animation setting to play all frames in the
current view state.</p></dd>
<dt><code><!--a  -->kQTVRObjectPalindromeViewFramesOn<!--/a--></code></dt>
<dd><p>The animation setting to play a back-and-forth
animation of the frames of the current view state.</p></dd>
<dt><code><!--a  -->kQTVRObjectStartFirstViewFrameOn<!--/a--></code></dt>
<dd><p>The animation setting to play the frame animation
starting with the first frame in the view (that is, at the view
start time).</p></dd>
<dt><code><!--a  -->kQTVRObjectAnimateViewsOn<!--/a--></code></dt>
<dd><p>The animation setting to play all views of the
current object in the default row of views.</p></dd>
<dt><code><!--a  -->kQTVRObjectPalindromeViewsOn<!--/a--></code></dt>
<dd><p>The animation setting to play a back-and-forth
animation of all views of the current object in the default row
of views.</p></dd>
<dt><code><!--a  -->kQTVRObjectSyncViewToFrameRate<!--/a--></code></dt>
<dd><p>The animation setting to synchronize the view animation
to the frame animation and use the same options as for frame animation.</p></dd>
<dt><code><!--a  -->kQTVRObjectDontLoopViewFramesOn<!--/a--></code></dt>
<dd><p>The animation setting to stop playing the frame
animation in the current view at the end.</p></dd>
<dt><code><!--a  -->kQTVRObjectPlayEveryViewFrameOn<!--/a--></code></dt>
<dd><p>The animation setting to play every view frame regardless
of play rate. The play rate is used to adjust the duration in which
a frame appears but no frames are skipped so the rate is not exact. </p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-89899" title="Control Settings"></a><h5>Control
Settings</h5>
<p>The <code>controlSettings</code> field
of the object sample atom is a long integer that specifies a set
of control settings for an object node. Control settings specify
whether the object can wrap during panning and tilting, as well
as other features of the node. The control settings are specified
using these bit flags:</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum QTVRControlSettings {<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectWrapPanOn                        = (1 &lt;&lt; 0),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectWrapTiltOn                       = (1 &lt;&lt; 1),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectCanZoomOn                        = (1 &lt;&lt; 2),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectReverseHControlOn                = (1 &lt;&lt; 3),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectReverseVControlOn                = (1 &lt;&lt; 4),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectSwapHVControlOn                  = (1 &lt;&lt; 5),<span></span></pre></td></tr><tr><td scope="row"><pre>    kQTVRObjectTranslationOn                    = (1 &lt;&lt; 6)<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>
<dl class="termdef">	<a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_93" title="Constant Descriptions"></a><h5>Constant Descriptions</h5>
<dt><code><!--a  -->kQTVRObjectWrapPanOn<!--/a--></code></dt>
<dd><p>The control setting to enable wrapping during panning.
When this control setting is enabled, the user can wrap around from
the current pan constraint maximum value to the pan constraint minimum
value (or vice versa) using the mouse or arrow keys.</p></dd>
<dt><code><!--a  -->kQTVRObjectWrapTiltOn<!--/a--></code></dt>
<dd><p>The control setting to enable wrapping during tilting.
When this control setting is enabled, the user can wrap around from
the current tilt constraint maximum value to the tilt constraint
minimum value (or vice versa) using the mouse or arrow keys.</p></dd>
<dt><code><!--a  -->kQTVRObjectCanZoomOn<!--/a--></code></dt>
<dd><p>The control setting to enable zooming. When this
control setting is enabled, the user can change the current field
of view using the zoom-in and zoom-out keys on the keyboard (or
using the VR controller buttons).</p></dd>
<dt><code><!--a  -->kQTVRObjectReverseHControlOn<!--/a--></code></dt>
<dd><p>The control setting to reverse the direction of the
horizontal control.</p></dd>
<dt><code><!--a  -->kQTVRObjectReverseVControlOn<!--/a--></code></dt>
<dd><p>The control setting to reverse the direction of the
vertical control.</p></dd>
<dt><code><!--a  -->kQTVRObjectSwapHVControlOn<!--/a--></code></dt>
<dd><p>The control setting to exchange the horizontal and
vertical controls.</p></dd>
<dt><code><!--a  -->kQTVRObjectTranslationOn<!--/a--></code></dt>
<dd><p>The control setting to enable translation. When this
setting is enabled, the user can translate using the mouse when
either the translate key is held down or the controller translation
mode button is toggled on.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH205-90688" title="Track References for Object Tracks"></a><h2>Track
References for Object
Tracks</h2><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_759"></a>
<p>The track references to an object’s image and hot spot tracks
are not handled the same way as track references to panoramas. The
track reference types are the same (<code>kQTVRImageTrackRefType</code> and <code>kQTVRHotSpotTrackRefAtomType</code>),
but the location of the reference indexes is different. There is
no entry in the object sample atom for the track reference indexes.
Instead, separate atoms using the <code>VRTrackRefEntry</code> structure
are stored as siblings to the object sample atom. The types of these
atoms are <code>kQTVRImageTrackRefAtomType</code> and <code>kQTVRHotSpotTrackRefAtomType</code>.
If either of these atoms is not present, then the reference index
to the corresponding track is assumed to be 1. </p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_94" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>trackResolution</code> field
in the <code>VRTrackRefEntry</code> structure
is ignored for object tracks. </p></div>
<p>The actual views of an object for an object node are contained
in an <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_760"></a>object
image track, which is usually a standard QuickTime video track.
(An object image track can also be any type of track that is capable
of displaying an image, such as a QuickTime 3D track.) </p>
<p>As described in Chapter 1 of <em><a href="../../InsideQT_QTVR/index.html#//apple_ref/doc/uid/TP40000944" target="_top">QuickTime VR</a></em>,
these views are often captured by moving a camera around the object
in a defined pattern of pan and tilt angles. The views must then
be ordered into an object image array, which is stored as a one-dimensional
sequence of frames in the movie’s video track (see <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-69381">Figure 3-23</a></span>).</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH205-69381" title="Figure 3-23The structure of an image track for an object"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCCCHDA" title="Figure 3-23The structure of an image track for an object"></a><p><strong>Figure 3-23&nbsp;&nbsp;</strong>The structure of an image track for
an object</p><img src = "../art/qtvr_l_03.gif" alt = "The structure of an image track for an object" width="478" height="168"></div><br/>
<p>For object movies containing frame animation, each animated
view in the object image array consists of the animating frames.
It is not necessary that each view in the object image array contain
the same number of frames, but the view duration of all views in
the object movie must be the same.</p>
<p>For object movies containing alternate view states, alternate
view states are stored as separate object image arrays that immediately
follow the preceding view state in the object image track. Each
state does not need to contain the same number of frames. However,
the total movie time of each view state in an object node must be
the same.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-69881" title="Movie Media"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-BBCJAIEE" title="Movie Media"></a><h2>Movie Media</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_761"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_762"></a>Movie media
is used to encapsulate <a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_763"></a>embedded
movies within QuickTime movies. This feature is available in QuickTime
4.1.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58410" title="Movie Sample Description"></a><h3>Movie
Sample Description</h3>
<p>The movie media doesn’t have a unique sample description.
It uses the minimum sample description, which is <code>SampleDescriptionRecord</code>.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH205-58416" title="Movie Media Sample Format"></a><a name="//apple_ref/doc/uid/TP40000939-CH205-CJBHCCJG" title="Movie Media Sample Format"></a><h3>Movie Media Sample Format</h3>
<p>Each sample in the movie media is a QuickTime atom container.
All root-level atoms and their contents are enumerated in the following
list. Note that the contents of all atoms are stored in big-endian
format.</p>
<dl class="termdef">	<dt><code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_764"></a>kMovieMediaDataReference</code></dt>
<dd><p>A data reference type and a
data reference. The data reference type is stored as an <code>OSType</code> at
the start of the atom. The data reference is stored following the
data reference type. If the data reference type is URL and the data
reference is for a movie on the Apple website, the contents of the
atom would be <code>url     http://www.apple.com/foo.mov</code>.</p><p>There
may be more than one atom of this type. The first atom of this type should
have an atom ID of 1. Additional data references should be numbered
sequentially.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_765"></a><code>kMovieMediaDefaultDataReferenceID</code></dt>
<dd><p>This atom contains a <code>QTAtomID</code> that
indicates the ID of the data reference to use when instantiating
the embedded movie for this sample. If this atom is not present,
the data reference with an ID of 1 is used.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_766"></a><code>kMovieMediaSlaveTime</code></dt>
<dd><p>A Boolean that indicates whether
or not the <code>TimeBase</code> of the
embedded movie should be slaved to the <code>TimeBase</code> of
the parent movie. If the <code>TimeBase</code> is
slaved, the embedded movie’s zero time will correspond to the
start time of its movie media sample. Further, the playback rate
of the embedded movie will always be the same as the parent movie’s.
If the <code>TimeBase</code> is not
slaved, the embedded movie will default to a rate of 0, and a default
time of whatever default time value it instantiated with (which may
not be 0). If the <code>TimeBase</code> is
not slaved, the embedded movie can be played by either including
an <code>AutoPlay</code> atom in the
movie media sample or by using a wired action. If this atom is not
present, the embedded movie defaults to not slaved.</p></dd>
<dt><code><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_767"></a>kMovieMediaSlaveAudio</code></dt>
<dd><p>A Boolean that indicates whether
or not the audio properties of the embedded movie should be slaved
to those of the parent movie. When audio is slaved, all audio properties
of the containing track are duplicated in the embedded movie. These
properties include sound volume, balance, bass and treble, and level
metering. If this atom is not present, the embedded movie defaults
to not slaved audio.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_768"></a><code>kMovieMediaSlaveGraphicsMode</code></dt>
<dd><p>A Boolean that indicates how
the graphics mode of the containing track is applied to the embedded
movie. If the graphics mode is not slaved, then the entire embedded
movie is imaged using its own graphics modes. The result of the
drawing of the embedded movie is composited onto the containing
movie using the graphics mode of the containing track. If the graphics
mode is slaved, then the graphics mode of each track in the embedded
movie is ignored and instead the graphics mode of the containing
track is used. In this case, the tracks of the embedded movie composite
their drawing directly into the parent movie’s contents. If this
atom is not present, the graphics mode defaults to not slaved. Graphics mode
slaving is useful for compositing semi-transparent media––for example,
a PNG with an alpha channel––on top of other media.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_769"></a><code>kMovieMediaSlaveTrackDuration</code></dt>
<dd><p>A Boolean that indicates how
the Movie Media Handler should react when the duration of the embedded
movie is different than the duration of the movie media sample that
it is contained by. When the movie media sample is created, the
duration of the embedded movie may not yet be known. Therefore,
the duration of the media sample may not be correct. In this case,
the Movie Media Handler can do one of two things. If this atom is
not present or it contains a value of false, the Movie Media Handler
will respect the duration of media sample that contains the embedded
movie. If the embedded movie has a longer duration than the movie
media sample, the embedded movie will be truncated to the duration
of the containing movie media sample. If the embedded movie is shorter,
there will be a gap after it is finished playing. If this atom contains
a value of true, the duration of the movie media sample will be
adjusted to match the actual duration of the embedded movie. Because
it is not possible to change an existing media sample, this will
cause a new media sample to be added to the movie and the track’s
edit list to be updated to reference the new sample instead of the original
sample.</p></dd></dl>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_95" title="Note"></a><p><strong>Note:</strong>&nbsp;When the duration
of the embedded movie’s sample is adjusted, by default no other
tracks are adjusted. This can cause the overall temporal composition
to change in unintended ways. To maintain the complete temporal
composition, a higher-level data structure which describes the temporal
relationships between the various tracks must also be included with
the movie.</p></div>
<dl class="termdef">	<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_770"></a><code>kMovieMediaAutoPlay</code></dt>
<dd><p>A Boolean that indicates whether
or not the embedded movie should start playing immediately after
being instantiated. This atom is only used if the <code>TimeBase</code> of
the embedded movie is not slaved to the parent movie. See the <code>kMovieMediaSlaveTime</code> atom in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-58416">“Movie Media Sample Format”</a></span> for
more information. If auto play is requested, the movie will be played
at its preferred rate after being instantiated. If this atom is
not present, the embedded movie will not automatically play.</p></dd>
<dt><code>kMovieMediaLoop</code></dt>
<dd><p>A <code>UInt8</code> that
indicates how the embedded movie should loop. This atom is only
used if the <code>TimeBase</code> of
the embedded movie is not slaved to the parent movie. See the <code>kMovieMediaSlaveTime</code> atom in <span class="content_text"><a href="qtff3.html#//apple_ref/doc/uid/TP40000939-CH205-58416">“Movie Media Sample Format”</a></span> for
more information. If this atom contains a 0, or if this atom is
not present, the embedded movie will not loop. If this atom contains
a value of 1, the embedded movie loops normally––that is, when
it reaches the end it loops back to the beginning. If this atom
contains a value of 2, the embedded movie uses palindromic looping.
All other values are reserved.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_771"></a><code>kMovieMediaUseMIMEType</code></dt>
<dd><p>Text (not a C string or a pascal
string) that indicates the MIME type of the movie import component
that should be used to instantiate this media. This is useful in
cases where the data reference may not contain MIME type information.
If this atom is not present, the MIME type of the data reference
as determined at instantiation time is used. This atom is intended
to allow content creators a method for working around MIME type
binding problems. It should not typically be required, and should
not be included in movie media samples by default.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_772"></a><code>kMovieMediaTitle</code></dt>
<dd><p>Currently unused. It would contain text indicating
the name of the embedded movie.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_773"></a><code>kMovieMediaAltText</code></dt>
<dd><p>Text (not a C string or a pascal
string) that is displayed to the user when the embedded movie is
being instantiated or if the embedded movie cannot be instantiated.
If this atom is not present, the name of the data reference (typically
the file name) is used.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_774"></a><code>kMovieMediaClipBegin</code></dt>
<dd><p>A <code>MovieMediaTimeRecord</code> that
indicates the time of the embedded movie that should be used. The
clip begin atom provides a way to specify that a portion of the
beginning of the embedded movie should not be used. If this atom
is not present, the beginning of the embedded movie is not changed.
Note that this atom does not change the time at which the embedded
movie begins playing in the parent movie’s time line. If the time specified
in the clip begin atom is greater than the duration of the embedded
movie, then the embedded movie will not play at all.</p><div class="codesample"><table><tr><td scope="row"><pre>struct MovieMediaTimeRecord {<span></span></pre></td></tr><tr><td scope="row"><pre> wide            time;<span></span></pre></td></tr><tr><td scope="row"><pre>TimeScale       scale;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_775"></a><code>kMovieMediaClipDuration</code></dt>
<dd><p>A <code>MovieMediaTimeRecord</code> that
indicates the duration of the embedded movie that should be used.
The clip duration atom is applied by removing media from end of
the embedded movie. If the clip duration atom is not present, then
no media is removed from the end of the embedded movie. In situations
where the sample contains both a clip duration and a clip begin
atom, the clip begin is applied first. If the clip duration specifies
a value that is larger than the duration of the embedded movie,
no change is made to the embedded movie.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_776"></a><code>kMovieMediaEnableFrameStepping</code></dt>
<dd><p>A Boolean that indicates whether
or not the embedded movie should be considered when performing step
operations, specifically using the interesting time calls with the <code>nextTimeStep</code> flag.
If this atom is not present or is set to <code>false</code>,
the embedded movie is not included in step calculations. If the
atom is set to <code>true</code>,
it is included in step calculations.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_777"></a><code>kMovieMediaBackgroundColor</code></dt>
<dd><p>An <code>RGBColor</code> that
is used for filling the background when the movie is being instantiated
or when it fails to instantiate.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_778"></a><code>kMovieMediaRegionAtom</code></dt>
<dd><p>A number of child atoms, shown
below, which describe how the Movie Media Handler should resize
the embedded movie. If this atom is not present, the Movie Media
Handler resizes the child movie to completely fill the containing
track’s box.</p><p><code>kMovieMediaSpatialAdjustment</code> </p><p>This
atom contains an <code>OSType</code> that
indicates how the embedded movie should be scaled to fit the track
box. If this atom is not present, the default value is <code>kMovieMediaFitFill</code>.
These modes are all based on SMIL layout options.</p><p><code>kMovieMediaFitClipIfNecessary</code> </p><p>If
the media is larger than the track box, it will be clipped; if it
is smaller, any additional area will be transparent.</p><p><code>kMovieMediaFitFill</code></p><p>The
media will be scaled to completely fill the track box.</p><p><code>kMovieMediaFitMeet</code></p><p>The
media is proportionally scaled so that it is entirely visible in
the track box and fills the largest area possible without changing
the aspect ratio.</p><p><code>kMovieMediaFitSlice</code></p><p>The
media is scaled proportionally so that the smaller dimension is completely
visible.</p><p><code>kMovieMediaFitScroll</code></p><p>Not
currently implemented. It currently has the same behavior as <code>kMovieMediaFitClipIfNecessary</code>.
When implemented, it will have the behavior described in the SMIL
specification for a scrolling layout element.</p></dd>
<dt><a name="//apple_ref/doc/uid/TP40000939-CH205-DontLinkElementID_779"></a><code>kMovieMediaRectangleAtom</code></dt>
<dd><p>Four child atoms that define
a rectangle. Not all child atoms must be present: top and left must
both appear together, width and height must both appear together.
The dimensions contained in this rectangle are used in place of
the track box when applying the contents of the spatial adjustment
atom. If the top and left are not specified, the top and left of
the containing track’s box are used. If the width and height are
not specified, the width and height of the containing track’s
box are used. Each child atom contains a <code>UInt32</code>.</p><p><code>kMovieMediaTop</code></p><p>If
present, the top of the rectangle</p><p><code>kMovieMediaLeft</code></p><p>If
present, the left boundary of the rectangle</p><p><code>kMovieMediaWidth</code></p><p>If
present, width of rectangle</p><p><code>kMovieMediaHeight</code></p><p>If
present, height of rectangle</p></dd></dl>
<p></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../QTFFChap2/qtff2.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../QTFFChap4/qtff4.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-09-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/QTFF/QTFFChap3/qtff3.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>