<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Carbon-Cocoa Integration Guide: Using a Cocoa User Interface in a Carbon Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using a Cocoa User Interface in a Carbon Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20002404" title="Using a Cocoa User Interface in a Carbon Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DesignGuidelines-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000556" target="_top">Design Guidelines</a> &gt; <a href="../index.html" target="_top">Carbon-Cocoa Integration Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CarbonInCocoa.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="CarbonUIInCocoa.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20002404-TP1" title="Using a Cocoa User Interface in a Carbon Application"></a><hr /><H1>Using a Cocoa User Interface in a Carbon Application</H1>

<p><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_80"></a>You can use a Cocoa user interface in a Carbon application starting with Mac OS X version 10.2. The system provides code that allows Cocoa and Carbon to communicate user events to each other, so there are only a few tasks you must perform to enable the Cocoa user interface to work properly in Carbon. Most tasks are similar to what you would do to use non-UI Cocoa functionality in a Carbon application—that is, writing C-callable wrapper functions and calling them. (See <span class="content_text"><a href="CocoaInCarbon.html#//apple_ref/doc/uid/20002402-TP1">“Using Cocoa Functionality in a Carbon Application.”</a></span>)</p>
<p>It is important to recognize that embedding a Cocoa NSView inside a Carbon window is not supported in Mac OS X version 10.4 and earlier. For more information, see <span class="content_text"><a href="HICocoaView.html#//apple_ref/doc/uid/TP40004724-SW1">“HICocoaView: Using Cocoa Views in Carbon Windows.”</a></span></p>
<p>To use a Cocoa user interface in a Carbon application, you need to perform two major tasks:</p>
<ul class="ul"><li class="li"><p>Write a Cocoa source file that contains the interface you want to use, the Cocoa methods that support the interface, and C-callable wrapper functions that allow access to the Cocoa functionality needed by the Carbon application. This is described in detail in <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-782818">“Writing the Cocoa Source Files.”</a></span> </p></li>
<li class="li"><p>Write Carbon code that provides handlers, as appropriate, for the interface. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-784621">“Setting Up the Carbon Application to Use the Cocoa Interface”</a></span> for details.</p></li></ul>
<p>The tasks described in the following sections are illustrated using sample code taken from a working application called CocoaInCarbon. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-808522">“About the CocoaInCarbon Application”</a></span> for a description of the application. You can download the code for <em><a href="../../../../../samplecode/CocoaInCarbon/index.html#//apple_ref/doc/uid/DTS10000385" target="_top">CocoaInCarbon</a></em>.</p>
<p>Keep in mind that many parts of the CocoaInCarbon application are specific to the sample application; you need to customize the code for your own purposes. Although most of the code from the CocoaInCarbon application is shown in the listings in this article, not all of the code is included.</p>
<a name="//apple_ref/doc/uid/20002404-808522" title="About the CocoaInCarbon Application"></a><a name="//apple_ref/doc/uid/20002404-808522-TPXREF167" title="About the CocoaInCarbon Application"></a><h2>About the CocoaInCarbon Application</h2>
<p><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_81"></a><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_82"></a>When you look at the code in the subsequent sections, it may be helpful to have an idea of how the CocoaInCarbon application behaves and what the user interface looks like. When the application is launched, an empty window appears. This window, shown in <span class="content_text">Figure 1</span>, is a Carbon window defined in a nib file created with Interface Builder. The application provides a Test menu, that contains one command, Open Cocoa Window.</p>
<br/><div><a name="//apple_ref/doc/uid/20002404-782653-BCIEJCEF" title="Figure 1The Carbon user interface for the CocoaInCarbon application"></a><p><a name="//apple_ref/doc/uid/20002404-782653" title="Figure 1The Carbon user interface for the CocoaInCarbon application"></a><strong>Figure 1&nbsp;&nbsp;</strong>The Carbon user interface for the CocoaInCarbon application</p><img src = "../Art/carboninterface.gif" alt = "The Carbon user interface for the CocoaInCarbon application" width="585" height="322"></div><br/>
<p>When the user chooses Open Cocoa Window from the Test menu, the application calls the C-wrapper function that opens the Cocoa window (shown in <span class="content_text">Figure 2</span>) and makes the window active.</p>
<br/><div><a name="//apple_ref/doc/uid/20002404-796486-BCIGEDDH" title="Figure 2The Cocoa window for the CocoaInCarbon application"></a><p><a name="//apple_ref/doc/uid/20002404-796486" title="Figure 2The Cocoa window for the CocoaInCarbon application"></a><strong>Figure 2&nbsp;&nbsp;</strong>The Cocoa window for the CocoaInCarbon application</p><img src = "../Art/cocoainterface.gif" alt = "The Cocoa window for the CocoaInCarbon application" width="304" height="121"></div><br/>
<p>When the user clicks the button shown in <span class="content_text">Figure 2</span>, the mouse event is received by the Carbon application, which automatically dispatches the event to Cocoa. Specifically, the button receives the mouse event and sends its action method. The action method triggers a button command handler provided by the Carbon application. The button command handler calls a C-wrapper function that sends the text “button pressed!” to the text field below the button, as shown in <span class="content_text">Figure 2</span>.</p>
<p>Although the sample application is obviously a contrived example, it illustrates the extent to which Carbon and Cocoa can communicate with each other.</p>
<a name="//apple_ref/doc/uid/20002404-782818" title="Writing the Cocoa Source Files"></a><a name="//apple_ref/doc/uid/20002404-782818-TPXREF158" title="Writing the Cocoa Source Files"></a><h2>Writing the Cocoa Source Files</h2>
<p>Writing the Cocoa source requires performing the tasks described in the following sections:</p>
<ul class="ul"><li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-782894">“Creating a Cocoa Source File Using Xcode”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-797359">“Writing a Common Header File”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-796385">“Implementing the Controller”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-860618">“Declaring the Controller Interface”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-860737">“Writing C-Callable Wrapper Functions”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-862464">“Creating the Cocoa Window in Interface Builder”</a></span></p></li></ul>
<a name="//apple_ref/doc/uid/20002404-782894" title="Creating a Cocoa Source File Using Xcode"></a><a name="//apple_ref/doc/uid/20002404-782894-BCIGAJHD" title="Creating a Cocoa Source File Using Xcode"></a><h3>Creating a Cocoa Source File Using Xcode</h3><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_83"></a>
<p>You need to make a Cocoa source file that contains all the Cocoa functionality needed by your Carbon application. Follow these steps to create a Cocoa source file:</p>
<ol class="ol"><li class="li"><p>Open your Carbon project in Xcode.</p></li>
<li class="li"><p>Choose File > New File.</p></li>
<li class="li"><p>Select Empty File in Project in the New File window and click the Next button.</p></li>
<li class="li"><p>Name the file so it has the appropriate <code>.m</code> extension. The sample code filename is <code>Controller.m</code>.</p><p>Recall from <span class="content_text"><a href="CompilerPreprocessors.html#//apple_ref/doc/uid/20002400-SW1">“Preprocessing Mixed-Language Code”</a></span> that the <code>.m</code> extension indicates to the compiler that the code is Objective-C. </p></li>
<li class="li"><p>Create any other files you need for the application. For example, the Cocoa source created for the CocoaInCarbon application has an interface file, <code>Controller.h</code>. You must create this file and import it to the <code>Controller.m</code> file by adding an import statement to the <code>Controller.m</code> file.</p></li></ol>
<p>As long as you create your source file using Xcode, you should not need to modify build settings and property list values.<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_84"></a></p>
<a name="//apple_ref/doc/uid/20002404-797359" title="Writing a Common Header File"></a><a name="//apple_ref/doc/uid/20002404-797359-CJBHDJDG" title="Writing a Common Header File"></a><h3>Writing a Common Header File</h3>
<p>Both the Cocoa and the Carbon sources need to have a copy of the header file that declares any constants used to communicate events between them. The constant that defines the button-press event in the CocoaInCarbon application is one such constant. The C-callable wrapper function declarations could also be in this shared file. <span class="content_text">Listing 1</span> shows the contents of the header file (<code>CocoaStuff.h</code>) that must be included in both the Cocoa and the Carbon source for the CocoaInCarbon project.</p>
<a name="//apple_ref/doc/uid/20002404-808859-CJBDEEFB" title="Listing 1The contents of the common header for Cocoa and Carbon"></a><p class="codesample"><a name="//apple_ref/doc/uid/20002404-808859" title="Listing 1The contents of the common header for Cocoa and Carbon"></a><strong>Listing 1&nbsp;&nbsp;</strong>The contents of the common header for Cocoa and Carbon</p>
<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kEventButtonPressed = 1<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//Declare the wrapper functions<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus initializeCocoa(OSStatus (*callBack)(int));<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus orderWindowFront(void);<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus changeText(CFStringRef message);<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/20002404-796385" title="Implementing the Controller"></a><a name="//apple_ref/doc/uid/20002404-796385-TPXREF181" title="Implementing the Controller"></a><h3>Implementing the Controller</h3>
<p>The code to implement the controller for the Cocoa source in the CocoaInCarbon application is shown in <span class="content_text">Listing 2</span>. The critical item in this code is the use of the <a name="//apple_ref/doc/uid/20002404-DontLinkElementID_85"></a><code><a href="../../../Reference/ApplicationKit/Miscellaneous/AppKit_Functions/Reference/reference.html#//apple_ref/c/func/NSApplicationLoad" target="_top">NSApplicationLoad</a></code> function (in the line numbered 2). A Carbon application cannot access the Cocoa interface unless the application includes a call to <code>NSApplicationLoad</code>. This function is not needed for Cocoa applications, but it is mandatory for Carbon applications that use Cocoa. The <code>NSApplicationLoad</code> function is available starting with Mac OS X v10.2. <code>NSApplicationLoad</code> should be called after Carbon is initialized.</p>
<p>A detailed explanation of each numbered line of code in <span class="content_text">Listing 2</span> follows the listing.</p>
<a name="//apple_ref/doc/uid/20002404-808898-CJBCJIBI" title="Listing 2Implementing the controller in the Cocoa source file"></a><p class="codesample"><a name="//apple_ref/doc/uid/20002404-808898" title="Listing 2Implementing the controller in the Cocoa source file"></a><strong>Listing 2&nbsp;&nbsp;</strong>Implementing the controller in the Cocoa source file</p>
<div class="codesample"><table><tr><td scope="row"><pre>#import "Controller.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static Controller *sharedController;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@implementation Controller<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>+ (Controller *) sharedController<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return sharedController;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (id) init                                                             <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    self = [super init];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSApplicationLoad();                                                <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    if (![NSBundle loadNibNamed:@"MyWindow" owner:self]) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLog(@"failed to load MyWindow nib");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    sharedController = self;<span></span></pre></td></tr><tr><td scope="row"><pre>    return self;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) setCallBack:(CallBackType) callBack                            <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    _callBack = callBack;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) showWindow                                                     <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [window makeKeyAndOrderFront:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) changeText:(NSString *)text                                    <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [textField setStringValue:text];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction) buttonPressed:(id)sender                                   <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    (*_callBack) (kEventButtonPressed);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<p>Here’s what the code does:</p>
<ol class="ol"><li class="li"><p>Defines the method that initializes Cocoa. You’ll write a C-callable wrapper function for this method later. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-860737">“Writing C-Callable Wrapper Functions.”</a></span></p></li>
<li class="li"><p>Calls <code>NSApplicationLoad</code> as required. This entry point is needed for Carbon applications using Cocoa API but is a no-op for Cocoa applications. </p></li>
<li class="li"><p>Sets a callback for the controller. The callback (as you’ll see later) is provided by the Carbon application to handle the button-press event.</p></li>
<li class="li"><p>Shows the Cocoa window and makes it active and frontmost. You’ll write a C-callable wrapper function for this method later. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-860737">“Writing C-Callable Wrapper Functions.”</a></span></p></li>
<li class="li"><p>Displays a string in the text field of the Cocoa window. You’ll write a C-callable wrapper function for this method later. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-860737">“Writing C-Callable Wrapper Functions.”</a></span></p></li>
<li class="li"><p>Defines the Interface Builder action associated with the button in the Cocoa window. It invokes the callback (provided by Carbon) that handles the button-press event. You’ll connect the action method to its button target later. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-862464">“Creating the Cocoa Window in Interface Builder.”</a></span></p><div class="notebox"><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_14" title="Note"></a><p><strong>Note:</strong>&nbsp;The Interface Builder action is an example of how an action method in Cocoa could control something in a Carbon application.  The example shows that such control is possible; however, the task performed by the example code doesn't require Carbon. That is, Cocoa could update the text field itself.</p></div></li></ol>
<a name="//apple_ref/doc/uid/20002404-860618" title="Declaring the Controller Interface"></a><a name="//apple_ref/doc/uid/20002404-860618-CJBEHBEI" title="Declaring the Controller Interface"></a><h3>Declaring the Controller Interface</h3>
<p>The code to declare the interface for the controller (<code>Controller.h</code>) is shown in <span class="content_text">Listing 3</span>. The item of note in this listing is the <code>_callBack</code> instance variable. The Carbon application provides the callback function that’s assigned to this variable.</p>
<a name="//apple_ref/doc/uid/20002404-860643-CJBDHFDD" title="Listing 3Declaring the interface for the controller"></a><p class="codesample"><a name="//apple_ref/doc/uid/20002404-860643" title="Listing 3Declaring the interface for the controller"></a><strong>Listing 3&nbsp;&nbsp;</strong>Declaring the interface for the controller</p>
<div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import "CocoaStuff.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef OSStatus (*CallBackType)(int);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface Controller : NSObject<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    id window;<span></span></pre></td></tr><tr><td scope="row"><pre>    id textField;<span></span></pre></td></tr><tr><td scope="row"><pre>    CallBackType _callBack;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)setCallBack:(CallBackType)callBack;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)showWindow;<span></span></pre></td></tr><tr><td scope="row"><pre>+ (id)sharedController;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/20002404-860737" title="Writing C-Callable Wrapper Functions"></a><a name="//apple_ref/doc/uid/20002404-860737-TPXREF182" title="Writing C-Callable Wrapper Functions"></a><h3>Writing C-Callable Wrapper Functions</h3>
<p><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_86"></a><span class="content_text">Listing 4</span> shows the C-callable wrapper functions that are part of the Cocoa source file. These functions are in the <code>Controller.m</code> file in the CocoaInCarbon project. Each function in <span class="content_text">Listing 4</span> wraps around one of the methods shown in <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-808898-CJBCJIBI">Listing 2</a></span>.</p>
<p>One of the critical items in this code is the use of and NSAutoreleasePool<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_87"></a> object. For Cocoa API used by a Carbon application, you must set up autorelease pools as needed. A detailed explanation of each numbered line of code appears following the listing.</p>
<a name="//apple_ref/doc/uid/20002404-860771-CJBFHHBI" title="Listing 4C-callable wrapper functions for the Cocoa API"></a><p class="codesample"><a name="//apple_ref/doc/uid/20002404-860771" title="Listing 4C-callable wrapper functions for the Cocoa API"></a><strong>Listing 4&nbsp;&nbsp;</strong>C-callable wrapper functions for the Cocoa API</p>
<div class="codesample"><table><tr><td scope="row"><pre>OSStatus initializeCocoa (OSStatus (*callBack)(int))                    <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Controller *controller;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool *localPool;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    localPool = [[NSAutoreleasePool alloc] init];                       <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    controller = [[Controller alloc] init];                             <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    [controller setCallBack:callBack];                                  <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    [localPool release];                                                <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus orderWindowFront(void)                                         <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool *localPool;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    localPool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[Controller sharedController] showWindow];<span></span></pre></td></tr><tr><td scope="row"><pre>    [localPool release];<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus changeText (CFStringRef message)                               <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool *localPool;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    localPool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[Controller sharedController] changeText:(NSString *)message];     <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    [localPool release];<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>Here’s what the code does:</p>
<ol class="ol"><li class="li"><p>Defines a C-callable wrapper function that must be called by the Carbon application to initialize Cocoa.</p></li>
<li class="li"><p>Allocates and initializes an autorelease pool, as required. You must do this for each C- callable wrapper function. See <span class="content_text"><a href="WrapperFunctions.html#//apple_ref/doc/uid/20002398-TP1">“Using Carbon and Cocoa in the Same Application”</a></span> for more information.</p></li>
<li class="li"><p>Calls the <code>init</code> method. Recall that this method makes the required call to <code>NSApplicationLoad</code><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_88"></a>.</p></li>
<li class="li"><p>Assigns the callback function provided by the Carbon application to the controller’s callback instance variable.</p></li>
<li class="li"><p>Releases the local autorelease pool. </p></li>
<li class="li"><p>Defines a C-callable wrapper function for the <code>showWindow</code> method.</p></li>
<li class="li"><p>Defines a C-callable wrapper function for the <code>changeText:</code> method.</p></li>
<li class="li"><p>Casts a <code>CFStringRef</code> value to NSString *. Recall from <span class="content_text"><a href="InterchangeableDataTypes.html#//apple_ref/doc/uid/20002401-TP1">“Interchangeable Data Types”</a></span> that the <code>CFString</code> data type is toll-free bridged to the NSString class.<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_89"></a></p></li></ol>
<a name="//apple_ref/doc/uid/20002404-862464" title="Creating the Cocoa Window in Interface Builder"></a><a name="//apple_ref/doc/uid/20002404-862464-BCIIGCAI" title="Creating the Cocoa Window in Interface Builder"></a><h3>Creating the Cocoa Window in Interface Builder</h3>
<p><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_90"></a>You must use Interface Builder to add the Cocoa window to the appropriate nib file and connect targets to the appropriate actions. A nib file contains the definition of a set of user-interface elements. When the button in the sample application is pressed, it triggers the <code>buttonPressed</code> action method (see <span class="content_text">Figure 3</span>). Recall from <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-808898-CJBCJIBI">Listing 2</a></span> that the <code>buttonPressed</code> method calls the callback function assigned to the controller. In the CocoaInCarbon application, the callback is provided by the Carbon application.</p>
<br/><div><a name="//apple_ref/doc/uid/20002404-789418-TPXREF172" title="Figure 3Connecting a button to a button-pressed action"></a><p><a name="//apple_ref/doc/uid/20002404-789418" title="Figure 3Connecting a button to a button-pressed action"></a><strong>Figure 3&nbsp;&nbsp;</strong>Connecting a button to a button-pressed action</p><img src = "../Art/targetaction.gif" alt = "Connecting a button to a button-pressed action" width="519" height="340"></div><br/>
<p>For more information on creating a Cocoa window in Interface Builder<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_91"></a>, see <em><a href="../../ObjCTutorial/index.html#//apple_ref/doc/uid/TP40000863" target="_top">Cocoa Application Tutorial</a></em><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_92"></a>.<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_93"></a></p>
<a name="//apple_ref/doc/uid/20002404-784621" title="Setting Up the Carbon Application to Use the Cocoa Interface"></a><a name="//apple_ref/doc/uid/20002404-784621-TPXREF159" title="Setting Up the Carbon Application to Use the Cocoa Interface"></a><h2>Setting Up the Carbon Application to Use the Cocoa Interface</h2>
<p>Your Carbon application must perform a number of tasks to use the interface provided by the Cocoa. These tasks are described in the following sections:</p>
<ul class="ul"><li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-807928">“Including the Common Header File”</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-799981">“Writing a Command Handler”</a></span></p></li></ul>
<a name="//apple_ref/doc/uid/20002404-807928" title="Including the Common Header File"></a><a name="//apple_ref/doc/uid/20002404-807928-CJBCFJGJ" title="Including the Common Header File"></a><h3>Including the Common Header File</h3>
<p>Both the Cocoa and the Carbon source files need to have a copy of the header file that declares any constants used to communicate events. <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-808859-CJBDEEFB">Listing 1</a></span> shows the header file (<code>CocoaStuff.h</code>) that needs to be included with both the Cocoa and the Carbon source files for the CocoaInCarbon project. See <span class="content_text"><a href="CocoaUIInCarbon.html#//apple_ref/doc/uid/20002404-797359">“Writing a Common Header File”</a></span> for details.</p>
<a name="//apple_ref/doc/uid/20002404-799981" title="Writing a Command Handler"></a><a name="//apple_ref/doc/uid/20002404-799981-CJBHJBIB" title="Writing a Command Handler"></a><h3>Writing a Command Handler</h3>
<p>The Carbon code in the CocoaInCarbon application provides a function (<code>handleCommand</code>) that is passed as a parameter to the C-wrapper function that initializes Cocoa. When the user presses the button in the Cocoa window, the action method associated with the button invokes the <code>handleCommand</code> function. In the CocoaInCarbon application, this function just sends a string back to the Cocoa method, so it is not really necessary. However, the <code>handleCommand</code> function does illustrate how a more complex application could be notified of user actions in the Cocoa source.</p>
<p>The <code>handleCommand</code> function is shown in <span class="content_text">Listing 5</span>. A detailed explanation of each numbered line of code appears following the listing. </p>
<a name="//apple_ref/doc/uid/20002404-810500-CJBBAGII" title="Listing 5A Carbon function that handles a Cocoa button press"></a><p class="codesample"><a name="//apple_ref/doc/uid/20002404-810500" title="Listing 5A Carbon function that handles a Cocoa button press"></a><strong>Listing 5&nbsp;&nbsp;</strong>A Carbon function that handles a Cocoa button press</p>
<div class="codesample"><table><tr><td scope="row"><pre>static OSStatus handleCommand (int commandID)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus osStatus = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (commandID == kEventButtonPressed)                               <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        osStatus = changeText (CFSTR("button pressed!"));               <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr (osStatus, CantCallFunction);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>CantCallFunction:<span></span></pre></td></tr><tr><td scope="row"><pre>    return osStatus;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>Here’s what the code does:</p>
<ol class="ol"><li class="li"><p>Checks to make sure the event is a button-press event, the only event handled by the function.</p></li>
<li class="li"><p>Calls the <code>changeText</code> C-wrapper function with the string “button pressed!”.<a name="//apple_ref/doc/uid/20002404-DontLinkElementID_94"></a><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_95"></a><a name="//apple_ref/doc/uid/20002404-DontLinkElementID_96"></a></p></li></ol>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CarbonInCocoa.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="CarbonUIInCocoa.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/CarbonCocoaDoc/Articles/CocoaUIInCarbon.html%3Fid%3DTP30000893-4.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/CarbonCocoaDoc/Articles/CocoaUIInCarbon.html%3Fid%3DTP30000893-4.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/CarbonCocoaDoc/Articles/CocoaUIInCarbon.html%3Fid%3DTP30000893-4.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
