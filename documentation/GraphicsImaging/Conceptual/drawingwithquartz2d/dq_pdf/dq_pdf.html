<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz 2D Programming Guide: PDF Document Creation, Viewing, and Transforming</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="PDF Document Creation, Viewing, and Transforming"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001066-CH214" title="PDF Document Creation, Viewing, and Transforming"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../dq_intro/dq_intro.html#//apple_ref/doc/uid/TP30001066-CH201-TPXREF101">Quartz 2D Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_layers/dq_layers.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_pdf_scan/dq_pdf_scan.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001066-CH214-TPXREF101" title="PDF Document Creation, Viewing, and Transforming"></a><h1>PDF Document Creation, Viewing, and Transforming</h1><p>PDF documents store resolution-independent vector graphics, text, and images as a series of commands written in a compact programming language. A PDF document can contain multiple pages of images and text. PDF is useful for creating cross-platform, read-only documents and for drawing resolution-independent graphics. </p><p>Quartz creates, for all applications, high-fidelity PDF documents that preserve the drawing operations of the application, as shown in <span class="content_text">Figure 13-1</span>. The resulting PDF may be optimized for a specific use (such as a particular printer, or for the web) by other parts of the system, or by third-party products. PDF documents generated by Quartz view correctly in Preview and Acrobat. </p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBJHDIH" title="Figure 13-1Quartz creates high-quality PDF documents "></a><p><strong>Figure 13-1&nbsp;&nbsp;</strong>Quartz creates high-quality PDF documents </p><img src = "../Art/postscript_to_pdf.gif" alt = "Quartz creates high-quality PDF documents" width="425" height="390"></div><br/><p>Quartz not only uses PDF as its “digital paper” but also includes as part of its API a number of functions that you can use to display and generate PDF files and to accomplish a number of other PDF-related tasks. The following tasks are discussed in this chapter:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-TPXREF109">“Opening and Viewing a PDF”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-CJBHCCIF">“Creating a Transform for a PDF Page”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-CJBHHJCB">“Creating a PDF File”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-BCIFAFBC">“Adding Links”</a></span></p></li><li class="li"><p><span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-BCIBGJFC">“Protecting PDF Content”</a></span></p></li></ul><p>For detailed information about PDF, including the PDF language and syntax, see <em>PDF Reference</em>, Fourth Edition, Version 1.5.</p><a name="//apple_ref/doc/uid/TP30001066-CH214-TPXREF109" title="Opening and Viewing a PDF"></a><h2>Opening and Viewing a PDF</h2><p>Quartz provides the data type <code>CGPDFDocumentRef</code> to represent a PDF document. You create a CGPDFDocument object using either the function <code><a href="../../../Reference/CGPDFDocument/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFDocumentCreateWithProvider" target="_top">CGPDFDocumentCreateWithProvider</a></code> or the function <code><a href="../../../Reference/CGPDFDocument/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFDocumentCreateWithURL" target="_top">CGPDFDocumentCreateWithURL</a></code>. After you create a CGPDFDocument object, you can draw it to a graphics context. <span class="content_text">Figure 13-2</span> shows a PDF document displayed by the PDFViewer sample application. After you install the Xcode Tools CD, you can find the Xcode project for this application in:</p><p><code>/Developer/Examples/Quartz/PDF/PDFViewer</code></p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBFGIAI" title="Figure 13-2A PDF document displayed by the PDFViewer sample application"></a><p><strong>Figure 13-2&nbsp;&nbsp;</strong>A PDF document displayed by the PDFViewer sample application</p><img src = "../Art/rooster_up.gif" alt = "A PDF document displayed by the PDFViewer sample application" width="376" height="361"></div><br/><p><span class="content_text">Listing 13-1</span> shows how to create a CGPDFDocument object and obtain the number of pages in the document. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBFFHHA" title="Listing 13-1A function that creates a CGPDFDocument object from a PDF file"></a><p class="codesample"><strong>Listing 13-1&nbsp;&nbsp;</strong>A function that creates a CGPDFDocument object from a PDF file</p><div class="codesample"><table><tr><td scope="row"><pre>CGPDFDocumentRef MyGetPDFDocumentRef (const char *filename)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef path;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFURLRef url;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPDFDocumentRef document;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    path = CFStringCreateWithCString (NULL, filename,<span></span></pre></td></tr><tr><td scope="row"><pre>                         kCFStringEncodingUTF8);<span></span></pre></td></tr><tr><td scope="row"><pre>    url = CFURLCreateWithFileSystemPath (NULL, path, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                        kCFURLPOSIXPathStyle, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease (path);<span></span></pre></td></tr><tr><td scope="row"><pre>    document = CGPDFDocumentCreateWithURL (url);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(url);<span></span></pre></td></tr><tr><td scope="row"><pre>    count = CGPDFDocumentGetNumberOfPages (document);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (count == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("`%s' needs at least one page!", filename);<span></span></pre></td></tr><tr><td scope="row"><pre>        return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return document;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the Core Foundation function to create a CFURL object from a CFString object that represents the filename of the PDF file to display.</p></li><li class="li"><p>Creates a CGPDFDocument object from a CFURL object.</p></li><li class="li"><p>Gets the number of pages in the PDF so that the next statement in the code can ensure that the document has at least one page. </p></li></ol><p>You can see how to draw a PDF page to a graphics context by looking at the code in <span class="content_text">Listing 13-2</span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBJGJBI" title="Listing 13-2A function that draws a PDF page "></a><p class="codesample"><strong>Listing 13-2&nbsp;&nbsp;</strong>A function that draws a PDF page </p><div class="codesample"><table><tr><td scope="row"><pre>void MyDisplayPDFPage (CGContextRef myContext,<span></span></pre></td></tr><tr><td scope="row"><pre>                    size_t pageNumber,<span></span></pre></td></tr><tr><td scope="row"><pre>                    const char *filename)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPDFDocumentRef document;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGPDFPageRef page;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect box;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    document = MyGetPDFDocumentRef (filename);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    page = CGPDFDocumentGetPage (document, pageNumber);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    CGContextDrawPDFPage (myContext, page);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    CGPDFDocumentRelease (document);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls your function (see <span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-CJBFFHHA">Listing 13-1</a></span>) to create a CGPDFDocument object from a file name you supply.</p></li><li class="li"><p>Gets the page for the specified page number from the PDF document.</p></li><li class="li"><p>Draws the specified page from the PDF file by calling the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextDrawPDFPage" target="_top">CGContextDrawPDFPage</a></code>. You need to supply a graphics context and the page to draw. For applications running in Mac OS X v10.3 and later, this function is recommended as a replacement for the older function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextDrawPDFDocument" target="_top">CGContextDrawPDFDocument</a></code>.</p></li><li class="li"><p>Releases the CGPDFDocument object.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBHCCIF" title="Creating a Transform for a PDF Page"></a><h2>Creating a Transform for a PDF Page</h2><p>Quartz provides a function—<code><a href="../../../Reference/CGPDFPage/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFPageGetDrawingTransform" target="_top">CGPDFPageGetDrawingTransform</a></code>—that creates an affine transform by mapping a box in a PDF page to a rectangle you specify. The prototype for this function is:</p><div class="codesample"><table><tr><td scope="row"><pre>CGAffineTransform CGPDFPageGetDrawingTransform (<span></span></pre></td></tr><tr><td scope="row"><pre>        CGPPageRef page,<span></span></pre></td></tr><tr><td scope="row"><pre>        CGPDFBox box,<span></span></pre></td></tr><tr><td scope="row"><pre>        CGRect rect,<span></span></pre></td></tr><tr><td scope="row"><pre>        int rotate,<span></span></pre></td></tr><tr><td scope="row"><pre>        bool preserveAspectRatio<span></span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>The function returns an affine transform using that following algorithm:</p><ul class="ul"><li class="li"><p>Intersects the rectangle associated with the type of PDF box you specify in the <code>box</code> parameter (media, crop, bleed, trim, or art) and the <code>/MediaBox</code> entry of the specified PDF page. The intersection results in an <strong>effective rectangle</strong>.</p></li><li class="li"><p>Rotates the effective rectangle by the amount specified by the <code>/Rotate</code> entry for the PDF page.</p></li><li class="li"><p>Centers the resulting rectangle on rectangle you supply in the <code>rect</code> parameter.</p></li><li class="li"><p> If the value of the <code>rotate</code> parameter you supply is nonzero and a multiple of 90, the function rotates the effective rectangle by the number of degrees you supply. Positive values rotate the rectangle to the right; negative values rotate the rectangle to the left. Note that you pass degrees, not radians. Keep in mind that is the <code>/Rotate</code> entry for the PDF page contains a rotation as well, the <code>rotate</code> parameter you supply is combined with the <code>/Rotate</code> entry. </p></li><li class="li"><p>Scales the effective rectangle, if necessary, so that it coincides with the edges of the rectangle you supply. </p></li><li class="li"><p>If you specify to preserve the aspect ratio by passing <code>true</code> in the <code>preserveAspectRatio</code> parameter, then the final rectangle coincides with the edges of the more restrictive dimension of the rectangle you supply in the <code>rect</code> parameter.</p></li></ul><p>You can use this function, for example, if you are writing a PDF viewing application similar to that shown in <span class="content_text"><a href="dq_pdf.html#//apple_ref/doc/uid/TP30001066-CH214-CJBJEBDF">Figure 13-3</a></span>. If you were to provide a Rotate Left/Rotate Right feature, you could call <code><a href="../../../Reference/CGPDFPage/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFPageGetDrawingTransform" target="_top">CGPDFPageGetDrawingTransform</a></code> to compute the appropriate transform for the current window size and rotation setting.</p><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBJEBDF" title="Figure 13-3A PDF page rotated 90 degrees to the right"></a><p><strong>Figure 13-3&nbsp;&nbsp;</strong>A PDF page rotated 90 degrees to the right</p><img src = "../Art/rooster_rotate.gif" alt = "A PDF page rotated 90 degrees to the right" width="375" height="361"></div><br/><p><span class="content_text">Listing 13-3</span> shows a function that creates an affine transform for a PDF page, using the parameters passed to the function, applies the transform, and then draws the PDF page. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBJCJEC" title="Listing 13-3Creating an affine transform for a PDF page"></a><p class="codesample"><strong>Listing 13-3&nbsp;&nbsp;</strong>Creating an affine transform for a PDF page</p><div class="codesample"><table><tr><td scope="row"><pre>void MyDrawPDFPageInRect (CGContextRef context,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CGPDFPageRef page,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CGPDFBox box,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CGRect rect,<span></span></pre></td></tr><tr><td scope="row"><pre>                    int rotation,<span></span></pre></td></tr><tr><td scope="row"><pre>                    bool preserveAspectRatio)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGAffineTransform m;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    m = CGPDFPageGetDrawingTransform (page, box, rect, rotation,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                                    preserveAspectRato);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSaveGState (context);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    CGContextConcatCTM (context, m);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    CGContextClipToRect (context,CGPDFPageGetBoxRect (page, box));<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    CGContextDrawPDFPage (context, page);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    CGContextRestoreGState (context);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates an affine transform from the parameters supplied to the function.</p></li><li class="li"><p>Saves the graphics state.</p></li><li class="li"><p>Concatenates the CTM with the affine transform.</p></li><li class="li"><p>Clips the graphics context to the rectangle specified by the <code>box</code> parameter. The function <code><a href="../../../Reference/CGPDFPage/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFPageGetBoxRect" target="_top">CGPDFPageGetBoxRect</a></code> obtains the page bounding box (media, crop, bleed, trim, and art boxes) associated with the constant you supply—<code>kCGPDFMediaBox</code>, <code>kCGPDFCropBox</code>, <code>kCGPDFBleedBox</code>, <code>kCGPDFTrimBox</code>, or <code>kCGPDFArtBox</code>. </p></li><li class="li"><p>Draws the PDF page to the transformed and clipped context.</p></li><li class="li"><p>Restores the graphics state.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBHHJCB" title="Creating a PDF File"></a><h2>Creating a PDF File</h2><p>It’s as easy to create a PDF file using Quartz 2D as it is to draw to any graphics context. You specify a location for a PDF file, set up a PDF graphics context, and use the same drawing routine you’d use for any graphics context. The function <code>MyCreatePDFFile</code>, shown in <span class="content_text">Listing 13-4</span>, shows all the tasks your code performs to create a PDF. A detailed explanation for each numbered line of code appears following the listing.</p><p>Note that the code delineates PDF pages by calling the functions <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextBeginPage" target="_top">CGContextBeginPage</a></code> and <code>CGContextEndPage</code>. In Mac OS X v10.4 and later, you should instead use the functions <code>CGPDFContextBeginPage</code> and <code>CGPDFContextEndPage</code>. One of the advantages of the newer functions is that you can pass a CFDictionary to specify page properties including the media, crop bleed, trim, and art boxes.  </p><p>For a list of dictionary key constants and a more detailed description of each, see <em><a href="../../../Reference/CGPDFContext/index.html#//apple_ref/doc/uid/TP30000957" target="_top">CGPDFContext Reference</a></em>.</p><a name="//apple_ref/doc/uid/TP30001066-CH214-CJBIGHBH" title="Listing 13-4A function that creates a PDF"></a><p class="codesample"><strong>Listing 13-4&nbsp;&nbsp;</strong>A function that creates a PDF</p><div class="codesample"><table><tr><td scope="row"><pre>void MyCreatePDFFile (CGRect pageRect, const char *filename)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextRef pdfContext;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef path;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFURLRef url;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableDictionaryRef myDictionary = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    path = CFStringCreateWithCString (NULL, filename, <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                                kCFStringEncodingUTF8);<span></span></pre></td></tr><tr><td scope="row"><pre>    url = CFURLCreateWithFileSystemPath (NULL, path, <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                     kCFURLPOSIXPathStyle, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease (path);<span></span></pre></td></tr><tr><td scope="row"><pre>    myDictionary = CFDictionaryCreateMutable(NULL, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;kCFTypeDictionaryKeyCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;kCFTypeDictionaryValueCallBacks); <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    CFDictionarySetValue(myDictionary, kCGPDFContextTitle, CFSTR("My PDF File"));<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDictionarySetValue(myDictionary, kCGPDFContextCreator, CFSTR("My Name"));<span></span></pre></td></tr><tr><td scope="row"><pre>    pdfContext = CGPDFContextCreateWithURL (url, &amp;pageRect, myDictionary); <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(myDictionary);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(url);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextBeginPage (pdfContext, &amp;pageRect); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    myDrawContent (pdfContext);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    CGContextEndPage (pdfContext);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    CGContextRelease (pdfContext);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Takes as parameters a rectangle that specifies the size of the PDF page and a string that specifies the filename.</p></li><li class="li"><p>Creates a CFString object from a filename passed to the function <code>MyCreatePDFFile</code>.</p></li><li class="li"><p>Creates a CFURL object from the CFString object.</p></li><li class="li"><p>Creates an empty CFDictionary object to hold metadata. The next two lines add a title and creator. You can add as many key-value pairs as you’d like using the function <code><a href="../../../../CoreFoundation/Reference/CFMutableDictionaryRef/Reference/reference.html#//apple_ref/c/func/CFDictionarySetValue" target="_top">CFDictionarySetValue</a></code>. For more information on creating dictionaries, see <em><a href="../../../../CoreFoundation/Reference/CFDictionaryRef/index.html#//apple_ref/doc/uid/20001195" target="_top">CFDictionary Reference</a></em>.</p></li><li class="li"><p>Creates a PDF graphics context, passing three parameters: </p><ul class="ul"><li class="li"><p>A CFURL object that specifies a location for the PDF data.</p></li><li class="li"><p>A pointer to a rectangle that defines the default size and location of the PDF page. The origin of the rectangle is typically (0, 0). Quartz uses this rectangle as the default bounds of the page media box. If you pass <code>NULL</code>, Quartz uses a default page size of 8.5 by 11 inches (612 by 792 points).</p></li><li class="li"><p>A CFDictionary object that contains PDF metadata. Pass <code>NULL</code> if you don’t have metadata to add. </p><p>In Mac OS X v10.4, you can use the CFDictionary object to specify output intent options—intent subtype, condition, condition identifier, registry name, destination output profile, and a human-readable text string that contains additional information or comments about the intended target device or production condition. For more information about output intent options, see <em><a href="../../../Reference/CGPDFContext/index.html#//apple_ref/doc/uid/TP30000957" target="_top">CGPDFContext Reference</a></em>.</p></li></ul></li><li class="li"><p>Signals the start of a page. When you use a graphics context that supports multiple pages (such as PDF), you call the function <code>CGContextBeginPage</code> together with <code>CGContextEndPage</code> to delineate the page boundaries in the output. Each page must be bracketed by calls to <code>CGContextBeginPage</code> and <code>CGContextEndPage</code>. Quartz ignores all drawing operations performed outside a page boundary in a page-based context.</p><p>In Mac OS X v10.4 and later, you should instead use the function <code>CGPDFContextBeginPage</code>, supplying the graphics context and a CFDictionary that contains key-value pairs to define the page properties.</p></li><li class="li"><p>Calls an application-defined function to draw content to the PDF context. You supply your drawing routine here.</p></li><li class="li"><p>Signals the end of a page in a page-based graphics context.</p><p>In Mac OS X v10.4 and later, if you previously called <code>CGPDFContextBeginPage</code>, then you must use the function <code>CGPDFContextEndPage</code> to signal the end of a page.</p></li><li class="li"><p>Releases the PDF context.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH214-BCIFAFBC" title="Adding Links"></a><h2>Adding Links</h2><p>You can add links and anchors to PDF context you create, starting with Mac OS X v10.4. Quartz provides three functions, each of which takes a PDF graphics context as a parameter, along with information about the links:</p><ul class="ul"><li class="li"><p><code><a href="../../../Reference/CGPDFContext/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFContextSetURLForRect" target="_top">CGPDFContextSetURLForRect</a></code> lets you specify a URL to open when the user clicks a rectangle in the current PDF page. </p></li><li class="li"><p><code><a href="../../../Reference/CGPDFContext/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFContextSetDestinationForRect" target="_top">CGPDFContextSetDestinationForRect</a></code> lets you set a destination to jump to when the user clicks a rectangle in the current PDF page. You must supply a destination name.</p></li><li class="li"><p><code><a href="../../../Reference/CGPDFContext/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFContextAddDestinationAtPoint" target="_top">CGPDFContextAddDestinationAtPoint</a></code> lets you set a destination to jump to when the user clicks a point in the current PDF page. You must supply a destination name.</p></li></ul><a name="//apple_ref/doc/uid/TP30001066-CH214-BCIBGJFC" title="Protecting PDF Content"></a><h2>Protecting PDF Content</h2><p>To protect PDF content (available starting in Mac OS X v10.4), there are a number of security options you can specify in the auxiliary dictionary you pass to the function <code><a href="../../../Reference/CGPDFContext/Reference/reference.html#//apple_ref/doc/c_ref/CGPDFContextCreate" target="_top">CGPDFContextCreate</a></code>. You can set the owner password, user password, and whether the PDF can be printed or copied by including the following keys in the auxiliary dictionary:</p><ul class="ul"><li class="li"><p><code>kCGPDFContextOwnerPassword</code>, to define the owner password of the PDF document. If this key is specified, the document is encrypted using the value as the owner password; otherwise, the document is not be encrypted. The value of this key must be a CFString object that can be represented in ASCII encoding. Only the first 32 bytes are used for the password. There is no default value for this key. If the value of this key cannot be represented in ASCII, the document is not created and the creation function returns <code>NULL</code>. In Mac OS X v10.4, Quartz uses 40-bit encryption.</p></li><li class="li"><p><code>kCGPDFContextUserPassword</code>, to define the user password of the PDF document. If the document is encrypted, then the value of this key is the user password for the document. If not specified, the user password is the empty string. The value of this key must be a CFString object that can be represented in ASCII encoding; only the first 32 bytes are used for the password. If the value of this key cannot be represented in ASCII, the document is not created and the creation function returns <code>NULL</code>.</p></li><li class="li"><p><code>kCGPDFContextAllowsPrinting</code> specifies whether the document can be printed when it is unlocked with the user password. The value of this key must be a CFBoolean object. The default value of this key is <code>kCFBooleanTrue</code>.</p></li><li class="li"><p><code>kCGPDFContextAllowsCopying</code> specifies whether the document can be copied when it is unlocked with the user password. The value of this key must be a CFBoolean object. The default value of this key is <code>kCFBooleanTrue</code>.</p></li></ul><p><span class="content_text"><a href="../dq_pdf_scan/dq_pdf_scan.html#//apple_ref/doc/uid/TP30001066-CH220-BAJBBFGF">Listing 14-4</a></span> (in the next chapter) shows code that checks PDF document to see if it’s locked and if it is, attempts to open the document with a password.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_layers/dq_layers.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_pdf_scan/dq_pdf_scan.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf/dq_pdf.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf/dq_pdf.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_pdf/dq_pdf.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>