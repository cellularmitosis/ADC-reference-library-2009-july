<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW510: AppleTalk Filing Protocol Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW510: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002572" title="AppleTalk Filing Protocol Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW510</div>
<div id="pageheadsub">AppleTalk Filing Protocol Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Section1">AFP error codes -5060,-5061, -5062, and -5063</a><BR><BR><a href="#Section2">How an AFP volume's allocation block size is calculated</a><BR><BR><a href="#Section3">Inside Macintosh Volume VI PBGetVolMountInfoSize typo</a><BR><BR><a href="#Section3">AFP 2.0 FPRead NewLine Mask change</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>AFP error codes -5060,-5061, -5062, and -5063</h2><p>Date Written:  1/18/93</p><p>Last reviewed:  6/14/93</p><p>What's AppleTalk error -5062? It seems to be an AppleTalk Filing Protocol errorof sorts but I can't find it documented anywhere.</p><p>Error -5062 is an <code>afpAlreadyMounted</code> error. You'll get it from the AppleShareexternal file system if you try to mount an AppleShare volume that's alreadymounted with <code>PBVolumeMount</code>. The three <code>PBVolumeMount</code>-related functions wereadded to System 7 very late during development, so <code>afpAlreadyMounted</code> (-5062),<code>afpBadDirIDType</code> (-5060), <code>afpCantMountMoreSrvrs</code> (-5061), and <code>afpSameNodeEr</code>(-5063) never made it into the public interface files.</p><h2>References:</h2><P><i>Inside Macintosh</i> Volume VI, pages 25-49 and 25-50</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>How an AFP volume's allocation block size is calculated</h2><p>Date Written:  8/15/91</p><p>Last reviewed:  8/16/91</p><p>The AppleTalk Filing Protocol (AFP) doesn't appear provide a way to learn aboutthe allocation block size of a server volume. So, how is the allocation blocksize determined on AFP server volumes? I noticed that the Macintosh Finderseems to calculate "size on disk" erratically for files on some AFP servervolumes. Is that a related problem?</p><p>All the workstation can get from an AFP server is the Bytes Total and BytesFree (returned by <code>FPGetVolParms</code> and <code>FPOpenVol</code>), so the AFP workstation codeestimates the value it uses in the allocation block size field (<code>vcbAlBlkSiz</code>) ofthe volume control block (VCB). The workstation code comes up with a value for<code>vcbAlBlkSiz</code> from the Bytes Total value returned to <code>FPOpenVol</code> when the volume isopened. The calculation used is:</p><p>This is the same value a local HFS volume would use. If an AFP server is notrunning on a Macintosh (and then, probably not using HFS), then this value maynot be what the server platform is actually using. And yes, the Finder uses theallocation block size in its calculations to decide how much space is used by afile, so the "size on disk" may not exactly reflect the amount of disk spaceactually used.</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>Inside Macintosh Volume VI PBGetVolMountInfoSize typo</h2><p>Date Written:  1/22/92</p><p>Last reviewed:  6/14/93</p><p>When I call <code>PBGetVolMountInfoSize</code> to get the size of an AppleShare volume'smounting information record, the function returns with no errors but <code>ioBuffer</code>points to garbage instead of the size of an <code>AFPVolMountInfo</code> record.</p><p>The problem you're having with <code>PBGetVolMountInfoSize</code> is a typo in <i>InsideMacintosh</i> Volume VI on page 25-48. In that call, the <code>ioBuffer</code> field shouldbe a pointer to a word (2-byte) size variable, not a long (4-byte) sizevariable.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>AFP 2.0 FPRead NewLine Mask change</h2><p>Date Written:  5/3/89</p><p>Last reviewed:  11/21/90</p><p>I'm confused about the changes to <code>FPRead</code> in AFP (AppleTalk Filing Protocol)version 2.0. How do I use the <code>NewLine</code> Mask?</p><p>The difference between AFP 1.1 and AFP 2.0 as far as the <code>NewLine</code> Mask isconcerned is that, in AFP 1.1, the only legal values of <code>NewLine</code> Mask are $00and $FF, whereas in AFP 2.0, all values of <code>NewLine</code> Mask are allowed. The<code>NewLine</code> Mask is logically ANDed with a copy of each byte read. If the resultmatches the <code>NewLine</code> character, the read terminates. The NewLine character isreturned as the last byte of data that was read from the fork.</p>                                      <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_510.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_510.html%3Fid%3DDTS10002572-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_510.html%3Fid%3DDTS10002572-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_510.html%3Fid%3DDTS10002572-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>