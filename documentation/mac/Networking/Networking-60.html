<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of AppleTalk Utilities(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING60></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-59.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-61.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-35.html"><B>Chapter 2 - AppleTalk Utilities</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING60-0></A>
<H1>Summary of AppleTalk Utilities</H1>
<A NAME=HEADING60-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING60-2></A>
<H3>Constants</H3>
<PRE>
CONST
   setSelfSend          =  256;        {allow intranode delivery, csCode}
   GetATalkInfo         =  258;        {get AppleTalk information, csCode}
</PRE>
<A NAME=HEADING60-4></A>
<H3>Data Types</H3>
<A NAME=HEADING60-5></A>
<H4>MPP Parameter Block for PSetSelfSend and PGetAppleTalkInfo</H4>
<PRE>
TYPE MPPParmType =   (...SetSelfSendParm,
                         GetAppleTalkInfoParm...);
TYPE MPPParamBlock = 
   PACKED RECORD
      qLink:               QElemPtr;      {reserved}
      qType:               Integer;       {reserved}
      ioTrap:              Integer;       {reserved}
      ioCmdAddr:           Ptr;           {reserved}
      ioCompletion:        ProcPtr;       {completion routine}
      ioResult:            OSErr;         {result code}
      ioNamePtr:           StringPtr;     {reserved}
      ioVRefNum:           Integer;       {reserved}
      ioRefNum:            Integer;       {driver reference number}
      csCode:              Integer;       {primary command code}
   CASE MPPParmType OF
      SetSelfSendParm:
         (newSelfFlag:     Byte;          {self-send toggle flag}
         oldSelfFlag:      Byte);         {previous self-send state}
      GetAppleTalkInfoParm: 
         (version:         Integer;       {requested info version}
         varsPtr:          Ptr;           {pointer to MPP variables}
         DCEPtr:           Ptr;           {pointer to MPP DCE}
         portID:           Integer;       {port number [0..7]}
         configuration:    LongInt;       {32-bit configuration word}
         selfSend:         Integer;       {nonzero if self-send enabled}
         netLo:            Integer;       {low value of network range}
         netHi:            Integer;       {high value of network range}
         ourAddr:          LongInt;       {our 24-bit AppleTalk address}
         routerAddr:       LongInt;       {24-bit address of last router}
         numOfPHs:         Integer;       {maximum number of protocol }
                                          { handlers}
         numOfSkts:        Integer;       {maximum number of static sockets}
         numNBPEs:         Integer;       {maximum concurrent NBP requests}
         ntQueue:          Ptr;           {pointer to registered name queue}
         LAlength:         Integer;       {length in bytes of data-link addr}
         linkAddr:         Ptr;           {data-link address returned}
         zoneName:         Ptr);          {zone name returned}
END;
MPPPBPtr =  ^MPPParamBlock;
</PRE>
<A NAME=HEADING60-8></A>
<H3>Routines</H3>
<A NAME=HEADING60-9></A>
<H4>Obtaining Information About the .MPP Driver and the Current Network Environment</H4>
<PRE>
FUNCTION PGetAppleTalkInfo(thePBptr: MPPPBPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING60-11></A>
<H4>Enabling Intranode Delivery of DDP Packets</H4>
<PRE>
FUNCTION PSetSelfSend(thePBptr: MPPPBPtr; async: Boolean): OSErr;
</PRE>
<A NAME=HEADING60-13></A>
<H4>Getting the Addresses of Your Node and Local Internet Router</H4>
<PRE>
FUNCTION GetNodeAddress(VAR myNode: Integer; VAR myNet: Integer): OSErr;
FUNCTION GetBridgeAddress: Integer;
</PRE>
<A NAME=HEADING60-16></A>
<H4>Opening and Closing Drivers</H4>
<PRE>
FUNCTION MPPOpen: OSErr;
FUNCTION MPPClose: OSErr;
FUNCTION IsMPPOpen: Boolean;
FUNCTION IsATPOpen:Boolean;
FUNCTION OpenXPP(VAR xppRefnum: Integer): OSErr;
</PRE>
<A NAME=HEADING60-22></A>
<H2>C Summary</H2>
<A NAME=HEADING60-23></A>
<H3>Constants</H3>
<PRE>
/*csCodes/
enum {
   setSelfSend       =     256,     /*intranode packet delivery*/
   GetATalkInfo      =     258      /*get AppleTalk information*/
};
</PRE>
<A NAME=HEADING60-25></A>
<H3>Data Types</H3>
<A NAME=HEADING60-26></A>
<H4>MPP Parameter Block <B>for</B> PSetSelfSend and PGetAppleTalkInfo</H4>
<PRE>
union ParamBlockRec {
   MPPparms       MPP;           /*general MPP parms*/
};

typedef MPPParamBlock *MPPPBPtr;
#define MPPATPHeader \
   QElem          *qLink;        /*reserved*/\
   short          qType;         /*reserved*/\
   short          ioTrap;        /*reserved*/\
   Ptr            ioCmdAddr;     /*reserved*/\
   ProcPtr        ioCompletion;  /*completion routine*/\
   OSErr          ioResult;      /*result code*/\
   long           userData;      /*reserved*/\
   short          reqTID;        /*reserved*/\
   short          ioRefNum;      /*driver reference number*/\
   short          csCode;        /*call command code*/

typedef struct {
   MPPATPHeader
   char     newSelfFlag;         /*self-send toggle flag*/
   char     oldSelfFlag;         /*previous self-send state*/
}SetSelfparms;

typedef struct {
   MPPATPHeader               
   short    version;          /*requested info version*/
   Ptr      varsPtr;          /*pointer to well-known MPP vars*/
   Ptr      DCEPtr;           /*pointer to MPP DCE*/
   short    portID;           /*port number [0..7]*/
   long     configuration;    /*32-bit configuration word*/
   short    selfSend;         /*nonzero if self-send enabled*/
   short    netLo;            /*low value of network range*/
   short    netHi;            /*high value of network range*/
   long     ourAdd;           /*our 24-bit AppleTalk address*/
   long     routerAddr;       /*24-bit address of last router*/
   short    numOfPHs;         /*maximum number of protocol handlers*/
   short    numOfSkts;        /*maximum number of static sockets*/
   short    numNBPEs;         /*maximum number of concurrent NBP requests*/
   Ptr      nTQueue;          /*pointer to registered name queue*/
   short    LAlength;         /*length in bytes of data-link addr*/
   Ptr      linkAddr;         /*data-link address returned*/
   Ptr      zoneName;         /*zone name returned*/
}GetAppleTalkInfoParm;
typedef union {
   MPPparms                   MPP;           /*general MPP parms*/
   SetSelfparms               SETSELF;
   GetAppleTalkInfoParm       GAIINFO;
}MPPParamBlock;
typedef MPPParamBlock *MPPPBPtr;
</PRE>
<A NAME=HEADING60-31></A>
<H3>Routines</H3>
<A NAME=HEADING60-32></A>
<H4>Obtaining Information About the .MPP Driver and the Current Network Environment</H4>
<PRE>
pascal OSErr PGetAppleTalkInfo
(MPPPBPtr thePBptr,Boolean async); 
</PRE>
<A NAME=HEADING60-34></A>
<H4>Enabling Intranode Delivery of DDP Packets</H4>
<PRE>
pascal OSErr PSetSelfSend(MPPPBPtr thePBptr,Boolean async); 
</PRE>
<A NAME=HEADING60-36></A>
<H4>Getting the Addresses of Your Node and Local Internet Router</H4>
<PRE>
pascal OSErr GetNodeAddress
(short *myNode,short *myNet); 
pascal short GetBridgeAddress
(void); 
</PRE>
<A NAME=HEADING60-39></A>
<H4>Opening and Closing Drivers</H4>
<PRE>
pascal OSErr MPPOpen(void); 
pascal OSErr MPPClose(void); 
pascal Boolean IsMPPOpen(void); 
pascal Boolean IsATPOpen(void);
pascal OSErr OpenXPP(short *xppRefnum); 
</PRE>
<A NAME=HEADING60-45></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING60-46></A>
<H3>Constants</H3>
<A NAME=HEADING60-47></A>
<H4>Unit Number for the .MPP driver</H4>
<PRE>
mppUnitNum     EQU      9         ;MPP unit number
mppRefNum      EQU      -10       ;MPP driver reference number
</PRE>
<A NAME=HEADING60-49></A>
<H4>Command Codes</H4>
<PRE>
setSelfSend    EQU      256       ;set to allow writes to self, control call
GetATalkInfo   EQU      258       ;get AppleTalk information, control call
</PRE>
<A NAME=HEADING60-51></A>
<H4>Zone and Router Bits</H4>
<PRE>
BadZoneHintBit EQU      7         ;1, if zone hint was found invalid when the
                                  ; .MPP driver was opened
RouterBit      EQU      30        ;1, if this is a router port
</PRE>
<A NAME=HEADING60-53></A>
<H4>MPP Queue Element Standard Structure</H4>
<PRE>
;arguments passed in the CSParam area
newSelfFlag    EQU      $1C       ;offset, new value for self-send flag
oldSelfFlag    EQU      $1D       ;old value of self-send flag
</PRE>
<A NAME=HEADING60-55></A>
<H4>GetAppleTalkInfo</H4>
<PRE>
GAIVersion     EQU      1        ;highest version for GAI params
</PRE>
<A NAME=HEADING60-57></A>
<H3>Data Structures</H3>
<A NAME=HEADING60-58></A>
<H4>MPP Parameter Block Common Fields for PGetAppleTalkInfo and PSetSelfSend
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>qLink<TD>long<TD>reserved<TR>
<TD>4<TD>qType<TD>word<TD>reserved<TR>
<TD>6<TD>ioTrap<TD>word<TD>reserved<TR>
<TD>8<TD>ioCmdAddr<TD>long<TD>reserved<TR>
<TD>12<TD>ioCompletion<TD>long<TD>address of completion routine<TR>
<TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>18<TD>ioNamePtr<TD>long<TD>reserved<TR>
<TD>22<TD>ioVRefNum<TD>word<TD>reserved<TR>
<TD>24<TD>ioRefNum<TD>word<TD>driver reference number</TABLE>
</H4>
<A NAME=HEADING60-59></A>
<H4>GetAppleTalkInfo Parameter Variant
<TABLE BORDER="0" CELLPADDING=3><TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>26<TD>csCode<TD>word<TD>command code; always <CODE>GetAppleTalkInfo</CODE> <TR>
<TD>28<TD>version<TD>word<TD>version of function<TR>
<TD>30<TD>varsPtr<TD>long<TD>pointer to the .MPP driver variables<TR>
<TD>34<TD>DCEPtr<TD>long<TD>pointer to DCE for the .MPP driver<TR>
<TD>38<TD>portID<TD>word<TD>port number<TR>
<TD>40<TD>configuration<TD>long<TD>configuration flags<TR>
<TD>44<TD>selfSend<TD>word<TD>nonzero if self-send is enabled<TR>
<TD>46<TD>netLo<TD>word<TD>low value of network range<TR>
<TD>48<TD>netHi<TD>word<TD>high value of network range<TR>
<TD>50<TD>ourAddr<TD>long<TD>local 24-bit AppleTalk address<TR>
<TD>54<TD>routerAddr<TD>long<TD>24-bit address of router<TR>
<TD>58<TD>numOfPHs<TD>word<TD>maximum number of protocol handlers<TR>
<TD>60<TD>numOfSkts<TD>word<TD>maximum number of static sockets<TR>
<TD>62<TD>numNBPEs<TD>word<TD>maximum number of concurrent NBP requests<TR>
<TD>64<TD>ntQueue<TD>long<TD>pointer to registered names table<TR>
<TD>68<TD>LAlength<TD>word<TD>length in bytes of data-link address (extended networks only)<TR>
<TD>70<TD>linkAddr<TD>long<TD>pointer to data-link address buffer (extended networks only)<TR>
<TD>74<TD>zoneName<TD>long<TD>pointer to zone name buffer</TABLE>
</H4>
<A NAME=HEADING60-60></A>
<H4>PSetSelfSend
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>always <CODE>setSelfSend</CODE><TR>
<TD>28<TD>newSelfFlag<TD>byte<TD>flag that turns intranode delivery on or off<TR>
<TD>29<TD>oldSelfFlag<TD>byte<TD>flag that reports the previous state of intranode delivery, whether it was on or off</TABLE>
 Parameter Variant</H4>
<A NAME=HEADING60-61></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>paramErr<TD>-50<TD>Version number is too high<TR>
<TD>portInUse<TD>-<B>97</B><TD>Driver open error code indicating that the port is in use<TR>
<TD>portNotCf<TD>-98<TD>Driver open error code indicating that the parameter RAM is not configured for this connection<B></B><TR>
<TD>noMPPErr<TD>-3102<TD><A NAME=MARKER-9-71></A>The .MPP driver is not installed</TABLE>
</H2>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-59.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-61.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
