<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Reverting to a Saved File (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING27></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-12.html"><B>Chapter 1 - Introduction to File Management</B></A> / <A HREF="Files-19.html"><B>Using Files</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H2>Reverting to a Saved File</H2>
 <A NAME=MARKER-9-207></A><A NAME=MARKER-2-196></A><A NAME=MARKER-2-43></A><A NAME=MARKER-2-79></A>Many applications that manipulate files provide a menu command that allows the user to revert to the last saved version of a document. The technique for handling this command is relatively simple. First you should display a dialog box asking whether to revert to the last saved version of the file, as illustrated in <A HREF=#MARKER-9-199>Figure 1-11</A>.<P>
<B>Figure 1-11  <A NAME=MARKER-9-199></A>A Revert to Saved dialog box</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/Revert.jpg"> <p>
 If the user clicks the Cancel button, nothing should happen to the current document. If, however, the user confirms the menu command by clicking OK, you just need to call <CODE>DoReadFile</CODE> to read the disk version of the file back into the window. <A HREF=#MARKER-9-200>Listing 1-14</A> illustrates how to implement a Revert to Saved menu command.<P>
<B>Listing 1-14  <A NAME=MARKER-9-200></A>Handling the Revert to Saved menu command</B><P>
<PRE>
FUNCTION DoRevertCmd: OSErr;
VAR
   myWindow:   WindowPtr;           {window for file data}
   myData:     MyDocRecHnd;         {handle to window data}
   myFile:     Integer;             {file reference number}
   myName:     Str255;              {file's name}
   myDialog:   DialogPtr;           {pointer to modal dialog box}
   myItem:     Integer;             {item selected in modal dialog}
   myPort:     GrafPtr;             {the original graphics port}
CONST
   kRevertDialog = 128;             {resource ID of Revert to Saved dialog}
BEGIN
   myWindow := FrontWindow;         {get pointer to front window}
                                    {get handle to window's data record}
   myData := MyDocRecHnd(GetWRefCon(myWindow));
   GetWTitle(myWindow, myName);     {get file's name}
   ParamText(myName, '', '', '');
   myDialog := GetNewDialog(kRevertDialog, NIL, WindowPtr(-1));
   GetPort(myPort);
   SetPort(myDialog);

   REPEAT
      ModalDialog(NIL, myItem);
   UNTIL (myItem = iOK) OR (myItem = iCancel);

   DisposeDialog(myDialog);
   SetPort(myPort);                 {restore previous grafPort}

   IF myItem = iOK THEN
      DoRevertCmd := DoReadFile(myWindow);
   ELSE
      DoRevertCmd := noErr;
END;
</PRE>
 The <CODE>DoRevertCmd</CODE> function retrieves the document record handle from the frontmost window's reference constant field and then gets the window's title (which is also the name of the file) and inserts it into a modal dialog box. <P>
 If the user clicks the OK button, <CODE>DoRevertCmd</CODE> calls the <CODE>DoReadFile</CODE> function to read the data from the file into the window. Otherwise, <CODE>DoRevertCmd</CODE> simply exits without changing the data in the window.<A NAME=MARKER-2-86></A><A NAME=MARKER-2-202></A><A NAME=MARKER-2-203></A><A NAME=MARKER-2-204></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
