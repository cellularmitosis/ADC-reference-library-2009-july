<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using Publisher and Subscriber Options(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING34></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-33.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-35.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A> / <A HREF="IAC-26.html"><B>Using the Edition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING34-0></A>
<H2><A NAME=MARKER-9-14></A>Using Publisher and Subscriber Options</H2>
 You can allow users to set several special options associated with publishers and subscribers. To set these preferences, users change settings in two dialog boxes provided by the Edition Manager: publisher options and subscriber options. To make these dialog boxes available to the user, provide a command in the Edit menu that toggles between Publisher Options (when the user has selected a publisher within a document) and Subscriber Options (when a user has selected a subscriber within a document).<A NAME=MARKER-2-127></A><A NAME=MARKER-2-193></A><A NAME=MARKER-2-338></A><A NAME=MARKER-2-215></A> <A NAME=MARKER-2-248></A><A NAME=MARKER-2-195></A><P>
 When a user chooses one of these menu commands, you need to display the appropriate dialog box. Use the <CODE>SectionOptionsDialog</CODE> function to display the publisher options or subscriber options dialog box on the user's screen.<P>
<PRE>
err := SectionOptionsDialog(reply);
</PRE>
 Each dialog box contains information regarding the section and its edition. <A HREF=#MARKER-9-230>Figure 2-13</A> shows the publisher options dialog box with the update mode set to On Save. <A NAME=MARKER-2-46></A><A NAME=MARKER-9-178></A><P>
<B>Figure 2-13  <A NAME=MARKER-9-230></A><A NAME=MARKER-21-231></A>The publisher options dialog box with update mode set to On Save</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ED-S-13.gif"><P>
 <A HREF=#MARKER-9-232>Figure 2-14</A> shows the publisher options dialog box with the update mode set to Manually.<P>
<B>Figure 2-14  <A NAME=MARKER-9-232></A>The publisher options dialog box with update mode set to <A NAME=MARKER-21-233></A>Manually </B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ED-S-14.gif"><P>
 As a shortcut for the user, you should display the publisher options dialog box when the user double-clicks a publisher section in a document. <P>
 <A HREF=#MARKER-9-238>Figure 2-15</A> shows the subscriber options dialog box with the update mode set to Automatically. <A NAME=MARKER-9-203></A><A NAME=MARKER-2-337></A><A NAME=MARKER-2-233></A><A NAME=MARKER-2-237></A><P>
<B>Figure 2-15  <A NAME=MARKER-9-238></A><A NAME=MARKER-21-239></A>The subscriber options dialog box with update mode set to Automatically </B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ED-S-15.gif"><P>
 <A HREF=#MARKER-9-240>Figure 2-16</A> shows the subscriber options dialog box with the update mode set to Manually.<P>
<B>Figure 2-16  <A NAME=MARKER-9-240></A><A NAME=MARKER-21-241></A>The subscriber options dialog box with update mode set to Manually</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ED-S-16.gif"><P>
 As a shortcut for the user, you should display the subscriber options dialog box when the user double-clicks a subscriber section in a document.<A NAME=MARKER-9-171></A><A NAME=MARKER-2-46></A><P>
 You pass a section options reply record as a parameter to the <CODE>SectionOptionsDialog</CODE> function.<A NAME=MARKER-2-47></A><P>
<PRE>
TYPE SectionOptionsReply = 
   RECORD
      canceled:   Boolean;          {user clicked Cancel}
      changed:    Boolean;          {changed section record}
      sectionH:   SectionHandle;    {handle to the specified }
                                    { section record}
      action:     ResType;          {action codes}
   END;
</PRE>
 Set the <CODE>sectionH</CODE> parameter to the handle to the section record for the section the user selected.<A NAME=MARKER-2-48></A><P>
 Upon return of the <CODE>SectionOptionsDialog</CODE> function, the <CODE>canceled</CODE> and <CODE>changed</CODE> fields are set. If the <CODE>canceled</CODE> field is set to <CODE>TRUE</CODE>, the user clicked Cancel. Otherwise, this field is set to <CODE>FALSE</CODE>. If the <CODE>changed</CODE> field is set to <CODE>TRUE</CODE>, the section record is changed. For example, the user may have changed the update mode.<A NAME=MARKER-9-98></A><A NAME=MARKER-2-113></A><P>
 The <CODE>SectionOptionsDialog</CODE> function returns in the <CODE>action</CODE> parameter the code for one of five user actions. The function dismisses the publisher and subscriber options dialog boxes after the user clicks a button.<A NAME=MARKER-2-305></A><P>
<UL>
<LI>Action code is <CODE>'read'</CODE> for a click of the Get Edition Now button.
<LI>Action code is <CODE>'writ'</CODE> for a click of the Send Edition Now button.
<LI>Action code is <CODE>'goto'</CODE> for a click of the Open Publisher button.
<LI>Action code is <CODE>'cncl'</CODE> for a click of the Cancel Publisher or Cancel Subscriber button.
<LI>Action code is <CODE>'    '</CODE> ($20202020) for a click of the OK button. <A NAME=MARKER-2-236></A><P>
</UL>
 <A HREF=#MARKER-9-250>Listing 2-8</A> shows an example of how your application can respond to the action codes received from the section options reply record. You can use several different techniques for this purpose; this listing shows one technique.<P>
<B>Listing 2-8  <A NAME=MARKER-9-250></A><A NAME=MARKER-21-251></A>Responding to action codes</B><P>
<PRE>
PROCEDURE DoOptionsDialog(theSection: SectionHandle);
VAR
   reply:            SectionOptionsReply;
   theEditionInfo:   EditionInfoRecord;
   action:           ResType;
   sodErr, geiErr:   OSErr;
   gpiErr, gpsErr:   OSErr;

BEGIN
   reply.sectionH := theSection;
   {display options dialog box}
   sodErr := SectionOptionsDialog(reply);
   {determine what the user did and handle appropriately}
   IF reply.canceled THEN  {user selected the Cancel button}
      EXIT(DoOptionsDialog);
   IF reply.changed THEN
      {the section record has changed; make note of this}
      MySectionHasChanged(theSection);
      {if you customize, you may want to do some }
      { post-processing now}
   {get the action code}
   action := reply.action;
   IF (action = 'read') THEN
   BEGIN    {user selected Get Edition Now button}
      DoReadEdition(theSection);
      EXIT(DoOptionsDialog);
   END;
   IF (action = 'writ') THEN
   BEGIN    {user selected Send Edition Now button}
      DoWriteEdition(theSection);
      EXIT(DoOptionsDialog);
   END;
   IF (action = 'goto') THEN
   BEGIN    {user selected Open Publisher button}
      geiErr := GetEditionInfo(theSection, theEditionInfo);
      IF geiErr &lt;&gt; noErr THEN 
         MyErrHandler(geiErr);{handle error and exit}
      gpsErr := GotoPublisherSection(theEditionInfo.container);
      IF gpsErr &lt;&gt; noErr THEN
         MyErrHandler(gpsErr);{handle error and exit}
      EXIT(DoOptionsDialog);
   END;
   IF (action = 'cncl') THEN
   BEGIN {User selected Cancel Publisher or Cancel Subscriber }
      { button. Call the UnRegisterSection function and dispose }
      { of the section record and alias record.}
      EXIT(DoOptionsDialog);
   END;
END;
</PRE>
 The following sections describe the features of the publisher and subscriber options dialog boxes.<P>
<A NAME=HEADING34-32></A>
<H3><A NAME=MARKER-21-252></A>Publishing a New Edition While Saving or Manually</H3>
 By default, your application should write publisher data to an edition each time the user saves the document and the contents of the publisher differ from the latest edition. In the publisher options dialog box, the user can choose to write new data to an edition each time the document is saved (by clicking On Save) or only upon the user's specific request (by clicking Manually).<A NAME=MARKER-2-449></A><A NAME=MARKER-9-120></A><P>
 When the update mode is set to manual, a user must click the Send Edition Now button in the publisher options dialog box to write publisher data to an edition. When a user clicks this button, the section options reply record contains the action code <CODE>'writ'</CODE>. In this case, you should write out the new edition. Writing to an edition manually is useful when a user tends to save a document numerous times while revising it.<P>
 Each time the user saves the document, check the update mode of the publisher section. If the publisher section sends its data to an edition when the document is saved, check whether the publisher data has changed since it was last written to the edition. If so, write the publisher's data to the new edition.<P>
 In addition, you may also support a Stop All Editions menu command to provide a method for temporarily suspending all update activity. See <A HREF=IAC-24.html#MARKER-9-3>"Introduction to Publishers, Subscribers, and Editions" beginning on page 2-4</A> for additional information.<A NAME=MARKER-9-160></A><P>
<A NAME=HEADING34-37></A>
<H3><A NAME=MARKER-21-256></A>Subscribing to an Edition Automatically or Manually</H3>
 By default, your application should subscribe to an edition each time new edition data becomes available. In the subscriber options dialog box, the user can choose to read new data from an edition as the data is available (by clicking Automatically) or only upon the user's specific request (by clicking Manually).<A NAME=MARKER-2-64></A><P>
 When the update mode is set to manual, the user must click the Get Edition Now button in the subscriber options dialog box to receive new editions. When a user clicks this button, the section options reply record contains the action code <CODE>'read'</CODE>. In this case, you should read in the new edition. See <A HREF=IAC-33.html#MARKER-9-207>"Opening an Edition Container to Read Data" beginning on page 2-41</A> for detailed information.<P>
 When the update mode is set to automatic, your application receives a Section Read event each time a new edition becomes available. In response, you should read the new edition data beginning with the <CODE>OpenEdition</CODE> function.<P>
 Your application does not receive Section Read events for subscribers that receive new editions manually.<P>
 You may also support a Stop All Editions menu command to provide a method for temporarily suspending all update activity. See <A HREF=IAC-24.html#MARKER-9-3>"Introduction to Publishers, Subscribers, and Editions" beginning on page 2-4</A> for additional information<A NAME=MARKER-9-455></A>.<P>
<A NAME=HEADING34-43></A>
<H3><A NAME=MARKER-9-259></A><A NAME=MARKER-21-260></A>Canceling Sections Within Documents</H3>
 The option of canceling publishers and subscribers is available to the user through the Cancel Publisher and Cancel Subscriber buttons in the corresponding options dialog boxes. When the user clicks one of these buttons, the action code of the section options reply record is <CODE>'cncl'</CODE>. See <A HREF=IAC-237.html#MARKER-9-103>"Relocating an Edition" on page 2-60</A> for additional information on canceling a section.<A NAME=MARKER-9-129></A><A NAME=MARKER-9-16></A><A NAME=MARKER-2-18></A><P>
 When a user cancels a section (either a publisher or subscriber) and then saves the document, or when a user closes an untitled document (which contains newly created sections) without saving it, you must unregister each corresponding section record and alias record using the <CODE>UnRegisterSection</CODE> function. In addition, you should also delete the section record and alias record using the <CODE>DisposeHandle</CODE> procedure. See <I><A HREF="../Memory/Memory-2.html">Inside Macintosh: Memory</A></I> for additional information on the <CODE>DisposeHandle</CODE> procedure.<A NAME=MARKER-2-17></A><P>
 When a user cancels a publisher section and then saves the document, or when a user closes an untitled document (which contains newly created publishers) without saving it, you must also delete any corresponding edition containers (in addition to deleting section records and alias records).<P>
 Do not delete an edition container file, section record, or alias record until the user saves the document; the user may decide to undo changes before saving the document.<A NAME=MARKER-2-72></A><A NAME=MARKER-2-73></A><P>
 To locate the appropriate edition container to be deleted (before you use the <CODE>UnRegisterSection</CODE> function), use the <CODE>GetEditionInfo</CODE> function.<A NAME=MARKER-2-30></A><P>
<PRE>
err := GetEditionInfo(sectionH, editionInfo);
</PRE>
 The <CODE>editionInfo</CODE> parameter is a record of data type <CODE>EditionInfoRecord</CODE>.<P>
<PRE>
TYPE EditionInfoRecord = 
   RECORD
      crDate:     TimeStamp;           {date edition container }
                                       { was created}
      mdDate:     TimeStamp;           {date of last change}
      fdCreator:  OSType;              {file creator}
      fdType:     OSType;              {file type}
      container:  EditionContainerSpec;{the edition}
   END;
</PRE>
 The <CODE>GetEditionInfo</CODE> function returns the edition container as part of the edition information.<A NAME=MARKER-2-75></A><P>
 The <CODE>crDate</CODE> field contains the creation date of the edition. The <CODE>mdDate</CODE> field contains the modification date of the edition.<A NAME=MARKER-2-269></A><A NAME=MARKER-2-189></A><P>
 The <CODE>fdType</CODE> and the <CODE>fdCreator</CODE> fields are the type and creator of the edition file. The <CODE>container</CODE> field includes a volume reference number, directory ID, filename, script, and part number for the edition.<A NAME=MARKER-2-76></A><A NAME=MARKER-9-192></A><A NAME=MARKER-2-275></A><P>
 To remove the edition container, use the <CODE>DeleteEditionContainerFile</CODE> function.<A NAME=MARKER-9-48></A><A NAME=MARKER-2-34></A><P>
<PRE>
err := DeleteEditionContainerFile(editionFile);
</PRE>
<A NAME=HEADING34-57></A>
<H3><A NAME=MARKER-21-276></A>Locating a Publisher Through a Subscriber</H3>
 The user can locate a publisher from a subscriber within a document by clicking the Open Publisher button in the subscriber options dialog box. As a shortcut, Apple suggests that you also allow the user to locate a publisher by selecting a subscriber in a document and pressing Option-double-click.<A NAME=MARKER-2-506></A><P>
 When the action code of the <CODE>SectionOptionsReply</CODE> record is <CODE>'goto'</CODE>, use the <CODE>GoToPublisherSection</CODE> function.<A NAME=MARKER-9-522></A><P>
<PRE>
err := GoToPublisherSection(container);
</PRE>
 The <CODE>GoToPublisherSection</CODE> function locates the correct document by resolving the alias in the edition, and it launches the document's application if necessary (the Edition Manager sends an Open Documents event). The Edition Manager then sends the publishing application a Section Scroll event. If the document containing the requested publisher is located on the same computer as its subscriber, the document opens and scrolls to the location of the publisher. If the document containing the requested publisher is located on a shared volume (using file sharing), the document opens and scrolls to the location of the publisher only if the user has privileges to open the document from the Finder.<P>
 You need to provide the <CODE>GoToPublisherSection</CODE> function with the edition container. To accomplish this, use the <CODE>GetEditionInfo</CODE> function. See the previous section, <A HREF=#MARKER-9-259>"Canceling Sections Within Documents,"</A> for information on the <CODE>GetEditionInfo</CODE> function.<A NAME=MARKER-2-78></A><A NAME=MARKER-2-79></A><A NAME=MARKER-21-243></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-33.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-35.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
