<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>usher - /sources/PresInfoWindow.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; <A HREF="javascript:location.replace('index.html');">usher</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/index.html" target="_blank">Reference Library > QuickTime</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">usher</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/sources/PresInfoWindow.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/notes/usingusher.htm</option>
<option value="listing2.html">/sources/AppSupport.c</option>
<option value="listing3.html">/sources/AppSupport.h</option>
<option value="listing4.html">/sources/MovieSourcing.c</option>
<option value="listing5.html">/sources/MovieSourcing.h</option>
<option value="listing6.html">/sources/PresInfoWindow.c</option>
<option value="listing7.html">/sources/PresInfoWindow.h</option>
<option value="listing8.html">/sources/PresinfoWindow.r</option>
<option value="listing9.html">/sources/QTSSampleCodeUtils.c</option>
<option value="listing10.html">/sources/QTSSampleCodeUtils.h</option>
<option value="listing11.html">/sources/SimplePres.c</option>
<option value="listing12.html">/sources/SimplePres.h</option>
<option value="listing13.html">/sources/SourcingSupport.c</option>
<option value="listing14.html">/sources/SourcingSupport.h</option>
<option value="listing15.html">/sources/usher.r</option>
<option value="listing16.html">/sources/UsherBroadcast.c</option>
<option value="listing17.html">/sources/UsherBroadcast.h</option>
<option value="listing18.html">/sources/UsherCarbon.r</option>
<option value="listing19.html">/sources/UsherCommands.h</option>
<option value="listing20.html">/sources/UsherMinWindow.c</option>
<option value="listing21.html">/sources/UsherMinWindow.h</option>
<option value="listing22.html">/sources/UsherMinWindow.r</option>
<option value="listing23.html">/sources/UsherNew.c</option>
<option value="listing24.html">/sources/UsherNew.h</option>
<option value="listing25.html">/sources/usherRezDefines.h</option>
<option value="listing26.html">/sources/WindowSupport.c</option>
<option value="listing27.html">/sources/WindowSupport.h</option>
<option value="listing28.html">/UsherReleaseNotes.txt</option></select>
				</p>
				</form>
				<p><strong><a href="usher.zip">Download Sample</a></strong> (&#147;usher.zip&#148;, 212.3K)<BR>
<strong><a href="usher.dmg">Download Sample</a></strong> (&#147;usher.dmg&#148;, 293.2K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    PresInfoWindow.c  Copyright:  &copy; 2000-2001 by Apple Computer, Inc., all rights reserved.*/#include &lt;ConditionalMacros.h&gt;#include &lt;Resources.h&gt;#include &lt;TextUtils.h&gt;#include &lt;string.h&gt;#include &lt;QuicktimeComponents.h&gt;#include &lt;MoviesFormat.h&gt;#include &lt;Movies.h&gt;#include &lt;QuickTimeStreaming.h&gt;#include &lt;QTStreamingComponents.h&gt;#include &quot;QTSSampleCodeUtils.h&quot;#include &quot;WindowSupport.h&quot;#include &quot;presinfowindow.h&quot;#include &quot;UsherBroadcast.h&quot;#include &quot;UsherCommands.h&quot;  // ---------------------------------------------------------------------------//    D E F I N I T I O N S// ---------------------------------------------------------------------------struct PresInfoWindowRecord {  StandardWindowRecord    standard;  UsherBroadcast        *broadcast;  WindowPtr          parentWindow;    QTSPresentation        qtsPresentation;  QTSStatHelper        statHelperAll;  QTSStatHelper        statHelperShort;  Handle            ditlHandle;  ControlHandle        vScroll;  ControlHandle        hScroll;  long            lastUpdateTime;    // in ticks  long            updateInterval;    // in ticks  SInt32            dirtyFlags;  SInt32            drawingCount;  GrafPtr            oldPort;  short            labelFont;  short            labelFontSize;  short            font;  short            fontSize;  FontInfo          fontInfo;  Rect            boundsGutterInfo;  Rect            textItemGutterInfo;  short            lineHeight;};typedef struct PresInfoWindowRecord PresInfoWindowRecord, *PresInfoWindPeek;#define kPresInfoWindDefaultUpdateInterval    60  // in ticks//#define kPresInfoWindDefaultLabelFont    systemFont#define kPresInfoWindDefaultLabelFont    applFont#define kPresInfoWindDefaultLabelFontSize  9#define kPresInfoWindDefaultFont      applFont#define kPresInfoWindDefaultFontSize    9// top, left, bottom, right#define kPresInfoWindDefaultBoundsGutterInfo    {2,5,2,5}//#define kPresInfoWindDefaultTextItemGutterInfo    {2,2,2,2}#define kPresInfoWindDefaultTextItemGutterInfo    {2,0,0,0}enum  {  kPresInfoWindDrawingFlag_Erase    = 0x00000001};enum  {  kPresInfoWindDirtyFlag_Stats = 0x00000001};// ---------------------------------------------------------------------------//    P R O T O T Y P E S// ---------------------------------------------------------------------------static void PresInfoWindPriv_SetupFontInfo(PresInfoWindowRecord *inWindData);static void PresInfoWindPriv_Dispose(PresInfoWindowRecord *inWindData);static Boolean PresInfoWindPriv_GetWindData(WindowPtr inWindow, PresInfoWindowRecord **outWindData);static void PresInfoWindPriv_SetBroadcast(PresInfoWindowRecord *inWindData, UsherBroadcast *inBroadcast);static void PresInfoWindPriv_GetReadyToDraw(PresInfoWindowRecord *inWindData);static void PresInfoWindPriv_FinishedDrawing(PresInfoWindowRecord *inWindData);static void PresInfoWindPriv_DrawStats(PresInfoWindowRecord *inWindData, QTSStatHelper inStatHelper);static void PresInfoWindPriv_UpdateIfNecessary(PresInfoWindowRecord *inWindData);static void PresInfoWindPriv_Update(PresInfoWindowRecord *inWindData);// ---------------------------------------------------------------------------//    PresInfoWind_New// ---------------------------------------------------------------------------OSErr PresInfoWind_New(WindowPtr *outWindow){  OSErr          err = noErr;  WindowPtr        window = NULL;  Rect          windowBounds = {100,100,400,400};  PresInfoWindowRecord  *windData = NULL;  Str255          tempString;  DialogTHndl        dlogHandle = NULL;  Rect          defaultBoundsGutter = kPresInfoWindDefaultBoundsGutterInfo;  Rect          defaultTextItemGutter = kPresInfoWindDefaultTextItemGutterInfo;  dlogHandle = (DialogTHndl)GetResource('DLOG', rDLOG_PresInfoWindow);  if (dlogHandle == NULL)  {    DEBUGF((&quot;PresInfoWind_New - null dlog resource&quot;));    EXITERR( err = memFullErr );  }  windowBounds = (**dlogHandle).boundsRect;  #if TARGET_API_MAC_CARBON  EXITIFERR( err = CreateNewWindow( kDocumentWindowClass,         kWindowCloseBoxAttribute /* + kWindowResizableAttribute, um */,         &amp;windowBounds,         &amp;window ) );#else  window = NewCWindow(nil, &amp;windowBounds, (StringPtr)&quot;&quot;,        false, documentProc, (WindowPtr)kFirstWindowOfClass, true, 0L);#endif  if (window == NULL)  {    DEBUGF((&quot;PresInfoWind_New - null window&quot;));    EXITERR( err = memFullErr );  }    windData = (PresInfoWindowRecord*)QTSNewPtrClear(sizeof(*windData));  EXITIFERR( err = MemError() );    WindowSupport_InitStandardRecord(&amp;windData-&gt;standard, kSignature_PresInfoWind, window);  SetWRefCon(window, (long)windData);    windData-&gt;updateInterval = kPresInfoWindDefaultUpdateInterval;  windData-&gt;labelFont = kPresInfoWindDefaultLabelFont;  windData-&gt;labelFontSize = kPresInfoWindDefaultLabelFontSize;  windData-&gt;font = kPresInfoWindDefaultFont;  windData-&gt;fontSize = kPresInfoWindDefaultFontSize;  windData-&gt;boundsGutterInfo = defaultBoundsGutter;  windData-&gt;textItemGutterInfo = defaultTextItemGutter;  PresInfoWindPriv_SetupFontInfo(windData);    windData-&gt;ditlHandle = GetResource('DITL', rDITL_PresInfoWindow);   if (windData-&gt;ditlHandle == NULL)  {    DEBUGF((&quot;PresInfoWind_New - null ditlhandle&quot;));    EXITERR( err = memFullErr );  }  DetachResource(windData-&gt;ditlHandle);  GetIndString(tempString, rStringList_PresInfoWindow, kPresInfoWindString_DefaultName);  SetWTitle(window, tempString);  //ShowWindow(window);  *outWindow = window;exit:  if (err != noErr)  {    if (windData != NULL)  {      PresInfoWind_Close(window);    }  else  {        }  }  return err;}// ---------------------------------------------------------------------------//    PresInfoWindPriv_SetupFontInfo// ---------------------------------------------------------------------------static void PresInfoWindPriv_SetupFontInfo(PresInfoWindowRecord *inWindData){  GrafPtr    oldPort;    GetPort(&amp;oldPort);    TextFont(inWindData-&gt;font);  TextSize(inWindData-&gt;fontSize);    GetFontInfo(&amp;inWindData-&gt;fontInfo);  inWindData-&gt;lineHeight = inWindData-&gt;fontInfo.ascent + inWindData-&gt;fontInfo.descent + inWindData-&gt;fontInfo.leading             + inWindData-&gt;textItemGutterInfo.top + inWindData-&gt;textItemGutterInfo.bottom;    MacSetPort(oldPort);}// ---------------------------------------------------------------------------//    PresInfoWind_Close// ---------------------------------------------------------------------------void PresInfoWind_Close(WindowPtr inWindow){  PresInfoWindowRecord    *windData = NULL;  if (inWindow != NULL)  {    if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {      DEBUGF((&quot;PresInfoWind_Close $%.8x - couldnt get wind data&quot;, inWindow));      goto exit;    }        if (windData-&gt;statHelperAll != 0)  {      QTSDisposeStatHelper(windData-&gt;statHelperAll);        }    if (windData-&gt;statHelperShort != 0)  {      QTSDisposeStatHelper(windData-&gt;statHelperShort);        }        if (windData-&gt;parentWindow != NULL)  {      WindowSupport_HandleMessage(windData-&gt;parentWindow, kMessage_WindowClosing, windData-&gt;standard.window);    }    PresInfoWindPriv_Dispose(windData);  }  DisposeWindow(inWindow);  exit:  return;}// ---------------------------------------------------------------------------//    PresInfoWindPriv_Dispose// ---------------------------------------------------------------------------static void PresInfoWindPriv_Dispose(PresInfoWindowRecord *inWindData){  if (inWindData != NULL)  {    if ((inWindData-&gt;broadcast != NULL)  &amp;&amp;  (inWindData-&gt;standard.window != NULL))  {      // tell the broadcast we went away...      UsherBroadcast_RemoveWindow(inWindData-&gt;broadcast, inWindData-&gt;standard.window);    }    DisposeHandle(inWindData-&gt;ditlHandle);    DisposePtr((Ptr)inWindData);  }}// ---------------------------------------------------------------------------//    PresInfoWindPriv_GetWindData// ---------------------------------------------------------------------------static Boolean PresInfoWindPriv_GetWindData(WindowPtr inWindow, PresInfoWindowRecord **outWindData){  *outWindData = NULL;  if (inWindow != NULL)  {    *outWindData = (PresInfoWindowRecord*)GetWRefCon(inWindow);    if (*outWindData != NULL)  {      if ((*outWindData)-&gt;standard.signature != kSignature_PresInfoWind)  {        DEBUGF((&quot;PresInfoWind_GetWindData $%.8x $%.8x bad signature '%.4s'&quot;, inWindow, *outWindData, &amp;(*outWindData)-&gt;standard.signature));        *outWindData = NULL;      }    }  }  return (*outWindData != NULL);}#pragma mark -// ---------------------------------------------------------------------------//    PresInfoWind_Idle// ---------------------------------------------------------------------------void PresInfoWind_Idle(WindowPtr inWindow){  PresInfoWindowRecord    *windData;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_Idle $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }    PresInfoWindPriv_UpdateIfNecessary(windData);    if (windData-&gt;dirtyFlags != 0)  {    PresInfoWind_Draw(inWindow);  }    exit:  return;}// ---------------------------------------------------------------------------//    PresInfoWind_GetMenuCommand// ---------------------------------------------------------------------------long PresInfoWind_GetMenuCommand(WindowPtr inWindow, long inMenuResult, void **outCommandParams){#pragma unused(outCommandParams)  PresInfoWindowRecord    *windData;  short            menuID, menuItem;  SInt32            command = kCommand_Nothing;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_GetMenuCommand $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }  menuID = (short)MYHIWORD(inMenuResult);  menuItem = (short)MYLOWORD(inMenuResult);  switch (menuID)  {    default:      break;  }    if (command == kCommand_Nothing)  {    if (windData-&gt;broadcast != 0)  {      command = UsherBroadcast_GetMenuCommand(windData-&gt;broadcast, inMenuResult, outCommandParams);    }  }  exit:  return command;}// ---------------------------------------------------------------------------//    PresInfoWind_DoCommand// ---------------------------------------------------------------------------OSErr PresInfoWind_DoCommand(WindowPtr inWindow, long inCommand, void *inCommandParams){#pragma unused(inCommandParams)  PresInfoWindowRecord  *windData;  OSErr          err = noErr;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_DoCommand $%.8x - couldnt get wind data&quot;, inWindow));    EXITERR( err = kErr_AppUnhandledCommand );  }    switch (inCommand)  {      default:      if (windData-&gt;broadcast != 0)  {        err = UsherBroadcast_DoCommand(windData-&gt;broadcast, inCommand, inCommandParams);      }  else  {        err = kErr_AppUnhandledCommand;      }      break;  }exit:  return err;}// ---------------------------------------------------------------------------//    PresInfoWind_GrowWindow// ---------------------------------------------------------------------------void PresInfoWind_GrowWindow(WindowPtr inWindow, EventRecord *inEvent){  PresInfoWindowRecord    *windData;  GrafPtr            oldPort;  Rect            oldWindowRect;  Rect            newWindowRect;  Rect            itemRect;  Rect            bbox;  long            result;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;UserInfoWind_GrowWindow $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }  GetPort(&amp;oldPort);  SetPortWindowPort(inWindow);#define kPresInfoWindMinWidth    250#define kPresInfoWindMinHeight    150#define kPresinfoWindMaxWidth    30000#define kPresInfoWindMaxHeight    30000    bbox.left = kPresInfoWindMinWidth;  bbox.top = kPresInfoWindMinHeight;  bbox.right = kPresinfoWindMaxWidth;  bbox.bottom = kPresInfoWindMaxHeight;    result = GrowWindow(inWindow, inEvent-&gt;where, &amp;bbox);  if (result != 0)  {    if ((MYLOWORD(result) &lt; 0)  ||   (MYHIWORD(result) &lt; 0))  {      DEBUGF((&quot;grow result $%.8x&quot;, result));      goto exit;    }    // resize the window, including the stats area    CopyPortBounds(GetWindowPort(inWindow), &amp;oldWindowRect);    SizeWindow(inWindow, (short)MYLOWORD(result), (short)MYHIWORD(result), true);    CopyPortBounds(GetWindowPort(inWindow), &amp;newWindowRect);    DITLGetItemRect(windData-&gt;ditlHandle, rPresInfoWindDITLItem_InfoArea, &amp;itemRect);    itemRect.right += (newWindowRect.right - newWindowRect.left - (oldWindowRect.right - oldWindowRect.left));    itemRect.bottom += (newWindowRect.bottom - newWindowRect.top - (oldWindowRect.bottom - oldWindowRect.top));    DITLSetItemRect(windData-&gt;ditlHandle, rPresInfoWindDITLItem_InfoArea, &amp;itemRect);    InvalWindowRect(inWindow, &amp;itemRect);  }exit:  MacSetPort(oldPort);  return;}// ---------------------------------------------------------------------------//    PresInfoWind_DoContentClick// ---------------------------------------------------------------------------void PresInfoWind_DoContentClick(WindowPtr inWindow, EventRecord *inEvent){#pragma unused(inEvent)  PresInfoWindowRecord    *windData;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_DoContentClick $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }exit:  return;}// ---------------------------------------------------------------------------//    PresInfoWind_ActivateWindow// ---------------------------------------------------------------------------void PresInfoWind_ActivateWindow(WindowPtr inWindow, Boolean inBecomingActive){#pragma unused(inBecomingActive)  PresInfoWindowRecord    *windData;  Rect            windowRect;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_ActivateWindow $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }    CopyPortBounds(GetWindowPort(inWindow), &amp;windowRect);  InvalWindowRect(inWindow, &amp;windowRect);    // draw any stuff that should be different in active/inactive mode  //PresInfoWind_Draw(inWindow);exit:  return;}// ---------------------------------------------------------------------------//    PresInfoWind_HandleMessage// ---------------------------------------------------------------------------OSErr PresInfoWind_HandleMessage(WindowPtr inWindow, long inMessage, void *inMessageParams){#pragma unused(inMessageParams)  PresInfoWindowRecord    *windData;  OSErr            err = noErr;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_HandleMessage $%.8x - couldnt get wind data&quot;, inWindow));    EXITERR( err = qtsBadSelectorErr );  }    switch (inMessage)  {    case kMessage_SetUsherBroadcast:      PresInfoWindPriv_SetBroadcast(windData, (UsherBroadcast*)inMessageParams);      break;    case kMessage_SetParentWindow:      windData-&gt;parentWindow = (WindowPtr)inMessageParams;      break;                default:      err = qtsBadSelectorErr;      break;  }exit:  return err;}// ---------------------------------------------------------------------------//    PresInfoWindPriv_SetBroadcast// ---------------------------------------------------------------------------static void PresInfoWindPriv_SetBroadcast(PresInfoWindowRecord *inWindData, UsherBroadcast *inBroadcast){  OSErr          err = noErr;  OSErr          tempErr;  Str255          pname;  UsherBroadcastStringParams  stringParams;  inWindData-&gt;broadcast = inBroadcast;  if (inWindData-&gt;broadcast != 0)  {    memset(&amp;stringParams, 0, sizeof(stringParams));    stringParams.ioString = (char*)pname;    stringParams.inMaxLength = sizeof(pname)-1;    tempErr = UsherBroadcast_DoCommand(inWindData-&gt;broadcast, kCommand_GetBroadcastName, &amp;stringParams);    if (tempErr == noErr)  {      if (stringParams.returnedStringLength &gt; 0)  {        //@@@ use resources here        strcat((char*)pname, &quot; Info&quot;);        CopyCToPStr((char*)pname, pname);        SetWTitle(inWindData-&gt;standard.window, pname);      }    }    UsherBroadcast_AddWindow(inBroadcast, inWindData-&gt;standard.window);        inWindData-&gt;qtsPresentation = UsherBroadcast_GetQTSPresentation(inWindData-&gt;broadcast);    if (inWindData-&gt;qtsPresentation != kQTSInvalidPresentation)  {      EXITIFERR( err = QTSNewStatHelper(inWindData-&gt;qtsPresentation, kQTSAllStreams,              kQTSAllStatisticsType, 0L, &amp;inWindData-&gt;statHelperAll) );      EXITIFERR( err = QTSNewStatHelper(inWindData-&gt;qtsPresentation, kQTSAllStreams,              kQTSShortStatisticsType, 0L, &amp;inWindData-&gt;statHelperShort) );    }    }exit:  return;}#pragma mark -// ---------------------------------------------------------------------------//    PresInfoWind_Draw// ---------------------------------------------------------------------------void PresInfoWind_Draw(WindowPtr inWindow){  PresInfoWindowRecord    *windData;  Rect            tempRect;  if (!PresInfoWindPriv_GetWindData(inWindow, &amp;windData))  {    DEBUGF((&quot;PresInfoWind_Draw $%.8x - couldnt get wind data&quot;, inWindow));    goto exit;  }    PresInfoWindPriv_GetReadyToDraw(windData);  CopyPortBounds(GetWindowPort(inWindow), &amp;tempRect);  EraseRect(&amp;tempRect);  DrawGrowIcon(inWindow);  if (windData-&gt;statHelperAll != 0)  {    PresInfoWindPriv_DrawStats(windData, windData-&gt;statHelperAll);  }          PresInfoWindPriv_FinishedDrawing(windData);exit:  return;}// ---------------------------------------------------------------------------//    PresInfoWindPriv_GetReadyToDraw// ---------------------------------------------------------------------------static void PresInfoWindPriv_GetReadyToDraw(PresInfoWindowRecord *inWindData){  if (inWindData-&gt;drawingCount &lt; 0)  {    DEBUGF((&quot;PresInfoWindPriv_GetReadyToDraw $%.8x-drawingcount&lt;0 $%.8x&quot;, inWindData, inWindData-&gt;drawingCount));  }  // if we're reentrant, we won't save the old port...i guess  if (inWindData-&gt;drawingCount == 0)  {    GetPort(&amp;inWindData-&gt;oldPort);  }  ++inWindData-&gt;drawingCount;  SetPortWindowPort(inWindData-&gt;standard.window);  TextFont(inWindData-&gt;font);  TextSize(inWindData-&gt;fontSize);}// ---------------------------------------------------------------------------//    PresInfoWindPriv_FinishedDrawing// ---------------------------------------------------------------------------static void PresInfoWindPriv_FinishedDrawing(PresInfoWindowRecord *inWindData){  --inWindData-&gt;drawingCount;  if (inWindData-&gt;drawingCount == 0)  {    MacSetPort(inWindData-&gt;oldPort);  }}// ---------------------------------------------------------------------------//    PresInfoWindPriv_DrawStats// ---------------------------------------------------------------------------static void PresInfoWindPriv_DrawStats(PresInfoWindowRecord *inWindData, QTSStatHelper inStatHelper){#define kSHStringLength    255  OSErr            err = noErr;  QTSStatHelperNextParams    nextParams;  Rect            bounds;  Rect            lineBounds;  Point            current;  char            nameString[kSHStringLength+1];  char            dataString[kSHStringLength+1];  char            unitsString[kSHStringLength+1];  short            width;  short            unitsWidth;      DITLGetItemRect(inWindData-&gt;ditlHandle, rPresInfoWindDITLItem_InfoArea, &amp;bounds);    MacFrameRect(&amp;bounds);  bounds.left += inWindData-&gt;boundsGutterInfo.left;  bounds.right -= inWindData-&gt;boundsGutterInfo.right;  bounds.top += inWindData-&gt;boundsGutterInfo.top;  bounds.bottom -= inWindData-&gt;boundsGutterInfo.bottom;    memset(&amp;nextParams, 0, sizeof(nextParams));  nextParams.maxStatNameLength = sizeof(nameString)-1;  nextParams.returnedStatName = nameString;  nextParams.maxStatStringLength = sizeof(dataString)-1;  nextParams.returnedStatString = dataString;  nextParams.maxStatUnitLength = sizeof(unitsString)-1;  nextParams.returnedStatUnit = unitsString;    current.h = bounds.left;  current.v = bounds.top + inWindData-&gt;lineHeight;  EXITIFERR( err = QTSStatHelperResetIter(inStatHelper) );  while (QTSStatHelperNext(inStatHelper, &amp;nextParams))  {//@@@ should do something smarter when the label+data is too long for the line    MoveTo(current.h, current.v);    lineBounds.left = current.h;    lineBounds.right = bounds.right;    lineBounds.top = current.v - inWindData-&gt;lineHeight;    lineBounds.bottom = current.v;    // name    MacDrawText((unsigned char*)nameString, 0, (short)strlen(nameString));#define kDataAndUnitsSpacing  3    // stat units    unitsWidth = 0;    if (unitsString[0] != '\0')  {      unitsWidth = TextWidth(unitsString, 0, (short)strlen(unitsString));      MoveTo((short)(lineBounds.right - unitsWidth), current.v);      MacDrawText((unsigned char*)unitsString, 0, (short)strlen(unitsString));      unitsWidth += kDataAndUnitsSpacing;    }        // stat data    width = TextWidth(dataString, 0, (short)strlen(dataString));    MoveTo((short)(lineBounds.right - width - unitsWidth), current.v);    MacDrawText((unsigned char*)dataString, 0, (short)strlen(dataString));      current.v += inWindData-&gt;lineHeight;    if (current.v &gt; bounds.bottom)  {      break;    }  }    inWindData-&gt;dirtyFlags = 0;exit:  return;}#pragma mark -// ---------------------------------------------------------------------------//    PresInfoWindPriv_UpdateIfNecessary// ---------------------------------------------------------------------------static void PresInfoWindPriv_UpdateIfNecessary(PresInfoWindowRecord *inWindData){  if (inWindData-&gt;lastUpdateTime + inWindData-&gt;updateInterval &lt; (SInt32)TickCount())  {    PresInfoWindPriv_Update(inWindData);    inWindData-&gt;lastUpdateTime = TickCount();    inWindData-&gt;dirtyFlags |= kPresInfoWindDirtyFlag_Stats;  }}// ---------------------------------------------------------------------------//    PresInfoWindPriv_Update// ---------------------------------------------------------------------------static void PresInfoWindPriv_Update(PresInfoWindowRecord *inWindData){  if (inWindData-&gt;statHelperAll != 0)  {    QTSStatHelperGetStats(inWindData-&gt;statHelperAll);  }  if (inWindData-&gt;statHelperShort != 0)  {    QTSStatHelperGetStats(inWindData-&gt;statHelperShort);  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/usher/listing6.html%3Fid%3DDTS10001057-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/usher/listing6.html%3Fid%3DDTS10001057-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/usher/listing6.html%3Fid%3DDTS10001057-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>