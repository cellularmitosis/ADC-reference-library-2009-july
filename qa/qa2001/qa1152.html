<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1152: Using Navigation Services to filter QuickTime files</title><meta name="keywords" content="QuickTime CanQuickTimeOpenFile Navigation Services filterfunction"><meta name="Description" content="Technical Q&amp;A QA1152: This Q&amp;A demonstrates how to use theQuickTime CanQuickTimeOpenFile function in a Navigation Servicesfilter function to display files QuickTime is able to open."><meta name="categories" content="Human Interface Toolbox and QuickTime Components"><meta name="week-posted" content="Jul 15, 2002 - Jul 19, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001697" title="Using Navigation Services to filter QuickTime files"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxMovieBasics-date.html">Movie Basics</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1152</div>
<div id="pageheadsub">Using Navigation Services to filter QuickTime files</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      I'm using Navigation Services in my QuickTime-saavy application,      and I'd like to be able to display in my Navigation Services      Open dialog box all the files QuickTime is able to open.      Is there any easy way to do this?</p>                          <P id=p4>A: Yes. The QuickTime CanQuickTimeOpenFile function will tell           you whether a file can be opened by QuickTime using a graphics importer           or opened in place as a movie. Simply call this API from a Navigation           Services application-defined filter function and you'll be able to display           all files QuickTime is able to open. Here's a sample Navigation Services           filter function which demonstrates how this is done:</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left>                <pre> OSStatus    GetFSSpecFromAEDesc( FSSpec *fsspec, AEDesc* theItem ){    OSStatus    err           = noErr;    AEDesc      coerceDesc    = { NULL, NULL };    AEDesc      coerceDesc2   = { NULL, NULL };    FSSpec      fsSpec;    /* If the AEDesc isn't already an FSSpec, convert it to one... */    if ( theItem-&gt;descriptorType != typeFSS )    {        err = AECoerceDesc( theItem, typeFSS, &amp;coerceDesc2 );        /* Get the FSSpec out of the AEDesc */        if ( err == noErr )        {            theItem = &amp;coerceDesc2;        }    }    err = AEGetDescData( theItem, fsspec, sizeof(fsSpec) );    AEDisposeDesc( &amp;coerceDesc2 );    return( err );}pascal Boolean NavLaunchServicesFilterProc(                                          AEDesc* theItem,                                          void* info,                                          NavCallBackUserData ioUserData,                                          NavFilterModes filterMode                                          ){    #pragma unused(ioUserData)    NavFileOrFolderInfo    *myInfo      = (NavFileOrFolderInfo *)info;    OSStatus                err         = noErr;    Boolean                 showItem    = false;    FSSpec                  fsspec;    if ( filterMode == kNavFilteringBrowserList )    {        if (theItem-&gt;descriptorType == typeFSS)        {            /* file or folder? */            if (myInfo-&gt;isFolder)            {                /* show all folders */                showItem = true;            }            else    /* we have a file, not a folder */            {                Boolean outCanOpenWithGraphicsImporter    = false;                Boolean outCanOpenAsMovie        = false;                err = GetFSSpecFromAEDesc( &amp;fsspec, theItem );                if ( err != noErr ) goto BailWithError;/*A reference to the documentation for the CanQuickTimeOpenFile functionis provided at the end of this document.We simply pass an FSSpec for the file of interest, and QuickTime will returnto us in the outCanOpenWithGraphicsImporter and outCanOpenAsMovie parametersa value indicating whether or not the file can be opened using a graphicsimporter or in place as a movie.Of particular interest are the various flags you can pass for the inFlagsparameter. These affect the way QuickTime performs its search. Here's alist of the flags:-inFlags Constants-kQTDontUseDataToFindImporterTells QuickTime not to use the data in the file to help in the search.This will speed up the search, especially in cases where a negativeresult is returned, but it will cause QuickTime to report that itcannot open files that aren't identified by a recognized file typeor file name suffix.kQTDontLookForMovieImporterIfGraphicsImporterFoundTells QuickTime to short-circuit its search as soon as it finds oneway to open the file. Pass this flag if you want to know whether afile can be opened with a graphics importer or as a movie, but youdon't care which.kQTAllowOpeningStillImagesAsMoviesTells QuickTime to consider opening still images as movies. Ifthis flag is set, if a file can be opened using a graphics importerQuickTime will automatically say it can be opened as a movie.kQTAllowImportersThatWouldCreateNewFileTells QuickTime to include importers which would create new files.If this flag is clear, QuickTime only includes importers which canimport in place without needing to create new files.kQTAllowAggressiveImportersTells QuickTime to include movie importers for file types like PICTand TEXT that aren't traditionally thought of as movies. If thisflag is clear, QuickTime excludes these movie importers.We recommend using the kQTDontLookForMovieImporterIfGraphicsImporterFoundflag, as it makes the search faster, since you don't care how the fileis opened.  In certain situations if may be useful to use thekQTDontUseDataToFindImporter flag, as it will also speed-up thesearch. However, the drawback is it will skip files with nosuffix or file type.*/                err = CanQuickTimeOpenFile(                       &amp;fsspec,                           /* fileType */                       myInfo-&gt;fileAndFolder.fileInfo.finderInfo.fdType,                           /* filename suffix, or 0 if not known */                       0,                           /* returns true if file can be opened with a                           graphics importer */                       &amp;outCanOpenWithGraphicsImporter,                           /* returns true if file can be opened with a                           movie importer */                       &amp;outCanOpenAsMovie,                           /* returns true if file can be opened both with                           a graphics importer and movie importer, but                           QT would prefer to use a graphics importer */                       nil,                           /* inFlags, we'll specify                           kQTDontLookForMovieImporterIfGraphicsImporterFound                           to tell QuickTime to short-circuit its search as                           soon as it finds one way to open the file. We                           don't care if the file can be opened with a                           graphics importer or as a movie. */                       kQTDontLookForMovieImporterIfGraphicsImporterFound                       );                if ( err != noErr ) goto BailWithError;                if ((outCanOpenWithGraphicsImporter) || (outCanOpenAsMovie))                {                    /* success!! file can be opened with either a graphics                    importer or movie importer */                    showItem = true;                }            }        }    }    return (showItem);BailWithError:    return( false );}</pre></TD></TR><TR><td align="left"><P><B>Listing 1</B>.       Sample Navigation Services application-defined filter function      which uses the CanQuickTimeOpenFile function to filter files</P></TD></TR></TABLE></CENTER><BR><BR>        <P><B>References:</B><BR><BR>Documentation for the <CODE>CanQuickTimeOpenFile</CODE> can found in the QuickTime onlinedocumentation at the address:<BR><A HREF="http://developer.apple.com/documentation/quicktime/qtdevdocs/APIREF/SOURCESI/canquicktimeopenfile.htm">http://developer.apple.com/documentation/quicktime/qtdevdocs/APIREF/SOURCESI/canquicktimeopenfile.htm</A></P>          <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Jul 15 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1152.html%3Fid%3DDTS10001697-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1152.html%3Fid%3DDTS10001697-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1152.html%3Fid%3DDTS10001697-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>