<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OV15: Debugging Tips</title><meta name="keywords" content="Mac OS 8 debugging tips checksumming handles memory errors"><meta name="Description" content="Technical Note OV15: This Technical Note provides tips fordebugging applications on the Macintosh. Tips include: checksummingto slow down the Macintosh, watching out for nil handlesthat are dereferenced, checksumming MemErr, and finding outwhich handles in an application will be moved so as to avoidoverusing lockhandle.">                                      <meta name="categories" content="Overview"><meta name="week-posted" content="Mar 31, 1986 - Apr 4, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002613" title="Debugging Tips"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OV15</div>
<div id="pageheadsub">Debugging Tips</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Setting memory location 0 to something odd</A><br><br><A HREF="#Section2">Checksumming for slow motion mode</A><br><br><A HREF="#Section3">Checksumming MemErr</A><br><br><A HREF="#Section4">Checksumming on a master pointer</A><br><br> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technote presents a few tips which may make your debugging easier.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jun 01 1986]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->        <A NAME=Section1></A><h2>Setting memory location 0 to something odd</h2><p>Dereferencing nil handles can cause real problems for an application. Iflocation 0 (<code>nil</code>) is something even, the dereference will not cause an address error, and the application can run on for quite a while, making tracing back to the problem quite difficult. If location 0 contains something odd, such as <code>$50FFC001</code>, an address error will be generated immediately when a nil handle is dereferenced. On Macintoshes with 68020s, like the Mac II, this same value (<code>$50FFC001</code>) will cause a bus error. An address error or bus error will also be generated, of course, when the ROM tries to dereference a nil handle, such as when you call <code>HNoPurge(hndl)</code>, where <code>hndl</code> is nil.</p><p>Some versions of the <code>TMON</code> debugger set location 0 to 'NIL!'<code>($4E494C21)</code> or <code>$50FFC001</code>. If you are using MacsBug, you should include code in your program that sets location 0. Of course, there is no need to ship your application with this code in it--it's just for debugging purposes. Old versions of the Finder used to set location 0 to the value <code>$464F424A ('FOBJ')</code>. On newer machines, newly launched applications get location 0 set to <code>$00F80000</code> by the Segment Loader.</p> <P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>Checksumming for slow motion mode</h2><p>Entering the Macsbug command <code>"SS 400000 400000"</code> will cause Macsbug todo a checksum of the location <code>$400000 </code>every time an instruction is executed. Checksum the ROM, because it will not change while your program is executing (the ROM may change in between launches of your application, but that's OK)! This will cause the Macintosh to go into slow motion mode. For example, you will need to hold down the mouse button for about 10 seconds to get a menu to pull down - you can see how the ROM draws menus, grays text, etc.</p><p>This technique is very handy for catching problems like multiple updates ofyour windows, redrawing scroll bars more than once, that troublesome flashing grow icon, etc. To turn slow motion mode off, simply enter MacsBug and type <code>"SS"</code>.</p><p><code>TMON</code> performs this function in a different way. Instead of calculating thechecksum after each instruction, it only calculates checksums after each trap.You can checksum different amounts of the ROM depending on how much you wantthings to slow down.</p> <P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>Checksumming MemErr</h2><p>A lot of programs don't call <code>MemError</code> as often as they should. If youare having strange, memory-related problems, one thing that you can do to helpfind them is to checksum on <code>MemErr</code> (the low memory global word at<code>$220</code>). In MacsBug, type <code>"SS 220 221"</code>. In <code>TMON</code>, enter<code>220</code> and <code>221</code> as limits on the '<code>Checksum (bgn end):</code>'line and on the line above, enter the range of traps you wish to have thechecksum calculated after.</p><p>When <code>MemErr</code> changes, the debugger will appear, and you can check yourcode to make sure that you are checking <code>MemErr</code>. If not, you might have found aproblem that could cause your program to crash!</p> <P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>Checksumming on a master pointer</h2><p>Due to fear of moving memory, some programmers lock every handle that they create. Of course, handles need only be locked if they are going to be dereferenced and if a call will be made that can cause relocation. Unnecessarily locking handles can cause unwanted heap fragmentation. If you suspect that a particular memory block is moving on you when you have its handle dereferenced, you can checksum the master pointer (the handle you got back from <code>NewHandle</code> is the address of the master pointer). Your program will drop into the debugger each time your handle changes - that is, either when the block it refers to is relocated, or when the master pointer's flags byte changes.</p> <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (40K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ov_15.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ov/ov_15.html%3Fid%3DDTS10002613-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ov/ov_15.html%3Fid%3DDTS10002613-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ov/ov_15.html%3Fid%3DDTS10002613-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>