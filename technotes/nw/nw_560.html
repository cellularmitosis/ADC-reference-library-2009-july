<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW560: Macintosh Protocol Package Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW560: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002581" title="Macintosh Protocol Package Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW560</div>
<div id="pageheadsub">Macintosh Protocol Package Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext">					<a href="#Section1">Retries and tickle mechanism for nonAppleShare connections</a><br><br>					<a href="#Section2">MPP stands for Macintosh Protocol Package handler</a><br><br><a href="#Section2">RAM-based AppleTalk driver fixes Mac Plus PNSendRequest error</a><br><br>					<a href="#Section4">RAM-based AppleTalk driver fixes Mac Plus PNSendRequest error</a><br><br><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>Retries and tickle mechanism for nonAppleShare connections</h2><p>Date Written:  12/28/92</p><p>Last reviewed:  3/1/93</p><p>We're experiencing time-outs in the .MPP driver communications between ournon-AppleShare server and applications that talk to it, when the connection islow-speed (for example, an AppleTalk Remote Access connection). We have noproblems over local area nets or with AppleShare connected over our low-speedconnection. What values should we use for the ATP timeOutVal and retryCount?</p><p>The reason you don't see problems with AppleShare connections is thatAppleShare uses the AppleTalk Filing Protocol (AFP) and AFP is built on theAppleTalk Session Protocol (ASP). ASP uses an infinite retry count on its ATPtransactions and a tickle mechanism to detect broken session connections. IfASP's tickle mechanism finds the session connection is dead, it kills alloutstanding asynchronous ATP calls with PKillSendReq and PKillGetReq. ASPclients don't have to worry about time-out conditions except when the networkconnection fails.</p><p>The AppleShare workstation determines the timeOutVal to pass to AFP/ASP byusing the Apple Echo Protocol. Here's how you could use the echo protocol todetermine the timeOutVal for your program:</p><ol type="1">	<li>Send the other end of the new connection a full-size (586-byte) packet to the echo socket.</li>	<li>Wait for up to 10 seconds for the echo packet to come back. This should be enough time to send a full-size packet both ways at 1200 bps (slower than any connection you'd hope to encounter on an AppleTalk network).</li>	<li>If the echo packet isn't back in 10 seconds, assume the packet was lost either going to or coming from the other end and use a default retry time of 4 seconds (this is what AppleShare uses as a default when its echo packet is lost--it's generally a good value for LocalTalk).</li>	<li>If the echo packet is back within 10 seconds, multiply the turnaround time by 4.5 (enough time to transfer nine full-size packets).</li>	<li>Add the maximum amount of latency you expect the responding side of the connection to have between receiving a request and sending the response (you'll have to determine this value by running your code on a slow system).</li>	<li>If the calculated value ( (echo time * 4.5) + latency ) is greater than 2 seconds, use it. Otherwise use a minimum default retry time of 2 seconds. The reason for keeping the minimum above a certain level is to minimize network  traffic.</li></ol><p>We recommend building a session protocol something like ASP on top of ATP sothat you can use infinite retries and let a tickle mechanism tear down a brokenconnection. A tickle mechanism is also easy to implement. For example, toimplement a tickle mechanism like the one AppleTalk protocols use, just start aVBL task with a vblCount of 2 minutes (120 ticks) on both ends of theconnection. Every time you receive a packet of any kind from the other side ofthe connection, reset the vblCount to 2 minutes again. If the VBL task evergets called, the connection was broken. To send the tickle packets, just callPSendRequest (or PNSendRequest) to send a small tickle request with an infiniteretry count and a retry period of 30 seconds. Whenever you receive a ticklepacket from the other side of a connection, simply ignore it (if you don'trespond, ATP will keep retrying every 30 seconds, which is what you want).</p><p>If you don't want to use a tickle mechanism, you'll have to decide how manytimes you want ATP to retry. The value you use should balance how long you wanta user to wait for something to happen and how reliable the user's network isat delivering packets -- something that isn't at all easy to determine.</p><p>For more information, see the Macintosh (Networking) Technical Note <A HREF = "nw_14.html">"AppleTalkTimers Explained."</a></p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>MPP stands for Macintosh Protocol Package handler</h2><p>Date Written:  2/28/92</p><p>Last reviewed:  2/28/92</p><p>What does "MPP" stand for? We know it's a lower-level driver that contains codeto implement ALAP (Link Access Protocol), DDP (Datagram Delivery Protocol), NBP(Name Binding Protocol), and RTMP (Routing Table Maintenance Protocol) stuff,but we're curious to the point of not being able to do any work :) MacintoshPacket Protocol? Multiple Problem Protocol?</p><p>MPP stands for Macintosh Protocol Package handler. XPP stands for eXtendedProtocol Package handler; ATP stands for AppleTalk (originally AppleBus)Transaction Protocol handler; DSP is Data Stream Protocol handler; LTM is LinkTool Manager; and MNP is Microcom Networking Protocol, implemented by AppleTalkRemote Access across the remote link. Hope you can get some work done now ;)</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>RAM-based AppleTalk driver fixes Mac Plus PNSendRequest error</h2><p>Date Written:  1/1/91</p><p>Last reviewed:  1/1/91</p><p>I get an odd address error when using PNSendRequest on the Macintosh Plus. TheMacintosh Plus has version 19 of the .MPP driver. Is there is an INIT orsomething that patches the older Macintosh models with the newer drivers?</p><p><i>Inside Macintosh</i> suggests checking the .MPP driver version to see if thenew driver is available (version &gt;= 48).</p><p>You need the RAM-based AppleTalk drivers on the older Macintosh models to usethe calls documented in <i>Inside Macintosh</i> Volume V. The RAM-basedAppleTalk driver is available as an AppleTalk System file, and you need toplace it in the System Folder of your Mac Plus.</p><p>X-Ref:</p><P>"The AppleTalk Manager," <i>Inside Macintosh</i> Volume V</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>PKillNBP aKillQEl pointer</h2><p>Date Written:  6/12/92</p><p>Last reviewed:  9/15/92</p><p>Where can I get the Q element pointer for a PLookupName call in order to callPKillNBP?</p><p>The pointer that you pass in the parameter block to <code>PKillNBP</code>, is the pointer tothe parameter block of the outstanding lookup request. If several lookuprequests have been made asynchronously, and are outstanding, then you wouldtake the pointer to each parameter block and issue separate <code>PKillNBP</code> calls foreach lookup to kill the request on.</p><p>Each asynchronous lookup request along with other asynchronous requests to thedrivers get queued for processing. The <code>KillNBP</code> request takes the pointer to theparameter block of the outstanding request and searches through the driverqueue, looking for a match. When a match is found, the request is dequeued andthe driver notified of the action. If the request has already beendequeued--for example, if the original lookup request was completed while the<code>PKillNBP</code> was made--a cbNotFound error (error -1102) will be returned.</p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_560.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_560.html%3Fid%3DDTS10002581-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_560.html%3Fid%3DDTS10002581-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_560.html%3Fid%3DDTS10002581-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>