<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shell Scripting Primer: Advanced Techniques</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Advanced Techniques"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004268-TP40003521" title="Advanced Techniques"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP40003594" target="_top">Open Source</a> &gt; <a href="../../../Scripting-date.html#//apple_ref/doc/uid/TP30000440-TP40003594-TP30000569" target="_top">Scripting &amp; Automation</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004268-TP40003516-SW1">Shell Scripting Primer</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../PortingScriptstoMacOSX/PortingScriptstoMacOSX.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../performance/performance.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW35" title="Advanced Techniques"></a><h1>Advanced Techniques</h1><p>Shell scripts can be powerful tools for writing software. Graphical interfaces notwithstanding, they are capable of performing nearly any task that could be performed with a more traditional language. This chapter describes several techniques that will help you write more complex software using shell scripts.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW1">Data Structures, Arrays, and Indirection</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW24">Nonblocking I/O</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW25">Timing Loops</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW8">Trapping Signals</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW20">Special Shell Variables</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW27">Shell Text Formatting</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW42">Finding the Absolute Path of the Current Script</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_1">Application Scripting With osascript</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW1" title="Data Structures, Arrays, and Indirection"></a><h2>Data Structures, Arrays, and Indirection</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_31"></a>One of the more under-appreciated commands in shell scripting is the <code><a href="../../../../Darwin/Reference/ManPages/man1/eval.1.html#//apple_ref/doc/man/1/eval" target="_top">eval</a></code> builtin. The <code>eval</code> builtin takes a series of arguments, concatenates them into a single command, then executes it.</p><p>For example, the following script assigns the value <code>3</code> to the variable <code>X</code> and then prints the value:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre>eval X=3<span></span></pre></td></tr><tr><td scope="row"><pre>echo $X<span></span></pre></td></tr></table></div><p>For such simple examples, the <code>eval</code> builtin is superfluous. However, the behavior of the <code>eval</code> builtin becomes much more interesting when you need to construct or choose variable names programmatically. For example, the next script also assigns the value <code>3</code> to the variable <code>X</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>VARIABLE="X"<span></span></pre></td></tr><tr><td scope="row"><pre>eval $VARIABLE=3<span></span></pre></td></tr><tr><td scope="row"><pre>echo $X<span></span></pre></td></tr></table></div><p>When the <code>eval</code> builtin evaluates its arguments, it does so in two steps. In the first step, variables are replaced by their values. In the preceding example, the letter <code>X</code> is inserted in place of <code>$VARIABLE</code>. Thus, the result of the first step is the following string:</p><div class="codesample"><table><tr><td scope="row"><pre>X=3<span></span></pre></td></tr></table></div><p>In the second step, the <code>eval</code> builtin executes the statement generated by the first step, thus assigning the value <code>3</code> to the variable <code>X</code>. As further proof, the <code>echo</code> statement at the end of the script prints the value <code>3</code>.</p><p>The <code>eval</code> builtin can be particularly convenient as a substitute for arrays in shell script programming. It can also be used to provide a level of indirection, much like pointers in C. Some examples of the <code>eval</code> builtin are included in the sections that follow.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW21" title="A Complex Example: Setting and Printing Values of Arbitrary Variables"></a><h3>A Complex Example: Setting and Printing Values of Arbitrary Variables</h3><p>The next example takes user input, constructs a variable based on the value entered using <code><a href="../../../../Darwin/Reference/ManPages/man1/eval.1.html#//apple_ref/doc/man/1/eval" target="_top">eval</a></code>, then prints the value stored in the resulting variable.</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre>echo "Enter variable name and value separated by a space"<span></span></pre></td></tr><tr><td scope="row"><pre>read VARIABLE VALUE<span></span></pre></td></tr><tr><td scope="row"><pre>echo Assigning the value $VALUE to variable $VARIABLE<span></span></pre></td></tr><tr><td scope="row"><pre>eval $VARIABLE=$VALUE<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># print the value<span></span></pre></td></tr><tr><td scope="row"><pre>eval echo "$"$VARIABLE<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># export the value<span></span></pre></td></tr><tr><td scope="row"><pre>eval export $VARIABLE<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># print the exported variables.<span></span></pre></td></tr><tr><td scope="row"><pre>export<span></span></pre></td></tr></table></div><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_10" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;This script executes arbitrary user input. It is intended <em>only</em> as an example of the usage of the <code>eval</code> builtin. In real-world code, you should <em>never</em> pass unsanitized user input directly to <code>eval</code> because doing so can provide a vector for arbitrary code execution.</p><p></p><div class="clear"></div></div><p>Run this script and type something like <code>MYVAR 33</code>. The script assigns the value <code>33</code> to the variable <code>MYVAR</code> (or whatever variable name you entered).</p><p>You should notice that the echo command has an additional dollar sign (<code>$</code>) in quotes. The first time the <code>eval</code> builtin parses the string, the quoted dollar sign is simplified to merely a dollar sign. You could also surround this dollar sign with single quotes or quote it with a backslash, as described in <span class="content_text"><a href="../shell_scripts/shell_scripts.html#//apple_ref/doc/uid/TP40004268-CH237-SW13">“Quoting Special Characters.”</a></span> The result is the same.</p><p>Thus, the statement:</p><div class="codesample"><table><tr><td scope="row"><pre>eval echo "$"$VARIABLE<span></span></pre></td></tr></table></div><p>evaluates to:</p><div class="codesample"><table><tr><td scope="row"><pre>echo $MYVAR<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW36" title="Note"></a><p><strong>Note:</strong>&nbsp;If you forget to quote the first dollar sign, you get a very strange result. The variable <code>$$</code> is a special shell variable that contains the process ID of the current shell. Thus, without quoting the first dollar sign, the two dollar signs are interpreted as a variable, and thus the statement evaluates to something like:</p><div class="codesample"><table><tr><td scope="row"><pre>echo 1492MYVAR<span></span></pre></td></tr></table></div>This is probably not what you want.</p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW22" title="A Practical Example: Using eval to Simulate an Array"></a><h3>A Practical Example: Using eval to Simulate an Array</h3><p>In <span class="content_text"><a href="../shell_scripts/shell_scripts.html#//apple_ref/doc/uid/TP40004268-CH237-SW8">“Shell Variables and Printing,”</a></span> you learned how to <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_32"></a>read variables from standard input. This was limited to some degree by the inability to read an unknown number of user-entered values.</p><p>The script below solves this problem using <code><a href="../../../../Darwin/Reference/ManPages/man1/eval.1.html#//apple_ref/doc/man/1/eval" target="_top">eval</a></code> by creating a series of variables to hold the values of a simulated array.</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>COUNTER=0<span></span></pre></td></tr><tr><td scope="row"><pre>VALUE="-1"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "Enter a series of lines of test.  Enter a blank line to end."<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while [ "x$VALUE" != "x" ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        read VALUE<span></span></pre></td></tr><tr><td scope="row"><pre>        eval ARRAY_$COUNTER=$VALUE<span></span></pre></td></tr><tr><td scope="row"><pre>        eval export ARRAY_$COUNTER<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNTER=$(expr $COUNTER '+' 1) # More on this in Paint by Numbers<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr><tr><td scope="row"><pre>COUNTER=$(expr $COUNTER '-' 1) # Subtract one for the blank value at the end.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># print the exported variables.<span></span></pre></td></tr><tr><td scope="row"><pre>COUNTERB=0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "Printing values."<span></span></pre></td></tr><tr><td scope="row"><pre>while [ $COUNTERB -lt $COUNTER ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "ARRAY[$COUNTERB] = $(eval echo "$"ARRAY_$COUNTERB)"<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNTERB=$(expr $COUNTERB '+' 1) # More on this in Paint by Numbers<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><p>This same technique can be used for splitting an unknown number of input values in a single line as shown in the next listing:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>COUNTER=0<span></span></pre></td></tr><tr><td scope="row"><pre>VALUE="-1"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "Enter a series of lines of numbers separated by spaces."<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>read LIST<span></span></pre></td></tr><tr><td scope="row"><pre>IFS=" "<span></span></pre></td></tr><tr><td scope="row"><pre>for VALUE in $LIST ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        eval ARRAY_$COUNTER=$VALUE<span></span></pre></td></tr><tr><td scope="row"><pre>        eval export ARRAY_$COUNTER<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNTER=$(expr $COUNTER '+' 1) # More on this in Paint by Numbers<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># print the exported variables.<span></span></pre></td></tr><tr><td scope="row"><pre>COUNTERB=0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "Printing values."<span></span></pre></td></tr><tr><td scope="row"><pre>while [ $COUNTERB -lt $COUNTER ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "ARRAY[$COUNTERB] = $(eval echo '$'ARRAY_$COUNTERB)"<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNTERB=$(expr $COUNTERB '+' 1) # More on this in Paint by Numbers<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW23" title="A Data Structure Example: Linked Lists"></a><h3>A Data Structure Example: Linked Lists</h3><p>In a complex shell script, you may need to keep track of multiple pieces of data and treat them like a <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_33"></a>data structure. The <code><a href="../../../../Darwin/Reference/ManPages/man1/eval.1.html#//apple_ref/doc/man/1/eval" target="_top">eval</a></code> builtin makes this easy. Your code needs to pass around only a single name from which you build other variable names to represent fields in the structure.</p><p>Similarly, you can use the <code>eval</code> builtin to provide a level of indirection similar to pointers in C.</p><p>For example, the following script manually constructs a linked list with three items, then walks the list:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>VAR1_VALUE="7"<span></span></pre></td></tr><tr><td scope="row"><pre>VAR1_NEXT="VAR2"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>VAR2_VALUE="11"<span></span></pre></td></tr><tr><td scope="row"><pre>VAR2_NEXT="VAR3"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>VAR3_VALUE="42"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>HEAD="VAR1"<span></span></pre></td></tr><tr><td scope="row"><pre>POS=$HEAD<span></span></pre></td></tr><tr><td scope="row"><pre>while [ "x$POS" != "x" ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "POS: $POS"<span></span></pre></td></tr><tr><td scope="row"><pre>        VALUE="$(eval echo '$'$POS'_VALUE')"<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "VALUE: $VALUE"<span></span></pre></td></tr><tr><td scope="row"><pre>        POS="$(eval echo '$'$POS'_NEXT')"<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><p>Using this technique, you could conceivably construct any data structure that you need (with the caveat that manipulating large data structures in shell scripts is generally not conducive to good performance).<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_34"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW24" title="Nonblocking I/O"></a><h2>Nonblocking I/O</h2><p>Most shell scripts do not need to accept user input at all during execution, and scripts that do require user input can generally request it a line at a time. However, if you are writing a shell script that needs to interact with the user while performing background activity, it can be convenient to simulate asynchronous timer events and asynchronous input and output.</p><p>First, a warning: <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_35"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_36"></a>nonblocking I/O is not possible in a pure shell script. It requires the use of an external tool that sets the terminal to nonblocking. Setting the terminal to nonblocking can seriously confuse the shell, so you should not mix nonblocking I/O and blocking I/O in the same program.</p><p>With that caveat, you can perform nonblocking I/O by writing a small C helper such as this one:</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;unistd.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;fcntl.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main(int argc, char *argv[])<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int ch;<span></span></pre></td></tr><tr><td scope="row"><pre>    int flags = fcntl(STDIN_FILENO, F_GETFL);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (flags == -1) return -1; // error<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    fcntl(STDIN_FILENO, F_SETFL, flags | O_NONBLOCK);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    ch = fgetc(stdin);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (ch == EOF) return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (ch == -1) return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("%c", ch);<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If you compile this tool and name it <code>getch</code>, you can then use it to perform nonblocking terminal input, as shown in the following example:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/bash<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>stty -icanon -isig<span></span></pre></td></tr><tr><td scope="row"><pre>while true ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        echo -n "Enter a character: "<span></span></pre></td></tr><tr><td scope="row"><pre>        CHAR=`./getch`<span></span></pre></td></tr><tr><td scope="row"><pre>        if [ "x$CHAR" = "x" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>                echo "NO DATA";<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>                if [ "x$CHAR" = "xq" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>                        stty -cbreak<span></span></pre></td></tr><tr><td scope="row"><pre>                        exit<span></span></pre></td></tr><tr><td scope="row"><pre>                fi<span></span></pre></td></tr><tr><td scope="row"><pre>                echo "DATA: $CHAR";<span></span></pre></td></tr><tr><td scope="row"><pre>        fi<span></span></pre></td></tr><tr><td scope="row"><pre>        sleep 1;<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># never reached<span></span></pre></td></tr><tr><td scope="row"><pre>stty -cbreak<span></span></pre></td></tr></table></div><p>This script prints “NO DATA” or “DATA: <em>[some character]</em>” depending on whether you have pressed a key in the past second. (To stop the script, press the Q key.) Using the same technique, you can write fairly complex shell scripts that can detect keystrokes while performing other tasks. For example, you might write a game of ping pong that checks for a keystroke at the beginning of each ball drawing loop and if it detects one, moves the user’s paddle by a few pixels.</p><p>This script also illustrates another useful technique: disabling input buffering. The <code><a href="../../../../Darwin/Reference/ManPages/man1/stty.1.html#//apple_ref/doc/man/1/stty" target="_top">stty</a></code> command changes three settings on the controlling terminal (a device file that represents the current Terminal window, console, <code>ssh</code> session, or other communication channel):</p><ul class="ul"><li class="li"><p>The <code>-icanon</code> flag disables canonicalization of input. For example, if you press (in order) the keys A, Delete, and Return, normally your shell script receives an empty line. With canonicalization disabled, your application instead sees three bytes: the letter A, a control character representing the Delete key, and a newline character representing the Return key.</p></li><li class="li"><p>The <code>-isig</code> flag disables automatic generation of signals based on input character. By specifying this flag, you can trap arbitrary control characters, including characters that would otherwise halt, pause, or resume execution (Control-C, for example). Because disabling these signals makes it harder to stop execution of a shell script, you should generally avoid using this flag unless you intend to capture these control characters as part of normal operation. If you merely need to execute cleanup code when these keys are pressed, you should trap the resulting signals instead, as described in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW8">“Trapping Signals.”</a></span></p></li><li class="li"><p>The <code>-cbreak</code> flag sets some reasonable defaults for interactive shell use.</p></li></ul><p>Depending on what you are doing, you may also find it useful to pass the <code>-echo</code> flag. This flag disables the automatic echo of typed characters to the screen. If you are capturing characters for a full-screen game, for example, echoing the typed characters to the screen tends to be disastrous, depending on how unlucky the user’s timing is when pressing the key.</p><p>Depending on what other flags you pass, you may want to reset the terminal more fully at the end by issuing the command <code>stty sane</code>. In Mac OS X, this flag is identical to <code>-cbreak</code>, but in Linux and some other operating systems, the <code>sane</code> flag is a superset of the <code>-cbreak</code> flag.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW25" title="Timing Loops"></a><h2>Timing Loops</h2><p>On rare occasions, you may find the need to perform some operation on a periodic basis with greater than the one second precision offered by <code><a href="../../../../Darwin/Reference/ManPages/man1/sleep.1.html#//apple_ref/doc/man/1/sleep" target="_top">sleep</a></code>. Although the shell does not offer any precision timers, you can closely approximate such behavior through the use of a <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_37"></a>calibrated delay loop.</p><p>The basic design for such a loop consists of two parts: a calibration routine and a delay loop. The calibration routine should execute approximately the same instructions as the delay loop for a known number of iterations.</p><p>The nature of the instructions within the delay loop are largely unimportant. They can be any instructions that your program needs to execute while waiting for the desired amount of time to elapse. However, a common technique is to perform nonblocking I/O during the delay loop and then process any characters received.</p><p>For example, <span class="content_text">Listing 7-1</span> shows a very simple timing loop that reads a byte and triggers some simple echo statements (depending on what key is pressed) while simultaneously echoing a statement to the screen about once per second.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW11" title="Listing 7-1A simple one-second timing loop"></a><p class="codesample"><strong>Listing 7-1&nbsp;&nbsp;</strong>A simple one-second timing loop</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ONE_SECOND=1000<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>function read_test()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    COUNT=0<span></span></pre></td></tr><tr><td scope="row"><pre>    local ONE_SECOND=1000                       # ensure this never trips!<span></span></pre></td></tr><tr><td scope="row"><pre>    while [ $COUNT -lt 200 ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        CHAR=`./getch`<span></span></pre></td></tr><tr><td scope="row"><pre>        if [ $1 = "rot" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>                CHAR=","<span></span></pre></td></tr><tr><td scope="row"><pre>        fi<span></span></pre></td></tr><tr><td scope="row"><pre>        case "$CHAR" in<span></span></pre></td></tr><tr><td scope="row"><pre>                ( "q" | "Q" )<span></span></pre></td></tr><tr><td scope="row"><pre>                        CONT=0;<span></span></pre></td></tr><tr><td scope="row"><pre>                        GAMEOVER=1<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>                ( "" )<span></span></pre></td></tr><tr><td scope="row"><pre>                        # Silently ignore empty input.<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>                ( * )<span></span></pre></td></tr><tr><td scope="row"><pre>                        echo "Unknown key $CHAR"<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>        esac<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNT=`expr $COUNT '+' 1`<span></span></pre></td></tr><tr><td scope="row"><pre>        while [ $COUNT -ge $ONE_SECOND ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>                COUNT=`expr $COUNT - $ONE_SECOND`<span></span></pre></td></tr><tr><td scope="row"><pre>                MODE="clear";<span></span></pre></td></tr><tr><td scope="row"><pre>                draw_cur $ROT;<span></span></pre></td></tr><tr><td scope="row"><pre>                VPOS=`expr $VPOS '+' 1`<span></span></pre></td></tr><tr><td scope="row"><pre>                MODE="apple";<span></span></pre></td></tr><tr><td scope="row"><pre>                draw_cur $ROT<span></span></pre></td></tr><tr><td scope="row"><pre>        done<span></span></pre></td></tr><tr><td scope="row"><pre>    done<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>function calibrate_timers()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    2>/tmp/readtesttime time $0 -readtest<span></span></pre></td></tr><tr><td scope="row"><pre>    local READ_DUR=`grep real /tmp/readtesttime | sed 's/real.*//' | tr -d ' '`<span></span></pre></td></tr><tr><td scope="row"><pre>    # echo "READ_DUR: $READ_DUR"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    local READ_SINGLE=`echo "scale=20; ($READ_DUR / 200)" | bc`<span></span></pre></td></tr><tr><td scope="row"><pre>    ONE_SECOND=`echo "scale=0; 1.0  / $READ_SINGLE" | bc`<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    # echo "READ_SINGLE: $READ_SINGLE";<span></span></pre></td></tr><tr><td scope="row"><pre>    # exit<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    echo "One second is about $ONE_SECOND cycles."<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ "x$1" = "x-readtest" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>        read_test<span></span></pre></td></tr><tr><td scope="row"><pre>        exit<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "Calibrating.  Please wait."<span></span></pre></td></tr><tr><td scope="row"><pre>calibrate_timers<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "Done calibrating.  You should see a message about once per second.  Press 'q' to quit."<span></span></pre></td></tr><tr><td scope="row"><pre>stty -icanon -isig<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>GAMEOVER=0<span></span></pre></td></tr><tr><td scope="row"><pre>COUNT=0<span></span></pre></td></tr><tr><td scope="row"><pre># Start the game loop.<span></span></pre></td></tr><tr><td scope="row"><pre>while [ $GAMEOVER -eq 0 ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        # echo -n "Enter a character: "<span></span></pre></td></tr><tr><td scope="row"><pre>        CHAR=`./getch`<span></span></pre></td></tr><tr><td scope="row"><pre>        case "$CHAR" in<span></span></pre></td></tr><tr><td scope="row"><pre>                ( "q" | "Q" )<span></span></pre></td></tr><tr><td scope="row"><pre>                        CONT=0;<span></span></pre></td></tr><tr><td scope="row"><pre>                        GAMEOVER=1<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>                ( "" )<span></span></pre></td></tr><tr><td scope="row"><pre>                        # Silently ignore empty input.<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>                ( * )<span></span></pre></td></tr><tr><td scope="row"><pre>                        echo "Unknown key $CHAR"<span></span></pre></td></tr><tr><td scope="row"><pre>                ;;<span></span></pre></td></tr><tr><td scope="row"><pre>        esac<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNT=`expr $COUNT '+' 1`<span></span></pre></td></tr><tr><td scope="row"><pre>        while [ $COUNT -ge $ONE_SECOND ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>                COUNT=`expr $COUNT - $ONE_SECOND`<span></span></pre></td></tr><tr><td scope="row"><pre>                echo "One second elapsed (give or take)."<span></span></pre></td></tr><tr><td scope="row"><pre>        done<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>stty sane<span></span></pre></td></tr></table></div>	<p>In a real-world timing loop, you will probably have keys that perform certain operations that take time—moving a piece on a checkerboard, for example. In that case, your calibration should also perform a series to tests to approximate the amount of time for each of those operations.</p><p>If you divide the time for the slow operation by the duration of a single read operation (<code>READ_SINGLE</code>), you can discern an approximate penalty for the move using iterations of the main program loop as the unit value. Then, when you perform one of those operations later, you simply add that penalty value to the main loop counter, thus ensuring that the "One second elapsed” messages will quickly catch up with (approximately) where they should be.</p><p>You can approximate this further by using larger numbers in your loop counter to achieve greater precision. For example, you might increment your loop counter by 100 instead of by 1. This will give a much more accurate approximation of the number of cycles stolen by a slow operation.</p><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_11" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;If you perform significant multiplication (for example, to increase game play speed on subsequent levels) to change the rate of your timer, using larger values means that you are much more likely to exceed the maximum value that shell math or <code><a href="../../../../Darwin/Reference/ManPages/man1/expr.1.html#//apple_ref/doc/man/1/expr" target="_top">expr</a></code> math can handle during your interim calculations. In such cases, you may find it better to use <code><a href="../../../../Darwin/Reference/ManPages/man1/bc.1.html#//apple_ref/doc/man/1/bc" target="_top">bc</a></code>, which works with floating-point quantities.</p><p></p><div class="clear"></div></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW8" title="Trapping Signals"></a><h2>Trapping Signals</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_38"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_39"></a>No discussion of advanced programming would be complete without an explanation of signal handling. In UNIX-based and UNIX-like operating systems, signals provide a primitive means of interprocess communication. A script or other process can send a signal to another process by either using the <code><a href="../../../../Darwin/Reference/ManPages/man1/kill.1.html#//apple_ref/doc/man/1/kill" target="_top">kill</a></code> command or by calling the <code><a href="../../../../Darwin/Reference/ManPages/man2/kill.2.html#//apple_ref/doc/man/2/kill" target="_top">kill</a></code> function in a C program. Upon receipt, the receiving process either exits, ignores the signal, or executes a signal handler routine of the author’s choosing.</p><p>Signals are most frequently used to terminate execution of a process in a friendly way, allowing that process the opportunity to clean up before it exits. However, they can also be used for other purposes. For example, when a terminal window changes in size, any running shell in that window receives a <code>SIGWINCH</code> (window change) signal. Normally, this signal is ignored, but if a program cares about window size changes, it can trap that signal and handle it in an application-specific way.  With the exception of the <code>SIGKILL</code> signal, any signal can be trapped and handled by calling the function <code><a href="../../../../Darwin/Reference/ManPages/man3/signal.3.html#//apple_ref/doc/man/3/signal" target="_top">signal</a></code>.</p><p>In much the same way, shell scripts can also trap signals and perform operations when they occur, through the use of the <code>trap</code> builtin.</p><p>The syntax of <code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_40"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_41"></a>trap</code> is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>trap function signal [ signal ... ]<span></span></pre></td></tr></table></div><p>The first argument is the name of a function that should be called when the specified signals are received. The remaining arguments contain a space-delimited list of signal names or numbers. Because signal numbers vary between platforms, for maximum readability and portability, you should always use signal names.</p><p>For example, if you want to trap the <code>SIGWINCH</code> (window change) signal, you could write the following statement:</p><div class="codesample"><table><tr><td scope="row"><pre>trap sigwinch_handler SIGWINCH<span></span></pre></td></tr></table></div><p>After you issue this statement, the shell calls the function <code>sigwinch_handler</code> whenever it receives a <code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_42"></a>SIGWINCH</code> signal. The script in <span class="content_text">Listing 7-2</span> prints the phrase “Window size changed.“ whenever you adjust the size of your terminal window.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW10" title="Listing 7-2Installing a signal handler trap"></a><p class="codesample"><strong>Listing 7-2&nbsp;&nbsp;</strong>Installing a signal handler trap</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>function fixrows()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "Window size changed."<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "Adjust the size of your window now."<span></span></pre></td></tr><tr><td scope="row"><pre>trap fixrows SIGWINCH<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>COUNT=0<span></span></pre></td></tr><tr><td scope="row"><pre>while [ $COUNT -lt 60 ] ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        COUNT=$(($COUNT + 1))<span></span></pre></td></tr><tr><td scope="row"><pre>        sleep 1<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><p>Sometimes, instead of trapping a signal, you may want to ignore a signal entirely. To do this, specify an empty string for the function name. For example, the code in <span class="content_text">Listing 7-3</span> ignores the “interrupt” signal generated when you press Control-C:<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_43"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW12" title="Listing 7-3Ignoring a signal"></a><p class="codesample"><strong>Listing 7-3&nbsp;&nbsp;</strong>Ignoring a signal</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre>trap "" SIGINT<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "This program will sleep for 10 seconds and cannot be killed with"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "control-c."<span></span></pre></td></tr><tr><td scope="row"><pre>sleep 10<span></span></pre></td></tr></table></div><p>Finally, signals can be used as a primitive form of interscript communication. The next two scripts work as a pair. To see this in action, first save the script in <span class="content_text">Listing 7-4</span> as <code>ipc1.sh</code> and the script in <span class="content_text">Listing 7-5</span> as <code>ipc2.sh</code>.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW13" title="Listing 7-4ipc1.sh: Script interprocess communication example, part 1 of 2"></a><p class="codesample"><strong>Listing 7-4&nbsp;&nbsp;</strong><code>ipc1.sh</code>: Script interprocess communication example, part 1 of 2</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>## Save this as ipc1.sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>./ipc2.sh &amp;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>PID=$!<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>sleep 1 # Give it time to launch.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>kill -HUP $PID<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW14" title="Listing 7-5ipc2.sh: Script interprocess communication example, part 2 of 2"></a><p class="codesample"><strong>Listing 7-5&nbsp;&nbsp;</strong><code>ipc2.sh</code>: Script interprocess communication example, part 2 of 2</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>## Save this as ipc2.sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>function hup_handler()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        echo "SIGHUP RECEIVED."<span></span></pre></td></tr><tr><td scope="row"><pre>        exit 0<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>trap hup_handler SIGHUP<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while true ; do<span></span></pre></td></tr><tr><td scope="row"><pre>        sleep 1<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><p>Now run <code>ipc1.sh</code>. It launches the script <code>ipc2.sh</code> in the background, uses the special shell variable <code>$!</code> to get the process ID of the last background process (<code>ipc2.sh</code> in this case), then sends it a hangup (<code>SIGHUP</code>) signal using <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_44"></a><code><a href="../../../../Darwin/Reference/ManPages/man1/kill.1.html#//apple_ref/doc/man/1/kill" target="_top">kill</a></code>.</p><p>Because the second script, <code>ipc2.sh</code>, trapped the hangup signal, its shell then calls a handler function, <code>hup_handler</code>. This function prints the words “SIGHUP RECEIVED.“ and exits.<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_45"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_46"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW20" title="Special Shell Variables"></a><h2>Special Shell Variables</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_47"></a>The Bourne shell has a number of special “automatic” variables that it maintains for informational purposes. These variables provide information such as the process ID of the shell, the exit status of the last command, and so on. This section provides a list of these special variables. For additional variables supported by specific Bourne shell variants such as BASH and ZSH, see the <code><a href="../../../../Darwin/Reference/ManPages/man1/bash.1.html#//apple_ref/doc/man/1/bash" target="_top">bash</a></code> and <code><a href="../../../../Darwin/Reference/ManPages/man1/zshparam.1.html#//apple_ref/doc/man/1/zshparam" target="_top">zshparam</a></code> manual pages, respectively.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW26" title="Table 7-1Special shell variables"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 7-1&nbsp;&nbsp;</strong>Special shell variables</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Variable</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><strong>Process information</strong></p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_48"></a>$$</code></p></td><td ><p>Process ID of shell</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_49"></a>$PPID</code></p></td><td ><p>Process ID of shell’s parent process.</p><p><strong>Quirk Warning:</strong> <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_50"></a>For subshells, the value of PPID is inherited from the parent shell. Thus, PPID is only the parent of the outermost shell process.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_51"></a>$?</code></p></td><td ><p>Exit status of last command.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_52"></a>$_</code></p></td><td ><p>Name of last command.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_53"></a>$!</code></p></td><td ><p>Process ID of last process run in the background using ampersand (&amp;) operator. This is commonly used in conjunction with the <code><a href="../../../../Darwin/Reference/ManPages/man1/wait.1.html#//apple_ref/doc/man/1/wait" target="_top">wait</a></code> builtin.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_54"></a>$PATH</code></p></td><td ><p>A colon-delimited list of locations where trusted executables are installed. Any executable in one of these locations can be executed without specifying a complete path.</p></td></tr><tr><td  scope="row"><p><strong>Field and record parsing</strong></p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_55"></a>$IFS</code></p></td><td ><p>Input Field Separators (uses are explained in <span class="content_text"><a href="../shell_scripts/shell_scripts.html#//apple_ref/doc/uid/TP40004268-CH237-SW9">“Variable Expansion and Field Separators”</a></span>)</p></td></tr><tr><td  scope="row"><p><strong>User information</strong></p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_56"></a>$HOME</code></p></td><td ><p>The user’s home directory.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_57"></a>$UID</code></p></td><td ><p>The user’s ID.</p><p><strong>Security Warning:</strong> <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_58"></a>This value can be modified by the calling script, so it should not be used for authentication purposes.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_59"></a>$USER</code></p></td><td ><p>The user’s (short) login name.</p><p><strong>Security Warning:</strong> <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_60"></a>This value can be modified by the calling script, so it should not be used for authentication purposes.</p></td></tr><tr><td  scope="row"><p><strong>Miscellaneous Variables</strong></p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_61"></a>$#</code></p></td><td ><p>Number of arguments passed to the shell.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_62"></a>$@</code></p></td><td ><p>Complete list of arguments passed to the shell, separated by spaces..</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_63"></a>$*</code></p></td><td ><p>Complete list of arguments passed to the shell, separated by the first character of the <code>IFS</code> (input field separators) variable.</p><p><strong>Compatibility Note:</strong> In AIX, if you surround this variable with quotes, the shell wraps each individual argument with <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_64"></a>quotes when it expands the variable.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_65"></a>$-</code></p></td><td ><p>A list of all shell flags currently enabled.</p></td></tr><tr><td  scope="row"><p><code><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_66"></a>$PWD</code></p></td><td ><p>The current working directory. Equivalent to executing the <code><a href="../../../../Darwin/Reference/ManPages/man1/pwd.1.html#//apple_ref/doc/man/1/pwd" target="_top">pwd</a></code> command.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_67"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW27" title="Shell Text Formatting"></a><h2>Shell Text Formatting</h2><p>One powerful technique when writing shell scripts is to take advantage of the terminal emulation features of your terminal application (whether it is Terminal, an xterm, or some other application) to display formatted content.</p><p>You can use the <code><a href="../../../../Darwin/Reference/ManPages/man1/printf.1.html#//apple_ref/doc/man/1/printf" target="_top">printf</a></code> command to easily create columnar layouts without any special tricks. For more visually exciting presentation, you can add color or text formatting such as boldface or underlined display using ANSI (VT100/VT220) escape sequences.</p><p>In addition, you can use ANSI escape sequences to show or hide the cursor, set the cursor position anywhere on the screen, and set various text attributes, including boldface, inverse, underline, and foreground and background color.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW28" title="Using the printf Command for Tabular Layout"></a><h3>Using the printf Command for Tabular Layout</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_68"></a>Much like C and other languages, most operating systems that support shell scripts also provide a command-line version of <code><a href="../../../../Darwin/Reference/ManPages/man1/printf.1.html#//apple_ref/doc/man/1/printf" target="_top">printf</a></code>. This command differs from the C <code><a href="../../../../Darwin/Reference/ManPages/man3/printf.3.html#//apple_ref/doc/man/3/printf" target="_top">printf</a></code> function in a number of ways. These differences include the following:</p><ul class="spaceabove"><li class="li"><p>The <code>%c</code> directive does not perform integer-to-character conversion. The only way to convert an integer to a character with the shell version is to first convert the integer into octal and then print it by using the octal value as a switch. For example, <code>printf "\144"</code> prints the lowercase letter d.</p></li><li class="li"><p>The command-line version supports a much smaller set of placeholders. For example, <code>%p</code> (pointers) does not exist in the shell version.</p></li><li class="li"><p>The command-line version does not have a notion of long or double-precision numbers. Although flags with these modifiers are allowed (<code>%lld</code>, for example), the modifiers are ignored. Thus, there is no difference between <code>%d</code>, <code>%ld</code>, and <code>%lld</code>.</p></li><li class="li"><p>Large integers may be truncated to 32-bit signed values.</p></li><li class="li"><p>Double-precision floating-point values may be reduced to single-precision values.</p></li><li class="li"><p>Floating point precision is not guaranteed (even for single-precision values) because some imprecision is inherent in the conversion between strings and floating-point numbers.</p></li></ul><p>Much like the <code>printf</code> statement in other languages, the shell script <code>printf</code> syntax is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>printf "format string" argument ...<span></span></pre></td></tr></table></div><p>Like the C <code>printf</code> function, the command-line <code>printf</code> format string contains some combination of text, switches (<code>\n</code> and <code>\t</code>, for example), and placeholders (<code>%d</code>, for example).</p><p>The most important feature of <code>printf</code> for tabular layouts is the padding feature. Between the percent sign and the type letter, you can place a number to indicate the width to which the field should be padded. For a floating-point placeholder (<code>%f</code>), you can optionally specify <code>two</code> numbers separated by a decimal point. The leftmost value indicates the total field width, while the rightmost value indicates the number of decimal places that should be included. For example, you can print pi to three digits of precision in an 8-character-wide field by typing <code>printf "%8.3f" 3.14159265</code>.</p><p>In addition to the width of the padding, you can add certain prefixes before the field width to indicate special padding requirements. They are:</p><ul class="spaceabove"><li class="li"><p>Minus sign (<code>-</code>)—indicates the field should be left justified. (Fields are right justified by default.)</p></li><li class="li"><p>Plus sign (<code>+</code>)—indicates that a sign should be prepended to a numerical argument even if it has a positive value.</p></li><li class="li"><p>Space—indicates that a space should be added to a numerical argument in place of the sign if the value is positive. (A plus sign takes precedence over a space.)</p></li><li class="li"><p>Zero (<code>0</code>)—indicates that numerical arguments should be padded with leading zeroes instead of spaces. (A minus sign takes precedence over a zero.)</p></li></ul><p>For example, if you want to create a four-column table of name, address, phone number, and GPA, you might write a statement like this:</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW29" title="Listing 7-6Columnar printing using printf"></a><p class="codesample"><strong>Listing 7-6&nbsp;&nbsp;</strong>Columnar printing using <code>printf</code></p><div class="codesample"><table><tr><td scope="row"><pre>#/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>NAME="John Doe"<span></span></pre></td></tr><tr><td scope="row"><pre>ADDRESS="1 Fictitious Rd, Bucksnort, TN"<span></span></pre></td></tr><tr><td scope="row"><pre>PHONE="(555) 555-5555"<span></span></pre></td></tr><tr><td scope="row"><pre>GPA="3.885"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%20s | %30s | %14s | %5s\n" "Name" "Address" "Phone Number" "GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%20s | %30s | %14s | %5.2f\n" "$NAME" "$ADDRESS" "$PHONE" "$GPA"<span></span></pre></td></tr></table></div><p>The <code>printf</code> statement pads the fields into neat columns and truncates the GPA to two decimal places, leaving room for three additional characters (the decimal point itself, the ones place, and a leading space). You should notice that the additional arguments are all surrounded by quotation marks. If you do not do this, you will get incorrect behavior because of the spaces in the arguments.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW37" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>printf</code> command, like its C function sibling, does not truncate values to fit within the specified field width. For examples of how to truncate strings, see <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW16">“Truncating Strings.”</a></span></p></div><p>The next sample shows number formatting:</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>GPA="3.885"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>printf "%f | whatever\n" "$GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%20f | whatever\n" "$GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%+20f | whatever\n" "$GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%+020f | whatever\n" "$GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%-20f | whatever\n" "$GPA"<span></span></pre></td></tr><tr><td scope="row"><pre>printf "%- 20f | whatever\n" "$GPA"<span></span></pre></td></tr></table></div><p>This prints the following output:</p><div class="codesample"><table><tr><td scope="row"><pre>3.885000 | whatever<span></span></pre></td></tr><tr><td scope="row"><pre>            3.885000 | whatever<span></span></pre></td></tr><tr><td scope="row"><pre>           +3.885000 | whatever<span></span></pre></td></tr><tr><td scope="row"><pre>+000000000003.885000 | whatever<span></span></pre></td></tr><tr><td scope="row"><pre>3.885000             | whatever<span></span></pre></td></tr><tr><td scope="row"><pre> 3.885000            | whatever<span></span></pre></td></tr></table></div><p>Most of the same formatting options apply to <code>%s</code> and <code>%d</code> (including, surprisingly, zero-padding of string arguments). For more information, see the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man1/printf.1.html#//apple_ref/doc/man/1/printf" target="_top">printf</a></code>.<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_69"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW16" title="Truncating Strings"></a><h3>Truncating Strings</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_70"></a>To truncate a value to a given width, you can use a simple regular expression to keep only the first few characters. For example, the following snippet copies the first seven characters of a string:</p><div class="codesample"><table><tr><td scope="row"><pre>STRING="whatever you want it to be"<span></span></pre></td></tr><tr><td scope="row"><pre>TRUNCSTRING="`echo "$STRING" | sed 's/^\(.......\).*$/\1/'`"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "$TRUNCSTRING"<span></span></pre></td></tr></table></div><p>As an alternative, you can use a more general-purpose routine such as the one in <span class="content_text">Listing 7-7</span>, which truncates a string to an arbitrary length by building up a regular expression.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW15" title="Listing 7-7Truncating text to column width"></a><p class="codesample"><strong>Listing 7-7&nbsp;&nbsp;</strong>Truncating text to column width</p><div class="codesample"><table><tr><td scope="row"><pre>function trunc_field()
{
    local STR=$1
    local CHARS=$2
    local EXP=""
    local COUNT=0
    while [ $COUNT -lt $CHARS ] ; do
        EXP="$EXP."
        COUNT=`expr $COUNT + 1`
    done
    echo $STR | sed "s/^\($EXP\).*$/\1/"
}

printf "%10s | something\n" "`trunc_field "$TEXT" 20`"<span></span></pre></td></tr></table></div><p>Of course, you can do this much faster by either caching these strings or replacing most of the function with a single line of Perl:</p><div class="codesample"><table><tr><td scope="row"><pre>echo "$STR" | perl -e "$/=undef; print substr(&lt;STDIN>, 0, $CHARS);"<span></span></pre></td></tr></table></div><p>Finally, if you are willing to write code that is <em>extremely</em> nonportable (using a syntax that does not even work in ZSH), you can use BASH-specific <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_71"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_72"></a>substring expansion:</p><div class="codesample"><table><tr><td scope="row"><pre>echo "${STR:0:8}"<span></span></pre></td></tr></table></div><p>You can learn about similar operations in the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man1/bash.1.html#//apple_ref/doc/man/1/bash" target="_top">bash</a></code> under the “Parameter Expansion” heading. As a general rule, however, you should avoid such shell-specific tricks.<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_73"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW30" title="Using ANSI Escape Sequences"></a><h3>Using ANSI Escape Sequences</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_74"></a>You can use <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_75"></a>ANSI escape sequences to add color or formatting to text displayed in the terminal, reposition the cursor, set tab stops, clear portions of the display, change scrolling behavior, and more. This section includes a partial list of many commonly used escape sequences, along with examples of how to use them.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_12" title="Important:"></a><p><strong>Important:</strong>&nbsp;For the purposes of this section, the Esc (escape) key is represented by the notation <code>^[</code> because the ASCII character for the Esc key is the same as the ASCII character for Control-bracket (character 27). Thus, when you see <code>^[[</code>, it means Esc followed by a bracket. (Nearly all ANSI escape sequences begin with Esc-bracket, though there are a few exceptions.)</p><p></p></div><p>There are two ways to generate escape sequences: direct printing and using the terminfo database. Printing the sequences directly has significant performance advantages but is less portable because it assumes that all terminals are ANSI/VT100/VT220-compliant. A good compromise is to combine these two approaches by caching the values generated with a terminfo command such as <code><a href="../../../../Darwin/Reference/ManPages/man1/tput.1.html#//apple_ref/doc/man/1/tput" target="_top">tput</a></code> at the beginning of your script and then printing the values directly elsewhere in the script.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW31" title="Generating Escape Sequences using the terminfo Database"></a><h4>Generating Escape Sequences using the terminfo Database</h4><p>Generating <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_76"></a>escape sequences with the terminfo database is relatively straightforward once you know what terminal capabilities to request. You can find several tables containing capability information, along with the standard ANSI/VT220 values for each capability, in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW9">“ANSI Escape Sequence Tables.”</a></span> (Note that not all ANSI escape sequences have equivalent terminfo capabilities, and vice versa.)</p><p>Once you know what capability to request (along with any additional arguments that you must specify), you can use the <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_77"></a><code><a href="../../../../Darwin/Reference/ManPages/man1/tput.1.html#//apple_ref/doc/man/1/tput" target="_top">tput</a></code> command to output the escape sequence (or capture the output of <code>tput</code> into a variable so you can use it later). For example, you can clear the screen with the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>tput cl<span></span></pre></td></tr></table></div><p>Some terminfo database entries contain placeholders for numeric values, such as row and column information. The easiest way to use these is to specify those numeric values on the command line when calling <code>tput</code>. However, for performance, it may be faster to substitute the values yourself. For example, the capability <code>cup</code> sets the cursor position to a row and column value. The following command sets the position to row 3, column 7:</p><div class="codesample"><table><tr><td scope="row"><pre>tput cup 3 7<span></span></pre></td></tr></table></div><p>You can, however, obtain the unsubstituted string by requesting the capability without specifying row and column parameters. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>tput cup | less<span></span></pre></td></tr></table></div><p>By piping the data to <code><a href="../../../../Darwin/Reference/ManPages/man1/less.1.html#//apple_ref/doc/man/1/less" target="_top">less</a></code>, you can see precisely what the <code>tput</code> tool is providing, and you can look up the parameters in the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man5/terminfo.5.html#//apple_ref/doc/man/5/terminfo" target="_top">terminfo</a></code>. This particular example prints the following string:</p><div class="codesample"><table><tr><td scope="row"><pre>^[[%i%p1%d;%p2%dH<span></span></pre></td></tr></table></div><p>The <code>%i</code> notation means that the first two (and only the first two) values are one greater than you might otherwise expect. (For ANSI terminals, columns and rows number from 1 rather than from 0). The <code>%p1%d</code> means to push parameter 1 onto the stack and then print it immediately. The parameter <code>%p2%d</code> is the equivalent for parameter 2.</p><p>As you can see from even this relatively simple example, the language used for terminfo is quite complex. Thus, while it may be acceptable to perform the substitution for simple terminals such as VT100 yourself, you may still be trading performance for portability. In general, it is best to let <code>tput</code> perform the substitutions on your behalf.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW7" title="Generating Escape Sequences Directly"></a><h4>Generating Escape Sequences Directly</h4><p>To use an <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_78"></a>ANSI escape sequence without using <code><a href="../../../../Darwin/Reference/ManPages/man1/tput.1.html#//apple_ref/doc/man/1/tput" target="_top">tput</a></code>, you must first be able to print an escape character from your script. There are three ways to do this:</p><ul class="spaceabove"><li class="li"><p><strong>Use </strong><code>printf</code><strong> to print the escape sequence.</strong> In a string, the <code>\e</code> switch prints an escape character. This is the easiest way to print escape sequences.</p><p>For example, the following snippet shows how to print the reset sequence (<code>^[c</code>):</p><div class="codesample"><table><tr><td scope="row"><pre>printf "\ec" # resets the screen<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW38" title="Note"></a><p><strong>Note:</strong>&nbsp;In all versions of Mac OS X, <code><a href="../../../../Darwin/Reference/ManPages/man1/printf.1.html#//apple_ref/doc/man/1/printf" target="_top">printf</a></code> is a shell builtin for <code>/bin/sh</code>. However, this is not necessarily true for other platforms. Thus, if cross-platform performance is an issue, you should avoid this usage.</p></div></li><li class="li"><p><strong>Embed the escape character in your script.</strong> <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_79"></a>The method of doing this varies widely from one editor to another. In most text-based editors and on the command line itself, you do this by pressing Control-V followed by the Esc key. Although this is the fastest way to print an escape sequence, it has the disadvantage of making your script harder to edit.</p><p>For example, you might write a snippet like this one:</p><div class="codesample"><table><tr><td scope="row"><pre>echo "^[c" # Read the note below!!!<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW39" title="Note"></a><p><strong>Note:</strong>&nbsp;You <em>must</em> enter this escape character manually; copying and pasting the text in this example will <em>not</em> work.</p>To enter the above escape sequence, type <code>echo</code> followed by a space and double-quote mark. Then press Control-V followed by the Esc key to add the escape character. Next, type a lowercase <code>c</code>. Finally, close the double-quote mark and press Return.</p></div></li><li class="li"><p><strong>Use </strong><code>printf</code><strong> to store an escape character into a variable.</strong> <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_80"></a>This is the recommended technique because it is nearly as fast as embedding the escape character but does not make the code hard to read and edit.</p><p>For example, the following code sends a terminal reset command (<code>^[c</code>):</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ESC=`printf "\e"`       # store an escape character<span></span></pre></td></tr><tr><td scope="row"><pre>                        # into the variable ESC<span></span></pre></td></tr><tr><td scope="row"><pre>echo "$ESC""c"          # Echo a terminal reset command.<span></span></pre></td></tr></table></div></li></ul><p>Because the terminal reset command is one of only a handful of escape sequences that do not start with a left square bracket, it is worth pointing out the two sets of double-quote marks after the variable in the above example. Without those, the shell tries to print the value of the variable <code>ESCc</code>, which does not exist.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW9" title="ANSI Escape Sequence Tables"></a><h3>ANSI Escape Sequence Tables</h3><p>There are four basic categories of escape codes:</p><ul class="spaceabove"><li class="li"><p>Cursor manipulation routines (described in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW2">Table 7-2</a></span>) allow you to move the cursor around on the screen, show or hide the cursor, and limit scrolling to only a portion of the screen.</p></li><li class="li"><p>Attribute manipulation sequences (described in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW6">“Attribute and Color Escape Sequences”</a></span>) allow you to set or clear text attributes such as underlining, boldface display, and inverse display.</p></li><li class="li"><p>Color manipulation sequences (described in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW6">“Attribute and Color Escape Sequences”</a></span>) allow you to change the foreground and background color of text.</p></li><li class="li"><p>Other escape codes (described in <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW5">Table 7-5</a></span>) support clearing the screen, clearing portions of the screen, resetting the terminal, and setting tab stops.</p></li></ul><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW32" title="Cursor and Scrolling Manipulation Escape Sequences"></a><h4>Cursor and Scrolling Manipulation Escape Sequences</h4><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_81"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_82"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_83"></a>Tdhe terminal window is divided into a series of rows and columns. The upper-left corner is row 1, column 1. The lower-right corner varies depending on the size of the terminal window.</p><p>You can obtain the current number of rows and columns on the screen by examining the values of the shell variables <code>LINES</code> and <code>COLUMNS</code>. Thus, the screen coordinates range from <code>(1, 1)</code> to <code>($LINES, $COLUMNS)</code>. In most modern Bourne shells, the values for <code>LINES</code> and <code>COLUMNS</code> are automatically updated when the window size changes. This is true for both BASH and ZSH shells.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW43" title="Compatibility Note"></a><p><strong>Compatibility Note:</strong>&nbsp;<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_84"></a>In BASH, the <code>LINES</code> and <code>COLUMNS</code> variables are set only for interactive instances of the shell. This presents a small problem for shell scripts that care about window size. As a result, in versions of Mac OS X where the default shell is BASH (Mac OS X v10.3 and newer), these variables are not defined in shell scripts that start with <code>#!/bin/sh</code>.</p>Of course, you could request that ZSH interpret the script by changing the first line of your script to <code>#!/bin/zsh</code>, but doing so is not particularly portable. Fortunately, without changing shells, you can easily obtain the current row and column count with the code in <span class="content_text">Listing 7-8</span>.<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_85"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW17" title="Listing 7-8Obtaining terminal size using stty or tput"></a><p class="codesample"><strong>Listing 7-8&nbsp;&nbsp;</strong>Obtaining terminal size using <code>stty</code> or <code>tput</code></p><div class="codesample"><table><tr><td scope="row"><pre># If tput is available, this is the easy way:<span></span></pre></td></tr><tr><td scope="row"><pre>MYLINES=`tput lines` # ROWS<span></span></pre></td></tr><tr><td scope="row"><pre>MYCOLUMNS=`tput cols` # COLUMNS<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># If not, you can do it the hard way.  This usually works.<span></span></pre></td></tr><tr><td scope="row"><pre>MYLINES=`stty -a | grep rows | sed 's/^.*;\(.*\)rows\(.*\);.*$/\1\2/' | sed 's/;.*$//' | sed 's/[^0-9]//g'` # ROWS<span></span></pre></td></tr><tr><td scope="row"><pre>MYCOLUMNS=`stty -a | grep columns | sed 's/^.*;\(.*\)columns\(.*\);.*$/\1\2/' | sed 's/;.*$//' | sed 's/[^0-9]//g'` # COLUMNS<span></span></pre></td></tr></table></div>	</div><p>If you want to be particularly clever, you can also trap the <code>SIGWINCH</code> signal and update your script’s notion of lines and columns when it occurs. See <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW8">“Trapping Signals”</a></span> for more information.</p><p>Once you know the number of rows and columns on your screen, you can move the cursor around with the escape sequences listed in <span class="content_text">Table 7-2</span>. For example, to set the cursor position to row 4, column 5, you could issue the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>printf "\e[4;5H"<span></span></pre></td></tr></table></div><p>For other, faster ways to print escape sequences, see <span class="content_text"><a href="AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW7">“Generating Escape Sequences Directly.”</a></span></p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW2" title="Table 7-2Cursor and scrolling manipulation escape sequences"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 7-2&nbsp;&nbsp;</strong>Cursor and scrolling manipulation escape sequences</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Terminfo capability</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Escape sequence</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>tivis</code></p><p><strong>Note: </strong>The <code>terminfo</code> entry for Terminal does not support this option.</p></td><td ><p><code>^[[?25l</code></p></td><td ><p>Hides the cursor.</p></td></tr><tr><td  scope="row"><p><code>tvvis</code></p><p><strong>Note: </strong>The <code>terminfo</code> entry for Terminal does not support this option.</p></td><td ><p><code>^[[?25h</code></p></td><td ><p>Shows the cursor.</p></td></tr><tr><td  scope="row"><p><code>cup </code><em>row</em> <em>colum</em></p></td><td ><p><code>^[[</code><em>r</em><code>;</code><em>c</em><code>H</code></p></td><td ><p>Sets cursor position to row <em>r</em>, column <em>c</em>.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[6n</code></p></td><td ><p>Reports current cursor position as though typed from the keyboard (reported as <code>^[[</code><em>r</em><code>;</code><em>c</em><code>R</code>). Note: it is not practical to capture this information in a shell script.</p></td></tr><tr><td  scope="row"><p><code>sc</code></p></td><td ><p><code>^[7</code></p></td><td ><p>Saves current cursor position and style.</p></td></tr><tr><td  scope="row"><p><code>rc</code></p></td><td ><p><code>^[8</code></p></td><td ><p>Restores previously saved cursor position and style.</p></td></tr><tr><td  scope="row"><p><code>cuu </code><em>r</em></p></td><td ><p><code>^[[</code><em>r</em><code>A</code></p></td><td ><p>Moves cursor up <em>r</em> rows.</p></td></tr><tr><td  scope="row"><p><code>cud </code><em>r</em></p></td><td ><p><code>^[[</code><em>r</em><code>B</code></p></td><td ><p>Moves cursor down <em>r</em> rows.</p></td></tr><tr><td  scope="row"><p><code>cuf </code><em>c</em></p></td><td ><p><code>^[[</code><em>c</em><code>C</code></p></td><td ><p>Moves cursor right <em>c</em> columns.</p></td></tr><tr><td  scope="row"><p><code>cub </code><em>c</em></p></td><td ><p><code>^[[</code><em>c</em><code>D</code></p></td><td ><p>Moves cursor left <em>c</em> columns.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[7h</code></p></td><td ><p>Disables automatic line wrapping when the cursor reaches the right edge of the screen.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[7l</code></p></td><td ><p>Enables line wrapping (on by default).</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[r</code></p></td><td ><p>Enables whole-screen scrolling (on by default).</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[</code><em>S</em><code>;</code><em>E</em><code>r</code></p></td><td ><p>Enables partial-screen scrolling from row <em>S</em> to row <em>E</em> and moves the cursor to the top of this region.</p></td></tr><tr><td  scope="row"><p><code>do</code></p></td><td ><p><code>^[D</code></p></td><td ><p>Moves the cursor down by one line.</p></td></tr><tr><td  scope="row"><p><code>up</code></p></td><td ><p><code>^[M</code></p></td><td ><p>Moves the cursor up by one line.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_86"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_87"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_88"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW6" title="Attribute and Color Escape Sequences"></a><h4>Attribute and Color Escape Sequences</h4><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_89"></a>Attribute and color escape sequences allow you to change the attributes or color for text that you have not yet drawn. No escape sequence (scrolling notwithstanding) changes anything that has already been drawn on the screen. Escape sequences apply only to subsequent text.</p><p>For example, to draw a red “W” character, first send the escape sequence to set the foreground color to red (<code>^[[31m</code>), then print a “W” character, then send an attribute reset sequence (<code>^[[m</code>), if desired.</p><p>The attribute and color escape codes can be combined with other attribute and color escape codes in the form <code>^[[#;#;#;...#m</code>. For example, you can combine the escape sequences <code>^[[1m</code> (bold) and <code>^[[32m</code> green text) into the sequence <code>^[[1;32m</code>. <span class="content_text">Listing 7-9</span> prints a familiar phrase in multiple colors.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW18" title="Listing 7-9Using ANSI color"></a><p class="codesample"><strong>Listing 7-9&nbsp;&nbsp;</strong>Using ANSI color</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>printf '\e[41mH\e[42me\e[43ml\e[44;32ml\e[45mo\e[m \e[46;33m'<span></span></pre></td></tr><tr><td scope="row"><pre>printf 'W\e[47;30mo\e[40;37mr\e[49;39ml\e[41md\e[42m!\e[m\n'<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW40" title="Note"></a><p><strong>Note:</strong>&nbsp;For consistent formatting, you may add a leading zero to any single-digit attribute escape sequences, if desired. For example, <code>^[[1m</code> is equivalent to <code>^[[01m</code>.</p></div><p><span class="content_text">Table 7-3</span> contains a list of capabilities and escape sequences that control text style.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW4" title="Table 7-3Attribute escape sequences"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 7-3&nbsp;&nbsp;</strong>Attribute escape sequences</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Terminfo capability</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Escape sequence</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><strong>Resetting attributes</strong></p></td></tr><tr><td  scope="row"><p><code>me</code></p></td><td ><p><code>^[[m</code> or <code>^[[0m</code></p></td><td ><p>Resets all attributes to their default values.</p></td></tr><tr><td  scope="row"><p><strong>Setting attributes</strong></p></td></tr><tr><td  scope="row"><p><code>bold</code></p></td><td ><p><code>^[[1m</code></p></td><td ><p>Enables “bold” display. This code and code #2 (<code>dim</code>) are mutually exclusive.</p></td></tr><tr><td  scope="row"><p><code>dim</code></p></td><td ><p><code>^[[2m</code></p></td><td ><p>Enables “dim” display. This code and code #1 (<code>bold</code>) are mutually exclusive. Not supported in Terminal.</p></td></tr><tr><td  scope="row"><p><code>so</code></p><p><strong>Note: </strong>In the <code>terminfo</code> database entry for Terminal, this attribute is mapped to inverse because the VT100 “standout” mode is not supported.</p></td><td ><p><code>^[[3m</code></p></td><td ><p>Enables “standout” display. Not supported in Terminal.</p></td></tr><tr><td  scope="row"><p><code>us</code></p></td><td ><p><code>^[[4m</code></p></td><td ><p>Enables underlined display.</p></td></tr><tr><td  scope="row"><p><code>blink</code></p><p><strong>Note: </strong>The <code>terminfo</code> entry for Terminal does not support this option.</p></td><td ><p><code>^[[5m</code></p></td><td ><p>&lt;blink>.</p></td></tr><tr><td  scope="row"><p>(No equivalent.)</p></td><td ><p><code>^[[6m</code></p></td><td ><p>Fast blink or strike-through. (Not supported in Terminal; behavior inconsistent elsewhere.)</p></td></tr><tr><td  scope="row"><p><code>mr</code></p></td><td ><p><code>^[[7m</code></p></td><td ><p>Enables reversed (inverse) display.</p></td></tr><tr><td  scope="row"><p><code>invis</code></p><p><strong>Note: </strong>The <code>terminfo</code> entry for Terminal does not support this option.</p></td><td ><p><code>^[[8m</code></p></td><td ><p>Enables hidden (background-on-background) display.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[9m</code></p></td><td ><p>Unused.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Codes <code>10m</code>–<code>19m</code></p></td><td ><p>Font selection codes. Unsupported in most terminal applications, including Terminal.</p></td></tr><tr><td  scope="row"><p><strong>Clearing attributes</strong></p></td></tr><tr><td  scope="row"><p>(No equivalent.)</p></td><td ><p><code>^[[20m</code></p></td><td ><p>“Fraktur” typeface. Unsupported almost universally, and Terminal is no exception.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[21m</code></p></td><td ><p>Unused.</p></td></tr><tr><td  scope="row"><p><code>se</code></p><p><strong>Note: </strong>Technically, this capability is supposed to end standout mode, but it is overloaded to disable bold bright/dim mode as well.</p></td><td ><p><code>^[[22m</code></p></td><td ><p>Disables “bright” or “dim” display. This disables either code <code>1m</code> or <code>2m</code>.</p></td></tr><tr><td  scope="row"><p><code>se</code></p></td><td ><p><code>^[[23m</code></p></td><td ><p>Disables “standout” display. Not supported in Terminal.</p></td></tr><tr><td  scope="row"><p><code>ue</code></p></td><td ><p><code>^[[24m</code></p></td><td ><p>Disables underlined display.</p></td></tr><tr><td  scope="row"><p>(No equivalent. Use <code>me</code> to disable all attributes instead.)</p></td><td ><p><code>^[[25m</code></p></td><td ><p>&lt;/blink>. Also disables slow blink or strike-through (<code>6m</code>) on terminals that support that attribute.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[26m</code></p></td><td ><p>Unused.</p></td></tr><tr><td  scope="row"><p>(No equivalent. Use <code>me</code> to disable all attributes instead.)</p></td><td ><p><code>^[[27m</code></p></td><td ><p>Disables reversed (inverse) display.</p></td></tr><tr><td  scope="row"><p>(No equivalent. Use <code>me</code> to disable all attributes instead.)</p></td><td ><p><code>^[[28m</code></p></td><td ><p>Disables hidden (background-on-background) display.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[29m</code></p></td><td ><p>Unused.</p></td></tr></table></div><p><span class="content_text">Table 7-4</span> contains a list of capabilities and escape sequences that control text and background colors.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_90"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_91"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_92"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW3" title="Table 7-4Color escape sequences"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 7-4&nbsp;&nbsp;</strong>Color escape sequences</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Terminfo capability</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Escape sequence</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><strong>Foreground colors</strong></p></td></tr><tr><td  scope="row"><p><code>setaf 0</code></p></td><td ><p><code>^[[30m</code></p></td><td ><p>Sets foreground color to black.</p></td></tr><tr><td  scope="row"><p><code>setaf 1</code></p></td><td ><p><code>^[[31m</code></p></td><td ><p>Sets foreground color to red.</p></td></tr><tr><td  scope="row"><p><code>setaf 2</code></p></td><td ><p><code>^[[32m</code></p></td><td ><p>Sets foreground color to green.</p></td></tr><tr><td  scope="row"><p><code>setaf 3</code></p></td><td ><p><code>^[[33m</code></p></td><td ><p>Sets foreground color to yellow.</p></td></tr><tr><td  scope="row"><p><code>setaf 4</code></p></td><td ><p><code>^[[34m</code></p></td><td ><p>Sets foreground color to blue.</p></td></tr><tr><td  scope="row"><p><code>setaf 5</code></p></td><td ><p><code>^[[35m</code></p></td><td ><p>Sets foreground color to magenta.</p></td></tr><tr><td  scope="row"><p><code>setaf 6</code></p></td><td ><p><code>^[[36m</code></p></td><td ><p>Sets foreground color to cyan.</p></td></tr><tr><td  scope="row"><p><code>setaf 7</code></p></td><td ><p><code>^[[37m</code></p></td><td ><p>Sets foreground color to white.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[38m</code></p></td><td ><p>Unused.</p></td></tr><tr><td  scope="row"><p><code>setaf 9</code></p></td><td ><p><code>^[[39m</code></p></td><td ><p>Sets foreground color to the default.</p></td></tr><tr><td  scope="row"><p><strong>Background colors</strong></p></td></tr><tr><td  scope="row"><p><code>setab 0</code></p></td><td ><p><code>^[[40m</code></p></td><td ><p>Sets background color to black.</p></td></tr><tr><td  scope="row"><p><code>setab 1</code></p></td><td ><p><code>^[[41m</code></p></td><td ><p>Sets background color to red.</p></td></tr><tr><td  scope="row"><p><code>setab 2</code></p></td><td ><p><code>^[[42m</code></p></td><td ><p>Sets background color to green.</p></td></tr><tr><td  scope="row"><p><code>setab 3</code></p></td><td ><p><code>^[[43m</code></p></td><td ><p>Sets background color to yellow.</p></td></tr><tr><td  scope="row"><p><code>setab 4</code></p></td><td ><p><code>^[[44m</code></p></td><td ><p>Sets background color to blue.</p></td></tr><tr><td  scope="row"><p><code>setab 5</code></p></td><td ><p><code>^[[45m</code></p></td><td ><p>Sets background color to magenta.</p></td></tr><tr><td  scope="row"><p><code>setab 6</code></p></td><td ><p><code>^[[46m</code></p></td><td ><p>Sets background color to cyan.</p></td></tr><tr><td  scope="row"><p><code>setab 7</code></p></td><td ><p><code>^[[47m</code></p></td><td ><p>Sets background color to white.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>^[[48m</code></p></td><td ><p>Unused.</p></td></tr><tr><td  scope="row"><p><code>setab 9</code></p></td><td ><p><code>^[[49m</code></p></td><td ><p>Sets background color to the default.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_93"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_94"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW33" title="Other Escape Sequences"></a><h4>Other Escape Sequences</h4><p>In addition to providing text formatting, ANSI escape sequences provide the ability to reset the terminal, clear the screen (or portions thereof), clear a line (or portions thereof), and set or clear tab stops.</p><p>For example, to clear all existing tab stops and set a single tab stop at column 20, you could use the snippet show in <span class="content_text">Listing 7-10</span>.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW19" title="Listing 7-10Setting tab stops"></a><p class="codesample"><strong>Listing 7-10&nbsp;&nbsp;</strong>Setting tab stops</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre>echo # Start on a new line<span></span></pre></td></tr><tr><td scope="row"><pre>printf "\e[19C" # move right 19 columns to column 20<span></span></pre></td></tr><tr><td scope="row"><pre>printf "\e[3g" # clear all tab stops<span></span></pre></td></tr><tr><td scope="row"><pre>printf "\e[W" # set a new tab stop<span></span></pre></td></tr><tr><td scope="row"><pre>printf "\e[19D" # move back to the left<span></span></pre></td></tr><tr><td scope="row"><pre>printf "Tab test\tThis starts at column 20."<span></span></pre></td></tr></table></div><p><span class="content_text">Table 7-5</span> contains a list of capabilities and escape sequences that perform other miscellaneous tasks such as cursor control, tab stop manipulation, and clearing the screen or portions thereof.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW5" title="Table 7-5Other escape codes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 7-5&nbsp;&nbsp;</strong>Other escape codes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Terminfo capability</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Escape sequence</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_95"></a><strong>Resetting the terminal</strong></p></td></tr><tr><td  scope="row"><p><code>reset</code></p><p><strong>Note: </strong>This resets many more things than <code>^[c</code>. It is also technically not a single capability but rather the contatenation of <code>rs1</code>, <code>rs2</code>, and <code>rs3</code>.</p></td><td ><p><code>^[c</code></p></td><td ><p>Resets the background and foreground colors to their default values, clears the screen, and moves the cursor to the home position.</p></td></tr><tr><td  scope="row"><p><strong>Clearing the screen<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_96"></a></strong></p></td></tr><tr><td  scope="row"><p><code>cd</code></p></td><td ><p><code>^[[J</code> or <code>^[[0J</code></p></td><td ><p>Clears to the bottom of the screen using the current background color.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[1J</code></p></td><td ><p>Clears to the top of the screen using the current background color.</p></td></tr><tr><td  scope="row"><p><code>cl</code></p></td><td ><p><code>^[[2J</code></p></td><td ><p>Clears the screen to the current background color. On some terminals, the cursor is reset to the home position.</p></td></tr><tr><td  scope="row"><p><strong>Clearing the current line</strong></p></td></tr><tr><td  scope="row"><p><code>ce</code></p></td><td ><p><code>^[[K</code> or <code>^[[0K</code></p></td><td ><p>Clears to the end of the current line.</p></td></tr><tr><td  scope="row"><p><code>cb</code>—Not supported in <code>terminfo</code> entry for Terminal.</p></td><td ><p><code>^[[1K</code></p></td><td ><p>Clears to the beginning of the current line.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[2K</code></p></td><td ><p>Clears the current line.</p></td></tr><tr><td  scope="row"><p><strong><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_97"></a>Tab stops<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_98"></a></strong></p></td></tr><tr><td  scope="row"><p><code>hts</code></p></td><td ><p><code>^[[W</code> or <code>^[[0W</code></p></td><td ><p>Set horizontal tab at cursor position.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[1W</code></p></td><td ><p>Set vertical tab at current line. (Not supported in Terminal.)</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Codes <code>2W</code>–<code>6W</code></p></td><td ><p>Redundant codes equivalent to codes <code>0g</code>–<code>3g</code>.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p><code>^[[g</code> or <code>^[[0g</code></p></td><td ><p>Clear horizontal tab at cursor position.</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p>^[[1g</p></td><td ><p>Clear vertical tab at current line. (Not supported in Terminal.)</p></td></tr><tr><td  scope="row"><p>(no equivalent)</p></td><td ><p>^[[2g</p></td><td ><p>Clear horizontal and vertical tab stops for current line <em>only</em>. (Not supported in Terminal.)</p></td></tr><tr><td  scope="row"><p><code>tbc</code></p></td><td ><p>^[[3g</p></td><td ><p>Clear all horizontal tabs.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_99"></a><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW41" title="Note"></a><p><strong>Note:</strong>&nbsp;You can also set tab stops with the command-line utility <code><a href="../../../../Darwin/Reference/ManPages/man1/tabs.1.html#//apple_ref/doc/man/1/tabs" target="_top">tabs</a></code>.</p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_100"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW34" title="For More Information"></a><h4>For More Information</h4><p>The tables in this chapter provide only some of the more commonly used escape sequences and <code>terminfo</code> capabilities. You can find an exhaustive list of ANSI escape sequences at <span class="content_text"><a href="http://www.inwap.com/pdp10/ansicode.txt" target="_blank">http://www.inwap.com/pdp10/ansicode.txt</a></span> and an exhaustive list of <code>terminfo</code> capabilities in the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man5/terminfo.5.html#//apple_ref/doc/man/5/terminfo" target="_top">terminfo</a></code>.</p><p>Before using capabilities or escape sequences not in this chapter, however, you should be aware that most terminal software (including Terminal in Mac OS X) does not support the complete set of ANSI escape sequences or terminfo capabilities.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_101"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-SW42" title="Finding the Absolute Path of the Current Script"></a><h2>Finding the Absolute Path of the Current Script</h2><p>Occasionally, you may write a script that needs to execute itself. The <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_102"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_103"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_104"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_105"></a>shell variable <code>$0</code> contains the name passed in on the command line. However, if the script is in a directory contained in the <code>PATH</code> environment variable, you may want a path that does not depend on the value of the <code>PATH</code> variable remaining contstant. The following snippet returns the path (which may be relative to the current working directory) of the executing script.</p><div class="codesample"><table><tr><td scope="row"><pre>SCRIPT="$(which $0)"<span></span></pre></td></tr></table></div><p>Your script can then execute itself like this:</p><div class="codesample"><table><tr><td scope="row"><pre>"$SCRIPT" arguments go here<span></span></pre></td></tr></table></div><p>If you need a complete <a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_106"></a>absolute path, you can modify the original snippet to do this:</p><div class="codesample"><table><tr><td scope="row"><pre>SCRIPT="$(which $0)"<span></span></pre></td></tr><tr><td scope="row"><pre>if [ "x$(echo $SCRIPT | grep '^\/')" = "x" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    SCRIPT="$PWD/$SCRIPT"<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr></table></div><p>If the path starts with a leading slash (<code>/</code>), it is already an absolute path, so you don’t need to do anything to it. If it does not, prepending the current working directory turns it into one. Note that the result is not a minimized absolute path; it may contain references to the current (<code>.</code>) or enclosing (<code>..</code>) directories. It is, however, an absolute path that is will not break even if your script changes directories or modifies its <code>PATH</code> environment variable.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_1" title="Application Scripting With osascript"></a><h2>Application Scripting With osascript</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_107"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_108"></a>Mac OS X provides a powerful application scripting environment called AppleScript. With AppleScript, you can launch an application, tell a running application to perform various tasks, query a running application in various ways, and so on. Shell script programmers can harness this power through the <code><a href="../../../../Darwin/Reference/ManPages/man1/osascript.1.html#//apple_ref/doc/man/1/osascript" target="_top">osascript(1)</a></code> tool.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_13" title="Note"></a><p><strong>Note:</strong>&nbsp;Although this section describes use of <code>osascript</code> for executing AppleScript for application scripting, the <code>osascript</code> tool provides a command-line interface to any scripting language with an interpreter that conforms to the Open Scripting Architecture (OSA). For example, if you install the third-party JavaScript OSA freeware package, you can use <code>osascript</code> to execute JavaScript code.</p></div><p>The <code>osascript</code> tool executes a program in the specified language and prints the results via standard output. If no program file is specified, it reads the program from standard input.</p><p>The first example is fairly straightforward. It opens the file <code>poem.txt</code> in the directory above the directory where the script is located:</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_14" title="Listing 7-11Opening a file using AppleScript and osascript: 07_osascript_simple.sh"></a><p class="codesample"><strong>Listing 7-11&nbsp;&nbsp;</strong>Opening a file using AppleScript and osascript: 07_osascript_simple.sh</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>POEM="$PWD/../poem.txt"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre>launch application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>        open "$POEM"<span></span></pre></td></tr><tr><td scope="row"><pre>end tell<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr></table></div><p>You should notice that the path to the file <code>poem.txt</code> is specified as an absolute path here. This is crucial when working with <code>osascript</code>. Because the current working directory of a launched application is always the root of the file system (the <code>/</code> directory) rather than the shell script’s working directory, a script must pass an absolute path to AppleScript rather than a path relative to the script’s working directory.</p><p>The next example shows how to query an application. In this case, it launches TextEdit, opens two files, asks TextEdit for a list of open documents, and uses that list to help it ask TextEdit to return the first paragraph of text in the document that corresponds with the <code>poem.txt</code> file.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_15" title="Listing 7-12Working with a file using AppleScript and osascript: 08_osascript_para.sh"></a><p class="codesample"><strong>Listing 7-12&nbsp;&nbsp;</strong>Working with a file using AppleScript and osascript: 08_osascript_para.sh</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Get an absolute path for the poem.txt file.<span></span></pre></td></tr><tr><td scope="row"><pre>POEM="$PWD/../poem.txt"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Get an absolute path for the script file.<span></span></pre></td></tr><tr><td scope="row"><pre>SCRIPT="$(which $0)"<span></span></pre></td></tr><tr><td scope="row"><pre>if [ "x$(echo $SCRIPT | grep '^\/')" = "x" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    SCRIPT="$PWD/$SCRIPT"<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Launch TextEdit and open both the poem and script files.<span></span></pre></td></tr><tr><td scope="row"><pre>cat &lt;&lt; EOF | osascript -l AppleScript > /dev/null<span></span></pre></td></tr><tr><td scope="row"><pre>launch application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>    open "$POEM"<span></span></pre></td></tr><tr><td scope="row"><pre>end tell<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>set myDocument to result<span></span></pre></td></tr><tr><td scope="row"><pre>return number of myDocument<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>cat &lt;&lt; EOF | osascript -l AppleScript > /dev/null<span></span></pre></td></tr><tr><td scope="row"><pre>launch application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>        open "$SCRIPT"<span></span></pre></td></tr><tr><td scope="row"><pre>end tell<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>set myDocument to result<span></span></pre></td></tr><tr><td scope="row"><pre>return number of myDocument<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Tell the shell not to mangle newline characters, tabs, or whitespace.<span></span></pre></td></tr><tr><td scope="row"><pre>IFS=""<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Ask TextEdit for a list of open documents.  From this, we can<span></span></pre></td></tr><tr><td scope="row"><pre># obtain a document number that corresponds with the poem.txt file.<span></span></pre></td></tr><tr><td scope="row"><pre># This query returns a newline-deliminted list of open files. Each<span></span></pre></td></tr><tr><td scope="row"><pre># line contains the file number, followed by a tab, followed by the<span></span></pre></td></tr><tr><td scope="row"><pre># filename<span></span></pre></td></tr><tr><td scope="row"><pre>DOCUMENTS="$(cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>        documents<span></span></pre></td></tr><tr><td scope="row"><pre>    end tell<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    set myList to result         -- Store the result of "documents" message into variable "myList"<span></span></pre></td></tr><tr><td scope="row"><pre>    set myCount to count myList  -- Store the number of items in myList into myCount<span></span></pre></td></tr><tr><td scope="row"><pre>    set myRet to ""              -- Create an empty string variable called "myRet"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    (* Loop through the myList array and build up a string in the myRet variable<span></span></pre></td></tr><tr><td scope="row"><pre>       containing one line per entry in the form:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        number tab_character name<span></span></pre></td></tr><tr><td scope="row"><pre>      *)<span></span></pre></td></tr><tr><td scope="row"><pre>    repeat with myPos from 1 to myCount<span></span></pre></td></tr><tr><td scope="row"><pre>        set myRet to myRet &amp; myPos &amp; "\t" &amp; name of item myPos of myList &amp; "\n"<span></span></pre></td></tr><tr><td scope="row"><pre>    end repeat<span></span></pre></td></tr><tr><td scope="row"><pre>    return myRet<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre>)"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Determine the document number that corresponds with the poem.txt<span></span></pre></td></tr><tr><td scope="row"><pre># file.<span></span></pre></td></tr><tr><td scope="row"><pre>DOCNUMBER="$(echo $DOCUMENTS | grep '[[:space:]]poem\.txt' | grep -v ' poem\.txt' | head -n 1 | sed 's/\([0-9][0-9]*.\).*/\1/')"<span></span></pre></td></tr><tr><td scope="row"><pre>SECOND_DOCNUMBER="$(echo $DOCUMENTS | grep '[[:space:]]poem\.txt' | grep -v ' poem\.txt' | tail -n 1 | sed 's/\([0-9][0-9]*.\).*/\1/')"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ $DOCNUMBER -ne $SECOND_DOCNUMBER ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    echo "WARNING: You have more than one file named poem.txt open.  Using the" 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre>    echo "most recently opened file." 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre>    echo "DOCNUMBER $DOCNUMBER != $SECOND_DOCNUMBER"<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "DOCNUMBER: $DOCNUMBER"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ "x$DOCNUMBER" != "x" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    # Query poem.txt by number<span></span></pre></td></tr><tr><td scope="row"><pre>    FIRSTPARAGRAPH="$(cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre>        tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>            paragraph 1 of document $DOCNUMBER<span></span></pre></td></tr><tr><td scope="row"><pre>        end tell<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre>    )"<span></span></pre></td></tr><tr><td scope="row"><pre>    echo "The first paragraph of poem.txt is:"<span></span></pre></td></tr><tr><td scope="row"><pre>    echo "$FIRSTPARAGRAPH"<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Query poem.txt by name<span></span></pre></td></tr><tr><td scope="row"><pre>FIRSTPARAGRAPH="$(cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre>        tell application "TextEdit"<span></span></pre></td></tr><tr><td scope="row"><pre>            paragraph 1 of document "poem.txt"<span></span></pre></td></tr><tr><td scope="row"><pre>        end tell<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre>)"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "The first paragraph of poem.txt is:"<span></span></pre></td></tr><tr><td scope="row"><pre>echo "$FIRSTPARAGRAPH"<span></span></pre></td></tr></table></div><p>This script illustrates three very important concepts.</p><ul class="ul"><li class="li"><p>It shows how to refer to a document by number and how to iterate through a list of documents, associating the name with a particular document number.</p></li><li class="li"><p>It demonstrates a limitation in AppleScript—specifically, that you cannot always uniquely identify a particular document with a given name if two open files have the same name. When writing scripts, you should carefully avoid opening two files with the same name using the same application.</p></li><li class="li"><p>It demonstrates how to reference a document by its name. The results from the <code>documents</code> message are transient; document numbers change as new windows are opened and old windows are closed. Thus, you should generally address documents using their names rather than using document numbers unless you are very careful.</p></li></ul><p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_109"></a>The final example shows how to manipulate images using shell scripts and AppleScript. It scales the image to be as close to 320x480 or 480x320 (depending on the orientation of the image) as possible.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_16" title="Listing 7-13Resizing an image using Image Events and osascript: 09_osascript_images.sh"></a><p class="codesample"><strong>Listing 7-13&nbsp;&nbsp;</strong>Resizing an image using Image Events and osascript: 09_osascript_images.sh</p><div class="codesample"><table><tr><td scope="row"><pre>#!/bin/sh<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Get an absolute path for the poem.txt file.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>MAXLONG=480<span></span></pre></td></tr><tr><td scope="row"><pre>MAXSHORT=320<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>URL="http://images.apple.com/macpro/images/design_smartdesign_hero20080108.png"<span></span></pre></td></tr><tr><td scope="row"><pre>FILE="$PWD/my design_smartdesign_hero20080108.png"<span></span></pre></td></tr><tr><td scope="row"><pre>OUTFILE="$PWD/my design_smartdesign_hero20080108-mini.png"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ ! -f "$FILE" ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    curl "$URL" > "$FILE"<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Tell the shell not to mangle newline characters, tabs, or whitespace.<span></span></pre></td></tr><tr><td scope="row"><pre>IFS=""<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Obtain image information<span></span></pre></td></tr><tr><td scope="row"><pre>DIM="$(cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre>tell application "Image Events"<span></span></pre></td></tr><tr><td scope="row"><pre>    launch<span></span></pre></td></tr><tr><td scope="row"><pre>    set this_image to open "$FILE"<span></span></pre></td></tr><tr><td scope="row"><pre>    copy dimensions of this_image to {W, H}<span></span></pre></td></tr><tr><td scope="row"><pre>    close this_image<span></span></pre></td></tr><tr><td scope="row"><pre>end tell<span></span></pre></td></tr><tr><td scope="row"><pre>return W &amp; H<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre>)"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>W="$(echo "$DIM" | sed 's/ *, *.*//' )"<span></span></pre></td></tr><tr><td scope="row"><pre>H="$(echo "$DIM" | sed 's/.* *, *//' )"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo WIDTH: $W HEIGHT: $H<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ $W -gt $H ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    LONG=$W<span></span></pre></td></tr><tr><td scope="row"><pre>    SHORT=$H<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>    LONG=$H<span></span></pre></td></tr><tr><td scope="row"><pre>    SHORT=$W<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># echo "LONG: $LONG SHORT: $SHORT"<span></span></pre></td></tr><tr><td scope="row"><pre># echo "MAXLONG: $MAXLONG MAXSHORT: $MAXSHORT"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>NEWLONG=$LONG<span></span></pre></td></tr><tr><td scope="row"><pre>NEWSHORT=$SHORT<span></span></pre></td></tr><tr><td scope="row"><pre># NEWSCALE=1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ $NEWLONG -gt $MAXLONG ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    # Long direction is too big.<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWLONG="$(echo "scale=20; $LONG * ($MAXLONG/$LONG)" | bc | sed 's/\..*//')";<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWSHORT="$(echo "scale=20; $SHORT * ($MAXLONG/$LONG)" | bc | sed 's/\..*//')";<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWSCALE="$(echo "scale=20; ($MAXLONG/$LONG)" | bc)";<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># echo "PART 1: NEWLONG: $NEWLONG NEWSHORT: $NEWSHORT"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ $NEWSHORT -gt $MAXSHORT ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    # Short direction is till too big.<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWLONG="$(echo "scale=20; $LONG * ($MAXSHORT/$SHORT)" | bc | sed 's/\..*//')";<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWSHORT="$(echo "scale=20; $SHORT * ($MAXSHORT/$SHORT)" | bc | sed 's/\..*//')";<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWSCALE="$(echo "scale=20; ($MAXSHORT/$SHORT)" | bc)";<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># echo "PART 2: NEWLONG: $NEWLONG NEWSHORT: $NEWSHORT"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if [ $W -gt $H ] ; then<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWWIDTH=$NEWLONG<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWHEIGHT=$NEWSHORT<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWHEIGHT=$NEWLONG<span></span></pre></td></tr><tr><td scope="row"><pre>    NEWWIDTH=$NEWSHORT<span></span></pre></td></tr><tr><td scope="row"><pre>fi<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "DESIRED WIDTH: $NEWWIDTH NEW HEIGHT: $NEWHEIGHT (SCALE IS $NEWSCALE)"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>cp "$FILE" "$OUTFILE"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>DIM="$(cat &lt;&lt; EOF | osascript -l AppleScript<span></span></pre></td></tr><tr><td scope="row"><pre>tell application "Image Events"<span></span></pre></td></tr><tr><td scope="row"><pre>    launch<span></span></pre></td></tr><tr><td scope="row"><pre>    set this_image to open "$OUTFILE"<span></span></pre></td></tr><tr><td scope="row"><pre>    scale this_image by factor $NEWSCALE<span></span></pre></td></tr><tr><td scope="row"><pre>    save this_image with icon<span></span></pre></td></tr><tr><td scope="row"><pre>    copy dimensions of this_image to {W, H}<span></span></pre></td></tr><tr><td scope="row"><pre>    close this_image<span></span></pre></td></tr><tr><td scope="row"><pre>end tell<span></span></pre></td></tr><tr><td scope="row"><pre>return W &amp; H<span></span></pre></td></tr><tr><td scope="row"><pre>EOF<span></span></pre></td></tr><tr><td scope="row"><pre>)"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>GOTW="$(echo "$DIM" | sed 's/ *, *.*//' )"<span></span></pre></td></tr><tr><td scope="row"><pre>GOTH="$(echo "$DIM" | sed 's/.* *, *//' )"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo "NEW WIDTH: $GOTW NEW HEIGHT: $GOTH"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p>Of course, you could just as easily perform these calculations in AppleScript itself, but this demonstrates how easy it is for shell scripts to exchange information with AppleScript code, manipulate image files, and tell applications to perform other complex tasks.</p><p>For more information about manipulating images with Image Events, see <span class="content_text"><a href="http://www.apple.com/applescript/imageevents/" target="_blank">http://www.apple.com/applescript/imageevents/</a></span>. You can also find many other AppleScript examples at <span class="content_text"><a href="http://www.apple.com/applescript/examples.html" target="_blank">http://www.apple.com/applescript/examples.html</a></span>.<a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_110"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_111"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003521-DontLinkElementID_112"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../PortingScriptstoMacOSX/PortingScriptstoMacOSX.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../performance/performance.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-04-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/OpenSource/Conceptual/ShellScripting/AdvancedTechniques/AdvancedTechniques.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/OpenSource/Conceptual/ShellScripting/AdvancedTechniques/AdvancedTechniques.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/OpenSource/Conceptual/ShellScripting/AdvancedTechniques/AdvancedTechniques.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>