<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Determining the Amount of Free Space on a Volume (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING96></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-95.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-97.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-89.html"><B>Using the File Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING96-0></A>
<H2><A NAME=MARKER-9-379></A>Determining the Amount of Free Space on a Volume</H2>
 <A NAME=MARKER-2-192></A>You can determine how much space is free on a particular volume by calling the low-level function <CODE>PBHGetVInfo</CODE>. This function returns, in the <CODE>ioVFrBlk</CODE> field of the parameter block passed to it, the number of free allocation blocks on a volume. It also returns, in the <CODE>ioVAlBlkSiz</CODE> field, the number of bytes in the allocation blocks on that volume. By multiplying those two values, you can determine how many bytes are free on a particular volume.<A NAME=MARKER-2-381></A><P>
 There is, however, one complication in this process. The <CODE>ioVFrBlk</CODE> field of the parameter block is actually an unsigned integer and can contain values from 0 to 65,535. However, because Pascal does not support unsigned integers, it interprets the values in the <CODE>ioVFrBlk</CODE> field as lying in the range -32,768 to 32,767. (Integers are stored as 16-bit quantities where the high-order bit indicates whether the value is true binary or a negated value in its two's complement positive form.) If, for example, a volume has 40,000 allocation blocks free and your application blindly returned the value in the <CODE>ioVFrBlk</CODE> field, it would erroneously report that the volume had -25,536 allocation blocks available.<P>
 You can circumvent this problem by forcing Pascal to interpret the high-order bit as <BR>part of the number of free blocks. For example, if you install the value returned in the <CODE>ioVFrBlk</CODE> field as the low-order word of a long integer, the high-order bit of that <BR>word is no longer the high-order bit of that long integer and hence is not interpreted <BR>as a sign indication. The data type <CODE>TwoIntsMakeALong</CODE> provides a convenient way <BR>to accomplish this.<P>
<PRE>
TYPE
   TwoIntsMakeALong =      {two integers make a long integer}
   RECORD
      CASE Integer OF
         1: (long: LongInt);
         2: (ints: ARRAY[0..1] OF Integer);
   END;
</PRE>
 <A HREF=#MARKER-9-382>Listing 2-6</A> illustrates how to use this technique to determine the amount of free space on a volume (specified by its volume reference number).<P>
<B>Listing 2-6  <A NAME=MARKER-9-382></A>Determining the amount of free space on a volume</B><P>
<PRE>
FUNCTION GetVolumeFreeSpace (myVol: Integer): LongInt;
VAR
   myHPB:   HParamBlockRec;      {parameter block for PBHGetVInfo}
   myErr:   OSErr;               {result code from PBHGetVInfo}
   myRec:   TwoIntsMakeALong;    {easy way to get an unsigned int}
BEGIN
   WITH myHPB DO
      BEGIN
         ioNamePtr := NIL;
         ioVRefNum := myVol;
         ioVolIndex := 0;
      END;
   myErr := PBHGetVInfo(@myHPB, FALSE);
   IF myErr = noErr THEN
      BEGIN
         myRec.ints[0] := 0;
         myRec.ints[1] := myHPB.ioVFrBlk;
         GetVolumeFreeSpace := myRec.long * myHPB.ioVAlBlkSiz;
      END
   ELSE
      GetVolumeFreeSpace := 0;
END;
</PRE>
 If the value passed to GetVolumeFreeSpace is a valid volume reference number, <BR>then this function reads the number of free allocation blocks on the volume, installs <BR>that number as the low-order word of a long integer, and performs the necessary multiplication to determine how many bytes are free on the volume.<P>
<DL>
<DT><B>Note</B>
<DD>You could avoid these complications with unsigned integers by calling <CODE>PBHGetVInfo</CODE> as illustrated and then passing the value returned in the <CODE>ioVDrvInfo</CODE> field to the high-level function <CODE>GetVInfo</CODE>. The technique using the <CODE>TwoIntsMakeALong</CODE> data type to convert unsigned integers to long integers is illustrated here because it is useful when reading the fields of many other File Manager data structures from Pascal. For example, the <CODE>vcbFreeBks</CODE> field of a volume control block contains an unsigned integer that you can interpret in this way.<EM></EM><A NAME=MARKER-2-383></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-95.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-97.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
