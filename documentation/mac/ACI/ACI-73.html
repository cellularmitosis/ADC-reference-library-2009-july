<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Creating and Using Device-Linked Profiles</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING73></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-72.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-74.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-55.html"><B>Chapter 4 - Developing ColorSync-Supportive Applications</B></A> / <A HREF="ACI-60.html"><B>Developing Your ColorSync-Supportive Application</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING73-0></A>
<H2><A NAME=MARKER-9-145></A>Creating and Using Device-Linked Profiles</H2>
 <A NAME=MARKER-2-146></A>To<A NAME=MARKER-2-147></A> accommodate users who use a specific configuration requiring a combination of device profiles and possibly nondevice profiles repeatedly over time, your application can create device-linked profiles. A device-linked profile offers your user a means of saving and storing a series of profiles corresponding to a specific configuration in a concatenated format. This feature provides an economy of effort for both your application and its user.<P>
 There are many uses for <A NAME=MARKER-2-148></A>device-linked profiles. For example, a user might want to store multiple profiles, such as various device profiles and color space profiles associated with the creation and editing of an image. <P>
 Most users use the same device configuration to scan, view, and print graphics over a period of time, often soft proofing images before they print them. To enhance your application's soft-proofing feature, you can allow your users to store the contents of the profiles involved in the soft-proofing process in a device-linked profile. Your application can use the appropriate device-linked profile each time a user enacts the soft-proofing feature, instead of opening a profile reference to each of the profiles to create a color world to pass to the color-matching functions. For additional information about soft proofing, see <A HREF=ACI-74.html#MARKER-9-155>"Providing Soft Proofs" (page 4-55)</A>.<P>
 A device-linked profile is especially useful when a scanner application does not embed the source profile in the document containing the image it creates. By storing the scanner's profile, your application eliminates the need to query the user for the appropriate source profile each time the user wants to soft proof using the configuration involving that scanner.<P>
 A user may want to see how a scanned image will look when printed using a specific printer. The user may want to look at many images captured on the same scanner at different times before printing the image. Because the same devices are involved in the process, if your application has offered the user the opportunity to create device-linked profiles, your application could display a list of device-linked profiles that the user had previously created for various configurations and allow the user to select the appropriate one for the current soft proofing.<P>
 <A NAME=MARKER-2-149></A>Here are the steps your application should take in creating a device-linked profile:<P>
<OL>
<LI><B>Open the profiles corresponding to the devices and transformations involved in the configuration and obtain references to them. </B><P>
To create a device-linked profile, your application must first obtain references to the profiles involved in the configuration. If the profile for an input device, such as a scanner, is embedded in the document containing the image, you must first extract the profile. For a description of how to obtain a profile reference, see <A HREF=ACI-63.html#MARKER-9-52>"Obtaining Profile References" (page 4-16)</A>. For information describing how to extract a profile from a document, see <A HREF=ACI-70.html#MARKER-9-108>"Extracting Profiles Embedded in Pictures" (page 4-37)</A>. 
<LI><B>Create an array containing references to the profiles, specifying the profile references in processing order. </B><P>
You supply the profile references as an array of type <CODE>CMProfileRef</CODE> within a data structure of type <CODE>CMConcatProfileSet</CODE>. The order of the profiles must correspond to the order in which you want the colors of the image to be processed. For example, for soft proofing an image, you should specify the scanner profile reference first, followed by the printer profile reference, and then the display profile reference because the goal is to match the colors of the scanned image to the color gamut of the printer for which the image is destined and then display the results to the user. <P>
In the <CODE>count</CODE> field, specify a one-based number identifying how many profiles the array holds. A device-linked profile represents a one-way link between devices. <P>
Here is the <CODE>CMConcatProfileSet</CODE> data type:<P>
<pre><CODE>struct CMConcatProfileSet {<BR> unsigned short     keyIndex;     /* zero-based */<BR> unsigned short     count;     /* one-based */<BR> CMProfileRef     profileSet[1];<BR>};</CODE></pre><P>
You must adhere to the rules that govern the type of profiles you can specify in the array. For example, the first and last profiles must be device profiles. For a list of these rules, see <A HREF=#nonexistent-marker>"Concatenated Profile Set Structure"</A> in <I>Advanced Color Imaging Reference</I>. 
<LI><B>Specify the index corresponding to the profile whose preferred CMM is used to perform the processing. </B><P>
The header of each profile specifies the preferred CMM for that profile. Only one CMM is used for all transformations across the profiles of a device-linked profile. You identify the profile whose CMM is used by supplying the zero-based index of that profile in the <CODE>keyIndex</CODE> field of the <CODE>CMConcatProfileSet</CODE> data type.
<LI><B>Using the <B>CMProfileLocation</B> data type, provide a file specification for the new device-linked profile. </B><P>
If the <CODE>CWNewLinkProfile</CODE> function is successful, the ColorSync Manager creates a device-linked profile in the location that you specify, opens a reference to the profile, and returns the profile reference to your application. To tell the ColorSync Manager where to create the new profile, your application must provide a file specification. The ColorSync Manager defines a data structure of type <CODE>CMProfileLocation</CODE> containing a <CODE>CMProfLoc</CODE> union that you use to give a file specification. See <A HREF=ACI-64.html#MARKER-9-62>Listing 4-2 (page 4-19)</A>, which assigns values to a <CODE>CMProfileLocation</CODE> data structure.
<LI><B>Call the <B>CWNewLinkProfile</B> function to create the device-linked profile. </B><P>
After you set up <CODE>CMConcatProfileSet</CODE> and <CODE>CMProfileLocation</CODE>, your application can call the <A NAME=MARKER-11-150></A><CODE>CWNewLinkProfile</CODE> function, passing these values to it. If the function completes successfully, it returns a reference to the newly created device-linked profile. <P>
Note that you cannot embed a device-linked profile into a document along with an image that uses it. 
<LI><B>Using the <B>CWConcatColorWorld</B> function, create a color world based on the device-linked profile. </B><P>
You can use a device-linked profile with the low-level ColorSync Manager functions only. To use a device-linked profile for a color-matching or color gamut-checking function, you must first create a color world using the <A NAME=MARKER-11-151></A><CODE>CWConcatColorWorld</CODE> function, passing to it a data structure of type <CODE>CMConcatProfileSet</CODE>. The <CODE>CMConcatProfileSet</CODE> data structure is the same data type that you used to specify the array of profiles when you created the new device-linked profile. To create the color world, however, you specify the device-linked profile as the only member of the <CODE>CMConcatProfileSet</CODE> array. If the <CODE>CWConcatColorWorld</CODE> function is successful, it returns a reference to a color world that your application can pass to other low-level functions for color-matching and color gamut-checking sessions. A device-linked profile remains intact and available for use again after your application calls the <CODE>CWDisposeColorWorld</CODE> function to dispose of the concatenated color world. <P>
</OL>
<A NAME=HEADING73-24></A>
<H3>Considerations</H3>
 Here are some points to consider about how the ColorSync Manager uses information contained in the profiles comprising a device-linked profile:<P>
<UL>
<LI>When you use a device-linked profile, the quality flag setting--indicating normal mode, draft mode, or best mode--specified by the first profile prevails for the entire session; the quality flags of following profiles in the sequence are ignored. The quality flag setting is stored in the <CODE>flags</CODE> field of the profile header.
<LI>The ColorSync Manager uses the rendering intent specified by the first profile to color match to the second profile, the rendering intent specified by the second profile to color match to the third profile, and so on through the series of concatenated profiles. <P>
</UL>
 When your application is finished with the device-linked profile, it must close the profile with the <CODE>CMCloseProfile</CODE> <A NAME=MARKER-2-152></A>func<A NAME=MARKER-2-153></A>tion<A NAME=MARKER-2-154></A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-72.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-74.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
