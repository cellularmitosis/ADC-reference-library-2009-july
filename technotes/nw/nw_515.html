<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW515: AppleShare Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW515: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002573" title="AppleShare Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW515</div>
<div id="pageheadsub">AppleShare Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>Alternate User Authentication Methods (UAMs)</h2><p>Date Written:   3/9/93</p><p>Last reviewed: 6/24/93</p><p>Is there a sanctioned way to use <code>PBVolumeMount</code> to mount a volume with analternate user authentication method (UAM)? I heard there's an old documentdescribing AppleShare UAMs.</p><p>Alternate User Authentication Methods (UAMs) aren't a supported feature of theAppleShare workstation software. The only documentation to ever come out ofApple concerning alternate UAMs is a draft proposal titled "Multiple UserAuthentication Methods for AppleShare" and it was written back in 1987. Thething to remember is that the document was a <i>draft</i> proposal; not finaldocumentation for a <i>tested</i> mechanism in shipping product. AppleDeveloper Technical Support will <i>not</i> supply this document to developerswho don't have it.</p><p>Although the code for the alternate UAM mechanism described by that document isin the AppleShare workstation, it has never been fully implemented or tested inany version of AppleShare Workstation (including the AppleShare 3.0Workstation); it has been only partially tested by some of the engineers thatwrote that code. Because the code for alternate UAMs has never been officiallytested or documented as a shipping product, Apple Developer Technical Supportcan't officially support you in this area. On top of that, engineering doesn'tconsider the alternate UAM mechanism part of any current project, so we (inDTS) have no project to submit bugs against. It is <i>very</i> likely that thecode for the alternate UAM mechanism in the current AppleShare workstation willbe removed at some point, so you should not rely on it in any of yourprograms.</p><p>Since alternate UAMs aren't a supported feature of AppleShare workstation, newfeatures added to the AppleShare workstation don't support them, and otherparts of the operating system don't use them. So <code>PBVolumeMount</code> (which isimplemented for AppleShare volumes by the AppleShare workstation's externalfile system code) doesn't support alternate UAMs, and the Alias Manager (whichuses <code>PBVolumeMount</code> to mount AppleShare volumes) doesn't know anything aboutalternate UAMs and has no way to support them.</p><h2>Determining AppleShare Admin password</h2><p>Date Written:   2/8/93</p><p>Last reviewed: 7/9/93</p><p>I mistyped an AppleShare file server's administrative password. How can Iretrieve it?</p><p>We can't provide the information you've requested since it is consideredproprietary (for security reasons). If you've lost your admin password you'llneed to delete your current Users &amp; Groups Data File. This is the onlysanctioned way to reset your password. (If you have a duplicate Users &amp;Groups file on another server, you can copy this file over and change thepassword accordingly.)</p><h2>CreateResFile calls and AppleShare drop folders</h2><p>Date Written:   4/28/93</p><p>Last reviewed: 7/2/93</p><p>Why does calling <code>FSpCreateResFile</code> return an <code>afpAccessDenied</code> error (in <code>ResErr</code>)when the destination folder is an AppleShare drop folder?</p><p>Using any of the <code>CreateResFile</code> calls in a drop box is a useless exercise.Here's why: The access privileges within a drop box are very limited write-onlyaccess. This lets you create new files and then perform a small set ofoperations on the file while it's empty (no bytes in either the data or theresource fork of the file). So, while the file is empty, you can open it(either fork) with write-only access (<code>PBHOpenDeny</code> or <code>PBHOpenRFDeny</code>), and writethe file's attributes (<code>PBHSetFInfo</code> or <code>PBSetCatInfo</code>), including Desktop Managercomments. Once either fork has a single byte of data written to it, you can nolonger open or change the file's attributes. This makes it possible to copy afile into a drop folder, but not to manipulate or delete a file (containingdata) that's already in the drop folder. You can also move a file or directoryinto a drop folder if that file or directory is already on the same servervolume.</p><p>So, when you call <code>CreateResFile</code> on a drop folder, a new file is created anddata is added to the resource fork of the file. Since the file now has data inone of the forks, you cannot open the file or change any of the file'sattributes. <code>FSpCreateResFile</code> fails because after performing the <code>CreateResFile</code>operation that writes data into the resource fork, it attempts to set thefile's attributes (creator, fileType, and scriptTag).</p><p>For a quick explanation of drop folder access privileges and rules, see theMacintosh Technical Note "Creating Files Inside an AppleShare Drop Folder"(Files 18). For a complete explanation of what AFP access privileges you needto perform specific operations on an AppleShare (AFP) server, see the section"Directory Access Control" in <i>Inside AppleTalk</i> starting on page 13-31.</p><h2>Updating aliases when File Sharing state changes</h2><p>Date Written:   2/4/93</p><p>Last reviewed: 7/2/93</p><p>We create an alias for a file when File Sharing is off, so the alias doesn'tcontain server and zone information. Then we turn on File Sharing and resolvethe alias. The file, of course, is found but the alias isn't marked for anupdate. Shouldn't it be updated?</p><p>According to <i>Inside Macintosh: Files,</i> <code>wasChanged</code> is set to TRUE only onaliases created by <code>NewAlias</code> (not <code>NewAliasMinimalFromFullPath</code> or<code>NewAliasMinimal</code>) when it sees that key information has changed. The keyinformation is:</p><ul type="disc">	<li>name of the target</li>	<li>directory ID of the target's parent</li>	<li>file ID or directory ID of the target</li>	<li>name and creation date of the volume on which the target resides</li></ul><p>Since none of that changes when you turn File Sharing on or off, the <code>wasChanged</code>flag isn't set to TRUE. If you're really worried about it, just callUpdateAlias every time you use the alias (unless you think this would be amajor performance hit). Or maybe you should update it only if you notice thatit doesn't have server information and the server is now turned on (to checkfor this, call <code>PBHGetVolParms</code> and check the <code>bHasPersonalAccessPrivileges</code>bit).</p><h2>Macintosh AppleShare client version details</h2><p>Date Written:  12/18/92</p><p>Last reviewed:  3/1/93</p><p>System 7.0.1 doesn't seem to correctly display (or display at all) login(greeting) messages from an AppleShare server. System 7.1 works fine. Is this aknown problem, and is there anything we can do do get the login messages toshow up?</p><p>Not all Macintosh AppleShare clients support server messages (including thegreeting messages). Every version of the Macintosh AppleShare client releasedsince AppleShare 3.0 has supported server messages. If you install theAppleShare client version 3.0, 7.1 or 3.0.1 on System 7.0, 7.0.1 with orwithout System 7 Tune-up, you'll get server greeting messages.</p><p>Here's a list of Macintosh AppleShare client versions in the order they werereleased (notice that they aren't in version order). We've listed the importantchanges made to each version and listed system software compatibility. (As youmight suspect, DTS doesn't have a complete list of all minor changes made toevery version.)</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>AppleShare Client version:  2.0Shipped with:               System 6.0.x and AppleShare 2.0System Software versions:   6.0.xMaximum AFP version:        2.0Features:                   Supports AFP 2.0AppleShare Client version:  7.0Shipped with:               System 7.0System Software versions:   7.0Maximum AFP version:        2.1Features:                   Supports required AFP 2.1 features only. Adds                            support for these new File Manager functions:                               PBCreateFileIDRef                               PBDeleteFileIDRef                               PBResolveFileIDRef                               PBExchangeFiles                               PBCatSearch                               PBGetVolMountInfoSize                               PBGetVolMountInfo                               PBVolumeMount (no volume password support)AppleShare Client version:  7.0.1Shipped with:               System 7.0.1System Software versions:   7.0 or 7.0.1Maximum AFP version:        2.1Features:                   No changes from version 7.0AppleShare Client version:  3.0Shipped with:               AppleShare 3.0System Software versions:   System 6.0.4 through 6.0.8, System 7.0 and 7.0.1Maximum AFP version:        2.1Features:                   Added support for server greeting messages.                            Patched the System 6 File Manager to support                            these File Manager functions:                               PBGetVolMountInfoSize                               PBGetVolMountInfo                               PBVolumeMount                            PBVolumeMount now supports volume passwords.AppleShare Client version:  7.1 and 3.0.1Shipped with:               System 7.1 and AppleShare 3.0.1System Software versions:   System 6.0.4 through 6.0.8, System 7.0, 7.0.1,                            and 7.1Maximum AFP version:        2.1</pre>	</TD></TR></TABLE></CENTER><h2>Auto-mounting AppleShare 3.0 volumes when a Greeting is enabled</h2><p>Date Written:  6/5/92</p><p>Last reviewed:  3/1/93</p><p>Our program calls PBVolumeMount using MPW 3.2.2 interfaces to automountFileShare and AppleShare servers when performing unattended backups, but if anAppleShare 3.0 server has a Greeting, the backup cannot proceed until theGreeting is dealt with. Is there a way to auto-mount these volumes whichsuppresses the Greeting?</p><p>To mount a volume with <code>PBVolumeMount</code> and disable the greetings, you need to setbit 0 in the flags field of the <code>AFPVolMountInfo</code> record. The flags field wasmarked reserved in <i>Inside Macintosh</i> Volume VI because the greetingmessage feature had yet to be released when Volume VI was written. The InsideMacintosh: Files book (the revised edition of Inside Macintosh) documents thisflag bit.</p><p>One thing you should be aware of is an alias record to an AFP volume created bythe Alias Manager stores the flags information. That is, if you mount a volumewith greetings disabled, create an alias to the volume (or a file or directoryon the volume), and then later mount the volume by resolving the alias, thegreeting message will be disabled. If the volume is mounted with the flags wordcleared, any aliases resolved with show greeting messages (if any).</p><p>Here's a short sample application that mounts a volume with greeting messagesdisabled:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Program MountVolTest;USES  Types,  Files;CONST  kNormalMountFlags = 0;  kInhibitMsgFlags = 1;TYPE  Str8 = STRING[8];  { I like the following record structure better than }  { the AFPVolMountInfo struture in Files.p }  MyAFPVolMountInfo = RECORD    length: Integer; { length of this record }    media: VolumeType; { type of media, always AppleShareMediaType }    flags: Integer; { 0 = normal mount; 1 = no greeting messages }    nbpInterval: SignedByte; { NBP interval ; 7 is a good choice }    nbpCount: SignedByte; { NBP count ; 5 is a good choice }    uamType: Integer; { 1 = 'No User Authent' (guest); }                      { 2 = 'Cleartxt Passwrd'; }                      { 3 = 'Randnum Exchange'; }                      { 6 = '2-Way Randnum exchange' }    zoneNameOffset: Integer; { offset-record start to zoneName }    serverNameOffset: Integer; { offset-record start to serverName }    volNameOffset: Integer; { offset-record start to volName }    userNameOffset: Integer; { offset-record start to userName }    userPasswordOffset: Integer; { offset-record start to userPassWord }    volPasswordOffset: Integer; { offset-record start to volPassWord }    zoneName: Str31; { server's AppleTalk zone name }    serverName: Str31; { server name }    volName: Str27; { volume name }    userName: Str31; { user name (0 length = guest) }    userPassWord: Str8; { user password (0 length = no user password) }    volPassWord: Str8; { volume password (0 length = no volume password) }    END;VAR  gUAMType: Integer;  gZoneName: Str31;  gServerName: Str31;  gVolName: Str27;  gUserName: Str31;  gUserPassWord: Str8;  gVolPassWord: Str8;  FUNCTION SilentMountAFPVolume: OSErr;    VAR      theAFPInfo: MyAFPVolMountInfo;      pb: HParamBlockRec;  BEGIN    WITH theAFPInfo DO      BEGIN        length := sizeof(MyAFPVolMountInfo);        media := AppleShareMediaType;        flags := kInhibitMsgFlags;        nbpInterval := 7;        nbpCount := 5;        uamType := gUAMType;        zoneNameOffset := ORD4(@zoneName) - ORD4(@theAFPInfo);        zoneName := gZoneName;        serverNameOffset := ORD4(@serverName) - ORD4(@theAFPInfo);        serverName := gServerName;        volNameOffset := ORD4(@volName) - ORD4(@theAFPInfo);        volName := gVolName;        userNameOffset := ORD4(@userName) - ORD4(@theAFPInfo);        userName := gUserName;        userPasswordOffset := ORD4(@userPassWord) - ORD4(@theAFPInfo);        userPassWord := gUserPassWord;        volPasswordOffset := ORD4(@volPassWord) - ORD4(@theAFPInfo);        volPassWord := gVolPassWord;      END;    pb.ioBuffer := @theAFPInfo;    SilentMountAFPVolume := PBVolumeMount(@pb);  END;BEGIN  gUAMType := 1; { mount as guest }  gZoneName := 'Dev Support Center (DTS)';  gServerName := 'Briggs';  gVolName := 'SevenOh';  gUserName := ''; { guest }  gUserPassWord := ''; { guest }  gVolPassWord := ''; { no volume password }  IF SilentMountAFPVolume &lt;&gt; noErr THEN    DebugStr('couldn''t mount volume');</pre>	</TD></TR></TABLE></CENTER><h2>Mounting volumes without using aliases</h2><p>Date Written:  9/25/92</p><p>Last reviewed:  11/24/92</p><p>How can I mount a volume without using aliases? I get the mounting information,then attempt to mount the volume. However, the <code>PBVolumeMount</code> call returns anerror code.</p><p>The <code>PBGetVolMountInfo</code>, <code>PBGetVolMountInfoSize</code>, and <code>PBVolumeMount</code> functions arecurrently handled by only the AppleShare external file system (part of theAppleShare Chooser extension). Those functions are available on AppleSharevolumes when the AppleShare Chooser extension is version 7.0 (system softwareversions 7.0 and 7.0.1), version 3.0 (AppleShare 3.0), or version 7.1 (System7.1). The AppleShare Chooser extension version 3.0 can be installed on System 6systems, and then the <code>PBGetVolMountInfo</code>, <code>PBGetVolMountInfoSize</code>, and<code>PBVolumeMount</code> functions can be used in System 6. Other file systems may supportthese functions in the future. The paramErr error code is returned when thesefunctions aren't available on a particular volume.</p><h2>How to tell if someone else has your data file open</h2><p>Date Written:  7/7/92</p><p>Last reviewed:  11/1/92</p><p>How can I tell if another person has my data file open? According to <i>InsideMacintosh</i> Volume IV (pages 148-149), <code>PBGetFInfo</code> will tell you if anyone hasa file open by returning the first access path found in <code>ioFRefNum</code>, but if Ihave this file already open, it returns information about myself. I want to beable to tell if anyone <i>else</i> has it open.</p>_<p>If the file is on a local volume, you can index through the open FCBs to findall open connections to the file. You'll find your own connection in that listbut since you know what your <code>ioRefNum</code> is, you can ignore that match. Forexample, the following function will tell you if someone else has the filespecified by <code>myRefNum</code> open. With a small change, you could have it return thenumber of other open connections instead of TRUE or FALSE.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION OthersHaveItOpen (myRefNum: Integer): Boolean;   VAR      err: OSErr;      fcbPB: FCBPBRec;      myName: Str255;      myVRefNum: Integer;      myDirID: LongInt;      index: LongInt;      fileName: Str255;      found: Boolean;BEGIN   fcbPB.ioNamePtr := @myName;      { let PBGetFCBInfo fill in the name. }   fcbPB.ioVRefNum := 0;            { look on all volumes. }   fcbPB.ioRefNum := myRefNum;      { use myRefNum to get info. }   fcbPB.ioFCBIndx := 0;            { use ioRefNum instead of ioFCBIndx. }   err := PBGetFCBInfoSync(@fcbPB); { get the open file's info. }   IF err = noErr THEN      BEGIN         { save my file's vRefNum and dirID for matching later. }         { myName was filled in by PBGetFCBInfo call above. }         myVRefNum := fcbPB.ioFCBVRefNum;         myDirID := fcbPB.ioFCBParID;         { index through the open files on the volume }         index := 1;         REPEAT            fcbPB.ioNamePtr := @fileName;            fcbPB.ioVRefNum := myVRefNum;            fcbPB.ioRefNum := 0;            fcbPB.ioFCBIndx := index;            err := PBGetFCBInfoSync(@fcbPB);            IF err = noErr THEN               { see if there is a match that isn't myRefNum }               found := (fileName = myName) AND                        (fcbPB.ioFCBParID = myDirID) AND                        (fcbPB.ioRefNum &lt;&gt; myRefNum)            ELSE               found := FALSE;  { no matches on errors }            index := index + 1; { next index position... }         UNTIL found OR (err &lt;&gt; noErr);         OthersHaveItOpen := found;      END   ELSE      OthersHaveItOpen := FALSE; { we don't even have it open! }</pre>	</TD></TR></TABLE></CENTER><p>On nonlocal volumes (AppleShare volumes), you can use <code>PBHOpenDeny</code> with thedeny-read and deny-write permissions to ensure nobody else can open a file youhave open. You can tell which volumes are nonlocal by calling <code>PBHGetVolParms</code>and looking at the value returned in the <code>GetVolParmsInfo.vMServerAd</code>r field. Ifthat value is 0, the volume is local.</p><h2>Unmounting volumes shared with Macintosh File Sharing</h2><p>Date Written:  9/15/92</p><p>Last reviewed:  3/10/93</p><p>I tried to unmount a volume shared with Macintosh File Sharing from my programusing the following steps: I shut down the file service with the <code>SCShutDown</code>server control call; I call <code>SCPollServer</code> to make sure the file service isreally off (<code>scServerState</code> = <code>SCPSJustDisabled</code>); then, I call <code>PBUnmountVol</code> toattempt to unmount the volume. It didn't work because <code>PBUnmountVol</code> fails with<code>fBsyErr</code> (-47). I broke on the <code>_UnmountVol</code> trap because the AppleShare PDS file,where the file server keeps the access privilege and share-point informationfor the shared volume, was open. Why is AppleShare PDS still open when I'veturned the file service off? How can I close it and unmount the volume?</p><p><code>SCPollServer</code> returns the state of the file service, not the file serverapplication (in this case, File Sharing Extension is the file serverapplication). When <code>SCPollServer</code> returns a server state of <code>SCPSJustDisabled</code>, thefile service is off; however, the file server application may or may not stillbe running. The AppleShare PDS file will eventually get closed before the fileserver application quits.</p><p>There's an easy way to determine when the File Sharing application has quit(and thus when the AppleShare PDS file is closed): just use the Process Manager<code>GetNextProcess</code> and <code>GetProcessInformation</code> calls to find out when File SharingExtension is no longer running. The File Sharing Extension application has aprocessType of <code>'INIT'</code> and a processSignature of <code>'hhgg'</code>. Here's a function youcan use to see if the File Sharing Extension application is running:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION FileSharingAppIsRunning: Boolean;  CONST    FileSharingSignature = 'hhgg';  {Macintosh File Sharing}  VAR    err:      OSErr;    myPSN:    ProcessSerialNumber;    myPInfoRec:  ProcessInfoRec;BEGIN  myPSN.highLongOfPSN := 0;  {Start at beginning of process list}  myPSN.lowLongOfPSN := kNoProcess;  myPInfoRec.processInfoLength := sizeOf(ProcessInfoRec);  myPInfoRec.processName := NIL;   {Don't need process name}  myPInfoRec.processAppSpec := NIL; {Don't need process location}  FileSharingAppIsRunning := FALSE; {Haven't found it yet}  WHILE (GetNextProcess(myPSN) = noErr) DO    IF GetProcessInformation(myPSN, myPInfoRec) = noErr THEN      IF (myPInfoRec.processSignature = FileSharingSignature)        THEN        FileSharingAppIsRunning := TRUE;  {Found it}</pre>	</TD></TR></TABLE></CENTER><p>After shutting down the file service, your event loop will need to poll with<code>FileSharingAppIsRunning</code> because you must give the file server applicationprocessing time to close files, dispose of memory, and perform other shutdownoperations. If you poll with <code>FileSharingAppIsRunning</code> without giving otherprocesses time, File Sharing will never shut down.</p><h2>Maximum volumes for file sharing</h2><p>Date Written:  3/9/92</p><p>Last reviewed:  8/1/92</p><p>In the past I've been able to file share more volumes off my Macintosh SCSIstorage devices than I can with System 7. Now I get an alert saying: "One ormore items could not be shared because not all volumes are available for filesharing." Please advise as to what the problem might be.</p><p>Macintosh File Sharing will only prepare for sharing the first 10 volumes itsees (it enumerates the volume list with <code>PBHGetVInfo</code>). The volumes you can'tshare will usually be the ones mounted last. The reason you used to be able toshare another set of volumes probably has to do with some change you've made(like changing the boot volume or a volume's SCSI ID number).</p><p>So, you've just hit the limits of File Sharing. The solution to your problem isto use AppleShare 3.0 -it will share up to 50 volumes. File Sharing wasn'tintended to be the end-all in file servers; it was designed for individuals whowant to occasionally share files with a small number of other users. Here aresome limits to File Sharing that you should note:</p><ul type="disc">	<li>The number of users and groups in the Users &amp; Groups Data File is limited to 100 total. (The limit with AppleShare 3.0 is 8192 total.)</li>	<li>The number of users that can be logged in at one time is 10 (this doesn't count the owner of the system, one remote connection is always reserved for the owner of the system). (The limit with AppleShare 3.0 is 120.)</li>	<li>The number of share points available for regular users is 10. (The limit with AppleShare 3.0 is 50.)</li>	<li>The number of sharable volumes (what the owner sees when he or she logs in remotely and what can be shared or partially shared) is 10. (The limit with AppleShare 3.0 is 50.)</li></ul><p>AppleShare 3.0 also supports many other user (for example, server messages),security, and developer features (server control calls and the server eventmechanism) not supported by Macintosh File Sharing.</p><h2>AppleShare user limit</h2><p>Date Written:  11/16/90</p><p>Last reviewed:  12/19/90</p><p>What is the maximum number of users that can be logged in to any one AppleSharefile server? What can we do to increase the limit? Will upgrading to AppleTalkPhase II help? Is there an upgrade to the AppleShare 2.0.1 software?</p><p>AppleShare currently has a limit of 50 simultaneous users. This is a limitationin the software and is not related to AppleTalk. Changing from AppleTalk PhaseI to Phase II will not change anything. The next version of AppleShare mightraise this limitation. We do not have any projected dates for a release of thenext version of AppleShare. You may want to periodically check with APDA forany update or new release.</p><h2>Maximum number of users supported by AppleShare for each CPU</h2><p>Date Written:  5/3/89</p><p>Last reviewed:  11/21/90</p><p>What is the maximum number of users supported by AppleShare? Does this numberchange based on the type of CPU being used for the server?</p><p>The following chart lists some current AppleShare limits (AppleShare 1.1, 2.0,and 2.01) which are based upon the chosen server platform and memoryconfiguration. The limits that otherwise might be present on a workstation arestill in effect, and are not affected by the workstation being logged in to anAppleShare server. These limits will change in the future.</p><p>Server machine is Macintosh Plus, SE, or II with 1 MB:</p>   <ul type="disc">	<li> Number of users: 25</li>	<li>    Number of locked ranges: 1000</li>	<li>    Number of open files: 80</li>	<li>    Number of volumes: 16</li></ul><p>Server machine is Macintosh II with more than 1 MB:</p>   <ul type="disc">	<li> Number of users: 50</li>	<li>    Number of locked ranges: 2000</li>	<li>    Number of open files: 160</li>	<li>    Number of volumes: 16</li></ul><p>X-Ref:</p><P>Macintosh Technical Note <A HREF = "nw_11.html">"AppleShare 1.1 and 2.0 Limits"</a></p><h2>Macintosh file system active ranges</h2><p>Date Written:  3/18/91</p><p>Last reviewed:  6/7/91</p><p>How many active ranges can a Macintosh application have on a shared file? Ifthe answer is more than one, is the limit per application or per machine? Iftwo ranges overlap, are they joined into one range? Can an application nestranges? For example, if an application's user performs an action that forces arecord to be locked and later the application locks the full range of the file,does the initial record lock disappear?</p><p>The only way to determine the limit is to hit the limit and get a NoMoreLockserror. The number of range locks supported is a limit of the server platform,and that limit is shared by all users of the server (at least it is withApple's AppleShare server software). With Apple's server-based version ofAppleShare, approximately 40 locks per user are allowed (for example, if theserver allows 25 users, there are 1000 locked ranges total; if the serverallows 50 users, there are 2000 locked ranges total; and with File Sharingrunning under System 7.0, approximately 20 locks are allowed per user). Othervendors may allow more or fewer locked ranges on their implementations of anAppleTalk Filing Protocol (AFP) server. Notice that the numbers given are peruser, not per application. It's assumed that a user probably won't need morethan a few locks at a time on a single file.</p><p>You cannot have range locks that overlap. You'll get a <code>RangeOverlap</code> error fromAFP. All the rules for range locking can be found in the AFP chapter of<i>Inside AppleTalk</i> (page 13-56). Additional information on AppleSharelimits is available on the latest <i>Developer CD Series</i> disc.</p><p>The Macintosh Technical Note <A HREF = "../fl/fl_26.html">"Lock, Unlock the Range"</a> covers several importantdetails about <code>PBLockRange</code> and <code>PBUnlockRange</code> that are not in <i>InsideMacintosh.</i></p><h2>AppleShare open file limit</h2><p>Date Written:  10/8/91</p><p>Last reviewed:  10/8/91</p><p>On an AppleShare 2.0 File Server platform, the only application that can accessfiles outside of the Server Folder (that is, the System Folder) is the fileserver application. AppleShare Foreground applications (described in theMacintosh Technote <A HREF = "nw_10.html">"AppleShare Foreground Applications"</a> are the only otherapplications that should be running on a server and they can only access filesinside the Server Folder. All file forks (referred to as files from here on)opened by remote AppleShare workstations are opened by the File Serverapplication.</p><p>The File Server application will open a file only one time. All access to thatfile from any number of workstations will use the single access path the FileServer has opened. Only when all workstations have closed the file does theFile Server really close the file on the server. So, that means only one FCB isused on the server per open file, even if 50 users have shared access to thatfile.</p><p>The File Server application handles all access control to an open file usingthe AppleTalk Filing Protocol (AFP) deny-mode permission model. The only reasona user won't be able to open an access path to a file on a server is if anotheruser has opened that file with a deny-mode that conflicts with the seconduser's request, or the user does not have the access rights needed to openfiles in the file's parent directory or directory ancestors. The AFP deny-modepermission model is described briefly in <i>Inside Macintosh</i> Volume V, FileManager Extensions in a Shared Environment, and in detail in the AppleTalkFiling Protocol chapter of <i>Inside AppleTalk.</i></p><p>As noted in the Macintosh Technote <A HREF = "nw_11.html">"AppleShare 1.1 and 2.0 Limits,"</a> themaximum number of open file forks on an AppleShare 2.0 server is either 80 on a1 MB MC68000 server platform, or 160 on a server platform with more than 1 MBand a MC68020 or greater processor. That figure includes the number of fileskept open by the system and the file server application. If an AppleShareForeground application is running on the server (for example, the AppleSharePrint Server), then any files it may have open count against the maximum, too.The same can be said for open desk accessories. This Technote currentlydoesn't say anything about those files counting towards the limit. If the 160(or 80) file limit is a problem, you can use the "Up Your FCBs" INIT to bumpthe number available up to the maximum (342) allowed by the File Manager. "UpYour FCBs" can be found on AppleLink in the Developer Support: DeveloperTechnical Support: Hacks folder.</p><h2>Software-selecting an AppleShare volume</h2><p>Date Written:  10/23/90</p><p>Last reviewed:  2/20/91</p><p>Is there any source code available for mounting/unmounting AppleSharevolumes?</p><p>There are actually a couple of ways to select an AppleShare volume. You coulduse the Choose tool in MPW that accomplishes this, or you can do it withaliases under System 7. Other than the MPW tool, there is no other supportedway of doing this under pre-7.0 systems; there are no current hooks to alloweasy mounting of AppleShare volumes programmatically. It gets pretty nastytrying to figure out everything that is necessary to accomplish this, which iswhy people here pretty much stay away from this as well. Also, some low-levelstuff may be proprietary, which is why the tool is supplied for developers. TheChoose tool is described in the MPW docs. It should be pretty straightforwardto use.</p><h2>2.0.1 PBHGetDirAccess and PutDirAccess restrictions</h2><p>Date Written:  12/5/90</p><p>Last reviewed:  1/16/91</p><p>If a volume is connected to an AppleShare server, but is not an AppleSharevolume, will the <code>PBHGetDirAccess</code> (and <code>PutDirAccess</code>) function work on it? Can anINIT on the server make these calls?</p><p>For AppleShare 2.0.1, the INIT cannot make these calls on non-file servervolumes. In future versions, the <code>PBHGetDirAccess</code> and <code>PutDirAccess</code> calls cansafely be made on all volumes connected.</p><h2>Server Move &amp; Rename folder</h2><p>Date Written:  12/5/90</p><p>Last reviewed:  6/14/93</p><p>A folder is created in the Server Folder called "...Move &amp; Rename." What isthis and what are its contents? Should it be backed up? Are there any othertemporary folders and files that might need to be backed up?</p><p>It's the "$01$02$03Move &amp; Rename" folder that AppleShare 2.0.1 and futureversions create for the two-step process of moving and renaming a file or afolder, a feature that is not provided via HFS. It should be backed up, but ingeneral will not contain anything. (It has something in it only for a briefinstant and only if the server has IBM PCs or some other computer that usesthis call. Macintosh systems don't.) It needs to be backed up for 2.0.1 so thatthe folder is there if the server is restored. (Otherwise, Admin will have tobe run to create a new one, a somewhat disconcerting action to perform aftercompletely restoring a file server.)</p><h2>How to tell if application's running on a server</h2><p>Date Written:  12/5/90</p><p>Last reviewed:  1/16/91</p><p>What is the best way to determine if a Macintosh application is running on aserver?</p><p>For 2.0.1 you can test the longword at $B50. If it is 0 or -1, the server isnot running. If it isn't--that is, it's a real address--then the server iseither starting up, or is running. There might be a hook available in futureversions of AppleShare that your process can hook into.</p><h2>Detecting AppleTalk being closed down by user</h2><p>Date Written:  12/12/90</p><p>Last reviewed:  6/14/93</p><p>How do I detect that a user has closed down my AppleTalk connection (by turningAppleTalk off from the Chooser or by changing network connections from theNetwork control panel)?</p><p>The AppleTalk Transition Queue provides a means to determine when the AppleTalkdrivers change status or when they might be closed in the very near future. TheTransition Queue informs its clients (everyone who has asked to be added to thequeue) each time the state of the .MPP driver changes state (opened or closed)or is about to change state.</p><p>The AppleTalk Transition Queue is documented in <i>Inside Macintosh</i> VolumeVI, Chapter 32 (The AppleTalk Manager) and is also documented in the<i>Macintosh AppleTalk Connections Programmer's Guide,</i> Chapter 3 (Calls tothe LAP Manager), available from APDA. A sample AppleTalk Transition Queueroutine is shown in Technote 311.</p><h2>Purpose of AppleShare SP file</h2><p>Date Written:  3/14/91</p><p>Last reviewed:  4/29/91</p><p>What is the file "AppleShare SP" and what does it do? The AppleShare FileServer seems to run without it, and it reduces the alert sound to just a beepeven when the server is not running on that computer. Is the file reallyneeded?</p><p>You do need the AppleShare SP INIT on your file server. The AppleShare SP(Small Patch) INIT is designed to correct a minor incompatibility betweenAppleShare 2.0x and the Sound Manager. The INIT forces the Macintosh to use the"Simple Beep" sound at all times. System 7.0 file sharing and future versionsof AppleShare do not need the INIT.</p><h2>Macintosh EOF in an AppleShare environment</h2><p>Date Written:  3/18/91</p><p>Last reviewed:  6/10/91</p><p>I ran into the following when updating the logical end of file (EOF) of ashared file: Application A and Application B have access to a file underAppleShare. Each is using <code>fsRdWrShPerm</code>. When Application A changes the logicalEOF, Application B doesn't seem to notice that EOF has changed untilApplication B calls <code>GetEOF</code>. Is there a better way to make Application B awareof the change of logical EOF?</p><p>You've made a correct assumption that the correct way to keep track of EOF inan AppleShare environment is to ask for it. When you open a file, theAppleShare workstation code translates the Macintosh operating system Open callto the AFP (AppleTalk Filing Protocol) <code>FPOpenFork</code> call, and sets the bits inthe bitmap parameter to current length of the fork opened (in the case of Open,the data fork). It then uses THAT as the EOF for future operations unless itgets an update from the server. Because the server does not constantly updateeveryone who has the file open, you have to ask to find if another user (orapplication) has made a change. Just remember that using <code>GetEOF</code> will only getyou the EOF at that instant in time. Someone else sharing the file could changeEOF right after you check it.</p><p>The <code>PBLockRange</code> function can be used by an AppleShare aware application toprevent another user from appending data to a shared file while you areappending data. For example:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>  paramBlock.ioRefNum := myFileRef;  err := PBGetEOF(@paramBlock, FALSE); {get the current EOF}  {check for errors in a real application}  oldEOF := paramBlock.ioMisc; {save the current EOF}  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := oldEOF; {start range lock at current EOF}  err := PCLockRange(@paramBlock, FALSE); {and lock the rest of the fork}  {check for errors in a real application}  {now you can append data to the file}  paramBlock.ioRefNum := myFileRef;  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := oldEOF;  err := PCUnlockRange(@paramBlock, FALSE); {unlock the locked range}</pre>	</TD></TR></TABLE></CENTER><p><code>PBLockRange</code> can also be used when you need to truncate a shared file. Lockingthe portion of the file you're about to truncate prevents another user fromusing that portion during the truncation process. For example:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>  paramBlock.ioRefNum := myFileRef;  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := theNewEOF; {start lock at truncation point}  err := PCLockRange(@paramBlock, FALSE); {and lock the rest of the fork}  {check for errors in a real application}  paramBlock.ioMisc:= theNewEOF;  err := PBSetEOF(@paramBlock, FALSE); {set the new EOF (truncate the file)}  {check for errors in a real application}  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := theNewEOF;  err := PCUnlockRange(@paramBlock, FALSE); {unlock the locked range}  {check for errors in a real application}The entire fork can be locked with:  paramBlock.ioRefNum := myFileRef;  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := 0; {lock from the beginning}  err := PCLockRange(@paramBlock, FALSE); {lock the whole fork}  {check for errors in a real application}  {do your thing}  paramBlock.ioRefNum := myFileRef;  paramBlock.ioReqCount := -1; {$FFFFFFFF}  paramBlock.ioPosMode := fsFromStart;  paramBlock.ioPosOffset := 0; {unlock from the beginning}  err := PCUnlockRange(@paramBlock, FALSE); {unlock the whole fork}</pre>	</TD></TR></TABLE></CENTER><h2>Macintosh AppleShare versus file sharing capabilities</h2><p>Date Written:  4/3/91</p><p>Last reviewed:  6/21/91</p><p>We are using the file sharing capabilities of Macintosh systems with System 7.0to make them mini file servers. Where can information that details the featuresof both AppleShare and file sharing be found? We are considering using onlyfile sharing in the office if it is capable of providing most of whatAppleShare provides.</p><p>Information on file sharing can be found in the System 7 Personal Upgrade Kitand in <i>Inside Macintosh</i> Volume VI, on your <i>Developer CD Series</i>disc. The maximum number of concurrent connections allowed on a Macintosh usingfile sharing is 10. The performance of an AppleShare file server (the standardkind of server) is approximately 25 percent better than a similar configurationof Macintosh computers acting as a file sharing server.</p><h2>System 7 and AppleTalk Internet Router</h2><p>Date Written:  9/17/91</p><p>Last reviewed:  11/25/91</p><p>We've tried to run the Apple Internet Router with our System 7 file sharingservers. There does not appear to be support for multiple networks. Is theresome solution to this?</p><p>The AppleTalk Internet Router and System 7 are compatible, with two exceptions:virtual memory and 32-bit addressing. You need to drag-install it instead ofusing the Installer. The Installer script on the router disk will put the partsof the router in the wrong place. Here are the steps to drag-install therouter:</p><ol type="1">	<li>Drag the files Router, LocalTalk (Built-in), and LocalTalk (Modem) from the System Folder on the <i>AppleTalk Internet Router</i> disk to the closed System Folder on the disk where you want to install. System 7 will automatically put the Router file in the System Folder, and put the LocalTalk (Built-in) and LocalTalk (Modem) files in the Extensions folder in the System Folder.</li>	<li>Under System 7, open the System file on the <i>AppleTalk Internet Router </i>disk (double-click the System file). A window will open showing the desk accessories, fonts, and sounds that are part of that System file. Drag the Router desk accessory from that window to the closed System Folder on the disk where you want to install. System 7 will automatically put the Router desk accessory in the Apple Menu Items folder in the System folder.</li>	<li>Reboot.</li></ol> <p>That's all there is to it.</p><p>X-Ref:</p><P>"System 7: Installing Internet Router 2.0," AppleLink Tech Info Library</p><h2>TMGetTermEnvirons envVersTooBig error</h2><p>Date Written:  9/17/91</p><p>Last reviewed:  9/17/91</p><p>A call made to <code>TMGetTermEnvirons</code> returns -5502 or <code>envVersTooBig</code>. The call ismade with a good terminal handle started from your TTY tool. What's wrong? Howdo I fix it?</p><p>When you call <code>TMGetTermEnvirons</code>, the <code>TermEnvironRec</code> that you hand it a pointerto must have initialized the version field with <code>curTermEnvRecVers</code>. Thefollowing will work properly:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void getTEnvirons(TermHandle aTerm){  ...   TermEnvironRec tEnv;   TMErr err;   ...   tEnv.version = curTermEnvRecVers;   err = TMGetTermEnvirons(aTerm,&amp;tEnv);   /* check for errors, do whatever... */   ...</pre>	</TD></TR></TABLE></CENTER><p>This is consistent with most other Macintosh "get environment" calls such as<code>SysEnvirons</code>, and is documented (somewhat unclearly) at the top of page 113 in<i>Inside the Macintosh Communications Toolbox.</i></p><h2>Modifying a server volume's backup date-time from a workstation</h2><p>Date Written:  12/5/91</p><p>Last reviewed:  1/27/92</p><p>How can I change the backup date of a remote AppleShare volume? When I get thevolume information with <code>PBHGetVInfo</code> (followed by a <code>PBFlushVol</code>), change thebackup date field, and call <code>PBSetVInfo</code>, the date is changed in my local copy ofthe volume information, but when I unmount and remount the AppleShare volume,the original backup date is still there.</p><p>On an AppleTalk Filing Protocol (AFP) file server, two of the volume date-timevalues, the volume creation date-time and the volume modification date-time,are managed solely by the server and can't be changed by workstations. Thethird volume date-time value, the volume backup date-time, can be set by aworkstation with only one AFP call, <code>afpSetVolParms</code>. However, the File Manager,through the Macintosh AppleShare external file system, does not give anapplication a way to make the <code>afpSetVolParms</code> call. That leaves only one way youcan change a server volume's backup date-time from a workstation: You'll haveto use the AppleTalk .XPP driver to access the server directly.</p><p>Using the .XPP driver to change the backup date-time involves these steps:</p><ul type="disc">	<li>Open the .XPP driver and get the driver reference number.</li>	<li>Use the <code>afpLogin</code> variant of AFPCommand to start a session and log in to the server. If the "Randnum Exchange" or "2-Way Randnum Exchange" user authentication methods are used, you will receive an <code>AuthContinue</code> error (-5001) from the <code>afpLogin</code> call and you'll have to follow up the <code>afpLogin</code> call with an <code>afpLoginCont</code> call (through <code>AFPCommand</code> again) to finish the log-in sequence.</li>	<li>Once you're logged in to the server, you need make an <code>afpGetSrvrParms</code> call to get a list of volumes and to find out if the volume you're interested in has a password associated with it.</li>	<li>Then you need to call <code>afpOpenVol</code> with the volume name (and password if there is one). You can have <code>afpOpenVol</code> give you the volume's current backup date-time and other volume information if you set the appropriate bits in the bitmap parameter passed to <code>afpOpenVol</code>.</li>	<li>Now that you're logged in to the server and have the volume opened, you can make an <code>afpSetVolParms</code> call to change the backup date-time.</li>	<li>After changing backup date-time, you need to close the volume with <code>afpCloseVol</code>, and then log off the server with <code>afpLogout</code>.</li></ul><p>The .XPP driver's AFP commands are described in <i>Inside Macintosh</i> VolumeV in the AppleTalk chapter (pages V-524 through V-550). For a description ofthe AFP calls, user authentication methods, and other AFP information, you needto look in the AppleTalk Filing Protocol chapter of <i>Inside AppleTalk.</i> Ifyou decide you want to really use the .XPP driver as described above and wantto use the 2-Way Randnum Exchange user authentication method supported bySystem 7 File Sharing and AppleShare 3.0, contact DTS for a preliminary versionof the AFP 2.1 specification that describes that new authentication method.</p><h2>AppleShare Print Server 3.0 and AppleTalk self-send</h2><p>Date Written:  2/28/92</p><p>Last reviewed:  2/28/92</p><p>When I issue a <code>PAPWrite</code> from my application to the AppleShare Print Server 3.0running on the same Macintosh, <code>PAPWrite</code> locks up in a tight loop. If I send toa LaserWriter or the AppleShare Print Server 3.0 running on a differentMacintosh system, all works well. The LaserWriter Font Utility 7.0 behaves thesame as my application: It works if the spooler is remote and locks up if thespooler is local.</p><p>You're probably calling <code>PAPWrite</code> and then not giving up any system time neededby the print server to process the data you sent to it. That just doesn't workin the self-send environment. For example, the following won't work:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    PAPWrite(refNum, writeBuff, dataSize, eof, compState);    WHILE compState = 1 DO</pre>	</TD></TR></TABLE></CENTER><p>What your application should do is drop back into its event loop after makingthe <code>PAPWrite</code> call and then poll <code>compState</code> to see when the <code>PAPWrite</code> completes.By calling <code>WaitNextEvent</code> from your event loop, your application gives the printserver application the time it needs to receive and process the data you sentto it.</p><p>The LaserWriter Font Utility wasn't designed to work with print servers andwill exhibit the same problem your application is experiencing.</p><h2>System 6 &amp; 7 Chooser AppleShare differences</h2><p>Date Written:  2/28/92</p><p>Last reviewed:  2/1/93</p><p>What's the limit on the number of servers displayable in the Chooser as well asthe maximum number of AppleShare mount points per server? Are the System 7limits the same as for System 6?</p><p>Most System 6 Chooser limitations have been eliminated with the System 7Chooser. Here's how each version operates:</p><p>System 6 Chooser:</p><p>The 6.0 Chooser's LookupName call to find AppleTalk entities is madeasynchronously where retBuffPtr points to a 512-byte buffer and maxToGet = 32(this is the 32-device limit per device type you may have heard of). Theimportant thing to note here is the return buffer size (512 bytes). Forexample, if you are looking for AppleShare servers in your own zone (the "*"zone), the number of overhead bytes per NBP tuple returned will be 16 (5 forthe entity address, 10 for the string "AFPServer", and 2 for the string "*").If there were 20 servers in your zone, 340 bytes of the 512-byte buffer areused <i>before</i> you start counting the space used by the server names. Thatleaves 172 bytes for the names or around 8 characters per name (1 length byteplus 8 characters). If the average server name is longer than that, there won'tbe enough room to collect all of the NBP replies and one or more servers won'tshow up in the list.</p><p>Once a server is selected and the user is authenticated, the AppleShare 2.0RDEV uses afpGetSrvrParms to ask for the list of server volumes. The AppleShare2.0 RDEV uses a 512-byte buffer for the replies. After the overhead used by theAppleTalk protocol headers, that's enough room for around 16 volumes withfull-sized names; more if the names aren't full-sized.</p><p>System 7 Chooser:</p><p>The System 7.0 Chooser fixes the problem with the NBP buffer completely. Itdynamically sizes the NBP <code>LookupName</code> return buffer. So, if <code>numGotten</code> =&gt;<code>maxToGet</code>, it will make the return buffer larger and increase the value of<code>maxToGet</code>. The System 7.0 Chooser starts with <code>retBuffSize</code>=1024 and<code>maxToGet</code>=256.</p><p>The AppleShare 7.0 and 3.0 RDEVs increased the size of the <code>afpGetSrvrParms</code>reply buffer to 1728 bytes. That's still not big enough to get 255 volumes (theAFP limit) with full-sized names. However, it is big enough for 50 volumes withfull-sized names, the maximum number of volumes supported by AppleShare 3.0.</p><p>For both System 6 and 7 Choosers, the only limits imposed on the zone are theList Manager limits of 32K of data per list. If each zone name were 33characters, for example, that would give you space for roughly 1000 zones.</p><h2>Server and workstation clock times</h2><p>Date Written:  2/25/92</p><p>Last reviewed:  4/22/92</p><p>If I hook up two Macintosh computers over LocalTalk, turn on Personal FileShare, mount one computer's volume on the other, and make changes to files oneach machine, the Get Info mod dates are not adjusted. In my case, machine A'sclock said 10:20 and machine B's said 10:30. From machine B, I made a change toa file on machine A. Then, still on machine B, I did a Get Info on that machineA file. Its mod date said 10:20. I then instantly made a change to a file (frommachine B still) on machine B and did a Get Info on it and its mod date was10:30. In other words, the mod dates were not adjusted and reflected the timeof the machine each file was located on. Am I misinterpreting something?</p><p>The way the workstation computes the server time is not quite asstraightforward as is documented in <i>Inside AppleTalk,</i> 2nd edition, page13-21. When a workstation logs onto a server (File Share or AppleShare), thedifference between the workstation's clock and the server's clock (s - w) iscomputed. All subsequent server date/time values as seen by the workstation arecomputed by adding this difference (s - w) to the server data/time (workstationtime = server time + (s - w)).</p><p>However, it looks as if the Macintosh workstation also uses the followingalgorithm to compute the adjusted server time:</p><ul type="disc">	<li>if the offset (s - w) is 15 minutes or less, report the server time as is</li>	<li>if the offset (s - w) is greater than 15 minutes, compute the offset rounded up to the nearest 30 minute interval.</li></ul><p>For example, let's say you have two machines, A and B. B logs on to A. B thengoes and modifies a file on A. Listed below are the clock times that themodification took place, and in the rightmost column is the mod. time that Bwould see for the modified file on A.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    A time               B time              mod. time as seen by B    ------               ------              ----------------------    11:09                11:22                        11:09    11:04                11:20                        11:34     4:34                 7:14                         7:05</pre>	</TD></TR></TABLE></CENTER><p>In the first example, the difference (s - w) is (11:22 - 11:09) = 13 minutes.Since 13 is less than 15 minutes, B sees the server time as is. In the secondexample, (s - w) is (11:20 - 11:04) = 16 minutes which is greater than 15minutes so compute the offset to the nearest 30 minute interval (30 - 16) = 14,and 11:20 + 14 = 11:34. In the third example, (s - w) is (7:14 - 4:34) = 2:40which is greater than 15 minutes so compute the offset to the nearest 30 minuteinterval (30-40) = -10, and 7:14 - 10 = 7:05. In the last example, (s - w) is(11:53 - 11:22) = 31 minutes so compute the offset to the nearest 30 minuteinterval 30 - 31 = -1, and 11:53 - 1 = 11:52.</p><p>You are probably asking why the 15-minute cushion and why round to the nearest30-minute interval? Possibly it's an attempt to approximate a modification timesomewhere in between the workstation and server times.</p><h2>PBCatSearch on AppleShare volumes</h2><p>Date Written:  3/11/92</p><p>Last reviewed:  5/21/92</p><p><code>PBCatSearch</code> acts differently on a local hard disk than on an AppleShare volume.Say, after a couple of successful <code>PBCatSearch</code> operations on a volume, the usermodifies the directory by duplicating, renaming, or removing a file. An erroris returned, and (theoretically), the search can continue. If you do this on alocal hard disk, everything is cool. After making the change, the next<code>PBCatSearch</code> call returns -1304 (<code>catChangedErr</code>), but subsequent calls return<code>noErr</code> and continue to find files. However, if you run this on an AppleShare 3.0volume, the first call after the change returns -5037 (<code>afpCatalogChanged</code>), butall following calls continue to return that error, and "find" the same filethat was found on the last good attempt. So what gives?</p><p>The <code>afpCatSearch</code> AFP call does not map exactly to the File Manager's<code>PBCatSearch</code> call. This isn't uncommon in File Manager to AFP translationsbecause AFP calls are designed to be more general so they can be implemented onplatforms other than the Macintosh. In some cases, AFP keeps more informationthan the Macintosh requires (for example, ProDOS file type mapping informationfor Apple II systems and short names for DOS workstations) and in other casesMacintosh-specific information is "generated" by the Macintosh workstationsoftware (for example, allocation block sizes in the Volume Control Block).Here are specific differences I've found between <code>PBCatSearch</code> and<code>afpCatSearch</code>:</p><ul type="disc">	<li>afpCatSearch and the AppleShare workstation implementation of <code>PBCatSearch</code> do not use <code>ioSearchTime</code>. The AppleShare 3.0 server searches for up to 1 second or 4 matches maximum and then returns to the workstation with whatever matches (0-4) are found within areas of the disk that user has access to. The AppleShare workstation keeps asking for the number of matches requested minus the total matches returned until it gets the number requested, or the server returns an error.</li>	<li>AFP 2.1 does not support both physical and logical fork lengths. If a <code>PBCatSearch</code> call uses fork lengths, the upper bound (in the <code>afpCatSearch</code> Spec2 field which comes from the <code>ioSearchInfo2</code> record) becomes the maximum of the logical and physical lengths and the lower bound (in the <code>afpCatSearch</code> Spec1 field, which comes from the <code>ioSearchInfo1</code> record) becomes the minimum of the logical and physical lengths.</li>	<li>AFP 2.1 does not support the <code>fsSBNegate ioSearchBits</code> bit. If a <code>PBCatSearch</code> call uses <code>fsSBNegate</code>, that bit will be ignored by the AppleShare workstation and server and you'll get back exactly the opposite of what you expected. This is an unfortunate omission from AFP 2.1. Because it is implemented this way in at least two shipping servers, the <code>fsSBNegate</code> cannot be added without a revision to the AFP specification.</li>	<li>The File Manager <code>PBCatSearch</code> call doesn't return any matches when a <code>catChangedErr</code> occurs. However, it does return an updated <code>ioCatPosition</code> record which can be used to make another <code>PBCatSearch</code> call (this may result in your search either missing a few entries or getting a few duplicate matches). <code>afpCatSearch</code> does not work that way. <code>afpCatSearch</code> only returns AFP reply data (which includes the ioCatPosition record) if the <code>FPError</code> is <code>noErr</code> or <code>afpEofError</code>. The current <code>ioCatPosition</code> record is not returned to the workstation if any other error occurs. So, if an <code>afpCatalogChanged</code> error occurs, the <code>ioCatPosition</code> record is not returned to the workstation and the workstation returns ioCatPosition to the caller of <code>PBCatSearch</code> unchanged. Since the <code>ioCatPosition</code> record is still invalid, calling <code>PBCatSearch</code> again with the same invalid <code>ioCatPosition</code> record will just return the <code>afpCatalogChanged</code> error again. The conclusion from this explanation is that you can continue a search if <code>PBCatSearch</code> returns a result of noErr or <code>catChangedErr</code>. The search completed if <code>PBCatSearch</code> returns a result of eofErr. All other results from PBCatSearch (including <code><code>afpCatalogChanged</code></code>) indicate that you must restart the search from the beginning by clearing the initialize field of the <code>ioCatPosition</code> record.</li></ul><h2>AppleShare Prep file and boot-mounting volumes</h2><p>Date Written:  8/25/92</p><p>Last reviewed:  9/15/92</p><p>I have selected AppleShare volumes to mount at system startup by checking thevolumes in the Chooser list. If I'm on a nonextended network and I call anextended network via AppleTalk Remote Access and log into a remote server viathe Chooser and AppleShare, an error alert will say "The AppleShare Prep fileneeded some minor repairs. Some AppleShare startup information may be lost" andall the information about my local nonextended network will be cleared out ofthe AppleShare Prep file, so I loose all my log-in IDs and passwords for mylocal servers. The same thing happens going back the other way (extended tononextended). Why is this happening?</p><p>There are several problems you can run into when you connect two networks (andthat's what you're doing when you use AppleTalk Remote Access when you'realready connected to a network). The problems are usually the result ofduplicate names or duplicate node numbers.</p><p>The "boot mount list" (BML) kept in the AppleShare Prep file stores thelocation of volumes that you want mounted at boot time. Part of that locationis the zone name. If you create entries to the BML when you aren't on anextended network (that is, when you have no zones), the zone name stored in theBML is "*" ("*" is AppleTalk's shorthand for "this zone"). If you createentries to the BML when you are on an extended network (that is, when you havezones), then the zone name stored in the BML is the zone name of the server.</p><p>The boot mount code checks the validity of the BML when the system starts up,and the Choose checks the validity of the BML when it's opened. If there are nozones, then entries with zone names other than "*" are cleared out and an alertsaying "The AppleShare Prep file needed some minor repairs. Some AppleSharestartup information may be lost" is displayed because those entries aren'tvalid. If there are zones, then entries with zone names of "*" are cleared outand the alert is displayed because the "*" zone name isn't a reliable way tosave the zone location of a server on an extended network. The "*" zone isn'treliable for storing the zone name because a workstation can easily be movedfrom zone to zone, keeping the same NBP object and NBP type names. This isespecially true with AppleTalk phase 2, which supports multiple zones on asingle network (for example, multiple zones on the same piece of Ethernetcable).</p><p>The workaround for boot-mounting volumes is to create alias files to the fileservers you want to mount at boot time and then drop those alias files into theStartup folder inside your System Folder. The only drawback to this is aliasesdon't save the user's password. If you need boot-mounted volumes without thepassword dialog, you'll have to use guest access.</p>                                     <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (84K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_515.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_515.html%3Fid%3DDTS10002573-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_515.html%3Fid%3DDTS10002573-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_515.html%3Fid%3DDTS10002573-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>