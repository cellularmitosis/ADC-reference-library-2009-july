<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A NW61: Accessing DHCP Options</title><meta name="keywords" content="Mac OS 8 Open Transport Accessing DHCP Options"><meta name="Description" content="Technical Q&amp;A NW61: Q&amp;A describes the new Open TransportAPI routine for accessing DHCP options."><meta name="categories" content="Networking"><meta name="week-posted" content="Apr 19, 1999 - Apr 23, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001473" title="Accessing DHCP Options"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A NW61</div>
<div id="pageheadsub">Accessing DHCP Options</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id=p2>Q: I'm writing a cross-platform connectivity product. One of the features of the product is that it can automatically configure itself based on extra options returned in the DHCP configuration. Is there any way I can access these extra options from the DHCP packet that OT used to configure the TCP/IP stack?</P>         <p id=p4>A: Prior to Open Transport 2.0.1, there was no way to access the extra DHCP options that were in the DHCP packet OT used to configure the TCP/IP stack. Open Transport 2.0.1 introduces a new API routine,<CODE>OTInetGetDHCPConfigInfo</CODE>, which allows access to all options in the DHCPACK packet used to configure the TCP/IP stack. This Q&amp;A describes the new routine.</P>         <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>                  To use this routine you will need the interfaces and libraries from the<a href="http://developer.apple.com/sdk" target="_blank">Open Transport 2.0.1 SDK</A> (or later).               </TD></TR></TABLE></center><BR>                  <H4>&nbsp;InetDHCPOption</H4>         <TABLE BORDER=0>            <TR>               <td bgcolor="#EEEEEE" align=left>                  <pre>struct InetDHCPOption{    UInt8       fOptionTag;    UInt8       fOptionLen;    UInt8       fOptionValue;};typedef struct InetDHCPOption InetDHCPOption;</pre>               </TD></TR></TABLE>         <p id=p4>This structure is used to return information about a DHCP option. The fields have the following meaning:</P>                       <P id=p4><CODE>fOptionTag</CODE></p>                        <P id=p4>This is the DHCP <STRONG>tag octet</STRONG> as            defined in RFC 2132            <A HREF="http://www.faqs.org/rfcs/rfc2132.html" target="_blank">DHCP            Options and BOOTP Vendor Extensions</A>.</p>                        <P id=p4><CODE>fOptionLen</CODE></p>                        <P id=p4>This is the total length of the option, not including            the size of the tag octet and this length byte.</p>                        <P id=p4><CODE>fOptionValue</CODE></p>                        <P id=p4>This field is a place holder for an unbounded array            of bytes that make up the option.</p>                        <H4>&nbsp;OTInetGetDHCPConfigInfo</H4>         <TABLE BORDER=0>            <TR>               <td bgcolor="#EEEEEE" align=left>                  <pre>extern pascal OSStatus OTInetGetDHCPConfigInfo(InetDHCPOption* buf,                    UInt32 bufSize, SInt32 index, SInt32 opt);</pre>               </TD></TR></TABLE><BR>         <TABLE BORDER=1>            <TR>               <td width=134 align=left>                  <code>buf</code>               </TD><td align="left">                  A pointer to a buffer where OT places the DHCP                  option.               </TD></TR>            <TR>               <td width=134 align=left>                  <code>bufSize</code>               </TD><td align="left">                  The size of the above buffer.               </TD></TR>            <TR>               <td width=134 align=left>                  <code>index</code>               </TD><td align="left">                  The interface from whose DHCP configuration you                  wish to extract options. This is the same index                  used to specify an interface when calling                  <CODE>OTInetGetInterfaceInfo</CODE>. Specify                  <CODE>kDefaultInetInterface</CODE> if you wish to                  get options from the default interface.               </TD></TR>            <TR>               <td width=134 align=left>                  <code>opt</code>               </TD><td align="left">                  The tag octet of the option to be extracted from                  the DHCP configuration, or                  <CODE>kAllDHCPOptions</CODE> to receive all                  options. If you ask for all options, they are                  packed in the same way as they are in the DHCP                  configuration.               </TD></TR>            <TR>               <td width=134 align=left>                  <code>result</code>               </TD><td align="left">                  An error result. Likely errors include                  <CODE>kENOENTErr</CODE> (TCP/IP is not loaded, or                  the interface specified by index is not found or                  not loaded), <CODE>kEINVALErr</CODE>                  (<CODE>index</CODE> is                  <CODE>kDefaultInetInterface</CODE> but the default                  interface isn't configured, or the specified                  interface wasn't configured using DHCP or BOOTP),                  <CODE>kENORSRCErr</CODE> (DHCP information is not                  available because there was not enough memory to                  save it when the TCP/IP stack loaded),                  <CODE>kOTBufferOverflowErr</CODE> (explained                  below), or <CODE>kOTBadOptionErr</CODE> (the option                  specified by <CODE>opt</CODE> was not in the DHCP                  configuration).               </TD></TR></TABLE>         <p id=p4>This routine returns, in the buffer described by  <CODE>buf</CODE> and <CODE>bufSize</CODE>, the value of the  DHCP option for the interface specified by <CODE>index</CODE> whose tag octet is <CODE>opt</CODE>. You can specify <CODE>kDefaultInetInterface</CODE> for <CODE>index</CODE> to get the options for the default interface. You can specify <CODE>kAllDHCPOptions</CODE> for <CODE>opt</CODE> to get all DHCP options for an interface.</P>         <p id=p4>The standard values for <CODE>opt</CODE> are specified in  RFC 1700 <A HREF="http://www.faqs.org/rfcs/rfc1700.html" target="_blank">Assigned Numbers</A>. The format of the returned option values for these options are defined in RFC 2132 <A HREF="http://www.faqs.org/rfcs/rfc2132.html" target="_blank">DHCP Options and BOOTP Vendor Extensions</A>.</P>   <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Important:</B><BR>Option values are returned as they appear in the                  DHCPACK packet. The component fields of an option                  value may not be packed as you expect. Check with                  the RFC before interpreting option values.</P></TD></TR></TABLE></CENTER><BR>                 <p id=p4>The routine expects the option value to fit into the buffer specified by <CODE>buf</CODE> and <CODE>bufSize</CODE>. If the buffer is too small to hold the  option value, the routine returns <CODE>kOTBufferOverflowErr</CODE>. If you are requesting all  options (<CODE>opt</CODE> is <CODE>kAllDHCPOptions</CODE>) and you get this error, the buffer contains the first <CODE>bufSize</CODE> bytes of the options. If you are requesting a specific option and you get this error, the buffer contains no useful data.</P>         <p id=p4>The following snippet of code shows how to extract the subnet mask option from the DHCP packet that was used to configure the computer:</P>         <TABLE BORDER=0>            <TR>               <td bgcolor="#e6e6e6" align=left>                  <pre>enum {    kDHCPSubnetMaskOption = 1};&nbsp;UInt8 optionBuffer[6];&nbsp;err = OTInetGetDHCPConfigInfo(  (InetDHCPOption*) optionBuffer,                                sizeof(optionBuffer),                                kDefaultInetInterface,                                kDHCPSubnetMaskOption);if (err == noErr) {    OTAssert("Got back wrong option", optionBuffer[0] == kDHCPSubnetMaskOption);    OTAssert("Option size is wrong ", optionBuffer[1] == sizeof(InetHost));    printf("Subnet mask provided by DHCP is %d.%d.%d.%d\n",                optionBuffer[2],                optionBuffer[3],                optionBuffer[4],                optionBuffer[5]            );}</pre>               </TD></TR></TABLE></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Apr 19 1999]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/nw/nw61.html%3Fid%3DDTS10001473-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/nw/nw61.html%3Fid%3DDTS10001473-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/nw/nw61.html%3Fid%3DDTS10001473-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center> </BODY></HTML>