<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>File Manipulation (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING74></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-73.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-75.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-73.html"><B>About the File Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING74-0></A>
<H2><A NAME=MARKER-9-202></A>File Manipulation</H2>
 The File Manager provides a number of routines that allow you to manipulate files. You can open a file fork, read and write the data in it, adjust its logical end-of-file, set the file mark, allocate blocks to a file, and close a file.<P>
 <A NAME=MARKER-2-203></A>To manipulate the data in a file, you first need to open the file. You can open a file using one of several routines, depending on whether you want to use low-level or high-level routines and how you identify the file to open. <A HREF=Files-94.html#MARKER-9-371>Table 2-1</A> lists the file-opening routines.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-371></A><B>Table 2-1 Routines for opening file forks</B></CAPTION>
<TH>FSSpec <TH>HFS High-Level<TH>HFS Low-Level<TH>Description<TR>
<TD>FSpOpenDF<TD><CODE>HOpenDF</CODE><TD><CODE>PBHOpenDF</CODE><TD>Open a file's data fork.<TR>
<TD>FSpOpenRF<TD><CODE>HOpenRF</CODE><TD><CODE>PBHOpenRF</CODE><TD>Open a file's resource fork.<TR>
<TD>&nbsp;<TD><CODE>HOpen</CODE><TD><CODE>PBHOpen</CODE><TD>Open a driver or file data fork.</TABLE>
<P>
 All the high-level <CODE>FSSpec</CODE> routines require you to specify a file using a file system specification record. All the HFS routines, whether high or low level, require you to specify a file by its volume, directory, and name.<P>
 No matter which routine you use to open a file, you need to specify a <B>file permission</B> that governs the kind of access your application can have to that file. You can specify one of these constants:<A NAME=MARKER-2-204></A><A NAME=MARKER-2-205></A><A NAME=MARKER-2-206></A><A NAME=MARKER-2-207></A><A NAME=MARKER-2-208></A><P>
<PRE>
CONST
   fsCurPerm      =  0;    {whatever permission is allowed}
   fsRdPerm       =  1;    {read permission}
   fsWrPerm       =  2;    {write permission}
   fsRdWrPerm     =  3;    {exclusive read/write permission}
   fsRdWrShPerm   =  4;    {shared read/write permission}
</PRE>
 Use the constant <CODE>fsCurPerm</CODE> to request whatever permission is currently allowed. If write access is unavailable (because the file is locked or because the file is already open with write access), then read permission is granted. Otherwise, read/write permission <BR>is granted.<P>
 Use the constant <CODE>fsRdPerm</CODE> to request permission to read the file. Similarly, use the constant <CODE>fsWrPerm</CODE> to request permission to write to the file. If write permission is granted, no other access paths are granted write permission. Note, however, that the File Manager does not support write-only access to a file. As a result, <CODE>fsWrPerm</CODE> is synonymous with <CODE>fsRdWrPerm</CODE>.<A NAME=MARKER-9-66></A><P>
 There are two types of read/write permission--exclusive and shared. Often you want exclusive read/write permission, so that users can safely read and alter portions of a file. If your application requests and is granted exclusive read/write permission, no users are granted permission to write to the file; other users may, however, be granted permission to read the file.<P>
 Shared read/write permission allows multiple access paths for writing and reading. It is safe to have multiple read/write paths open to a file only if there is some way of locking a portion of the file before writing to that portion of the file. You can use the File Manager functions <CODE>PBLockRange</CODE> and <CODE>PBUnlockRange</CODE> to lock and unlock ranges of bytes in a file. These functions, however, are supported only on remotely mounted volumes or on local volumes that are sharable on the network. As a result, you should request shared read/write permission only if range locking is available. See <A HREF=Files-78.html#MARKER-9-233>"Shared File Access Permissions" on page 2-15</A> for details on permissions in shared environments.<P>
<DL>
<DT><B>Note</B>
<DD>Don't assume that successfully opening a file for writing ensures that you can actually write data to the file. The File Manager allows you to open with write permission a file located on a locked volume, and you won't receive an error until you first try to write data to the file. To be safe, you can call the <CODE>PBHGetVInfo</CODE> function to make sure that the volume is writable.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 When you successfully open a file fork, you receive a <B>file reference number</B> that uniquely identifies the open file. You can pass that number to the File Manager routines that allow you to manipulate open files. <A HREF=Files-77.html#MARKER-9-175>Table 2-2</A> lists the routines that operate on <BR>open files.<P>
 The File Manager provides a number of routines that allow you to operate on files that are closed. You can create, delete, get and set information, and lock and unlock files. <BR>You can also move files within a volume and exchange data in two files. <A HREF=Files-77.html#MARKER-9-175>Table 2-2</A> lists these routines.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-175></A><B>Table 2-2 Routines for operating on open file forks</B></CAPTION>
<TH>High-Level<TH>Low-Level<TH>Description<TR>
<TD>FSRead<TD><CODE>PBRead</CODE><TD>Read bytes from an open file fork.<TR>
<TD>FSWrite<TD><CODE>PBWrite</CODE><TD>Write bytes to an open file fork.<TR>
<TD>FSClose<TD><CODE>PBClose</CODE><TD>Close an open file fork.<TR>
<TD>GetFPos<TD><CODE>PBGetFPos</CODE><TD>Get the position of the file mark.<TR>
<TD>SetFPos<TD><CODE>PBSetFPos</CODE><TD>Set the position of the file mark.<TR>
<TD>GetEOF<TD><CODE>PBGetEOF</CODE><TD>Get the current logical end-of-file.<TR>
<TD>SetEOF<TD><CODE>PBSetEOF</CODE><TD>Set the current logical end-of-file.<TR>
<TD>Allocate<TD><CODE>PBAllocate</CODE><TD>Add allocation blocks to a file fork.<TR>
<TD>AllocContig<TD><CODE>PBAllocContig</CODE><TD>Add contiguous allocation blocks to a file fork.<TR>
<TD>&nbsp;<TD><CODE>PBFlushFile</CODE><TD>Update the disk contents of a file fork.<TR>
<TD>GetVRefNum<TD>&nbsp;<TD>Get volume reference number of an open file.</TABLE>
 
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-175></A><B>Table 2-3 Routines for operating on closed files</B></CAPTION>
<TH>FSSpec <TH>HFS High-Level<TH>HFS Low-Level<TH>Description<TR>
<TD>FSpCreate<TD>HCreate<TD>PBHCreate<TD>Create both forks of a <BR>new file.<TR>
<TD>FSpDelete<TD>HDelete<TD>PBHDelete<TD>Delete both forks of a file.<TR>
<TD>FSpGetFInfo<TD>HGetFInfo<TD>PBHGetFInfo<TD>Get a file's Finder information.<TR>
<TD>FSpSetFInfo<TD>HSetFInfo<TD>PBHSetFInfo<TD>Set a file's Finder information.<TR>
<TD>FSpSetFLock<TD>HSetFLock<TD>PBHSetFLock<TD>Lock a file.<TR>
<TD>FSpRstFLock<TD>HRstFLock<TD>PBHRstFLock<TD>Unlock a file.<TR>
<TD>FSpCatMove<TD>CatMove<TD>PBCatMove<TD>Move a file or directory within a volume.<TR>
<TD>FSpRename<TD>HRename<TD>PBHRename<TD>Rename a file or directory.<TR>
<TD>&nbsp;<TD>&nbsp;<TD><CODE>PBGetCatInfo</CODE><TD>Get information about a file or directory.<TR>
<TD>&nbsp;<TD>&nbsp;<TD><CODE>PBSetCatInfo</CODE><TD>Set information about a file or directory.</TABLE>
<P>
<DL>
<DT><B>Note</B>
<DD>You can use the functions listed in <A HREF=Files-77.html#MARKER-9-175>Table 2-2</A> on open files as well, except for those functions that create or delete file forks.<EM></EM><A NAME=MARKER-2-210></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 You can exchange the data in two files using the FSpExchangeFiles and <CODE>PBExchangeFiles</CODE> functions. If you need to create a file system specification record, you can use the FSMakeFSSpec or <CODE>PBMakeFSSpec</CODE> function.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-73.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-75.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
