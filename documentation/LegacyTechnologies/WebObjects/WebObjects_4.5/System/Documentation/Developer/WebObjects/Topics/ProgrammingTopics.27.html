<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Updating with the Adaptor Sublayer</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.26.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.28.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=616620"> </A><A NAME="10154"> </A>Updating with the Adaptor Sublayer</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=616621"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to update a row of the database using the adaptor channel's <TT CLASS="Code">updateValuesInRowDescribedByQualifier</TT> method.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606104"> </A>Description</H2><P CLASS="Body-Text"><A NAME="pgfId=616900"> </A>There are three ways to update a row into the database with the adaptor sublayer. You can update using raw SQL using the adaptor channel's <TT CLASS="Code">evaluateExpression</TT> method, the adaptor channel's <TT CLASS="Code">updateValuesInRowDescribedByQualifier</TT> method, or a stored procedure.</P><P CLASS="Body"><A NAME="pgfId=616901"> </A>In this topic we describe how to update a row using the <TT CLASS="Code">updateValuesInRowDescribedByQualifier</TT> method. This method eliminates the overhead associated with snapshots, uniquing, and fault creation. Furthermore, the source code does not depend on the particular database you use. However, you have to work with raw row dictionaries.</P><P CLASS="Body"><A NAME="pgfId=616970"> </A>If you are working with an editing context and updating using the adaptor sublayer at the same time, EOF does not realize that an object has changed. You need to synchronize any enterprise objects with the changes to the database. </P><P CLASS="Body"><A NAME="pgfId=616906"> </A>To update a row using the adaptor channel's <TT CLASS="Code">updateValuesInRowDescribedByQualifier</TT> method, you need to provide</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=616907"> </A>An EOModel mapping entities to database tables.</LI><LI CLASS="Bulleted"><A NAME="pgfId=616908"> </A>An NSDictionary containing the modifications to the row. The keys are the attribute names not the database column names.</LI><LI CLASS="Bulleted"><A NAME="pgfId=616909"> </A>An adaptor channel that is connected to the database. (See the programming topics <A HREF="ProgrammingTopics.30.html#27044" CLASS="XRef">Accessing Adaptor Sublayer Objects</A>, <A HREF="ProgrammingTopics.31.html#17565" CLASS="XRef">Creating Adaptor Sublayer Objects and Connecting Them to the Server</A>, and <A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A> for more information about getting an adaptor channel.</LI><LI CLASS="Bulleted"><A NAME="pgfId=616919"> </A>The name of the entity that you wish to update, for example, &quot;<TT CLASS="Code">Movie</TT>&quot;.</LI><LI CLASS="Bulleted"><A NAME="pgfId=612963"> </A>An EOQualifier specifying which row to update. See the programming topic <A HREF="ProgrammingTopics.1d.html#21221" CLASS="XRef">Creating EOQualifiers Programmatically</A> for more information about creating qualifiers.</LI></UL><P CLASS="Body"><A NAME="pgfId=606119"> </A>The following code updates a row using the adaptor sublayer.</P><PRE CLASS="Code"><A NAME="pgfId=617030"> </A>EOAdaptorChannel myAdaptorChannel; // assume exists<A NAME="pgfId=616731"> </A>String modelName = &quot;movies&quot;;<A NAME="pgfId=616732"> </A>String entityName = &quot;Movie&quot;;<A NAME="pgfId=617082"> </A><A NAME="pgfId=617090"> </A>NSMutableDictionary dict = new NSMutableDictionary();<A NAME="pgfId=617083"> </A>dict.setObjectForKey (new Integer(95000000),&quot;revenue&quot;);<A NAME="pgfId=617084"> </A><A NAME="pgfId=617085"> </A>EOQualifier myQualifier = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=617086"> </A>    (&quot;title = 'EOF III: The Multithreading'&quot;);<A NAME="pgfId=617087"> </A><A NAME="pgfId=617039"> </A>EOModel myModel = EOModelGroup.defaultGroup().modelNamed(modelName);<A NAME="pgfId=616735"> </A>EOEntity myEntity = myModel.entityNamed(entityName);<A NAME="pgfId=617018"> </A><A NAME="pgfId=616738"> </A>// update row<A NAME="pgfId=616739"> </A>myAdaptorChannel.openChannel();<A NAME="pgfId=616740"> </A>myAdaptorChannel.updateValuesInRowDescribedByQualifier<A NAME="pgfId=617007"> </A>    (dict,myQualifier,myEntity);<A NAME="pgfId=616741"> </A>myAdaptorChannel.closeChannel();	</PRE><P CLASS="Body"><A NAME="pgfId=617009"> </A>The code first allocates and initializes a raw row dictionary for the changed values of the database row and creates the qualifier that identifies the row.</P><P CLASS="Body"><A NAME="pgfId=617078"> </A>The code then finds the EOModel corresponding to the model name in the default model group. The default model group, accessed using <TT CLASS="Code">EOModelGroup.defaultGroup()</TT> is a collection of EOModel objects corresponding to the models in the project's Resources suitcase. If you already have the EOModel, you don't need this step. Next, the code determines the EOEntity corresponding to the given entity name from the EOModel.</P><P CLASS="Body"><A NAME="pgfId=617010"> </A>Before performing updateValuesInRowDescribedByQualifier with the adaptor channel, the code establishes a connection to the database using the <TT CLASS="Code">openChannel</TT> method. The <TT CLASS="Code">closeChannel</TT> method invocation disconnects the channel from the database.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=612665"> </A>Update Failures</H3><P CLASS="Body"><A NAME="pgfId=617055"> </A>The update can fail for the following reasons:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=612667"> </A>	The user logged on to the database does not have permission to update the row.</LI><LI CLASS="Bulleted"><A NAME="pgfId=612668"> </A>The EOAdaptorChannel is in an invalid state, for example, a fetch is in progress. To check if a fetch is in progress, use the adaptor channels <TT CLASS="Code">isFetchInProgress</TT> method</LI><LI CLASS="Bulleted"><A NAME="pgfId=612669"> </A>The updated row fails to satisfy constraints defined in the database, for example, the primary key has been modified with an improper value.</LI></UL></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606147"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606148"> </A><A HREF="ProgrammingTopics.30.html#27044" CLASS="XRef">Accessing Adaptor Sublayer Objects</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616823"> </A><A HREF="ProgrammingTopics.31.html#17565" CLASS="XRef">Creating Adaptor Sublayer Objects and Connecting Them to the Server</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616835"> </A><A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616811"> </A><A HREF="ProgrammingTopics.24.html#36344" CLASS="XRef">Inserting with the Adaptor Sublayer</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606149"> </A><A HREF="ProgrammingTopics.25.html#24751" CLASS="XRef">Deleting with the Adaptor Sublayer</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=612959"> </A><A HREF="ProgrammingTopics.32.html#35319" CLASS="XRef">Executing Arbitrary SQL Statements</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=613855"> </A>EOAdaptor class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=613860"> </A>EOAdaptorContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=613864"> </A>EOAdaptorChannel class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606151"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606152"> </A>	How do I update a row described by a qualifier?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606153"> </A>	How do I update a row using the adaptor sublayer?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606154"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606155"> </A>Update</LI><LI CLASS="Bulleted"><A NAME="pgfId=612673"> </A>Adaptor</LI><LI CLASS="Bulleted"><A NAME="pgfId=612674"> </A>Performance</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606156"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606157"> </A>22 July, 1998. Seejo Pylappan. First Draft.</P><P CLASS="Body"><A NAME="pgfId=616881"> </A>13 November, 1998. Clif Liu. Second Draft.</P><P CLASS="Body"><A NAME="pgfId=616882"> </A>16 March, 1999. Clif Liu. Third Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.26.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.28.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>