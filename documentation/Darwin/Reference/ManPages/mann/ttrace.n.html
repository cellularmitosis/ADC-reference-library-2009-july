<html><head><title>Mac OS X
 Manual Page For ttrace(n)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/n/ttrace" title="Mac OS X
 Manual Page for ttrace(n)"><a name="//apple_ref/doc/man/n/ttrace" title="Mac OS X
 Manual Page for ttrace(n)"><!-- headerDoc=man; indexgroup=Section n; uid="//apple_ref/doc/man/n/ttrace"; name=ttrace(n) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>

ttrace(n)                                                                                          ttrace(n)



____________________________________________________________________________________________________________

<b>NAME</b>
       ttrace - Trace-based interpreter initialization

<b>SYNOPSIS</b>
       package require <b>Tcl</b>  <b>8.3</b>

       package require <b>Thread</b>  <b>?2.6?</b>

       <b>ttrace::eval</b> <u>arg</u> ?arg ...?

       <b>ttrace::enable</b>

       <b>ttrace::disable</b>

       <b>ttrace::cleanup</b>

       <b>ttrace::update</b> ?epoch?

       <b>ttrace::getscript</b>

       <b>ttrace::atenable</b> <u>cmd</u> <u>arglist</u> <u>body</u>

       <b>ttrace::atdisable</b> <u>cmd</u> <u>arglist</u> <u>body</u>

       <b>ttrace::addtrace</b> <u>cmd</u> <u>arglist</u> <u>body</u>

       <b>ttrace::addscript</b> <u>name</u> <u>body</u>

       <b>ttrace::addresolver</b> <u>cmd</u> <u>arglist</u> <u>body</u>

       <b>ttrace::addcleanup</b> <u>body</u>

       <b>ttrace::addentry</b> <u>cmd</u> <u>var</u> <u>val</u>

       <b>ttrace::getentry</b> <u>cmd</u> <u>var</u>

       <b>ttrace::getentries</b> <u>cmd</u> ?pattern?

       <b>ttrace::delentry</b> <u>cmd</u>

       <b>ttrace::preload</b> <u>cmd</u>

____________________________________________________________________________________________________________

<b>DESCRIPTION</b>
       This  package  creates a framework for on-demand replication of the interpreter state accross threads
       in an multithreading application.  It relies on the mechanics of the Tcl <b>unknown</b> command mechanism.

       The package requires Tcl threading extension but can be alternatively  used  stand-alone  within  the
       AOLserver, a scalable webserver from America Online.

<b>USER</b> <b>COMMANDS</b>
       This  section  describes user-level commands. Those commands can be used by script writers to control
       the execution of the tracing framework.

       <b>ttrace::eval</b> <u>arg</u> ?arg ...?
              This command concatenates given arguments and evaluates the resulting Tcl command  with  trace
              framework  enabled. If the command execution was ok, it takes necessary steps to automatically
              propagate the trace epoch change to all threads in the application.  For AOLserver, only newly
              created  threads  actually  receive  the  epoch  change.  For the Tcl threading extension, all
              threads created by the extension are automatically updated. If the command execution  resulted
              in Tcl error, no state propagation takes place.

              This  is the most important user-level command of the package as it wraps most of the commands
              described below. This greatly simplifies things, because user need to learn  just  this  (one)
              command  in  order  to  effectively  use  the  package. Other commands, as desribed below, are
              included mostly for the sake of completeness.

       <b>ttrace::enable</b>
              Activates all registered callbacks in the framework and starts a new trace  epoch.  The  trace
              epoch encapsulates all changes done to the interpreter during the time traces are activated.

       <b>ttrace::disable</b>
              Deactivates all registered callbacks in the framework and closes the current trace epoch.

       <b>ttrace::cleanup</b>
              Used to clean-up all on-demand loaded resources in the interpreter.  It effectively brings Tcl
              interpreter to its pristine state.

       <b>ttrace::update</b> ?epoch?
              Used to refresh the state of the interpreter to match  the  optional  trace  ?epoch?.  If  the
              optional ?epoch? is not given, it takes the most recent trace epoch.

       <b>ttrace::getscript</b>
              Returns  a  synthesized  Tcl script which may be sourced in any interpreter.  This script sets
              the stage for the Tcl <b>unknown</b> command so it can load traced resources from the in-memory data-<font color="#ffffff" class="whiteout">base.&nbsp;database.</font>
              base.  Normally,  this  command  is  automatically invoked by other higher-level commands like
              <b>ttrace::eval</b> and <b>ttrace::update</b>.

<b>CALLBACK</b> <b>COMMANDS</b>
       A word upfront: the package already includes callbacks for  tracing  following  Tcl  commands:  <b>proc</b>,
       <b>namespace</b>, <b>variable</b>, <b>load</b>, and <b>rename</b>. Additionaly, a set of callbacks for tracing resources (object,
       clasess) for the XOTcl v1.1.0+, an OO-extension to Tcl, is also provided.  This gives  a  solid  base
       for  solving most of the real-life needs and serves as an example for people wanting to customize the
       package to cover their specific needs.

       Below, you can find commands for registering callbacks in the  framework  and  for  writing  callback
       scripts.  These  callbacks are invoked by the framework in order to gather interpreter state changes,
       build in-memory database, perform custom-cleanups and various other tasks.

       <b>ttrace::atenable</b> <u>cmd</u> <u>arglist</u> <u>body</u>
              Registers Tcl callback to be activated at <b>ttrace::enable</b>.  Registered callbacks are  activated
              on FIFO basis. The callback definition includes the name of the callback, <u>cmd</u>, a list of call-<font color="#ffffff" class="whiteout">back&nbsp;callback</font>
              back arguments, <u>arglist</u> and the <u>body</u> of the callback. Effectively, this actually resembles the
              call interface of the standard Tcl <b>proc</b> command.

       <b>ttrace::atdisable</b> <u>cmd</u> <u>arglist</u> <u>body</u>
              Registers Tcl callback to be activated at <b>ttrace::disable</b>.  Registered callbacks are activated
              on FIFO basis. The callback definition includes the name of the callback, <u>cmd</u>, a list of call-<font color="#ffffff" class="whiteout">back&nbsp;callback</font>
              back arguments, <u>arglist</u> and the <u>body</u> of the callback. Effectively, this actually resembles the
              call interface of the standard Tcl <b>proc</b> command.

       <b>ttrace::addtrace</b> <u>cmd</u> <u>arglist</u> <u>body</u>
              Registers Tcl callback to be activated for tracing the Tcl <b>cmd</b> command. The  callback  defini-<font color="#ffffff" class="whiteout">tion&nbsp;definition</font>
              tion includes the name of the Tcl command to trace, <u>cmd</u>, a list of callback arguments, <u>arglist</u>
              and the <u>body</u> of the callback. Effectively, this actually resembles the call interface  of  the
              standard Tcl <b>proc</b> command.

       <b>ttrace::addscript</b> <u>name</u> <u>body</u>
              Registers  Tcl callback to be activated for building a Tcl script to be passed to other inter-<font color="#ffffff" class="whiteout">preters.&nbsp;interpreters.</font>
              preters. This script is used to set the stage for the Tcl <b>unknown</b> command.   Registered  call-<font color="#ffffff" class="whiteout">backs&nbsp;callbacks</font>
              backs are activated on FIFO basis.  The callback definition includes the name of the callback,
              <u>name</u> and the <u>body</u> of the callback.

       <b>ttrace::addresolver</b> <u>cmd</u> <u>arglist</u> <u>body</u>
              Registers Tcl callback to be activated by the  overloaded  Tcl  <b>unknown</b>  command.   Registered
              callbacks are activated on FIFO basis.  This callback is used to resolve the resource and load
              the resource in the current interpreter.

       <b>ttrace::addcleanup</b> <u>body</u>
              Registers Tcl callback to be activated by the <b>trace::cleanup</b>.  Registered callbacks are  acti-<font color="#ffffff" class="whiteout">vated&nbsp;activated</font>
              vated on FIFO basis.

       <b>ttrace::addentry</b> <u>cmd</u> <u>var</u> <u>val</u>
              Adds one entry to the named in-memory database.

       <b>ttrace::getentry</b> <u>cmd</u> <u>var</u>
              Returns the value of the entry from the named in-memory database.

       <b>ttrace::getentries</b> <u>cmd</u> ?pattern?
              Returns names of all entries from the named in-memory database.

       <b>ttrace::delentry</b> <u>cmd</u>
              Deletes an entry from the named in-memory database.

       <b>ttrace::preload</b> <u>cmd</u>
              Registers  the Tcl command to be loaded in the interpreter.  Commands registered this way will
              always be the part of the interpreter and not be on-demand loaded by the Tcl <b>unknown</b>  command.

<b>DISCUSSION</b>
       Common  introspective  state-replication approaches use a custom Tcl script to introspect the running
       interpreter and synthesize another Tcl script to replicate this  state  in  some  other  interpreter.
       This package, on the contrary, uses Tcl command traces. Command traces are registered on selected Tcl
       commands, like <b>proc</b>, <b>namespace</b>, <b>load</b> and other standard  (and/or  user-defined)  Tcl  commands.  When
       activated,  those traces build an in-memory database of created resources. This database is used as a
       resource repository for the (overloaded) Tcl <b>unknown</b> command which creates the requested resource  in
       the  interpreter  on  demand.  This way, users can update just one interpreter (master) in one thread
       and replicate that interpreter state (or part of it) to other threads/interpreters in the process.

       Immediate benefit of such approach is the much smaller memory footprint of the application  and  much
       faster  thread  creation.  By  not actually loading all necessary procedures (and other resources) in
       every thread at the thread initialization time, but by deffering this to the  time  the  resource  is
       actually  referenced,  significant  improvements in both memory consumption and thread initialization
       time can be achieved. Some tests have shown that memory footprint of an multithreading  Tcl  applica-<font color="#ffffff" class="whiteout">tion&nbsp;application</font>
       tion  went  down  more  than three times and thread startup time was reduced for about 50 times. Note
       that your mileage may vary.  Other benefits include much finer control about  what  (and  when)  gets
       replicated from the master to other Tcl thread/interpreters.

<b>SEE</b> <b>ALSO</b>
       thread, tpool, tsv

<b>KEYWORDS</b>
       command tracing, introspection



Tcl Threading                                        2.6                                           ttrace(n)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/mann/ttrace.n.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/mann/ttrace.n.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/mann/ttrace.n.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
