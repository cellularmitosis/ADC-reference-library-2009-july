<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>SCSI Async Sample - /Src/SCSIAsyncSample.h</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; <A HREF="javascript:location.replace('index.html');">SCSI Async Sample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxSCSI-date.html" target="_blank">Hardware & Drivers > SCSI</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">SCSI Async Sample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Src/SCSIAsyncSample.h</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Src/AsyncSCSIPresent.c</option>
<option value="listing2.html">/Src/ContinueTesting.c</option>
<option value="listing3.html">/Src/DialogUtilities.c</option>
<option value="listing4.html">/Src/DialogUtilities.h</option>
<option value="listing5.html">/Src/DisplayTestParameters.c</option>
<option value="listing6.html">/Src/DisplayTestResults.c</option>
<option value="listing7.html">/Src/DoSCSISynchronousIO.c</option>
<option value="listing8.html">/Src/GetDevicesToTest.c</option>
<option value="listing9.html">/Src/GetSCSICDBLength.c</option>
<option value="listing10.html">/Src/LogManager.c</option>
<option value="listing11.html">/Src/LogManager.h</option>
<option value="listing12.html">/Src/MicrosecondDelta.c</option>
<option value="listing13.html">/Src/MicrosecondTrap.h</option>
<option value="listing14.html">/Src/MicrosecondTrapPresent.c</option>
<option value="listing15.html">/Src/NewSCSIManagerPresent.c</option>
<option value="listing16.html">/Src/NumericFilter.c</option>
<option value="listing17.html">/Src/scsi.h</option>
<option value="listing18.html">/Src/SCSIAsyncSample.h</option>
<option value="listing19.html">/Src/SCSIAsyncSample.r</option>
<option value="listing20.html">/Src/SCSIAsyncSampleMain.c</option>
<option value="listing21.html">/Src/SCSIBusInquiry.c</option>
<option value="listing22.html">/Src/SCSIDefinitions.h</option>
<option value="listing23.html">/Src/SpinCursor.c</option>
<option value="listing24.html">/Src/StringFormat.c</option>
<option value="listing25.html">/Src/WindowUtilities.c</option></select>
				</p>
				</form>
				<p><strong><a href="SCSI_Async_Sample.zip">Download Sample</a></strong> (&#147;SCSI_Async_Sample.zip&#148;, 105.5K)<BR>
<strong><a href="SCSI_Async_Sample.dmg">Download Sample</a></strong> (&#147;SCSI_Async_Sample.dmg&#148;, 169.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*                SCSIAsyncSample.h                *//* * SCSIAsyncSample.h * Copyright &copy; 1992-93 Apple Computer Inc. All Rights Reserved. */#define kApplicationCreator  '????'#define MBAR_MenuBar    1000#define MENU_Apple      1#define MENU_File      128#define MENU_Edit      129#define STRS_SenseBase    1000#define DLOG_About      128#define DLOG_Query      129#define ALRT_NoNewSCSI    9000#define ALRT_FatalError    9001#define ALRT_NoMemory    9002#define ALRT_NonFatalError  9003#define ACUR_Animator    128#define kMinWindowWidth    200#define kMinWindowHeight  300#define kLogLines      512#define kRequestMemory    100#ifndef REZ#ifndef THINK_C        /* MPW includes      */#include &lt;Errors.h&gt;#include &lt;Script.h&gt;#include &lt;Types.h&gt;#include &lt;Resources.h&gt;#include &lt;QuickDraw.h&gt;#include &lt;Fonts.h&gt;#include &lt;Events.h&gt;#include &lt;Windows.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;Memory.h&gt;#include &lt;Menus.h&gt;#include &lt;Lists.h&gt;#include &lt;Printing.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Packages.h&gt;#include &lt;Controls.h&gt;#endif/* * These definitions are only for the code files. */#ifndef TRUE#define TRUE  1#define FALSE  0#endif#ifndef EXTERN#define EXTERN  extern#endif#include &quot;SCSIDefinitions.h&quot;#include &quot;LogManager.h&quot;#include &quot;MicrosecondTrap.h&quot;/* * Include the O.S. files in a specific order to make sure that we have * a definition for the _SCSIAtomic trap. */#include &lt;Traps.h&gt;#ifndef _SCSIAtomic#define _SCSIAtomic  0xA089#endif/* * Note that this uses a later version of &lt;Scsi.h&gt; than is available in * the published headers. */#include &quot;Scsi.h&quot;#define kScrollBarWidth    16#define kScrollBarOffset  (kScrollBarWidth - 1)/* * Items in the Apple Menu */enum {  kAppleAbout = 1};/* * Items in the File Menu */enum {  kFileCreateLogFile = 1,  kFileCloseLogFile,  kFileUnused1,  kFilePageSetup,  kFilePrint,  kFileUnused2,  kFileDebug,  kFileUnused3,  kFileQuit};enum EditMenu {  kEditUndo        = 1,  kEditUnused,  kEditCut,  kEditCopy,  kEditPaste,  kEditClear};/* * Items in the Query Dialog */enum {  kQueryTest = 1,  kQueryFinished,  kQueryHostBus,  kQueryTargetID,  kQueryTotalRequests,  kQueryBlocksPerTransfer,  kQueryTimeout,  kQueryEnableAsync,  kQueryEnableDisconnect,  kQueryRandomSeek,  kQueryThreadNumber,  kQueryVendorID,  kQueryProduct,  kQueryLogicalBlockLength,  kQueryBlocksOnDevice};typedef struct VMHoldRecord {  void        *ptr;  unsigned long    size;} VMHoldRecord, *VMHoldPtr;enum {  kVMFunction = 0,  kVMStack,  kVMParam,  kVMBuffer,  kVMSense,  kVMSize      /* Must be last */};typedef struct RequestMemory {  unsigned long    blockNumber;  UnsignedWide    startTime;  UnsignedWide    endTime;} RequestMemory, *RequestMemoryPtr;/* * This is the information we need for each execution thread. They are * created by the query dialog loop. These records are stored in * permanent physical memory (HoldMemory) */struct InfoRecord {  struct ScsiCmdBlock  *link;          /* Queue link pointer      */  short        qType;          /* Unused for OSQueue      */  SCSIExecIOPB    *pb;          /* For SCSI Mgr Request      */  unsigned long    pbSize;          /* Sizeof param block      */  Ptr          bufferPtr;        /* -&gt; transfer buffer      */  unsigned long    bufferLength;      /* == allocated length      */  unsigned short    threadIndex;      /* Which thread is it      */  Boolean        deviceActive;      /* TRUE when busy        */  Boolean        testCompleted;      /* TRUE when finished      */  unsigned long    completionTimeout;    /* I/O Timeout          */  unsigned long    transferQuantum;    /* Transfer quantum        */  unsigned long    randomSeed;        /* Random number for seek test  *//* Data from the dialog */  DeviceIdent      deviceIdent;      /* Bus/Target/LUN        */  unsigned long    transferSizeBlocks;    /* Blocks to transfer      */  unsigned long    totalTransfers;      /* Transfers to perform      */  unsigned long    transfersAttempted;    /* Calls to SCSIAction      */  Boolean        enableAsync;      /* Asynch checked?        */  Boolean        enableDisconnect;    /* Disconnect checked?      */  Boolean        enableRandomSeek;    /* Random seek test        *//* Data resulting from Read Capacity */  unsigned long    totalLogicalBlocks;    /* Blocks on device        */  unsigned long    logicalBlockLength;    /* Logical block size      *//* Data resulting from Device Inquiry */  unsigned char    vendor[9];        /* Vendor name (pascal)      */  unsigned char    product[17];      /* Product ID (pascal)      *//* Data changed by/for each transfer request */  OSErr        finalStatus;      /* First detected error      */  SCSI_Command    command;        /* == Current command      */  unsigned long    blockNumber;      /* Read from this block      */  unsigned long    blockCount;        /* Blocks to transfer      */  unsigned long    byteCount;        /* Bytes to transfer      */  unsigned long    nextBlockNumber;    /* Block to start next time    */  unsigned long    transfersCompleted;    /* I/O Completion count      */  unsigned long    asynchRequests;      /* Truely asychronous      */  unsigned char    statusByte;        /* Status Phase byte      */  SCSI_Sense_Data    senseData;        /* Gets Sense data        */  unsigned long    actualTransferCount;  /* TRUE transfer length      *//* VM state (set by DoSCSIExecIO, cleared by command completion) */  VMHoldRecord    vmHoldInfo[kVMSize];/* This is used for the setup dialog */  Boolean        validDevice;/* Statistics */  UnsignedWide    testStartTime;      /* Total testing start time    */  UnsignedWide    testEndTime;      /* Total testing end time    */  double        sampleSum;        /* For mean time (sum in uSec)  */  double        sampleSumSquare;    /* And standard deviation    */  RequestMemoryPtr  requestMemoryPtr;    /* Current request slot      */  RequestMemory    requestMemory[kRequestMemory];};typedef struct InfoRecord InfoRecord, *InfoPtr;/* * Processing functions */void              GetDevicesToTest(void);void              DisplayTestParameters(void);void              DisplayTestResults(void);void              StartTesting(void);void              ContinueTesting(void);pascal Boolean          NumericFilter(    DialogPtr          dp,    EventRecord          *eventPtr,    short            *itemHit  );/* * SCSI Executor */OSErr              DoSCSISynchronousIO(     InfoPtr            infoPtr,    SCSI_CommandPtr        commandPtr,    unsigned long        scsiFlags,    Ptr              bufferPtr,    unsigned long        transferLength  );short              GetSCSICDBLength(    const SCSI_CommandPtr    scsiCommandPtr  );/* * Utility functions */OSErr              CheckForDevicePresent(    unsigned short        busID,    unsigned short        target,    unsigned short        LUN  );Boolean              AsyncSCSIPresent(void);OSErr              GetHostBusCount(    short            *busCount  );void              DoTestUnitReady(    unsigned short        busID,    unsigned short        target,    unsigned short        LUN  );void              ExecuteSCSICommand(    register InfoPtr      infoPtr  );void              IOCompletion(    SCSIExecIOPB        *ioPBPtr  );/* * Display and error logging */void              DisplayDeviceInfo(    register InfoPtr      infoPtr  );void              AppendSCSIBusID(    StringPtr          result,    DeviceIdent          deviceIdent  );void              ShowSCSIBusID(    register InfoPtr      infoPtr  );void              ShowRequestSense(    register InfoPtr      infoPtr  );void              ShowStatusError(    OSErr            errorStatus,    unsigned short        cmdByte  );void              DisplaySCSIErrorMessage(    OSErr            errorStatus,    ConstStr255Param      errorText  );void              NonFatalError(    OSErr            errorStatus,    ConstStr255Param      errorMsg  );void              FatalError(    OSErr            errorStatus,    ConstStr255Param      errorMsg  );/* * String formatting utilities. *//* * AppendChar writes a character into the string. Note that * it wraps around if the string size exceeds 255 bytes. */#define AppendChar(result, c) (result[++result[0]] = (c))void              AppendUnsigned(    StringPtr          result,    unsigned long        value  );void              AppendSigned(    StringPtr          result,    signed long          value  );void              AppendUnsignedLeadingZeros(    StringPtr          result,    unsigned long        value,    short            fieldWidth,    short            terminatorChar  );void            AppendHexLeadingZeros(    StringPtr          result,    unsigned long        value,    short            fieldWidth  );void            AppendUnsignedInField(    StringPtr          result,    unsigned long        value,    short            fieldWidth  );void            AppendBytes(    StringPtr          result,    const Ptr          source,    unsigned short        length  );void            AppendPascalString(    StringPtr          result,    const StringPtr        value  );void            AppendCString(    StringPtr          result,    const char          *source,    unsigned short        maxLength    /* Ignored if zero  */  );void            AppendOSType(    StringPtr          result,    OSType            value  );void            AppendDouble(    StringPtr          result,    double            value,    unsigned short        decimalPlaces  );/* * Window Utilities */void              DoZoomWindow(    WindowPtr          theWindow,    short            whichPart  );Boolean              DoGrowWindow(    WindowPtr          theWindow,    Point            eventWhere,    short            minimumWidth,    short            minimumHeight  );void              MyDrawGrowIcon(    WindowPtr          theWindow  );/* * Format a block of data into the log. */void              DisplayDataBlock(    Ptr              dataPtr,    unsigned short        dataLength  );void              pstrcpy(    StringPtr          destination,    ConstStr255Param      source  );void              pstrcat(    StringPtr          destination,    ConstStr255Param      source  );void              ClearMemory(    Ptr              dataPtr,    unsigned long        dataSize  );#define width(r)    ((r).right - (r).left)#define height(r)    ((r).bottom - (r).top)#define CLEAR(record)  ClearMemory((Ptr) &amp;record, sizeof record);/* * Global variables. */EXTERN WindowPtr        gMainWindow;EXTERN EventRecord        gCurrentEvent;#define EVENT          (gCurrentEvent)EXTERN ListHandle        gLogListHandle;EXTERN THPrint          gPrintHandle;EXTERN Boolean          gQuitNow;EXTERN Boolean          gStopNow;EXTERN Boolean          gUpdateMenusNeeded;EXTERN Boolean          gInForeground;EXTERN Boolean          gVirtualMemoryEnabled;EXTERN MenuHandle        gAppleMenu;EXTERN MenuHandle        gFileMenu;EXTERN MenuHandle        gEditMenu;EXTERN short          gMaxHostBus;EXTERN QHdr            infoPtrQueue;  /* Known execution threads  *//* * VM Stuff */extern void            VMStartMarker(void);extern void            VMEndMarker(void);#define kVMStackSize      4096EXTERN VMHoldRecord        gVMHoldRecord[kVMStack + 1];#endif    /* REZ      */</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/SCSI_Async_Sample/listing18.html%3Fid%3DDTS10000022-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/SCSI_Async_Sample/listing18.html%3Fid%3DDTS10000022-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/SCSI_Async_Sample/listing18.html%3Fid%3DDTS10000022-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>