<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1026: Calling AppleScript from an Application</title><meta name="keywords" content="AppleScript"><meta name="Description" content="Technical Q&amp;A QA1026: This Q&amp;A describes how to call an AppleScriptfrom an application written in C."><meta name="categories" content="AppleScript, Platforms and Tools, Overview and Interapplication Communication"><meta name="week-posted" content="Apr 9, 2001 - Apr 13, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001578" title="Calling AppleScript from an Application"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/ScriptingAutomation/index.html">Scripting & Automation</a> &gt; <a href="../../technicalqas/ScriptingAutomation/idxCarbon-date.html">Carbon</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1026</div>
<div id="pageheadsub">Calling AppleScript from an Application</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      My application is written in C, but I would like to use AppleScripts      to perform some operations.  How can I do this?</p>                  <P id=p4>A:      To run an AppleScript inside of your application, your application      should call the AppleScript component to compile and execute      a script.  The basic steps required to do this are illustrated      in Listing 1.</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>#if TARGET_API_MAC_CARBON#ifdef __APPLE_CC__#include &lt;Carbon/Carbon.h&gt;#else#include &lt;Carbon.h&gt;#endif#else#include &lt;Types.h&gt;#include &lt;OSA.h&gt;#include &lt;AppleScript.h&gt;#endif#include &lt;string.h&gt;    /* LowRunAppleScript compiles and runs an AppleScript    provided as text in the buffer pointed to by text.  textLength    bytes will be compiled from this buffer and run as an AppleScript    using all of the default environment and execution settings.  If    resultData is not NULL, then the result returned by the execution    command will be returned as typeChar in this descriptor record    (or typeNull if there is no result information).  If the function    returns errOSAScriptError, then resultData will be set to a    descriptive error message describing the error (if one is    available).  */static OSStatus LowRunAppleScript(const void* text, long textLength,                                    AEDesc *resultData) {    ComponentInstance theComponent;    AEDesc scriptTextDesc;    OSStatus err;    OSAID scriptID, resultID;        /* set up locals to a known state */    theComponent = NULL;    AECreateDesc(typeNull, NULL, 0, &amp;scriptTextDesc);    scriptID = kOSANullScript;    resultID = kOSANullScript;        /* open the scripting component */    theComponent = OpenDefaultComponent(kOSAComponentType,                    typeAppleScript);    if (theComponent == NULL) { err = paramErr; goto bail; }        /* put the script text into an aedesc */    err = AECreateDesc(typeChar, text, textLength, &amp;scriptTextDesc);    if (err != noErr) goto bail;        /* compile the script */    err = OSACompile(theComponent, &amp;scriptTextDesc,                    kOSAModeNull, &amp;scriptID);    if (err != noErr) goto bail;        /* run the script */    err = OSAExecute(theComponent, scriptID, kOSANullScript,                    kOSAModeNull, &amp;resultID);        /* collect the results - if any */    if (resultData != NULL) {        AECreateDesc(typeNull, NULL, 0, resultData);        if (err == errOSAScriptError) {            OSAScriptError(theComponent, kOSAErrorMessage,                        typeChar, resultData);        } else if (err == noErr &amp;&amp; resultID != kOSANullScript) {            OSADisplay(theComponent, resultID, typeChar,                        kOSAModeNull, resultData);        }    }bail:    AEDisposeDesc(&amp;scriptTextDesc);    if (scriptID != kOSANullScript) OSADispose(theComponent, scriptID);    if (resultID != kOSANullScript) OSADispose(theComponent, resultID);    if (theComponent != NULL) CloseComponent(theComponent);    return err;}    /* SimpleRunAppleScript compiles and runs the AppleScript in    the c-style string provided as a parameter.  The result returned    indicates the success of the operation. */static OSStatus SimpleRunAppleScript(const char* theScript) {    return LowRunAppleScript(theScript, strlen(theScript), NULL);}/* example:   SimpleRunAppleScript(       &quot;tell application \&quot;Finder\&quot;\n&quot;       &quot;  activate\n&quot;       &quot;  select folder \&quot;Documents\&quot; of startup disk\n&quot;       &quot;  open selection\n&quot;       &quot;end tell&quot;);   */</pre></TD></TR><TR><td align="left"><P><B>Listing 1</B>. Example illustrating how to call an AppleScript from C.</P></TD></TR></TABLE></CENTER><BR><BR><P id=p4>Applications that require more specialized control over the      script compilation and execution process, such as, for example,      caching precompiled scripts, can use other routines defined      in OSA.h.  To use these routines, applications must link with      either CarbonLib or AppleScriptLib.</p>          <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>This Q&amp;A illustrates a simple way to run AppleScripts inside ofyour application.  Developers concerned about speed, will want toconsider using precomiled scripts and opening the scripting componentonly once when they are initializing their application.  For moreinformation about these techniques, consult the AppleScript documentation.</P></TD></TR></TABLE></CENTER><BR><BR>   <H2>Downloadables</H2>                <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">           <TR>              <td width=50 align=left>                 <P ALIGN=center>                 qa1026.hqx                 </P>              </TD>              <td align="left">                 <P>C source files used for code listing (8K)</P>              </TD>              <td width=60 align=left>                 <P><A HREF="downloads/qa1026.hqx">Download</A></P>              </TD>           </TR>        </TABLE>        <BR><hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Apr 11 2001]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1026.html%3Fid%3DDTS10001578-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1026.html%3Fid%3DDTS10001578-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1026.html%3Fid%3DDTS10001578-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>