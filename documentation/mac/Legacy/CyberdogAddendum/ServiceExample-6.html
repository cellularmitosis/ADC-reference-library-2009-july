<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Implementing Your Cyberdog Panel Parts</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING6></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ServiceExample-5.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ServiceExample-1.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ServiceExample-7.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ServiceExample-7.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html"><B>Inside Macintosh:</B></A>  / <BR><DD><A HREF="ServiceExample-1.html"><B> Creating a Cyberdog Service</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING6-0></A>
<H1>Implementing Your Cyberdog Panel Parts</H1>
 You can associate a Connect To and a Preferences panel with your Cyberdog service. The Connect To panel is an OpenDoc part that is associated with a <CODE>CyberConnectExtension</CODE> object. A Preferences panel is an OpenDoc part that is associated with a <CODE>CyberPreferencesExtension</CODE> object. You implement these parts and extensions just as you implement a Cyberdog display part. See Chapter 4, "Creating a Cyberdog Display Part," in <I>Cyberdog Programmer's Kit</I> for information about implementing display parts and part extensions. The following sections show you the additional steps that you must take to implement these panels.<P>
<A NAME=HEADING6-2></A>
<H2><A NAME=MARKER-9-92></A>Creating the Connect To Panel</H2>
 <A NAME=MARKER-2-93></A>To create a Connect To panel, you must implement the OpenDoc extension protocol in the part that displays your Connect To panel (see "Creating a Cyberdog Display Part"), override the extension's <CODE>CreateCyberItem</CODE> method, and set up the part's name-mapping (<CODE>'nmap'</CODE>) resource. <P>
 You override the extension's <A NAME=MARKER-2-94></A><CODE>CreateCyberItem</CODE> method to create your Cyberdog item using the fields in the Connect To panel. <A HREF=#MARKER-9-95>Listing 29</A> shows the Connect To extension's <CODE>CreateCyberItem</CODE> method for the Finger service.<P>
<B>Listing 29  <A NAME=MARKER-9-95></A>The Connect To extension's <CODE>CreateCyberItem</CODE> method for the Finger service </B><P>
<PRE>
CyberItem* FSConnect::CreateCyberItem(Environment* ev)
{
   CyberItem* ci = nil;
   
   if (fHostTE)
   {
      Str255 Str, uStr, url;
      
      // Convert the text to pascal strings; truncate if necessary.
      GetDialogItemText((Handle)TEGetText(fHostTE), hStr);
      GetDialogItemText((Handle)TEGetText(fUserTE), uStr);
      
      // Concatenate the strings into Finger format.
      MakeFingerURL(uStr, hStr, url);
            
      // Create the Cyberdog item.
      ci = GetCyberSession(ev)-&gt;CreateCyberItemFromURL(ev, (char*)url);
   }
   return ci;
}
</PRE>
 Your panel part's <A NAME=MARKER-2-96></A>name-mapping (<CODE>'nmap'</CODE>) resource specifies the panel's ID and kind. The service uses the part's kind to locate the panel that matches the panel specified in the service resource. See <A HREF=ServiceExample-3.html#MARKER-9-12>"Defining Your Cyberdog Service Resource" (page 6)</A> for information about the service resource. <A HREF=#MARKER-9-97>Listing 30</A> shows the name-mapping resource for the Connect To panel associated with the Finger service. The panel's ID is kFSConnectID, and its kind is kFingerConnectPanelKind. <P>
<B>Listing 30  <A NAME=MARKER-9-97></A>The Connect To panel's resource for the Finger service</B><P>
<PRE>
resource kODNameMappings (kEditorKindMapId) {
   kODEditorKinds,
   {  /* array Types: 2 elements */
      /* [1] */
      kFSConnectID,
      kODIsAnISOStringList
      {
         {  /* array ClassIDs: 1 element */
            /* [4] */
            kFingerConnectPanelKind
         }
      }
   }
};
</PRE>
<A NAME=HEADING6-10></A>
<H2><A NAME=MARKER-9-98></A>Creating the Preferences Panel</H2>
 <A NAME=MARKER-2-99></A>To create a Preferences panel, you must implement the OpenDoc extension protocol in the part that displays your Preferences panel and set up the part's name-mapping (<CODE>'nmap'</CODE>) resource. These are same tasks you perform to create a Connect To panel, except that you associate your panel's display part with a <CODE>CyberPreferencesExtension</CODE> object. <P>
 Typically, you store preferences in the <A NAME=MARKER-2-100></A>Internet Config file. To handle reading and writing to Internet Config, you must override the <A NAME=MARKER-2-101></A><CODE>InternalizeIC</CODE> and <A NAME=MARKER-2-102></A><CODE>ExternalizeIC</CODE> methods, respectively, of your preferences extension. The <CODE>InternalizeIC</CODE> method is called to retrieve preferences when the extension is created. The <CODE>ExternalizeIC</CODE> method is called to save preferences when the extension is removed.<P>
 The Preferences panel part for the Finger service uses Internet Config to store preferences. The <CODE>InternalizeIC</CODE> and <CODE>ExternalizeIC</CODE> methods of the preferences extension pass control to methods of the same name in the panel part. <A HREF=#MARKER-9-103>Listing 31</A> shows the panel part's <CODE>InternalizeIC</CODE> method, which reads the preference associated with kFingerOpenAsyncPref from Internet Config.<P>
<B>Listing 31  <A NAME=MARKER-9-103></A>The <CODE>InternalizeIC</CODE> method of the Preferences panel part</B><P>
<PRE>
void FSPrefs::InternalizeIC(Environment* ev, ICInstance inst)
{
   ICError  err;
   ICAttr   icAttr;
   long     size;
   Boolean  checkValue;
   
   do
   {
      err = ICBegin(inst, icReadOnlyPerm);
      if (err != noErr)
         break;
         
      // Use the Open Asynch checkbox.
      size = sizeof(ODBoolean);
      err = ICGetPref (inst, kFingerOpenAsyncPref, 
                           &amp;icAttr, (Ptr)&amp;checkValue, &amp;size);
      if (err == noErr)
         fCheckBoxOn = checkValue;
      else if (err != icPrefNotFoundErr)
         break;
   } while (0);

   err = ICEnd(inst);
   if (err != noErr)
      DebugStr(&quot;\p InternalizeIC error&quot;);
}
</PRE>
 <A HREF=#MARKER-9-104>Listing 32</A> shows the panel part's <CODE>ExternalizeIC</CODE> method, which writes the preference associated with kFingerOpenAsyncPref from Internet Config.<P>
<B>Listing 32  <A NAME=MARKER-9-104></A>The <CODE>ExternalizeIC</CODE> method of the Preferences panel part</B><P>
<PRE>
void FSPrefs::ExternalizeIC(Environment* ev, ICInstance inst)
{
   ICError  err;
   Boolean  checkValue;

   do 
   {
      err = ICBegin(inst, icReadWritePerm);
      if (err != noErr)
         break;

      // Use the Open Asynch checkbox.
      checkValue = fCheckBoxOn;
      err = ICSetPref(inst, kFingerOpenAsyncPref, 
            ICattr_no_change, (Ptr)&amp;checkValue, sizeof(ODBoolean));
      if (err != noErr)
         break;   
      } while (0);
      
   err = ICEnd(inst);
   if (err != noErr)
      DebugStr(&quot;\p ExternalizeIC error&quot;);
}
</PRE>
 The constants kFingerCreator and <CODE>kFingerOpenAsyncPref</CODE> are defined as follows:<P>
<PRE>
#define kFingerCreator  'FNGR'
#define kFingerOpenAsyncPref&quot;\p464E4752OpenAsync&quot;/* ODBoolean */
</PRE>
 The <CODE>464E4752</CODE> in the definition for <CODE>kFingerOpenAsyncPref</CODE> is the hexadecimal representation of <CODE>'FNGR'</CODE>. All keys in Internet Config that are not defined in <CODE>ICKeys.h</CODE> should begin with the hexadecimal representation (four hexadecimal digits) of the creator type. <EM></EM><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="ServiceExample-5.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ServiceExample-1.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ServiceExample-7.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ServiceExample-7.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<P>
<FONT SIZE="-1">
<center><font size=-1><A HREF="ServiceExample-1A.html">&copy; Apple Computer, Inc.</A><br>1 JUNE 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
