<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><!--Includes revisions to code listings--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note DV02: _AddDrive, _DrvrInstall, and _DrvrRemove</title><meta name="keywords" content="Mac OS 8 SCSI _AddDrive _DrvrInstall _DrvrRemove glue"><meta name="Description" content="Technical Note DV02: This Technical Note documents the parametersof the calls _AddDrive, _DrvrInstall, and _DrvrRemove whichwere used in the sample SCSI driver in SCSI development.It includes the contents of the A0 and D0 registers for eachof these calls, and glue code that was omitted from the MPWinterfaces for _DrvrInstall and _DrvrRemove.">                                                                            <meta name="categories" content="Devices"><meta name="week-posted" content="Feb 23, 1987 - Mar 6, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002392" title="_AddDrive, _DrvrInstall, and _DrvrRemove"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/idxSCSI-date.html" target="_blank">Hardware & Drivers > SCSI</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note DV02</div>
<div id="pageheadsub">_AddDrive, _DrvrInstall, and _DrvrRemove</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc --><p id="menutext"><a href="#Section1">_AddDrive</a><BR><BR><a href="#Section2">_DrvrInstall</a><BR><BR><a href="#Section3">_DrvrRemove</a><BR><BR><a href="#Section4">Interfaces</a><BR><BR><a href="#Changes">Change History</a><BR><BR>					<A HREF="#downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>		<td width=300 valign="top" align=left>	<!-- begin_intro_text --><P id = "introtext"><code>_AddDrive</code>, <code>_DrvrInstall</code>, and <code>_DrvrRemove</code> are used in the sample SCSI driver in the SCSI Development Package. This Technical Note documents the parameters for these calls.</p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [March 1987]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><a name="Section1"></a><h2>_AddDrive</h2><p><code>_AddDrive</code> adds a drive to the drive queue, and is discussed in more detailin Technical Note #36, <u><A HREF = "dv_05.html">Drive Queue Elements:</a></u></p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        FUNCTION AddDrive(DQE:DrvQE1;driveNum,refNum:INTEGER):OSErr;                A0 (input)              -&gt;     pointer to DQE               D0 high word(input)       -&gt;     drive number               D0 low word(input)        -&gt;     driver RefNum               D0 (output)             &lt;-      error code                                     noErr (always returned)</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>_DrvrInstall</h2><p><code>_DrvrInstall</code> is used to install a driver.  A <code>DCE</code> for the driveris created and its handle entered into the specified Unit Table position (-1 through -64). If the unit number is -4 through -9, the corresponding ROM-based driver will be replaced:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        FUNCTION DrvrInstall(drvrHandle:Handle; refNum: INTEGER): OSErr;               A0 (input)        -&gt;    pointer to driver               D0 (input)        -&gt;    driver RefNum (-1 through -64)               D0 (output)       &lt;-    error code                                     noErr                                     badUnitErr</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>_DrvrRemove</h2><p><code>_DrvrRemove</code> is used to remove a driver.  A RAM-based driver is purged fromthe system heap (using <code>_ReleaseResource</code>).  Memory for the <code>DCE</code> is disposed:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        FUNCTION DrvrRemove(refNum: INTEGER):OSErr;               D0 (input)        -&gt;    Driver RefNum               D0 (output)       &lt;-    error code                                    noErr                                    qErr</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>Interfaces</h2><p>Through a sequence of cataclysmic events, the glue code for <code>_DrvrInstall</code> and <code>_DrvrRemove</code> was never actually added to the MPW interfaces (i.e., "We forgot."), so we will include simple glue here at no extra expense to you.</p><p>It would be advisable to first lock the handle to your driver with <code>_HLock</code> before making either of these calls since memory may be moved.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>       ;---------------------------------------------------------------       ; FUNCTION DRVRInstall(drvrHandle:Handle; refNum:INTEGER):OSErr;       ;---------------------------------------------------------------       DRVRInstall      PROC    EXPORT              MOVEA.L           (SP)+, A1    ; pop return address              MOVE.W              (SP)+, D0    ; driver reference number              MOVEA.L           (SP)+, A0    ; handle to driver              MOVEA.L           (A0), A0     ; pointer to driver              _DrvrInstall                   ; $A03D              MOVE.W            D0, (SP)     ; get error              JMP               (A1)         ; &amp; split              ENDPPROC       ;---------------------------------------------------------------       ; FUNCTION DRVRRemove(refNum:INTEGER):OSErr;       ;---------------------------------------------------------------       DRVRRemove      PROC    EXPORT              MOVEA.L          (SP)+, A1    ; pop return address              MOVE.W           (SP)+, D0    ; driver reference number              _DrvrRemove                   ; $A03E              MOVE.W           D0, (SP)     ; get error              JMP              (A1)         ; &amp; split              ENDPPROC</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Changes"></a><h2>Change History</h2><TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-March-1987</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>             <TR>               <td width=100 align=left>                  <P ALIGN=center>01-March-1988</P>               </TD>               <td align="left">                  <P>Updated the <code>_DrvrInstall</code> text toreflect the use of register <code>A0</code>, which should contain a pointer to thedriver when called.  Also added simple glue code for <code>_DrvrInstall</code> and<code>_DrvrRemove</code> since none is available in the MPW interfaces.</P>               </TD>            </TR></table><P><A HREF="#top">Back to top</A></P>         <a name="downloads"></a>         <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center>                                    <img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/dv_02.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/dv/dv_02.html%3Fid%3DDTS10002392-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/dv/dv_02.html%3Fid%3DDTS10002392-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/dv/dv_02.html%3Fid%3DDTS10002392-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML>