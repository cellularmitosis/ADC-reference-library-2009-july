<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="Resource Partial ReadPartialResource WritePartialResource"><meta name="Description" content="Technical Note TB40: This Technical Note corrects and clarifies Inside Macintosh: More Macintosh Toolbox for the ReadPartialResourceand WritePartialResource calls."><title>Technical Note TB40: Partial Resource Myths and Legends</title>                                       <meta name="categories" content="Human Interface Toolbox"><meta name="week-posted" content="Mar 28, 1994 - Apr 1, 1994"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002791" title="Partial Resource Myths and Legends"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTools-date.html">Tools</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Java/idxTools-date.html" target="_blank">Reference Library > Tools</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TB40</div>
<div id="pageheadsub">Partial Resource Myths and Legends</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Three Bogus Error Codes</A><BR><BR><A HREF="#Section2">Replacement Partial Resource Documentation</A><BR><BR><A HREF="#Section3">Reading and Writing Partial Resources</A><BR><BR><A HREF="#Section4">ReadPartialResource</A><BR><BR><A HREF="#Section4">WritePartialResource</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note corrects and clarifies <i>Inside Macintosh: More MacintoshToolbox</i> for the <code>ReadPartialResource</code> and<code>WritePartialResource</code> calls.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1994]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Three Bogus Error Codes</h2><P>The documentation for reading and writing partial resources is incorrect inthree important ways--it states that the Resource Manager returns error codesto protect you against bad inputs, when it does no such thing.  Three of theerrors described in Resource Manager documentation are completely erroneous andare never returned by Resource Manager routines.  Those codes are:</p><ol type="1" start="1">	<li><code>inputOutOfBounds</code> does not exist</li></ol><P><i>Inside Macintosh: More Macintosh Toolbox</i>  states that the<code>ReadPartialResource</code> and <code>WritePartialResource</code> calls check your<code>count</code> and <code>offset</code> input parameters and return<code>inputOutOfBounds</code> if they are out of range. This is not true; the onlycheck on your input parameters is the verification of your resource handle. Theresult code <code>inputOutOfBounds</code> is completely erroneous and is notreturned by any Resource Manager call.</p><ol type="1" start="2">	<li><code>resourceInMemory</code> is never returned</li></ol><P>The documentation also indicates that the Resource Manager returns the code<code>resourceInMemory</code> if the resource handle is not empty.  This too isfalse; the only test performed on your resource handle is whether it is in thecurrent map chain. The result code <code>resourceInMemory</code> is completelyerroneous and is not returned by any Resource Manager call.</p><ol type="1" start="3">	<li><code>writingPastEnd</code> is a figment of our imagination</li></ol><P>In the case of <code>WritePartialResource</code>, if the combination of the<code>offset</code> and the <code>count</code> would extend the write request past theend of the resource on disk, the documentation indicates that the routineenlarges the resource and returns the result code <code>writingPastEnd</code>. Thisis not true; it does not automatically resize the resource and blindlyoverwrites any data in the following resource.  If it is your intent to enlargethe resource, you must call <code>SetResourceSize</code> prior to the write. Theresult code <code>writingPastEnd</code> is completely erroneous and is not returnedby any Resource Manager call.</p><P><A HREF="#top">Back to top</A></p><a name="Section2"></a><h2>Replacement Partial Resource Documentation</h2><P>The correct text documenting these two routines follows.  This supersedes allcurrent documentation concerning partial resources, including: <i>InsideMacintosh, Volume VI</i>, pages 13-16-17, 13-21-23; and <i>Inside Macintosh:More Macintosh Toolbox</i>, pages 1-111-115.</p><P><A HREF="#top">Back to top</A></p><a name="Section3"></a><h2>Reading and Writing Partial Resources</h2><P>You can use the <code>ReadPartialResource</code>, <code>WritePartialResource</code>,and <code>SetResourceSize</code> procedures to work with a portion of a largeresource that may not otherwise fit in memory.</p><p>When using partial resource routines, you should call the <code>SetResLoad</code>procedure, specifying <code>FALSE</code> for the load parameter, before you call<code>GetResource</code>. Using the <code>SetResLoad</code> procedure prevents theResource Manager from reading the entire resource into memory. Be sure torestore the normal state by calling <code>SetResLoad</code> again, with the loadparameter set to <code>TRUE</code>, immediately after you call<code>GetResource</code>. Then use <code>ReadPartialResource</code> to read a portionof the resource into a buffer and <code>WritePartialResource</code> as needed towrite a portion of the resource from a buffer to disk.</p><p>Note that the partial resources routines work with the data in the memorypointed to by the <code>buffer</code> parameter, not the memory referenced throughthe resource's handle. Therefore, you may experience problems if you have acopy of a resource in memory when you are using the partial resource routines.If you have modified the copy in memory and then access the resource on diskusing the <code>ReadPartialResource</code> procedure, <code>ReadPartialResource</code>reads the data on disk, not the data in memory, which is referenced through theresource's handle. Similarly, <code>WritePartialResource</code> writes data fromthe specified buffer, not from the data in memory, which is referenced throughthe resource's handle.</p><p>The partial resources routines do not decompress Apple's compressed resourceformat.  It is not really possible to decompress part of a resource, since thecurrent decompression method requires the entire resource to be in memory forthe conversion to occur. Therefore, the partial resources routines should notbe used when the data is in Apple's proprietary format. You can determine if aresource is compressed by examining bit 0 of the resource's attributes. If thisbit is clear, the resource is not compressed and it is safe to use thesepartial resources routines.</p><P><A HREF="#top">Back to top</A></p><a name="Section4"></a><h2>ReadPartialResource</h2><P>You can use the <code>ReadPartialResource</code> procedure to read part of aresource into memory and work with a small subsection of a large resource.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE ReadPartialResource (theResource: Handle;                             offset: LongInt; buffer: UNIV Ptr;</pre>	</TD></TR></TABLE></CENTER><table>	<tr>		<td align="left" scope="row"><code>theResource</code></td> <td align="left">A handle to a resource.</td>	</tr>	<tr>		<td align="left" scope="row"></td>	</tr>	<tr>		<td align="left" scope="row"><code>offset</code></td> <td align="left">The beginning of the resource subsection to be read, measured in bytes from the beginning of the resource.</td>	</tr>	<tr>		<td align="left" scope="row"></td>	</tr>	<tr>		<td align="left" scope="row"><code>buffer</code></td> <td align="left">A pointer to the buffer into which the partial resource is to be read.</td>	</tr>	<tr>		<td align="left" scope="row"><code>count</code></td> <td align="left">The length of the resource subsection.</td>	</tr></table><h3>Description</h3><p>The <code>ReadPartialResource</code> procedure reads the resource subsectionidentified by the <code>theResource</code>, <code>offset</code>, and <code>count</code>parameters into a buffer specified by the <code>buffer</code> parameter. Yourapplication is responsible for the buffer's memory management. You cannot usethe <code>ReleaseResource</code> procedure to release the memory the bufferoccupies.</p><p>The <code>ReadPartialResource</code> procedure always tries to read resources fromdisk. If the handle in the parameter <code>theResource</code> doesn't refer to aresource in an open resource fork, <code>ResError</code> returns the result code<code>resNotFound</code>.</p><p>When using partial resource routines, you should call the <code>SetResLoad</code>procedure, specifying <code>FALSE</code> for the load parameter, before you call<code>GetResource</code>. Using the <code>SetResLoad</code> procedure prevents theResource Manager from reading the entire resource into memory. Be sure torestore the normal state by calling <code>SetResLoad</code> again, with the loadparameter set to <code>TRUE</code>, immediately after you call<code>GetResource</code>. Then use <code>ReadPartialResource</code> to read a portionof the resource into a buffer.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>If the entire resource is in memory and you want only part of itsdata, it's faster to use the Memory Manager procedure <code>BlockMove</code>instead of the <code>ReadPartialResource</code> procedure. If you read a partialresource into memory and then change its size, you can use<code>SetResourceSize</code> to change the entire resource's size on disk asnecessary.</P></TD></TR></TABLE></CENTER><BR><h3>Special Considerations</h3>The <code>ReadPartialResource</code> procedure may move or purge memory blocks inthe application heap. Your application should not call this procedure atinterrupt time.<h3>Assembly-Language Information</h3><p>The trap macro and routine selector for <code>ReadPartialResource</code> are:</p><table>	<tr>		<td align="left" scope="row">Trap macro</td> <td align="left">Selector</td>	</tr>	<tr>		<td align="left" scope="row"><code>_ResourceDispatch</code></td> <td align="left">$7001</td>	</tr></table><table>	<tr>		<td align="left" scope="row">Result Codes</td> <td align="left"></td> <td align="left"></td>	</tr>	<tr>		<td align="left" scope="row">noErr</td> <td align="left">0</td> <td align="left">No error</td>	</tr>	<tr>		<td align="left" scope="row"><code>resNotFound</code></td> <td align="left">-192</td> <td align="left">Resource not found</td>	</tr></table><P><A HREF="#top">Back to top</A></p><a name="Section5"></a><h2>WritePartialResource</h2><P>You can use the <code>WritePartialResource</code> procedure to write part of aresource to disk when working with a small subsection of a large resource.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE WritePartialResource (theResource: Handle;                              offset: LongInt; buffer: UNIV Ptr;</pre>	</TD></TR></TABLE></CENTER><table>	<tr>		<td align="left" scope="row"><code>theResource</code></td> <td align="left">A handle to a resource.</td>	</tr>	<tr>		<td align="left" scope="row"><code>offset</code></td> <td align="left">The beginning of the resource subsection to write, measured in bytes from the beginning of the resource.</td>	</tr>	<tr>		<td align="left" scope="row"><code>buffer</code></td> <td align="left">A pointer to the buffer containing the data to write.</td>	</tr>	<tr>		<td align="left" scope="row"><code>count</code></td> <td align="left">The length of the resource subsection to write.</td>	</tr></table><h3>Description</h3><P>The <code>WritePartialResource</code> procedure writes the data specified by the<code>buffer</code> parameter to the resource subsection identified by the<code>theResource</code>, <code>offset</code>, and <code>count</code> parameters. Yourapplication is responsible for the buffer's memory management.</p><p>If the disk or the file is locked, the <code>ResError</code> function returns anappropriate File Manager result code.</p><p>The <code>WritePartialResource</code> procedure tries to write the data from thebuffer to disk. If the attempt is successful and the resource data (referencedthrough the resource's handle) is in memory, be aware that the data of theresource subsection on disk matches the data from the buffer, not the resourcedata referenced through the resource's handle. If the attempt to write the datafrom the buffer to the disk fails, <code>ResError</code> returns an appropriateerror.</p><p>If the handle in the parameter <code>theResource</code> does not refer to aresource in an open resource fork, <code>ResError</code> returns the result code<code>resNotFound</code>.</p><p>The <code>WritePartialResource</code> procedure checks that the information in theresource map is internally consistent. If it isn't, the <code>ResError</code>function returns the result code <code>mapReadErr</code>.</p><p>When using partial resource routines, you should call the <code>SetResLoad</code>procedure, specifying <code>FALSE</code> for the load parameter, before you call<code>GetResource</code>. Doing so prevents the Resource Manager from reading theentire resource into memory. Be sure to restore the normal state by calling<code>SetResLoad</code> again, with the load parameter set to <code>TRUE</code>,immediately after you call <code>GetResource</code>.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>If you read a partial resource into memory and then change itssize, you must use <code>SetResourceSize</code> to change the entire resource'ssize on disk as necessary before you write the partial resource.</P></TD></TR></TABLE></CENTER><BR><h3>Special Considerations</h3>The <code>WritePartialResource</code> procedure may move or purge memory blocks inthe application heap. Your application should not call this procedure atinterrupt time.<h3>Assembly-Language Information</h3><p>The trap macro and routine selector for <code>WritePartialResource</code> are:</p><table>	<tr>		<td align="left" scope="row">Trap macro</td> <td align="left"><code>Selector_ResourceDispatch</code></td> <td align="left">$7002</td>	</tr></table><h3>Result Codes</h3><table>	<tr>		<td align="left" scope="row">noErr</td><td align="left">0        </td>	</tr>	<tr>		<td align="left" scope="row">No errordskFulErr</td><td align="left">-34        </td>	</tr>	<tr>		<td align="left" scope="row">Disk fullresNotFound</td><td align="left">-192        </td>	</tr>	<tr>		<td align="left" scope="row">Resource not foundmapReadErr</td><td align="left">-199        </td>	</tr>	<tr>		<td align="left" scope="row">Map inconsistent with operation</td> <td align="left"></td>	</tr></table><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P><i>Inside Macintosh: More Macintosh Toolbox</i></p><P>Technical Note TB 555- <A HREF = "tb_555.html">Resource Manager Q&amp;As </a></p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tb_40.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tb/tb_40.html%3Fid%3DDTS10002791-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tb/tb_40.html%3Fid%3DDTS10002791-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tb/tb_40.html%3Fid%3DDTS10002791-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>