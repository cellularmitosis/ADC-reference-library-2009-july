<HTML><HEAD>   <title>Technical Q&amp;A QA1099: Reducing the size of Physical Memory in Open Firmware</title>				<LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css">	<LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">	<meta name="keywords" content="Open Firmware, maxmem">	<meta name="Description" content="Technical Q&amp;A QA1099: limiting physical memory without havingto remove memory"><meta name="categories" content="Hardware"><meta name="week-posted" content="Dec 17, 2001 - Dec 21, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR=white><a name="//apple_ref/doc/uid/DTS10001647" title="Reducing the size of Physical Memory in Open Firmware"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/HardwareDrivers/index.html">Hardware & Drivers</a> &gt; <a href="../../technicalqas/HardwareDrivers/idxAppleHardware-date.html">Apple Hardware</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1099</div>
<div id="pageheadsub">Reducing the size of Physical Memory in Open Firmware</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <P><!-- begin_content -->                  <hr width=500 align=center>                  </P>                  <P id=p2>Q: Can I configure the Power Macintosh system so         that the system thinks that there is less physical memory         present than there actually is without having to open the         system to remove memory sticks.</P>                  <P id=p4>A: For all Power Macintosh systems with Open         Firmware, you can implement settings to make the system         believe that there is less physical memory than is actually         present. This is useful for testing purposes when you don't         want to have to physically remove RAM such as on the earlier         iMacs or PowerBooks which require disassembly. The simplest         method is supported by Mac OS X only. Under Mac OS X, you         can use the Terminal application to enter the nvram command         and reboot the system. There are additional methods which         work within the Open Firmware environment.</P>                  <BR><BR>                  <h2>Using Terminal to Set the Physical Memory Size for Mac OS X</h2>                  <P id=p4>The following instructions works for Mac OS X only.         You must have root privileges in order to make this change.         You will use the Terminal application to issue the nvram         command to set the "boot-arg" environment variable. Follow         these steps.</P>                  <P id=p4>Step 1. Launch the Terminal application. The         Terminal application is found at <CODE>/Applications/Utilities/Terminal</CODE></P>                  <P id=p4>Step 2. Enter the following command</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         % sudo nvram boot-args="maxmem=64"</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Step 3. Restart the system</P>                  <P id=p4>The above commands implements the <CODE>"maxmem"</CODE>         setting into nonvolatile RAM. This means that the setting is         persistent across system restarts. If you had previous set         <CODE>boot-args</CODE> to a different value,         then the original value will be lost to be replaced by the         <CODE>"maxmem"</CODE> setting. If you decide         to change the setting before restarting, a subsequent         setting will overwrite a preceding setting. If you misspell         "<CODE>boot-args</CODE>" , there is no         warning, a (probably useless) new entry into NVRAM is made,         and the RAM use will be unchanged after restart.</P>                  <P id=p4>An important caveat - the "desired memory size"         must be a multiple of 2. If you specify an odd setting of         65, 129, etc, your system may hang during the boot process.         If this happens, you will need to "zap PRAM" as described in         the next section "<A HREF="#ClearMaxmem">Clearing the         "maxmem" Setting</A>".</P>                  <P id=p4>Note that you can also implement the <CODE>boot-args</CODE>         setting within Open Firmware. This option is discussed at         the end of this Q&amp;A under the section "<A HREF="#SetSizeMacXInOF">Setting         the Physical Memory Size for Mac OS X using "maxmem" in Open         Firmware</A>".</P>                  <BR><BR>         <A NAME=ClearMaxmem></A>                  <h2>Clearing the "maxmem" Setting</h2>                  <P id=p4>The <CODE>maxmem </CODE>setting is         set in NVRAM and will affect all system restarts, unless the         setting is changed or cleared. Use the instructions above to         set <CODE>"maxmem"</CODE> to a different         value. To clear the <CODE>maxmem</CODE>         setting, there are three options.</P>                  <P id=p4>1. Use the Terminal application to clear the         <CODE>boot-args</CODE> setting. For example,         you could enter the following command within the Terminal         application</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         % sudo nvram boot-args=""</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>This command sequence clears the value of         <CODE>boot-args</CODE>.</P>                  <P id=p4>2. You can clear <CODE>boot-args         </CODE>by "zapping PRAM". Restart the system and hold down         the "Command-Option-P-R" keys until you hear the start beep         a second time. Release the keys and the system will restart         normally with all memory recognized. Keep in mind that         resetting PRAM has the effect of clearing all custom NVRAM         settings.</P>                  <P id=p4>3. Finally, you can clear the <CODE>"maxmem"         </CODE>setting using the Startup Disk Preference Panel to         switch startup to a different disk or to Mac OS 9. This         clears the <CODE>boot-args</CODE>         "<CODE>maxmem</CODE>" setting and is similar         to using the Terminal application to clear this setting.</P>                  <BR><BR>                  <h2>Setting the Physical Memory Size         for Mac OS 8/9 and Mac OS X Under Open         Firmware</h2>                  <P id=p4>The following method works for system starts into         both Mac OS 8/9 and Mac OS X. To have less physical RAM         recognized, you need to delete the existing "reg" property         in the memory node and create a replacement property with         less memory specified. Follow these instructions.</P>                  <P id=p4>Step 1. Enter Open Firmware.<BR>         Restart the system and hold the "Command-Option-O-F" keys         down until the Open Firmware screen is displayed.</P>                  <P id=p4>Step 2. Set the current directory to the memory         node.<BR>         Enter the following at the Open Firmware prompt.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         dev /memory</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Step 3. Display the contents of the memory         node.<BR>         Enter the following command.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         .properties</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Remember to include the period character at the         beginning of the command. The following are the memory node         properties for a PowerBook G3 (FireWire) with a 32M SODIMM         in the lower slot and a 128M SODIMM in the upper slot.</P>                     <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>name memorydevice_type memoryreg &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00000000 08000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;08000000 02000000slot-names &nbsp;00000003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SODIMM0/J2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SODIMM1/J1available   00003000 09bfd000dimm-info   8008040c 09024000 01a06000 80100001 8f040601 01000ec0 70000014 14143210            20102010 00000000 00000000 00000000 00000000 00000000 00000000 0000123e            ce000000 00000000 014b4d4d 34203634 53313732 34425431 2d464c31 42010023            a85400ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffff64cd            8008040c 08014000 01a08000 80100001 8f040601 01000ef0 8000001e 141e3c08            00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000141            1cffffff ffffffff 014d4834 53363442 4b472d31 304c2020 20202000 57631a33            b00a1400 00000000 00000000 00000000 00000000 00000000 00000000 00006606dimm-types &nbsp;SDRAM            SDRAMdimm-speeds PC100-322S            PC100-333S</pre></TD></TR></TABLE></CENTER><BR><BR>                                                              <P id=p4>Step 4. Identify the "reg" values<BR>         Case 1 - The "reg" property from above is</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         reg 00000000 08000000             08000000 02000000</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>The first column is the starting address for the         DIMM and the second column is the size of the DIMM -         0x08000000 is equivalent to 128M, 0x02000000 is equivalent         to 32M. Note that the memory space always begins at location         0. If you try to set the starting address to an address         other than 0, the system may not boot.</P>                  <P id=p4>Case 2 - For a system with only 1 memory DIMM         present, you might see</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         reg 00000000 08000000</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>In this case, there is a single DIMM (SODIMM) of         128M memory present.</P>                  <P id=p4>Step 5. Decide how much memory you want the system         to think is present. You can only specify the same or less         memory than is physically present.</P>                  <P id=p4>Let's assume you want the system to recognize only         32M of the 160M of RAM present in Case 1 above.</P>                  <P id=p4>Step 6. Delete the existing " reg" property.<BR>         At the OF prompt enter</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         " reg" delete-property</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>There is a leading space character in <CODE>"         reg"</CODE></P>                  <P id=p4>You can verify that the property is gone by         entering the <CODE>".properties"</CODE>         command.</P>                  <P id=p4>Step 7. Enter in a replacement <CODE>"         reg"</CODE> property array. You will enter pairs of values         where the first value is the beginning address and the         second value is the size of memory at that location. To         simulate 32M we can enter the following for both cases noted         above.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         0 encode-int 2000000 encode-int encode+ " reg" property</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>In this case, 0 is the memory starting address and         2000000 (32M) is the memory size.</P>                  <P id=p4>Verify that the property is now present with only a         single array entry by using the ".properties" command. You         should now see the following <CODE>"         reg"</CODE> entry</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         reg 00000000 02000000</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Step 8. Continue the boot process<BR>         Enter the following at the OF Prompt.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         mac-boot</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Once the Mac OS is active, you can verify that the         system now only thinks that there is 32M present.</P>                  <P id=p4>Note that this information is not written to NVRAM.         When you reboot the system, the system will recognize the         Physical RAM which is present.</P>                           <BR><BR>                  <h2>Another Example Open Firmware         Example</h2>                  <P id=p4>You may have a system with only one or multiple RAM         DIMMs present. For all cases, the generalized command is</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         0 encode-int XXX00000 encode-int encode+ " reg" property</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>where <CODE>XXX00000</CODE> is the         desired size of memory to limit the system to. <CODE>XXX00000         </CODE>cannot be greater than the amount of physical memory         present on the system.</P>                  <P id=p4>For case 1, if we want the system to think that         there is 144M of memory instead of the full 160M, we do the         following for step 7. Enter the following for this step.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         0 encode-int 9000000 encode-int encode+</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>This creates a <CODE>" reg"</CODE>         property for a memory DIMM starting at location 0 with a         size of 144M. After booting, if you open Apple System         Profiler, it will show that there is only a single memory         DIMM of 144M in the first slot. While it is possible to         recreate the <CODE>" reg"</CODE> property so         that two DIMM's are listed, that is beyond the scope of this         Q&amp;A.</P>                           <BR><BR>                           <h2>Three DIMM Open Firmware Example</h2>                  <P id=p4>Whether you have one, two or many more DIMMs         present, the same command format is used. You might have a         G4 with three 128M DIMMs installed as displayed using the         <CODE>.properties</CODE> command.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         reg 00000000 08000000             08000000 08000000             10000000 08000000</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>The total memory present is 384M. Lets assume that         you want to limit the system to recognizing only 320M. For         step 7. Enter the following.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         0 encode-int 14000000 encode-int encode+ " reg" property</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <BR><BR>                  <h2>2M Limitation</h2>                  <P id=p4>When specifying the size of memory present, the         size must be a multiple of 200000 (or 2M) else the system         may hang on start or enter a kernel panic. You cannot         specify that the available memory is 65M for example, but         you can specify that it is 66M. If you specify an invalid         value, you may have to "zap PRAM" as described in the         section - "<A HREF="#ClearMaxmem">Clearing the "maxmem"         Setting</A>".</P>                  <BR><BR>                                    <A NAME=SetSizeMacXInOF></A>                  <h2>Setting         the Physical Memory Size for Mac OS X using "maxmem" in Open         Firmware</h2>                  <P id=p4>For Mac OS X, you can create the <CODE>maxmem</CODE>         property in nonvolatile (NVRAM) memory, which Mac OS X uses,         if present, to define the amount of physical memory present.         If this setting is greater than the actual amount of         physical memory present, then the setting is not used. Once         the setting is in NVRAM, the setting persists across system         restarts.</P>                  <P id=p4>To define the <CODE>maxmem</CODE>         property from within Open Firmware, follow these         instructions:</P>                  <P id=p4>Step 1. Enter Open Firmware.<BR>         Restart the system and hold the "Command-Option-O-F" keys         down until the Open Firmware screen is displayed.</P>                  <P id=p4>Step 2. Enter the following command</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         setenv boot-args maxmem=64</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>Note that there are no "double" quote characters         used in this command line as there are when using the         Terminal application.</P>                  <P id=p4>Step 3. After the "ok" response, enter</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>         mac-boot</pre></TD></TR></TABLE></CENTER><BR><BR>                                      <P id=p4>to continue the boot process.</P>                  <P id=p4>The above commands implements the maxmem setting         into nonvolatile RAM, which means that the setting is         persistent across system restarts. To clear this setting,         refer to the options described above in the section         "<A HREF="#ClearMaxmem">Clearing the "maxmem"         Setting</A>".</P>                           <BR><BR>                                    <h2>References</h2>                  <P id=p4><a href="../../technotes/tn/tn1061.html">Tech         Note 1061 Fundamentals of Open Firmware, Part I: The User         Interface</A>, Part I in the Open Firmware Technote         Series</P>                  <P id=p4><a href="../../technotes/tn/tn2004.html">Tech         Note 2004 Debugging Open Firmware Using Telnet</A></P>                  <P id=p4><a href="../../technotes/tn/tn1062.html">Tech         Note 1062 Fundamentals of Open Firmware, Part II: The Device         Tree</A> Part II in the Open Firmware Technote Series</P>                  <!-- begin_date --><H4 align=center>[Dec 20 2001]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1099.html%3Fid%3DDTS10001647-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1099.html%3Fid%3DDTS10001647-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1099.html%3Fid%3DDTS10001647-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>