<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Checking for Compatible Import Libraries </TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING22></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-14.html"><B>Chapter 1 - CFM-Based Runtime Architecture</B></A> / <A HREF="RTArch-20.html"><B>Preparing a Closure</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING22-0></A>
<H2><A NAME=MARKER-9-58></A>Checking for Compatible Import Libraries </H2>
 <A NAME=MARKER-2-59></A>Checking compatibility between a client fragment and an import library essentially means checking for an intersection between the version range required by the client fragment and the range supported by the import library. <P>
 When building a fragment that requires an import library, you must supply information in a definition stub library that defines the library's API. A <B>s</B>tub library contains symbol definitions but does not contain actual code. The linker uses definition stub libraries to associate imported symbols with particular import libraries. <A HREF=#MARKER-9-60>Figure 1-8</A> shows an application linking to a definition stub library to produce the completed application. A reference such as <CODE>cowLib:setWindow</CODE> means that the symbol <CODE>setWindow</CODE> can be found in the import library <CODE>cowLib</CODE>. <P>
<B>Figure 1-8  <A NAME=MARKER-9-60></A>Linking to a definition stub library</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-74.jpg"> <P>
 An import library that provides implementation code is dynamically linked to the client fragment by the Code Fragment Manager during the preparation process. This library (sometimes called the implementation library) must be fully functional.<P>
<DL>
<DT><B>Note</B>
<DD>Since an implementation library contains symbol definitions, the implementation library can act as a definition stub library at link time.<EM></EM><EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A HREF=#MARKER-9-61>Figure 1-9</A> shows an implementation library bound to the application at runtime.<P>
<B>Figure 1-9  <A NAME=MARKER-9-61></A>Using the implementation version of a library at runtime</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-103.jpg"> <P>
 The definition stub library may not be the same version as the implementation library (one may be an earlier version, for example), so the Code Fragment Manager must check to make sure that they are compatible. Generally the libraries are compatible if the library used at runtime can satisfy the programming interface defined for it during the build process.<P>
 When building an import library, you determine compatibility by defining version numbers. You should set three version numbers (usually by specifying linker options) for use in version checking:<P>
<UL>
<LI>the current version number of the library you are creating
<LI>the old implementation version number, which is the oldest version of this library available at runtime that supports the client's needs
<LI>the old definition version number, which is the oldest version of the library defined for the client fragment that is supported by the library you are creating<P>
</UL>
 When building a client fragment, the linker stores the current version and old implementation version numbers of the import library in the client. Later, when the Code Fragment Manager prepares the client fragment, it uses this information to check for a compatible import library. <P>
 <A HREF=#MARKER-9-1>Table 1-1</A> shows two different versions of an import library <CODE>cowLib</CODE> and their version numbers.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-1></A><B>Table 1-1 Two import libraries and their version numbers</B></CAPTION>
<TH>Name<TH>Current <BR>version number<TH>Old definition version number<TH>Old implementation version number<TR>
<TD><CODE>cowLib 13</CODE><TD>13<TD>9<TD>10<TR>
<TD><CODE>cowLib 16</CODE><TD>16<TD>12<TD>14</TABLE>
<P>
<DL>
<DT><B>IMPORTANT</B>
<DD>The current version number must always be greater than or equal to both the old definition version number and the old implementation version number.<EM></EM><EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 If you build an application <CODE>mooApp</CODE> with <CODE>cowLib 13</CODE> and attempt to run with <CODE>cowLib 16</CODE>, the compatibility ranges are as follows:<P>
<UL>
<LI><CODE>cowLib 13</CODE> is not compatible with implementations of <CODE>cowLib</CODE> earlier than version 10 (its old implementation number is set to 10).
<LI><CODE>cowLib 16</CODE> (present in the Extensions folder, for example) is not compatible with definitions of <CODE>cowLib</CODE> earlier than version 12 (its old definition version number is set to 12).<P>
</UL>
 <A HREF=#MARKER-9-62>Figure 1-10</A> shows the compatibility ranges graphically. <P>
<B>Figure 1-10  <A NAME=MARKER-9-62></A>Library versions compatible with each other</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-65.jpg"> <P>
 The presence of an overlap between the two areas of compatibility indicates that the two import libraries are compatible in this case. <P>
 However, reversing the roles of the two libraries (building with <CODE>cowLib 16</CODE>, executing with <CODE>cowLib 13</CODE>) results in a different set of compatibility ranges as follows:<P>
<UL>
<LI><CODE>cowLib 16</CODE> is not compatible with implementations of <CODE>cowLib</CODE> earlier than version 14 (the old implementation version number is 14).
<LI><CODE>cowLib 13</CODE> is not compatible with definitions of <CODE>cowLib</CODE> earlier than version 9 (the old definition version number is 9).<P>
</UL>
 In this case the two libraries are incompatible, as shown in <A HREF=#MARKER-9-63>Figure 1-11</A>.<P>
<B>Figure 1-11  <A NAME=MARKER-9-63></A>Library versions incompatible with each other </B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-66.jpg"> <P>
 The library <CODE>cowLib 16</CODE> may (for example) include additional routines that are not supported by versions older than 14. <P>
 The Code Fragment Manager uses the algorithm shown in <A HREF=#MARKER-9-64>Listing 1-1</A> for checking import library compatibility. It uses this algorithm to check the compatibility of the fragment being prepared with all the import libraries from which it imports code and data. <P>
<B>Listing 1-1  <A NAME=MARKER-9-64></A>Pseudocode for the CFM version-checking algorithm </B><P>
<PRE>
if (Definition.Current == Implementation.Current)
   return(kLibAndAppAreCompatible);
else if (Definition.Current &gt; Implementation.Current)
   /*definition version is newer than implementation version*/
   if (Definition.OldestImp &lt;= Implementation.Current)
      return(kImplAndDefAreCompatible);
   else
      return(kImplIsTooOld);
else
   /*definition version is older than implementation version*/
   if (Implementation.OldestDef &lt;= Definition.Current)
      return(kImplAndDefAreCompatible);
   else
      return(kDefIsTooOld);
</PRE>
 The fact that only one instance of an import library can appear in a given process may cause versioning conflicts. For example say an application <CODE>mooApp</CODE> uses the import library <CODE>mooLib</CODE>. If <CODE>mooApp</CODE> loads a plug-in <CODE>mooPlug</CODE> that also requires <CODE>mooLib</CODE>, then the Code Fragment Manager uses the available connection for <CODE>mooLib</CODE>. If this version is not compatible with the version required by the plug-in, then the preparation of the plug-in fails. (This failure occurs even if you designated <CODE>mooLib</CODE> to be weak.)<A NAME=MARKER-2-65></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
