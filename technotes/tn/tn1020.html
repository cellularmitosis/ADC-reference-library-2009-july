<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1020: Color Cursing: Two Major Causes</title>       <meta name="keywords" content="Mac OS 8 Color Cursors QuickDraw CLUT SetCCursor purgeable">    <meta name="Description" content="Technical Note TN1020: This Technical Note provides solutionsto a few                                     common problemsencountered while building an application that uses colorcursors from Color QuickDraw. Problem areas include: SettingBounds on your cursor, purging of the 'CLUT' resource, andthe use of SetCCursor."><meta name="categories" content="Color and QuickDraw"><meta name="week-posted" content="Jan 29, 1996 - Feb 2, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002862" title="Color Cursing: Two Major Causes"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/GraphicsImaging/idxCarbon-date.html" target="_blank">Graphics & Imaging > Carbon</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1020</div>
<div id="pageheadsub">Color Cursing: Two Major Causes</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc --><p id="menutext"><A HREF = "#Section1">Using Color Cursors</A><BR><BR><A HREF = "#References">References</a><br><br><A HREF = "#Changes">Change History</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr> <tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->            <P id = "introtext">The creation and use of color          cursors is discussed in the chapter on cursorutilities in <a href="../../documentation/mac/QuickDraw/QuickDraw-369.html"><i>Inside Macintosh: Imaging with QuickDraw</i></A>.</p><P id = "introtext">If you're building an application that uses color cursors, you may encountersome quirks present in Color QuickDraw. This Technote provides solutions to a fewcommon problems.</P> <!-- end_intro_text --><!-- begin_date --><h3 align=center>&nbsp;[Dec 23 1997]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content -->         <A NAME="Section1"></A>         <H2>Using Color Cursors</H2>         <P>To avoid system errors or crashes while using a color cursor, incorporate thefollowing information in your application development.</p><h3>Setting Bounds for your Cursor</h3><P>If your cursor is, for example, 15 pixels tall and 9 pixels wide, you might betempted to use these values for the bounds.bottom and bounds.right,respectively, in your cursor's pixel map. <i>Don't</i>. When the cursor's imageneeds to be expanded (that is, when you specify a two bit-per-pixel cursor andthe mouse pointer is on an eight-bit screen) the <CODE>SetCCursor</CODE> trap rounds thewidth of the pixel map in such a way that you'll get only the space requiredfor a 15 by 8 pixel map allocated for the expanded cursor data. When thecursor's image is expanded into this too-small expanded cursor data handle as a15 by 9 pixel map, something in your heap will get munched.</p><P>To avoid this problem, <i>always</i> specify the <CODE>pixmapHandle^^.bounds</CODE> to be 16by 16. This will cause <CODE>SetCCursor</CODE> to properly allocate the expanded data area.Since the amount of data <i>drawn</i> for a cursor is specified by the cursor'spixel values and 'clut' resource, trying to save a few bytes by making thebounds rectangle smaller than 16 by 16 won't be very helpful anyway.</p><h3>Inopportune Purging of a `<CODE>CLUT</CODE>' resource</h3><P>If you load a color cursor's color table from a '<CODE>clut</CODE>' resource using<CODE>GetCTable</CODE>, make sure that the '<CODE>clut</CODE>' is marked non-purgeable while the colorcursor is in use. If you don't take this precaution, bombs will occur if your'<CODE>clut</CODE>' gets purged at an inopportune time.<BR><br>For more information, see <a href="../../documentation/mac/QuickDraw/QuickDraw-369.html"><i>Inside Macintosh: Imaging with QuickDraw</i></A>, "Cursor Utilities."</p><h3>Calling <CODE>SetCCursor</CODE> can change the <CODE>GDevice</CODE></h3><P>Starting with System 7.5.2, the cursor images are copied into offscreen GWorlds via <CODE>CopyBits</CODE>.  To do this, <CODE>SetCCursor</CODE> saves and restores the port and device using a fairly standard set of code: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>{  GetGWorld (&amp;savePort, &amp;saveDevice);  SetGWorld (offPort, NULL);...copybits and other stuff goes here  SetGWorld (savePort, saveDevice);}</pre>	</TD></TR></TABLE></CENTER><P>A documented side effect of <CODE>SetGWorld</CODE> is that the device parameter will be ignored when you pass in a GWorld port.  So, if the current port is a GWorld port, the save-restore code in <CODE>SetCCursor</CODE> will always make the current device that of the GWorld.</p><P>One place where this is especially dangerous is when the current port is a disposed GWorld.  <CODE>DisposeGWorld</CODE> sets the current <CODE>GDevice</CODE> to a safe device, but doesn't affect the current port.  If you then call <CODE>SetCCursor</CODE> before a valid port has been set, then <CODE>SetCCursor</CODE> will cause the current <CODE>GDevice</CODE> to point at the disposed <CODE>GDevice</CODE>, and the system will crash shortly afterwards.</p><P>The easiest way to avoid this side-effect of <CODE>SetCCursor</CODE> is to: </p><ul><LI>Ensure that your port and device always match.  Never allow a situation where the port and device can be mismatched.  This helps cure many problems unrelated to color cursors.</li><LI>Never dispose of the current port without setting a valid QuickDraw port first.  Drawing to a disposed port or device will most likely result in a crash.</li></ul><h3>Don't Call <CODE>SetCCursor</CODE> at Interrupt Time</h3><P><CODE>SetCCursor</CODE> is documented as moving memory.  In 7.5.2 and later, <CODE>SetCCursor</CODE> makes calls to <CODE>CopyBits</CODE> and other QuickDraw routines.  Never, ever call <CODE>SetCCursor</CODE> at interrupt time!  Calling <CODE>SetCursor</CODE> at interrupt time is still allowed, however.</p>    <a name="References"></a><H2>References</h2>            <p><a href="../../documentation/mac/QuickDraw/QuickDraw-369.html"><I>Inside Macintosh: Imaging with QuickDraw</I></A></p><P><A HREF="#top">Back to top</A></P>         <a name="Changes"></a><H2>Change History</H2> <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-June-1989</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1996</P>               </TD>               <td align="left">                  <P>The warning about purgeable 'clut' resources added.</P>               </TD>            </TR>                <TR>               <td width=100 align=left>                  <P ALIGN=center>23-December-1997</P>               </TD>               <td align="left">                  <P>Warnings about <CODE>SetCCursor</CODE> changing the <CODE>GDevice</CODE>, and <CODE>SetCCursor</CODE> moving memory added.</P>               </TD>            </TR>           </table>           <P><A HREF="#top">Back to top</A></P>         <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1020.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1020.html%3Fid%3DDTS10002862-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1020.html%3Fid%3DDTS10002862-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1020.html%3Fid%3DDTS10002862-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>