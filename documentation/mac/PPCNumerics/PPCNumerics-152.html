<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Inquiries: Class and Sign(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<A NAME="HEADING152"></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-151.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-153.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-144.html"><B>Part 3 - Numerics in PowerPC Assembly Language</B></A><BR><DD><A HREF="PPCNumerics-150.html"><B>Chapter 12 - Assembly-Language Environmental Controls</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING152-0"></A>
<H1><A NAME="MARKER-9-42"></A>Inquiries: Class and Sign</H1>
 <A NAME="MARKER-2-43"></A>As stated in <A HREF="PPCNumerics-49.html#MARKER-9-18">Chapter 2, "Floating-Point Data Formats,"</A> the result of a floating-point operation is either a normalized number, a denormalized number, a zero, a NaN, or an Infinity. This section describes how the class and sign of a floating-point number can be determined in PowerPC assembly language.<P>
<A NAME="HEADING152-2"></A>
<H2>Floating-Point Result Flags and Condition Codes</H2>
 <A NAME="MARKER-2-6"></A>FPSCR bits 15 through 19 are the floating-point result flags. Bit 15 is in FPSCR field 3, and bits 16 through 19 are in FPSCR field 4. For many instructions, FPSCR bits 15 through 19 specify the class and sign of the instruction's result. For comparison instructions, bits 16 through 19 store the result of the comparison.
<TABLE BORDER="0" CELLPADDING="3"><TH ALIGN="LEFT">Bit<TH>Meaning<TR>
<TD>15<TD>The class descriptor. If this bit is set, the result is either a quiet NaN or a denormalized number, depending on the settings of bits 16 through 19. <TR>
<TD>16<TD>&lt; or &lt; 0. For comparison operations, this bit is set if the first operand is less than the second operand. For other operations, this bit is set if the result is negative (&lt; 0).<A NAME="MARKER-2-28"></A><TR>
<TD>17<TD>&gt; or &gt; 0. For comparison operations, this bit is set if the first operand is greater than the second operand. For other operations, this bit is set if the result is positive (&gt; 0).<A NAME="MARKER-2-29"></A><TR>
<TD>18<TD>= or = 0. For comparison operations, this bit is set if the first operand is equal to the second operand. For other operations, this bit is set if the result is 0 (= 0).<A NAME="MARKER-2-30"></A><TR>
<TD>19<TD>Unordered or NaN. For comparison operations, this bit is set if either of the operands is a NaN. For other operations, this bit is set if the result is a NaN or an Infinity, depending on the value of bit 15.<A NAME="MARKER-2-31"></A></TABLE>
<P>
 <A HREF="#MARKER-9-18">Table 12-3</A> shows how bits 15 through 19 are interpreted, depending on whether the previous instruction was a comparison operation or not. 
<TABLE BORDER="0" CELLPADDING="3">
<CAPTION><A NAME="MARKER-9-18"></A><B>Table 12-3 Values for FPSCR bits 15 through 19</B> </CAPTION>
<TH>Bits 15-19<TH>Result for comparisons<TH>Result for other operations<TR>
<TD>00001<TD>Unordered<TD>Not applicable<TR>
<TD>00010<TD>== (equal to)<TD>+0<TR>
<TD>00100<TD>&gt; (greater than)<TD>Positive normalized number<TR>
<TD>00101<TD>Not applicable<TD>+ <IMG BORDER="NONE" SRC="graphics/infinity.gif"> <TR>
<TD>01000<TD>&lt; (less than)<TD>Negative normalized number<TR>
<TD COLSPAN="3">&nbsp;<TR>
<TD>01001<TD>Not applicable<TD>
<MATH>
- <IMG BORDER="NONE" SRC="graphics/infinity.gif"> 
</MATH>

<TR>
<TD>10001<TD>Unordered<TD>Quiet NaN<TR>
<TD>10010<TD>== (equal to)<TD>
<MATH>
-0
</MATH>

<TR>
<TD>10100<TD>&gt; (greater than)<TD>Positive denormalized number<TR>
<TD>11000<TD>&lt; (less than)<TD>Negative denormalized number</TABLE>
<A NAME="MARKER-2-20"></A><P>
<A NAME="HEADING152-5"></A>
<H2><A NAME="MARKER-9-46"></A>Example: Determining Class</H2>
 To determine the class of a floating-point operation, copy the FPSCR bits to the Condition Register and then branch on the Condition Register field, as shown in <BR><A HREF="#MARKER-9-47">Listing 12-1</A>. To copy FPSCR bits to the Condition Register, use the <CODE>mcrfs</CODE> instruction, which has the form <P>
<PRE>
mcrfs  DST, SRC 
</PRE>
 where <I>DST</I> is a 4-bit Condition Register field and <I>SRC</I> is an FPSCR field. <P>
<B>Listing 12-1  <A NAME="MARKER-9-47"></A>Determining the class of an assembler instruction result</B><P>
<PRE>
   fadd  f0,f1,f2    # sets FPSCR bits 15-19 from f0
   mcrfs 2,3         # copy FPSCR bits 12-15 to CR2
   mcrfs 3,4         # copy FPSCR bits 16-19 to CR3
   # CR bits 11 - 15 are class and sign of f0
   bun   3,inf       # if bit 3 of CR3 is 1, result is 
                     # Infinity or NaN
   beq   3,zero      # if bit 2 of CR3 is 1, result is zero
   blt   3,norm      # if bit 0 or 1 of CR3 is 1, 
   bgt   3,norm      # result is a normalized or 
                     # denormalized number

inf:
   bta   11,NaN      # if bit 11 is set, result = quiet NaN
                     # else result is an Infinity

norm:
   bta   11,denorm   # if bit 11 is set, result is denorm
                     # else result is norm

zero:
   # return class of zero

denorm:
   # return class of denormalized number
</PRE>
 <CODE><A NAME="MARKER-2-8"></A></CODE>The <CODE>fadd</CODE> instruction, which adds two floating-point numbers, is one of the many floating-point instructions that set FPSCR bits 15 through 19 to the class and sign of its result. To read these FPSCR bits, <A HREF="#MARKER-9-47">Listing 12-1</A> copies them to the Condition Register using the <CODE>mcrfs</CODE> instruction. This instruction operates on 4-bit fields. Bits 15 through 19 are contained in two fields (3 and 4), so two separate <CODE>mcrfs</CODE> instructions are required to copy all pertinent bits to the Condition Register. Once the bits are copied, Condition Register fields 2 and 3 contain FPSCR fields 3 and 4, which means that Condition Register bits 11 through 15 reflect FPSCR bits 15 through 19. Next, the branch instructions test the values in the Condition Register and determine what type of result the <CODE>fadd</CODE> instruction had.<CODE></CODE><A NAME="MARKER-2-23"></A><P>

</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="PPCNumerics-151.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-153.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><BR>13 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
