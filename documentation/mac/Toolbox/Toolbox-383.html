<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using an Application-Defined Item to Draw the Bold Outline  for a Default Button(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING383></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-382.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-384.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-370.html"><B>Chapter 6 - Dialog Manager</B></A> / <A HREF="Toolbox-378.html"><B>Using the Dialog Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING383-0></A>
<H2><A NAME=MARKER-9-223></A>Using an Application-Defined Item to Draw the Bold Outline <BR>for a Default Button</H2>
 <A NAME=MARKER-2-224></A><A NAME=MARKER-2-225></A>You can define your own type of item for dialog boxes. You might wish, for example, <BR>to display a clock with the current time in a dialog box. You can also use application- defined items to draw a bold outline around the default button in a dialog box. <P>
 You should not use application-defined items in an alert box because they add unnecessary programming complications. If you need an application-defined item, <BR>use a dialog box instead.<P>
 To define your own item, include an item of type <CODE>UserItem</CODE> in your item list resource; <BR>it should have a display rectangle, but no text and no resource ID associated with <BR>it. The dialog resource that uses this item list resource must specify the <CODE>invisible</CODE> constant. This makes the dialog box invisible while you install a draw procedure for your application-defined item. After installing the procedure that draws the application- defined item, you display the dialog box by using the Window Manager procedure <CODE>ShowWindow</CODE>.<P>
 For example, <A HREF=Toolbox-382.html#MARKER-9-218>Figure 6-32 on page 6-48</A> illustrates a dialog box that outlines the default button (Spell Check). To outline the button, the application must add an item of type <CODE>UserItem</CODE> to the item list resource for that dialog box.<P>
 So that an application-defined drawing procedure can draw a border around the Spell Check button, the item list resource in <A HREF=#MARKER-9-226>Listing 6-15</A> specifies a larger display rectangle for the application-defined item than for the Spell Check button.<P>
<B>Listing 6-15  <A NAME=MARKER-9-226></A>Rez input for an application-defined item in an item list</B><P>
<PRE>
resource 'DITL' (kSpellCheckDITL, purgeable) {
   /*ITEM NO. 1: OK button--the default*/
   {  {123, 170, 144, 254}, Button {enabled,&quot;Spell Check&quot;},
   /*ITEMs 2-5 go here: Cancel button, two checkboxes, and static text*/
   /*ITEM NO. 6: application-defined item*/
      {115, 164, 152, 260},   /*6th item*/
      UserItem {              /*draw procedure for item draws an outline*/
            disabled,         /*1st item lies inside this--1st is enabled*/ 
      }
   }
};
</PRE>
 The application-defined item is disabled because the Spell Check button, which lies within the application-defined item, is enabled. Because the Spell Check button is listed before the application-defined item in this item list resource, the Dialog Manager reports when the user clicks the Spell Check button. However, note that when application- defined items are enabled, the Dialog Manager reports their item numbers when the <BR>user clicks them.<P>
<DL>
<DT><B>Note</B>
<DD>Although the draw procedure for an application-defined item can draw outside the item's display rectangle, this is not recommended because <BR>if the Dialog Manager receives an update event involving an area outside the display rectangle but inside the area where you draw <BR>your application-defined item, the Dialog Manager won't call your <BR>draw procedure.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A HREF=Toolbox-382.html#MARKER-9-220>Listing 6-14 on page 6-49</A> shows the dialog resource for the dialog box. Notice that the <CODE>invisible</CODE> constant in the dialog resource specifies that the dialog box should initially be invisible.<P>
 You must provide a procedure that draws your application-defined item. Your draw procedure must have two parameters: a dialog pointer and an item number from the dialog box's item list resource. For example, this is how you should declare the draw procedure if you were to name it <CODE>MyDrawDefaultButtonOutline</CODE>:<P>
<PRE>
PROCEDURE MyDrawDefaultButtonOutline (theDialog: DialogPtr; 
                                       theItem: Integer);
</PRE>
 The parameter <CODE>theDialog</CODE> is a pointer to the dialog box containing the application- defined item. (If your procedure draws in more than one dialog box, this parameter tells <BR>your procedure which dialog box to draw in.) The parameter <CODE>theItem</CODE> is a number corresponding to the position of an item in the item list resource for the dialog box. (In case the procedure draws more than one item, this parameter tells the procedure which one to draw.) <P>
 To install this draw procedure, use the <CODE>GetDialogItem</CODE> and <CODE>SetDialogItem</CODE> procedures. Use <CODE>GetDialogItem</CODE> to return a handle to the application-defined item specified in the item list resource. Then use <CODE>SetDialogItem</CODE> to replace this handle <BR>with a pointer to your draw procedure. When calling your draw procedure, the Dialog Manager sets the current port to the dialog box's graphics port. The Dialog Manager then calls your procedure to draw the application-defined item as necessary--for instance, when you display the dialog box and whenever the Dialog Manager receives an update event for the dialog box.<P>
 <A HREF=#MARKER-9-227>Listing 6-16</A> illustrates how to install the procedure that draws a bold outline. In this listing, <CODE>GetDialogItem</CODE> gets a handle to the application-defined item (which is <BR>the sixth item in the item list resource from <A HREF=#MARKER-9-226>Listing 6-15</A>). The procedure pointer <CODE>@MyDrawDefaultButtonOutline</CODE>, which is coerced to a handle, is then passed <BR>to <CODE>SetDialogItem</CODE>, which sets the draw procedure into the dialog record.<P>
<B>Listing 6-16  <A NAME=MARKER-9-227></A>Installing the draw procedure for an application-defined item</B><P>
<PRE>
FUNCTION DisplayMyDialog (VAR theDialog: DialogPtr): OSErr;
VAR
   itemType:      Integer;
   itemHandle:    Handle;
   itemRect:      Rect;
   docWindow:     WindowPtr;
   event:      EventRecord;
BEGIN
   {begin by creating an invisible dialog box}
   theDialog := GetNewDialog(kSpellCheckID, NIL, Pointer(-1));
   IF theDialog &lt;&gt; NIL THEN
   BEGIN
      {get a handle to the application-defined item (i.e., userItem)}
      GetDialogItem(theDialog, kUserItem, itemType, itemHandle, itemRect);
      {install the drawing procedure for the application-defined item}
      SetDialogItem(theDialog, kUserItem, itemType, 
                    Handle(@MyDrawDefaultButtonOutline), itemRect);
      docWindow := FrontWindow;     {get the front window}
         {if there's a front window, deactivate it}
      IF docWindow &lt;&gt; NIL THEN 
         DoActivate(docWindow, FALSE, event);
      ShowWindow(theDialog);     {display the dialog box}
      MyAdjustMenus;             {adjust menus as needed}
      DisplayMyDialog := kSuccess;
   END
   ELSE DisplayMyDialog := kFailed;
   {call ModalDialog and handle events in dialog box here}
END;
</PRE>
 Use the Window Manager procedure <CODE>ShowWindow</CODE> to display the previously invisible dialog box. When <CODE>ShowWindow</CODE> is called in this example, a bold outline is drawn inside the application-defined item and around the Spell Check button.<P>
 <A HREF=#MARKER-9-228>Listing 6-17</A> shows a procedure that draws a bold outline around a button of any size and shape. This procedure can be used to draw the outline around the Spell Check button from the previous example.<P>
<B>Listing 6-17  <A NAME=MARKER-9-228></A>Creating a draw procedure that draws a bold outline around the default button</B><P>
<PRE>
PROCEDURE MyDrawDefaultButtonOutline(theDialog: DialogPtr; theItem: Integer);
CONST
   kButtonFrameInset =  -4;
   kButtonFrameSize =   3;
   kCntrActivate =      0;
VAR
   itemType:      Integer;    {returned item type}
   itemRect:      Rect;       {returned display rectangle}
   itemHandle:    Handle;     {returned item handle}
   curPen:        PenState;
   buttonOval:    Integer;
   fgSaveColor:   RGBColor;
   bgColor:       RGBColor;
   newfgColor:    RGBColor;
   newGray:       Boolean;
   oldPort:       WindowPtr;
   isColor:       Boolean;
   targetDevice:  GDHandle;
BEGIN
   {get the default button &amp; draw a bold border around it}
   GetDialogItem(theDialog, kDefaultButton, itemType, itemHandle, itemRect);
   GetPort(oldPort);
   SetPort(ControlHandle(itemHandle)^^.contrlOwner);
   GetPenState(curPen);
   PenNormal;
   InsetRect(itemRect, kButtonFrameInset, kButtonFrameInset);
   FrameRoundRect(itemRect, 16, 16);
   buttonOval := (itemRect.bottom - itemRect.top) DIV 2 + 2;
   IF ((CGrafPtr(ControlHandle(itemHandle)^^.contrlOwner)^.portVersion) =
       kIsColorPort) THEN
      isColor := TRUE
   ELSE
      isColor := FALSE;
   IF (ControlHandle(itemHandle)^^.contrlHilite &lt;&gt; kCntrlActivate) THEN
   BEGIN    {control is dimmed, so draw gray default button outline}
      newGray := FALSE;
      IF isColor THEN
      BEGIN
         GetBackColor(bgColor);
         GetForeColor(fgSaveColor);
         newfgColor := fgSaveColor;
            {get the device on which this dialog box is displayed}
         targetDevice := 
                MyGetDeviceFromRect(ControlHandle(itemHandle)^^.contrlRect);
            {use the gray defined by the display device}
         newGray := GetGray(targetDevice, bgColor, newfgColor);
      END;
      IF newGray THEN
         RGBForeColor(newfgColor)
      ELSE
         PenPat(gray);
      PenSize(kButtonFrameSize, kButtonFrameSize);
      FrameRoundRect(itemRect, buttonOval, buttonOval);
      IF isColor THEN
         RGBForeColor(fgSaveColor);
   END
   ELSE  {control is active, so draw default button outline in black}
   BEGIN
      PenPat(black);
      PenSize(kButtonFrameSize, kButtonFrameSize);
      FrameRoundRect(itemRect, buttonOval, buttonOval);
   END;
   SetPenState(curPen);
   SetPort(oldPort);
END;
</PRE>
 <A HREF=#MARKER-9-228>Listing 6-17</A> uses <CODE>GetDialogItem</CODE> to get the Spell Check button and then uses <BR>several QuickDraw routines to draw a black outline around that button's display rectangle when the button is active. If the button is inactive (that is, dimmed), <CODE>MyDrawDefaultButtonOutline</CODE> draws a gray outline.<P>
 Before drawing a gray outline, <CODE>MyDrawDefaultButtonOutline</CODE> determines whether the dialog box uses a color graphics port. As explained in <A HREF=Toolbox-384.html#MARKER-9-290>"Including Color in Your Alert and Dialog Boxes" beginning on page 6-75</A>, you can supply a dialog box with a color graphics port by creating a dialog color table (<CODE>'dctb'</CODE>) resource with the same resource ID as the dialog resource. If the dialog box uses a color graphics port, <CODE>MyDrawDefaultButtonOutline</CODE> uses the Color QuickDraw function <CODE>GetGray</CODE> to return a blended gray based on the foreground and background colors. Then <CODE>MyDrawDefaultButtonOutline</CODE> uses this gray for outlining the dimmed default button. Otherwise, <CODE>MyDrawDefaultButtonOutline</CODE> uses the QuickDraw procedure <CODE>PenPat</CODE> to draw a gray outline on black-and-white monitors.<A NAME=MARKER-2-229></A><A NAME=MARKER-2-230></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-382.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-384.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
