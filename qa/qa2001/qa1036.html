<HTML><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><!--This file created 5/16/01 8:31 AM by Claris Home Page version 3.0--><HEAD>   <title>Technical Q&amp;A QA1036: Displaying PCI Configuration Registers contents in Open Firmware</title>   <META NAME=GENERATOR CONTENT="Claris Home Page 3.0"><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="PCI, Open Firmware, Device Tree, Configuration Registers,Config. Reg., .cregs"><meta name="Description" content="Technical Q&amp;A QA1036: Displaying PCI Configuration Resistercontents in Open Firmware"><meta name="categories" content="Hardware"><meta name="week-posted" content="May 14, 2001 - May 18, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001588" title="Displaying PCI Configuration Registers contents in Open Firmware"></a><P><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/HardwareDrivers/index.html">Hardware & Drivers</a> &gt; <a href="../../technicalqas/HardwareDrivers/idxPCIandPCCard-date.html">PCI and PC Card</a> &gt; </p><!-- end_header_information --> <!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1036</div>
<div id="pageheadsub">Displaying PCI Configuration Registers contents in Open Firmware</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --></P><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <P><!-- begin_content -->                  <hr width=500 align=center>                  </P>                  <P id=p2>Q: How can I display a PCI device's         Configuration Registers in sequential order, in Open         Firmware?</P>                  <P id=p4>A:  Displaying the contents of PCI device's         Configuration Registers sequentially, as shown         in figure 1 can be accomplished in 6 steps.</P>                <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=480>               <TR>                  <td align="left">                     <P>&nbsp;</P>                                          <CENTER><img src="images/qa1036_001.jpg" alt="Format for PCI Configuration                     Header (Type 0)" width=368 height=653 x-claris-useimagewidth x-claris-useimageheight align=bottom></CENTER>                                          <P>&nbsp;</P>                                          <P><B>Figure 1</B>. Format for PCI Configuration                     Header (Type 0)</P>                  </TD>               </TR>            </TABLE></CENTER>                  <P id=p4>&nbsp;</P>                  <P id=p4>1. Locate your device in the device tree in open         firmware. An NCR8250 PCI Card as an example.</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 1</B>. Device Tree                     Listing</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>0 &gt; dev / lsff83d620: /cpusff83d8d0:   /PowerPC,G4@0ff83dcc8:     /l2-cacheff83e948: /chosenff83eb60: /memory@0ff83ee00: /openpromff83efa8:   /client-servicesff840298: /rom@ff800000ff840498:   /boot-rom@fff00000ff8406c8:   /macosff8407d0: /optionsff8408d8: /aliasesff841428: /packagesff841508:   /deblockerff841ea0:   /disk-labelff842968:   /obp-tftpff84c248:   /telnetff84cb48:   /mac-partsff84e2f0:   /mac-filesff8511a8:   /hfs-plus-filesff855fc8:   /fat-filesff857dc0:   /iso-9660-filesff858c20:   /bootinfo-loaderff85a8f8:   /xcoff-loaderff85b390:   /pe-loaderff85bde0:   /elf-loaderff85d488:   /usb-hid-classff85ffc8:   /usb-ms-classff862c18:   /usb-audio-classff8d0790:   /sbp2-diskff8d3130:   /ata-diskff8d4e98:   /atapi-diskff8d6de0:   /bootpath-searchff8dd770:   /terminal-emulatorff8dd880: /firewire-disk-modeff8f2138: /pseudo-hidff8f2238:   /keyboardff8f2930:   /mouseff8f2ec8:   /eject-keyff8f3398: /pseudo-soundff8f36c8: /multibootff9066b8: /diagnosticsff906798: /nvram@fff04000ff907398: /uni-n@f8000000ff907660:   /i2c@f8001000ff907f28:     /cerealff908658: /pci@f0000000ff94b290:   /uni-north-agp@bff94b578:   /ATY,Rage128Ps@10ff909800: /pci@f2000000ff90a968:   /pci-bridge@dff90cc20:     /mac-io@7ff910bd8:       /interrupt-controller@40000ff910e28:       /gpio@50ff910f90:         /extint-gpio1ff9111b0:         /programmer-switchff911360:       /escc-legacy@12000ff9115d0:         /ch-a@12004ff9117d0:         /ch-b@12000ff9119d0:       /escc@13000ff911c58:         /ch-a@13020ff912680:         /ch-b@13000ff913018:       /davbus@14000ff913350:         /soundff913ad0:       /timer@15000ff913ce0:       /via-pmu@16000ff9172b8:         /rtcff917a28:         /power-mgtff96ac40:           /usb-power-mgtff917d10:       /i2c@18000ff918618:         /cerealff918d60:       /ata-4@1f000ff91b450:         /diskff91bbb0:       /ata-3@20000ff91e2a0:         /diskff91ea00:       /ata-3@21000ff9210f0:         /diskff927a80:     /AAPL,NCR8250S@4  &lt;----------  My Deviceff927de0:     /usb@8ff92fa68:     /usb@9ff9693a0:       /hub@1ff9695a8:         /device@1ff969720:           /keyboard@0ff969ab0:           /eject-key@1ff969e18:         /mouse@2ff9376f0:     /firewire@aff90baa8: /pci@f4000000ff9468c8:   /ethernet@fff96ae20:     /ethernet-phy ok</pre></TD></TR></TABLE></CENTER><BR><BR>                  <P id=p4>&nbsp;</P>                  <P id=p4>2. Select your device in the device tree in open         firmware.&nbsp;</P>                  <P id=p4>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 2</B>. Selecting the Device</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>0 &gt; dev bridge/@4 ok0 &gt; pwd /pci@f2000000/pci-bridge@d/AAPL,NCR8250S@4 ok</pre></TD></TR></TABLE></CENTER>         <P id=p4>               Note that the word "dev" was used to select               the device path. The "devalias" for the PCI               bridge path and the unit address for the device,               were used to abriviate the path name. Finally, the               "pwd" (Print Working Directory) word was used to               display the selected device path.</P>                  </P>                  <P id=p4>&nbsp;</P>                  <P id=p4>3. Display the devices properties.&nbsp;</P>                  <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 3</B>. Device Properties</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>0 &gt; .propertiesvendor-id               00001000device-id               00000003revision-id             00000002class-code              00010000interrupts              00000001min-grant               00000000max-latency             00000000devsel-speed            00000001fcode-rom-offset        00000000name                    AAPL,NCR8250Sdevice_type             scsimodel                   8250Sreg                     00012000 00000000 00000000  00000000 00000000                        02012030 00000000 00000000  00000000 00008000                        02012014 00000000 00000000  00000000 00000100power-consumption       00000000 00000000 007270e0  007270e0 00000000                        00000000 007b98a0 007b98a0jsun                    4920616d 20686572 6500assigned-addresses      82012030 00000000 80088000  00000000 00008000                        82012014 00000000 80080000  00000000 00000100 ok</pre></TD></TR></TABLE></CENTER>                                    <P id=p4>&nbsp;</P>                  <P id=p4>4. Note the Configuration Space address (phys.hi) from         the "reg" property.&nbsp;</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 4</B>. Configuration Space address is "phys.hi" from the first entry in the "reg" property. In this case the Configuration Space address for the device is 0x00012000.</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>reg                     00012000</pre></TD></TR></TABLE></CENTER>         <P id=p4>&nbsp;</P>                  <P id=p4>5. Define the following word (.cregs) in Open         Firmware:</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><pre>: .cregs base @swap 10 base ! h# 40 boundsdo cr i 5 u.r &quot;: &quot; type i do-config-l@ 8 u.r 4 +loopbase !;</pre></TD></TR></TABLE></CENTER><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 5.</B>. Define the word, ".cregs".</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>0&gt; : .cregs base @ swap 10 base !h# 40 bounds do cr i 5 u.r &quot; : &quot; typei do-config-l@ 8 u.r 4 +loop base !;  ok</pre></TD></TR></TABLE></CENTER>                  <P id=p4>6. Enter the Configuration Space address (phys.hi) and         then the word .cregs.&nbsp;&nbsp;</P>         <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B>Example 6.</B>. Using ".cregs"</P></TD></TR>                <TR><td bgcolor="#E6E6E6" align=left><pre>0 &gt; 00012000 .cregs12000: 0003100012004: 0200000412008: 010000021200c: 0000100012010: 0000000112014: 8008000012018: 000000001201c: 0000000012020: 0000000012024: 0000000012028: 000000001202c: 0000000012030: 8008800012034: 0000000012038: 000000001203c: 00000100 ok</pre></TD></TR></TABLE></CENTER>                                               <P id=p4>               Note that the Vendor ID , Device ID, Revision ID               and Class Code values match the coresponding               properties when compared to the byte ordered layout               in figure 1.</P>                  <P>                  <hr width=500 align=center>                  </P>                  <!-- begin_date --><H4 align=center>[May 18 2001]</H4><!-- end_date -->      </TD>   </TR></TABLE></CENTER><P><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1036.html%3Fid%3DDTS10001588-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1036.html%3Fid%3DDTS10001588-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1036.html%3Fid%3DDTS10001588-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></P></BODY></HTML>