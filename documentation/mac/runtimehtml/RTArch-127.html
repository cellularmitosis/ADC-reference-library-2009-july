<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>The Far Model Jump Table </TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING127></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-126.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-128.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-115.html"><B>Chapter 10 - Classic 68K Runtime Architecture</B></A> / <A HREF="RTArch-124.html"><B>How 32-Bit Everything Is Implemented</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING127-0></A>
<H2><A NAME=MARKER-9-65></A><A NAME=MARKER-21-66></A>The Far Model Jump Table </H2>
 Compilation and linking with the option <CODE>-model far</CODE> results in a change in the format of the jump table and a change in the format of unloaded entries.<P>
<UL>
<LI>Because a segment can be larger than 32 KB, 4 bytes are required to describe the offset of a routine from the beginning of its segment. As the model near unloaded entry for a routine allowed only 2 bytes to specify the offset of the routine, this requires a change in the unloaded format of jump table entries.<A NAME=MARKER-2-67></A>
<LI>Because segments compiled with the option <CODE>-model near</CODE> can be linked with segments compiled with the option <CODE>-model far</CODE>, jump-table entries for the same segment are not necessarily contiguous.<P>
</UL>
 <A HREF=#MARKER-9-68>Figure 10-8</A> shows the unloaded jump table entry for a routine in a segment that is linked using the far model. As you can see, the modified entry omits the instruction that puts the segment number on the stack. The 2 bytes saved are then used to store the larger 4-byte offset that locates the routine within the segment. The Segment Manager gets the segment number from the entry itself and loads that segment.<P>
<B>Figure 10-8  <CODE><A NAME=MARKER-9-68></A></CODE>Far model unloaded jump table entry</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-26.jpg"> <P>
 In the standard near model jump table, entries for routines in the same segment are stored contiguously. In a jump table created for a program linked under the far model, entries for routines in the same segment might not be contiguous. Consider the case shown in <A HREF=#MARKER-9-69>Figure 10-9</A>. When the linker builds segment 1 and segment 2, it places code compiled with <CODE>-model near</CODE> within the first 32 KB and code with <CODE>-model far</CODE> beyond the 32 KB limit. <P>
 When the jump table is built, the linker places near-referenced entries within the first 32 KB; far-referenced entries are placed after all near references. Thus near and far references for the same segment can be stored in different areas of the jump table. In <A HREF=#MARKER-9-69>Figure 10-9</A>, the entry for <CODE>Module</CODE> <CODE>E</CODE> is not contiguous with near entries for the other modules contained in segment 2.<P>
<B>Figure 10-9  <A NAME=MARKER-9-69></A>Separation of near and far references in the far model jump table</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-27.jpg"> <P>
 The format of the jump table built for programs linked under the far model is different from that for programs built under the near model. <A HREF=#MARKER-9-70>Figure 10-10</A> shows the format of the far model jump table.<P>
<B>Figure 10-10  <A NAME=MARKER-9-70></A>The far model jump table structure</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-28.jpg"> <P>
 The first entry in the jump table is a near model format entry used to load a segment that patches the <CODE>_LoadSeg</CODE> trap, segment <I>n</I>. The next entry is an entry used to flag the far model format jump table. The third entry is a far model format entry. Remember that what's different about it affects only the information stored for its unloaded state. This third entry is used to load segment 1, which is the segment containing the program's main entry point.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-126.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-128.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
