<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>AEObject-Edition Sample - /Initialize.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; <A HREF="javascript:location.replace('index.html');">AEObject-Edition Sample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxInterapplicationCommunication-date.html" target="_blank">Carbon > Interapplication Communication</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">AEObject-Edition Sample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Initialize.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/AEObject-Edition Sample.r</option>
<option value="listing2.html">/AEObject.c</option>
<option value="listing3.html">/AEUtilities.c</option>
<option value="listing4.html">/AppleEventCore.c</option>
<option value="listing5.html">/BuildHeaders.c</option>
<option value="listing6.html">/Files.c</option>
<option value="listing7.html">/globals.c</option>
<option value="listing8.html">/Initialize.c</option>
<option value="listing9.html">/Macros.h</option>
<option value="listing10.html">/main.c</option>
<option value="listing11.html">/Menu.c</option>
<option value="listing12.html">/Print.c</option>
<option value="listing13.html">/prototypes.h</option>
<option value="listing14.html">/Publish.c</option>
<option value="listing15.html">/SampConstants.h</option>
<option value="listing16.html">/Sampdefines.h</option>
<option value="listing17.html">/Structs.h</option>
<option value="listing18.html">/Subscribe.c</option>
<option value="listing19.html">/TextSections.c</option>
<option value="listing20.html">/Utilities.c</option>
<option value="listing21.html">/Windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="AEObject-Edition_Sample.zip">Download Sample</a></strong> (&#147;AEObject-Edition_Sample.zip&#148;, 895.6K)<BR>
<strong><a href="AEObject-Edition_Sample.dmg">Download Sample</a></strong> (&#147;AEObject-Edition_Sample.dmg&#148;, 1.22M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*------------------------------------------------------------------------------**  Apple Developer Technical Support**  **  Program:    AEObject-Edition Sample*  File:   Initialize.c -C Source**  by: C.K. Haun &lt;TR&gt;**  Copyright &copy; 1990-1992 Apple Computer, Inc.*  All rights reserved.**------------------------------------------------------------------------------* This file contains some of our window handling routines.  I created it * primarily to take some of the clutter out of the main.c file.* It also contains the clipboard handlers*----------------------------------------------------------------------------*/#define __INIT__#include &quot;Sampdefines.h&quot;#include &lt;SegLoad.h&gt;#pragma segment MyInit/* StartStuff initializes the managers and does some other init stuff */void StartStuff(void){    long aLong;  OSErr myErr;        MaxApplZone();    MaxMem(&amp;aLong);    /* Nobody every says this, it's always assumed, but I'll tell yah... */    /* 'qd' is in the Runtime.o library (which is one reason you have to link it)  */    /* it doesn't come from the toolbox or any other magic place */    InitGraf((Ptr)&amp;qd.thePort);    InitFonts();    InitWindows();    InitMenus();    TEInit();    InitDialogs(nil);    MoreMasters();    /* See if AppleEvents and the Edition manager are available */    InitAEStuff();                                          /* In AppleEventM.c */    gHasEditionManager = (Gestalt(gestaltEditionMgrAttr, &amp;aLong) == noErr);    /* the value returned will be 1, but we don't really care here, since there aren't */    /* multiple versions of the Edition Manager yet */    if (gHasEditionManager) {        InitEditionPack();            } else {    ModalFilterUPP upp = NewModalFilterProc(standardAlertFilter);        Alert(kNoEditionManager, upp);                      /* tell 'em and exit */    DisposeRoutineDescriptor(upp);        ExitToShell();    }    GetCurrentProcess(&amp;gOurSN);                             /* grab our applications process serial number */    /* so we can communicate (send appleevents) to */    /* ourself easily */  myErr = Gestalt(gestaltQuickdrawVersion, &amp;aLong);  if(myErr == noErr &amp;&amp; (aLong &amp; 0xff00))     gHasColor = true;    StartMenus();                                           /* load the menu bar and set up the menus */    CreateClipBoard();    CreateAEStatus();    /* *** NOTE: I am not opening a document window here.  The application will wait for an */    /* 'oapp' or 'odoc' AppleEvent before opening a window.  This makes it a whole lot easier */    /* to deal with ODOC events, since you needn't special case anything */    gMySleep = 5;                                           /* initialize sleep at some reasonable level */    gWindObjSpecHandle = (WindowObjectDefHandle)NewHandleClear(sizeof(WindowObjectDef));    gTextObjSpecHandle = (TextObjectDefHandle)NewHandleClear(sizeof(TextObjectDef));    gShapeObjSpecHandle = (ShapeObjectDefHandle)NewHandleClear(sizeof(ShapeObjectDef));  gLocalInteraction = 0;  /* default this */  gAESendInteraction = 0;  gReplyMode = 1;    LoadPrefs();  gPreferences.prefsChanged = false;  /* and set it, it may have changed with the Prefs */   AESetInteractionAllowed(gLocalInteraction);    InitCursor();}/* end StartStuff */#pragma segment MyInit/* CreateClipBoard creates our invisible clipboard window at application *//* start time, and keeps it open always.  Visibility is toggled from the edit menu, *//* but the window always exists */void CreateClipBoard(void){    WindowPtr tempWindow;    windowCHandle tempWC;        /* open my clipboard window */    tempWindow = GetNewWindow(kClipWindow, 0, (WindowPtr)-1);        /* since I'm using the same function for my clipboard as for a document window, I have */    /* to change some of the fields */    ((WindowPeek)tempWindow)-&gt;windowKind = kClipboardWindow;    ((WindowPeek)tempWindow)-&gt;refCon = NewHandleClear(sizeof(windowControl));        /* add our control structure to it */    tempWC = (windowCHandle)GetWRefCon(tempWindow);         /* and put it where we can use it */    HLock((Handle)tempWC);                                  /* lock it down */    /* add pointers to our procedures for drawing, saving, and closing */    (*tempWC)-&gt;drawMe = (ProcPtr)DrawClip;    (*tempWC)-&gt;saveMe = (ProcPtr)nil;    (*tempWC)-&gt;closeMe = (ProcPtr)CloseClip;    (*tempWC)-&gt;clickMe = (ProcPtr)ClipClick;    (*tempWC)-&gt;sizeMe = (ProcPtr)SizeClip;    (*tempWC)-&gt;currentAction = nil;    (*tempWC)-&gt;undoAction = nil;    (*tempWC)-&gt;hasSelection = false;    (*tempWC)-&gt;windowDirty = false;    (*tempWC)-&gt;boxHandle = nil;    (*tempWC)-&gt;textSections = nil;    HUnlock((Handle)tempWC);    gScrapData = NewHandle(0);    UpdateScrap(false);                                     /* not visible, don't refresh */}/* end CreateClipBoard *//* CreateAEStatus creates our invisible AEStatus window at application *//* start time, and keeps it open always.  Visibility is toggled from the edit menu, *//* but the window always exists */void CreateAEStatus(void){    WindowPtr tempWindow;    windowCHandle tempWC;    WindowPtr tempPort;    Rect dest;    /* open my clipboard window */    tempWindow = GetNewWindow(kAEStatusWindowID, 0, (WindowPtr)-1);    ((WindowPeek)tempWindow)-&gt;windowKind = kAEStatusWindow;    /* since I'm using the same function for my clipboard as for a document window, I have */    /* to change some of the fields */    ((WindowPeek)tempWindow)-&gt;refCon = NewHandleClear(sizeof(windowControl));        /* add our control structure to it */    tempWC = (windowCHandle)GetWRefCon(tempWindow);         /* and put it where we can use it */    HLock((Handle)tempWC);                                  /* lock it down */    /* add pointers to our procedures for drawing, saving, and closing */    (*tempWC)-&gt;drawMe = (ProcPtr)DrawAES;    (*tempWC)-&gt;saveMe = (ProcPtr)SaveAES;    (*tempWC)-&gt;closeMe = (ProcPtr)CloseAES;    (*tempWC)-&gt;clickMe = (ProcPtr)ClickAES;    (*tempWC)-&gt;sizeMe = (ProcPtr)SizeAES;    (*tempWC)-&gt;currentAction = nil;    (*tempWC)-&gt;undoAction = nil;    (*tempWC)-&gt;hasSelection = false;    (*tempWC)-&gt;windowDirty = false;        (*tempWC)-&gt;textSections = nil;    (*tempWC)-&gt;fileAliasHandle = (AliasHandle)NewHandle(0);    (*tempWC)-&gt;windowDirty = false;  (*tempWC)-&gt;windowIndex = 999999; /* make abnormally large */    HUnlock((Handle)tempWC);    /* and this window has a  text edit field */    GetPort(&amp;tempPort);                                     /* save and set port so TextEdit puts the record in the right place */    SetPort(tempWindow);        dest = tempWindow-&gt;portRect;    dest.right -= 16;    (*tempWC)-&gt;boxHandle = TENew(&amp;dest, &amp;dest);    TEAutoView(true, (*tempWC)-&gt;boxHandle);                 /* make the text auto-scrolling */    SetPort(tempPort);}/* StartMenus loads our menu bar resource, and initializes the menus *   and some settings related to the menu items */void StartMenus(void){    MenuHandle tempHandle;    StringHandle helpString;    Handle myMBar;  short count;    myMBar = GetNewMBar(kOurMenuBar);    SetMenuBar(myMBar);    gAppleMenuHandle = GetMenuHandle(kAppleMenu);    gFileMenuHandle = GetMenuHandle(kFileMenu);    gEditMenuHandle = GetMenuHandle(kEditMenu);    gToolMenuHandle = GetMenuHandle(kToolsMenu);    gAppleEventMenuHandle = GetMenuHandle(kAEMenu);    gEditionMenuHandle = GetMenuHandle(kEditionMenu);    gWindowMenuHandle = GetMenuHandle(kWindowMenu);  if(gHasColor){    gColorMenuHandle = GetMenu(kColorMenu);    InsertMenu(gColorMenuHandle,0);    CheckItem(gColorMenuHandle,kBlackColorItem,true);    }      DrawMenuBar();      /* The following lines add my Help item to the Sys 7 Help menu. */    /* That's where help should go now, _not_ under the Apple Menu as we have  */    /* been doing for so long.  Since we now have an actual Help menu, use it, */    /* since your users will expect it. */    /* get the Help menu handle */    HMGetHelpMenuHandle(&amp;tempHandle);    /* How many items does it have? */    count = CountMItems(tempHandle);    /* get our help string from our resource fork */    helpString = GetString(kHelpString);    DetachResource(helpString);    HNoPurge(helpString);    MoveHHi((Handle)helpString);    HLock((Handle)helpString);    /* Add our help item to the help menu */    InsertMenuItem(tempHandle, (Ptr)*helpString, count + 1);    HUnlock(helpString);    HPurge(helpString);    /* Remember what our help item number is */    gHelpItem = CountMItems(tempHandle);        /* add heirarchical menus for AppleEvent menu */    tempHandle = GetMenu(kGetDataSubmenu);    InsertMenu(tempHandle, -1);    /* and the setdata hier */    tempHandle = GetMenu(kSetDataSubmenu);    InsertMenu(tempHandle, -1);        AppendResMenu(gAppleMenuHandle, 'DRVR');                   /* add DAs */}/* end StartMenus *//* InitAEStuff checks to see if this machine has AppleEvents and *   does our setup.*   If AppleEvents are not found, we alert and exit.*   This is also the place where all the handlers for AppleEvents we deal*   with are installed.  This includes the required AppleEvents, and the*   Edition Manager specific ones used in this app.*/#pragma segment MyInitvoid InitAEStuff(void){    extern Boolean gHasAppleEvents;    long aLong;    // leaks Routine Descriptors, but we'll live    AEinstalls HandlersToInstall[] =  {        /* The above are the four required AppleEvents. */ {            kCoreEventClass, kAEOpenApplication, NewAEEventHandlerProc(AEOpenHandler)        },  {            kCoreEventClass, kAEOpenDocuments, NewAEEventHandlerProc(AEOpenDocHandler)        },  {            kCoreEventClass, kAEPrintDocuments, NewAEEventHandlerProc(AEPrintHandler)        },  {            kCoreEventClass, kAEQuitApplication, NewAEEventHandlerProc(AEQuitHandler)        },         /* These are the five Edition Manager AppleEvents  */ {            kCoreEventClass, kAECreatePublisher, NewAEEventHandlerProc(AECreatePubHandler)        },  {            sectionEventMsgClass, sectionReadMsgID, NewAEEventHandlerProc(AEReadSectionHandler)        },  {            sectionEventMsgClass, sectionWriteMsgID, NewAEEventHandlerProc(AEWriteSectionHandler)        },  {            sectionEventMsgClass, sectionScrollMsgID, NewAEEventHandlerProc(AEScrollSectionHandler)        },  {            sectionEventMsgClass, sectionCancelMsgID, NewAEEventHandlerProc(AECancelSectionHandler)        },         /*  some core event handlers */ {            kAECoreSuite, kAEGetData, NewAEEventHandlerProc(AEGetDataHandler)        },  {            kAECoreSuite, kAESetData, NewAEEventHandlerProc(AESetDataHandler)        },  {            kAECoreSuite, kAEAnswer, NewAEEventHandlerProc(AEAnswerHandler)        }    };        // leaks Routine Descriptors, but we'll live  static CoercionInstalls CoercionsToInstall[] =  {        {            typeAlias, typeTargetID, NewAECoercePtrProc(CoerceAliasToTargetID), false        },  {            typeBoolean, typeChar, NewAECoercePtrProc(CoerceBooleanToChar), false        },  {            typeQDRectangle, typeChar, NewAECoercePtrProc(CoerceQDRectToChar), false        },         /* and two little coercions I just had to have... */ {            typeChar, typeMyPString, NewAECoercePtrProc(CoerceCharToPString), false        },  {            typeMyPString, typeChar, NewAECoercePtrProc(CoercePStringToChar), false        }    };      OSErr aevtErr = noErr;    aLong = 0;    /* Check this machine for AppleEvents.  If they are not here (ie not 7.0)    *   then we exit */    gHasAppleEvents = (Gestalt(gestaltAppleEventsAttr, &amp;aLong) == noErr);    /* The following series of calls installs all our AppleEvent Handlers.    *   These handlers are added to the application event handler list that     *   the AppleEvent manager maintains.  So, whenever an AppleEvent happens    *   and we call AEProcessEvent, the AppleEvent manager will check our    *   list of handlers and dispatch to it if there is one.    */    if (gHasAppleEvents) {        register qq;        for (qq = 0; qq &lt; ((sizeof(HandlersToInstall) / sizeof(AEinstalls))); qq++) {            aevtErr = AEInstallEventHandler(HandlersToInstall[qq].theClass, HandlersToInstall[qq].theEvent,                                            HandlersToInstall[qq].theProc, 0, false);                  if (aevtErr) {        ModalFilterUPP upp = NewModalFilterProc(standardAlertFilter);                Str31 text1, text2;                NumToString((long)aevtErr, text1);                text2[0] = 4;                BlockMove((Ptr)&amp;HandlersToInstall[qq].theEvent, (Ptr)text2, 4);                ParamText(text1, text2, &quot;&quot;, &quot;&quot;);                NoteAlert(kBadHInstall, upp);        DisposeRoutineDescriptor(upp);            }        }        /* now our coercion routines */        for (qq = 0; qq &lt; ((sizeof(CoercionsToInstall) / sizeof(AEinstalls))); qq++) {            aevtErr = AEInstallCoercionHandler(CoercionsToInstall[qq].fromType, CoercionsToInstall[qq].toType,                                               CoercionsToInstall[qq].theProc, nil, false, false);            if (aevtErr) {        ModalFilterUPP upp = NewModalFilterProc(standardAlertFilter);                Str31 text1, text2;                NumToString((long)aevtErr, text1);                text2[0] = 4;                BlockMove((Ptr)&amp;CoercionsToInstall[qq].fromType, (Ptr)text2, 4);                ParamText(text1, text2, &quot;&quot;, &quot;&quot;);                NoteAlert(kBadHInstall, upp);        DisposeRoutineDescriptor(upp);            }        }          } else {    ModalFilterUPP upp = NewModalFilterProc(standardAlertFilter);        Alert(kNoAppleEvents, upp);    DisposeRoutineDescriptor(upp);        ExitToShell();    }    /* this function initializes the OSL and installs our handlers */    aevtErr = InstallObjectHandlers();    if (aevtErr) {                ShowMe(&quot;\p Object Lib error, failing and exiting&quot;, aevtErr, __LINE__);        ExitToShell();    }    /* and one more thing, create my null descriptor to build all my objects from. */    /* you may want to do this each time, personal choice */    aevtErr = AECreateDesc(typeNull, nil, 0, &amp;gNullDesc);    mAEErrorDisplay(&quot;\pCreating nul desc&quot;, aevtErr)}/* end InitAEStuff */#undef __INIT__</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/AEObject-Edition_Sample/listing8.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/AEObject-Edition_Sample/listing8.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/AEObject-Edition_Sample/listing8.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>