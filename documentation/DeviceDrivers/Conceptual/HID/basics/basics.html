<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>HID Class Device Interface Guide: HID Access Overview</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="HID Access Overview"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000970-CH211" title="HID Access Overview"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../HardwareDrivers/index.html#//apple_ref/doc/uid/TP30000440-TP40003576" target="_top">Hardware &amp; Drivers</a> &gt; <a href="../../../../HardwareDrivers/HumanInterfaceDeviceForceFeedback-date.html#//apple_ref/doc/uid/TP30000440-TP40003576-TP30000855" target="_top">Human Interface Device &amp; Force Feedback</a> &gt; <a href="../intro/intro.html#//apple_ref/doc/uid/TP40000970-CH202-DontLinkElementID_6">HID Class Device Interface Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../overview/overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../workingwith/workingwith.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000970-CH211-CIHFIAID" title="HID Access Overview"></a><h1>HID Access Overview</h1><p>This chapter provides step-by-step instructions, including listings of sample code, for accessing a HID class device on Mac OS X. The sample code shows how to find all HID class devices, how to narrow the search to devices of a specific type, and how to open and communicate with the device.</p><p>To search the I/O Registry for a currently available HID class device, create a device interface for the device, and communicate with it, you perform the steps described in the following sections:</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CIHHJACD">“HID Access Overview”</a></span></p></li><li class="li"><p><span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CHDDJEAF">“Setting Up Your Programming Environment”</a></span></p></li><li class="li"><p><span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CHDHEGAJ">“Accessing the I/O Kit Master Port”</a></span></p></li><li class="li"><p><span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CHDGCEDC">“Finding a HID Class Device”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP40000970-CH211-CIHHJACD" title="HID Access Overview"></a><h2>HID Access Overview</h2><p>The following list of steps briefly describes how to find a HID class device, create a device interface for it, connect to it, and communicate with it. The remainder of this chapter gives a detailed example of this process, including sample code.</p><ol class="ol"><li class="li"><p>Find the object that represents the device in the I/O Registry. For an overview of this process, see the discussion of device matching in the chapter<span class="content_text"><a href="../../AccessingHardware/AH_Device_Access_IOKit/AH_Device_Access_IOKit.html#//apple_ref/doc/uid/TP30000378" target="_top">Device Access and the I/O Kit</a></span> of <em>Accessing Hardware From Applications</em>.</p></li><li class="li"><p>Create a device interface for the device. For a HID class device, you create a device interface of type <code><a href="../../../../Darwin/Reference/IOKit/IOHIDLibObsolete_h/Classes/IOHIDDeviceInterface/index.html#//apple_ref/c/cl/IOHIDDeviceInterface" target="_top">IOHIDDeviceInterface</a></code>. This device interface, defined in <code><a href="../../../../Darwin/Reference/IOKit/IOHIDLib_h/index.html#//apple_ref/doc/header/IOHIDLib.h" target="_top">IOHIDLib.h</a></code>, provides all the functions you need to access and communicate with your device.</p></li><li class="li"><p>Open a connection to the device by calling the <code>open</code> function of the device interface.</p></li><li class="li"><p>Communicate with the device using the functions provided by the HID Manager. For example, to get an element’s most recent value, use the <code><!--a-->getElementValue<!--/a--></code> function.</p><p>Functions for queue creation and manipulation are also provided by the HID Manager. For example, to read the next event from a queue, use the <code>getNextEvent</code> function; to request notification when a queue is no longer empty, use the function <code>setEventCallout</code>.</p></li><li class="li"><p>When you are finished with the device, call the <code>close</code> function of the device interface.</p></li><li class="li"><p>Release the device interface.</p></li></ol><a name="//apple_ref/doc/uid/TP40000970-CH211-CHDDJEAF" title="Setting Up Your Programming Environment"></a><h2>Setting Up Your Programming Environment</h2><p>The sample code in this document is from a Xcode project that builds a command-line tool. This section focuses on the use of Xcode to develop a test function for the device interface functions you’ll be using. You can find more detailed documentation for Xcode at <span class="content_text"><a href="../../../../../documentation/DeveloperTools/index.html" target="_top">http://developer.apple.com/documentation/DeveloperTools/index.html</a></span>.</p><p>To set up Xcode to build the device interface, do the following:</p><ol class="ol"><li class="li"><p>Choose “CoreFoundation Tool” (in the Command Line Utility) when creating your project or add <code>CoreFoundation.framework</code> to your External Frameworks and Libraries of an existing project.</p></li><li class="li"><p>Add <code>IOKit.framework</code> and <code>System.framework</code> to the External Frameworks and Libraries section of your project. (Click and drag from Finder.)</p></li><li class="li"><p>It is recommended that you initially build your project with debugging turned on. To do this in Xcode, open the target list by clicking on the disclosure triangle. Double-click on the only target listed. In the inspector that appears, click on the build tab, then check the checkbox next to ‘Generate Debug Symbols’.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40000970-CH211-DontLinkElementID_4" title="Note"></a><p><strong>Note:</strong>&nbsp; This chapter does not contain a complete sample tool. If your goal is to build a sample application to experiment with this code, you should download the companion files associated with this document, which include all of the code samples as a functioning tool. For more information, see <span class="content_text"><a href="../samples/samples.html#//apple_ref/doc/uid/TP40000970-CH212-CEGDJBFH">“Complete Code Samples.”</a></span></p></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40000970-CH211-DontLinkElementID_5" title="Note"></a><p><strong>Note:</strong>&nbsp;Although this code uses Core Foundation objects extensively, these objects are toll-free bridged to the equivalent Foundation objects (<code>CFArray</code> and <code>NSArray</code>, for example). For more information on using Core Foundation code in Cocoa applications, read <em><a href="../../../../Cocoa/Conceptual/CarbonCocoaDoc/index.html#//apple_ref/doc/uid/TP30000893" target="_top">Carbon-Cocoa Integration Guide</a></em>.</p></div><p><span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CCHHHAIJ">Listing 2-1</a></span> shows the header files you’ll need to include for the sample code in this document. Some of these headers include others; a shorter list may be possible. Except for <code>CoreFoundation.h</code>, these headers are generally part of <code>IOKit.framework</code> or <code>System.framework</code>, both of which are located in <code>/System/Library/Frameworks</code>.</p><a name="//apple_ref/doc/uid/TP40000970-CH211-CCHHHAIJ" title="Listing 2-1Header files to include for the sample code in this document "></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Header files to include for the sample code in this document </p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdlib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;unistd.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;ctype.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;sys/errno.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;sysexits.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;mach/mach.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;mach/mach_error.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;IOKit/IOKitLib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;IOKit/IOCFPlugIn.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;IOKit/hid/IOHIDLib.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;IOKit/hid/IOHIDKeys.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;CoreFoundation/CoreFoundation.h><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000970-CH211-CHDHEGAJ" title="Accessing the I/O Kit Master Port"></a><h2>Accessing the I/O Kit Master Port</h2><p>The sample code for working with HID class device interfaces begins with the <code>MyStartHIDDeviceInterfaceTest</code> function, shown in <span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CHDGAEJC">Listing 2-2</a></span>. This function establishes a connection to the I/O Kit and then calls functions to search for HID class devices and perform tests on each HID class device found. It accomplishes most of its work by calling the following functions:</p><ul class="ul"><li class="li"><p><code>MyFindHIDDevices</code>, shown in <span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-BABCGAHI">Listing 2-3</a></span>, sets up a matching dictionary and then searches for matching HID class devices</p></li><li class="li"><p><code>MyTestHIDDevices</code>, available in the downloadable source package, iterates over the set of matching devices and calls many of the functions in this sample to print property information and create and test a device interface for each device.</p></li></ul><a name="//apple_ref/doc/uid/TP40000970-CH211-CHDGAEJC" title="Listing 2-2A function that finds HID class devices in the I/O Registry and performs a test on each device"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>A function that finds HID class devices in the I/O Registry and performs a test on each device</p><div class="codesample"><table><tr><td scope="row"><pre>static void MyStartHIDDeviceInterfaceTest(void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    io_iterator_t hidObjectIterator = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    IOReturn ioReturnValue = kIOReturnSuccess;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    MyFindHIDDevices(kIOMasterPortDefault, &amp;hidObjectIterator);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (hidObjectIterator != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        MyTestHIDDevices(hidObjectIterator);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        //Release iterator. Don't need to release iterator objects.<span></span></pre></td></tr><tr><td scope="row"><pre>        IOObjectRelease(hidObjectIterator);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>MyStartHIDDeviceInterfaceTest</code> function releases both the master port it obtained and the iterator returned by the <code>MyFindHIDDevices</code> function, but it doesn’t release the iterator’s objects. They are released in the <code>MyTestHIDDevices</code> function after it uses the objects.</p><a name="//apple_ref/doc/uid/TP40000970-CH211-CHDGCEDC" title="Finding a HID Class Device"></a><h2>Finding a HID Class Device</h2><p>Before your application can create a device interface to access a device, it must first find the device in the I/O Registry. To do this, you create a matching dictionary specifying the type of device you want to find. Then you get an iterator for the list of devices that match your criteria so you can examine each one. </p><p>The following functions demonstrate this process by creating a matching dictionary and searching the I/O Registry for matching devices. If the search is successful, the function <code><!--a-->MyFindHIDDevices<!--/a--></code> (shown in <span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-BABCGAHI">Listing 2-3</a></span>) returns an iterator for the list of matched devices.</p><a name="//apple_ref/doc/uid/TP40000970-CH211-CHDFIDEE" title="Searching the I/O Registry"></a><h3>Searching the I/O Registry</h3><p>The <code>MyFindHIDDevices</code> function is the starting point for finding a specific type of device in the I/O Registry. First, it sets up a matching dictionary by passing <code>kIOHIDDeviceKey</code> (defined in <code><a href="../../../../Darwin/Reference/IOKit/IOHIDLib_h/index.html#//apple_ref/doc/header/IOHIDLib.h" target="_top">IOHIDLib.h</a></code>) to the I/O Kit function <code><!--a-->IOServiceMatching<!--/a--></code>. This defines a broad search for all objects in the I/O Registry that represent HID class devices. Then it calls the I/O Kit function <code>IOServiceGetMatchingServices</code>, which performs the search and, if successful, returns an iterator for the set of matching devices.</p><p>The parameters to <code>MyFindHIDDevices</code> are a Mach port and a pointer to an object iterator. The Mach port is obtained in a previous call to the <code>IOMasterPort</code> function—see <span class="content_text"><a href="basics.html#//apple_ref/doc/uid/TP40000970-CH211-CHDGAEJC">Listing 2-2</a></span>. The <code>MyFindHIDDevices</code> function uses the pointer to an object iterator to return an iterator that provides access to matching driver objects from the I/O Registry.</p><a name="//apple_ref/doc/uid/TP40000970-CH211-BABCGAHI" title="Listing 2-3A function that searches for HID devices that match the specified criteria"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>A function that searches for HID devices that match the specified criteria</p><div class="codesample"><table><tr><td scope="row"><pre>static void MyFindHIDDevices(mach_port_t masterPort,<span></span></pre></td></tr><tr><td scope="row"><pre>                io_iterator_t *hidObjectIterator)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableDictionaryRef hidMatchDictionary = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    IOReturn ioReturnValue = kIOReturnSuccess;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean noMatchingDevices = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Set up a matching dictionary to search the I/O Registry by class<span></span></pre></td></tr><tr><td scope="row"><pre>    // name for all HID class devices<span></span></pre></td></tr><tr><td scope="row"><pre>    hidMatchDictionary = IOServiceMatching(kIOHIDDeviceKey);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Now search I/O Registry for matching devices.<span></span></pre></td></tr><tr><td scope="row"><pre>    ioReturnValue = IOServiceGetMatchingServices(masterPort,<span></span></pre></td></tr><tr><td scope="row"><pre>                            hidMatchDictionary, hidObjectIterator);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    noMatchingDevices = ((ioReturnValue != kIOReturnSuccess)<span></span></pre></td></tr><tr><td scope="row"><pre>                                | (*hidObjectIterator == NULL));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //If search is unsuccessful, print message and hang.<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noMatchingDevices)<span></span></pre></td></tr><tr><td scope="row"><pre>        print_errmsg_if_err(ioReturnValue, "No matching HID class devices found.");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // IOServiceGetMatchingServices consumes a reference to the<span></span></pre></td></tr><tr><td scope="row"><pre>    //   dictionary, so we don't need to release the dictionary ref.<span></span></pre></td></tr><tr><td scope="row"><pre>    hidMatchDictionary = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>MyFindHIDDevices</code> function doesn’t release the reference it obtains to a matching dictionary because when it calls the I/O Kit function <code>IOServiceGetMatchingServices</code>, that function consumes a reference to the dictionary.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../overview/overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../workingwith/workingwith.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-05-06<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeviceDrivers/Conceptual/HID/basics/basics.html%3Fid%3DTP40000970-3.7&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeviceDrivers/Conceptual/HID/basics/basics.html%3Fid%3DTP40000970-3.7&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeviceDrivers/Conceptual/HID/basics/basics.html%3Fid%3DTP40000970-3.7&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>