<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A GXPD28: Can't Print Hairlines</title><meta name="keywords" content="Mac OS 7 QuickDraw GX printing Hairlines -51 error"><meta name="Description" content="Technical Q&amp;A GXPD28: NOTE: QuickDraw GX printer driversand GX printing extensions will not be supported in Mac OS8.0 or in future Mac OS releases. Q&amp;A explains how to drawand print hairlines, then takes an in depth look at the callsGXSetShapePen and GXSetStylePen, and gives possible reasonsfor an -51 error code. Q&amp;A also shows how to use a translatorcorrectly, to print hairlines."><meta name="categories" content="QuickDraw GX"><meta name="week-posted" content="Jul 31, 1995 - Aug 4, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001243" title="Can't Print Hairlines"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A GXPD28</div>
<div id="pageheadsub">Can't Print Hairlines</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->			<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><TABLE BORDER="0"><TR>	<td bgcolor="#e6e6e6" align=left>		<B>Important for all Apple Printing and Graphics Developers: </B><p id=p4>		The information in this Technical Q &amp; A is still relevant up to and including		<A HREF="../../technotes/tn/tn1090.html" target="_blank">Mac OS 7.6</A>		with QuickDraw GX 1.1.5. Beginning with the release of Mac OS 8.0,		however, Apple plans to deliver a system which incorporates QuickDraw GX		graphics and typography <B>only</B>. QuickDraw GX printer drivers and GX printing		extensions will <B>not</B> be supported in Mac OS 8.0 or in future Mac OS releases. Apple's		goal is to simplify the user experience of printing by unifying the Macintosh		graphic and printing architectures and standardizing on the classic Printing		Manager. </P>				For details on Apple's official announcement, refer to 		<A HREF="../../technotes/gxchange.html" target="_blank">		&lt;/dev/technotes/gxchange.html&gt;</A>	</TD></TR></TABLE><BR><p id = p2>Q:  How can I draw and print hairlines with QuickDraw GX? We use a PicComment inthe normal print code, but this seems to make QuickDraw GX fail. (We get a -51error, i.e., reference number invalid, when we call <code>GXGetJobError</code> after calling<code>GXFinishJob</code>, and we sometimes get this error without the <code>PicComment</code> code.)</p><p id="p4">We also tried calling <code>GXSetShapePen</code> in our spool procedure.  When we set it toa fractional value, we get a wide line, but when we set it to a wide value,such as 8, it works properly.  What do we need to do to print fractionalwidths?</p><p id="p4">I can print hairlines when I use:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SetPt((Point*)*lineWidth,2,1); PicComment(182,sizeof(Point),lineWidth);</pre>	</TD></TR></TABLE></CENTER><p id="p4">but they are one pixel wide not two-pixel-wide, half-width lines (I am passing1/2 in).</p><p id=p4>A:  Here are two ways to get QuickDraw GX to draw hairlines when printing:</p><ol type="1" start="1">	<li>Call <code>GXSetShapePen(myShape, 0)</code>;  This sets your pen width to 0, which indicates that your pen should be set as thin as renderable on the output device. QuickDraw GX always draws hairlines at the resolution of the output device -- one pixel wide.</li>	<li>Call <code>GXSetStylePen(myStyle, 0)</code>;  This also sets your pen width to 0.</li></ol><p id=p4>When using the <code>GXSetShapePen</code> and <code>GXSetStylePen</code> calls, don't specify the penwidth as an integer. Calling <code>GXSetStylePen(myStyle, 1)</code> sets the pen width to1/65536. Calling <code>GXSetStylePen(myStyle, ff(1))</code> sets the pen width to 1.0.</p><p id=p4>QuickDraw GX uses a backing store file (it's an invisible file within theSystem folder) to send QuickDraw GX objects to disk when additional space isneeded within the QuickDraw GX heap. </p><p id=p4>Almost all -51 errors from within QuickDraw GX or an application usingQuickDraw GX are caused by double-disposing of a QuickDraw GX object (i.e., ashape, ink, style, or transform). The -51 error occurs because the doubledispose causes QuickDraw GX to set the shape attributes, which tells QuickDrawGX that it has sent the QuickDraw GX object to disk. When it needs this object,it goes to the backing store and tries to get it, but it's not there. We havefound a few cases where QuickDraw GX was double-disposing of objects, and thesewere fixed in QuickDraw GX version 1.1.</p><p id=p4>Before calling <code>GXDrawShape</code> (before calling <code>GXFinishPage</code>), call <code>GXValidateShape</code>on the shape(s) you are trying print. This ensures that a shape is valid beforeit is drawn or printed. This slows things down a little, but you will be ableto determine if a shape is still available before you attempt to draw it (youmight be disposing of a shape before you draw it). If you have an error handlerinstalled, you usually receive the "shape_already_disposed" message, but youmay not receive this message if something is wrong with the QuickDraw GXbacking store.</p><p id=p4>It is also possible that the hairline drawing problems you are encountering arerelated to the translation options you are using. A translator takes yourQuickDraw drawing commands and converts them to QuickDraw GX objects, based onoptions you provide. If you use the <code>gxDefaultOptionsTranslation</code> setting, aQuickDraw line turns into a 6-sided filled polygon. When your object is apolygon, changing the pen width has no effect.</p><p id=p4>To avoid this, call <code>GXInstallQDTranslator()</code> with either the<code>gxSimpleGeometryTranslation</code> or the <code>gxReplaceLineWidthTranslation</code> option. The<code>gxSimpleGeometryTranslation</code> option turns on both the simple-lines andsimple-scaling translation options, and it translates QuickDraw lines intoQuickDraw GX lines with flat endcaps. The QuickDraw GX line shape runs alongthe center of the original QuickDraw line, and it covers all the pixels of theQuickDraw line and more. The <code>gxReplaceLineWidthTranslation</code> option turns aQuickDraw line into a QuickDraw GX line with a width that is the average of theoriginal pen's width and height. The <code>gxReplaceLineWidthTranslation</code> also affectsthe way the <code>SetLineWidth</code> PicComment is interpreted.</p><p id=p4>Once you set the translation option, your calls to <code>GXSetShapePen()</code> and/or<code>GXSetStylePen()</code> should behave as you expect them to, because they are acting onQuickDraw GX lines -- not polygons. When you have installed a translator, besure to remove it with <code>GXRemoveQDTranslator()</code>. To learn more about thetranslation options, see:</p><p id="p4">Chapter 1 of <i>Inside Macintosh: QuickDraw GXEnvironment and Utilities</i>.</p><p id="p4"><i>Inside Macintosh: QuickDraw GX Printing</i></p><a name="p4"><i>Inside Macintosh: QuickDraw GX Printing Extensions and Drivers</i></a><p id="p4"><i>Inside Macintosh: QuickDraw GX Graphics</i></p></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Aug 01 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/gxpd/gxpd28.html%3Fid%3DDTS10001243-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/gxpd/gxpd28.html%3Fid%3DDTS10001243-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/gxpd/gxpd28.html%3Fid%3DDTS10001243-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>