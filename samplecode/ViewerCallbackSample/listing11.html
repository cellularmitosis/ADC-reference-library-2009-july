<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ViewerCallbackSample - /Source/Viewer_Events.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">ViewerCallbackSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ViewerCallbackSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/Viewer_Events.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Headers/Viewer_Callbacks.h</option>
<option value="listing2.html">/Headers/Viewer_Error.h</option>
<option value="listing3.html">/Headers/Viewer_Events.h</option>
<option value="listing4.html">/Headers/Viewer_Main.h</option>
<option value="listing5.html">/Headers/Viewer_Menu.h</option>
<option value="listing6.html">/Headers/Viewer_Message.h</option>
<option value="listing7.html">/Headers/Viewer_System.h</option>
<option value="listing8.html">/Headers/Viewer_Window.h</option>
<option value="listing9.html">/Source/Viewer_Callbacks.c</option>
<option value="listing10.html">/Source/Viewer_Error.c</option>
<option value="listing11.html">/Source/Viewer_Events.c</option>
<option value="listing12.html">/Source/Viewer_Main.c</option>
<option value="listing13.html">/Source/Viewer_Menu.c</option>
<option value="listing14.html">/Source/Viewer_Message.c</option>
<option value="listing15.html">/Source/Viewer_System.c</option>
<option value="listing16.html">/Source/Viewer_Window.c</option></select>
				</p>
				</form>
				<p><strong><a href="ViewerCallbackSample.zip">Download Sample</a></strong> (&#147;ViewerCallbackSample.zip&#148;, 38.1K)<BR>
<strong><a href="ViewerCallbackSample.dmg">Download Sample</a></strong> (&#147;ViewerCallbackSample.dmg&#148;, 97.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  *  Viewer_Events.c * *  QuickDraw 3D 1.6 Sample *  Robert Dierkes * *   12/22/98  RDD    Created. *//*------------------*//*  Include Files  *//*------------------*/#include &quot;QD3D.h&quot;#include &quot;QD3DViewer.h&quot;#if defined(OS_MACINTOSH) &amp;&amp; OS_MACINTOSH#include &lt;MacWindows.h&gt;#include &lt;Events.h&gt;#include &lt;DiskInit.h&gt;#include &lt;ToolUtils.h&gt;#endif#include &quot;Viewer_Error.h&quot;#include &quot;Viewer_Events.h&quot;#include &quot;Viewer_Main.h&quot;#include &quot;Viewer_Menu.h&quot;#include &quot;Viewer_Window.h&quot;#include &quot;Viewer_System.h&quot;/*------------------*//*    Constants    *//*------------------*//*----------------------*//*  Extern Declarations  *//*----------------------*/extern  TQ3Boolean  gTimeToQuit;extern  WindowRef  gAppResizeWindow; /* For example 2 *//*----------------------*//*  Global Declarations  *//*----------------------*//*----------------------*//*   Type Definitions  *//*----------------------*//*----------------------*//*   Local Prototypes   *//*----------------------*/staticBoolean Events_HandleViewerEvents(      EventRecord        *pEvent);staticOSErr  Events_MouseDown(      EventRecord        *pEvent);staticOSErr  Events_KeyPress(      EventRecord        *pEvent);staticOSErr  Events_UpdateWindow(      EventRecord        *pEvent);staticOSErr  Events_Disk(      EventRecord        *pEvent);staticOSErr  Events_Activate(      EventRecord        *pEvent);staticOSErr  Events_ClickInContent(      EventRecord        *pEvent,      WindowPtr        pWindow);staticOSErr  Events_ClickInDrag(      EventRecord        *pEvent,      WindowPtr        window);//TODO  #if 0 /* SAVE */staticOSErr  Events_ClickInGrowBox(      EventRecord        *pEvent,      WindowPtr        pWindow);#if 0 /* SAVE */staticOSErr  Events_ClickInZoomBox(      EventRecord        *pEvent,      WindowPtr        pWindow,      short          windowPart);#endif /* SAVE */staticOSErr  Events_ClickInGoAway(      EventRecord        *pEvent,      WindowPtr        *hWindow);/* *  Events_Initialize */Boolean Events_Initialize(      void){  FlushEvents(everyEvent, 0);  return true;}/* *  Events_Process */void Events_Process(      void){  EventRecord   event;  OSErr      theErr    = noErr;  Boolean      doEvent    = false;  Boolean      wasHandled  = false;  while (! gTimeToQuit) {    /* Is there an event in the queue? */    doEvent = WaitNextEvent(everyEvent, &amp;event, 0, NULL);    wasHandled = Events_HandleViewerEvents(&amp;event);    if (! wasHandled) {      /* Viewer didn't handle event so do it here */      switch (event.what) {        case nullEvent:          break;        case mouseDown:          theErr = Events_MouseDown(&amp;event);          break;        case keyDown:        case autoKey:          theErr = Events_KeyPress(&amp;event);          break;        case updateEvt:          theErr = Events_UpdateWindow(&amp;event);          break;        case diskEvt:          theErr = Events_Disk(&amp;event);          break;        case activateEvt:          theErr = Events_Activate(&amp;event);          break;        case mouseUp:        case keyUp:        case osEvt:        case kHighLevelEvent:          break;      }    }    else {      /* Viewer already handled event */    }  }}#pragma mark -/* *  Events_HandleViewerEvents */staticBoolean Events_HandleViewerEvents(      EventRecord *pEvent){  WindowPtr    pWindow      = NULL;  TQ3ViewerObject  viewer      = NULL;  Boolean      wasHandled    = false;  Boolean      cursorChanged  = false;  Point      mousePt;  /* Get front window */  if ((pWindow = FrontWindow()) == NULL) {    return false;  }  /* Get Viewer reference from window's refcon */  if ((viewer = Window_GetViewer(pWindow)) == NULL) {    return false;  }  /* Let Viewer handle this event */  wasHandled = Q3ViewerEvent(viewer, pEvent);  /* Update cursor for current mouse location */  GetMouse(&amp;mousePt);    cursorChanged = Q3ViewerAdjustCursor(viewer, &amp;mousePt);  return wasHandled;}/* *  Events_UpdateWindow */OSErr Events_UpdateWindow(      EventRecord *pEvent){  OSErr      theErr = noErr;  WindowPtr    pUpdateWindow  = NULL;  GrafPtr      savedPort    = NULL;  TQ3ViewerObject  viewer      = NULL;  if ((pUpdateWindow = (WindowPtr) pEvent-&gt;message) == NULL) {    return paramErr;  }  if ((viewer = Window_GetViewer(pUpdateWindow)) == NULL) {    return paramErr;  }  /* Save port and set to Viewer's */  GetPort(&amp;savedPort);  SetPort(pUpdateWindow);  BeginUpdate(pUpdateWindow);    /* Update the Viewer model and button control strip */    theErr = Q3ViewerDraw(viewer);  EndUpdate(pUpdateWindow);  /* Restore port */  SetPort(savedPort);  return theErr;}/* *  Events_MouseDown */staticOSErr Events_MouseDown(      EventRecord *pEvent){  OSErr      theErr = noErr;  WindowPtr    pWindow = NULL;  short      windowPart;  windowPart = FindWindow(pEvent-&gt;where, &amp;pWindow);  switch (windowPart) {  case inMenuBar:     theErr = Menu_Command(MenuSelect (pEvent-&gt;where));    break;  case inSysWindow:    SystemClick(pEvent, pWindow);    break;  case inContent:    if (FrontWindow() != pWindow) {      SelectWindow(pWindow);    }    theErr = Events_ClickInContent(pEvent, pWindow);  break;  case inDrag:    theErr = Events_ClickInDrag(pEvent, pWindow);    break;  case inGrow://TODOif(1){//TODO    if (pWindow == gAppResizeWindow) {      theErr = Events_ClickInGrowBox(pEvent, pWindow);    }    else {        /*         * Handllng mouse down events in the Viewer's grow box are controlled         * by setting the Viewer's kQ3ViewerDrawGrowBox flag.         */        theErr = noErr;    }//TODO#if 0 /* SAVE */    theErr = Events_ClickInGrowBox(pEvent, pWindow);//#else      /*       * Handllng mouse down events in the Viewer's grow box are controlled       * by setting the Viewer's kQ3ViewerDrawGrowBox flag.       */      theErr = noErr;#endif /* SAVE */    break;  case inGoAway:    theErr = Events_ClickInGoAway(pEvent, &amp;pWindow);    break;  case inZoomIn:  case inZoomOut:#if 0 /* SAVE */    theErr = Events_ClickInZoomBox(pEvent, pWindow, windowPart);#else      theErr = noErr;#endif /* SAVE */    break;  case inCollapseBox:      theErr = noErr;    break;  default:      theErr = paramErr;    break;  }  return theErr;}/* *  Events_KeyPress */staticOSErr Events_KeyPress(      EventRecord    *pEvent){  OSErr    theErr = noErr;  char    charCode;  charCode = ((pEvent-&gt;message) &amp; charCodeMask);  if (pEvent-&gt;modifiers &amp; btnState) {    /* Button is UP with a key */    if (pEvent-&gt;modifiers &amp; cmdKey) {      theErr = Menu_Command(MenuKey(charCode));    }    else {    }  }  else {    /* Button is DOWN with a key */  }  return theErr;}/* *  Events_Disk */staticOSErr Events_Disk(      EventRecord *pEvent){  OSErr    theErr = noErr;  Point    topLeft;  if ((theErr = HiWord(pEvent-&gt;message)) != noErr) {    return theErr;  }  SetPt(&amp;topLeft, 100, 100);  (void) DIBadMount(topLeft, pEvent-&gt;message);  return theErr;}/* *  Events_Activate */staticOSErr Events_Activate(      EventRecord  *pEvent){  OSErr    theErr = noErr;  WindowPtr  pActiveWindow;  if ((pActiveWindow = (WindowPtr) pEvent-&gt;message) == NULL) {    return paramErr;  }  /* Activate window */  if (pEvent-&gt;modifiers &amp; activeFlag)  {    /* Enable/Disable items */    SetPort (pActiveWindow);  }  else  /* Deactivate window */  {    /* Enable/Disable items */  }  return theErr;}#pragma mark -/* *  Events_ClickInContent */staticOSErr Events_ClickInContent(      EventRecord    *pEvent,      WindowPtr    pWindow){  TQ3ViewerObject  viewer = NULL;  Boolean      wasHandled = false;  GrafPtr      savedPort;  if ((viewer = Window_GetViewer(pWindow)) == NULL) {    return paramErr;  }  /*   * There is a bug in versions 1.0.4 and earlier of the Viewer,   * so the port has to be set and restored.   */  GetPort(&amp;savedPort);  SetPort((GrafPtr) pWindow);  /* Handle mouse click inside Viewer */  wasHandled = Q3ViewerEvent(viewer, pEvent);  SetPort(savedPort);  return noErr;}/* *  Events_ClickInDrag */staticOSErr Events_ClickInDrag(      EventRecord    *pEvent,      WindowPtr    window){  GrafPtr      savedPort;  RgnHandle    tempRgn;  Rect      dragRect;  GetPort(&amp;savedPort);  SetPort((GrafPtr) window);   tempRgn = GetGrayRgn();    dragRect = (**tempRgn).rgnBBox;    DragWindow(window, pEvent-&gt;where, &amp;dragRect);  SetPort(savedPort);  return noErr;}//TODO  #if 0 /* SAVE *//* *  Events_ClickInGrowBox */staticOSErr Events_ClickInGrowBox (      EventRecord    *pEvent,      WindowPtr    pWindow){  long    newSize;  Rect    newRect,        oldRect,        screenRect;  GrafPtr    savedPort;  screenRect = (**GetGrayRgn()).rgnBBox;  screenRect.left =  screenRect.top  = 64;  oldRect = newRect = pWindow-&gt;portRect;  GetPort (&amp;savedPort);  SetPort (pWindow);  newSize = GrowWindow (pWindow, pEvent-&gt;where, &amp;screenRect);  if (newSize != 0) {    newRect.right  = newRect.left + ((short) newSize);    newRect.bottom  = newRect.top  + ((short) (newSize &gt;&gt; 16));    SizeWindow (pWindow,          (short)(newRect.right  - newRect.left),          (short)(newRect.bottom - newRect.top),          true);    InvalRect (&amp;oldRect);  }  SetPort (savedPort);  return noErr;}#if 0 /* SAVE *//* *  Events_ClickInZoomBox */staticOSErr Events_ClickInZoomBox (      EventRecord    *pEvent,      WindowPtr    pWindow,      short      windowPart){  Rect  bounds;  GrafPtr  savedPort;  GetPort(&amp;savedPort);  SetPort(pWindow);  if (TrackBox(pWindow, pEvent-&gt;where, windowPart))  {    ZoomWindow(pWindow, windowPart, true);    bounds = pWindow-&gt;portRect;    InvalRect(&amp;bounds);  }  SetPort(savedPort);  return noErr;}#endif /* SAVE *//* * Events_ClickInGoAway */OSErr Events_ClickInGoAway(      EventRecord        *pEvent,      WindowPtr        *hWindow){  OSErr  theErr = noErr;  if (TrackGoAway(*hWindow, pEvent-&gt;where)) {    theErr = Window_CloseViewer(hWindow);  }  return theErr;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ViewerCallbackSample/listing11.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ViewerCallbackSample/listing11.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ViewerCallbackSample/listing11.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>