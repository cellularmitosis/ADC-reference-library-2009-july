<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Manipulating a Sound That Is Playing (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.e.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.b.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.10.htm">Next</A> |</P></DIV><!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H3.Heading3"><A NAME="pgfId=2907"> </A><A NAME="16808"> </A>Manipulating a Sound That Is Playing<A NAME="marker=328"> </A></H1><P CLASS="T0.Text0"><A NAME="pgfId=2908"> </A>The Sound Manager provides a number of sound commands that you can use to change some of the characteristics of sounds that are currently playing. For example, you can alter the rate at which a sampled sound is played back, thereby lowering or increasing the pitch of the sound. You can also pause or stop a sound that is currently in progress. See <A target="doc" HREF="imsoundmgr.11.htm#12236" CLASS="XRef">&quot;Pausing and Restarting Sound Channels&quot;</A> for information on how to pause the processing of a sound channel.</P><P CLASS="T1.Text1"><A NAME="pgfId=2909"> </A>You can use the <TT CLASS="cv">getRateCmd</TT> command to determine the rate at which a sampled sound is currently playing. If <TT CLASS="cv">SndDoImmediate</TT> returns <TT CLASS="cv">noErr</TT> when you pass <TT CLASS="cv">getRateCmd</TT>, the current sample rate of the channel is returned as a <TT CLASS="cv">Fixed</TT> value in the location that is pointed to by <TT CLASS="cv">param2</TT> of the sound command. (As usual, the high bit of that value returned is not interpreted as a sign bit.) Values that specify sampling rates are always interpreted relative to the 22&nbsp;kHz rate. That is, the <TT CLASS="cv">Fixed</TT> value $00010000 indicates a rate of 22&nbsp;kHz. The value $00020000 indicates a rate of 44&nbsp;kHz. The value $00008000 indicates a rate of 11&nbsp;kHz.<A NAME="marker=494"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=2910"> </A>To modify the pitch of a sampled sound currently playing, use the <TT CLASS="cv">rateCmd</TT> command. The current pitch is set to the rate specified in the <TT CLASS="cv">param2</TT> field of the sound command. <A target="doc" HREF="imsoundmgr.f.htm#23581" CLASS="XRef">Listing 1-14</A> illustrates how to halve the frequency of a sampled sound that is already playing. Note that sending the <TT CLASS="cv">rateCmd</TT> command before a sound plays has no effect.<A NAME="marker=564"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=2912"> </A>Listing&nbsp;14 <A NAME="23581"> </A>Halving the frequency of a sampled sound</P><CODE CLASS="Cv.Code"><A NAME="pgfId=9717"> </A>FUNCTION MyHalveFreq (mySndChan: SndChannelPtr): OSErr;<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;myRate:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{rate of sound play}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SndCommand;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a sound command}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;{Get the rate of the sample currently playing.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.cmd := getRateCmd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{the command is getRateCmd}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param1 := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{unused}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param2 := LongInt(@myRate);<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr := SndDoImmediate(mySndChan, mySndCmd);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;IF myErr = noErr THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Halve the sample rate.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.cmd := rateCmd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{the command is rateCmd}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param1 := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{unused}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param2 := FixDiv(myRate, $00020000);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SndDoImmediate(mySndChan, mySndCmd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyHalveFreq := myErr;<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=2305"> </A><A NAME="marker=9719"> </A>When you halve the frequency of a sampled sound using the technique in <A target="doc" HREF="imsoundmgr.f.htm#23581" CLASS="XRef">Listing 1-14</A>, the sound will play one octave lower than before. In addition, the sound will play twice as slowly as before. Likewise, if you use the <TT CLASS="cv">rateCmd</TT> command to double the frequency of a sound, it plays one octave higher and twice as fast. Using <TT CLASS="cv">rateCmd</TT> in this way is like pressing the fast forward button on a tape player while the play button remains depressed.</P><P CLASS="T1.Text1"><A NAME="pgfId=2314"> </A>You can also use <TT CLASS="cv">rateCmd</TT> and <TT CLASS="cv">getRateCmd</TT> to pause a sampled sound that is currently playing. To do this, read the rate at which it is playing, issue a <TT CLASS="cv">rateCmd</TT> command with a rate of 0, and then issue a <TT CLASS="cv">rateCmd</TT> command with the previous rate when you want the sound to resume playing.<A NAME="marker=865"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=2916"> </A><A NAME="marker=1377"> </A>To change the amplitude (or loudness) of the sound in progress, issue the <TT CLASS="cv">ampCmd</TT> command. (See <A target="doc" HREF="imsoundmgr.f.htm#15468" CLASS="XRef">Listing 1-15</A> for an example.) If no sound is currently playing, <TT CLASS="cv">ampCmd</TT> sets the amplitude of the next sound. Specify the desired new amplitude in the <TT CLASS="cv">param1</TT> field of the sound command as a value in the range 0 to 255. <A NAME="marker=605"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=2315"> </A>Listing&nbsp;15 <A NAME="15468"> </A>Changing the amplitude of a sound channel</P><CODE CLASS="Cv.Code"><A NAME="pgfId=9723"> </A>PROCEDURE MySetAmplitude (chan: SndChannelPtr; myAmp: Integer);<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SndCommand;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a sound command}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF chan &lt;&gt; NIL THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH mySndCmd DO<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd := ampCmd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{the command is ampCmd}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param1 := myAmp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{desired amplitude}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param2 := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ignored}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SndDoImmediate(chan, mySndCmd);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF myErr &lt;&gt; noErr THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoError(myErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=2317"> </A><A NAME="marker=9725"> </A>If your application has an option that allows users to turn off sound output, you could call the <TT CLASS="cv">MySetAmplitude</TT> procedure on all open channels to set the amplitude of all channels to 0. Note that the Sound control panel allows the user to adjust the sound from 0 (softest) to 7 (loudest). This value is independent of the values used for amplitudes of sounds playing in channels, and the Sound Manager uses the Sound control panel value jointly with the amplitude of a sound channel to determine how loudly to play a sound. Sounds with low frequencies sound softer than sounds with high frequencies even if the sounds play at the same amplitude. If the amplitude of a sound is 0, the sound hardware produces no sound; however, when the value set in the Sound control panel is 0, sound might still play, depending on the amplitude.<A NAME="marker=867"> </A><A NAME="marker=868"> </A><A NAME="marker=869"> </A><A NAME="marker=870"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=2319"> </A><A NAME="marker=624"> </A>You can use the <TT CLASS="cv">getAmpCmd</TT> command to determine the current amplitude of a sound in progress. The <TT CLASS="cv">getAmpCmd</TT> command is similar to <TT CLASS="cv">getRateCmd</TT>, except that the value returned is an integer. The value returned in <TT CLASS="cv">param2</TT> is in the range 0-255. <A target="doc" HREF="imsoundmgr.f.htm#11962" CLASS="XRef">Listing 1-16</A> shows an example:</P><P CLASS="L.Listing"><A NAME="pgfId=2318"> </A>Listing&nbsp;16 <A NAME="11962"> </A>Getting the amplitude of a sound in progress</P><CODE CLASS="Cv.Code"><A NAME="pgfId=9729"> </A>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;myAmp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.cmd := getAmpCmd;<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param1 := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{unused}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndCmd.param2 := LongInt(@myAmp);<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr := SndDoImmediate(mySndChan, mySndCmd);<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=2313"> </A><A NAME="marker=9731"> </A>To modify the timbre of a sound defined using by square-wave data, use the <TT CLASS="cv">timbreCmd</TT> command. A sine wave is specified as 0 in <TT CLASS="cv">param1</TT> and produces a very clear sound. A value of 254 in <TT CLASS="cv">param1</TT> represents a modified square wave and produces a buzzing sound. To avoid a bug in some versions of the Sound Manager, you should not use the value 255. You should change the timbre before playing the sound.<A NAME="marker=627"> </A><A NAME="marker=600"> </A></P><hr>&#169; 1998 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.e.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.b.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.10.htm">Next</A> |</P></DIV><!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>