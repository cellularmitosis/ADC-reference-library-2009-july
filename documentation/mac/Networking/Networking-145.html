<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The ATP Packet Format(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING145></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-144.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-146.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-143.html"><B>Chapter 6 - AppleTalk Transaction Protocol (ATP)</B></A> / <A HREF="Networking-144.html"><B>About ATP</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING145-0></A>
<H2><A NAME=MARKER-9-39></A>The ATP Packet Format</H2>
 An ATP <A NAME=MARKER-2-178></A>packet includes an 8-byte header followed by up to 578 bytes of data. An ATP packet is preceded by the DDP header that, in turn, is preceded by the data-link header, <A NAME=MARKER-2-138></A>referred to as the <I>frame</I> header. <P>
 The ATP header contains the following information:<P>
<UL>
<LI>The first byte consists of control information. Bits within this byte are set to identify aspects of a request or a response function.
<LI>The second byte contains a <A NAME=MARKER-9-148></A><B>bitmap/sequence number.</B> This field is 8 bits wide, and <BR>its use and significance depend on whether the ATP packet is a request packet or a response packet. For request packets, this field is referred to as the <A NAME=MARKER-2-172></A><B>transaction bitmap,</B> and it identifies the number of buffers that a requester application has reserved for the response data. For response packets, this field is referred to as the <B><A NAME=MARKER-9-11></A>ATP sequence number,</B> and it is used to identify the sequential position of the response packet in the complete response message; ATP uses the sequence number <BR>to manage and handle lost or out-of-sequence response packets. 
<LI>The third and fourth bytes carry the transaction ID assigned to a request and used by the response to that request.
<LI>The fifth through eighth bytes carry <A NAME=MARKER-2-3></A>user data; an application can use these bytes for its own purposes, for example, to transfer command information.<A NAME=MARKER-2-18></A><P>
</UL>
 <A NAME=MARKER-2-87></A>The ATP data follows the header. It can consist of from 0 to 578 bytes. An ATP packet is enclosed in a DDP datagram that is enclosed in a data-link frame. <A HREF=#MARKER-9-49>Figure 6-3</A> shows a close-up view of the first byte of the ATP header, the control information byte<A NAME=MARKER-2-76></A>. <P>
<B>Figure 6-3  <A NAME=MARKER-9-49></A>The ATP packet header control information byte</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ATP-L-03.jpg"><P>
<A NAME=HEADING145-10></A>
<H4>The Control Information Byte</H4>
 ATP applications call response and request functions that generate request and <BR>response packets. (ATP uses the release packet internally.) When set, the bits have <BR>the following meanings:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Bit<TH>Meaning <TR>
<TD>0<TD>Use the DDP <A NAME=MARKER-2-81></A>checksum feature for this packet.<TR>
<TD>1<TD>ATP has assigned the request transaction ID; the TID field value is now valid. <TR>
<TD>2<TD>This request uses an extended parameter block. <TR>
<TD>3<TD>To the requester: retransmit the request immediately (<A NAME=MARKER-2-4></A>send-transmission status).<TR>
<TD>4<TD>This is the last packet of the response message (end of message).<TR>
<TD>5<TD>This request is an <A NAME=MARKER-2-24></A>exactly-once transaction. </TABLE>
<P>
<A NAME=HEADING145-12></A>
<H4><A NAME=MARKER-9-50></A>The Bitmap/Sequence Number </H4>
 ATP ensures <A NAME=MARKER-2-153></A>reliable delivery of data. This means that ATP retransmits all lost or dropped packets, and if it is unable to complete a transaction properly, ATP returns an error as the function result. To receive all the packets that make up a response message, <BR>a requester application must provide enough buffer space to hold the data. A request message consists of a single packet, while each <A NAME=MARKER-2-53></A><B>response message</B> can contain up to eight response packets. <P>
 Response packets are numbered from 0 to 7. ATP uses the<A NAME=MARKER-2-5></A> sequence number to manage the transmission and receipt of response packets; the packet header ATP sequence number field contains 8 bits, 1 for each response packet. <P>
 ATP sets the <A NAME=MARKER-2-8></A>sequence number in the request header to tell the .ATP driver code on the <A NAME=MARKER-2-142></A>responder side which response packets the requester has not received. When a requester does not receive a complete response message, the .ATP driver code on the responder side can then send again only the packets that the requester side has not received, based on the bit settings of the transaction sequence number. ATP handles the retransmission of data internally without requiring any action on the part of your application. For information about the buffer records, see <A HREF=Networking-155.html#MARKER-9-108>"The Buffer Data Structure" on page 6-20</A>. <P>
<A NAME=HEADING145-16></A>
<H4>The Transaction ID</H4>
 The third and fourth bytes of the ATP header carry a 16-bit <A NAME=MARKER-2-16></A>transaction ID. The .ATP driver code on the requester side of a transaction assigns a unique transaction ID to each request that a requester application makes. The responder application that services the request includes this number as a parameter to the response call that it issues to send <BR>its response back to the requester. The transaction ID ties together the request and its response, ensuring that ATP delivers the correct data in response to each request. An application can issue and have pending multiple concurrent asynchronous requests; ATP uses the transaction ID to keep track of them. <P>
<A NAME=HEADING145-18></A>
<H4>User Bytes</H4>
 ATP does not <A NAME=MARKER-2-32></A>concern itself with the last 4 bytes of the ATP header. They are reserved for your use. You can use these bytes for any purpose prearranged by the requester and responder applications. The ATP functions include a parameter that you use to specify this data. <A NAME=MARKER-2-18></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-144.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-146.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
