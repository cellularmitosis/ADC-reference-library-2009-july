<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects XML Serialization Guide: Serializing Objects and Data</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Serializing Objects and Data"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000180" title="Serializing Objects and Data"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../AboutThisBook/AboutThisBook.html#//apple_ref/doc/uid/TP30000177-DontLinkElementID_4">WebObjects XML Serialization Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Serialization/Serialization.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Transformation/Transformation.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000180-SW36" title="Serializing Objects and Data"></a><h1>Serializing Objects and Data</h1><p><span class="content_text"><a href="../Serialization/Serialization.html#//apple_ref/doc/uid/TP30000179-SW16">“XML Serialization Essentials”</a></span> explained that serialization is a useful way to implement component-to-component communication or application-to-application communication. This chapter guides you through the creation of a simple WebObjects application that shows how serialization, both binary-based and XML-based, can be implemented.</p><p>The chapter is divided in two sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW1">“Binary Serialization Example”</a></span> walks you through the creation of the Serialization project, which includes an example utility class called BinarySerializer, used to serialize objects and data into binary files.</p></li><li class="li"><p><span class="content_text"><a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW18">“XML Serialization Example”</a></span> shows how to use WebObjects XML serialization with the example class named XMLSerializer to serialize objects and data. It demonstrates that serializing to XML documents is just as easy as serializing to binary files. In addition, it teaches you how to include keys in the XML documents that represent serialized data. These keys can make it easier to transform those documents into a format that other applications expect. Finally, it explains the use of NSXMLOutputFormat objects to set output-format properties for NSXMLOutputStream objects.</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW1">Binary Serialization Example</a>
				
			<br/>
			
        
			
			
				<a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW18">XML Serialization Example</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000180-SW1" title="Binary Serialization Example"></a><h2>Binary Serialization Example</h2><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_121"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_122"></a>This section guides you through the creation of a straightforward application that serializes and deserializes objects and primitive values into and from binary form using Java's binary-serialization facilities.</p><a name="//apple_ref/doc/uid/TP30000180-SW2" title="Creating the Serialization Project"></a><h3>Creating the Serialization Project</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_123"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_124"></a>Using Project Builder, create a WebObjects application project named Serialization. You don't need to add any frameworks to the project, such as the Java JDBC Adaptor framework. (You can look at the finalized project in <code>projects/Serializing/Binary/Serialization</code>.)</p><br/><div><img src = "../art/project_start.gif" alt = "Serialization.pbproj" width="734" height="438"></div><br/><a name="//apple_ref/doc/uid/TP30000180-SW3" title="Adding the BinarySerializer Class"></a><h3>Adding the BinarySerializer Class</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_125"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_126"></a>The BinarySerializer class manages binary serialization and deserialization to and from files. To save yourself some typing, you can add the <code>BinarySerializer.java</code> file in <code>projects/Serializing/Binary/Serialization</code> to your project's Application Server target. Otherwise, follow the steps below.</p><ol class="ol"><li class="li"><p>Select the Classes group in the Serializer project.</p></li><li class="li"><p>Choose File > New File.</p></li><li class="li"><p>In the New File pane of the Project Builder Assistant, select Java Class under WebObjects and click Next.</p></li><li class="li"><p>In the New Java Class pane, name the class <code>BinarySerializer</code> and click Finish.</p></li><li class="li"><p>Replace the template code in <code>BinarySerializer.java</code> with the code in <span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW1">“BinarySerialization.java.”</a></span></p></li></ol><p><code>BinarySerializer.java</code> provides two main functions: serialization and deserialization of objects and creation and disposal of ObjectOutputStream and ObjectInputStream objects.</p><p>The <code>serializeObject</code> and <code>deserializeObject</code> methods serialize and deserialize objects to and from a file. You can use the <code>openStream</code> and <code>closeStream</code> methods to serialize primitive-type values or individual objects. See <span class="content_text"><a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW24">“Serializing Primitive-Type Values to an XML Document”</a></span> for an example.</p><a name="//apple_ref/doc/uid/TP30000180-SW4" title="Serializing an NSArray of Strings"></a><h3>Serializing an NSArray of Strings</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_127"></a>Now that you have the BinarySerializer class as part of your project, you can use it to serialize objects.</p><p>The first step is to add three methods to the Application class: one that instantiates, populates, and serializes an NSArray of Strings; a second one that deserializes and displays the data; and a third one that invokes the other two. <span class="content_text">Listing 3-1</span> shows the methods.</p><a name="//apple_ref/doc/uid/TP30000180-SW5" title="Listing 3-1The serializeArray, deserializeArray, and arraySerialization methods in Application.java"></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>The <code>serializeArray</code>, <code>deserializeArray</code>, and <code>arraySerialization</code> methods in <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Creates and serializes an NSArray of Strings.<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier      identifies the target file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                        path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializeArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Instantiate object to serialize.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray book_titles =  new NSArray(new Object[] {"The Chestry Oak", "A Tree for Peter", "The White Stag"});<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize the object.<span></span></pre></td></tr><tr><td scope="row"><pre>    BinarySerializer.serializeObject(book_titles, identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes an NSArray and writes its contents to the console.<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier      identifies the source file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                        path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializeArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize the data and assign it to an NSArray object.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray books = (NSArray)BinarySerializer.deserializeObject(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Display the contents of &lt;code>books&lt;/code> on the console<span></span></pre></td></tr><tr><td scope="row"><pre>    // (the Run pane in Project Builder).<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("** Deserialized NSArray **");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println(books);<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Invokes the &lt;code>serializeArray&lt;/code> and<span></span></pre></td></tr><tr><td scope="row"><pre> * &lt;code>deserializeArray&lt;/code> methods.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void arraySerialization() {<span></span></pre></td></tr><tr><td scope="row"><pre>    String identifier = "BookTitles";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize NSArray object.<span></span></pre></td></tr><tr><td scope="row"><pre>    serializeArray(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize NSArray object.<span></span></pre></td></tr><tr><td scope="row"><pre>    deserializeArray(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Finally, modify the Application class's constructor so that it looks like <span class="content_text">Listing 3-2</span>.</p><a name="//apple_ref/doc/uid/TP30000180-SW6" title="Listing 3-2The constructor in Application.java"></a><p class="codesample"><strong>Listing 3-2&nbsp;&nbsp;</strong>The constructor in <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Creates an Application object. Invoked once during application startup.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public Application() {<span></span></pre></td></tr><tr><td scope="row"><pre>    super();<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("Welcome to " + this.name() + "!");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Test serialization of an array.<span></span></pre></td></tr><tr><td scope="row"><pre>    arraySerialization();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>After you build and run the application, Project Builder's Run pane should look similar to <span class="content_text">Listing 3-1</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW7" title="Figure 3-1Project Builder&#39;s Run pane when running the array-serialization example"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>Project Builder's Run pane when running the array-serialization example</p><img src = "../art/console_nsarray.gif" alt = "Project Builder's Run pane when running the array-serialization example" width="829" height="462"></div><br/><p>If you open <code>/tmp/BookTitles_data.binary</code> (generated by the serialization process) in a text editor, you should see something similar to <span class="content_text">Listing 3-2</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW8" title="Figure 3-2BinaryTitles_data.binary file viewed through a text editor"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong><code>BinaryTitles_data.binary</code> file viewed through a text editor</p><img src = "../art/binary_nsarray.gif" alt = "BinaryTitles_data.binary file viewed through a text editor" width="571" height="228"></div><br/><p>This hardly qualifies as human-readable. <span class="content_text"><a href="../Serialization/Serialization.html#//apple_ref/doc/uid/TP30000179-SW16">“XML Serialization Essentials”</a></span> shows you how to create files with serialized data that are easier for people to read and modify.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_128"></a></p><a name="//apple_ref/doc/uid/TP30000180-SW9" title="Serializing Primitive-Type Values"></a><h3>Serializing Primitive-Type Values</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_129"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_130"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_131"></a>This section shows you how to serialize primitive-type values that are not encapsulated by objects. To accomplish this, you instantiate an ObjectOutputStream and invoke one or more of its <code>write</code> methods.</p><p>Add three methods to the Application class of the Serialization project: one that serializes values of type <code>int</code>, <code>boolean</code>, <code>char</code> and <code>double</code>; a second that deserializes the data; and a third one that calls the other two. <span class="content_text">Listing 3-3</span> gives you an example of such methods.</p><a name="//apple_ref/doc/uid/TP30000180-SW10" title="Listing 3-3The serializePrimitives, deserializePrimitives, and primitiveSerialization methods in Application.java"></a><p class="codesample"><strong>Listing 3-3&nbsp;&nbsp;</strong>The <code>serializePrimitives</code>, <code>deserializePrimitives</code>, and <code>primitiveSerialization</code> methods in <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes a set of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename    identifies the target file, including its<span></span></pre></td></tr><tr><td scope="row"><pre> *                    path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param an_int      value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_boolean   value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_char      value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_double    value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializePrimitives(String filename, int an_int, boolean a_boolean, char a_char, double a_double) {<span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        ObjectOutputStream stream = BinarySerializer.openOutputStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values.<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeInt(an_int);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeBoolean(a_boolean);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeChar(a_char);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeDouble(a_double);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        BinarySerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes a set of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename   identifies the source file, including its<span></span></pre></td></tr><tr><td scope="row"><pre> *                   path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializePrimitives(String filename) {<span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        ObjectInputStream stream = BinarySerializer.openInputStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Read values.<span></span></pre></td></tr><tr><td scope="row"><pre>        int the_int = stream.readInt();<span></span></pre></td></tr><tr><td scope="row"><pre>        boolean the_boolean = stream.readBoolean();<span></span></pre></td></tr><tr><td scope="row"><pre>        char the_char = stream.readChar();<span></span></pre></td></tr><tr><td scope="row"><pre>        double the_double = stream.readDouble();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        BinarySerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values to console (Run pane in Project Builder).<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("** Deserialized primitives **");<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("int: " + the_int);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("boolean: " + the_boolean);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("char: " + the_char);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("double: " + the_double);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Invokes the &lt;code>serializePrimitives&lt;/code> and<span></span></pre></td></tr><tr><td scope="row"><pre> * &lt;code>deserializePrimitives&lt;/code> methods.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void primitiveSerialization() {<span></span></pre></td></tr><tr><td scope="row"><pre>    String filename = "/tmp/PrimitiveValues_data.binary";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>    serializePrimitives(filename, 5, true, 'u', 3.14);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>    deserializePrimitives(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>You also need to add the following to the Application class:</p><div class="codesample"><table><tr><td scope="row"><pre>import java.io.IOException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectOutputStream;<span></span></pre></td></tr></table></div><p>Finally, add a call to the <code>primitiveSerialization</code> method in the Application class's constructor:</p><div class="codesample"><table><tr><td scope="row"><pre>// Test serialization of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>primitiveSerialization();<span></span></pre></td></tr></table></div><p>Build and run the application. Project Builder's Run pane should look similar to <span class="content_text">Listing 3-3</span>.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_132"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_133"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_134"></a></p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW11" title="Figure 3-3Project Builder&#39;s Run pane when running the primitive-values serialization example"></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>Project Builder's Run pane when running the primitive-values serialization example</p><img src = "../art/console_primitives.gif" alt = "Project Builder's Run pane when running the primitive-values serialization example" width="837" height="465"></div><br/><a name="//apple_ref/doc/uid/TP30000180-SW12" title="Serializing Custom Objects"></a><h3>Serializing Custom Objects</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_135"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_136"></a>Now that you've mastered the art of serializing an instance of a WebObjects Serializable class and primitive-type values, you're ready to tackle the serialization of custom objects. For this, you create a Movie class that includes <code>writeObject</code> and <code>readObject</code> methods.</p><p>Add a class named Movie to the Serialization project and assign it to the Application Server target. Modify <code>Movie.java</code> so that it looks like <span class="content_text">Listing 3-4</span>. (Alternatively, you can add the <code>Movie.java</code> file in <code>projects/Serializing/Binary/Serialization</code> to your project.)</p><a name="//apple_ref/doc/uid/TP30000180-SW13" title="Listing 3-4Movie.java using binary serialization"></a><p class="codesample"><strong>Listing 3-4&nbsp;&nbsp;</strong><code>Movie.java</code> using binary serialization</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.appserver.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.xml.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.IOException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.Serializable;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.sql.Timestamp;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Manages movie information.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class Movie extends Object implements Serializable {<span></span></pre></td></tr><tr><td scope="row"><pre>    private String title;<span></span></pre></td></tr><tr><td scope="row"><pre>    private String studio;<span></span></pre></td></tr><tr><td scope="row"><pre>    private NSTimestamp releaseDate;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Creates a Movie object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param name          movie title<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param studio        studio that released the movie<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param release_date  date the movie was released<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie(String title, String studio, NSTimestamp releaseDate) {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        setTitle(title);<span></span></pre></td></tr><tr><td scope="row"><pre>        setStudio(studio);<span></span></pre></td></tr><tr><td scope="row"><pre>        setReleaseDate(releaseDate);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets this movie's title.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return movie title.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public String title() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return this.title;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Sets this movie's title.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param value            movie's title<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public void setTitle(String value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        this.title = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets this movie's studio.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return movie studio.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public String studio() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return this.studio;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Sets this movie's studio.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param value           studio's name<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public void setStudio(String value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        this.studio = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets this movie's release date.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return movie release date.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public NSTimestamp releaseDate() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return this.releaseDate;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Sets this movie's release date.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param value          release date<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public void setReleaseDate(NSTimestamp value) {<span></span></pre></td></tr><tr><td scope="row"><pre>        this.releaseDate = value;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets the string representation of this movie.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return string representing this movie.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public String toString() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return "(Movie: (Title: " + title() + "), (Studio: " + studio() + "), (Release Date: " + releaseDate().toString() +  "))";<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Serializes this object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param stream   object stream to serialize this object to<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void writeObject(ObjectOutputStream stream) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Serialize the object's instance members.<span></span></pre></td></tr><tr><td scope="row"><pre>        // (This is where you put special encoding logic,<span></span></pre></td></tr><tr><td scope="row"><pre>        // such as the one used to encode the releaseDate field.)<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeObject(title());<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeObject(studio());<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeObject(releaseDate().toString());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Deserializes this object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param stream   object stream from which the serialized data<span></span></pre></td></tr><tr><td scope="row"><pre>     *                 is obtained<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void readObject(ObjectInputStream stream) throws IOException, ClassNotFoundException {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Deserializes the data a put it in the object's instance members.<span></span></pre></td></tr><tr><td scope="row"><pre>        // (This is where you would put special de-encoding logic<span></span></pre></td></tr><tr><td scope="row"><pre>        // such as the one used to decode the releaseDate field.)<span></span></pre></td></tr><tr><td scope="row"><pre>        setTitle((String)stream.readObject());<span></span></pre></td></tr><tr><td scope="row"><pre>        setStudio((String)stream.readObject());<span></span></pre></td></tr><tr><td scope="row"><pre>        setReleaseDate(_timestampFromString((String)stream.readObject()));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Converts a string into an NSTimestamp.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param timestampAsString     string to convert<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return NSTimestamp object represented by timestampAsString.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private NSTimestamp _timestampFromString(String timestampAsString) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSTimestampFormatter formatter = new NSTimestampFormatter();<span></span></pre></td></tr><tr><td scope="row"><pre>        java.text.ParsePosition pp = new java.text.ParsePosition(0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return (NSTimestamp)formatter.parseObject(timestampAsString, pp);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Now add the methods in <span class="content_text">Listing 3-5</span> to <code>Application.java</code>.</p><a name="//apple_ref/doc/uid/TP30000180-SW14" title="Listing 3-5The serializeMovie, deserializeMovie, and movieSerialization methods in Application.java"></a><p class="codesample"><strong>Listing 3-5&nbsp;&nbsp;</strong>The <code>serializeMovie</code>, <code>deserializeMovie</code>, and <code>movieSerialization</code> methods in <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes a Movie object.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier   identifies the target file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                     a path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializeMovie(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the local time zone.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTimeZone timeZone = NSTimeZone.timeZoneWithName("America/Los_Angeles", true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Movie movie = new Movie("Alien", "20th Century Fox", new NSTimestamp(1979, 10, 25, 0, 0, 0, timeZone));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    BinarySerializer.serializeObject(movie, identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes Movie data into an object.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier   identifies the source file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                     a path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializeMovie(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie movie = (Movie)BinarySerializer.deserializeObject(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("** Deserialized Movie object **");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println(movie.toString());<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Invokes the &lt;code>movieSerialization&lt;/code> and<span></span></pre></td></tr><tr><td scope="row"><pre> * &lt;code>movieDeserialization&lt;/code> methods.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void movieSerialization() {<span></span></pre></td></tr><tr><td scope="row"><pre>    String identifier = "Movie";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    serializeMovie(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>    deserializeMovie(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Finally, modify the Application class's constructor by adding a call to the <code>movieSerialization</code> method:</p><div class="codesample"><table><tr><td scope="row"><pre>// Serialize a Movie object.<span></span></pre></td></tr><tr><td scope="row"><pre>movieSerialization();<span></span></pre></td></tr></table></div><p>After building and running the application, you should see something similar to <span class="content_text">Listing 3-4</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW15" title="Figure 3-4Project Builder&#39;s Run pane when running the Movie-object serialization example"></a><p><strong>Figure 3-4&nbsp;&nbsp;</strong>Project Builder's Run pane when running the Movie-object serialization example</p><img src = "../art/console_movie.gif" alt = "Project Builder's Run pane when running the Movie-object serialization example" width="810" height="475"></div><br/><p>The remainder of the section shows you how to serialize an NSMutableArray of Movies and deserialize the data into an NSArray.</p><p>Add the methods shown in <span class="content_text">Listing 3-6</span> to <code>Application.java</code>.</p><a name="//apple_ref/doc/uid/TP30000180-SW16" title="Listing 3-6The serializeMovieArray, deserializeMovieArray, and movieArraySerialization methods of Application.java"></a><p class="codesample"><strong>Listing 3-6&nbsp;&nbsp;</strong>The <code>serializeMovieArray</code>, <code>deserializeMovieArray</code>, and <code>movieArraySerialization</code> methods of <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes a Movie array.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier   identifies the target file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                     a path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializeMovieArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the local time zone.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTimeZone timeZone = NSTimeZone.timeZoneWithName("America/Los_Angeles", true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Initialize the array.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray movies = new NSMutableArray();<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Alien", "20th Century Fox", new NSTimestamp(1979, 10, 25, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Blade Runner", "Warner Brothers", new NSTimestamp(1982, 1, 3, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Star Wars", "20th Century Fox", new NSTimestamp(1977, 12, 29, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize the array.<span></span></pre></td></tr><tr><td scope="row"><pre>    BinarySerializer.serializeObject(movies, identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes Movie data into an NSArray.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier   identifies the source file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                     a path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializeMovieArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create an empty array.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray movies = new NSArray();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize data into movies.<span></span></pre></td></tr><tr><td scope="row"><pre>    movies = (NSArray)BinarySerializer.deserializeObject(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("** Deserialized Movie array **");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println(movies.toString());<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Invokes the &lt;code>movieArraySerialization&lt;/code> and<span></span></pre></td></tr><tr><td scope="row"><pre> * &lt;code>movieArrayDeserialization&lt;/code> methods.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void movieArraySerialization() {<span></span></pre></td></tr><tr><td scope="row"><pre>    String identifier = "Movies";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    serializeMovieArray(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>    deserializeMovieArray(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Add a call to the <code>movieArraySerialization</code> method in the Application class's constructor and build and run the application. The Project Builder Run pane should look like <span class="content_text">Listing 3-5</span>.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_137"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_138"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_139"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_140"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_141"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_142"></a></p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW17" title="Figure 3-5Project Builder&#39;s Run pane when running the Movie-array serialization example"></a><p><strong>Figure 3-5&nbsp;&nbsp;</strong>Project Builder's Run pane when running the Movie-array serialization example</p><img src = "../art/console_movie_array.gif" alt = "Project Builder's Run pane when running the Movie-array serialization example" width="806" height="470"></div><br/><a name="//apple_ref/doc/uid/TP30000180-SW18" title="XML Serialization Example"></a><h2>XML Serialization Example</h2><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_143"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_144"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_145"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_146"></a>As you learned in <span class="content_text"><a href="../Serialization/Serialization.html#//apple_ref/doc/uid/TP30000179-SW16">“XML Serialization Essentials”</a></span> WebObjects XML serialization works essentially the same way Java binary serialization does. This section shows how to modify the Serialization project so that it uses a new class, XMLSerializer, to serialize and deserialize objects and data.</p><p>If you did not create the Serialization project in <span class="content_text"><a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW1">“Binary Serialization Example,”</a></span> you can get it from this document's example projects in <code>projects/Serializing/Binary</code>.</p><a name="//apple_ref/doc/uid/TP30000180-SW19" title="Adding the XMLSerializer Class"></a><h3>Adding the XMLSerializer Class</h3><p>Start by adding a new class called <code>XMLSerializer.java</code> to the project and assigning it to the Application Server target. Then modify the class so that it looks like <span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW3">“XMLSerializer.java.”</a></span> (Alternatively, you can add the <code>XMLSerializer.java</code> file in <code>projects/Serializing/XML/Serialization</code> to your project.)</p><a name="//apple_ref/doc/uid/TP30000180-SW20" title="Serializing an NSArray of Strings to an XML Document"></a><h3>Serializing an NSArray of Strings to an XML Document</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_147"></a>Now that the Serialization project contains the utility class XMLSerializer, modify the <code>serializeArray</code> and <code>deserializeArray</code> methods in <code>Application.java</code> so that they look like <span class="content_text">Listing 3-7</span>. (All you need to do is change occurrences of <code>BinarySerializer</code> to <code>XMLSerializer</code> in the lines numbered 1 and 2.)</p><a name="//apple_ref/doc/uid/TP30000180-SW21" title="Listing 3-7The serializeArray and deserializeArray methods in Application.java using XML serialization"></a><p class="codesample"><strong>Listing 3-7&nbsp;&nbsp;</strong>The <code>serializeArray</code> and <code>deserializeArray</code> methods in <code>Application.java</code> using XML serialization</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Creates and serializes an NSArray of Strings.<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier          identifies the target file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                            path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializeArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Instantiate object to serialize.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray book_titles =  new NSArray(new Object[] {"The Chestry Oak", "A Tree for Peter", "The White Stag"});<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize the object.<span></span></pre></td></tr><tr><td scope="row"><pre>    XMLSerializer.serializeObject(book_titles, identifier);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes an NSArray and writes its contents to the console.<span></span></pre></td></tr><tr><td scope="row"><pre> * @param identifier          identifies the source file, without a<span></span></pre></td></tr><tr><td scope="row"><pre> *                            path or an extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializeArray(String identifier) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize the data and assign it to an NSArray object.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray books = (NSArray)XMLSerializer.deserializeObject(identifier);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Display the contents of &lt;code>books&lt;/code> on the console<span></span></pre></td></tr><tr><td scope="row"><pre>    // (the Run pane in Project Buider).<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("** Deserialized NSArray **");<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println(books);<span></span></pre></td></tr><tr><td scope="row"><pre>    System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>After building and running the application, you can find the <code>BookTitles_data.xml</code> file (shown in <span class="content_text">Listing 3-8</span>) in <code>/tmp</code>.</p><a name="//apple_ref/doc/uid/TP30000180-SW22" title="Listing 3-8BookTitles_data.xml (serialized array of Strings)"></a><p class="codesample"><strong>Listing 3-8&nbsp;&nbsp;</strong><code>BookTitles_data.xml</code> (serialized array of Strings)</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content xmlns="http://www.apple.com/webobjects/XMLSerialization"<span></span></pre></td></tr><tr><td scope="row"><pre>xmlns:xsi="http://www.w3.org/2001/XMLSchema-<span></span></pre></td></tr><tr><td scope="row"><pre>instance" xsi:schemaLocation="http://www.apple.com/webobjects/XMLSerialization<span></span></pre></td></tr><tr><td scope="row"><pre>http://www.apple.com/webobjects/5.2/schemas/woxml.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;object id="2"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;class flag="3" id="0" name="com.webobjects.foundation.NSArray" suid="-<span></span></pre></td></tr><tr><td scope="row"><pre>3789592578296478260"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;field name="objects" type="java.lang.Object[]"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;array field="objects" id="4" ignoreEDB="1" length="3" type="java.lang.Object[]"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string id="5">The Chestry Oak&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string id="6">A Tree for Peter&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string id="7">The White Stag&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/object><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div>	<p>As you can see, the serialized version of the NSArray object is easier to read than <code>BookTitles_data.binary</code>, created in <span class="content_text"><a href="Serializing.html#//apple_ref/doc/uid/TP30000180-SW4">“Serializing an NSArray of Strings.”</a></span> <span class="content_text">Listing 3-6</span> graphically depicts <code>BookTitles_data.xml</code>. However, the document is somewhat verbose. <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW13">“Transforming XML Documents”</a></span> shows you how to transform XML streams generated by NSXMLOutputStream into streamlined XML documents.</p><br/><div><a name="//apple_ref/doc/uid/TP30000180-SW23" title="Figure 3-6The element hierarchy of the BoolTitles_data.xml document"></a><p><strong>Figure 3-6&nbsp;&nbsp;</strong>The element hierarchy of the <code>BoolTitles_data.xml</code> document</p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_148"></a><img src = "../art/booktitles_data_xml.gif" alt = "The element hierarchy of the BoolTitles_data.xml document" width="269" height="484"></div><br/><a name="//apple_ref/doc/uid/TP30000180-SW24" title="Serializing Primitive-Type Values to an XML Document"></a><h3>Serializing Primitive-Type Values to an XML Document</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_149"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_150"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_151"></a>By now you've probably noticed how easy it is to serialize objects into XML documents. This section shows you how to serialize primitive-type values.</p><p>First, add the following code line to <code>Application.java</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.foundation.xml.*;<span></span></pre></td></tr></table></div><p>Now, modify the <code>serializePrimitives</code> and <code>deserializePrimitives</code> methods so that they match <span class="content_text">Listing 3-9</span> (You need to modify only the five numbered lines.)</p><a name="//apple_ref/doc/uid/TP30000180-SW25" title="Listing 3-9The serializePrimitives, deserializePrimitives and primitiveSerialization methods in Application.java using XML serialization"></a><p class="codesample"><strong>Listing 3-9&nbsp;&nbsp;</strong>The <code>serializePrimitives</code>, <code>deserializePrimitives</code> and <code>primitiveSerialization</code> methods in <code>Application.java</code> using XML serialization</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes a set of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename     identifies the target file, including its<span></span></pre></td></tr><tr><td scope="row"><pre> *                     path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> * @param an_int       value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_boolean    value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_char       value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_double     value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serializePrimitives(String filename, int an_int, boolean a_boolean,<span></span></pre></td></tr><tr><td scope="row"><pre>char a_char, double a_double) {<span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream stream = XMLSerializer.openOutputStream(filename, null);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values.<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeInt(an_int);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeBoolean(a_boolean);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeChar(a_char);<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeDouble(a_double);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        XMLSerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes a set of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename     identifies the source file, including<span></span></pre></td></tr><tr><td scope="row"><pre> *                     its path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserializePrimitives(String filename) {<span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLInputStream stream = XMLSerializer.openInputStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Read values.<span></span></pre></td></tr><tr><td scope="row"><pre>        int the_int = stream.readInt();<span></span></pre></td></tr><tr><td scope="row"><pre>        boolean the_boolean = stream.readBoolean();<span></span></pre></td></tr><tr><td scope="row"><pre>        char the_char = stream.readChar();<span></span></pre></td></tr><tr><td scope="row"><pre>        double the_double = stream.readDouble();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        XMLSerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values to console (Run pane in Project Builder).<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("** Deserialized primitives **");<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("int: " + the_int);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("boolean: " + the_boolean);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("char: " + the_char);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("double: " + the_double);<span></span></pre></td></tr><tr><td scope="row"><pre>        System.out.println("");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Invokes the &lt;code>serializePrimitives&lt;/code> and<span></span></pre></td></tr><tr><td scope="row"><pre> * &lt;code>deserializePrimitives&lt;/code> methods.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void primitiveSerialization() {<span></span></pre></td></tr><tr><td scope="row"><pre>    String filename = "/tmp/PrimitiveValues_data.xml";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>    serializePrimitives(filename, 5, true, 'u', 3.14);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Deserialize primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>    deserializePrimitives(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Notice the signature of the <code>openOutputStream</code> method of the XMLSerializer class (<span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW4">Listing B-2</a></span>):</p><div class="codesample"><table><tr><td scope="row"><pre>openOutputStream(String filename, String transformation) throws IOException;<span></span></pre></td></tr></table></div><p>The invoking code specifies the type of transformation to perform on the serialized data through the <em>transformation</em> parameter. In this case, however, <code>serializePrimitives</code> does not perform a transformation; therefore, it invokes <code>openOutputStream</code> with <em>transformation</em> set to <code>null</code>. See <span class="content_text"><a href="../Transformation/Transformation.html#//apple_ref/doc/uid/TP30000181-SW8">“XML Transformation”</a></span> for more information on transforming XML documents.</p><p>After building and running the application, your<code> /tmp</code> directory should contain the <code>PrimitiveValues_data.xml</code>. file. <span class="content_text">Listing 3-10</span> shows its contents.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_152"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_153"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_154"></a></p><a name="//apple_ref/doc/uid/TP30000180-SW26" title="Listing 3-10The PrimitiveValues_data.xml file"></a><p class="codesample"><strong>Listing 3-10&nbsp;&nbsp;</strong>The <code>PrimitiveValues_data.xml</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content xmlns="http://www.apple.com/webobjects/XMLSerialization" xmlns:xsi="http://www.w3.org/2001/<span></span></pre></td></tr><tr><td scope="row"><pre>XMLSchema-instance" xsi:schemaLocation="http://www.apple.com/webobjects/<span></span></pre></td></tr><tr><td scope="row"><pre>XMLSerialization<span></span></pre></td></tr><tr><td scope="row"><pre>http://www.apple.com/webobjects/5.2/schemas/woxml.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;int>5&lt;/int><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;boolean>true&lt;/boolean><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;ch>u&lt;/ch><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;double>3.14&lt;/double><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000180-SW27" title="Serializing With Keys"></a><h3>Serializing With Keys</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_155"></a>Keys can help a great deal in describing what a data element represents. Adding keys to values as they are serialized is a simple process. Modify <code>serializePrimitives</code> so that it looks like <span class="content_text">Listing 3-11</span> (change the numbered code lines), and build and run the application.</p><a name="//apple_ref/doc/uid/TP30000180-SW28" title="Listing 3-11The serializePrimitives method of Application.java using keys to identify elements in XML document"></a><p class="codesample"><strong>Listing 3-11&nbsp;&nbsp;</strong>The <code>serializePrimitives</code> method of <code>Application.java</code> using keys to identify elements in XML document</p><div class="codesample"><table><tr><td scope="row"><pre>public void serializePrimitives(String filename, int an_int, boolean a_boolean, char a_char, double a_double) {<span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream stream = XMLSerializer.openOutputStream(<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        filename, null);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values.<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeInt(an_int, "my_integer");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeBoolean(a_boolean, "my_boolean");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeChar(a_char, "my_char");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeDouble(a_double, "my_double");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        XMLSerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Now, after building and running the project, the <code>PrimitiveValues_data.xml</code> file looks like <span class="content_text">Listing 3-12</span>.</p><a name="//apple_ref/doc/uid/TP30000180-SW29" title="Listing 3-12The PrimitiveValues_data.xml file with keys identifying each element"></a><p class="codesample"><strong>Listing 3-12&nbsp;&nbsp;</strong>The <code>PrimitiveValues_data.xml</code> file with keys identifying each element</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content xmlns="http://www.apple.com/webobjects/XMLSerialization"<span></span></pre></td></tr><tr><td scope="row"><pre>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<span></span></pre></td></tr><tr><td scope="row"><pre>xsi:schemaLocation="http://www.apple.com/webobjects/XMLSerialization<span></span></pre></td></tr><tr><td scope="row"><pre>http://www.apple.com/webobjects/5.2/schemas/woxml.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;int key="my_integer">5&lt;/int><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;boolean key="my_boolean">true&lt;/boolean><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;ch key="my_char">u&lt;/ch><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;double key="my_double">3.14&lt;/double><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div><p>The code in <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW6">“Transforming Primitive-Type Values Using Keys”</a></span> takes advantage of the <code>key</code> attribute on each element of the <code>content</code> element to transform the source XML document in <span class="content_text">Listing 3-12</span> to one that uses the values of those keys as the tag names of the elements that contain the data values in the target document, shown in <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW9">Listing 5-6</a></span>.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_156"></a></p><a name="//apple_ref/doc/uid/TP30000180-SW30" title="Serializing Custom Objects to an XML Document"></a><h3>Serializing Custom Objects to an XML Document</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_157"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_158"></a>You can take advantage of keys in custom Serializable objects by invoking the <code>writeObject(Object, String)</code> method of NSXMLOutputStream<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_159"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_160"></a> in the <code>writeObject</code> method of your custom class. To accomplish this, however, you have to cast the ObjectOutputStream argument to NSXMLOutputStream before invoking the<code> writeObject(Object, String)</code> method.</p><p>Modify the <code>writeObject</code> method of <code>Movie.java</code> so that it looks like <span class="content_text">Listing 3-13</span>.</p><a name="//apple_ref/doc/uid/TP30000180-SW31" title="Listing 3-13The writeObject method in Movie.java using XML serialization with keys"></a><p class="codesample"><strong>Listing 3-13&nbsp;&nbsp;</strong>The <code>writeObject</code> method in <code>Movie.java</code> using XML serialization with keys</p><div class="codesample"><table><tr><td scope="row"><pre>private void writeObject(ObjectOutputStream stream) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Serialize the object's instance members.<span></span></pre></td></tr><tr><td scope="row"><pre>    // (This is where you put special encoding logic;<span></span></pre></td></tr><tr><td scope="row"><pre>    // this example doesn't perform any special encoding.)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Cast stream to NSXMLOutputStream to gain access to<span></span></pre></td></tr><tr><td scope="row"><pre>    // &lt;code>writeObject(Object, String)&lt;/code>.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSXMLOutputStream xml_stream = (NSXMLOutputStream)stream;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    xml_stream.writeObject(title(), "title");<span></span></pre></td></tr><tr><td scope="row"><pre>    xml_stream.writeObject(studio(), "studio");<span></span></pre></td></tr><tr><td scope="row"><pre>    xml_stream.writeObject(releaseDate().toString(), "release_date");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Now, modify the <code>serializeMovie</code>, <code>deserializeMovie</code>, <code>serializeMovieArray</code> and <code>deserializeMovieArray</code> methods in <code>Application.java</code> so that they use the XMLSerializer class's <code>serializeObject</code> and <code>deserializeObject</code> methods, respectively.</p><p>Build and run the application. If you open<code> /tmp/Movies_data.xml</code> in a text editor, you'll see something similar to the contents of <span class="content_text">Listing 3-14</span>. Notice the <code>key</code> attribute included in the data elements of each <code>object</code> element corresponding to a Movie object. The <code>key</code> attribute is used by the transformation script in <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW10">“Transforming an Array of Movies”</a></span> to generate the data elements of the target document.</p><p>Also notice that the third Movie object in <code>Movies_data.xml</code> (starting at the line numbered 2) contains a reference to the studio defined in the first Movie object (the line numbered 1) instead of the name of the studio. This is how multiple references<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_161"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_162"></a> to the same object are represented in XML documents generated by NSXMLOutputStream.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_163"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_164"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_165"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_166"></a></p><a name="//apple_ref/doc/uid/TP30000180-SW32" title="Listing 3-14The Movies_data.xml file"></a><p class="codesample"><strong>Listing 3-14&nbsp;&nbsp;</strong>The <code>Movies_data.xml</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content xmlns="http://www.apple.com/webobjects/XMLSerialization"<span></span></pre></td></tr><tr><td scope="row"><pre>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.apple.com/webobjects/XMLSerialization<span></span></pre></td></tr><tr><td scope="row"><pre>http://www.apple.com/webobjects/5.2/schemas/woxml.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;object id="3"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;class flag="2" id="0"<span></span></pre></td></tr><tr><td scope="row"><pre>            name="com.webobjects.foundation.NSMutableArray" suid="-3909373569895711876"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;super flag="3" id="1"<span></span></pre></td></tr><tr><td scope="row"><pre>                name="com.webobjects.foundation.NSArray" suid="-3789592578296478260"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;field name="objects" type="java.lang.Object[]"/><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/super><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;array field="objects" id="5" ignoreEDB="1" length="3" type="java.lang.Object[]"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;object id="10"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;class flag="3" id="6" name="Movie" suid="-791832868721905865"><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;field name="releaseDate" type="com.webobjects.foundation.NSTimestamp"/><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;field name="studio" type="java.lang.String"/><span></span></pre></td></tr><tr><td scope="row"><pre>                    &lt;field name="title" type="java.lang.String"/><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="11" key="title" xml:space="preserve">Alien&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="12" key="studio" xml:space="preserve">20th Century Fox&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="13" ignoreEDB="1" key="release_date" xml:space="preserve">1979-10-25 07:00:00 Etc/GMT&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/object><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;object id="14"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;class idRef="6" name="Movie"/><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="15" key="title" xml:space="preserve">Blade Runner&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="16" key="studio" xml:space="preserve">Warner Brothers&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="17" ignoreEDB="1" key="release_date" xml:space="preserve">1982-01-03 08:00:00 Etc/GMT&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/object><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;object id="18"><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;class idRef="6" name="Movie"/><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="19" key="title" xml:space="preserve">Star Wars&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string idRef="12" key="studio"/><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string id="20" ignoreEDB="1" key="release_date" xml:space="preserve">1977-12-29 08:00:00 Etc/GMT&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/object><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/object><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000180-SW33" title="Formatting Serialized Output"></a><h3>Formatting Serialized Output</h3><p><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_167"></a>The XML documents produced so far are nicely indented to facilitate their comprehension by people. However, most of the time, these documents are intended for applications. Therefore, indentation (and the extra characters it adds to a stream) is not needed. You can determine whether the output produced by an NSXMLOutputStream object is indented using a NSXMLOutputFormat (<code>com.webobjects.foundation.xml</code>) object. NSXMLOutputFormat<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_168"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_169"></a> objects encapsulate formatting information that can be applied to an NSXMLOutputStream object.</p><p><span class="content_text">Table 3-1</span> lists the output-format properties you can set with NSXMLOutputFormat.</p><a name="//apple_ref/doc/uid/TP30000180-SW34" title="Table 3-1Output-format properties accessible through NSXMLOutputFormat"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Output-format properties accessible through NSXMLOutputFormat</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Default value</p></th></tr><tr><td  scope="row"><p><code>encoding<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_170"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_171"></a></code></p></td><td ><p>Determines the encoding used in the document.</p></td><td ><p><code>"UTF-8"</code></p></td></tr><tr><td  scope="row"><p><code>indenting<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_172"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_173"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_174"></a></code></p></td><td ><p>Determines whether the XML document generated is indented.</p></td><td ><p><code>true</code></p></td></tr><tr><td  scope="row"><p><code>omitXMLDeclaration<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_175"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_176"></a></code></p></td><td ><p>Determines whether the XML declaration is omitted from the document.</p></td><td ><p><code>false</code></p></td></tr><tr><td  scope="row"><p><code>version<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_177"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_178"></a></code></p></td><td ><p>Determines the document's XML version.</p></td><td ><p><code>"1.0"</code></p></td></tr></table></div><p>You can use WebObjects-style accessors to get and set the values of the properties listed in <span class="content_text">Table 3-1</span>. The value of the <code>indenting</code> property can also be set through one of the constructors of NSXMLOutputFormat, <code>NSXMLOutputFormat(boolean)</code>.</p><p><span class="content_text">Listing 3-15</span> shows a method that creates an XML stream to a file and sets the <code>indenting</code> and <code>encoding</code> properties for the stream.</p><a name="//apple_ref/doc/uid/TP30000180-SW35" title="Listing 3-15Setting the indenting and encoding properties of an NSXMLOutputFormat object and applying them to an NSXMLOutputStream object"></a><p class="codesample"><strong>Listing 3-15&nbsp;&nbsp;</strong>Setting the <code>indenting</code> and <code>encoding</code> properties of an NSXMLOutputFormat object and applying them to an NSXMLOutputStream object</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Opens an XML output stream to a file.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename   fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre> *                   target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre> *                   the channel to open<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @return object stream, &lt;code>null&lt;/code> when the stream<span></span></pre></td></tr><tr><td scope="row"><pre> *         could not be created.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public Object xmlOutputStream(String filename) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>    BufferedOutputStream file_output_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSXMLOutputStream xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSXMLOutputFormat format;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create an output stream to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>    file_output_stream = new BufferedOutputStream(new FileOutputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create object output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>    xml_stream = new NSXMLOutputStream(file_output_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the format of the output document.<span></span></pre></td></tr><tr><td scope="row"><pre>    format = new NSXMLOutputFormat(true);  // turn indentation on<span></span></pre></td></tr><tr><td scope="row"><pre>    format.setEncoding("UTF-16");          // set encoding to UTF-16<span></span></pre></td></tr><tr><td scope="row"><pre>    xml_stream.setOutputFormat(format);    // apply format to the stream<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>For more information on NSXMLOutputFormat, see the API documentation.<a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_179"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_180"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_181"></a><a name="//apple_ref/doc/uid/TP30000180-DontLinkElementID_182"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Serialization/Serialization.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Transformation/Transformation.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/XML_Serialization/Serializing/Serializing.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/XML_Serialization/Serializing/Serializing.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/XML_Serialization/Serializing/Serializing.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>