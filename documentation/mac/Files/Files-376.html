<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Changing Default Volume Characteristics (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING376></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-375.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-377.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-367.html"><B>Chapter 5 - Disk Initialization Manager</B></A> / <A HREF="Files-372.html"><B>Using the Disk Initialization Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING376-0></A>
<H2><A NAME=MARKER-9-66></A><A NAME=MARKER-2-67></A>Changing Default Volume Characteristics</H2>
 The Disk Initialization Manager must set certain volume characteristics when it creates an HFS directory on a volume. Default values for these characteristics are stored in an HFS defaults record in ROM. If you wish, you can override those default values by placing a pointer to an HFS defaults record in the low-memory global variable <CODE>FmtDefaults</CODE>. The Disk Initialization Manager uses the record stored in ROM whenever this low-memory global variable contains <CODE>NIL</CODE>.<A NAME=MARKER-2-68></A><A NAME=MARKER-2-69></A><P>
<DL>
<DT><B>IMPORTANT</B>
<DD>Most applications do not need to alter the default volume characteristics. This technique is useful primarily for applications, such as backup <BR>utilities, that intelligently adjust the allocation block size and clump <BR>size to maximize the amount of data written to a backup volume.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 <A NAME=MARKER-2-70></A>The <CODE>HFSDefaults</CODE> data structure defines the HFS defaults record.<A NAME=MARKER-2-71></A><P>
<PRE>
TYPE HFSDefaults =
RECORD
   sigWord:    PACKED ARRAY[0..1] OF Byte;   {signature word}
   abSize:     LongInt;                      {allocation block size in bytes}
   clpSize:    LongInt;                      {clump size in bytes}
   nxFreeFN:   LongInt;                      {next free file number}
   btClpSize:  LongInt;                      {B*-tree clump size in bytes}
   rsrv1:      Integer;                      {reserved}
   rsrv2:      Integer;                      {reserved}
   rsrv3:      Integer;                      {reserved}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE>sigWord</CODE>
<DD> The signature word to be used for newly initialized volumes. By default, this field is set to <CODE>'BD'</CODE> (hexadecimal $4244). You must set this field to <CODE>'BD'</CODE> for the volume to be recognized as an HFS volume.<A NAME=MARKER-2-72></A><A NAME=MARKER-2-73></A>
<DT><CODE>abSize</CODE>
<DD> The number of bytes in each allocation block on newly initialized volumes. If you set this field to 0, the number of bytes in each allocation block is computed according to the following formula:
</DL>
<PRE>
               abSize = (1 + (blocks in volume/64K)) * 512 bytes
</PRE>
<DL>
<DT>
<DD> By default, this field is set to 0.<A NAME=MARKER-2-74></A><A NAME=MARKER-2-75></A>
<DT><CODE>clpSize</CODE>
<DD> The number of bytes to be used for the clump on newly initialized volumes. By default, this field is set to <CODE>4*abSize</CODE>.<A NAME=MARKER-2-76></A><A NAME=MARKER-2-77></A>
<DT><CODE>nxFreeFN</CODE>
<DD> The next free file number on newly initialized volumes. By default, this field is set to 16.<A NAME=MARKER-2-78></A>
<DT><CODE>btClpSize</CODE>
<DD> The number of bytes to be used for the B*-tree clump on newly initialized volumes. If you set this field to 0, the number of bytes to be used for the B*-tree clump is computed according to the following formula:<A NAME=MARKER-2-79></A><A NAME=MARKER-2-80></A>
</DL>
<PRE>
               btClpSize = ((blocks in volume)/128) * 512 bytes
</PRE>
<DL>
<DT>
<DD> By default, this field is set to 0.
<DT><CODE>rsrv1</CODE>
<DD> Reserved. Set to 0.<A NAME=MARKER-2-81></A>
<DT><CODE>rsrv2</CODE>
<DD> Reserved. Set to 0.<A NAME=MARKER-2-82></A>
<DT><CODE>rsrv3</CODE>
<DD> Reserved. Set to 0.<A NAME=MARKER-2-83></A><A NAME=MARKER-2-84></A>
</DL>
 The code in <A HREF=#MARKER-9-86>Listing 5-5</A> fills in an <CODE>HFSDefaults</CODE> record, stores it in the system heap (so that the record remains in memory after the application terminates), and makes the low-memory global variable <CODE>FmtDefaults</CODE> a pointer to that record. Note that changing the default volume characteristics does not affect volumes that you have already initialized, but only volumes to be initialized.<A NAME=MARKER-2-85></A><P>
<B>Listing 5-5  <A NAME=MARKER-9-86></A>Changing default volume characteristics</B><P>
<PRE>
PROCEDURE ChangeHFSDefaults;
CONST
   FmtDefaults    = $039E;                {address of low-memory global}
TYPE
   HFSDefaultsPtr = ^HFSDefaults;         {pointer to override record}
   HFSDefaultsAdd = ^HFSDefaultsPtr;      {address of above pointer}
VAR
   myDefaults:    HFSDefaultsPtr;
BEGIN                                     {allocate record in system heap}
   myDefaults := HFSDefaultsPtr(NewPtrSysClear(SizeOf(HFSDefaults)));
   WITH myDefaults^ DO
      BEGIN
         ...                              {set fields of record}
      END;
   HFSDefaultsAdd(FmtDefaults)^ := myDefaults;
                                          {change value of global}
END;
</PRE>
 If you later want to restore the default settings, you can reset the low-memory global variable <CODE>FmtDefaults</CODE> to <CODE>NIL</CODE>. Remember to delete any memory you have allocated.<A NAME=MARKER-2-87></A><A NAME=MARKER-2-88></A><A NAME=MARKER-2-89></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-375.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-377.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
