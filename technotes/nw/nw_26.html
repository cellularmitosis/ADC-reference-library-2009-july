<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW26: ARA GetUserPortGlobalsPtr Call</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW26: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Apr 26, 1993 - May 7, 1993"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002567" title="ARA GetUserPortGlobalsPtr Call"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW26</div>
<div id="pageheadsub">ARA GetUserPortGlobalsPtr Call</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Conclusion">Conclusion</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note documents the Remote Access Manager (RAM)<code>GetUserPortGlobalsPtr</code> call. In order to make the RAM <code>Status</code>call on a machine that is setup to answer calls, you must first make the<code>GetUserPortGlobalsPtr</code> call to retrieve a pointer to the globals forthe user port.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[May 01 1993]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>The Apple Remote Access (ARA) 1.0 client software supports dial-out andanswering capabilities through a single port called the "user" port (the modemor printer port on your Mac). This means that when you setup your machine toanswer calls, you can answer only one call at a time on the user port. However,the underlying ARA architecture was designed so that in the future multipleports may be supported (in a dial-in server for example).</p><P>When you dial out on your Mac and establish an ARA connection, ARA internallyallocates the data structures for the user port - but not until a connection isactually made. This is why, for example, the <code>Status</code> call will returnthe -5833 ERR_PORTDOESNOTEXIST error on the originating machine if there is noactive connection. Once a connection has been made on a machine that is theoriginator of the connection, the <code>Status</code> call should return no error,because the data structures for the port will have been created.</p><p>When you make the <code>Status</code> call on a machine that is setup to answercalls (the answer calls box is checked in the Remote Access Setup controlpanel), you will find that you always get the -5833 <code>ERR_PORTDOESNOTEXIST</code> error.The reason for this is that when ARA is in answer mode it needs to be able touniquely identify each connection with a separate <code>portGlobalsPtr</code>,because in the future there may be support for more than one connection on asingle machine. Therefore, on a machine that is setup to answer calls, you mustfirst retrieve the <code>portGlobalsPtr </code>for the user port before the<code>Status</code> call can be made. This is accomplished with the<code>GetUserPortGlobalsPtr</code> call. This call makes use of the familiar<code>TRemoteAccessParmHeader </code>structure, which is defined in the<i>AppleTalk Remote Access Developer's Toolkit</i>:. The pointer to the portglobals for the user port is returned in the <code>portGlobalsPtr</code> field uponcompletion of the call. Here are the data structures used by this call:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#define DControlParamHeader \    QElem    *qLink;        /*next queue entry*/\    short    qType;            /*queue type*/\    short    ioTrap;        /*routine trap*/\    Ptr    ioCmdAddr;            /*routine address*/\    ProcPtr    ioCompletion;        /*completion routine*/\    OSErr    ioResult;        /*result code*/\    long    userData;        /*for use by the user */\    short    unused;        /*unused field */\    short    ioRefNum;        /*driver reference number*/\    short    csCode;        /*Call command code*/#define DExtendedParam \    DControlParamHeader \    Ptr    hReserved1; \    Ptr    hReserved2; \    Ptr    resultStrPtr; \    Ptr    extendedType;        /* pointer to identifier string */#define DRemoteAccessParmHeader    \    DExtendedParam \    short    extendedCode;        /* for use by extended call proc */\    Ptr    portGlobalsPtr;    /* pointer to globals for this port (0=userport) */\struct TRemoteAccessParmHeader{    DRemoteAccessParmHeader};</pre>	</TD></TR></TABLE></CENTER><p>The fields in the <code>TRemoteAccessParmHeader </code>structure used for the<code>GetUserPortGlobalsPtr</code> call to the Remote Access Manager are defined asfollows:</p><p>-&gt;    12    <code>ioCompletion</code>    long    pointer to completion routine</p><p>&lt;-    16    <code>ioResult</code>    word    result code</p><p>-&gt;    20    <code>userData</code>    long    for use by the user</p><p>-&gt;    26    <code>ioRefNum</code>    word    driver reference number</p><p>-&gt;    28    <code>csCode</code>    word    call command code</p><p>-&gt;    40    <code>extendedType</code>    long    pointer to identifier string</p><p>-&gt;    42    <code>extendedCode</code>    word    for use by extended call procedure</p><p>&lt;--&gt;    44    <code>portGlobalsPtr</code>    long    pointer to globals for this port (0= return user port globals)</p><p>Here are the detailed descriptions of the parameter block fields used by thiscall:</p><p><code>ioCompletion</code>    pointer to completion routine.</p><p><code>ioResult</code>    result code returned by the call.</p><p><code>userData</code>    user data for use by the user.</p><p><code>ioRefNum</code>    driver reference number.</p><p><code>csCode</code>    command code, normally set to RAM_EXTENDED_CALL.</p><p><code>extendedType</code>    should be set to REMOTEACCESSNAME.</p><p><code>extendedCode</code>    set to 54 to indicate the <code>GetUserPortGlobalsPtr</code>call.</p><p><code>portGlobalsPtr</code> returns a pointer to the globals for the port. On inputpass 0 to indicate you want the user port globals.</p><p>The following result codes can be returned by the<code>GetUserPortGlobalsPtr</code> call:</p><p><code>noErr</code> 0 no error.</p><p>ERR_PORTDOESNOTEXIST<code>    </code>-5833    port does not exist.</p><p>ERR_PORTSHUTDOWN<code>        </code>-5832    port is shutting down.</p><p>The following is an example of how you would use the<code>GetUserPortGlobalsPtr</code> call prior to making a <code>Status</code> call.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#include    &quot;RemoteAccessInterface.h&quot;Str255                ResultStr;Str255                UserName;Str255                LastMessage;Str255                ConnectedTo;#define CmdRemoteAccess_GetUserPortGlobalsPtr 54void DoStatus(){TRemoteAccessParamBlock    pb;  /* Ask LTM driver for PortGlobals address */  pb.HDR.csCode = RAM_EXTENDED_CALL;        /* extended call */  pb.HDR.extendedType = (Ptr)REMOTEACCESSNAME;    /* to Netshare */  pb.HDR.extendedCode = CmdRemoteAccess_GetUserPortGlobalsPtr; /* get user portglobals */  pb.HDR.portGlobalsPtr = nil;             /* 0 = return user port globals */  PBRemoteAccess( &amp;pb, false );  if (pb.HDR.ioResult != noErr)    HandleError(pb.HDR.ioResult);  else  {    /* Issue ARA Status Call */    ResultStr[0] = 0;    pb.STATUS.resultStrPtr = (Ptr)ResultStr;     /* put results here */    pb.STATUS.extendedCode = CmdRemoteAccess_Status;     /* status command */    pb.STATUS.userNamePtr = UserName;    pb.STATUS.connectedToNamePtr = ConnectedTo;    pb.STATUS.theLastStatusMsgPtr = LastMessage;    pb.STATUS.statusUserNamePtr = 0;    pb.STATUS.statusMsgSeqNum = 0;    PBRemoteAccess( &amp;pb, false );    if (pb.STATUS.ioResult != noErr)      HandleError(pb.STATUS.ioResult);  }</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Conclusion"></a><h2>Conclusion</h2><p>To make sure that the RAM <code>Status</code> call will work on machines that aresetup to answer calls, you will need to first make the<code>GetUserPortGlobalsPtr </code>call so that the Remote Access Manager knowswhich port to return status information for.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P><i>AppleTalk Remote Access Developer's Toolkit</i></p>                                      <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_26.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_26.html%3Fid%3DDTS10002567-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_26.html%3Fid%3DDTS10002567-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_26.html%3Fid%3DDTS10002567-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>