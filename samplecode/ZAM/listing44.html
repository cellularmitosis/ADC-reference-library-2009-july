<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ZAM - /GameSource/SpriteFrameSet.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGames-date.html">Games</a> &gt; <A HREF="javascript:location.replace('index.html');">ZAM</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Games/index.html" target="_blank">Reference Library > Games</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ZAM</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/GameSource/SpriteFrameSet.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/CoreHeaders/CoreGlobals.h</option>
<option value="listing2.html">/CoreHeaders/EventLoop.h</option>
<option value="listing3.html">/CoreHeaders/MenuDispatch.h</option>
<option value="listing4.html">/CoreHeaders/WindowDispatch.h</option>
<option value="listing5.html">/CoreSource/AdjustMenus.c</option>
<option value="listing6.html">/CoreSource/AEventCoreDisp.c</option>
<option value="listing7.html">/CoreSource/Document.c</option>
<option value="listing8.html">/CoreSource/ErrMsg.c</option>
<option value="listing9.html">/CoreSource/EventLoop.c</option>
<option value="listing10.html">/CoreSource/GetBackTime.c</option>
<option value="listing11.html">/CoreSource/InitMac.c</option>
<option value="listing12.html">/CoreSource/Main.c</option>
<option value="listing13.html">/CoreSource/MenuDispatch.c</option>
<option value="listing14.html">/CoreSource/WindowDispatch.c</option>
<option value="listing15.html">/Dude #includes.c</option>
<option value="listing16.html">/GameHeaders/Document.h</option>
<option value="listing17.html">/GameHeaders/FixGraf.h</option>
<option value="listing18.html">/GameHeaders/GameAEvents.h</option>
<option value="listing19.html">/GameHeaders/GameDef.h</option>
<option value="listing20.html">/GameHeaders/GameSounds.h</option>
<option value="listing21.html">/GameHeaders/MissileSprite.h</option>
<option value="listing22.html">/GameHeaders/Sprite.h</option>
<option value="listing23.html">/GameHeaders/SpriteFrameRates.h</option>
<option value="listing24.html">/GameHeaders/TankSprite.h</option>
<option value="listing25.html">/GameHeaders/xqueue.h</option>
<option value="listing26.html">/GameHeaders/xthing.h</option>
<option value="listing27.html">/GameHeaders/ZAM.h</option>
<option value="listing28.html">/GameSource/DirectionTable.c</option>
<option value="listing29.html">/GameSource/ExplosionSprites.c</option>
<option value="listing30.html">/GameSource/FixGraf.c</option>
<option value="listing31.html">/GameSource/GameAEvents.c</option>
<option value="listing32.html">/GameSource/GameMenu.c</option>
<option value="listing33.html">/GameSource/GameSounds.c</option>
<option value="listing34.html">/GameSource/IncidentalSounds.c</option>
<option value="listing35.html">/GameSource/InitGame.c</option>
<option value="listing36.html">/GameSource/MissileAEvents.c</option>
<option value="listing37.html">/GameSource/MissileSprite.c</option>
<option value="listing38.html">/GameSource/pixiZAM - direct blitter/pixiZAM.c</option>
<option value="listing39.html">/GameSource/pixiZAM - direct blitter/pixiZAM.h</option>
<option value="listing40.html">/GameSource/SlamPixels.c</option>
<option value="listing41.html">/GameSource/Sprite.c</option>
<option value="listing42.html">/GameSource/Sprite.proto.h</option>
<option value="listing43.html">/GameSource/SpriteColission.c</option>
<option value="listing44.html">/GameSource/SpriteFrameSet.c</option>
<option value="listing45.html">/GameSource/SpriteLayer.c</option>
<option value="listing46.html">/GameSource/TankSprite.c</option>
<option value="listing47.html">/GameSource/xqueue.c</option>
<option value="listing48.html">/GameSource/xthing.c</option>
<option value="listing49.html">/GameSource/ZAMProtos.h</option>
<option value="listing50.html">/UtilCode/CoreAssertion.c</option>
<option value="listing51.html">/UtilCode/CoreAssertion.h</option>
<option value="listing52.html">/UtilCode/DialogUtil.c</option>
<option value="listing53.html">/UtilCode/GrafUtils.c</option>
<option value="listing54.html">/UtilCode/GrafUtils.h</option>
<option value="listing55.html">/UtilCode/GWorldUtils.c</option>
<option value="listing56.html">/UtilCode/GWorldUtils.h</option>
<option value="listing57.html">/UtilCode/IsPressed.c</option>
<option value="listing58.html">/UtilCode/WindowUtil.c</option></select>
				</p>
				</form>
				<p><strong><a href="ZAM.zip">Download Sample</a></strong> (&#147;ZAM.zip&#148;, 73.3K)<BR>
<strong><a href="ZAM.dmg">Download Sample</a></strong> (&#147;ZAM.dmg&#148;, 125.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">#include &quot;ZAMProtos.h&quot;void InitFrameSetInfo(frameSetPtr fsp, short frameCount)/* initialize the frame set header *//* this is the stuff that is block moved around when a sprite frame set is shared *//* not a good way to do it. */{  fsp-&gt;finfo.frameCount = frameCount;  fsp-&gt;finfo.frameIndex = 0;  fsp-&gt;finfo.curImage = &amp;fsp-&gt;flist[0];  fsp-&gt;finfo.prevImage = fsp-&gt;finfo.curImage;  fsp-&gt;finfo.dimension.h = RECT_WD(fsp-&gt;flist[0].image-&gt;portRect);  fsp-&gt;finfo.dimension.v = RECT_HT(fsp-&gt;flist[0].image-&gt;portRect);  fsp-&gt;finfo.center.h = fsp-&gt;finfo.dimension.h / 2;  fsp-&gt;finfo.center.v = fsp-&gt;finfo.dimension.v / 2;}void SetSpriteCurrentFrame(spritePtr theSprite, short frameNum)/*  Force the sprite to change frame. This also remembers the current frame  so that erasing happens correctly later.*/{  theSprite-&gt;frameList-&gt;finfo.frameIndex = frameNum;  theSprite-&gt;frameList-&gt;finfo.prevImage = theSprite-&gt;frameList-&gt;finfo.curImage;  theSprite-&gt;frameList-&gt;finfo.curImage = &amp;theSprite-&gt;frameList-&gt;flist[frameNum];}OSErr CopyFrameSet(frameSetPtr srcFrameSet, frameSetPtr *destFrameSet)/*  This should be called duplicate or clone because it allocates  the destination frame set for you and copies the source to it.*/{  frameSetPtr fsp;  long    fsSize;  OSErr    err = noErr;      fsSize = sizeof(frameInfo) + (sizeof(frameCell) * srcFrameSet-&gt;finfo.frameCount);    /* create a new frame set block -- this is the destination frame set */  fsp = (frameSetPtr)NewPtrClear(fsSize);  if(fsp == nil) {    err = MemError();    ErrMsgCode(&quot;\pError allocating SpriteFrameSet&quot;,err);  }    if(err == noErr) {    BlockMove(srcFrameSet, fsp, fsSize);  }    *destFrameSet = fsp;    return err;}OSErr CreateEmptyFrameSet(frameSetPtr *dstFrameSet, short numFrames)/*  This creates a frame set with no actual content.    Content can be copied later with SetSpriteFrameSet, which is the nasty block move  culprit.*/{  frameSetPtr fsp;  long    fsSize;  OSErr    err = noErr;  fsSize = sizeof(frameInfo) + (sizeof(frameCell) * numFrames);    /* create a new frame set block -- this is the destination frame set */  fsp = (frameSetPtr)NewPtrClear(fsSize);  if(fsp == nil) {    err = MemError();    ErrMsgCode(&quot;\pError allocating SpriteFrameSet&quot;,err);  }  if(err == noErr) {    fsp-&gt;finfo.frameCount = numFrames;    fsp-&gt;finfo.frameIndex = 0;    fsp-&gt;finfo.curImage = nil;    fsp-&gt;finfo.prevImage = nil;  }  *dstFrameSet = fsp;    return err;}void SetSpriteFrameSet( spritePtr theSprite, frameSetPtr srcFrameSet)/*  Change the frame set of a sprite from whatever it was to the new one.    Note that this has one severe limiation, in that you can only go to another  frame set that has the same number of frames.   This function could be changed  to check for a difference in size and deal with it, but it is actually pretty  weak as it is already, and a completely different scheme would work better.  A frame set reference perhaps or something like that.*/{  long      fsSize;  frameCellPtr  prevFrameSet;    fsSize = GetPtrSize(srcFrameSet);  /* save the previous frame set for erasing the old image */  prevFrameSet = theSprite-&gt;frameList-&gt;finfo.curImage;  /* copy the new frame set over the first one, and set it to the start */  BlockMove(srcFrameSet, theSprite-&gt;frameList, fsSize);  InitFrameSetInfo(theSprite-&gt;frameList, srcFrameSet-&gt;finfo.frameCount);  /* if there was a previous frame set, then restore it */  if(prevFrameSet != nil)    theSprite-&gt;frameList-&gt;finfo.prevImage = prevFrameSet;}OSErr CreateColorIconFrameSet(frameSetPtr *newFrameSet, short startID, short numFrames)/*  Create a frame set from color icons starting with CICN resource id startID for the numFrames.*/{  short      index;  frameSetPtr    fsp;  frameCellPtr  fcp;  short      err = noErr;  CIconHandle    cicn;    /* create a new frame set block */  fsp = (frameSetPtr)NewPtrClear(sizeof(frameInfo) + (sizeof(frameCell) * numFrames));  if(fsp == nil) {    err = MemError();    ErrMsgCode(&quot;\pError allocating SpriteFrameSet&quot;,err);  }  if(err == noErr) {    /* load the frames into the GWorld list */    for(index = 0; (index &lt; numFrames) &amp;&amp; (err == noErr); index ++) {      fcp = &amp;fsp-&gt;flist[index];      cicn = GetCIcon(startID + index);      if(cicn == nil) {        err = ResError();        ErrMsgCode(&quot;\pcicn resource not loaded in CreateColorIconFrameSet&quot;,err);      } else {        err = CreateGWorldFromCIcon(&amp;fcp-&gt;image, cicn);        if(err != noErr) {          ErrMsgCode(&quot;\pCreateColorIconFrameSet: CreateGWorldFromCIcon failed.&quot;,err);        }        if(err == noErr) {            err = CreateRegionFromCIconMask(&amp;fcp-&gt;mask, cicn);          if(err != noErr) {            ErrMsgCode(&quot;\pCreateRegionFromCIconMask failed.&quot;,err);          } else {            /* save off the topleft of the region so we can move */            /* it with the sprite */            fcp-&gt;maskLoc.v = (**fcp-&gt;mask).rgnBBox.top;            fcp-&gt;maskLoc.h = (**fcp-&gt;mask).rgnBBox.left;          }        }        DisposeCIcon(cicn);      }    }    /* have all the frames, so set up the frame header information */    InitFrameSetInfo(fsp, numFrames);  }    *newFrameSet = fsp;  if(err != noErr) {    /* crappy for now but hey */    ErrMsgCode(&quot;\pIt would be unwise to proceed.!!!&quot;,err);    ExitToShell();  }    return err;}OSErr CreatePICTIconFrameSet(frameSetPtr *newFrameSet, short startID, short numFrames)/*  Does the same thing, only the image is loaded from a picture while  the mask is loaded from a cicn.  The reason for this is that I originally was only using  cicns, but, then I discovered a lovely program called DeBabelizer   ( by Equilibrium Technologies, in Sausalito, CA), which will take a whole bunch of art work  from just about anywhere and create a common palette for it, and even re-map the pictures to the  new palette.  So I did that with all the artwork in ZAM, but did not want to take it from the PICTs  back to CICN.  Too bad Debabelizer cannot process CICNS directly.  So this is a hacky way around it, and I'm sorry to say it takes up more room on disk.*/{  short      index;  frameSetPtr    fsp;  frameCellPtr  fcp;  short      err = noErr;  CIconHandle    cicn;  PicHandle    pict;    /* create a new frame set block */  fsp = (frameSetPtr)NewPtrClear(sizeof(frameInfo) + (sizeof(frameCell) * numFrames));  if(fsp == nil) {    err = MemError();    ErrMsgCode(&quot;\pError allocating SpriteFrameSet&quot;,err);  }  if(err == noErr) {    /* load the frames into the GWorld list */    for(index = 0; (index &lt; numFrames) &amp;&amp; (err == noErr); index ++) {      fcp = &amp;fsp-&gt;flist[index];      cicn = GetCIcon(startID + index);      if(cicn == nil) {        err = ResError();        ErrMsgCode(&quot;\pcicn resource not loaded in CreateColorIconFrameSet&quot;,err);      } else {        pict = GetPicture(startID + index);        if(pict == nil) {          err = ResError();          ErrMsgCode(&quot;\pPICT resource not loaded in CreateColorIconFrameSet&quot;,err);        } else {          err = CreateGWorldFromPict(&amp;fcp-&gt;image, pict);          if(err != noErr) {            ErrMsgCode(&quot;\pCreateColorIconFrameSet: CreateGWorldFromPict failed.&quot;,err);          }          if(err == noErr) {              err = CreateRegionFromCIconMask(&amp;fcp-&gt;mask, cicn);            if(err != noErr) {              ErrMsgCode(&quot;\pCreateRegionFromCIconMask failed.&quot;,err);            } else {              /* save off the topleft of the region so we can move */              /* it with the sprite */              fcp-&gt;maskLoc.v = (**fcp-&gt;mask).rgnBBox.top;              fcp-&gt;maskLoc.h = (**fcp-&gt;mask).rgnBBox.left;            }          }          ReleaseResource(pict);        }        DisposeCIcon(cicn);      }    }    /* have all the frames, so set up the frame header information */    InitFrameSetInfo(fsp, numFrames);  }    *newFrameSet = fsp;  if(err != noErr) {    /* crappy for now but hey */    ErrMsgCode(&quot;\pIt would be unwise to proceed.!!!&quot;,err);    ExitToShell();  }    return err;}short GetNextSpriteFrameIndex(spritePtr spr){  short  frameNum;  frameNum = spr-&gt;frameList-&gt;finfo.frameIndex + 1;  if(frameNum &gt;= spr-&gt;frameList-&gt;finfo.frameCount) {    frameNum  = 0;  }    return frameNum;}void AttachCTableToFrameSet(frameSetPtr frameSet, CTabHandle srcCtable, short ctSeed)/*  Change the color table of a frame set, and set the seed.  I had mixed results using this.*/{  CTabHandle    ctab;  frameCellPtr  prevFrameSet;  short      i;  PixMapHandle  pmH;      ctab = srcCtable;  for(i = 0; i &lt; frameSet-&gt;finfo.frameCount; i++) {    pmH = GetGWorldPixMap(frameSet-&gt;flist[i].image);    // get pixmap    DisposeHandle((**pmH).pmTable);    HandToHand(&amp;ctab);                    // duplicate it    (**pmH).pmTable = ctab;                  // stuff it in    (**(**pmH).pmTable).ctSeed = ctSeed;          // change the seed  }   }void SetFrameSetCTSeed(frameSetPtr frameSet, short newSeed){  short      i;  PixMapHandle  pmH;  for(i = 0; i &lt; frameSet-&gt;finfo.frameCount; i++) {    pmH = GetGWorldPixMap(frameSet-&gt;flist[i].image);    // get pixmap    (**(**pmH).pmTable).ctSeed = newSeed;          // change the seed  } }void SetSpriteXXFrameSet( spritePtr theSprite, frameSetPtr srcFrameSet)/*  Guess this is old dead code no longer used.*/{  long      fsSize;  frameCellPtr  prevFrameSet;    fsSize = GetPtrSize(srcFrameSet);  /* save the previous frame set for erasing the old image */  prevFrameSet = theSprite-&gt;frameList-&gt;finfo.curImage;  /* copy the new frame set over the first one, and set it to the start */  BlockMove(srcFrameSet, theSprite-&gt;frameList, fsSize);  InitFrameSetInfo(theSprite-&gt;frameList, srcFrameSet-&gt;finfo.frameCount);  /* if there was a previous frame set, then restore it */  theSprite-&gt;frameList-&gt;finfo.prevImage = prevFrameSet;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ZAM/listing44.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ZAM/listing44.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ZAM/listing44.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>