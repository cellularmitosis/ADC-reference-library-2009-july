<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Recipes--Applications (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING84></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-83.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-85.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-82.html"><B>Chapter 11 -   Working With Applications</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING84-0></A>
<H1><A NAME=MARKER-2-24></A>Recipes--Applications</H1>
 The recipes and sample code in this section demonstrate how to create and launch a MacApp application. <A HREF=#MARKER-9-26>Figure 11-1</A> shows a partial class hierarchy for MacApp's application classes, including the <CODE>TIconEditApplication</CODE> class from the IconEdit sample application. It also shows some of the macros and initialization routines that are used to launch an application.<P>
<B>Figure 11-1  <A NAME=MARKER-2-25></A><A NAME=MARKER-9-26></A>Application classes, methods, and initialization routines</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-063.gif"><P>
<A NAME=HEADING84-4></A>
<H2><A NAME=MARKER-2-27></A><A NAME=MARKER-2-28></A><A NAME=MARKER-9-34></A>Recipe--Defining a Subclass of TApplication</H2>
 To define a subclass of <CODE>TApplication</CODE>, you perform these steps:<P>
<OL>
<LI>Provide a class definition.
<LI>Provide constructor and destructor methods.
<LI>Provide an initialization method.
<LI>Override the <CODE>DoMakeDocument</CODE> method.<P>
</OL>
 The sample code shown in this recipe is from the IconEdit application.<P>
<A NAME=HEADING84-11></A>
<H3>Provide a Class Definition</H3>
 The definition for your application class should look something like the definition of the <CODE>TIconEditApplication</CODE> class:<P>
<PRE>
class TIconEditApplication : public TApplication
{
   MA_DECLARE_CLASS;                // Macro for RTTI info.
   public:
   TIconEditApplication();          // Constructor.
   virtual ~TIconEditApplication(); // Destructor.
   virtual void IIconEditApplication(); // Initialization.
   virtual TDocument* DoMakeDocument(CommandNumber
      itsCommandNumber, TFile* itsFile);// Override.
   // Some methods not shown.
};
</PRE>
<A NAME=HEADING84-14></A>
<H3>Provide Constructor and Destructor Methods</H3>
 Since the <CODE>TIconEditApplication</CODE> class adds no additional fields to <CODE>TApplication</CODE>, its constructor and destructor methods are empty. For a recipe that shows nonempty constructor and destructor methods, see <A HREF=MacAppProgGuide-81.html#MARKER-9-24>"Provide Constructor and Destructor Methods," beginning on page 279</A> in <A HREF=MacAppProgGuide-79.html#MARKER-9-19>Chapter 10, "Working With Objects."</A><P>
<A NAME=HEADING84-16></A>
<H3>Provide an Initialization Method</H3>
 The initialization method for your application class should perform the following tasks:<P>
<UL>
<LI>It should call the initialization method of its parent class.
<LI>It should perform any initialization specific to your class that can't be handled safely in a constructor method.<P>
For example, a constructor should not perform operations that may fail, such as allocating memory. So if your application needs to allocate memory, you do so in the initialization method.<P>
</UL>
 Consider the initialization method for <CODE>TIconEditApplication</CODE>:<P>
<PRE>
void TIconEditApplication::IIconEditApplication()
{
   this-&gt;IApplication(kFileType, kSignature);
   MA_REGISTER_CLASS(TIconEditView);
}  // IIconEditApplication
</PRE>
 The <CODE>IIconEditApplication</CODE> method calls <CODE>IApplication</CODE> to ensure proper initialization of MacApp. The constants passed to <CODE>IApplication</CODE> specify a file type and an application signature.<P>
 After calling <CODE>IApplication</CODE>, the <CODE>IIconEditApplication</CODE> method performs any initialization specific to the application. For <CODE>TIconEditApplication</CODE>, that consists entirely of using the <CODE>MA_REGISTER_CLASS</CODE> macro to register the <CODE>TIconEditView</CODE> class so that the application can create view objects of that type by name or by class ID.<P>
 As an example of application-specific initialization, if you don't want your application to open a new document when launched (MacApp's default behavior), include the following line (<I>after</I> calling <CODE>IApplication</CODE>):<P>
<PRE>
fLaunchWithNewDocument = FALSE; // No new document at launch.
</PRE>
<A NAME=HEADING84-27></A>
<H3>Override the DoMakeDocument Method</H3>
 In MacApp, the responsibility for creating documents falls to the application object's <CODE><A NAME=MARKER-2-30></A>DoMakeDocument</CODE> method. In the <CODE>TApplication</CODE> class, that method does nothing, so you must override <CODE>DoMakeDocument</CODE> to create the kind of documents your application requires.<P>
 The <CODE>DoMakeDocument</CODE> method creates and initializes a document object and returns a reference to it. The following is the <CODE>DoMakeDocument</CODE> method from the <CODE>TIconEditApplication</CODE> class:<P>
<PRE>
TDocument* TIconEditApplication::DoMakeDocument(
                  CommandNumber/*itsCommandNumber*/,
                  TFile*      itsFile)
{
   TIconDocument* anIconDocument;

   // Create and initialize a TIconDocument object.
   anIconDocument = new TIconDocument;
   anIconDocument-&gt;IIconDocument(itsFile);

   // Return a reference to the document.
   return anIconDocument;
}
</PRE>
 The <CODE>itsCommandNumber</CODE> parameter can be used to determine the type of document to create, but it is commented out here because the IconEdit application only creates one kind of document. Your application can set the command number passed to <CODE>DoMakeDocument</CODE> by overriding the <CODE>TApplication::KindOfDocument</CODE> method. It can also create different kinds of documents based on the command number.<A NAME=MARKER-2-32></A> For more information, see <A HREF=MacAppProgGuide-60.html#MARKER-9-49>"Kinds of Documents," beginning on page 169</A>.<P>
<A NAME=HEADING84-32></A>
<H2><A NAME=MARKER-2-32></A><A NAME=MARKER-2-35></A><A NAME=MARKER-9-34></A>Recipe--Launching a Simple Application</H2>
 To launch a simple application, you perform these steps:<P>
<OL>
<LI>Define a subclass of <CODE>TApplication</CODE>.
<LI>Create a <CODE>main</CODE> routine.<P>
</OL>
 The sample code shown in this recipe is from the IconEdit application.<P>
<A NAME=HEADING84-37></A>
<H3>Define a Subclass of TApplication</H3>
 This step is described in <A HREF=MacAppProgGuide-111.html#MARKER-9-34>"Recipe--Defining a Subclass of TApplication" on page 289</A>. If your application supports PowerTalk mailers, your application class should descend from the <CODE>TMailingApplication</CODE> class, a subclass of the <CODE>TApplication</CODE> class.<P>
<A NAME=HEADING84-39></A>
<H3><A NAME=MARKER-9-35></A>Create a Main Routine</H3>
 You write a <CODE><A NAME=MARKER-2-36></A>main</CODE> routine for each MacApp application you create. The <CODE>main</CODE> routine performs the following steps:<P>
<UL>
<LI>It calls <CODE>InitUMacApp</CODE>, a macro supplied by MacApp, to initialize the Macintosh Toolbox, initialize MacApp, and perform other initialization tasks.
<LI>It initializes any additional MacApp units used by your application, as well as any application units you may have defined.
<LI>It creates and initializes an instance of your application class.
<LI>It calls the application object's <CODE>Run</CODE> method to launch the application and start the application's main event loop.<P>
</UL>
 The following is the <CODE>main</CODE> routine from the IconEdit application:<P>
<PRE>
void main()
{
   // Initialize MacApp with 4 calls to MoreMasters.
   InitUMacApp(4);
   // Initialize the printing unit.
   InitUPrinting();

   // Create and initialize an application object.
   TIconEditApplication* anIconEditApplication = 
                        new TIconEditApplication;
   anIconEditApplication-&gt;IIconEditApplication();

   // Run the application's main event loop.
   anIconEditApplication-&gt;Run();
} // main
</PRE>
 The <CODE>InitUMacApp</CODE> macro is expanded to a number of calls that perform initialization tasks for MacApp. One of these tasks is to call the MacApp routine <CODE>InitUMemory</CODE>, passing the same value that was passed to <CODE>InitUMacApp</CODE> (in this case, 4). This value tells the <CODE>InitUMemory</CODE> routine how many times to call the Macintosh Toolbox routine <CODE>MoreMasters</CODE>. The <CODE>MoreMasters</CODE> routine allocates space for a block of master pointers. By calling <CODE>MoreMasters</CODE> during MacApp initialization, <CODE>InitUMacApp</CODE> ensures that the master pointers are among the first items allocated in the heap, and memory fragmentation is minimized.<P>
 Each call to <CODE>MoreMasters</CODE> creates a block of 64 master pointers. The number passed to <CODE>InitUMacApp</CODE> by your application's <CODE>main</CODE> routine should equal the greatest number of dynamically allocated blocks of memory that your application will need at any one time, divided by 64.<P>
 The IconEdit application calls the <CODE>InitUPrinting</CODE> routine to initialize MacApp's Printing unit. The following code shows how to initialize additional MacApp units to support dialog boxes, drag and drop, floating windows, PowerTalk, and text-edit views:<P>
<PRE>
InitUDialog();
#if qDrag
   if (HasDragManager())
      InitUDragManager();
#endif
InitUFloatWindow();
#if qPowerTalk
   if (HasAOCEToolBox())
      InitUMailer();
#endif
InitUTEView();
</PRE>
 These MacApp units are not automatically included in every application. This code uses the compiler flags <CODE>qDrag</CODE>, to conditionally include drag-and-drop initialization, and <CODE>qPowerTalk</CODE>, to conditionally include PowerTalk initialization. For information on compiler flags and on how to include MacApp units when you build your application, see <A HREF=MacAppProgGuide-148.html#MARKER-9-10>Appendix A</A>.<P>
 The <CODE>IIconEditApplication</CODE> method is described in the previous recipe.<P>
 The <CODE>TApplication::Run</CODE> method checks whether there is enough memory to run the application, calls <CODE>DoLaunchClipboard</CODE> to set up the application's Clipboard, and finally calls the application's <CODE>MainEventLoop</CODE> method, which looks for incoming events to dispatch.<A NAME=MARKER-2-37></A><A NAME=MARKER-2-38></A><A NAME=MARKER-2-39></A><A NAME=MARKER-2-40></A><P>
<A NAME=HEADING84-54></A>
<H2><A NAME=MARKER-2-41></A><A NAME=MARKER-2-42></A><A NAME=MARKER-9-77></A>Recipe--Launching an Application With a Startup Screen</H2>
 When you launch an application with a startup screen, you can't simply use the <CODE><A NAME=MARKER-2-44></A>InitUMacApp</CODE> macro. That macro expands into calls to <CODE>InitUMacApp_Step1</CODE>, <CODE><A NAME=MARKER-2-45></A>InstallFailureHandler</CODE>, and <CODE>InitUMacApp_Step3</CODE>. To launch your application with a startup screen, you call each of the three routines separately at the appropriate time, making sure to call the <CODE>InstallFailureHandler</CODE> routine from within the <CODE>main</CODE> routine.<P>
 To launch an application with a startup screen, you perform these steps:<P>
<OL>
<LI>Create a specialized <CODE>main</CODE> routine.
<LI>Create a routine to display a startup screen.<P>
</OL>
 The sample code shown in this recipe is from the Calc application.<P>
<A NAME=HEADING84-60></A>
<H3><A NAME=MARKER-10-43></A>Create a Specialized Main Routine</H3>
 A <CODE>main</CODE> routine that displays a startup screen must break up the standard process of initializing MacApp and launching the application. One way to accomplish this is to write a <CODE>main</CODE> routine that performs the following steps:<P>
<UL>
<LI>It calls the MacApp routine <CODE>InitUMacApp_Step1</CODE>, which initializes the Macintosh Toolbox and performs other initialization tasks.
<LI>It calls the MacApp routine <CODE>InstallFailureHandler</CODE>, which installs a top-level failure handler for MacApp's failure-handling mechanism.
<LI>It calls the MacApp routine <CODE><A NAME=MARKER-2-47></A>PullApplicationToFront</CODE>, which makes sure the application is the active application, so it can display a startup screen.
<LI>It calls a routine you write (described in the next section) that displays a startup screen while it completes the initialization of MacApp and creates an application object. Your routine returns the application object it created.
<LI>It calls the application object's <CODE>Run</CODE> method to launch the application.<P>
</UL>
 The <CODE>main</CODE> routine from the Calc application, shown on the following page, performs each of these steps.<P>
<PRE>
void main()
{
   // Initialize Macintosh Toolbox and validate machine configuration.
   InitUMacApp_Step1();

   // Install permanent outermost failure handler. Note that
   // InstallFailureHandler is implemented as a macro.
   // This MUST be called from main on PowerPC!
   InstallFailureHandler;

   // Make the application active.
   PullApplicationToFront();

   // Call routine to display startup screen while completing
   // the initialization.
   TCalcApplication* aCalcApplication = InitWithSplashScreen();

   // Launch the application's main event loop.
   aCalcApplication-&gt;Run();

} // main
</PRE>
<A NAME=HEADING84-69></A>
<H3>Create a Routine to Display a Startup Screen</H3>
 To display a startup screen, you write a routine that performs the following steps:<P>
<UL>
<LI>It gets and displays the startup screen.
<LI>It calls the MacApp routine <CODE>InitUMacApp_Step3</CODE> to perform additional MacApp initialization.
<LI>It calls MacApp routines to initialize other MacApp units used by the application (such as the Printing unit).
<LI>It creates and initializes an application object.
<LI>It closes the startup screen.
<LI>It returns the application object.<P>
</UL>
 The <CODE><A NAME=MARKER-2-48></A>InitWithSplashScreen</CODE> routine from the Calc application demonstrates these steps.<P>
<PRE>
TCalcApplication* InitWithSplashScreen()
{
   TCalcApplication* aCalcApplication = NULL;
   DialogRecord theDialogRecord;
.
   // Show the startup screen.
   if (GetNewCenteredDialog(phSplash,
      (Ptr) &amp;theDialogRecord,(WindowRef) (-1)) != NULL)
   {
      DrawDialog((GrafPort*) &amp;theDialogRecord);
   }
   // Continue initialization, including memory initialization.
   InitUMacApp_Step3(16);

   // Initialize additional units used by the application.
   InitUEditionDocument();
   InitUTEView();
   InitUGridView(); 
   InitUPrinting();

   // Create the application object and initialize it.
   aCalcApplication = new TCalcApplication;
   aCalcApplication-&gt;ICalcApplication();

   // Remove the startup screen and dispose of it.
   CloseDialog((DialogRef) &amp;theDialogRecord);
   DisposeIfHandle(theDialogRecord.items);

   // Return the application object we created.
   return aCalcApplication;

} // InitWithSplashScreen
</PRE>
 The constant <CODE>phSplash</CODE> identifies a dialog resource in the file <CODE>Calc.r</CODE>.<A NAME=MARKER-2-49></A><A NAME=MARKER-2-50></A><A NAME=MARKER-9-22></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-83.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-85.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
