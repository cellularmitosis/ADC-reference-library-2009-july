<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Apple Events Programming Guide: Working With the Data in an Apple Event</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Working With the Data in an Apple Event"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001582" title="Working With the Data in an Apple Event"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000494" target="_top">Carbon</a> &gt; <a href="../intro_aepg/intro_aepg.html#//apple_ref/doc/uid/TP40001449-CH201-DontLinkElementID_65">Apple Events Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dispatch_aes_aepg/dispatch_aes_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../responding_aepg/responding_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001582-BABDAJGB" title="Working With the Data in an Apple Event"></a><h1>Working With the Data in an Apple Event</h1><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_240"></a>This chapter describes how your application gets various kinds of data from Apple events and the data structures that comprise them.</p><p>Your application responds to Apple events in the Apple event handlers it registers, or in routines your handlers call. Within a handler, you know that the passed Apple event matches the expected event class and event ID, although there can be some variation if the handler is registered with one or more wildcards. In either case, your handler has at least a general idea of what information the Apple event should contain. In the case of a wildcard handler, it can obtain information from the Apple event to identify the type more closely.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-DontLinkElementID_28">About Extracting Data From an Apple Event</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABGDHIB">Coercing Data From an Apple Event</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-DontLinkElementID_29">Getting Data From an Apple Event Parameter</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-DontLinkElementID_30">Getting Data From an Apple Event Attribute</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-DontLinkElementID_31">Getting Data From a Descriptor</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABEAJGI">Getting Data From a Descriptor List</a>
				
			<br/>
			
        
			
			
				<a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABEDEGI">Disposing of Apple Event Data Structures</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_28" title="About Extracting Data From an Apple Event"></a><h2>About Extracting Data From an Apple Event</h2><p>The parameters and attributes of an Apple event, as well as the data within an individual descriptor, are stored in a format that is opaque to your application. You use Apple Event Manager functions to extract the data you need from a received Apple event. To obtain data in a format your application can use, you typically follow a common series of steps:</p><ol class="ol"><li class="li"><p>You call a function that returns the descriptor for a high-level data structure you are interested in, such as an Apple event attribute or parameter. For example, you can call the <code>AEGetAttributeDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_241"></a> function to obtain the descriptor for an attribute, specifying the attribute by its keyword.</p></li><li class="li"><p>If the returned descriptor is a list, you use another function to iterate over the items in the list. For example, you can use <code>AEGetNthDesc</code> to get descriptors from a list by index.</p></li><li class="li"><p>Once you have obtained an individual descriptor, you use other functions to extract its data. For example, you can call <code>AEGetDescDataSize</code> to determine the size of the data in a descriptor and <code>AEGetDescData</code> to get the data.</p></li></ol><p>Many of the functions for getting data from an Apple event are available in two forms:</p><ul class="ul"><li class="li"><p>One that returns a copy of the descriptor for the data.</p></li><li class="li"><p>One that returns a copy of the data in a buffer you have supplied.</p></li></ul><p>For example, <code>AEGetParamDesc</code> returns a copy of the descriptor for a parameter, while <code>AEGetParamPtr</code> returns the data from an Apple event parameter in a specified buffer. You typically use the buffer form to extract data of fixed length or known maximum length, such as a result code. You use the descriptor form to extract data of variable length, such as a list of unknown length.</p><p>You can also use Apple Event Manager functions to get data from descriptors, descriptor lists, and Apple events. For example, you can use the <code>AESizeOfAttribute</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_242"></a> function to get the size and descriptor type of an Apple event attribute from an Apple event. And you can use the <code>AESizeOfParam</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_243"></a> function to get the size and descriptor type of an Apple event parameter from an Apple event or an Apple event record (type <code>AERecord</code>).</p><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_244"></a>Where performance is critical, you can use <code>AECreateDescFromExternalPtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_245"></a> to efficiently create a descriptor containing large amounts of data, and call <code>AEGetDescDataRange</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_246"></a> to efficiently get data from a descriptor.</p><p>Other functions allow you to count the number of items in a descriptor list (<code>AECountItems</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_247"></a>) or iterate through those descriptors (<code>AEGetNthPtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_248"></a>or <code>AEGetNthDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_249"></a>).</p><p>This chapter provides examples of how to work with some of these functions, while <span class="content_text"><a href="../appendix1_aepg/appendix1_aepg.html#//apple_ref/doc/uid/TP40001449-CH211-CHDGFBFF">“Functions for Working With Apple Event Data Structures”</a></span> lists these and other Apple Event Manager functions. For complete reference, see <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p><a name="//apple_ref/doc/uid/TP40001582-BABGDHIB" title="Coercing Data From an Apple Event"></a><h2>Coercing Data From an Apple Event</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_250"></a><strong>Coercion</strong><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_251"></a> is the process of converting a descriptor and, if necessary, the data it contains, from one type to another. When your handler receives an Apple event, you typically use one or more of the functions <code>AEGetParamPtr</code>, <code>AEGetAttributePtr</code>, <code>AEGetParamDesc</code>, <code>AEGetAttributeDesc</code>, <code>AEGetNthPtr</code>, and <code>AEGetNthDesc</code> to get data from the Apple event. Each of these Apple Event Manager functions allows your application to specify a desired descriptor type for the resulting data. If the original data is of a different type, the Apple Event Manager attempts to coerce the data to the requested descriptor type. To prevent coercion and ensure that the descriptor type of the result is of the same type as the original, you specify <code>typeWildCard</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_252"></a>for the desired type.</p><p>The following code snippet shows how to specify a desired descriptor type when calling the function <code>AEGetParamPtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_253"></a>.</p><a name="//apple_ref/doc/uid/TP40001582-BABFJJDE" title="Listing 4-1Getting and coercing an Apple event parameter"></a><p class="codesample"><strong>Listing 4-1&nbsp;&nbsp;</strong>Getting and coercing an Apple event parameter</p><div class="codesample"><table><tr><td scope="row"><pre>    DescType        returnedType;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            multResult;<span></span></pre></td></tr><tr><td scope="row"><pre>    Size            actualSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AEGetParamPtr(<span></span></pre></td></tr><tr><td scope="row"><pre>            theAppleEvent,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>            keyMultResult,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            typeSInt32,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            &amp;returnedType,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            &amp;multResult,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            sizeof(multResult),<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            &amp;actualSize);<span>// 7</span></pre></td></tr></table></div><p>Here’s a description of the parameters used in this call:</p><ol class="ol"><li class="li"><p>A pointer to the Apple event to get the parameter data from.</p></li><li class="li"><p>A keyword constant specifying the parameter to get the data from. In this example, the keyword is defined by the application and indicates a parameter containing the result of a multiplication operation.</p></li><li class="li"><p>A constant specifying the type to coerce the returned value to (if it isn’t already that type).</p></li><li class="li"><p>The address of a variable in which the function stores the actual type of the returned value, which may not match the requested type.</p></li><li class="li"><p>The address of a variable in which the function stores the returned data.</p></li><li class="li"><p>The maximum size of the returned data. The <code>AEGetParamPtr</code> function won’t return more data than you specify in this parameter.</p></li><li class="li"><p>The address of a variable in which the function stores the actual size of the requested data. If the returned value is greater than the amount your application allocated to store the returned data, you can increase the size of your buffer to this amount and call the function again. You can also choose to use the <code>AEGetParamDesc</code> function when your application doesn’t know the size of the data.</p></li></ol><p>If the coercion fails, the <code>AEGetParamPtr</code> function returns the result code <code>errAECoercionFail</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_254"></a>.</p><p>By default, the Apple Event Manager can coerce between many different data types, listed in <span class="content_text"><a href="../appendix3_aepg/appendix3_aepg.html#//apple_ref/doc/uid/TP40001449-CH213-SW1">Table C-2</a></span>. To perform other coercions, such as those involving data types you have defined, you can provide your own coercion handlers. See <span class="content_text"><a href="../coercions_aepg/coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-BABDAJGB">“Writing and Installing Coercion Handlers”</a></span> for more information on working with coercion handlers.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_255"></a></p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_29" title="Getting Data From an Apple Event Parameter"></a><h2>Getting Data From an Apple Event Parameter</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_256"></a>Apple event parameters are keyword-specified descriptors. You can use the  <code>AEGetParamDesc</code> function to get the descriptor for a parameter or to extract the descriptor list from a parameter; you can use <code>AEGetParamPtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_257"></a> to get the data from the descriptor for a parameter. In general, use the former to extract data of variable length, and the latter to extract data of fixed length or known maximum length.</p><p><span class="content_text">Listing 4-2</span> shows how to call <code>AEGetParamDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_258"></a> to extract a parameter descriptor from an Apple event such as an <code>open documents </code>event.</p><a name="//apple_ref/doc/uid/TP40001582-BABIIGAC" title="Listing 4-2Getting a parameter as a descriptor"></a><p class="codesample"><strong>Listing 4-2&nbsp;&nbsp;</strong>Getting a parameter as a descriptor</p><div class="codesample"><table><tr><td scope="row"><pre>    AEDescList  docList;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       myErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AEGetParamDesc( theAppleEvent,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                            keyDirectObject,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                            typeAEList,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                            &amp;docList);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Check the returned value from AEGetParamDesc for any error.<span></span></pre></td></tr><tr><td scope="row"><pre>    // (Not shown.)<span></span></pre></td></tr></table></div><p>Here’s a description of the parameters used in this call:</p><ol class="ol"><li class="li"><p>A pointer to the Apple event to get the parameter descriptor from (obtained previously).</p></li><li class="li"><p>A constant specifying that the function should get the descriptor for the direct parameter.</p></li><li class="li"><p>A constant specifying that the descriptor should be returned as a descriptor list, coercing it if necessary. If the coercion fails, the function returns the result code <code>errAECoercionFail</code>.</p></li><li class="li"><p>The address of a variable in which the function stores the returned descriptor list.</p></li></ol><p>See <span class="content_text"><a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABEAJGI">“Getting Data From a Descriptor List”</a></span> for details on working with a descriptor list.</p><p>The <code>AEGetParamDesc</code> function supplies a copy of the descriptor for the parameter, so you must dispose of it when you’re finished with it by calling the <code>AEDisposeDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_259"></a> function. For an example, see <span class="content_text"><a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABEJAAF">Listing 4-6</a></span>.</p><p>If an Apple event parameter contains an object specifier, your handler should use the <code>AEResolve</code> function, other Apple Event Manager functions, and your own application-defined functions to resolve the object specifier—that is, to locate the Apple event object in your application that the specifier describes. For more information, see <span class="content_text"><a href="http://developer.apple.com/documentation/mac/IAC/IAC-231.html#HEADING231-0" target="_top">“Resolving and Creating Object Specifier Records”</a></span> in <span class="content_text"><a href="http://developer.apple.com/documentation/mac/IAC/IAC-2.html" target="_top">Inside Macintosh: Interapplication Communication</a></span>.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_260"></a></p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_30" title="Getting Data From an Apple Event Attribute"></a><h2>Getting Data From an Apple Event Attribute</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_261"></a>To get the descriptor for an attribute or to get the data from an attribute you use routines that are similar to those you use with parameters: the <code>AEGetAttributePtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_262"></a> and <code>AEGetAttributeDesc<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_263"></a></code> functions.</p><p>For example, <span class="content_text">Listing 4-3</span> shows how to use <code>AEGetAttributePtr</code> to get the data from the <code>keyEventSourceAttr</code> attribute of an Apple event.</p><a name="//apple_ref/doc/uid/TP40001582-BABCGDAE" title="Listing 4-3Getting a value from an attribute"></a><p class="codesample"><strong>Listing 4-3&nbsp;&nbsp;</strong>Getting a value from an attribute</p><div class="codesample"><table><tr><td scope="row"><pre>    DescType        returnedType;<span></span></pre></td></tr><tr><td scope="row"><pre>    AEEventSource   sourceOfAE;<span></span></pre></td></tr><tr><td scope="row"><pre>    Size            actualSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           myErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myErr = AEGetAttributePtr( theAppleEvent,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                            keyEventSourceAttr,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                            typeShortInteger,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                            &amp;returnedType,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                            (void *) &amp;sourceOfAE,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                            sizeof (sourceOfAE),<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                            &amp;actualSize);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Check the returned value from AEGetParamDesc for any error.<span></span></pre></td></tr><tr><td scope="row"><pre>    // (Not shown.)<span></span></pre></td></tr></table></div><p>Here’s a description of the parameters used in this call:</p><ol class="ol"><li class="li"><p>A pointer to the Apple event to get the attribute data from (obtained previously).</p></li><li class="li"><p>A constant specifying the attribute from which to get the data.</p></li><li class="li"><p>A constant specifying that the data should be returned as a short integer.</p></li><li class="li"><p>The address of a variable in which the function stores the type of the actual descriptor returned.</p></li><li class="li"><p>The address of a variable in which the function stores the requested data. If the data is not already a short integer, the Apple Event Manager coerces it as necessary. The value should equal one of the event source constant values described in <span class="content_text"><a href="../appendix2_aepg/appendix2_aepg.html#//apple_ref/doc/uid/TP40001449-CH212-CHDFBBGE">“Event Source Constants.”</a></span></p><p>If you allocate a buffer for this parameter, it’s up to you to free it when you are finished with it.</p></li><li class="li"><p>The size of the return buffer.</p></li><li class="li"><p>The address of a variable in which the function stores the actual size of the returned data after coercion has taken place. You can check this value to make sure you got all the data.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_264"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_31" title="Getting Data From a Descriptor"></a><h2>Getting Data From a Descriptor</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_265"></a>Because the data within a descriptor is opaque, you use Apple Event Manager functions to extract it. In some cases, such as the example shown in <span class="content_text">Listing 4-3</span>, the data is of known type and size, or can be coerced to a known type, and you can store it in a variable of that type.</p><p>It is common, however, for a descriptor to contain data, such as text or an image, of unknown size. In situations of that type, you can call the <code>AEGetDescDataSize</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_266"></a> function to find out how much memory you will need to store the data, allocate a buffer of that size, then call <code>AEGetDescData</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_267"></a> to get the actual data from the descriptor. The code snippet in <span class="content_text">Listing 4-4</span> shows how you might use these functions to get data into a buffer.</p><a name="//apple_ref/doc/uid/TP40001582-BABDFJFJ" title="Listing 4-4Determining the size, then obtaining descriptor data"></a><p class="codesample"><strong>Listing 4-4&nbsp;&nbsp;</strong>Determining the size, then obtaining descriptor data</p><div class="codesample"><table><tr><td scope="row"><pre>    Size dataSize = AEGetDescDataSize(desc);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    UInt8* buffer = malloc(dataSize);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    if (buffer)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        OSErr err = AEGetDescData(desc, buffer, dataSize);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // If no error, use the data.<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        free(buffer);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s a description of what this code does:</p><ol class="ol"><li class="li"><p>Calls an Apple Event Manager function to get the data size for the descriptor.</p></li><li class="li"><p>Creates a buffer of that size.</p></li><li class="li"><p>Calls an Apple Event Manager function to get the data from the descriptor into the buffer.</p></li><li class="li"><p>If no error occurred in getting the data, your application can use it as needed.</p></li><li class="li"><p>Frees the allocated buffer.</p></li></ol><p>Alternatively, you can do the following:</p><ol class="ol"><li class="li"><p>Call the <code>AEGetParamPtr</code> function (shown in <span class="content_text"><a href="data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABFJJDE">Listing 4-1</a></span>), passing a size of zero for the maximum size (line 6 in the listing).</p></li><li class="li"><p>Get the actual size value returned by <code>AEGetParamPtr</code>.</p></li><li class="li"><p>Allocate a buffer of that size.</p></li><li class="li"><p>Call <code>AEGetParamPtr</code> again to get the data into the buffer.</p></li><li class="li"><p>If you allocated memory for the buffer, free it when you are finished with it.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_268"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001582-BABEAJGI" title="Getting Data From a Descriptor List"></a><h2>Getting Data From a Descriptor List</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_269"></a>To get descriptors and their data from a descriptor list, you can call the <code>AECountItems</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_270"></a> function to get the number of descriptors in the list, then set up a loop that calls <code>AEGetNthDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_271"></a> or <code>AEGetNthPtr</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_272"></a> to get the data from each descriptor.</p><p>For example, an <code>open documents</code> event contains a direct parameter that specifies a list of documents to open. The parameter contains a descriptor list in which each descriptor specifies an alias to a file to open. <span class="content_text">Listing 4-5</span> shows how you can extract the descriptor list from the parameter, determine the number of items it contains, and extract each descriptor from the list.</p><a name="//apple_ref/doc/uid/TP40001582-BABGBICJ" title="Listing 4-5Getting a descriptor list and its items"></a><p class="codesample"><strong>Listing 4-5&nbsp;&nbsp;</strong>Getting a descriptor list and its items</p><div class="codesample"><table><tr><td scope="row"><pre>    AEDescList  docList;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSRef       theFSRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        index;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        count = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AEGetParamDesc(theAppleEvent, keyDirectObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                         typeAEList, &amp;docList);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AECountItems(&amp;docList, &amp;count);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for(index = 1; index &lt;= count; index++)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = AEGetNthPtr(&amp;docList, index, typeFSRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, NULL, &amp;theFSRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(theFSRef), NULL);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Call routine to open document with current reference.<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s a description of what this code does:</p><ol class="ol"><li class="li"><p>Calls <code>AEGetParamDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_273"></a> to obtain, in the variable <code>docList</code>, a copy of the descriptor list from the direct parameter of the Apple event. Passes the constant <code>keyDirectObject</code> to identify the direct parameter and the constant <code>typeAEList</code> to indicate the desired descriptor type. (<code>theAppleEvent</code> is a pointer to the Apple event, obtained previously, to get the parameter descriptor from).</p></li><li class="li"><p>Calls <code>AECountItems</code>, passing the previously obtained descriptor list, to get the number of items in the list.</p></li><li class="li"><p>Sets up a loop based on the count.</p></li><li class="li"><p>Calls <code>AEGetNthPtr</code> to obtain the indexed descriptor from the list. Passes <code>typeFSRef</code> to indicate the descriptor should be coerced to a file system reference, if necessary (otherwise the returned value will be a file alias). Passes the address of the variable <code>theFSRef</code> as a buffer to store the reference.</p><p>Passes <code>NULL</code> for the fourth and fifth parameters, indicating the keyword and descriptor type of the returned item aren’t needed.</p><p>Also passes <code>NULL</code> for the last parameter, indicating the actual size of the returned data isn’t required. (If the returned size is larger than the size of the buffer you provided, you know that you didn’t get all of the data for the descriptor.)</p></li><li class="li"><p>Here you would call your own routine to open a document specified by the extracted file system reference.</p></li></ol><p>For a more complete version of this code, including simple error handling, see <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGCCHDG">Listing 5-5</a></span>.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_274"></a></p><a name="//apple_ref/doc/uid/TP40001582-BABEDEGI" title="Disposing of Apple Event Data Structures"></a><h2>Disposing of Apple Event Data Structures</h2><p><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_275"></a>If you create a descriptor, you must dispose of it when you are finished with it to prevent memory leaks. For example, when you extract a descriptor using the <code>AEGetParamDesc</code>, <code>AEGetAttributeDesc</code>, <code>AEGetNthDesc</code>, or <code>AEGetKeyDesc</code> function, you get a copy of the descriptor. You call the <code>AEDisposeDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_276"></a> function to dispose of your copy, thereby deallocating the memory used by its data.</p><p><span class="content_text">Listing 4-6</span> shows how to dispose of a descriptor list returned by <code>AEGetParamDesc</code><a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_277"></a>.</p><a name="//apple_ref/doc/uid/TP40001582-BABEJAAF" title="Listing 4-6Disposing of a descriptor list obtained from the direct object of an Apple event"></a><p class="codesample"><strong>Listing 4-6&nbsp;&nbsp;</strong>Disposing of a descriptor list obtained from the direct object of an Apple event</p><div class="codesample"><table><tr><td scope="row"><pre>AEDescList  docList;<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr       err;<span></span></pre></td></tr><tr><td scope="row"><pre>err = AEGetParamDesc(theAppleEvent, keyDirectObject, typeAEList, &amp;docList);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Check for error, then perform operations on the descriptor list here.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>AEDisposeDesc(&amp;docList);<span></span></pre></td></tr></table></div><p>You can safely call <code>AEDisposeDesc</code> on a null descriptor (but not on a null pointer!) A <a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_278"></a><strong>null descriptor</strong> is one that has been initialized as shown in the following code snippet.</p><div class="codesample"><table><tr><td scope="row"><pre>AEDesc      someDesc = { typeNull, 0L };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Code to obtain a descriptor, which may fail.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Safe to dispose, whether or not previous code succeeded.<span></span></pre></td></tr><tr><td scope="row"><pre>AEDisposeDesc(&amp;someDesc);<span></span></pre></td></tr></table></div><p>You can perform the same initialization using the <code>AEInitializeDesc</code> function, as shown in this code snippet.</p><div class="codesample"><table><tr><td scope="row"><pre>    AEDesc      someDesc;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AEInitializeDesc(&amp;someDesc);<span></span></pre></td></tr></table></div><p>When you obtain a copy of a descriptor with one of the buffer-based functions, such as <code>AEGetAttributePtr</code> or <code>AEGetNthPtr</code>, the data is copied into a buffer provided by your application. You must then free any allocated memory when finished with the buffer<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_279"></a>.<a name="//apple_ref/doc/uid/TP40001582-DontLinkElementID_280"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dispatch_aes_aepg/dispatch_aes_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../responding_aepg/responding_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/AppleEvents/data_in_ae_aepg/data_in_ae_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/AppleEvents/data_in_ae_aepg/data_in_ae_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/AppleEvents/data_in_ae_aepg/data_in_ae_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>