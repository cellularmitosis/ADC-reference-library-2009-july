<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note FL17: CreateResFile and the Poor Man's Search Path</title><meta name="keywords" content="Mac OS 8 CreateResFile PMSP SFPutFile dupFNErr -48 OpenResFile"><meta name="Description" content="Technical Note FL17: This Technical Note describes the functioncall CreateResFile, focusing on its return value and thealgorithm it uses to do its search (termed the Poor Man'sSearch Path PMSP). Because the search path used by CreateResFilemay return an error when you want to create a file ( evenif a resource file with the same name doesn't exist in thecurrent directory) TechNote provides an alternative callfor creating a directory. Technical Note includes a codesnippet to illustrate the use of CreateResFile.">                                       <meta name="categories" content="Files"><meta name="week-posted" content="Dec 29, 1986 - Jan 2, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002443" title="CreateResFile and the Poor Man's Search Path"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxFileManagement-date.html" target="_blank">Carbon > File Management</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note FL17</div>
<div id="pageheadsub">CreateResFile and the Poor Man's Search Path</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">                  <A HREF="#Section1">CreateResFile</A><BR><BR>           <A HREF="#References">References</A><BR><BR>          <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text -->  <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jan 01 1987]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><h2>CreateResFile</h2><P><code>CreateResFile</code> checks to see if a resource file with a given name exists,and if it does, returns a <code>dupFNErr</code> (-48) error. Unfortunately, to do this check, <code>CreateResFile</code> uses a call that follows the Poor Man's Search Path (PMSP).</p><p><code>CreateResFile</code> checks to see if a resource file with a given name exists, and if it does, returns a <code>dupFNErr</code> (-48) error. Unfortunately, to do the check, <code>CreateResFile</code>calls <code>PBOpenRF</code>, which uses the Poor Man's Search Path (PMSP). For example, if we have a resource file in the System folder named `<code>MyFile</code>' (and no file with that name in the current directory) and we call <code>CreateResFile('MyFile')</code>, <code>ResError</code> will returna <code>dupFNErr</code>, since <code>PBOpenRF</code> will search the current directory first, then search the blessed folder on the same volume. This makes it impossible to use <code>CreateResFile</code> to create the resource file '<code>MyFile</code>' in the current directory if a file with the same name already existsin a directory that's in the PMSP.</p><p>To make sure that <code>CreateResFile</code> will create a resource file in thecurrent directory whether or not a resource file with the same name alreadyexists further down the PMSP, call <code>_Create</code> (<code>PBCreate</code> or<code>Create</code>) before calling <code>CreateResFile</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    err := Create('MyFile',0,myCreator,myType);        {0 for VRefNum means current volume/directory}    CreateResFile('MyFile');    err := ResError; {check for error}</pre>	</TD></TR></TABLE></CENTER><p>In MPW C:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    err = Create(&quot;\pMyFile&quot;,0,myCreator,myType);    CreateResFile(&quot;\pMyFile&quot;);    err = ResError();</pre>	</TD></TR></TABLE></CENTER><p>This works because <code>_Create</code> does <b>not</b> use the PMSP. If we alreadyhave `<code>MyFile</code>' in the current directory, <code>_Create</code> will failwith a <code>dupFNErr</code>, then, if `<code>MyFile</code>' has an empty resourcefork, <code>CreateResFile</code> will write a resource map, otherwise,<code>CreateResFile</code> will return <code>dupFNErr</code>. If there is no file named'<code>MyFile</code>' in the current directory, <code>_Create</code> will create oneand then <code>CreateResFile</code> will write the resource map.</p><p>Notice that we are intentionally ignoring the error from <code>_Create</code>,since we are calling it only to assure that a file named `<code>MyFile</code>' doesexist in the current directory.</p><p>Please note that <code>SFPutFile</code> does <b>not</b> use the PMSP, but that<code>FSDelete</code> does. <code>SFPutFile</code> returns the <code>vRefNum/WDRefNum</code> of the volume/folder that the user selected. If your program deletes a resource file before creating one with the same name based on information returned from <code>SFPutFile</code>, you can use the following strategy to avoid deleting the wrong file, that is, a file that is not in the directory specified by the <code>vRefNum/WDRefNum</code> returned by <code>SFPutFile</code>, but in some other directory in the PMSP:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    VAR        wher    : Point;        reply    : SFReply;        err        : OSErr;        oldVol    : Integer;    ...        wher.h := 80; wher.v := 90;        SFPutFile(wher,'','',NIL,reply);        IF reply.good THEN BEGIN            err := GetVol(NIL,oldVol); {So we can restore it later}            err := SetVol(NIL,reply.vRefNum);{for the CreateResFile call}        {Now for the Create/CreateResFile calls to create a resource file that        we know is in the current directory}            err := Create(reply.fName,reply.vRefNum,myCreator,myType);            CreateResFile(reply.fName); {we'll use the ResError from this ...}            CASE ResError OF                noErr:{the create succeeded, go ahead and work with the new                resource file -- NOTE: at this point, we don't know what's                in the data fork of the file!!} ;                dupFNErr: BEGIN {duplicate file name error}                {the file already existed, so, let's delete it. We're                now sure that we're deleting the file in the current directory}                        err:= FSDelete(reply.fName,reply.vRefNum);                {now that we've deleted the file, let's create the new one,                again, we know this will be in the current directory}                err:= Create(reply.fName,reply.vRefNum,myCreator,myType);                        CreateResFile(reply.fName);                END; {CASE dupFNErr}                OTHERWISE        {handle other errors} ;            END;                {Case ResError}            err := SetVol(NIL,oldVol);{restore the default directory}        END; {If reply.good}    ...</pre>	</TD></TR></TABLE></CENTER><p>In MPW C:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        Point             wher;        SFReply        reply;        OSErr            err;        short             oldVol;        wher.h = 80; wher.v = 90;        SFPutFile(wher,&quot;&quot;,&quot;&quot;,nil,&amp;reply);        if (reply.good )        {            err = GetVol(nil,&amp;oldVol); /*So we can restore it later*/            err = SetVol(nil,reply.vRefNum);/*for the CreateResFile call*/            /*Now for the Create/CreateResFile calls to create a resource            file that we know is in the current directory*/            err = Create(&amp;reply.fName,reply.vRefNum,myCreator,myType);            CreateResFile(&amp;reply.fName); /*we'll use the ResError            from this ...*/            switch    (ResError())            {            case noErr:;/*the create succeeded, go ahead and work with the            new resource file -- NOTE: at this point, we don't know what's            in the data fork of the file!!*/                     break; /* case noErr*/                case dupFNErr: /*duplicate file name error*/                        /*the file already existed, so, let's delete it.                        We're now sure that we're deleting the file in the                        current directory*/                err= FSDelete(&amp;reply.fName,reply.vRefNum);                    /*now that we've deleted the file, let's create the new one,                    again, we know this will be in the current directory*/                            err= Create(&amp;reply.fName,reply.vRefNum,                            myCreator,myType);                            CreateResFile(&amp;reply.fName);                    break; /*case dupFNErr*/                default:;        /*handle other errors*/            }     /* switch */            err = SetVol(nil,oldVol);/*restore the default directory*/        }                    /*if reply.good*/</pre>	</TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR><code>OpenResFile</code> uses the PMSP too, so you may have to adoptsimilar strategies to make sure that you are opening the desired resource fileand not some other file further down the PMSP. This is normally not a problemif you use <code>SFGetFile</code>, since <code>SFGetFile</code> does not use the PMSP,in fact, <code>SFGetFile</code> does not open or close files, so it doesn't runinto this problem.</P></TD></TR></TABLE></CENTER><BR><a name="References"></a><h2>References</h2><p>The File Manager</p><p>The Resource Manager</p><p>Technical Note <u><A HREF = "fl_22.html">M.FL.HFSRuminations</a></u></p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/fl_17.pdf">Download</A></P>               </TD>            </TR></table><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/fl/fl_17.html%3Fid%3DDTS10002443-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/fl/fl_17.html%3Fid%3DDTS10002443-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/fl/fl_17.html%3Fid%3DDTS10002443-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML>