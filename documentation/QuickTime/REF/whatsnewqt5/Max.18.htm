<HTML><head><script language="JavaScript" src="../../RM/frametest.js"></script><TITLE> Adding Media Skins Using the QuickTime API</TITLE><script language=javascript> window.parent.focus(); </script></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>What's New in QuickTime 5</I><P>| <A HREF="Max.17.htm">Previous</A> | <A HREF="Max.1.htm">Chapter Contents</A> | <A HREF="Max.htm">Chapter Top</A> | <A HREF="Max.19.htm">Next</A> |</P></DIV><!-- QTnavbar end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=72614"> </A><A NAME="marker=93025"> </A>Adding Media Skins Using the QuickTime API</H1><P CLASS="T1.Text1"><A NAME="pgfId=72615"> </A>You can also add a media skin to a movie programatically -- for example, to enhance a movie editing application. </P><P CLASS="T1.Text1"><A NAME="pgfId=72619"> </A>You could do this by mimicking the steps just described in the section <A HREF="Max.16.htm#21123" CLASS="XRef">&quot;Creating Media Skins&quot;</A>. That is, you can generate a movie file, a pair of black-and-white image files, and a small XML text file that points to them, then call a movie importer to put them all together, flatten and save.</P><P CLASS="T1.Text1"><A NAME="pgfId=72620"> </A>But it's simpler to add a media skin to a movie in memory without going through an XML skin importer. The process is as follows:</P><OL><LI CLASS="N/.NList=1"><A NAME="pgfId=91574"> </A>Locate two black-and-white PICT files, or create two PICT images in RAM, to act as a window region mask and a drag region mask (You can use graphic importer and exporter components to convert a BMP or GIF to a PICT). See <A HREF="Max.16.htm#41863" CLASS="XRef">Figure&nbsp;13</A> and <A HREF="Max.16.htm#46843" CLASS="XRef">Figure&nbsp;14</A> for examples of these kinds of images.</LI><LI CLASS="N.NList"><A NAME="pgfId=91578"> </A>Create a <TT CLASS="cv">PicHandle</TT> that points to each mask image.</LI><LI CLASS="N.NList"><A NAME="pgfId=72623"> </A>Add a new track to the movie.</LI><LI CLASS="N.NList"><A NAME="pgfId=72624"> </A>Add a media of type <TT CLASS="cv">'skin'</TT> to the new track.</LI><LI CLASS="N.NList"><A NAME="pgfId=72626"> </A>Tell the media handler to put the masks in a public resource.</LI><LI CLASS="N.NList"><A NAME="pgfId=72627"> </A>Flatten and save.</LI></OL><P CLASS="T1.Text1"><A NAME="pgfId=75059"> </A>The code snippet shown in <A HREF="Max.18.htm#62259" CLASS="XRef">Listing&nbsp;2</A> provides a general outline of how you can add a media skin programmatically to a QuickTime movie, and is intended primarily as a guide to the process -- not as actual working code. </P><P CLASS="T1.Text1"><A NAME="pgfId=75960"> </A><A HREF="Max.18.htm#44241" CLASS="XRef">Listing&nbsp;3</A>, however, is working code that walks you through the various steps you need to follow in order to add media skins programmatically to a QuickTime movie. </P><P CLASS="L.Listing"><A NAME="pgfId=75061"> </A>Listing&nbsp;2 <A NAME="62259"> </A>A general outline of how you add a media skin to a QuickTime movie</P><CODE CLASS="Cv.Code"><A NAME="pgfId=97085"> </A>//Adding a skin without using the importer<BR><BR>// Somehow create a picture handle:<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;PicHandle winRgnHndl = nil;<BR>&nbsp;&nbsp;&nbsp;&nbsp;PicHandle dragRgnHndl = nil;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;winRgnHndl = MyMagicalCode();<BR>&nbsp;&nbsp;&nbsp;&nbsp;dragRgnHndl = MyMagicalCode();<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// create a new track<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;theTrack = NewMovieTrack(myMovie, ((Fixed)movieBox.right) &lt;&lt; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((Fixed)16, movieBox.bottom) &lt;&lt; 16, 0);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// must have someplace for the sample data to go<BR>&nbsp;&nbsp;&nbsp;&nbsp;// could use BeginMediaEdits, or...<BR>&nbsp;&nbsp;&nbsp;&nbsp;// create a cool handle that the HandleDataHandler can deal with,<BR>&nbsp;&nbsp;&nbsp;&nbsp;// so I can add this stuff in ram without needing a file<BR>&nbsp;&nbsp;&nbsp;&nbsp;dataRef = NewHandleClear(5);<BR>&nbsp;&nbsp;&nbsp;&nbsp;atomHeader[0] = EndianU32_NtoB(8);<BR>&nbsp;&nbsp;&nbsp;&nbsp;atomHeader[1] = EndianU32_NtoB('data');<BR>&nbsp;&nbsp;&nbsp;&nbsp;PtrAndHand(atomHeader, dataRef, 8);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// add a skin media structure to the movie track<BR>&nbsp;&nbsp;&nbsp;&nbsp;theMedia = NewTrackMedia(theTrack, 'skin', movieTimeScale, dataRef, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HandleDataHandlerSubType);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// retrieve media handler reference so we can call it<BR>&nbsp;&nbsp;&nbsp;&nbsp;mh = GetMediaHandler(theMedia);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// tell the media handler to add the masks <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'skcr' is skin content region<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 'skdr' is skin drag region<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// final parameter is length -- set to 0 for an allocated handle<BR>&nbsp;&nbsp;&nbsp;&nbsp;err = MediaSetPublicInfo(mh, 'skcr', winRgnHndl, 0);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (err) goto bail;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;err = MediaSetPublicInfo(mh, 'skdr', dragRgnHndl, 0);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (err) goto bail;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;// dispose of the Handle when done<BR>&nbsp;&nbsp;&nbsp;&nbsp;DisposeHandle(dataRef);<BR>&nbsp;&nbsp;&nbsp;&nbsp;dataRef = nil</code><br><P CLASS="L.Listing"><A NAME="pgfId=75021"> </A>Listing&nbsp;3 Adding media skins programmatically to a QuickTime movie<A NAME="44241"> </A></P><CODE CLASS="Cv.Code"><A NAME="pgfId=97089"> </A>OSErr QTSkin_AddSkinTrack (Movie theMovie){<BR>        Track myTrack = NULL; // the skin track<BR>        Media myMedia = NULL; // the skin track's media<BR>        Rect myRect;<BR>        MediaHandler myHandler = NULL;<BR>        PicHandle myContentPic = NULL; // window mask<BR>        PicHandle myDragPic = NULL; // drag mask<BR>        OSErr myErr = paramErr;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (theMovie == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR> <BR>// elicit the two pictures we need from the user<BR>        myContentPic = QTSkin_GetPicHandleFromFile();<BR>        if (myContentPic == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myDragPic = QTSkin_GetPicHandleFromFile();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (myDragPic == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR><BR>// get the movie's dimensions<BR>        GetMovieBox(theMovie, &amp;myRect);<BR>        MacOffsetRect(&amp;myRect, -myRect.left, -myRect.top);</code><br><CODE CLASS="Cv.Code"><A NAME="pgfId=97093"> </A>// create the skin track and media<BR>        myTrack = NewMovieTrack(theMovie, FixRatio(myRect.right, 1), <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FixRatio(myRect.bottom, 1), kNoVolume);<BR>        if (myTrack == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myMedia = NewTrackMedia(myTrack, FOUR_CHAR_CODE('skin'), <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMovieTimeScale(theMovie), NULL, 0);<BR>        if (myMedia == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;</code><br><CODE CLASS="Cv.Code"><A NAME="pgfId=97097"> </A>// find a media handler that understands skins<BR>        myHandler = GetMediaHandler(myMedia);<BR>        if (myHandler == NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR><BR>// tell the media handler to add <BR>// the skin content picture<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr = MediaSetPublicInfo(myHandler, FOUR_CHAR_CODE('skcr'),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void *)myContentPic, 0);<BR>        if (myErr != noErr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR><BR>// now add the skin drag picture<BR>        myErr = MediaSetPublicInfo(myHandler, FOUR_CHAR_CODE('skdr'),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void *)myDragPic, 0);<BR>        if (myErr != noErr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto bail;<BR>// note: the last parameter passed to <BR>// MediaSetPublicInfo is the data size;<BR>// pass 0 for an allocated handle<BR><BR>// add the media to the track<BR>        myErr = InsertMediaIntoTrack(myTrack, 0, 0,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMediaDuration(myMedia), fixed1);<BR><BR>// skin tracks should be disabled...<BR>        SetTrackEnabled(myTrack, false);<BR>bail:<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myContentPic != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KillPicture(myContentPic);<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (myDragPic != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KillPicture(myDragPic);<BR>&nbsp;&nbsp;&nbsp;&nbsp;return(myErr);<BR>}</code><br><hr>&#169; 2001 Apple Computer, Inc.<!-- QTnavbar start --><P><I>What's New in QuickTime 5</I><P>| <A HREF="Max.17.htm">Previous</A> | <A HREF="Max.1.htm">Chapter Contents</A> | <A HREF="Max.htm">Chapter Top</A> | <A HREF="Max.19.htm">Next</A> |</P></DIV><!-- QTnavbar end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>