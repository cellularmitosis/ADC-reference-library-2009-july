<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Inserting with the Adaptor Sublayer</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.23.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.25.html"><img src="next.gif" border="0" alt="Next"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="36344"> </A>Inserting with the Adaptor Sublayer</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=612507"> </A>Describes how to insert a row into the database using the adaptor channel's <TT CLASS="Code">insertRow</TT> method.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Description</H2><P CLASS="Body-Text"><A NAME="pgfId=612515"> </A>There are three ways to insert a row into the database with the adaptor sublayer. You can insert using raw SQL using the adaptor channel's <TT CLASS="Code">evaluateExpression</TT> method, the adaptor channel's <TT CLASS="Code">insertRow</TT> method, or a stored procedure.</P><P CLASS="Body"><A NAME="pgfId=618340"> </A>In this topic we describe how to insert a row using the <TT CLASS="Code">insertRow</TT> method. This method eliminates the overhead associated with snapshots, uniquing, and fault creation. Furthermore, the source code does not depend on the particular database you use. However, you have to work with raw row dictionaries and you are responsible for setting the primary key. This example sets the primary key using the adaptor channel's <TT CLASS="Code">primaryKeyForNewRowWithEntity</TT> method. See the programming topic <A HREF="ProgrammingTopics.23.html#31742" CLASS="XRef">Generating Primary Key Values</A> for more information about the tradeoffs when generating primary keys.</P><P CLASS="Body"><A NAME="pgfId=619063"> </A>If you are working with an editing context and inserting using the adaptor sublayer at the same time, EOF does not realize that an object has been inserted. You need to synchronize any enterprise objects with the changes to the database. </P><P CLASS="Body"><A NAME="pgfId=618235"> </A>To insert a row using the adaptor channel's <TT CLASS="Code">insertRow</TT> method, you need to provide</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=618434"> </A>An EOModel mapping entities to database tables.</LI><LI CLASS="Bulleted"><A NAME="pgfId=618486"> </A>An NSDictionary containing the row. The keys for the row are the attribute names not the database column names.</LI><LI CLASS="Bulleted"><A NAME="pgfId=618487"> </A>An adaptor channel that is connected to the database. (See the programming topics <A HREF="ProgrammingTopics.30.html#27044" CLASS="XRef">Accessing Adaptor Sublayer Objects</A>, <A HREF="ProgrammingTopics.31.html#17565" CLASS="XRef">Creating Adaptor Sublayer Objects and Connecting Them to the Server</A>, and <A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A> for more information about getting an adaptor channel.</LI><LI CLASS="Bulleted"><A NAME="pgfId=619078"> </A>The name of the entity that you wish to insert, for example, &quot;<TT CLASS="Code">Movie</TT>&quot;.</LI></UL><P CLASS="Body"><A NAME="pgfId=612592"> </A>The following code inserts a row using the adaptor sublayer.</P><PRE CLASS="Code"><A NAME="pgfId=619108"> </A>EOAdaptorChannel myAdaptorChannel; // assume exists<A NAME="pgfId=612547"> </A>String modelName = &quot;movies&quot;;<A NAME="pgfId=618112"> </A>String entityName = &quot;Movie&quot;;<A NAME="pgfId=618127"> </A><A NAME="pgfId=618924"> </A>NSMutableDictionary dict = new NSMutableDictionary();<A NAME="pgfId=618930"> </A>dict.setObjectForKey (&quot;EOF III: The Multithreading&quot;,&quot;title&quot;);<A NAME="pgfId=618931"> </A>dict.setObjectForKey (&quot;Action&quot;,&quot;category&quot;);<A NAME="pgfId=618932"> </A>dict.setObjectForKey (new Integer(90000000),&quot;revenue&quot;);<A NAME="pgfId=619120"> </A><A NAME="pgfId=619128"> </A>EOModel myModel = EOModelGroup.defaultGroup().modelNamed(modelName);<A NAME="pgfId=619121"> </A>EOEntity myEntity = myModel.entityNamed(entityName);<A NAME="pgfId=618799"> </A><A NAME="pgfId=612583"> </A>myAdaptorChannel.openChannel();<A NAME="pgfId=618982"> </A>dict.addEntriesFromDictionary(myAdaptorChannel.   // get a primary key<A NAME="pgfId=618897"> </A>    primaryKeyForNewRowWithEntity(myEntity));<A NAME="pgfId=619003"> </A>myAdaptorChannel.insertRow(dict,myEntity);        // insert the row<A NAME="pgfId=612589"> </A>myAdaptorChannel.closeChannel();	</PRE><P CLASS="Body"><A NAME="pgfId=619144"> </A>The code first allocates and initializes a raw row dictionary for the new database row.</P><P CLASS="Body"><A NAME="pgfId=619152"> </A>The code then finds the EOModel corresponding to the model name in the default model group. The default model group, accessed using <TT CLASS="Code">EOModelGroup.defaultGroup()</TT> is a collection of EOModel objects corresponding to the models in the project's Resources suitcase. If you already have the EOModel, you don't need this step. Next, the code determines the EOEntity corresponding to the given entity name from the EOModel.</P><P CLASS="Body"><A NAME="pgfId=619131"> </A>Before performing <TT CLASS="Code">insertRow</TT> with the adaptor channel, the code establishes a connection to the database using the <TT CLASS="Code">openChannel</TT> method and determines a primary key for the row. The <TT CLASS="Code">primaryKeyForNewRowWithEntity</TT> method returns the primary key as an NSDictionary, which the code merges with the raw row dictionary before inserting the row into the database. The <TT CLASS="Code">closeChannel</TT> method invocation disconnects the channel from the database.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606206"> </A>Insertion Failures</H3><P CLASS="Body"><A NAME="pgfId=618584"> </A>The insertion can fail for the following reasons:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606138"> </A>The user logged on to the database does not have permission to insert a row.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606192"> </A>The EOAdaptorChannel is in an invalid state for inserting, for example, a fetch is in progress. To test if a fetch is in progress, use the adaptor channel's <TT CLASS="Code">isFetchInProgress</TT> method.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606140"> </A>The inserted row fails to satisfy constraints defined in the database, for example, the primary key is missing or has an improper value.</LI></UL></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=618598"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=618599"> </A><A HREF="ProgrammingTopics.30.html#27044" CLASS="XRef">Accessing Adaptor Sublayer Objects</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=618609"> </A><A HREF="ProgrammingTopics.31.html#17565" CLASS="XRef">Creating Adaptor Sublayer Objects and Connecting Them to the Server</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=618626"> </A><A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=618603"> </A>	<A HREF="ProgrammingTopics.27.html#10154" CLASS="XRef">Updating with the Adaptor Sublayer</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606144"> </A>	<A HREF="ProgrammingTopics.25.html#24751" CLASS="XRef">Deleting with the Adaptor Sublayer</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=612658"> </A><A HREF="ProgrammingTopics.32.html#35319" CLASS="XRef">Executing Arbitrary SQL Statements</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=613556"> </A>EOAdaptor class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=613561"> </A>EOAdaptorContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=613566"> </A>EOAdaptorChannel class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606145"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606146"> </A>	How do I insert a row using the adaptor sublayer?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606147"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606148"> </A>Insert</LI><LI CLASS="Bulleted"><A NAME="pgfId=613583"> </A>Adaptor</LI><LI CLASS="Bulleted"><A NAME="pgfId=613588"> </A>Performance</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606149"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606150"> </A>22 July, 1998. Seejo Pylappan. First Draft.</P><P CLASS="Body"><A NAME="pgfId=618677"> </A>13 November, 1998. Clif Liu. Second Draft.</P><P CLASS="Body"><A NAME="pgfId=618678"> </A>16 March, 1999. Clif Liu. Third Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.23.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.25.html"><img src="next.gif" border="0" alt="Next"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>