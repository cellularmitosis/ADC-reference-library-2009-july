<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>OTPAPSampleServer - /PAPServerSample.h</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; <A HREF="javascript:location.replace('index.html');">OTPAPSampleServer</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/idxPrinting-date.html" target="_blank">Networking > Printing</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">OTPAPSampleServer</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/PAPServerSample.h</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/ATalkSampleUtils.c</option>
<option value="listing2.html">/ATalkSampleUtils.h</option>
<option value="listing3.html">/EnableEOMSample.c</option>
<option value="listing4.html">/EnableSelfSendSample.c</option>
<option value="listing5.html">/OTDebug.h</option>
<option value="listing6.html">/PAPPostScriptStuff.c</option>
<option value="listing7.html">/PAPPostScriptStuff.h</option>
<option value="listing8.html">/PAPServerSample.c</option>
<option value="listing9.html">/PAPServerSample.h</option>
<option value="listing10.html">/PAPServerUtilities.c</option>
<option value="listing11.html">/PAPServerUtilities.h</option>
<option value="listing12.html">/SetServerStatusOption.c</option>
<option value="listing13.html">/StringUtils.c</option>
<option value="listing14.html">/StringUtils.h</option></select>
				</p>
				</form>
				<p><strong><a href="OTPAPSampleServer.zip">Download Sample</a></strong> (&#147;OTPAPSampleServer.zip&#148;, 87.7K)<BR>
<strong><a href="OTPAPSampleServer.dmg">Download Sample</a></strong> (&#147;OTPAPSampleServer.dmg&#148;, 163.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    PAPServerSample.h  Contains:  headers, defines for the PAPServerSample.c file  Written by:  Rich Kubota  Copyright:  &copy; 1993-1996 by Apple Computer, Inc., all rights reserved.  Change History (most recent first):  To Do:*/#ifndef __PAPSERVERSAMPLE__#define __PAPSERVERSAMPLE__#ifndef __CONDITIONALMACROS__#include &lt;ConditionalMacros.h&gt;#endif#ifdef __cplusplusextern &quot;C&quot; {#endif#if PRAGMA_ALIGN_SUPPORTED#pragma options align=mac68k#endif#if PRAGMA_IMPORT_SUPPORTED#pragma import on#endif#include &lt;stdio.h&gt;#include &lt;Types.h&gt;#include &lt;Memory.h&gt;#include &lt;Resources.h&gt;#include &lt;Events.h&gt;#include &quot;OpenTransport.h&quot;    // open transport files  #include &quot;OpenTptAppleTalk.h&quot;  //#define SHOW_DEBUG_FLOW    1  // enable display of DebugStr showing program flow#if SHOW_DEBUG_FLOW#define  DO_DEBUG_LOG    0  // enable a debug log at the beginning#endif// defines for the STR# resource#define kServerStrID  1000  // STR# resource ID for the PAP Server Sample strings#define kOTVersion111  0x01118000#define kOTVersion120  0x01208000enum {  kServerNBPStrID  = 1,  kIdleStrID,  kBusyStrID,  kForceClose = 'clos'};#define kZeroQLen    0#define kDynamicSocket  0#define kATPType    3#define TIMEOUT      25     // seconds#define kMaxHandoffEPs  1    // maximum number of handoff endpoints supported by this sample#define kDITop      0x0050    /* kTopLeft - for positioning the Disk                         Initialization dialogs. */#define kDILeft      0x0070#define kNumBuffers    25    // initial number of packet buffers to allocate#define kUserByteSize  4#define  kPAPDataSize  32768  // if we can, collect 16K of data at a time    // defines for gFlags bits#define OTActiveFlag    0#define  dumpAllPktsFlag    1#define BufsInitdFlag    4#define InBackGndFlag    5#define BuffsHeldFlag    6#define CheckOptFlag    7#define StatusBusyFlag    8#define StatusIdleFlag    9// flags macros for setting, testing and clearing the gFlag bits#define SetOTActiveFlag(flags)    ((flags) |= 1 &lt;&lt; OTActiveFlag)#define ClrOTActiveFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; OTActiveFlag)))#define TstOTActiveFlag(flags)    (((flags) &amp; (1 &lt;&lt; OTActiveFlag)) != 0)#define SetdumpAllPktsFlag(flags)  ((flags) |= 1 &lt;&lt; dumpAllPktsFlag)#define ClrdumpAllPktsFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; dumpAllPktsFlag)))#define TstdumpAllPktsFlag(flags)  (((flags) &amp; (1 &lt;&lt; dumpAllPktsFlag)) != 0)#define SetBufsInitdFlag(flags)    ((flags) |= 1 &lt;&lt; BufsInitdFlag)#define ClrBufsInitdFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; BufsInitdFlag)))#define TstBufsInitdFlag(flags)    (((flags) &amp; (1 &lt;&lt; BufsInitdFlag)) != 0)#define SetInBackGndFlag(flags)    ((flags) |= 1 &lt;&lt; InBackGndFlag)#define ClrInBackGndFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; InBackGndFlag)))#define TstInBackGndFlag(flags)    (((flags) &amp; (1 &lt;&lt; InBackGndFlag)) != 0)#define SetBuffsHeldFlag(flags)    ((flags) |= 1 &lt;&lt; BuffsHeldFlag)#define ClrBuffsHeldFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; BuffsHeldFlag)))#define TstBuffsHeldFlag(flags)    (((flags) &amp; (1 &lt;&lt; BuffsHeldFlag)) != 0)#define SetCheckOptFlag(flags)    ((flags) |= 1 &lt;&lt; CheckOptFlag)#define ClrCheckOptFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; CheckOptFlag)))#define TstCheckOptFlag(flags)    (((flags) &amp; (1 &lt;&lt; CheckOptFlag)) != 0)#define SetStatusBusyFlag(flags)  ((flags) |= 1 &lt;&lt; StatusBusyFlag)#define ClrStatusBusyFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; StatusBusyFlag)))#define TstStatusBusyFlag(flags)  (((flags) &amp; (1 &lt;&lt; StatusBusyFlag)) != 0)#define SetStatusIdleFlag(flags)  ((flags) |= 1 &lt;&lt; StatusIdleFlag)#define ClrStatusIdleFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; StatusIdleFlag)))#define TstStatusIdleFlag(flags)  (((flags) &amp; (1 &lt;&lt; StatusIdleFlag)) != 0)// defines for the semaphore bits#define kInListenLoop    0    // this bit used with OTAtomicSetBit to control re-entrancy into the DoListenAccept procedure#define kInRcvDataFlag    1    // used with OTAtomic calls to check whether in DoReceive call// defines for flags bits#define EPActiveFlag    0    // indicates that the endpoint is active#define EPBoundFlag      1    // indicates the endpoint is bound#define EPBusyFlag      2    // used with handoff endpoint to indicate it has accepted                   // a handoff endpoint#define PassconFlag      3    // the passive connection has completed#define ListenPendFlag    4#define AcceptPendFlag    5#define UnbindPendFlag    7    // indicates that the endpoint is pending an unbind request to                  // to complete#define DisconPendFlag    8    // indicates that a disconnect request is pending#define ForceCloseFlag    9    // indicates that we want to force the CloseProvider and and re-open                  // the endpoint#define OpenPendFlag    10    // indicates that we are awaiting a OpenComplete event#define EOMOnFlag      11    // EOM option enabled#define  TempFileFlag    12    // indicates that a temp file has been opened for data to this endpoint#define InPSQueryFlag    13    // indicates that the endpoint is currently processing a PS query#define HasDataFlag      14    // indicates that there is more to read for this endpoint#define FirstPktFlag    15    // indicates that we are looking for the first packet to set time in value#define DumpPktsFlag    16    // indicates that for this endpoint we will dump all packets// flags macros for setting, testing and clearing the flag bits#define SetEPActiveFlag(flags)    ((flags) |= 1 &lt;&lt; EPActiveFlag)#define ClrEPActiveFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; EPActiveFlag)))#define TstEPActiveFlag(flags)    (((flags) &amp; (1 &lt;&lt; EPActiveFlag)) != 0)#define SetEPBoundFlag(flags)    ((flags) |= 1 &lt;&lt; EPBoundFlag)#define ClrEPBoundFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; EPBoundFlag)))#define TstEPBoundFlag(flags)    (((flags) &amp; (1 &lt;&lt; EPBoundFlag)) != 0)#define SetEPBusyFlag(flags)    ((flags) |= 1 &lt;&lt; EPBusyFlag)#define ClrEPBusyFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; EPBusyFlag)))#define TstEPBusyFlag(flags)    (((flags) &amp; (1 &lt;&lt; EPBusyFlag)) != 0)#define SetPassconFlag(flags)    ((flags) |= 1 &lt;&lt; PassconFlag)#define ClrPassconFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; PassconFlag)))#define TstPassconFlag(flags)    (((flags) &amp; (1 &lt;&lt; PassconFlag)) != 0)#define SetListenPendFlag(flags)  ((flags) |= 1 &lt;&lt; ListenPendFlag)#define ClrListenPendFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; ListenPendFlag)))#define TstListenPendFlag(flags)  (((flags) &amp; (1 &lt;&lt; ListenPendFlag)) != 0)#define SetAcceptPendFlag(flags)  ((flags) |= 1 &lt;&lt; AcceptPendFlag)#define ClrAcceptPendFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; AcceptPendFlag)))#define TstAcceptPendFlag(flags)  (((flags) &amp; (1 &lt;&lt; AcceptPendFlag)) != 0)#define SetUnbindPendFlag(flags)  ((flags) |= 1 &lt;&lt; UnbindPendFlag)#define ClrUnbindPendFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; UnbindPendFlag)))#define TstUnbindPendFlag(flags)  (((flags) &amp; (1 &lt;&lt; UnbindPendFlag)) != 0)#define SetDisconPendFlag(flags)  ((flags) |= 1 &lt;&lt; DisconPendFlag)#define ClrDisconPendFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; DisconPendFlag)))#define TstDisconPendFlag(flags)  (((flags) &amp; (1 &lt;&lt; DisconPendFlag)) != 0)#define SetForceCloseFlag(flags)  ((flags) |= 1 &lt;&lt; ForceCloseFlag)#define ClrForceCloseFlag(flags)  ((flags) &amp;= (-1 ^ (1 &lt;&lt; ForceCloseFlag)))#define TstForceCloseFlag(flags)  (((flags) &amp; (1 &lt;&lt; ForceCloseFlag)) != 0)#define SetOpenPendFlag(flags)    ((flags) |= 1 &lt;&lt; OpenPendFlag)#define ClrOpenPendFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; OpenPendFlag)))#define TstOpenPendFlag(flags)    (((flags) &amp; (1 &lt;&lt; OpenPendFlag)) != 0)#define SetEOMOnFlag(flags)      ((flags) |= 1 &lt;&lt; EOMOnFlag)#define ClrEOMOnFlag(flags)      ((flags) &amp;= (-1 ^ (1 &lt;&lt; EOMOnFlag)))#define TstEOMOnFlag(flags)      (((flags) &amp; (1 &lt;&lt; EOMOnFlag)) != 0)#define SetTempFileFlag(flags)    ((flags) |= 1 &lt;&lt; TempFileFlag)#define ClrTempFileFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; TempFileFlag)))#define TstTempFileFlag(flags)    (((flags) &amp; (1 &lt;&lt; TempFileFlag)) != 0)#define SetInPSQueryFlag(flags)    ((flags) |= 1 &lt;&lt; InPSQueryFlag)#define ClrInPSQueryFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; InPSQueryFlag)))#define TstInPSQueryFlag(flags)    (((flags) &amp; (1 &lt;&lt; InPSQueryFlag)) != 0)#define SetHasDataFlag(flags)    ((flags) |= 1 &lt;&lt; HasDataFlag)#define ClrHasDataFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; HasDataFlag)))#define TstHasDataFlag(flags)    (((flags) &amp; (1 &lt;&lt; HasDataFlag)) != 0)#define SetFirstPktFlag(flags)    ((flags) |= 1 &lt;&lt; FirstPktFlag)#define ClrFirstPktFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; FirstPktFlag)))#define TstFirstPktFlag(flags)    (((flags) &amp; (1 &lt;&lt; FirstPktFlag)) != 0)#define SetDumpPktsFlag(flags)    ((flags) |= 1 &lt;&lt; DumpPktsFlag)#define ClrDumpPktsFlag(flags)    ((flags) &amp;= (-1 ^ (1 &lt;&lt; DumpPktsFlag)))#define TstDumpPktsFlag(flags)    (((flags) &amp; (1 &lt;&lt; DumpPktsFlag)) != 0)enum {  kLookingForEndStr = 1,  kLookingForQueryStr,  kLookingForDefaultResponse,  kLookingForEOFStr};enum {  kSetBusyStr = 1,  kSetIdleStr,  kAcceptOption,  kDeclineOption,  kQuitTest};  /********************************************************************************* Structures********************************************************************************/typedef struct MyEndpointRef MyEndpointRef;typedef struct {    OTLink    fLink;            // first field standard for OTLink list    OTFlags    flags;    MyEndpointRef *theEp;          // save the endpoint ref associated with the endpoint    UInt32    lastPos;          // last scanned position in the buffer    UInt32    numBytes;          // numBytes in this packet    OTTimeStamp  timeStamp;          // timestamp of this packet    UInt8    data[kPAPDataSize];      // data bytes of packet} PacketBuffer;typedef PacketBuffer *PacketPtr;struct MyEndpointRef{  EndpointRef    ep;  UInt32      flags;  OTLIFO      *usedQ;          // ptr to incoming packet queue for this connection  PacketPtr    prevPtr;        // used while processing a postscript                      // query where we have to save the previous packet                      // in order to complete processing of queries.  OTTimeStamp    timeDataIn;        // timestamp of first incoming packet  OTTimeStamp   timeDataEnd;      // timestamp of last incoming packet  OTTimeStamp    timerDog;        // timestamp of most recent packet  UInt32      numBytesIn;        // number of bytes received for a connection  UInt16      psState;        // state while processing a postscript query  short      fRefNum;        // file ref num of temp file associated                      //  with this endpoint  UInt8      semaphore;  UInt8      dummy;};// Prototypesextern void DoValueBreak(long value, const char* message);#if PRAGMA_IMPORT_SUPPORTED#pragma import off#endif#if PRAGMA_ALIGN_SUPPORTED#pragma options align=reset#endif#ifdef __cplusplus}#endif#endif /* __PAPSERVERSAMPLE__ */</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/OTPAPSampleServer/listing9.html%3Fid%3DDTS10000252-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/OTPAPSampleServer/listing9.html%3Fid%3DDTS10000252-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/OTPAPSampleServer/listing9.html%3Fid%3DDTS10000252-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>