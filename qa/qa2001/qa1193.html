<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1193: QuickDraw Text Anti-Aliasing using Quartz 2D</title><meta name="keywords" content="QuickDraw Text Quartz CG Core Graphics anti-alias SwapQDTextFlagsQDSwapTextFlags QDSwapPortTextFlags"><meta name="Description" content="Technical Q&amp;A QA1193: This Q&amp;A describes new APIs added toMac OS X to allow applications to draw QD text using CG anti-aliasing."><meta name="categories" content="Core Graphics and QuickDraw"><meta name="week-posted" content="Oct 28, 2002 - Nov 1, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001721" title="QuickDraw Text Anti-Aliasing using Quartz 2D"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalqas/Carbon/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1193</div>
<div id="pageheadsub">QuickDraw Text Anti-Aliasing using Quartz 2D</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      How do I turn on Quartz 2D anti-aliasing of QuickDraw text      for my application?</p>                  <P id=p4>A:      Starting in Mac OS X 10.1.5, Apple added a feature that allows      developers to draw QuickDraw text using the anti-aliasing      from Core Graphics (Quartz 2D).  This feature was added to      help developers that cannot migrate completely to UniCode      imaging through <CODE>DrawThemeTextBox</CODE> or ATSUI but still want      to provide a consistent look in their applications.</p><P id=p4>      In 10.1.5, only the API name of <CODE>SwapQDTextFlags</CODE> is available      and it is not exported via CFM so CFM applications will need      to use <CODE>CFBundleGetFunctionPointerForName</CODE> from the Core Foundation      framework to look up the <CODE>SwapQDTextFlags</CODE> symbol in the Application      Services framework.  See the CallMachOFramework sample in      the CarbonLib SDK for more information on how to look up      and call Mach-O symbols from a CFM application.</p><P id=p4>      Starting in Mac OS X 10.2 (Jaguar), a new API name, <CODE>QDSwapTextFlags</CODE>,      is supported that functions identically to SwapQDTextFlags.       In addition, Jaguar supports a new port-based API named      <CODE>QDSwapPortTextFlags</CODE> to allow developers to control the setting      on a port-by-port basis.</p>      <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre><P id=p4>      Function:</p><P id=p4>          // In 10.1.5 and later          SwapQDTextFlags - Returns current flags and optionally sets new flags.</p><P id=p4>          UInt32 SwapQDTextFlags(UInt32 newFlags);</p><P id=p4>          // In 10.2 and later          QDSwapTextFlags - Returns current flags and optionally sets new flags.</p><P id=p4>          UInt32 QDSwapTextFlags(UInt32 newFlags);</p><P id=p4>      Parameter:</p><P id=p4>    UInt32 newFlags;</p><P id=p4>      Supported Flags:</p><P id=p4>          // Sets whatever is specified in system defaults.          // Currently sets kQDUseTrueTypeScalerGlyphs if nothing is specified.          kQDUseDefaultTextRendering    = 0</p><P id=p4>          // bit 0          kQDUseTrueTypeScalerGlyphs    = (1 &lt;&lt; 0)</p><P id=p4>          // bit 1          kQDUseCGTextRendering    = (1 &lt;&lt; 1)</p><P id=p4>          // bit 2          // As of Mac OS X 10.2, kQDUseCGTextMetrics implies kQDUseCGTextRendering          kQDUseCGTextMetrics        = (1 &lt;&lt; 2)</p><P id=p4>          kQDSupportedFlags        = kQDUseTrueTypeScalerGlyphs                      | kQDUseCGTextRendering                      | kQDUseCGTextMetrics</p><P id=p4>          // to request the current state, without changing anything          kQDDontChangeFlags        = 0xFFFFFFFF</p><P id=p4>      Suggested Usage:</p><P id=p4>          UInt32 savedFlags = SwapQDTextFlags(newFlags);</p><P id=p4>          // ... draw text under the conditions of &quot;newFlags&quot;...</p><P id=p4>          // restore previous setting          (void)SwapQDTextFlags(savedFlags);</p><P id=p4>      Port-based API:</p><P id=p4>          // In 10.2 and later          QDSwapPortTextFlags - Returns current flags and optionally sets new flags for the given port.</p><P id=p4>          UInt32 QDSwapPortTextFlags(CGrafPtr port, UInt32 newFlags);</p><P id=p4>      Parameters:</p><P id=p4>          CGrafPtr port;        // Settings per port override any global settings                // If port == NULL then the current port is used</p><P id=p4>          UInt32 newFlags;        // As per SwapQDTextFlags and QDSwapTextFlags above</p></pre></TD></TR></TABLE></CENTER><BR><BR><P id=p4>      Discussion:</p><P id=p4>      Use <code>SwapQDTextFlags(kQDUseCGTextRendering)</code> without <code>kQDUseCGTextMetrics</code>      only if compatibility with existing documents is required      (to avoid reflow). The old QuickdrawText metrics are derived      from the instructed (grid-fitted) outlines, and are sometimes      too different from the ideal (unhinted) metrics corresponding      to the ideal outlines used by CG text rendering.</p><P id=p4>      The <code>SwapQDTextFlags</code> function itself does not have any measurable      performance impact; the flags can be changed at any time.      The setting is per application (like <code>SetFractEnable()</code>, <code>SetOutlinePreferred()</code>      etc.), not per <code>GrafPort</code>.  Use <code>QDSwapPortTextFlags</code> for a per-port      setting.</p><P id=p4>      Limitations:</p><P id=p4>      <code>SrcOr</code> is the only supported text transfer mode. In all other      cases, we fall back to the old QuickdrawText rendering.       Developers who need special transfer mode effects need to      draw the text into an offscreen and use <code>CopyBits</code> (which is      basically what QuickDrawText does, too, for the other transfer      modes).</p><P id=p4>      Similarly, only bold and italic are supported as algorithmic      styles (when there is no intrinsic font for the type face).      Outline and shadow are not supported.</p><P id=p4>      Underlines always are continuous lines, whereas QuickdrawText      spares out descenders.</p><P id=p4>      Avoid double-drawing the same text because anti-aliased areas      darken with repeated over-drawing.</p><P id=p4>      As with Cocoa text, fonts with very fine lines are drawn      so light that readability may be a problem.</p><P id=p4>      Certain glyphs in certain fonts exceed the      ascent and/or descent values of the vertical metrics in QD's      FontInfo.  By default (unless <code>SetPreserveGlyph(true)</code> is called),      QuickDrawText forces them to fit between ascent and descent,      such that text editing code that assumes that all text is      drawn within that range doesn't leave dirty pixels around      or clip off the accents. CG text rendering has no support for      &quot;squishing&quot; these glyphs.  In particular, this      may affect certain localizations where diacriticals on uppercase      characters are used, &quot;undercommas&quot;, etc.  The workaround      is to avoid fonts that have the design flaw of &quot;lying&quot;      about their metrics.  These are mainly TrueType fonts for      which legacy bitmap fonts existed with the same font name.      The TrueType outlines were designed under the constraints      to match the existing bitmap fonts as much as possible and      also to preserve the vertical metrics, which created the      conflicts with certain additional glyphs.</p><P id=p4>      In Mac OS X 10.1.5, these flags only support anti-aliasing      for text in fonts larger that 10 points regardless of the      anti-aliasing setting in the General System Preferences panel.  In Mac OS X 10.2,      the System Preferences setting is respected.</p>          <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Oct 29 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1193.html%3Fid%3DDTS10001721-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1193.html%3Fid%3DDTS10001721-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1193.html%3Fid%3DDTS10001721-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>