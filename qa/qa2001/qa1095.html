<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1095: Intercepting QuickTime Wired Actions</title><meta name="keywords" content="wired actions, movie controller action filter function,mcActionExecuteOneActionForQTEvent,kActionApplicationNumberAndString"><meta name="Description" content="Technical Q&amp;A QA1095: This Q&amp;A demonstrates how to interceptwired actions in a movie controller action filter function."><meta name="categories" content="QuickTime Movie Toolbox"><meta name="week-posted" content="Nov 12, 2001 - Nov 16, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001644" title="Intercepting QuickTime Wired Actions"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxWiredMoviesandSprites-date.html">Wired Movies and Sprites</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1095</div>
<div id="pageheadsub">Intercepting QuickTime Wired Actions</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      I'm using the kActionApplicationNumberAndString wired action      in my QuickTime movie to send a number and a string to my      running application. How can my application intercept this      action and retrieve the number and string data?</p>                  <P id=p4>A:      You'll need to first use a movie controller action filter      function to intercept the mcActionExecuteOneActionForQTEvent      action. You associate a movie controller action filter function      with a given movie controller by calling the MCSetActionFilterWithRefCon      functions as shown in Listing 1.</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>MCActionFilterWithRefConUPP myFilterProcUPP;myFilterProcUPP = NewMCActionFilterWithRefConProc(myFilterProcedure);MCSetActionFilterWithRefCon(movieController,                            myFilterProcUPP,                            0);</pre></TD></TR><TR><td align="left"><P><B>Listing 1</B>. Calling the MCSetActionFilterWithRefCon      functions.</P></TD></TR></TABLE></CENTER><BR><BR><P id=p4>      The filter function allows your application to filter individual      actions which are about to be executed in response to a QuickTime      event. The events are first sent to your filter function      before the actions are executed. Return true from your filter      function if you do not want the action to be executed, return      false if you do want the action executed.</p><P id=p4>      Once you've setup a custom action filter function, you will      need to add code to your filter function to check for the      mcActionExecuteOneActionForQTEvent action. Next, when you      receive the mcActionExecuteOneActionForQTEvent action in      your filter function you can examine the atoms associated      with this action to see if the kActionApplicationNumberAndString      action is about to be executed.</p><P id=p4>      The parameter passed with the mcActionExecuteOneActionForQTEvent      action is a ResolvedQTEventSpecPtr (see Movies.h). The type      of action may be determined by parsing the atoms contained      in the actionAtom field of this structure (refer to the Wired      Movies API reference for more information on the various      atoms contained here: &lt;http://developer.apple.com/documentation/quicktime/qtdevdocs/RM/rmWiredRef.htm&gt;).</p><P id=p4>      The code snippet in listing 2 below shows how to access the parameters of the kActionApplicationNumberAndString action from a movie      controller action filter function.</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre> QTAtom findChildAtomOfType(QTAtomContainer container,                            QTAtom parentAtom,                            QTAtomType typeToFind,                            QTAtomID *foundID){    QTAtom currentChild=NULL, nextChild=NULL;    do    {        QTAtomType    atomType;        QTAtomID      id;        QTNextChildAnyType (container,                           parentAtom,                           currentChild,                           &amp;nextChild);        if (nextChild != 0)        {            QTGetAtomTypeAndID(container,                               nextChild,                               &amp;atomType,                               &amp;id);             if (atomType == typeToFind)             {                 *foundID = id;                 break;             }        }        currentChild=nextChild;    } while (nextChild != NULL);    return nextChild;}pascal Boolean myFilterProcedure (         MovieController theMC,         short theAction,         void *theParams,         long theRefCon){    Boolean isHandled = false;    switch (theAction) {        case mcActionExecuteOneActionForQTEvent:        {            short                   action;            ResolvedQTEventSpecPtr  qtEventSpecPtr;            QTAtomSpec              *thekActionAtom;            QTAtom                  atomPtr;            long                    dataSize, theAction;            Ptr                     atomData = NULL;            qtEventSpecPtr = (ResolvedQTEventSpecPtr)theParams;                /* get the action atom */            thekActionAtom = &amp;qtEventSpecPtr-&gt;actionAtom;            if (thekActionAtom != NULL)            {                /* the first child of the action atom is the action                   type atom (kWhichAction), so let's get it... */                QTNextChildAnyType(thekActionAtom-&gt;container,                                     thekActionAtom-&gt;atom,                                     0,                                     &amp;atomPtr);                if (atomPtr != NULL)                {                    /* lock the atom container before accessing a leaf                        atom's data */                    QTLockContainer(thekActionAtom-&gt;container);                    /* now get the actual data for this action atom */                    QTGetAtomDataPtr(thekActionAtom-&gt;container,                                     atomPtr,                                     &amp;dataSize,                                     &amp;atomData);                    if (atomData != NULL)                    {                        BlockMove(atomData, &amp;theAction, 4);                        if (theAction == kActionApplicationNumberAndString)                        {                            /* got the ActionApplicationNumberAndString                               action! */                            QTAtom    actionParamAtom1,actionParamAtom2;                            QTAtomID  id;                            long      param1;                            /* now let's get the parameter atoms */                            actionParamAtom1 = findChildAtomOfType(                                    thekActionAtom-&gt;container,                                    thekActionAtom-&gt;atom,                                    kActionParameter,                                    &amp;id);                            if (actionParamAtom1)                            {                                /* got the first parameter: &quot;long aNumber&quot; */                                /* now get the actual data for this parameter */                                QTGetAtomDataPtr(thekActionAtom-&gt;container,                                                 actionParamAtom1,                                                 &amp;dataSize,                                                 &amp;atomData);                                if (atomData != NULL)                                {                                    param1 = (long)*atomData;                                }                                /* now get the second parameter:                                   &quot;Str255 aString&quot; */                                actionParamAtom2 = QTFindChildByID(                                        thekActionAtom-&gt;container,                                        thekActionAtom-&gt;atom,                                        kActionParameter,                                        id+1, /* we want the next                                                 parameter atom */                                        0);   /* don't care */                                if (actionParamAtom2)                                {                                    /* now get the actual data for                                       this parameter */                                    QTGetAtomDataPtr(thekActionAtom-&gt;container,                                                     actionParamAtom2,                                                     &amp;dataSize,                                                     &amp;atomData);                                    /* atomData contains the string data... */                                }                              }                            isHandled = true;                        }                    }                    /* done accessing leaf atom's data */                    QTUnlockContainer(thekActionAtom-&gt;container);                }            }        }        break;        default:            break;    }    // switch (theAction)    return(isHandled);}</pre></TD></TR><TR><td align="left"><P><B>Listing 2</B>.       Intercepting wired actions in a filter function</P></TD></TR></TABLE></CENTER><BR><BR>          <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Nov 14 2001]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1095.html%3Fid%3DDTS10001644-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1095.html%3Fid%3DDTS10001644-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1095.html%3Fid%3DDTS10001644-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>