<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Prefetching</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.8.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.a.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="24021"> </A>Prefetching</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to fetch all related objects at once.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=606104"> </A>When the Enterprise Objects Framework (EOF) fetches an enterprise object, it creates EOFault objects for the enterprise object's relationships. Each time you access one of these EOFaults, EOF fetches the data from the database. This procedure works well and minimizes the amount of unneeded data fetching from the database. However, each time an EOFault is accessed, a separate database query is performed. Using a technique called &quot;batch faulting&quot; can reduce the number of database queries. If you know that you will be faulting all instances of a particular relationship, you can use a technique called &quot;prefetching&quot; to skip the EOFault creating stage and produce a single database query to load all related objects.</P><P CLASS="Body"><A NAME="pgfId=606106"> </A>By using EOFetchSpecification's <TT CLASS="Code">setPrefetchingRelationshipKeyPaths</TT> to specify the key paths of relationships, the Enterprise Objects Framework uses the qualifier of the fetch specification along with the related attributes to perform a joined query against the related objects' table, thereby causing all the appropriate objects to be loaded from the database at once.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606107"> </A>An Example</H3><P CLASS="Body"><A NAME="pgfId=606108"> </A>A Movie has a to-one relationship to a Studio. Suppose that you have a WOComponent that lets you query movies and display all the movies with their studios. Without using prefetching, every time the component displays a group of Movies, EOF makes a separate query to the database to get each Studio. You can use prefetching to ensure that every time the movies are fetched, all the appropriate studios are also fetched, significantly reducing the number of database queries.</P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606110"> </A>How to Use Prefetching</H3><P CLASS="Body"><A NAME="pgfId=606111"> </A>Following are two different ways to enable prefetching:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606112"> </A>Use EOModeler's Prefetching tab to specify relationship key paths for a particular fetch specification.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606113"> </A>Send <TT CLASS="Code">setPrefetchingRelationshipKeyPaths</TT> to the fetch-specification object. This method takes an array of strings designating relationship key paths. </LI></UL></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606115"> </A>When to Use Prefetching</H3><P CLASS="Body"><A NAME="pgfId=606116"> </A>You can use prefetching when you know that a particular relationship will always be accessed. It is more instructive, however, to know when <EM CLASS="Emphasis">not</EM> to use prefetching:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606118"> </A>Don't use prefetching when memory usage is more important then database performance. </LI></UL><P CLASS="BulletedCont"><A NAME="pgfId=612495"> </A>By prefetching, you may fetch in more objects than you need, and thus waste memory.</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606119"> </A>Don't use prefetching when you have fetch limits on a fetch. </LI></UL><P CLASS="BulletedCont"><A NAME="pgfId=612496"> </A>Because prefetching uses the qualifier of the original fetch, it fetches all the related objects, regardless of any limit placed on the original fetch. If you issue a fetch that returns 10,000 records, but use fetch limit to only get 100 of them, the prefetching hint will cause all 10,000 relationships to be fetched.</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606120"> </A>Don't use prefetching when performing multiple queries that return the same records. </LI></UL><P CLASS="BulletedCont"><A NAME="pgfId=612497"> </A>Using the movie-query screen example described earlier, suppose that a user makes a query for all movies that have the letter &quot;a&quot; in their titles. This returns a large number of movies and causes several studios to be fetched. If the user does another query for all movies with the letter &quot;e&quot; in their titles, the resulting records will overlap those previously fetched and EOF will refetch several studios. In this case, batch-faulting is more appropriate; all of the movies with the letter &quot;a&quot; in their names have had their faults fired and EOF fetches only the studios for movies containing the letter &quot;e&quot; and not the letter &quot;a&quot; in their names.</P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606121"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606123"> </A><A HREF="ProgrammingTopics.8.html#35698" CLASS="XRef">Batch Faulting to Improve Performance</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=612609"> </A><A HREF="ProgrammingTopics.20.html#26713" CLASS="XRef">Setting a Fetch Limit</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606125"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606126"> </A>	How do I fetch all related objects at once?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606127"> </A>	How can I increase the performance of my fetches?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606128"> </A>	How can I minimize database access?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606129"> </A>	How can I increase response time?</LI><LI CLASS="Bulleted"><A NAME="pgfId=612562"> </A>When should I not use prefetching?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606130"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606131"> </A>Relationship</LI><LI CLASS="Bulleted"><A NAME="pgfId=616283"> </A>Key</LI><LI CLASS="Bulleted"><A NAME="pgfId=616282"> </A>Path</LI><LI CLASS="Bulleted"><A NAME="pgfId=612557"> </A>Prefetching</LI><LI CLASS="Bulleted"><A NAME="pgfId=612552"> </A>Batch</LI><LI CLASS="Bulleted"><A NAME="pgfId=616281"> </A>Fault</LI><LI CLASS="Bulleted"><A NAME="pgfId=606134"> </A>Fetching</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606135"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606136"> </A>2 July, 1998. Paul Haddad. First Draft.</P><P CLASS="Body"><A NAME="pgfId=612551"> </A>17 November, 1998. Terry Donoghue. Second Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.8.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.a.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>