<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1172: Writing Plug-ins for Desktop Printer Utility</title>        <meta name="keywords" content="LaserWriter 8 Desktop Printer Utility Plugins Printing"><meta name="categories" content="Printing"><meta name="week-posted" content="Jul 26, 1999 - Aug 6, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003011" title="Writing Plug-ins for Desktop Printer Utility"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/idxCarbon-date.html" target="_blank">Printing > Carbon</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1172</div>
<div id="pageheadsub">Writing Plug-ins for Desktop Printer Utility</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>            <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc -->         <P id = "menutext">         <A HREF = "#Section1">Limits and Assumptions</A><BR><BR>                  <A HREF = "#Section2">Plug-in Requirements</A><BR><BR>                  <A HREF = "#Section3">Interaction between DTPU and plug-ins</A><BR><BR>                  <A HREF = "#Section4">The PlugInDtpInfo structure</A><BR><BR>                  <A HREF = "#Section5">The Plug-in Interface</A><BR><BR>                  <A HREF = "#Summary">Summary</A>        <A HREF = "#References">References</A><br><br><A HREF = "#Downloads">Downloadables</A></p> <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">Apple's Desktop Printer Utility (DTPU) is an application used to create or configure various types of Desktop Printers (DTPs) supported by the LaserWriter 8 printer driver. The built-in DTP types currently provided by DTPU version 1.1 include AppleTalk (PAP) printer, LPR printer, infrared printer, Hold printer, PostScript translator, and Custom application translator.</p><P id = "introtext">Third-party plug-in support was added in DTPU version 1.2. This document describes how to write plug-ins for DTPU version 1.2 and later. A DTPU plug-in is a mechanism for programmers to write shared libraries which can be recognized by DTPU and provide means to configure different types of desktop printers that are not built into DTPU. A good use of this is to provide user interface for configuring external hoses for LaserWriter 8. See <A HREF = "tn1144.html">Technote 1144: Writing Custom Hoses for LaserWriter 8</A> for information about writing LaserWriter 8 communication hoses.</p>      <!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Aug 16 1999]</h3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><H2>Introduction</h2><P>A DTPU window has either one or two panes, depending on the type of the desktop printerit represents. The upper pane, which is common to all types of Desktop Printers,is used to select the PostScript<img src="images/tn1172_001.gif" align=top alt="" width=11 height=12> Printer Description (PPD) file for the printer. The lower pane, if one exists, is used to configure properties or characteristics specific to that DTP. Examples of this are an AppleTalk address for an AppleTalk DTP (see Figure 2) and a domain name address for an LPR DTP.</P><p align="center"><img src="images/tn1172_002.gif" alt="Figure 1" width=398 height=183 border=2 align=middle></p><p align="center"><b>Figure 1</b> - Single pane DTPU window</p><p align="center"><img src="images/tn1172_003.gif" alt="Figure 2" width=403 height=287 border=2 align=middle></p><p align="center"><b>Figure 2</b> - Double pane DTPU window for PAP DTP</p><P>Developers who need to configure desktop printers with more information than just the basic PPD file configuration may want to consider writing a DTPU plug-in. A DTPU plug-in allows developers to customize the lower pane of their DTP window to a small extent, and to display a dialog window when the lower &quot;Change&quot; button is clicked (or when the lower icon is double-clicked).</P><BR><p><A HREF = "#top">Back to top</a></p>         <A NAME="Section1"></A><H2 ALIGN=LEFT>Limits and Assumptions</H2><P>When using this plug-in mechanism, the main DTP windows are limited to two panes. The layout and design of the items in the main DTP windows are fixed. The DTPU plug-in has control over the content of the items in the lower pane, but not the positioning of those items. Once the "Change" button is clicked, a plug-in can then present a dialog window with the items necessary to properly configure that type of desktop printer. The example dialog below shows how AppleTalk printers on the network are chosen. Movable dialog windows are strongly recommended for this purpose.</P><p align="center"><img src="images/tn1172_004.gif" alt="Figure 3" width=421 height=250 border=2 align=middle></p><p align="center"><b>Figure 3</b> - Dialog Window to configure a PAP DTP.</p><BR><p><A HREF = "#top">Back to top</a></p>         <A NAME="Section2"></A><H2>Plug-in Requirements</H2><P>Please read the related document <A HREF = "tn1170.html">Technote 1170: The Printing Plug-ins Manager</A> for requirements of writing LaserWriter plug-ins. In order for shared library plug-ins to be recognized by DTPU, they have to be kept in the "Printing Plug-ins" folder within the Extension folder of the active System Folder.</p><P>The type in the <CODE>'PLGN'</CODE> resource (ID <CODE>-8192</CODE>) for a DTPU plug-in has to be <CODE>'dtpu'</CODE>. The subtype can be any four-character type starting with the character '='. If this subtype represents a custom hose, it should be registered with DTS. Please send the following information to <A HREF = "mailto:devprogram@apple.com">devprogram@apple.com</A> to register your custom hose type:</P><BR><OL><LI TYPE="1">Contact Name:<BR></li><LI TYPE="1">Company Name:<BR></li><LI TYPE="1">Mailing Address:<BR></li><LI TYPE="1">Phone Number:<BR></li><LI TYPE="1">Email Address:<BR></li><LI TYPE="1">Make and Model of device:<BR></li><LI TYPE="1">Description of communications method:<BR></li><LI TYPE="1">4-byte type (in the form '=XXX'):<BR></li></OL>Example: type:  'dtpu'<BR>  subtype: '=AS '<BR><BR>Developers attempting to write a DTPU plug-in will need the following files:<BR><UL><LI TYPE="disc">Desktop Printer Utility Version 1.2 or later<BR></li><LI TYPE="disc">PrintingLib Version 8.6.5 or later<BR></li><LI TYPE="disc">DtpuPlugIn.h (which is included with the Sample Code accompanying this Technote)<BR></li></UL><BR><p><A HREF = "#top">Back to top</a></p>         <A NAME="Section3"></A>         <H2>Interaction between DTPU and plug-ins</H2><P>When the &quot;New&quot; menu item is selected in DTPU, the following dialog window is displayed for users to select the type of DTP to create:</P><p align="center"><img src="images/tn1172_005.gif" alt="Figure 4" width=371 height=274 border=2 align=middle></p><p align="center"><b>Figure 4</b> - DTP type selection dialog</p><P>If DTPU recognizes a plug-in in the &quot;Printing Plug-ins&quot; folder, it adds the plug-in's type (item 1 in Figure 4) to the selection list and provides some explanation (item 2 in Figure 4) in the space below the list when the plug-in type is selected. DTPU asks each plug-in for this informational string.</P><P>Once a plug-in DTP type is chosen, DTPU displays a DTP window similar to the one in Figure 5. The content of items 1-4 are controlled by the plug-ins. Again, DTPU obtains the text strings from plug-ins and displays them on behalf of the plug-ins. Item 2 is a 32 pixel x 32 pixel icon. Plug-ins can also provide an icon drawing routine which will be called by DTPU whenever it needs to draw the icon. More information about how a plug-in can control these items is provided in the <A HREF = "#Section4">PlugInDtpInfo Structure</A> and <A HREF = "#DTPWindow">DTP Window Display</A> sections.</P><p align="center"><img src="images/tn1172_006.gif" alt="Figure 5" width=425 height=286 border=2 align=middle></p><p align="center"><b>Figure 5</b> - Example of a plug-in DTP window</p><P>When the lower change button (item 5 in Figure 5) is clicked, DTPU calls the plug-in to display a configuration dialog window. The window displayed by the included sample code is shown in Figure 6. This window is entirely owned by the plug-in. A plug-in can put any number of items of any type in this window and position the items wherever appropriate. User interaction directed to this dialog window should be handled by the plug-in. DTPU provides a callback routine to handle events that are not related to this dialog window. Plug-ins should use movable modal dialog windows for this purpose whenever possible. More information about how to control this window is given in the <A HREF = "#ConfigDialog">Configuration Dialog Window</A> section.</P><p align="center"><img src="images/tn1172_007.gif" alt="Figure 6" width=404 height=158 border=2 align=middle></p><p align="center"><b>Figure 6</b> - Movable modal dialog controlled by plug-ins</p><BR><p><A HREF = "#top">Back to top</a></p><A NAME="Section4"></A><h2>The PlugInDtpInfo Structure</h2>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>struct PlugInDtpInfo{ OSType dtpID;  // four character type ID unique to     // your DTP type Str255 dtpType;  // appear in DTP type selection list Str255 dtpHelp;  // explanation of DTP usage Str255 dtpConfigTitle; // explanation of DTP configuration Boolean pluginSpecified; // plug-in data is well specified      // and valid Boolean canAutoSetup; // this DTP has enough info to      // do PPD auto setup Boolean autoSetupPossible; // can possibly do PPD       // auto setup DtpuPlugInDrawIconProc  drawIconProc; //optional DtpuPlugInClipboardOkProc  clipboardOkProc; DtpuPlugInPasteClipboardProc pasteClipboardProc; DtpuPlugInPlaceInClipboardProc placeInClipboardProc; DtpuPlugInAddDragDataProc  addDragDataProc; DtpuPlugInDragAcceptableProc dragAcceptableProc; DtpuPlugInReceiveDragItemProc receiveDragItemProc; DtpuPlugInAddTagsProc  addTagsProc; //optional DtpuPlugInSavePrefsProc   savePrefsProc; //optional DtpuPlugInSuggestDocNameProc  suggestDocNameProc; //optional DtpuPlugInConfigureProc   configureProc; DtpuPlugInGetIconTitleProc  getIconTitleProc; DtpuPlugInGetUsageTextProc  getUsageTextProc; DtpuPlugInCloseProc    closeProc; void *refcon;  // your private pointer that will     // be passed back each time };typedef struct PlugInDtpInfo PlugInDtpInfo;typedef PlugInDtpInfo *PlugInDtpInfoPtr;typedef PlugInDtpInfo **PlugInDtpInfoHdl;</pre></TD></TR></TABLE></CENTER><BR><BR><P><CODE>PlugInDtpInfo</CODE> is used by DTPU to retrieve information from plug-ins. The fields in this data structure are:</P><UL>    <LI><CODE>dtpID</CODE> - should be the same four-character ID used for subtype in <CODE>'PLGN'</CODE> resource (ID <CODE>-8192</CODE>)</li>    <LI><CODE>dtpType</CODE> - will be displayed as item 1 in Figure 4 (DTP type selection dialog)</li>    <LI><CODE>dtpHelp</CODE> - will be displayed as item 2 in Figure 4 (DTP type selection dialog)</li>    <LI><CODE>dtpConfigTitle</CODE> - will be displayed as item 1 in Figure 5 (plug-in DTP window)</li>    <LI><CODE>pluginSpecified</CODE> - should be TRUE if the default plug-in settings for a newly created "Untitled" DTP are complete and can fully satisfy the print-time needs, FALSE otherwise. If this field contains FALSE and a user tries to save the DTP, the alert box shown in Figure 7 will be presented.</li></UL><p ALIGN=center><img src="images/tn1172_008.gif" alt="Figure 7" width=401 height=118 border=2 align=middle></p><p ALIGN=center><b>Figure 7</b> - Unspecified Printer warning</p><P>Plug-ins should set the <CODE>pluginSpecified</CODE> field to FALSE if this alert is wanted before saving a DTP. By setting <CODE>pluginSpecified</CODE> to TRUE for a newly created DTP, the alert can be avoided. For existing DTPs, this field should always be set to TRUE.</P><UL>    <LI><CODE>canAutoSetup</CODE> - TRUE if this particular DTP has enough information to do a PPD auto setup (for example, a PAP DTP has a valid AppleTalk address for a LaserWriter).</li>    <LI><CODE>autoSetupPossible</CODE> - TRUE if this plug-in type can possibly do a PPD auto setup. For example, this field would be TRUE for a PAP DTP but FALSE for an LPR DTP because its lack of duplex communication protocol.</li>    <LI><CODE>refcon</CODE> - can be used by plug-ins in any way they please. It is normally used as a pointer to any memory allocated by a plug-in.</li>    <LI>The rest of the fields in this data structure are <CODE>ProcPtrs</CODE> pointing to routines in the plug-in. DTPU calls these routines when it needs some information from a plug-in or when it needs a plug-in to perform certain tasks. These routines are described below.</li></UL><BR><p><A HREF = "#top">Back to top</a></p><A NAME="Section5"></A><H2>Plug-in Interface</H2><P>The Plug-in interface is in C. Although DTPU is written in C++ using PowerPlant, plug-ins do not have to use C++ or PowerPlant. All routines provided by plug-ins should return a result of type <CODE>OSStatus</CODE>. <CODE>noErr</CODE> should be used as an indication of success. Shared library initialization and termination routines can be used for initialization and clean-up. It is important to restore the current resource file before exiting any plug-in routine if the current resource file is ever changed.</P><P>Plug-ins must provide the following routines and point each of their corresponding <CODE>ProcPtrs</CODE> in <CODE>PlugInDtpInfo</CODE> to them. For those marked optional, the <CODE>ProcPtrs</CODE> should be set to NULL if the plug-in chooses not to support them.</P><H3>Open and Close</H3><h4>DtpuPluginOpen</h4><P>All DTPU plug-ins must export a routine named <CODE>DtpuPluginOpen</CODE>. This is the first routine called by DTPU after shared library initialization.</p>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSStatus DtpuPluginOpen(PlugInDtpInfo *plugInDtpInfoP, void* inRefCon,  Collection inCollection);</pre></TD></TR></TABLE></CENTER><BR><BR><P><CODE>plugInDtpInfoP</CODE> points to a <CODE>PlugInDtpInfo</CODE> structure whose contents should be filled in by this routine. DTPU uses the information returned in this data structure to display a DTP window and interact with the plug-in. The data fields <CODE>dtpID</CODE>, <CODE>dtpType</CODE>, <CODE>dtpHelp</CODE>, <CODE>dtpConfigTitle</CODE>, <CODE>pluginSpecified</CODE>, and <CODE>refcon</CODE> have already been explained in the previous section. The <CODE>ProcPtrs</CODE> are pointers to routines provided by a plug-in. When <CODE>DtpuPluginOpen</CODE> is called, a plug-in should fill out all <CODE>ProcPtrs</CODE> and point them to the routines handling the requests. These routines are described below with their corresponding <CODE>ProcPtrs</CODE> in <CODE>PlugInDtpInfo</CODE>. <CODE>ProcPtrs</CODE> for optional routines which are not supported by a specific plug-in should be set to NULL.</P><P><CODE>inRefCon</CODE> should be ignored if it is NULL. Otherwise, <CODE>inRefCon</CODE> would be the value returned by a previous call to <CODE>DtpuPluginOpen</CODE>. In this case, it should be used to initialize the newly created plug-in DTP. Internal information contained in <CODE>inRefCon</CODE> should be copied over to the new refcon or data structure allocated for the new plug-in DTP.</p><P><CODE>inCollection</CODE> should be ignored if it is NULL. Otherwise, it is a Collection for an existing DTP. Internal information needed by plug-ins to initialize a newly created plug-in DTP can be extracted from this Collection by using <CODE>GetCollectionItem</CODE>. This information would be the same as that saved by the routine pointed to by <CODE>savePrefsProc</CODE>, which is described later. See <a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">Inside Macintosh: QuickDraw GX Environment and Utilities</A> for more information on the Collection Manager.</p><P>If <CODE>inRefCon</CODE> is non-zero, it should be used to initialized the new DTP, and <CODE>inCollection</CODE> should be ignored. If <CODE>inRefCon</CODE> is zero and <CODE>inCollection</CODE> is non-zero, <CODE>inCollection</CODE> should be used to initialize the new DTP. If they are both zero, the new DTP should be initialized with reasonable default values.</P>        <P><B>Note:</B><BR>Multiple instances of the same plug-in must be able to coexist at the same time, since there may be multiple DTPs with the same plug-in type. This means the calling sequence does NOT necessary follow an open -&gt; close -&gt; open -&gt; close order. Your plug-in's <CODE>DtpuPluginOpen</CODE> function might be called again before its closeProc function is ever called.</p><P>Unless otherwise stated, the <CODE>refcon</CODE> parameter in the following routines is the same as the <CODE>refcon</CODE> in the <CODE>PlugInDtpInfo</CODE> returned by a previous call to your <CODE>DtpuPluginOpen</CODE> function.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>closeProcOSStatus closeProc(void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>closeProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>closeProc</CODE> routine.</P><P>DTPU calls this routine to give a plug-in a chance to release any system resources allocated in the <CODE>DtpuPluginOpen</CODE> call.</P><A NAME="DTPWindow"></A><H3 ALIGN=LEFT>DTP Window Display</H3><P>To display the lower pane of the DTPU window on behalf of plug-ins, DTPU must call the following three routines:</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>getIconTitlecloseProcOSStatus getIconTitle(Str255 outIconTitle, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>getIconTitleProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>getIconTitle</CODE> routine.</P><P>The plug-in should set the content of <CODE>outIconTitle</CODE> to the string to display as the printer icon title (typically the printer name or network address) in item 3, Figure 5.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>getUsageTextOSStatus getUsageText(Str255 outUsageText, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>getUsageTextProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>getUsageText</CODE> routine.</P><P>The plug-in should set the content of <CODE>outUsageText</CODE> to the informative text to display, as shown in item 4, Figure 5.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>drawIconOSStatus drawIcon(Rect* inFrameP, Boolean inHilite, void* inRefCon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>drawIconProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>drawIcon</CODE> routine or to NULL if it's not supported.</P><P>This is the plug-in's optional routine to draw an icon representing the printer or its setting. Plug-ins that don't want to draw their own icons should set this field to NULL, in which case a generic LaserWriter icon is displayed.</p><P>The icon is positioned as item 2 in Figure 5. Plug-ins can use Mac Toolbox routines such as <CODE>PlotIconID</CODE> or <CODE>PlotIconSuite</CODE> to draw this icon. The GrafPort is already set properly when this routine is called. Any change made to the GrafPort's drawing state by this routine should be restored on exit.</p><P><CODE>inFrameP</CODE> is a pointer to a <CODE>Rect</CODE> which contains the position (in local coordinates) of the icon to be drawn.</p><P><CODE>inHilite</CODE> indicates whether the icon should be drawn as hilited or normal.</p><H3>Copy&amp;Paste + Drag&amp;Drop</H3><P>DTPU supports Copy &amp; Paste and Drag &amp; Drop between DTP documents. One can copy or drag the lower pane icon (item 2 in Figure 5) and paste or drop it into another DTP window provided the two DTP windows have compatible data types. This allows a user to copy the configuration information from one DTP to another, which can simplify the configuration process. Because DTPU does not know the meaning of a plug-in's internal data, plug-ins have to provide the following six routines to help DTPU determine if the data can be used.</p>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>clipboardOkOSStatus clipboardOk(Boolean* outAceptableP, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field clipboardOkProc in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>clipboardOk</CODE> routine.</p><P>DTPU calls this routine to decide if the content in the clipboard is acceptable to a plug-in's DTP. Plug-ins should use <CODE>GetScrap()</CODE> to determine if the data on the clipboard is sufficient to setup its part of the DTP completely. <CODE>*outAceptableP</CODE> should be set to TRUE if the clipboard contains the needed data and FALSE otherwise (if not all needed information is present).</p>              <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>pasteClipboardOSStatus pasteClipboard(void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><p>The field <CODE>pasteClipboardProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>pasteClipboard</CODE> routine.</p><P>DTPU calls this routine to paste the clipboard into a plug-in's internal DTP data. The plug-in should use <CODE>GetScrap()</CODE> to extract the type of data it needs and update its internal information. Any fields in <CODE>PlugInDtpInfo</CODE> that are affected by this operation should be updated to reflect these changes.</p>               <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>placeInClipboardOSStatus placeInClipboard(void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>placeInClipboardProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>placeInClipboard</CODE> routine.</p><P>DTPU calls this routine to place a plug-in's internal data in the clipboard. The plug-in should use <CODE>PutScrap()</CODE> to export its internal data of one or more types.</p>             <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>addDragDataOSStatus addDragData(DragReference inDragRef,    ItemReference inItemRef, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR>        <p>The field addDragDataProc in data structure PlugInDtpInfo should be set to the address of the plug-in's addDragData routine.</p><P>DTPU calls this routine when the plug-in's icon is being dragged. The plug-in should use <CODE>AddDragItemFlavor()</CODE> to export its internal data in one or more types. See <a href="../../documentation/macos8/InterproCom/DragManager/dragmanager.html">Inside Macintosh: Drag Manager</A> for descriptions <CODE>inDragRef</CODE> and <CODE>inItemRef</CODE>.</p>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>dragAcceptableOSStatus dragAcceptable(DragReference inDragRef,     ItemReference inItemRef,     Boolean* acceptableP, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><p>The field <CODE>dragAcceptableProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>dragAcceptable</CODE> routine.</p><P>DTPU calls this routine to decide if the content of a drag is acceptable to a plug-in's DTP. Plug-ins should use <CODE>GetFlavorFlags()</CODE> to decide if a drag has the type or types of data needed. See <a href="../../documentation/macos8/InterproCom/DragManager/dragmanager.html">Inside Macintosh: Drag Manager</A> for <CODE>inDragRef</CODE> and <CODE>inItemRef</CODE>.</p>              <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>receiveDragItemOSStatus receiveDragItem(DragReference inDragRef,     DragAttributes inDragAttrs,     ItemReference inItemRef, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR> <P>The field <CODE>receiveDragItemProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>receiveDragItem</CODE> routine.</p><P>DTPU calls this routine to drop data onto plug-in's DTP. Plug-ins should use <CODE>GetFlavorDataSize()</CODE> and <CODE>GetFlavorData()</CODE> to extract the data. See <a href="../../documentation/macos8/InterproCom/DragManager/dragmanager.html">Inside Macintosh: Drag Manager</A> for <CODE>inDragRef</CODE>, <CODE>inDragAttrs</CODE>, and <CODE>inItemRef</CODE>.</P><H3 ALIGN=LEFT>DTP Saving</H3><P>Whenever DTPU needs to save a DTP which has a custom plug-in type, it needs assistance from the following three routines provided by plug-ins:</p>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>addTagsOSStatus addTags(Collection outTagCollection,   CollectionTag inTag, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>addTagsProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's addTags routine or to NULL if not supported.</p><P>DTPU calls <CODE>addTags</CODE> before making an extended <CODE>'PAPA'</CODE>. This gives plug-ins a chance to save information needed at printing time. Plug-ins need to add this data to the Collection <CODE>outTagCollection</CODE>. On exit, DTPU will take the Collection and save its data into the DTP's <CODE>'PAPA'</CODE>. Plug-ins that don't need this functionality don't have to support this routine.</P><P>For example, the domain name address required by an LPR hose at print time can be saved in extended <CODE>'PAPA'</CODE> with this routine. See <A HREF = "tn1115.html">Technote 1115: The Extended PAPA</A> for additional information. This routine should make a call similar to this one:</P>               <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>err = AddCollectionItem(outTagCollection, inTag,myPluginDataType, myPluginDataSize, (void *)myPluginDataPtr);</pre></TD></TR></TABLE></CENTER><BR><BR><P><CODE>outTagCollection</CODE> is the resulting Collection that will be used to make the extended <CODE>'PAPA'</CODE>. <CODE>inTag</CODE> is always <CODE>'PAPA'</CODE>. <CODE>myPluginDataType</CODE> should be a 4-character id identifying the plug-in data being added into the Collection. <CODE>myPluginDataSize</CODE> and <CODE>myPluginDataPtr</CODE> are the size and pointer to a plug-in's private data for the DTP. As an example of this, an LPR DTP could use <CODE>'TCP '</CODE> for <CODE>myPluginDataType</CODE>, the length of the domain name for <CODE>myPluginDataSize</CODE> and a pointer to the domain name for <CODE>myPluginDataPtr</CODE>.</P>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>savePrefsOSStatus savePrefs(Collection outTagCollection, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>savePrefsProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>savePrefs</CODE> routine or to NULL if not supported.</p><P>DTPU calls <CODE>savePrefs()</CODE> before saving a plug-in DTP. It gives plug-ins a chance to save any private data they might need to reopen an existing DTP. Plug-ins need to add their private data to <CODE>outTagCollection</CODE>. On exit, DTPU saves the content of the Collection.</P>              <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>suggestDocNameOSStatus suggestDocName(Str255 outDocName, void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR><P>The field <CODE>suggestDocNameProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's <CODE>suggestDocName</CODE> routine or to NULL if not supported. If this field is NULL, DTPU will use the name returned by <CODE>getIconTitle</CODE> as the default DTP name in a save or save as dialog window.</P><P>DTPU calls <CODE>suggestDocName</CODE> before saving an untitled plug-in DTP. It gives plug-ins a chance to suggest a name for the DTP. Plug-ins can use an appropriate default name and put it in <CODE>outDocName</CODE>. For example, an LPR DTP might suggest the printer's domain name address for the DTP name.</P><A NAME="ConfigDialog"></A><H3>Configuration Dialog Window</H3>              <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>configureOSStatus configure(PlugInDialogCallbackProc callbackProc,    MenuHandle editMenuH, short cutMenuItem,    short copyMenuItem, short pasteMenuItem,    void *refcon);</pre></TD></TR></TABLE></CENTER><BR><BR>   <P>The field <CODE>configureProc</CODE> in data structure <CODE>PlugInDtpInfo</CODE> should be set to the address of the plug-in's configure routine.</P><P>DTPU calls configure whenever the lower &quot;Change...&quot; button (item 5, Figure 5) is clicked or the lower icon (item 2, Figure 5) is double-clicked. In response to this user interaction, a plug-in should display a movable modal dialog window such as the one shown in Figure 6. The content of the dialog is decided by the plug-in.</P><P>A plug-in's configure routine should call <CODE>WaitNextEvent()</CODE> and handle all events directed to this movable modal dialog window. In particular, the routine should handle mouse clicks in the content region, mouse clicks in the title bar of the dialog window, window dragging of this dialog, and any update events for the dialog. <CODE>keyDown</CODE> or <CODE>autoKey</CODE> events when the command key is not pressed should be handled by this routine as well. Events not related to the dialog window and not handled by the plug-in's configure routine should be passed up to DTPU by calling <CODE>callbackProc</CODE>. <CODE>callbackProc</CODE> is of type <CODE>PlugInDialogCallbackProc</CODE> which is defined as:</P>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>typedef void (*PlugInDialogCallbackProc)(EventRecord* macEventP);</pre></TD></TR></TABLE></CENTER><BR><BR><P>DTPU handles command key-down events, and events not specifically for the plug-in's window.</P><P>Upon entering this routine, the Edit menu is disabled. Plug-ins should enable/disable the Cut, Copy, and Paste menu items as desired if the dialog has editable text items. Plug-ins should keep this menu updated for the duration of the execution of this configure routine. The command key-down events for Edit, however, are handled by DTPU through the callback. The <CODE>MenuHandle</CODE> of Edit is passed in as <CODE>editMenuH</CODE> and the menu items are in <CODE>cutMenuItem</CODE>, <CODE>copyMenuItem</CODE>, and <CODE>pasteMenuItem</CODE>. Plug-ins should use <CODE>EnableItem()</CODE> and <CODE>DrawMenuBar()</CODE> to update the Edit menu (see Figure 8).</P><p align=center><img src="images/tn1172_009.gif" alt="Figure 8" width=229 height=100 border=2 align=middle></p><p align=center><b>Figure 8</b> - Edit menu enabled by plug-in</p><P>Plug-ins should not return control back to DTPU until the user either confirms or cancels the settings in the dialog window. A value of "0" for user confirmation or a value "1" for user cancellation should be returned as a result of this routine. Any other value causes an error.</P><BR><p><A HREF = "#top">Back to top</a></p>         <A NAME="Summary"></A><H2>Summary</H2><P>This Technote explains how to add a plug-in (or plug-ins) to the system that will be used by Desktop Printer Utility. These plug-ins can configure desktop printers that use third-party custom hoses as described in <A HREF = "tn1144.html">Technote 1144: Writing Custom Hoses for LaserWriter 8</A>. With the information contained in this Technote and the sample code which accompanies it, you should be able to extend Desktop Printer Utility and Desktop Printing in general.</P><a name="References"></a><H2>References</H2>    <p><A HREF = "tn1170.html">Technote 1170: The Printing Plug-ins Manager</A></p>    <p><A HREF = "tn1144.html">Technote 1144: Writing Custom Hoses for LaserWriter 8 </A></p>      <p><A HREF = "tn1129.html">Technote 1129: The Settings Library</A></p>         <p><A HREF = "tn1115.html">Technote 1115: The Extended 'PAPA' Resource</A> </p>        <p><A HREF = "tn1113.html">Technote 1113: Customizing the Desktop Printer Utility</A> </p>    <p><a href="../../documentation/macos8/InterproCom/DragManager/dragmanager.html">Inside Macintosh: Drag Manager</A></p>    <p><a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">Inside Macintosh: QuickDraw GX Environment and Utilities</A></p><a name="Changes"></a><H2>Change History</H2>           <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-December-1998</P>               </TD>               <td align="left">                  <P>First released.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-June-1999</P>               </TD>               <td align="left">                  <P>Updated and converted to Technote format.</P>               </TD>            </TR>                         </TABLE>         <BR><P><A HREF="#top">Back to top</A></P><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (500K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn1172.pdf">Download</A></P></TD>  </TR>   <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/bluebook.gif" width=22 height=23 align=bottom alt="Bluebook.gif"></P></TD><td align="left">   <p> Binhexed Sample Code (196K).</P></TD><td width=60 align=left>   <p><A HREF = "downloads/tn1172.1.hqx">Download</A></P></TD>  </TR>   </table></center>  <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1172.html%3Fid%3DDTS10003011-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1172.html%3Fid%3DDTS10003011-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1172.html%3Fid%3DDTS10003011-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>