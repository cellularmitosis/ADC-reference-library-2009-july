<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><title>Technical Q&amp;A QA1316: QuickTime 6.4 &amp; AvailabilityMacros.h on Mac OS X 10.2.x</title><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><meta name="keywords" content="QuickTime 6.4, Precompiled Headers, CodeWarrior, Mach-O, Availability Macros"><meta name="Description" content="This Q&amp;A describes how to fix compiler build issues when upgrading to QuickTime 6.4 on Mac OS X 10.2.x systems."><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR=WHITE><a name="//apple_ref/doc/uid/DTS10002341" title="QuickTime 6.4 & AvailabilityMacros.h on Mac OS X 10.2.x"></a><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxCarbon-date.html">Carbon</a> &gt; </p><!-- end_header_information --><!-- begin_titles_information --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1316</div>
<div id="pageheadsub">QuickTime 6.4 &amp; AvailabilityMacros.h on Mac OS X 10.2.x</div>
</h1>
</td></tr></table></CENTER><!-- end_titles_information --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR>					<td align="left">						<hr width=500 align=center>						<!-- begin_document_contents -->						<p id=p2>Q: Upgrading to QuickTime 6.4 seems to have broken the ability to build our application. In one case we are using CodeWarrior 8.3 on Mac OS X 10.2.6 to build a Mach-O target and are now getting parse errors referring to <code>AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER</code>. How do we fix this?</p>						<p id=p2>We also rely on <code>MAC_OS_X_VERSION_10_3</code> being defined to determine if we&#146;re building with the Mac OS X 10.3 headers or not. QuickTime 6.4 seems to have updated <code>AvailabilityMacros.h</code> on MacOS X 10.2.x systems and now defines it. What is the correct approach when conditionalizing our code to build on multiple versions of the OS when <code>MAC_OS_X_VERSION_10_3</code> may, or may not be defined?</p>						<p id=p4>A: Whenever you install or update a Framework (in this case QuickTime 6.4) you should always recompile any precompiled headers a project is relying on. Additionally, you should not rely on the existance of a specific OS version macro (in this case <code>MAC_OS_X_VERSION_10_3</code>) being defined as the way to conditionalizing your code.</p>						<p id=p4>QuickTime 6.4 introduces new APIs which are available on Mac OS X 10.2.x systems when QuickTime 6.4 is installed, and always available on Mac OS X 10.3 systems. These APIs are tagged with <code>AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER</code>; this macro is defined in the updated version of <code>AvailabilityMacros.h</code> (<code>/usr/include/AvailabilityMacros.h</code>) but was not defined in the version of this header file that shipped with Mac OS X 10.2.</p>						<CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6">										<P><B>Note:<br>											</B></P>										<p>The previous version of <code>AvailabilityMacros.h</code> is renamed to <code>AvailabilityMacros.h.orig</code> after installing QuickTime 6.4</p>									</TD></TR></TABLE></CENTER>						<p id=p4>These Availability Macros help you determine which OS versions or Framework updates introduced the APIs you are using, and can tell the compiler which routines should be weakly linked. For a more detailed explanation of Availability Macros see <a href="../../technotes/tn2002/tn2064.html" target="_blank">TN:2064 Ensuring Backward Binary Compatibility - Weak Linking and Availability Macros on Mac OS X</a>.</p>						<h3 id=p4>Solutions:</h3>						<ol>							<li id=p4>Rebuild your CodeWarrior precompiled headers.							<li id=p4>Rebuild your Project Builder precompiled headers.							<li id=p4>Do not test whether <code>MAC_OS_X_VERSION_10_3</code> is defined to distinguish between building on Mac OS X 10.2.x and Mac OS X 10.3.					</ol>						<p id=p4>1) If you were using precompiled headers for your CodeWarrior Mach-O project, MacHeadersMach-O.h as your Prefix File in the C/C++ Language Settings panel for example, you can rebuild them by following these steps:</p>						<ol>							<li type="1" id=p4>Navigate to your Metrowerks CodeWarrior directory.							<li type="1" id=p4>Find the Build.MacOSX.mcp project located in MSL/(MSL_Build_Projects)/OS X/.							<li type="1" id=p4>Double click to open the Build.MacOSX.mcp project.							<li type="1" id=p4>Select Make (Command+M) from the Project menu.						</ol>						<p id=p4>2) Project Builder/Xcode users developing using gcc 2.95 or gcc 3.1may notice errors such as:</p>						<div align="center">							<table border=0 cellpadding=3 width=550>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<pre><code>/System/Library/Frameworks/QuickTime.framework/Headers/QuickTime.h:20:warning: could not use precompiled header'/System/Library/Frameworks/Carbon.framework/Headers/Carbon-gcc3.p',because:/System/Library/Frameworks/QuickTime.framework/Headers/QuickTime.h:20:warning: 'AvailabilityMacros.h' has different date than in precomp</code></pre>									</td>								</tr>							</table>						</div>						<p id=p4>Fixing these errors also requires a rebuild of your precompiled headers using <code>fixPrecomp</code>.</p>						<p id=p4>From the Terminal type: <code>sudo fixPrecomps -force</code><br>						</p>						<p id=p4>3) Do not rely on the existance of a specific OS version macro (in this case <code>MAC_OS_X_VERSION_10_3</code>) being defined as the way to conditionalizing your code. While it may be very tempting to perform the checks shown in Listing 1 and 1a, these are flawed and liable to fail.</p>						<div align="center">							<table border=0 cellpadding=3 width=550>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<p><b>Important:<br>											</b></p>										<p>To help visually demonstrate how using the macro <code>MAC_OS_X_VERSION_10_3</code> as the way to conditionalize your code can cause unintentional results, Listing 1 and 1a are presented as examples of <b>incorrect</b> use.</p>									</td>								</tr>							</table>							<br>							<table border=0 cellpadding=0 width=550>								<tr>									<td scope="row">										<p><b>Listing 1</b>. Incorrect test -- do <b>not</b> do this!</p>									</td>								</tr>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<pre><code>// WRONG -- This fails on Mac OS 10.2 systems when// QuickTime 6.4 is installed, because MAC_OS_X_VERSION_10_3 is defined.#ifdef MAC_OS_X_VERSION_10_3  // Mac OS X 10.3 only code...#endif </code></pre>									</td>								</tr>							</table>							<br>							<table border=0 cellpadding=0 width=550>								<tr>									<td scope="row">										<p><b>Listing 1a</b>. Incorrect test -- do <b>not</b> do this!</p>									</td>								</tr>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<pre><code>// WRONG -- This fails on Mac OS 10.2 systems when// QuickTime 6.4 is not installed. </code><code>// if MAC_OS_X_VERSION_10_3 is not defined, it may be interpreted// as having the value zero, so the test becomes (1020 &gt;= 0),// which evaluates to true and could cause Mac OS X 10.3-only code// to be used unintentionally.#if MAC_OS_X_VERSION_MAX_ALLOWED &gt;= MAC_OS_X_VERSION_10_3  // Mac OS X 10.3 only code...#endif</code></pre>									</td>								</tr>							</table>							<br>						</div>						<p id=p4>By default, <code>MAC_OS_X_VERSION_MAX_ALLOWED</code> is the version of Mac OS X you are compiling on. For MacOS 10.2.x <code>MAC_OS_X_VERSION_MAX_ALLOWED</code> is defined as <code>1020</code>, for MacOS X 10.3 it is <code>1030</code> and so on. By using <code>MAC_OS_X_VERSION_MAX_ALLOWED</code> as the way to conditionalize, you are ensuring that the bracketed code will only compile on MacOS X 10.3 or later.</p>						<div align="center">							<table border=0 cellpadding=0 width=550>								<tr>									<td scope="row">										<p><b>Listing 2</b>. Specifically conditionalize for 10.3 or above</p>									</td>								</tr>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<div align="left">											<pre><code>#if MAC_OS_X_VERSION_MAX_ALLOWED &gt;= 1030  </code><code>// Mac OS X 10.3 only code...#endif</code></pre>										</div>									</td>								</tr>							</table>						</div>						<div align="left">							<h3>References:</h3>						</div>						<ul>							<div align="left">								<li><a href="../../technotes/tn2002/tn2064.html" target="_blank">TN:2064 Ensuring Backward Binary Compatibility - Weak Linking and Availability Macros on Mac OS X</a>							</div>						</ul>						<hr width=500 align=center>						<!-- begin_date --><H4 ALIGN=center>[Oct 21, 2003]</H4><!-- end_date --><!-- end_document_contents --></td>				</TR></TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1316.html%3Fid%3DDTS10002341-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1316.html%3Fid%3DDTS10002341-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1316.html%3Fid%3DDTS10002341-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>