<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>AFP General Command Format(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING230></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-229.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-231.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-223.html"><B>Chapter 9 - AppleTalk Filing Protocol (AFP)</B></A> / <A HREF="Networking-225.html"><B>AFP Reference</B></A><BR><DL><DD><A HREF="Networking-229.html"><B>Routines</B></A> / <A HREF="Networking-228.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING230-0></A>
<H3>AFP General Command Format</H3>
 You use the general command format for the <A NAME=MARKER-9-112></A><CODE>AFPCommand</CODE> function to pass any of the AFP commands to the .XPP driver to be sent to the server except <CODE>afpLogin</CODE>, <CODE>afpRead</CODE>, <BR>and <CODE>afpWrite</CODE>. <P>
<PRE>
FUNCTION AFPCommand (thePBptr: XPPParmBlkPtr; 
                     async: Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to the XPP parameter block format for the AFP commands that use the AFP general command format. 
<DT><CODE><A NAME=MARKER-2-178></A>async</CODE> 
<DD> A Boolean that specifies whether the function is to be executed synchro-<BR>nously or asynchronously. Set the <CODE>async</CODE> parameter to <CODE>TRUE</CODE> to execute the function asynchronously.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result. <TR>
<TD><--<TD>cmdResult<TD>LongInt<TD>The AFP command result.<TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .XPP driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always afpCall for this function.<TR>
<TD>--><TD>sessRefnum<TD>Integer<TD>The session reference number. <TR>
<TD>--><TD>aspTimeout<TD>Byte<TD>The retry interval in seconds.<TR>
<TD>--><TD>cbSize<TD>Integer<TD>The command buffer size.<TR>
<TD>--><TD>cbPtr<TD>Ptr<TD>The command buffer<EM>.</EM><TR>
<TD><-><TD>rbSize<TD>Integer<TD>The reply buffer size and reply size.<TR>
<TD>--><TD>rbPtr<TD>Ptr<TD>A pointer to the reply buffer.<TR>
<TD><-><TD>wdSize<TD>Integer<TD>The write data size.<TR>
<TD>--><TD>wdPtr<TD>Ptr<TD>A pointer to the write data.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-43></A>cmdResult</CODE>
<DD> Four bytes of data returned from the server indicating the result of the AFP command. 
<DT><CODE>sessRefnum</CODE>
<DD> The session reference number, which is a unique number that the .XPP driver assigns to the session and returns in response to an <CODE>afpLogin</CODE> command. 
<DT><CODE>aspTimeout</CODE>
<DD> The interval in seconds that the .XPP driver waits between retries of the AFP command.
<DT><CODE><A NAME=MARKER-2-179></A>cbSize</CODE>
<DD> The size in bytes of the block of data that contains the command and its parameters to be sent to the server across the session. <BR>The size of the command block must not exceed the value of <CODE>aspMaxCmdSize</CODE> that the <CODE>ASPGetParms</CODE> function returns. For information on the <CODE>ASPGetParms</CODE> function, see the chapter "AppleTalk Session Protocol (ASP)" in this book.
<DT><CODE><A NAME=MARKER-9-47></A>cbPtr</CODE>
<DD> A pointer to the beginning of the command block that contains the AFP command to be sent across the session to the server. (The <CODE>cbSize</CODE> field value specifies the command block size.) The first byte of the command block must contain the AFP command. The following bytes contain the parameters for the command. See <BR><I>Inside AppleTalk</I>, second edition, and the <I>AppleShare 3.0 Developer's Kit</I> version 3.0 for the definitions of the AFP commands and their command codes and parameters. 
<DT><CODE><A NAME=MARKER-2-79></A>rbSize</CODE>
<DD> On input, the size in bytes of the reply buffer that is to hold the expected response to the AFP command. On return, the actual size of the reply to the AFP command that the .XPP driver returned in the buffer. 
<DT><CODE><A NAME=MARKER-2-49></A>rbPtr</CODE>
<DD> A pointer to the reply buffer. 
<DT><CODE><A NAME=MARKER-2-50></A>wdSize</CODE>
<DD> The size of the write data buffer that contains the data to be written to the server. This field's value is used only if the AFP command is one that the .XPP driver maps to the <CODE>ASPUserWrite</CODE> function. 
<DT><CODE><A NAME=MARKER-2-114></A>wdPtr</CODE>
<DD> A pointer to the write-data buffer. This field's value is used only <BR>if the AFP command is one that the .XPP driver maps to the <CODE>ASPUserWrite</CODE> function.
</DL>
<A NAME=HEADING230-15></A>
<H5>DESCRIPTION</H5>
 The general format of the <CODE>AFPCommand</CODE> function provides a way to pass an AFP command to the server end of an open session and receive a reply. After you open a session with <BR>an AFP file server using the login format of the <CODE>AFPCommand</CODE> function, you can send a sequence of AFP commands across the session to the server. You use the general format for the <CODE>AFPCommand</CODE> function to send all of the AFP commands to the server, except for <CODE>afpLogin</CODE>, <CODE>afpRead</CODE>, and <CODE>afpWrite</CODE>, which have their own <CODE>AFPCommand</CODE> formats. AFP delivers the commands in the same order in which you send them and returns replies to the commands in the reply buffer that you provide. The <CODE>cmdResult</CODE> field indicates the result of the command that was delivered to the server, not the function result.<P>
<A NAME=HEADING230-17></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Note that you must provide the .XPP driver reference number as an input parameter <BR>to this function. You can obtain the driver reference number by calling the Device Manager's <CODE>OpenDriver</CODE> function. For information on the <CODE>OpenDriver</CODE> function, see <I><A HREF = "../Devices/Devices-2.html">Inside Macintosh: Devices</A>.</I><P>
 Any memory that you allocate for the parameter block, buffers, and command block belongs to the .XPP driver until the function completes execution, after which you can reuse or release the memory. <P>
<A NAME=HEADING230-20></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>AFPCommand</CODE> function from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>afpCall</CODE> in the <CODE>csCode</CODE> field of the parameter block.<P>
<A NAME=HEADING230-22></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>aspBufTooSmall<TD>-1067<TD>The command reply from the server is larger than <BR>the response buffer; ASP will fill the buffer and truncate the reply data <TR>
<TD>aspParamErr<TD>-1070<TD>You specified an invalid session reference number, or the session has been closed <TR>
<TD>aspSessClosed<TD>-1072<TD>The .XPP driver is in the process of closing <BR>the session<TR>
<TD>aspSizeErr<TD>-1073<TD>The size of the command block exceeds the <BR>maximum size of <CODE>aspMaxCmdSize</CODE><TR>
<TD>afpParmError<TD>-5019<TD>The AFP command block size is equal to 0 (this error is also returned when the command block is equal to 0 or $FF [255] or <CODE>GetSrvrStatus</CODE> [15]) </TABLE>
</H5>
<A NAME=HEADING230-23></A>
<H5>SEE ALSO </H5>
 For a list of the AFP commands and their command code numeric values and constants, see <A HREF=Networking-229.html#MARKER-9-5>Table 9-1 on page 9-9</A>. To determine which AFP commands take the general <CODE>AFPCommand</CODE> format, see <A HREF=Networking-229.html#MARKER-9-3>Table 9-2 on page 9-13</A>. For a description of the AFP commands that you can send to a server and their required command block formats, see <I>Inside AppleTalk</I>, second edition, and the <I>AppleShare 3.0 Developer's Kit</I> <A NAME=MARKER-2-52></A>version 3.0.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-229.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-231.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
