<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../style.css" TYPE="text/css"><title>Technical Note PR04: LaserWriter Optimization Techniques</title>                                      <meta name="categories" content="Printing"><meta name="week-posted" content="Jan 27, 1986 - Feb 7, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002625" title="LaserWriter Optimization Techniques"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PR04</div>
<div id="pageheadsub">LaserWriter Optimization Techniques</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">Using QuickDraw With the LaserWriter</A><BR><BR><A HREF="#Section3">What You See Is Not Always What You Get</A><BR><BR><A HREF="#Section4">Memory Considerations</A><BR><BR><A HREF="#Section5">Printable Paper Area</A><BR><BR><A HREF="#Section6">Page Sizes</A><BR><BR><A HREF="#Section7">Speed Considerations</A><BR><BR><A HREF="#Section8">Clipping Within Text Strings</A><BR><BR><A HREF="#Section9">When to Validate the Print Record</A><BR><BR><A HREF="#Section10">Empty QuickDraw Objects</A><BR><BR> <A HREF="#References">References</A><BR><BR> <A HREF="#Changes">Change History</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note discusses techniques for optimizing code for printing onthe LaserWriter.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Mar 01 1988]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><p>Although the Printing Manager was originally designed to allow application codeto be printer independent, there are some things about the LaserWriter that, insome cases, have to be addressed in a printer dependent way.  This Notedescribes what the LaserWriter can and cannot do, memory considerations, speedconsiderations, as well as other things you need to watch out for if you wantto make your printing more efficient on the LaserWriter.</p><P><A HREF="#top">Back to top</A></P><h2>How To Determine The Currently Selected Printer</h2><p>With the addition of new picture comments and the <code>PrGeneral</code> procedure,an application should never need to know the type of device to which it isconnected.  However, some developers feel their application should be able totake advantage of all of the features provided by a particular device, not justthose provided by the Printing Manager, and in doing so, these developersproduce device-dependent applications, which can produce unpredictable resultsthird-party and new Apple printing devices.  For this reason, Apple stronglyrecommends that you use only the features provided by the Printing Manager, anddo not try to use unsupported device features.</p><p>Even though there is no supported method for determining a device's type, thereis one method described in the original <i>Inside Macintosh </i>that stillworks for ImageWriter and LaserWriter printer drivers.  This method is<b>not</b> supported, meaning that at some point in the future it will nolonger work.  If you use this method in your application, it is up to you toweigh the value of the feature against the compatibility risk.  The followingmethod works for all ImageWriter, ImageWriter II, and LaserWriter (original,Plus, IINT, IINTX) drivers.  Since all new devices released from Apple andthird-party developers have their own unique ID, it is up to you to decide whatto do with an ID that your application does not recognize.</p><p>If you are using the high-level Printing Manager interface, first call<code>PrValidate</code> to make sure you have the correct print record.  Look atthe high byte of the <code>wdev</code> word in the <code>TPrStl</code> subrecord of theprint record.  Note that if you have your own driver and want to have your ownnumber, please let DTS know, and DTS can register it.</p><p>Following is the current list of printer IDs:</p><P align=center><img src="images/pr_04_001.gif" alt="list of printer IDs" width=280 height=100></p><p>If you are using the low-level Printing Manager interface, there is nodependable way of getting the wDev information.  You should <b>not</b> attemptto determine the device ID when using the low-level Printing Managerinterface.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>Using QuickDraw With the LaserWriter</h2><p>When you print to the LaserWriter, all of the QuickDraw calls you make aretranslated (via QuickDraw bottlenecks) into PostScript, which is in the LaserWriter ROM.  Most of theoperations available in QuickDraw are available in PostScript, with a fewexceptions.  The LaserWriter driver does not support the following:</p><ul type="disc">	<li><code>XOR</code> and <code>NotXOR</code> transfer modes.</li>	<li>The grafverb <code>invert</code>.</li>	<li><code>_SetOrigin</code> calls within <code>PrOpenPage</code> and <code>PrClosePage</code> calls.  Use <code>_OffsetRect</code> instead.  (This is fixed in version 3.0 and later of the driver.)</li>	<li>Regions are ignored.  You can simulate regions using polygons or bitmaps.</li>	<li>Refer to Technical Note #41, <A HREF = "../qd/qd_07.html">Drawing Into An Off-Screen Bitmap</a>, for how to create off-screen bitmaps.</li>	<li>Clip regions should be limited to rectangles.</li>	<li>There is a small difference in character widths between screen fonts and printer fonts.  Only the end points of text strings are the same.</li></ul><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>What You See Is Not Always What You Get</h2><p>Unfortunately, what you see on the screen is not always what you get.  If youare using standard graphic objects, like rectangles, circles, etc., the objectis the same size on the LaserWriter as it is on the screen.  There are,however, two types of objects where this is not the case:  text and bitmaps.</p><p>The earlier noted difference between the widths of characters on the screen andthe widths of characters on the printer is due to the difference in resolution.However, to maintain the integrity of line breaks, the driver changes the wordand character spacing to maintain the end points of the lines as specified.What this all means is that you cannot count on the positions or the widths ofprinted characters being exactly the same as they are on the screen.  This iswhy in the original MacDraw, for example, if onecarefully places text and a rectangle and prints it, the text sometimes extendsbeyond the bounds of the rectangle on the printed page.  If an application doesits own line layout (i.e., positions the words on the line itself), then it maywant to disable the LaserWriter's line layout routines.  To disable theseroutines, use the <code>LineLayoutOff</code> picture comment described in theLaserWriter Reference Manual and Technical Note #91, <A HREF = "../qd/qd_10.html">Optimizing for theLaserWriter--Picture Comments</a>.</p><p>The sole exception to this rule is if an application is running on 128K ROMs orlater.  The 128K ROM Font Manager supports the specification of fractionalpixel widths for screen fonts, increasing the screen to printer accuracy.  Thisfractional width feature is disabled by default.  To enable it, an applicationcan use <code>_SetFractEnable</code>, after calling <code>_InitFonts</code>.</p><p>Applications can use picture comments to left-, right-, or center-justify text.Only the left, right, or center end points are accurate.  If the text is fullyjustified, both end points are accurate.  Technical Note #91, <A HREF = "../qd/qd_10.html">Optimizing forthe LaserWriter--Picture Comments</a>, discusses these picture comments.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>Memory Considerations</h2><p>To print to the LaserWriter, you need to make sure that you have enough memoryavailable to load the driver's code.  The best way to do this is to have allthe code you need for printing in a separate segment and unload everythingelse.  When you print to the LaserWriter you are only able to print in Draftmode.  You are not able to spool (as the ImageWriter does in the standard orhigh-quality settings), and your print code, data, and the driver code have tobe resident in memory.</p><p>In terms of memory requirements, there is not any magic number that alwaysworks with all printer drivers (including third-party printer drivers) that areavailable for the Macintosh.  To make sure there is enough memory availableduring print time, you should make your printing code a separate segment andswap out all unwanted code and data before you call <code>_PrOpen</code>.</p><P><A HREF="#top">Back to top</A></P><a name="Section5"></a><h2>Printable Paper Area</h2><p>On the LaserWriter there is a 0.45-inch border that surrounds the printablearea of the paper (this is assuming an 8.5" x 11" paper).  If you select the"Larger Print Area" option in the Page Setup dialog box, the border changes to0.25 of an inch.  This printable area is different than the available printarea of the ImageWriter.  An application cannot print a larger area because ofthe memory PostScript needs to image a page.  PostScript takes the amount ofmemory available in the printer and centers it on the paper, and there is notenough RAM in the LaserWriter to image an entire sheet of paper.</p><P><A HREF="#top">Back to top</A></P><a name="Section6"></a><h2>Page Sizes</h2><p>Many developers have expressed a desire to support page sizes other than thoseprovided by the Apple printer drivers.  Even though some devices can physicallysupport other page sizes, there is no way for an application to tell the driverto use this size.  With the ImageWriter driver, it is possible to modifycertain fields in the print record and expand the printable area of the page.However, each of the Apple drivers implements the page sizes in a differentway.  No one method works for all drivers.  Because of this difference, it isstrongly recommended that applications do not attempt to change the page sizesprovided in the "Style" dialog box.  If your application currently supportspage sizes other than those provided by the printer driver, you are taking aserious compatibility risk with future Apple and third-party printer drivers.</p><P><A HREF="#top">Back to top</A></P><a name="Section7"></a><h2>Speed Considerations</h2><p>Although the LaserWriter is relatively fast, there are some techniques anapplication can use to ensure its maximum performance:</p><ul type="disc">	<li>Try to avoid using the QuickDraw Erase calls (e.g., <code>_EraseRect</code>, <code>_EraseOval</code>, etc.).  It takes a lot of time to handle the erase function because every bit (90,000 bits per square inch) has to be cleared. Erasing is unnecessary because the paper does not need to be erased the way the screen does.</li>	<li>Printing patterns takes time, since the bitmap for the pattern has to be built.  The patterns <code>black</code>, <code>white</code>, and all the gray patterns have been optimized to use the PostScript gray scales.  If you use a different pattern it works, but it just takes longer than usual.  In addition, the patterns in driver version 3.0 are rotated; they are not rotated in version 1.0.</li>	<li>Try to avoid frequently changing fonts.  PostScript has to build each character it needs either by using the drawing commands for the built-in LaserWriter fonts or by resizing bitmaps downloaded from screen fonts on the Macintosh.  As each character is built, it is cached (if there's room), so if that character is needed again PostScript gets if from the cache.  When the font changes, the characters have to be built from scratch in the new font, which takes time.  If the font is not in the LaserWriter, it takes time to download it from the Macintosh.  If the user has the option of choosing fonts, you have no control over this variable; however, if you  control which fonts to use, keep this in mind.</li>	<li>Avoid using <code>_TextBox</code>.  It makes calls to <code>_EraseRect</code>, which slows the printer, for every line of text it draws.  You might want to use a different method of displaying text (e.g., <code>_DrawString</code> or <code>_DrawText</code>) or write your own version of <code>_TextBox</code>.  If an application is currently calling <code>_TextBox</code>, changing to another method of displaying text can improve speed on the order of five to one.</li>	<li>Because of the way rectangle intersections are determined, if your clip region falls outside of the <code>rPage</code> rectangle, you slow down the printer substantially.  By making sure your clip region is entirely within the <code>rPage</code> rectangle, you can get a speed improvement of approximately four to one.</li>	<li>Do not use spool-a-page/print-a-page as some applications do when printing on the ImageWriter.  It slows things down considerably because of all of the preparation that has to be done when a job is initiated.  Refer to Technical Note #125, <A HREF = "pr_18.html">Effect of Spool-A-Page/Print-A-Page on Shared Printers</a>, for more information.</li>	<li>Using <code>_DrawChar</code> to place every character to print can take a lot of time.  One reason, of course, is because it has to go through the bottlenecks for every character that is drawn.  The other is that the printer driver does its best to do line layout, making the character spacing just right.  If you are trying to position characters and the driver is trying to position characters too, there is conflict, and printing takes much longer than necessary.  In version 3.0 of the driver, there are picture comments that turn off the line layout optimization, alleviating some of the problem.  Refer to Technical Note #91, <A HREF = "../qd/qd_10.html">Optimizing for the LaserWriter--Picture Comments</a>, for more information.</li></ul><P><A HREF="#top">Back to top</A></P><a name="Section8"></a><h2>Clipping Within Text Strings</h2><p>When clipping characters out of a string, make sure that the clipping rectangleor region is greater than the bounding box of the text you want to clip.  Thereason is that if you clip part of a character (e.g., a descender), the clippedcharacter has to be rebuilt, which takes time.  In addition, because of thedifference between screen fonts and printer fonts, chances are that you cannotaccurately clip the right characters unless you are running on the 128K ROMsand have fractional pixel widths enabled.</p><P><A HREF="#top">Back to top</A></P><a name="Section9"></a><h2>When to Validate the Print Record</h2><p>To validate the print record, call <code>PrValidate</code>.  You need validation tocheck to see if all of the fields are accurate according to the current printerselected and the current version of the driver.  You should call<code>PrValidate</code> when you have allocated a new print record or whenever youneed to access information from the print record (i.e., when you get<code>rPage</code>).  The routines <code>PrStlDialog</code> and <code>PrJobDialog</code>call <code>PrValidate</code> when they are called, so you do not have to worryabout it if you use these calls.</p><P><A HREF="#top">Back to top</A></P><a name="Section10"></a><h2>Empty QuickDraw Objects</h2><p>QuickDraw objects that are empty (i.e., they have no pixels in them) and arefilled but not framed, do not print on the ImageWriter and do not show up onthe screen; however, on the LaserWriter they are real objects and do print.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P><i>Inside Macintosh</i>, Volume I, QuickDraw</p><P><i>Inside Macintosh</i>, Volume II, The Printing Manager</p><P><i>LaserWriter Reference Manual</i></p><P>Technical Note M.IM.OffscreenBitMap-- <A HREF = "../qd/qd_07.html">Drawing Into An Off-Screen Bitmap</a></p><P>Technical Note M.IM.gifComments -- <A HREF = "../qd/qd_10.html">Optimizing for the LaserWriter--Picture Comments</a></p><P>Technical Note M.IM.Spooler -- <A HREF = "pr_18.html">Effect of Spool-A-Page/Print-A-Page on Shared Printers</a></p><P>Technical Note M.IM.PrintLoop -- <A HREF = "pr_10.html">A Printing Loop That Cares...</a></p><P>PostScript Language Reference, Adobe Systems, Incorporated</p><P>PostScript Language Tutorial and Cookbook, Adobe Systems,Incorporated</p><P>MacDraw is a registered trademark of Claris Corporation.</p><P>PostScript is a registered trademark of Adobe Systems, Incorporated.</p><P><A HREF="#top">Back to top</A></P> <P>&nbsp;<A NAME=changes></A></P>                  <H2>Change History</H2>                                    <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1986</P>               </TD>               <td align="left">                  <P>Original publication.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-March-1988</P>               </TD>               <td align="left">                  <P>Updated the "Printable Paper Area" and "MemoryConsiderations" sections as well as the printer IDs, moved the error messagesfrom the end of the Note to Technical Note #161, <A HREF = "pr_10.html">A Printing Loop That Cares...</a>,and removed the "Spool-A-Page/Print-A-Page" section because Technical Note#125, <A HREF = "pr_18.html">Effect of Spool-A-Page/Print-A-Page on Shared Printers</a>, alreadythoroughly covers this topic.</P>               </TD>            </TR>         </TABLE>         <BR>                                    <P><A HREF="#top">Back to top</A></P>         <a name=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (92K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pr_04.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pr/pr_04.html%3Fid%3DDTS10002625-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pr/pr_04.html%3Fid%3DDTS10002625-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pr/pr_04.html%3Fid%3DDTS10002625-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>