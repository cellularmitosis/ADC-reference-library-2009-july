<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>LW8_Hosesample - /Hose.h</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; <A HREF="javascript:location.replace('index.html');">LW8_Hosesample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">LW8_Hosesample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Hose.h</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Hose.h</option>
<option value="listing2.html">/HoseFile.r</option>
<option value="listing3.html">/HoseIrda.c</option>
<option value="listing4.html">/HoseIrda.h</option>
<option value="listing5.html">/PSWriterErr.h</option></select>
				</p>
				</form>
				<p><strong><a href="LW8_Hosesample.zip">Download Sample</a></strong> (&#147;LW8_Hosesample.zip&#148;, 26.1K)<BR>
<strong><a href="LW8_Hosesample.dmg">Download Sample</a></strong> (&#147;LW8_Hosesample.dmg&#148;, 86.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    Hose.h  Contains:  interface to the hose routines  Written by: Richard Blanchard and Ingrid Kelly    Copyright:  Copyright &copy; 1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/26/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#ifndef __HOSE__#define __HOSE__/*** Constants ***//*  The size and number of buffers to use when writing PostScript to a file.*/#define kPrinterHoseBufSize      (8 * 512)    // For a quantem 8 printer.#define kPrinterHoseMinBufs      2        // We need at least this many buffers.#define kPrinterHoseMaxBufs      16        // Don't allocate more that this many buffers. rb891/*  The PAP code sets ioResult to 1 while an operation is pending.*/#define kPAPBusy      1/*  Our queues use the following constant as the queue type.  The type really doesn't matter, but it can ease debugging.*/#define kMemQueueType        84/*** Variable Types ***//*  The format of our queue elements. We allocate the queue elements  seperately from the actual buffers. This means we make twice as many  allocations (bad), but the code is more flexible (good) in that we can switch  to handles for the buffers or we can allocate multiple buffers in a single NewPtr  call.*/typedef struct MemQElem{  QElemPtr qLink;          // Used by Enqueue and Dequeue.  short qType;          // Our constant (kMemQueueType) to identify our queues.  struct BufIO *bufIO;      // So we can recover buffer information.  Byte *buf;            // Pointer to the allocated buffer.  SInt32 maxBytes;        // The size of the block pointed to by 'buf'  SInt32 nBytes;          // Number of valid bytes in 'buf'.  Boolean eoj;          // true if the data is followed by an end of job.  Boolean inQOnly;        // This buffer should be used only for the input routines.}MemQElem, *MemQElemPtr;/*  We track the state of the connection using these state constants.*/typedef enum{  kConnClosed = 0,    // We start in this state.  kConnOpening,      // This is the state while we wait for the printer to accept the connection.  kConnOpen,        // This is the state while we do reads and writes to the printer.  kConnClosing      // This is the state while we wait for the connection to close}ConnState;/*  When the hose's async routines complete, they should call PrStream's routines  via the following procedures. The hose passes the memory element of the  buffer that just completed reading or writing. The hose also passes an  error parameter to indicate problems with the channel.*/typedef void (*FinishedWriteProc)(MemQElemPtr memElem, OSStatus err);typedef void (*FinishedReadProc)(MemQElemPtr memElem, OSStatus err);typedef struct{  FinishedWriteProc finishedWrite;  FinishedReadProc finishedRead;}BufCallbacks;typedef OSStatus (*HoseOutProc)(void *refcon, MemQElemPtr memElem);typedef OSStatus (*HoseInProc)(void *refcon, MemQElemPtr memElem);typedef OSStatus (*HoseIdleProc)(void *refcon);typedef OSStatus (*HoseCloseProc)(void *refcon);typedef ConnState (*HoseConnProc)(void *refcon);typedef OSStatus (*HoseStatusProc)(void *refcon, StringPtr statusStr);typedef OSStatus (*HoseDisposeProc)(void *refcon);            typedef OSStatus (*HoseCancelProc)(void *refcon);/*  Support for the HoseCancelProc is new in PrintingLib 8.6.5.  When a job is being terminated abnormally, if the hose exports  a function with the name &quot;hoseCancel&quot; then that routine  is invoked prior to the HoseCloseProc and HoseDisposeProc. *//*  The HoseInfo structure is filled out by a hose open procedure. The  structure describes the buffer requirements of the hose as well as  the function pointers for reading, writing, and closing the hose.*/typedef struct{  HoseOutProc out;      // The procedure to call with a filled buffer.  HoseInProc in;        // The procedure to call to send a buffer.  HoseIdleProc idle;      // The procedure to call when we get a chance.  HoseCloseProc close;    // The procedure to call when we are done printing.  HoseConnProc connState;    // This procedure returns the state of the current connection.  HoseStatusProc status;    // Use this procedure to get the hose's current status string.  HoseDisposeProc dispose;  // The hose should free up all of its memory.         //rb2198    Size bufSize;        // The size of each allocated data buffer.  long minBufs;        // We need at least this many buffers or we return an out of mem error.  long maxBufs;        // We'll never allocate more buffers than this.  void *refcon;        // A pointer that will be passed to the data handling routines.}HoseInfo;typedef OSStatus (*HoseOpenProc)(HoseInfo *hoseInfo, BufCallbacks *callbacks, Collection hints, Handle papaH);    // DMG500/* The entry point for a hose library. */#if PRAGMA_IMPORT_SUPPORTED#pragma import on#endifOSStatus hoseOpen(HoseInfo *hoseInfo, BufCallbacks *callbacks, Collection hints, Handle papaH);#if PRAGMA_IMPORT_SUPPORTED  #pragma import off#endif#endif    // __HOSE__</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/LW8_Hosesample/listing1.html%3Fid%3DDTS10000295-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/LW8_Hosesample/listing1.html%3Fid%3DDTS10000295-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/LW8_Hosesample/listing1.html%3Fid%3DDTS10000295-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>