<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QTMCC15: Decompressing MP3</title><meta name="keywords" content="have creator list relevant keywords here"><meta name="Description" content="Technical Q&amp;A QTMCC15: This Q&amp;A describes how decompressMP3 files into a buffer using  SoundConverterConvertBuffer."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Sep 18, 2000 - Sep 22, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001958" title="Decompressing MP3"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxImportExport-date.html">Import & Export</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QTMCC15</div>
<div id="pageheadsub">Decompressing MP3</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><P ID=p2>Q: I am currently attempting to decompress an MP3 file into a buffer using the SoundConverter APIs and am having no luck. <CODE>SoundConverterConvertBuffer</CODE> seems to work fine when decoding certain files, but fails if the file is MP3 encoded. Does MP3 decompression require calling <CODE>SoundConverterSetInfo</CODE>? If so, what parameters do I pass in?</P><P ID=p4>A: Yes, a call to <CODE>SoundConverterSetInfo</CODE> is required, but first you'll have to retrieve the decompression settings atom from the sound file. To do this, open the MP3 as a QuickTime movie using <CODE>NewMovieFromFile</CODE>. Use the <CODE>GetMediaSampleDescription</CODE> routine to retrieve a description of the sample data, then use <CODE>GetSoundDescriptionExtension</CODE> (passing in the sample description, and using the <CODE>siDecompressionParams</CODE> selector as parameters) to extract the decompression atom list from the sound track. Once you have the decompression atom list, call <CODE>SoundConverterSetInfo</CODE> using the <CODE>siDecompressionParams</CODE> selector as we did with the previous call. Without this setup, the decoder won't know how to interpret the sample data.</p><P ID=p4>The sample routine below shows how to extract the decompression parameters.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>OSErr MyGetSoundDescriptionExtension(const FSSpec *inMP3file,    AudioFormatAtomPtr *outAudioAtom) {  Movie theMovie;  Track theTrack;  Media theMedia;  short theRefNum;  short theResID = 0;  // we want the first movie  Boolean wasChanged;  OSErr err = noErr;  // open the movie file  err = OpenMovieFile(inMP3file, &amp;theRefNum, fsRdPerm);  if (err) goto bail;  // instantiate the movie  err = NewMovieFromFile(&amp;theMovie, theRefNum, &amp;theResID, NULL,      newMovieActive, &amp;wasChanged);  if (err) goto bail;  CloseMovieFile(theRefNum);  theRefNum = 0;  // get the first sound track  theTrack = GetMovieIndTrackType(theMovie, 1, SoundMediaType,      movieTrackMediaType);  if (theTrack != NULL) {    // get the sound track media    theMedia = GetTrackMedia(theTrack);    if (theMedia != NULL) {      Size size;      Handle extension;      SoundDescriptionV1Handle sourceSoundDescription;      sourceSoundDescription = (SoundDescriptionV1Handle)NewHandle(0);      // get the description of the sample data      GetMediaSampleDescription(theMedia, 1,          (SampleDescriptionHandle)sourceSoundDescription);      err = GetMoviesError();      extension = NewHandle(0);      // get the &quot;magic&quot; decompression atom      // This extension to the SoundDescription information stores      // data specific to a given audio decompressor. Some audio      // decompression algorithms require a set of out-of-stream      // values to configure the decompressor.      err = GetSoundDescriptionExtension(          (SoundDescriptionHandle)sourceSoundDescription,          &amp;extension, siDecompressionParams);      if (noErr == err) {        size = GetHandleSize(extension);        HLock(extension);        *outAudioAtom = (AudioFormatAtom*)NewPtr(size);        err = MemError();        // copy the atom data to our buffer...        BlockMoveData(*extension, *outAudioAtom, size);        HUnlock(extension);      } else {        // if it doesn't have an atom, that's ok        *outAudioAtom = NULL;        err = noErr;      }      DisposeHandle(extension);      DisposeHandle((Handle)sourceSoundDescription);    }  }bail:  return err;}</pre></td></tr></table></CENTER><BR><P ID=p4>A full sample application called MP3Player can be found on the <a href="../../samplecode/Sample_Code/Sound/MP3Player.htm">QuickTime Sample Code page</A>. </p><hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Sep 22 2000]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qtmcc/qtmcc15.html%3Fid%3DDTS10001958-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qtmcc/qtmcc15.html%3Fid%3DDTS10001958-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qtmcc/qtmcc15.html%3Fid%3DDTS10001958-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>