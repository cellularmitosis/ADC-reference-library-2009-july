<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Using Ink Services in Your Application: Ink Services Concepts</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Ink Services Concepts"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000843" title="Ink Services Concepts"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../EventsOtherInput-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000447" target="_top">Events &amp; Other Input</a> &gt; <a href="../ink_intro/ink_intro.html#//apple_ref/doc/uid/TP30000842-TPXREF101">Using Ink Services in Your Application</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ink_intro/ink_intro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ink_tasks/ink_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000843-TPXREF101" title="Ink Services Concepts"></a><h1>Ink Services Concepts</h1><p>Ink input is available for any application that accepts text input, as long as an Ink input device is connected to the computer and the user turns on handwriting recognition in the Ink pane of System Preferences. An application doesn’t need to perform any tasks to support Ink input. However, there may be special situations for which an application needs to use the Ink Services application programming interface (API) to provide a customized Ink-input solution. After reading this chapter, you should be able to determine whether your application needs to use the Ink Services API. </p><p>Ink has four components (shown in <span class="content_text">Figure 1-1</span>)—Ink input method, framework, server, and user preferences. The Ink input method is the component responsible for collecting Ink, drawing Ink, managing phrase termination, and posting Ink events. The Ink framework provides the application programming interface and services for the other Ink components. The Ink server manages the recognizer (including character and word segmentation), the language model used for recognition, and the Ink window that can be used for Ink input. The user preferences component manages the user settings that control the Ink recognition mode as well as a variety of options that can be set by the user. </p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJIBAEF" title="Figure 1-1Ink components"></a><p><strong>Figure 1-1&nbsp;&nbsp;</strong>Ink components</p><img src = "../art/ink_components.gif" alt = "Ink components" width="214" height="153"></div><br/><p>The remainder of this chapter provides an overview of the Ink user interface, describes how Ink technology works in Mac OS X, and discusses the concepts you need to understand the Ink Services API. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF140">Ink User Interface</a>
				
			<br/>
			
        
			
			
				<a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF125">How Ink Works in Mac OS X</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000843-TPXREF140" title="Ink User Interface"></a><h2>Ink User Interface</h2><p>Three items make up the Ink user interface: the Ink preferences pane, the Ink window, and Ink writing guides. The Ink preferences pane allows the user to turn handwriting recognition on and off. This preferences pane is only available if the computer detects an Ink input device, such as a tablet. The Ink window provides a writing area as well as controls that allow users to quickly toggle handwriting on or off and to control a number of other aspects of Ink. The Ink window is not available unless handwriting recognition is turned on. The Ink writing guides are visual aids that can help users to enter text horizontally. Each of these user interface items are described in the sections that follow. The user interface described here is available in Mac OS X version 10.3.</p><a name="//apple_ref/doc/uid/TP30000843-TPXREF141" title="Ink Preferences Pane"></a><h3>Ink Preferences Pane</h3><p>Users access the Ink preferences pane by opening System Preferences and clicking the Ink icon shown in <span class="content_text">Figure 1-2</span>. The Ink icon is visible in System Preferences in Mac OS X version 10.2 and later if there is an Ink input device attached to the computer and an appropriate device driver has been installed.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJBACBI" title="Figure 1-2The Ink icon in System Preferences "></a><p><strong>Figure 1-2&nbsp;&nbsp;</strong>The Ink icon in System Preferences </p><img src = "../art/ink_icon.gif" alt = "The Ink icon in System Preferences" width="432" height="191"></div><br/><a name="//apple_ref/doc/uid/TP30000843-TPXREF145" title="Settings"></a><h4>Settings</h4><p>A user can turn handwriting recognition on or off by clicking the appropriate radio button in the Ink preferences pane, as shown in <span class="content_text">Figure 1-3</span>. The figure also shows that Ink preferences has three panes within it—Settings, Gestures, and Word List. A user can navigate between the panes by clicking the appropriate tab.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJCABHD" title="Figure 1-3Settings in the Ink preferences pane "></a><p><strong>Figure 1-3&nbsp;&nbsp;</strong>Settings in the Ink preferences pane </p><img src = "../art/ink_pref_settings.gif" alt = "Settings in the Ink preferences pane" width="466" height="405"></div><br/><p> The options available in the Settings pane allow a user to:</p><ul class="spaceabove"><li class="li"><p>Identify handwriting style as closely or widely spaced</p></li><li class="li"><p>Specify whether to allow Ink input anywhere or to limit Ink input only to Ink-aware applications. In Mac OS version 10.2, the only Ink-aware application is the Ink window.</p></li><li class="li"><p>Choose a language (English, French, or German) for the recognizer to use</p></li><li class="li"><p>Specify whether to recognize Western European characters. Users should turn on this option if they plan to enter ligatures or characters that use diacritical marks.</p></li><li class="li"><p>Choose a font to use in the Ink window</p></li><li class="li"><p>Specify whether to show the Ink window</p></li><li class="li"><p>Specify whether to show the Ink icon in the menu bar</p></li></ul><p>A user who wants to customize Ink further can click the Options button shown in <span class="content_text">Figure 1-3</span> to:</p><ul class="spaceabove"><li class="li"><p>Set how quickly recognition begins after lifting the stylus. A <strong>stylus</strong> is the hand held instrument used to enter data on a graphics tablet. It is also called a <strong>pen</strong>.</p></li><li class="li"><p>Specify how far the stylus must move before Ink input begins</p></li><li class="li"><p>Set how long the stylus must be held still before it can be used as a mouse instead of as a pen</p></li><li class="li"><p>Specify that a phrase is terminated when the stylus moves away from the tablet</p></li><li class="li"><p>Hide the pointer that normally appears when writing</p></li><li class="li"><p>Specify to play a sound while writing</p></li></ul><a name="//apple_ref/doc/uid/TP30000843-TPXREF146" title="Gestures"></a><h4>Gestures</h4><p>Gestures are pen strokes that specify editing actions. The list of available editing actions appear when the user clicks the Gestures tabs, shown in <span class="content_text">Figure 1-4</span>. Recognition for all gestures associated with editing actions is on by default; the user can disable an action by clicking the checkbox next to the action. When a user chooses an action, the gesture associated with the action is drawn in the box to the right of the action list. A user can learn how to draw the more complex gestures (such as Select All) by watching the animated drawing of the gesture in the box. The description of the action appears below the gesture. </p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJHGJBC" title="Figure 1-4Gestures in the Ink preferences pane"></a><p><strong>Figure 1-4&nbsp;&nbsp;</strong>Gestures in the Ink preferences pane</p><img src = "../art/ink_pref_gestures.gif" alt = "Gestures in the Ink preferences pane" width="444" height="302"></div><br/><p>All gestures, except Join (which is described later), can be used in an untargeted manner. <strong>Untargeted gestures</strong> apply to the current selection, if there is one, or to the insertion point, if there is no selection. Most gestures can also be used in a targeted manner. <strong>Targeted gestures</strong> apply either to the item under a predefined hot spot or the entire gesture bounds. Not all gestures that can be targeted have a hot spot. An application can use the hot spot location (if available) and gesture bounds to determine the area to which a targeted gesture should apply.</p><p>The Gestures pane doesn’t indicate whether a gesture is targeted or not; this information is not available to users and depends, in general, on whether targeted gestures are supported or not in each application. If an application is not specifically set up to handle Ink events (that is, the application is not Ink-aware) the gesture is always treated by the system as an untargeted gesture (except for the Join gesture). An application that is Ink-aware can use the Ink Services API to obtain information about the hot spot. The application can then use that information to apply the editing action specified by the gesture to the appropriate area. See <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-BAJECEHA">“Supporting Text Editing With Ink Gestures”</a></span> for more information.</p><p>A targeted gesture can also be tentative. A <strong>tentative gesture</strong> is Ink that the system treats tentatively as a gesture until your application either confirms the Ink is indeed a gesture or informs the system the Ink is not a gesture. There is only one tentative gesture—the Join gesture, shown in <span class="content_text">Figure 1-5</span>. Note in the figure that this gesture looks similar to the letter “v.” The Join gesture can only be used in an Ink-aware application, because it is the application that must decide whether the Ink is a gesture or text.</p><p>When Ink Services receives Ink input that appears similar to that shown in <span class="content_text">Figure 1-5</span>, it has no way to determine whether the Ink input should be interpreted as the Join gesture or the letter “v.” Ink Services tentatively interprets the Ink as a gesture and passes the gesture to your application. You application must make the determination as to whether the Ink input is the Join gesture or the letter “v.” If you determine the Ink input is the Join gesture, it is up to your application to apply the gesture to the appropriate text. If you determine the Ink input is not the Join gesture, your application informs Ink Services of this by returning <code>eventNotHandledErr</code>, which in turn posts the Ink as the letter “v.” See <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-BAJECEHA">“Supporting Text Editing With Ink Gestures”</a></span> for details on how to handle the Join gesture. </p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJGEAAB" title="Figure 1-5The Join gesture is indistinguishable from the letter &acirc;&#128;&#156;v&acirc;&#128;&#157;"></a><p><strong>Figure 1-5&nbsp;&nbsp;</strong>The Join gesture is indistinguishable from the letter “v”</p><img src = "../art/join_gesture.gif" alt = "The Join gesture is indistinguishable from the letter “v”" width="482" height="409"></div><br/><p>All gestures except the Join gesture fall into the category of non-tentative gestures. Non-tentative gestures are always treated as gestures, regardless of where they are drawn because Ink Services interprets them unambiguously as gestures. </p><p><span class="content_text">Table 1-1</span> lists gestures and the categories they can fall into. Notice that some gestures can be targeted or untargeted while others are always untargeted. Join, the only tentative gesture, is always targeted.</p><a name="//apple_ref/doc/uid/TP30000843-BAJCCGDC" title="Table 1-1Gesture categories"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-1&nbsp;&nbsp;</strong>Gesture categories</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Gesture</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Targeted</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Untargeted</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Tentative</p></th></tr><tr><td  scope="row"><p>Undo</p></td><td ><p>Never</p></td><td ><p>Always</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Escape</p></td><td ><p>Never</p></td><td ><p>Always</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Select All</p></td><td ><p>Never</p></td><td ><p>Always</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Delete </p></td><td ><p>Never</p></td><td ><p>Always</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Clear</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Cut</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Copy</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Paste</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Horizontal Space </p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Tab</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Return</p></td><td ><p>Sometimes</p></td><td ><p>Sometimes</p></td><td ><p>No</p></td></tr><tr><td  scope="row"><p>Join</p></td><td ><p>Always</p></td><td ><p>Never</p></td><td ><p>Yes</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000843-TPXREF147" title="Word List"></a><h4>Word List</h4><p>Users can improve handwriting recognition, particularly for unusual words such as technical jargon, by entering words into the Word List, shown in <span class="content_text">Figure 1-6</span>. When the user clicks Add, a sheet appears that has a text field into which the use can type a word. A user can edit or delete words in the list by clicking the appropriate button.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJHGEDC" title="Figure 1-6A custom word list in the Ink preferences pane"></a><p><strong>Figure 1-6&nbsp;&nbsp;</strong>A custom word list in the Ink preferences pane</p><img src = "../art/ink_pref_words.gif" alt = "A custom word list in the Ink preferences pane" width="478" height="403"></div><br/><a name="//apple_ref/doc/uid/TP30000843-TPXREF143" title="Ink Window"></a><h3>Ink Window</h3><p>The Ink window has two areas—the Ink toolbar and the Ink pad. When a user turns on handwriting recognition in the Ink preferences pane, the Ink toolbar appears, as shown in <span class="content_text">Figure 1-7</span>. A user can use the Ink toolbar to: </p><ul class="spaceabove"><li class="li"><p>Turn recognition on or off. This is handy if the user needs to quickly switch between using the stylus to print and using it to control the pointer. </p></li><li class="li"><p>Show and hide the Ink pad </p></li><li class="li"><p>Open Ink Help</p></li><li class="li"><p>Open the Ink preferences pane</p></li><li class="li"><p>Activate Command, Shift, Option, and Control</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJBEBDF" title="Figure 1-7The Ink toolbar "></a><p><strong>Figure 1-7&nbsp;&nbsp;</strong>The Ink toolbar </p><img src = "../art/ink_bar.gif" alt = "The Ink toolbar" width="400" height="121"></div><br/><p>When the users clicks the Ink pad icon, the Ink pad appears as shown in <span class="content_text">Figure 1-8</span>. The Ink pad provides an area for users to print or sketch and then insert the printed text or drawn art into a document. A user can toggle between entering printed text and graphics by clicking the buttons in the lower-left of the Ink pad. The Clear button erases anything currently displayed while Send pastes the entered text or sketch into the insertion point of the currently active Mac OS X application.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJEIABJ" title="Figure 1-8The Ink window with the Ink pad open"></a><p><strong>Figure 1-8&nbsp;&nbsp;</strong>The Ink window with the Ink pad open</p><img src = "../art/ink_pad.gif" alt = "The Ink window with the Ink pad open" width="307" height="240"></div><br/><p>The Ink window provides a list of alternate interpretations for each unit of text (typically a word) entered by the user. The list is in the form of a menu that the user can access by placing the pointer over a word and then pressing the Control key while clicking the mouse. <span class="content_text">Figure 1-9</span> shows a contextual menu with a list of alternates. The original Ink is listed as the last item.</p><p>Menu items for a set of alternates whose first letter is an alphabetical character always include an alternate whose first letter is the opposite lettercase. Hence the second item shown in the menu in <span class="content_text">Figure 1-9</span> is Crash. Menu items for a set of alternates whose first letter is a nonalphabetical character do not include a lettercase alternate.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJDCAGA" title="Figure 1-9A menu with a list of alternate interpretations"></a><p><strong>Figure 1-9&nbsp;&nbsp;</strong>A menu with a list of alternate interpretations</p><img src = "../art/alternates1.gif" alt = "A menu with a list of alternate interpretations" width="268" height="310"></div><br/><p>When the user chooses a word from the list, Ink Services automatically reorders the menu items. The text that was first in the list moves to the second or the third position, depending upon whether the first letter is alphabetical or nonalphabetical. For example, for the list of words shown in <span class="content_text">Figure 1-9</span>, if the user chooses crush, the menu items are reordered as shown in <span class="content_text">Figure 1-10</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJDCICH" title="Figure 1-10The reordered list of alternate interpretations "></a><p><strong>Figure 1-10&nbsp;&nbsp;</strong>The reordered list of alternate interpretations </p><img src = "../art/alternates2.gif" alt = "The reordered list of alternate interpretations" width="268" height="310"></div><br/><p>Notice that the list of alternates is kept to a maximum length of five. An uppercase alternate for crush is added to the menu while the uppercase alternate Crash is dropped.</p><p>For a nonalphabetic first character, however, such as a number, the original moves to the second position. So for the following items:</p><p>1239, 1234, 1289, 1284</p><p>If the user chooses 1234, the list is reordered as follows:</p><p>1234, 1239, 1289, 1284</p><p>An application may provide support for alternate word lists using the Ink Services API. For more information, see <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-BAJEABFD">“Implementing a Correction Model.”</a></span></p><a name="//apple_ref/doc/uid/TP30000843-TPXREF144" title="Ink Writing Guides"></a><h3>Ink Writing Guides</h3><p>A user can enter pen input directly into any application that accepts text input. Ink Services automatically draws the user’s strokes as Ink, recognizes the text, and sends the recognized text to the application. All the user needs to do is position the stylus and start printing. Ink provides writing guides to facilitate text entry, as shown in <span class="content_text">Figure 1-11</span>. A user may write almost anywhere on the screen and the recognition results flow to the insertion point in the frontmost application. The only exceptions are specially designated controls and screen areas, such as the Dock, the menu bar, window title bars, and scroll bars. </p><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJCCABC" title="Figure 1-11Ink writing guides facilitate pen input into an application"></a><p><strong>Figure 1-11&nbsp;&nbsp;</strong>Ink writing guides facilitate pen input into an application</p><img src = "../art/ink_app_input2.gif" alt = "Ink writing guides facilitate pen input into an application" width="508" height="175"></div><br/><p>The Ink writing guides looks similar to a translucent piece of yellow, lined, writing paper and is positioned wherever the user writes. The user’s printed input appears in the writing guides until Ink Services applies recognition to the Ink text, at which point the Ink phrase is terminated. After the Ink text is recognized, the text appears in the application window as typed text. It is possible for an application to control whether Ink Services draws the writing guides.</p><a name="//apple_ref/doc/uid/TP30000843-TPXREF125" title="How Ink Works in Mac OS X"></a><h2>How Ink Works in Mac OS X</h2><p>The flow of Ink from stylus and tablet to an application is shown in <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-BAJHCJHA">Figure 1-12</a></span>. When the user writes a line of text using a stylus, Ink performs a series of operations, as follows:</p><ul class="ul"><li class="li"><p>Raw data from the hardware is acquired and processed by the tablet driver, which emits pen events using IOKit and Human Interface Device (HID) Manager calls. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000843-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp;A <strong>pen event</strong> is a shorthand convention for referring to a mouse event that contains tablet data.</p></div></li><li class="li"><p>Pen events are passed to the Core Graphics layer. Unlike ordinary mouse events, pen events are usually routed to the frontmost application, even if the event occurred somewhere other than in that application’s windows. This allows the user to write anywhere on the screen. The exception to this occurs when pen events are located within certain “instant mousing” areas, such as window title bars, scroll bars, the Dock, and the main Menu Bar. </p><p>An <strong>instant-mousing area</strong> defines an area in which stylus input is interpreted as mouse input; the system “instantly” interprets the stylus as a mouse in these special places and Ink is not generated. For any other location, a user can signal Ink to interpret stylus input as mouse input by pressing and holding the stylus still briefly. It not possible for a user to start Ink input with the stylus placed over an instant-mousing area.</p></li><li class="li"><p>Pen events (mouse plus tablet data) are then passed to Ink Services, where the various components (see <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-BAJIBAEF">Figure 1-1</a></span>) perform the tasks listed in the Ink Input Method box shown in <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-BAJHCJHA">Figure 1-12</a></span>. </p></li><li class="li"><p>The input method component of Ink Services accumulates pen events into strokes and phrases.</p><p><strong>Strokes</strong> are collections of points (onscreen locations), spanning the time from which the pen is pressed to the tablet hard enough to generate a mouse-down event until the time at which the pen is lifted from the tablet enough to generate a mouse-up event, and corresponds to the common concept of strokes one might write with paper and pencil.</p><p><strong>Phrases</strong> are collections of strokes, spanning the time from when the first stroke is started to the time at which the phrase is terminated due to one of several common events—a timeout following a pen lift (but staying in proximity), a lift that takes the stylus out of tablet proximity (the limited range over which the tablet can sense the stylus), a recognizer-generated break (due to the user introducing an extra large horizontal space or beginning a new line), or a direct request by the application to terminate the phrase. An Ink phrase can represent a letter, word, or longer unit.</p></li><li class="li"><p>The Ink server hosts the recognizer which processes accumulated phrases. Ink Services is set up by default to recognize both text and editing gestures. See <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF127">“The Ink Recognizer”</a></span> for more information on how the recognizer works.</p><p>If a user toggles the write-anywhere mode off, then pen events are ignored by Ink Services, everywhere except in ink-aware applications. These points are not drawn by Ink Services nor interpreted by the recognizer unless the application calls the Ink Services function <code><a href="../../../Reference/ink_services_ref/Reference/reference.html#//apple_ref/doc/c_ref/InkSetApplicationWritingMode" target="_top">InkSetApplicationWritingMode</a></code> with the <code>iWhere</code> parameter set to <code>kInkWriteAnywhereInApp</code>. As long as Ink is turned on, Ink will always be drawn and recognized if the user writes directly into the Ink pad in the Ink window. Similarly, as long as Ink is turned on, Ink drawing and recognition services will always be provided for your ink-aware application once you enable them by calling <code><a href="../../../Reference/ink_services_ref/Reference/reference.html#//apple_ref/doc/c_ref/InkSetApplicationWritingMode" target="_top">InkSetApplicationWritingMode</a></code>, regardless of the user's write-anywhere preference setting.</p></li><li class="li"><p>When the Ink input is recognized, Ink Services generates one or more Carbon events of class <code>kEventClassInk</code> and the appropriate event kind <code>kEventInkText</code> or <code>kEventInkGesture</code>. Your application can obtain the data it requires to accomplish its goals by installing appropriate handlers for Ink-related Carbon events. When your application is the active application (that is, the one that has keyboard focus) it can receive the Carbon events, extract the relevant event parameters, and process the data accordingly. If your application does not handle the events, then Ink Services handles them. </p><p>For more details, see <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF121">“Ink-Related Carbon Events.”</a></span></p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP30000843-BAJHCJHA" title="Figure 1-12The flow of Ink from stylus to application"></a><p><strong>Figure 1-12&nbsp;&nbsp;</strong>The flow of Ink from stylus to application</p><img src = "../art/ink_data_flow.gif" alt = "The flow of Ink from stylus to application" width="521" height="247"></div><br/><a name="//apple_ref/doc/uid/TP30000843-TPXREF127" title="The Ink Recognizer"></a><h3>The Ink Recognizer</h3><p>The Ink recognizer is at the heart of Ink Services. It is the algorithmic component of Ink Services that identifies written text and gestures. Built using neural-network technology, the architecture of the recognizer integrates multiple representations of the input data. This design, combined with the training regimen used to build the recognizer, provides robust, accurate character recognition despite individual differences in the writing styles of users.</p><p>Three outcomes are possible from the Ink recognizer. The first two outcomes are the ones you are likely to see; the third is a rare event.</p><ul class="spaceabove"><li class="li"><p>The Ink input is recognized as a gesture.</p><p>When the recognizer determines with a high confidence level that the Ink input is a gesture, Ink Services generates a gesture event. </p><p>Recall that Ink input in the form of the standalone letter “v” is tentatively treated as a gesture. If your application determines the Ink input is not the Join gesture, not handling the gesture (returning <code>eventNotHandledErr</code>) notifies Ink Services that the Ink input should be interpreted as text by the recognizer. See <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF146">“Gestures”</a></span> for more information.</p></li><li class="li"><p>The Ink input is recognized as text.</p><p>The recognizer ranks text interpretations according to a confidence level. Up to five interpretations are returned to an application through the Ink text event (in the <code>InkTextRef</code> parameter). If the Ink text event is not handled by the application, then for compatibility with non-ink-aware applications, only the top-choice, highest confidence interpretation is returned in a <code>kEventTextInputUnicodeForKeyEvent</code> event. If that event is not handled, then the text is returned to the application receiving the input as raw <code>keyDown</code> events.</p><p>Using the Ink Services API, your application can obtain a list of interpretations, in ranked order, from the recognizer, and then use the list to implement a correction model. For more information, see <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-BAJEABFD">“Implementing a Correction Model.”</a></span></p></li><li class="li"><p>The Ink input is not recognized.</p><p>In the rare case that handwritten input cannot be recognized, the recognition system returns a diamond character that indicates the text is not recognized. </p><p>However, in the event of misrecognition it is more often the case that the Ink input is recognized as text, but that the text has no meaning to the user. For example, the Ink input shown in <span class="content_text">Figure 1-13</span> would be recognized as “54M^ NG” or some other meaningless text. With a little practice most users improve their printed input to achieve a high recognition rate. </p><p>Note that the Ink input shown in the <span class="content_text">Figure 1-13</span> is script, not print. The recognizer is optimized for printed text.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000843-BAJBBDAG" title="Figure 1-13Ink input that is difficult to recognize"></a><p><strong>Figure 1-13&nbsp;&nbsp;</strong>Ink input that is difficult to recognize</p><img src = "../art/sloppy_ink.gif" alt = "Ink input that is difficult to recognize" width="321" height="268"></div></li></ul><a name="//apple_ref/doc/uid/TP30000843-TPXREF121" title="Ink-Related Carbon Events"></a><h3>Ink-Related Carbon Events</h3><p>Ink Services notifies your application of Ink-related events by generating Carbon events. The events listed in <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-BAJFDEFI">Table 1-2</a></span> are generated by the system, in the order listed, until an event in the chain is handled by an event handler provided by your application. Once your application handles one of these events (by returning any result other than the result code <code>eventNotHandledErr</code>), the chain is terminated and no further events are generated by Ink Services for that data.</p><a name="//apple_ref/doc/uid/TP30000843-BAJFDEFI" title="Table 1-2Carbon events generated by Ink input"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-2&nbsp;&nbsp;</strong>Carbon events generated by Ink input</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Event category </p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Carbon event</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>The event is received by your application ...</p></th></tr><tr><td  scope="row"><p>pen</p></td><td ><p><code>kEventMouseDown</code><code>kEventMouseDragged</code></p></td><td ><p>along with tablet coordinates and a pressure value, only when recognition is disabled.</p></td></tr><tr><td  scope="row"><p>instant mousing</p></td><td ><p><code>kEventAppIsEventInInstantMouser</code></p></td><td ><p>only at the start of a phrase.</p></td></tr><tr><td  scope="row"><p>Ink point</p></td><td ><p><code>kEventInkPoint</code></p></td><td ><p>during a phrase.</p></td></tr><tr><td  scope="row"><p>gesture</p></td><td ><p><code>kEventInkGesture</code></p></td><td ><p>only when a gesture is recognized.</p></td></tr><tr><td  scope="row"><p>text</p></td><td ><p><code>kEventInkText</code></p></td><td ><p>when text is recognized.</p></td></tr><tr><td  scope="row"><p>Unicode text</p></td><td ><p><code>kEventTextInputUnicodeForKeyEvent</code></p></td><td ><p>when Unicode text is recognized and when <code>kEventInkText</code> is not handled.</p></td></tr><tr><td  scope="row"><p>key</p></td><td ><p><code>kEventRawKeyDown</code></p></td><td ><p>when text is recognized and the previous events are not handled.</p></td></tr></table></div><p>The Ink-specific events most important to any application that uses Ink Services—instant mousing, Ink point, Ink gesture, Ink text —are described in the sections that follow. For more information, see <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-TPXREF144">“Obtaining Parameters from Ink Text and Gesture Events.”</a></span> </p><a name="//apple_ref/doc/uid/TP30000843-TPXREF148" title="Instant Mousing Events"></a><h4>Instant Mousing Events</h4><p>The event <code>kEventAppIsEventInInstantMouser</code> is dispatched only when the stylus is initially pressed to a tablet and before Ink Services determines whether the user is writing or not. Instant mousing areas are those areas where you do not want the tablet to start Inking. Once the user begins to write, Ink input does not generate instant-mousing events until the current phrase is terminated.</p><p>Instant mousing in standard Carbon and Cocoa controls, drag regions, and so forth is handled for you automatically. If your application implements its own custom controls that you want to be treated as instant mousing areas, it must provide a handler for this event. The handler must check the location of the pen event and return <code>noErr</code> if the pen's location is in a custom instant mousing region, which will force the pen to behave as a mouse. Your handler should return <code>eventNotHandledErr</code> outside the custom mousing regions, to allow the user to commence writing in most locations. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000843-SW2" title="Note"></a><p><strong>Note:</strong>&nbsp;Cocoa applications can implement the <code>NSResponder</code> method <code>shouldBeTreatedAsInkEvent</code> for these purposes. This method returns <code>YES</code> if <code>theEvent</code> should be treated as an Ink event, <code>NO</code> if <code>theEvent</code> should be treated as a mouse event. This provides the ability to distinguish when a pen-down should start an Ink input event versus when a pen-down should be treated as a mouse down event. This allows for both a write-anywhere model for pen-based input and arbitrary application-defined instant-mousing regions.  Note the inverse semantics from the Carbon event. </p></div><a name="//apple_ref/doc/uid/TP30000843-TPXREF149" title="Ink Point Events"></a><h4>Ink Point Events</h4><p>Ink Services sends an Ink point event (<code>kEventInkPoint</code>) whenever it detects a pen event at the start of or within a phrase (that is, whenever the user is actually entering Ink and not mousing). If the Ink point event is not handled by your application, Ink Services continues to handle the event through the normal recognition path. If the Ink point event is handled by your application, Ink Services drops the current mouse event from further recognition handling. This allows your application to treat certain areas of a window as special, non-inking areas, and provides the option for your application to terminate the Ink input session. It also allows your application to draw its own Ink, while letting Ink Services manage the inking-versus-mousing decision, and even carry out normal recognition services (if your event handler returns <code>eventNotHandledErr</code>). </p><p>If your application chooses to handle Ink point events, be aware that you can receive mouse events that lie outside your application’s windows. For example, if your application draws its own Ink, it could continue to track the Ink points past the visible bounds of the window, making the out-of-bounds Ink visible if the user scrolls to look at it. Or your application could provide a separate Ink-background window for Ink input for the out-of-bounds Ink, similar to the Ink writing guides provided by Ink Services.</p><a name="//apple_ref/doc/uid/TP30000843-BAJBHIAE" title="Ink Gesture Events"></a><h4>Ink Gesture Events</h4><p>Ink Services dispatches an Ink gesture event (<code>kEventInkGesture</code>) only if the Ink is recognized as a gesture with a high degree of confidence. All gestures except the Join gesture can be interpreted unambiguously as a gesture. So for most gestures, whether your application handles a gesture event or not, the event chain is terminated at that point—either your application handles the gesture or it returns <code>eventNotHandledErr</code> and Ink Services handles the gesture. However, if the Join gesture (which must be targeted) is not handled by your application, Ink Services performs text recognition on the Ink and posts it as the letter “v.”</p><p>If an application does not handle the gesture, then Ink Services posts the command event (<code>HICommand</code>) associated with the editing action specified by the gesture. If a command event isn’t defined for the gesture, as in the case of the Escape, Delete, Tab, Horizontal Space, and Return, then Ink Services posts the keyboard equivalent for the gesture. For these gestures, this is simply the key event associated with the gesture (Escape, Delete, Tab, Space, and Return key presses).</p><p>Recall that the Join gesture, which is a tentative gesture, must be handled by the application, otherwise Ink Services treats it as the letter “v.” (There is no command event or keyboard equivalent fallback.) As such, the Join gesture is only available in an Ink-aware application. See <span class="content_text"><a href="ink_concepts.html#//apple_ref/doc/uid/TP30000843-TPXREF146">“Gestures”</a></span> for more information.</p><a name="//apple_ref/doc/uid/TP30000843-TPXREF150" title="Ink Text Events"></a><h4>Ink Text Events</h4><p>The Ink text event (<code>kEventInkText</code>) is sent when Ink Services recognizes Ink input as text. In Roman languages the Ink text event typically corresponds to an individual word. It contains the original raw Ink and the recognized text and typically includes a list of alternate interpretations that your application can show should you want to provide an easy-to-use correction model. (See <span class="content_text"><a href="../ink_tasks/ink_tasks.html#//apple_ref/doc/uid/TP30000844-BAJEABFD">“Implementing a Correction Model”</a></span> for details.)</p><p>The parameters associated with an Ink text event are <code>kEventParamInkTextRef</code> and <code>kEventParamInkTextKeyboardShortcut</code>. The parameter <code>kEventParamInkTextRef</code> is a reference to an opaque Ink text object (<code>InkTextRef</code>). An <strong>Ink text object</strong> contains data that describes the recognized text. You can’t access the object directly, but you can use a variety of Ink Services functions to obtain data from the object.</p><p>The parameter <code>kEventParamInkTextKeyboardShortcut</code> is a Boolean value that indicates whether the Ink text is likely a keyboard equivalent. The value is <code>true</code> if the Command or Control key is pressed and the top-choice alternate text is a single character. Checking for this parameter provides an easy way for you to determine if the text associated with an <code>InkTextRef</code> is likely to be a keyboard equivalent instead of text. Otherwise, to determine whether the Ink text is a keyboard equivalent, you would need to extract the <code>kEventParamInkTextRef</code> parameter, retrieve the <code>CFStringRef</code> for the text, determine the length of the string, and then check for modifier keys. In most cases, you don’t need to handle an Ink text event that is a keyboard equivalent, and can immediately return <code>eventNotHandledErr</code>. </p><p>If the Ink text event is not a keyboard equivalent and you do not handle the event, Ink Services posts a <code>kEventTextInputUnicodeForKeyEvent</code> event. If that goes unhandled, Ink Services posts a sequence of raw <code>keyDown</code> events corresponding to the top-choice recognition result.</p><a name="//apple_ref/doc/uid/TP30000843-TPXREF151" title="Mouse Event Coalescing"></a><h3>Mouse Event Coalescing</h3><p>Mouse events, whether generated by a mouse and mouse driver or by a graphics tablet and tablet driver, have the potential of being posted at a faster rate than the system can handle. For example, if an application redraws a window for each <code>mouseDragged</code> event generated when a user drags a window, the window could move slowly or lag behind the pointer. To avoid slowing down the application, the Carbon Event Manager coalesces mouse events instead of placing all the mouse events in a queue. <strong>Mouse event coalescing</strong> is a process that merges <code>mouseMoved</code> and <code>mouseDragged</code> events by checking to see if one of these events exists in the event queue, and if it does, replacing the previously queued event with the more recently-generated event. Note that <code>mouseUp</code> and <code>mouseDown</code> events are never coalesced, as they are semantically meaningful.</p><p>Since Ink is accumulated predominantly through <code>mouseDragged</code> events (that have tablet data associated with them), event coalescing can reduce the fidelity of the data used to draw Ink input and to perform handwriting recognition. Reduced fidelity can produce Ink that appears faceted instead of smooth, and can reduce recognition accuracy.</p><p>To avoid fidelity problems, Ink Services temporarily disables event coalescing when a stylus enters proximity of the graphics tablet. Thus Ink data is guaranteed to be smooth, for both rendering and recognition purposes. When the stylus leaves the proximity of the tablet, or when the stylus is pressed down in an instant-mousing region, event coalescing is enabled again. Thus coalescing is active, as usual, during window drags and normal mouse activity.</p><p>If your application calls the function <code><a href="../../../Reference/ink_services_ref/Reference/reference.html#//apple_ref/doc/c_ref/InkSetApplicationWritingMode" target="_top">InkSetApplicationWritingMode</a></code> to disable Ink Services management of pen events so that your application can accumulate Ink data on its own, your application may need to manage event coalescing. Otherwise, Ink rendering and recognition may suffer from fidelity problems. You can use the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/SetMouseCoalescingEnabled" target="_top">SetMouseCoalescingEnabled</a></code> to manage event coalescing in your application. Make sure that you disable event coalescing only when absolutely necessary. See <em>Carbon Event Manager Reference</em> for more information on event coalescing.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ink_intro/ink_intro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ink_tasks/ink_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-07-24<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/using_ink/ink_concepts/ink_concepts.html%3Fid%3DTP40000959-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/using_ink/ink_concepts/ink_concepts.html%3Fid%3DTP40000959-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/using_ink/ink_concepts/ink_concepts.html%3Fid%3DTP40000959-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>