<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><link rel="Stylesheet" href="../../adcstyle.css" type="text/css"><title>Technical Note TN2038: Movie Data Security</title><meta name="keywords" content=""><meta name="Description" content="Technical Note TN2038: This technote describes techniquesyou can use to protect data in QuickTime movies."><meta name="categories" content="QuickTime"><meta name="week-posted" content="Dec 10, 2001 - Dec 14, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003073" title="Movie Data Security"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalnotes/QuickTime/idxCompressionDecompression-date.html">Compression & Decompression</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2038</div>
<div id="pageheadsub">Movie Data Security</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">                  <A HREF="#Section1">Overview</A><BR><BR>                  <A HREF="#Section2">The No Save User Data Item</A><BR><BR>                  <A HREF="#Section3">Compressed Movie Resources</A><BR><BR>                 <A HREF="#Section4"> QuickTime Access Keys</A><BR><BR>                 <A HREF="#Section5">Custom Data Structures</A><BR><BR>                 <A HREF="#Section6">Custom Codec or Data Handler</A><BR><BR>                 <A HREF="#Summary">Summary</A><BR><BR>               <A HREF="#References">References</A><BR>                  <BR>                                    <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This technote describes techniques you can use to protect data in QuickTime movies.</P>              <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Dec 13 2001]</h3><!-- end_date -->                </td>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->          <P><A NAME=Section1></A></P>                  <H2>Overview</H2><p>Developers will often find it necessary to safeguard data in movie files. Such safeguards could involve password protecting the data or various other schemes. QuickTime provides a number of techniques for protecting movie data, including  password protection, and the ability to prevent users from altering movie data or saving it to another file. Listed below is a discussion of these and other techniques for protecting movie data.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="Section2"></a><h2>The No Save User Data Item</h2><p>You can add a No Save user data item (type 'nsav') to your movies to prevent them from being edited or re-saved within the QuickTime environment. The No Save user data item was introduced with QuickTime 4. Once this user data item has been added to a movie, any attempts at using Movie Toolbox editing functions (<code>CutMovieSelection</code>, etc.) will fail. Furthermore, Movie Toolbox functions that attempt to save the movie (<code>UpdateMovieResource</code>, etc.) will fail. Here's a brief overview of this user data item:</p></td></tr></table></center><center><table width=600>	<tr>		<td align="left" scope="row">Type</td> <td align="left">Data Size</td> <td align="left">Data Description</td></tr>		<TR><td align="left">'nsav'</td>	 		<td align="left">4 bytes</td>		<td align="left">Indicates whether editing or saving of a movie file is possible. A data value of 1 means no saves or edits are allowed. A value of 0 means saves and edits are allowed.</td>		</tr></table></center><center><Table width=600><TR><td align="left"><p>Adding this item to a movie should prevent all but hard-core QuickTime hackers from editing or re-saving movies. However, the No Save user data item is a first level of defense, and a statement of intent to users. Hackers could remove this user data item from a movie and thus allow the movie to be edited or re-saved. If you need more security than this, you'll want to explore some of the other options discussed below.</p>  <P align=center>&nbsp;<B>Listing 1</B>. A short code snippet showing how to add the No Save user data item to a movie:</P></td></tr></table></center><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=470><TR><td bgcolor="#E6E6E6" align=left><pre>enum{     kUserDataNSAV  =     FOUR_CHAR_CODE('nsav')};enum{    kNoSavesOrEditsAllowed    =    1    /* no saves or edits allowed */};OSErr PutFile (ConstStr255Param thePrompt, ConstStr255Param theFileName,FSSpecPtr theFSSpecPtr, Boolean *theIsSelected,Boolean *theIsReplacing){    StandardFileReply    myReply;    OSErr            myErr = noErr;    if ((theFSSpecPtr == NULL) || (theIsSelected == NULL) ||         (theIsReplacing == NULL))         return(paramErr);    // assume we are not replacing an existing file    *theIsReplacing = false;    StandardPutFile(thePrompt, theFileName, &amp;myReply);    *theFSSpecPtr = myReply.sfFile;    *theIsSelected = myReply.sfGood;    if (myReply.sfGood)        *theIsReplacing = myReply.sfReplacing;    return(myErr);}OSErr Add_NSAV_Item(    Movie     theMovie,                    short    theRefNum,                    short    theResID                     ){    OSErr        err = noErr;    UserData        theUserData;    long            nsavData;    Handle        ourNSAVdataH = NULL;    /* get the movie's user data list */    theUserData = GetMovieUserData(theMovie);    if (theUserData == NULL)        return (GetMoviesError());    /* specify the actual data for this user item */    nsavData = kNoSavesOrEditsAllowed;    PtrToHand(&amp;nsavData, &amp;ourNSAVdataH, 4);    if (ourNSAVdataH == NULL)        return (MemError());    /* add the No Save item to the user data list */    AddUserData (theUserData, ourNSAVdataH, kUserDataNSAV);    err = GetMoviesError();    if (err == noErr)    {        FSSpec        myFile;        Boolean        myIsSelected = false;        Boolean        myIsReplacing = false;        Str255         myPrompt = "\pSave new movie:";        Str255         myFileName = "\pNewMovie.mov";        /* prompt the user for a new movie save file */        PutFile(myPrompt, myFileName, &amp;myFile, &amp;myIsSelected, &amp;myIsReplacing);        if (myIsSelected)        {        /* create a new movie file containing our No Save user            data item - we'll also compress the movie resource            to make it more difficult for hackers to remove this            user data item */            FlattenMovieData(theMovie,     flattenAddMovieToDataFork | flattenForceMovieResourceBeforeMovieData     | flattenCompressMovieResource,     &amp;myFile, FOUR_CHAR_CODE('TVOD'),     smSystemScript, createMovieFileDeleteCurFile);            err = GetMoviesError();        }    }    DisposeHandle(ourNSAVdataH);    return err;}</pre>	</TD></TR><TR>	<td align="left"><P><B>Listing 1.</B>  Adding a No Save user data item.</P>	</TD>	</TR></TABLE></center>						<CENTER>	<TABLE width=600>			<TR><td align="left">	<P><A HREF="#top">Back to top</A></P>	<BR><BR>			<a name="Section3"></a><h2>Compressed Movie Resources</h2><p>All QuickTime movies have a movie header describing the type and location of their media data. Media data can, of course, be compressed using a variety of video and sound compression algorithms. Beginning with QuickTime 3, it also became possible to compress the movie header - more commonly known as the movie resource.</p><p>Notice the code in Listing 1 makes use of the <code>flattenCompressMovieResource</code> flag when calling the <code>FlattenMovieData</code> function to save the movie file. Specifying the <code>flattenCompressMovieResource</code> flag will compress the movie resource of the new movie (this flag can be used with the <code>FlattenMovie</code> function as well). Compressing the movie resource will make it a bit more difficult for hackers to remove this user data item from the movie. </p><p>Most application developers won't need to know the details of how movie resources are compressed. For information on how to compress the movie resource without using the FlattenMovie and FlattenMovieData functions, see <a href="http://developer.apple.com/quicktime/icefloe/dispatch012.html">Letters From The Ice Floe #12 "Compressed Movie Resources" </a>). Using the techniques described in this Ice Floe note it is possible to compress a movie resource in-place, without writing another copy of the file (as long as the compressed movie resource is really smaller than the uncompressed one).</p><p>Note it is also possible to encrypt the movie resource for your movie with a custom encryption scheme. For example a custom data compressor component could be used to provide the custom encryption. Again, refer to Ice Floe Note #12 for the details. Your custom component could also make use of the QuickTime access keys as described below.</p><p>After applying a custom encryption scheme to your movie atom it is also possible to use the QuickTime <code>NewMovieFromUserProc</code> function and a custom decrypting data procedure to open and view the movie.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="Section4"></a><h2>QuickTime Access Keys</h2><p>QuickTime access keys (also referred to as "media keys") make it possible to protect data. QuickTime access keys were introduced with QuickTime 3. The QuickTime access keys allow an application that supplies data to register a password for the data with QuickTime and allows a user to enter the password to gain access to the data. For example, a codec can protect data it compresses with a password, so that it is available only to someone with the password. Similarly, the creator of a movie can require a password to view the movie. In order to gain access to protected data, the user enters the access key in the QuickTime Settings control panel.</p><p>There are actually two kinds of access keys:</p><ul type="disc">	<li>system access keys<BR><BR></li>	<li>application access keys<BR><BR></li></ul><p>Data protected by a system access key can be unlocked by any QuickTime caller on the computer. Data protected by an application access key can be unlocked only by QuickTime clients for that application.</p><p>System access keys are useful for data that needs to be used by more than one application. When a system access key is registered for data, applications do not have to perform any additional registration to unlock the data. In contrast, application access keys are normally registered by the application in which the data is available, and each application registers the application access keys it uses.</p><p>Certain compression formats, such as the Intel Indeo and Sorenson Vision 3 formats for video compression, allow data to be encrypted when it is compressed. For software to gain access to the encrypted data, the access key for the data must be registered with QuickTime. For example, a CD-ROM title could register one or more access keys for encrypted video data it presents. Once the access keys are registered, the keys are available to the decompressor component that will be used to decompress the data. The CD-ROM title can then use the encrypted data in the same way it uses unencrypted data.</p><p>Sorenson Vision 2 video compression also makes use of the QuickTime access keys to protect data, but it does not actually encrypt the data.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="Section5"></a><h2>Custom Data Structures</h2><p>If you don't want "casual" users to be able to open movies stored in your application you could hide them in a custom data structure. That way, they would not be easily identifiable (by simple browsing) and thus not easily opened by a user. However, keep in mind if you alter the movie atom for a movie after the movie has been saved this might prevent the movie from correctly locating the movie sample data. Check the <a href="../../documentation/quicktime/qtdevdocs/RM/PDF.htm">QuickTime File Format pdf document</a>) for more information regarding the various movie atoms.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="Section6"></a><h2>Custom Codec or Data Handler</h2><p>Finally, one could write a custom codec or data handler. Access to proprietary data in a movie file encrypted with a custom codec would of course require the codec for decryption.  Check the <a href="../../documentation/quicktime/qtdevdocs/RM/rmCodecComp.htm">QuickTime API documentation</a> for more information about writing image compressor components.</p><p>Similarly, a custom decrypting data handler could be used to perform decryption of movie data, though the manner in which data handlers receive data may preclude some encryption techniques (cipher block chaining might be a challenge, for example). Check the <a href="../../documentation/quicktime/qtdevdocs/RM/rmDataHandlerComp.htm">QuickTime data handler documentation</a>) for additional information.</p><p>Also, keep in mind writing a custom data handler or a custom codec capable of keeping up with cutting-edge media is a major undertaking.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="Summary"></a><h2>Summary</h2><p>There are a number of techniques you can use to protect movie data. However, a critical issue one needs to resolve when formulating a protection scheme is this - what level of security is necessary to protect the data?  Any protection can be broken by someone determined enough - but each of the above techniques would present a certain degree of challenge.</p><p>Also, one final consideration worth noting is how much the chosen technique will inconvenience and put-off legitimate viewers of your content. Users may become frustrated with elaborate security techniques, and could end up not using your product as a result.</p><P><A HREF="#top">Back to top</A></P><BR><BR><a name="References"></a><h2>References</h2><p><a href="../../documentation/quicktime/qtdevdocs/RM/rmMTAccessKeys.htm">Movie Toolbox Access Keys</a></p><p><a href="../../documentation/quicktime/qtdevdocs/PDF/QTFileFormat.pdf">QuickTime File Format</a></p><p><a href="http://developer.apple.com/quicktime/icefloe/dispatch012.html">Letters From The Ice Floe #12 "Compressed Movie Resources"</a></p><p><a href="../../documentation/quicktime/qtdevdocs/RM/rmCodecComp.htm">Image Compressor Components</a></p><p><a href="../../documentation/quicktime/qtdevdocs/RM/rmDataHandlerComp.htm">QuickTime Data Handler Components</a></p> <P><A HREF="#top">Back to top</A></P>         <BR><BR>                           <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P align=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>              </td>               <td align="left">                  <P>Acrobat version of this Note (K)</P>               </td>               <td width=60 align=left>                  <P><A HREF="pdf/tn2038.pdf">Download</A></P>               </td>            </TR>         </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P>         <BR><BR></td></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2038.html%3Fid%3DDTS10003073-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2038.html%3Fid%3DDTS10003073-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2038.html%3Fid%3DDTS10003073-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>