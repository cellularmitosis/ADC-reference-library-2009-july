<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PixelToChar(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING172></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-171.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-173.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-126.html"><B>Chapter 3 - QuickDraw Text</B></A> / <A HREF="Text-143.html"><B>QuickDraw Text Reference</B></A><BR><DL><DD><A HREF="Text-147.html"><B>Routines</B></A> / <A HREF="Text-171.html"><B>Determining the Caret Position, and Selecting and Highlighting Text</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING172-0></A>
<H3><A NAME=MARKER-9-350></A>PixelToChar</H3>
 The<A NAME=MARKER-9-42></A> <CODE>PixelToChar</CODE> function returns the byte offset of a character in a style run, or part of a style run, whose onscreen glyph is nearest the place where the user clicked the mouse.<P>
<PRE>
FUNCTION PixelToChar (textBuf: Ptr; textLen: LongInt; 
                      slop: Fixed; pixelWidth: Fixed; 
                      VAR leadingEdge: Boolean; 
                      VAR widthRemaining: Fixed;
                      styleRunPosition: JustStyleCode; 
                      numer: Point; denom: Point): Integer;
</PRE>
<DL>
<DT><CODE>textBuf</CODE>
<DD> A pointer to the start of the text segment.
<DT><CODE>textLen</CODE>
<DD> The length in bytes of the entire text segment pointed to by <CODE>textBuf</CODE>. The <CODE>PixelToChar</CODE> function requires the context of the complete text segment in order to determine the correct value.
<DT><CODE>slop</CODE>
<DD> The amount of slop for the text to be drawn. A positive value extends the text segment; a negative value condenses the text segment.
<DT><CODE>pixelWidth</CODE>
<DD> The screen location of the glyph associated with the character whose byte offset is to be returned. The screen location is measured in pixels beginning from the left edge of the text segment for which you <BR>call <CODE>PixelToChar</CODE>.
<DT><CODE>leadingEdge</CODE>
<DD> <A NAME=MARKER-2-232></A>A Boolean flag that, upon completion of the call, is set to <CODE>TRUE</CODE> if the pixel location is on the leading edge of the glyph, and <CODE>FALSE</CODE> if the pixel location is on the trailing edge of the glyph. The leading edge is the left side if the direction of the character that the glyph represents is left-to-right (such as a Roman character), and the right side if the character direction is right-to-left (such as an Arabic or a Hebrew letter).
<DT><CODE>widthRemaining</CODE>
<DD> Upon completion of the call, contains -1 if the pixel location (specified by the <CODE>pixelWidth</CODE> parameter) falls within the style run (represented by the <CODE>textLen</CODE> bytes starting at <CODE>textBuf</CODE>). Otherwise, contains the amount of pixels by which the input pixel location (<CODE>pixelWidth</CODE>) extends beyond the right edge of the text for which you called <CODE>PixelToChar</CODE>.
<DT><CODE>styleRunPosition</CODE>
<DD> The position on the line of this style run. The style run can be the only one on the line, the leftmost on the line, the rightmost on the line, or one between two other style runs.
<DT><CODE>numer</CODE>
<DD> A point giving the numerator for the horizontal and vertical <BR>scaling factors.
<DT><CODE>denom</CODE>
<DD> A point giving the denominator for the horizontal and vertical <BR>scaling factors.
</DL>
<A NAME=HEADING172-12></A>
<H5>DESCRIPTION</H5>
 You can use the information that <CODE>PixelToChar</CODE> returns for highlighting, word selection, and identifying the caret position. The <CODE>PixelToChar</CODE> function returns a byte offset and a Boolean value that describes whether the pixel location is on the leading edge or trailing edge of the glyph where the mouse-down event occurred. When the pixel location falls on a glyph that corresponds to one or more characters that are part of the text segment, the <CODE>PixelToChar</CODE> function uses the direction of the character or characters to determine which side of the glyph is the leading edge. (A glyph can represent more than one character, for example, for a ligature. Generally, if a glyph represents more than one character, all of the characters have the same text direction.)<P>
 If the pixel location is on the leading edge, <CODE>PixelToChar</CODE> returns the byte offset <BR>of the character whose glyph is at the pixel location. (If the glyph represents multiple characters, it returns the byte offset of the first of these characters in memory.) If the pixel location is on the trailing edge, <CODE>PixelToChar</CODE> returns the byte offset of the first character in memory <I>following</I> the character or characters represented by the glyph. If the pixel location is on the trailing edge of the glyph that corresponds to the last character <BR>in the text segment, <CODE>PixelToChar</CODE> returns a byte offset equal to the length of the <BR>text segment.<P>
 When the pixel location is <I>before</I> the leading edge of the first glyph in the displayed text segment, <CODE>PixelToChar</CODE> returns a leading edge value of <CODE>FALSE</CODE> and the byte offset of the first character. When the pixel location is <I>after</I> the trailing edge of the last glyph in the displayed text segment, <CODE>PixelToChar</CODE> returns a leading edge value of <CODE>TRUE</CODE> and the next byte offset in memory, the one after the last character in the text segment. If the primary line direction is left to right, <I>before</I> means to the left of all of the glyphs for the characters in the text segment, and <I>after</I> means to the right of all these glyphs. If the primary line direction is right to left, before and after hold the opposite meanings.<P>
 You also use the value of the <CODE>leadingEdge</CODE> flag to help determine the value of the <CODE>direction</CODE> parameter to pass to <CODE>CharToPixel</CODE>, which you call to get the caret position. If the <CODE>leadingEdge</CODE> flag is <CODE>FALSE</CODE>, you base the value of the <CODE>direction</CODE> parameter on the direction of the character at the byte offset in memory that precedes the one that <CODE>PixelToChar</CODE> returns; if <CODE>leadingEdge</CODE> is <CODE>TRUE</CODE>, you base the value of the <CODE>direction</CODE> parameter on the direction of the character at the byte offset that <CODE>PixelToChar</CODE> returns. If there isn't a character at the byte offset, you base the value of the <CODE>direction</CODE> parameter on the primary line direction as determined by the <CODE>SysDirection</CODE> <BR>global variable.<P>
 You specify a value for <CODE>textLe</CODE>n that is equal to the entire visible part of the style run on a line and includes trailing spaces if and only if they are displayed. They may not be displayed, for example, for the last style run in memory order that is part of the <BR>current line.<P>
 For more information about the scaling factors, see <A HREF=Text-147.html#MARKER-9-256>"The numer and denom Parameters" on page 3-64</A>. See <A HREF=Text-147.html#MARKER-9-255>"The styleRunPosition Parameter" on page 3-63</A> for a description of the <CODE>styleRunPosition</CODE> parameter and the values it takes. See <A HREF=Text-147.html#MARKER-9-254>"The slop Parameter" on page 3-63</A> for more information about the <CODE>slop</CODE> parameter.<P>
<DL>
<DT><B>Note</B>
<DD>Be sure to pass the same values for <CODE>styleRunPosition</CODE> and the scaling factors (<CODE>numer</CODE> and <CODE>denom</CODE>) to <CODE>PixelToChar</CODE> that you pass to any of the other justification routines for this style run.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 You pass <CODE>PixelToChar</CODE> a pointer to the byte offset of the character in the text buffer that begins the text segment or style run containing the character whose glyph is at the pixel location. If you do not know which style run on the display line contains the character whose glyph is at the pixel location, you can loop through the style runs until you find the one that contains the pixel location. If the style run contains the character, <CODE>PixelToChar</CODE> returns its byte offset. If it doesn't, you can use the <CODE>widthRemaining</CODE> parameter value to help determine which style run contains the glyph at the pixel location.<P>
 If you pass <CODE>PixelToChar</CODE> the pixel width of the display line, you can use the returned value of <CODE>widthRemaining</CODE> to calculate the length of a style run. The <CODE>widthRemaining</CODE> parameter contains the length in pixels from the end of the style run for which you call <CODE>PixelToChar</CODE> to the end of the display line, in this case, if the style run for which you call it does not include the byte offset whose glyph corresponds to the pixel location. You subtract the returned <CODE>widthRemaining</CODE> value from the screen pixel width of the display line to get the style run's length.<P>
 <A NAME=MARKER-2-190></A>To truncate a line of text, you can use <CODE>PixelToChar</CODE> to find the byte offset of the character where the line should be broken. To return the correct byte offset associated with the pixel location of a mouse-down event when the text belongs to a right-to-left script system, the <CODE>PixelToChar</CODE> function reorders the text. If right-to-left text is reordered when you use <CODE>PixelToChar</CODE> to determine where to break a line, it returns the wrong byte offset. <A NAME=MARKER-2-354></A>To get the correct result, you must turn off reordering before you call <CODE>PixelToCha</CODE>r. Remember to restore reordering after you have determined where to break the line. See <A HREF=Text-139.html#MARKER-9-186>"Using Scaled Text"</A> beginning on <A HREF=Text-139.html#MARKER-9-186>page 3-43</A> for more information.<P>
<A NAME=HEADING172-23></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The <CODE>PixelToChar</CODE> function works with text in all script systems, and for text that is justified or not. For contextual script systems, <CODE>PixelToChar</CODE> takes into account the widths of any ligatures, reversals, and compound characters that were created when the text was drawn.<P>
 Because 2-byte script systems also include characters consisting of only one byte, you should not simply multiply the number of characters by 2 to determine this value; you must determine and specify the correct number of bytes.<P>
 The <CODE>PixelToChar</CODE> function may move memory; do not call this procedure at <BR>interrupt time.<A NAME=MARKER-2-388></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-171.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-173.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
