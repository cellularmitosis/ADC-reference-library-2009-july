<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW505: AppleTalk Data Stream Protocol Q&amp;As</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW505: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002571" title="AppleTalk Data Stream Protocol Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW505</div>
<div id="pageheadsub">AppleTalk Data Stream Protocol Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Section1">AppleTalk Data Stream Protocol references</a><BR><BR><a href="#Section2">ADSP closes connections on eClosed or eTearDown events</a><BR><BR><a href="#Section3">ADSP dspAttention and attention retransmit timer interval</a><BR><BR><a href="#Section4">Using ADSP with AppleTalk for Apple's VMS</a><BR><BR><a href="#Section5">Appletalk Internet Router and Internet Protocol support</a><BR><BR><a href="#Section6">ADSP session limits</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>AppleTalk Data Stream Protocol references</h2><p>Date Written:  11/13/90</p><p>Last reviewed:  8/1/92</p><p>Where are the AppleTalk Data Stream Protocol (ADSP) calls documented?</p><p>APDA has a product called "ADSP: AppleTalk Data Stream Protocol DevelopmentKit" that gives you ADSP and the ADSP call descriptions. ADSP and ADSPinterfaces can be found on the Developer CD and can be used for yourdevelopment purposes. However, you'll need to license ADSP through AppleSoftware Licensing (AppleLink: SW.LICENSE) before you ship your product. Callsare also documented in Chapter 32 of <i>Inside Macintosh</i> Volume VI.</p><p>If you want to use ADSP, then you should read ALL of the documentation. Thereare various tips and explanations that may be vital to your implementation ofADSP in your product. It is useful for transferring data between machines andprovides built-in error checking to ensure that you do receive the data at theother end. For these reasons, you should read <i>Inside AppleTalk,</i> Chapter12, Apple Data Stream Protocol, to make sure you utilize it to its fullest.</p><P><A HREF="#top">Back to top</A></P><h2>Sending broadcast packets to transmit data to multiple clients</h2><p>Date Written:  11/19/90</p><p>Last reviewed:  6/14/93</p><p>How do I broadcast information over AppleTalk using the Communications Toolbox(CTB) and the AppleTalk Data Stream Protocol Development (ADSP) Tool ormultiple access? I cannot find any significant information regarding broadcastor multiple access transmissions.</p><p>There is no supported method to send broadcast packets to transmit data tomultiple clients. The reason is that this method does not ensure the data wasreceived by every client. It is possible to lose a packet on a network beforeit reaches a client even though it may reach the others. If this is the casethen the data is lost forever for this client unless you resend the packet.This is highly inefficient and unreliable.</p><p>If you want to have multiple clients, then you'll need to write your own serversoftware that can handle multiple clients logged on simultaneously. The serverwill then need to keep a record of every connection and its correspondingtransaction ID even though you will be sending the same information to eachclient; this is to ensure that each client receives the data. Following theADSP protocol should be enough for you to implement this server/clientconnection and ensure that the data is reliably transmitted to each node.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></P><h2>ADSP closes connections on eClosed or eTearDown events</h2><p>Date Written:  7/30/91</p><p>Last reviewed:  6/14/93</p><p>When I receive an <code>eClosed</code> or <code>eTearDown</code> ADSP connection event, do I have toclose my end of the connection, or does ADSP close it automatically?</p><p>When you get a <code>eClosed</code> unsolicited event, it means the other (remote) side ofthe ADSP connection sent a Close Connection Advice control packet and ADSP hasclosed the connection. It is purely advisory and does not require you to takeany action. The Close Connection Advice control packet allows ADSP to closeconnections faster than just waiting for the connection to time-out due to theopen timer expiring.</p><p>When you get a <code>eTearDown</code> unsolicited event, it means the network connectionwith other side of the ADSP connection was lost (the open timer expired) andADSP has closed the connection. Again, it is purely advisory and does notrequire you to take any action.</p><p>The ADSP chapter of <i>Inside AppleTalk</i> (Chapter 12) might with help otherquestions you may have about ADSP in the future since it explains how ADSPworks beneath the Macintosh implementation documented in <i>InsideMacintosh</i> Volume VI.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>ADSP dspAttention and attention retransmit timer interval</h2><p>Date Written:  9/16/91</p><p>Last reviewed:  6/14/93</p><p>I'm having problems with the AppleTalk Data Stream Protocol (ADSP) calldspAttention. Sometimes it takes several minutes for <code>dspAttention</code> tocomplete.I've tried using ADSP 1.5.1 with System 6.0.7 and ADSP 56, which shipsas part of System 7.</p><p>ADSP 1.5.1 (and ADSP 56) no longer uses the <code>attnInterval</code> field in the<code>DSPParamBlock</code> for the attention retransmit timer interval. Instead, theattention retransmit timer interval is based on the round-trip time of ADSPdata packets. When a connection end is established, the attention retransmitacknowledged, the attention retransmit timer interval is adjusted for theconnection speed. This mechanism works well when a connection end isestablished, an ADSP connection is opened, the connection is used, theconnection is closed, and then the connection is eliminated.</p><p>A problem in this mechanism can surface when a connection end is establishedand is reused over and over for several ADSP connections. When a connection isclosed and then a new connection is opened using the same connection end, theattention retransmit timer interval is not reset to the default starting value(the problem). Instead, some garbage value in memory is used. If the first ADSPattention packet or the acknowledgment packet returned for that attentionpacket is lost on the network, ADSP will use the "garbage" value for theattention retransmit timer interval and it could take several minutes for ADSPto retry sending the attention packet.</p><p>This has been fixed for versions of ADSP greater than version 56. With versionsof AppleTalk 56 and earlier, the only workaround is to use a new connection endfor every new ADSP connection requiring ADSP's attention mechanism.</p><a name="Section4"></a><P><A HREF="#top">Back to top</A></P><h2>Using ADSP with AppleTalk for Apple's VMS</h2><p>Date Written:  5/3/89</p><p>Last reviewed:  6/14/93</p><p>I am trying to create a simple program to try ADSP (AppleTalk Data StreamProtocol) with AppleTalk for Apple's VMS (version 2). I started the bridgeprocess but got an access violation on the first call.</p><p>You need to make three calls before you can call any other functions withAppleTalk for VMS. These calls are:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    ATK$INIT_ATALK    ATK$INIT_PORT</pre>	</TD></TR></TABLE></CENTER><p>Then you can use the other routines.</p><a name="Section5"></a><P><A HREF="#top">Back to top</A></P><h2>Appletalk Internet Router and Internet Protocol support</h2><p>Date Written:  5/15/92</p><p>Last reviewed:  8/1/92</p><p>Does the Appletalk Internet Router support the routing of Internet Protocolpackets, or Datagram Delivery Protocol-to-Internet Protocol translation?</p><p>The AppleTalk Internet Router does not provide support for routing IP packetsor the translation of IP packets encapsulated inside AppleTalk packets into IPpackets.  It only supports the routing of AppleTalk packets between AppleTalklink layers such as LocalTalk, EtherTalk, and TokenTalk.  To route IP packetsbetween, for instance, a LocalTalk network and an IP only backbone, you'll needto purchase a hardware router such as a Cayman Gatorbox or a Shiva Fastpath.Using one of these routers you can, using MacTCP, tunnel IP packets inAppleTalk packets by selecting the appropriate AppleTalk adev from within theMacTCP Control Panel. This will allow transfer of IP packets over the wire andthe hardware routers will then strip the AppleTalk protocol, allowing IPpackets to reach their destination over Ethernet. In addition, these routersusually support tunneling AppleTalk within IP packets (IPTalk).</p><p>If both the host computer running the TCP/IP protocol stack and the Macintoshyou wish to connect from are on the same Ethernet wire, you can select Ethernetfrom the MacTCP Control Panel to bypass the encapsulation of IP packets withinAppleTalk DDP packets.</p><a name="Section6"></a><P><A HREF="#top">Back to top</A></P><h2>ADSP session limits</h2><p>Date Written:  7/21/92</p><p>Last reviewed:  6/14/93</p><p>What's the absolute maximum number of ADSP sessions that a single Macintosh canhave? What's the largest client community that can be served at any giventime?</p><p>As documented in <i>Inside AppleTalk</i> 2nd Edition, page 4-5, dynamic socketscan range from 128-254. Therefore, when using ADSP you have 126 differentdynamic sockets available for use as connection ends.</p><p>Note that you may have only one connection open between a pair of sockets.However, it is possible to have multiple connections open on the same socket,provided that the other end of each connection resides on a different socket.For example, socket 128 on machine B may have connections with socket 128 onmachine C and socket 128 on machine D, but it may not have more than oneconnection with the same socket of a remote machine.</p><p>When a connection is established between two sockets, each connection end isassigned a unique connection ID value (<code>ConnID</code>). The <code>ConnID</code> is an unsignedinteger. Therefore, it is theoretically possible to have 65,535 differentconnections on a single machine.</p><p>However, since each connection requires that you allocate a CCB data structure(242 bytes), you will most likely run out of memory long before this limit isreached. In addition, the more connections you have, the more traffic you willgenerate on the network since each connection is maintained internally by ADSPwith probe control packets and connection timers (see Chapter 12 of <i>InsideAppleTalk</i> 2nd Edition for the details). On top of that, if each connectionis transferring a lot of data, the burden of passing ADSP packets around willput an even greater strain on your machine and the network in general.</p>                                    <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (60K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_505.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_505.html%3Fid%3DDTS10002571-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_505.html%3Fid%3DDTS10002571-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_505.html%3Fid%3DDTS10002571-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>