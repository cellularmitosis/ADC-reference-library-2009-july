<HTML>		<HEAD>        <title>AddingRelationships</title>		</HEAD>	<BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../index.html" target="_top">Documentation</a> <b>></b> <a href="../../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><a href="Enhancing_t_Application.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Expanding_t_ovies_Model.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "TPXREF130"></a><h2><font face="Helvetica,Arial,Lucida Grande">AddingRelationships</font></h2><!-- apple_doc: pageHeadingEnd --><p><font face="Times">The Studio, Movie, and Talent entities are not especiallyinteresting when considered separately. Their real significancebecomes apparent only in their relationships to each other. EveryMovie has one corresponding Studio. One Studio can have many Movies.A particular actor (Talent) can star in several movies.</font></p><p><font face="Times">Relational databases model not just individual entities, butentities' relationships to one another. For example, a Movie hasa corresponding Studio. This is represented by both the MOVIE andSTUDIO tables having a STUDIO_ID column. In MOVIE, the STUDIO_ID columnis a foreign key, while in the STUDIO table it's a primary key.A foreign key correlates with the primary key of another table inorder to model a relationship a source table (MOVIE) has to a destinationtable (STUDIO). In the following diagram, notice that the valuein the STUDIO_ID column for both movies is "501". This matchesthe value in the STUDIO_ID column of the Columbia Pictures moviestudio. In other words, the movies <i>Tootsie</i> and <i>TaxiDriver</i> both belong to Columbia Pictures.</font></p> <img src = "../Art/dbrel.gif" alt = "[image: ../Art/dbrel.gif]"><p><font face="Times">This plays out in your running application as follows: Supposeyou fetch a Movie object. Enterprise Objects Framework takes thevalue for the movie's studioId attribute and looks up the studiowith the corresponding primary key.</font></p><p><font face="Times">For your application to take advantage of such database-definedrelationships, your model must specify the corresponding relationships.The example Movies model already defines these relationships. Ifyou used that model in your project, you can skip to  <a href="#TPXREF131">"Adding Movies to the Application"</a>.Otherwise, you'll need to add relationships using EOModeler.</font></p><br><a name = "BCIEIGHI"></a><h3><font face="Helvetica,Arial,Lucida Grande">UsingEOModeler to Add Relationships</font></h3><p><font face="Times">To add the relationships between Movie and Studio in EOModeler,follow these steps:</font></p><ol><p><li>Display thegraphical view of the model.<p>Choose Tools &gt; Diagram View.</p><p>Youare presented with a graphical view of the entities in your model.Because no relationships have been defined, you'll see only agroup of individual entities.</p></li></p><p><li>Create the Movie-Studio relationships.<p>Position the Movieand Studio entities next to each other.</p><p>Control-dragfrom the studioId attribute of the Movie entity to the studioId<code></code> attributeof the Studio entity.</p> <img src = "../Art/firstrelationships.gif" alt = "[image: ../Art/firstrelationships.gif]"><p>You'll add more relationshipsto the model in  <a href="Expanding_t_ovies_Model.html#TPXREF134" target = "_right">"Expanding the Movies Model"</a>, using a different technique. </p></li></p><p><li>Add client-side class properties.<p>For the client to beable to access the objects referenced by the relationships of each entity,they have to be defined as client-side class properties. EOModelerdoes not automatically select this option for new relationships.</p><p>SelectTools &gt; Table Mode.</p><p>Select the Studio entity.</p><p>Inthe Studio Relationships table, click the  <img src = "../Art/clientsideclassproperty.gif" alt = "[image: ../Art/clientsideclassproperty.gif]"> column inthe movies relationship information row. When the arrows show up,it means that the relationship is a client-side class property.</p><p>Repeatthe process for the studio relationship of the Movie entity.</p> <img src = "../Art/studiomoviescsp.gif" alt = "[image: ../Art/studiomoviescsp.gif]"></li></p><p><li>Save the model.</li></p></ol><p><font face="Times">You've just defined two relationships in the Movies model: </font></p><ul><p><li>a to-one <em></em>relationshipcalled "studio" in the Movie entity that references each Movie objectwith the Studio object that owns it</li></p><p><li>a to-many relationship called "movies" in the Studio entitythat references all the Movie objects that belong to a particularStudio object</li></p></ul><p><font face="Times">As you can see, there are two types of relationships:</font></p><ul><p><li><b>to-one</b> relationshipsassociate a <em>source</em> object to a single <em>target</em> object.These relationships are named using the singular form of the targetentity name.</li></p><p><li><b>to-many</b> relationships associate a sourceobject to one or more target objects. These relationships are namedusing the plural form of the target entity name.</li></p></ul><br><a name = "TPXREF131"></a><h3><font face="Helvetica,Arial,Lucida Grande">AddingMovies to the Application</font></h3><p><font face="Times">The relationships defined in the Movies model now come intoplay in your application. You can use Studio's movies relationshipto display the movies for the selected studio.</font></p><p><font face="Times">In this type of configuration, called master-detail, the mastertable holds records for the source of the relationship, while thedetail table holds records for the destination. As individual recordsin the master table are selected, the contents of the detail tablechange to show the records that correspond to the selection in themaster. In the Studio Manager application, Studio is the mastertable and Movie is the detail table.</font></p><br><a name = "TPXREF132"></a><h3><font face="Helvetica,Arial,Lucida Grande">Creatinga Master-Detail Interface</font></h3><p><font face="Times">Starting with this exercise, you will create the final userinterface of the Studio Manager application. This means that youshould start off by removing all objects added earlier to your nibfile; also, give your application window a title.</font></p><ol><p><li>Prepare thenib file.<p>In Interface Builder, delete the table view fromthe window.</p><p>Delete the Studio EODisplayGroup and theEditingContext from the nib file window.</p><p>Save the nibfile.</p></li></p><p><li>Set the window title.<p>Select the window by clicking itstitle bar.</p><p>Choose Show Info from the Tools menu.</p><p>Enter <code>StudioManager</code> in the Title field of the Attributespane and press Enter.</p> <img src = "../Art/ibwindowattributeinfo.gif" alt = "[image: ../Art/ibwindowattributeinfo.gif]"></li></p><p><li>Create a master-detail interface.<p>You can create a master-detailinterface by simply dragging a relationship from EOModeler ontoyour window.</p><p>Drag the Studio entity's movies relationshipfrom EOModeler onto the window in Interface Builder.</p> <img src = "../Art/moviesrelationshipdrag.gif" alt = "[image: ../Art/moviesrelationshipdrag.gif]"><p>This operationcreates a master-detail interface. Columns are automatically addedfor all of the attributes marked as class properties; you can deleteany columns you don't want displayed to the user. </p><p>Rearrangeand resize the tables so that they are side by side.</p> <img src = "../Art/ibinterfacemd.gif" alt = "[image: ../Art/ibinterfacemd.gif]"><p>Reconnect theAdd and Remove buttons to the new Studio EODisplayGroup.</p><p>(See  <a sector="mod" href="../Creating/iCreating_th_r_Interface.html" target="_top">"Adding Action Methods"</a> forthese procedures.)</p></li></p><p><li>Connect the interface controller to its editing context anddisplay group.<p>For a Java Client application, the interfacecontroller-represented by the File's Owner icon in the nib filewindow-is the <em>controller</em> object in the Model-View-Controller designscheme. The interface controller comes already connected to its <em>view</em> throughthe component outlet. But you must connect it to its <em>model</em> object,the editing context.</p> <img src = "../Art/model_viewcontroller.gif" alt = "[image: ../Art/model_viewcontroller.gif]"><p>Control-drag from the File'sOwner icon to the EditingContext icon in the nib file window.</p> <img src = "../Art/ibfileownerdrag.gif" alt = "[image: ../Art/ibfileownerdrag.gif]"><p>In the Connectionspane of the Info window, select the <code>editingContext</code> outlet.</p><p>ClickConnect.</p> <img src = "../Art/ibfileownerinfo.gif" alt = "[image: ../Art/ibfileownerinfo.gif]"><p>Control-dragfrom the File's Owner icon to the Studio icon in the nib filewindow.</p><p>In the Connections pane of the Info Window,select the <code>displayGroup</code> outlet.</p><p>ClickConnect. (Alternatively, you can double-click the <code>displayGroup</code> outletto connect it to the File's Owner.)</p></li></p><p><li>Add titles to the Studio and Movies tables.<p>Drag a MessageText element from the palette window into the content window, above theStudio table.</p><p>Choose Tools &gt; Show Info.</p><p>Displaythe Attributes pane of the Info window.</p><p>Enter <code>Studio</code> inthe Title field.</p><p>Repeat the process for the Movies table.</p></li></p><p><li>Change the formatting for currency and dates.<p>Selectthe Budget column in the Studio table.</p><p>Choose Tools&gt; Show Info.</p><p>Display the Formatter pane of the InfoWindow.</p><p>Select the standard currency formatter (theone that does not display negative numbers in red).</p><p>Repeatthe process for the Revenue column in the Movies table.</p><p>Selectthe Date Released column in the Movies table.</p><p>Displaythe Formatter view of the NSTableColumn Info window.</p><p>Selectthe formatter that uses the "%b %d, %Y" format.</p></li></p><p><li>Save the interface file.</li></p><p><li>Test the interface.<p>Choose File &gt; Test Interface.</p> <img src = "../Art/ibinterfacetestmd.gif" alt = "[image: ../Art/ibinterfacetestmd.gif]"><p>Choose InterfaceBuilder &gt; Quit Interface Builder to end the test.</p></li></p><p><li>Learn the size of the window.<p>To see the effects of yourchanges, you must compile and run the application. However, beforeyou run the application, there is one last step to perform. Theapplet providing the running environment for your Java Client applicationis set to a default size in the WOJavaClientApplet bindings in <code>Main.wod</code>.This size could be too small to accommodate your user interface(or too large for it).</p><p>In Interface Builder, selectthe content window by clicking its title bar.</p><p>ChooseTools &gt; Show Info.</p><p>Display the Size pane.</p><p>ClickCurrent in the Min Size group.</p><p>Write down the valuesfor the <code>w</code> (width) and <code>h</code> (height)attributes.</p> <img src = "../Art/ibwindowsizeInfo.gif" alt = "[image: ../Art/ibwindowsizeInfo.gif]"></li></p><p><li>Enter the size information into the Main component's WOJavaClientApplet's subcomponent'ssize bindings.<p>In the Groups & Files list of Project Builder'smain window, click the disclosure triangle to the left of the WebComponents group.</p><p>In the Web Components group, clickthe disclosure triangle to the left of the Main subgroup.</p><p>Inthe Main subgroup, click the disclosure triangle to the left ofthe Main.wo subgroup.</p><p>In the Main.wo subgroup, select <code>Main.wod</code>.</p> <img src = "../Art/pbselectmainwobindings.gif" alt = "[image: ../Art/pbselectmainwobindings.gif]"><p></p><p>InProject Builder, select Web Components &gt; Main &gt; Main.wo &gt; <code>Main.wod</code>.</p><p>Enterthe dimensions of the window in the height and width bindings.</p><pre>Applet: WOJavaClientApplet {    height = 375; // change this    width = 865; // and this    interfaceControllerClassName =  "studiomanagerinterfacecontroller.client.StudioManagerInterfaceController";    useJavaPlugin = YES;}</pre><p>Save <code>Main.wod</code>.</p><p>Nowyou are ready to test the application.</p></li></p><p><li>Build the application.<p>See  <a sector="mod" href="../Creating/iBuilding_an_Application.html" target="_top">"Building the Application"</a> fordetails.</p></li></p><p><li>Run and test the application.<p>Click  <img src = "../Art/launchicon.gif" alt = "[image: ../Art/launchicon.gif]"> to launch the server application.</p><p>Launchthe client application.</p><p>See  <a sector="mod" href="../Creating/iBuilding_an_Application.html" target="_top">"Running a Java Client Application"</a> for details on launching Java Client applications.</p></li></p></ol><p><font face="Times">When you select a studio in the Studio table, the displaychanges in the Movies table to show the selected studio's movies.</font></p><br><a name = "TPXREF133"></a><h3><font face="Helvetica,Arial,Lucida Grande">TransferringMovies Between Studios</font></h3><p><font face="Times">One of the primary functions of the Studio Manager applicationis to allow one studio to purchase movies from another. To makethis possible, you'll now add a pop-up list to the user interface. </font></p><p><font face="Times">The pop-up list displays a list of all of the studio titles.When you select a new studio in the pop-up list, you cause thatstudio to purchase the movie that's selected in the Movies table view.</font></p><ol><p><li>Add a pop-uplist.<p>Drag a pop-up list (labeled "Item1" on the Viewspalette) into the window.</p><p>Put the pop-up list directlybelow the Studio table view and leave some space between it andthe row of buttons. Later you will be adding fields between thepop-up list and the buttons. See  <a href="#BCIGHAGF">Figure 3-1</a> for a guide.</p></li></p><p><li>Set the binding that provides the pop-up list with the listof studio names.<p>The pop-up list needs a source from whichto obtain the list of options to display when the user clicks onit, in this case, a list of studio names. You need to connect thepop-up lists <code>titles</code> aspectwith the Studio EODisplayGroup's <code>name</code> property.</p><p>Control-dragfrom the pop-up list to the Studio EODisplayGroup.</p><p>Inthe NSPopupButton Info window, select EOValueSelectionAssociationfrom the pop-up list at the top of the left column.</p><p>Select <code>titles</code> inthe left column. The <code>titles</code> aspectis bound to the class key whose values you want to display in thepop-up list.</p><p>Select <code>name</code> inthe right column (since you want to display studio names in thepop-up list).</p><p>Click Connect.</p> <img src = "../Art/ibstudiopopuplistinfo.gif" alt = "[image: ../Art/ibstudiopopuplistinfo.gif]"></li></p><p><li>Set the binding that changes the studio of the selected movie.<p>Nowyou have to add another binding to the EOValueSelectionAssociationso that when you change the selected studio title, it sets the corresponding <code>studio</code><code></code> relationship propertyin the selected Movie object. In other works, when you choose astudio from the pop-up list, the value of the <code>studio</code> propertyof the selected movie is set to the studio selected in the pop-uplist.</p><p>Control-drag from the pop-up list to the moviesEODisplayGroup.</p><p>Display the EOValueSelectionAssociationpane of the Info window. </p><p>Select <code>selectedObject</code> inthe left column.</p><p>Select <code>studio</code> inthe right column.</p><p>Click Connect.</p> <img src = "../Art/ibstudiopopupmoviesinfo.gif" alt = "[image: ../Art/ibstudiopopupmoviesinfo.gif]"><p>The <code>selectedObject</code> aspectis bound to the relationship property (in this example, Movie's <code>studio</code> property)that corresponds to the object bound to the <code>titles</code> aspect (Studio). </p></li></p><p><li>Save the interface.</li></p><p><li>Build and test-run the application.<p>(See  <a sector="mod" href="../Creating/iBuilding_an_Application.html" target="_top">"Building and Testing Your Application"</a> for details.)</p></li></p></ol><a name = "BCIGHAGF"></a><p><font face="Helvetica,Arial,Lucida Grande"><b>Figure3-1 Master-detail interface</b></font></p> <img src = "../Art/ibinterfacetestmdpopup.gif" alt = "[image: ../Art/ibinterfacetestmdpopup.gif]"><p><font face="Times">You can now test the behavior of the pop-up list. For example,suppose you want to transfer the movie <i>Alien</i> fromthe 20th Century Fox studio to MGM. First select 20th Century Foxto display its movies. Then select <i>Alien</i> inthe list of movies. Finally, use the pop-up list to change the selectedstudio from 20th Century Fox to MGM. This has the effect of removing <i>Alien</i> from20th Century Fox's <code>movies</code> relationshiparray and adding it to the <code>movies</code> relationshiparray of MGM. It also sets the <i>Alien</i> Movieobject's <code>studio</code> relationshipproperty to point to the new studio, MGM. When you use the pop-uplist to transfer a movie, you'll notice that the movie disappearsfrom the original studio's movie list and reappears in the movielist of the new studio.</font></p><p><font face="Times">These changes aren't committed to the database until youclick Save. At that time Enterprise Objects Framework translatesthe changes you made in the object graph into the appropriate databasechanges. For example, it sets the foreign key <code>studioId</code> inthe transferred Movie object to have the same value as the <code>studioId</code> primarykey of its new studio.</font></p><p><font face="Times">Note that Enterprise Objects Framework manages all of thisfor you without requiring you to write any code.</font></p><p><font face="Times">For more information on associations, see  <a sector="mod" href="../Concepts/iWhat_Is_an_Association_.html" target="_top">"What Is an Association?"</a>.</font></p><br>    <br><a href="Enhancing_t_Application.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="Expanding_t_ovies_Model.html" target="_right"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<p><font face="Geneva,Helvetica,Arial" size="1">&#169; 2001 Apple Computer, Inc.</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></html>