<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html><head>
<!-- BEGIN META TAG INFO -->
<link rel="home" href="http://developer.apple.com/">
<link rel="find" href="http://developer.apple.com/search/">
<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
<script language="JavaScript" type="text/javascript" src="../../documentation/js/busnav.js"></script>
<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- END META TAG INFO -->
<!-- BEGIN TITLE -->
<title>Technical Note TN2115: Image Color Management</title>
<!-- END TITLE -->
</head>
<!-- BEGIN BODY OPEN -->
<body bgcolor="#ffffff"><a name="//apple_ref/doc/uid/DTS10004098" title="Image Color Management"></a>
<!--END BODY OPEN -->
<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->
<a name="top"></a>
<!-- BEGIN LOGO AND SEARCH -->
<!--#include virtual="/includes/adcnavbar"-->
<!-- END LOGO AND SEARCH -->
<!-- START BREADCRUMB -->
<div id="breadcrumb"><table width="680" border="0" cellpadding="0" cellspacing="0"><tr>
<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
<td><img width="340" height="10" src="images/1dot.gif" alt=""></td></tr><tr valign="middle"><td align="left" colspan="2">
<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/GraphicsImaging/index.html">Graphics & Imaging</a> &gt; <a href="../../technicalnotes/GraphicsImaging/idxQuartz-date.html">Quartz</a> &gt; 
</td></tr><tr><td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td></tr></table></div>
<!-- END BREADCRUMB -->

<!-- START MAIN CONTENT -->
<!-- START TITLE GRAPHIC AND INTRO-->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top">
<td><h1>
<div id="pagehead">Technical Note TN2115</div>
<div id="pageheadsub">Image Color Management</div>
</h1></td></tr></table>
<!-- END TITLE GRAPHIC AND INTRO -->
<!-- BEGIN WIDE COLUMN -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td align="left" width="680">
<!-- BEGIN CONTENTS -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td><p>Describes how to easily determine whether or not your application is properly color managed when drawing or printing images and how to modify your code to ensure it is color managed.</p></td></tr><tr><td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td width="680"><ul><li><a href="#TNTAG1">Introduction</a></li><li><a href="#TNTAG10">Background - Mac OS X Color Management</a></li><li><a href="#TNTAG2">The Problem</a></li><li><a href="#TNTAG4">How can I verify color management in my application when drawing or printing images?</a></li><li><a href="#TNTAG5">Why isn't my application being properly color managed when drawing or printing images?</a></li><li><a href="#TNTAG7">How can I fix my application to be properly color managed when drawing or printing images?</a><ul><li><a href="#TNTAG3">Use the Image I/O framework for image handling</a></li></ul></li><li><a href="#TNTAG8">References</a></li><li><a href="#TNTAG6">Downloadables</a></li><li><a href="#TNT_HISTORY_TAG">Document Revision History</a></li></ul></td></tr><tr><td colspan="3" scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><A NAME="TNTAG1"></A><H2>Introduction</H2><p>With the growing prevalence of color digital media, such as digital photos, applications that handle color correctly when drawing or printing images benefit greatly by being able to accurately reproduce color over a wide range of devices. This results in a higher quality product and more satisfied customers. But how do you know if your application is properly color managed? Is there a simple test that will give you this information?</p><p>This Technote describes one technique for determining whether or not your application is being properly color managed when drawing or printing images.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG10"></A><H2>Background - Mac OS X Color Management</H2><p>Mac OS X takes a system-wide approach to managing color data by integrating ICC color management via ColorSync into all layers of the graphics stack (for more information about ColorSync, please see <A HREF="../tn/tn2035.html">TN2035: ColorSync on Mac OS X</A>).</p><p>As Figure 1 shows, ColorSync is built into the system at a low level on top of Darwin. Built on top of ColorSync are a variety of graphics frameworks providing a diverse set of functionality, and most all of these frameworks make use of color management provided by ColorSync.</p><p class="caption"><strong>Figure 1:</strong> ColorSync Architectural Diagram</p><p><img  src="images/tn2115_ArchBlockDiagram.jpg" width="622" height="332" alt="Figure 1, ColorSync Architectural Diagram"></p><p>Developers who take advantage of the various color managed frameworks in Mac OS X can be confident their applications will display and print images correctly. For example, ColorSync color management on Mac OS X will recognize any profile embedded in an image for the following file formats:</p><p>JPEG, GIF, TIFF, PNG, PSD, PICT</p><p>When such images are then drawn or printed, the embedded image profile will be correctly color matched against a profile for the destination device (for example a monitor or printer). If no embedded profile is provided with the image file, Mac OS X will assume a Generic RGB color space (see <A HREF="../tn/tn2035.html">TN2035: ColorSync on Mac OS X</A> and <A HREF="../../qa/qa2004/qa1396.html">Q&amp;A 1396 Creating color spaces that ensure color matching</A>).</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG2"></A><H2>The Problem</H2><p>Color plays a very important role in the world of digital media. Color makes a difference&mdash;often a dramatic difference&mdash;in your images and graphics. Users can be very disappointed when they display or print an image and the color is vastly different from expectations. For this reason, applications that handle color correctly gain a distinct advantage over those that don't. But managing color correctly in your application can be increasingly difficult, and the availability of a wide variety of different image libraries complicates matters even further</p><p>So how do you really know if drawing or printing of images is being properly color managed in your application?</p><p>Or what if you also make use of a third-party framework in your application? Is there a simple technique for verifying proper color management when displaying or printing images in your application?</p><p>One simple technique is the use of images with embedded &quot;trick&quot; profiles. This Technote describes this technique.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG4"></A><H2>How can I verify color management in my application when drawing or printing images?</H2><p>Included with this Technote are a set of image files with embedded &quot;trick&quot; profiles. These aren't &quot;normal&quot; profiles you would expect to see in a typical image file. Instead, these profiles were specially made to allow you to easily tell whether or not ColorSync color management is being performed when the image is drawn or printed. Simply look at the message displayed and you will know right away if the proper color management is being performed (the image files were constructed to display different colors when color managed).</p><p>For example, if you draw or print the enclosed image file &quot;<code>TestRGB.jpg</code>&quot; in an application which correctly performs color management (such as the Mac OS X Preview application) you should see the output as shown in Figure 2 below.  This indicates the application is being properly color managed. In this case, the embedded image profile is being recognized by ColorSync and is being color-matched against an appropriate destination profile:</p><p class="caption"><strong>Figure 2:</strong> Image file properly color managed.</p><p><img  src="images/tn2115_ColorMatchedImage.jpg" width="458" height="296" alt="Figure 2, Image file properly color managed."></p><p>On the other hand, if you see the following output when drawing/printing the same image then you know your application is not being properly color managed. In this case, the embedded image profile is not being taken into account for any drawing or printing operation.</p><p class="caption"><strong>Figure 3:</strong> Image file *not* properly color managed.</p><p><img  src="images/tn2115_NonColorMatchedImage.jpg" width="457" height="294" alt="Figure 3, Image file *not* properly color managed."></p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG5"></A><H2>Why isn't my application being properly color managed when drawing or printing images?</H2><p>If you display or print the enclosed images with &quot;trick&quot; profiles in your application and you find they are not being properly color managed it can be for one of the following reasons:</p><ul><li><p>You are not using one of the available color managed frameworks in Mac OS X which respect image profiles such as the Image I/O framework. For example, you could be using a third-party framework which does not support color management.</p></li><li><p>You are using one of the available color managed frameworks in Mac OS X but you are circumventing the built-in color management (for example with the <code>CGImageCreateCopyWithColorSpace</code> function or others).</p></li><li><p>You are writing your own image handling code but you are ignoring any embedded image profiles.</p></li><li><p>You are using device color spaces (see <A HREF="../../qa/qa2004/qa1396.html">Q&amp;A 1396 Creating color spaces that ensure color matching</A>).</p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG7"></A><H2>How can I fix my application to be properly color managed when drawing or printing images?</H2><p>What can you do to ensure your application will be properly color managed when drawing or printing images? Follow these guidelines:</p><ul><li><p>Use one of the available color managed frameworks in Mac OS X which respect embedded image profiles such as the Image I/O framework or the Cocoa <code>NSImage</code> class.</p></li><li><p>If you are using a third-party image framework make sure it supports color management.</p></li><li><p>If you are writing your own custom image-handling code make sure and identify any embedded profiles in your image files and color match these against  a device profile for your drawing destination.</p></li></ul><p>For examples of code written using one of the color managed frameworks in Mac OS X take a look at the available <A HREF="../../samplecode/GraphicsImaging/index-date.html">Graphics &amp; Imaging sample code</A> on the ADC website.  For example, see the <A HREF="../../samplecode/ImageApp/index.html">ImageApp</A> sample code for a good example of use of the Image I/O framework.</p><A NAME="TNTAG3"></A><H3>Use the Image I/O framework for image handling</H3><p>We recommend use of the Image I/O framework, introduced in Mac OS X v10.4, for working with images in your application. The Image I/O framework provides image reading or writing functionality for the Core Graphics framework (the Core Graphics framework and the the Image I/O framework together comprise the Quartz 2D API). The Image I/O framework is also a companion framework to <code>CGImage</code>.</p><p>Why make use of the Image I/O framework in your application? Because the Image I/O framework makes it easy to work with image file formats in a color managed way. The Image I/O framework provides the best compromise between an API which is easy to work with but at the same time provides access to a diverse set of options.</p><p>The Image I/O framework currently supports the following image file formats:</p><ul><li><p>Web standards</p><p>TIFF, JPEG, PNG, GIF, JPEG-2000</p></li><li><p>Floating Point HDR formats</p><p>OpenEXR, Radiance, LogLuv TIFF, Float TIFF, and Pixar TIFF</p></li><li><p>Camera Raw formats</p><p>Canon, Nikon, Minolta, Olympus, Sony</p></li><li><p>Others</p><p>.bmp, .psd, .qtif, .tga, .sgi, .xbm, .icns, .ico, .pict, .ptng, .fpx</p></li><li><p>MetaData</p><p>Exif, IPTC, CIFF, GPS, some MakerNotes, &hellip;</p></li></ul><p>ImageIO supports embedded profiles for the following image file formats:</p><p>- JPEG, GIF, TIFF, PNG, PSD, PICT</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG8"></A><H2>References</H2><ul><li><p><A HREF="../tn/tn2035.html">TN2035: ColorSync on Mac OS X</A></p></li><li><p><A HREF="../../qa/qa2004/qa1396.html">Q&amp;A 1396 Creating color spaces that ensure color matching</A></p></li><li><p><A HREF="../../documentation/GraphicsImaging/Reference/CGImageSource/index.html">CGImageSource Reference</A></p></li><li><p><A HREF="../../documentation/GraphicsImaging/Reference/CGImageDestination/index.html">CGImageDestination Reference</A></p></li><li><p><A HREF="../../documentation/GraphicsImaging/Quartz-date.html">Quartz Documentation</A></p></li><li><p><A HREF="../../samplecode/ImageApp/index.html">ImageApp sample code</A></p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG6"></A><H2>Downloadables</H2><ul><li><p><a href="downloads/tn2115_Images.zip">Images with trick profiles.</a> ("tn2115_Images.zip", 870.7K)</p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNT_HISTORY_TAG"></A><H2>Document Revision History</H2><table cellspacing="0" class="graybox" width="680"><tr><th width="100">Date</th><th width="580">Notes</th></tr><tr><td scope="row">2006-11-01</td><td>First Version</td></tr></table><p><b>Posted:</b> 2006-11-01</p>
<!-- END CONTENTS -->
</td></tr></table>
<!-- END WIDE COLUMN -->
<!-- END MAIN CONTENT -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2006/tn2115.html%3Fid%3DDTS10004098-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2006/tn2115.html%3Fid%3DDTS10004098-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2006/tn2115.html%3Fid%3DDTS10004098-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<!-- START BOTTOM APPLE NAVIGATION -->
<!--#include virtual="/includes/footer"-->
<!-- END BOTTOM APPLE NAVIGATION -->
<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->
</body></html>