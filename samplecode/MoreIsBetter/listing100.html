<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MoreIsBetter - /MIB-Libraries/MoreDisks/MoreCDs.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">MoreIsBetter</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MoreIsBetter</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MIB-Libraries/MoreDisks/MoreCDs.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/MIB-Clients/Demos/MoreOpenAndSaveDemo/AnswerShell.c</option>
<option value="listing2.html">/MIB-Clients/MacCVSProTool/MacCVSProTool.c</option>
<option value="listing3.html">/MIB-Clients/SampleSubmit/SampleSubmit.c</option>
<option value="listing4.html">/MIB-Documentation/index.html</option>
<option value="listing5.html">/MIB-Documentation/MoreDocumentation/0ReleaseNotes.html</option>
<option value="listing6.html">/MIB-Documentation/MoreDocumentation/0toc.html</option>
<option value="listing7.html">/MIB-Documentation/MoreDocumentation/banner.html</option>
<option value="listing8.html">/MIB-Documentation/MoreDocumentation/BuildingAndUsing.html</option>
<option value="listing9.html">/MIB-Documentation/MoreDocumentation/ContributingToMoreIsBetter.html</option>
<option value="listing10.html">/MIB-Documentation/MoreDocumentation/copyright.html</option>
<option value="listing11.html">/MIB-Documentation/MoreDocumentation/index.html</option>
<option value="listing12.html">/MIB-Documentation/MoreDocumentation/intro.html</option>
<option value="listing13.html">/MIB-Documentation/MoreDocumentation/MoreAppearance.html</option>
<option value="listing14.html">/MIB-Documentation/MoreDocumentation/MoreAppleEvents.html</option>
<option value="listing15.html">/MIB-Documentation/MoreDocumentation/MoreCDs.html</option>
<option value="listing16.html">/MIB-Documentation/MoreDocumentation/MoreCodeFragments.html</option>
<option value="listing17.html">/MIB-Documentation/MoreDocumentation/MoreControls.html</option>
<option value="listing18.html">/MIB-Documentation/MoreDocumentation/MoreDevices.html</option>
<option value="listing19.html">/MIB-Documentation/MoreDocumentation/MoreDialogs.html</option>
<option value="listing20.html">/MIB-Documentation/MoreDocumentation/MoreDisks.html</option>
<option value="listing21.html">/MIB-Documentation/MoreDocumentation/MoreErrors.html</option>
<option value="listing22.html">/MIB-Documentation/MoreDocumentation/MoreEvents.html</option>
<option value="listing23.html">/MIB-Documentation/MoreDocumentation/MoreInterfaceLib.html</option>
<option value="listing24.html">/MIB-Documentation/MoreDocumentation/MoreLists.html</option>
<option value="listing25.html">/MIB-Documentation/MoreDocumentation/MoreMemory.html</option>
<option value="listing26.html">/MIB-Documentation/MoreDocumentation/MoreMenus.html</option>
<option value="listing27.html">/MIB-Documentation/MoreDocumentation/MoreMultiprocessing.html</option>
<option value="listing28.html">/MIB-Documentation/MoreDocumentation/MoreNavigation.html</option>
<option value="listing29.html">/MIB-Documentation/MoreDocumentation/MoreNetworkSetup.html</option>
<option value="listing30.html">/MIB-Documentation/MoreDocumentation/MoreOpenAndSave.html</option>
<option value="listing31.html">/MIB-Documentation/MoreDocumentation/MoreOpenTransport.html</option>
<option value="listing32.html">/MIB-Documentation/MoreDocumentation/MoreOSL.html</option>
<option value="listing33.html">/MIB-Documentation/MoreDocumentation/MoreOSUtils.html</option>
<option value="listing34.html">/MIB-Documentation/MoreDocumentation/MorePatches.html</option>
<option value="listing35.html">/MIB-Documentation/MoreDocumentation/MorePreferences.html</option>
<option value="listing36.html">/MIB-Documentation/MoreDocumentation/MoreProcesses.html</option>
<option value="listing37.html">/MIB-Documentation/MoreDocumentation/MoreQuickDraw.html</option>
<option value="listing38.html">/MIB-Documentation/MoreDocumentation/MoreResources.html</option>
<option value="listing39.html">/MIB-Documentation/MoreDocumentation/MoreTextUtils.html</option>
<option value="listing40.html">/MIB-Documentation/MoreDocumentation/MoreToolbox.html</option>
<option value="listing41.html">/MIB-Documentation/MoreDocumentation/MoreWindows.html</option>
<option value="listing42.html">/MIB-Libraries/MIB_Carbon.h</option>
<option value="listing43.html">/MIB-Libraries/MIB_SourceHeader.txt</option>
<option value="listing44.html">/MIB-Libraries/MoreAppearance/MoreAppearance.cp</option>
<option value="listing45.html">/MIB-Libraries/MoreAppearance/MoreAppearance.h</option>
<option value="listing46.html">/MIB-Libraries/MoreAppleEvents/MoreAEDataModel.c</option>
<option value="listing47.html">/MIB-Libraries/MoreAppleEvents/MoreAEDataModel.h</option>
<option value="listing48.html">/MIB-Libraries/MoreAppleEvents/MoreAEObjects.c</option>
<option value="listing49.html">/MIB-Libraries/MoreAppleEvents/MoreAEObjects.h</option>
<option value="listing50.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEvents.cp</option>
<option value="listing51.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEvents.h</option>
<option value="listing52.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEventsPlus.c</option>
<option value="listing53.html">/MIB-Libraries/MoreAppleEvents/MoreAppleEventsPlus.h</option>
<option value="listing54.html">/MIB-Libraries/MoreAppleEvents/MoreFinderEvents.c</option>
<option value="listing55.html">/MIB-Libraries/MoreAppleEvents/MoreFinderEvents.h</option>
<option value="listing56.html">/MIB-Libraries/MoreAppleEvents/MoreOSA.c</option>
<option value="listing57.html">/MIB-Libraries/MoreAppleEvents/MoreOSA.h</option>
<option value="listing58.html">/MIB-Libraries/MoreAppleEvents/ProductInfo.txt</option>
<option value="listing59.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/Carbon.r</option>
<option value="listing60.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/HelloWorld.c</option>
<option value="listing61.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/Info.plist.r</option>
<option value="listing62.html">/MIB-Libraries/MoreAppleEvents/TestMoreAppleEvents/TestMoreAppleEvents.c</option>
<option value="listing63.html">/MIB-Libraries/MoreAppleEvents/VersionInfo.r</option>
<option value="listing64.html">/MIB-Libraries/MoreCarbonEvents/MoreCarbonEvents.c</option>
<option value="listing65.html">/MIB-Libraries/MoreCarbonEvents/MoreCarbonEvents.h</option>
<option value="listing66.html">/MIB-Libraries/MoreCFQ/MoreCFQ.c</option>
<option value="listing67.html">/MIB-Libraries/MoreCFQ/MoreCFQ.h</option>
<option value="listing68.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/CallMachOFramework.c</option>
<option value="listing69.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/CallMachOFramework.r</option>
<option value="listing70.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/Read Me CallMachOFramework.txt</option>
<option value="listing71.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CallMachOFramework/System Framework Stub/Stub Library Read Me.txt</option>
<option value="listing72.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CFMLateImport.c</option>
<option value="listing73.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/CFMLateImport.h</option>
<option value="listing74.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/LateImportTest.c</option>
<option value="listing75.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/TestLibrary/TestLibrary.h</option>
<option value="listing76.html">/MIB-Libraries/MoreCodeFragments/CFMLateImport/LateImportTest/TestLibrary/TestLibraryImpl.c</option>
<option value="listing77.html">/MIB-Libraries/MoreControls/MoreControls.cp</option>
<option value="listing78.html">/MIB-Libraries/MoreControls/MoreControls.h</option>
<option value="listing79.html">/MIB-Libraries/MoreCRC/MoreCRC.c</option>
<option value="listing80.html">/MIB-Libraries/MoreCRC/MoreCRC.h</option>
<option value="listing81.html">/MIB-Libraries/MoreDebugging/MoreAddrToSym.c</option>
<option value="listing82.html">/MIB-Libraries/MoreDebugging/MoreAddrToSym.h</option>
<option value="listing83.html">/MIB-Libraries/MoreDebugging/MoreBacktrace.c</option>
<option value="listing84.html">/MIB-Libraries/MoreDebugging/MoreBacktrace.h</option>
<option value="listing85.html">/MIB-Libraries/MoreDebugging/MoreBacktraceTest/MoreBacktraceTest.c</option>
<option value="listing86.html">/MIB-Libraries/MoreDebugging/MoreBBLog.c</option>
<option value="listing87.html">/MIB-Libraries/MoreDebugging/MoreBBLog.h</option>
<option value="listing88.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/GenerateFont/GenerateFont.c</option>
<option value="listing89.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.c</option>
<option value="listing90.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.h</option>
<option value="listing91.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/InterruptSafeDebug.s</option>
<option value="listing92.html">/MIB-Libraries/MoreDevices/InterruptSafeDebug/TestInterruptSafeDebug/TestInterruptSafeDebug.c</option>
<option value="listing93.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/ReadMe.html</option>
<option value="listing94.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TestTradDriverLoaderLib/TestDriver/TestDriverMain.c</option>
<option value="listing95.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TestTradDriverLoaderLib/TestTradDriverLoader.c</option>
<option value="listing96.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TradDriverLoaderLib.c</option>
<option value="listing97.html">/MIB-Libraries/MoreDevices/TradDriverLoaderLib/TradDriverLoaderLib.h</option>
<option value="listing98.html">/MIB-Libraries/MoreDialogs/MoreDialogs.cp</option>
<option value="listing99.html">/MIB-Libraries/MoreDialogs/MoreDialogs.h</option>
<option value="listing100.html">/MIB-Libraries/MoreDisks/MoreCDs.c</option>
<option value="listing101.html">/MIB-Libraries/MoreDisks/MoreCDs.h</option>
<option value="listing102.html">/MIB-Libraries/MoreDisks/MoreDisks.c</option>
<option value="listing103.html">/MIB-Libraries/MoreDisks/MoreDisks.h</option>
<option value="listing104.html">/MIB-Libraries/MoreDisks/TestMoreDisks/TestMoreDisks.c</option>
<option value="listing105.html">/MIB-Libraries/MoreErrors/MoreErrors.c</option>
<option value="listing106.html">/MIB-Libraries/MoreErrors/MoreErrors.h</option>
<option value="listing107.html">/MIB-Libraries/MoreErrors/MoreErrors.r</option>
<option value="listing108.html">/MIB-Libraries/MoreEvents/MoreEvents.h</option>
<option value="listing109.html">/MIB-Libraries/MoreInterfaceLib/MoreInterfaceLib.c</option>
<option value="listing110.html">/MIB-Libraries/MoreInterfaceLib/MoreInterfaceLib.h</option>
<option value="listing111.html">/MIB-Libraries/MoreInterfaceLib/RemoteAccessInterface.h</option>
<option value="listing112.html">/MIB-Libraries/MoreInterfaceLib/TestMoreInterfaceLib/TestMoreInterfaceLib.c</option>
<option value="listing113.html">/MIB-Libraries/MoreIsBetter.h</option>
<option value="listing114.html">/MIB-Libraries/MoreLists/MoreLists.c</option>
<option value="listing115.html">/MIB-Libraries/MoreLists/MoreLists.h</option>
<option value="listing116.html">/MIB-Libraries/MoreMemory/MoreMemory.c</option>
<option value="listing117.html">/MIB-Libraries/MoreMemory/MoreMemory.h</option>
<option value="listing118.html">/MIB-Libraries/MoreMemory/TestMoreMemory/TestMoreMemory.c</option>
<option value="listing119.html">/MIB-Libraries/MoreMenus/MenuKeyGlyphs.h</option>
<option value="listing120.html">/MIB-Libraries/MoreMenus/MoreMenus.c</option>
<option value="listing121.html">/MIB-Libraries/MoreMenus/MoreMenus.h</option>
<option value="listing122.html">/MIB-Libraries/MoreMenus/MoreSystemMenus.c</option>
<option value="listing123.html">/MIB-Libraries/MoreMenus/MoreSystemMenus.h</option>
<option value="listing124.html">/MIB-Libraries/MoreMenus/TestMoreSystemMenus/TestMoreSystemMenus.c</option>
<option value="listing125.html">/MIB-Libraries/MoreMultiprocessing/MoreBlueActions.c</option>
<option value="listing126.html">/MIB-Libraries/MoreMultiprocessing/MoreBlueActions.h</option>
<option value="listing127.html">/MIB-Libraries/MoreMultiprocessing/MoreMPLog.c</option>
<option value="listing128.html">/MIB-Libraries/MoreMultiprocessing/MoreMPLog.h</option>
<option value="listing129.html">/MIB-Libraries/MoreNavigation/MoreNavigation.c</option>
<option value="listing130.html">/MIB-Libraries/MoreNavigation/MoreNavigation.h</option>
<option value="listing131.html">/MIB-Libraries/MoreOpenAndSave/MoreOpenAndSave.cp</option>
<option value="listing132.html">/MIB-Libraries/MoreOpenAndSave/MoreOpenAndSave.h</option>
<option value="listing133.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPush.c</option>
<option value="listing134.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPush.h</option>
<option value="listing135.html">/MIB-Libraries/MoreOpenTransport/MoreAutoPushTest/MoreAutoPushTest.c</option>
<option value="listing136.html">/MIB-Libraries/MoreOpenTransport/OTClassicContext.h</option>
<option value="listing137.html">/MIB-Libraries/MoreOpenTransport/OTClassicContextTest/OTClassicContextTest.c</option>
<option value="listing138.html">/MIB-Libraries/MoreOpenTransport/OTMP.c</option>
<option value="listing139.html">/MIB-Libraries/MoreOpenTransport/OTMP.h</option>
<option value="listing140.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.c</option>
<option value="listing141.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTP.h</option>
<option value="listing142.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.c</option>
<option value="listing143.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/OTMPSimpleServerHTTPTest.r</option>
<option value="listing144.html">/MIB-Libraries/MoreOpenTransport/OTMPSimpleServerHTTP/Sample HTTP Source/index.html</option>
<option value="listing145.html">/MIB-Libraries/MoreOpenTransport/OTMPTest/OTMPTest.c</option>
<option value="listing146.html">/MIB-Libraries/MoreOpenTransport/Read_Me_About_OTMP.html</option>
<option value="listing147.html">/MIB-Libraries/MoreOpenTransport/ReadMeOTClassicContext.html</option>
<option value="listing148.html">/MIB-Libraries/MoreOSL/MoreOSL.c</option>
<option value="listing149.html">/MIB-Libraries/MoreOSL/MoreOSL.h</option>
<option value="listing150.html">/MIB-Libraries/MoreOSL/MoreOSLHelpers.c</option>
<option value="listing151.html">/MIB-Libraries/MoreOSL/MoreOSLHelpers.h</option>
<option value="listing152.html">/MIB-Libraries/MoreOSL/MoreOSLStringComp.applescript</option>
<option value="listing153.html">/MIB-Libraries/MoreOSL/MoreOSLStringCompare.c</option>
<option value="listing154.html">/MIB-Libraries/MoreOSL/MoreOSLStringCompare.h</option>
<option value="listing155.html">/MIB-Libraries/MoreOSL/MoreOSLTokens.c</option>
<option value="listing156.html">/MIB-Libraries/MoreOSL/MoreOSLTokens.h</option>
<option value="listing157.html">/MIB-Libraries/MoreOSL/ReadMe.html</option>
<option value="listing158.html">/MIB-Libraries/MoreOSL/TestMoreOSL/Test Script.applescript</option>
<option value="listing159.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSL.c</option>
<option value="listing160.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSLTerminology.h</option>
<option value="listing161.html">/MIB-Libraries/MoreOSL/TestMoreOSL/TestMoreOSLTerminology.r</option>
<option value="listing162.html">/MIB-Libraries/MoreOSUtils/MoreOSUtils.c</option>
<option value="listing163.html">/MIB-Libraries/MoreOSUtils/MoreOSUtils.h</option>
<option value="listing164.html">/MIB-Libraries/MoreOSUtils/TestMoreOSUtils/TestMoreOSUtils.c</option>
<option value="listing165.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.c</option>
<option value="listing166.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.h</option>
<option value="listing167.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatches.s</option>
<option value="listing168.html">/MIB-Libraries/MorePatches/MoreCFMPatches/MoreCFMPatchesTest/MoreCFMPatchesTest.c</option>
<option value="listing169.html">/MIB-Libraries/MorePreferences/MorePreferences.cp</option>
<option value="listing170.html">/MIB-Libraries/MorePreferences/MorePreferences.h</option>
<option value="listing171.html">/MIB-Libraries/MoreProcesses/MoreProcesses.cp</option>
<option value="listing172.html">/MIB-Libraries/MoreProcesses/MoreProcesses.h</option>
<option value="listing173.html">/MIB-Libraries/MoreProcesses/MoreScheduledExec.c</option>
<option value="listing174.html">/MIB-Libraries/MoreProcesses/MoreScheduledExec.h</option>
<option value="listing175.html">/MIB-Libraries/MoreProcesses/TestMoreScheduledExec/TestMoreScheduledExec.c</option>
<option value="listing176.html">/MIB-Libraries/MoreQuickDraw/MoreQuickDraw.cp</option>
<option value="listing177.html">/MIB-Libraries/MoreQuickDraw/MoreQuickDraw.h</option>
<option value="listing178.html">/MIB-Libraries/MoreResources/MoreResources.c</option>
<option value="listing179.html">/MIB-Libraries/MoreResources/MoreResources.h</option>
<option value="listing180.html">/MIB-Libraries/MoreSCF/MoreSCF.c</option>
<option value="listing181.html">/MIB-Libraries/MoreSCF/MoreSCF.h</option>
<option value="listing182.html">/MIB-Libraries/MoreSCF/MoreSCFCCLScanner.c</option>
<option value="listing183.html">/MIB-Libraries/MoreSCF/MoreSCFCCLScanner.h</option>
<option value="listing184.html">/MIB-Libraries/MoreSCF/MoreSCFDigest.c</option>
<option value="listing185.html">/MIB-Libraries/MoreSCF/MoreSCFDigest.h</option>
<option value="listing186.html">/MIB-Libraries/MoreSCF/MoreSCFHelpers.c</option>
<option value="listing187.html">/MIB-Libraries/MoreSCF/MoreSCFHelpers.h</option>
<option value="listing188.html">/MIB-Libraries/MoreSCF/MoreSCFPortScanner.c</option>
<option value="listing189.html">/MIB-Libraries/MoreSCF/MoreSCFPortScanner.h</option>
<option value="listing190.html">/MIB-Libraries/MoreSCF/MoreSCFTest/MoreSCFTest.c</option>
<option value="listing191.html">/MIB-Libraries/MoreSCF/ReadMeAboutMoreSCF.html</option>
<option value="listing192.html">/MIB-Libraries/MoreSecurity/MoreSecurity.c</option>
<option value="listing193.html">/MIB-Libraries/MoreSecurity/MoreSecurity.h</option>
<option value="listing194.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTest.c</option>
<option value="listing195.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTestCommon.h</option>
<option value="listing196.html">/MIB-Libraries/MoreSecurity/MoreSecurityTest/MoreSecurityTestTool.c</option>
<option value="listing197.html">/MIB-Libraries/MoreSecurity/ReadMeAboutMoreAuthSample.html</option>
<option value="listing198.html">/MIB-Libraries/MoreSetup.h</option>
<option value="listing199.html">/MIB-Libraries/MoreSetup.r</option>
<option value="listing200.html">/MIB-Libraries/MoreSound/MoreSound.cp</option>
<option value="listing201.html">/MIB-Libraries/MoreSound/MoreSound.h</option>
<option value="listing202.html">/MIB-Libraries/MoreTextUtils/MoreTextUtils.cp</option>
<option value="listing203.html">/MIB-Libraries/MoreTextUtils/MoreTextUtils.h</option>
<option value="listing204.html">/MIB-Libraries/MoreTextUtils/TestMoreTextUtils/TestMoreTextUtils.c</option>
<option value="listing205.html">/MIB-Libraries/MoreTextUtils/TestMoreTextUtils/TestMoreTextUtils.r</option>
<option value="listing206.html">/MIB-Libraries/MoreToolbox/MoreToolbox.cp</option>
<option value="listing207.html">/MIB-Libraries/MoreToolbox/MoreToolbox.h</option>
<option value="listing208.html">/MIB-Libraries/MoreUNIX/MoreUNIX.c</option>
<option value="listing209.html">/MIB-Libraries/MoreUNIX/MoreUNIX.h</option>
<option value="listing210.html">/MIB-Libraries/MoreWindows/MoreWindows.cp</option>
<option value="listing211.html">/MIB-Libraries/MoreWindows/MoreWindows.h</option>
<option value="listing212.html">/MIB-Libraries/NetworkSetup/MoreNetworkSetup.c</option>
<option value="listing213.html">/MIB-Libraries/NetworkSetup/MoreNetworkSetup.h</option>
<option value="listing214.html">/MIB-Libraries/NetworkSetup/Network Setup SDK Bits/ Read Me.txt</option>
<option value="listing215.html">/MIB-Libraries/NetworkSetup/Network Setup SDK Bits/NetworkSetupBigPicture.html</option>
<option value="listing216.html">/MIB-Libraries/NetworkSetup/NetworkSetupHelpers.c</option>
<option value="listing217.html">/MIB-Libraries/NetworkSetup/NetworkSetupHelpers.h</option>
<option value="listing218.html">/MIB-Libraries/NetworkSetup/NetworkSetupTest/NetworkSetupTest.c</option>
<option value="listing219.html">/MIB-Libraries/NetworkSetup/OldStyleAPI/OldOTConfigLib.h</option>
<option value="listing220.html">/MIB-Libraries/NetworkSetup/ReadMe.html</option>
<option value="listing221.html">/MIB-Libraries/PascalInterfaces/MoreSetup.p</option>
<option value="listing222.html">/MIB-Libraries/PascalInterfaces/TradDriverLoaderLib.p</option></select>
				</p>
				</form>
				<p><strong><a href="MoreIsBetter.zip">Download Sample</a></strong> (&#147;MoreIsBetter.zip&#148;, 1.61M)<BR>
<strong><a href="MoreIsBetter.dmg">Download Sample</a></strong> (&#147;MoreIsBetter.dmg&#148;, 2.04M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*
  File:    MoreCDs.c

  Contains:  CD-ROM driver utilities.

  Written by:  Quinn

  Copyright:  Copyright (c) 2001 by Apple Computer, Inc., All Rights Reserved.

  Disclaimer:  IMPORTANT:  This Apple software is supplied to you by Apple Computer, Inc.
        (&quot;Apple&quot;) in consideration of your agreement to the following terms, and your
        use, installation, modification or redistribution of this Apple software
        constitutes acceptance of these terms.  If you do not agree with these terms,
        please do not use, install, modify or redistribute this Apple software.

        In consideration of your agreement to abide by the following terms, and subject
        to these terms, Apple grants you a personal, non-exclusive license, under Apple's
        copyrights in this original Apple software (the &quot;Apple Software&quot;), to use,
        reproduce, modify and redistribute the Apple Software, with or without
        modifications, in source and/or binary forms; provided that if you redistribute
        the Apple Software in its entirety and without modifications, you must retain
        this notice and the following text and disclaimers in all such redistributions of
        the Apple Software.  Neither the name, trademarks, service marks or logos of
        Apple Computer, Inc. may be used to endorse or promote products derived from the
        Apple Software without specific prior written permission from Apple.  Except as
        expressly stated in this notice, no other rights or licenses, express or implied,
        are granted by Apple herein, including but not limited to any patent rights that
        may be infringed by your derivative works or by other works in which the Apple
        Software may be incorporated.

        The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO
        WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED
        WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR
        PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE OR IN
        COMBINATION WITH YOUR PRODUCTS.

        IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR
        CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
        GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
        ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION
        OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER UNDER THEORY OF CONTRACT, TORT
        (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN
        ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

  Change History (most recent first):

$Log: MoreCDs.c,v $
Revision 1.4  2002/11/08 23:28:12         
Include our prototype early to flush out any missing dependencies. Only include TradDriverLoaderLib if not compiling Carbon. Convert nil to NULL. Convert MoreAssertQ to assert.

Revision 1.3  2001/11/07 15:51:32         
Tidy up headers, add CVS logs, update copyright.


         &lt;2&gt;     21/9/01    Quinn   Changes for CWPro7 Mach-O build.
         &lt;1&gt;      5/7/01    Quinn   First checked in.
*/

/////////////////////////////////////////////////////////////////

// Our Prototypes

#include &quot;MoreCDs.h&quot;

// Mac OS Interfaces

#if ! MORE_FRAMEWORK_INCLUDES
  #include &lt;Devices.h&gt;
  #include &lt;TextUtils.h&gt;
#endif

// MIB Prototypes

#include &quot;MoreMemory.h&quot;

#if !TARGET_API_MAC_CARBON
  #include &quot;TradDriverLoaderLib.h&quot;
#endif

/////////////////////////////////////////////////////////////////

extern pascal UInt8 MoreCDsBCDToByte(UInt8 bcd)
  // See comment in header.
{
  UInt8 firstDigit;
  UInt8 secondDigit;
  
  firstDigit  = ((bcd &gt;&gt; 4) &amp; 0x0F);
  secondDigit =  (bcd &amp; 0x0F);

  assert(firstDigit &lt; 10);
  assert(secondDigit &lt; 10);

  return (firstDigit * 10) + secondDigit;
}

extern pascal UInt8 MoreCDsByteToBCD(UInt8 byte)
  // See comment in header.
{
  assert(byte &lt; 100);
  return ((byte / 10) &lt;&lt; 4) | (byte % 10);
}

extern pascal void MoreCDsLBATimeToMSFTime(CDLBATime lbaTime, CDMSFTime *msfTime)
  // See comment in header.
{
  assert(msfTime != NULL);
  
  // I force all arithmetic to type long for voodoo reasons.  
  // I've been bitten by this too many times.

  msfTime-&gt;minutes  = (lbaTime / 75L) / 60L;
  msfTime-&gt;seconds  = (lbaTime / 75L) % 60L;
  msfTime-&gt;frames    =  lbaTime % 75L;
}

extern pascal CDLBATime MoreCDsMSFTimeToLBATime(const CDMSFTime *msfTime)
  // See comment in header.
{
  CDLBATime result;
  
  assert(msfTime-&gt;seconds &lt; 60);
  assert(msfTime-&gt;frames  &lt; 75);
  
  // I force all arithmetic to type long for voodoo reasons.  
  // I've been bitten by this too many times.

  result =  ((CDLBATime) msfTime-&gt;minutes) * 75L * 60L
      + ((CDLBATime) msfTime-&gt;seconds) * 75L
      + ((CDLBATime) msfTime-&gt;frames);
  
  // To catch any arithmetic errors (surprisingly common in routines like this) 
  // I've added code to check the results of this routine against the inverse 
  // operation, MoreCDsLBATimeToMSFTime.
    
  #if MORE_DEBUG
    {
      CDMSFTime msfTmp;
      
      MoreCDsLBATimeToMSFTime(result, &amp;msfTmp);
      assert(msfTmp.minutes == msfTime-&gt;minutes);
      assert(msfTmp.seconds == msfTime-&gt;seconds);
      assert(msfTmp.frames  == msfTime-&gt;frames );
    }
  #endif

  return result;
}

extern pascal CDLBATime MoreCDsMinSecFrameToLBATime(UInt8 minutes, UInt8 seconds, UInt8 frames)
  // See comment in header.
{
  CDMSFTime tmp;
  
  tmp.control = 0;
  tmp.minutes = minutes;
  tmp.seconds = seconds;
  tmp.frames  = frames;
  return MoreCDsMSFTimeToLBATime(&amp;tmp);
}

extern pascal void MoreCDsMSFTimeFromBCD(CDMSFTime *msfTime)
  // See comment in header.
{
  msfTime-&gt;minutes = MoreCDsBCDToByte(msfTime-&gt;minutes);
  msfTime-&gt;seconds = MoreCDsBCDToByte(msfTime-&gt;seconds);
  msfTime-&gt;frames  = MoreCDsBCDToByte(msfTime-&gt;frames );
}

extern pascal void MoreCDsMSFTimeToBCD(CDMSFTime *msfTime)
  // See comment in header.
{
  msfTime-&gt;minutes = MoreCDsByteToBCD(msfTime-&gt;minutes);
  msfTime-&gt;seconds = MoreCDsByteToBCD(msfTime-&gt;seconds);
  msfTime-&gt;frames  = MoreCDsByteToBCD(msfTime-&gt;frames );
}

#if !TARGET_API_MAC_CARBON

extern pascal OSStatus MoreCDsReadTOCFirstAndLastTrack(SInt16 driveNum, UInt16 *firstTrack, UInt16 *lastTrack, UInt16 *trackCount)
  // See comment in header.
{
  OSStatus     err;
  ParamBlockRec pb;
  UInt16      localFirstTrack;
  UInt16      localLastTrack;
  
  pb.cntrlParam.ioNamePtr  = NULL;
  pb.cntrlParam.ioVRefNum  = driveNum;
  pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
  pb.cntrlParam.csCode     = kReadTOC;
  pb.cntrlParam.csParam[0] = kCDReadTOCFirstAndLastTrack;
  err = PBControlSync(&amp;pb);
  if (err == noErr) {
    localFirstTrack = MoreCDsBCDToByte((pb.cntrlParam.csParam[0] &gt;&gt; 8) &amp; 0x0FF);
    localLastTrack  = MoreCDsBCDToByte( pb.cntrlParam.csParam[0] &amp; 0x0FF);
    if (firstTrack != NULL) {
      *firstTrack = localFirstTrack;
    }
    if (lastTrack != NULL) {
      *lastTrack  = localLastTrack;
    }
    if (trackCount != NULL) {
      *trackCount = localLastTrack - localFirstTrack + 1;
    }
  }
  return err;
}

extern pascal OSStatus MoreCDsReadTOCLastSessionLeadOut(SInt16 driveNum, CDLBATime *leadOut)
  // See comment in header.
{
  OSStatus        err;
  ParamBlockRec      pb;
  CDMSFTime       leadOutTmp;
  
  // Most of the other calls support parameters being NULL if you don't want 
  // the value.  However, this routine only returns one parameter, so if 
  // you don't want its value don't call it!
  assert(leadOut != NULL);

  pb.cntrlParam.ioNamePtr  = NULL;
  pb.cntrlParam.ioVRefNum  = driveNum;
  pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
  pb.cntrlParam.csCode     = kReadTOC;
  pb.cntrlParam.csParam[0] = kCDReadTOCLastSessionLeadOut;
  err = PBControlSync(&amp;pb);
  if (err == noErr) {
    leadOutTmp.control = 0;
    // Move the first three bytes of csParam into the minutes, 
    // seconds, and frames fields of leadOutTmp.
    BlockMoveData(&amp;pb.cntrlParam.csParam[0], &amp;leadOutTmp.minutes, 3);
    MoreCDsMSFTimeFromBCD(&amp;leadOutTmp);
    *leadOut = MoreCDsMSFTimeToLBATime(&amp;leadOutTmp);
  }
  return err;

}

extern pascal OSStatus MoreCDsReadTOCTrackStarts(SInt16 driveNum, UInt16 firstTrack, UInt16 trackCount, 
                  CDMSFTime trackStarts[])
  // See comment in header.
{
  OSStatus      err;
  ParamBlockRec    pb;
  UInt16       trackIndex;
  
  assert(trackStarts != NULL);
  assert(sizeof(CDMSFTime) == 4);

  pb.cntrlParam.ioNamePtr  = NULL;
  pb.cntrlParam.ioVRefNum  = driveNum;
  pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
  pb.cntrlParam.csCode     = kReadTOC;
  pb.cntrlParam.csParam[0] = kCDReadTOCTrackStarts;
  *((CDMSFTime **) &amp;pb.cntrlParam.csParam[1]) = trackStarts;
  pb.cntrlParam.csParam[3] = trackCount * sizeof(CDMSFTime);
  pb.cntrlParam.csParam[4] = MoreCDsByteToBCD(firstTrack) &lt;&lt; 8;
  err = PBControlSync(&amp;pb);
  if (err == noErr) {
    // Convert results from BCD to binary.
    for (trackIndex = 0; trackIndex &lt; trackCount; trackIndex++) {
      MoreCDsMSFTimeFromBCD(&amp;trackStarts[trackIndex]);
    }
  }
  return err;
}

extern pascal OSStatus MoreCDsReadTOCSessionInfo(SInt16 driveNum, UInt16 *firstSession, UInt16 *lastSession, 
                          UInt16 *firstTrackOfLastSession,
                          CDMSFTime *infoForFirstTrackOfLastSession)
  // See comment in header.
{
  OSStatus        err;
  ParamBlockRec      pb;
  
  assert(sizeof(*infoForFirstTrackOfLastSession) == 4);

  pb.cntrlParam.ioNamePtr  = NULL;
  pb.cntrlParam.ioVRefNum  = driveNum;
  pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
  pb.cntrlParam.csCode     = kReadTOC;
  pb.cntrlParam.csParam[0] = kCDReadTOCSessionInfo;
  err = PBControlSync(&amp;pb);
  if (err == noErr) {
    if (firstSession != NULL) {
      *firstSession            = MoreCDsBCDToByte(pb.cntrlParam.csParam[0]);
    }
    if (lastSession != NULL) {
      *lastSession             = MoreCDsBCDToByte(pb.cntrlParam.csParam[1]);
    }
    if (firstTrackOfLastSession != NULL) {
      *firstTrackOfLastSession = MoreCDsBCDToByte(pb.cntrlParam.csParam[2]);
    }
    if (infoForFirstTrackOfLastSession != NULL) {
      BlockMoveData(&amp;pb.cntrlParam.csParam[3], infoForFirstTrackOfLastSession, sizeof(*infoForFirstTrackOfLastSession));
      MoreCDsMSFTimeFromBCD(infoForFirstTrackOfLastSession);
    }
  }
  return err;

}

static void TransferTOCEntry(Ptr source, CDTOCEntry *dest)
{
  // Copy entry from buffer to the caller's array.
  
  BlockMoveData(source, dest, kCDTOCEntrySize);
  
  // Now un-BCDify each of the fields in the client's entry.
  // But only if they're a reasonably values.  The point field 
  // is either a BCD encoded track number, or a magic number like 
  // $A0, $A1, or $A2.  So we only de-BCD point if its in the 
  // track range.  Also, tracks beyond the last track have 255 in
  // the MSF fields which we leave there to a) signify to the caller
  // that these fields aren't meaningful, and b) avoid an assert 
  // in MoreCDsBCDToByte.
  
  if (dest-&gt;point &lt;= 0x99) {
    dest-&gt;point    = MoreCDsBCDToByte(dest-&gt;point);
  }
  if (dest-&gt;pMinutes != 255) {
    dest-&gt;pMinutes   = MoreCDsBCDToByte(dest-&gt;pMinutes);
  }
  if (dest-&gt;pSeconds != 255) {
    dest-&gt;pSeconds   = MoreCDsBCDToByte(dest-&gt;pSeconds);
  }
  if (dest-&gt;pFrames  != 255) {
    dest-&gt;pFrames   = MoreCDsBCDToByte(dest-&gt;pFrames);
  }
}

extern pascal OSStatus MoreCDsReadTOCEntireTOC(SInt16 driveNum, MoreCDsEntireTOC *entireTOC)
  // See comment in header.
{
  OSStatus      err;
  ParamBlockRec    pb;
  Ptr         buffer;
  ItemCount     entryIndex;
  Ptr          pointerToEntryInBuffer;
  
  assert(entireTOC != NULL);
  
  buffer = NewPtrClear(512);
  err = MoreMemError(buffer);
  if (err == noErr) {
    pb.cntrlParam.ioNamePtr  = NULL;
    pb.cntrlParam.ioVRefNum  = driveNum;
    pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
    pb.cntrlParam.csCode     = kReadTOC;
    pb.cntrlParam.csParam[0] = kCDReadTOCEntireTOC;
    *((Ptr *) &amp;pb.cntrlParam.csParam[1]) = buffer;
    err = PBControlSync(&amp;pb);
  }
  if (err == noErr) {
    pointerToEntryInBuffer = buffer + 1;    // Point to first entry in buffer.

    // Transfer TOC entries for points A0, A1, and A2.
    //
    // When stepping to the next entry in buffer, we have to do 
    // use pointer arithmetic rather than array indexing because 
    // kCDTOCEntrySize is 5, and there's no way to get the 
    // compiler to index an array whose elements are of an odd size.
    
    TransferTOCEntry(pointerToEntryInBuffer, &amp;entireTOC-&gt;a0);
    pointerToEntryInBuffer += kCDTOCEntrySize;

    TransferTOCEntry(pointerToEntryInBuffer, &amp;entireTOC-&gt;a1);
    pointerToEntryInBuffer += kCDTOCEntrySize;
    
    TransferTOCEntry(pointerToEntryInBuffer, &amp;entireTOC-&gt;a2);
    pointerToEntryInBuffer += kCDTOCEntrySize;

    // Now transfer each of the tracks.
    
    for (entryIndex = 0; entryIndex &lt; 99; entryIndex++) {
      TransferTOCEntry(pointerToEntryInBuffer, &amp;entireTOC-&gt;tracks[entryIndex]);
      pointerToEntryInBuffer += kCDTOCEntrySize;
    }
  }
  
  // Clean up.
  
  if (buffer != NULL) {
    DisposePtr(buffer);
    assert( MemError() == noErr );
  }
  return err;
}

extern pascal OSStatus MoreCDsReadTOCAllQSubCodeEntries(SInt16 driveNum, UInt16 firstSession, 
                      ItemCount entriesRequested,
                      ItemCount *entriesReturned,
                      CDQSubCodeEntry entries[])
  // See comment in header.
{
  OSStatus      err;
  ParamBlockRec    pb;
  Ptr         buffer;
  ByteCount     bufferSize;
  ItemCount     entryIndex;
  ByteCount     numberOfBytesOfEntriesReturned;
  ItemCount     entriesToCopy;
  Ptr         pointerToEntryInBuffer;
  CDQSubCodeEntry* thisEntry;
  
  assert(entriesReturned != NULL);
  assert(entries != NULL);
  assert(sizeof(CDMSFTime) == 4);

  bufferSize = 4 + entriesRequested * kCDQSubCodeEntrySize;
  assert(bufferSize &lt;= 32767);
  
  buffer = NewPtr(bufferSize);
  err = MoreMemError(buffer);
  if (err == noErr) {
    pb.cntrlParam.ioNamePtr  = NULL;
    pb.cntrlParam.ioVRefNum  = driveNum;
    pb.cntrlParam.ioCRefNum  = MoreGetDriveRefNum(driveNum);
    pb.cntrlParam.csCode     = kReadTOC;
    pb.cntrlParam.csParam[0] = kCDReadTOCAllQSubCodeEntries;
    *((Ptr *) &amp;pb.cntrlParam.csParam[1]) = buffer;
    pb.cntrlParam.csParam[3] = bufferSize;
    pb.cntrlParam.csParam[4] = MoreCDsByteToBCD(firstSession) &lt;&lt; 8;
    err = PBControlSync(&amp;pb);
  }
  if (err == noErr) {
    // Get the count of the number of bytes of Q sub-code entries returned, 
    // from the first two bytes of the buffer.  Note that this the count 
    // in the buffer includes two header bytes (the first and last session 
    // number), which we subtract away to get the number of bytes of 
    // actual Q sub-code entries.
    
    numberOfBytesOfEntriesReturned = *((UInt16 *) buffer) - 2;
    
    // We should have got an even number of entries back.  Let the caller 
    // know that number.  Note that &quot;/&quot; rounds down, so if the assert isn't 
    // true then we'll only return the whole entries that we found.
    
    assert( (numberOfBytesOfEntriesReturned % kCDQSubCodeEntrySize) == 0 );
    *entriesReturned = numberOfBytesOfEntriesReturned / kCDQSubCodeEntrySize;
    
    // CD-ROM driver returns the byte count of the number of entries available, 
    // which isn't really what the documentation says but we can handle it.  
    // Basically, if we get more entries back that we asked for, lets just copy 
    // the entries we have space for.  But we want to return the full count of 
    // entries in entriesReturned so that the client knows that they've missed some.
    
    entriesToCopy = *entriesReturned;
    if (entriesToCopy &gt; entriesRequested) {
      entriesToCopy = entriesRequested;
    }
    
    pointerToEntryInBuffer = buffer + 4;    // Point to first entry in buffer.
    for (entryIndex = 0; entryIndex &lt; entriesToCopy; entryIndex++) {
      
      // Copy entry from buffer to the caller's array.
      
      thisEntry = &amp;entries[entryIndex];
      BlockMoveData(pointerToEntryInBuffer, thisEntry, kCDQSubCodeEntrySize);
      
      // Now un-BCDify each of the fields in the client's entry.

      thisEntry-&gt;trackNumber   = MoreCDsBCDToByte(thisEntry-&gt;trackNumber);
      thisEntry-&gt;minutes       = MoreCDsBCDToByte(thisEntry-&gt;minutes);
      thisEntry-&gt;seconds       = MoreCDsBCDToByte(thisEntry-&gt;seconds);
      thisEntry-&gt;frames     = MoreCDsBCDToByte(thisEntry-&gt;frames);
      thisEntry-&gt;zero     = MoreCDsBCDToByte(thisEntry-&gt;zero);
      thisEntry-&gt;pMinutes   = MoreCDsBCDToByte(thisEntry-&gt;pMinutes);
      thisEntry-&gt;pSeconds   = MoreCDsBCDToByte(thisEntry-&gt;pSeconds);
      thisEntry-&gt;pFrames     = MoreCDsBCDToByte(thisEntry-&gt;pFrames);
      thisEntry-&gt;pad       = 0;

      // Step to the next entry in buffer.  We have to do this 
      // using pointer arithmetic rather than array indexing because 
      // kCDQSubCodeEntrySize is 11, and there's no way to get the 
      // compiler to index an array whose elements are of an odd size.
      
      pointerToEntryInBuffer += kCDQSubCodeEntrySize;
    }
  }
  
  // Clean up.
  
  if (buffer != NULL) {
    DisposePtr(buffer);
    assert( MemError() == noErr );
  }
  
  return err;
}

static OSStatus BuildTrackListFromStartsArray(UInt16 firstTrack, UInt16 trackCount, 
                      CDMSFTime *          trackStarts,
                      CDLBATime          endOfLastTrack,
                      MoreCDsAudioTrackListHandle trackList)
  // This routine builds a track list array in the trackList handle 
  // based on the track information supplied in firstTrack, trackCount, 
  // trackStarts, and endOfLastTrack.  The track numbers are one-based, 
  // although trackStarts is zero-based (confusing huh? wish I was 
  // programming in Pascal!).
{
  OSStatus  err;
  UInt16    trackIndex;
  CDLBATime thisTrackStartTime;
  CDLBATime nextTrackStartTime;
  
  assert(firstTrack &gt; 0);    // firstTrack is a track number, not an index into trackStarts
  assert(trackCount &gt; 0);    // If there are no audio tracks, we should not have been called.
  
  SetHandleSize( (Handle) trackList, trackCount * sizeof(MoreCDsAudioTrackEntry) );
  err = MemError();
  if (err == noErr) {
    // Now fill out all of the previous entries in the track list 
    // array, using the algorithm that length(track N) is 
    // start(track N + 1) - start(track N).  Note that the last track 
    // is special because its end is actually the start of the lead out.
    
    nextTrackStartTime = endOfLastTrack;
    trackIndex = trackCount;
    while (trackIndex != 0) {
      trackIndex -= 1;
      (*trackList)[trackIndex].trackNumber = firstTrack + trackIndex;
      thisTrackStartTime                   = MoreCDsMSFTimeToLBATime(&amp;trackStarts[(firstTrack - 1) + trackIndex]);
      (*trackList)[trackIndex].trackStart  = thisTrackStartTime;
      (*trackList)[trackIndex].trackLength = nextTrackStartTime - thisTrackStartTime;
      nextTrackStartTime = thisTrackStartTime;
    }
  }
  return err;
}

static void AdjustEndOfLastAudioTrackOnEnhancedCD(SInt16 driveNum, UInt16 lastAudioTrack, CDLBATime *endOfLastAudioTrack)
  // There are a variety of ways to mix audio and data tracks on a CD.  One common 
  // method is known as a &quot;pressed multisession CD&quot;, specified in the Blue Book and 
  // marketted under various names like &quot;Enhanced CD&quot; or &quot;CD Extra&quot;.  In this approach 
  // the CD contains two sessions: the first session contains audio tracks and the 
  // second session contains a data track (typically in ISO-9660 format).  To retain 
  // compatibility with existing CD players, there is an extended lead out (150 seconds) 
  // after the last audio track and before the first data track.  [My understanding is 
  // that really old and dumb CD players require this lead out to detect the end of the 
  // disc.]  Moreover, there is a second lead out after the last data track.
  //
  // This structure causes problems for the traditional algorithm for calculating track 
  // lengths:
  // 
  // 1. length(track N) := start(track N+1) - start(track N)
  // 2. length of last track := start(lead out) - start(last track)
  // 
  // because start(lead out) (as returned by MoreCDsLastSessionLeadOut) is the start of 
  // the second lead out (after the data tracks) not the start of the first lead out.
  // 
  // To get around this problem we read a low-level representation of the TOC and 
  // look for the A2 TOC entry.  The Read Book (CD-DA) standard defines that point 
  // A2 references the start of the lead out, and for an Enhanced CD this lead out 
  // is the one between the audio and the data.  This address becomes the end of 
  // the last audio track as far as our calculations are concerned.
  //
  // Note that the driver calls required by this routine are not supported on 
  // all Apple CD players, so this routine is expected to fail on that hardware.
  // Rather than fail the entire operation, however, this routine is defined to 
  // ignore the error and preserve the value in *endOfLastAudioTrack.  If 
  // you're running on old hardware you may get a bogus last track length for 
  // Enhanced CDs (then again, maybe the old hardware will only see the first 
  // lead out, and so give the right result -- I don't have access to the old 
  // hardware on which to test this).
{
  OSStatus     err;
  UInt16      sessionCount;
  UInt16      sessionIndex;
  CDQSubCodeEntry qSubCodeEntries[3];
  ItemCount    qSubCodeEntriesReturned;

  // Start by getting a count of the sessions on the disc.
  
  err = MoreCDsReadTOCSessionInfo(driveNum, NULL, &amp;sessionCount, NULL, NULL);
  if (err == noErr) {
  
    // Now iterate over each session that has an A1 and A2 TOC entry, looking 
    // for a session whose A1 TOC entry refers to our last audio track.  If we 
    // find that session then its A2 TOC entry is the start of the audio lead out.
    //
    // For those unfamiliar with the Red Book (CD-DA) standard, TOC entry A0 
    // holds the first track number in its PMIN field (pMinutes in our data 
    // structure), TOC entry A1 holds the last track number, and TOC entry A2 
    // holds the address of the audio lead out.
    //
    // Note that MoreCDsAllQSubCodeEntries returns A0, A1, and A2 in that order 
    // before the actual track TOC entries.  In this case we're only asking 
    // for 3 entries so we only get those entries.
    // 
    // This gist of this code was stolen from the &quot;Audio CD Extension&quot;.
    
    for (sessionIndex = 1; sessionIndex &lt;= sessionCount; sessionIndex++) {
      err = MoreCDsReadTOCAllQSubCodeEntries(driveNum, sessionIndex, 3, &amp;qSubCodeEntriesReturned, qSubCodeEntries);
      if (   (err == noErr)                    // If driver supports call, and
        &amp;&amp; (qSubCodeEntriesReturned  &gt;= 3)            // Enough TOC entries for audio on this session, and
        &amp;&amp; (qSubCodeEntries[1].point == 0xA1)          // TOC entry A1 is present, and
        &amp;&amp; (qSubCodeEntries[2].point == 0xA2)          // TOC entry A1 is present, and
        &amp;&amp; (lastAudioTrack == qSubCodeEntries[1].pMinutes)    // Right Ax TOC entries.
         ) {
        *endOfLastAudioTrack = MoreCDsMinSecFrameToLBATime(qSubCodeEntries[2].pMinutes, qSubCodeEntries[2].pSeconds, qSubCodeEntries[2].pFrames);
        break;
      }
    }
  }
  // Ignore error.  See comments above.
}

extern pascal OSStatus MoreCDsAudioTrackList(SInt16 driveNum, MoreCDsAudioTrackListHandle trackList)
  // See comment in header.
{
  OSStatus     err;
  UInt16      firstTrack;
  UInt16      trackCount;
  UInt16       firstAudioTrack;
  UInt16      audioTrackCount;
  UInt16      trackIndex;
  CDMSFTime *    trackStarts;
  CDLBATime    endOfLastAudioTrack;
  Boolean      allAudioTracks;
  Boolean      allDataTracks;

  trackStarts = NULL;

  // Get the first track number and a count of the tracks.
      
  err = MoreCDsReadTOCFirstAndLastTrack(driveNum, &amp;firstTrack, NULL, &amp;trackCount);
  if (trackCount == 0) {
    err = -1;        // We're not going anywhere near a disc with no tracks!
  }

  // Read each track's control info and start time into trackStarts.
  
  if (err == noErr) {
    trackStarts = (CDMSFTime *) NewPtr(sizeof(*trackStarts) * trackCount);
    err = MoreMemError(trackStarts);
  }
  if (err == noErr) {
    err = MoreCDsReadTOCTrackStarts(driveNum, firstTrack, trackCount, trackStarts);
  }

  // Scan the track list to determine whether all tracks are audio or data.
  
  if (err == noErr) {
    allAudioTracks = true;
    allDataTracks = true;
    
    for (trackIndex = 0; trackIndex &lt; trackCount; trackIndex++) {
      if (trackStarts[trackIndex].control &amp; kCDControlDataTrackMask) {
        allAudioTracks = false;
      } else {
        allDataTracks = false;
      }
    }
    if (allDataTracks) {
      err = -2;      // If the disc is just a data disc, return an error.
    }
  }

  // Get the start of the last session's lead out.  For a normal 
  // (single session) audio disc this is the end of the last audio track.
  
  if (err == noErr) {
    err = MoreCDsReadTOCLastSessionLeadOut(driveNum, &amp;endOfLastAudioTrack);
  }

  if (err == noErr) {

    // If no error at this point, then we know that we have at least one 
    // audio track.  Let's establish preliminary values for firstAudioTrack 
    // and audioTrackCount.
    
    firstAudioTrack = firstTrack;
    audioTrackCount = trackCount;
    
    // If we have any data tracks, go make some adjustments (voodoo).
    
    if (!allAudioTracks) {
      // If the disc starts with data tracks, remove them from the beginning of the disc 
      // by incrementing firstAudioTrack and decrementing audioTrackCount.  This handles 
      // discs like &quot;Phil and Dave's Excellent CD&quot;, where the first track is a 
      // data track.
      
      while (    (audioTrackCount &gt; 0)
          &amp;&amp; ((trackStarts[firstAudioTrack - 1].control &amp; kCDControlDataTrackMask) != 0) ) {
        firstAudioTrack += 1;
        audioTrackCount -= 1;
      }
      if (audioTrackCount == 0) {
        // This is weird.  The first scan of the tracks indicates that there 
        // was an audio track, but now we can't find it.
        assert(false);
        err = -3;
      }
      
      // If the disc ends with data tracks, remove them from the end of the disc 
      // by decrementing audioTrackCount and by setting endOfLastAudioTrack to the start 
      // of the track we deleted.
      
      if (err == noErr) {
        // Set trackIndex to the index of the last track that we think is 
        // an audio track.  We subtract two because a) firstAudioTrack is one-based 
        // and trackStarts is zero-based, and b) track number + count - 1 is the track 
        // number of the last track.
        
        trackIndex = firstAudioTrack + audioTrackCount - 1 - 1;

        while ( (trackIndex &gt; 0) &amp;&amp; ((trackStarts[trackIndex].control &amp; kCDControlDataTrackMask) != 0)) {
          endOfLastAudioTrack = MoreCDsMSFTimeToLBATime(&amp;trackStarts[trackIndex]);
          audioTrackCount -= 1;
          trackIndex -= 1;
        }
      }
      
      // Now we handle a super-wacky special case involving Enhanced CDs. 
      // See the comments for the routine for more information.
      
      if (err == noErr) {
        AdjustEndOfLastAudioTrackOnEnhancedCD(driveNum, (firstAudioTrack + audioTrackCount - 1), &amp;endOfLastAudioTrack);
      }
    }
  }

  // Now place the results into the handle supplied by the user.
  
  if (err == noErr) {
    err = BuildTrackListFromStartsArray(firstAudioTrack, audioTrackCount, trackStarts, endOfLastAudioTrack, trackList);
  }

  // Clean up.
  
  if (trackStarts != NULL) {
    DisposePtr( (Ptr) trackStarts );
    assert( MemError() == noErr );
  }
  
  return err;
}


extern pascal void MoreIsDriveCDROM(SInt16 drive, MoreCDsCDROMResponse *response)
  // See comment in header.
{
  DriverRefNum refNum;
  DriverFlags drvrFlags;
  Str255 drvrName;
    DriverGestaltParam pb;
  
  assert(drive &gt; 0);
  assert(response != NULL);
  
  *response = kMoreDriveUnableToDetermineCDROM;
  
  refNum = MoreGetDriveRefNum(drive);
  if (refNum != 0) {
    if ( TradGetDriverInformation(refNum, NULL, &amp;drvrFlags, drvrName, NULL) == noErr ) {
    
      // Step 1 -- if the driver supports driver gestalt, we
      // exclusively rely on its response for the kdgDeviceType
      // selector.
      
      if ( TradDriverGestaltIsOn(drvrFlags) ) {
            pb.ioVRefNum = drive;
            pb.ioCRefNum = refNum;
            pb.csCode = kDriverGestaltCode;
            pb.driverGestaltSelector = kdgDeviceType;

            if ( PBStatusSync((ParmBlkPtr) &amp;pb) == noErr ) {
              if (GetDriverGestaltDevTResponse(&amp;pb)-&gt;deviceType == kdgCDType) {
                  *response = kMoreDriveIsCDROM;
              } else {
                  *response = kMoreDriveIsNotCDROM;
              }
            }
      }
      
      // Step 2 -- if the above didn't work, we only say it's a CD-ROM
      // if the driver is &quot;.AppleCD&quot;.

      if (*response == kMoreDriveUnableToDetermineCDROM) {
        if ( EqualString(drvrName, &quot;\p.AppleCD&quot;, false, true) ) {
                 *response = kMoreDriveIsCDROM;
        } else if ( EqualString(drvrName, &quot;\p.AFPTranslator&quot;, false, true) ) {
          // &quot;.AFPTranslator&quot; does not respond to Driver Gestalt,
          // which is pretty lame IMHO.  [Radar ID ]  Regardless,
          // we know it's not a CD-ROM.
                 *response = kMoreDriveIsNotCDROM;
        } else if ( EqualString(drvrName, &quot;\p.Sony&quot;, false, true) ) {
                 *response = kMoreDriveIsNotCDROM;
        }
      }
    }
  }
}

#endif
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MoreIsBetter/listing100.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MoreIsBetter/listing100.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MoreIsBetter/listing100.html%3Fid%3DDTS10000732-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>