<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW23: Routes From the Source</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW23: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Dec 30, 1991 - Jan 3, 1992"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002565" title="Routes From the Source"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW23</div>
<div id="pageheadsub">Routes From the Source</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Section1">Source Routing on Apple's TokenTalk Card</a><BR><BR><a href="#Conclusion">Conclusion</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note discusses source routing and its possible implementation intoken ring link layers.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jan 01 1992]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>"AppleTalk," in the words of Gursharan Sidhu, "is a network <b>system</b>." Assuch, it provides for multiple types of media and data links, and token ring isone such data link.</p><p>Source routing refers to a process on token ring networks where the source of apacket indicates, to any bridges between the source and the destination, theroute a packet must take to get from the source to the destination. Thedestination also uses this same route to transmit the response packet back tothe proper place. The presence of routing information is indicated by a 1 inthe most significant bit (MSB) of source address (SA) filed in the media accesscontrol (MAC) header. For nodes on the <b>same</b> ring, note that routinginformation is unnecessary.</p><p>Broadcast packets on a token ring always have their routing information bitturned on (Figure 1), indicating to bridges between the source and destinationnodes that the route is to be inserted into the packet. For non-broadcastpackets, each source node (SN) determines whether routing information isnecessary, and hence either puts a 1 into the MSB of the source address andappends the routing control field, or it doesn't. If the source routing bit isset to one, the routing information field (RC) is inserted between the sourceaddress (SA) field and the information field. With the source routing bit setto 0, the information field would immediately follow the source address (SA)field.</p><p>Each bridge puts its adjoining segment number into the next available SN fieldin the routing information field. Thus, a destination node <b>could</b> receivemultiple packets from multiple bridges, and thus have several routes back tothe source.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The term <i>broadcast</i>  here refers to link-level broadcasts.This is <b>not</b> to be confused with AppleTalk broadcasts to the<b>AppleTalk</b> address $FF. These types of broadcasts are destined only forAppleTalk nodes on the link, not necessarily all nodes on the link.)</P></TD></TR></TABLE></CENTER><BR><P align=center><img src="images/nw_23_001.gif" alt="Figure 1. Routing Information and Routing Control Fields." width=480 height=309></p><P align=center><b>Figure 1</b>.  Routing Information and Routing Control Fields</p><h3>Types of Broadcasts</h3><p>At present, packets can be broadcast in one of three ways. The type ofbroadcast is defined by three bits in the routing control field of the routinginformation field (see Figure 1).</p><p>The types of broadcasts are as follows:</p><p>100</p>	<P>All-routes broadcast, non-broadcast return. Broadcast packets of this typewill travel along any possible path to the destination; thus the number ofpackets received at the destination will equal the number of routes to thedestination node. Packets coming back to the source will travel along the sameroute, in reverse order, as they did going to the destination.</p><p>110</p>    <p>Single-route broadcast, all-routes broadcast return. Broadcast packets ofthis type will travel along a single route, passing through designated bridgesto the adjoining segment. Packets coming back to the source can possibly travelalong multiple paths to reach the source; thus, the first packet received backat the source will indicate the best route between the destination and thesource. A network administrator will set up the designated bridge as one thatwill forward this kind of broadcast. (Note that rev F of the <i>TMS380 AdapterChipset User's Guide Supplement</i>, which describes these bits on page 7-4,incorrectly documents the bits, 111, to this type of broadcast.)</p><p>111</p>    <P>Single-route broadcast, non-broadcast return. Broadcast packets of thistype will travel along a single route, passing through designated bridges tothe adjoining segment. Packets coming back to the source will travel along thesame route, in reverse order, as they did going to the destination. A networkadministrator will set up the designated bridge as one that will forward thiskind of broadcast. (Note that rev F of the <i>TMS380 Adapter Chipset User'sGuide Supplement</i>, which describes these bits on page 7-4, incorrectlydocuments the bits, 110, to this type of broadcast.)</p><p>For directed transmissions between several bridges, the broadcast bits are 000.This indicates that the route is already present in the segment numbers, andthe packet travels in a directed manner to the destination.</p><P><A HREF="#top">Back to top</A></P><a name="Section1"></a><h2>Source Routing on Apple's TokenTalk Card</h2><p>Apple's TokenTalk Card is built upon the Macintosh Coprocessor Platform. Muchof the TokenTalk software consists of dynamic A/ROSE tasks running on the card.Developers can use the services of TokenTalk Prep (documentation of which isavailable on the <i>TokenTalk NB Programmer's Guide</i>), and the actual sourcerouting is done with a SNAPXmit. SNAPXmit does the exact same thing as LLCXmit,but it doesn't do source routing for you, nor do you have to specify a serviceaccess point (SAP).</p><p>Essentially, we have two types of packets to transmit: broadcast packets andindividual directed packets.</p><p>For broadcast packets, which include functional address transmissions, groupaddress transmissions, and all-stations broadcast transmissions, we add sourcerouting information. For TokenTalk, the broadcast type is all-routes broadcast,non-broadcast return.</p><p>For individual directed packets, we have to determine if the destination is onour ring or not. If it is not then we must append the routing information tothe packet. Where does the route come from? If we've been smart, we've beengathering routes from any broadcast packet we receive, and saving them away. Wewant to have a couple of tables on which to store the information: a table thatmaps destination nodes to ring numbers (segment numbers), and a table that mapsring numbers to routes. If we are asked to transmit an individual packet, wesimply look up the destination ring number (compare it with our own ring numberto determine whether routing information is necessary) and then look up theroute for the ring we just looked up. Once we have a match, we just append therouting information and transmit the packet. Everything's hunky- dory.</p><p>"But," you ask, "what if I don't have the route?" That is, what if there's noring number mapped to the destination address? You'll have to find the bestroute and then send it along. We do this by queuing the original requestmomentarily, packing up a Logical Link Control (LLC) test command packet,putting the desired destination address into the packet, and setting thebroadcast type to "single-route broadcast, all-routes broadcast return." Thismeans we'll get back (potentially, if there's more than one route) manyresponses with routes in them. Hopefully the first such packet we receive willindicate the best route because it took the shortest amount of time to reachus.</p><p>Now, you're probably asking yourself: "What did you mean when you said, `Ifwe've been smart, we've been gathering routes from any broadcast packet wereceive'?" Even better, every TokenTalk packet broadcast at the link layer willhave this source routing information in it. Therefore, every TokenTalk packetwill contain the route back to the source and we can "glean" this informationand store it in our tables. This is where the direction bit comes in handy. Ifthe direction bit is 1, then the furthest segment is the last segment number inthe routing information field, that is, the rightmost. Conversely, if thedirection bit is 0, then the furthest segment is the first segment number inthe routing information field, that is, the leftmost. This furthest segmentindicates the ring number the source is actually on, and we can add this sourcering number to our table. We can also add (or update) our ring number to routetable.</p><p>"What if the entries in this table just sit around--potentially after a node isno longer reachable?" That's a good question. Again, we'll use a commonpractice for such tables: each entry in our table should have some "age"associated with it, and when the "age" gets too old, we delete the entry fromour table. The worst thing that can happen from such a deletion is we'll haveto go through the route discovery process again.</p><P><A HREF="#top">Back to top</A></P><a name="Conclusion"></a><h2>Conclusion</h2><p>Source routing is necessary for any token ring link to function. Thus,hopefully, you have a clear recipe here for implementing that functionality inyour code.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P><i>TokenTalk NB Programmer's Guide, </i> Chapter 2, "Source RoutingSupport", APDA, M0827LL/A</p><P><i>IBM Token-Ring Network Architecture Reference</i>, Chapter 3, "MACFrame Format", IBM Corporation, SC30-3374--01</p><P><i>TMS380 Adapter Chipset User's Guide</i>, Texas Instruments, SPWU001D</p><P><i>TMS380 Adapter Chipset User's Guide Supplement</i>, Chapter 7, TexasInstruments, SPWU003</p><P>J. Scott Haugdahl: <i>Inside the Token-Ring</i>, Chapter 3, "Standardsand Protocols", Architecture Technology Corporation, 1986</p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (120K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_23.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_23.html%3Fid%3DDTS10002565-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_23.html%3Fid%3DDTS10002565-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_23.html%3Fid%3DDTS10002565-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>