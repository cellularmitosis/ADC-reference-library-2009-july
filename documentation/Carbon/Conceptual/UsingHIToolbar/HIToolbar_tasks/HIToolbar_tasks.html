<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>HIToolbar Programming Guide: Toolbar Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Toolbar Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000310" title="Toolbar Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../HumanInterfaceToolbox-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000516" target="_top">Human Interface Toolbox</a> &gt; <a href="../HIToolbar_concept/HIToolbar_concept.html#//apple_ref/doc/uid/TP40000958-CH201-DontLinkElementID_2">HIToolbar Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../HIToolbar_concept/HIToolbar_concept.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../HIToolbar_apdx_a_history/HIToolbar_apdx_a_history.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_12" title="Toolbar Tasks"></a><h1><a name="//apple_ref/doc/uid/TP30000310-TPXREF101" title="Toolbar Tasks"></a>Toolbar Tasks</h1><p>This chapter describes how to create and manipulate toolbars. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-TPXREF119">How the Toolbar Works</a>
				
			<br/>
			
        
			
			
				<a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-TPXREF120">Creating Toolbars</a>
				
			<br/>
			
        
			
			
				<a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-TPXREF121">Event Handling Using the Delegate</a>
				
			<br/>
			
        
			
			
				<a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-TPXREF122">Creating Toolbar Items</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000310-TPXREF119" title="How the Toolbar Works"></a><h2>How the Toolbar Works</h2><p>Before creating a toolbar, you should understand what goes on during the life of the HIToolbar object. </p><ol class="ol"><li class="li"><p>When the HIToolbar object is first created, it takes no additional actions until it actually becomes time to show a toolbar. For example, you can associate multiple windows with the toolbar, but it will not create any views until a toolbar must be displayed in a visible window.</p></li><li class="li"><p>When it is time to show a toolbar, the HIToolbar object creates a toolbar view and embeds it in the root view of the window that contains it. </p></li><li class="li"><p>The HIToolbar object then checks to see if any previously saved configuration information exists for this toolbar. If not, the HIToolbar object queries its delegate (through Carbon events) for the default configuration information.</p></li><li class="li"><p>For each item in the default configuration list, it sends a request to the delegate to create that toolbar item. The delegate should return a toolbar item reference for each item it creates. If the delegate returns <code>EventNotHandledErr</code>, the event passes to HIToolbar’s default handlers, which will create any standard toolbar items. </p></li><li class="li"><p>For each toolbar item reference it receives, the HIToolbar object then creates a toolbar item view and embeds it in the toolbar view. If the toolbar item creates a custom HIView, this view is embedded in the toolbar item view. </p></li><li class="li"><p>HIToolbar repeats steps 2, 4, and 5 for each toolbar that appears in a visible window. </p></li><li class="li"><p>If the user changes the toolbar configuration in one window, the HIToolbar object is notified (using Carbon events) and it can then update the views in all the other windows associated with it. </p></li><li class="li"><p>If the user requests the Configuration sheet, the HIToolbar object queries its delegate for a list of allowable toolbar items. Using that list and the list of default items, it then requests toolbar items from the delegate to populate the Configuration sheet before displaying it. </p></li></ol><a name="//apple_ref/doc/uid/TP30000310-TPXREF120" title="Creating Toolbars"></a><h2>Creating Toolbars</h2><p>To create the toolbar, you simply call the <code>HIToolbarCreate</code> function. This creates an HIToolbar object, which controls the creation and display of the toolbar in associated windows. <span class="content_text">Listing 1-1</span> shows how you might create a toolbar and attach it to a window. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_13" title="Listing 2-1Creating a toolbar"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJEBFDD" title="Listing 2-1Creating a toolbar"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Creating a toolbar</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus        err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>HIToolbarRef    toolbar;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = HIToolbarCreate( CFSTR( "com.mycompany.carbontoolbar" ),<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                    kHIToolbarAutoSavesConfig | kHIToolbarIsConfigurable,<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;toolbar );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>InstallEventHandler( HIObjectGetEventTarget( (HIToolbarRef)toolbar ),<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    ToolbarDelegate, GetEventTypeCount( kToolbarEvents ),<span></span></pre></td></tr><tr><td scope="row"><pre>                    kToolbarEvents, toolbar, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>SetWindowToolbar( window, toolbar );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>ShowHideWindowToolbar( window, true, false );<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease( toolbar );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ChangeWindowAttributes( window, kWindowToolbarButtonAttribute, 0 );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>SetAutomaticControlDragTrackingEnabledForWindow( window, true );<span>// 8</span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>The toolbar is defined by a toolbar reference, which is also an HIObject reference. </p></li><li class="li"><p>To create a toolbar, call the <code>HIToolbarCreate</code> function. You must pass a unique identifer (as a Core Foundation string) for each toolbar your application creates. Doing so allows you to define multiple toolbars. The identifier should be in the form: com.<em>myCompany</em>.<em>myApp</em>.<em>myUniqueName</em>.</p><p>You can specify attributes for your toolbar when you create it. <code>kHIToolbarAutoSavesConfig</code> indicates that the toolbar will save its current configuration to the application’s user preferences file. The <code>kHIToolbarIsConfigurable</code> attribute indicates that the user can configure the toolbar (that is, the user can bring up the configuration sheet). If you do not want to specify any attributes, pass <code>kHIToolbarNoAttributes</code>.</p></li><li class="li"><p>You install the toolbar event handler on your delegate just as you would for any other event target. The delegate does all the event handling related to creating and managing toolbar items. When you first create the toolbar, the toolbar is its own delegate. </p><p>To set a different delegate for the toolbar, call the <code>HIToolbarSetDelegate</code> function. Note that events are sent to the delegate with the <code>kEventTargetDontPropagate</code> option, so they cannot propagate up the event hierarchy.</p></li><li class="li"><p>To assign a toolbar to a window, call the <code>SetWindowToolbar</code> function. Note that you can assign the toolbar to multiple windows. Any window that contains the toolbar should use the standard window event handler.</p></li><li class="li"><p>The <code>ShowHideWindowToolbar</code> function shows or hides the toolbar (just as if the user pressed the toolbar button). The toolbar is initially hidden, so call this function to make it visible in the window. </p></li><li class="li"><p>Now that the toolbar is retained by a window, you can release your reference to it by calling <code>CFRelease</code>.</p></li><li class="li"><p>To add the oblong button to show and hide the toolbar, you must set the window attribute <code>kWindowToolbarButtonAttribute</code>. You can set this attribute within a nib file or when you programmatically create the window.</p></li><li class="li"><p>The toolbar requires automatic drag tracking, so you must set this by calling <code>SetAutomaticControlDragTrackingEnabledForWindow</code> on windows containing toolbars. </p></li></ol><a name="//apple_ref/doc/uid/TP30000310-TPXREF121" title="Event Handling Using the Delegate"></a><h2>Event Handling Using the Delegate</h2><p>After creating your toolbar, you need to assign an event handler to create and manage its toolbar items. These events are automatically sent to either the toolbar event target (the default) or an event target you specify by calling the <code>HIToolbarSetDelegate</code> function. In most cases, the toolbar itself is the appropriate delegate. </p><p><span class="content_text">Listing 1-2</span> shows an example of a toolbar event handler. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_14" title="Listing 2-2A toolbar event handler"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJFHCJD" title="Listing 2-2A toolbar event handler"></a><strong>Listing 2-2&nbsp;&nbsp;</strong>A toolbar event handler</p><div class="codesample"><table><tr><td scope="row"><pre>static const EventTypeSpec kToolbarEvents[] =<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassToolbar, kEventToolbarGetDefaultIdentifiers },<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassToolbar, kEventToolbarGetAllowedIdentifiers },<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassToolbar, kEventToolbarCreateItemWithIdentifier },<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassToolbar, kEventToolbarCreateItemFromDrag }<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static OSStatus ToolbarDelegate( EventHandlerCallRef inCallRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                                EventRef inEvent, void* inUserData )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            result = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableArrayRef   array;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef         identifier;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch ( GetEventKind( inEvent ) )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventToolbarGetDefaultIdentifiers:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            GetEventParameter( inEvent, kEventParamMutableArray,<span></span></pre></td></tr><tr><td scope="row"><pre>                            typeCFMutableArrayRef, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof( CFMutableArrayRef ), NULL, &amp;array );<span></span></pre></td></tr><tr><td scope="row"><pre>            GetToolbarDefaultItems( array ); // application-defined<span></span></pre></td></tr><tr><td scope="row"><pre>            result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventToolbarGetAllowedIdentifiers:<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            GetEventParameter( inEvent, kEventParamMutableArray,<span></span></pre></td></tr><tr><td scope="row"><pre>                            typeCFMutableArrayRef, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof( CFMutableArrayRef ), NULL, &amp;array );<span></span></pre></td></tr><tr><td scope="row"><pre>            GetToolbarAllowedItems( array ); // application-defined<span></span></pre></td></tr><tr><td scope="row"><pre>            result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventToolbarCreateItemWithIdentifier:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                HIToolbarItemRef        item;<span></span></pre></td></tr><tr><td scope="row"><pre>                CFTypeRef               data = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                GetEventParameter( inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kEventParamToolbarItemIdentifier, typeCFStringRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, sizeof( CFStringRef ), NULL, &amp;identifier );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                GetEventParameter( inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kEventParamToolbarItemConfigData, typeCFTypeRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, sizeof( CFTypeRef ), NULL, &amp;data );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                item = CreateToolbarItemForIdentifier( identifier, data );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                if ( item )<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    SetEventParameter( inEvent, kEventParamToolbarItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                            typeHIToolbarItemRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof(HIToolbarItemRef ), &amp;item );<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventToolbarCreateItemFromDrag:<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                HIToolbarItemRef        item;<span></span></pre></td></tr><tr><td scope="row"><pre>                DragRef                 drag;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                GetEventParameter( inEvent, kEventParamDragRef, typeDragRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, sizeof( DragRef ), NULL, &amp;drag );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                item = CreateToolbarItemFromDrag( drag );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                if ( item )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    SetEventParameter( inEvent, kEventParamToolbarItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                            typeHIToolbarItemRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof( HIToolbarItemRef ), &amp;item );<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>This example handler covers the four possible toolbar events:</p><ul class="ul"><li class="li"><p>A query for the default toolbar items. Default items are those contained in the toolbar when it first appears. </p></li><li class="li"><p>A query for allowable toolbar items. Allowable items are those that the user can place into the toolbar when in configuration mode. Note that if your toolbar is not configurable, you do not need to handle this event. </p></li><li class="li"><p>A query to create a specific toolbar item. Each toolbar item has an unique identifier, which is passed in this event when the system wants to create it. </p></li><li class="li"><p>A query to create a toolbar item based on a drag-and-drop action. For example, the Finder allows you to drag folders into the toolbar. If you want to add similar functionality to create folders, URLs, and so on from drags into your toolbar, you must handle this event. </p></li></ul></li><li class="li"><p>When you receive the <code>kEventToolbarGetDefaultIdentifiers</code> event, you receive a pointer to a Core Foundation mutable array (obtained using the <code>kEventParamMutableArray</code> parameter). You must populate this array with the default toolbar item identifiers. The function to do so might look like this:</p><div class="codesample"><table><tr><td scope="row"><pre>static void GetToolbarDefaultItems( CFMutableArrayRef array )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, CFSTR( "com.apple.carbontoolbar.anchored" ) );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, kHIToolbarSeparatorIdentifier );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, CFSTR( "com.apple.carbontoolbar.permanent" ) );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, kHIToolbarFlexibleSpaceIdentifier );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, CFSTR( "MyCustomIdentifier" ) );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayAppendValue( array, CFSTR( "com.apple.carbontoolbar.trash" ) );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The items appear in the toolbar in the order they are added to the array. In this default arrangement, the “anchored” item will appear on the far left, followed by the separator, and so on.</p></li><li class="li"><p>Similarly, when you receive the <code>kEventToolbarGetAllowableIdentifiers</code> event, you must populate a Core Foundation mutable array with the identifiers for the allowable toolbar items. These items appear in the configuration sheet in the order they are placed into the array. Note that you do not have to specify toolbar items that are created only from drag-and-drop actions. </p></li><li class="li"><p>When you receive a <code>kEventToolbarCreateItemWithIdentifier</code> event, you must create a toolbar item based on the identifier that was passed with the event. For example, after sending the <code>kEventToolbarGetDefaultIdentifiers</code> event, when the time comes to display the toolbar, the system sends a <code>kEventToolbarCreateItemWithIdentifer</code> event for each default item. </p><p>The handler calls <code>GetEventParameter</code> to obtain the identifier (<code>kEventParamToolbarItemIdentifier</code>) and any associated configuration data that may be associated with it (<code>kEventParamToolbarItemConfigData</code>). For example, the configuration data could hold initial values for your item, a URL, text, and so on. </p><p>You use the identifier to determine what kind of toolbar item to create. See <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJHJIGD">“Creating Items from an Identifier”</a></span> for information about how you could implement the <code>CreateToolbarItemForIdentifier</code> function. </p></li><li class="li"><p>If your item creation function successfully created a toolbar item, call <code>SetEventParameter</code> to pass its reference back in the <code>kEventParamToolbarItem</code> parameter. Note that you are sent the <code>kEventToolbarCreateItemWithIdentifier</code> event even if the HIToolbar object wants to create a system-defined toolbar item. Therefore, whenever you don’t create a toolbar item, you should return <code>eventNotHandledErr</code> so the next handler in the calling chain has a chance to take the event. </p></li><li class="li"><p>When you receive a <code>kEventToolbarCreateItemFromDrag</code> event, you should create a toolbar item based on the user’s drag-and-drop action.</p><p>First, use <code>GetEventParameter</code> to obtain the drag reference (<code>kEventParamDragRef</code>) from the event. This example then passes the drag reference to its own toolbar item creation function. See <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJDCJHA">“Creating Items from a Drag”</a></span> for information about how the <code>CreateToolbarItemFromDrag</code> function is implemented. </p><p>As with the <code>kEventToolbarItemCreateItemWithIdentifier</code> function, you pass the reference of the created toolbar item back into the event using <code>SetEventParameter</code>. </p></li></ol><a name="//apple_ref/doc/uid/TP30000310-TPXREF122" title="Creating Toolbar Items"></a><h2>Creating Toolbar Items</h2><p>In most cases, you create a toolbar item based on a unique identifier. The identifier is just that; a unique string that identifies a particular toolbar item. Identifiers you create are used only within your application, but they must be unique so that the system does not confuse them with identifiers from other applications. </p><a name="//apple_ref/doc/uid/TP30000310-TPXREF123" title="System-Defined Identifiers"></a><h3>System-Defined Identifiers</h3><p>The HIToolbar API defines several standard identifiers that you can use in your application. Aside from returning the proper identifiers for the default and allowable item requests, you do not need to do anything else to implement these items.</p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_15" title="Table 2-1System-defined toolbar item identifiers"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30000310-TPXREF126" title="Table 2-1System-defined toolbar item identifiers"></a><strong>Table 2-1&nbsp;&nbsp;</strong>System-defined toolbar item identifiers</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Identifier</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>kHIToolbarSeparatorIdentifier</code></p></td><td ><p>A thin vertical line used to group toolbar items. </p></td></tr><tr><td  scope="row"><p><code>kHIToolbarSpaceIdentifier</code></p></td><td ><p>A fixed-width space.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarFlexibleSpaceIdentifier</code></p></td><td ><p>A variable-width space.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarCustomizeIdentifier</code></p></td><td ><p>Clicking on this item brings up the toolbar configuration sheet.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarPrintItemIdentifier</code></p></td><td ><p>Clicking on this item sends a Print command event (just as if the user had selected the Print menu item) to the toolbar item view. You should install a command event handler at the window level to take this event. </p></td></tr><tr><td  scope="row"><p><code>kHIToolbarFontsItemIdentifier</code></p></td><td ><p>Clicking on this item brings up the standard Fonts floating window. See the Apple Type Services (ATS) for Fonts documentation for details about how to set and obtain information from the Fonts window. </p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000310-BAJHAABG" title="Toolbar Item Attributes"></a><h3>Toolbar Item Attributes</h3><p>You can set attributes in your toolbar items that influence their behavior. <span class="content_text">Table 1-2</span> lists the available attributes. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_16" title="Table 2-2Toolbar item attributes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30000310-BAJFJFFJ" title="Table 2-2Toolbar item attributes"></a><strong>Table 2-2&nbsp;&nbsp;</strong>Toolbar item attributes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>kHIToolbarItemNoAttributes</code></p></td><td ><p>No attributes.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarItemAllowDuplicates</code></p></td><td ><p>More than one item of this type can appear in the toolbar.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarItemCantBeRemoved</code></p></td><td ><p>The user cannot drag this item out of the toolbar.</p></td></tr><tr><td  scope="row"><p><code>kHIToolbarItemAnchoredLeft</code></p></td><td ><p>The item is fixed to the left side of the toolbar and cannot be moved. You can have multiple items with this attribute in a toolbar. </p></td></tr><tr><td  scope="row"><p><code>kHIToolbarItemIsSeparator</code></p></td><td ><p>The item is used is a separator, and should appear as such in the overflow menu. Note that being a separator also implies that the item can draw the full height of the toolbar (unlike normal items, which typically have a label area below the graphic). </p></td></tr><tr><td  scope="row"><p><code>kHIToolbarItemSendCmdToUserFocus</code></p></td><td ><p>Any command events sent in response to clicks in this item are sent to the current user focus rather than the item’s view. </p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000310-BAJHJIGD" title="Creating Items from an Identifier"></a><h3>Creating Items from an Identifier</h3><p>This section describes how to create your toolbar items from identifiers passed to your application in the <code>kEventToolbarCreateItemWithIdentifier</code> event. </p><p>The toolbar sends this event to your application for every identifer, even those not defined by your application. Therefore, you should make sure that your delegate event handler returns <code>eventNotHandledErr</code> if you don’t create a toolbar item. </p><p><span class="content_text">Listing 1-3</span> shows a function used to create toolbar items. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_17" title="Listing 2-3Creating toolbar items from identifiers"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJJGJHJ" title="Listing 2-3Creating toolbar items from identifiers"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Creating toolbar items from identifiers</p><div class="codesample"><table><tr><td scope="row"><pre>static HIToolbarItemRef CreateToolbarItemForIdentifier( <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                            CFStringRef identifier, CFTypeRef configData )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemRef        item = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( CFStringCompare( CFSTR( "com.apple.carbontoolbar.permanent" ),<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                identifier, kCFCompareBackwards ) == kCFCompareEqualTo )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ( HIToolbarItemCreate( identifier, kHIToolbarItemCantBeRemoved,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;item ) == noErr )<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            IconRef     icon;<span></span></pre></td></tr><tr><td scope="row"><pre>            MenuRef     menu;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            GetIconRef( kOnSystemDisk, kSystemIconsCreator, kFinderIcon,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                         &amp;icon );<span></span></pre></td></tr><tr><td scope="row"><pre>            HIToolbarItemSetLabel( item, CFSTR( "Can't Remove Me" ) );<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            HIToolbarItemSetIconRef( item, icon );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            HIToolbarItemSetCommandID( item, 'shrt' );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            ReleaseIconRef( icon );<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            menu = NewMenu( 0, "\p" );<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>            AppendMenuItemTextWithCFString( menu, CFSTR( "Item 1" ), 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>            AppendMenuItemTextWithCFString( menu, CFSTR( "Item 2" ), 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>            AppendMenuItemTextWithCFString( menu, CFSTR( "Item 3" ), 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>            HIToolbarItemSetMenu( item, menu );<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>            ReleaseMenu( menu );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( CFStringCompare( CFSTR( "MyCustomIdentifier" ),<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                identifier, kCFCompareBackwards ) == kCFCompareEqualTo )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        item = CreateMyButtonToolbarItem( CFSTR( "MyCustomIdentifier" ));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return item;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>This function, <code>CreateToolbarItemForIdentifier</code>, takes the two parameters passed to you in the <code>kEventToolbarCreateItemWithIdentifier</code> event.</p></li><li class="li"><p>Use the Core Foundation string compare function to determine which identifier is which. You specify the <code>kCFCompareBackwards</code> option to minimize the compare time. </p></li><li class="li"><p>If the identifier indicates the permanent toolbar item, create an unremovable toolbar item by calling the <code>HIToolbarItemCreate</code> function with the <code>kHIToolbarItemCantBeRemoved</code> attribute set. While a permanent toolbar item can be moved within the toolbar, the user cannot remove it. </p></li><li class="li"><p>You usually want to assign an icon to the toolbar item. In this case, you call the Icon Services function <code>GetIconRef</code> to obtain a system-defined icon (in this case, the Finder icon). </p></li><li class="li"><p>Call the <code>HIToolbarItemSetLabel</code> function to set the text that appears in the toolbar for this item. </p></li><li class="li"><p>Call the <code>HIToolbarItemSetIconRef</code> function to assign the icon reference you obtained for the toolbar item.</p></li><li class="li"><p>Call the <code>HIToolbarItemSetCommandID</code> function to assign a command ID to the toolbar item. Clicks on the item or its label will then generate a <code>kEventCommandProcess</code> event containing that command ID. This event is sent to the item’s view unless you specified the <code>kHIToolbarItemSendCmdToUserFocus</code> attribute for your toolbar item. </p><p>Note that if you do not assign a command ID to a toolbar item, the item is inherently not clickable, which may be preferable for certain custom items. For example, if the toolbar item displays a pop-up menu or similar control that has multiple states, you probably don’t want the item’s label to be clickable (except perhaps in text-only mode). Similarly, if a toolbar item contains an search field HIView, you want to take action based on what’s typed into the view, not on clicks in the view or the item label. </p><p>Also, if you do not set a command ID for your toolbar item, that item will not be enabled when it appears in the overflow menu. </p></li><li class="li"><p>After you assign the icon reference to the toolbar item, you can release your reference to it. </p></li><li class="li"><p>If desired, you can add a pop-up menu to your toolbar item. This menu is used only for multi-state toolbar items when the toolbar is in text-only display mode. For example, the Finder’s View toolbar item is a three-state button in icon view, corresponding to the three possible viewing modes (icon, list and column). In text-only mode, there is no button for the user to click, so the possible selections are made available using the pop-up menu.</p><p>This example uses the Menu Manager function <code>NewMenu</code> to create a new empty menu, then calls the <code>AppendMenuItemTextWithCFString</code> to add menu items. You can then assign event handlers or command IDs to the menu to initiate actions when selected. </p></li><li class="li"><p>To assign the newly-created menu to the toolbar item, call the <code>HIToolbarItemSetMenu</code> function.</p></li><li class="li"><p>If the identifier indicates a custom ID, then create a custom toolbar item. For example, such a toolbar item could contain an HIView or other control, or it may be be created on the fly, from a drag-and-drop action. See <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJDCJHA">“Creating Items from a Drag”</a></span> and <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJEEDJD">“Embedding Views in a Toolbar Item”</a></span> for more information.</p></li></ol><a name="//apple_ref/doc/uid/TP30000310-TPXREF124" title="Creating Custom Toolbar Items"></a><h3>Creating Custom Toolbar Items</h3><p>In some cases, you may want to create a special toolbar item that has nonstandard behavior. For example, you may want a toolbar item that is a slider, or a text input field, or you may want to create items from a drag-and-drop operation. </p><p>You create your custom toolbar item class by subclassing the toolbar item HIObject class and calling <code>HIObjectCreate</code> on that subclass. You need to register your subclass and provide handlers for construct, destruct, and initialize events, as well as some specific toolbar item–related events.</p><p>The sections that follow describe how to implement commonly-used custom toolbox items. </p><p>See <em>Inside Mac OS X: Introducing HIView</em> for more information about subclassing HIObjects and creating instances of those classes. </p><a name="//apple_ref/doc/uid/TP30000310-BAJEEDJD" title="Embedding Views in a Toolbar Item"></a><h4>Embedding Views in a Toolbar Item</h4><p>You can associate an HIView with a toolbar item. For example, you can place buttons, sliders, editable text fields, and other controls in the toolbar item. To do so, you must create a custom HIObject, specifically a subclass of the toolbar item class. </p><p>Note that, although the toolbar item is an HIObject, your view is not embedded within that object. For each window the toolbar is associated with, the toolbar item object creates a toolbar item view and then embeds your view within that. </p><p>Also, you do not have to supply your own item labels and help tags when creating your custom toolbar item; you can assign these as before using the <code>HIToolbarItemSetLabel</code> and <code>HIToolbarItemSetHelpText</code> functions. </p><p>To register your toolbar item subclass, you call the <code>HIObjectRegisterSubclass</code> function. The function in <span class="content_text">Listing 1-4</span> shows how you could do this. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_18" title="Listing 2-4Registering a toolbar item subclass"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJBIICG" title="Listing 2-4Registering a toolbar item subclass"></a><strong>Listing 2-4&nbsp;&nbsp;</strong>Registering a toolbar item subclass</p><div class="codesample"><table><tr><td scope="row"><pre>#define kMyButtonToolbarItemClassID CFSTR("com.moof.buttontoolbaritem")<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void RegisterMyButtonToolbarItemClass()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    static bool sRegistered;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( !sRegistered )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        HIObjectRegisterSubclass( kMyButtonToolbarItemClassID,<span></span></pre></td></tr><tr><td scope="row"><pre>                kHIToolbarItemClassID, 0, MyButtonToolbarItemHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                GetEventTypeCount( buttonEvents ), buttonEvents, 0, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        sRegistered = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This example registers a new toolbar item subclass (<code>kMyButtonToolbarItemClassID</code>) and its associated event handler <code>MyButtonToolbarItemHandler</code>. This toolbar item simply contains a standard push button. </p><p>For efficiency, this example also sets a static Boolean to avoid registering the custom item multiple times (although there is no penalty for doing so). </p><p>The <code>MyButtonToolbarItemHandler</code> must handle the HIObject construct, initialize, and destruct events. In addition, because you want to embed a view into the toolbar item view, you must also handle the <code>kEventToolbarItemCreateCustomView</code> event. </p><p><span class="content_text">Listing 1-5</span> shows how you might implement the event handler for your custom button toolbar item. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_19" title="Listing 2-5Event handler for a toolbar item with an embedded view"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJFGEGD" title="Listing 2-5Event handler for a toolbar item with an embedded view"></a><strong>Listing 2-5&nbsp;&nbsp;</strong>Event handler for a toolbar item with an embedded view</p><div class="codesample"><table><tr><td scope="row"><pre>const EventTypeSpec buttonEvents[] =<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassHIObject, kEventHIObjectConstruct },<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassHIObject, kEventHIObjectInitialize },<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassHIObject, kEventHIObjectDestruct },<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassToolbarItem, kEventToolbarItemCreateCustomView }<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>const EventTypeSpec pushButtonEvents[] =<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    { kEventClassControl, kEventControlGetSizeConstraints}<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>struct MyButtonToolbarItem<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemRef        toolbarItem;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct MyButtonToolbarItem MyButtonToolbarItem;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static OSStatus MyButtonToolbarItemHandler( EventHandlerCallRef inCallRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                             EventRef inEvent, void* inUserData )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            result = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    MyButtonToolbarItem*    object = (MyButtonToolbarItem*)inUserData;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch ( GetEventClass( inEvent ) )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassHIObject:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( GetEventKind( inEvent ) )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectConstruct:<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        HIObjectRef         toolbarItem;<span></span></pre></td></tr><tr><td scope="row"><pre>                        MyButtonToolbarItem*    item;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        GetEventParameter( inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                             kEventParamHIObjectInstance, typeHIObjectRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                             NULL, sizeof( HIObjectRef ), NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                             &amp;toolbarItem );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        result = ConstructMyButtonToolbarItem(toolbarItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                             &amp;item );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        if ( result == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                            SetEventParameter( inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kEventParamHIObjectInstance, typeVoidPtr,<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof( void * ), &amp;item );<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectInitialize:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                    if (CallNextEventHandler(inCallRef, inEvent) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            HIToolbarItemSetLabel( object->toolbarItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 CFSTR( "Press Me" ) );<span></span></pre></td></tr><tr><td scope="row"><pre>                            HIToolbarItemSetHelpText( object->toolbarItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 CFSTR("Moof!"), NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>                            result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventHIObjectDestruct:<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                    free (object);<span></span></pre></td></tr><tr><td scope="row"><pre>                    result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassToolbarItem:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( GetEventKind( inEvent ) )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventToolbarItemCreateCustomView:<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        EventTargetRef myButtonEventTarget;<span></span></pre></td></tr><tr><td scope="row"><pre>                        HIViewRef myButton;<span></span></pre></td></tr><tr><td scope="row"><pre>                        Rect myButtonRect = {0,0,20,80};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        CreatePushButtonControl(NULL, &amp;myButtonRect,<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                             CFSTR("Push!"), &amp;myButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        SetEventParameter (inEvent, kEventParamControlRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                             typeControlRef, sizeof(myButton), &amp;myButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        myButtonEventTarget =<span></span></pre></td></tr><tr><td scope="row"><pre>                                        GetControlEventTarget(myButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        InstallEventHandler (myButtonEventTarget,<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                                MyButtonEventHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                                GetEventTypeCount(pushButtonEvents),<span></span></pre></td></tr><tr><td scope="row"><pre>                                pushButtonEvents, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>                        result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is what the code does:</p><ol class="ol"><li class="li"><p>Your subclass must have a structure associated with it that can hold any necessary instance data. This example requires only only one data item: the toolbar item reference. Note that even though this toolbar item provides an HIView, you do not store the HIView reference in this structure. </p></li><li class="li"><p>If your application defines any user data for this toolbar item, you can store it in the instance data.</p></li><li class="li"><p>When you receive the <code>kEventHIObjectConstruct</code> event, you receive a pointer to store the reference to your toolbar item in the <code>kEventParamHIObjectInstance</code> parameter. You must allocate memory for the item reference and any associated instance data. Here is a possible implementation for the <code>ConstructMyToolbarButtonItem</code> function:</p><div class="codesample"><table><tr><td scope="row"><pre>static OSStatus ConstructMyButtonToolbarItem( HIToolbarItemRef inItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                                MyButtonToolbarItem** outItem )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MyButtonToolbarItem*        item;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    item = (MyButtonToolbarItem*)malloc( sizeof( MyButtonToolbarItem ) );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_action( item != NULL, CantAllocItem, err = memFullErr );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    item->toolbarItem = inItem;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *outItem = item;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CantAllocItem:<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>After allocating the memory, use <code>SetEventParameter</code> to return a pointer to the space created for the toolbar item reference.</p></li><li class="li"><p>When you receive the <code>kEventHIObjectInitialize</code> event, you must perform any initialization that your toolbar item requires, such as setting initial values for some instance data. This example calls the <code>HIToolbarSetItemLabel</code> function to set the text portion of the toolbar item, and <code>HIToolbarItemSetHelpText</code> function to set the help tag text. </p></li><li class="li"><p>When you receive the <code>kEventHIObjectDestruct</code> event, you must release the memory that was allocated for your toolbar item. This example simply calls the Memory Manager function <code>free</code> to release the instance data. Note that you must not dispose your HIView reference here.</p></li><li class="li"><p>When you receive the <code>kEventToolbarItemCreateCustomView</code>, you must create an HIView to embed in the toolbar item view. Any sort of view is valid; you can embed a picture view, a text field, a button, or even your own custom HIView. </p></li><li class="li"><p>This example simply creates a standard push button control and then uses <code>SetEventParameter</code> to store its HIView reference in the <code>kEventParamControlRef</code> parameter of the event. Note that when creating standard views, you must pass <code>NULL</code> for the owning window parameter, as the view is not associated with any window. </p></li><li class="li"><p>All views that are associated with toolbar items must respond to the <code>kEventControlGetSizeConstraints</code> event, which asks for the maximum and minimum allowable sizes for the view. The system uses this information to determine how to best size the toolbar item view given its embedded content. In most cases you should simply return the bounds of the view, as in the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>static OSStatus MyButtonEventHandler( EventHandlerCallRef inCallRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                         EventRef inEvent, void* inUserData )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>switch ( GetEventKind( inEvent ) )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventControlGetSizeConstraints:<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        HISize minBounds = {80,20};<span></span></pre></td></tr><tr><td scope="row"><pre>                        HISize maxBounds = {80,20};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        SetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 kEventParamMinimumSize, typeHISize,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 sizeof(HISize), &amp;minBounds);<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 kEventParamMaximumSize, typeHISize,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 sizeof(HISize), &amp;maxBounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                default:<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr><tr><td scope="row"><pre>return eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Note that the <code>HISize</code> type is position-independent, indicating only the width and height of the object. </p><p>Finally, you need to call <code>HIObjectCreate</code> to create an instance of your custom toolbar item. <span class="content_text">Listing 1-6</span> shows a function you could use to do this. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_20" title="Listing 2-6Creating a custom toolbar item instance."></a><br/><br/><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJEEFDE" title="Listing 2-6Creating a custom toolbar item instance."></a><strong>Listing 2-6&nbsp;&nbsp;</strong>Creating a custom toolbar item instance.</p><div class="codesample"><table><tr><td scope="row"><pre>HIToolbarItemRef CreateMyButtonToolbarItem( CFStringRef inIdentifier)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            err;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRef            event;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32              options = kHIToolbarItemAllowDuplicates;<span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemRef    result = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    RegisterMyButtonToolbarItemClass();<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateEvent( NULL, kEventClassHIObject,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                 kEventHIObjectInitialize, GetCurrentEventTime(), 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                 &amp;event );<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr( err, CantCreateEvent );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetEventParameter( event, kEventParamToolbarItemIdentifier,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>             typeCFStringRef, sizeof( CFStringRef ), &amp;inIdentifier );<span></span></pre></td></tr><tr><td scope="row"><pre>    SetEventParameter( event, kEventParamAttributes, typeUInt32, <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            sizeof( UInt32 ), &amp;options );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = HIObjectCreate( kMyButtonToolbarItemClassID, event,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                         (HIObjectRef*)&amp;result );<span></span></pre></td></tr><tr><td scope="row"><pre>    check_noerr( err );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    ReleaseEvent( event );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCreateEvent:<span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>First, register your custom toolbar item by calling the <code>RegisterMyButtonToolbarItemClass</code> function in <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJBIICG">Listing 1-4</a></span>. </p></li><li class="li"><p>Create an initialization event to send to your item once it is created. Note that this event is sent directly to the toolbar item (that is, it is not placed in the event queue).</p></li><li class="li"><p>Set the toolbar item’s identifier in the initialization event using the <code>kEventParamToolbarIdentifier</code> parameter. </p></li><li class="li"><p>Set any desired toolbar attributes in the initialization event using the <code>kEventParamAttributes</code> parameter. </p><p>Note that the identifier and the toolbar attributes are the same parameters you would pass into the standard <code>HIToolbarItemCreate</code> function. If you do not set these parameters, the <code>HIObjectCreate</code> call fails.</p></li><li class="li"><p>Call <code>HIObjectCreate</code> to create an instance of your custom toolbar item class (<code>kMyButtonToolbarClassID</code>). On return, you receive a <code>ToolbarItemRef</code> (which is also an <code>HIObjectRef</code>) that points to the newly-created toolbar item. </p></li><li class="li"><p>After sending the initialization event to your toolbar item, you no longer need to retain it, so call <code>ReleaseEvent</code>. </p></li></ol><a name="//apple_ref/doc/uid/TP30000310-BAJDCJHA" title="Creating Items from a Drag"></a><h4>Creating Items from a Drag</h4><p>If the user drags something onto the toolbar, and your toolbar accepts drags, your application will have to create a toolbar item from the drag.</p><p><span class="content_text">Listing 1-7</span> shows how you could process the drag to create a toolbar item. This example creates URLs from one or more text drag items. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_21" title="Listing 2-7Creating a toolbar item from a drag"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJCAABB" title="Listing 2-7Creating a toolbar item from a drag"></a><strong>Listing 2-7&nbsp;&nbsp;</strong>Creating a toolbar item from a drag</p><div class="codesample"><table><tr><td scope="row"><pre>static HIToolbarItemRef CreateToolbarItemFromDrag( DragRef drag )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt16              i, itemCount;<span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemRef    result = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CountDragItems( drag, &amp;itemCount );<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for ( i = 1; i &lt;= itemCount; i++ )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        DragItemRef         itemRef;<span></span></pre></td></tr><tr><td scope="row"><pre>        FlavorFlags         flags;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        GetDragItemReferenceNumber( drag, i, &amp;itemRef );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ( GetFlavorFlags( drag, itemRef, 'TEXT', &amp;flags ) == noErr )<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            Size        dataSize;<span></span></pre></td></tr><tr><td scope="row"><pre>            char        string[256];<span></span></pre></td></tr><tr><td scope="row"><pre>            CFURLRef    url;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            dataSize = sizeof( string );<span></span></pre></td></tr><tr><td scope="row"><pre>            GetFlavorData( drag, itemRef, 'TEXT', &amp;string, &amp;dataSize, 0 );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            url = CFURLCreateWithBytes( NULL, string, dataSize,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                             kCFStringEncodingMacRoman, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            result = CreateMyURLToolbarItem( CFSTR( "MyURLIdentifier" ), url );<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            CFRelease( url );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>This example uses a number of Drag Manager calls to process the drag item. First, you call the <code>CountDragItems</code> function on the drag reference to determine how many items are in the drag. (For example, the user might have selected and dragged several items into the toolbar.)</p></li><li class="li"><p>Now iterate over the number of drag items. For each item index number, obtain the item reference by calling <code>GetDragItemReferenceNumber</code>.</p></li><li class="li"><p>Use the Drag Manager function <code>GetFlavorFlags</code> to determine if the drag item content is of type <code>TEXT</code>. If so, the item contents can be turned into a URL toolbar item. If not, the drag item is rejected and the contents ignored. </p></li><li class="li"><p>If the drag flavor is compatible, call the Drag Manager function <code>GetFlavorData</code> to obtain the actual text associated with the drag item. </p></li><li class="li"><p>The Core Foundation function <code>CFURLCreateWithBytes</code> converts the string into a CFURL with the specifed encoding (in this case, MacRoman).</p></li><li class="li"><p>Now pass the CFURL to a toolbar item creation function. This function, which is analogous to the <code>CreateMyButtonToolbarItem</code> function in <span class="content_text"><a href="HIToolbar_tasks.html#//apple_ref/doc/uid/TP30000310-BAJEEFDE">Listing 1-6</a></span>, should register the toolbar item subclass, create a <code>kEventHIObjectInitialize</code> event, and call <code>HIObjectCreate</code>. </p><p>You should set several parameters in the initialize event before calling <code>HIObjectCreate</code>:</p><ul class="ul"><li class="li"><p><code>kEventParamToolbarIdentifier</code>, the identifier for this toolbar item. </p></li><li class="li"><p><code>kEventParamAttributes</code>, any toolbar attributes you want to set. </p></li><li class="li"><p><code>kEventParamToolbarItemConfigData</code>, a pointer to any specific configuration data. In this case, the configuration data would be a pointer to the URL obtained from the drag. </p></li></ul></li><li class="li"><p>After passing the CFURL to the toolbar item creation function, you can release your reference to it. </p></li></ol><p>The event handler for your custom URL toolbar item class must handle the usual creation, destruction, and initialization events. The construction event allocates memory for the instance data, and the destruction event releases it. Note that the data structure for the instance data has two fields in this case: one to hold the toolbar item reference, and the other to hold the URL. </p><div class="codesample"><table><tr><td scope="row"><pre>struct CustomToolbarItem<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemRef        toolbarItem;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFURLRef                url;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct CustomToolbarItem CustomToolbarItem;<span></span></pre></td></tr></table></div><p>The initialization event handler must obtain the configuration data passed with the event and store that in the instance data as a URL. <span class="content_text">Listing 1-8</span> shows an example of how you could do this. </p><a name="//apple_ref/doc/uid/TP30000310-DontLinkElementID_22" title="Listing 2-8Initialization function for the kEventHIObjectInifialize event"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000310-BAJJDCFJ" title="Listing 2-8Initialization function for the kEventHIObjectInifialize event"></a><strong>Listing 2-8&nbsp;&nbsp;</strong>Initialization function for the kEventHIObjectInifialize event</p><div class="codesample"><table><tr><td scope="row"><pre>/* Assume that the event handler called CallNextEventHandler before<span></span></pre></td></tr><tr><td scope="row"><pre>/* calling this function */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static OSStatus InitializeCustomToolbarItem( CustomToolbarItem* inItem,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                     EventRef inEvent )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFTypeRef       data;<span></span></pre></td></tr><tr><td scope="row"><pre>    IconRef         iconRef;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( GetEventParameter( inEvent, kEventParamToolbarItemConfigData,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                     typeCFTypeRef, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            sizeof( CFTypeRef ), NULL, &amp;data ) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( CFGetTypeID( data ) == CFStringGetTypeID() )<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            inItem->url = CFURLCreateWithString( NULL, (CFStringRef)data,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            inItem->url = (CFURLRef)CFRetain( data );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        inItem->url = CFURLCreateWithString( NULL, <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                                CFSTR( "http://www.apple.com" ), NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemSetLabel( inItem->toolbarItem, CFSTR( "URL Item" ) );<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( GetIconRef( kOnSystemDisk, kSystemIconsCreator, kGenericURLIcon,<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                     &amp;iconRef ) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        HIToolbarItemSetIconRef( inItem->toolbarItem, iconRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        ReleaseIconRef( iconRef );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    HIToolbarItemSetHelpText( inItem->toolbarItem, <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                        CFURLGetString( inItem->url ), NULL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>This function takes two parameters: the toolbar item to initialize, and the initialization event that was sent to it. </p></li><li class="li"><p>Use <code>GetEventParameter</code> to obtain the configuration data stored in the initalization event. This is the URL obtained from the drag (the one stored in the <code>kEventHIObjectInitialize</code> event passed to <code>HIObjectCreate</code>.</p></li><li class="li"><p>If the configuration data passed is of type <code>CFString</code>, then you must call <code>CFURLCreateWithString</code> to convert it to a <code>CFURL</code> type before storing it in the instance data structure. </p><p>If the data is already of type <code>CFURL</code>, we can simply retain its reference and store it in the instance data. </p></li><li class="li"><p>If for some reason no configuration data was passed in the initialization event, set the instance data URL to some default value. </p></li><li class="li"><p>Call <code>HIToolbarItemSetLabel</code> to set the displayed text for the toolbar item. </p></li><li class="li"><p>If your custom toolbar item does not create an HIView to display, in most cases you should assign it an icon. This example simply uses the Icon Services function <code>GetIconRef</code> to obtain a generic URL icon, and assigns it to the toolbar item by calling <code>HIToolbarItemSetIconRef</code>. </p></li><li class="li"><p>After assigning the icon reference to the toolbar item, you can release your reference to it. </p></li><li class="li"><p>Call <code>HIToolbarItemSetHelpText</code> to assign the help tag text for your toolbar item. </p></li></ol><p>In addition to the <code>kEventClassHIObject</code> events, your custom URL toolbar item should also handle two additional events: </p><ul class="spaceabove"><li class="li"><p><code>kEventToolbarItemGetPersistentData</code>: You receive this event when the toolbar wants to store configuration information in the user’s preferences. You should return a pointer (which must be of type <code>CFTypeRef</code>) to any data you want to store in the <code>kEventParamConfigData</code> parameter.</p><p>Note that this data is saved in XML format; any data you store in this event must be CFPropertyList-compatible. Currently this means the data must be one of the following types: <code>CFString</code>, <code>CFData</code>, <code>CFNumber</code>, <code>CFBoolean</code>, <code>CFDate</code>, <code>CFArray</code>, and <code>CFDictionary</code>.</p><p>Note that for CFType references, you should pass a copy of the data, as the system will dispose of the reference it receives to the configuration data. </p></li><li class="li"><p><code>kEventToolbarItemPerformAction</code>: You receive this event when the user clicks on your toolbar item. Your handler can then take any appropriate action. For example, if the user clicks on your custom URL toolbar item, you can call the Launch Services function <code>LSOpenCFURLRef</code> to open the URL using the user’s default browser. </p><p>Note that if your toolbar item handles the <code>kEventToolbarItemPerformAction</code> event, you should set the command ID for the toolbar item to <code>kHIToolbarCommandPressAction</code> (value: <code>'tbpr'</code>). Doing so ensures that HIToolbar can send the perform action event when your toolbar item is selected from the overflow menu. This command ID is available in Mac OS X v.10.2.3 and later. </p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../HIToolbar_concept/HIToolbar_concept.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../HIToolbar_apdx_a_history/HIToolbar_apdx_a_history.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-07-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/UsingHIToolbar/HIToolbar_tasks/HIToolbar_tasks.html%3Fid%3DTP40000958-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/UsingHIToolbar/HIToolbar_tasks/HIToolbar_tasks.html%3Fid%3DTP40000958-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/UsingHIToolbar/HIToolbar_tasks/HIToolbar_tasks.html%3Fid%3DTP40000958-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>