<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>ASPOpenSession(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING211></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-210.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-212.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-204.html"><B>Chapter 8 - AppleTalk Session Protocol (ASP)</B></A> / <A HREF="Networking-206.html"><B>ASP Reference</B></A><BR><DL><DD><A HREF="Networking-209.html"><B>Routines</B></A> / <A HREF="Networking-210.html"><B>Opening and Closing ASP Sessions</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING211-0></A>
<H3><A NAME=MARKER-9-36></A>ASPOpenSession</H3>
 <A NAME=MARKER-11-37></A><A NAME=MARKER-2-34></A>The <A NAME=MARKER-9-12></A><CODE>ASPOpenSession</CODE> function <A NAME=MARKER-2-46></A>opens an ASP session between an ASP workstation application and an ASP server application. <P>
<PRE>
FUNCTION ASPOpenSession (thePBptr: XPPParmBlkPtr; 
                         async: Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to an XPP parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean that specifies whether the function should be executed asynchronously or synchronously. Specify <CODE>TRUE</CODE> for asynchronous execution.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result. <TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .XPP driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always openSess for this function.<TR>
<TD><--<TD>sessRefnum<TD>Integer<TD>The session reference number. <TR>
<TD>--><TD>aspTimeout<TD>Byte<TD>The retry interval in seconds.<TR>
<TD>--><TD>aspRetry<TD>Byte<TD>The number of retries.<TR>
<TD>--><TD>serverAddr<TD>AddrBlock<TD>The server socket address<EM>.</EM><TR>
<TD>--><TD>scbPointer<TD>Ptr<TD>A pointer to the session control block.<TR>
<TD>--><TD>attnRoutine<TD>Ptr<TD>A pointer to an attention routine.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-27></A>sessRefnum</CODE>
<DD> A unique number that the .XPP driver assigns to the session that it opens if the function completes successfully. 
<DT><CODE><A NAME=MARKER-21-114></A>aspTimeout</CODE>
<DD> The interval in seconds between retries of the open session request.
<DT><CODE><A NAME=MARKER-9-75></A>aspRetry</CODE>
<DD> The number of times that ASP will retry to open a session.
<DT><CODE><A NAME=MARKER-2-41></A>serverAddr</CODE>
<DD> The internet socket address of the socket that the server is using to listen for requests to open a session. 
<DT><CODE><A NAME=MARKER-2-25></A>scbPointer</CODE>
<DD> A pointer to a session control block (SCB) that the .XPP driver requires to maintain an open session. The <CODE>scbMemSize</CODE> constant defines the size of the session control block. The memory that you allocate for the SCB must be nonrelocatable or locked because it belongs to the .XPP driver for the life of the session.
<DT><CODE><A NAME=MARKER-2-26></A>attnRoutine</CODE>
<DD> A pointer to a routine that ASP calls if the workstation component of ASP receives an attention request from the server or if the session is closed. If you do not want to specify an attention routine to be called, set this pointer to <CODE>NIL</CODE>.<CODE> </CODE>
</DL>
<A NAME=HEADING211-12></A>
<H5>DESCRIPTION</H5>
 To gain access to an ASP server, you must call the <CODE>ASPOpenSession</CODE> function to open <BR>a session. Before calling the <CODE>ASPOpenSession</CODE> function, you must obtain the internet socket address of the socket that the ASP server uses to listen for incoming session requests. The server uses a <A NAME=MARKER-2-43></A>session listening socket (SLS) for this purpose. You can use the Name-Binding Protocol (NBP) to get the internet socket address of an SLS. You pass the internet socket address of the <A NAME=MARKER-2-90></A>SLS as the value of the serverAddr parameter.<P>
 <A NAME=MARKER-13-57></A>You also pass the <CODE>ASPOpenSession</CODE> function a pointer to a <A NAME=MARKER-2-50></A>s<A NAME=MARKER-2-51></A>ession control block (SCB) in the <CODE>scbPointer</CODE> parameter. The .XPP driver uses the SCB internally to manage the session. Each session requires its own SCB. You must either allocate nonrelocatable memory for the session control block or lock the memory and not modify it for the duration of the session. The SCB size is defined by the constant <A NAME=MARKER-21-84></A><CODE>scbMemSize</CODE>. The memory belongs to the .XPP driver for the life of the session. You can reuse an SCB after either of the following events occurs: <P>
<UL>
<LI>You have called the <CODE>ASPCloseSession</CODE> function to close the session and it has completed successfully.
<LI>The server end of the ASP session has closed the session or the .XPP driver has closed the session. In both cases, the .XPP driver returns an <CODE>aspParamErr</CODE> result code as the result of a call for that session. <P>
</UL>
 You can also pass the <CODE>ASPOpenSession</CODE> function a pointer to an attention routine that the .XPP driver calls when it receives an attention request from the server and when the session is closing. ASP provides an attention mechanism that allows the ASP server to notify the ASP workstation application of some event or critical piece of information. As the value of the <CODE>attnRoutine</CODE> parameter, you can specify a pointer to your attention routine, and the .XPP driver will call this routine when it receives an attention request from the server or when the server, the workstation, or ASP closes the session; ASP, as implemented in the .XPP driver, will close a session if it cannot successfully open the session before it exhausts the number of retries.<P>
 Because the .XPP driver calls your attention routine at interrupt level, you must observe the following interrupt conventions in writing the attention routine:<P>
<UL>
<LI><A NAME=MARKER-2-53></A>An attention routine <A NAME=MARKER-2-68></A>can change registers A0 through A3 and D0 through D3. 
<LI>The routine must not call any Memory Manager routines. <P>
</UL>
 The .XPP driver calls your attention routine with<P>
<UL>
<LI>D0 (word) equal to the session reference number (<CODE>sessRefnum</CODE>) for that session. This is the number that ASP returns on completion of the <CODE>ASPOpenSession</CODE> function.
<LI>D1 (word) equal to the attention bytes passed by the server or 0 if the session <BR>is closing. <P>
</UL>
 To resume normal execution, your attention routine must return with an RTS (return from subroutine) instruction.<A NAME=MARKER-2-91></A> <P>
 If you code your program in a high-level language such as Pascal, you might not want to provide an attention routine written in assembly language. If you do not want to provide an attention routine, you can poll the attention bytes to determine if your ASP work-<BR>station application has received an attention request from the server. The attention bytes are the first 2 bytes of the session control block. When the .XPP driver receives an <CODE>ASPOpenSession</CODE> function call, it sets these 2 bytes to 0. When the server sends an attention request to the workstation, the .XPP driver receives the request and sets the first 2 bytes of the SCB to the attention bytes from the packet. (A higher-level protocol that uses the services of ASP defines the attention code that the 2 attention bytes in the packet carry.) If the first 2 bytes of the SCB are nonzero when your Pascal program polls them, the program will know that it has received an attention request from the server. Your program can handle the request, based on the conventions defined by the higher-level protocol, and reset the SCB's attention bytes to 0. However, using this method to determine if the workstation has received an attention request from the server has limitations: two or more attention requests could be received between successive polls and only the last one would be preserved. <P>
 When the .XPP driver receives an <CODE>ASPOpenSession</CODE> function, it sends a special open session (<CODE>OpenSession</CODE>) packet as an ATP request to the SLS; this packet carries the address of the socket that the ASP workstation application or process is using for the session. The open session packet also carries a version number so that both ends can verify that they are using the same version of ASP. <P>
 Once you open a session, you can send commands and data to the server and receive command replies from the server. However, before you open an ASP session, you should call the <CODE>ASPGetParms</CODE> function to determine the maximum sizes of commands and replies that ASP supports on your node. <P>
<A NAME=HEADING211-28></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Note that you must provide the .XPP driver reference number as an input parameter <BR>to this function. You can obtain the driver reference number by calling the Device Manager's <CODE>OpenDriver</CODE> function.<CODE> </CODE><P>
<A NAME=HEADING211-30></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>ASPOpenSession</CODE> function from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>openSess</CODE> in the <CODE>csCode</CODE> field of the parameter block. You must also specify the .XPP driver reference number. To execute the <CODE>_Control</CODE> trap asynchronously, include the value <CODE>,ASYNC</CODE> in the operand <A NAME=MARKER-2-56></A>field.<A NAME=MARKER-2-35></A><P>
<A NAME=HEADING211-32></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>aspBadVersNum<TD>-1066<TD>The server cannot support the ASP version number <TR>
<TD>aspNoMoreSess<TD>-1068<TD>The .XPP driver cannot support another ASP session (the number of sessions that the driver is capable of supporting is dependent on the machine type) <TR>
<TD>aspNoServers<TD>-1069<TD>There is no server at the specified <CODE>serverAddr</CODE> address, or the server did not respond to the request <TR>
<TD>aspParamErr<TD>-1070<TD>You specified an invalid session reference number, or the session has been closed <TR>
<TD>aspServerBusy<TD>-1071<TD>The server cannot open another session<TR>
<TD>reqAborted<TD>-1105<TD>The <CODE>ASPOpenSession</CODE> function call was aborted by an <CODE>ASPAbortOS</CODE> function call </TABLE>
</H5>
<A NAME=HEADING211-33></A>
<H5>SEE ALSO </H5>
 For information on how to use NBP, see the chapter "Name-Binding Protocol (NBP)" in this book. <P>
 You can use the <CODE>ASPAbortOS</CODE> function described on <A HREF=Networking-221.html#MARKER-9-108>page 8-25</A> to cancel an outstanding <CODE>ASPOpenSession</CODE> function request before it completes execution. <P>
 For the maximum sizes of commands and replies that ASP supports on your node, use the <CODE>ASPGetParms</CODE> function, described on<A NAME=MARKER-2-58></A> <A HREF=Networking-218.html#MARKER-9-93>page 8-22</A>.<A NAME=MARKER-2-91></A> <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-210.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-212.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
