<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Menu Manager(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING187></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-186.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-188.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-89.html"><B>Chapter 3 - Menu Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING187-0></A>
<H1>Summary of the Menu Manager</H1>
<A NAME=HEADING187-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING187-2></A>
<H3>Constants</H3>
<PRE>
CONST
      noMark         = 0;  {menu item doesn't have a marking character}

      {values for the message parameter to the menu definition procedure}
      mDrawMsg       = 0;  {draw the menu items of a menu}
      mChooseMsg     = 1;  {highlight or unhighlight a menu item as }
                           { appropriate if the cursor is in a menu item}
      mSizeMsg       = 2;  {calculate the dimensions of a menu}
      mPopUpMsg      = 3;  {calculate the open pop-up box rectangle}
   
      textMenuProc   = 0;  {resource ID of standard menu definition }
                           { procedure}
      hMenuCmd       = 27; {constant ($1B) specified as keyboard equivalent }
                           { to indicate a menu item has a submenu}
      hierMenu       = -1; {constant used with InsertMenu routine to insert }
                           { a submenu or pop-up menu into the submenu }
                           { portion of the current menu list}
      mctAllItems    = -98;{search for all items with the given ID}
      mctLastIDIndic = -99;{last menu color table entry has this value }
                           { in the ID field of the entry}
</PRE>
<A NAME=HEADING187-4></A>
<H3>Data Types</H3>
<PRE>
TYPE
      MenuInfo =                 {menu record}
      RECORD
         menuID:     Integer;    {number that identifies the menu}
         menuWidth:  Integer;    {width (in pixels) of the menu}
         menuHeight: Integer;    {height (in pixels) of the menu}
         menuProc:   Handle;     {menu definition procedure}
         enableFlags:LongInt;    {indicates whether menu and }
                                 { menu items are enabled}
         menuData:   Str255;     {title of menu}
         {itemDefinitions}       {variable-length data that }
                                 { defines the menu items}
      END;

      MenuPtr     = ^MenuInfo;   {pointer to a menu record}
      MenuHandle  = ^MenuPtr;    {handle to a menu record}
      MCEntry =                  {menu color entry record}
      RECORD
         mctID:      Integer;    {menu ID or 0 for menu bar}
         mctItem:    Integer;    {menu item number or 0 for }
                                 { menu title}
         mctRGB1:    RGBColor;   {usage depends on mctID and }
                                 { mctItem}
         mctRGB2:    RGBColor;   {usage depends on mctID and }
                                 { mctItem}
         mctRGB3:    RGBColor;   {usage depends on mctID and }
                                 { mctItem}
         mctRGB4:    RGBColor;   {usage depends on mctID and }
                                 { mctItem}
         mctReserved:Integer;    {reserved}
      END;

      MCEntryPtr  = ^MCEntry;    {pointer to a menu color entry record}

      MCTable     = ARRAY[0..0] OF MCEntry;  {menu color table}
      MCTablePtr  = ^MCTable;       {pointer to a menu color table}
      MCTableHandle = ^MCTablePtr;  {handle to a menu color table}
</PRE>
<A NAME=HEADING187-7></A>
<H3>Menu Manager Routines</H3>
<A NAME=HEADING187-8></A>
<H4>Initializing the Menu Manager</H4>
<PRE>
PROCEDURE InitMenus;
PROCEDURE InitProcMenu(resID: Integer);
</PRE>
<A NAME=HEADING187-11></A>
<H4>Creating Menus</H4>
<PRE>
FUNCTION NewMenu (menuID: Integer; menuTitle: Str255)
: MenuHandle;
FUNCTION GetMenu (resourceID: Integer): MenuHandle;
</PRE>
<A NAME=HEADING187-14></A>
<H4>Adding Menus to and Removing Menus From the Current Menu List</H4>
<PRE>
PROCEDURE InsertMenu (theMenu: MenuHandle; beforeID: Integer);
PROCEDURE DeleteMenu (menuID: Integer);
PROCEDURE ClearMenuBar;
</PRE>
<A NAME=HEADING187-18></A>
<H4>Getting a Menu Bar Description From an 'MBAR' Resource</H4>
<PRE>
FUNCTION GetNewMBar (menuBarID: Integer): Handle;
</PRE>
<A NAME=HEADING187-20></A>
<H4>Getting and Setting the Menu Bar</H4>
<PRE>
FUNCTION GetMenuBar: Handle;
PROCEDURE SetMenuBar (menuList: Handle);
FUNCTION GetMBarHeight: Integer;
</PRE>
<A NAME=HEADING187-24></A>
<H4>Drawing the Menu Bar</H4>
<PRE>
PROCEDURE DrawMenuBar;
PROCEDURE InvalMenuBar;
</PRE>
<A NAME=HEADING187-27></A>
<H4>Responding to the User's Choice of a Menu Command</H4>
<PRE>
FUNCTION MenuSelect(startPt: Point): LongInt;
FUNCTION MenuKey(ch: Char): LongInt;
FUNCTION MenuChoice: LongInt;
PROCEDURE HiliteMenu (menuID: Integer);
FUNCTION PopUpMenuSelect (menu: MenuHandle;
Top: Integer; Left: Integer; 
PopUpItem: Integer): LongInt;
PROCEDURE SystemMenu (menuResult: LongInt);
FUNCTION SystemEdit (editCmd: Integer): Boolean;
</PRE>
<A NAME=HEADING187-35></A>
<H4>Getting a Handle to a Menu Record</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
FUNCTION GetMenuHandle (menuID: Integer): MenuHandle;
FUNCTION HMGetHelpMenuHandle
   (VAR mh: MenuHandle): OSErr;
</PRE>
<A NAME=HEADING187-40></A>
<H4>Adding and Deleting Menu Items</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
PROCEDURE AppendMenu(menu: MenuHandle; data: Str255);
PROCEDURE InsertMenuItem(theMenu: MenuHandle; itemString: Str255; 
afterItem: Integer);
PROCEDURE DeleteMenuItem(theMenu: MenuHandle; item: Integer);
PROCEDURE AppendResMenu(theMenu: MenuHandle; theType: ResType);
PROCEDURE InsertResMenu(theMenu: MenuHandle; theType: ResType;
                        afterItem: Integer);
</PRE>
<A NAME=HEADING187-47></A>
<H4>Getting and Setting the Appearance of Menu Items</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
PROCEDURE EnableItem (theMenu: MenuHandle; item: Integer);
PROCEDURE DisableItem (theMenu: MenuHandle; item: Integer);
PROCEDURE GetMenuItemText (theMenu: MenuHandle; item: Integer;
                     VAR itemString: Str255);
PROCEDURE SetMenuItemText (theMenu: MenuHandle; item: Integer;
                  itemString: Str255);
PROCEDURE GetItemStyle (theMenu: MenuHandle; item: Integer;
                        VAR chStyle: Style);
PROCEDURE SetItemStyle (theMenu: MenuHandle; item: Integer;
                        chStyle: Style);
PROCEDURE GetItemMark (theMenu: MenuHandle; item: Integer;
                        VAR markChar: Char);
PROCEDURE SetItemMark (theMenu: MenuHandle; item: Integer;
                        markChar: Char);
PROCEDURE CheckItem (theMenu: MenuHandle; item: Integer;
                     checked: Boolean);
PROCEDURE GetItemIcon (theMenu: MenuHandle; item: Integer;
                        VAR iconIndex: Byte);
PROCEDURE SetItemIcon (theMenu: MenuHandle; item: Integer;
                        iconIndex: Byte);
PROCEDURE GetItemCmd(theMenu: MenuHandle; item: Integer;
VAR cmdChar: CHAR);
PROCEDURE SetItemCmd(theMenu: MenuHandle; item: Integer;
cmdChar: CHAR);
</PRE>
<A NAME=HEADING187-62></A>
<H4>Disposing of Menus</H4>
<PRE>
PROCEDURE DisposeMenu (theMenu: MenuHandle);
</PRE>
<A NAME=HEADING187-64></A>
<H4>Counting the Items in a Menu</H4>
<PRE>
FUNCTION CountMItems (theMenu: MenuHandle): Integer;
</PRE>
<A NAME=HEADING187-66></A>
<H4>Highlighting the Menu Bar</H4>
<PRE>
PROCEDURE FlashMenuBar (menuID: Integer);
PROCEDURE SetMenuFlash (count: Integer);
</PRE>
<A NAME=HEADING187-69></A>
<H4>Recalculating Menu Dimensions</H4>
<PRE>
PROCEDURE CalcMenuSize (theMenu: MenuHandle);
</PRE>
<A NAME=HEADING187-71></A>
<H4>Managing Entries in the Menu Color Information Table</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
FUNCTION GetMCInfo: MCTableHandle;
PROCEDURE SetMCInfo(menuCTbl: MCTableHandle);
PROCEDURE DisposeMCInfo (menuCTbl: MCTableHandle);
FUNCTION GetMCEntry (menuID: Integer; menuItem: Integer)
: MCEntryPtr;
PROCEDURE SetMCEntries (numEntries: Integer; 
                        menuCEntries: MCTablePtr);
PROCEDURE DeleteMCEntries (menuID: Integer; menuItem: Integer);
</PRE>
<A NAME=HEADING187-79></A>
<H3>Application-Defined Routine</H3>
<PRE>
PROCEDURE MyMenuDef (message: Integer; theMenu: MenuHandle;
                     VAR menuRect: Rect; hitPt: Point; 
                     VAR whichItem: Integer);
</PRE>
<A NAME=HEADING187-81></A>
<H2>C Summary</H2>
<A NAME=HEADING187-82></A>
<H3>Constants</H3>
<PRE>
enum {
      #define noMark '\0'  /*menu item doesn't have a marking character*/

      /*values for the message parameter to the menu definition procedure*/
      mDrawMsg       = 0,  /*draw the menu items of a menu*/
      mChooseMsg     = 1,  /*highlight or unhighlight a menu item as */
                           /* appropriate if the cursor is in a menu item*/
      mSizeMsg       = 2,  /*calculate the dimensions of a menu*/
      mPopUpMsg      = 3,  /*calculate the open pop-up box rectangle*/
   
      textMenuProc   = 0,  /*resource ID of standard menu definition */
                           /* procedure*/
      hMenuCmd       = 27, /*constant ($1B) specified as keyboard */
                           /* equivalent to indicate an item has a submenu*/
      hierMenu       = -1, /*constant used with InsertMenu to insert */
                           /* a submenu or pop-up menu into the submenu */
                           /* portion of the current menu list*/
      mctAllItems    = -98,/*search for all items with the given ID*/
      mctLastIDIndic = -99 /*last menu color table entry has this value */
                           /* in the ID field of the entry*/
   };
</PRE>
<A NAME=HEADING187-84></A>
<H3>Data Types</H3>
<PRE>
struct MenuInfo {          /*menu record*/
         short       menuID;        /*number that identifies the menu*/
         short       menuWidth;     /*width (in pixels) of the menu*/
         short       menuHeight;    /*height (in pixels) of the menu*/
         Handle      menuProc;      /*menu definition procedure*/
         long        enableFlags;   /*indicates whether menu and */
                                    /* menu items are enabled*/
         Str255      menuData;      /*title of menu*/
         /*itemDefinitions*/        /*variable-length data that */
                                    /* defines the menu items*/
      };

typedef struct MenuInfo MenuInfo;         /*pointer to a menu record*/
typedef MenuInfo *MenuPtr, **MenuHandle;  /*handle to a menu record*/
struct MCEntry {           /*menu color entry record*/
         short       mctID;         /*menu ID or 0 for menu bar*/
         short       mctItem;       /*menu item number or 0 for */
                                    /* menu title*/
         RGBColor    mctRGB1;       /*usage depends on mctID and */
                                    /* mctItem*/
         RGBColor    mctRGB2;       /*usage depends on mctID and */
                                    /* mctItem*/
         RGBColor    mctRGB3;       /*usage depends on mctID and */
                                    /* mctItem*/
         RGBColor    mctRGB4;       /*usage depends on mctID and */
                                    /* mctItem*/
         short       mctReserved;   /*reserved*/
      };

typedef struct MCEntry MCEntry;
typedef MCEntry *MCEntryPtr;        /*pointer to a menu color entry record*/
                                    /*menu color table*/
typedef MCEntry MCTable[1], *MCTablePtr, **MCTableHandle;
</PRE>
<A NAME=HEADING187-87></A>
<H3>Menu Manager Routines</H3>
<A NAME=HEADING187-88></A>
<H4>Initializing the Menu Manager</H4>
<PRE>
pascal void InitMenus(void);
pascal void InitProcMenu(short resID);
</PRE>
<A NAME=HEADING187-91></A>
<H4>Creating Menus</H4>
<PRE>
pascal MenuHandle NewMenu (short menuID, const Str255 menuTitle);
pascal MenuHandle GetMenu (short resourceID);
</PRE>
<A NAME=HEADING187-94></A>
<H4>Adding Menus to and Removing Menus From the Current Menu List</H4>
<PRE>
pascal void InsertMenu(MenuHandle theMenu, short beforeID);
pascal void DeleteMenu(short menuID);
pascal void ClearMenuBar(void);
</PRE>
<A NAME=HEADING187-98></A>
<H4>Getting a Menu Bar Description From an 'MBAR' Resource</H4>
<PRE>
pascal Handle GetNewMBar (short menuBarID);
</PRE>
<A NAME=HEADING187-100></A>
<H4>Getting and Setting the Menu Bar</H4>
<PRE>
pascal Handle GetMenuBar(void);
pascal void SetMenuBar(Handle menuList);
#define GetMBarHeight() (* (short*) 0x0BAA)
</PRE>
<A NAME=HEADING187-104></A>
<H4>Drawing the Menu Bar</H4>
<PRE>
pascal void DrawMenuBar(void);
pascal void InvalMenuBar(void);
</PRE>
<A NAME=HEADING187-107></A>
<H4>Responding to the User's Choice of a Menu Command</H4>
<PRE>
pascal long MenuSelect(Point startPt);
pascal long MenuKey(short ch);
pascal long MenuChoice(void);
pascal void HiliteMenu(short menuID);
pascal long PopUpMenuSelect(MenuHandle menu, short top, short left,
short popUpItem);
pascal void SystemMenu(long menuResult);
pascal Boolean SystemEdit(short editCmd);
</PRE>
<A NAME=HEADING187-115></A>
<H4>Getting a Handle to a Menu Record</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
pascal MenuHandle GetMenuHandle 
(short menuID);
pascal OSErr HMGetHelpMenuHandle 
(MenuHandle *mh);
</PRE>
<A NAME=HEADING187-119></A>
<H4>Adding and Deleting Menu Items</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
pascal void AppendMenu(MenuHandle menu, ConstStr255Param data);
pascal void InsertMenuItem(MenuHandle theMenu, 
ConstStr255Param itemString,
short afterItem);
pascal void DeleteMenuItem(MenuHandle theMenu, short item);
pascal void AppendResMenu(MenuHandle theMenu, ResType theType);
pascal void InsertResMenu(MenuHandle theMenu, ResType theType,
short afterItem);
</PRE>
<A NAME=HEADING187-126></A>
<H4>Getting and Setting the Appearance of Menu Items</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
pascal void EnableItem(MenuHandle theMenu, short item);
pascal void DisableItem(MenuHandle theMenu, short item);
pascal void GetMenuItemText(MenuHandle theMenu, short item,
Str255 itemString);
pascal void SetMenuItemText(MenuHandle theMenu, short item, 
ConstStr255Param itemString);
pascal void GetItemStyle(MenuHandle theMenu, short item, 
Style *chStyle);
pascal void SetItemStyle(MenuHandle theMenu, short item, short chStyle);
pascal void GetItemMark(MenuHandle theMenu, short item, 
short *markChar);
pascal void SetItemMark(MenuHandle theMenu, short item, 
short markChar);
pascal void CheckItem (MenuHandle theMenu, short item, 
Boolean checked);
pascal void GetItemIcon(MenuHandle theMenu, short item, 
short *iconIndex);
pascal void SetItemIcon(MenuHandle theMenu, short item, 
short iconIndex);
pascal void GetItemCmd(MenuHandle theMenu, short item, short 
*cmdChar);
pascal void SetItemCmd(MenuHandle theMenu, short item, short cmdChar);
</PRE>
<A NAME=HEADING187-141></A>
<H4>Disposing of Menus</H4>
<PRE>
pascal void DisposeMenu(MenuHandle theMenu);
</PRE>
<A NAME=HEADING187-143></A>
<H4>Counting the Items in a Menu</H4>
<PRE>
pascal short CountMItems(MenuHandle theMenu);
</PRE>
<A NAME=HEADING187-145></A>
<H4>Highlighting the Menu Bar</H4>
<PRE>
pascal void FlashMenuBar(short menuID);
pascal void SetMenuFlash(short count);
</PRE>
<A NAME=HEADING187-148></A>
<H4>Recalculating Menu Dimensions</H4>
<PRE>
pascal void CalcMenuSize(MenuHandle theMenu);
</PRE>
<A NAME=HEADING187-150></A>
<H4>Managing Entries in the Menu Color Information Table</H4>
<PRE>
{some routines have two spellings, see Table 3-8 for the alternate spelling}
pascal MCTableHandle GetMCInfo(void);
pascal void SetMCInfo(MCTableHandle menuCTbl);
pascal void DisposeMCInfo(MCTableHandle menuCTbl);
pascal MCEntryPtr GetMCEntry(short menuID, short menuItem);
pascal void SetMCEntries(short numEntries, MCTablePtr menuCEntries);
pascal void DeleteMCEntries(short menuID, short menuItem);
</PRE>
<A NAME=HEADING187-158></A>
<H3>Application-Defined Routine</H3>
<PRE>
pascal void MyMenuDef (short message, MenuHandle theMenu,
                     Rect *menuRect, Point hitPt, 
short *whichItem);
</PRE>
<A NAME=HEADING187-160></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING187-161></A>
<H3>Data Structures</H3>
<A NAME=HEADING187-162></A>
<H4>The Menu Information Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD><CODE>menuID</CODE><TD>word<TD>number that identifies the menu<TR>
<TD>2<TD><CODE>menuWidth</CODE><TD>word<TD>width (in pixels) of the menu<TR>
<TD>4<TD><CODE>menuHeight</CODE><TD>word<TD>height (in pixels) of the menu<TR>
<TD>6<TD><CODE>menuDefHandle</CODE><TD>long<TD>menu definition procedure<TR>
<TD>10<TD><CODE>menuEnable</CODE><TD>long<TD>enable flags<TR>
<TD>14<TD><CODE>menuData</CODE><TD>256 bytes<TD>menu title followed by menu item information</TABLE>
</H4>
<A NAME=HEADING187-163></A>
<H3>Global Variables
<TABLE BORDER="0" CELLPADDING=3><TD>AtMenuBottom<TD>The pixel value at the bottom of the scrollable menu.<TR>
<TD><A NAME=MARKER-2-49></A><CODE>MBarEnable</CODE><TD>Contains 0 if all menus in the current menu bar belong to an application; contains a nonzero value if all menus belong to a desk accessory.<TR>
<TD>MBarHeight<TD>Contains current height of the menu bar, in pixels.<TR>
<TD>MBarHook<TD>Address of routine that <CODE>MenuSelect</CODE> calls repeatedly while the mouse button <BR>is down.<TR>
<TD>MenuCInfo<TD>Contains a handle to application's menu color information table.<TR>
<TD>MenuDisable<TD>Contains the menu ID and item number of the last item chosen, regardless of whether the item was disabled or enabled.<TR>
<TD>MenuFlash <TD>Contains the current count (number of times) a menu item blinks when chosen by the user.<TR>
<TD>MenuHook<TD>Address of routine that <CODE>MenuSelect</CODE> calls after a menu title is highlighted and the menu rectangle is calculated but before the menu is drawn.<TR>
<TD>TheMenu<TD>Contains the menu ID of the highlighted menu in the menu bar.<TR>
<TD>TopMenuItem<TD>The pixel value at the top of the scrollable menu.</TABLE>
</H3>
<A NAME=HEADING187-164></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>paramErr<TD>-50<TD>Error in parameter list<TR>
<TD>memFullErr<TD>-108<TD>Not enough room in heap zone<TR>
<TD>resNotFound<TD>-192<TD>Unable to read resource<TR>
<TD>hmHelpManagerNotInited<TD>-855<TD>Help menu not set up </TABLE>
</H2>
 <P>
 <P>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-186.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-188.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
