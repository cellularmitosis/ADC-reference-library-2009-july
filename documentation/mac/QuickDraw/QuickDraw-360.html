<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Application-Defined Routines (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING360></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-359.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-361.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-332.html"><B>Chapter 7 - Pictures</B></A> / <A HREF="QuickDraw-335.html"><B>Pictures Reference</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING360-0></A>
<H2><A NAME=MARKER-9-260></A>Application-Defined Routines</H2>
 <A NAME=MARKER-2-439></A><A NAME=MARKER-2-262></A>As described in <A HREF=QuickDraw-352.html#MARKER-9-222>"Collecting Picture Information" beginning on page 7-45</A>, your application can use the <CODE>GetPictInfo</CODE>, <CODE>GetPixMapInfo</CODE>, and <CODE>NewPictInfo</CODE> functions to gather information about pictures, pixel maps, and bitmaps. Each of these functions can gather up to 256 colors in <CODE>ColorTable</CODE> and <CODE>Palette</CODE> records. In the <CODE>colorPickMethod</CODE> parameter to these functions, you specify how they should select which colors to gather. These Picture Utilities functions provide two color-picking methods: the first selects the most frequently used colors, and the second selects a weighted distribution of the existing colors. <P>
 You can also create your own color-picking method. You must compile it as a resource of type <CODE>'cpmt'</CODE> and write its entry point in assembly language. To use this color-picking method (<CODE>'cpmt'</CODE>) resource, pass its resource ID (which must be greater than 127) in the <CODE>colorPickMethod</CODE> parameter to these Picture Utilities functions. These functions call your color-picking method's entry point and pass one of four possible selectors in register D0. These functions pass their parameters on the stack. As shown in <A HREF=#MARKER-9-9>Table 7-1</A>, each selector requires your color-picking method to call a different routine, which should return its results in register D0. <P>
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-9></A><B>Table 7-1:  Routine selectors for an application-defined color-picking method</B></CAPTION>
<TH>D0 value<TH>Routine to call<TR>
<TD>0<TD>MyInitPickMethod<TR>
<TD>1<TD>MyRecordColors<TR>
<TD>2<TD>MyCalcColorTable<TR>
<TD>3<TD>MyDisposeColorPickMethod</TABLE>
<P>
 Your color-picking method (<CODE>'cpmt'</CODE>) resource should include a routine that specifies its <B>color bank</B> (that is, the structure into which all the colors of a picture, pixel map, or bitmap are gathered) and allocates whatever data your color-picking method needs. This routine is explained next as a Pascal function declared as <CODE>MyInitPickMethod</CODE>. <P>
 <A NAME=MARKER-2-264></A>Your <CODE>MyInitPickMethod</CODE> function can let the Picture Utilities generate a color bank consisting of a <B>histogram</B> (that is, frequency counts of each color) to a resolution of 5 bits per color. Or, your <CODE>MyInitPickMethod</CODE> function can specify that your application has its own custom color bank--for example, a histogram to a resolution of 8 bits per color.<P>
 If you create your own custom color bank, your <CODE>'cpmt'</CODE> resource should include a routine that gathers and stores colors; this routine is described on <A HREF=QuickDraw-362.html#MARKER-9-271>page 7-63</A> as a Pascal function declared as <CODE>MyRecordColors</CODE>.<P>
 For the number of colors your application requests using the Picture Utilities, your <CODE>'cpmt'</CODE> resource should include a routine that determines which colors to select from the color bank and then fills an array of <CODE>ColorSpec</CODE> records with those colors; this routine is described on <A HREF=QuickDraw-363.html#MARKER-9-276>page 7-64</A> as a Pascal function declared as <CODE>MyCalcColorTable</CODE>. The Picture Utilities function that your application initially called then returns these colors in a <CODE>Palette</CODE> record or <CODE>ColorTable</CODE> record, as specified by your application when it first called the Picture Utilities function.<A NAME=MARKER-2-6></A><P>
 Your <CODE>'cpmt'</CODE> resource should include a routine that releases the memory allocated by your <CODE>MyInitPickMethod</CODE> routine. The routine that releases memory is described on <A HREF=QuickDraw-364.html#MARKER-9-280>page 7-66</A> as a Pascal function declared as <CODE>MyDisposeColorPickMethod</CODE>.<P>
 If your routines return an error, that error is passed back to the <CODE>GetPictInfo</CODE>, <CODE>GetPixMapInfo</CODE>, or <CODE>NewPictInfo</CODE> function, which in turn passes the error to your application as a function result.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-359.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-361.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
