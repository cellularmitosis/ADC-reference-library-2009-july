<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW25: TokenTalk Programmer's Guide Update</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW25: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Jun 29, 1992 - Jul 3, 1992"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002566" title="TokenTalk Programmer's Guide Update"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW25</div>
<div id="pageheadsub">TokenTalk Programmer's Guide Update</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Section1">Getting the Latest TokenTalk Software</a><BR><BR><a href="#Section2">TokenTalk Prefs File</a><BR><BR><a href="#Section3">TokenTalk Prep Services</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note presents the additions and changes to the <i>TokenTalkProgrammer's Guide</i> and the latest information with regard to softwaredevelopment for the Apple Token Ring NB and Token Ring 4/16 NB networkcards.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jul 01 1992]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>With the release of the Token Ring 4/16 NB Card, the TokenTalk driver softwarewas modified to support the Multivendor ADEV Architecture. This architecture isdescribed in detail in M.NW.AppleTalk2, <A HREF = "nw_03.html">"What's New With AppleTalk Phase 2."</a>This Technote presents topics specific to TokenTalk as presented in the<i>TokenTalk Programmer's  Guide</i>.</p><p>The first section, "TokenTalk Prefs File," discusses changes to the<code>'llcp'</code> resources of the TokenTalk Prefs file. The Options field is nowused to store the speed setting for the card and to determine whether the EarlyToken Release feature is to be supported.</p><p>The next section, "TokenTalk Prep Services," describes the new TokenTalk Preputility routines for getting and setting the default and boot parameters for anApple MCP (Macintosh Coprocessor Platform) based token ring network card.</p><P><A HREF="#top">Back to top</A></P><a name="Section1"></a><h2>Getting the Latest TokenTalk Software</h2><p>For testing purposes, the latest version of AppleTalk and related software canbe installed by using the Network Software Installer, available on the latestDeveloper CD, on AppleLink on the Developer Services Bulletin Board, and on theInternet through anonymous FTP to ftp.apple.com (130.43.2.3). The NetworkSoftware Installer includes all necessary components for the TokenTalk driversoftware including A/ROSE.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>TokenTalk Prefs File</h2><p>This section  discusses the changes to the <code>'llcp'</code> resource andsupplements the material presented in Chapter 6, "Download and Initialization"of the <i>Programmer's Guide</i>. The primary change to the resource concernsthe 'Options' field, and the increase of the default <code>MaxFrame</code> sizesetting. The TokenTalk Prefs file will be found in the Preferences folder insystem software version 7.0 and later, and in the System Folder for version6.0.x. The file contains the preferred Logical Link Control (LLC)initialization parameters for a card. These parameters are stored in<code>'llcp'</code> resources with resource IDs corresponding to the slot number ofthe smart Token Ring Card to be supported. These initialization parametersoverride the default settings provided in the TokenTalk Prep file. For example,if the user selects a smart Token Ring Card in NuBus slot 9 to be used, theTokenTalk Prep routines will search for <code>'llcp'</code> resource ID 9 in thePrefs file. If the resource is not found in the Prefs file, the default<code>'llcp'</code> parameters in the Prep file will be used.</p><p>The format of the <code>'llcp'</code> is as follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>typedef struct{    long              FAddr;            /* Functional address */    long              GAddr;            /* Group address */    long              Options;          /* See below */    void           (*Listener)(); /* Pointer to SAP 0 listener, always 0 in resource */    unsigned short    MaxFrame;         /* Maximum frame size */    unsigned short    StationMax;       /* Maximum number of stations */    unsigned short    BufferSize;       /* Buffer size within chipset */    unsigned char     SAPMax;           /* Maximum number of SAPs */    unsigned char     GSAPMax;          /* Maximum number of GSAPs */    unsigned char     GSAPMemberMax;    /* Maximum number of members in a group SAP */    unsigned char     TxBufs;           /* Number of buffers in transmit list */    unsigned char     RxBufs;           /* Number of buffers in receive list */    unsigned char     IntMsgs;          /* Number of interrupt message buffers */    unsigned char     TimerT1_1;        /* Default group 1 response timer */    unsigned char     TimerT2_1;        /* Default group 1 receive acknowledge timer */    unsigned char     TimerTI_1;        /* Default group 1 inactivity timer */    unsigned char     TimerT1_2;        /* Default group 2 response timer */    unsigned char     TimerT2_2;        /* Default group 2 receive acknowledge timer*/    unsigned char     TimerTI_2;        /* Default group 2 inactivity timer */    unsigned char     TxBufMin;         /* Transmit buffers minimum */    unsigned char     TxBufMax;         /* Transmit buffers maximum */    unsigned char     NodeAddr[6];      /* Node address (0 to use burned-in address)*/    unsigned char     ProdID[18];       /* Product ID string */    unsigned char     LLCName[32];      /* IPC name of this LLC (C string) */</pre>	</TD></TR></TABLE></CENTER><h3>Options Field</h3><p>TokenTalk version 2.4 makes use of the low three bits of the <code>Options</code>field as follows:</p><p>Bits 0 and 1 are used to indicate the current speed setting for the Token Ring4/16 NB Card as follows:</p><p>    4 Mbits/sec    <code>bit 0 -&gt; ON,  bit 1 -&gt; OFF</code></p><P>16 Mbits/sec    <code>bit 0 -&gt; OFF, bit 1 -&gt; ON</code></p><p>Bit 2 is used to flag use of the "Early Token Release" feature : <code>0 -&gt;ON, 1 -&gt; OFF</code>.  This feature only applies to the TokenRing 4/16 NB cardwhen operating at 16 Mbits/sec.</p><p>For speed switchable cards, the TokenTalk Phase 2 ADEV checks whether bits 0and 1 have been set correctly when the user selects a smart card in the networkcdev. If neither bit is set, the user is presented with a dialog box allowingthe user to select the desired speed. The Token Ring cdev also checks thesebits to determine which radio button to select for speed switchable smartcards. For the TokenTalk NB card, which is nonswitchable, the bit settings areinsignificant, and the speed is assumed to be 4 Mbits/sec.</p><h3>Default Maximum Frame Size</h3><p>The default MaxFrame size setting in TokenTalk version 2.3 and earlier was 1536bytes. With TokenTalk Prep version 2.4, the maximum default frame size has beenincreased to 4464 bytes. The maximum frame size setting limits the amount ofmemory set aside by the token ring chipset for each receive buffer.  If on an<code>LLCOpenSAP</code> or <code>LLCOpenStation</code> call, the <code>MaxIField</code>setting is greater than the <code>MaxFrame</code> value specified in the <code>'llcp'</code>resource, then the <code>MaxFrame</code> value is used instead.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>TokenTalk Prep Services</h2><p>TokenTalk Prep version 2.4 provides several new services to developers fordetermining and setting boot time parameters, and determining whether the TokenRing Card is speed switchable. The following new selectors are implemented inthe TokenTalk Prep <code>'ttut'</code> utilities. This section supplements thematerial presented in Chapter 6, "Download and Initialization," of the<i>Programmer's Guide. </i></p><p><code>TTGetDefaultParms</code> 10 Return default <code>TRInit</code> parameters.</p><p><code>TTGetBootParms</code> 11 Return <code>TRInit</code> parameters to use at the next boottime.</p><p><code>TTSetBootParms</code> 12 Save <code>TRInit</code> parameters to the TokenTalk Prefsfile.</p><p><code>TTSpeedSwitchable</code> 13 Determine if the token ring speed is switchable or not.</p><h3>TTGetDefaultParms</h3><p>The <code>TTGetDefaultParms</code> function returns a pointer to the default LLCinitialization parameters from the TokenTalk Prep file <code>'llcp'</code>resource. The second parameter to this request is a mask of the slot to operateon. This mask must have only a single bit set since the default parameters fora single card can be returned. The result of this operation is a 32-bit NuBusaddress, a pointer to a structure of type <code>TRInit</code>, if nonzero. The pointer mustbe disposed of when finished.</p><p>This function calls a card-specific routine to fill in the address field withthat of the burned-in address from the card, the Product ID string, and the<code>LLCName</code> as a C string. A result of 0 indicates that </p><p>    1.  there is no supported card in the specified slot,</p>    <p>2.  more than one card was specified,</p>    <p>3.  the 'llcp' resource could not be found,</p>    <p>4.  or a memory allocation error occurred.</p><p>The following call returns the default LLC parameters for a smart Token RingCard in NuBus slot C:</p><p><code>    result = (*UtilPtr) (TTGetDefaultParms, 1&lt;&lt;0xC);</code></p><h3>TTGetBootParms</h3><p>The <code>TTGetBootParms</code> function returns a pointer to the LLCinitialization parameters to be used on the next boot of the designated card.As with the <code>TTGetDefaultParms</code> function, the second parameter to thisrequest is a mask of the slot to operate on. This mask must have only a singlebit set. This function first checks whether a card-specific <code>'llcp'</code>resource for the card exists in the TokenTalk Prefs file; otherwise the defaultparameters specified in the <code>'llcp'</code> resource in the Prep file arereturned. The result of this operation is a 32-bit NuBus address, a pointer toa structure of type <code>TRInit</code>, if nonzero. The pointer must be disposed of whenfinished.</p><p>This function calls a card-specific routine to fill in the address field withthat of the burned-in address from the card, the Product ID string, and the<code>LLCName</code> as a C string. A result of 0 indicates that </p><p>    1.  there is no supported card in the specified slot,</p>    <p>2.  more than one card was specified,</p>    <p>3.  an 'llcp' resource could not be found,</p>    <p>4.  or a memory allocation error occurred.</p><p>The following call returns the default LLC parameters for a smart Token RingCard in NuBus slot D:</p><p><code>    result = (*UtilPtr) (TTGetBootParms, 1&lt;&lt;0xD);</code></p><h3>TTSetBootParms</h3><p>The <code>TTSetBootParms</code> function stores LLC initialization parameters tothe TokenTalk Prefs file. The function takes as input a pointer to a structureof type <code>TTSetBP</code> as the second parameter. The structure type,<code>TTSetBP</code>, is described below. The function searches for the Prefs filein the Preferences folder or creates the file if one does not exist. It thenwrites the initialization parameters to an <code>'llcp'</code> resource using theslot number passed in the <code>TTSetBP</code> parameter block. If an<code>'llcp'</code> resource already exists under the ID of the slot number, theold resource is replaced by the new parameters. The function returns<code>TRUE</code> if the parameters are successfully stored, or <code>FALSE</code> ifunsuccessful. Under system software version 6.0.x, the Prefs file is searchedfor or created in the Blessed Folder.</p><p>The newly stored LLC initialization parameters will be used the next time thecard is started. To use the burned-in address on the card as the node addressof the card, set all bytes of the NodeAddr field to 0.</p><p>A result of 0 indicates that </p><p>    1.  a memory allocation error occurred,</p><p>2.  a problem occurred opening the Preferences folder or file,</p><p>3.  the Prefs file could not be created,</p><p>4.  or Resource Manager error occurred.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>typedef struct{       long     SlotNo;    /* Slot number to save */       TRInit   *TRPtr;    /* Pointer to a TRInit data structure described above */</pre>	</TD></TR></TABLE></CENTER><p>The following demonstrates the use of the <code>TTGetBootParms</code> utility toset the boot parameters for a smart Token Ring Card in NuBus slot E:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>      TRInit  myTRRec;       TTSetBp  my SetBP       void  *SetMyTRInitRec(TRInit &amp;myTRRec);       SetMyTRInitRec(myTRRec); /* set LLC parameters */       mySetBP.SlotNo = 0x0E;       mySetBP.TRPtr = myTRRec;</pre>	</TD></TR></TABLE></CENTER><h3>TTSpeedSwitchable</h3><p>The <code>TTSpeedSwitchable</code> function returns <code>true</code> if the speed onthe Token Ring Card can be switched, or <code>false</code> if not. This functiondoes not indicate the current speed setting for the card. To determine thespeed, check the <code>Options</code> field of the <code>'llcp'</code> resource. If thetwo lowest bits, 0 and 1, are not set, then assume that the card supports onlythe 4 Mbits/sec speed. The second parameter to this request is a mask of theslot to operate on. This mask must have only a single bit set since the settingfor only a single card can be returned.</p><p>The following call returns the default LLC parameters for a smart Token RingCard in NuBus slot A:</p><p><code>result = (*UtilPtr) (TTSpeedSwitchable, 1&lt;&lt;0xA);</code></p>    <a name="References"></a><P><i>TokenTalk Programmer's Guide</i>, Apple Computer, Inc. (M0827LL/A)</p><P><A HREF = "nw_13.html">M.NW.AppleTalk2</a></p><P><i>Macintosh Coprocessor Platform Developer's Kit</i>, Apple Computer,Inc. (M0793LL/A)</p>                                    <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (60K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_25.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_25.html%3Fid%3DDTS10002566-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_25.html%3Fid%3DDTS10002566-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_25.html%3Fid%3DDTS10002566-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>