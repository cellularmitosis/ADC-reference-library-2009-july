<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating a Translation List (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING417></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-416.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-418.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-402.html"><B>Chapter 7 - Translation Manager</B></A> / <A HREF="MoreToolbox-414.html"><B>Writing a Translation Extension</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING417-0></A>
<H2>Creating a Translation List</H2>
 Your translation extension must be able to inform Macintosh Easy Open of its translation capabilities in response to the <CODE>kTranslateGetFileTranslationList</CODE> request code. To do this, you can define a <CODE>DoGetFileTranslationList</CODE> function in which you fill in a <B>file translation list,</B> defined by a <CODE>FileTranslationList</CODE> record. From the file translation list you return, Macintosh Easy Open learns which types of files your extension can translate into which other types. On the basis of this information, it may later call your extension to identify a particular document and possibly to translate it.<A NAME=MARKER-2-155></A><P>
 <A NAME=MARKER-2-156></A>The <CODE>FileTranslationList</CODE> record has this structure:<P>
<PRE>
TYPE FileTranslationList = 
   RECORD
      modDate:                LongInt;
      groupCount:             LongInt;
      {group1SrcCount:        LongInt;}
      {group1SrcEntrySize:    LongInt;}
      {group1SrcTypes:        ARRAY[1..group1SrcCount] OF FileTypeSpec;}
      {group1DstCount:        LongInt;}
      {group1DstEntrySize:    LongInt;}
      {group1DstTypes:        ARRAY[1..group1DstCount] OF FileTypeSpec;}
      {repeat above six lines for a total of groupCount times}
   END;
</PRE>
 This record contains a modification date and a count of the number of translation groups that follow. Each <B>translation group<A NAME=MARKER-2-157></A></B> in the file translation list specifies a collection of file types from which the extension can translate (the <CODE>group1SrcTypes</CODE> field) and a collection of file types into which the extension can translate (the <CODE>group1DstTypes</CODE> field). Within a translation group, your extension must be able to translate any of the source types into any of the destination types.<P>
 You might have different translation groups corresponding to different categories of documents. For instance, you can place word-processing documents in one group, spreadsheet documents in another, and so on. You are, however, free to group file types in whatever manner you like.<P>
 In most cases, <CODE>group1SrcCount</CODE> and <CODE>group1DstCount</CODE> will each be greater than 1, because most translators operate by translating through a particular data model. In these cases, it's also quite likely that the source and destination file types overlap or even coincide. <A HREF=#MARKER-9-158>Figure 7-8</A> illustrates a typical translation group.<P>
<B>Figure 7-8  <A NAME=MARKER-9-158></A>A translation group with multiple source and destination types</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TR_L-05.jpg">
 Similarly, you might write a translation extension that converts other file types into your own proprietary document format. In this case, you would have multiple source document types but only one destination type (<CODE>group1DstCount</CODE> equal to 1), as illustrated in <A HREF=#MARKER-9-159>Figure 7-9</A>.<P>
<B>Figure 7-9  <A NAME=MARKER-9-159></A>A translation group with a single destination type</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TR_L-06.jpg">
 It's possible, however, to have both <CODE>group1SrcCount</CODE> and <CODE>group1DstCount</CODE> equal <BR>to 1. This kind of translation is known as <B>point-to-point translation<A NAME=MARKER-2-160></A>.</B> <A HREF=#MARKER-9-161>Figure 7-10</A> illustrates point-to-point translation.<P>
<B>Figure 7-10  <A NAME=MARKER-9-161></A>Point-to-point translation<A NAME=MARKER-2-162></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TR_L-07.jpg">
<DL>
<DT><B>Note</B>
<DD>The number of translation groups you can specify in a file translation list is limited by memory considerations only.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Within any particular group of file types, you specify a particular document format using a <B>file type specification<A NAME=MARKER-2-163></A>,</B> defined by the <CODE>FileTypeSpec</CODE> data type.<P>
<PRE>
TYPE FileTypeSpec = 
   RECORD
      format:           FileType;
      hint:             LongInt;
      flags:            TranslationAttributes;
      catInfoType:      OSType;
      catInfoCreator:   OSType;
   END;
</PRE>
 A file type specification includes the file type, a hint reserved for use by your extension, a flags field, and the original file type and creator. See <A HREF=MoreToolbox-434.html#MARKER-9-228>"File Type Specifications" beginning on page 7-46</A> for complete details on these fields.<P>
 <A HREF=#MARKER-9-164>Listing 7-6</A> shows a simple routine that creates a file translation list. The translation extension containing this routine can translate both SurfWriter and SurfPaint documents to a format understood by TeachText.<P>
<B>Listing 7-6  <A NAME=MARKER-9-164></A>Creating a file translation list<A NAME=MARKER-2-165></A></B><P>
<PRE>
FUNCTION DoGetFileTranslationList 
                     (self: ComponentInstance; 
                      translationList: FileTranslationListHandle) 
                      : ComponentResult;


TYPE
   MyList =
      RECORD
         modDate:                LongInt;
         groupCount:             LongInt;
         group1SrcCount:         LongInt; 
         group1SrcEntrySize:     LongInt;
         group1SrcTypes:         ARRAY[1..2] OF FileTypeSpec; 
         group1DstCount:         LongInt;
         group1DstEntrySize:     LongInt;
         group1DstTypes:         ARRAY[1..1] OF FileTypeSpec;
      END;
   MyListPtr      = ^MyList;
   MyListHandle   = ^MyListPtr;
VAR
   myErr:      OSErr;
   myPtr:      MyListPtr;
CONST
   kStamp      = $A74520A8;      {date of original list creation}
BEGIN
   myErr := noErr;
   IF translationList^^.modDate &lt;&gt; kStamp THEN
   BEGIN
      {resize the handle so there's enough room}
      SetHandleSize(Handle(translationList), SizeOf(MyList));
      myErr := MemError;
      IF myErr = noErr THEN
      BEGIN
         myPtr := MyListHandle(translationList)^;
         WITH myPtr^ DO
         BEGIN
            modDate := kStamp;               {set creation date}
            groupCount := 1;                 {only 1 translation group}
            group1SrcCount := 2;             {source side has two types}
            group1SrcEntrySize := SizeOf(FileTypeSpec);
            WITH group1SrcTypes[1] DO
            BEGIN
               format := 'SURF';             {SurfWriter document format}
               hint := 0;                    {no hint}
               flags := 0;                   {no flags}
               catInfoType := 'SURF';        {catalog type}
               catInfoCreator := 'TONY';     {catalog creator}
            END;
            WITH group1SrcTypes[2] DO
            BEGIN
               format := 'SPNT';             {SurfPaint document format}
               hint := 0;                    {no hint}
               flags := 0;                   {no flags}
               catInfoType := 'SPNT';        {catalog type}
               catInfoCreator := 'TONY';     {catalog creator}
            END;
            group1DstCount := 1;             {destination side has one type}
            group1DstEntrySize := SizeOf(FileTypeSpec);
            WITH group1DstTypes[1] DO
            BEGIN
               format := 'ttro';             {TeachText document format}
               hint := 0;                    {no hint}
               flags := taDstDocNeedsResourceFork;
                                             {TeachText documents need a }
                                             { resource fork (for pictures)}
               catInfoType := 'ttro';        {catalog type}
               catInfoCreator := 'ttxt';     {catalog creator}
            END;
         END; {WITH myPtr^}
      END; {IF}
   END; {IF}
   DoGetFileTranslationList := myErr;
END;
</PRE>
 Because the list of file types that this extension can translate never changes, <CODE>DoGetFileTranslationList</CODE> fills out a file translation list the first time Macintosh Easy Open calls it; every other time it is called, <CODE>DoGetFileTranslationList</CODE> simply passes back the list it was passed.<A NAME=MARKER-9-406></A><P>
 In all likelihood, your translation extension will rely on external translators to perform the actual translation of files or scraps. If so, it's also likely that the user will be able to add and remove translators used by your extension--possibly by moving translators into or out of some specific folder. In that case, your <CODE>DoGetFileTranslationList</CODE> function could read the modification date of that folder and compare with a value you previously put in the <CODE>modDate</CODE> field to determine whether to regenerate the translation list.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-416.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-418.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
