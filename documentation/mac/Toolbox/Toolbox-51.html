<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>WaitNextEvent(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING51></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-50.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-52.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-28.html"><B>Chapter 2 - Event Manager</B></A> / <A HREF="Toolbox-43.html"><B>Event Manager Reference</B></A><BR><DL><DD><A HREF="Toolbox-49.html"><B>Event Manager Routines</B></A> / <A HREF="Toolbox-50.html"><B>Receiving Events</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING51-0></A>
<H3><A NAME=MARKER-9-367></A>WaitNextEvent</H3>
 <A NAME=MARKER-11-368></A><A NAME=MARKER-21-214></A>You can use the <CODE>WaitNextEvent</CODE> function to retrieve events one at a time from the Event Manager.<P>
<PRE>
FUNCTION WaitNextEvent (eventMask: Integer;
                        VAR theEvent: EventRecord; sleep: LongInt;
                        mouseRgn: RgnHandle): Boolean;
</PRE>
<DL>
<DT><CODE>eventMask</CODE>
<DD> A value that indicates which kinds of events are to be returned; this parameter is interpreted as a sum of event mask constants. You can use these constants to specify the event mask:<A NAME=MARKER-9-453></A>
</DL>
<PRE>
            CONST          
            mDownMask       = 2;    {mouse-down event    (bit 1)}
            mUpMask         = 4;    {mouse-up event      (bit 2)}
            keyDownMask     = 8;    {key-down event      (bit 3)}
            keyUpMask       = 16;   {key-up event        (bit 4)}
            autoKeyMask     = 32;   {auto-key event      (bit 5)}
            updateMask      = 64;   {update event        (bit 6)}
            diskMask        = 128;  {disk-inserted event (bit 7)}
            activMask       = 256;  {activate event      (bit 8)}
            highLevelEventMask
                            = 1024; {high-level event    (bit 10)}
            osMask          = -32768;{operating-system   (bit 15)}
</PRE>
<DL>
<DT>
<DD> To accept all events, you can specify the <CODE>everyEvent</CODE> constant as the event mask:
</DL>
<PRE>
            CONST
            everyEvent     =  -1;   {every event}
</PRE>
<DL>
<DT>
<DD> If no event of any of the designated types is available, <CODE>WaitNextEvent</CODE> returns a null event. <CODE>WaitNextEvent</CODE> determines the next available event to return based on the <CODE>eventMask</CODE> parameter and the priority of the event. 
<DT>
<DD> Events not designated by the event mask remain in the event stream until retrieved by an application. Low-level events in the Operating System event queue are kept in the queue until they are retrieved by your application or another application or until the queue becomes full. Once the queue becomes full, the Operating System Event Manager begins discarding the oldest events in the queue. 
<DT><CODE>theEvent</CODE>
<DD> The next available event of the specified type or types. The <CODE>WaitNextEvent</CODE> function removes the returned event from the event stream and returns the information about the event in an event record. The event record includes the type of event received and other information. See <A HREF=Toolbox-45.html#MARKER-9-331>"The Event Record,"</A> beginning on <A HREF=Toolbox-45.html#MARKER-9-331>page 2-79</A>, for a description of the fields in the event record. 
<DT>
<DD> In addition to the event record, high-level events can contain additional data; you use the <CODE>AcceptHighLevelEvent</CODE> or <CODE>AEProcessAppleEvent</CODE> functions to get additional data associated with these events.
<DT><CODE>sleep</CODE>
<DD> The number of ticks (a tick is approximately 1/60 of a second) indicating the amount of time your application is willing to relinquish the processor if no events (other than null events) are pending for your application. If you specify a value greater than 0 for the <CODE>sleep</CODE> parameter, your application relinquishes the processor for the specified time or until an event occurs. 
<DT>
<DD> You should usually specify a value greater than 0 for the <CODE>sleep</CODE> parameter to allow background processes to receive processing time. You should not set the <CODE>sleep</CODE> parameter to a value greater than the number of ticks returned by <CODE>GetCaretTime</CODE> if your application provides text-editing capabilities. When the specified time expires, and if there are no pending events for your application, <CODE>WaitNextEvent</CODE> returns a null event in the parameter <CODE>theEvent</CODE>.
<DT><CODE>mouseRgn</CODE>
<DD> A handle to a region that specifies a region inside of which mouse movement does not cause mouse-moved events. In other words, your application receives mouse-moved events only when the cursor is outside the specified region. You should specify the region in global coordinates. If you pass an empty region or a <CODE>NIL</CODE> region handle, the Event Manager does not report mouse-moved events to your application. Note that your application should recalculate the <CODE>mouseRgn</CODE> parameter when it receives a mouse-moved event, or it will continue to receive mouse-moved events as long as the cursor position is outside the original <CODE>mouseRgn</CODE>.<A NAME=MARKER-2-387></A>
</DL>
<A NAME=HEADING51-14></A>
<H5>DESCRIPTION</H5>
 The <CODE>WaitNextEvent</CODE> function returns <CODE>FALSE</CODE> as its function result if the event being returned is a null event or if <CODE>WaitNextEvent</CODE> has intercepted the event; otherwise, <CODE>WaitNextEvent</CODE> returns <CODE>TRUE</CODE>. The <CODE>WaitNextEvent</CODE> function calls the Operating System Event Manager function <CODE>SystemEvent</CODE> to determine whether the event should be handled by the application or the Operating System.<P>
 If no events are pending for your application, <CODE>WaitNextEvent</CODE> waits for a specified amount of time for an event. (During this time, processing time may be allocated to background processes.) If an event occurs, it is returned as the value of the parameter <CODE>theEvent</CODE>, and <CODE>WaitNextEvent</CODE> returns a function result of <CODE>TRUE</CODE>. If the specified <BR>time expires and there are no pending events for your application, <CODE>WaitNextEvent</CODE> returns a null event in <CODE>theEvent</CODE> and a function result of <CODE>FALSE</CODE>. <P>
 Before returning an event to your application, <CODE>WaitNextEvent</CODE> performs other processing and may intercept the event. <P>
 The <CODE>WaitNextEvent</CODE> function intercepts Command-Shift-number key sequences and calls the corresponding '<CODE>FKEY</CODE>' resource to perform the associated action. The Event Manager's processing of Command-Shift-number key sequences with numbers 3 through 9 can be disabled by setting the <CODE>ScrDmpEnable</CODE> global variable (a byte) to 0. <A NAME=MARKER-2-224></A><P>
 The <CODE>WaitNextEvent</CODE> function also makes the alarm go off if the alarm is set and <BR>the current time is the alarm time. The user sets the alarm using the Alarm Clock <BR>desk accessory.<P>
 <A NAME=MARKER-11-373></A>The <CODE>WaitNextEvent</CODE> function also calls the <CODE>SystemTask</CODE> procedure, which gives time to each open desk accessory or device driver to perform any periodic action defined <BR>for it. A desk accessory or device driver specifies how often the periodic action should occur, and <CODE>SystemTask</CODE> gives time to the desk accessory or device driver at the appropriate interval. <A NAME=MARKER-2-325></A><P>
 <A NAME=MARKER-2-377></A>Some high-level events may be fully specified by their event records only, while others may include additional information in an optional buffer. To get any additional information and to find the sender of the event, use the <CODE>AcceptHighLevelEvent</CODE> function.<A NAME=MARKER-2-327></A><A NAME=MARKER-21-652></A><P>
 If the returned event is a high-level event and your application supports Apple events, use the Apple Event Manager function <CODE>AEProcessAppleEvent</CODE> to respond to the Apple event and to get additional information associated with the Apple event.<P>
<A NAME=HEADING51-23></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 In System 7, if your application is in the foreground and the user opens a desk accessory or other item from the Apple menu, clicks in the window belonging to another application or desk accessory, or chooses another process from the Application menu, the next event reported to your application by the <CODE>WaitNextEvent</CODE> function is a suspend event. After your application is switched out, the Event Manager directs events (other than events your application can receive in the background) to the newly activated process until the user switches back to your application or another application.<P>
<DL>
<DT><B>Note</B>
<DD>In a single-application environment in System 6, and in a multiple- application environment in which the desk accessory is launched in <BR>the application's partition (for example, a desk accessory opened by the user from the Apple menu while holding down the Option key), the Event Manager handles events for desk accessories in a slightly <BR>different manner. <A NAME=MARKER-2-181></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
<DD><A NAME=MARKER-11-379></A>In these environments, when mouse-up, activate, update, and keyboard events (including keyboard equivalents of menu commands) occur, the Event Manager checks to see whether the active window belongs to a desk accessory and whether the desk accessory can handle the event. If so, it sends the event to the desk accessory and <CODE>WaitNextEvent</CODE> returns <CODE>FALSE</CODE> to your application. Also note that in these environments, the Event Manager returns <CODE>TRUE</CODE> for mouse-down events, regardless of whether the mouse-down event is for a desk accessory or not. For mouse-down events in these situations, if the mouse button was <BR>pressed while the cursor was in a desk accessory window (as indicated by the <CODE>inSystem</CODE> constant returned by the <CODE>FindWindow</CODE> function), <BR>your application should call the <CODE>SystemClick</CODE> procedure. The <CODE>SystemClick</CODE> procedure handles mouse-down events as appropriate for desk accessories, including sending your application an activate event to deactivate its front window if the desk accessory window needs to be activated.<EM></EM> <A NAME=MARKER-2-124></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING51-27></A>
<H5>SEE ALSO</H5>
 For examples that use the <CODE>WaitNextEvent</CODE> function, see <A HREF=Toolbox-38.html#MARKER-9-100>Listing 2-1 on page 2-23</A> and <A HREF=Toolbox-38.html#MARKER-9-103>Listing 2-2 on page 2-24</A>.<P>
 To get information about the sender of a high-level event and to retrieve any <BR>additional data associated with the high-level event, see the description of the <CODE>AcceptHighLevelEvent</CODE> function on <A HREF=Toolbox-189.html#MARKER-9-9>page 2-90</A>. For details on how to process <BR>an Apple event, see the description of the <CODE>AEProcessAppleEvent</CODE> function in <BR><I><A HREF="../IAC/IAC-2.html">Inside Macintosh: Interapplication Communication</A></I>.<P>
 For information on how to retrieve an event without removing it from the event stream, see the description of the <CODE>EventAvail</CODE> function, immediately following. <A NAME=MARKER-2-286></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-50.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-52.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
