<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Displaying Cyberdog Menus(Cyberdog)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING26></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Cyberdog-25.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-27.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Cyberdog-2.html"><B>Cyberdog Programmer's Kit</B></A> / <A HREF="Cyberdog-20.html"><B>Part 2 - Programming in Cyberdog</B></A><BR><DD><A HREF="Cyberdog-21.html"><B>Chapter 3 - Adding Cyberdog Features to an OpenDoc Part</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING26-0></A>
<H1><A NAME=MARKER-9-55></A>Displaying Cyberdog Menus</H1>
 <A NAME=MARKER-2-56></A><A NAME=MARKER-2-57></A><A NAME=MARKER-2-58></A>A Cyberdog service menu object handles the display of the Cyberdog menu and the Mail/News menu. It also allows services, such as FTP and Gopher, to install their menus as well. Collectively, these menus are called the Cyberdog service menus. You set up these menus by creating a <A NAME=MARKER-2-59></A>CyberServiceMenu object and calling its <A NAME=MARKER-2-60></A><CODE>IC</CODE>yberServiceMenu method. When your part is destroyed, you can delete the service menu object. See <A HREF=Cyberdog-24.html#MARKER-9-28>Listing 3-3 (page 95)</A>.<P>
 <A HREF=#MARKER-9-61>Listing 3-11</A> shows the button part's <CODE>CreateMenus</CODE> method, which creates and initializes the Cyberdog service menu object and adds it to the menu bar.<P>
<B>Listing 3-11  <A NAME=MARKER-9-61></A>Creating Cyberdog's menus</B><P>
<PRE>
void CybTxtBtn::CreateMenus(Environment* ev)
{
   ODSession* session = ODGetSession(ev,fSelf);
   
   // Copy the base menu bar.
   fMenuBar = session-&gt;GetWindowState(ev)-&gt;CopyBaseMenuBar(ev);

   // Extend it with Cyberdog's menus.
   fCyberServiceMenu = new CyberServiceMenu;
   if (fCyberServiceMenu)
      fCyberServiceMenu-&gt;ICyberServiceMenu(ev, fMenuBar, 
                                    fSelf, kBaseResourceID);
}
</PRE>
 In the call to the ICyberServiceMenu method, the <CODE>kBaseResourceID</CODE> constant specifies the first value to use for Cyberdog menu commands. The value you choose must allow Cyberdog menus to fall within the range supported by OpenDoc. In this example, the <CODE>kBaseResourceID</CODE> constant is defined as follows:<P>
<PRE>
#define  kBaseResourceID20001
</PRE>
 For more information about the Cyberdog command numbers, see the CyberServiceMenu class <A HREF=Cyberdog-244.html#MARKER-9-336>(page 341)</A>.<P>
 You must anticipate that the menu bar changed between activations of your part. You should recreate the menu bar each time your part is activated or its menus are adjusted. <A HREF=#MARKER-9-62>Listing 3-12</A> shows the button part's CheckMenus method, which recreates the menu bar.<P>
<B>Listing 3-12  <A NAME=MARKER-9-62></A>Recreating the menu bar</B><P>
<PRE>
void CybTxtBtn::CheckMenus(Environment* ev, ODFrame* frame)
{
   if (fMenuBar-&gt;IsValid(ev) == kODFalse)
   {
      // Release the old menu bar and the CyberServiceMenu object
      if (fCyberServiceMenu)
      {
         delete fCyberServiceMenu;
         fCyberServiceMenu = kODNULL;
      }
      
      ODReleaseObject(ev, fMenuBar);
      fMenuBar = kODNULL;
      
      // Recreate the menus.
      CreateMenus(ev);
      
      // If the part has the menu focus, inform the newly created
      // CyberServiceMenu object and display the newly created menu bar
      if (frame != kODNULL)
      {
         ODBoolean hasMenuFocus;
         ODArbitrator* arbitrator 
                     = ODGetSession(ev,fSelf)-&gt;GetArbitrator(ev);
         TempODFrame menuOwner 
          = arbitrator-&gt;AcquireFocusOwner(ev, gGlobals-&gt;fMenuFocus);
         hasMenuFocus = ODObjectsAreEqual(ev, frame, menuOwner);
         
         if (hasMenuFocus)
         {
            if (fCyberServiceMenu)
               fCyberServiceMenu-&gt;MenuFocusAcquired(ev, frame);
            // Display the menu bar.
            fMenuBar-&gt;Display(ev);
         }
      }
   }
}
</PRE>
 <A NAME=MARKER-2-63></A>When your part has the menu focus, you must call the service menu object's MenuFocusAcquired method to activate Cyberdog's menus. <A HREF=#MARKER-9-65>Listing 3-13</A> shows the button part's PartActivated method, which calls the service menu's <A NAME=MARKER-2-64></A>MenuFocusAcquired method.<P>
<B>Listing 3-13  <A NAME=MARKER-9-65></A>Acquiring the Cyberdog service menu's focus</B><P>
<PRE>
void CybTxtBtn::PartActivated(Environment* ev,
                      ODFrame* frame )
{
   CheckMenus(ev, kODNULL);

   fCyberServiceMenu-&gt;MenuFocusAcquired(ev, frame);
   fMenuBar-&gt;Display(ev);
   ...
}
</PRE>
 When your part is no longer active, you must call the service menu's MenuFocusLost method to deactivate Cyberdog's menus. <A HREF=#MARKER-9-67>Listing 3-14</A> shows the button part's FocusLost method, which calls the <A NAME=MARKER-2-66></A>MenuFocusLost method.<P>
<B>Listing 3-14  <A NAME=MARKER-9-67></A>The button part's <CODE>FocusLost</CODE> method</B><P>
<PRE>
void CybTxtBtn::FocusLost(Environment* ev, ODTypeToken focus, 
                                       ODFrame* ownerFrame )
{
   if ( focus == gGlobals-&gt;fSelectionFocus )
   {
   ...
   }
   else if( focus == gGlobals-&gt;fMenuFocus )
   {
      // Tell the CyberServiceMenu object that the menu focus is lost.
      if (fCyberServiceMenu)
         fCyberServiceMenu-&gt;MenuFocusLost(ev, ownerFrame);
   }
}
</PRE>
 You must also allow menus to adjust their items and allow the menu items to handle menu events. <P>
<UL>
<LI>You call the Cyberdog service menu object's <CODE>Adjust</CODE> method, which allows service menus to enable or disable their menu items. See <A HREF=Cyberdog-27.html#MARKER-9-74>Listing 3-15 (page 109)</A>.
<LI>You call the Cyberdog service menu object's <CODE>DoCommand</CODE> method, which allows services to handle their commands. See <A HREF=Cyberdog-27.html#MARKER-9-78>Listing 3-16 (page 110)</A>.<P>
</UL>
 In this example, these methods are called by the button part's <CODE>AdjustMenus</CODE> and <CODE>HandleMenuEvents</CODE> methods, respectively, as shown in the following section. The <CODE>AdjustMenus</CODE> method also deletes and recreates the Cyberdog service menu object when a root part's menus are adjusted.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Cyberdog-25.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-27.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Cyberdog-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>   
