<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Safari JavaScript Database Programming Guide: Relational Database Basics</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Relational Database Basics"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40007256-CH5" title="Relational Database Basics"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../../InternetWeb/Scripting-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000569" target="_top">Scripting &amp; Automation</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40007256-CH1-SW1">Safari JavaScript Database Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40007256-CH5-SW2" title="Relational Database Basics"></a><h1>Relational Database Basics</h1><p>There are many kinds of databases: flat databases, relational databases, object-oriented databases, and so on. Before you can understand relational databases, you must first understand flat databases.</p><p>A flat database consists of a single table of information. The rows in the table (also called records) each contain all of the information about a single entry—a single person’s name, address, and ZIP code, for example. The row is further divided into fields, each of which represents a particular piece of information about that entry. A <code>name</code> field, for example, might contain a person’s name.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW9" title="Note"></a><p><strong>Note:</strong>&nbsp;The terms column and field are often used interchangeably, but the term column typically refers collectively to a particular field in <em>every</em> row. In other words, the table as a whole is divided into rows and columns, and the intersection of a row and column is called a field.</p></div><p>This design allows you to rapidly access a subset of the information in a table. For example, you might want to get a list of the names and phone numbers of everyone in a particular ZIP code, but you might not care about the rest of the address.</p><p>Consider this example of a medical database for an insurance company. A flat database (not relational), might contain a series of records that look like this:</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW1"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>First Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Last Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Address</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>City</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>State</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ZIP</p></th></tr><tr><td  scope="row"><p>John</p></td><td ><p>Doe</p></td><td ><p>56989 Peach St.</p></td><td ><p>Martin</p></td><td ><p>TN</p></td><td ><p>38237</p></td></tr><tr><td  scope="row"><p>Jane</p></td><td ><p>Doe</p></td><td ><p>56989 Peach St.</p></td><td ><p>Martin</p></td><td ><p>TN</p></td><td ><p>38237</p></td></tr></table></div><p>This example contains two rows, each of which contains information about a single person. Each row contains separate fields for first and last name, address, and so on.</p><p>At first glance, this database seems fairly reasonable. However, when you look more closely, it highlights a common problem with flat databases: redundancy. Notice that both of these entries contain the same address, city, state, and ZIP code. Thus, this information (and probably other information such as phone numbers) is duplicated between these two records.</p><p>A relational database is designed to maximize efficiency of storage by avoiding this duplication of information. Assuming that John and Jane are members of the same family, you could create a relational version of this information as shown in <span class="content_text">Table 1-1</span> and <span class="content_text">Table 1-2</span>.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW3" title="Table 1-1Relational database &acirc;&#128;&#156;family&acirc;&#128;&#157; table"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-1&nbsp;&nbsp;</strong>Relational database “family” table</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Last_Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Address</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>City</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>State</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ZIP</p></th></tr><tr><td  scope="row"><p>1</p></td><td ><p>Doe</p></td><td ><p>56989 Peach St.</p></td><td ><p>Martin</p></td><td ><p>TN</p></td><td ><p>38237</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007256-CH5-SW4" title="Table 1-2Relational database &acirc;&#128;&#156;familymember&acirc;&#128;&#157; table"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-2&nbsp;&nbsp;</strong>Relational database “familymember” table</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>First_Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Family_ID</p></th></tr><tr><td  scope="row"><p>1</p></td><td ><p>John</p></td><td ><p>1</p></td></tr><tr><td  scope="row"><p>2</p></td><td ><p>Jane</p></td><td ><p>1</p></td></tr></table></div><p>Instead of two separate copies of the address, city, state, and ZIP code, the database now contains only one copy. The <code>Family_ID</code> fields in the <code>familymember</code> table tell you that both John and Jane are members of the family shown in the <code>family</code> table whose <code>ID</code> field has a value of 1. This relationship between a field in one table and a field in another is where relational databases get their name.</p><p>The advantages to such a scheme are twofold. First, by having only one copy of this information, you save storage (though in this case, the savings are minimal). Second, by keeping only a single copy, you reduce the risk of mistakes. When John and Jane have their third child and move to a bigger house, the database user only needs to change the address in one place instead of five. This reduces the risk of making a typo and removes any possibility of failing to update the address of one of their children.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW8">Relationship Models and Schema</a>
				
			<br/>
			
        
			
			
				<a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW10">SQL Basics</a>
				
			<br/>
			
        
			
			
				<a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW21">Transaction Processing</a>
				
			<br/>
			
        
			
			
				<a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW22">Relational Databases and Object-Oriented Programming</a>
				
			<br/>
			
        
			
			
				<a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW7">SQL Security and Quoting Characters in Strings</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40007256-CH5-SW8" title="Relationship Models and Schema"></a><h2>Relationship Models and Schema</h2><p>When working with relational databases, instead of thinking only about what information your database describes, you should think of the relationships between pieces of information.</p><p>When you create a database, you should start by creating a conceptual model, or schema. This schema defines the overall structure of your database in terms of associations between pieces of information.</p><p>There are three basic types of relationships in databases: one-to-one, one-to-many (or many-to-one), and many-to-many. In order to use relational databases effectively, you need to think of the information in terms of those types of relationships.</p><p>A good way to show the three different types of relationships is to model a student’s class schedule.</p><p>Here are examples of each type of relationship in the context of a student class schedule:</p><ul class="ul"><li class="li"><p><strong>one-to-one relationship</strong>—A student has only one student ID number and a student ID number is associated with only one student.</p></li><li class="li"><p><strong>one-to-many relationship</strong>—A teacher teaches many classes, but generally speaking, a class has only one teacher of record.</p></li><li class="li"><p><strong>many-to-many relationship</strong>—A student can take more than one class. With few exceptions, each class generally contains more than one student.</p></li></ul><p>Because of the differences in these relationships, the database structures that represent them must also be different to maximize efficiency.</p><ul class="ul"><li class="li"><p><strong>one-to-one</strong>—The student ID number should be part of the same table as other information about the student. You should generally break one-to-one information out into a separate table only if one or more of the following is true:</p><ul class="nested"><li class="nested li"><p>You have a large blob of data that is infrequently accessed (for example, a student ID photo) and would otherwise slow down every access to the table as a whole.</p></li><li class="nested li"><p>You have differing security requirements for the information. For example, social security numbers, credit card information, and so on must by stored in a separate database.</p></li><li class="nested li"><p>You have significantly separate sets of information that are used under different conditions. For example, student grade records might take advantage of a table that contains basic information about the student, but would probably not benefit from additional information about the student’s housing or financial aid.</p></li></ul></li><li class="li"><p><strong>one-to-many</strong>—You should really think of this relationship as “many-to-one.” Instead of thinking about a teacher having multiple classes, think about each class having a single teacher. This may seem counterintuitive at first, but it makes sense once you see an example such as the one shown in <span class="content_text">Table 1-3</span>.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW5" title="Table 1-3The &acirc;&#128;&#156;classes&acirc;&#128;&#157; table"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-3&nbsp;&nbsp;</strong>The “classes” table</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Teacher_ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Class_Number</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Class_Name</p></th></tr><tr><td  scope="row"><p>1</p></td><td ><p>1</p></td><td ><p>MUS111</p></td><td ><p>Music Appreciation: Classical Music</p></td></tr><tr><td  scope="row"><p>2</p></td><td ><p>1</p></td><td ><p>MUS112</p></td><td ><p>Music Appreciation: Music of the World</p></td></tr></table></div><p>Notice that each class is associated with a teacher ID. This should contain an ID from the <code>teacher</code> table (not shown). Thus, by creating a relationship from each of the many classes to a single teacher, you have changed the relationship from an unmanageable one-to-many relationship into a very simple many-to-one relationship.</p></li><li class="li"><p><strong>many-to-many</strong>—Many-to-many relationships are essentially a convenient fiction. Your first instinct would be to somehow make each class contain a list of student IDs that were associated with this class. This, however, is not a workable approach because relational databases (or at least those based on SQL) do not support any notion of a list.</p><p>Indeed, someone thinking about this from a flat database perspective might think of a class schedule as a table containing a student’s name and a list of classes. In a relational database world, however, you would view it as a collection of students, a collection of classes, and a collection of lists that associate each person with a particular class or classes.</p><p>Thus, you should think of a many-to-many relationship as multiple collections of many-to-one relationships. In the case of students and classes, instead of having a class associated with multiple students or a student associated with multiple classes, you instead have a third entity—a “student class” entity. This naming tells you that the entity expresses a relationship between a student and a class. An example of a <code>student_class</code> table is shown in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW6">Table 1-4</a></span>.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW6" title="Table 1-4The &acirc;&#128;&#156;student_class&acirc;&#128;&#157; table"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-4&nbsp;&nbsp;</strong>The “student_class” table</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Student_ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Class_ID</p></th></tr><tr><td  scope="row"><p>1</p></td><td ><p>19</p></td><td ><p>37</p></td></tr></table></div><p>Instead of associating either the student or the class with multiple entries, you now simply have multiple <code>student_class</code> entries. Each entry associates one student with one class. Thus, you effectively have multiple students, each associated with multiple classes in a many-to-many relationship, but you did it by creating multiple instances of many-to-one relationship pairs.</p></li></ul><a name="//apple_ref/doc/uid/TP40007256-CH5-SW10" title="SQL Basics"></a><h2>SQL Basics</h2><p>The Structured Query Language, or SQL, is a standard syntax for querying or modifying the contents of a database. Using SQL, you can write software that interacts with a database without worrying about the underlying database architecture; the same basic queries can be executed on every database from SQLite to Oracle, provided that you limit yourself to the basic core queries and data types.</p><p>The JavaScript database uses SQLite internally to store information. SQLite is a lightweight database architecture that stores each database in a separate file. For more information about SQLite, see the SQLite website at <span class="content_text"><a href="http://www.sqlite.org/" target="_blank">http://www.sqlite.org/</a></span>.</p><p>For syntax descriptions in this section:</p><ul class="ul"><li class="li"><p>Text enclosed in square brackets (<code>[]</code>)is optional.</p></li><li class="li"><p>Lowercase text represents information that you choose.</p></li><li class="li"><p>An ellipsis (<code>...</code>) means that you can specify additional parameters similar to the preceding parameter.</p></li><li class="li"><p>Uppercase text and all other symbols are literal text and keywords that you must enter exactly as-is. (These keywords are not case sensitive, however.)</p></li></ul><p>The most common SQL queries are <code>CREATE TABLE</code>, <code>INSERT</code>, <code>SELECT</code>, <code>UPDATE</code>, <code>DELETE</code>, and <code>DROP TABLE</code>. These queries are described in the sections that follow.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW11" title="Note"></a><p><strong>Note:</strong>&nbsp;To easily distinguish between language keywords and other content, commands and other language keywords are traditionally capitalized in SQL queries. The SQL language, however, is case insensitive, so <code>SELECT</code> and <code>select</code> are equivalent. (Some SQL implementations do handle table and column names in a case-sensitive fashion, however, so you should always be consistent with those.)</p></div><p>For a complete list of SQL commands supported by SQLite and for additional options to the commands described above, see the SQLite language support specification at <span class="content_text"><a href="http://www.sqlite.org/lang.html" target="_blank">http://www.sqlite.org/lang.html</a></span>.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW12" title="CREATE TABLE Query"></a><h3>CREATE TABLE Query</h3><p>Creates a table.</p><div class="codesample"><table><tr><td scope="row"><pre>CREATE [TEMP[ORARY]] TABLE [IF NOT EXISTS] table_name (<span></span></pre></td></tr><tr><td scope="row"><pre>    column_name column_type [constraint],<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr></table></div><p>The most common values for <code>constraint</code> are <code>PRIMARY KEY</code>, <code>NOT NULL</code>, <code>UNIQUE</code>, and <code>AUTOINCREMENT</code>. Column constraints are optional. For example, the following <code>CREATE</code> command creates the table described by <span class="content_text">Table 1-1</span> in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW8">“Relationship Models and Schema”</a></span>:</p><div class="codesample"><table><tr><td scope="row"><pre>CREATE TABLE IF NOT EXISTS family (<span></span></pre></td></tr><tr><td scope="row"><pre>    ID INTEGER PRIMARY KEY,<span></span></pre></td></tr><tr><td scope="row"><pre>    Last_Name NVARCHAR(63) KEY,<span></span></pre></td></tr><tr><td scope="row"><pre>    Address NVARCHAR(255),<span></span></pre></td></tr><tr><td scope="row"><pre>    City NVARCHAR(63),<span></span></pre></td></tr><tr><td scope="row"><pre>    State NVARCHAR(2),<span></span></pre></td></tr><tr><td scope="row"><pre>    Zip NVARCHAR(10));<span></span></pre></td></tr></table></div><p>Each table should contain a primary key. A primary key implicitly has the <code>UNIQUE</code>, and <code>NOT NULL</code> properties set. It doesn’t hurt to state them explicitly, as other database implementations require <code>NOT NULL</code> to be stated explicitly. This column must be of type <code>INTEGER</code> (at least in SQLite—other SQL implementations use different integer data types).</p><p>Notice that this table does not specify the <code>AUTOINCREMENT</code> option for its primary key. SQLite does not support the <code>AUTOINCREMENT</code> keyword, but SQLite implicitly enables auto-increment behavior when <code>PRIMARY KEY</code> is specified.</p><p>The data types supported by SQLite are as follows:</p><dl class="termdef">	<dt><code>BLOB</code></dt><dd><p>A large block of binary data.</p></dd><dt><code>BOOL</code></dt><dd><p>A boolean (true or false) value.</p></dd><dt><code>CLOB</code></dt><dd><p>A large block of (typically 7-bit ASCII) text.</p></dd><dt><code>FLOAT</code></dt><dd><p>A floating-point number.</p></dd><dt><code>INTEGER</code></dt><dd><p>An integer value.</p><div class="noteboxdef"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW13" title="Note"></a><p><strong>Note:</strong>&nbsp;Although integer values are stored internally as integers, all numerical comparisons are performed using 64-bit floating-point values. This may cause precision loss for very large numeric values (>15 digits). If you need to compare such large numbers, you should store them as a string and compare their length (to detect magnitude differences) prior to comparing their value.</p></p></div></dd><dt><code>NATIONAL VARYING CHARACTER</code> or <code>NVCHAR</code></dt><dd><p>A Unicode (UTF-8) string of variable length (generally short). This data type requires a length parameter that provides an upper bound for the maximum data length. For example, the following statement declares a column named <code>Fahrenheit</code> whose UFT-8 data cannot exceed 451 characters in length:</p><div class="codesample"><table><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>    Douglas NVARCHAR(42),<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr></table></div><div class="noteboxdef"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW14" title="Note"></a><p><strong>Note:</strong>&nbsp;Unlike some SQL implementations, SQLite does not enforce this maximum length and does not truncate data to the length specified. However, you should still set reasonable bounds to avoid the risk of compatibility problems in the future.</p>SQLite also does not enforce valid Unicode encoding for this data. In effect, it is treated just like any other text unless and until you use a UTF-16 collating sequence (controlled by the <code>COLLATE</code> keyword) or SQL function. Collating sequences and SQL functions are beyond the scope of this document. See the SQLite documentation at <span class="content_text"><a href="http://www.sqlite.org/docs.html" target="_blank">http://www.sqlite.org/docs.html</a></span> for more information.</p></p></div></dd><dt><code>NUMERIC</code></dt><dd><p>A fixed-precision decimal value that is expected to hold values of a given precision. Note that SQLite does not enforce this in any way.</p></dd><dt><code>REAL</code></dt><dd><p>A floating-point value. This is stored as a 64-bit (8-byte) IEEE double-precision floating point value.</p></dd><dt><code>VARCHAR</code> or <code>VARYING CHARACTER</code></dt><dd><p>A (generally short) variable-length block of text. This data type requires a length parameter that provides an upper bound for the maximum data length. For example, the following statement declares a column named <code>Douglas</code> whose data cannot exceed 42 characters in length:</p><div class="codesample"><table><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>    Douglas VARCHAR(42),<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr></table></div><div class="noteboxdef"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW15" title="Note"></a><p><strong>Note:</strong>&nbsp;Unlike some SQL implementations, SQLite does not enforce this maximum length and does not truncate data to the length specified. However, you should still set reasonable bounds to avoid the risk of compatibility problems in the future.</p></p></div></dd></dl><p>To avoid unexpected behavior, you should be careful to store only numeric values into numeric (<code>REAL</code>, <code>INTEGER</code>, and so on) columns. If you attempt to store a non-numeric value into a numeric column, the value is stored as text. SQLite does not warn you when this happens. In effect, although SQLite supports typed columns, the types are not enforced in any significant way, though integer values are converted to floating point values when stored in a <code>REAL</code> column.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW16" title="INSERT Query"></a><h3>INSERT Query</h3><p>Inserts a new row into a table.</p><div class="codesample"><table><tr><td scope="row"><pre>INSERT INTO table_name (column_1, ...)<span></span></pre></td></tr><tr><td scope="row"><pre>    VALUES (value_1, ...);<span></span></pre></td></tr></table></div><p>For example, to store the values shown in <span class="content_text">Table 1-1</span> in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW8">“Relationship Models and Schema,”</a></span> you would use the following query:</p><div class="codesample"><table><tr><td scope="row"><pre>INSERT INTO family (Last_Name, Address, City, State, Zip)<span></span></pre></td></tr><tr><td scope="row"><pre>    VALUES ('Doe', '56989 Peach St.', 'Martin', 'TN', '38237');<span></span></pre></td></tr></table></div><p>You should notice that all non-numeric values must be surrounded by quotation marks (single or double). This is described further in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW7">“SQL Security and Quoting Characters in Strings.”</a></span></p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW17" title="SELECT Query"></a><h3>SELECT Query</h3><p>Retrieves rows (or portions thereof) from a table or tables.</p><div class="codesample"><table><tr><td scope="row"><pre>SELECT column_1 [, ...] from table_1 [, ...] WHERE expression;<span></span></pre></td></tr></table></div><p>Each <code>SELECT</code> query returns an result array (essentially a temporary table) that contains one entry for every row in the database table that matches the provided expression. Each entry is itself an array that contains the values stored in the specified columns within that database row. For example, the following SQL query returns an array of (name, age) pairs for every row in the people table where the value in the age column is greater than 18:</p><div class="codesample"><table><tr><td scope="row"><pre>SELECT name, age FROM people WHERE age > 18;<span></span></pre></td></tr></table></div><p>Here are some other relatively straightforward examples of expressions that are valid in <code>SELECT</code> queries:</p><div class="codesample"><table><tr><td scope="row"><pre># Alphabetic comparison<span></span></pre></td></tr><tr><td scope="row"><pre>SELECT name, age FROM people WHERE name &lt; "Alfalfa";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Equality and inequality<span></span></pre></td></tr><tr><td scope="row"><pre>SELECT name, age FROM people WHERE age = 18;<span></span></pre></td></tr><tr><td scope="row"><pre>SELECT name, age FROM people WHERE age != 18;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Combinations<span></span></pre></td></tr><tr><td scope="row"><pre>SELECT name, age FROM people WHERE (age > 18 OR (age > 55 AND AGE &lt;= 65));<span></span></pre></td></tr></table></div><p>The complete expression syntax is beyond the scope of this document. For further details, see the SQLite language support specification at <span class="content_text"><a href="http://www.sqlite.org/lang.html" target="_blank">http://www.sqlite.org/lang.html</a></span>.</p><p>To select all columns, you can use an asterisk (<code>*</code>) instead of specifying a list of column names. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>SELECT * FROM people WHERE age > 18;<span></span></pre></td></tr></table></div><p>You can also use a <code>SELECT</code> query to query multiple tables at once. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>SELECT First_Name, Last_Name FROM family, familymember WHERE familymember.Family_ID = family.ID AND familymember.ID = 2;<span></span></pre></td></tr></table></div><p>The query creates a temporary joined table that contains one row for each combination of a single row from the <code>family</code> table and a single row from the <code>familymember</code> table in which the combined row pair matches the specified constraints (<code>WHERE</code> clause). It then returns an array containing the fields <code>First_Name</code> and <code>Last_Name</code> from that temporary table. Only rows in the <code>familymember</code> table whose <code>ID</code> value is <code>2</code> are included in the output; all other rows in this table are ignored. Similarly, only rows in the <code>family</code> table that match against at least one of the returned rows from the <code>familymember</code> table are included; other rows are ignored.</p><p>For example, if you provide tables containing the values shown in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW3">Table 1-1</a></span> and <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW4">Table 1-2</a></span> in <span class="content_text"><a href="RelationalDatabases.html#//apple_ref/doc/uid/TP40007256-CH5-SW8">“Relationship Models and Schema,”</a></span> this would return only a single row of data containing the values (‘Jane’, ‘Doe’).</p><p>Notice the constraint <code>family.ID</code>. If a column name appears in multiple tables, you cannot just use the field name as part of a <code>WHERE</code> constraint because the SQL database has no way of knowing which ID field to compare. Instead, you must specify the table name as part of the column name, in the form <code>table_name.column_name</code>. Similarly, in the field list, you can specify <code>table_name.*</code> to request all of the rows in the table called <code>table_name</code>. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>SELECT familymember.*, Last_Name from family, familymember WHERE ...<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007256-CH5-SW18" title="UPDATE Query"></a><h3>UPDATE Query</h3><p>Changes values within an existing table row.</p><div class="codesample"><table><tr><td scope="row"><pre>UPDATE table_name SET column_1=value_1 [, ...]<span></span></pre></td></tr><tr><td scope="row"><pre>    [WHERE expression];<span></span></pre></td></tr></table></div><p>If you do not specify a <code>WHERE</code> expression, the specified change is made to every row in the table. The expression syntax is the same as for the <code>SELECT</code> statement. For example, if someone gets married, you might change that person’s <code>Family_ID</code> field with a query like this one:</p><div class="codesample"><table><tr><td scope="row"><pre>UPDATE familymember set Family_ID=32767 WHERE ID=179;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007256-CH5-SW19" title="DELETE Query"></a><h3>DELETE Query</h3><p>Deletes a row or rows from a table.</p><div class="codesample"><table><tr><td scope="row"><pre>DELETE FROM table_name [WHERE expression];<span></span></pre></td></tr></table></div><p>If you do not specify a <code>WHERE</code> expression, this statement deletes every row in the table. The expression syntax is the same as for the <code>SELECT</code> statement. For example, if someone drops their membership in an organization, you might remove them from the roster with a query like this one:</p><div class="codesample"><table><tr><td scope="row"><pre>DELETE FROM people WHERE ID=973;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007256-CH5-SW20" title="DROP TABLE Query"></a><h3>DROP TABLE Query</h3><p>Deletes an entire table.</p><div class="codesample"><table><tr><td scope="row"><pre>DROP TABLE table_name;<span></span></pre></td></tr></table></div><p>For example, if your code copies the contents of a table into a new table with a different name, then deletes the old table, you might delete the old table like this:</p><div class="codesample"><table><tr><td scope="row"><pre>DROP TABLE roster_2007;<span></span></pre></td></tr></table></div><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40007256-CH5-DontLinkElementID_4" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;It is not possible to undo this operation. Be <em>absolutely sure</em> that you are deleting the correct table before you execute a query like this one!</p><p></p><div class="clear"></div></div><a name="//apple_ref/doc/uid/TP40007256-CH5-SW21" title="Transaction Processing"></a><h2>Transaction Processing</h2><p>Most modern relational databases have the notion of a transaction. A transaction is defined as an atomic unit of work that either completes or does not complete. If any part of a transaction fails, the changes it made are rolled back—restored to their original state prior to the beginning of the transaction.</p><p>Transactions prevent something from being halfway completed. This is particularly important with relational databases because changes can span multiple tables.</p><p>For example, if you are updating someone’s class schedule, inserting a new <code>student_class</code> record might succeed, but a verification step might fail because the class itself was deleted by a previous change. Obviously, making the change would be harmful, so the changes to the first table are rolled back.</p><p>Other common reasons for failures include:</p><ul class="ul"><li class="li"><p>Invalid values—a string where the database expected a number, for example, could cause a failure if the database checks for this. (SQLite does <em>not</em>, however.)</p></li><li class="li"><p>Constraint failure—for example, if the class number column is marked with the <code>UNIQUE</code> keyword, any query that attempts to insert a second class with the same class number as an existing class fails.</p></li><li class="li"><p>Syntax error—if the syntax of a query is invalid, the query fails.</p></li></ul><p>The mechanism for performing a transaction is database-specific. In the case of the JavaScript Database, transactions are built into the query API itself, as described in <span class="content_text"><a href="../UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html#//apple_ref/doc/uid/TP40007256-CH3-SW3">“Executing a Query.”</a></span></p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW22" title="Relational Databases and Object-Oriented Programming"></a><h2>Relational Databases and Object-Oriented Programming</h2><p>Relational databases and data structures inside applications should be closely coupled to avoid problems. The best in-memory architecture is generally an object for each row in each table. This means that each object in your code would have the same relationships with other objects that the underlying database entries themselves have with each other.</p><p>Tying database objects to data structures is important for two reasons:</p><ul class="ul"><li class="li"><p>It reduces the likelihood of conflicting information. You can be certain that no two objects will ever point to the same information in the database. Thus, changing one object will never require changing another object.</p></li><li class="li"><p>It makes it a lot easier to keep track of what data is stored in which table when you are debugging.</p></li></ul><p>It is best to keep the names of tables and classes as similar as possible. Similarly, it is best to keep the names of instance variables as similar as possible to the names of the database fields whose contents they contain.</p><a name="//apple_ref/doc/uid/TP40007256-CH5-SW7" title="SQL Security and Quoting Characters in Strings"></a><h2>SQL Security and Quoting Characters in Strings</h2><p>When working with user-entered strings, additional care is needed. Because strings can contain arbitrary characters, it is possible to construct a value that, if handled incorrectly by your code, could produce unforseen side effects. Consider the following SQL query:</p><div class="codesample"><table><tr><td scope="row"><pre>INSERT INTO MyTable SET MyValue='VARIABLE_VALUE';<span></span></pre></td></tr></table></div><p>Suppose for a moment that your code substitutes a user-entered string in place of <code>VARIABLE_VALUE</code> without any additional processing. The user enters the following value:</p><div class="codesample"><table><tr><td scope="row"><pre>'; DROP TABLE MyTable; --<span></span></pre></td></tr></table></div><p>The single quote mark terminates the value to be stored in <code>MyValue</code>. The semicolon ends the command. The next command deletes the table entirely. Finally, the two hyphens cause the remainder of the line (the trailing <code>';</code>) to be treated as a comment and ignored. Clearly, allowing a user to delete a table in your database is an undesirable side effect. This is known as a SQL injection attack because it allows arbitrary SQL commands to be injected into your application as though your application sent them explicitly.</p><p>When you perform actual queries using user-provided data, to avoid mistakes, you should use placeholders for any user-provided values and rely on whatever SQL query API you are using to quote them properly. In the case of the JavaScript database API, this process is described in <span class="content_text"><a href="../UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html#//apple_ref/doc/uid/TP40007256-CH3-SW3">“Executing a Query.”</a></span></p><p>If you need to manually insert strings with constant string values, however, using placeholders is overkill and can make the query harder to read. To insert these strings manually, use double-quote marks around any strings that contain a single-quote mark, and vice-versa. In the rare event that you must manually insert a string that contains both types of quotation marks, use single quotes, but add a backslash before every single-quote mark within the string. For example, to insert the value</p><div class="codesample"><table><tr><td scope="row"><pre>"It's a boy," he whispered softly.<span></span></pre></td></tr></table></div><p>you would write it like this:</p><div class="codesample"><table><tr><td scope="row"><pre>'"It\'s a boy," he whispered softly.'<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40007256-CH5-SW23" title="Note"></a><p><strong>Note:</strong>&nbsp;Because the backslash is treated as a special quote character, you <em>must</em> similarly quote any backslashes within the string by adding a second backslash. If you only quote the single quote mark, you can still be the victim of a slightly tweaked injection attack like this one:</p><div class="codesample"><table><tr><td scope="row"><pre>\'; DROP TABLE MyTable; --<span></span></pre></td></tr></table></div>If you merely added a backslash before the single quote, the backslash before it would quote that backslash, and the single quote would still end the string and allow the <code>DROP TABLE</code> command to execute.</p></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-01-06<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/RelationalDatabases/RelationalDatabases.html%3Fid%3DTP40007256-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/RelationalDatabases/RelationalDatabases.html%3Fid%3DTP40007256-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/RelationalDatabases/RelationalDatabases.html%3Fid%3DTP40007256-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>