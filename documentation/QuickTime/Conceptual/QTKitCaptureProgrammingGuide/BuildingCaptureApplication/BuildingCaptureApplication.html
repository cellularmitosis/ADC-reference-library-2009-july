<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QTKit Capture Programming Guide: Building a Simple QTKit Capture Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Building a Simple QTKit Capture Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004574-CH4" title="Building a Simple QTKit Capture Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../Cocoa-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000495" target="_top">Cocoa</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004574-CH1-DontLinkElementID_41">QTKit Capture Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../GettingStarted/GettingStarted.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004574-CH4-SW2" title="Building a Simple QTKit Capture Application"></a><h1>Building a Simple QTKit Capture Application</h1><p>In this chapter, you’ll build a QTKit capture player, a simple yet powerful application that demonstrates how you can take advantage of some of the new capture classes and methods available in the next iteration of the QuickTime Kit framework. When completed, your QTKit capture player application will allow you to capture a video stream and record the media to a QuickTime movie. You won’t have to write more than 20 or 30 lines of Objective-C code to implement this capture player.</p><p>Using Xcode 3 as your integrated development environment (IDE), along with Interface Builder 3, you’ll see how easy it is to work with the QuickTime Kit framework. In this example, you’ll use the new QTKit capture control provided in the library of controls available in Interface Builder 3. The QTKit capture control will perform much of the work for you in implementing the design of the user interface for this application.</p><p>Following the steps in this guide, you’ll be able to build a functioning capture player application that controls the capture of QuickTime movies, adding simple start and stop buttons, and allowing you to output and display your captured files in QuickTime Player. For this project, you’ll need an iSight camera, either built-in or plugged into your Macintosh. You’ll also need Mac OS X v10.5, the latest release of Mac OS X, installed in your system.</p><p>In building your QTKit capture application, you’ll work with the following three classes:</p><ul class="ul"><li class="li"><p><code>QTCaptureSession</code>. The primary interface for capturing media streams.</p></li><li class="li"><p><code>QTCaptureMovieFileOutput</code>. The output destination for a QTCaptureSession object that writes captured media to QuickTime movie files.</p></li><li class="li"><p><code>QTCaptureDeviceInput</code>. The input source for media devices, such as cameras and microphones. </p></li></ul><p>For purposes of this tutorial, you won’t need to have a complete understanding of the methods that belong to these capture classes. As you extend your knowledge of the QTKit framework, you should refer to the <em><a href="../../../Reference/QTCocoaObjCKit/index.html#//apple_ref/doc/uid/TP40001164" target="_top">QTKit Framework Reference</a></em>, which describes in detail the methods, notifications, attributes, constants, and types that comprise the collection of classes in the QTKit API. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-SW16">First Steps</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_4">Create the Project Using Xcode 3</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_7">Create the User Interface Using Interface Builder 3</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_8">Set Up a Preview of the Captured Video Output</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_9">Wire the Start and Stop Buttons</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_10">Complete the Project Nib File in Xcode</a>
				
			<br/>
			
        
			
			
				<a href="BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_11">Implement and Build Your Capture Application</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004574-CH4-SW16" title="First Steps"></a><h2>First Steps</h2><p>If you’ve worked with Cocoa and Xcode before, you know that every Cocoa application starts out as a project. A project is simply a repository for all the elements that go into the application, such as source code files, frameworks, libraries, the application’s user interface, sounds, and images. You use Xcode to create and manage your project.</p><p>The QTKit capture player application should serve as a good learning example for developers who may be new to Cocoa and QuickTime. If you already know Cocoa, you probably won’t be surprised at how quickly and effortlessly you can build this capture player application.</p><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_3" title="What You Need"></a><h3>What You Need</h3><p>Before you get started with your QTKit capture player project, be sure that you are running Mac OS X v10.5 and have the following items installed on your system:</p><ul class="spaceabove"><li class="li"><p>Xcode 3 and Interface Builder 3. Note that although you can use Xcode 2.2 to build your project, to take full advantage of the new programming features available, you’ll want to use Xcode 3. Also, Interface Builder 3 provides a new paradigm for working with and building the user interface for your application. Palettes are no longer provided; instead, you’ll work with a new library of controls that are designed to enable you to hook up the components of your user interface with greater ease and efficiency. In the end, you’ll be able to build applications faster and take advantage of this rich, new library of controls.</p></li><li class="li"><p>The QuickTime Kit framework, which resides in the Mac OS X v10.5 <code>System/Library/Frameworks</code> directory as <code>QTKit.framework</code>.</p></li><li class="li"><p>An iSight camera connected to your computer. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_29" title="Important:"></a><p><strong>Important:</strong>&nbsp;The complete sample code discussed in this and the next chapter is available for download at <span class="content_text"><a href="http://developer.apple.com/samplecode/QuickTime/idxCocoa-date.html" target="_top">Sample Code: QuickTime Cocoa</a></span>, as <code>MyRecorder</code>.</p><p></p></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_30" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>MyRecorder</code> sample code, as explained in this chapter, will not support DV cameras, which are of type <code>QTMediaTypeMuxed</code>, rather than <code>QTMediaTypeVideo</code>. The next chapter in this programming guide, <span class="content_text"><a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html#//apple_ref/doc/uid/TP40004574-CH5-SW1">“Adding Audio Input and DV Camera Support,”</a></span> explains how you can add code that lets you work with DV cameras and use the <code>QTMediaTypeMuxed</code> type.</p></div></li></ul><a name="//apple_ref/doc/uid/TP40004574-CH4-SW17" title="Prototype the Capture Player"></a><h3>Prototype the Capture Player</h3><p>Interface Builder lets you specify the windows, menus, and views of your application, while Xcode enables you to define the behavior behind them. Interface Builder provides the basic support you need for configuring the items in your user interface. Beyond that, most of the work you do in constructing your application takes place in Xcode.</p><p>When designing your application, start by defining your application’s data model in Xcode. Once you’ve constructed a workable data model, you can use Interface Builder to create a set of basic windows, menus, and views for presenting that data. Depending on the complexity of your design, you may also need to create custom views and controls, and then integrate them into Interface Builder and add them to your nib files.</p><p>Creating the controller objects and tying them to your data model in your user interface is the final step in the design process. </p><p>Of course, you can just jump right in and start assembling windows and menus in Interface Builder. However, using Interface Builder 3, which is the latest iteration, it’s important to have a good understanding of your application’s desired behavior first. Knowing your application’s data model, and knowing what operations will occur on that data, will help you piece together the design elements you need to show in order to convey that information to the end user.</p><p>You may want to start by creating a rough sketch of your QTKit capture application. Think of what design elements you want to incorporate into the application. Rather than simply jumping into Interface Builder and doing your prototype there, you may want to visualize the elements first in your rough sketch, as shown in <span class="content_text">Figure 2-1</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40004574-CH4-SW1" title="Figure 2-1Prototype sketch of QTKit capture application"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Prototype sketch of QTKit capture application</p><img src = "../Art/qt_capture_app_sketch.jpg" alt = "Prototype sketch of QTKit capture application" ></div><br/><p>In this design prototype, you can start with three simple objects: a capture view and two control buttons. These will be the building blocks for your application. After you’ve sketched them out, you can begin to think of how you’ll be able to hook them up in Interface Builder and what code you need in your Xcode project to make this happen. </p><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_4" title="Create the Project Using Xcode 3"></a><h2>Create the Project Using Xcode 3</h2><p>To create the project, follow these steps:</p><ol class="ol"><li class="li"><p>Launch Xcode 3 (shown in <span class="content_text">Figure 2-2</span>) and choose File > New Project.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW14" title="Figure 2-2The Xcode 3 icon"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>The Xcode 3 icon</p><img src = "../Art/xcode3_icon.jpg" alt = "The Xcode 3 icon" ></div></li><li class="li"><p>When the new project window appears, select Cocoa Application.</p></li><li class="li"><p>Name the project <code>MyRecorder</code> and navigate to the location where you want the Xcode application to create the project folder. Now the Xcode project window appears, as shown in <span class="content_text">Figure 2-3</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW3" title="Figure 2-3The MyRecorder Xcode project window"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>The MyRecorder Xcode project window</p><img src = "../Art/myrecorder_project.jpg" alt = "The MyRecorder Xcode project window" ></div></li><li class="li"><p>Next, you need to add the QuickTime Kit framework to your <code>MyRecorder</code> project. Although obvious, this step is sometimes easy to forget. Note that you don’t need to add the QuickTime framework to your project, just the QuickTime Kit framework. Choose Project > Add to Project.</p></li><li class="li"><p>The QuickTime Kit framework resides in the <code>System/Library/Frameworks</code> directory. Select <code>QTKit.framework</code>, and click Add when the Add To Targets window appears to add it to your project. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_31" title="Important:"></a><p><strong>Important:</strong>&nbsp;This completes the first sequence of steps in your project. In the next sequence, you’ll move ahead to define actions and outlets in Xcode <em>before</em> working with Interface Builder. This may involve something of a paradigm shift in how you may be used to building and constructing an application with versions of Interface Builder prior to Interface Builder 3. Because you’ve already prototyped your QTKit capture application, at least in rough form with a clearly defined data model, you can now determine which actions and outlets need to be implemented. In this case, you have a <code>QTCaptureView</code> object, which is a subclass of <code>NSView</code>, and two simple buttons to start and stop the recording of your captured media content.</p><p></p></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_5" title="Name the Project Files and Import the QTKit Headers"></a><h3>Name the Project Files and Import the QTKit Headers</h3><ol class="ol"><li class="li"><p>Choose File > New File. In the panel, scroll down and select Cocoa > Objective-C class, which includes the <code>Cocoa.Cocoa.h</code>. files.</p></li><li class="li"><p>Name your implementation file <code>MyRecorderController.m</code>. You’ll also check the item to name your declaration file <code>MyRecorderController.h</code>. </p></li><li class="li"><p>In your <code>MyRecorderController.h</code> file, add <code>#import &lt;QTKit/QTkit.h></code>.</p></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_6" title="Determine the Actions and Outlets You Want"></a><h3>Determine the Actions and Outlets You Want</h3><ol class="ol"><li class="li"><p>Now you can begin adding outlets and actions. In your <code>MyRecorderController.h</code> file, add the instance variable <code>mCaptureView</code> in the following line of code:</p><div class="codesample"><table><tr><td scope="row"><pre>IBOutlet QTCaptureView *mCaptureView;<span></span></pre></td></tr></table></div></li><li class="li"><p>You also want to add these two actions:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)startRecording:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)stopRecording:(id)sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>Now open your <code>MyRecorderController.m</code> file and add the following actions, along with the requisite braces:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)startRecording:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)stopRecording:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	</li></ol><p>At this point the code in your <code>MyRecorderController.h</code> file should look like this.</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QTKit/QTKit.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface MyRecorderController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet QTCaptureView *mCaptureView;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)startRecording:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)stopRecording:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>This completes the second stage of your project. Now you’ll need to shift gears and work with Interface Builder 3 to construct the user interface for your project. </p><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_7" title="Create the User Interface Using Interface Builder 3"></a><h2>Create the User Interface Using Interface Builder 3</h2><p>In the next phase of your project you’ll see how seamlessly Interface Builder and Xcode work together, enabling you to construct and implement the various elements in your project more efficiently and with less overhead.</p><ol class="ol"><li class="li"><p>Open Interface Builder 3 (<span class="content_text">Figure 2-4</span>) and drag the <code>MainMenu.nib</code> file in your Xcode project window on the Interface Builder 3 icon. Because of the new integration between Xcode 3 and Interface Builder 3, you’ll find the actions and outlets you’ve declared in your <code>MyRecorderController.h</code> file are also synchronously updated in Interface Builder 3. This will become apparent once you open your nib file and begin to work with the library of controls available in Interface Builder 3. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW4" title="Figure 2-4The new Interface Builder 3 icon"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>The new Interface Builder 3 icon</p><img src = "../Art/ib3_icon.jpg" alt = "The new Interface Builder 3 icon" ></div></li><li class="li"><p>In Interface Builder 3, you’ll find a new library of controls. Scroll down until you find the QuickTime Capture View control, as shown in <span class="content_text">Figure 2-5</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW5" title="Figure 2-5QuickTime Capture View control in the library"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>QuickTime Capture View control in the library</p><img src = "../Art/ib_lib_qtcap.jpg" alt = "QuickTime Capture View control in the library" ></div><p>The <code>QTCaptureView</code> object provides you with an instance of a view subclass to display a preview of the video output that is captured by a capture session. </p></li><li class="li"><p>Drag the <code>QTCaptureView</code> object into your window and resize the object to fit the window, allowing room for the two Start and Stop buttons in your QTKit capture player.</p></li><li class="li"><p>Choose Tools > Inspector. In the Identity Inspector, select the information (“i”) icon. Click in the field Class and your <code>QTCaptureView</code> object appears, as shown in <span class="content_text">Figure 2-6</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW6" title="Figure 2-6The resized QTCaptureView object and its class Identity defined in the Identity Inspector"></a><p><strong>Figure 2-6&nbsp;&nbsp;</strong>The resized <code>QTCaptureView</code> object and its class Identity defined in the Identity Inspector</p><img src = "../Art/defining_captureview_class.jpg" alt = "The resized QTCaptureView object and its class Identity defined in the Identity inspector" ></div></li><li class="li"><p>Set the autosizing for the object in the Capture View Size Inspector, as shown in <span class="content_text">Figure 2-7</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW7" title="Figure 2-7Setting the autosizing for your QTCaptureView object"></a><p><strong>Figure 2-7&nbsp;&nbsp;</strong>Setting the autosizing for your <code>QTCaptureView</code> object</p><img src = "../Art/myrecorder_cap_view_size.jpg" alt = "Setting the autosizing for your QTCaptureView object" ></div></li><li class="li"><p>Define the attributes of your MyRecorder Window, as shown in <span class="content_text">Figure 2-8</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW23" title="Figure 2-8Window attributes defined in the Inspector"></a><p><strong>Figure 2-8&nbsp;&nbsp;</strong>Window attributes defined in the Inspector</p><img src = "../Art/myrecorder_window_attributes.jpg" alt = "Window attributes defined in the Inspector" ></div></li><li class="li"><p>In the Library, select the Push Button control and drag it to the Window, as shown in <span class="content_text">Figure 2-9</span>. Enter the text <strong>Start</strong> and duplicate the button to create another button as <strong>Stop</strong>. In autosizing, set the struts for both buttons at the bottom and right outside corners, leaving the inside struts untouched.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW8" title="Figure 2-9Specifying Start and Stop push buttons"></a><p><strong>Figure 2-9&nbsp;&nbsp;</strong>Specifying Start and Stop push buttons</p><img src = "../Art/push_buttons_lib.jpg" alt = "Specifying Start and Stop push buttons" ></div></li><li class="li"><p>Set up the autosizing for your buttons by selecting the button and clicking the Button Size Inspector shown in <span class="content_text">Figure 2-10</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW22" title="Figure 2-10Setting up the autosizing for the Start and Stop buttons"></a><p><strong>Figure 2-10&nbsp;&nbsp;</strong>Setting up the autosizing for the Start and Stop buttons</p><img src = "../Art/button_autosize.jpg" alt = "Setting up the autosizing for the Start and Stop buttons" ></div></li><li class="li"><p>In the Library, scroll down and select the blue cube control shown in <span class="content_text">Figure 2-11</span>, which is an object (<code>NSObject</code>) you can instantiate as your controller. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW13" title="Figure 2-11The blue cube object for your controller"></a><p><strong>Figure 2-11&nbsp;&nbsp;</strong>The blue cube object for your controller</p><img src = "../Art/obj_controller_lib.jpg" alt = "The blue cube object for your controller" ></div></li><li class="li"><p>Drag the object into your <code>MainMenu.nib</code> window, as shown in <span class="content_text">Figure 2-12</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW9" title="Figure 2-12The object from the instantiated as a controller"></a><p><strong>Figure 2-12&nbsp;&nbsp;</strong>The object from the instantiated as a controller</p><img src = "../Art/def_myrecordercontroller.jpg" alt = "The object from the instantiated as a controller" ></div></li><li class="li"><p>Select the object and enter its name as <strong>My Recorder Controller</strong>. Then click the information icon in the Inspector. When you click the Class Identity field, the <code>MyRecorderController</code> object appears. Interface Builder has automatically updated the <code>MyRecorderController</code> class specified in your Xcode implementation file. You don’t need to enter the name of this class in the Class Identity field. Note that to verify and reconfirm that an update has occurred, press Return. If the identify field is not automatically updated, you may need to specify manually that it is a <code>MyRecorderController</code> object.</p></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_8" title="Set Up a Preview of the Captured Video Output"></a><h2>Set Up a Preview of the Captured Video Output</h2><p>In the next phase of your project, you’ll see how seamlessly Interface Builder and Xcode work together, enabling you to construct and implement the various elements in your project more efficiently and with less overhead.</p><ol class="ol"><li class="li"><p>In Interface Builder, hook up the <code>MyRecorderController</code> object to the <code>QTCaptureView</code> object. Control-drag from the <code>MyRecorderController</code> object in your nib file to the <code>QTCaptureView</code> object. A transparent panel will appear, as shown in <span class="content_text">Figure 2-13</span>, displaying the <code>IBOutlet</code> instance variable, <code>mCaptureView</code>, that you’ve specified in your declaration file.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW10" title="Figure 2-13The mCaptureView instance variable wired as an outlet for the MyRecorderController object"></a><p><strong>Figure 2-13&nbsp;&nbsp;</strong>The <code>mCaptureView</code> instance variable wired as an outlet for the <code>MyRecorderController</code> object</p><img src = "../Art/wiring_rec_capture_view.jpg" alt = "The mCaptureView instance variable wired as an outlet for the MyRecorderController object" ></div></li><li class="li"><p>Click the Interface Builder outlet <code>mCaptureView</code> to wire up the two objects. </p></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_9" title="Wire the Start and Stop Buttons"></a><h2>Wire the Start and Stop Buttons</h2><p>Now you’re ready to add your <strong>Start</strong> and <strong>Stop</strong> push buttons and wire them up in your MainMenu.nib window.</p><ol class="ol"><li class="li"><p>Control-drag each of the <strong>Start</strong> and <strong>Stop</strong> buttons from the window to the MyRecorderController object, as shown in <span class="content_text">Figure 2-14</span>. Click the <code>startRecording:</code> method in the transparent Received Actions panel to connect the Start button, and likewise, the <code>stopRecording:</code> method in the Received Actions panel to connect the Stop button.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW11" title="Figure 2-14Wiring the recording buttons to the MyRecorderController object"></a><p><strong>Figure 2-14&nbsp;&nbsp;</strong>Wiring the recording buttons to the <code>MyRecorderController</code> object</p><img src = "../Art/wiring_record_actions.jpg" alt = "Wiring the recording buttons to the MyRecorderController object" ></div></li><li class="li"><p>Now you’ll need to hook up the window and the <code>MyRecorderController</code> object as a delegate, shown in <span class="content_text">Figure 2-15</span>. Control-drag a connection from the window to the <code>MyRecorderController</code> object and click the outlet, connecting the two objects. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW12" title="Figure 2-15Connecting the window to the MyRecorderController object as the delegate outlet"></a><p><strong>Figure 2-15&nbsp;&nbsp;</strong>Connecting the window to the <code>MyRecorderController</code> object as the delegate outlet</p><img src = "../Art/delegate_outlet.jpg" alt = "Connecting the window to the MyRecorderController object as the delegate outlet" ></div></li><li class="li"><p>To verify that you’ve correctly wired up your window object to your delegate object, select the Window and click the Window Connections Inspector icon, shown in <span class="content_text">Figure 2-16</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW24" title="Figure 2-16The window object wired up correctly to the delegate object"></a><p><strong>Figure 2-16&nbsp;&nbsp;</strong>The window object wired up correctly to the delegate object</p><img src = "../Art/wiring_window_delegate.jpg" alt = "The window object wired up correctly to the delegate object" ></div></li><li class="li"><p>Verify that you’ve correctly wired up your outlets and received actions. Select the My Recorder Controller object and click the My Recorder Controller Connections Inspector icon, shown in <span class="content_text">Figure 2-17</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW20" title="Figure 2-17My Recorder controller object and buttons wired up correctly"></a><p><strong>Figure 2-17&nbsp;&nbsp;</strong>My Recorder controller object and buttons wired up correctly</p><img src = "../Art/myrecordercontroller_wiredup.jpg" alt = "My Recorder controller object and buttons wired up correctly" ></div></li><li class="li"><p>Check the My Recorder Controller Identity Inspector panel to confirm the class actions and class outlets, shown in <span class="content_text">Figure 2-18</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW19" title="Figure 2-18Class actions and outlets specified in the identity inspector"></a><p><strong>Figure 2-18&nbsp;&nbsp;</strong>Class actions and outlets specified in the identity inspector</p><img src = "../Art/myrecordercontroller_identity.jpg" alt = "Class actions and outlets specified in the identity inspector" ></div></li><li class="li"><p>Click the <code>MainMenu.nib</code> file to verify that Interface Builder and Xcode have worked together to synchronize the actions and outlets you’ve specified. A small green light appears at the left bottom corner of the <code>MainMenu.nib</code> file next to <code>MyRecorder.xcodeproj</code> to confirm this synchronization, as shown in <span class="content_text">Figure 2-19</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW18" title="Figure 2-19The green light indicating synchronization between Xcode and Interface Builder"></a><p><strong>Figure 2-19&nbsp;&nbsp;</strong>The green light indicating synchronization between Xcode and Interface Builder</p><img src = "../Art/nib_synchronized_greenlight.jpg" alt = "The green light indicating synchronization between Xcode and Interface Builder" ></div></li><li class="li"><p>Save your nib file. </p></li><li class="li"><p>Verify that your QTKit MyRecorder capture application appears as shown in <span class="content_text">Figure 2-20</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH4-SW21" title="Figure 2-20The completed user interface for the MyRecorder application"></a><p><strong>Figure 2-20&nbsp;&nbsp;</strong>The completed user interface for the MyRecorder application</p><img src = "../Art/myrecorder_win_buttons.jpg" alt = "The completed user interface for the MyRecorder application" ></div></li></ol><p>You’ve now completed your work in Interface Builder 3. In this next sequence of steps, you’ll return to your Xcode project, adding a few lines of code in both your declaration and implemention files to build and compile the QTKit capture player application.</p><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_10" title="Complete the Project Nib File in Xcode"></a><h2>Complete the Project Nib File in Xcode</h2><p>To complete the project nib file, you’ll need to declare the outlet you set up and connected in Interface Builder, and define the instance variables that point to the capture session, as well as to the input and output objects. </p><ol class="ol"><li class="li"><p>In your Xcode project, you need to add the instance variables to the interface declaration. Add these lines of code in your <code>MyRecorderController.h</code> declaration file:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MyRecorderController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>QTCaptureSession           *mCaptureSession;<span></span></pre></td></tr><tr><td scope="row"><pre>QTCaptureMovieFileOutput   *mCaptureMovieFileOutput;<span></span></pre></td></tr><tr><td scope="row"><pre>QTCaptureDeviceInput       *mCaptureDeviceInput;<span></span></pre></td></tr></table></div>	<p>The <code>mCaptureSession</code> instance variable points to the <code>QTCaptureSession</code> object, and the <code>mCaptureMovieFileOutput</code> instance variable points to the <code>QTCaptureMovieFileOutput</code> object. The last line declares that the <code>mCaptureDeviceInput</code> instance variable points to the <code>QTCaptureDeviceInput</code> object. </p><p>The complete code for your declaration file should look like this:</p><div class="codesample"><table><tr><td scope="row"><pre>//  MyRecorderController.h<span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QTKit/QTkit.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface MyRecorderController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet QTCaptureView *mCaptureView;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTCaptureSession            *mCaptureSession;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTCaptureMovieFileOutput    *mCaptureMovieFileOutput;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTCaptureDeviceInput        *mCaptureDeviceInput;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)startRecording:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)stopRecording:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>In your <code>MyRecorderController.m</code> implementation file, add these lines of code, following your <code>@implementation MyRecordController</code> directive:</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_32" title="Important:"></a><p><strong>Important:</strong>&nbsp;There is a specific, though not rigid, order of steps you want to follow in constructing your code. These are the steps you need to follow: </p><p></p></div><ol class="ol"><li class="ol ol"><p>Create the capture session.</p></li><li class="ol ol"><p>Find the device and create the device input. Then add it to the session.</p></li><li class="ol ol"><p>Create the movie file output and add it to the session.</p></li><li class="ol ol"><p>Associate the capture view in the user interface with the session.</p></li></ol><div class="codesample"><table><tr><td scope="row"><pre>- (void)awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>//Create the capture session<span></span></pre></td></tr><tr><td scope="row"><pre>    mCaptureSession = [[QTCaptureSession alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//Connect inputs and outputs to the session<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL success = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSError *error;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Find a video device<span></span></pre></td></tr><tr><td scope="row"><pre>QTCaptureDevice *device = [QTCaptureDevice defaultInputDeviceWithMediaType:QTMediaTypeVideo];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (device) {<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [device open:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Handle error<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>// Add the video device to the session as device input<span></span></pre></td></tr><tr><td scope="row"><pre>        mCaptureDeviceInput = [[QTCaptureDeviceInput alloc] initWithDevice:device];<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [mCaptureSession addInput:mCaptureDeviceInput error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Handle error<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>// Create the movie file output and add it to the session<span></span></pre></td></tr><tr><td scope="row"><pre>    mCaptureMovieFileOutput = [[QTCaptureMovieFileOutput alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    success = [mCaptureSession addOutput:mCaptureMovieFileOutput error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>// Set the controller be the movie file output delegate.<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureMovieFileOutput setDelegate:self];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Associate the capture view in the UI with the session<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureView setCaptureSession:mCaptureSession];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>// Start the capture session running<span></span></pre></td></tr><tr><td scope="row"><pre>        [mCaptureSession startRunning];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	</li><li class="li"><p>Add these lines to handle window closing notifications for your device input and stop the capture session.</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)windowWillClose:(NSNotification *)notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureSession stopRunning];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[mCaptureDeviceInput device] close];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following block of code to handle deallocation of memory for your capture objects.</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> - (void)dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureSession release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureDeviceInput release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureMovieFileOutput release];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement these start and stop actions, then add the following lines of code to specify the output destination for your recorded media, in this case a QuickTime movie (<code>.mov</code>) in your <code>/Users/Shared</code> folder.</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)startRecording:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureMovieFileOutput recordToOutputFileURL:[NSURL fileURLWithPath:@"/Users/Shared/My Recorded Movie.mov"]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)stopRecording:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureMovieFileOutput recordToOutputFileURL:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add these lines of code to finish recording and then launch your recording as a QuickTime movie on your Desktop.</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)captureOutput:(QTCaptureFileOutput *)captureOutput didFinishRecordingToOutputFileAtURL:(NSURL *)outputFileURL forConnections:(NSArray *)connections dueToError:(NSError *)error<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSWorkspace sharedWorkspace] openURL:outputFileURL];<span></span></pre></td></tr><tr><td scope="row"><pre>    // Do something with the movie at /Users/Shared/My Recorded Movie.mov<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH4-DontLinkElementID_11" title="Implement and Build Your Capture Application"></a><h2>Implement and Build Your Capture Application</h2><p>After you’ve saved your project, click Build and Go. After compiling, click the <strong>Start</strong> button to record, and the <strong>Stop</strong> button to stop recording. The output of your captured session is saved as a QuickTime movie in the path you’ve specified in this code sample.</p><p>Now you can begin capturing and recording with your QTKit capture player application, as shown in <span class="content_text">Figure 2-21</span>. Using a simple iSight camera, you can capture and record media, and then output your recording to a QuickTime movie. .</p><br/><div><a name="//apple_ref/doc/uid/TP40004574-CH4-SW15" title="Figure 2-21MyRecorder with Start and Stop buttons"></a><p><strong>Figure 2-21&nbsp;&nbsp;</strong>MyRecorder with Start and Stop buttons</p><img src = "../Art/myrecorder_start_capturing.jpg" alt = "MyRecorder with Start and Stop buttons" ></div><br/><p>In the next chapter you’ll see how easy it is to add audio input capability to your QTKit capture player application. Only a half dozen lines of code are required. You can build on what you’ve already written for your <code>MyRecorder</code> project, and add audio, along with support for DV cameras other than your iSight camera, with a minimum of programming effort.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../GettingStarted/GettingStarted.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/BuildingCaptureApplication/BuildingCaptureApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/BuildingCaptureApplication/BuildingCaptureApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/BuildingCaptureApplication/BuildingCaptureApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>