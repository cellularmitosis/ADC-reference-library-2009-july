<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PGetAppleTalkInfo(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING48></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-35.html"><B>Chapter 2 - AppleTalk Utilities</B></A> / <A HREF="Networking-43.html"><B>AppleTalk Utilities Reference</B></A><BR><DL><DD><A HREF="Networking-46.html"><B>Routines</B></A> / <A HREF="Networking-47.html"><B>Obtaining Information About the .MPP Driver and the Current Network Environment</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING48-0></A>
<H3><A NAME=MARKER-9-75></A><A NAME=MARKER-2-11></A>PGetAppleTalkInfo</H3>
 The <CODE>PGetAppleTalkInfo</CODE> function returns information about the currently installed version of the .MPP driver and the network environment. <P>
<PRE>
FUNCTION PGetAppleTalkInfo (thePBptr: MPPPBPtr; async:
                              Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to an MPP parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean that specifies whether the function should be executed asynchronously. Specify <CODE>TRUE</CODE> for asynchronous execution.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSerr<TD>The result code. <TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .MPP driver reference number.<TR>
<TD>--><TD>csCode<A NAME=MARKER-2-91></A><TD>Integer<TD><A NAME=MARKER-13-3></A><A NAME=MARKER-13-3></A>Always <A NAME=MARKER-2-88></A><CODE>GetATalkInfo</CODE>.<TR>
<TD>--><TD>version<TD>Integer<TD>The version of the function.<TR>
<TD><--<TD>varsPtr<TD>Ptr<TD>A pointer to the MPP globals.<TR>
<TD colspan=4>&nbsp;<TR>
<TD><--<TD>DCEPtr<TD>Ptr<TD>A pointer to DCE for the .MPP driver.<TR>
<TD><--<TD>portID<TD>Integer<TD>The port number.<TR>
<TD><--<TD>configuration<TD>LongInt<TD>The configuration flags.<TR>
<TD><--<TD>selfSend<TD>Integer<TD>Nonzero if self-sending is enabled.<TR>
<TD><--<TD>netLo<TD>Integer<TD>The low value of the network range.<TR>
<TD><--<TD>netHi<TD>Integer<TD>The high value of the network range.<TR>
<TD><--<TD>ourAddr<TD>LongInt<TD>The local 24-bit AppleTalk address.<TR>
<TD><--<TD>routerAddr<TD>LongInt<TD>The 24-bit address of the router.<TR>
<TD><--<TD>numOfPHs<TD>Integer<TD>The maximum number of protocol handlers.<TR>
<TD><--<TD>numOfSkts<TD>Integer<TD>The maximum number of static sockets.<TR>
<TD><--<TD>numNBPEs<TD>Integer<TD>The maximum concurrent NBP requests.<TR>
<TD><--<TD>ntQueue<TD>Ptr<TD>A pointer to registered names table.<TR>
<TD><-><TD>LAlength<TD>Integer<TD>The length in bytes of data-link address (extended networks only).<TR>
<TD>--><TD>linkAddr<TD>Ptr<TD>A pointer to data-link address buffer (extended networks only).<TR>
<TD>--><TD>zoneName<TD>Ptr<TD>A pointer to zone name buffer.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>version</CODE>
<DD> <A NAME=MARKER-21-48></A>The version number of the <CODE>PGetAppleTalkInfo</CODE> function you are calling. For version number 53 and greater of the .MPP driver, this number is always 1.
<DT><CODE>varsPtr</CODE>
<DD> <A NAME=MARKER-2-193></A>A pointer to the MPP global variables. This parameter is reserved for the use of Apple Computer, Inc.; you cannot rely on the validity of the variables pointed to by this parameter. 
<DT><CODE>DCEPtr</CODE>
<DD> <A NAME=MARKER-2-49></A>A pointer to the device control entry (DCE) data structure for the .MPP driver. For information about the DCE, see the chapter "Device Manager" in <I><A HREF="../Devices/Devices-2.html">Inside Macintosh: Devices</A></I>.<A NAME=MARKER-2-13></A><A NAME=MARKER-2-156></A>
<DT><CODE>portID</CODE>
<DD> <A NAME=MARKER-9-17></A>The port number for the .MPP driver. The port number is always 0 unless you are requesting information for an .MPP driver being used by a router.<A NAME=MARKER-9-75></A>
<DT><CODE>configuration</CODE>
<DD> <A NAME=MARKER-2-95></A>A 32-bit longword of configuration flags. The following flags are currently defined:<A NAME=MARKER-9-56></A>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Flag<TH>Description<TR>
<TD>&nbsp;<TD>31<TD>SrvAdrBit<TD><CODE>TRUE</CODE> (equal to 1) if the routine that opened the .MPP driver requested <BR>a server node number. For more information on server nodes, see <A HREF=Networking-42.html#MARKER-9-50>"Selecting a Node in the Server Range" on page 2-7</A>. This flag indicates only that the server node number was requested, not that it was returned. Some AppleTalk data links, such as EtherTalk, TokenTalk, and FDDITalk, do not honor a request for a server node number. <TR>
<TD colspan=4>&nbsp;<TR>
<TD>&nbsp;<TD>30<TD>RouterBit<TD><A NAME=MARKER-13-6></A><A NAME=MARKER-13-6></A><A NAME=MARKER-9-86></A><CODE>TRUE</CODE> (equal to 1) if an AppleTalk <A NAME=MARKER-9-5></A>internet router was loaded at system startup (that is, there's a router operating on the same node as your application). A router can be loaded and not active.<TR>
<TD>&nbsp;<TD>15<TD>ExtendedBit<TD><A NAME=MARKER-13-10></A><A NAME=MARKER-13-10></A><A NAME=MARKER-2-66></A><CODE>TRUE</CODE> (equal to 1) if the node is on an extended network. Testing this bit is the only way to determine whether you are on an extended network.<A NAME=MARKER-9-16></A><TR>
<TD>&nbsp;<TD>7<TD>BadZoneHintBit<TD><A NAME=MARKER-13-14></A><A NAME=MARKER-13-14></A><A NAME=MARKER-2-95></A><CODE>TRUE</CODE> (equal to 1) if the <A NAME=MARKER-2-91></A>zone name of the node you are on was not the same as the zone name stored in parameter RAM (sometimes referred to as the <I>zone name hint</I>) when the .MPP driver was opened. If the zone name hint is invalid, then the AppleTalk Manager uses the default zone for the network. The default zone is defined by the network administrator.<B></B><TR>
<TD>&nbsp;<TD>6<TD>OneZoneBit<TD><A NAME=MARKER-13-18></A><A NAME=MARKER-13-18></A><A NAME=MARKER-2-78></A><CODE>TRUE</CODE> (equal to 1) if only one zone is assigned to your extended network or if you are not on an extended network. Use the <CODE>ExtendedBit</CODE> flag to determine whether you are on an extended network.</TABLE>

<DT><CODE>selfSend</CODE>
<DD> <A NAME=MARKER-2-80></A>The ability of a node to send packets to itself. This feature, called <I>intranode delivery</I>, is enabled when this parameter is nonzero. <BR>Use the <CODE>PSetSelfSend</CODE> function, which is described beginning <BR>on <A HREF=Networking-50.html#MARKER-9-115>page 2-15</A>, to enable or disable this feature<A NAME=MARKER-2-44></A>.
<DT><CODE>netLo</CODE>
<DD> <A NAME=MARKER-2-44></A>The<A NAME=MARKER-2-177></A> low value of the range of network numbers on the local cable. Only extended networks can have a range of network numbers. For a nonextended network, this parameter returns the network number.<A NAME=MARKER-2-19></A>
<DT><CODE>netHi</CODE>
<DD> <A NAME=MARKER-2-26></A>The high value of the range of network numbers on the local cable. Only extended networks can have a range of network numbers. For a nonextended network, this parameter returns the network number.
<DT><CODE>ourAddr</CODE>
<DD> <A NAME=MARKER-9-144></A>The 24-bit AppleTalk <A NAME=MARKER-2-78></A>network address of the node you are on. The least significant byte of the longword is the node ID. The middle <BR>16 bits are the network number. The most significant byte of the longword is reserved for use by Apple Computer, Inc. 
<DT><CODE>routerAddr</CODE>
<DD> <A NAME=MARKER-2-66></A>The 24-bit AppleTalk network address of the last router from which your node heard traffic. The least significant byte of the longword <BR>is the node ID. The middle 16 bits are the network number. The most significant byte of the longword is reserved for use by Apple Computer, Inc. You should always use this address when you want to communicate with a router.
<DT><CODE>numOfPHs</CODE>
<DD> <A NAME=MARKER-2-61></A>The<A NAME=MARKER-2-22></A> maximum number of protocol handlers that this .MPP <BR>driver allows.<A NAME=MARKER-21-66></A>
<DT><CODE>numOfSkts</CODE>
<DD> <A NAME=MARKER-2-69></A>The maximum number of statically assigned sockets that this .MPP <A NAME=MARKER-9-96></A>driver allows. Statically assigned sockets are described in <I>Inside AppleTalk,</I> second edition. For more information about sockets, see the chapter "Datagram Delivery Protocol (DDP)" in this book.
<DT><CODE>numNBPEs</CODE>
<DD> <A NAME=MARKER-9-10></A>The maximum number of concurrent requests to NBP that this .MPP driver allows. <A NAME=MARKER-2-32></A>
<DT><CODE>ntQueue</CODE>
<DD> <A NAME=MARKER-9-112></A>A pointer to the first entry in the names table for the local node. You can use NBP routines to look up and register names in the names table. The names table is described in the chapter "Name-Binding Protocol (NBP)" in this book. 
<DT><CODE>LAlength</CODE>
<DD> <A NAME=MARKER-2-39></A>The number of bytes of the data-link address that the function should place in the buffer pointed to by the <CODE>LinkAddr</CODE> parameter. You use this parameter when you call the <CODE>PGetAppleTalkInfo</CODE> function on a node on an extended network. If you request more bytes than the total number of bytes in the address, then the function returns in the <CODE>LAlength</CODE> parameter the actual number of bytes it placed in the buffer. If the address is longer than the size of the buffer, then the <CODE>PGetAppleTalkInfo</CODE> function fills the buffer and returns in the <CODE>LAlength</CODE> parameter the actual length of the address, not the number of bytes returned. The function does <I>not</I> return an error when the buffer is too large or too small for the address. A value of 6 bytes for <CODE>LAlength</CODE> is sufficient for most purposes.
<DT><CODE>linkAddr</CODE>
<DD> <A NAME=MARKER-2-74></A><A NAME=MARKER-2-19></A>A pointer to a buffer for the data-link address returned for extended networks only. You use the <CODE>LAlength</CODE> parameter to specify the number of bytes of the address that you want placed in this buffer. You must allocate a buffer large enough to hold the number of bytes you specify. Specify <CODE>NIL</CODE> for this parameter if you do not want the function to provide a data-link address.
<DT><CODE>zoneName</CODE>
<DD> <A NAME=MARKER-2-29></A>A <A NAME=MARKER-2-29></A>pointer to a buffer into which the <CODE>PGetAppleTalkInfo</CODE> function places the local node's zone name. You must allocate a buffer of at least 33 bytes to hold this data, or you must specify <CODE>NIL</CODE> for the <CODE>zoneName</CODE> parameter if you do not want to obtain the zone name. This field is returned only if the node is on an <A NAME=MARKER-2-90></A>extended network.<A NAME=MARKER-2-149></A>
</DL>
<A NAME=HEADING48-23></A>
<H5>DESCRIPTION</H5>
 The <CODE>PGetAppleTalkInfo</CODE> function returns a variety of information about the current networking environment. For example, it returns information telling you whether or not applications running on the node can send packets to themselves or to other applica-<BR>tions or processes on the same node. An application can call <CODE>PGetAppleTalkInfo</CODE> to determine if the node on which it is running has an ID that falls within the server node ID range. It can also obtain the address of the last router that the node communicated with and the node's own address. <P>
 You must allocate memory for and define a parameter block of type <CODE>MPPParmType</CODE> and pass that parameter block's pointer to <CODE>PGetAppleTalkInfo</CODE> when you call the function. You must also allocate memory for and provide pointers to the data buffers into which the <CODE>PGetAppleTalkInfo</CODE> function returns the data-link address and zone name. <BR>You pass a pointer to the buffer for the returned data-link address as the value of the <CODE>linkAddr</CODE> field. You pass a pointer to the buffer for the returned zone name as the <BR>value of the <CODE>zoneName</CODE> parameter block field. <P>
<A NAME=HEADING48-26></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 If the node on which your application is running happens also to be running AppleTalk <A NAME=MARKER-9-21></A>internet router software in the background, more than one set of MPP global variables may be in RAM. To make sure you obtain information about the .MPP driver that handles application software, always use the <CODE>PGetAppleTalkInf</CODE>o function rather than the Device Manager's <CODE>PBControl</CODE> function. However, if you want to use the <CODE>PBControl</CODE> function, you must use a device driver reference number of -10 for the .MPP driver. <P>
 The memory that you allocated for the parameter block and data buffers belongs to the .MPP driver until the <CODE>PGetAppleTalkInfo</CODE> function completes execution. The memory must be nonrelocatable. After the <CODE>PGetAppleTalkInfo</CODE> function completes execution, you can reuse the memory or release it. <P>
<A NAME=HEADING48-29></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 If you use assembly language to call this function, you must use a device driver reference number of -10 for the .MPP driver.<A NAME=MARKER-2-32></A><P>
<A NAME=HEADING48-31></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>paramErr<TD>-50<TD>Version number is too high<A NAME=MARKER-2-181></A></TABLE>
</H5>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-47.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-49.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
