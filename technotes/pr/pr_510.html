<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PR510: Printer Driver Q&amp;As</title>                                       <meta name="categories" content="Printing"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002646" title="Printer Driver Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PR510</div>
<div id="pageheadsub">Printer Driver Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					  <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <A HREF = "../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p> <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><h2>Defining default LaserWriter Pro paper tray</h2><P>Date Written:   5/17/93</p><P>Last reviewed: 5/19/93</p><p>How can I set the default paper tray on my LaserWriter Pro to something otherthan the 250-sheet cassette?</p> <P>The paper tray selection in the printing job dialog is not "sticky"; it's notpreserved from job to job. In LaserWriter 7.2, the choice of one of the twopaper trays is stored in the print record. You may be able to hack out wherethis is stored and define a new "default" print record by changing the <code>PREC</code>(0)resource, but this is completely unsupported and you do so at your own risk.</p><p>In LaserWriter driver 8.0, the default paper trays are defined in thePostScript Printer Definition (PPD) file.  If you're sufficiently adventurous,you can edit the PPD file for your printer to change these relationships.LaserWriter 8.0 requires files that meet the PPD 4.0 specification, availablefrom Adobe's Developer Support program.</p><P><A HREF="#top">Back to top</A></P><h2>Code for getting selected printer name</h2><P>Date Written:   3/10/93</p><P>Last reviewed: 6/24/93</p><p>How do I get the name of the currently selected printer, for Systems 6 and 7?</p> <P>The printer driver has a resource of type PAPA, ID -8192, which contains thename of the selected printer and the network object type. This resource isamazingly easy to get; you don't even need to know where the printer driverresource file is located. Just call <code>PrOpen</code>. The Printing Manager will open thecurrently selected printer driver for you, and place it at the top of theresource chain. Then see whether you can <code>GetResource</code> for <code>'PAPA'</code> ID -8192, andviola--you have a handle to the printer name.</p><p>This will work under both System 6 and System 7. However, under QuickDraw GX,this method is subject to change. Also note that this is a read-only field;changing it doesn't necessarily change the selected printer.</p><p>The printer name is the first string, and the object type is packed right upagainst it. If all you want is the name, then here's a C routine that willprovide it:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr GetPrinterName(Str255 prName){  OSErr   err = noErr;  char  **papaDataHandle;  PrOpen();  papaDataHandle = Get1Resource('PAPA',-8192);  if(!papaDataHandle) {    err = ResError();  } else {    BlockMove(*papaDataHandle, prName, (**papaDataHandle)+1);    ReleaseResource((Handle) papaDataHandle);  }  PrClose();  return err;</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><h2>StyleWriter II driver differences</h2><P>Date Written:   3/17/93</p><P>Last reviewed: 6/24/93</p><p>My application won't print to a StyleWriter II although it works fine on allother printers including the original StyleWriter. Can you give me anysuggestions? What's different about the StyleWriter II?</p> <P>The StyleWriter II driver is a member of the "GrayShare" driver family, withnew features such as support for grayscale printing (if Color QuickDraw isavailable) and printer sharing over the network. Its internal architecture isvery different from previous printer drivers. In spite of thoroughcompatibility testing, some problems have shown up since the first release. Inmany cases, the driver revealed weaknesses in the applications themselves; forsome other problems, a solution will be incorporated in the next release of thedriver. Here are currently identified problem areas with the StyleWriter IIdriver:</p><ul type="disc"><li>The StyleWriter II driver handles memory differently. For example, if anapplication has a dereferenced handle to an unlocked block while <code>CopyBits</code>'inginto the printing port, this may work fine on all other printer drivers, butthe block is likely to move with the StyleWriter II driver, and the results areunpredictable.</li><LI>The StyleWriter II driver maintains its own A5 world internally. If anapplication installs a <code>GrowZone</code> proc and forgets to set up its own A5 in the<code>GrowZone</code> proc (ignoring the Technical Note <A HREF = "../me/me_01.html">"Register A5 Within <code>GrowZone</code>Functions"</a>), the <code>GrowZone</code> proc may get called with the StyleWriter II driver'sA5, which obviously is bad for the survival of both the application and theprinter driver.</li>	<li>The StyleWriter II driver calls the <code>pIdleProc</code> (in the job subrecord of the print record) more often than other printer drivers; in particular, it may be called during execution of <code>PrOpenDoc</code>. If an application reloads a print record previously used, containing an old (now invalid) pointer to an <code>idleProc</code>, and doesn't update the <code>pIdleProc</code> field before calling <code>PrOpenDoc</code>, disaster is very likely. Note that the Technote "pIdle Proc (or how to let users know what's going on during print time)" recommends installing the <code>idleProc</code> before <code>PrOpenDoc</code>.</li>	<li>Like most other QuickDraw printer drivers, the StyleWriter II driver uses algorithms built into QuickDraw for rasterizing picture elements like ovals and arcs, but not necessarily with the same sequence of coordinate transformations. Because of the 360 dpi resolution, internal computations with the transformed coordinates may hit the 16-bit integer limitation of QuickDraw, and reveal bugs in the old QuickDraw routines that have never been discovered so far.</li>	<li>The StyleWriter II driver (version 1.0) contains STR# resources with positive ID numbers that may conflict with STR# resources in an application. This will be fixed in the next release of the driver.</li>	<li>Under certain circumstances, the StyleWriter II driver seems to have trouble with a PmForeColor call. This is under investigation and will be fixed.</li></ul><P><A HREF="#top">Back to top</A></P><h2>Determining printer font</h2><P>Date Written: 1/26/93</p><P>Last reviewed: 4/26/93</p><p>Our application must print with Helvetica if available, and Geneva if not. Howcan I determine which fonts are available in a printer? I've been using the<code>wDev</code> field in the print record and assuming that a value of 3 means Helveticawill print correctly, but according to "Print Hints: Top 10 PrintingMisdemeanors" in <i>develop</i> issue 12, this isn't dependable.</p> <P>There's no procedural way to ask a printer if it even has built-in fonts, letalone what they are. By using <code>wDev</code> == 3, you've been assuming that allPostScript printers have built-in Helvetica fonts, and while most do, some donot. There are several things you can do, though.</p><p>First of all, you should know about font substitution. If this option ischecked in the LaserWriter driver (it's checked by default), you'll getHelvetica instead of Geneva when drawing in Geneva on PostScript printers thathave Helvetica. The driver adjusts all the font metrics so the widths matchwhat you see on the screen. In some versions of the LaserWriter driver, you'llget Geneva instead--but only if the Geneva TrueType font is available, so youget excellent quality either way. This might be enough to solve your entireproblem.</p><p>If not, there's the new <code><code>PSWriter</code></code> driver on AppleLink and on the <i>Developer CDSeries</i> disc. <code>PSWriter</code> uses PostScript Printer Definition (PPD) files andsupports a new <code>PrGeneral</code> call that lets you obtain the PPD file so that you canknow things about your target printer, including what fonts are installed.While this might give misleading results if the user has never set up theprinter (and is using the Generic PPD), it should be just fine in all othercases.</p><p>There's no way to tell whether the user has downloaded a font to the PostScriptprinter, making it available, because it won't be in the PPD file and there'sno way to ask the printer.</p><P><A HREF="#top">Back to top</A></P><h2>Where to get PostScript Printer Definition (PPD) files</h2><P>Date Written:  2/9/93</p><P>Last reviewed:  4/1/93</p><P>Where can I get PostScript Printer Definition (PPD) files for Apple'sPostScript printers?</p> <P>Apple recently made PPD files for its printers--past and present--available.You can find them on AppleLink in the Software Sampler: Apple SW Updates:Macintosh: Printing Software: PPDs folder.</p><p>PPD files for non-Apple PostScript printers with ROMs by Adobe Systems areavailable from a clearinghouse maintained by Adobe. To request a PPD file fromAdobe, send an internet message to "ps-file-server@adobe.com" with the subject"help". Adobe's list server will respond with mail about items available on thelist server and how you can get them.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter Driver 7.2 isn't ColorSync aware</h2><P>Date Written:  1/11/93</p><P>Last reviewed:  4/1/93</p><P>Is LaserWriter Driver 7.2 ColorSync aware?</p> <P>No, LaserWriter Driver 7.2 isn't ColorSync aware. Apple plans to add ColorSynccapability to future versions of the LaserWriter driver, but we don't have anymore information or details than that.</p><P><A HREF="#top">Back to top</A></P><h2>Printing nonstandard page dimensions</h2><P>Date Written:  1/14/93</p><P>Last reviewed:  6/14/93</p><P>How do we override the standard page dimensions for the StyleWriter or, forthat matter, any other printer? We want to print 5.5" x 8.5" (halfletter-sized) pages.</p> <P>The current printing architecture isn't designed for elegant (or sometimes<i>any)</i> communication from your program to the printer driver. All thecalls you normally make (such as <code>PrOpenDoc</code>, <code>PrOpenPage</code>, and <code>PrPicFile</code>) arehandled by the printer driver and not by the Printing Manager. The driversmanage the print records, put up the dialog boxes, decide how to rendergraphics and everything else in between. That's why writing a printer driver isso hard.</p><p>If you want to tell a printer driver "I want to use this size paper," thatdriver has to implement a driver-specific way to do it or it can't be done.There's no <code>PrSetPageSize</code> call in the current printing architecture. In fact,trying to print outside the rPage rectangle can cause physical damage on someprinters, so customizing page sizes is not something you want to enter intolightly.</p><p>You can't change the paper size in the print record, because most drivers don'tlook there to see what size you <i>want;</i> instead they tell you what sizeyou <i>get </i>in that field. The same is true for most of the print record:Unless <i>Inside Macintosh</i> tells you that you can write to that field, youcan't (or doing so won't do any good).</p><p>The StyleWriter in particular has very limited paper options; it handlesletter, legal, A4, and B5 paper sizes--and that's it. If you try to print othersizes, the hardware reports an error. This is pretty common in these days ofvery low-cost high-quality printers; features that you as a programmer wouldwant are jettisoned to keep the cost down. Most low-cost laser printers havelimited paper-handling capabilities as well. If you try to print continuousfeed paper on a StyleWriter, you'll get a paper jam error after about 15 inchesof paper pass through (long enough for the printer to realize it's notlegal-sized paper). Your half-letter size pages are too short for the printerto use.</p><p>While QuickDraw GX has a much more robust printing architecture, that doesn'thelp right now for the current world. Something that you may wish to consideris making forms available on regular letter-sized paper, with two per sheet.That size paper works in <i>every</i> printer sold in the United States andcould be perforated and detached by the customers.</p><p>All of Apple's LaserWriter printers have excellent paper handling but costrelatively more. The best way to handle custom page printing across <i>all</i>printers is to place your custom-sized image on an 8.5" x 11" page and providespecial paper.</p><p>Many, but not all, of Apple's printers support a <code>PREC</code> 3 resource that containsextra page sizes in a custom format. The format of this resource is asfollows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre> PageSizeRecord = RECORD  numItems: INTEGER;  botRights: ARRAY [0..NumPageOptionsZB] OF Point;  titles: PACKED ARRAY [0..0] OF CHAR;</pre>	</TD></TR></TABLE></CENTER><p><code>numItems</code> is the number of page sizes displayed in the dialog. The maximumnumber is six (since there is only room for six radio buttons in the Page Setupdialog). <code>botRights</code> is an array of points specifying the bottom right corner foreach page. This corner is specified in 120ths of an inch, and it should definethe physical size of the paper, not the imageable area. </p><p>titles is a packed array of page size names. Each name begins with a lengthbyte, followed by the number of characters specified by the length byte. Thestrings are packed, so <code>string1[LENGTH(string1)+1</code>] would reference the lengthbyte of string2.</p><p>To use this mechanism, your application should create a <code>PREC</code> resource with anID = 4. You can do this very easily by copying <code>PREC</code>(3). Once you have a copy,you can modify the page sizes as you wish. When the printer driver is called todisplay the Page Setup dialog, it will first look for <code>PREC</code>(4). If found, itwill use it to define the page sizes. If not found, the driver will use thestandard sizes in <code>PREC</code>(3).</p><p>This method only works with some of Apple's drivers; the LaserWriter driverignores these resources. If you decide to implement this feature in yourapplication, be sure to warn your users that custom page sizes may not beavailable on all devices.</p><p>Use this feature at your own risk; it's very likely not to work under QuickDrawGX and later system software.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter driver <code>'feed'</code> resource troubleshooting</h2><P>Date Written:  11/24/92</p><P>Last reviewed:  3/1/93</p><P>The userdict definitions in my LaserWriter driver <code>'feed'</code> resource (written perthe Macintosh Technical Note <A HREF = "pr_15.html">"Feeder Fodder"</a>) get wiped out after each page. Atleast, every time my redefined showpage is executed the variables that shouldhave been defined the first time in userdict are unbound. What could behappening here? How should I define something in <code>'feed'</code> resource code that actslike a global variable for a redefined showpage?</p> <P>Your operators shouldn't be wiped out with each page. You're being loadedbefore the <code>PREC</code> 103 is loaded and before the series of save and restoreoperators are called, which could otherwise wipe you out. Please read theMacintosh Technical Note "The Lo Down on Dictionary Downloading" for a robustdescription of this process. Thus, we must look to other reasons why youroperators are being wiped out.</p><p>The natural culprit is your PostScript. Are you wiping yourself out? Second,you should heed the warning on page 4 of the "Feeder Fodder" Technical Note:"As always, calling or redefining operators defined by the LaserPrep (md)dictionary isn't supported." You could see problems as you describe if you'reredefining LaserPrep dictionary commands. Other variables include the systemsoftware and LaserWriter driver versions that you're using. It could be anissue with the type of LaserWriter itself.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter driver doesn't <code>SwapMMUMode</code> for 32-bit addresses</h2><P>Date Written:  11/17/92</p><P>Last reviewed:  6/14/93</p><P>When I use <code>CopyBits</code> to move a <code>cGrafPort</code>'s portPixMap to another <code>cGrafPort</code> (myprinting port), it works like a charm when background printing is turned on,but when <code>CopyBits</code> gets called with background printing turned off, the imagethat prints isn't the image at all. Why is this happening?</p> <P>You should be aware that since you're copying the pixels directly from thescreen, the baseAddr pointer for the screen's pixMap may be 32-bit addressed.In fact, with 32-Bit QuickDraw, this is the case. This in itself isn't aproblem, since <code>CopyBits</code> knows enough to access the port's pixMap's baseAddr in32-bit mode, as follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>mode = true32b;SwapMMUMode(&amp;mode);  // Make sure we're in 32-bit addressing mode.// Access pixels directly; make no other system calls.</pre>	</TD></TR></TABLE></CENTER><p>That's how you'd normally handle things if you were accessing the pixelsdirectly yourself. Unfortunately, the LaserWriter driver doesn't know enough todo the <code>SwapMMUMode</code> and instead ends up copying garbage (from a 32-bit pointerstripped to a 24-bit pointer).</p><p>So why does background printing work? Because when you print in the background,everything is rolled into a PICT, which the driver saves off for PrintMonitor.Since the driver is using the standard QuickDraw picture bottlenecks to dothis, and <code>CopyBits</code> knows to swap the MMU mode before copying the data into thepicture, everything works great. Later, at PrintMonitor time, the picture isplayed back. Since the data is no longer 32-bit addressed, the LaserWriterdriver doesn't have to call <code>SwapMMUMode</code> to do the right thing; it can just playthe picture back.</p><p>The solution we propose for you is something similar. At print time (beforeyour <code>PrOpenPage</code> call), call OpenPicture, copy the data from the screen with<code>CopyBits</code>, call ClosePicture, and then call DrawPicture within your<code>PrOpenPage</code>/PrClosePage loop. That should do the trick.</p><p>Note that copying bits directly from the screen is not something we recommend.Unless you have no alternative, you should <i>always</i> copy from the originalsource of the data instead.</p><P><A HREF="#top">Back to top</A></P><h2>System 7.1 and printer driver compatibility</h2><P>Date Written:  11/18/92</p><P>Last reviewed:  6/14/93</p><P>If a user upgrades from System 7.0.x to 7.1, a new version of the PrintMonitoris installed. Will existing printer drivers behave correctly with the newPrintMonitor?</p> <P>When a user installs System 7.1, Easy Install will update any existing printersoftware. If the user picks Customize, he or she must choose the printers to beupdated. Only the versions of the printer drivers that come with System 7.1should be used with 7.1. Mixing and matching is bad.</p><p>Since only Apple's printer drivers use PrintMonitor, as long as you upgrade toSystem 7.1 by using the Installer there's no issue at all.</p><P><A HREF="#top">Back to top</A></P><h2>System 6 and System 7 PrintMonitor</h2><P>Date Written:  11/18/92</p><P>Last reviewed:  3/1/93</p><P>Is the version of PrintMonitor that ships with System 7.1 compatible withSystem 6? If so, which version of the Backgrounder file would be compatible forinstallation with the System 7.1 PrintMonitor on System 6.x systems?</p> <P>Only Apple's printer drivers should be using PrintMonitor--the interface isundocumented and unsupported for other printer drivers. PrintMonitor-likethings are a different story, but the specific Apple product PrintMonitor worksonly with Apple's printer drivers.</p><p>While the drivers may be used under System 6, users should use the versions ofBackgrounder and PrintMonitor present on the System 6.0.8 disks. SinceBackgrounder and PrintMonitor are tied together, we have to recommend againstusing the 7.1 PrintMonitor under System 6.</p><p>Note that in all these cases, nothing was specifically added to make things<i>not</i> work under System 6--they simply weren't tested and therefore can'tbe supported.</p><p>Summary:</p><p>System 6: Backgrounder and PrintMonitor from 6.0.8, current driver</p><P>System 7: Use whatever the Installer installs.</p><P><A HREF="#top">Back to top</A></P><h2>Which printers to test printing</h2><P>Date Written:  10/1/92</p><P>Last reviewed:  11/2/92</p><P>We need to know what printers on which to test our application. It prints onlypixmaps. It's been tested on some LaserWriters. The question is, how manybrands and models of printers do we need to test it on? Are there anydefinitive printing tests (for example, does success on a LaserWriter indicatecorrectness of the application)?</p> <P>Unfortunately, there is no such thing as a universal printing test suite.Moreover, successful printing not only depends on the specific printer driver(and its version), but also on the available memory at print time, and onthings like the font configuration in the system. (Given that you print pixmapsonly, the last comment is not applicable. Most certainly, all potentialproblems will rather boil down to out of memory conditions). Also, we have seenapplications with severe defects in their printing code print quite correctlyto the LaserWriter, and fail only on a few other specific printers. Most otherprinting problems have to do with assumptions about the inner working of aspecific printer driver, such as hacking the print record behind the back ofthe Printing Manager. In this case, trouble with at least one of the 150 plusdifferent printer drivers out there is guaranteed!</p><P>Pragmatically speaking, you may want to test printing in priority on theprinters most likely being used by your customers. Currently (as of November1992), this is the PostScript LaserWriter (driver version 7.1.2 or later), theStyleWriter (driver version 7.2.2), the Personal LaserWriter LS (driver version7.2), and one or another of the most popular third-party printers. In addition,we recommend that you test both on an older LaserWriter (up to the LaserWriterIINT), and the newer ones (LaserWriter IIf, IIg, NTR), because of thedifferences in the PostScript interpreters and gray-level support.</p><P><A HREF="#top">Back to top</A></P><h2>Where to get documentation on writing a Macintosh printer driver</h2><P>Date Written:  4/9/91</p><P>Last reviewed:  8/1/92</p><p>Where can I find documentation on how to write a Macintosh printer driverequivalent to the ImageWriter or LaserWriter driver? In particular, how arePrinting Manager and QuickDraw commands translated into calls to the printerdriver?</p> <P>DTS's <A HREF = "downloads/Learning_to_Drive.sea.hqx">"Learning to Drive"</a> document and "StdFileSaver" source code, available inAppleLink's Developer Support folder and on the latest<i> Developer CDSeries</i> disc, are helpful references.</p><P><A HREF="#top">Back to top</A></P><h2>Writing a Macintosh printer driver</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  8/1/92</p><p>I have a printer I would like to connect to the Macintosh. Where can I findinformation on writing a printer driver?</p> <P>A Macintosh printer driver is more than a standard device driver. A printerdriver contains code to implement all of the standard Macintosh PrintingManager routines. The code includes routines like <code>PrOpen</code>/PrClose, and<code><code>PrOpenDoc</code>/PrCloseDoc</code>. A Printing Resource File contains all of the resources(including code) to implement the Macintosh Printing Manager for a particulardevice. A driver works best with all Macintosh applications if it supports boththe high- and low-level Printing Manager interfaces, as well as the <code>PrGeneral</code>(IM V:410) routine and its associated opcodes.</p><p>Apple is not currently supporting the development of Chooser-selectable devicedrivers, at least not those that support printers. There are many reasons forthis, and here are at least a few of them:</p><p>First, there is no documentation or examples available. Each of the Appleprinter drivers is unique. They are all written almost entirely in 68000assembler, and consequently, are not very easy to read. Since each driver isdifferent, the only real documentation for how the drivers work is the sourcecode to the driver. There is some general interface information available, butimportant information, like how the driver manages its print record, isdescribed only in the source code. This information could be extracted anddistilled into some kind of document, but this brings up the next problem:</p><p>The Macintosh Printing Manager is currently being revised and enhanced. Theserevisions will require major changes to the architecture of the PrintingManager. It's not clear what effect these changes will have on existing printerdrivers, but it is very possible that the drivers that exist today will have tobe revised significantly to run under the new Printing Manager.</p><p>Apple is designing and implementing the next generation Macintosh PrintingManager. Developers' suggestions for features are being taken into account. Oneof the goals of the new architecture is to make writing drivers much simpler,and to allow the sharing of code between drivers. When this architecturebecomes available, Apple will reconsider its position of driver development,and will probably end up with some kind of licensing agreement for developersthat want to write drivers. Until then, the preceding reasons should beadequate justification for NOT attempting a Macintosh printer driver at thistime.</p><p>If you still aren't convinced, and want to write a driver despite thechallenge, see the article in the December '88 issue of <i>MacTutor</i>magazine. There is an example printer driver written in C. It is just askeleton driver, and does not handle any of the more difficult problems such asline layout, font substitution, graphics, or banding. But it is a start, andgives you a general idea of the structure of a driver. Since some developersbegan writing their drivers before Apple discontinued support, DTS is stillanswering questions concerning driver development. However, these questions arelimited to those that can be answered by the DTS engineers. You should also beaware that some of the techniques used by Apple printer drivers are consideredproprietary. Information on methods used for line layout as well as certainaspects of font handling will not be disclosed.</p><p>X-Ref:</p><P>Printing Manager</p><P><A HREF="#top">Back to top</A></P><h2>Changing printer driver settings without using the dialog</h2><P>Date Written:  11/6/91</p><P>Last reviewed:  6/14/93</p><p>To change default printer driver settings without using the dialog, keep a copyof the print record with the various settings you want, and when you want tochoose your settings, just use your special print record. The current Macintoshprint architecture doesn't allow procedural access to the print record, so youmust call the dialogs once for yourself, choose your settings, and then save acopy of the print record that is produced. Some settings are job-dependent, butvalues that are retrieved from the print record can be changed using thistechnique. You can only save the settings in the Style dialog. Call PrValidatewhen retrieving a print record from the resource fork to make sure it is"good." </p><P>See <i>develop</i>, issue #1, pages 58-65, for a complete discussion ofchanging default printer driver settings and sample code.</p><P><A HREF="#top">Back to top</A></P><h2>Macintosh print record <code>wDev</code> field</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  8/1/92</p><p>What is the Macintosh print record <code>wDev</code> value for the ImageWriter LQ,LaserWriter IISC, and AppleFax Modem?</p> <P>Apple strongly discourages the use of the <code>wDev</code> field in the print record forseveral reasons. First, this field contains a unique ID for each printer driveron the Macintosh. Coding your application to use this ID makes it devicedependent, and device dependence will cause many problems in the future as theMacintosh Printing Manager continues to evolve. Many applications currentlycheck for <code>wDev</code> = 3 to determine whether or not to send PostScript. Although theApple LaserWriter driver has a <code>wDev</code> of 3, third-party printer drivers forPostScript devices do not, so if your application determines whether or not tosend PostScript based on <code>wDev</code> alone, your application may incorrectly printwith QuickDraw on third-party PostScript devices. A second problem concernsspoolers and spool files. If a spooler is installed between an application andthe printer driver that is going to do the printing, the application receivesthe <code>wDev</code> ID of the spooler instead of the target driver. If the applicationmakes assumptions based on this ID, it probably gets unexpected results. In thefuture, it may also be possible to redirect spool files. This means that a filethat was originally spooled for a PostScript printer may be redirected to aQuickDraw device. If the spool file contains only the PostScript representationof the document, it will be useless to the QuickDraw device. Despite thesestrong warnings, some developers are convinced they need the <code>wDev</code> values, andthere may be some vertical applications where they're needed. For those cases,here is the current list of <code>wDev</code> IDs for Apple printer drivers:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Device               <code>wDev</code> (Hi Byte)    ImageWriter I/II:     1    LaserWriter,    LaserWriter Plus,    LaserWriter IINT,    LaserWriter IINTX:    3    LaserWriter IISC:     4    ImageWriter LQ:       5</pre>	</TD></TR></TABLE></CENTER><p>DTS does not support the use of these constants. They are definitely subject tochange.</p><P><A HREF="#top">Back to top</A></P><h2>Determining if a printer driver accepts Color QuickDraw calls</h2><P>Date Written:  11/21/90</p><P>Last reviewed:  8/1/92</p><p>How do you find out if a printer driver accepts Macintosh Color QuickDrawcalls?</p> <P>Check to see if the printer driver has returned a color <code>grafPort</code> to yourapplication after the call to <code>PrOpenDoc</code> (that is, the port that <code>PrOpenDoc</code>returns).</p><p>To determine if the <code>grafPort</code> is color, you need to check to see if rowBytesfrom the <code>grafPort</code> are less than 0. The following code fragment demonstratesthis idea:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>(* This function determines if the port passed to it is a color port. If *)(* so, it returns TRUE. *)FUNCTION ColorPort(portInQuestion: GrafPtr): BOOLEAN;BEGIN    IF portInQuestion^.portBits.rowBytes &lt; 0 THEN        ColorPort := TRUE    ELSE        ColorPort := FALSE;</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><h2>Printing in mixed Macintosh System 6/7 network</h2><P>Date Written:  12/11/90</p><P>Last reviewed:  8/1/92</p><p>What is the recommended printer driver for a network environment with mixedoperating systems (such as System 6.0.5 on a Macintosh Plus and 7.0 on twoMacintosh IIfx systems)?</p> <P>In a mixed 6.0.x/7.0 network we recommend upgrading all systems to the 7.0print drivers--even systems running 6.0.x. The 7.0 LaserWriter drivers workfine under system 6.0.x and will avoid any printer reinitialization problems.Use the 7.0 printing disk (or the printing install folder), and launch theInstaller from that disk. It has scripts needed to install 7.0 print drivers ona 6.0.x system. Do <i>not </i>select the Installer options for printers fromthe main 7.0 Installer, because these scripts currently are only for systemsrunning 7.0.</p><p>If a Personal LaserWriter NTR is used on the network, you must upgrade allworkstations to the 7.1.1 LaserWriter driver or later. (The NTR requires atleast LaserWriter 7.1.1.)</p><P><A HREF="#top">Back to top</A></P><h2>System 7.0 LaserWriter driver &amp; choosing nonstandard page sizes</h2><P>Date Written:  4/8/91</p><P>Last reviewed:  6/14/93</p><p>With the System 7.0 version of the LaserWriter driver, when the user selectsEnvelope from the Page Setup dialog, the page size returned by the driver isstill a standard page: 8.5 x 11. How do you recommend that applications displaythe page size when the user has chosen a nonstandard page size?</p> <P>We recommend that you have the page preview show a full page instead of anenvelope-sized page. The LaserWriter driver supports a large number ofPostScript devices, and it can't be sure whether the envelope will be fed onthe right, left, or center of the paper tray. If you show the full page, a usercan print on any device by putting the text in the correct location for thatdevice.</p><p>Manufacturers of PostScript printers can add custom page sizes to theLaserWriter driver. If they do, the representation on the screen will bewhatever they decide to define. Applications should not try to interpret custompage sizes. If your application ignores the results returned by the driver, yourisk incompatibility down the road.</p><P><A HREF="#top">Back to top</A></P><h2>Asynchronous LaserWriter driver no longer supported</h2><P>Date Written:  9/24/91</p><P>Last reviewed:  8/1/92</p><p>What is causing incorrect characters to be printed on the asynchronousLaserWriter driver we licensed from Apple for use with a non-ApplePostScript-equipped printer?</p> <P>The printing of incorrect characters is probably due to an incompatibilitybetween the async driver and the version of PostScript being used in theprinter.</p><p>The reason for the incompatibility is that the driver is no longer supportedand hasn't been revised for quite some time. The driver was originallydeveloped outside of Apple, and Apple licensed the driver for its use. Thecompany subsequently went out of business and the driver hasn't been revvedsince.</p><p>PostScript and Apple's AppleTalk LaserWriter drivers have been updated andchanged quite a bit since then, which is why the characters print correctlywhen using AppleTalk, but not when printing asynchronously. The old asyncdriver just doesn't know how to handle the new PostScript versions andtherefore prints "garbage" characters.</p><p>The SL Laser II driver is no longer supported by Apple, and at this time Applehas no plans to update this driver or write a new one. Since things workcorrectly with AppleTalk, you should confine usage to AppleTalk when printingPostScript to the LaserWriter. If this is unacceptable, you might check aroundwith different clearinghouses to see if a third-party developer has acompatible, up-to-date asynchronous LaserWriter driver that you can use.</p><P><A HREF="#top">Back to top</A></P><h2>Use LaserWriter driver srcCopy instead of <code>srcOr</code> transfer mode</h2><P>Date Written:  5/1/91</p><P>Last reviewed:  6/14/93</p><p>I'm creating PICTs that are comprised of many lines drawn in <code>srcOr</code> mode. Whenusing the LaserWriter 6.x or 7.x driver with the Color/Grayscale radio buttonselected, some lines fail to print. Why is this happening?</p> <P>The problem is a bug in the LaserWriter driver. Sometimes, when using a<code>cGrafPort</code>, the driver doesn't reproduce lines drawn in <code>srcOr</code> mode. (A <code>cGrafPort</code>is used when the Color/Grayscale print option is selected; in Black &amp; Whiteprint mode, a regular <code>grafPort</code> is used.) A workaround is to use srcCopy insteadof <code>srcOr</code> when drawing QuickDraw objects within your PICTs.</p><P><A HREF="#top">Back to top</A></P><h2>Save and restore long word if using $948 under System 7</h2><P>Date Written:  6/11/91</p><P>Last reviewed:  8/1/92</p><p>Unless my Macintosh application restores the contents of the long word at $948after using that space for globals, the Finder draws icons incorrectly and mythird-party LaserWriter driver crashes. Is somebody now using $948 for otherpurposes?</p> <P>This is a known System 7 icon drawing bug, and also a bug with the printerdriver that you are using.</p><p>The icon drawing utilities are trying to determine if a print page is currentlyopen, by looking at that variable ($948 is part of printvars). This turns outnot to be such a good idea, and it will be fixed in the next release of thesystem software.</p><p>The printer driver bug that you are experiencing is that every printer drivermust return the variable at $948 to -1 when they are done printing. Also, whileprinting, the driver should set it to &lt;&gt; -1.</p><P><A HREF="#top">Back to top</A></P><h2>Update Backgrounder if using LaserWriter 7.0 under System 6</h2><P>Date Written:  7/10/91</p><P>Last reviewed:  8/1/92</p><p>When we use the LaserWriter driver 7.0 with System 6.0, the Chooser'sBackground Printing On button is always dimmed. Is there any way to enablebackground printing?</p> <P>To get the LaserWriter 7.0 driver to work with System 6.0.x, update yourBackgrounder file with the version on the Printing Tools disk that's used toinstall System 7.0.</p><p>In short, to use the 7.0 LaserWriter Driver, 7.0 PrintMonitor, and System6.0.x, place these files from the System 7.0 Printing Tools installation disksinto your System Folder. All three must be used together for printing to workcorrectly. After you've placed these files in the System Folder, you shouldfind the Background Printing option enabled for your use.</p><p>There are no known incompatibilities with the 7.0 drivers and System 6.0.x, soeveryone should use the latest drivers, even with a mixed environment. Thiswill also get rid of "printer wars" that occur when users use more than oneversion of the LaserWriter driver to print to the same printer. (The printermust be reinitialized if the current user uses a different version of thedriver than that used by the previous user.)</p><P><A HREF="#top">Back to top</A></P><h2>LaserPrep 7.0 file &amp; AppleShare Print Server</h2><P>Date Written:  7/15/91</p><P>Last reviewed:  8/1/92</p><p>The LaserPrep 7.0 file is included on the System 7 Printing disk and the System7 Group Update CD for upgrading the AppleShare Print Server to support theLaserWriter 7.0 driver. The AppleShare Print Server has its own LaserWriterdriver built in and all it needs to print is a LaserPrep file. In fact, theAppleShare Print Server completely ignores any LaserWriter driver installed inthe System Folder of the server.</p><p>Page 49 of the <i>System 7 Group Upgrade Guide</i> states the followingprocedure for upgrading an AppleShare Print Server to support the System 7LaserWriter drivers:</p><ol type="1">	<li>Shut down the print server software.</li>	<li>Install the printer driver update.</li>	<li>Drag the LaserPrep icon from the Printer Update folder to the Server Folder of the print server Macintosh.</li>	<li>Restart the print server Macintosh and the AppleShare Print Server software.</li></ol><p>Actually, step #2 in the <i>System 7 Group Upgrade Guide</i> is unnecessary.Installing the printer driver update has no effect on the AppleShare PrintServer software.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter 7.0 driver and LaserPrep dictionary</h2><P>Date Written:  8/29/91</p><P>Last reviewed:  6/14/93</p><p>In the old LaserWriter drivers it was possible to create a PostScript file withor without the LaserPrep dictionary ("F" or "K" key). Is it possible togenerate a file without the dictionary with the LaserWriter 7.0 driver?</p> <P>In 7.0 printing, a LaserPrep dictionary is always sent with a print job. Thisis done to prevent constant reinitialization of the LaserWriter by conflictingprinter drivers. You cannot prevent it from being sent. Fortunately the 7.0version of the LaserPrep dictionary is much smaller (~40K total) than its 6.xpredecessors.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter ignores ForeColor while filling smoothed polygon</h2><P>Date Written:  10/8/91</p><P>Last reviewed:  8/1/92</p><p>When doing the FillRgn for drawing the fill of a smoothed polygon (as describedin <A HREF = "../qd/qd_10.html">Macintosh Technote #91</a>) the foreColor isn't used on the LaserWriter. Anyway to make it work?</p> <P>You've discovered a design limitation of the LaserWriter driver. Things thathave patterns associated with them are rendered by using the LaserWriter screenoperators. This results in an assumption of the foreground color being blackand the background color being white, which is what's causing the problem younoticed. In short, it makes the driver ignore your foreground and backgroundcolors.</p><p>You can work around the problem by working in an off-screen <code>GWorld</code> first andthen CopyBitsing everything to the printer port using srcCopy. There are acouple of problems with this approach: First, don't do it with text or yourtext will be turned into a bitmap and you'll get the "jaggies." Second, you'llprobably want to increase the printer port's resolution from its default of 72dpi for better results. A value of 288 dpi works nicely since it's an evenmultiple of QuickDraw's native 72-dpi resolution. Also, make sure that the<code>GWorld</code> you create has the same bounds as the printer port's rPage rectangle toavoid unnecessary scaling and clipping. After you've done all that, draw intoit and <code>CopyBits</code> the result to the printer port. The nice thing about doingeverything off-screen first is that then you can use some of thenon-printer-friendly transfer modes like blend or dithered. Also, you can useForeColor/BackColor and get the right thing this way.</p><p>If you don't want to use this method for all printers, (since it can be quite amemory hog), you can check for the LaserWriter driver and use this method injust that case. For other drivers, you should just print as normal.</p><p>So, what do you need to do all this? Well, to set the resolution of the printerport, use <code>PrGeneral</code> as described in <i>Inside Macintosh</i> Volume V and<i>develop</i> #3.</p><p>To determine whether you have the LaserWriter driver or not, check the highbyte of the <code>wDev</code> field in your print handle. This is described in the Technote"Optimizing For The LaserWriter--Techniques." While this method might breaksome day, it's currently the best way to determine which driver you're using,and Apple will have to let developers know before we break it.</p><p>If the high byte of the <code>wDev</code> is 3, then you either have the LaserWriter driveror a third-party driver impersonating the LaserWriter. Some PostScript driversdo that because many apps assume a <code>wDev</code> of 3 means a PostScript printer, andanything else doesn't. By acting like Apple's LaserWriter driver, they getpreferential treatment from apps that "special case" for PostScript. That's notreally a problem in this situation.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter driver PostScript error strings &amp; document names</h2><P>Date Written:  12/11/91</p><P>Last reviewed:  8/1/92</p><p>I discovered an interesting bug in the Macintosh LaserWriter driver. If theword "timeout" is in the name of a document, the LaserWriter driver will give atimeout error -8132. Are there similar magic words?</p> <P>PostScript error messages are sent from the LaserWriter to the driver as textstreams. The driver must check these strings to see if they contain an errormessage. If a document is named something that contains the same string as aPostScript error message, the driver may think there's an error when theprinter sends the "status: printing document XXXXX" message. Other stringscause similar problems; one of them is "printer out of paper." If you want tosee the rest of the strings, take a look at the LaserWriter printer driverresource type '<code>PREC</code>' ID = 109.</p><P><A HREF="#top">Back to top</A></P><h2>Personal LaserWriter NTR has longer product string</h2><P>Date Written:  3/17/92</p><P>Last reviewed:  6/14/93</p><P>The product name stored for this printer is (LaserWriter Personal NTR) or(Personal LaserWriter NTR), depending on whether you're using statusdict orsystemdict, respectively. In either case, the product's length is 24characters. Since you're only allocating 20 characters for the 2nd string youuse with cvs, you're getting a rangecheck error. You may want to make the string even larger than 24characters to accommodate longer product names in the future.</p><p>Assumptions about the length of PostScript product strings are a common problemwith new printers (having more verbose names). In fact, you should have thesame trouble if you run your original PostScript on the Personal LaserWriterNT, which has a 23 character name.</p><P><A HREF="#top">Back to top</A></P><h2>LaserWriter II SC fonts and 4x bitmap size</h2><P>Date Written:  11/17/89</p><P>Last reviewed:  6/14/93</p><p>Why do I need to have four times the bitmap size of the font I want to print inon the LaserWriter II SC?</p> <P>LaserWriter II SC fonts are four times the point size of the associatedMacintosh screen font. The pixels on the screen are four times as far apart(center to center) as the dots printed by the LaserWriter SC. When the bitmapsfor one of the printer fonts is printed, the result is a font with a resolutionfour times greater than that of the font displayed, but at a size identical tothe font displayed on the screen.</p><P><A HREF="#top">Back to top</A></P><h2>Font families shipped with LaserWriters</h2><P>Date Written:  11/17/89</p><P>Last reviewed:  8/1/92</p><p>What fonts and sizes are shipped with the LaserWriter Plus, LaserWriter IINT,LaserWriter IINTX, and LaserWriter SC?</p> <P>The LaserWriter Plus, LaserWriter IINT, and LaserWriter IINTX, shipped with atotal of 11 font families with the sizes indicated below:</p><p>Times, Helvetica, Courier, Symbol: 9, 10, 12, 14, 18, 24</p><P>Palatino, Helvetica Narrow, ITC Bookman,</p><P>ITC Avant Garde Gothic, ITC Zapf Chancery,</p><P>ITC Zapf Dingbats, New Century Schoolbook 10, 12, 14, 18, 24</p><P>A total of four font families are shipped with the SC: Courier, Symbol, Times,and Helvetica in the following sizes: 9, 10, 12, 14, 18, 24, 36, 48, 56, 72,96.</p><P><A HREF="#top">Back to top</A></P><h2>Disable Graphics Smoothing for printing large bitmap images</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  6/14/93</p><p>When printing large (possibly scanned) Macintosh bitmap images, the page isprinted with small lines running horizontally through the image. Why?</p> <P>In System 6.0 the QuickDraw DrawPicture call was revised to fix some problems.One of these problems concerned large bitmaps. To help solve the problem ofbitmaps that were too large to be printed, DrawPicture was modified to "band"the <code>CopyBits</code> request if it was too large. Banding is the process of convertinga large bitmap into several smaller bitmaps. This banding usually occursvertically down the page. When DrawPicture bands a large bitmap into pieces,the smoothing algorithm of the LaserWriter is applied to each piece separately,instead of being applied to the entire bitmap at once. Since the process ofsmoothing involves removing some pixels, hairlines will be created between thebitmap bands. There is no way to tell the LaserWriter driver that the smallerbitmaps are all part of one large bitmap, so the only solution to this problemis to disable Graphics Smoothing when printing large bitmap images.</p><P><A HREF="#top">Back to top</A></P><h2>Difference between LaserWriter 7.0 and 7.1 Namer</h2><P>Date Written:  3/3/92</p><P>Last reviewed:  8/1/92</p><p>Apple Software Licensing's "Exhibit C" lists localized Namer 7.0 versions inseveral languages, and mentions that these localized versions of the Namer areavailable in version 7.1. What is the difference in the Namer between 7.0 and7.1?</p> <P>The main difference between the LaserWriter utility 7.0 and 7.1 is that part ofthe Namer has been integrated into the 7.1 version of the software. Until theLaserWriter utility 7.1 was made available, the Namer was a stand-aloneapplication. However, the LaserWriter utility does not do everything the Namerdoes. For example, the Namer renames AppleTalked ImageWriters, but theLaserWriter utility doesn't. For all your printer configuration needs, youshould use the 7.1 version of the software.</p><P><A HREF="#top">Back to top</A></P><h2>ImageWriter and printing multiple copies in draft mode</h2><P>Date Written:  1/6/92</p><P>Last reviewed:  6/14/93</p><p>Our application can't print multiple copies on the ImageWriter in Draft mode.If we type in 3 copies in the ImageWriter driver dialog box in Draft mode, weonly get one copy. Everything prints fine in Best or Faster modes. Is this abug in the ImageWriter driver?</p> <P>Although it seems like this must be a bug in the ImageWriter driver, it's not.In Draft mode, the application that's printing must make sure the requirednumber of pages are printed. This involves cycling through the app's print loopfor each copy to be printed.</p><p>In Draft mode on an ImageWriter, nothing is spooled to disk; the data isimmediately sent to the printer. Therefore, the data is no longer availableonce it's sent to the printer (and there's no way for the print driver toresend it for multiple copies). When the ImageWriter spool-prints, the filethat's created is printed the required number of times for you. Therefore, yourapp only needs to handle multiple copies when printing in Draft mode.</p><p>Here's what your app should do:</p><ol type="1">	<li>Validate the print record and present the job dialog. This allows the user to choose how many copies to print and allows the printer driver to adjust the print record to reflect how many copies your program has to print.</li>	<li>Get the number of copies that you're expected to handle from the print record. In the case of spool printing, this number will be set to 1 (since the multiple copies are handled for you by the printer driver). In any case, the following Pascal code will give you the correct info.</li>	<li>For each copy in <code>numCopies</code>, loop through the <code><code>PrOpenDoc</code>/PrCloseDoc</code> section of your code.</li></ol><p>This method is demonstrated in the code for the Macintosh Technote <A HREF = "pr_10.html">"A PrintingLoop that Cares...</a>," which describes a model print loop.</p><P><A HREF="#top">Back to top</A></P><h2><a name="dogcow">Dogcow logo is trademarked</a></h2><P>Date Written:  9/10/92</p><P>Last reviewed:  6/14/93</p><p>We would like to use the "dogcow" icon in our Page Setup dialog. Is the dogcowtrademarked, and are there any restrictions on using this icon in oursoftware?</p> <P>Yes, the dogcow logo (along with its call, "Moof!") is a trademark of Apple andis proprietary. The dogcow appears on Apple's <i>Developer CD Series</i> discand in other material. Apple has a pending U.S. registration on it.Accordingly, it's not available to third-party developers as an icon or filesymbol.</p><P><A HREF="#top">Back to top</A></P><h2>"Printer driver is MultiFinder compatible" bit</h2><P>Date Written:  7/29/92</p><P>Last reviewed:  6/14/93</p><p>Could you tell me what the "printer driver is MultiFinder compatible" bit isused for?</p> <P>The "printer driver is MultiFinder compatible" bit provides two features.First, it allows the printer driver resource file to be opened by multipleclients. This was obviously needed to support multiple applications printingsimultaneously under MultiFinder. The other feature provided by the flag is theloading of PDEFs into the system heap rather than the application heap (whichis where they go under the Finder).</p><p>The MultiFinder-compatible bit has a major limitation: If your driver has thisflag set, you aren't allowed to add or resize resources, or do anything elsethat would cause the RAM-resident resource map to change. Although MultiFinderlets multiple applications open the printer resource file at the same time, ithas no control over the resource map that gets loaded by the Resource Managerwhen the file is opened. Because of this, each client gets its own personalcopy of the resource map. When these clients get done with the file, they writethe resource map back to the file (via <code>UpdateResFile</code>). Obviously, if theresources have changed in any way, the last client to call <code>UpdateResFile</code> is theonly one whose changes will be recorded. This is a "thrill seeker" method ofhandling the printer driver resource files, but since none of the Apple printerdrivers currently add or resize resources, it made sense.</p><p>So the bottom line here is that if you want your drivers to be compatible underMultiFinder, you'll have to implement a scheme that doesn't require adding orresizing resources. It's OK to change the data in a resource, as long as youdon't change its size. Changing the data won't cause changes to the resourcemap, so each client will still have accurate copies of the map.</p><p>Here's what would happen to your printer driver's resources under the Finderand MultiFinder when the MultiFinder-compatible bit is set:</p><p>* Under the Finder in system software version 6.0.x: All resources are loadedinto the application heap--regardless of the resource attribute's bit setting.If the resource has the "load into the system heap" bit set, it will still beloaded into the application heap under the Finder. This makes sense in theFinder world because the application heap will usually have more room than thesystem heap.</p><p>* Under MultiFinder in System 6 or System 7: All the printer driver's resourceswill be loaded into the system heap. This is true whether the "load into thesystem heap" bit is set or not.</p><p>Why does the resource loading occur this way, even when the resource's "loadinto the system heap" bit is set? Patches to the <code>GetResource</code> trap load all yourprinter driver's resources into the system heap when the MultiFinder-compatiblebit is set under MultiFinder, and into the application heap under the Finder(as described above), which is why you can't override this behavior.</p><p>By the way, you should be aware of the <A HREF = "downloads/setpdimc.hqx">SetPDiMC</a> MPW tool, which is available onthe <i>Developer CD Series</i> disc. It will automatically set theMultiFinder-compatible bit for you when you build your printer driver.</p><P><A HREF="#top">Back to top</A></P><h2>Use FillCRect off-screen, not directly to printer port</h2><P>Date Written:  8/25/92</p><P>Last reviewed:  11/30/92</p><p>We're having problems with color patterns using the LaserWriter driver version7.1.2. If we create a 'ppat' resource in ResEdit (32 x 32 bits, in this case)and then do a <code>FillCRect</code> to the port returned by <code>PrOpenDoc</code> (with color set sothat it's a <code>cGrafPort</code>) with the pattern loaded by <code>GetPixPat</code>, we get a weirdpattern. Doing the same to an off-screen <code>GWorld</code> and using <code>CopyBits</code> to copy tothe printer port works fine, if a little slowly. Are we missing somethinghere?</p> <P>You need to use the <code>FillCRect</code> call off-screen rather than directly into theprinter port, for at least two reasons. First, the LaserWriter driver doesn'tsupport filling objects with anything but black-and-white patterns because ituses the PostScript halftone screen functions to draw patterns. Second, theLaserWriter driver doesn't understand (or handle) <code>pixPats</code>. Therefore, your onlyrecourse is the one you discovered--to copy to and from <code>GWorlds</code>. Unfortunately,FillCRect doesn't work with the LaserWriter drivers through version 7.2. Afterversion 7.2 this probably won't be a problem.</p><P><A HREF="#top">Back to top</A></P><h2>Color/Grayscale button on a non-Color QuickDraw Macintosh</h2><P>Date Written:  8/31/92</p><P>Last reviewed:  6/14/93</p><p>The LaserWriter driver displays the Color/Grayscale option even on a non-ColorQuickDraw Macintosh, which seems odd because the option normally causes thedriver to return a <code>cGrafPort</code> to the calling application, and <code>CGrafPorts</code> areonly available under Color QuickDraw. What happens if you're printing originalQuickDraw colors using the LaserWriter driver on a non-Color QuickDraw system?Does the driver just use the Black &amp; White code regardless of whether theColor/Grayscale button is selected?</p> <P>Regardless of whether Color/Grayscale is selected or not, the driver returns a<code>grafPort</code> because it's not running on a Color QuickDraw machine. But, if theColor/Grayscale option is chosen on a Macintosh without Color QuickDraw, thedriver doesn't just use the Black &amp; White code to print. Instead, it sendsthe colors to the printer as best it can without Color QuickDraw. This canresult in three different sets of output when printing classic QuickDrawcolors:</p><ul type="disc">	<li>Black &amp; White button selected (identical output whether the system has Color QuickDraw or not)</li>	<li>Color/Grayscale button selected on Color QuickDraw Macintosh</li>	<li>Color/Grayscale button selected on non-Color QuickDraw Macintosh</li></ul>         <P><A HREF="#top">Back to top</A></P>         <a name=Downloads></A>                 <h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (76K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pr_510.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pr/pr_510.html%3Fid%3DDTS10002646-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pr/pr_510.html%3Fid%3DDTS10002646-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pr/pr_510.html%3Fid%3DDTS10002646-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>