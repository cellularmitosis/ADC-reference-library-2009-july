<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Skinny3DSample - /ValueControls &Alpha;/ValueControls.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Skinny3DSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Skinny3DSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ValueControls &Alpha;/ValueControls.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Skinny3DSources ƒ/3DAppSpecific.c</option>
<option value="listing2.html">/Skinny3DSources ƒ/3DAppSpecific.h</option>
<option value="listing3.html">/Skinny3DSources ƒ/BoxModel.c</option>
<option value="listing4.html">/Skinny3DSources ƒ/BoxModel.h</option>
<option value="listing5.html">/Skinny3DSources ƒ/Cameras.c</option>
<option value="listing6.html">/Skinny3DSources ƒ/Cameras.h</option>
<option value="listing7.html">/Skinny3DSources ƒ/Lights.c</option>
<option value="listing8.html">/Skinny3DSources ƒ/Lights.h</option>
<option value="listing9.html">/Skinny3DSources ƒ/SkinnyMain.c</option>
<option value="listing10.html">/Skinny3DSources ƒ/SkinnyMain.h</option>
<option value="listing11.html">/ValueControls ƒ/ValueControls.c</option>
<option value="listing12.html">/ValueControls ƒ/ValueControls.h</option></select>
				</p>
				</form>
				<p><strong><a href="Skinny3DSample.zip">Download Sample</a></strong> (&#147;Skinny3DSample.zip&#148;, 64.7K)<BR>
<strong><a href="Skinny3DSample.dmg">Download Sample</a></strong> (&#147;Skinny3DSample.dmg&#148;, 127.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">#include &lt;Printing.h&gt;#include &lt;Windows.h&gt;#include &lt;Fonts.h&gt;#include &lt;Devices.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;TextUtils.h&gt;#include &lt;LowMem.h&gt;#include &lt;SegLoad.h&gt;#include &lt;fp.h&gt;#include &quot;ValueControls.h&quot;#define  kVCHeight  12#define kVCWidth  192#define kValuePos  142 // right edge (right flush)#define kDecHitPos  156#define kIncHitPos  172#define kResetWidth  36enum {   kSettingsDlog = 1280};enum {  iVCtitle = 3,  iMinValue,  iMaxValue,  iStepSize,  iCurrentV};// private structuresstruct ValueCtlRec {  Str255    title;  float    initV;  float    currV;  float    mini;  float    maxi;  float    delta;  Point    titlePos;  // absolute window coordinates; initialized from ValueCtlCluster  Point    valuePos;  Rect    wholeRect;  Rect    incrHit;  Rect    decrHit;  long    lastClick;  Boolean    isCheckBox;};typedef struct ValueCtlRec ValueCtlRec, *VcPtr;struct ValueCtlCluster {  OSType    idTag;  Str255    vTitle;  long    howMany;      // 1-based  Rect    frame;        // tries to position controls by itself;                   // may add scrollbars if required, later.  Rect    resetHit;  long    vcHeight;      // height of one ValueCtlRec in pixels  long    maxEntries;      // 1-based  VcPtr    vCtls[1];      // 0-based};typedef struct ValueCtlCluster ValueCtlCluster;static VcPtr  NewValueCtl(Str255 title, float initV, float mini, float maxi, float delta);static void   DrawValueCtl(VcPtr v);static void    IncrementVC(VcPtr v);static void    DecrementVC(VcPtr v);static Boolean   DoSettingsDialog(VcPtr v);// from TextUtils.h:extern pascal StringPtr C2PStr(Ptr cString);extern pascal Ptr P2CStr(StringPtr pString);// from my dialog utilities:void  PutFloat(DialogPtr dlg, short item, float value);float  GetFloat(DialogPtr dlg, short item);//----------------------------------------------------------------------VcPtr  NewValueCtl(Str255 title, float  initV, float mini, float maxi, float delta){  VcPtr  v;  Rect    r;    v = (VcPtr)NewPtr(sizeof(ValueCtlRec));  if (v != nil) {    BlockMove((Ptr)title, (Ptr)v-&gt;title, (long)title[0]+1);    v-&gt;initV = initV;    v-&gt;currV = initV;    v-&gt;mini  = mini;    v-&gt;maxi  = maxi;    v-&gt;delta = delta;    v-&gt;titlePos.h = 4;    v-&gt;titlePos.v = kVCHeight - 2;    v-&gt;valuePos.h = kValuePos;    v-&gt;valuePos.v = kVCHeight - 2;    SetRect(&amp;v-&gt;wholeRect, 0, 0, kVCWidth, kVCHeight);    SetRect(&amp;r, 0, 0, kVCHeight - 2, kVCHeight - 2);    OffsetRect(&amp;r, kDecHitPos, 1);    v-&gt;decrHit  = r;    OffsetRect(&amp;r, kIncHitPos - kDecHitPos, 0);    v-&gt;incrHit  = r;    v-&gt;lastClick = 0;    v-&gt;isCheckBox = ((mini == 0.0) &amp;&amp; (maxi == 1.0) &amp;&amp; (delta == 1.0));  }  return v;}//----------------------------------------------------------------------VccPtr  NewVCluster(long tag, Str255 title, long numEntries, Rect *bounds){  Rect  r = *bounds; // avoid side effects on bounds parameter!  long   size;  VccPtr   vcc;    InsetRect(&amp;r, 4, 4);  r.top += 4;  if ( (numEntries + 1) * kVCHeight &gt; (r.bottom - r.top) )    return nil; // don't have enough space      r.bottom = r.top + numEntries * kVCHeight + 10;  size = sizeof(ValueCtlCluster) + (numEntries - 1) * sizeof(VcPtr);  vcc = (VccPtr)NewPtr(size);  if (vcc != nil) {    vcc-&gt;idTag = tag;    BlockMove((Ptr)title, (Ptr)vcc-&gt;vTitle, (long)title[0] + 1);    vcc-&gt;howMany = 0;    vcc-&gt;frame = r;    vcc-&gt;vcHeight = kVCHeight;    vcc-&gt;maxEntries = numEntries;    SetRect(&amp;r, 0, 0, kResetWidth, kVCHeight - 1);    OffsetRect(&amp;r, vcc-&gt;frame.right - kResetWidth - 6, vcc-&gt;frame.top - 6);    vcc-&gt;resetHit = r;  }  return vcc;}//----------------------------------------------------------------------void AddValueCtl(VccPtr vcc, Str255 title, float initV, float mini, float maxi, float delta){  VcPtr  v;  Point  offset;    if (vcc-&gt;howMany &gt;= vcc-&gt;maxEntries)    return;  v = NewValueCtl(title, initV, mini, maxi, delta);  if (!v)    return;  offset.v = vcc-&gt;frame.top + (vcc-&gt;howMany + 1) * (vcc-&gt;vcHeight) - 6;  offset.h = vcc-&gt;frame.left + 2;  AddPt(offset, &amp;v-&gt;titlePos);  AddPt(offset, &amp;v-&gt;valuePos);  OffsetRect(&amp;v-&gt;wholeRect, offset.h, offset.v);  SectRect(&amp;vcc-&gt;frame, &amp;v-&gt;wholeRect, &amp;v-&gt;wholeRect);  v-&gt;wholeRect.right -= 2;  OffsetRect(&amp;v-&gt;incrHit, offset.h, offset.v);  OffsetRect(&amp;v-&gt;decrHit, offset.h, offset.v);  vcc-&gt;vCtls[vcc-&gt;howMany] = v;  vcc-&gt;howMany++;}//----------------------------------------------------------------------void  AddSeparator(VccPtr vcc){  AddValueCtl(vcc, &quot;\p------------&quot;, 0.0,  0.0,  0.0, 0.0);}//----------------------------------------------------------------------Boolean  TakeHit(Point clickPt, VccPtr vcc){  long     i, ticks;  Rect    r;  Boolean   isDblClick = false;    i = 0;  r = vcc-&gt;resetHit;  if ( PtInRect(clickPt, &amp;r) ) { // an afterthought ...    InvertRect(&amp;r);     do {      vcc-&gt;vCtls[i]-&gt;currV = vcc-&gt;vCtls[i]-&gt;initV;      DrawValueCtl(vcc-&gt;vCtls[i]);    } while (++i &lt; vcc-&gt;howMany);    InvertRect(&amp;r);    return true;  }  // i = 0;    do {    if ((vcc-&gt;vCtls)[i]-&gt;mini &lt; (vcc-&gt;vCtls)[i]-&gt;maxi) {     // take hits only in real control lines      r = (vcc-&gt;vCtls)[i]-&gt;incrHit;      if ( PtInRect(clickPt, &amp;r) ) {        InvertRect(&amp;r);        IncrementVC((vcc-&gt;vCtls)[i]);        goto newValue;      }      r = (vcc-&gt;vCtls)[i]-&gt;decrHit;      if ( PtInRect(clickPt, &amp;r) ) {        InvertRect(&amp;r);        DecrementVC((vcc-&gt;vCtls)[i]);        goto newValue;      }      r = (vcc-&gt;vCtls)[i]-&gt;wholeRect;      if ( PtInRect(clickPt, &amp;r) ) {        ticks = ((vcc-&gt;vCtls)[i])-&gt;lastClick;        isDblClick = (TickCount() - ticks &lt; LMGetDoubleTime());        ((vcc-&gt;vCtls)[i])-&gt;lastClick = TickCount();      }        if ((isDblClick) &amp;&amp; DoSettingsDialog((vcc-&gt;vCtls)[i])) {        DrawValueCtl((vcc-&gt;vCtls)[i]);        return true;      }      else        isDblClick = false;    }  }  while ( (++i &lt; vcc-&gt;howMany) );  return false;  newValue:    Delay(6, &amp;ticks);    InvertRect(&amp;r);    ((vcc-&gt;vCtls)[i])-&gt;lastClick = TickCount();    DrawValueCtl((vcc-&gt;vCtls)[i]);    return true;}//----------------------------------------------------------------------static void  DrawValueCtl(VcPtr v){  Str255    s;  Str255    st = &quot;\ptrue&quot;;  Str255    sf = &quot;\pfalse&quot;;  Rect    r;  long    w;  decimal    d;  decform    df;    EraseRect(&amp;v-&gt;wholeRect);  TextFont(geneva);  TextSize(9);  TextFace(0);  MoveTo(v-&gt;titlePos.h, v-&gt;titlePos.v);  DrawString(v-&gt;title);  if (v-&gt;mini == v-&gt;maxi) // separator    return;      if (v-&gt;isCheckBox) {    if (v-&gt;currV == 1.0)      BlockMove(st, s, st[0]+1);    else      BlockMove(sf, s, sf[0]+1);  }  else {    df.style = FIXEDDECIMAL;    df.digits = 2;    num2dec(&amp;df, v-&gt;currV, &amp;d);    dec2str(&amp;df, &amp;d, (char *)s);    C2PStr((Ptr)s);  }    TextFace(bold);  w = StringWidth(s);  MoveTo(v-&gt;valuePos.h - w, v-&gt;valuePos.v);  DrawString(s);  r = v-&gt;incrHit;  FrameRect(&amp;r);  if (v-&gt;isCheckBox) {    if (v-&gt;currV == 1.0) {      MoveTo(r.left, r.top);      LineTo(r.right - 1, r.bottom - 1);      MoveTo(r.left, r.bottom - 1);      LineTo(r.right - 1, r.top);    }  }  else {    MoveTo( r.left + 2, r.bottom - 2);    DrawChar('+');    r = v-&gt;decrHit;    FrameRect(&amp;r);    MoveTo(r.left + 2, r.bottom - 2);    DrawChar('-');  }}//-----------------------------------static void  IncrementVC(VcPtr v){  if (v-&gt;isCheckBox) {    if (v-&gt;currV == 0.0)      v-&gt;currV = 1.0;    else      v-&gt;currV = 0.0;   }  else {    v-&gt;currV += v-&gt;delta;    if (v-&gt;currV &gt; v-&gt;maxi)      v-&gt;currV = v-&gt;maxi;  }}//-----------------------------------static void  DecrementVC(VcPtr v){  v-&gt;currV -= v-&gt;delta;  if (v-&gt;currV &lt; v-&gt;mini)    v-&gt;currV = v-&gt;mini;}//----------------------------------------------------------------------//--------------------- ValueControlCluster routines -------------------//----------------------------------------------------------------------void  DrawVCluster(VccPtr  vcc){  long   i;  Rect  r;    FrameRect(&amp;vcc-&gt;frame);  MoveTo(vcc-&gt;frame.left + 12, vcc-&gt;frame.top + 3);  TextFont(geneva);  TextSize(9);  TextFace(bold);  TextMode(srcCopy);  DrawChar(' '); DrawString(vcc-&gt;vTitle); DrawChar(' ');  r = vcc-&gt;resetHit;  EraseRect(&amp;r);  FrameRect(&amp;r);  MoveTo(r.left + 3, r.bottom - 2);  TextMode(srcOr);  DrawString(&quot;\pReset&quot;);  for (i = 0; i &lt; vcc-&gt;howMany; i++)    DrawValueCtl(vcc-&gt;vCtls[i]);}//----------------------------------------------------------------------void  DisposeVCluster(VccPtr  vcc){  long i;    for (i = 0; i &lt; vcc-&gt;howMany; i++)    DisposePtr((Ptr)(&amp;vcc-&gt;vCtls[i]));  DisposePtr((Ptr)vcc);}//----------------------------------------------------------------------OSType  GetIdTag(VccPtr  vcc){  return vcc-&gt;idTag;}//----------------------------------------------------------------------float  GetCurrentValue(VccPtr vcc, long index){  if ((index &gt;= 0) &amp;&amp; (index &lt; vcc-&gt;howMany))    return   (vcc-&gt;vCtls[index])-&gt;currV;  else {    SysBeep(10);    return 0;  }}//----------------------------------------------------------------------void  SetResetValue(VccPtr vcc, long index, float value){  if ((index &gt;= 0) &amp;&amp; (index &lt; vcc-&gt;howMany))    (vcc-&gt;vCtls[index])-&gt;initV = value;  else {    SysBeep(10);  }}//----------------------------------------------------------------------//---------------------   SettingsDialog routines   -------------------//----------------------------------------------------------------------static Boolean DoSettingsDialog(VcPtr v){  DialogPtr    dlg;  GrafPtr      savePort;  ModalFilterUPP  filterProc;  OSErr      err;  short      item, kind;  Handle      h;  Rect      r;    GetPort(&amp;savePort);  dlg = GetNewDialog(kSettingsDlog, nil, (WindowPtr)(-1));  if (!dlg)    return false;  SetPort(dlg);    err = GetStdFilterProc(&amp;filterProc);  err = SetDialogDefaultItem(dlg, ok);  err = SetDialogCancelItem(dlg, cancel);  err = SetDialogTracksCursor(dlg, true);  GetDialogItem(dlg, iVCtitle, &amp;kind, &amp;h, &amp;r);  SetDialogItemText(h, v-&gt;title);  PutFloat(dlg, iMinValue, v-&gt;mini);  PutFloat(dlg, iMaxValue, v-&gt;maxi);  PutFloat(dlg, iStepSize, v-&gt;delta);  PutFloat(dlg, iCurrentV, v-&gt;currV);    do {    ModalDialog(filterProc, &amp;item);     switch (item) {     case ok:      // range checks      break;    case iMinValue:     // range check      break;    case iMaxValue:    // range check      break;    case iStepSize:    // range check      break;    case iCurrentV:    // range check      break;    }    if (item == ok) {      v-&gt;mini  = GetFloat(dlg, iMinValue);      v-&gt;maxi  = GetFloat(dlg, iMaxValue);      v-&gt;delta = GetFloat(dlg, iStepSize);      v-&gt;currV = GetFloat(dlg, iCurrentV);    }  } while ((item != cancel) &amp;&amp; (item != ok));    DisposeDialog(dlg);  SetPort(savePort);  return (item == ok);}//----------------------------------------------------------------------void  PutFloat(DialogPtr dlg, short item, float value){  Str255    s;  Handle    h;  Rect    r;  decimal    d;  decform    df;  short    kind;    df.style = FIXEDDECIMAL;  df.digits = 2;  num2dec(&amp;df, value, &amp;d);  dec2str(&amp;df, &amp;d, (char *)s);  C2PStr((Ptr)s);  GetDialogItem(dlg, item, &amp;kind, &amp;h, &amp;r);  SetDialogItemText(h, s);}//----------------------------------------------------------------------float  GetFloat(DialogPtr dlg, short item){  Str255    s;  Handle    h;  Rect    r;  decimal    d;  decform    df;  float    value = 0.0;  short    kind;  short    ix, vp;    GetDialogItem(dlg, item, &amp;kind, &amp;h, &amp;r);  if (h) {    GetDialogItemText(h, s);    P2CStr(s);    ix = 0;    str2dec((char *)s, &amp;ix, &amp;d, &amp;vp);    if (vp)       value = dec2f(&amp;d);  }  return value;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Skinny3DSample/listing11.html%3Fid%3DDTS10000104-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Skinny3DSample/listing11.html%3Fid%3DDTS10000104-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Skinny3DSample/listing11.html%3Fid%3DDTS10000104-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>