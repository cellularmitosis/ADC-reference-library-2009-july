<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>OOPTESample - /UTESample.inc1.p</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">OOPTESample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">OOPTESample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/UTESample.inc1.p</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/FlowCtlMacs.d</option>
<option value="listing2.html">/MTESample.p</option>
<option value="listing3.html">/ProgStrucMacs.d</option>
<option value="listing4.html">/TECommon.h</option>
<option value="listing5.html">/TESample.r</option>
<option value="listing6.html">/TESampleGlue.a</option>
<option value="listing7.html">/UApplication.inc1.p</option>
<option value="listing8.html">/UApplication.p</option>
<option value="listing9.html">/UDocument.inc1.p</option>
<option value="listing10.html">/UDocument.p</option>
<option value="listing11.html">/UTEDocument.inc1.p</option>
<option value="listing12.html">/UTEDocument.p</option>
<option value="listing13.html">/UTESample.inc1.p</option>
<option value="listing14.html">/UTESample.p</option></select>
				</p>
				</form>
				<p><strong><a href="OOPTESample.zip">Download Sample</a></strong> (&#147;OOPTESample.zip&#148;, 62.2K)<BR>
<strong><a href="OOPTESample.dmg">Download Sample</a></strong> (&#147;OOPTESample.dmg&#148;, 121.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">{---------------------------------------------------------------------##  Apple Macintosh Developer Technical Support##  MultiFinder-Aware Simple TextEdit Sample Application##  OOPTESample##  UTESample.inc1.p    -  Pascal Source##  Copyright &copy; 1988, 1989 Apple Computer, Inc.#  All rights reserved.##  Versions:    #          1.00          04/89#          1.10          02/90#          1.11          10/92##  Components:     #          BuildOOPTESample      February 1, 1990#          MTESample.p          February 1, 1990#          OOPTESample.make      February 1, 1990#          TECommon.h          February 1, 1990#          TESampleGlue.a        February 1, 1990#          TESample.r          February 1, 1990#          TMLRules.make        February 1, 1990#          UApplication.p        February 1, 1990#          UApplication.inc1.p      February 1, 1990#          UDocument.p          February 1, 1990#          UDocument.inc1.p      February 1, 1990#          UTEDocument.p        February 1, 1990#          UTEDocument.inc1.p      February 1, 1990#          UTESample.p          February 1, 1990#          UTESample.inc1.p      February 1, 1990#---------------------------------------------------------------------}CONST  rMenuBar  = 128;  rDocWindow  = 128;        { application's window }  rAboutAlert  = 128;        { about alert }  { The following constants are used to identify menus and their items. The menu IDs }  { have an &quot;m&quot; prefix and the item numbers within each menu have an &quot;i&quot; prefix. }  mApple    = 128;        {Apple menu}  iAbout    = 1;  mFile    = 129;        { File menu }  iNew    = 1;  iClose    = 4;  iQuit    = 12;  mEdit    = 130;        { Edit menu }  iUndo    = 1;  iCut    = 3;  iCopy    = 4;  iPaste    = 5;  iClear    = 6;  kMinSize    = 40;  kMaxSleepTime  = 60;  kSleepTime    = $7FFFFFFF;  kExtremePos    = 32767 - 1;  { required for old region bug }  kExtremeNeg    = -32768;    {kExtremePos and kExtremeNeg are used to set up                  wide open rectangles and regions.}  kMaxOpenDocuments    = 1;  {kMaxOpenDocuments is used to determine whether                  a new document can be opened or created. We keep                  track of the number of open documents, and disable                  the menu items that create a new document when the                  maximum is reached. If the number of documents falls                  below the maximum, the items are enabled again.}(********************************************************************************************)(*    T T E S a m p l e                                  *)(********************************************************************************************){$S Initialize}{-----------------------------------+|  ITESample            |+-----------------------------------}PROCEDURE TTESample.ITESample;VAR  menuBar: Handle;BEGIN  IApplication;    { Read menus into menubar }  menuBar := GetNewMBar(rMenuBar);    { Install menus }  SetMenuBar(menuBar);  DisposeHandle(menuBar);    { Add DA names to Apple menu }  AppendResMenu(GetMenuHandle(mApple),'DRVR');  DrawMenuBar;    { Create empty mouse region }  fMouseRgn := NewRgn;    { Create a single empty document }  DoNew;    {Make sure we have a valid cursor region }  AdjustCursor;END;{$S Main}{-----------------------------------+|  DoIdle              |+-----------------------------------}{ This is called whenever we get a NULL event et al. }{ It takes care of necessary periodic actions. For this program, }{ it calls the DoIdle method of the current document. }PROCEDURE TTESample.DoIdle; OVERRIDE;VAR  fTECurDoc: TTEDocument;BEGIN  fTECurdoc := TTEDocument(fCurDoc);  IF fTECurDoc &lt;&gt; NIL THEN    fTECurDoc.DoIdle;END;{$S Main}{-----------------------------------+|  AdjustMenus            |+-----------------------------------}{ Enable and disable menus based on the current state. The }{ user can only select enabled menu items. We set up all the }{ menu items before calling MenuSelect or MenuKey, since }{ these are the only times that a menu item can be selected. }{ Note that MenuSelect is also the only time the user will }{ see menu items. This approach to deciding what enable/ }{ disable state a menu item has the advantage of }{ concentrating all the decision-making in one routine, as }{ opposed to being spread throughout the application. Other }{ application designs may take a different approach that may }{ or may not be as valid.  }PROCEDURE TTESample.AdjustMenus; OVERRIDE;VAR  frontMost:  WindowPtr;  menu:    MenuHandle;  offset:    longint;  undo:    Boolean;  cutCopyClear:  Boolean;  paste:    Boolean;  fTECurDoc:  TTEDocument;BEGIN  fTECurdoc := TTEDocument(fCurDoc);  frontMost := FrontWindow;    menu := GetMenuHandle(mFile);  IF (fDocList.NumDocs &lt; kMaxOpenDocuments) THEN    EnableItem(menu,iNew)  ELSE    DisableItem(menu,iNew);  IF (frontMost &lt;&gt; NIL) THEN    EnableItem(menu,iClose)  ELSE    DisableItem(menu,iClose);      menu := GetMenuHandle(mEdit);  undo := FALSE;  cutCopyClear := FALSE;  paste := FALSE;  IF (frontMost &lt;&gt; NIL) THEN     IF (fTECurDoc = NIL) THEN BEGIN    { all editing is enabled for DA windows }      undo := TRUE;      cutCopyClear := TRUE;      paste := TRUE;    END ELSE BEGIN      { Cut, Copy, and Clear is enabled for app. windows with selections  }      IF fTECurDoc.HaveSelection THEN        cutCopyClear := TRUE;      { If we have any TEXT in the scrap, enable paste }      IF GetScrap(NIL, 'TEXT', offset) &gt; 0 THEN        paste := TRUE;     END;    IF undo THEN    EnableItem(menu,iUndo)  ELSE    DisableItem(menu,iUndo);  IF cutCopyClear THEN BEGIN    EnableItem(menu,iCut);    EnableItem(menu,iCopy);    EnableItem(menu,iClear);  END ELSE BEGIN    DisableItem(menu,iCut);    DisableItem(menu,iCopy);    DisableItem(menu,iClear);  END;  IF paste THEN    EnableItem(menu,iPaste)  ELSE    DisableItem(menu,iPaste);END;{$S Main}{-----------------------------------+|  AdjustCursor          |+-----------------------------------}{ Change the cursor's shape, depending on its position. This also calculates a }{ region that includes the cursor for WaitNextEvent. }PROCEDURE TTESample.AdjustCursor; OVERRIDE;VAR  fTECurDoc:  TTEDocument;  arrowRgn,  iBeamRgn:  RgnHandle;  mouse:    Point;BEGIN  fTECurdoc := TTEDocument(fCurDoc);    { Notice that we don't change the cursor if front window isn't ours }  IF (NOT(fInBackGround) AND (fTECurDoc &lt;&gt; NIL)) THEN BEGIN      GetMouse(mouse);    LocalToGlobal(mouse);        arrowRgn := NewRgn;    iBeamRgn := NewRgn;        SetRectRgn(arrowRgn,kExtremeNeg, kExtremeNeg, kExtremePos, kExtremePos);        fTECurDoc.GetVisTERgn(iBeamRgn);        DiffRgn(arrowRgn,iBeamRgn,arrowRgn);        IF PtInRgn(mouse,iBeamRgn) THEN BEGIN      SetCursor(GetCursor(iBeamCursor)^^);      CopyRgn(iBeamRgn,fMouseRgn);    END ELSE BEGIN      SetCursor(qd.arrow);      CopyRgn(arrowRgn,fMouseRgn);    END;    DisposeRgn(arrowRgn);    DisposeRgn(iBeamRgn);  END;END;{$S Main}{-----------------------------------+|  DoMenuCommand          |+-----------------------------------}{ This is called when an item is chosen from the menu bar (after calling }{ MenuSelect or MenuKey). It does the right thing for each command. }PROCEDURE TTESample.DoMenuCommand(menuID,menuItem: integer); OVERRIDE;VAR  itemHit:  integer;  daName:    Str255;  daRefNum:  integer;  window:    WindowPtr;  fTECurDoc: TTEDocument;BEGIN  fTECurdoc := TTEDocument(fCurDoc);  window := FrontWindow;    CASE menuID OF    mApple:      CASE menuItem OF        iAbout:          { bring up alert for About  }          itemHit := Alert(rAboutAlert, NIL);        OTHERWISE BEGIN      { all non-About items in this menu are DAs et al  }          GetMenuItemText(GetMenuHandle(mApple), menuItem, daName);          daRefNum := OpenDeskAcc(daName);        END; { OTHERWISE }      END; { CASE menuItem }    mFile:      CASE menuItem OF        iNew:          DoNew;        iClose:          BEGIN            IF fTECurDoc &lt;&gt; NIL THEN BEGIN              fDocList.RemoveDoc(fTECurDoc);              fTECurDoc.Free;            END ELSE BEGIN              CloseDeskAcc(WindowPeek(fWhichWindow)^.windowKind);            END;                        { make sure our current document/window references are valid }            window := FrontWindow;            IF window &lt;&gt; NIL THEN BEGIN              fCurDoc := fDocList.FindDoc(window);              SetPort(window);            END ELSE BEGIN              fCurDoc := NIL;            END;          END;        iQuit:          Terminate;      END; { CASE menuItem }    mEdit:          { call SystemEdit for DA editing &amp; MultiFinder  }      IF NOT SystemEdit(menuItem-1) THEN         CASE menuItem OF          iCut:  fTECurDoc.DoCut;          iCopy:  fTECurDoc.DoCopy;          iPaste:  fTECurDoc.DoPaste;          iClear:  fTECurDoc.DoClear;        END; { CASE menuItem }  END;  HiliteMenu(0);END; { doMenuCommand }{$S Main}{-----------------------------------+|  HeapNeeded            |+-----------------------------------}FUNCTION TTESample.HeapNeeded: Longint; OVERRIDE;BEGIN  HeapNeeded := kMinSize * 1024;END;{$S Main}{-----------------------------------+|  SleepVal            |+-----------------------------------}{ Calculate a sleep value for WaitNextEvent. This takes into account the things }{ that DoIdle does with Idle Time. The formula used here is:   IF we are in the foreground  AND our document window is in front  THEN    SleepVal := whatever the front document says it should be  ELSE    SleepVal := aRealLongTime      After that, SleepVal is clipped to kMaxSleepTime which is currently set  to 60 ticks. This is to account for a Notification Manager bug wherein  notifications don't occur while the front application is asleep. }FUNCTION TTESample.SleepVal: LongInt; OVERRIDE;VAR  sleep: longint;  fTECurDoc: TTEDocument;BEGIN  sleep := kSleepTime;  fTECurdoc := TTEDocument(fCurDoc);  IF ((NOT fInBackGround) AND (fTECurdoc &lt;&gt; NIL)) THEN BEGIN    sleep := fTECurDoc.CalcIdle;  END;  IF sleep &gt; kMaxSleepTime THEN    sleep := kMaxSleepTime;  SleepVal := sleep;END;{$S Initialize}{-----------------------------------+|  DoNew              |+-----------------------------------}{ Create a new document and window.  }PROCEDURE TTESample.DoNew;VAR  tDoc:  TTEDocument;BEGIN  New(tdoc);  tDoc.ITEDocument(rDocWindow);    IF tdoc &lt;&gt; NIL THEN    fdocList.Adddoc(tdoc);END;{$S Main}{-----------------------------------+|  Terminate            |+-----------------------------------}{ Clean up the application and exits. We close all of the windows so that }{ they can update their documents. }PROCEDURE TTESample.Terminate;BEGIN  { FIX: close all docs }  ExitLoop;END;</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/OOPTESample/listing13.html%3Fid%3DDTS10000278-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/OOPTESample/listing13.html%3Fid%3DDTS10000278-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/OOPTESample/listing13.html%3Fid%3DDTS10000278-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>