<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating a Menu(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING98></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-97.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-99.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-89.html"><B>Chapter 3 - Menu Manager</B></A> / <A HREF="Toolbox-97.html"><B>Using the Menu Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING98-0></A>
<H2><A NAME=MARKER-9-222></A>Creating a Menu</H2>
 <A NAME=MARKER-2-223></A>You use various Menu Manager routines to set up the menus and the menu bar <BR>for your application. You can use any of these methods to create pull-down menus for <BR>your application: <A NAME=MARKER-2-47></A><P>
<UL>
<LI>You can create descriptions of your application's menus in <CODE>'MENU'</CODE> resources and describe your application's menu bar in an <CODE>'MBAR'</CODE> resource. You use the <CODE>GetNewMBar</CODE> function to read in descriptions of your menu bar and menus and create a new menu list, use the <CODE>SetMenuBar</CODE> procedure to set the current menu list to your application's menu list, and use the <CODE>DrawMenuBar</CODE> procedure to update the menu bar. 
<LI>You can create descriptions of your application's menus in <CODE>'MENU'</CODE> resources, read them in using <CODE>GetMenu</CODE>, add them to the current menu list using <CODE>InsertMenu</CODE>, and update the menu bar using <CODE>DrawMenuBar</CODE>.
<LI>You can use <CODE>NewMenu</CODE> to create new empty menus; use <CODE>AppendMenu</CODE>, <CODE>InsertMenuItem</CODE>, <CODE>InsertResMenu</CODE>, or <CODE>AppendResMenu</CODE> to fill the menus with menu items; add the menus to the current menu list using <CODE>InsertMenu</CODE>; and update the menu bar using <CODE>DrawMenuBar</CODE>.<P>
</UL>
 Whenever possible you should define your menus in menu (<CODE>'MENU'</CODE>) resources and your menu bar in a menu bar (<CODE>'MBAR'</CODE>) resource to make your application easier <BR>to localize.<A NAME=MARKER-2-226></A><P>
 To create a hierarchical menu, you need to create descriptions of the submenu and the menu to which the submenu is attached. Usually you create the description of both menus in <CODE>'MENU'</CODE> resources. You typically read in the description of the hierarchical menu using <CODE>GetNewMBar</CODE> (if you also provide an <CODE>'MBAR'</CODE> resource). To read in the description of the submenu and insert it in the current menu list, use the <CODE>GetMenu</CODE> function and <CODE>InsertMenu</CODE> procedure.<P>
 To create a pop-up menu, create descriptions of the pop-up menu and its menu items, create a control that uses the pop-up control definition function, and associate the control with a window or dialog box. You can display and manage the pop-up menu using the Dialog Manager or Control Manager routines.<P>
 Once the Menu Manager creates a menu for your application, if necessary you can add additional menu items to the menu using <CODE>AppendMenu</CODE>, <CODE>InsertMenuItem</CODE>, <CODE>InsertResMenu</CODE>, or <CODE>AppendResMenu</CODE>. You can use various Menu Manager routines to change the appearance of menu items.<P>
 The next sections describe how to create <CODE>'MENU'</CODE> and <CODE>'MBAR'</CODE> resources. <A HREF=Toolbox-99.html#MARKER-9-270>"Creating a Hierarchical Menu" on page 3-55</A> describes how to create a menu that has a submenu, and <A HREF=Toolbox-100.html#MARKER-9-282>"Creating a Pop-Up Menu" on page 3-58</A> describes how to create pop-up menus.<P>
<A NAME=HEADING98-10></A>
<H3><A NAME=MARKER-9-227></A><A NAME=MARKER-21-228></A>Creating a Menu Resource</H3>
 Usually you should define your menus in menu<DFN> (<CODE>'MENU'</CODE></DFN>) resources so that you can easily localize the menu titles and menu items for other languages, cultures, or regions. A <CODE>'MENU'</CODE> resource defines the menu title of a menu and the characteristics of menu items in a menu. <A HREF=#MARKER-9-231>Listing 3-1</A> shows a sample <CODE>'MENU'</CODE> resource in Rez format for an application's Apple menu. (Rez is a resource compiler available with MPW. You can also define menus using a resource utility, such as ResEdit, available from APDA.)<A NAME=MARKER-2-229></A><A NAME=MARKER-2-230></A><P>
<B>Listing 3-1  <A NAME=MARKER-9-231></A>Rez input for a <CODE>'MENU'</CODE> resource for the Apple menu </B><P>
<PRE>
#define mApple 128
resource 'MENU' (mApple, preload) { /*resource ID, preload resource*/
      mApple,                       /*menu ID*/ 
      textMenuProc,                 /*uses standard menu definition */ 
                                    /* procedure*/
      0b1111111111111111111111111111101,  /*enable About item, */
                                          /* disable divider, */
                                          /* enable all other items*/
      enabled,                      /*enable menu title*/
       apple,                       /*menu title*/
      {
                                    /*first menu item*/
            &quot;About SurfWriter...&quot;,       /*text of menu item */
                                       /* (includes ellipsis)*/
                                       /*item characteristics follow*/
                  noicon,              /*icon number (if any) or */
                                       /* script code (if any)*/
                  nokey,               /*keyboard equivalent (if any) */
                                       /* or submenu (if any) or */
                                       /* small or reduced icon (if any)*/
                  nomark,              /*marking character (if any) or */
                                       /* menu ID of submenu (if any)*/
                  plain;               /*style of menu item text*/
                                    /*second menu item*/
            &quot;-&quot;,                       /*item text (divider)*/
                  noicon, nokey, nomark, plain  /*item characteristics*/
      }
};
</PRE>
 You should also define help balloons for each of your application's menu items and each menu title when you create your menus. (<A HREF=Toolbox-93.html#MARKER-9-174>Figure 3-21 on page 3-35</A> shows help balloons for an application's Cut command.) You define the help balloons for your application's menus in <CODE>'hmmu'</CODE> resources. See the chapter "Help Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I> for examples of how to create <CODE>'hmmu'</CODE> resources<A NAME=MARKER-2-232></A>.<P>
 <A HREF=#MARKER-9-231>Listing 3-1</A> defines the resource ID of the Apple menu as 128. You can use any number equal to or greater than 128 as a resource ID for a menu. By convention, many applications use 128 as the resource ID of the first menu in the application's menu bar (the Apple menu) and use sequential numbers for the resource IDs of following menus.<A NAME=MARKER-2-189></A><P>
 <A HREF=#MARKER-9-231>Listing 3-1</A> also defines the menu ID of the Apple menu as 128. Once your application creates the menu, the Menu Manager uses the defined menu ID to refer to this menu. The number you define for the menu ID of a menu does not have to match the resource ID of the menu, but it is usually more convenient to use the same number. You can use any number greater than 0 for the menu ID of a pull-down or pop-up menu; submenus of an application can only use menu IDs from 1 through 235; submenus of a desk accessory must use menu IDs from 236 through 255. <A NAME=MARKER-2-235></A><P>
 The listing specifies that this menu uses the standard menu definition procedure. If you choose to create your own menu definition procedure, list its resource ID instead of the <CODE>textMenuProc</CODE> constant. <P>
 After the resource ID of the menu definition procedure is a 32-bit number (expressed as <BR>a 31-bit field followed by a <CODE>Boolean</CODE> field), where bits 1-31 indicate if the correspond- ing menu item is disabled or enabled, and bit 0 indicates whether the menu is enabled <BR>or disabled.<P>
 The listing specifies in the 31-bit field that the first menu item should be enabled, that the second menu item should be disabled, and that the following menu items (item numbers 3 through 31) should be enabled when the menu is first created. After creating a menu, your application can enable or disable menu items using the <CODE>EnableItem</CODE> or <CODE>DisableItem</CODE> procedure. If a menu contains more than 31 items, the Menu Manager automatically enables all items following the 31st item when the menu is enabled. Your application cannot disable any individual items following the 31st item. However, you can disable all items, including items after the 31st item, by disabling the entire menu.<P>
 <A HREF=#MARKER-9-231>Listing 3-1</A> specifies that the menu title should be enabled when it is first created. <BR>Your application can also disable or enable the menu title using the <CODE>DisableItem</CODE> or <CODE>EnableItem</CODE> procedure. When you disable a menu using the <CODE>DisableItem</CODE> procedure, the Menu Manager disables all menu items in the menu (including any items following the 31st item) and dims the title of the menu.<P>
 <A NAME=MARKER-2-236></A>The resource listing identifies the title of the menu using the constant <CODE>apple</CODE>. If you specify the <CODE>apple</CODE> constant as the title, the Menu Manager uses a small Apple icon as the title of the menu. The Menu Manager uses a color Apple icon if the monitor is set to display colors. The listing then defines the characteristics of each menu item in the menu. For each menu item, you need to define the text and any other characteristics of the menu item. For example, <A HREF=#MARKER-9-231>Listing 3-1</A> defines the first item in the Apple menu as the About command; note that the text of this menu item specifies three ellipsis points (...). Specify three ellipsis points following the text of a menu command if your application displays a dialog box requesting information from the user before performing the command. In general, you should not use ellipses if your application displays a confirmation alert after the user chooses a menu command; the About command is an exception to this guideline.<A NAME=MARKER-2-237></A><A NAME=MARKER-9-319></A><P>
 <A HREF=#MARKER-9-231>Listing 3-1</A> defines other characteristics of the About command--it doesn't have an <BR>icon to the left of the menu item text, it doesn't have a keyboard equivalent, it doesn't have any mark to the left of the menu item text, and the font style of the menu item <BR>text is plain. <P>
 By specifying various combinations of values in the icon field and keyboard equivalent field, you can define an icon (normal, small, reduced, or color), a keyboard equivalent, a submenu, or the script code of a menu item. Note that some characteristics are mutually exclusive (for example, an item can have a keyboard equivalent or submenu, but not both), as described in the following paragraphs. <A HREF=#MARKER-9-239>Table 3-6 on page 3-48</A> summarizes how the Menu Manager interprets these item characteristics.<P>
<B>Table 3-6  <A NAME=MARKER-9-239></A><B>Table 3-6 Specifying submenus, script codes, reduced icons, small icons, and color icons of a menu item in a menu resource</B>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Keyboard equivalent field<TH>Icon field<TH>Marking character field<TH>Description<TR>
<TD>$1B<TD>&nbsp;<TD>Menu ID of submenu<TD>Indicates the item has a submenu. The marking character field specifies the <BR>menu ID of the submenu.<TR>
<TD>$1C<TD>Script code of item text<TD>&nbsp;<TD>Indicates the item text uses the script defined by the script code specified in the icon field.<TR>
<TD>$1D<TD>Icon number of <CODE>'ICON'</CODE>resource<TD>&nbsp;<TD>Indicates the item has an icon defined by an <CODE>'ICON'</CODE> resource and that it should be reduced to fit in a 16-by-16 bit rectangle.<TR>
<TD>$1E<TD>Icon number <BR>of <CODE>'SICN' </CODE>resource<TD>&nbsp;<TD>Indicates the item has an icon defined by an <CODE>'SICN'</CODE> resource. <TR>
<TD>$00 or &gt;$20<TD>Icon number of <CODE>'ICON'</CODE> or <CODE>'cicn'</CODE> resource<TD>&nbsp;<TD>Indicates the item has an icon defined <BR>by an <CODE>'ICON'</CODE> or a <CODE>'cicn'</CODE>resource. <BR>(A value greater than $20 in the <BR>keyboard equivalent field specifies the item's keyboard equivalent.)</TABLE>
</B><P>
 To assign an icon to a menu item, specify an icon number in place of the <CODE>noicon</CODE> constant. The icon number you specify should be a number from 1 through 255 (or from 1 through 254 for small icons and reduced icons); add 256 to your icon number and use the result for the resource ID of the color icon (<CODE>'cicn'</CODE>) resource, icon (<CODE>'ICON'</CODE>) resource, or small icon (<CODE>'SICN'</CODE>) resource that describes the icons for the menu item. You must define the icon for a menu item in a <CODE>'cicn'</CODE>,<DFN> an <CODE>'ICON', </CODE></DFN>or<DFN> an <CODE>'SICN'</CODE></DFN> resource; the Menu Manager<DFN> uses only these types of resources </DFN>for icons you define for your menu items. The Menu Manager first looks for a <CODE>'cicn'</CODE> resource with the calculated resource ID and uses that icon if it finds it. If it doesn't find a <CODE>'cicn'</CODE> resource (or if the computer doesn't have Color QuickDraw) and the keyboard equivalent field specifies $1E, the Menu Manager looks for an <CODE>'SICN'</CODE> resource with the calculated resource ID. Otherwise, the Menu Manager looks for an <CODE>'ICON'</CODE> resource and plots it in a 32-by-32 bit rectangle, unless the keyboard equivalent field contains $1D. If the keyboard equivalent field contains $1D, the Menu Manager reduces the icon to fit in a 16-by-16 <BR>bit rectangle.<P>
 If you provide an <CODE>'ICON'</CODE> resource and specify the <CODE>nokey</CODE> constant or a value greater than $20 as the keyboard equivalent, the Menu Manager enlarges the rectangle of the entire menu item to fit the 32-by-32 bit<DFN> <CODE>'ICON'</CODE></DFN> resource. If you specify a value of $1D as the keyboard equivalent of the menu item, the Menu Manager reduces the <CODE>'ICON'</CODE> resource to fit in a 16-by-16 bit rectangle. If you provide an <CODE>'SICN'</CODE> resource and specify a value of $1E as the keyboard equivalent of a menu item, the Menu Manager plots the small icon in a 16-by-16 bit rectangle. If you provide a <CODE>'cicn'</CODE> resource, the Menu Manager automatically enlarges the enclosing rectangle of the menu item according to the rectangle specified in the <CODE>'cicn'</CODE> resource. (For the Apple and Application menus, the Menu Manager automatically reduces the icon to fit within the enclosing rectangle of a menu item or uses the appropriate icon from the application's icon family, such as an <CODE>'ics8'</CODE> resource, if one is available.) See the chapter "Finder Interface" in this book for details on how to create icons for your application.<P>
 To assign a keyboard equivalent to a menu item, specify the 1-byte character that the user types in addition to the Command key in place of the <CODE>nokey</CODE> constant in your resource definition for the menu item. If your application attaches a submenu to a menu item, then specify the <CODE>hierarchicalMenu</CODE> constant in place of the <CODE>nokey</CODE> constant. A menu item can have either a keyboard equivalent or submenu defined for it, but not both. To indicate that a menu item has an icon that is defined in an <CODE>'SICN'</CODE> resource, specify $1E in place of the <CODE>nokey</CODE> constant. To indicate that a menu item has an icon that is defined in an <CODE>'ICON'</CODE> resource and that the Menu Manager should reduce this icon to a 16-by-16 bit rectangle, specify $1D in place of the <CODE>nokey</CODE> constant. Menu items that have small icons or reduced icons cannot have keyboard equivalents.<A NAME=MARKER-2-243></A><A NAME=MARKER-2-144></A><P>
 To set the script code of a menu item's text, specify $1C in place of the <CODE>nokey</CODE> constant and define the desired script code in place of the <CODE>noicon</CODE> constant. If an item contains $1C in its keyboard equivalent field and a script code in its icon field, the Menu Manager draws the item's text in the script identified by the script code value if the corresponding script system is installed. If you do not specify a script code for a menu item, the Menu Manager displays the menu item's text in the system font of the current system script. For Roman scripts, the system font is Chicago and the system font size is 12.<A NAME=MARKER-2-166></A><P>
 To assign a mark that appears to the left of the menu item text and to the left of any <BR>icon, specify the marking character in place of the <CODE>nomark</CODE> constant in your resource definition. If the menu item has a submenu, then specify the menu ID of the submenu in place of the <CODE>nomark</CODE> constant. Submenus of an application must use menu IDs from <BR>1 through 235; submenus of a desk accessory must use menu IDs from 236 through 255. Note that defining the menu ID of a submenu in a <CODE>'MENU'</CODE> resource does not attach the submenu to its menu. You must use the <CODE>GetMenu</CODE> function and <CODE>InsertMenu</CODE> procedure to do this. <A HREF=Toolbox-99.html#MARKER-9-270>"Creating a Hierarchical Menu,"</A> which begins on <A HREF=Toolbox-99.html#MARKER-9-270>page 3-55</A>, gives information on attaching a submenu to its menu.<P>
 To assign a font style to a menu item, in your <CODE>'MENU'</CODE> resource use the constants <CODE>bold</CODE>, <CODE>italic</CODE>, <CODE>plain</CODE>, <CODE>outline</CODE>, and <CODE>shadow</CODE> to get their corresponding styles. <A NAME=MARKER-2-247></A><A NAME=MARKER-2-248></A><P>
 <A HREF=#MARKER-9-231>Listing 3-1</A> defines the second menu item as a divider. When you use a hyphen as the first character in the string that defines the text of a menu item, the Menu Manager creates a divider that extends across the entire width of the menu item. You cannot assign any other characteristics to a divider.<P>
 The <CODE>'MENU'</CODE> resource for the Apple menu does not list any other menu items. Use the <CODE>AppendResMenu</CODE> procedure to add the desktop items to the Apple menu after your application creates the menu. See <A HREF=Toolbox-102.html#MARKER-9-363>"Adding Items to the Apple Menu" on page 3-70</A> for more information.<P>
 Once you create a menu, you can append additional items to it using the <CODE>AppendMenu</CODE>, <CODE>InsertMenuItem</CODE>, <CODE>InsertResMenu</CODE>, or <CODE>AppendResMenu</CODE> procedure. You can also change the characteristics of individual menu items using Menu Manager routines. See <A HREF=Toolbox-101.html#MARKER-9-289>"Changing the Appearance of Items in a Menu" on page 3-59</A> for more information.<P>
 <A HREF=Toolbox-93.html#MARKER-9-148>Figure 3-12 on page 3-30</A> shows a typical Edit menu for an application. <A HREF=#MARKER-9-251>Listing 3-2</A> shows a <CODE>'MENU'</CODE> resource for this Edit menu.<A NAME=MARKER-2-250></A><P>
<B>Listing 3-2  <A NAME=MARKER-9-251></A>Rez input for a <CODE>'MENU'</CODE> resource for an Edit menu</B><P>
<PRE>
#define mEdit 130
resource 'MENU' (mEdit, preload) {     /*resource ID, preload resource*/
   mEdit,                              /*menu ID*/
   textMenuProc,                       /*uses standard menu definition */ 
                                       /* procedure*/
   0b0000000000000000001001000000000,  /*enable/disable first 31 menu */
                                       /* items as appropriate*/
   enabled,                            /*enable title*/
   &quot;Edit&quot;,                             /*text of menu title*/
    {                                  /*menu items*/
   &quot;Undo&quot;,  noicon, &quot;Z&quot;,   nomark, plain; /*keyboard equivalent Command-Z*/
   &quot;-&quot;,     noicon, nokey, nomark, plain;
   &quot;Cut&quot;,   noicon, &quot;X&quot;,   nomark, plain; /*keyboard equivalent Command-X*/
   &quot;Copy&quot;,  noicon, &quot;C&quot;,   nomark, plain; /*keyboard equivalent Command-C*/
   &quot;Paste&quot;, noicon, &quot;V&quot;,   nomark, plain; /*keyboard equivalent Command-V*/
   &quot;Clear&quot;, noicon, nokey, nomark, plain; 
   &quot;Select All&quot;,
            noicon, &quot;A&quot;,   nomark, plain; /*keyboard equivalent Command-A*/
   &quot;-&quot;,     noicon, nokey, nomark, plain;
   &quot;Create Publisher...&quot;,
            noicon, nokey, nomark, plain;
   &quot;Subscribe To...&quot;,
            noicon, nokey, nomark, plain;
   &quot;Publisher Options...&quot;,
            noicon, nokey, nomark, plain;
   &quot;-&quot;,     noicon, nokey, nomark, plain;
   &quot;Show Clipboard&quot;,
            noicon, nokey, nomark, plain 
      }
};
</PRE>
 <A HREF=#MARKER-9-251>Listing 3-2</A> defines the resource ID of the Edit menu as 130, defines the menu ID of the Edit menu as 130, and specifies that this menu uses the standard menu definition procedure. The listing defines the initial enabled state of the first 31 menu items and <BR>also specifies that the menu title should be enabled when it is first created. <P>
 The resource listing defines the title of the menu, Edit. It then defines the characteristics of each menu item in the menu. For each menu item, you need to specify the text of the menu item and any other characteristics of the menu item. For example, <A HREF=#MARKER-9-251>Listing 3-2</A> defines the first item in the Edit menu as the Undo command with these characteristics: there is no icon to the left of the menu item text, the menu item has a keyboard equivalent of Command-Z, it does not have any mark to the left of the menu item text, and the style of the menu item text is plain. The listing defines the second menu item as a divider line. It defines the Cut, Copy, and Paste commands; specifies keyboard equivalents for each of them; and defines the rest of the items in the menu.<P>
 <A HREF=#MARKER-9-252>Listing 3-3</A> shows another example of a resource description of a menu, the File menu of a typical application.<P>
<B>Listing 3-3  <A NAME=MARKER-9-252></A>Rez input for a <CODE>'MENU'</CODE> resource for a File menu</B><P>
<PRE>
resource 'MENU' (mFile, preload) {  
      mFile, textMenuProc,          
      0b0000000000000000000010000000000,  
      enabled, 
      &quot;File&quot;,                       
      {                                      
         &quot;New&quot;,         noicon, &quot;N&quot;,   nomark, plain; 
         &quot;Open...&quot;,       noicon, &quot;O&quot;,   nomark, plain; 
         &quot;-&quot;,           noicon, nokey, nomark, plain; 
         &quot;Close&quot;,       noicon, &quot;W&quot;,   nomark, plain; 
         &quot;Save&quot;,        noicon, &quot;S&quot;,   nomark, plain; 
         &quot;Save As...&quot;,    noicon, nokey, nomark, plain; 
         &quot;-&quot;,           noicon, nokey, nomark, plain; 
         &quot;Page Setup...&quot;, noicon, nokey, nomark, plain; 
         &quot;Print...&quot;,      noicon, &quot;P&quot;,   nomark, plain; 
         &quot;-&quot;,           noicon, nokey, nomark, plain;
         &quot;Quit&quot;,        noicon, &quot;Q&quot;,   nomark, plain  
      }
};
</PRE>
<A NAME=HEADING98-43></A>
<H3><A NAME=MARKER-9-253></A><A NAME=MARKER-21-254></A>Creating a Menu Bar Resource</H3>
 <A NAME=MARKER-2-385></A>You typically define your application's menu bar using a menu bar (<CODE>'MBAR'</CODE>) resource. <A HREF=#MARKER-9-256>Listing 3-4</A> shows an <CODE>'MBAR'</CODE> resource, in Rez format, for a sample application. <P>
<B>Listing 3-4  <A NAME=MARKER-9-256></A>Rez input for an <CODE>'MBAR'</CODE> resource</B><P>
<PRE>
#define rMenuBar     128
#define mApple       128
#define mFile        129
#define mEdit        130
resource 'MBAR' (rMenuBar, preload) {/*resource ID, preload*/
   /*menus appear in the order listed here*/
   { mApple, mFile, mEdit };        /*resource IDs for menus in */
                                    /* this menu bar*/
};
</PRE>
 <A HREF=#MARKER-9-256>Listing 3-4</A> defines the <CODE>'MBAR'</CODE> resource with resource ID 128. This <CODE>'MBAR'</CODE> resource defines the order and resource IDs of the menus contained in it; it defines its first <BR>three menus as the menus with resource IDs 128, 129, and 130. The Menu Manager <BR>uses the assigned resource IDs to read in the menus when it creates a menu bar from <BR>an <CODE>'MBAR'</CODE> resource.<A NAME=MARKER-2-257></A><P>
<A NAME=HEADING98-49></A>
<H3>Setting Up Your Application's Menu Bar</H3>
 <A NAME=MARKER-2-319></A>To create a menu list as defined in an <CODE>'MBAR'</CODE> resource, use the <CODE>GetNewMBar</CODE> function. For each menu defined by the <CODE>'MBAR'</CODE> resource, the <CODE>GetNewMBar</CODE> function creates a menu record for the menu, creates each menu according to its resource definition in its corresponding <CODE>'MENU'</CODE> resource, and inserts each menu into the new menu list. The <CODE>GetNewMBar</CODE> function returns a handle to the created menu list. For example, this code creates a menu list for the menu bar defined by the <CODE>'MBAR'</CODE> resource with resource ID 128 (defined by the constant <CODE>rMenuBar</CODE>):<P>
<PRE>
CONST
   rMenuBar = 128;
VAR
   menuBar:    Handle;
menuBar := GetNewMBar(rMenuBar); {read menus and menu bar }
                                  { descriptions,create &amp; return }
                                  { a handle to a new menu list}
</PRE>
 <A NAME=MARKER-2-491></A>Use the <CODE>SetMenuBar</CODE> procedure to set the current menu list to the menu list created <BR>by your application and the <CODE>DrawMenuBar</CODE> procedure to update the menu bar's appearance. For example, <A HREF=#MARKER-9-260>Listing 3-5</A> uses these two routines to set up the application's menu bar.<P>
<B>Listing 3-5  <A NAME=MARKER-9-260></A>Setting up an application's menus and menu bar<A NAME=MARKER-2-19></A></B><P>
<PRE>
PROCEDURE MyMakeMenus;   
VAR
   menuBar:                Handle;
 BEGIN                  
{first use the GetNewMBar function to read menus in &amp; create a }
{ new menu list. If you define an Apple menu, the Menu Manager }
{ inserts the Help and Application menus (and Keyboard menu if }
{ necessary) into the newly created menu list}
   menuBar := GetNewMBar(rMenuBar);    
   IF menuBar = NIL THEN
      EXIT(MyMakeMenus);
   SetMenuBar(menuBar); {insert menus into the current menu list}
   DisposHandle(menuBar);
                        {add desktop items in Apple Menu Items }
                        { folder to Apple menu}
   AppendResMenu(GetMenuHandle(mApple), 'DRVR');
   MyAdjustMenus;       {adjust items and enabled state of menus}
   DrawMenuBar;         {draw the menu bar}
 END;
</PRE>
 The code in <A HREF=#MARKER-9-260>Listing 3-5</A> creates the application's menu bar by reading in the definition from the <CODE>'MBAR'</CODE> resource with resource ID 128, and it uses <CODE>SetMenuBar</CODE> to set the current menu list to the newly created menu list. The code then adds the desktop <BR>items in the Apple Menu Items folder to the Apple menu using the <CODE>AppendResMenu</CODE> procedure. <A NAME=MARKER-2-156></A><A NAME=MARKER-9-322></A><P>
 You can use the <CODE>GetMenuHandle</CODE> function to get a handle to the menu record of <BR>any menu in the current menu list. You supply the menu ID of the desired menu as a parameter to <CODE>GetMenuHandle</CODE>, and <CODE>GetMenuHandle</CODE> returns a handle to the menu's menu record. Most Menu Manager routines require either a menu ID or a handle to <BR>a menu record as a parameter.<P>
 After creating the menu bar and adding any other menus or items as necessary, the code calls the <CODE>MyAdjustMenus</CODE> procedure to adjust the application's menus--for example, this procedure sets the enabled and disabled states of menu items in accordance with the current state of the application. (<A HREF=Toolbox-103.html#MARKER-9-399>Listing 3-19 on page 3-76</A> shows the application-defined <CODE>MyAdjustMenus</CODE> procedure used in <A HREF=#MARKER-9-260>Listing 3-5</A>.)  After adjusting the menus, the code in <A HREF=#MARKER-9-260>Listing 3-5</A> uses <CODE>DrawMenuBar</CODE> to draw the menus in the menu bar according to their current enabled state and as they are defined in the current menu list. <A NAME=MARKER-2-495></A><P>
 Usually you'll define the menus of your application and its menu bar using <CODE>'MENU'</CODE> resources and an <CODE>'MBAR'</CODE> resource and using the <CODE>GetNewMBar</CODE> function to read the resource definitions. However, you can choose to read in a <CODE>'MENU'</CODE> resource using the <CODE>GetMenu</CODE> function or to create a new empty menu using <CODE>NewMenu</CODE>. You can then insert <BR>a menu into the current menu list using the <CODE>InsertMenu</CODE> procedure. See <A HREF=Toolbox-116.html#MARKER-9-499>"Creating Menus" on page 3-105</A> and <A HREF=Toolbox-119.html#MARKER-9-508>"Adding Menus to and Removing Menus From the Current Menu List" on page 3-108</A> for information on forming your menus using these routines.<P>
 If your application uses a submenu, you need to use the <CODE>GetMenu</CODE> function and <CODE>InsertMenu</CODE> procedure to make these menus available to your application. See <A HREF=Toolbox-99.html#MARKER-9-270>"Creating a Hierarchical Menu" on page 3-55</A> for information on creating submenus. <BR>If your application uses a pop-up menu, you can use the pop-up control definition function and Dialog Manager or Control Manager routines to create and display <BR>the pop-up menu. See <A HREF=Toolbox-100.html#MARKER-9-282>"Creating a Pop-Up Menu" on page 3-58</A> for information on creating pop-up menus.<P>
 The Menu Manager creates and initializes your application's menu color information table when your application calls <CODE>GetNewMBar</CODE>. You can add entries to your application's menu color information table if you want to use colors other than the default colors in your menus and menu bar. You can add entries to this table by providing menu color information table (<CODE>'mctb'</CODE>) resources or by using the <CODE>SetMCEntries</CODE> procedure. Usually you should use the default colors to help maintain <BR>a consistent user interface.<A NAME=MARKER-2-268></A><P>
 If you add menu color entries to your application's menu color information table and your application uses more than one menu bar, you need to save a copy of your application's menu color information table before changing menu bars. Use the <CODE>GetMCInfo</CODE> function before calling <CODE>GetNewMBar</CODE> and call <CODE>SetMCInfo</CODE> afterward to restore the menu color information table. <A HREF=#MARKER-9-268>Listing 3-6</A> shows a routine that saves and <BR>then restores the menu color information table when creating a new menu bar. <A NAME=MARKER-2-496></A><P>
<B>Listing 3-6  <A NAME=MARKER-9-268></A>Saving and restoring menu color information<A NAME=MARKER-2-571></A></B><P>
<PRE>
PROCEDURE MyChangeMenuBarAndSaveColorInfo; 
CONST
   rMenuBar2 = 129;
VAR
   menu:                MenuHandle;
   menuBar:             Handle;
   currentMCTable:      MCTableHandle;
   newMCTable:          MCTableHandle;
 BEGIN
   currentMCTable := GetMCInfo;     {save menu color info table}
   IF currentMCTable = NIL THEN
      EXIT(MyChangeMenuBarAndSaveColorInfo);
   menuBar := GetNewMBar(rMenuBar2);{read menus in &amp; create new menu list}
   IF menuBar = NIL THEN
      EXIT(MyChangeMenuBarAndSaveColorInfo);
   newMCTable := GetMCInfo;         {get new menu color info table} 
   IF newMCTable = NIL THEN
      EXIT(MyChangeMenuBarAndSaveColorInfo);
   SetMCInfo(currentMCTable);       {restore previous menu color info table}
   SetMenuBar(menuBar);             {insert menus into the current menu list}
   DisposHandle(menuBar);
   AppendResMenu(GetMenuHandle(m2Apple), 'DRVR'); {add desktop items from }
                                    { Apple Menu Items folder to Apple menu}
   MyAdjustMenus;                         {adjust menu items}
   DrawMenuBar;                           {draw the menu bar}
 END; 
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-97.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-99.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
