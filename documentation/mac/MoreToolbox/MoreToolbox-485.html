<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using the Desktop Manager (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING485></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-484.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-486.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-483.html"><B>Chapter 9 - Desktop Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING485-0></A>
<H1><A NAME=MARKER-21-84></A>Using the Desktop Manager</H1>
 You can manipulate the desktop database with a set of low-level routines that follow the parameter-block conventions used by the File Manager. The desktop database functions use a desktop parameter block (see <A HREF=MoreToolbox-488.html#MARKER-9-89>page 9-7</A> for the structure of the desktop parameter block).<P>
 Because you cannot use the Desktop Manager functions on a disk that does not have a desktop database, call <CODE>PBHGetVolParms</CODE> to verify that the target disk has a desktop database before calling any of the Desktop Manager functions. (For a description of the <CODE>PBHGetVolParms</CODE> function and the <CODE>bHasDesktopMgr</CODE> bit that you should check, see the chapter "File Manager" in <I><A HREF="../Files/Files-2.html">Inside Macintosh: Files</A></I>.)<P>
 Because the Finder uses the desktop database, the database is almost always open. When the Desktop Manager opens the database, it assigns the database a reference number that represents the access path. You use the <CODE>PBDTGetPath</CODE> function to get the reference number, which you must specify when calling most other Desktop Manager functions. If the desktop database is not open, <CODE>PBDTGetPath</CODE> opens it.<A NAME=MARKER-2-85></A><A NAME=MARKER-2-86></A><P>
 If you are manipulating the database in the absence of the Finder, you can open the database with <CODE>PBDTOpenInform</CODE>, which performs the same functions as <CODE>PBDTGetPath</CODE> and also sets a flag to tell your application whether the desktop database was empty when it was opened. Your application should never close the database.<P>
 The Desktop Manager provides different functions for manipulating different kinds of information in the database. Not all manipulations are possible with all kinds of data.<P>
 You can retrieve five kinds of information from the database:<A NAME=MARKER-2-87></A><P>
<UL>
<LI>icon definitions
<LI>file types and icon types supported by a known creator
<LI>name and location of applications with a known creator
<LI>user comments for a file or a directory
<LI>size and parent directory of the desktop database <P>
</UL>
 To retrieve an icon definition, call <CODE>PBDTGetIcon</CODE>. You must specify a file creator, file type, and icon type. The database recognizes both large and small icons, with 1, 4, or 8 bits of color encoding. (For a description of these icons, see the chapter "Finder Interface" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>.)<P>
 To step through a list of all the icon types supported by an application, make repeated calls to <CODE>PBDTGetIconInfo</CODE>. Each time you call <CODE>PBDTGetIconInfo</CODE>, you specify a creator and an index value. Set the index to 1 on the first call, and increment it on each subsequent call until <CODE>PBDTGetIconInfo</CODE> returns the result code <CODE>afpItemNotFound</CODE>. For each entry in the icon list, <CODE>PBDTGetIconInfo</CODE> reports the icon type, the file type it is associated with, and the size of its icon data.<P>
 To identify the application that can open a file with a given creator, call <CODE>PBDTGetAPPL</CODE>. In each call to <CODE>PBDTGetAPPL</CODE>, you specify a creator (which is the application's signature) and an index value. An index value of 0 retrieves the "first choice" application--that is, the one with the most recent creation date. By setting the index to 1 on the first call and incrementing it on each subsequent call until <CODE>PBDTGetAPPL</CODE> returns the result code <CODE>afpItemNotFound</CODE>, you can make multiple calls to <CODE>PBDTGetAPPL</CODE> to find information about all copies or versions of the application with this signature on the disk. <CODE>PBDTGetAPPL</CODE> returns them all in arbitrary order. <CODE>PBDTGetAPPL</CODE> returns the name, parent directory ID, and creation date of each application in the desktop database.<P>
 To retrieve the user comments for a file or directory, call <CODE>PBDTGetComment</CODE>. The user can change comments at any time by typing in the comment box of the information window for any desktop object.<P>
 Your application should not ordinarily call the functions for adding and removing data to and from the database. If your application does need to write to or delete information from the desktop database, it must call <CODE>PBDTFlush</CODE> to update the copy stored on the volume.<P>
 The following list summarizes the data manipulation functions:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Kind of data<TH>Read<TH>Write<TH>Remove<TR>
<TD>Icon definitions (for a given file type and creator)<TD>PBDTGetIcon<TD>PBDTAddIcon<TD>--<TR>
<TD>Icon types (associated with each file type that an application supports)<TD>PBDTGetIconInfo<TD>--<TD>--<TR>
<TD>Applications with a given creator<TD>PBDTGetAPPL<TD>PBDTAddAPPL<TD>PBDTRemoveAPPL<TR>
<TD>User comments<TD>PBDTGetComment<TD>PBDTSetComment<TD>PBDTRemoveComment<TR>
<TD>Entire desktop database<TD><CODE>PBDTGetInfo</CODE> (returns the size and parent directory of the database)<TD><CODE>PBDTFlush</CODE> (updates the copy stored on the volume)<TD><CODE>PBDTDelete</CODE> and <CODE>PBDTReset</CODE> (neither should be called by your application)</TABLE>
<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-484.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-486.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
