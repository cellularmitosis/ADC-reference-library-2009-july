<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Enterprise Objects Programming Guide: Saving Data</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Saving Data"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001011-CH208" title="Saving Data"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../About/About.html#//apple_ref/doc/uid/TP30001011-CH201-DontLinkElementID_1">WebObjects Enterprise Objects Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Managing/Managing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../UpdateStrategies/UpdateStrategies.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_144" title="Saving Data"></a><h1><a name="//apple_ref/doc/uid/TP30001011-CH208-TP1" title="Saving Data"></a>Saving Data</h1><p>This chapter discusses the mechanics of saving data within the Enterprise Objects frameworks. </p><p>It is divided into the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADIACBC">“Objects Involved in Saving”</a></span> introduces the objects involved in saving data in an Enterprise Objects application.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADCEFIF">“Flow of Data During a Save”</a></span> discusses the flow of data during a save.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADHCCEE">“Phases of Saving”</a></span> discusses the mechanisms Enterprise Objects uses to ensure data integrity while saving.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF151">“Key Generation”</a></span> discusses how key generation works in Enterprise Objects.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF150">“Common Delegate Usage”</a></span> discusses common delegates used in the save process.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF153">“Generating Custom Primary Keys”</a></span> teaches you how to generate custom primary keys.</p></li><li class="li"><p><span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADJEBIB">“Using Compound Primary Keys”</a></span> discusses what you need to do to use compound primary keys.</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH208-BADIACBC" title="Objects Involved in Saving"></a><h2>Objects Involved in Saving</h2><p>There are many objects involved in saving data in an Enterprise Objects application. The objects you’ll most commonly work with are introduced here.</p><dl class="termdef">	<dt>EOEditingContext<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_592"></a></dt><dd><p>In Enterprise Objects, saves to the database most often originate with a <code>saveChanges</code><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_593"></a> invocation on an editing context.</p></dd><dt>EOObjectStoreCoordinator<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_594"></a></dt><dd><p>This object is responsible for figuring out which data source corresponds to the changes in a particular editing context. A given editing context can contain enterprise objects that are constituted from various data sources, so the object store coordinator manages the logistics of identifying these data sources when saving.</p></dd><dt>EOCooperatingObjectStore<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_595"></a></dt><dd><p>Each cooperating object store in an application is responsible for transmitting to its data source the changes handed to it by the object store coordinator. A cooperating object store (which is most often an instance of EODatabaseContext) is an abstract representation of a data source.</p></dd></dl><p>Other objects are involved in saving data, such as EODatabaseContext and EOAdaptorChannel, but you rarely need to interact with these objects programmatically.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-BADHCCEE" title="Phases of Saving"></a><h2>Phases of Saving</h2><p>The following phases are involved in pushing data back to a database:</p><ul class="ul"><li class="li"><p><strong>Validation.<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_596"></a></strong> The first phase of committing data to a database is validating the data. A large part of your application’s business logic involves validation—verifying that customers don’t exceed their credit limits, that test scores fall within an allowable range, that phone numbers contain only numbers, and so on. In your enterprise object classes, you implement methods that perform validation at different points in an application, such as when users attempt to save, delete, update, or perform other operations on a record.</p><p>By validating data in your enterprise object classes, you have an early opportunity to catch invalid data before it is committed to the database. Validation in enterprise object classes, however, is only a piece of the data integrity puzzle.</p></li><li class="li"><p><strong>Referential integrity<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_597"></a> enforcement.</strong> Another part of the data integrity puzzle is relationship-level referential integrity rules that specify the parameters of relationships between entities. Like validation rules, referential integrity rules often reflect your custom business logic. In the context of the Enterprise Objects stack, referential integrity enforcement occurs at a lower level in the access layer<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_598"></a>. You define referential integrity rules in an application’s data model.</p><p>Enterprise Objects supports the following referential integrity rules: ownership, optionality, delete rule, and propagate primary key.</p></li><li class="li"><p><strong>Key generation.<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_599"></a><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_600"></a><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_601"></a></strong> When you use Enterprise Objects, you usually don’t have to worry about database artifacts such as primary and foreign key values. Primary and foreign keys are rarely meaningful parts of a business model; rather they’re used within a database to express relationships between tables. For example, the primary key of a LISTING table (LISTING_ID) doesn’t have any meaning to users as they identify property listings by address.</p><p>Most database application-development environments force you to worry about primary and foreign key generation. Part of the Enterprise Objects philosophy is that this is a task that the technology should take care of for you—your time as a developer is better spent focusing on business logic and building great applications, not on managing database key generation.</p><p>Enterprise Objects manages primary and foreign key data for you. Your enterprise object classes don’t have knowledge of primary and foreign keys and you don’t have to worry about generating or propagating primary key values when adding records to a database.</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH208-BADCEFIF" title="Flow of Data During a Save"></a><h2>Flow of Data During a Save</h2><p>A save operation begins with the invocation of <code>saveChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_602"></a></code> on an editing context. If you programmatically create and manage editing contexts, you explicitly invoke this method. However, <code>saveChanges</code> is commonly invoked automatically by elements of an Enterprise Objects application such as display groups.</p><p><span class="content_text">Figure 8-1</span> provides a high-level overview of the save process.</p><br/><div><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_145" title="Figure 7-1Flow of data during a save"></a><p><a name="//apple_ref/doc/uid/TP30001011-CH208-TPXREF157" title="Figure 7-1Flow of data during a save"></a><strong>Figure 7-1&nbsp;&nbsp;</strong>Flow of data during a save</p><img src = "../Art/flowofsave.gif" alt = "Flow of data during a save" width="464" height="404"></div><br/><p>Once a save is initiated, the following sequence occurs to retrieve data from a data source:</p><ol class="ol"><li class="li"><p>When <code>saveChanges</code><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_603"></a> is invoked on an editing context, that editing context invokes the method <code>editingContextWillSaveChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_604"></a></code> on its editors and delegates.</p></li><li class="li"><p>The editing context processes, propagates, and validates changes for deleting.</p></li><li class="li"><p>The editing context processes and validates changes for saving.</p></li><li class="li"><p>The editing context commits the changes made to its objects to its parent object store by invoking the method <code>saveChangesInEditingContext<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_605"></a></code> on its parent. For nonnested editing contexts, the parent is typically an instance of EOObjectStoreCoordinator<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_606"></a>. When an object store coordinator receives this invocation, it guides its cooperating object stores through a multipass save protocol in which each cooperating store saves its own changes and forwards remaining changes to other cooperating stores.</p></li><li class="li"><p>After it receives the invocation of <code>saveChangesInEditingContext</code>, the object store coordinator invokes the method <code>prepareForSaveWithCoordinator<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_607"></a></code> on each of its cooperating object stores. This informs each object store that a multipass save operation is beginning. When the object store is an EODatabaseContext<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_608"></a> (which is the most common case), it initiates the process of generating primary keys for any new objects in the editing context on which <code>saveChanges</code> was invoked.</p></li><li class="li"><p>The object store coordinator then invokes the method <code>recordChangesInEditingContext<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_609"></a></code> on each of its cooperating object stores. This prompts each of those stores to examine the changed objects in the editing context, record any operations that need to be performed, and notify the coordinator of any changes that need to be forwarded to other cooperating stores.</p><p>For example, if in its <code>recordChangesInEditingContext</code> method, a cooperating object store notices the removal of an object from an owning relationship but that object belongs to another cooperating store, it informs the other store by invoking <code>forwardUpdateForObject<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_610"></a></code> on the object store coordinator.</p></li><li class="li"><p>The object store coordinator invokes the method <code>performChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_611"></a></code> on each of its cooperating object stores. This tells the stores to transmit their changes to their underlying databases. When the cooperating store is an EODatabaseContext, it responds to this invocation by constructing a list of adaptor operations based on the list of database operations that were determined in the last step. It then forwards this list of adaptor operations on to an available EOAdaptorChannel to be executed.</p></li><li class="li"><p>If <code>performChanges</code> fails for any of the cooperating object stores, the method <code>rollbackChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_612"></a></code> is invoked on all the cooperating object stores in that access-layer stack.</p></li><li class="li"><p>If <code>performChanges</code> succeeds for all of the cooperating object stores, the method <code>commitChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_613"></a></code> is invoked on all of them, which tells the adaptor to commit its changes.</p></li><li class="li"><p>If <code>commitChanges</code><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_614"></a> fails for a particular cooperating store, the method <code>rollbackChanges<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_615"></a></code> is invoked on that store and on all subsequent stores. However, the stores that have already committed their changes do not roll back. <em>In other words, the object store coordinator doesn’t perform the two-phase commit necessary to guarantee consistent distributed updates.</em><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_616"></a></p></li><li class="li"><p>If the save operation is successful, the database contexts of the editing context from which the save operation originated update their snapshots.</p></li><li class="li"><p>Finally, if the save operation is successful, the editing context posts the notification EditingContextDidSaveChangesNotification.</p></li></ol><a name="//apple_ref/doc/uid/TP30001011-CH208-TPXREF151" title="Key Generation"></a><h2>Key Generation</h2><p>One of the best<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_617"></a> features of Enterprise Objects is its ability to manage primary and foreign keys for you. It does this in part by providing a mechanism to automatically generate primary keys without requiring you to write any code. To take advantage of Enterprise Object’s automatic primary-key generation, an entity’s primary key must satisfy these guidelines:</p><ul class="ul"><li class="li"><p>It must be a simple integer; the adaptor cannot generate keys for noninteger data types.</p></li><li class="li"><p>It cannot be compound.</p></li></ul><p>Automatic primary-key generation in Enterprise Objects works differently depending on the database, but you usually don’t need to be concerned with the details. With some databases such as OpenBase and MySQL, Enterprise Objects maintains a table in the database (<code>EO_PK_TABLE</code><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_618"></a>) to help it maintain a linear sequence of nonrepeating primary keys. With an Oracle database, Enterprise Objects doesn’t need this table and instead uses Oracle sequences to generate primary keys.</p><p>The advantage of using Enterprise Object’s automatic primary-key generation is that it is easy to use and makes your life as a developer much simpler. However, there are some disadvantages and limitations, including these:</p><ul class="ul"><li class="li"><p>It is database-specific.</p></li><li class="li"><p>It requires a roundtrip to the database; however, key generation is batched, so even when inserting hundreds of objects at once, key generation is inexpensive.</p></li><li class="li"><p>It cannot generate compound primary keys.</p></li><li class="li"><p>It doesn’t work if the database includes rows that are inserted by non-Enterprise Objects applications.</p></li></ul><p>Fortunately, Enterprise Objects provides a number of hooks so you can provide primary key values. If an enterprise object or its snapshot already has a value for its primary key (which is the case for enterprise objects formed from preexisting data or for enterprise objects for which you set the primary key value explicitly in the enterprise object class), none of the key generation mechanisms are invoked. However, if this is not the case, the key generation mechanisms are given the opportunity to provide keys in this order:</p><ol class="ol"><li class="li"><p>If you implement a delegate for EODatabaseContext and the delegate implements the method <code>databaseContextNewPrimaryKey</code><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_619"></a> and if that method returns a value other than <code>null</code>, the keys it generates are used. An implementation of this feature is discussed in <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF153">“Generating Custom Primary Keys.”</a></span></p></li><li class="li"><p>If you provide to an entity the name of a stored procedure to use during Get PK operations (the operation type <code>EOEntity.NextPrimaryKeyProcedureOperation</code>), that stored procedure is invoked to generate a primary key. See the chapter “Working With Entities” in <em><a href="../../UsingEOModeler/index.html#//apple_ref/doc/uid/TP30001018" target="_top">EOModeler User Guide</a></em> to learn about automatic stored procedure invocation.</p></li><li class="li"><p>If an entity’s primary key’s data type is binary and it conforms to <code>EOTemporaryGlobalID.UniqueBinaryKeyLength</code>, Enterprise Objects automatically generates a primary key. This is discussed in <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADIFDCI">“Using Binary Keys.”</a></span></p></li><li class="li"><p>The adaptor automatically generates a primary key for an object whose entity has a noncompound, simple integer primary key.</p></li></ol><p>If the first mechanism fails to provide a primary key, the second mechanism is used. This continues through the last mechanism; if it fails to provide a primary key, an exception is thrown. </p><p>In the case of an entity that is the destination of a relationship that propagates primary key, the destination entity is assigned a primary key immediately after its source entity is assigned a key. So for destination entities in a relationship that propagates primary key, the key generation mechanisms in the list above are not invoked for that entity (though they may be invoked for the source entity).</p><p>See <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF153">“Generating Custom Primary Keys”</a></span> and <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-BADJEBIB">“Using Compound Primary Keys”</a></span> for sample implementations of custom key generation.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-TPXREF150" title="Common Delegate Usage"></a><h2>Common Delegate Usage</h2><div class="notebox"><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_146" title="Note"></a><p><strong>Note:</strong>&nbsp;This section is intended for experts.</p></div><p>A number of control points are provided that let you customize save operations in Enterprise Objects applications. <span class="content_text">Table 8-1</span> lists the delegate methods in EOEditingContext that you can use to customize save operations in the control layer, and <span class="content_text">Table 8-2</span> lists the delegate methods in EODatabaseContext that you can use to customize save operations in the access layer<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_620"></a>. </p><p>You can set the delegate for each object by invoking the class method <code>setDefaultDelegate</code>.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_147" title="Table 7-1EOEditingContext delegate methods"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30001011-CH208-BADHGFAB" title="Table 7-1EOEditingContext delegate methods"></a><strong>Table 7-1&nbsp;&nbsp;</strong>EOEditingContext delegate methods</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Method</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>editingContextShouldValidateChanges</code></p></td><td ><p>This method is invoked when an EOEditingContext receives a <code>saveChanges</code> invocation. If this delegate method returns <code>false</code>, changes are saved without first performing validation. You can use this method to provide your own validation mechanism.</p></td></tr><tr><td  scope="row"><p><code>editingContextWillSaveChanges</code></p></td><td ><p>This method is invoked when an EOEditingContext receives a <code>saveChanges</code> invocation. You can use this delegate method to perform custom validation before saving.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_148" title="Table 7-2EODatabaseContext delegate methods"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30001011-CH208-BADIAEHF" title="Table 7-2EODatabaseContext delegate methods"></a><strong>Table 7-2&nbsp;&nbsp;</strong>EODatabaseContext delegate methods</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Method</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>databaseContextWillOrderAdaptorOperations</code></p></td><td ><p>This method is invoked when an EODatabaseContext receives a <code>performChanges</code> invocation. You can use this delegate method to construct custom adaptor operations, such as transforming a delete operation into an update operation or into a stored procedure operation.</p></td></tr><tr><td  scope="row"><p><code>databaseContextWillPerformAdaptorOperations</code></p></td><td ><p>This method is invoked within the <code>performChanges</code> method in EODatabaseContext. You can use this delegate method to provide custom ordering of adaptor operations to, for example, avoid violating any referential integrity constraints that are enforced by the database.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001011-CH208-TPXREF153" title="Generating Custom Primary Keys"></a><h2>Generating Custom Primary Keys</h2><p>There are many reasons why you may want to or need to generate custom primary keys in an Enterprise Objects application. They are discussed in <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF151">“Key Generation.”</a></span> The following sections provide sample implementations of two of the custom-key generation mechanisms, using the EODatabaseContext delegate and using the automatic key generation for binary primary keys.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-TPXREF156" title="Using a Delegate"></a><h3>Using a Delegate</h3><p>The EODatabaseContext class provides a delegate in which you can generate custom primary keys. This is especially useful if an entity has a compound primary key, but it is also useful if your application can’t use Enterprise Object’s automatic key generation for simple integer primary keys.</p><p>You can set the delegate by invoking <code>EODatabaseContext.setDefaultDelegate(this)</code> in the class in which you implement the delegate method. An implementation of <code>databaseContextNewPrimaryKey<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_621"></a></code> is shown in <span class="content_text">Listing 8-1</span>.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_149" title="Listing 7-1databaseContextNewPrimaryKey implementation"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001011-CH208-BADBCDFD" title="Listing 7-1databaseContextNewPrimaryKey implementation"></a><strong>Listing 7-1&nbsp;&nbsp;</strong><code>databaseContextNewPrimaryKey</code> implementation</p><div class="codesample"><table><tr><td scope="row"><pre>public NSDictionary databaseContextNewPrimaryKey(EODatabaseContext dbCtxt, Object object, EOEntity entity) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray rawRows = EOUtilities.rawRowsForSQL(new EOEditingContext(), "PKTester",          "SELECT MAX(FOO_PK) FROM FOO");<span></span></pre></td></tr><tr><td scope="row"><pre>        NSDictionary rowWithPK = (NSDictionary)rawRows.objectAtIndex(0);<span></span></pre></td></tr><tr><td scope="row"><pre>        Object maxPK = rowWithPK.objectForKey("FOO_PK");<span></span></pre></td></tr><tr><td scope="row"><pre>        int pk = (new Integer(maxPK.toString())).intValue();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableDictionary newPrimaryKey = new NSMutableDictionary();<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray entityPrimaryKeys = entity.primaryKeyAttributeNames();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Enumeration primaryKeyEnumerator = entityPrimaryKeys.objectEnumerator();<span></span></pre></td></tr><tr><td scope="row"><pre>        while (primaryKeyEnumerator.hasMoreElements()) {<span></span></pre></td></tr><tr><td scope="row"><pre>            String pkName = (String)primaryKeyEnumerator.nextElement();<span></span></pre></td></tr><tr><td scope="row"><pre>            newPrimaryKey.takeValueForKey(new Integer(++pk), pkName);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return newPrimaryKey;<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div>	<p>The method in <span class="content_text">Listing 8-1</span> returns a dictionary of key-value pairs; the keys are the names of the entity’s primary key attributes (which are returned by the method <code>EOEntity.primaryKeyAttributeNames</code>) and the values are the values you generate in the method for each of those attributes. </p><p>In <span class="content_text">Listing 8-1</span>, a SQL expression is sent to the database to determine the highest value for the entity’s primary key, <code>FOO_PK</code>. That value is stored in the <code>pk</code> variable, which is incremented in the <code>while</code> loop to generate a unique primary key.</p><a name="//apple_ref/doc/uid/TP30001011-CH208-BADIFDCI" title="Using Binary Keys"></a><h3>Using Binary Keys</h3><p>Enterprise Objects provides another useful mechanism to generate primary keys. It generates a binary<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_622"></a> primary key if a primary key meets these criteria:</p><ul class="spaceabove"><li class="li"><p>Its external data type is a “raw bytes” data type, such as Oracle <code>RAW</code> and OpenBase <code>binary</code>.</p></li><li class="li"><p>Its internal data type is NSData.</p></li><li class="li"><p>Its internal data type width is 24 bytes.</p></li></ul><p>The binary primary key generated in this case is a globally unique key based on an enterprise object’s EOTemporaryGlobalID. Generating primary keys this way has these advantages:</p><ul class="spaceabove"><li class="li"><p>It doesn’t require a round trip to the database.</p></li><li class="li"><p>It is not database dependent.</p></li><li class="li"><p>The generated keys are globally unique.</p></li></ul><p>Binary primary keys have the following characteristics, which can be considered disadvantages:</p><ul class="spaceabove"><li class="li"><p>The generated keys are quite large.</p></li><li class="li"><p>Comparing keys requires more computing resources.</p></li><li class="li"><p>Binary keys can’t be part of a compound primary key.</p></li></ul><a name="//apple_ref/doc/uid/TP30001011-CH208-BADJEBIB" title="Using Compound Primary Keys"></a><h2>Using Compound Primary Keys</h2><p>Enterprise Objects supports tables that have compound<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_623"></a> primary keys. In EOModeler, you identify the attributes that are a part of the compound primary key by making those attributes primary keys (so the key icon is present in an attribute’s row). All of Enterprise Objects internal mechanisms that rely on primary keys (such as global ID creation) work just as well with compound primary keys as with simple primary keys. However, you cannot use a compound primary key and Enterprise Object’s automatic primary-key generation. You have to provide a primary key another way. </p><p>The easiest way to generate primary keys for compound primary keys is with the delegate method <code>databaseContextNewPrimaryKey</code>. The implementation of this method in <span class="content_text"><a href="Saving.html#//apple_ref/doc/uid/TP30001011-CH208-TPXREF153">“Generating Custom Primary Keys”</a></span> supports a compound primary key. It retrieves all of an entity’s primary keys and generates a unique value for each one.</p><p>Note that methods in Enterprise Objects that return primary key values usually return an NSDictionary<a name="//apple_ref/doc/uid/TP30001011-CH208-DontLinkElementID_624"></a> object. This is to support the case in which a primary key is compound. Each key of the dictionary is the name of an attribute that is part of the compound key.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Managing/Managing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../UpdateStrategies/UpdateStrategies.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Enterprise_Objects/Saving/Saving.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Enterprise_Objects/Saving/Saving.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Enterprise_Objects/Saving/Saving.html%3Fid%3DTP30001011-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>