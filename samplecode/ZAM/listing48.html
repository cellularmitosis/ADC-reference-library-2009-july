<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ZAM - /GameSource/xthing.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGames-date.html">Games</a> &gt; <A HREF="javascript:location.replace('index.html');">ZAM</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Games/index.html" target="_blank">Reference Library > Games</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ZAM</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/GameSource/xthing.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/CoreHeaders/CoreGlobals.h</option>
<option value="listing2.html">/CoreHeaders/EventLoop.h</option>
<option value="listing3.html">/CoreHeaders/MenuDispatch.h</option>
<option value="listing4.html">/CoreHeaders/WindowDispatch.h</option>
<option value="listing5.html">/CoreSource/AdjustMenus.c</option>
<option value="listing6.html">/CoreSource/AEventCoreDisp.c</option>
<option value="listing7.html">/CoreSource/Document.c</option>
<option value="listing8.html">/CoreSource/ErrMsg.c</option>
<option value="listing9.html">/CoreSource/EventLoop.c</option>
<option value="listing10.html">/CoreSource/GetBackTime.c</option>
<option value="listing11.html">/CoreSource/InitMac.c</option>
<option value="listing12.html">/CoreSource/Main.c</option>
<option value="listing13.html">/CoreSource/MenuDispatch.c</option>
<option value="listing14.html">/CoreSource/WindowDispatch.c</option>
<option value="listing15.html">/Dude #includes.c</option>
<option value="listing16.html">/GameHeaders/Document.h</option>
<option value="listing17.html">/GameHeaders/FixGraf.h</option>
<option value="listing18.html">/GameHeaders/GameAEvents.h</option>
<option value="listing19.html">/GameHeaders/GameDef.h</option>
<option value="listing20.html">/GameHeaders/GameSounds.h</option>
<option value="listing21.html">/GameHeaders/MissileSprite.h</option>
<option value="listing22.html">/GameHeaders/Sprite.h</option>
<option value="listing23.html">/GameHeaders/SpriteFrameRates.h</option>
<option value="listing24.html">/GameHeaders/TankSprite.h</option>
<option value="listing25.html">/GameHeaders/xqueue.h</option>
<option value="listing26.html">/GameHeaders/xthing.h</option>
<option value="listing27.html">/GameHeaders/ZAM.h</option>
<option value="listing28.html">/GameSource/DirectionTable.c</option>
<option value="listing29.html">/GameSource/ExplosionSprites.c</option>
<option value="listing30.html">/GameSource/FixGraf.c</option>
<option value="listing31.html">/GameSource/GameAEvents.c</option>
<option value="listing32.html">/GameSource/GameMenu.c</option>
<option value="listing33.html">/GameSource/GameSounds.c</option>
<option value="listing34.html">/GameSource/IncidentalSounds.c</option>
<option value="listing35.html">/GameSource/InitGame.c</option>
<option value="listing36.html">/GameSource/MissileAEvents.c</option>
<option value="listing37.html">/GameSource/MissileSprite.c</option>
<option value="listing38.html">/GameSource/pixiZAM - direct blitter/pixiZAM.c</option>
<option value="listing39.html">/GameSource/pixiZAM - direct blitter/pixiZAM.h</option>
<option value="listing40.html">/GameSource/SlamPixels.c</option>
<option value="listing41.html">/GameSource/Sprite.c</option>
<option value="listing42.html">/GameSource/Sprite.proto.h</option>
<option value="listing43.html">/GameSource/SpriteColission.c</option>
<option value="listing44.html">/GameSource/SpriteFrameSet.c</option>
<option value="listing45.html">/GameSource/SpriteLayer.c</option>
<option value="listing46.html">/GameSource/TankSprite.c</option>
<option value="listing47.html">/GameSource/xqueue.c</option>
<option value="listing48.html">/GameSource/xthing.c</option>
<option value="listing49.html">/GameSource/ZAMProtos.h</option>
<option value="listing50.html">/UtilCode/CoreAssertion.c</option>
<option value="listing51.html">/UtilCode/CoreAssertion.h</option>
<option value="listing52.html">/UtilCode/DialogUtil.c</option>
<option value="listing53.html">/UtilCode/GrafUtils.c</option>
<option value="listing54.html">/UtilCode/GrafUtils.h</option>
<option value="listing55.html">/UtilCode/GWorldUtils.c</option>
<option value="listing56.html">/UtilCode/GWorldUtils.h</option>
<option value="listing57.html">/UtilCode/IsPressed.c</option>
<option value="listing58.html">/UtilCode/WindowUtil.c</option></select>
				</p>
				</form>
				<p><strong><a href="ZAM.zip">Download Sample</a></strong> (&#147;ZAM.zip&#148;, 73.3K)<BR>
<strong><a href="ZAM.dmg">Download Sample</a></strong> (&#147;ZAM.dmg&#148;, 125.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  xthing  ------  A little set of routines that allow you to stuff  tasks in the time manager queue, which will be fed back to you  in the XThingList queue, accessed within the application's  main loop by calling ProcessXThingTask.      7:17:22 PM  10/28/92  By Brigham Stevens  Apple Computer, Inc.  Developer Technical Support      At init time call InitXThingTimer.  Call StartXThing to add a task and start its clock.  Call AddXThing to only add a task and NOT start its clock.  At the end of your program call KillAllXThingTasks  If your task wants to remove itself, it should return false.    Xthing tasks have the form of:    Boolean XThingUpdateTask(xthing *xtp, long dataRef)  {    myDataStruct *mdp;    Boolean     result;        mdp = (myDataStruct *)dataRef;        mdp.count++;        // do something usefull (less)        if(mdp.count)      result = true;      // want to be run again    else      result = false;      // tell Xthing not to re-install us  }  See Sprite.c for more examples.  */#include &quot;xthing.h&quot;#include &quot;ZAMProtos.h&quot;static void XThingTimeTask(void);static long    xThingCount = 0;static xQHdr  XThingList;void InitXThingTimer(void){  xInitQueueHeader(&amp;XThingList);}static void XThingTimeTask(void){    /* Time manager points to time task record in a1 */  /* We have all our data located after that, so it */  /* is simple to just do our  thing */    asm {        st.b    xthing.taskFlag(a1)        }}void ProcessXThingTask(short numTasksToProcess)/*  Whip through the queue until there  are no more entires.  Each item is  ripped from the queue, it's associated task  is called, and the item is then fed back to  the Time Manager task, which will give it back to us here  when it is done chewing on it.    If the user interface slows down because of too many things going on,  you might want to add a task that basically calls your event loop  once in a while.  Then you could make this the main loop of your  program if you were so inclined.*/{  xthing      *xtp;  updateProc    updateJSR;  Boolean      reTime;  OSErr      err;    for(xtp = (xthing*)XThingList.qHead; xtp != nil; xtp = xtp-&gt;next) {    if(xtp-&gt;taskFlag) {      xtp-&gt;taskFlag = false;      updateJSR = (updateProc)xtp-&gt;actionProc;      if(updateJSR)  {        reTime = (*updateJSR)(xtp,xtp-&gt;dataRef);        if(reTime) {          RmvTime(&amp;xtp-&gt;timer);          InsTime(&amp;xtp-&gt;timer);          PrimeTime(&amp;xtp-&gt;timer, xtp-&gt;interval);        }      }    }  }}void EnqueueXThing(xthing *xtp){  xThingCount++;    if(xtp-&gt;inList == false) {      // change to bit field in taskFlag later    xEnqueue(xtp,&amp;XThingList);    xtp-&gt;inList = true;  }}void AddXThing(xthing *xtp, long prime, updateProc updtProc, long dataRef)/*  This adds a thing to the xthing list, but does not start the tasks*/{  short  err = noErr;      if(err == noErr) {    /* set up default values */        xtp-&gt;timer.tmAddr = (ProcPtr)XThingTimeTask;        xtp-&gt;interval = prime;    xtp-&gt;taskFlag = false;      xtp-&gt;dataRef = dataRef;    xtp-&gt;actionProc = updtProc;    xtp-&gt;waiting = true;    EnqueueXThing(xtp);  }}xthing *StartXThing(xthing *xtp, long prime, updateProc updtProc, long dataRef)/*  The best thing about this  is that it takes almost NO parameters  pass the timing interval in prime  a pointer to the update routine in updtProc  and an application-defined reference in refcon.*/{  short  err = noErr;    /* allocate a new thing */  if(xtp == nil) {    xtp = (xthing*)NewPtrClear(sizeof(xthing));    if(!xtp){      err = MemError();      ErrMsgCode(&quot;\pNewPtrClear failed in StartThing&quot;,err);    }  }    if(err == noErr) {    /* set up default values */        xtp-&gt;timer.tmAddr = (ProcPtr)XThingTimeTask;        xtp-&gt;interval = prime;    xtp-&gt;taskFlag = false;      xtp-&gt;dataRef = dataRef;    xtp-&gt;actionProc = updtProc;    xtp-&gt;waiting = true;    EnqueueXThing(xtp);        InsTime((QElemPtr)&amp;xtp-&gt;timer);    PrimeTime(&amp;xtp-&gt;timer, xtp-&gt;interval);  }  return xtp;}void KillAllXThingTasks(void){  xthing      *xtp;    for(xtp = (xthing*)XThingList.qHead; xtp != nil; xtp = xtp-&gt;next) {    if( (xtp-&gt;timer.qType &amp; TaskActiveFlag) != 0)      RmvTime(&amp;xtp-&gt;timer);  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ZAM/listing48.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ZAM/listing48.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ZAM/listing48.html%3Fid%3DDTS10000063-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>