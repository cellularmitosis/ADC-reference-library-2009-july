<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Guide for Windows: Building QuickTime Capability Into a Windows Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Building QuickTime Capability Into a Windows Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication" title="Building QuickTime Capability Into a Windows Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../QuickTimeforWindows-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000563" target="_top">QuickTime for Windows</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000940-IntroductiontoQuickTimeGuideForWindows-DontLinkElementID_23">QuickTime Guide for Windows</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2QuickTimeForWindows.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4WindowsUtilityRouti.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-SW1" title="Building QuickTime Capability Into a Windows Application"></a>
<h1>Building QuickTime Capability Into a Windows Application</h1>

<p>Incorporating the QuickTime routines into the structure of a Windows application program is relatively straightforward. You need to follow the basic steps outlined here to build a simple QuickTime capability into your Windows program. Names in parentheses are those of the relevant QTML routines.</p>
<ol class="ol">
<li class="li"><p>Initialize the QuickTime Media Layer (<code>InitializeQTML</code>) and  QuickTime (<code>EnterMovies</code>) at the start of your program.</p></li>
<li class="li"><p>Associate a QuickDraw  graphics port with your movie window (<code>CreatePortAssociation)</code>.</p></li>
<li class="li"><p>Open a  movie file (<code>OpenMovieFile)</code> and  extract the movie from it (<code>NewMovieFromFile)</code>.</p></li>
<li class="li"><p>Create a  movie controller for displaying the movie on the screen (<code>NewMovieController)</code>.</p></li>
<li class="li"><p>In your  window procedure, convert incoming  messages to QTML  events (<code>WinEventToMacEvent</code>) and pass them to the  movie controller for processing (<code>MCIsPlayerEvent</code>).</p></li>
<li class="li"><p>Dispose of the  movie (<code>DisposeMovie</code>) and its  controller (<code>DisposeMovieController)</code> when they&#8217;re no longer needed.</p></li>
<li class="li"><p>Dispose of your movie window&#8217;s  graphics port when the window is destroyed (<code>DestroyPortAssociation)</code>.</p></li>
<li class="li"><p>Terminate QuickTime (<code>ExitMovies</code>) and the QuickTime Media Layer (<code>TerminateQTML)</code> at the end of your program.</p></li>
</ol>
<p>Listing 2-1 illustrates, in skeletal form, how these steps fit into the structure of a typical Windows application program.</p>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_26" title="Listing 2-1Skeleton of a Windows program using QuickTime"></a>
<p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Skeleton of a Windows program using QuickTime</p>
<div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Resource identifiers<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .<span></span></pre></td></tr><tr><td scope="row"><pre>#define  IDM_OPEN  101<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .<span></span></pre></td></tr><tr><td scope="row"><pre>// Global variables<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;char            movieFile[255];&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Name of movie file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Movie           theMovie;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Movie object<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;MovieController theMC;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Movie controller  <span></span></pre></td></tr><tr><td scope="row"><pre>////////////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>int CALLBACK WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;       LPSTR lpCmdLine, int nCmdShow)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;InitializeQTML(0);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Initialize QTML <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EnterMovies();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Initialize QuickTime <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Main message loop<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ExitMovies();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Terminate QuickTime <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TerminateQTML();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Terminate QTML <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WinMain */<span></span></pre></td></tr><tr><td scope="row"><pre>////////////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>LRESULT CALLBACK WndProc (HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MSG&#160;         winMsg;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EventRecord  qtmlEvent;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; wmEvent, wmId;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;    // Fill in contents of MSG structure<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Convert message to a QTML event<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NativeEventToMacEvent (&#38;winMsg, &#38;qtmlEvent);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Pass event to movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MCIsPlayerEvent (theMC, (const EventRecord *) &#38;qtmlEvent);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch ( message )<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case WM_CREATE:<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Register window with QTML<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CreatePortAssociation (hWnd, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case WM_COMMAND:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wmEvent = HIWORD(wParam);  // Parse menu selection<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wmId  = LOWORD(wParam);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch ( wmId )<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case IDM_OPEN:<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Close previous movie, if any <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CloseMovie (); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Get file name from user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( GetFile (movieFile) )&#160;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Open the movie<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OpenMovie (hWnd, movieFile); <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;. <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;. <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return DefWindowProc (hWnd, message, <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; wParam, lParam); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end switch ( wmId ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case WM_CLOSE:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Unregister window with QTML<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DestroyPortAssociation (hWnd);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;default:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return DefWindowProc (hWnd, message, wParam, lParam);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end switch ( message ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WndProc */<span></span></pre></td></tr><tr><td scope="row"><pre>////////////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>BOOL GetFile (char *movieFile)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;  OPENFILENAME  ofn;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;  // Fill in contents of OPENFILENAME structure<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;  if ( GetOpenFileName(&#38;ofn) )&#160;     // Let user select file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;    return TRUE;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;    return FALSE;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end GetFile */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>////////////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>void OpenMovie (HWND hwnd, char fileName[255])<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;short  theFile = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FSSpec  sfFile;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;char   fullPath[255];<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Set graphics port<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetGWorld ( (CGrafPtr)GetNativeWindowPort( hwnd ), nil);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;strcpy (fullPath, fileName);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Copy full pathname <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;c2pstr (fullPath);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Convert to Pascal string <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FSMakeFSSpec (0, 0L, fullPath, &#38;sfFile);&#160;&#160;&#160;&#160;&#160;&#160;// Make file-system<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//  specification record <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OpenMovieFile (&#38;sfFile, &#38;theFile, fsRdPerm);&#160;&#160;// Open movie file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NewMovieFromFile (&#38;theMovie, theFile, nil,&#160;&#160;&#160;&#160;// Get movie from file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; nil, newMovieActive, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CloseMovieFile (theFile);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Close movie file <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;theMC = NewMovieController (theMovie, ... );  // Make movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end OpenMovie */<span></span></pre></td></tr><tr><td scope="row"><pre>////////////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>void CloseMovie (void)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( theMC )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Destroy movie controller, if any <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DisposeMovieController (theMC);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( theMovie )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Destroy movie object, if any <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DisposeMovie (theMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end CloseMovie */<span></span></pre></td></tr></table></div>


<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_6">Basic QTML Routines</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_9">Redefined API Names</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_10">Window Records</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_11">Graphics Worlds (GWorlds) and How To Work With Them</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_12">Mixing QuickDraw and Win32 Drawing</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_13">Rendering into an HBITMAP</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_14">File Selection Dialogs</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_15">Movies and Movie Files</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_16">Movie Controllers</a>
				
			<br/>
			
        
			
			
				<a href="3BuildingQuickTimeCa.html#//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_17">Resources</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_6" title="Basic QTML Routines"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-BasicQTMLRoutines" title="Basic QTML Routines"></a>Basic QTML Routines</h2>
<p>This section discusses the basic QuickTime Media Layer (QTML) routines for building QuickTime capabilities into your Windows application, along with the underlying QTML concepts they&#8217;re based on.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_7" title="Initializing and Terminating QTML and QuickTime"></a>
<h3><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-InitializingandTerminatingQTMLandQuickTime" title="Initializing and Terminating QTML and QuickTime"></a>Initializing and Terminating QTML and QuickTime</h3>
<p>Before your program can perform any QuickTime operations, you must  initialize the QuickTime Media Layer and then QuickTime itself. The first is accomplished by calling a routine named <code><!--a target="_top" -->InitializeQTML<!--/a--></code>, the second with <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/EnterMovies" target="_top">EnterMovies</a></code>.</p>
<p><code><!--a target="_top" -->InitializeQTML<!--/a--></code> must be called at the very beginning of your program, before any other QuickTime call. The recommended place to call it is in your <code>WinMain</code> <code></code>  function, before creating your main window. The function is defined as follows:</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr InitializeQTML (long flag);<span></span></pre></td></tr></table></div>

<p>The <code>flag</code> parameter allows you to specify certain options for the way QuickTime will behave:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kInitQTMLUseDefault</code></p></td>
<td ><p>Use standard behavior.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kInitQTMLUseGDIFlag</code></p></td>
<td ><p>Use the Windows  Graphics Device Interface (GDI) for all drawing, rather than the DirectDraw or DCI services.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kInitQTMLNoSoundFlag</code></p></td>
<td ><p>Don't initialize the  Sound Manager; disable sound for all movies.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kInitializeQTMLDisableDirectSound</code></p></td>
<td ><p>Disable QTML's use of DirectSound.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kInitializeQTMLUseExclusiveFullScreenModeFlag</code></p></td>
<td ><p>Operate exclusively in full screen mode, in versions of QuickTime later than 3.0.</p></td>
</tr>

</table></div>
<p>In most cases, you&#8217;ll just want to set this parameter to <code>kInitQTMLUseDefault</code>, but other options are also available for unusual cases, either singly or in combination.</p>
<p>The function returns an error code indicating success (zero) or failure (nonzero). You can test this result and take appropriate action in case of failure, such as displaying a message box to inform the user that QuickTime is not available. Depending on the nature of your program, you might then choose either to terminate the program or to continue with QuickTime-related features disabled.</p>
<p>If you are writing a routine that does not know from context whether <code><!--a target="_top" -->InitializeQTML<!--/a--></code> has already been called, add a call to <code><!--a target="_top" -->InitializeQTML<!--/a--></code> at the beginning of the routine and a call to <code><!--a target="_top" -->TerminateQTML<!--/a--></code> at the end. It does no harm to call <code><!--a target="_top" -->InitializeQTML<!--/a--></code> more than once, as long as each call is nested with a matching call to <code><!--a target="_top" -->TerminateQTML<!--/a--></code>. If <code><!--a target="_top" -->InitializeQTML<!--/a--></code> has already been called, subsequent calls do nothing except increment a counter. Calls to <code><!--a target="_top" -->TerminateQTML<!--/a--></code> just decrement the counter (if it is nonzero). Only the first nested call to <code><!--a target="_top" -->InitializeQTML<!--/a--></code> and the last nested call to <code><!--a target="_top" -->TerminateQTML<!--/a--></code> do any actual work, so there is no penalty for having nested calls.</p>
<p>The <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/EnterMovies" target="_top">EnterMovies</a></code> function allocates space for QuickTime&#8217;s internal data structures and initializes their contents. Your program should call this function immediately after calling <code><!--a target="_top" -->InitializeQTML<!--/a--></code>. The function takes no parameters and returns an error code:</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr EnterMovies (void);<span></span></pre></td></tr></table></div>

<p>Again, you can test the result and do whatever is appropriate in case of failure.</p>
<p>At the end of the program, your initialization calls to <code><!--a target="_top" -->InitializeQTML<!--/a--></code> and <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/EnterMovies" target="_top">EnterMovies</a></code> should be balanced by corresponding calls to the termination routines <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/ExitMovies" target="_top">ExitMovies</a></code> and <code><!--a target="_top" -->TerminateQTML<!--/a--></code>. Both of these functions take no parameters and return no result.</p>

<div class="codesample"><table><tr><td scope="row"><pre>void ExitMovies (void)<span></span></pre></td></tr><tr><td scope="row"><pre>void TerminateQTML (void)<span></span></pre></td></tr></table></div>

<p>Listing 2-2 shows how these initialization and termination calls fit into the structure of a typical  <code>WinMain</code> routine.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_27" title="Listing 2-2Main routine of a Windows program using QuickTime"></a>
<p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Main routine of a Windows program using QuickTime</p>
<div class="codesample"><table><tr><td scope="row"><pre>int CALLBACK WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,<span></span></pre></td></tr><tr><td scope="row"><pre>LPSTR lpCmdLine, int nCmdShow)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MSG   msg;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HANDLE hAccelTable;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( !hPrevInstance )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Is there a previous instance?<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( !(InitApplication(hInstance)) )&#160;&#160;&#160;// Register window class<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( InitializeQTML(0) != noErr )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Initialize QTML<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MessageBox (hWnd, "QuickTime not available", // Notify user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;", MB_OK); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end if ( InitializeQTML(0) != noErr ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( EnterMovies() != noErr)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Initialize QuickTime<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MessageBox (hWnd, "QuickTime not available", // Notify user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;", MB_OK); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end if ( EnterMovies() != noErr ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( !(InitInstance(hInstance, nCmdShow)) )&#160;&#160;// Create main window<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hAccelTable = LoadAccelerators(hInstance,&#160;&#160;// Load accelerator table<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MAKEINTRESOURCE(IDR_ACCELSIMPLESDI));<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Main message loop<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;while ( GetMessage(&#38;msg, NULL, 0, 0) )&#160;&#160;&#160;&#160;&#160;&#160;// Retrieve next message<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Check for keyboard accelerator<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ( !TranslateAccelerator (msg.hwnd,&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hAccelTable, &#38;msg) )<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Convert virtual key to character<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TranslateMessage(&#38;msg);&#160;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Send message to window procedure<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DispatchMessage(&#38;msg);&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end if ( !TranslateAccelerator<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(msg.hwnd, hAccelTable, &#38;msg) ) */ <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;////////////////////////////////////////////////////////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ExitMovies();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Terminate QuickTime<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;TerminateQTML();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Terminate QTML<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (msg.wParam);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WinMain */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_8" title="Using Graphics Ports"></a>
<h3><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-UsingGraphicsPorts" title="Using Graphics Ports"></a>Using Graphics Ports</h3>
<p>Because of its Mac OS origins, QuickTime uses the QuickDraw graphics routines to draw to the screen. QuickDraw consitutes the Macintosh counterpart to the Windows  Graphics Device Interface, or GDI. Even when running under Windows, the  QuickTime Media Layer compatibility interface allows the QuickTime routines to use QuickDraw calls internally for their drawing operations. So in order to use QuickTime properly, you have to understand a little about QuickDraw.</p>
<p>The fundamental QuickDraw data structure is the <strong>graphics</strong> <strong>port</strong> (analogous to a Windows  device context). This is a complete drawing environment that specifies all of the parameters needed to control QuickDraw&#8217;s drawing operations. The port includes such things as the size and location of the line-drawing pen; colors and patterns (like brushes in Windows) for drawing, area fill, and background; the font, size, and style for text display; clipping boundaries; and so forth. All of this information is held in a data structure of type <code><!--a target="_top" -->CGrafPort<!--/a--></code>, pointed to by a pointer of type <code>CGrafPtr</code>.</p>
<p>The <code>C</code> in <code><!--a target="_top" -->CGrafPort<!--/a--></code> and <code>CGrafPtr</code> stands for &#8220;color,&#8221; to distinguish these from the &#8220;classic&#8221; black-and-white versions of these structures (<code>GrafPort</code> and <code>GrafPtr)</code>, which are now obsolete. Any QTML routine that nominally expects a <code><!--a target="_top" -->GrafPort<!--/a--></code> or <code>GrafPtr</code> will accept a <code><!--a target="_top" -->CGrafPort<!--/a--></code> or <code>CGrafPtr</code> instead.</p>
<p>The main purpose of a graphics port is to serve as the environment in which to perform QuickDraw graphics operations. Unlike the Windows GDI routines, which always accept a device context as an explicit parameter, most QTML QuickDraw routines operate implicitly on the <strong>current</strong> <strong>port.</strong> At any given time, exactly one graphics port is current. The QTML routine <code>GetPort</code></p>

<div class="codesample"><table><tr><td scope="row"><pre>void GetPort (GrafPtr *port)<span></span></pre></td></tr></table></div>

<p>returns a pointer to the current port, and <code>MacSetPort</code></p>

<div class="codesample"><table><tr><td scope="row"><pre>void MacSetPort (GrafPtr  port)<span></span></pre></td></tr></table></div>

<p>changes it.</p>
<p>The original Mac OS name of this routine, <code>SetPort</code>, conflicts with an existing name in the Windows API and had to be changed to <code>MacSetPort</code>.</p>
<p>Graphics ports are closely associated with windows on the screen; the  current port for QuickDraw drawing operations is typically a window. When running in the Windows environment, you have to associate a Mac OS-style graphics port with your movie window for the QuickTime routines to use in displaying a movie. The next section discusses how to accomplish this.</p>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_9" title="Redefined API Names"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-RedefinedAPINames" title="Redefined API Names"></a>Redefined API Names</h2>
<p>Some names defined in the Macintosh application programming interfaces conflict with identical names in the Windows API. In these cases, the QTML header file <code>QTMLMapNames</code>.h avoids these conflicts by redefining the affected names with the prefix <code>Mac</code> added.</p>
<p>In Table 2-2, names listed in the first column refer to the original Macintosh function or data structure name; the second column gives the redefined or newly mapped names.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_28" title="Table 2-1Redefined API names"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Redefined API names</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Original Macintosh API name</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Mapped name</p></th>
</tr>


<tr>
<td  scope="row"><p><code>AnimatePalette</code></p></td>
<td ><p><code>MacAnimatePalette</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>AppendMenu</code></p></td>
<td ><p><code>MacAppendMenu</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>CloseDriver</code></p></td>
<td ><p><code>MacCloseDriver</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>CloseWindow</code></p></td>
<td ><p><code>MacCloseWindow</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>CompareString</code></p></td>
<td ><p><code>MacCompareString</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>CopyRgn</code></p></td>
<td ><p><code>MacCopyRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>DeleteMenu</code></p></td>
<td ><p><code>MacDeleteMenu</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>DrawMenuBar</code></p></td>
<td ><p><code>MacDrawMenuBar</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>DrawText</code></p></td>
<td ><p><code>MacDrawText</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>EqualRect</code></p></td>
<td ><p><code>MacEqualRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>EqualRgn</code></p></td>
<td ><p><code>MacEqualRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FillRect</code></p></td>
<td ><p><code>MacFillRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FillRgn</code></p></td>
<td ><p><code>MacFillRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FindWindow</code></p></td>
<td ><p><code>MacFindWindow</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FlushInstructionCache</code></p></td>
<td ><p><code>MacFlushInstructionCache</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FrameRect</code></p></td>
<td ><p><code>MacFrameRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>FrameRgn</code></p></td>
<td ><p><code>MacFrameRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetClassInfo</code></p></td>
<td ><p><code>MacGetClassInfo</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetCurrentThread</code></p></td>
<td ><p><code>MacGetCurrentThread</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetCursor</code></p></td>
<td ><p><code>MacGetCursor</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetDoubleClickTime</code></p></td>
<td ><p><code>MacGetDoubleClickTime</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetFileSize</code></p></td>
<td ><p><code>MacGetFileSize</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetItem</code></p></td>
<td ><p><code>MacGetItem</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetMenu</code></p></td>
<td ><p><code>MacGetMenu</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetNextWindow</code></p></td>
<td ><p><code>MacGetNextWindow</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetParent</code></p></td>
<td ><p><code>MacGetParent</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetPath</code></p></td>
<td ><p><code>MacGetPath</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetPixel</code></p></td>
<td ><p><code>MacGetPixel</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>InsertMenu</code></p></td>
<td ><p><code>MacInsertMenu</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>InsertMenuItem</code></p></td>
<td ><p><code>MacInsertMenuItem</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>InsetRect</code></p></td>
<td ><p><code>MacInsetRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>InvertRect</code></p></td>
<td ><p><code>MacInvertRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>InvertRgn</code></p></td>
<td ><p><code>MacInvertRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>IsWindowVisible</code></p></td>
<td ><p><code>MacIsWindowVisible</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>LineTo</code></p></td>
<td ><p><code>MacLineTo</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>LoadResource</code></p></td>
<td ><p><code>MacLoadResource</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>MoveWindow</code></p></td>
<td ><p><code>MacMoveWindow</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>OffsetRect</code></p></td>
<td ><p><code>MacOffsetRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>OffsetRgn</code></p></td>
<td ><p><code>MacOffsetRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>OpenDriver</code></p></td>
<td ><p><code>MacOpenDriver</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>PaintRgn</code></p></td>
<td ><p><code>MacPaintRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>Polygon</code></p></td>
<td ><p><code>MacPolygon</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>PtInRect</code></p></td>
<td ><p><code>MacPtInRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>Region</code></p></td>
<td ><p><code>MacRegion</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>ReplaceText</code></p></td>
<td ><p><code>MacReplaceText</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>ResizePalette</code></p></td>
<td ><p><code>MacResizePalette</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SendMessage</code></p></td>
<td ><p><code>MacSendMessage</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SetCursor</code></p></td>
<td ><p><code>MacSetCursor</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SetItem</code></p></td>
<td ><p><code>MacSetItem</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SetPort</code></p></td>
<td ><p><code>MacSetPort</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SetRect</code></p></td>
<td ><p><code>MacSetRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SetRectRgn</code></p></td>
<td ><p><code>MacSetRectRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>ShowCursor</code></p></td>
<td ><p><code>MacShowCursor</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>ShowWindow</code></p></td>
<td ><p><code>MacShowWindow</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>StartSound</code></p></td>
<td ><p><code>MacStartSound</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>StopSound</code></p></td>
<td ><p><code>MacStopSound</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>TokenType</code></p></td>
<td ><p><code>MacTokenType</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>UnionRect</code></p></td>
<td ><p><code>MacUnionRect</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>UnionRgn</code></p></td>
<td ><p><code>MacUnionRgn</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>XorRgn</code></p></td>
<td ><p><code>MacXorRgn</code></p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_10" title="Window Records"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-WindowRecords" title="Window Records"></a>Window Records</h2>
<p>Because most drawing on the screen takes place in a window, graphics ports are also the basis of the QTML <strong>window</strong> <strong>record</strong> (<code>CWindowRecord</code>).</p>
<p>The only point to notice here is that its first field (<code>port</code>) holds not a pointer to a  graphics port, but actually a complete graphics port structure embedded directly in the window record. At the machine level, this means that the window record is simply an extended graphics port with some additional, window-specific information appended at the end. In fact, the pointer to a color window (<code>CWindowPtr</code>) is directly equated to the corresponding graphics port pointer (<code>CGrafPtr</code>):</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef  CGrafPtr  CWindowPtr;<span></span></pre></td></tr></table></div>

<p>This allows a window to be used in place of a graphics port in any context in which a port would be valid. Any QuickDraw routine that expects a pointer to a graphics port as a parameter will accept a window pointer in its place, since the two pointers are really the same data type. In particular, the QuickTime routines can pass your window pointer to the <code>MacSetPort</code>  function discussed in the preceding section, making the window the  current port in which to display the contents of a movie.</p>
<p>On the Windows platform, however, your window is normally designated by a Windows-style  handle (<code>HWND</code>) rather than a QTML pointer (<code>CWindowPtr</code>). To allow QuickTime to draw into the window, you must first <strong>register</strong> it with QTML by calling the QTML routine <code><!--a target="_top" -->CreatePortAssociation<!--/a--></code>.</p>

<div class="codesample"><table><tr><td scope="row"><pre>void CreatePortAssociation<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void  *theWnd,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Ptr   storage<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; long &#160;flags);<span></span></pre></td></tr></table></div>

<p>This creates a graphics port and associates it with this window in an internal data structure maintained by QTML. The first parameter (<code>theWnd</code>) is your Windows-style window handle, of type <code>HWND</code>. The second parameter (<code>storage</code>) allows you to supply your own storage for the <code><!--a target="_top" -->CGrafPort<!--/a--></code> record, if you wish. Generally, you will always pass <code>nil</code>, allowing the call to allocate memory. (If you leave this parameter <code>null</code>, QTML will allocate the space for you.)</p>
<p>Typically, you&#8217;ll want to register your movie window at the time it is created by calling <code><!--a target="_top" -->CreatePortAssociation<!--/a--></code> from your window procedure in response to the <code>WM_CREATE</code> message, as shown in Listing 2-3.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_29" title="Listing 2-3Creating a port association"></a>
<p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Creating a port association</p>
<div class="codesample"><table><tr><td scope="row"><pre>LRESULT CALLBACK WinProc<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(HWND   thisWindow,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to window <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; UINT   msgType,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message type <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WPARAM  wParam,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LPARAM  lParam)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter  <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch ( msgType )<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case WM_CREATE:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CreatePortAssociation (thisWindow, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  // Register window with QTML <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end switch ( msgType ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WinProc */<span></span></pre></td></tr></table></div>

<p>Once you&#8217;ve registered your window, you can use the conversion routine <code>GetHWNDPort</code>   to obtain a QTML-style window pointer for it:</p>

<div class="codesample"><table><tr><td scope="row"><pre>WindowPtr GetNativeWindowPort (void *h)<span></span></pre></td></tr></table></div>

<p>There&#8217;s also a reverse conversion function for recovering the window handle associated with a given window pointer.</p>

<div class="codesample"><table><tr><td scope="row"><pre>void* GetPortNativeWindow (WindowPtr  wptr)<span></span></pre></td></tr></table></div>

<p>When you&#8217;re through with a particular window, you can deregister it and dispose of its graphics port with <code><!--a target="_top" -->DestroyPortAssociation<!--/a--></code>:</p>

<div class="codesample"><table><tr><td scope="row"><pre>void DestroyPortAssociation (CGrafPtr  cgp)<span></span></pre></td></tr></table></div>

<p>A good place to do this is in your  window procedure&#8217;s response to the <code>WM_CLOSE</code> or <code>WM_DESTROY</code> message. Listing 2-4 shows an example of how to destroy a port association.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_30" title="Listing 2-4Destroying a port association"></a>
<p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Destroying a port association</p>
<div class="codesample"><table><tr><td scope="row"><pre>LRESULT CALLBACK WinProc<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(HWND    thisWindow,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to window <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; UINT    msgType,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message type <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WPARAM  wParam,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LPARAM  lParam)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter  <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch ( msgType )<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;case WM_CLOSE:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CWindowPtr  qtmlPtr;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Macintosh window pointer <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Convert to window pointer<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;qtmlPtr = GetHWNDPort(thisWindow);&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DestroyPortAssociation (qtmlPtr);&#160;&#160;&#160;// Deregister window<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end switch ( msgType ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WinProc */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_11" title="Graphics Worlds (GWorlds) and How To Work With Them"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-GraphicsWorldsGWorldsandHowToWorkWithThem" title="Graphics Worlds (GWorlds) and How To Work With Them"></a>Graphics Worlds (GWorlds) and How To Work With Them</h2>
<p>Another aspect of the graphics environment that affects the way QuickTime displays images on the screen is the characteristics of the graphics device on which they&#8217;re being presented. These include such things as the device&#8217;s pixel resolution, its color depth, and the capacity of its color table. The device&#8217;s characteristics are summarized in a <strong>graphics</strong> <strong>device</strong> <strong>record.</strong></p>
<p>Ordinarily, the results of a program&#8217;s drawing operations depend on the graphical capabilities of the display device that happens to be connected to the user&#8217;s computer at run time. There can even be more than one such device attached to the same system: QTML will figure out which screen is being drawn to and will display all results correctly according to the characteristics of each device. All of this normally happens automatically, and is transparent to the running program.</p>
<p>Sometimes, however, a program may need to take a more active role in controlling the graphics environment for its drawing operations. If you&#8217;re creating a QuickTime movie, for instance, you probably don&#8217;t want to define the movie&#8217;s appearance in terms of the display characteristics of a particular graphics device. Rather, you want the movie&#8217;s content to be device-independent, with its own inherent dimensions, pixel depth, colors, and so on. Then, when the movie is displayed on a user&#8217;s computer, QuickTime will automatically adapt its graphical characteristics to those of the available display device, and will present the movie as faithfully as it can on the given device.</p>
<p>The way to accomplish this is to define the movie with respect to a device-independent <strong>graphics</strong> <strong>world.</strong> This combines a  graphics port and a device record, which together completely determine the graphics environment in which QuickTime does its drawing. Like the window record we discussed in the preceding section, the data structure representing a graphics world is an extended graphics port with some additional fields appended at the end. The exact details are private to QTML; the graphics world is always referred to by means of an opaque pointer of type <code>GWorldPtr</code>. Because the underlying structure is based on a graphics port, however, this pointer is equated to a graphics port pointer:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef  CGrafPtr  GWorldPtr;<span></span></pre></td></tr></table></div>

<p>This means that (again, like a window record), a graphics world can be used anywhere a graphics port would be expected: for instance, as an argument to the <code>MacSetPort</code>  function that sets the current port for subsequent drawing operations.</p>
<p>A graphics world&#8217;s device record can represent an existing physical graphics device, but it need not: it can also describe a fictitious &#8220;offscreen&#8221; device with any graphical characteristics you choose. You create such an offscreen graphics world by specifying the desired characteristics as parameters to the QTML function <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/c/func/NewGWorld" target="_top">NewGWorld</a></code>:</p>

<div class="codesample"><table><tr><td scope="row"><pre>QDErr NewGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(GWorldPtr    *offscreenGWorld,   // Returns pointer to GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; short        pixelDepth,&#160;&#160;&#160;&#160;&#160;&#160;   // Color depth in bits per pixel<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; const Rect   *boundsRect,&#160;&#160;&#160;&#160;&#160;&#160;  // Boundary rectangle<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CTabHandle   cTable,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;  // Handle to color table<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle     aGDevice,&#160;&#160;&#160;&#160;&#160;&#160;&#160;   &#160;// Set to null for offscreen<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GWorldFlags  flags);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;   // Option flags<span></span></pre></td></tr></table></div>

<p>Notably, if the <code>noNewDevice</code>  flag in the <code>flags</code> parameter is clear, the function will ignore the parameter <code>aGDevice</code> and create a new, device-independent device record with the specified characteristics. It will then combine this device record with a graphics port for drawing into a memory-based image buffer (rather than directly to the screen), and will return a pointer to the resulting graphics world via the <code>offscreenGWorld</code> parameter.</p>
<p>When you use <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/c/func/NewGWorld" target="_top">NewGWorld</a></code> to create your graphics world, it will be set up to draw into a Macintosh-style <code>bitmap</code> as its image buffer. If you want to work with a Windows-style <code>bitmap</code> instead, you can use an alternate function available only in the Windows version of the QuickTime API.</p>

<div class="codesample"><table><tr><td scope="row"><pre>QDErr NewGWorldFromHBITMAP<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(GWorldPtr    *offscreenGWorld,&#160;&#160;&#160;// Returns pointer to GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CTabHandle   cTable,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Handle to color table<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle     aGDevice,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Set to null for offscreen<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GWorldFlags  flags,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Option flags<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; void         *newHBITMAP,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to bitmap<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; void         *newHDC)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to device context<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; long &#160; &#160;&#160;&#160;&#160;&#160;&#160;rowBytes) &#160; &#160;&#160;&#160; &#160;&#160;&#160; // number of bytes in a scanline<span></span></pre></td></tr></table></div>

<p>The parameters <code>newHBITMAP</code> and <code>newHDC</code> must either both be <code>null</code> or handles to a Windows <code>bitmap</code> and  device context, respectively. If they&#8217;re null, the function will allocate a complete graphics world for you; otherwise, it will simply wrap one around the specified structures. This allows you to use the native Windows drawing environment as the source for QuickTime operations such as image compression or <code>CopyBits</code>. If you do supply a Windows <code>bitmap</code>, it must be a device-independent <code>bitmap</code> (DIB) created with the Windows function <code>CreateDIBSection</code>.</p>

<div class="codesample"><table><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Default<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k1MonochromePixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k2IndexedPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k4IndexedPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k8IndexedPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k1IndexedGrayPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k2IndexedGrayPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k4IndexedGrayPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k8IndexedGrayPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k16BE555PixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k32ARGBPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k16LE555PixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k16LE565PixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k24BGRPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k24RGBPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k32BGRAPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k32ABGRPixelFormat<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;k32RGBAPixelFormat<span></span></pre></td></tr></table></div>

<p>Once you&#8217;ve created a graphics world to your specifications, you can use it to set the current graphics port and device, then you can proceed to create your movie. The QTML function <code>SetGWorld</code></p>

<div class="codesample"><table><tr><td scope="row"><pre>void SetGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(CGrafPtr  port,&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Port or graphics world to make current<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle  gdh)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Device to make current<span></span></pre></td></tr></table></div>

<p>nominally accepts a graphics port and device record and makes them the  current port and  current device. However, if the <code>port</code> parameter actually points to a graphics world (remember that data types <code>GWorldPtr</code>  and  <code>CGrafPtr</code> are equivalent), then the function ignores parameter <code>gdh</code> and uses the port and device from the given graphics world instead. A companion function, <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/c/func/GetGWorld" target="_top">GetGWorld</a></code></p>

<div class="codesample"><table><tr><td scope="row"><pre>void GetGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(CGrafPtr *port,&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Returns current port<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle *gdh)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Returns current device<span></span></pre></td></tr></table></div>

<p>returns a pointer to the current port and a handle to the current device record. You can use this function, for example, to save the previous current port and  device and restore them again after you&#8217;re finished creating your movie. Listing 2-5 shows an example of how to use an offscreen graphics world.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_31" title="Listing 2-5Using an offscreen graphics world"></a>
<p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Using an offscreen graphics world</p>
<div class="codesample"><table><tr><td scope="row"><pre>CGrafPtr   oldPort;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Previous current port<span></span></pre></td></tr><tr><td scope="row"><pre>GDHandle   oldDevice;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Previous current device<span></span></pre></td></tr><tr><td scope="row"><pre>GWorldPtr  movieGWorld = nil;&#160;&#160;&#160;&#160;&#160;&#160;  &#160;// Movie's graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>Rect       movieFrame;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Boundary rectangle for movie images<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr      errCode;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Result code<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>errCode = NewGWorld (&#38;movieGWorld,&#160;&#160;&#160;&#160;// Return result in movieGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Pixel depth <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#38;movieFrame,&#160;&#160;&#160;&#160;&#160;// Boundary rectangle<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Use default color table <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; nil,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// No preexisting device record <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0 );&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// No flags to pass  <span></span></pre></td></tr><tr><td scope="row"><pre>if ( errCode != noErr )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Was there an error?<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;MessageBox (hWnd, "Error creating graphics world", ", MB_OK); // Notify user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GetGWorld (&#38;oldPort, &#38;oldDevice);&#160;// Save previous graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetGWorld (movieGWorld, nil);&#160;&#160;&#160;&#160;&#160;// Set movie's graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Here...you would draw images */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetGWorld (oldPort, oldDevice);&#160;&#160;&#160;// Restore previous graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DisposeGWorld (movieGWorld);&#160;&#160;&#160;&#160;&#160;&#160;// Dispose of movie's graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end else */<span></span></pre></td></tr></table></div>

<p>Besides the general  <code>SetGWorld</code> and  <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/c/func/GetGWorld" target="_top">GetGWorld</a></code> functions, the QuickTime Movie Toolbox also provides a pair of functions for setting and retrieving a movie&#8217;s graphics world directly:</p>

<div class="codesample"><table><tr><td scope="row"><pre>void SetMovieGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Movie     theMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CGrafPtr  port,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle  gdh)<span></span></pre></td></tr></table></div>


<div class="codesample"><table><tr><td scope="row"><pre>void GetMovieGWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Movie     theMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; CGrafPtr  *port,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GDHandle  *gdh)<span></span></pre></td></tr></table></div>

<p>They are useful for drawing offscreen because you can create GWorlds and then direct the movie to draw them there.</p>
<p>Similar to <code>SetGWorld</code>, the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/SetMovieGWorld" target="_top">SetMovieGWorld</a></code> function will accept a graphics world as its first parameter in place of a graphics port; it will then ignore the second parameter and use the device record from the graphics world instead.</p>

<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_12" title="Mixing QuickDraw and Win32 Drawing"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-MixingQuickDrawandWin32Drawing" title="Mixing QuickDraw and Win32 Drawing"></a>Mixing QuickDraw and Win32 Drawing</h2>
<p>The Win32 implementation of QuickDraw incorporates Win32 graphics elements, thus enabling much easier integration. Resources are allocated using native Win32 elements. If you need these resources, there are accessor functions provided for their retrieval.</p>
<p>By default, QuickDraw allocates GWorlds by creating DIB sections. The DIB&#8217;s memory (where the actual pixel values are stored) is shared by the <code>GWorld</code>. The GWorld&#8217;s <code><!--a target="_top" -->PixMap<!--/a--></code> base address points to the location of the HBITMAP&#8217;s pixel values. In this way, both QuickDraw and Win32 can draw into the same graphic environment.</p>
<p>An HDC is created and the HBITMAP is selected into it for the duration of the <code>GWorld</code>. Any changes in the <code>GWorld</code> drawing environment are reflected in the corresponding HDC and HBITMAP. If QuickDraw is unable to allocate the <code>GWorld</code> as a DIB section, it falls back to allocating the offscreen drawing pixels in memory.</p>
<p>You can access a GWorld&#8217;s HDC and HBITMAP by using QuickTime&#8217;s <code>GetPortHDC</code> and <code>GetPortHBITMAP</code> functions. Your application must not dispose of the HBITMAP or HDC returned from these calls. They are owned by QuickTime and will automatically be disposed of when the <code>GWorld</code> is disposed.</p>
<p>You may also request that the offscreen <code>GWorld</code> is allocated as a DirectDraw surface by passing the <code>kAllocDirectDrawSurface</code> flag to the <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/Reference/reference.html#//apple_ref/c/func/NewGWorld" target="_top">NewGWorld</a></code> family of calls.</p>

<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_13" title="Rendering into an HBITMAP"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-RenderingintoanHBITMAP" title="Rendering into an HBITMAP"></a>Rendering into an HBITMAP</h2>
<p>A common question is, how to use QuickTime or QuickDraw to render into an HBITMAP?  Since most GWorlds are simply wrappers for HBITMAPs, this is straightforward enough to answer.</p>
<p>The <code>RenderIntoHBITMAPExample</code> function shown below demonstrates the relationship of GWorlds and HBITMAPs, as well as the use of <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/QTNewGWorld" target="_top">QTNewGWorld</a></code>, <code>SetGWorld</code>, <code>GetPortHDC</code>, and <code>GetPortHBITMAP</code>.</p>
<p>The sample code in listing below first creates a <code>GWorld</code> in a Win32 compatible pixel format (in our example code we use <code>k32BGRAPixelFormat)</code>.</p>
<p>Once created the GWorld&#8217;s HDC and HBITMAP are retrieved using <code>GetPortHDC</code> and <code>GetPortHBITMAP</code>. The active port is selected by calling <code>SetGWorld</code>, and graphics rendered using the QuickDraw APIs <code>RGBForeColor</code> and <code>PaintRect</code>. Additionally, native Win32 GDI calls are used to render graphics into the same <code>GWorld</code>. Finally, the contents of the port are copied to a secondary HDC via <code>ScaleBlt</code>, using the GWorld&#8217;s HDC as a source. Note that the HBITMAP and HDC are owned and managed by the <code>GWorld</code>, and are not disposed of.</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr RenderIntoHBITMAPExample(HDC hdcDest, RECT *rectDest)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GWorldPtr gw = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;CGrafPtr savedPort;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GDHandle savedGD;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;HDC hdcSrc;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;HBITMAP hbitmapSrc;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Rect bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;OSErr result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Create a 256 x 256 32BGRA GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bounds.top = bounds.left = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bounds.bottom = bounds.right = 256;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;result = QTNewGWorld(&#38;gw,k32BGRAPixelFormat,&#38;bounds,NULL,NULL,NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// check for errors<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (result != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// retrieve the associated HDC and HBITMAP<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hdcSrc = GetPortHDC((GrafPtr)gw);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hbitmapSrc = GetPortHBITMAP((GrafPtr)gw);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// bail if DIB allocation failed.<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if ((hdcSrc == 0) || (hbitmapSrc == 0)) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;result = memFullErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// save current port and GDevice, set current port to new GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GetGWorld(&#38;savedPort,&#38;savedGD);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;SetGWorld(gw,NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>// Render graphics into GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Rect macRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBColor color;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RECT winRect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;HBRUSH hBrush, hBrushOld;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// red<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;color.red = 0xffff; color.green = 0; color.blue = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBForeColor(&#38;color);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;macRect = bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;PaintRect(&#38;macRect);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// green<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;color.red = 0; color.green = 0xffff; color.blue = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBForeColor(&#38;color);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;MacInsetRect(&#38;macRect, 20, 20);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;PaintRect(&#38;macRect);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// blue. just for kicks lets use GDI<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// to render graphics into the same GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;MacInsetRect(&#38;macRect, 20, 20);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;winRect.top = macRect.top;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;winRect.left = macRect.left;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;winRect.bottom = macRect.bottom;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;winRect.right = macRect.right;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hBrush = CreateSolidBrush(RGB(0,0,0xff));<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hBrushOld = SelectObject(hdcSrc, hBrush);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;FillRect(hdcSrc, &#38;winRect, hBrush);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GdiFlush();<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;DeleteObject(SelectObject(hdcSrc, hBrushOld));<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// copy contents of GWorld to dstHDC.<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;StretchBlt(hdcDest,rectDest-&#62;left,rectDest-&#62;top,rectDest-&#62;right-rectDest-&#62;left,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rectDest-&#62;bottom-rectDest-&#62;top,hdcSrc,bounds.left,bounds.top,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bounds.right-bounds.left,bounds.bottom-bounds.top,SRCCOPY);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// reset port<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;SetGWorld(savedPort,savedGD);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// dispose of gworld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if( gw ) DisposeGWorld(gw);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>In some cases, you might want to use QuickTime or QuickDraw to render into an existing DIB section. The <code>NewGWorldFromHBITMAP</code> call allows you to wrap an existing DIB section with a <code>GWorld</code>. After creating the <code>DIBSection</code>, call <code>NewGWorldFromHBITMAP</code>, passing in the HDC and HBITMAP, to create a <code>GWorld</code> that shares the pixels of the DIB section.</p>
<p>As in the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/QTNewGWorld" target="_top">QTNewGWorld</a></code> case, the HBITMAP is selected into the HDC for the life of the <code>GWorld</code>. Note that in this case, QuickDraw does not dispose of the HDC or HBITMAP in <code><a href="../../../../../Carbon/Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DisposeGWorld" target="_top">DisposeGWorld</a></code>, as it did not allocate them. The creator of the HDC and HBITMAP is responsible for disposing of them. Also note that the HBITMAP passed to <code>NewGWorldFromHBITMAP</code> must be created using the <code>CreateDIBSection</code> API, old style DDBs are not allowed.</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr RenderIntoExistingDIBExample(HDC hdcDest, RECT *rectDest)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GWorldPtr gw = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;CGrafPtr savedPort;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GDHandle savedGD;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;HDC hdcSrc,hdcTemp;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;HBITMAP hbitmapSrc;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;BITMAPINFO *bitmapInfo = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;OSErr result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;void *baseaddr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// create an HDC<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hdcTemp = GetDC(NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hdcSrc = CreateCompatibleDC(hdcTemp);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ReleaseDC(NULL,hdcTemp);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// create a DIB section<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo = (BITMAPINFO *)NewPtrClear(sizeof (BITMAPINFOHEADER)<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;+ (3 * sizeof (DWORD)));<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biSize = sizeof(BITMAPINFOHEADER);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biWidth = 256;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biHeight =  -1 * 256;     // top down dib<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biPlanes = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biBitCount = 32;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biCompression = BI_RGB;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biSizeImage = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biXPelsPerMeter = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biYPelsPerMeter = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biClrUsed = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiHeader.biClrImportant = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiColors[0].rgbBlue = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiColors[0].rgbGreen = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiColors[0].rgbRed = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;bitmapInfo-&#62;bmiColors[0].rgbReserved = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hbitmapSrc = CreateDIBSection(hdcSrc, bitmapInfo, DIB_RGB_COLORS,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#38;baseaddr, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// bail if DIB creation failed<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (hbitmapSrc == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;result = memFullErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;DisposePtr((Ptr)bitmapInfo);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// wrap the DIB with a GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;result = NewGWorldFromHBITMAP(&#38;gw,NULL,NULL,NULL,hbitmapSrc,hdcSrc);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// check for errors<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (result != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// save current port and GDevice, set current port to new GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;GetGWorld(&#38;savedPort,&#38;savedGD);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;SetGWorld(gw,NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Render graphics into GWorld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Rect rect;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBColor color;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;color.red = 0xffff; color.green = 0; color.blue = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBForeColor(&#38;color);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rect.top = rect.left = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rect.bottom = rect.right = 256;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;PaintRect(&#38;rect);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;color.red = 0; color.green = 0xffff; color.blue = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RGBForeColor(&#38;color);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rect.top = rect.left = 20;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rect.bottom = rect.right = 236;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;PaintRect(&#38;rect);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// copy contents of GWorld to dstHDC.<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;StretchBlt(hdcDest,rectDest-&#62;left,rectDest-&#62;top,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rectDest-&#62;right-rectDest-&#62;left,rectDest-&#62;bottom-rectDest-&#62;top,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;hdcSrc,0,0,256,256,SRCCOPY);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// reset port<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;SetGWorld(savedPort,savedGD);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// dispose of gworld<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if( gw ) DisposeGWorld(gw);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;DeleteObject(hbitmapSrc);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;DeleteDC(hdcSrc);<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_14" title="File Selection Dialogs"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-FileSelectionDialogs" title="File Selection Dialogs"></a>File Selection Dialogs</h2>
<p>When the user chooses the Open command from your File menu, you&#8217;ll want to present a dialog box that allows the user to select the file to be opened. In Windows, this is normally done with the function  <code>GetOpenFileName</code>, part of the  Common Dialog Box Library. This function displays the standard Windows  Open File dialog box on the screen, handles all interactions with the mouse and keyboard until the dialog is dismissed, and then returns a data structure of type <code>OPENFILENAME</code>  identifying the file the user has selected. One of the members of this structure, <code>lpstrFile</code>, points to a string buffer in which to return the pathname of the file the user has selected. Typically, a Windows program would simply pass this string to the appropriate Windows function, such as <code>CreateFile</code>, to open the designated file.</p>
<p>As we&#8217;ll see in the next section, however, the QuickTime function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code>  instead expects to receive an analogous data structure from the Macintosh  Standard File dialog package, a <strong>file-system</strong> <strong>specification</strong> <strong>record</strong> (Listing 2-6).</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_32" title="Listing 2-6File-system specification record"></a>
<p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>File-system specification record</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct FSSpec<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;short   vRefNum;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Volume reference number<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;long    parID;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Directory ID of parent directory <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Str255  name;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// File name<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}; /* end FSSpec */<span></span></pre></td></tr></table></div>

<p>So before calling <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code> from a Windows program, you have to create a specification record to pass to it. The QTML function <code><a href="../../../../../Carbon/Reference/File_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/FSMakeFSSpec" target="_top">FSMakeFSSpec</a></code> can be used to accomplish this.</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr FSMakeFSSpec<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(short               vRefNum,   // Volume reference number<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; long                dirID,&#160;&#160;   // ID of parent directory<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ConstStr255Param    fileName,  // File name<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; FSSpec              *spec)&#160;&#160;&#160;  // Returns a specification record<span></span></pre></td></tr></table></div>

<p>On the Macintosh, files are normally identified by giving a  directory ID and a local  file name within the directory. In Windows code, you set the directory ID and volume reference number to <code>0</code> and supply a full  pathname instead; <code><a href="../../../../../Carbon/Reference/File_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/FSMakeFSSpec" target="_top">FSMakeFSSpec</a></code> will interpret this correctly and initialize the specification record accordingly. Listing 2-7 shows how to use this function to mediate between the Windows common dialog box and the QTML <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code>  function.</p>
<p>Another point to keep in mind is that the Windows  <code>GetOpenFileName</code> function returns the file&#8217;s pathname as a C-style string (terminated by a null character), whereas <code><a href="../../../../../Carbon/Reference/File_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/FSMakeFSSpec" target="_top">FSMakeFSSpec</a></code>, like all QTML routines, expects it in Pascal form (preceded by a 1-byte length count).</p>
<p>QTML provides a pair of utility functions, <code>c2pstr</code> and <code>p2cstr</code>, for  converting strings from one format to the other in place. You don&#8217;t want to pass a string constant; the buffer needs to be modifiable.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_33" title="Listing 2-7Opening a user-selected movie file"></a>
<p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Opening a user-selected movie file</p>
<div class="codesample"><table><tr><td scope="row"><pre>OPENFILENAME  ofn;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Parameters to Common Dialog Box<span></span></pre></td></tr><tr><td scope="row"><pre>char      pathName[255];&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Buffer for pathname<span></span></pre></td></tr><tr><td scope="row"><pre>BOOL      confirmed;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Did user confirm file selection?<span></span></pre></td></tr><tr><td scope="row"><pre>FSSpec    fileSpec;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// File-system specification record<span></span></pre></td></tr><tr><td scope="row"><pre>short     theFile;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Reference number of movie file<span></span></pre></td></tr><tr><td scope="row"><pre>HWND      hwnd;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to movie window <span></span></pre></td></tr><tr><td scope="row"><pre>CGrafPtr  windowPort;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Window's graphics port<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr     errCode;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Result code<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>memset (&#38;ofn, 0, sizeof(OPENFILENAME);&#160;&#160;&#160;&#160;// Clear to zero<span></span></pre></td></tr><tr><td scope="row"><pre>fileName[0] = '\0';&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// No default file name<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.lStructSize   = sizeof(OPENFILENAME);&#160;&#160;&#160;&#160;// Size of structure<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.hwndOwner    = GetActiveWindow();&#160;&#160;&#160;&#160;&#160;// Active window owns dialog<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.lpstrFile    = LPSTR(pathName);&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Point to pathname buffer<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.nMaxFile    = 255;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Size of buffer<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.lpstrFilter   = "QuickTime Movies (*.mov;*.avi) \0 *.mov;*.avi\0";<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Filter string <span></span></pre></td></tr><tr><td scope="row"><pre>ofn.nFilterIndex  = 1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Index of default filter<span></span></pre></td></tr><tr><td scope="row"><pre>ofn.lpstrInitialDir = NULL;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Use current directory<span></span></pre></td></tr><tr><td scope="row"><pre>confirmed = GetOpenFileName (&#38;ofn);&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Let user select file<span></span></pre></td></tr><tr><td scope="row"><pre>if ( confirmed )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Did user confirm selection? <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;c2pstr (pathName);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Convert to Pascal string<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Make specification record<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FSMakeFSSpec (0, 0L, pathName, &#38;fileSpec);&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Get window's graphics port<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;windowPort = GetNativeWindowPort( hwnd );&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SetGWorld (windowPort, nil);&#160;&#160;&#160;&#160;&#160;&#160;// Make it the graphics world<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Open the movie file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;errCode = OpenMovieFile (&#38;fileSpec, &#38;theFile, fsRdPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end if ( confirmed ) */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_15" title="Movies and Movie Files"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-MoviesandMovieFiles" title="Movies and Movie Files"></a>Movies and Movie Files</h2>
<p>QuickTime movies reside in <strong>movie</strong> <strong>files.</strong> On the Mac OS platform, such files carry the file type <code>'MooV'</code> (defined in the QuickTime interface as a constant named <code>MovieFileType)</code>; on the Windows platform, they are identified by the file-name extension <code></code>.mov.</p>
<p>Before reading a movie in from its movie file, you must first open the file with the QuickTime function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code>.</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr OpenMovieFile<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(const FSSpec  *fileSpec,&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Identifies file to be opened<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; short         *resRefNum,&#160;&#160;&#160;&#160;&#160;&#160;// Returns file reference number<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; SInt8         permission)&#160;&#160;&#160;&#160;&#160; // Requested permission level<span></span></pre></td></tr></table></div>

<p>The <code>fileSpec</code> parameter points to a <strong>file-system</strong> <strong>specification</strong> <strong>record</strong>  (described in Listing 2-6) telling which movie file to open. The <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code>  function returns a  <strong>file</strong> <strong>reference</strong> <strong>number,</strong> via the <code>resRefNum</code> parameter, that uniquely identifies this movie file. You&#8217;ll use this reference number to refer to the file when calling other QuickTime routines, such as <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/CloseMovieFile" target="_top">CloseMovieFile</a></code>  and <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromFile" target="_top">NewMovieFromFile</a></code>. The <code>permission</code> parameter specifies the level of  access permission requested for the file, such as <code>fsRdPerm</code>  (read-only), <code>fsWrPerm</code>  (write-only), or <code>fsRdWrPerm</code> <code></code>  (read-write).</p>
<p>After opening the movie file, you can read the movie&#8217;s contents into a <strong>movie</strong> <strong>record,</strong>  an opaque data structure in which QuickTime reads some information into memory about the movie&#8217;s contents. The movie record is referred to by a <strong>movie</strong> <strong>identifier</strong>  of type <code>Movie</code>.</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef MovieRecord* Movie;<span></span></pre></td></tr></table></div>

<p>The QuickTime function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromFile" target="_top">NewMovieFromFile</a></code>  creates movie record in memory for the specified file.</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr NewMovieFromFile<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Movie      *theMovie,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Returns movie identifier<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; short      resRefNum,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  // File reference number<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; short      *resID,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  // Unused in Windows; set to nil<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; StringPtr  resName,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  // Unused in Windows; set to nil<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; short      newMovieFlags,&#160;&#160;&#160;&#160;&#160;  // Option flags<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Boolean    *dataRefWasChanged)&#160; // Unused in Windows; set to nil<span></span></pre></td></tr></table></div>

<p>You identify the movie file by supplying the  file reference number (<code>resRefNum</code> ) that you got back from your call to <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/OpenMovieFile" target="_top">OpenMovieFile</a></code>. Parameter <code>theMovie</code> returns a movie identifier for the movie retrieved from the file. Of the possible option flags that you can set in the <code>newMovieFlags</code> parameter, the only one of interest on the Windows platform is <code>newMovieActive</code>, which controls whether the movie will initially be active or inactive when you read it in; you can later control this setting dynamically with the QuickTime function <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/SetMovieActive" target="_top">SetMovieActive</a></code>. The remaining parameters refer to Macintosh-style resources, and are not relevant in the Windows context.</p>
<p>Once you&#8217;ve read a movie in from its file to a movie record and obtained a movie identifier for it, there&#8217;s no need to keep the movie file open any longer. In the movie record, there are pointers to the file and QuickTime will automatically reopen it to retrieve data, if needed. It&#8217;s considered good practice to close the file immediately, using the QuickTime function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/CloseMovieFile" target="_top">CloseMovieFile</a></code>:</p>

<div class="codesample"><table><tr><td scope="row"><pre>OSErr CloseMovieFile (short resRefNum)   // File reference number<span></span></pre></td></tr></table></div>

<p>Once again, you identify the file by using the  file reference number you received when you first opened it. After closing the file, the file reference number is invalid. Therefore, passing the reference to another file manager call is not a good idea and should be avoided.</p>
<p>Listing 2-8 illustrates how to combine these QuickTime calls to read a movie in from its movie file.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_34" title="Listing 2-8Reading a movie from a file"></a>
<p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Reading a movie from a file</p>
<div class="codesample"><table><tr><td scope="row"><pre>FSSpec  fileSpec;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;// Descriptive information on file to open<span></span></pre></td></tr><tr><td scope="row"><pre>short   theFile;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Reference number of movie file<span></span></pre></td></tr><tr><td scope="row"><pre>Movie   theMovie;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Movie identifier<span></span></pre></td></tr><tr><td scope="row"><pre>HWND    hWnd;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to window<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr   errCode;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Result code<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>// Open the movie file<span></span></pre></td></tr><tr><td scope="row"><pre>errCode = OpenMovieFile (&#38;fileSpec, &#38;theFile, fsRdPerm); &#160;<span></span></pre></td></tr><tr><td scope="row"><pre>if ( errCode != noErr )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Was there an error?<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MessageBox (hWnd, "Error opening movie file",&#160;// Notify user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;", MB_OK);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end if ( errCode != noErr ) */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>errCode = NewMovieFromFile (&#38;theMovie, theFile,&#160;// Get movie from file<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil, nil,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;newMovieActive, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>CloseMovieFile (theFile);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Close the file<span></span></pre></td></tr><tr><td scope="row"><pre>if ( errCode != noErr)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Was there an error? <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MessageBox (hWnd, "Error reading movie from file",&#160;// Notify user<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;", MB_OK);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return (FALSE);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Report failure <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end if ( errCode != noErr ) */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_16" title="Movie Controllers"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-MovieControllers" title="Movie Controllers"></a>Movie Controllers</h2>
<p>The preferred way to present a movie is with a <strong>movie</strong> <strong>controller.</strong> This is a QuickTime component that presents the user with a standard set of controls for running the movie and controlling its direction, speed, and so on.</p>
<p>You create a movie controller with the QuickTime function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieController" target="_top">NewMovieController</a></code>.</p>

<div class="codesample"><table><tr><td scope="row"><pre>MovieController NewMovieController<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Movie        theMovie,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Movie to be displayed<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; const Rect   *movieRect,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Rectangle to display it in<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; long         someFlags)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Option flags<span></span></pre></td></tr></table></div>

<p>Parameter <code>theMovie</code> is the movie identifier you received when you read the movie in with <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/NewMovieFromFile" target="_top">NewMovieFromFile</a></code>. The second parameter, <code>movieRect</code>, specifies the rectangle in which to display the movie on the screen. The parameter <code>someFlags</code> specifies various options, such as whether to display the movie with a frame around it, how to position it within the specified rectangle, and whether to scale it to fit the rectangle. (If you want it to fit the rectangle exactly, you can get the dimensions of the movie&#8217;s boundary rectangle with the QuickTime function <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/GetMovieBox" target="_top">GetMovieBox</a></code>.)</p>
<p>Because of its Mac OS origins, a movie controller is driven by <strong>events</strong>  rather than  messages. Events are similar in concept to Windows-style messages, though different in detail. As you can see in Listing 2-9, the QTML <strong>event</strong> <strong>record</strong>  closely resembles the Windows message structure (<code>MSG)</code> and contains essentially the same information. (One difference is that unlike a Windows message, the event doesn&#8217;t identify a particular window to which it applies; this is because all Macintosh events are addressed globally to the program itself, rather than to an individual window.)</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_35" title="Listing 2-9Event record"></a>
<p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Event record</p>
<div class="codesample"><table><tr><td scope="row"><pre>struct EventRecord<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EventKind       what;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Event type<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;UInt32          message;&#160;&#160;&#160;&#160;&#160;&#160;// Additional parametric information<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;UInt32          when;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Time event occurred<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Point           where;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Mouse position at time of event<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EventModifiers  modifiers;&#160;&#160;&#160;&#160;// State of keyboard modifier keys<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;};<span></span></pre></td></tr></table></div>

<p>The QTML utility function <code><!--a target="_top" -->NativeEventToMacEvent<!--/a--></code>  converts a Windows message into an equivalent QTML event:</p>

<div class="codesample"><table><tr><td scope="row"><pre>int NativeEventToMacEvent<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void          *winMsg,&#160;&#160;&#160;&#160;&#160;&#160; // Windows message to be converted<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; EventRecord   *macEvent)&#160;&#160;&#160; &#160;// Equivalent Macintosh event<span></span></pre></td></tr></table></div>

<p>The first parameter points to a Windows <code>MSG</code>  structure describing the message received by your window procedure; the second points to a QTML event record for the function to fill in to represent an equivalent event, if any. (A nonzero function result indicates that the conversion took place successfully; if the given message doesn&#8217;t correspond to a Mac OS-style event, the function simply converts it to a <strong>null</strong> <strong>event</strong>  and returns a zero result.)</p>
<p>The QuickTime function <code><a href="../../../../Reference/QTRef_MovieController/Reference/reference.html#//apple_ref/c/func/MCIsPlayerEvent" target="_top">MCIsPlayerEvent</a></code></p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MCIsPlayerEvent<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(MovieController      mc,&#160;&#160;&#160;&#160;&#160;&#160;// Movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; const EventRecord    *e)&#160;&#160;&#160;&#160;&#160; // Event to be processed<span></span></pre></td></tr></table></div>

<p>accepts a movie controller and an event record as parameters, determines whether the event is directed to the controller, and processes it as appropriate. This allows the movie controller to &#8220;run itself&#8221;, handling all mouse and keyboard interactions with the user and displaying its movie on the screen accordingly. Even if the movie controller has no interest in the given event (for instance, if it&#8217;s a null event), the controller receives some processing time to advance the presentation of the movie itself.</p>
<p>Although the function returns a result of type <code>ComponentResult</code> (equivalent to a long integer) to indicate whether the movie controller has processed the event, you should normally ignore this result and simply pass all messages through both <code><a href="../../../../Reference/QTRef_MovieController/Reference/reference.html#//apple_ref/c/func/MCIsPlayerEvent" target="_top">MCIsPlayerEvent</a></code> and your window procedure&#8217;s normal message dispatch.</p>
<p>Listing 2-10 shows how to use the <code><!--a target="_top" -->NativeEventToMacEvent<!--/a--></code> and <code><a href="../../../../Reference/QTRef_MovieController/Reference/reference.html#//apple_ref/c/func/MCIsPlayerEvent" target="_top">MCIsPlayerEvent</a></code> functions to convert each message you receive to an event, then pass it to the window controller for action.</p>
<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_36" title="Listing 2-10Displaying a movie"></a>
<p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>Displaying a movie</p>
<div class="codesample"><table><tr><td scope="row"><pre>MovieController  theController;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Movie controller for movie<span></span></pre></td></tr><tr><td scope="row"><pre>LRESULT<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CALLBACK WinProc<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(HWND    thisWindow,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle to window<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; UINT    msgType,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message type<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WPARAM  wParam,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; LPARAM  lParam)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Message-dependent parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MSG           winMsg;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Windows message structure<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EventRecord   qtmlEvt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Macintosh event record<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DWORD         msgPos;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Mouse coordinates of message<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.hwnd = thisWindow;&#160;&#160;&#160;&#160;&#160;// Window handle<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.message = msgType;&#160;&#160;&#160;&#160;&#160;// Message type<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.wParam = wParam;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Word-length parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.lParam = lParam;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Long-word parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.time = GetMessageTime();&#160;&#160;// Get time of message<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;msgPos = GetMessagePos();&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Get mouse position<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.pt.x = LOWORD(msgPos);&#160;&#160;&#160;&#160;// Extract x coordinate<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;winMsg.pt.y = HIWORD(msgPos);&#160;&#160;&#160;&#160;// Extract y coordinate<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NativeEventToMacEvent (&#38;winMsg, &#38;qtmlEvt);&#160;// Convert to event<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MCIsPlayerEvent (theController, &#38;qtmlEvt);&#160;// Pass event to QuickTime<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;switch ( msgType )&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Dispatch on message type<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Handle message according to type <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;} /* end switch ( msgType ) */<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} /* end WinProc */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-DontLinkElementID_17" title="Resources"></a>
<h2><a name="//apple_ref/doc/uid/TP40000940-BuildingQuickTimeCapabilityIntoaWindowsApplication-Resources" title="Resources"></a>Resources</h2>
<p>Mac OS <strong>resources</strong> are items of structured data that reside in files and can be read in on demand to help determine a program&#8217;s behavior. Although Windows has the concept of resources as well, they&#8217;re far less central to the system&#8217;s software architecture than they are on the Mac OS platform.</p>
<p>Every Mac OS file consists of two separate <strong>forks,</strong>  stored independently but logically joined under a single file name. The <strong>data</strong> <strong>fork</strong> consists of a single stream of data bytes intended to be read sequentially, and corresponds to what&#8217;s generally considered a file on most other platforms. The <strong>resource</strong> <strong>fork,</strong>  by contrast, contains a collection of individual resources that are accessed via a four-character <strong>resource</strong> <strong>type</strong>  and an integer <strong>resource</strong> <strong>ID.</strong> For example, an icon to be displayed on the screen might be identified by resource type <code>'ICON'</code> and resource ID 1; the contents of a menu by type <code>'MENU'</code>, ID 128; the layout of a dialog box by type <code>'DLOG'</code>, ID 1000; and so forth.</p>
<p>Four-character codes like the ones that represent resource types are used on the Mac OS platform for a wide variety of other purposes as well. For example, every file is stamped with a four-character <strong>file</strong> <strong>type</strong>  and a four-character <strong>creator</strong> <strong>signature</strong>  identifying the application program to which the file belongs; these play an analogous role on the Mac OS platform to the three-character file-name extension in the DOS/Windows file system.</p>
<p>QuickTime uses four-character codes to identify such things as track types, media types, and component types. Internally, such codes are simply 32-bit long integers; at the source-language level, they are typically represented by a string of four characters enclosed in single quotation marks, such as <code>'abcd'</code>.</p>
<p>Because DOS/Windows files don&#8217;t have a counterpart to the Macintosh resource fork, other mechanisms have to be adopted to accommodate resource information. For example, although QuickTime movie files use both forks on the Mac OS platform, those on Windows have only the equivalent of the data fork. One approach is to store only the contents of the data fork from the Mac OS movie file into the corresponding Windows movie file (extension <code></code>.mov ), while storing the resource fork into a companion file with extension <code></code>.qtr (&#8221;QuickTime resources&#8221;). If a needed resource cannot be found in the <code></code>.mov file, the QTML resource-handling routines will automatically look for a matching <code></code>.qtr file and will attempt to locate the resource there. The drawback to this approach is that the user, when moving or copying a movie file from one place to another, must remember to move the matching resource file along with it. This is a nuisance to the user and is likely to lead to dissatisfaction with your application.</p>
<p>Fortunately, QuickTime supports another solution to the cross-platform resource problem. The QuickTime function  <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/FlattenMovie" target="_top">FlattenMovie</a></code>  allows you to create a <strong>single-fork</strong> <strong>movie</strong> <strong>file</strong>  with an empty resource fork and all of the resource data stored in the data fork instead. The resulting file can then be transported to Windows (or other platforms) without losing any of the movie&#8217;s data. This is generally a better solution for cross-platform compatibility, since it requires the user to move one file instead of two.</p>
<p>In porting existing QuickTime applications from the Mac OS platform to Windows, the problem also arises of how to transport resources belonging to the application program itself. On the Mac OS platform, such resources normally reside in the resource fork of the application (<code>'APPL'</code> ) file. A utility named  RezWack, provided as part of the  QuickTime 3 Software Development Kit for Windows, incorporates these resources from the resource fork of the Mac OS version into the executable (<code></code>.exe ) file of the Windows version. The QTML resource-management routines will correctly locate and read in the resources from the application&#8217;s <code></code>.exe file.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2QuickTimeForWindows.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4WindowsUtilityRouti.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/QTforWindows/QTforWindows/C-Chapter/3BuildingQuickTimeCa.html%3Fid%3DTP40000940-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/QTforWindows/QTforWindows/C-Chapter/3BuildingQuickTimeCa.html%3Fid%3DTP40000940-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/QTforWindows/QTforWindows/C-Chapter/3BuildingQuickTimeCa.html%3Fid%3DTP40000940-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>