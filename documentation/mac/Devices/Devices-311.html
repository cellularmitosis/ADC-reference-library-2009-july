<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Power Manager(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING311></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-230.html"><B>Chapter 6 - Power Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING311-0></A>
<H1><A NAME=MARKER-9-374></A>Summary of the Power Manager</H1>
<A NAME=HEADING311-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING311-2></A>
<H3>Constants</H3>
<PRE>
CONST
   {Power Manager Gestalt selector}
   gestaltPowerMgrAttr        = 'powr';   {Power Manager attributes selector}

   {bit values in Gestalt response parameter}
   gestaltPMgrExists          = 0;     {Power Manager is present}
   gestaltPMgrCPUIdle         = 1;     {CPU can idle}
   gestaltPMgrSCC             = 2;     {can stop SCC clock}
   gestaltPMgrSound           = 3;     {can shut off sound circuits}
   gestaltPMgrDispatchExists  = 4;     {Power Manager dispatch exists }
   slpQType                   = 16;    {sleep queue type}
   sleepQType                 = 16;    {sleep queue type}
   {bit positions for ModemStatus}
   modemOnBit                 = 0;     {1 if modem is on}
   ringWakeUpBit              = 2;     {1 if ring wakeup is enabled}
   modemInstalledBit          = 3;     {1 if internal modem is installed}
   ringDetectBit              = 4;     {1 if incoming call is detected}
   modemOnHookBit             = 5;     {1 if modem is off hook}
   {masks for ModemStatus}
   modemOnMask                = $1;    {modem on}
   ringWakeUpMask             = $4;    {ring wakeup enabled}
   modemInstalledMask         = $8;    {internal modem installed}
   ringDetectMask             = $10;   {incoming call detected}
   modemOnHookMask            = $20;   {modem off hook}
   {bit positions for BatteryStatus}
   chargerConnBit             = 0;     {1 if charger is connected}
   hiChargeBit                = 1;     {1 if charging at hicharge rate}
   chargeOverFlowBit          = 2;     {1 if hicharge counter has overflowed}
   batteryDeadBit             = 3;     {always 0}
   batteryLowBit              = 4;     {1 if battery is low}
   connChangedBit             = 5;     {1 if charger connection has changed}
{masks for BatteryStatus}
chargerConnMask      = $1;    {charger is connected}
hiChargeMask         = $2;    {charging at hicharge rate}
chargeOverFlowMask   = $4;    {hicharge counter has overflowed}
batteryDeadMask      = $8;    {battery is dead}
batteryLowMask       = $10;   {battery is low}
connChangedMask      = $20;   {connection has changed}
{sleep procedure selector codes}
sleepRequest         = 1;     {sleep request}
sleepDemand          = 2;     {sleep demand}
sleepWakeUp          = 3;     {wakeup demand}
sleepRevoke          = 4;     {sleep-request revocation}
{bits in bitfield returned by PMFeatures}
hasWakeupTimer       = 0;  {1 = wakeup timer is supported}
hasSharedModemPort   = 1;  {1 = modem port shared by SCC and internal modem}
hasProcessorCycling  = 2;  {1 = processor cycling is supported}
mustProcessorCycle   = 3;  {1 = processor cycling should not be turned off}
hasReducedSpeed      = 4;  {1 = processor can be started up at reduced speed}
dynamicSpeedChange   = 5;  {1 = processor speed can be switched dynamically}
hasSCSIDiskMode      = 6;  {1 = SCSI Disk Mode is supported}
canGetBatteryTime    = 7;  {1 = battery time can be calculated}
canWakeupOnRing      = 8;  {1 = can wakeup when the modem detects a ring}
hasDimmingSupport    = 9;  {1 = has dimming support built into the ROM}

{bits in BatteryInfo.flags}
batteryInstalled     = 7;  {1 = battery is currently connected}
batteryCharging      = 6;  {1 = battery is being charged}
chargerConnected     = 5;  {1 = charger is connected to the PowerBook }
                           { (this does not mean the charger is plugged in)}

{bits in bitfield returned by GetIntModemInfo}
hasInternalModem     = 0;  {1 = internal modem installed}
intModemRingDetect   = 1;  {1 = internal modem has detected a ring}
intModemOffHook      = 2;  {1 = internal modem is off hook}
intModemRingWakeEnb  = 3;  {1 = wakeup on ring is enabled}
extModemSelected     = 4;  {1 = external modem selected}

modemSetBit          = 15; {1 = set bit, 0=clear bit}

HDPwrQType           ='HD';{hard disk notification queue element type}
</PRE>
<A NAME=HEADING311-11></A>
<H3>Data Types</H3>
<PRE>
TYPE SleepQRec = 
   RECORD
      sleepQLink:    SleepQRecPtr;  {next queue element}
      sleepQType:    Integer;       {queue type = 16}
      sleepQProc:    ProcPtr;       {pointer to sleep procedure}
      sleepQFlags:   Integer;       {reserved}
   END;
   SleepQRecPtr = ^SleepQRec;
TYPE HDQueueElement = 
   RECORD
      hdQLink:       Ptr;           {pointer to next queue element}
      hdQType:       Integer;       {queue element type (must be HDQType)}
      hdFlags:       Integer;       {miscellaneous flags}
      hdProc:        ProcPtr;       {pointer to routine to call}
      hdUser:        LongInt;       {user-defined (variable storage, etc.)}
   END;
TYPE WakeupTime = 
   PACKED RECORD
      wakeTime:      LongInt;       {wakeup time (same format as time)}
      wakeEnabled:   Byte;          {1 = enable, 0=disable wakeup timer}
   END;
TYPE BatteryInfo = 
   PACKED RECORD
      flags:         Byte;          {misc flags (see above)}
      warningLevel:  Byte;          {scaled warning level (0-255)}
      reserved:      Byte;          {reserved for internal use}
      batteryLevel:  Byte;          {scaled battery level (0-255)}
   END;
TYPE BatteryTimeRec = 
   RECORD

      expectedBatteryTime: LongInt; {estimated battery time remaining}
      minimumBatteryTime:  LongInt; {minimum battery time remaining}
      maximumBatteryTime:  LongInt; {maximum battery time remaining}
      timeUntilCharged:    LongInt; {time until battery is fully charged}
   END;
</PRE>
<A NAME=HEADING311-17></A>
<H3>Power Manager Routines</H3>
<A NAME=HEADING311-18></A>
<H4>Controlling the Idle State</H4>
<PRE>
FUNCTION IdleUpdate   : LongInt;
PROCEDURE EnableIdle;
PROCEDURE DisableIdle;
FUNCTION GetCPUSpeed  : LongInt;
</PRE>
<A NAME=HEADING311-23></A>
<H4>Controlling and Reading the Wakeup Timer</H4>
<PRE>
FUNCTION SetWUTime      (WUTime: LongInt): OSErr;
FUNCTION DisableWUTime  : OSErr;
FUNCTION GetWUTime      (VAR WUTime: LongInt; VAR WUFlag: Byte): OSErr;
</PRE>
<A NAME=HEADING311-27></A>
<H4>Controlling the Sleep Queue </H4>
<PRE>
PROCEDURE SleepQInstall   (qRecPtr: SleepQRecPtr);
PROCEDURE SleepQRemove    (qRecPtr: SleepQRecPtr);
</PRE>
<A NAME=HEADING311-30></A>
<H4>Controlling Serial Power </H4>
<PRE>
PROCEDURE AOn;
PROCEDURE AOnIgnoreModem;
PROCEDURE BOn;
PROCEDURE AOff;
PROCEDURE BOff;
</PRE>
<A NAME=HEADING311-36></A>
<H4>Reading the Status of the Internal Modem</H4>
<PRE>
FUNCTION ModemStatus     (VAR Status: Byte): OSErr;
</PRE>
<A NAME=HEADING311-38></A>
<H4>Reading the Status of the Battery and the Battery Charger</H4>
<PRE>
FUNCTION BatteryStatus   (VAR Status: Byte; VAR Power: Byte): OSErr;
</PRE>
<A NAME=HEADING311-40></A>
<H3>Power Manager Dispatch Routines</H3>
<A NAME=HEADING311-41></A>
<H4>Determining the Power Manager Features Available</H4>
<PRE>
FUNCTION PMSelectorCount  : Integer;
FUNCTION PMFeatures       : LongInt;
</PRE>
<A NAME=HEADING311-44></A>
<H4>Controlling the Sleep and Wakeup Timers</H4>
<PRE>
FUNCTION GetSleepTimeout           : Byte;
PROCEDURE SetSleepTimeout          (timeout : Byte);
PROCEDURE AutoSleepControl         (enableSleep : Boolean);
FUNCTION IsAutoSlpControlDisabled  () : Boolean;
PROCEDURE GetWakeupTimer           (VAR theTime : WakeupTime);
PROCEDURE SetWakeupTimer           (theTime : WakeupTime);
</PRE>
<A NAME=HEADING311-51></A>
<H4>Controlling the Dimming Timer</H4>
<PRE>
FUNCTION GetDimmingTimeout         () : Byte;
PROCEDURE SetDimmingTimeout        (timeout : Byte);
PROCEDURE DimmingControl           (enableDimming : Boolean);
FUNCTION IsDimmingControlDisabled  () : Boolean;
</PRE>
<A NAME=HEADING311-56></A>
<H4>Controlling the Hard Disk</H4>
<PRE>
FUNCTION GetHardDiskTimeout        : Byte;
PROCEDURE SetHardDiskTimeout       (timeout : Byte);
FUNCTION HardDiskPowered           : Boolean;
PROCEDURE SpinDownHardDisk;
FUNCTION IsSpindownDisabled        : Boolean;
PROCEDURE SetSpindownDisable       (setDisable : BOOLEAN);
FUNCTION HardDiskQInstall          (VAR theElement : HDQueueElement) : OSErr;
FUNCTION HardDiskQRemove           (VAR theElement : HDQueueElement) : OSErr;
</PRE>
<A NAME=HEADING311-65></A>
<H4>Getting Information About the Battery</H4>
<PRE>
PROCEDURE GetScaledBatteryInfo      (whichBattery : Integer; VAR theInfo : 
BatteryInfo);
FUNCTION BatteryCount : Integer;
FUNCTION GetBatteryVoltage          (whichBattery : Integer) : Fixed;
PROCEDURE GetBatteryTimes           (whichBattery : INTEGER; VAR theTimes : 
                                     BatteryTimeRec);
</PRE>
<A NAME=HEADING311-70></A>
<H4>Controlling the Internal Modem</H4>
<PRE>
FUNCTION GetIntModemInfo    : LongInt;
PROCEDURE SetIntModemState  (theState : Integer);
</PRE>
<A NAME=HEADING311-73></A>
<H4>Controlling the Processor</H4>
<PRE>
FUNCTION MaximumProcessorSpeed      : Integer;
FUNCTION CurrentProcessorSpeed      : Integer;
FUNCTION FullProcessorSpeed         : Boolean;
FUNCTION SetProcessorSpeed          (fullSpeed : Boolean) : Boolean;
FUNCTION IsProcessorCyclingEnabled  : Boolean;
PROCEDURE EnableProcessorCycling    (enable : Boolean);
</PRE>
<A NAME=HEADING311-80></A>
<H4>Getting and Setting the SCSI ID</H4>
<PRE>
FUNCTION GetSCSIDiskModeAddress     : Integer;
PROCEDURE SetSCSIDiskModeAddress    (scsiAddress : Integer);
</PRE>
<A NAME=HEADING311-83></A>
<H3>Application-Defined Routines</H3>
<PRE>
PROCEDURE MySleepProc;
PROCEDURE MyHDSpindownProc  (theElement : HDQueueElement);
</PRE>
<A NAME=HEADING311-86></A>
<H2>C Summary</H2>
<A NAME=HEADING311-87></A>
<H3>Constants and Data Types</H3>
<PRE>
/* Power Manager Gestalt selector */
#define gestaltPowerMgrAttr 'powr'  /* Power Manager attributes selector */

/* bit values in Gestalt response parameter */
enum {
   gestaltPMgrExists          = 0,     /* Power Manager is present */
   gestaltPMgrCPUIdle         = 1,     /* CPU can idle */
   gestaltPMgrSCC             = 2,     /* can stop SCC clock */
   gestaltPMgrSound           = 3,     /* can shut off sound circuits */
   gestaltPMgrDispatchExists  = 4      /* Power Manager dispatch exists */
};
enum {
   slpQType                   = 16,    /* sleep queue type */
   sleepQType                 = 16     /* sleep queue type */
};
enum {
   /* bit positions for ModemStatus */
   modemOnBit                 = 0,     /* 1 if modem is on */
   ringWakeUpBit              = 2,     /* 1 if ring wakeup is enabled */
   modemInstalledBit       = 3,     /* 1 if internal modem is installed */
   ringDetectBit           = 4,     /* 1 if incoming call is detected */
   modemOnHookBit          = 5,     /* 1 if modem is off hook */
   /* masks for ModemStatus */
   modemOnMask             = 0x1,   /* modem on */
   ringWakeUpMask          = 0x4,   /* ring wakeup enabled */
   modemInstalledMask      = 0x8,   /* internal modem installed */
   ringDetectMask          = 0x10,  /* incoming call detected */
   modemOnHookMask         = 0x20,  /* modem off hook */
   /* bit positions for BatteryStatus */
   chargerConnBit          = 0,     /* 1 if charger is connected */
   hiChargeBit             = 1,     /* 1 if charging at hicharge rate */
   chargeOverFlowBit       = 2,     /* 1 if hicharge counter has overflowed */
   batteryDeadBit          = 3,     /* always 0 */
   batteryLowBit           = 4,     /* 1 if battery is low */
   connChangedBit          = 5,     /* 1 if charger connection has changed */
   /* masks for BatteryStatus */
   chargerConnMask         = 0x1,   /* charger is connected */
   hiChargeMask            = 0x2,   /* charging at hicharge rate */
   chargeOverFlowMask      = 0x4,   /* hicharge counter has overflowed */
   batteryDeadMask         = 0x8,   /* battery is dead */
   batteryLowMask          = 0x10,  /* battery is low */
   connChangedMask         = 0x20,  /* connection has changed */
   /* sleep procedure selector codes */
   sleepRequest            = 1,     /* sleep request */
   sleepDemand             = 2,     /* sleep demand */
   sleepWakeUp             = 3,     /* wakeup demand */
   sleepRevoke             = 4      /* sleep-request revocation */
};
/* bits in bitfield returned by PMFeatures */
#define hasWakeupTimer 0            /* 1 = wakeup timer is supported */
#define hasSharedModemPort 1        /* 1 = modem port shared by SCC and */
                                    /*  internal modem */
#define hasProcessorCycling 2       /* 1 = processor cycling is supported */
#define mustProcessorCycle 3        /* 1 = processor cycling should not be */
                                    /*  turned off */
#define hasReducedSpeed 4           /* 1 = processor can be started up at */
                                    /*  reduced speed */
#define dynamicSpeedChange 5        /* 1 = processor speed can be */
                                    /* switched dynamically */
#define hasSCSIDiskMode 6     /* 1 = SCSI Disk Mode is supported */
#define canGetBatteryTime 7   /* 1 = battery time can be calculated */
#define canWakeupOnRing 8     /* 1 = can wakeup when the modem detects */
                              /*  a ring */
#define hasDimmingSupport 9   /* 1 = has dimming support built into the ROM */
/* bits in bitfield returned by GetIntModemInfo and set by SetIntModemState */
#define hasInternalModem 0    /* 1 = internal modem installed */
#define intModemRingDetect 1  /* 1 = internal modem has detected a ring */
#define intModemOffHook 2     /* 1 = internal modem is off hook */
#define intModemRingWakeEnb 3 /* 1 = wakeup on ring is enabled */
#define extModemSelected 4    /* 1 = external modem selected */

#define modemSetBit 15        /* 1 = set bit, 0=clear bit (SetIntModemState) */
/* bits in BatteryInfo.flags */
#define batteryInstalled 7    /* 1 = battery is currently connected */
#define batteryCharging 6     /* 1 = battery is being charged */
#define chargerConnected 5    /* 1 = charger is connected to the PowerBook */
                              /*  (this does not mean the charger is */
                              /*  plugged in) */
struct SleepQRec {
   struct SleepQRec  *sleepQLink;   /* next queue element */
   short             sleepQType;    /* queue type = 16 */
   ProcPtr           sleepQProc;    /* pointer to sleep procedure */
   short             sleepQFlags;   /* reserved */
};
typedef struct SleepQRec SleepQRec;
typedef SleepQRec *SleepQRecPtr;
/* hard disk spindown notification queue element */
typedef struct HDQueueElement HDQueueElement;

typedef pascal void (*HDSpindownProc)(HDQueueElement *theElement);

struct HDQueueElement {
   Ptr hdQLink;            /* pointer to next queue element */
   short hdQType;          /* queue element type (must be HDQType) */
   short hdFlags;          /* miscellaneous flags */
   HDSpindownProc hdProc;  /* pointer to routine to call */
   long hdUser;            /* user-defined private storage */
};
#define HDPwrQType 'HD'    /* queue element type */
/* wakeup time record */
typedef struct WakeupTime {
   unsigned long wakeTime;    /* wakeup time (same format as current time) */
   char wakeEnabled;          /* 1 = enable wakeup timer, 0=disable */
} WakeupTime;
/* battery time information (in seconds) */
typedef struct BatteryTimeRec {
   unsigned long expectedBatteryTime; /* estimated battery time remaining */
   unsigned long inimumBatteryTime;  /* minimum battery time remaining */
   unsigned long maximumBatteryTime; /* maximum battery time remaining */
   unsigned long timeUntilCharged;   /* time until battery is fully charged */
} BatteryTimeRec;
</PRE>
<A NAME=HEADING311-103></A>
<H3>Power Manager Functions</H3>
<A NAME=HEADING311-104></A>
<H4>Controlling the Idle State</H4>
<PRE>
pascal long IdleUpdate   (void);
pascal void EnableIdle   (void);
pascal void DisableIdle  (void);
pascal long GetCPUSpeed  (void);
</PRE>
<A NAME=HEADING311-109></A>
<H4>Controlling and Reading the Wakeup Timer</H4>
<PRE>
pascal OSErr SetWUTime       (long WUTime);
pascal OSErr DisableWUTime   (void);
pascal OSErr GetWUTime       (long *WUTime, Byte *WUFlag);
</PRE>
<A NAME=HEADING311-113></A>
<H4>Controlling the Sleep Queue </H4>
<PRE>
pascal void SleepQInstall  (SleepQRecPtr qRecPtr);
pascal void SleepQRemove   (SleepQRecPtr qRecPtr);
</PRE>
<A NAME=HEADING311-116></A>
<H4>Controlling Serial Power </H4>
<PRE>
pascal void AOn             (void);
pascal void AOnIgnoreModem  (void);
pascal void BOn             (void);
pascal void AOff            (void);
pascal void BOff            (void);
</PRE>
<A NAME=HEADING311-122></A>
<H4>Reading the Status of the Internal Modem</H4>
<PRE>
pascal OSErr ModemStatus    (Byte *Status);
</PRE>
<A NAME=HEADING311-124></A>
<H4>Reading the Status of the Battery and the Battery Charger</H4>
<PRE>
pascal OSErr BatteryStatus  (Byte *Status, Byte *Power);
</PRE>
<A NAME=HEADING311-126></A>
<H3>Power Manager Dispatch Functions</H3>
<A NAME=HEADING311-127></A>
<H4>Determining the Power Manager Features Available</H4>
<PRE>
short PMSelectorCount       (void);
unsigned long PMFeatures    (void);
</PRE>
<A NAME=HEADING311-130></A>
<H4>Controlling the Sleep and Wakeup Timers</H4>
<PRE>
unsigned char GetSleepTimeout     (void);
void SetSleepTimeout              (unsigned char timeout);
void AutoSleepControl             (Boolean enableSleep);
Boolean IsAutoSlpControlDisabled  (void);
void GetWakeupTimer               (WakeupTime *theTime);
void SetWakeupTimer               (WakeupTime *theTime);
</PRE>
<A NAME=HEADING311-137></A>
<H4>Controlling the Dimming Timer</H4>
<PRE>
unsigned char GetDimmingTimeout   (void);
void SetDimmingTimeout            (unsigned char timeout);
void DimmingControl               (Boolean enableDimming);
Boolean IsDimmingControlDisabled  (void);
</PRE>
<A NAME=HEADING311-142></A>
<H4>Controlling the Hard Disk</H4>
<PRE>
unsigned char GetHardDiskTimeout  (void);
void SetHardDiskTimeout           (unsigned char timeout);
Boolean HardDiskPowered           (void);
void SpinDownHardDisk             (void);
Boolean IsSpindownDisabled        (void);
void SetSpindownDisable           (Boolean setDisable);
OSErr HardDiskQInstall            (HDQueueElement *theElement);
OSErr HardDiskQRemove             (HDQueueElement *theElement);
</PRE>
<A NAME=HEADING311-151></A>
<H4>Getting Information About the Battery</H4>
<PRE>
void GetScaledBatteryInfo      (short whichBattery, BatteryInfo *theInfo);
short BatteryCount             (void);
Fixed GetBatteryVoltage        (short whichBattery);
void GetBatteryTimes           (short whichBattery, BatteryTimeRec *theTimes);
</PRE>
<A NAME=HEADING311-156></A>
<H4>Controlling the Internal Modem</H4>
<PRE>
unsigned long GetIntModemInfo  (void);
void SetIntModemState          (short theState);
</PRE>
<A NAME=HEADING311-159></A>
<H4>Controlling the Processor</H4>
<PRE>
short MaximumProcessorSpeed        (void);
short CurrentProcessorSpeed        (void);
Boolean FullProcessorSpeed         (void);
Boolean SetProcessorSpeed          (Boolean fullSpeed);
Boolean IsProcessorCyclingEnabled  (void);
void EnableProcessorCycling        (Boolean enable);
</PRE>
<A NAME=HEADING311-166></A>
<H4>Getting and Setting the SCSI ID</H4>
<PRE>
short GetSCSIDiskModeAddress  (void);
void SetSCSIDiskModeAddress   (short scsiAddress);
</PRE>
<A NAME=HEADING311-169></A>
<H3>Application-Defined Functions</H3>
<PRE>
void MySleepProc        (void);
void (*HDSpindownProc)  (HDQueueElement *theElement);
</PRE>
<A NAME=HEADING311-172></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING311-173></A>
<H3>Data Structures</H3>
<A NAME=HEADING311-174></A>
<H4>Sleep Queue Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>sleepQLink<TD>long<TD>pointer to next element in the queue<TR>
<TD>4<TD>sleepQType<TD>word<TD>queue type (should be 16)<TR>
<TD>6<TD>sleepQProc<TD>long<TD>pointer to a sleep procedure<TR>
<TD>10<TD>sleepQFlags<TD>word<TD>reserved</TABLE>
</H4>
<A NAME=HEADING311-175></A>
<H4>Hard Disk Queue Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>hdQLink<TD>long<TD>pointer to next element in the queue<TR>
<TD>4<TD>hdQType<TD>word<TD>queue type (should be <CODE>HDPwrQType</CODE>)<TR>
<TD>6<TD>hdFlags<TD>word<TD>reserved<TR>
<TD>8<TD>hdProc<TD>long<TD>pointer to a hard disk power-down procedure<TR>
<TD>12<TD>hdUser<TD>long<TD>user defined</TABLE>
</H4>
<A NAME=HEADING311-176></A>
<H4>Wakeup Time Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>wakeTime<TD>long<TD>wakeup time in seconds since 00:00:00, 1/1/1904<TR>
<TD>4<TD>wakeEnabled<TD>byte<TD>1 = enable wakeup timer, 0 = disable timer</TABLE>
</H4>
<A NAME=HEADING311-177></A>
<H4>Battery Information Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>flags<TD>byte<TD>flags<TR>
<TD>1<TD>warningLevel<TD>byte<TD>scaled warning level (0--255)<TR>
<TD>2<TD>reserved<TD>byte<TD>reserved<TR>
<TD>3<TD>batteryLevel<TD>byte<TD>scaled battery level (0--255)</TABLE>
</H4>
<A NAME=HEADING311-178></A>
<H4>Battery Time Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>expectedBatteryTime<TD>long<TD>estimated battery time remaining in seconds<TR>
<TD>4<TD>minimumBatteryTime<TD>long<TD>minimum battery time remaining<TR>
<TD>8<TD>maximumBatteryTime<TD>long<TD>maximum battery time remaining<TR>
<TD>12<TD>timeUntilCharged<TD>long<TD>time remaining until battery is fully charged</TABLE>
</H4>
<A NAME=HEADING311-179></A>
<H3>Trap Macros</H3>
<A NAME=HEADING311-180></A>
<H4>Trap Macros Requiring Routine Selectors</H4>
<PRE>
_IdleState
</PRE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>0<TD><CODE>EnableIdle</CODE><TR>
<TD>Any positive number<TD><CODE>DisableIdle</CODE><TR>
<TD>Any negative number<TD><CODE>GetCPUSpeed</CODE></TABLE>

<PRE>
_SerialPower
</PRE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>$04<TD><CODE>AOn</CODE><TR>
<TD>$05<TD><CODE>AOnIgnoreModem</CODE><TR>
<TD>$00<TD><CODE>BOn</CODE><TR>
<TD>$84<TD><CODE>AOff</CODE><TR>
<TD>$80<TD><CODE>BOff</CODE></TABLE>

<PRE>
_PowerMgrDispatch
</PRE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>$00<TD><CODE>PMSelectorCount</CODE><TR>
<TD>$01<TD><CODE>PMFeatures</CODE><TR>
<TD>$02<TD><CODE>GetSleepTimeout</CODE><TR>
<TD>$03<TD><CODE>SetSleepTimeout</CODE><TR>
<TD>$04<TD><CODE>GetHardDiskTimeout</CODE><TR>
<TD>$05<TD><CODE>SetHardDiskTimeout</CODE><TR>
<TD>$06<TD><CODE>HardDiskPowered</CODE><TR>
<TD>$07<TD><CODE>SpinDownHardDisk</CODE><TR>
<TD>$08<TD><CODE>IsSpindownDisabled</CODE><TR>
<TD>$09<TD><CODE>SetSpindownDisable</CODE><TR>
<TD>$0A<TD><CODE>HardDiskQInstall</CODE><TR>
<TD>$0B<TD><CODE>HardDiskQRemove</CODE><TR>
<TD>$0C<TD><CODE>GetScaledBatteryInfo</CODE><TR>
<TD>$0D<TD><CODE>AutoSleepControl</CODE><TR>
<TD>$0E<TD><CODE>GetIntModemInfo</CODE><TR>
<TD>$0F<TD><CODE>SetIntModemState</CODE><TR>
<TD>$10<TD><CODE>MaximumProcessorSpeed</CODE><TR>
<TD>$11<TD><CODE>CurrentProcessorSpeed</CODE><TR>
<TD>$12<TD><CODE>FullProcessorSpeed</CODE><TR>
<TD>$13<TD><CODE>SetProcessorSpeed</CODE><TR>
<TD>$14<TD><CODE>GetSCSIDiskModeAddress</CODE><TR>
<TD>$15<TD><CODE>SetSCSIDiskModeAddress</CODE><TR>
<TD>$16<TD><CODE>GetWakeupTimer</CODE><TR>
<TD>$17<TD><CODE>SetWakeupTimer</CODE><TR>
<TD>$18<TD><CODE>IsProcessorCyclingEnabled</CODE><TR>
<TD>$19<TD><CODE>EnableProcessorCycling</CODE><TR>
<TD>$1A<TD><CODE>BatteryCount</CODE><TR>
<TD>$1B<TD><CODE>GetBatteryVoltage</CODE><TR>
<TD>$1C<TD><CODE>GetBatteryTimes</CODE><TR>
<TD>$1D<TD><CODE>GetDimmingTimeout</CODE><TR>
<TD>$1E<TD><CODE>SetDimmingTimeout</CODE><TR>
<TD>$1F<TD><CODE>DimmingControl</CODE><TR>
<TD>$20<TD><CODE>IsDimmingControlDisabled</CODE><TR>
<TD>$21<TD><CODE>IsAutoSlpControlDisabled</CODE>
</TABLE>

<A NAME=HEADING311-184></A>
<H2>Result Codes</H2>
<TABLE BORDER="0" CELLPADDING=3>
<TD><CODE>noErr</CODE><TD>0<TD>No error<TR>
<TD><CODE>pmBusyErr</CODE><TD>-13000<TD>Power Manager IC stuck busy<TR>
<TD><CODE>pmReplyTOErr</CODE><TD>-13001<TD>Timed out waiting to begin reply handshake<TR>
<TD><CODE>pmSendStartErr</CODE><TD>-13002<TD>Power Manager IC did not start handshake<TR>
<TD><CODE>pmSendEndErr</CODE><TD>-13003<TD>During send, Power Manager did not finish handshake<TR>
<TD><CODE>pmRecvStartErr</CODE><TD>-13004<TD>During receive, Power Manager did not start handshake<TR>
<TD><CODE>pmRecvEndErr</CODE><TD>-13005<TD>During receive, Power Manager did not finish handshake</TABLE>
<A NAME=MARKER-2-375></A>
</BLOCKQUOTE><P>

<HR>
<center>
<A HREF="Devices-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
