<html><head><title>Mac OS X
 Manual Page For perlos2(1)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/1/perlos2" title="Mac OS X
 Manual Page for perlos2(1)"><!-- headerDoc=man; indexgroup=Section 1; uid="//apple_ref/doc/man/1/perlos2"; name=perlos2(1) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
PERLOS2(1)                            Perl Programmers Reference Guide                            PERLOS2(1)



<b>NAME</b>
       perlos2 - Perl under OS/2, DOS, Win0.3*, Win0.95 and WinNT.

<b>SYNOPSIS</b>
       One can read this document in the following formats:

               man perlos2
               view perl perlos2
               explorer perlos2.html
               info perlos2

       to list some (not all may be available simultaneously), or it may be read <u>as</u> <u>is</u>: either as
       <u>README.os2</u>, or <u>pod/perlos2.pod</u>.

       To read the <u>.INF</u> version of documentation (<b>very</b> recommended) outside of OS/2, one needs an IBM's
       reader (may be available on IBM ftp sites (?)  (URL anyone?)) or shipped with PC DOS 7.0 and IBM's
       Visual Age C++ 3.5.

       A copy of a Win* viewer is contained in the "Just add OS/2 Warp" package

         <a href="ftp://ftp.software.ibm.com/ps/products/os2/tools/jaow/jaow.zip">ftp://ftp.software.ibm.com/ps/products/os2/tools/jaow/jaow.zip</a>

       in <u>?:\JUST</u><b>_</b><u>ADD\view.exe</u>. This gives one an access to EMX's <u>.INF</u> docs as well (text form is available
       in <u>/emx/doc</u> in EMX's distribution).  There is also a different viewer named xview.

       Note that if you have <u>lynx.exe</u> or <u>netscape.exe</u> installed, you can follow WWW links from this document
       in <u>.INF</u> format. If you have EMX docs installed correctly, you can follow library links (you need to
       have "view emxbook" working by setting "EMXBOOK" environment variable as it is described in EMX
       docs).

<b>DESCRIPTION</b>
       <b>Target</b>

       The target is to make OS/2 one of the best supported platform for using/building/developing Perl and
       <u>Perl</u> <u>applications</u>, as well as make Perl the best language to use under OS/2. The secondary target is
       to try to make this work under DOS and Win* as well (but not <b>too</b> hard).

       The current state is quite close to this target. Known limitations:

           Some *nix programs use <u>fork()</u> a lot; with the mostly useful flavors of perl for OS/2 (there are
            several built simultaneously) this is supported; but some flavors do not support this (e.g.,
            when Perl is called from inside REXX).  Using <u>fork()</u> after <u>use</u>ing dynamically loading extensions
            would not work with <u>very</u> old versions of EMX.

           You need a separate perl executable <u>perl</u><b>__</b><u>.exe</u> (see perl__.exe) if you want to use PM code in
            your application (as Perl/Tk or OpenGL Perl modules do) without having a text-mode window
            present.

            While using the standard <u>perl.exe</u> from a text-mode window is possible too, I have seen cases
            when this causes degradation of the system stability.  Using <u>perl</u><b>__</b><u>.exe</u> avoids such a degrada-
            tion.

           There is no simple way to access WPS objects. The only way I know is via "OS2::REXX" and "SOM"
            extensions (see OS2::REXX, Som).  However, we do not have access to convenience methods of
            Object-REXX. (Is it possible at all? I know of no Object-REXX API.)  The "SOM" extension (cur-
            rently in alpha-text) may eventually remove this shortcoming; however, due to the fact that DII
            is not supported by the "SOM" module, using "SOM" is not as convenient as one would like it.

       Please keep this list up-to-date by informing me about other items.

       <b>Other</b> <b>OSes</b>

       Since OS/2 port of perl uses a remarkable EMX environment, it can run (and build extensions, and -
       possibly - be built itself) under any environment which can run EMX. The current list is DOS,
       DOS-inside-OS/2, Win0.3*, Win0.95 and WinNT. Out of many perl flavors, only one works, see
       "perl_.exe".

       Note that not all features of Perl are available under these environments. This depends on the fea-
       tures the <u>extender</u> - most probably RSX - decided to implement.

       Cf. Prerequisites.

       <b>Prerequisites</b>


       EMX   EMX runtime is required (may be substituted by RSX). Note that it is possible to make <u>perl</u><b>_</b><u>.exe</u>
             to run under DOS without any external support by binding <u>emx.exe</u>/<u>rsx.exe</u> to it, see emxbind.
             Note that under DOS for best results one should use RSX runtime, which has much more functions
             working (like "fork", "popen" and so on). In fact RSX is required if there is no VCPI present.
             Note the RSX requires DPMI.  Many implementations of DPMI are known to be very buggy, beware!

             Only the latest runtime is supported, currently "0.9d fix 03". Perl may run under earlier ver-
             sions of EMX, but this is not tested.

             One can get different parts of EMX from, say

               <a href="http://www.leo.org/pub/comp/os/os2/leo/gnu/emx+gcc/">http://www.leo.org/pub/comp/os/os2/leo/gnu/emx+gcc/</a>
               <a href="http://powerusersbbs.com/pub/os2/dev/">http://powerusersbbs.com/pub/os2/dev/</a>   [EMX+GCC Development]
               <a href="http://hobbes.nmsu.edu/pub/os2/dev/emx/v0.9d/">http://hobbes.nmsu.edu/pub/os2/dev/emx/v0.9d/</a>

             The runtime component should have the name <u>emxrt.zip</u>.

             <b>NOTE</b>. When using <u>emx.exe</u>/<u>rsx.exe</u>, it is enough to have them on your path. One does not need to
             specify them explicitly (though this

               emx perl_.exe -de 0

             will work as well.)

       RSX   To run Perl on DPMI platforms one needs RSX runtime. This is needed under DOS-inside-OS/2,
             Win0.3*, Win0.95 and WinNT (see "Other OSes"). RSX would not work with VCPI only, as EMX would,
             it requires DMPI.

             Having RSX and the latest <u>sh.exe</u> one gets a fully functional <b>*nix</b>-ish environment under DOS,
             say, "fork", `` and pipe-"open" work. In fact, MakeMaker works (for static build), so one can
             have Perl development environment under DOS.

             One can get RSX from, say

               <a href="ftp://ftp.cdrom.com/pub/os2/emx09c/contrib">ftp://ftp.cdrom.com/pub/os2/emx09c/contrib</a>
               <a href="ftp://ftp.uni-bielefeld.de/pub/systems/msdos/misc">ftp://ftp.uni-bielefeld.de/pub/systems/msdos/misc</a>
               <a href="ftp://ftp.leo.org/pub/comp/os/os2/leo/devtools/emx+gcc/contrib">ftp://ftp.leo.org/pub/comp/os/os2/leo/devtools/emx+gcc/contrib</a>

             Contact the author on "rainer@mathematik.uni-bielefeld.de".

             The latest <u>sh.exe</u> with DOS hooks is available in

               <a href="http://www.ilyaz.org/software/os2/">http://www.ilyaz.org/software/os2/</a>

             as <u>sh</u><b>_</b><u>dos.zip</u> or under similar names starting with "sh", "pdksh" etc.

       HPFS  Perl does not care about file systems, but the perl library contains many files with long
             names, so to install it intact one needs a file system which supports long file names.

             Note that if you do not plan to build the perl itself, it may be possible to fool EMX to trun-
             cate file names. This is not supported, read EMX docs to see how to do it.

       pdksh To start external programs with complicated command lines (like with pipes in between, and/or
             quoting of arguments), Perl uses an external shell. With EMX port such shell should be named
             <u>sh.exe</u>, and located either in the wired-in-during-compile locations (usually <u>F:/bin</u>), or in
             configurable location (see "PERL_SH_DIR").

             For best results use EMX pdksh. The standard binary (5.2.14 or later) runs under DOS (with RSX)
             as well, see

               <a href="http://www.ilyaz.org/software/os2/">http://www.ilyaz.org/software/os2/</a>

       <b>Starting</b> <b>Perl</b> <b>programs</b> <b>under</b> <b>OS/2</b> <b>(and</b> <b>DOS</b> <b>and...)</b>

       Start your Perl program <u>foo.pl</u> with arguments "arg1 arg2 arg3" the same way as on any other platform,
       by

               perl foo.pl arg1 arg2 arg3

       If you want to specify perl options "-my_opts" to the perl itself (as opposed to your program), use

               perl -my_opts foo.pl arg1 arg2 arg3

       Alternately, if you use OS/2-ish shell, like CMD or 4os2, put the following at the start of your perl
       script:

               extproc perl -S -my_opts

       rename your program to <u>foo.cmd</u>, and start it by typing

               foo arg1 arg2 arg3

       Note that because of stupid OS/2 limitations the full path of the perl script is not available when
       you use "extproc", thus you are forced to use "-S" perl switch, and your script should be on the
       "PATH". As a plus side, if you know a full path to your script, you may still start it with

               perl ../../blah/foo.cmd arg1 arg2 arg3

       (note that the argument "-my_opts" is taken care of by the "extproc" line in your script, see
       ""extproc" on the first line").

       To understand what the above <u>magic</u> does, read perl docs about "-S" switch - see perlrun, and cmdref
       about "extproc":

               view perl perlrun
               man perlrun
               view cmdref extproc
               help extproc

       or whatever method you prefer.

       There are also endless possibilities to use <u>executable</u> <u>extensions</u> of 4os2, <u>associations</u> of WPS and so
       on... However, if you use *nixish shell (like <u>sh.exe</u> supplied in the binary distribution), you need
       to follow the syntax specified in "Switches" in perlrun.

       Note that <b>-S</b> switch supports scripts with additional extensions <u>.cmd</u>, <u>.btm</u>, <u>.bat</u>, <u>.pl</u> as well.

       <b>Starting</b> <b>OS/2</b> <b>(and</b> <b>DOS)</b> <b>programs</b> <b>under</b> <b>Perl</b>

       This is what <u>system()</u> (see "system" in perlfunc), `` (see "I/O Operators" in perlop), and <u>open</u> <u>pipe</u>
       (see "open" in perlfunc) are for. (Avoid <u>exec()</u> (see "exec" in perlfunc) unless you know what you
       do).

       Note however that to use some of these operators you need to have a sh-syntax shell installed (see
       "Pdksh", "Frequently asked questions"), and perl should be able to find it (see "PERL_SH_DIR").

       The cases when the shell is used are:

       1   One-argument <u>system()</u> (see "system" in perlfunc), <u>exec()</u> (see "exec" in perlfunc) with redirect-
           ion or shell meta-characters;

       2   Pipe-open (see "open" in perlfunc) with the command which contains redirection or shell
           meta-characters;

       3   Backticks `` (see "I/O Operators" in perlop) with the command which contains redirection or shell
           meta-characters;

       4   If the executable called by <u>system()</u>/<u>exec()</u>/pipe-<u>open()</u>/`` is a script with the "magic" "#!" line
           or "extproc" line which specifies shell;

       5   If the executable called by <u>system()</u>/<u>exec()</u>/pipe-<u>open()</u>/`` is a script without "magic" line, and
           $ENV{EXECSHELL} is set to shell;

       6   If the executable called by <u>system()</u>/<u>exec()</u>/pipe-<u>open()</u>/`` is not found (is not this remark obso-
           lete?);

       7   For globbing (see "glob" in perlfunc, "I/O Operators" in perlop) (obsolete? Perl uses builtin
           globbing nowadays...).

       For the sake of speed for a common case, in the above algorithms backslashes in the command name are
       not considered as shell metacharacters.

       Perl starts scripts which begin with cookies "extproc" or "#!" directly, without an intervention of
       shell.  Perl uses the same algorithm to find the executable as <u>pdksh</u>: if the path on "#!" line does
       not work, and contains "/", then the directory part of the executable is ignored, and the executable
       is searched in <u>.</u> and on "PATH".  To find arguments for these scripts Perl uses a different algorithm
       than <u>pdksh</u>: up to 3 arguments are recognized, and trailing whitespace is stripped.

       If a script does not contain such a cooky, then to avoid calling <u>sh.exe</u>, Perl uses the same algorithm
       as <u>pdksh</u>: if $ENV{EXECSHELL} is set, the script is given as the first argument to this command, if
       not set, then "$ENV{COMSPEC} /c" is used (or a hardwired guess if $ENV{COMSPEC} is not set).

       When starting scripts directly, Perl uses exactly the same algorithm as for the search of script
       given by <b>-S</b> command-line option: it will look in the current directory, then on components of
       $ENV{PATH} using the following order of appended extensions: no extension, <u>.cmd</u>, <u>.btm</u>, <u>.bat</u>, <u>.pl</u>.

       Note that Perl will start to look for scripts only if OS/2 cannot start the specified application,
       thus "system 'blah'" will not look for a script if there is an executable file <u>blah.exe</u> <u>anywhere</u> on
       "PATH".  In other words, "PATH" is essentially searched twice: once by the OS for an executable, then
       by Perl for scripts.

       Note also that executable files on OS/2 can have an arbitrary extension, but <u>.exe</u> will be automati-
       cally appended if no dot is present in the name.  The workaround is as simple as that:  since <u>blah.</u>
       and <u>blah</u> denote the same file (at list on FAT and HPFS file systems), to start an executable residing
       in file <u>n:/bin/blah</u> (no extension) give an argument "n:/bin/blah." (dot appended) to <u>system()</u>.

       Perl will start PM programs from VIO (=text-mode) Perl process in a separate PM session; the opposite
       is not true: when you start a non-PM program from a PM Perl process, Perl would not run it in a sepa-
       rate session.  If a separate session is desired, either ensure that shell will be used, as in "system
       'cmd /c myprog'", or start it using optional arguments to <u>system()</u> documented in "OS2::Process" mod-
       ule.  This is considered to be a feature.

<b>Frequently</b> <b>asked</b> <b>questions</b>
       <b>"It</b> <b>does</b> <b>not</b> <b>work"</b>

       Perl binary distributions come with a <u>testperl.cmd</u> script which tries to detect common problems with
       misconfigured installations.  There is a pretty large chance it will discover which step of the
       installation you managed to goof.  ";-)"

       <b>I</b> <b>cannot</b> <b>run</b> <b>external</b> <b>programs</b>


          Did you run your programs with "-w" switch? See "2 (and DOS) programs under Perl" in Starting OS.

          Do you try to run <u>internal</u> shell commands, like `copy a b` (internal for <u>cmd.exe</u>), or `glob a*b`
           (internal for ksh)? You need to specify your shell explicitly, like `cmd /c copy a b`, since Perl
           cannot deduce which commands are internal to your shell.

       <b>I</b> <b>cannot</b> <b>embed</b> <b>perl</b> <b>into</b> <b>my</b> <b>program,</b> <b>or</b> <b>use</b> <u>perl.dll</u> <b>from</b> <b>my</b> <b>program.</b>


       Is your program EMX-compiled with "-Zmt -Zcrtdll"?
           Well, nowadays Perl DLL should be usable from a differently compiled program too...  If you can
           run Perl code from REXX scripts (see OS2::REXX), then there are some other aspect of interaction
           which are overlooked by the current hackish code to support differently-compiled principal pro-
           grams.

           If everything else fails, you need to build a stand-alone DLL for perl. Contact me, I did it
           once. Sockets would not work, as a lot of other stuff.

       Did you use ExtUtils::Embed?
           Some time ago I had reports it does not work.  Nowadays it is checked in the Perl test suite, so
           grep <u>./t</u> subdirectory of the build tree (as well as <u>*.t</u> files in the <u>./lib</u> subdirectory) to find
           how it should be done "correctly".

       <b>``</b> and pipe-"open" do not work under DOS.

       This may a variant of just "I cannot run external programs", or a deeper problem. Basically: you <u>need</u>
       RSX (see "Prerequisites") for these commands to work, and you may need a port of <u>sh.exe</u> which under-
       stands command arguments. One of such ports is listed in "Prerequisites" under RSX. Do not forget to
       set variable ""PERL_SH_DIR"" as well.

       DPMI is required for RSX.

       <b>Cannot</b> <b>start</b> <b>"find.exe</b> <b>"pattern"</b> <b>file"</b>

       The whole idea of the "standard C API to start applications" is that the forms "foo" and "foo" of
       program arguments are completely interchangable.  <u>find</u> breaks this paradigm;

         find "pattern" file
         find pattern file

       are not equivalent; <u>find</u> cannot be started directly using the above API.  One needs a way to surround
       the doublequotes in some other quoting construction, necessarily having an extra non-Unixish shell in
       between.

       Use one of

         system 'cmd', '/c', 'find "pattern" file';
         `cmd /c 'find "pattern" file'`

       This would start <u>find.exe</u> via <u>cmd.exe</u> via "sh.exe" via "perl.exe", but this is a price to pay if you
       want to use non-conforming program.

<b>INSTALLATION</b>
       <b>Automatic</b> <b>binary</b> <b>installation</b>

       The most convenient way of installing a binary distribution of perl is via perl installer
       <u>install.exe</u>. Just follow the instructions, and 99% of the installation blues would go away.

       Note however, that you need to have <u>unzip.exe</u> on your path, and EMX environment <u>running</u>. The latter
       means that if you just installed EMX, and made all the needed changes to <u>Config.sys</u>, you may need to
       reboot in between. Check EMX runtime by running

               emxrev

       Binary installer also creates a folder on your desktop with some useful objects.  If you need to
       change some aspects of the work of the binary installer, feel free to edit the file <u>Perl.pkg</u>.  This
       may be useful e.g., if you need to run the installer many times and do not want to make many interac-
       tive changes in the GUI.

       <b>Things</b> <b>not</b> <b>taken</b> <b>care</b> <b>of</b> <b>by</b> <b>automatic</b> <b>binary</b> <b>installation:</b>

       "PERL_BADLANG" may be needed if you change your codepage <u>after</u> perl installation, and the new value
                      is not supported by EMX. See "PERL_BADLANG".

       "PERL_BADFREE" see "PERL_BADFREE".

       <u>Config.pm</u>      This file resides somewhere deep in the location you installed your perl library, find
                      it out by

                        perl -MConfig -le "print $INC{'Config.pm'}"

                      While most important values in this file <u>are</u> updated by the binary installer, some of
                      them may need to be hand-edited. I know no such data, please keep me informed if you
                      find one.  Moreover, manual changes to the installed version may need to be accompa-
                      nied by an edit of this file.

       <b>NOTE</b>. Because of a typo the binary installer of 5.00305 would install a variable "PERL_SHPATH" into
       <u>Config.sys</u>. Please remove this variable and put "PERL_SH_DIR" instead.

       <b>Manual</b> <b>binary</b> <b>installation</b>

       As of version 5.00305, OS/2 perl binary distribution comes split into 11 components. Unfortunately,
       to enable configurable binary installation, the file paths in the zip files are not absolute, but
       relative to some directory.

       Note that the extraction with the stored paths is still necessary (default with unzip, specify "-d"
       to pkunzip). However, you need to know where to extract the files. You need also to manually change
       entries in <u>Config.sys</u> to reflect where did you put the files. Note that if you have some primitive
       unzipper (like "pkunzip"), you may get a lot of warnings/errors during unzipping. Upgrade to
       "(w)unzip".

       Below is the sample of what to do to reproduce the configuration on my machine.  In <u>VIEW.EXE</u> you can
       press "Ctrl-Insert" now, and cut-and-paste from the resulting file - created in the directory you
       started <u>VIEW.EXE</u> from.

       For each component, we mention environment variables related to each installation directory.  Either
       choose directories to match your values of the variables, or create/append-to variables to take into
       account the directories.

       Perl VIO and PM executables (dynamically linked)
            unzip perl_exc.zip *.exe *.ico -d f:/emx.add/bin
            unzip perl_exc.zip *.dll -d f:/emx.add/dll

          (have the directories with "*.exe" on PATH, and "*.dll" on LIBPATH);

       Perl_ VIO executable (statically linked)
            unzip perl_aou.zip -d f:/emx.add/bin

          (have the directory on PATH);

       Executables for Perl utilities
            unzip perl_utl.zip -d f:/emx.add/bin

          (have the directory on PATH);

       Main Perl library
            unzip perl_mlb.zip -d f:/perllib/lib

          If this directory is exactly the same as the prefix which was compiled into <u>perl.exe</u>, you do not
          need to change anything. However, for perl to find the library if you use a different path, you
          need to "set PERLLIB_PREFIX" in <u>Config.sys</u>, see "PERLLIB_PREFIX".

       Additional Perl modules
            unzip perl_ste.zip -d f:/perllib/lib/site_perl/5.8.8/

          Same remark as above applies.  Additionally, if this directory is not one of directories on @INC
          (and @INC is influenced by "PERLLIB_PREFIX"), you need to put this directory and subdirectory
          <u>./os2</u> in "PERLLIB" or "PERL5LIB" variable. Do not use "PERL5LIB" unless you have it set already.
          See "ENVIRONMENT" in perl.

          <b>[Check</b> <b>whether</b> <b>this</b> <b>extraction</b> <b>directory</b> <b>is</b> <b>still</b> <b>applicable</b> <b>with</b> <b>the</b> <b>new</b> <b>directory</b> <b>structure</b> <b>lay</b>-
          <b>out!]</b>

       Tools to compile Perl modules
            unzip perl_blb.zip -d f:/perllib/lib

          Same remark as for <u>perl</u><b>_</b><u>ste.zip</u>.

       Manpages for Perl and utilities
            unzip perl_man.zip -d f:/perllib/man

          This directory should better be on "MANPATH". You need to have a working <u>man</u> to access these
          files.

       Manpages for Perl modules
            unzip perl_mam.zip -d f:/perllib/man

          This directory should better be on "MANPATH". You need to have a working man to access these
          files.

       Source for Perl documentation
            unzip perl_pod.zip -d f:/perllib/lib

          This is used by the "perldoc" program (see perldoc), and may be used to generate HTML documenta-
          tion usable by WWW browsers, and documentation in zillions of other formats: "info", "LaTeX",
          "Acrobat", "FrameMaker" and so on.  [Use programs such as <u>pod2latex</u> etc.]

       Perl manual in <u>.INF</u> format
            unzip perl_inf.zip -d d:/os2/book

          This directory should better be on "BOOKSHELF".

       Pdksh
            unzip perl_sh.zip -d f:/bin

          This is used by perl to run external commands which explicitly require shell, like the commands
          using <u>redirection</u> and <u>shell</u> <u>metacharacters</u>. It is also used instead of explicit <u>/bin/sh</u>.

          Set "PERL_SH_DIR" (see "PERL_SH_DIR") if you move <u>sh.exe</u> from the above location.

          <b>Note.</b> It may be possible to use some other sh-compatible shell (untested).

       After you installed the components you needed and updated the <u>Config.sys</u> correspondingly, you need to
       hand-edit <u>Config.pm</u>. This file resides somewhere deep in the location you installed your perl
       library, find it out by

         perl -MConfig -le "print $INC{'Config.pm'}"

       You need to correct all the entries which look like file paths (they currently start with "f:/").

       <b>Warning</b>

       The automatic and manual perl installation leave precompiled paths inside perl executables. While
       these paths are overwriteable (see "PERLLIB_PREFIX", "PERL_SH_DIR"), some people may prefer binary
       editing of paths inside the executables/DLLs.

<b>Accessing</b> <b>documentation</b>
       Depending on how you built/installed perl you may have (otherwise identical) Perl documentation in
       the following formats:

       <b>OS/2</b> <u>.INF</u> <b>file</b>

       Most probably the most convenient form. Under OS/2 view it as

         view perl
         view perl perlfunc
         view perl less
         view perl ExtUtils::MakeMaker

       (currently the last two may hit a wrong location, but this may improve soon). Under Win* see "SYNOP-
       SIS".

       If you want to build the docs yourself, and have <u>OS/2</u> <u>toolkit</u>, run

               pod2ipf &gt; perl.ipf

       in <u>/perllib/lib/pod</u> directory, then

               ipfc /inf perl.ipf

       (Expect a lot of errors during the both steps.) Now move it on your BOOKSHELF path.

       <b>Plain</b> <b>text</b>

       If you have perl documentation in the source form, perl utilities installed, and GNU groff installed,
       you may use

               perldoc perlfunc
               perldoc less
               perldoc ExtUtils::MakeMaker

       to access the perl documentation in the text form (note that you may get better results using perl
       manpages).

       Alternately, try running pod2text on <u>.pod</u> files.

       <b>Manpages</b>

       If you have <u>man</u> installed on your system, and you installed perl manpages, use something like this:

               man perlfunc
               man 3 less
               man ExtUtils.MakeMaker

       to access documentation for different components of Perl. Start with

               man perl

       Note that dot (<u>.</u>) is used as a package separator for documentation for packages, and as usual, some-
       times you need to give the section - 3 above - to avoid shadowing by the <a href="less.1.html#//apple_ref/doc/man/1/less"><u>less(1)</u></a><u></u> <u>manpage</u>.

       Make sure that the directory <b>above</b> the directory with manpages is on our "MANPATH", like this

         set MANPATH=c:/man;f:/perllib/man

       for Perl manpages in "f:/perllib/man/man1/" etc.

       <b>HTML</b>

       If you have some WWW browser available, installed the Perl documentation in the source form, and Perl
       utilities, you can build HTML docs. Cd to directory with <u>.pod</u> files, and do like this

               cd f:/perllib/lib/pod
               pod2html

       After this you can direct your browser the file <u>perl.html</u> in this directory, and go ahead with read-
       ing docs, like this:

               explore file:///f:/perllib/lib/pod/perl.html

       Alternatively you may be able to get these docs prebuilt from CPAN.

       <b>GNU</b> <b>"info"</b> <b>files</b>

       Users of Emacs would appreciate it very much, especially with "CPerl" mode loaded. You need to get
       latest "pod2texi" from "CPAN", or, alternately, the prebuilt info pages.

       <u>PDF</u> <b>files</b>

       for "Acrobat" are available on CPAN (may be for slightly older version of perl).

       <b>"LaTeX"</b> <b>docs</b>

       can be constructed using "pod2latex".

<b>BUILD</b>
       Here we discuss how to build Perl under OS/2. There is an alternative (but maybe older) view on
       &lt;<a href="http://www.shadow.net/~troc/os2perl.html">http://www.shadow.net/~troc/os2perl.html</a>.

       <b>The</b> <b>short</b> <b>story</b>

       Assume that you are a seasoned porter, so are sure that all the necessary tools are already present
       on your system, and you know how to get the Perl source distribution.  Untar it, change to the
       extract directory, and

         gnupatch -p0 &lt; os2\diff.configure
         sh Configure -des -D prefix=f:/perllib
         make
         make test
         make install
         make aout_test
         make aout_install

       This puts the executables in f:/perllib/bin.  Manually move them to the "PATH", manually move the
       built <u>perl*.dll</u> to "LIBPATH" (here for Perl DLL <u>*</u> is a not-very-meaningful hex checksum), and run

         make installcmd INSTALLCMDDIR=d:/ir/on/path

       Assuming that the "man"-files were put on an appropriate location, this completes the installation of
       minimal Perl system.  (The binary distribution contains also a lot of additional modules, and the
       documentation in INF format.)

       What follows is a detailed guide through these steps.

       <b>Prerequisites</b>

       You need to have the latest EMX development environment, the full GNU tool suite (gawk renamed to
       awk, and GNU <u>find.exe</u> earlier on path than the OS/2 <u>find.exe</u>, same with <u>sort.exe</u>, to check use

         find --version
         sort --version

       ). You need the latest version of <u>pdksh</u> installed as <u>sh.exe</u>.

       Check that you have <b>BSD</b> libraries and headers installed, and - optionally - Berkeley DB headers and
       libraries, and crypt.

       Possible locations to get the files:

         <a href="ftp://hobbes.nmsu.edu/os2/unix/">ftp://hobbes.nmsu.edu/os2/unix/</a>
         <a href="ftp://ftp.cdrom.com/pub/os2/unix/">ftp://ftp.cdrom.com/pub/os2/unix/</a>
         <a href="ftp://ftp.cdrom.com/pub/os2/dev32/">ftp://ftp.cdrom.com/pub/os2/dev32/</a>
         <a href="ftp://ftp.cdrom.com/pub/os2/emx09c/">ftp://ftp.cdrom.com/pub/os2/emx09c/</a>

       It is reported that the following archives contain enough utils to build perl: <u>gnufutil.zip</u>, <u>gnusu-</u>
       <u>til.zip</u>, <u>gnututil.zip</u>, <u>gnused.zip</u>, <u>gnupatch.zip</u>, <u>gnuawk.zip</u>, <u>gnumake.zip</u>, <u>gnugrep.zip</u>, <u>bsddev.zip</u> and
       <u>ksh527rt.zip</u> (or a later version).  Note that all these utilities are known to be available from LEO:

         <a href="ftp://ftp.leo.org/pub/comp/os/os2/leo/gnu">ftp://ftp.leo.org/pub/comp/os/os2/leo/gnu</a>

       Note also that the <u>db.lib</u> and <u>db.a</u> from the EMX distribution are not suitable for multi-threaded com-
       pile (even single-threaded flavor of Perl uses multi-threaded C RTL, for compatibility with
       XFree86-OS/2). Get a corrected one from

         <a href="http://www.ilyaz.org/software/os2/db_mt.zip">http://www.ilyaz.org/software/os2/db_mt.zip</a>

       If you have <u>exactly</u> <u>the</u> <u>same</u> <u>version</u> <u>of</u> <u>Perl</u> installed already, make sure that no copies or perl are
       currently running.  Later steps of the build may fail since an older version of <u>perl.dll</u> loaded into
       memory may be found.  Running "make test" becomes meaningless, since the test are checking a previous
       build of perl (this situation is detected and reported by <u>lib/os2</u><b>_</b><u>base.t</u> test).  Do not forget to
       unset "PERL_EMXLOAD_SEC" in environment.

       Also make sure that you have <u>/tmp</u> directory on the current drive, and <u>.</u> directory in your "LIBPATH".
       One may try to correct the latter condition by

         set BEGINLIBPATH .\.

       if you use something like <u>CMD.EXE</u> or latest versions of <u>4os2.exe</u>.  (Setting BEGINLIBPATH to just "."
       is ignored by the OS/2 kernel.)

       Make sure your gcc is good for "-Zomf" linking: run "omflibs" script in <u>/emx/lib</u> directory.

       Check that you have link386 installed. It comes standard with OS/2, but may be not installed due to
       customization. If typing

         link386

       shows you do not have it, do <u>Selective</u> <u>install</u>, and choose "Link object modules" in <u>Optional</u> <u>system</u>
       <u>utilities/More</u>. If you get into link386 prompts, press "Ctrl-C" to exit.

       <b>Getting</b> <b>perl</b> <b>source</b>

       You need to fetch the latest perl source (including developers releases). With some probability it is
       located in

         <a href="http://www.cpan.org/src/5.0">http://www.cpan.org/src/5.0</a>
         <a href="http://www.cpan.org/src/5.0/unsupported">http://www.cpan.org/src/5.0/unsupported</a>

       If not, you may need to dig in the indices to find it in the directory of the current maintainer.

       Quick cycle of developers release may break the OS/2 build time to time, looking into

         <a href="http://www.cpan.org/ports/os2/">http://www.cpan.org/ports/os2/</a>

       may indicate the latest release which was publicly released by the maintainer. Note that the release
       may include some additional patches to apply to the current source of perl.

       Extract it like this

         tar vzxf perl5.00409.tar.gz

       You may see a message about errors while extracting <u>Configure</u>. This is because there is a conflict
       with a similarly-named file <u>configure</u>.

       Change to the directory of extraction.

       <b>Application</b> <b>of</b> <b>the</b> <b>patches</b>

       You need to apply the patches in <u>./os2/diff.*</u> like this:

         gnupatch -p0 &lt; os2\diff.configure

       You may also need to apply the patches supplied with the binary distribution of perl.  It also makes
       sense to look on the perl5-porters mailing list for the latest OS/2-related patches (see
       &lt;<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/</a>).  Such patches usually contain strings
       "/os2/" and "patch", so it makes sense looking for these strings.

       <b>Hand-editing</b>

       You may look into the file <u>./hints/os2.sh</u> and correct anything wrong you find there. I do not expect
       it is needed anywhere.

       <b>Making</b>

         sh Configure -des -D prefix=f:/perllib

       "prefix" means: where to install the resulting perl library. Giving correct prefix you may avoid the
       need to specify "PERLLIB_PREFIX", see "PERLLIB_PREFIX".

       <u>Ignore</u> <u>the</u> <u>message</u> <u>about</u> <u>missing</u> <u>"ln",</u> <u>and</u> <u>about</u> <u>"-c"</u> <u>option</u> <u>to</u> <u>tr</u>. The latter is most probably
       already fixed, if you see it and can trace where the latter spurious warning comes from, please
       inform me.

       Now

         make

       At some moment the built may die, reporting a <u>version</u> <u>mismatch</u> or <u>unable</u> <u>to</u> <u>run</u> <u>perl</u>.  This means
       that you do not have <u>.</u> in your LIBPATH, so <u>perl.exe</u> cannot find the needed <u>perl67B2.dll</u> (treat these
       hex digits as line noise).  After this is fixed the build should finish without a lot of fuss.

       <b>Testing</b>

       Now run

         make test

       All tests should succeed (with some of them skipped).  If you have the same version of Perl
       installed, it is crucial that you have "." early in your LIBPATH (or in BEGINLIBPATH), otherwise your
       tests will most probably test the wrong version of Perl.

       Some tests may generate extra messages similar to

       A lot of "bad free"
           in database tests related to Berkeley DB. <u>This</u> <u>should</u> <u>be</u> <u>fixed</u> <u>already.</u>  If it persists, you may
           disable this warnings, see "PERL_BADFREE".

       Process terminated by SIGTERM/SIGINT
           This is a standard message issued by OS/2 applications. *nix applications die in silence. It is
           considered to be a feature. One can easily disable this by appropriate sighandlers.

           However the test engine bleeds these message to screen in unexpected moments. Two messages of
           this kind <u>should</u> be present during testing.

       To get finer test reports, call

         perl t/harness

       The report with <u>io/pipe.t</u> failing may look like this:

         Failed Test  Status Wstat Total Fail  Failed  List of failed
         ------------------------------------------------------------<font color="#ffffff" class="whiteout">io/pipe.t&nbsp;-----------------------------------------------------------io/pipe.t</font>
         io/pipe.t                    12    1   8.33%  9
         7 tests skipped, plus 56 subtests skipped.
         Failed 1/195 test scripts, 99.49% okay. 1/6542 subtests failed, 99.98% okay.

       The reasons for most important skipped tests are:

       <u>op/fs.t</u>
               18  Checks "atime" and "mtime" of "stat()" - unfortunately, HPFS provides only 2sec time
                   granularity (for compatibility with FAT?).

               25  Checks "truncate()" on a filehandle just opened for write - I do not know why this should
                   or should not work.

       <u>op/stat.t</u>
               Checks "stat()". Tests:

               4   Checks "atime" and "mtime" of "stat()" - unfortunately, HPFS provides only 2sec time
                   granularity (for compatibility with FAT?).

       <b>Installing</b> <b>the</b> <b>built</b> <b>perl</b>

       If you haven't yet moved "perl*.dll" onto LIBPATH, do it now.

       Run

         make install

       It would put the generated files into needed locations. Manually put <u>perl.exe</u>, <u>perl</u><b>__</b><u>.exe</u> and
       <u>perl</u><b>___</b><u>.exe</u> to a location on your PATH, <u>perl.dll</u> to a location on your LIBPATH.

       Run

         make installcmd INSTALLCMDDIR=d:/ir/on/path

       to convert perl utilities to <u>.cmd</u> files and put them on PATH. You need to put <u>.EXE</u>-utilities on path
       manually. They are installed in "$prefix/bin", here $prefix is what you gave to <u>Configure</u>, see Mak-<font color="#ffffff" class="whiteout">ing.&nbsp;Making.</font>
       ing.

       If you use "man", either move the installed <u>*/man/</u> directories to your "MANPATH", or modify "MANPATH"
       to match the location.  (One could have avoided this by providing a correct "manpath" option to
       <u>./Configure</u>, or editing <u>./config.sh</u> between configuring and making steps.)

       <b>"a.out"-style</b> <b>build</b>

       Proceed as above, but make <u>perl</u><b>_</b><u>.exe</u> (see "perl_.exe") by

         make perl_

       test and install by

         make aout_test
         make aout_install

       Manually put <u>perl</u><b>_</b><u>.exe</u> to a location on your PATH.

       <b>Note.</b> The build process for "perl_" <u>does</u> <u>not</u> <u>know</u> about all the dependencies, so you should make sure
       that anything is up-to-date, say, by doing

         make perl_dll

       first.

<b>Building</b> <b>a</b> <b>binary</b> <b>distribution</b>
       [This section provides a short overview only...]

       Building should proceed differently depending on whether the version of perl you install is already
       present and used on your system, or is a new version not yet used.  The description below assumes
       that the version is new, so installing its DLLs and <u>.pm</u> files will not disrupt the operation of your
       system even if some intermediate steps are not yet fully working.

       The other cases require a little bit more convoluted procedures.  Below I suppose that the current
       version of Perl is 5.8.2, so the executables are named accordingly.

       1.  Fully build and test the Perl distribution.  Make sure that no tests are failing with "test" and
           "aout_test" targets; fix the bugs in Perl and the Perl test suite detected by these tests.  Make
           sure that "all_test" make target runs as clean as possible.  Check that "os2/perlrexx.cmd" runs
           fine.

       2.  Fully install Perl, including "installcmd" target.  Copy the generated DLLs to "LIBPATH"; copy
           the numbered Perl executables (as in <u>perl5.8.2.exe</u>) to "PATH"; copy "perl_.exe" to "PATH" as
           "perl_5.8.2.exe".  Think whether you need backward-compatibility DLLs.  In most cases you do not
           need to install them yet; but sometime this may simplify the following steps.

       3.  Make sure that "CPAN.pm" can download files from CPAN.  If not, you may need to manually install
           "Net::FTP".

       4.  Install the bundle "Bundle::OS2_default"

             perl5.8.2 -MCPAN -e "install Bundle::OS2_default" &lt; nul |&amp; tee 00cpan_i_1

           This may take a couple of hours on 1GHz processor (when run the first time).  And this should not
           be necessarily a smooth procedure.  Some modules may not specify required dependencies, so one
           may need to repeat this procedure several times until the results stabilize.

             perl5.8.2 -MCPAN -e "install Bundle::OS2_default" &lt; nul |&amp; tee 00cpan_i_2
             perl5.8.2 -MCPAN -e "install Bundle::OS2_default" &lt; nul |&amp; tee 00cpan_i_3

           Even after they stabilize, some tests may fail.

           Fix as many discovered bugs as possible.  Document all the bugs which are not fixed, and all the
           failures with unknown reasons.  Inspect the produced logs <u>00cpan</u><b>_</b><u>i</u><b>_</b><u>1</u> to find suspiciously skipped
           tests, and other fishy events.

           Keep in mind that <u>installation</u> of some modules may fail too: for example, the DLLs to update may
           be already loaded by <u>CPAN.pm</u>.  Inspect the "install" logs (in the example above <u>00cpan</u><b>_</b><u>i</u><b>_</b><u>1</u> etc)
           for errors, and install things manually, as in

             cd $CPANHOME/.cpan/build/Digest-MD5-2.31
             make install

           Some distributions may fail some tests, but you may want to install them anyway (as above, or via
           "force install" command of "CPAN.pm" shell-mode).

           Since this procedure may take quite a long time to complete, it makes sense to "freeze" your CPAN
           configuration by disabling periodic updates of the local copy of CPAN index: set "index_expire"
           to some big value (I use 365), then save the settings

             CPAN&gt; o conf index_expire 365
             CPAN&gt; o conf commit

           Reset back to the default value 1 when you are finished.

       5.  When satisfied with the results, rerun the "installcmd" target.  Now you can copy "perl5.8.2.exe"
           to "perl.exe", and install the other OMF-build executables: "perl__.exe" etc.  They are ready to
           be used.

       6.  Change to the "./pod" directory of the build tree, download the Perl logo <u>CamelGrayBig.BMP</u>, and
           run

             ( perl2ipf &gt; perl.ipf ) |&amp; tee 00ipf
             ipfc /INF perl.ipf |&amp; tee 00inf

           This produces the Perl docs online book "perl.INF".  Install in on "BOOKSHELF" path.

       7.  Now is the time to build statically linked executable <u>perl</u><b>_</b><u>.exe</u> which includes newly-installed
           via "Bundle::OS2_default" modules.  Doing testing via "CPAN.pm" is going to be painfully slow,
           since it statically links a new executable per XS extension.

           Here is a possible workaround: create a toplevel <u>Makefile.PL</u> in <u>$CPANHOME/.cpan/build/</u> with con-<font color="#ffffff" class="whiteout">tents&nbsp;contents</font>
           tents being (compare with "Making executables with a custom collection of statically loaded
           extensions")

             use ExtUtils::MakeMaker;
             WriteMakefile NAME =&gt; 'dummy';

           execute this as

             perl_5.8.2.exe Makefile.PL &lt;nul |&amp; tee 00aout_c1
             make -k all test &lt;nul |&amp; 00aout_t1

           Again, this procedure should not be absolutely smooth.  Some "Makefile.PL"'s in subdirectories
           may be buggy, and would not run as "child" scripts.  The interdependency of modules can strike
           you; however, since non-XS modules are already installed, the prerequisites of most modules have
           a very good chance to be present.

           If you discover some glitches, move directories of problematic modules to a different location;
           if these modules are non-XS modules, you may just ignore them - they are already installed; the
           remaining, XS, modules you need to install manually one by one.

           After each such removal you need to rerun the "Makefile.PL"/"make" process; usually this proce-
           dure converges soon.  (But be sure to convert all the necessary external C libraries from <u>.lib</u>
           format to <u>.a</u> format: run one of

             emxaout foo.lib
             emximp -o foo.a foo.lib

           whichever is appropriate.)  Also, make sure that the DLLs for external libraries are usable with
           with executables compiled without "-Zmtd" options.

           When you are sure that only a few subdirectories lead to failures, you may want to add "-j4"
           option to "make" to speed up skipping subdirectories with already finished build.

           When you are satisfied with the results of tests, install the build C libraries for extensions:

             make install |&amp; tee 00aout_i

           Now you can rename the file <u>./perl.exe</u> generated during the last phase to <u>perl</u><b>_</b><u>5.8.2.exe</u>; place
           it on "PATH"; if there is an inter-dependency between some XS modules, you may need to repeat the
           "test"/"install" loop with this new executable and some excluded modules - until the procedure
           converges.

           Now you have all the necessary <u>.a</u> libraries for these Perl modules in the places where Perl
           builder can find it.  Use the perl builder: change to an empty directory, create a "dummy" <u>Make</u>-<font color="#ffffff" class="whiteout">file.PL&nbsp;Makefile.PL</font>
           <u>file.PL</u> again, and run

             perl_5.8.2.exe Makefile.PL |&amp; tee 00c
             make perl                  |&amp; tee 00p

           This should create an executable <u>./perl.exe</u> with all the statically loaded extensions built in.
           Compare the generated <u>perlmain.c</u> files to make sure that during the iterations the number of
           loaded extensions only increases.  Rename <u>./perl.exe</u> to <u>perl</u><b>_</b><u>5.8.2.exe</u> on "PATH".

           When it converges, you got a functional variant of <u>perl</u><b>_</b><u>5.8.2.exe</u>; copy it to "perl_.exe".  You
           are done with generation of the local Perl installation.

       8.  Make sure that the installed modules are actually installed in the location of the new Perl, and
           are not inherited from entries of @INC given for inheritance from the older versions of Perl: set
           "PERLLIB_582_PREFIX" to redirect the new version of Perl to a new location, and copy the
           installed files to this new location.  Redo the tests to make sure that the versions of modules
           inherited from older versions of Perl are not needed.

           Actually, the log output of pod2ipf during the step 6 gives a very detailed info about which mod-<font color="#ffffff" class="whiteout">ules&nbsp;modules</font>
           ules are loaded from which place; so you may use it as an additional verification tool.

           Check that some temporary files did not make into the perl install tree.  Run something like this

             pfind . -f "!(/\.(pm|pl|ix|al|h|a|lib|txt|pod|imp|bs|dll|ld|bs|inc|xbm|yml|cgi|uu|e2x|skip|packlist|eg|cfg|html|pub|enc|all|ini|po|pot)$/i or /^\w+$/") | less

           in the install tree (both top one and <u>sitelib</u> one).

           Compress all the DLLs with <u>lxlite</u>.  The tiny <u>.exe</u> can be compressed with "/c:max" (the bug only
           appears when there is a fixup in the last 6 bytes of a page (?); since the tiny executables are
           much smaller than a page, the bug will not hit).  Do not compress "perl_.exe" - it would not work
           under DOS.

       9.  Now you can generate the binary distribution.  This is done by running the test of the CPAN dis-<font color="#ffffff" class="whiteout">tribution&nbsp;distribution</font>
           tribution "OS2::SoftInstaller".  Tune up the file <u>test.pl</u> to suit the layout of current version
           of Perl first.  Do not forget to pack the necessary external DLLs accordingly.  Include the
           description of the bugs and test suite failures you could not fix.  Include the small-stack ver-<font color="#ffffff" class="whiteout">sions&nbsp;versions</font>
           sions of Perl executables from Perl build directory.

           Include <u>perl5.def</u> so that people can relink the perl DLL preserving the binary compatibility, or
           can create compatibility DLLs.  Include the diff files ("diff -pu old new") of fixes you did so
           that people can rebuild your version.  Include <u>perl5.map</u> so that one can use remote debugging.

       10. Share what you did with the other people.  Relax.  Enjoy fruits of your work.

       11. Brace yourself for thanks, bug reports, hate mail and spam coming as result of the previous step.
           No good deed should remain unpunished!

<b>Building</b> <b>custom</b> <u>.EXE</u> <b>files</b>
       The Perl executables can be easily rebuilt at any moment.  Moreover, one can use the <u>embedding</u> inter-<font color="#ffffff" class="whiteout">face&nbsp;interface</font>
       face (see perlembed) to make very customized executables.

       <b>Making</b> <b>executables</b> <b>with</b> <b>a</b> <b>custom</b> <b>collection</b> <b>of</b> <b>statically</b> <b>loaded</b> <b>extensions</b>

       It is a little bit easier to do so while <u>decreasing</u> the list of statically loaded extensions.  We
       discuss this case only here.

       1.  Change to an empty directory, and create a placeholder &lt;Makefile.PL&gt;:

             use ExtUtils::MakeMaker;
             WriteMakefile NAME =&gt; 'dummy';

       2.  Run it with the flavor of Perl (<u>perl.exe</u> or <u>perl</u><b>_</b><u>.exe</u>) you want to rebuild.

             perl_ Makefile.PL

       3.  Ask it to create new Perl executable:

             make perl

           (you may need to manually add "PERLTYPE=-DPERL_CORE" to this commandline on some versions of
           Perl; the symptom is that the command-line globbing does not work from OS/2 shells with the
           newly-compiled executable; check with

             .\perl.exe -wle "print for @ARGV" *

           ).

       4.  The previous step created <u>perlmain.c</u> which contains a list of <u>newXS()</u> calls near the end.  Remov-<font color="#ffffff" class="whiteout">ing&nbsp;Removing</font>
           ing unnecessary calls, and rerunning

             make perl

           will produce a customized executable.

       <b>Making</b> <b>executables</b> <b>with</b> <b>a</b> <b>custom</b> <b>search-paths</b>

       The default perl executable is flexible enough to support most usages.  However, one may want some-<font color="#ffffff" class="whiteout">thing&nbsp;something</font>
       thing yet more flexible; for example, one may want to find Perl DLL relatively to the location of the
       EXE file; or one may want to ignore the environment when setting the Perl-library search patch, etc.

       If you fill comfortable with <u>embedding</u> interface (see perlembed), such things are easy to do repeat-<font color="#ffffff" class="whiteout">ing&nbsp;repeating</font>
       ing the steps outlined in "Making executables with a custom collection of statically loaded exten-<font color="#ffffff" class="whiteout">sions",&nbsp;extensions",</font>
       sions", and doing more comprehensive edits to <u>main()</u> of <u>perlmain.c</u>.  The people with little desire to
       understand Perl can just rename <u>main()</u>, and do necessary modification in a custom <u>main()</u> which calls
       the renamed function in appropriate time.

       However, there is a third way: perl DLL exports the <u>main()</u> function and several callbacks to cus-<font color="#ffffff" class="whiteout">tomize&nbsp;customize</font>
       tomize the search path.  Below is a complete example of a "Perl loader" which

       1.  Looks for Perl DLL in the directory "$exedir/../dll";

       2.  Prepends the above directory to "BEGINLIBPATH";

       3.  Fails if the Perl DLL found via "BEGINLIBPATH" is different from what was loaded on step 1; e.g.,
           another process could have loaded it from "LIBPATH" or from a different value of "BEGINLIBPATH".
           In these cases one needs to modify the setting of the system so that this other process either
           does not run, or loads the DLL from "BEGINLIBPATH" with "LIBPATHSTRICT=T" (available with kernels
           after September 2000).

       4.  Loads Perl library from "$exedir/../dll/lib/".

       5.  Uses Bourne shell from "$exedir/../dll/sh/ksh.exe".

       For best results compile the C file below with the same options as the Perl DLL.  However, a lot of
       functionality will work even if the executable is not an EMX applications, e.g., if compiled with

         gcc -Wall -DDOSISH -DOS2=1 -O2 -s -Zomf -Zsys perl-starter.c -DPERL_DLL_BASENAME=\"perl312F\" -Zstack 8192 -Zlinker /PM:VIO

       Here is the sample C file:

         #define INCL_DOS
         #define INCL_NOPM
         /* These are needed for compile if os2.h includes os2tk.h, not os2emx.h */
         #define INCL_DOSPROCESS
         #include &lt;os2.h&gt;

         #include "EXTERN.h"
         #define PERL_IN_MINIPERLMAIN_C
         #include "perl.h"

         static char *me;
         HMODULE handle;

         static void
         die_with(char *msg1, char *msg2, char *msg3, char *msg4)
         {
            ULONG c;
            char *s = " error: ";

            DosWrite(2, me, strlen(me), &amp;c);
            DosWrite(2, s, <!-- a -->strlen(s)<!-- /a -->, &amp;c);
            DosWrite(2, msg1, strlen(msg1), &amp;c);
            DosWrite(2, msg2, strlen(msg2), &amp;c);
            DosWrite(2, msg3, strlen(msg3), &amp;c);
            DosWrite(2, msg4, strlen(msg4), &amp;c);
            DosWrite(2, "\r\n", 2, &amp;c);
            <!-- a -->exit(255)<!-- /a -->;
         }

         typedef ULONG (*fill_extLibpath_t)(int type, char *pre, char *post, int replace, char *msg);
         typedef int (*main_t)(int type, char *argv[], char *env[]);
         typedef int (*handler_t)(void* data, int which);

         #ifndef PERL_DLL_BASENAME
         #  define PERL_DLL_BASENAME "perl"
         #endif

         static HMODULE
         load_perl_dll(char *basename)
         {
             char buf[300], fail[260];
             STRLEN l, dirl;
             fill_extLibpath_t f;
             ULONG rc_fullname;
             HMODULE handle, handle1;

             if (_execname(buf, sizeof(buf) - 13) != 0)
                 die_with("Can't find full path: ", strerror(errno), "", "");
             /* XXXX Fill `me' with new value */
             l = strlen(buf);
             while (l &amp;&amp; buf[l-1] != '/' &amp;&amp; buf[l-1] != '\\')
                 l--;
             dirl = l - 1;
             strcpy(buf + l, basename);
             l += strlen(basename);
             strcpy(buf + l, ".dll");
             if ( (rc_fullname = DosLoadModule(fail, sizeof fail, buf, &amp;handle)) != 0
                  &amp;&amp; DosLoadModule(fail, sizeof fail, basename, &amp;handle) != 0 )
                 die_with("Can't load DLL ", buf, "", "");
             if (rc_fullname)
                 return handle;                /* was loaded with short name; all is fine */
             if (DosQueryProcAddr(handle, 0, "fill_extLibpath", (PFN*)&amp;f))
                 die_with(buf, ": DLL exports no symbol ", "fill_extLibpath", "");
             buf[dirl] = 0;
             if (f(0 /*BEGINLIBPATH*/, buf /* prepend */, NULL /* append */,
                   0 /* keep old value */, me))
                 die_with(me, ": prepending BEGINLIBPATH", "", "");
             if (DosLoadModule(fail, sizeof fail, basename, &amp;handle1) != 0)
                 die_with(me, ": finding perl DLL again via BEGINLIBPATH", "", "");
             buf[dirl] = '\\';
             if (handle1 != handle) {
                 if (DosQueryModuleName(handle1, sizeof(fail), fail))
                     strcpy(fail, "???");
                 die_with(buf, ":\n\tperl DLL via BEGINLIBPATH is different: \n\t",
                          fail,
                          "\n\tYou may need to manipulate global BEGINLIBPATH and LIBPATHSTRICT"
                          "\n\tso that the other copy is loaded via BEGINLIBPATH.");
             }
             return handle;
         }

         int
         main(int argc, char **argv, char **env)
         {
             main_t f;
             handler_t h;

             me = argv[0];
             /**/
             handle = load_perl_dll(PERL_DLL_BASENAME);

             if (DosQueryProcAddr(handle, 0, "Perl_OS2_handler_install", (PFN*)&amp;h))
                 die_with(PERL_DLL_BASENAME, ": DLL exports no symbol ", "Perl_OS2_handler_install", "");
             if ( !h((void *)"~installprefix", Perlos2_handler_perllib_from)
                  || !h((void *)"~dll", Perlos2_handler_perllib_to)
                  || !h((void *)"~dll/sh/ksh.exe", Perlos2_handler_perl_sh) )
                 die_with(PERL_DLL_BASENAME, ": Can't install @INC manglers", "", "");

             if (DosQueryProcAddr(handle, 0, "dll_perlmain", (PFN*)&amp;f))
                 die_with(PERL_DLL_BASENAME, ": DLL exports no symbol ", "dll_perlmain", "");
             return f(argc, argv, env);
         }

<b>Build</b> <b>FAQ</b>
       <b>Some</b> <b>"/"</b> became "\" in pdksh.

       You have a very old pdksh. See Prerequisites.

       <b>'errno'</b> <b>-</b> <b>unresolved</b> <b>external</b>

       You do not have MT-safe <u>db.lib</u>. See Prerequisites.

       <b>Problems</b> <b>with</b> <b>tr</b> <b>or</b> <b>sed</b>

       reported with very old version of tr and sed.

       <b>Some</b> <b>problem</b> <b>(forget</b> <b>which</b> <b>;-)</b>

       You have an older version of <u>perl.dll</u> on your LIBPATH, which broke the build of extensions.

       <b>Library</b> <b>...</b> <b>not</b> <b>found</b>

       You did not run "omflibs". See Prerequisites.

       <b>Segfault</b> <b>in</b> <b>make</b>

       You use an old version of GNU make. See Prerequisites.

       <b>op/sprintf</b> <b>test</b> <b>failure</b>

       This can result from a bug in emx sprintf which was fixed in 0.9d fix 03.

<b>Specific</b> <b>(mis)features</b> <b>of</b> <b>OS/2</b> <b>port</b>
       <b>"setpriority"</b>, "getpriority"

       Note that these functions are compatible with *nix, not with the older ports of '94 - 95. The priori-<font color="#ffffff" class="whiteout">ties&nbsp;priorities</font>
       ties are absolute, go from 32 to -95, lower is quicker. 0 is the default priority.

       <b>WARNING</b>.  Calling "getpriority" on a non-existing process could lock the system before Warp3 fix-<font color="#ffffff" class="whiteout">pak22.&nbsp;fixpak22.</font>
       pak22.  Starting with Warp3, Perl will use a workaround: it aborts <u>getpriority()</u> if the process is
       not present.  This is not possible on older versions "2.*", and has a race condition anyway.

       <b>"system()"</b>

       Multi-argument form of "system()" allows an additional numeric argument. The meaning of this argument
       is described in OS2::Process.

       When finding a program to run, Perl first asks the OS to look for executables on "PATH" (OS/2 adds
       extension <u>.exe</u> if no extension is present).  If not found, it looks for a script with possible exten-<font color="#ffffff" class="whiteout">sions&nbsp;extensions</font>
       sions added in this order: no extension, <u>.cmd</u>, <u>.btm</u>, <u>.bat</u>, <u>.pl</u>.  If found, Perl checks the start of
       the file for magic strings "#!" and "extproc ".  If found, Perl uses the rest of the first line as
       the beginning of the command line to run this script.  The only mangling done to the first line is
       extraction of arguments (currently up to 3), and ignoring of the path-part of the "interpreter" name
       if it can't be found using the full path.

       E.g., "system 'foo', 'bar', 'baz'" may lead Perl to finding <u>C:/emx/bin/foo.cmd</u> with the first line
       being

        extproc /bin/bash    -x   -c

       If <u>/bin/bash.exe</u> is not found, then Perl looks for an executable <u>bash.exe</u> on "PATH".  If found in
       <u>C:/emx.add/bin/bash.exe</u>, then the above <u>system()</u> is translated to

         system qw(C:/emx.add/bin/bash.exe -x -c C:/emx/bin/foo.cmd bar baz)

       One additional translation is performed: instead of <u>/bin/sh</u> Perl uses the hardwired-or-customized
       shell (see ""PERL_SH_DIR"").

       The above search for "interpreter" is recursive: if <u>bash</u> executable is not found, but <u>bash.btm</u> is
       found, Perl will investigate its first line etc.  The only hardwired limit on the recursion depth is
       implicit: there is a limit 4 on the number of additional arguments inserted before the actual argu-<font color="#ffffff" class="whiteout">ments&nbsp;arguments</font>
       ments given to <u>system()</u>.  In particular, if no additional arguments are specified on the "magic"
       first lines, then the limit on the depth is 4.

       If Perl finds that the found executable is of PM type when the current session is not, it will start
       the new process in a separate session of necessary type.  Call via "OS2::Process" to disable this
       magic.

       <b>WARNING</b>.  Due to the described logic, you need to explicitly specify <u>.com</u> extension if needed.  More-<font color="#ffffff" class="whiteout">over,&nbsp;Moreover,</font>
       over, if the executable <u>perl5.6.1</u> is requested, Perl will not look for <u>perl5.6.1.exe</u>.  [This may
       change in the future.]

       <b>"extproc"</b> <b>on</b> <b>the</b> <b>first</b> <b>line</b>

       If the first chars of a Perl script are "extproc ", this line is treated as "#!"-line, thus all the
       switches on this line are processed (twice if script was started via cmd.exe).  See "DESCRIPTION" in
       perlrun.

       <b>Additional</b> <b>modules:</b>

       OS2::Process, OS2::DLL, OS2::REXX, OS2::PrfDB, OS2::ExtAttr. These modules provide access to addi-<font color="#ffffff" class="whiteout">tional&nbsp;additional</font>
       tional numeric argument for "system" and to the information about the running process, to DLLs having
       functions with REXX signature and to the REXX runtime, to OS/2 databases in the <u>.INI</u> format, and to
       Extended Attributes.

       Two additional extensions by Andreas Kaiser, "OS2::UPM", and "OS2::FTP", are included into "ILYAZ"
       directory, mirrored on CPAN.  Other OS/2-related extensions are available too.

       <b>Prebuilt</b> <b>methods:</b>


       "File::Copy::syscopy"
           used by "File::Copy::copy", see File::Copy.

       "DynaLoader::mod2fname"
           used by "DynaLoader" for DLL name mangling.

       "Cwd::current_drive()"
           Self explanatory.

       "Cwd::sys_chdir(name)"
           leaves drive as it is.

       "Cwd::change_drive(name)"
           chanes the "current" drive.

       "Cwd::sys_is_absolute(name)"
           means has drive letter and is_rooted.

       "Cwd::sys_is_rooted(name)"
           means has leading "[/\\]" (maybe after a drive-letter:).

       "Cwd::sys_is_relative(name)"
           means changes with current dir.

       "Cwd::sys_cwd(name)"
           Interface to cwd from EMX. Used by "Cwd::cwd".

       "Cwd::sys_abspath(name, dir)"
           Really really odious function to implement. Returns absolute name of file which would have "name"
           if CWD were "dir".  "Dir" defaults to the current dir.

       "Cwd::extLibpath([type])"
           Get current value of extended library search path. If "type" is present and positive, works with
           "END_LIBPATH", if negative, works with "LIBPATHSTRICT", otherwise with "BEGIN_LIBPATH".

       "Cwd::extLibpath_set( path [, type ] )"
           Set current value of extended library search path. If "type" is present and positive, works with
           &lt;END_LIBPATH&gt;, if negative, works with "LIBPATHSTRICT", otherwise with "BEGIN_LIBPATH".

       "OS2::Error(do_harderror,do_exception)"
           Returns   "undef" if it was not called yet, otherwise bit 1 is set if on the previous call
           do_harderror was enabled, bit 2 is set if on previous call do_exception was enabled.

           This function enables/disables error popups associated with hardware errors (Disk not ready etc.)
           and software exceptions.

           I know of no way to find out the state of popups <u>before</u> the first call to this function.

       "OS2::Errors2Drive(drive)"
           Returns "undef" if it was not called yet, otherwise return false if errors were not requested to
           be written to a hard drive, or the drive letter if this was requested.

           This function may redirect error popups associated with hardware errors (Disk not ready etc.) and
           software exceptions to the file POPUPLOG.OS2 at the root directory of the specified drive.  Over-<font color="#ffffff" class="whiteout">rides&nbsp;Overrides</font>
           rides <u>OS2::Error()</u> specified by individual programs.  Given argument undef will disable redirect-<font color="#ffffff" class="whiteout">ion.&nbsp;redirection.</font>
           ion.

           Has global effect, persists after the application exits.

           I know of no way to find out the state of redirection of popups to the disk <u>before</u> the first call
           to this function.

       <u>OS2::SysInfo()</u>
           Returns a hash with system information. The keys of the hash are

                   MAX_PATH_LENGTH, MAX_TEXT_SESSIONS, MAX_PM_SESSIONS,
                   MAX_VDM_SESSIONS, BOOT_DRIVE, DYN_PRI_VARIATION,
                   MAX_WAIT, MIN_SLICE, MAX_SLICE, PAGE_SIZE,
                   VERSION_MAJOR, VERSION_MINOR, VERSION_REVISION,
                   MS_COUNT, TIME_LOW, TIME_HIGH, TOTPHYSMEM, TOTRESMEM,
                   TOTAVAILMEM, MAXPRMEM, MAXSHMEM, TIMER_INTERVAL,
                   MAX_COMP_LENGTH, FOREGROUND_FS_SESSION,
                   FOREGROUND_PROCESS

       <u>OS2::BootDrive()</u>
           Returns a letter without colon.

       "OS2::MorphPM(serve)", "OS2::UnMorphPM(serve)"
           Transforms the current application into a PM application and back.  The argument true means that
           a real message loop is going to be served.  <u>OS2::MorphPM()</u> returns the PM message queue handle as
           an integer.

           See "Centralized management of resources" for additional details.

       "OS2::Serve_Messages(force)"
           Fake on-demand retrieval of outstanding PM messages.  If "force" is false, will not dispatch mes-<font color="#ffffff" class="whiteout">sages&nbsp;messages</font>
           sages if a real message loop is known to be present.  Returns number of messages retrieved.

           Dies with "QUITing..." if WM_QUIT message is obtained.

       "OS2::Process_Messages(force [, cnt])"
           Retrieval of PM messages until window creation/destruction.  If "force" is false, will not dis-<font color="#ffffff" class="whiteout">patch&nbsp;dispatch</font>
           patch messages if a real message loop is known to be present.

           Returns change in number of windows.  If "cnt" is given, it is incremented by the number of mes-<font color="#ffffff" class="whiteout">sages&nbsp;messages</font>
           sages retrieved.

           Dies with "QUITing..." if WM_QUIT message is obtained.

       "OS2::_control87(new,mask)"
           the same as <!-- a --><b>_</b><u>control87</u>(3)<!-- /a --> of EMX.  Takes integers as arguments, returns the previous coprocessor
           control word as an integer.  Only bits in "new" which are present in "mask" are changed in the
           control word.

       <u>OS2::get</u><b>_</b><u>control87()</u>
           gets the coprocessor control word as an integer.

       "OS2::set_control87_em(new=MCW_EM,mask=MCW_EM)"
           The variant of <u>OS2::</u><b>_</b><u>control87()</u> with default values good for handling exception mask: if no
           "mask", uses exception mask part of "new" only.  If no "new", disables all the floating point
           exceptions.

           See "Misfeatures" for details.

       "OS2::DLLname([how [, \&amp;xsub]])"
           Gives the information about the Perl DLL or the DLL containing the C function bound to by &amp;xsub.
           The meaning of "how" is: default (2): full name; 0: handle; 1: module name.

       (Note that some of these may be moved to different libraries - eventually).

       <b>Prebuilt</b> <b>variables:</b>


       $OS2::emx_rev
           numeric value is the same as _emx_rev of EMX, a string value the same as _emx_vprt (similar to
           "0.9c").

       $OS2::emx_env
           same as _emx_env of EMX, a number similar to 0x8001.

       $OS2::os_ver
           a number "OS_MAJOR + 0.001 * OS_MINOR".

       $OS2::is_aout
           true if the Perl library was compiled in AOUT format.

       $OS2::can_fork
           true if the current executable is an AOUT EMX executable, so Perl can fork.  Do not use this, use
           the portable check for $Config::Config{dfork}.

       $OS2::nsyserror
           This variable (default is 1) controls whether to enforce the contents of $^E to start with
           "SYS0003"-like id.  If set to 0, then the string value of $^E is what is available from the OS/2
           message file.  (Some messages in this file have an "SYS0003"-like id prepended, some not.)

       <b>Misfeatures</b>


          Since <!-- a --><u>flock</u>(3)<!-- /a --> is present in EMX, but is not functional, it is emulated by perl.  To disable the
           emulations, set environment variable "USE_PERL_FLOCK=0".

          Here is the list of things which may be "broken" on EMX (from EMX docs):

              The functions <!-- a --><u>recvmsg</u>(3)<!-- /a -->, <!-- a --><u>sendmsg</u>(3)<!-- /a -->, and <!-- a --><u>socketpair</u>(3)<!-- /a --> are not implemented.

              <!-- a --><u>sock</u><b>_</b><u>init</u>(3)<!-- /a --> is not required and not implemented.

              <!-- a --><u>flock</u>(3)<!-- /a --> is not yet implemented (dummy function).  (Perl has a workaround.)

              <!-- a --><u>kill</u>(3)<!-- /a -->:  Special treatment of PID=0, PID=1 and PID=-1 is not implemented.

              <!-- a --><u>waitpid</u>(3)<!-- /a -->:

                     WUNTRACED
                             Not implemented.
                     waitpid() is not implemented for negative values of PID.

           Note that "kill -9" does not work with the current version of EMX.

          See "Text-mode filehandles".

          Unix-domain sockets on OS/2 live in a pseudo-file-system "/sockets/...".  To avoid a failure to
           create a socket with a name of a different form, "/socket/" is prepended to the socket name
           (unless it starts with this already).

           This may lead to problems later in case the socket is accessed via the "usual" file-system calls
           using the "initial" name.

          Apparently, IBM used a compiler (for some period of time around '95?) which changes FP mask right
           and left.  This is not <u>that</u> bad for IBM's programs, but the same compiler was used for DLLs which
           are used with general-purpose applications.  When these DLLs are used, the state of floating-<font color="#ffffff" class="whiteout">point&nbsp;floatingpoint</font>
           point flags in the application is not predictable.

           What is much worse, some DLLs change the floating point flags when in <b>_</b><u>DLLInitTerm()</u> (e.g.,
           <u>TCP32IP</u>).  This means that even if you do not <u>call</u> any function in the DLL, just the act of load-<font color="#ffffff" class="whiteout">ing&nbsp;loading</font>
           ing this DLL will reset your flags.  What is worse, the same compiler was used to compile some
           HOOK DLLs.  Given that HOOK dlls are executed in the context of <u>all</u> the applications in the sys-<font color="#ffffff" class="whiteout">tem,&nbsp;system,</font>
           tem, this means a complete unpredictablity of floating point flags on systems using such HOOK
           DLLs.  E.g., <u>GAMESRVR.DLL</u> of <b>DIVE</b> origin changes the floating point flags on each write to the
           TTY of a VIO (windowed text-mode) applications.

           Some other (not completely debugged) situations when FP flags change include some video drivers
           (?), and some operations related to creation of the windows.  People who code <b>OpenGL</b> may have
           more experience on this.

           Perl is generally used in the situation when all the floating-point exceptions are ignored, as is
           the default under EMX.  If they are not ignored, some benign Perl programs would get a "SIGFPE"
           and would die a horrible death.

           To circumvent this, Perl uses two hacks.  They help against <u>one</u> type of damage only: FP flags
           changed when loading a DLL.

           One of the hacks is to disable floating point exceptions on Perl startup (as is the default with
           EMX).  This helps only with compile-time-linked DLLs changing the flags before <u>main()</u> had a
           chance to be called.

           The other hack is to restore FP flags after a call to <u>dlopen()</u>.  This helps against similar dam-<font color="#ffffff" class="whiteout">age&nbsp;damage</font>
           age done by DLLs <b>_</b><u>DLLInitTerm()</u> at runtime.  Currently no way to switch these hacks off is pro-<font color="#ffffff" class="whiteout">vided.&nbsp;provided.</font>
           vided.

       <b>Modifications</b>

       Perl modifies some standard C library calls in the following ways:

       "popen"  "my_popen" uses <u>sh.exe</u> if shell is required, cf. "PERL_SH_DIR".

       "tmpnam" is created using "TMP" or "TEMP" environment variable, via "tempnam".

       "tmpfile"
                If the current directory is not writable, file is created using modified "tmpnam", so there
                may be a race condition.

       "ctermid"
                a dummy implementation.

       "stat"   "os2_stat" special-cases <u>/dev/tty</u> and <u>/dev/con</u>.

       "mkdir", "rmdir"
                these EMX functions do not work if the path contains a trailing "/".  Perl contains a work-<font color="#ffffff" class="whiteout">around&nbsp;workaround</font>
                around for this.

       "flock"  Since <!-- a --><u>flock</u>(3)<!-- /a --> is present in EMX, but is not functional, it is emulated by perl.  To disable
                the emulations, set environment variable "USE_PERL_FLOCK=0".

       <b>Identifying</b> <b>DLLs</b>

       All the DLLs built with the current versions of Perl have ID strings identifying the name of the
       extension, its version, and the version of Perl required for this DLL.  Run "bldlevel DLL-name" to
       find this info.

       <b>Centralized</b> <b>management</b> <b>of</b> <b>resources</b>

       Since to call certain OS/2 API one needs to have a correctly initialized "Win" subsystem, OS/2-spe-<font color="#ffffff" class="whiteout">cific&nbsp;OS/2-specific</font>
       cific extensions may require getting "HAB"s and "HMQ"s.  If an extension would do it on its own,
       another extension could fail to initialize.

       Perl provides a centralized management of these resources:

       "HAB"
           To get the HAB, the extension should call "hab = perl_hab_GET()" in C.  After this call is per-<font color="#ffffff" class="whiteout">formed,&nbsp;performed,</font>
           formed, "hab" may be accessed as "Perl_hab".  There is no need to release the HAB after it is
           used.

           If by some reasons <u>perl.h</u> cannot be included, use

             extern int Perl_hab_GET(void);

           instead.

       "HMQ"
           There are two cases:

           *   the extension needs an "HMQ" only because some API will not work otherwise.  Use "serve = 0"
               below.

           *   the extension needs an "HMQ" since it wants to engage in a PM event loop.  Use "serve = 1"
               below.

           To get an "HMQ", the extension should call "hmq = perl_hmq_GET(serve)" in C.  After this call is
           performed, "hmq" may be accessed as "Perl_hmq".

           To signal to Perl that HMQ is not needed any more, call "perl_hmq_UNSET(serve)".  Perl process
           will automatically morph/unmorph itself into/from a PM process if HMQ is needed/not-needed.  Perl
           will automatically enable/disable "WM_QUIT" message during shutdown if the message queue is
           served/not-served.

           <b>NOTE</b>.  If during a shutdown there is a message queue which did not disable WM_QUIT, and which did
           not process the received WM_QUIT message, the shutdown will be automatically cancelled.  Do not
           call <!-- a -->perl_hmq_GET(1)<!-- /a --> unless you are going to process messages on an orderly basis.

       * Treating errors reported by OS/2 API
           There are two principal conventions (it is useful to call them "Dos*" and "Win*" - though this
           part of the function signature is not always determined by the name of the API) of reporting the
           error conditions of OS/2 API.  Most of "Dos*" APIs report the error code as the result of the
           call (so 0 means success, and there are many types of errors).  Most of "Win*" API report suc-<font color="#ffffff" class="whiteout">cess/fail&nbsp;success/fail</font>
           cess/fail via the result being "TRUE"/"FALSE"; to find the reason for the failure one should call
           <u>WinGetLastError()</u> API.

           Some "Win*" entry points also overload a "meaningful" return value with the error indicator; hav-<font color="#ffffff" class="whiteout">ing&nbsp;having</font>
           ing a 0 return value indicates an error.  Yet some other "Win*" entry points overload things even
           more, and 0 return value may mean a successful call returning a valid value 0, as well as an
           error condition; in the case of a 0 return value one should call <u>WinGetLastError()</u> API to distin-<font color="#ffffff" class="whiteout">guish&nbsp;distinguish</font>
           guish a successful call from a failing one.

           By convention, all the calls to OS/2 API should indicate their failures by resetting $^E.  All
           the Perl-accessible functions which call OS/2 API may be broken into two classes: some <u>die()</u>s
           when an API error is encountered, the other report the error via a false return value (of course,
           this does not concern Perl-accessible functions which <u>expect</u> a failure of the OS/2 API call, hav-<font color="#ffffff" class="whiteout">ing&nbsp;having</font>
           ing some workarounds coded).

           Obviously, in the situation of the last type of the signature of an OS/2 API, it is must more
           convenient for the users if the failure is indicated by <u>die()</u>ing: one does not need to check $^E
           to know that something went wrong.  If, however, this solution is not desirable by some reason,
           the code in question should reset $^E to 0 before making this OS/2 API call, so that the caller
           of this Perl-accessible function has a chance to distinguish a success-but-0-return value from a
           failure.  (One may return undef as an alternative way of reporting an error.)

           The macros to simplify this type of error propagation are

           "CheckOSError(expr)"
               Returns true on error, sets $^E.  Expects <u>expr()</u> be a call of "Dos*"-style API.

           "CheckWinError(expr)"
               Returns true on error, sets $^E.  Expects <u>expr()</u> be a call of "Win*"-style API.

           "SaveWinError(expr)"
               Returns "expr", sets $^E from <u>WinGetLastError()</u> if "expr" is false.

           "SaveCroakWinError(expr,die,name1,name2)"
               Returns "expr", sets $^E from <u>WinGetLastError()</u> if "expr" is false, and <u>die()</u>s if "die" and
               $^E are true.  The message to die is the concatenated strings "name1" and "name2", separated
               by ": " from the contents of $^E.

           "WinError_2_Perl_rc"
               Sets "Perl_rc" to the return value of <u>WinGetLastError()</u>.

           "FillWinError"
               Sets "Perl_rc" to the return value of <u>WinGetLastError()</u>, and sets $^E to the corresponding
               value.

           "FillOSError(rc)"
               Sets "Perl_rc" to "rc", and sets $^E to the corresponding value.

       * Loading DLLs and ordinals in DLLs
           Some DLLs are only present in some versions of OS/2, or in some configurations of OS/2.  Some
           exported entry points are present only in DLLs shipped with some versions of OS/2.  If these DLLs
           and entry points were linked directly for a Perl executable/DLL or from a Perl extensions, this
           binary would work only with the specified versions/setups.  Even if these entry points were not
           needed, the <u>load</u> of the executable (or DLL) would fail.

           For example, many newer useful APIs are not present in OS/2 v2; many PM-related APIs require DLLs
           not available on floppy-boot setup.

           To make these calls fail <u>only</u> <u>when</u> <u>the</u> <u>calls</u> <u>are</u> <u>executed</u>, one should call these API via a
           dynamic linking API.  There is a subsystem in Perl to simplify such type of calls.  A large num-<font color="#ffffff" class="whiteout">ber&nbsp;number</font>
           ber of entry points available for such linking is provided (see "entries_ordinals" - and also
           "PMWIN_entries" - in <u>os2ish.h</u>).  These ordinals can be accessed via the APIs:

             CallORD(), DeclFuncByORD(), DeclVoidFuncByORD(),
             DeclOSFuncByORD(), DeclWinFuncByORD(), AssignFuncPByORD(),
             DeclWinFuncByORD_CACHE(), DeclWinFuncByORD_CACHE_survive(),
             DeclWinFuncByORD_CACHE_resetError_survive(),
             DeclWinFunc_CACHE(), DeclWinFunc_CACHE_resetError(),
             DeclWinFunc_CACHE_survive(), DeclWinFunc_CACHE_resetError_survive()

           See the header files and the C code in the supplied OS/2-related modules for the details on usage
           of these functions.

           Some of these functions also combine dynaloading semantic with the error-propagation semantic
           discussed above.

<b>Perl</b> <b>flavors</b>
       Because of idiosyncrasies of OS/2 one cannot have all the eggs in the same basket (though EMX envi-<font color="#ffffff" class="whiteout">ronment&nbsp;environment</font>
       ronment tries hard to overcome this limitations, so the situation may somehow improve). There are 4
       executables for Perl provided by the distribution:

       <u>perl.exe</u>

       The main workhorse. This is a chimera executable: it is compiled as an "a.out"-style executable, but
       is linked with "omf"-style dynamic library <u>perl.dll</u>, and with dynamic CRT DLL. This executable is a
       VIO application.

       It can load perl dynamic extensions, and it can <u>fork()</u>.

       <b>Note.</b> Keep in mind that <u>fork()</u> is needed to open a pipe to yourself.

       <u>perl</u><b>_</b><u>.exe</u>

       This is a statically linked "a.out"-style executable. It cannot load dynamic Perl extensions. The
       executable supplied in binary distributions has a lot of extensions prebuilt, thus the above restric-<font color="#ffffff" class="whiteout">tion&nbsp;restriction</font>
       tion is important only if you use custom-built extensions. This executable is a VIO application.

       <u>This</u> <u>is</u> <u>the</u> <u>only</u> <u>executable</u> <u>with</u> <u>does</u> <u>not</u> <u>require</u> <u>OS/2.</u> The friends locked into "M$" world would
       appreciate the fact that this executable runs under DOS, Win0.3*, Win0.95 and WinNT with an appropri-<font color="#ffffff" class="whiteout">ate&nbsp;appropriate</font>
       ate extender. See "Other OSes".

       <u>perl</u><b>__</b><u>.exe</u>

       This is the same executable as <u>perl</u><b>___</b><u>.exe</u>, but it is a PM application.

       <b>Note.</b> Usually (unless explicitly redirected during the startup) STDIN, STDERR, and STDOUT of a PM
       application are redirected to <u>nul</u>. However, it is possible to <u>see</u> them if you start "perl__.exe" from
       a PM program which emulates a console window, like <u>Shell</u> <u>mode</u> of Emacs or EPM. Thus it <u>is</u> <u>possible</u> to
       use Perl debugger (see perldebug) to debug your PM application (but beware of the message loop lock-<font color="#ffffff" class="whiteout">ups&nbsp;lockups</font>
       ups - this will not work if you have a message queue to serve, unless you hook the serving into the
       <u>getc()</u> function of the debugger).

       Another way to see the output of a PM program is to run it as

         pm_prog args 2&gt;&amp;1 | cat -<font color="#ffffff" class="whiteout">with&nbsp;catwith</font>

       with a shell <u>different</u> from <u>cmd.exe</u>, so that it does not create a link between a VIO session and the
       session of "pm_porg".  (Such a link closes the VIO window.)  E.g., this works with <u>sh.exe</u> - or with
       Perl!

         open P, 'pm_prog args 2&gt;&amp;1 |' or die;
         print while &lt;P&gt;;

       The flavor <u>perl</u><b>__</b><u>.exe</u> is required if you want to start your program without a VIO window present, but
       not "detach"ed (run "help detach" for more info).  Very useful for extensions which use PM, like
       "Perl/Tk" or "OpenGL".

       Note also that the differences between PM and VIO executables are only in the <u>default</u> behaviour.  One
       can start <u>any</u> executable in <u>any</u> kind of session by using the arguments "/fs", "/pm" or "/win"
       switches of the command "start" (of <u>CMD.EXE</u> or a similar shell).  Alternatively, one can use the
       numeric first argument of the "system" Perl function (see OS2::Process).

       <u>perl</u><b>___</b><u>.exe</u>

       This is an "omf"-style executable which is dynamically linked to <u>perl.dll</u> and CRT DLL. I know no
       advantages of this executable over "perl.exe", but it cannot <u>fork()</u> at all. Well, one advantage is
       that the build process is not so convoluted as with "perl.exe".

       It is a VIO application.

       <b>Why</b> <b>strange</b> <b>names?</b>

       Since Perl processes the "#!"-line (cf.  "DESCRIPTION" in perlrun, "Switches" in perlrun, "Not a perl
       script" in perldiag, "No Perl script found in input" in perldiag), it should know when a program <u>is</u> <u>a</u>
       <u>Perl</u>. There is some naming convention which allows Perl to distinguish correct lines from wrong ones.
       The above names are almost the only names allowed by this convention which do not contain digits
       (which have absolutely different semantics).

       <b>Why</b> <b>dynamic</b> <b>linking?</b>

       Well, having several executables dynamically linked to the same huge library has its advantages, but
       this would not substantiate the additional work to make it compile. The reason is the complicated-to-<font color="#ffffff" class="whiteout">developers&nbsp;complicated-todevelopers</font>
       developers but very quick and convenient-to-users "hard" dynamic linking used by OS/2.

       There are two distinctive features of the dyna-linking model of OS/2: first, all the references to
       external functions are resolved at the compile time; second, there is no runtime fixup of the DLLs
       after they are loaded into memory.  The first feature is an enormous advantage over other models: it
       avoids conflicts when several DLLs used by an application export entries with the same name.  In such
       cases "other" models of dyna-linking just choose between these two entry points using some random
       criterion - with predictable disasters as results.  But it is the second feature which requires the
       build of <u>perl.dll</u>.

       The address tables of DLLs are patched only once, when they are loaded. The addresses of the entry
       points into DLLs are guaranteed to be the same for all the programs which use the same DLL.  This
       removes the runtime fixup - once DLL is loaded, its code is read-only.

       While this allows some (significant?) performance advantages, this makes life much harder for devel-<font color="#ffffff" class="whiteout">opers,&nbsp;developers,</font>
       opers, since the above scheme makes it impossible for a DLL to be "linked" to a symbol in the <u>.EXE</u>
       file.  Indeed, this would need a DLL to have different relocations tables for the (different) exe-<font color="#ffffff" class="whiteout">cutables&nbsp;executables</font>
       cutables which use this DLL.

       However, a dynamically loaded Perl extension is forced to use some symbols from the perl executable,
       e.g., to know how to find the arguments to the functions: the arguments live on the perl internal
       evaluation stack. The solution is to put the main code of the interpreter into a DLL, and make the
       <u>.EXE</u> file which just loads this DLL into memory and supplies command-arguments.  The extension DLL
       cannot link to symbols in <u>.EXE</u>, but it has no problem linking to symbols in the <u>.DLL</u>.

       This <u>greatly</u> increases the load time for the application (as well as complexity of the compilation).
       Since interpreter is in a DLL, the C RTL is basically forced to reside in a DLL as well (otherwise
       extensions would not be able to use CRT).  There are some advantages if you use different flavors of
       perl, such as running <u>perl.exe</u> and <u>perl</u><b>__</b><u>.exe</u> simultaneously: they share the memory of <u>perl.dll</u>.

       <b>NOTE</b>.  There is one additional effect which makes DLLs more wasteful: DLLs are loaded in the shared
       memory region, which is a scarse resource given the 512M barrier of the "standard" OS/2 virtual mem-<font color="#ffffff" class="whiteout">ory.&nbsp;memory.</font>
       ory.  The code of <u>.EXE</u> files is also shared by all the processes which use the particular <u>.EXE</u>, but
       they are "shared in the private address space of the process"; this is possible because the address
       at which different sections of the <u>.EXE</u> file are loaded is decided at compile-time, thus all the pro-<font color="#ffffff" class="whiteout">cesses&nbsp;processes</font>
       cesses have these sections loaded at same addresses, and no fixup of internal links inside the <u>.EXE</u>
       is needed.

       Since DLLs may be loaded at run time, to have the same mechanism for DLLs one needs to have the
       address range of <u>any</u> <u>of</u> <u>the</u> <u>loaded</u> DLLs in the system to be available <u>in</u> <u>all</u> <u>the</u> <u>processes</u> which did
       not load a particular DLL yet.  This is why the DLLs are mapped to the shared memory region.

       <b>Why</b> <b>chimera</b> <b>build?</b>

       Current EMX environment does not allow DLLs compiled using Unixish "a.out" format to export symbols
       for data (or at least some types of data). This forces "omf"-style compile of <u>perl.dll</u>.

       Current EMX environment does not allow <u>.EXE</u> files compiled in "omf" format to <u>fork()</u>. <u>fork()</u> is
       needed for exactly three Perl operations:

          explicit <u>fork()</u> in the script,

          "open FH, "|-""

          "open FH, "-|"", in other words, opening pipes to itself.

       While these operations are not questions of life and death, they are needed for a lot of useful
       scripts. This forces "a.out"-style compile of <u>perl.exe</u>.

<b>ENVIRONMENT</b>
       Here we list environment variables with are either OS/2- and DOS- and Win*-specific, or are more
       important under OS/2 than under other OSes.

       <b>"PERLLIB_PREFIX"</b>

       Specific for EMX port. Should have the form

         path1;path2

       or

         path1 path2

       If the beginning of some prebuilt path matches <u>path1</u>, it is substituted with <u>path2</u>.

       Should be used if the perl library is moved from the default location in preference to <!-- a -->"PERL(5)<!-- /a -->LIB",
       since this would not leave wrong entries in @INC.  For example, if the compiled version of perl looks
       for @INC in <u>f:/perllib/lib</u>, and you want to install the library in <u>h:/opt/gnu</u>, do

         set PERLLIB_PREFIX=f:/perllib/lib;h:/opt/gnu

       This will cause Perl with the prebuilt @INC of

         f:/perllib/lib/5.00553/os2
         f:/perllib/lib/5.00553
         f:/perllib/lib/site_perl/5.00553/os2
         f:/perllib/lib/site_perl/5.00553
         .

       to use the following @INC:

         h:/opt/gnu/5.00553/os2
         h:/opt/gnu/5.00553
         h:/opt/gnu/site_perl/5.00553/os2
         h:/opt/gnu/site_perl/5.00553
         .

       <b>"PERL_BADLANG"</b>

       If 0, perl ignores <u>setlocale()</u> failing. May be useful with some strange <u>locale</u>s.

       <b>"PERL_BADFREE"</b>

       If 0, perl would not warn of in case of unwarranted <u>free()</u>. With older perls this might be useful in
       conjunction with the module DB_File, which was buggy when dynamically linked and OMF-built.

       Should not be set with newer Perls, since this may hide some <u>real</u> problems.

       <b>"PERL_SH_DIR"</b>

       Specific for EMX port. Gives the directory part of the location for <u>sh.exe</u>.

       <b>"USE_PERL_FLOCK"</b>

       Specific for EMX port. Since <!-- a --><u>flock</u>(3)<!-- /a --> is present in EMX, but is not functional, it is emulated by
       perl.  To disable the emulations, set environment variable "USE_PERL_FLOCK=0".

       <b>"TMP"</b> or "TEMP"

       Specific for EMX port. Used as storage place for temporary files.

<b>Evolution</b>
       Here we list major changes which could make you by surprise.

       <b>Text-mode</b> <b>filehandles</b>

       Starting from version 5.8, Perl uses a builtin translation layer for text-mode files.  This replaces
       the efficient well-tested EMX layer by some code which should be best characterized as a "quick
       hack".

       In addition to possible bugs and an inability to follow changes to the translation policy with off/on
       switches of TERMIO translation, this introduces a serious incompatible change: before <u>sysread()</u> on
       text-mode filehandles would go through the translation layer, now it would not.

       <b>Priorities</b>

       "setpriority" and "getpriority" are not compatible with earlier ports by Andreas Kaiser. See "setpri-<font color="#ffffff" class="whiteout">ority,&nbsp;"setpriority,</font>
       ority, getpriority".

       <b>DLL</b> <b>name</b> <b>mangling:</b> <b>pre</b> <b>5.6.2</b>

       With the release 5.003_01 the dynamically loadable libraries should be rebuilt when a different ver-<font color="#ffffff" class="whiteout">sion&nbsp;version</font>
       sion of Perl is compiled. In particular, DLLs (including <u>perl.dll</u>) are now created with the names
       which contain a checksum, thus allowing workaround for OS/2 scheme of caching DLLs.

       It may be possible to code a simple workaround which would

          find the old DLLs looking through the old @INC;

          mangle the names according to the scheme of new perl and copy the DLLs to these names;

          edit the internal "LX" tables of DLL to reflect the change of the name (probably not needed for
           Perl extension DLLs, since the internally coded names are not used for "specific" DLLs, they used
           only for "global" DLLs).

          edit the internal "IMPORT" tables and change the name of the "old" <u>perl????.dll</u> to the "new"
           <u>perl????.dll</u>.

       <b>DLL</b> <b>name</b> <b>mangling:</b> <b>5.6.2</b> <b>and</b> <b>beyond</b>

       In fact mangling of <u>extension</u> DLLs was done due to misunderstanding of the OS/2 dynaloading model.
       OS/2 (effectively) maintains two different tables of loaded DLL:

       Global DLLs
           those loaded by the base name from "LIBPATH"; including those associated at link time;

       specific DLLs
           loaded by the full name.

       When resolving a request for a global DLL, the table of already-loaded specific DLLs is (effectively)
       ignored; moreover, specific DLLs are <u>always</u> loaded from the prescribed path.

       There is/was a minor twist which makes this scheme fragile: what to do with DLLs loaded from

       "BEGINLIBPATH" and "ENDLIBPATH"
           (which depend on the process)

       <u>.</u> from "LIBPATH"
           which <u>effectively</u> depends on the process (although "LIBPATH" is the same for all the processes).

       Unless "LIBPATHSTRICT" is set to "T" (and the kernel is after 2000/09/01), such DLLs are considered
       to be global.  When loading a global DLL it is first looked in the table of already-loaded global
       DLLs.  Because of this the fact that one executable loaded a DLL from "BEGINLIBPATH" and "ENDLIB-<font color="#ffffff" class="whiteout">PATH",&nbsp;"ENDLIBPATH",</font>
       PATH", or <u>.</u> from "LIBPATH" may affect <u>which</u> DLL is loaded when <u>another</u> executable requests a DLL with
       the same name.  <u>This</u> is the reason for version-specific mangling of the DLL name for perl DLL.

       Since the Perl extension DLLs are always loaded with the full path, there is no need to mangle their
       names in a version-specific ways: their directory already reflects the corresponding version of perl,
       and @INC takes into account binary compatibility with older version.  Starting from 5.6.2 the name
       mangling scheme is fixed to be the same as for Perl 5.005_53 (same as in a popular binary release).
       Thus new Perls will be able to <u>resolve</u> <u>the</u> <u>names</u> of old extension DLLs if @INC allows finding their
       directories.

       However, this still does not guarantee that these DLL may be loaded.  The reason is the mangling of
       the name of the <u>Perl</u> <u>DLL</u>.  And since the extension DLLs link with the Perl DLL, extension DLLs for
       older versions would load an older Perl DLL, and would most probably segfault (since the data in this
       DLL is not properly initialized).

       There is a partial workaround (which can be made complete with newer OS/2 kernels): create a for-<font color="#ffffff" class="whiteout">warder&nbsp;forwarder</font>
       warder DLL with the same name as the DLL of the older version of Perl, which forwards the entry
       points to the newer Perl's DLL.  Make this DLL accessible on (say) the "BEGINLIBPATH" of the new Perl
       executable.  When the new executable accesses old Perl's extension DLLs, they would request the old
       Perl's DLL by name, get the forwarder instead, so effectively will link with the currently running
       (new) Perl DLL.

       This may break in two ways:

          Old perl executable is started when a new executable is running has loaded an extension compiled
           for the old executable (ouph!).  In this case the old executable will get a forwarder DLL instead
           of the old perl DLL, so would link with the new perl DLL.  While not directly fatal, it will
           behave the same as new executable.  This beats the whole purpose of explicitly starting an old
           executable.

          A new executable loads an extension compiled for the old executable when an old perl executable
           is running.  In this case the extension will not pick up the forwarder - with fatal results.

       With support for "LIBPATHSTRICT" this may be circumvented - unless one of DLLs is started from <u>.</u> from
       "LIBPATH" (I do not know whether "LIBPATHSTRICT" affects this case).

       <b>REMARK</b>.  Unless newer kernels allow <u>.</u> in "BEGINLIBPATH" (older do not), this mess cannot be com-<font color="#ffffff" class="whiteout">pletely&nbsp;completely</font>
       pletely cleaned.  (It turns out that as of the beginning of 2002, <u>.</u> is not allowed, but <u>.\.</u> is - and
       it has the same effect.)

       <b>REMARK</b>.  "LIBPATHSTRICT", "BEGINLIBPATH" and "ENDLIBPATH" are not environment variables, although
       <u>cmd.exe</u> emulates them on "SET ..." lines.  From Perl they may be accessed by Cwd::extLibpath and
       Cwd::extLibpath_set.

       <b>DLL</b> <b>forwarder</b> <b>generation</b>

       Assume that the old DLL is named <u>perlE0AC.dll</u> (as is one for 5.005_53), and the new version is 5.6.1.
       Create a file <u>perl5shim.def-leader</u> with

         LIBRARY 'perlE0AC' INITINSTANCE TERMINSTANCE
         DESCRIPTION '@#perl5-porters@perl.org:5.006001#@ Perl module for 5.00553 -&gt; Perl 5.6.1 forwarder'
         CODE LOADONCALL
         DATA LOADONCALL NONSHARED MULTIPLE
         EXPORTS

       modifying the versions/names as needed.  Run

        perl -wnle "next if 0../EXPORTS/; print qq(  \"$1\") if /\"(\w+)\"/" perl5.def &gt;lst

       in the Perl build directory (to make the DLL smaller replace perl5.def with the definition file for
       the older version of Perl if present).

        cat perl5shim.def-leader lst &gt;perl5shim.def
        gcc -Zomf -Zdll -o perlE0AC.dll perl5shim.def -s -llibperl

       (ignore multiple "warning L4085").

       <b>Threading</b>

       As of release 5.003_01 perl is linked to multithreaded C RTL DLL.  If perl itself is not compiled
       multithread-enabled, so will not be perl's <u>malloc()</u>. However, extensions may use multiple thread on
       their own risk.

       This was needed to compile "Perl/Tk" for XFree86-OS/2 out-of-the-box, and link with DLLs for other
       useful libraries, which typically are compiled with "-Zmt -Zcrtdll".

       <b>Calls</b> <b>to</b> <b>external</b> <b>programs</b>

       Due to a popular demand the perl external program calling has been changed wrt Andreas Kaiser's port.
       <u>If</u> perl needs to call an external program <u>via</u> <u>shell</u>, the <u>f:/bin/sh.exe</u> will be called, or whatever is
       the override, see "PERL_SH_DIR".

       Thus means that you need to get some copy of a <u>sh.exe</u> as well (I use one from pdksh). The path <u>F:/bin</u>
       above is set up automatically during the build to a correct value on the builder machine, but is
       overridable at runtime,

       <b>Reasons:</b> a consensus on "perl5-porters" was that perl should use one non-overridable shell per plat-<font color="#ffffff" class="whiteout">form.&nbsp;platform.</font>
       form. The obvious choices for OS/2 are <u>cmd.exe</u> and <u>sh.exe</u>. Having perl build itself would be impossi-<font color="#ffffff" class="whiteout">ble&nbsp;impossible</font>
       ble with <u>cmd.exe</u> as a shell, thus I picked up "sh.exe". This assures almost 100% compatibility with
       the scripts coming from *nix. As an added benefit this works as well under DOS if you use DOS-enabled
       port of pdksh (see "Prerequisites").

       <b>Disadvantages:</b> currently <u>sh.exe</u> of pdksh calls external programs via <u>fork()</u>/<u>exec()</u>, and there is <u>no</u>
       functioning <u>exec()</u> on OS/2. <u>exec()</u> is emulated by EMX by an asynchronous call while the caller waits
       for child completion (to pretend that the "pid" did not change). This means that 1 <u>extra</u> copy of
       <u>sh.exe</u> is made active via <u>fork()</u>/<u>exec()</u>, which may lead to some resources taken from the system (even
       if we do not count extra work needed for <u>fork()</u>ing).

       Note that this a lesser issue now when we do not spawn <u>sh.exe</u> unless needed (metachars found).

       One can always start <u>cmd.exe</u> explicitly via

         system 'cmd', '/c', 'mycmd', 'arg1', 'arg2', ...

       If you need to use <u>cmd.exe</u>, and do not want to hand-edit thousands of your scripts, the long-term
       solution proposed on p5-p is to have a directive

         use OS2::Cmd;

       which will override <u>system()</u>, <u>exec()</u>, ``, and "open(,'...|')". With current perl you may override
       only <u>system()</u>, <u>readpipe()</u> - the explicit version of ``, and maybe <u>exec()</u>. The code will substitute
       the one-argument call to <u>system()</u> by "CORE::system('cmd.exe', '/c', shift)".

       If you have some working code for "OS2::Cmd", please send it to me, I will include it into distribu-<font color="#ffffff" class="whiteout">tion.&nbsp;distribution.</font>
       tion. I have no need for such a module, so cannot test it.

       For the details of the current situation with calling external programs, see "2 (and DOS) programs
       under Perl" in Starting OS.  Set us mention a couple of features:

          External scripts may be called by their basename.  Perl will try the same extensions as when pro-<font color="#ffffff" class="whiteout">cessing&nbsp;processing</font>
           cessing <b>-S</b> command-line switch.

          External scripts starting with "#!" or "extproc " will be executed directly, without calling the
           shell, by calling the program specified on the rest of the first line.

       <b>Memory</b> <b>allocation</b>

       Perl uses its own <u>malloc()</u> under OS/2 - interpreters are usually malloc-bound for speed, but perl is
       not, since its malloc is lightning-fast.  Perl-memory-usage-tuned benchmarks show that Perl's malloc
       is 5 times quicker than EMX one.  I do not have convincing data about memory footprint, but a (pretty
       random) benchmark showed that Perl's one is 5% better.

       Combination of perl's <u>malloc()</u> and rigid DLL name resolution creates a special problem with library
       functions which expect their return value to be <u>free()</u>d by system's <u>free()</u>. To facilitate extensions
       which need to call such functions, system memory-allocation functions are still available with the
       prefix "emx_" added. (Currently only DLL perl has this, it should propagate to <u>perl</u><b>_</b><u>.exe</u> shortly.)

       <b>Threads</b>

       One can build perl with thread support enabled by providing "-D usethreads" option to <u>Configure</u>.
       Currently OS/2 support of threads is very preliminary.

       Most notable problems:

       "COND_WAIT"
           may have a race condition (but probably does not due to edge-triggered nature of OS/2 Event sema-<font color="#ffffff" class="whiteout">phores).&nbsp;semaphores).</font>
           phores).  (Needs a reimplementation (in terms of chaining waiting threads, with the linked list
           stored in per-thread structure?)?)

       <u>os2.c</u>
           has a couple of static variables used in OS/2-specific functions.  (Need to be moved to per-<font color="#ffffff" class="whiteout">thread&nbsp;perthread</font>
           thread structure, or serialized?)

       Note that these problems should not discourage experimenting, since they have a low probability of
       affecting small programs.

<b>BUGS</b>
       This description is not updated often (since 5.6.1?), see <u>./os2/Changes</u> (perlos2delta) for more info.

<b>AUTHOR</b>
       Ilya Zakharevich, cpan@ilyaz.org

<b>SEE</b> <b>ALSO</b>
       <a href="perl.1.html#//apple_ref/doc/man/1/perl"><u>perl</u>(1)</a>.



perl v5.8.8                                      2006-01-07                                       PERLOS2(1)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man1/perlos2.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man1/perlos2.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man1/perlos2.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
