<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Sending a Shutdown or Restart Event (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING156></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-155.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-157.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-146.html"><B>Chapter 8 - Shutdown Manager</B></A> / <A HREF="Processes-155.html"><B>Using the Shutdown Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING156-0></A>
<H2><A NAME=MARKER-9-75></A>Sending a Shutdown or Restart Event<A NAME=MARKER-2-76></A></H2>
 Applications that support high-level events can send a Shutdown or Restart event to the Finder to request the system to shut down or restart. Once notified, the Finder calls the Process Manager, which gives open applications the opportunity to exit gracefully before the computer shuts down or restarts. The Process Manager checks its list of open applications and sends a Quit Application event to applications that can process Apple events. For applications that can't, the Process Manager sends a mouse-down event indicating that Quit was chosen from the File menu. Applications that display the Quit item in a different menu or that use a different wording must specify a resource of type<DFN> <CODE>'mstr'</CODE></DFN> or <CODE>'mst#'</CODE>with a resource ID of 100 or 101, respectively. Once notified, the open applications then have time to perform cleanup operations (such as displaying a Save Changes alert box) before quitting.<A NAME=MARKER-2-77></A><A NAME=MARKER-2-78></A><A NAME=MARKER-2-79></A><A NAME=MARKER-2-80></A><A NAME=MARKER-2-81></A><A NAME=MARKER-2-82></A><A NAME=MARKER-2-83></A><P>
 The Shutdown and Restart events have the event class defined by the <CODE>kAEFinderEvents</CODE> constant.<P>
<PRE>
CONST
   kAEFinderEvents = 'FNDR';     {event class for Finder}
</PRE>
 The Restart event has the event ID defined by the <CODE>kAERestart</CODE> constant, and the Shutdown event has the event ID defined by the <CODE>kAEShutDown</CODE> constant:<P>
<PRE>
CONST
   kAERestart = 'rest';    {event ID for Restart event}
   kAEShutDown = 'shut';   {event ID for Shutdown event}
</PRE>
 <A HREF=#MARKER-9-84>Listing 8-1</A> defines a function that sends a Shutdown event to the Finder.<P>
<B>Listing 8-1  <A NAME=MARKER-9-84></A>Sending a Shutdown event</B><P>
<PRE>
FUNCTION ShutDownSafely: OSErr;
CONST
   kFinderSig = 'FNDR';
VAR
   myErr:         OSErr;
   finderAddr:    AEDesc;
   myShutDown:    AppleEvent;
   nilReply:      AppleEvent;
BEGIN
   myErr := AECreateDesc(typeApplSignature, kFinderSig,
                        SizeOf(OSType), finderAddr);
   IF myErr = noErr THEN
      myErr := AECreateAppleEvent(kAEFinderEvents, kAEShutDown,
                              finderAddr, kAutoGenerateReturnID,
                              kAnyTransactionID, myShutDown);
   IF myErr = noErr THEN
      myErr := AESend(myShutDown, nilReply, kAENoReply +
                  kAECanSwitchLayer + kAEAlwaysInteract,
                  kAENormalPriority, kAEDefaultTimeout, NIL, NIL);
   ShutDownSafely := myErr;
END;
</PRE>
 To send a Shutdown or Restart event, you must call three Apple Event Manager functions. First, use the <CODE>AECreateDesc</CODE> function to create an address descriptor record that specifies the address of the Finder. You can specify the address of the Finder by its signature<DFN>, <CODE>'FNDR'</CODE></DFN>. Next, call <CODE>AECreateAppleEvent</CODE> to create the Apple event you want to send. Finally, call the <CODE>AESend</CODE> function. Use the Apple event returned in the <CODE>myShutDown</CODE> variable of the <CODE>AECreateAppleEvent</CODE> function as the Apple event to send in <CODE>AESend</CODE>.<A NAME=MARKER-2-85></A><A NAME=MARKER-2-86></A><A NAME=MARKER-2-87></A><P>
 After sending the event, remember to dispose of the descriptor record and Apple event at some point, by calling the <CODE>AEDisposeDesc</CODE> function. For complete details about this function and the ones used in <A HREF=#MARKER-9-84>Listing 8-1</A>, see the chapter "Apple Event Manager" in Inside Macintosh: Interapplication Communication.<A NAME=MARKER-2-88></A><A NAME=MARKER-2-89></A><A NAME=MARKER-2-90></A><A NAME=MARKER-2-91></A><P>
<DL>
<DT><B>Note</B>
<DD>Applications running under system software version 6.0.x cannot send Apple events to MultiFinder because it cannot process them. As a result, your application cannot request that open applications be notified to quit before it calls <CODE>ShutDwnPower</CODE> and <CODE>ShutDwnStart</CODE>. Therefore, you should avoid calling these procedures unless absolutely necessary.<B></B> <A NAME=MARKER-2-92></A><A NAME=MARKER-2-93></A>  <B>&#183;</B>
</DL>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-155.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-157.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
