<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects for Windows Developers (Legacy): Creating a WebObjects  Database Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating a WebObjects  Database Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001016-CH205" title="Creating a WebObjects  Database Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../LegacyTechnologies/InternetWeb-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000526" target="_top">Internet &amp; Web</a> &gt; <a href="../Preface/Preface.html#//apple_ref/doc/uid/TP30001016-CH202-DontLinkElementID_77">WebObjects for Windows Developers (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../GuestBookPlus/GuestBookPlus.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30001016-CH205-DontLinkElementID_73" title="Creating a WebObjects  Database Application"></a><h1><a name="//apple_ref/doc/uid/TP30001016-CH205-BCIBIDDC" title="Creating a WebObjects  Database Application"></a>Creating a WebObjects  Database Application</h1><p>One of the most powerful features of WebObjects is its ability to provide access to databases. To do so, it uses a framework called the Enterprise Objects Framework. This chapter introduces you to the Enterprise Objects Framework by showing you how to create a simple database application. The steps you take in creating this application demonstrate the principles you’ll use in every other application you develop with the WebObjects and Enterprise Objects frameworks.</p><p>The application you’ll create in this tutorial is called Movies. It makes use of a sample database, the Movies database, that contains information about movies. In this tutorial we’ll use the OpenBase Lite database that comes with WebObjects. If you wish to use another database, you need to set up the Movies database as described in the Post-Installation Instructions. Also, if you aren’t familiar with Project Builder and WebObjects Builder, read the first tutorials in this book, <span class="content_text"><a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCIBIDDC">“Creating a WebObjects Database Application”</a></span> and <span class="content_text"><a href="../GuestBookPlus/GuestBookPlus.html#//apple_ref/doc/uid/TP30001016-CH204-BCIBIIHJ">“Enhancing Your Application,”</a></span> which introduce basic concepts and procedures you should know before you go on.</p><p>In this tutorial, you will</p><ul class="ul"><li class="li"><p>Use EOModeler’s wizard to create a basic model file.</p></li><li class="li"><p>Use the WebObjects Application Wizard to create a fully functional Main component that reads and writes from the Movies database.</p></li><li class="li"><p>Create custom enterprise object classes.</p></li><li class="li"><p>Create and configure <em>display groups</em> for interacting with a database in terms of objects.</p></li><li class="li"><p>Create bindings between display groups and a user interface.</p></li><li class="li"><p>Write code to manipulate display groups’ selected objects.</p></li><li class="li"><p>Set up display groups in a master-detail configuration.</p></li><li class="li"><p>Use EOModeler to enhance a model file.</p></li></ul><p>Along the way, you’ll learn basic Enterprise Objects Framework concepts you can use to design your own database applications.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001016-CH205-DontLinkElementID_74" title="Note"></a><p><strong>Note:</strong>&nbsp;You can also develop database applications using Direct to Web, a high-level framework based on WebObjects. Direct to Web instantly generates a generic database application and allows you to modify its user interface, which makes it a useful starting point for simple projects without very specific user interface requirements. See <em>Developing WebObjects Applications With Direct to Web</em> for more information.</p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF101">The Movies Application</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF102">Enterprise Objects and the Movies Database</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF104">Defining the Model</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF110">Designing the Main Page</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF119">Examining Your Project</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF125">Refining Main.wo</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF129">Adding the MovieDetails Page</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF137">Refining Your Model</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF142">Setting Up a Master-Detail Configuration</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-TPXREF147">Updating Objects in the Detail Display Group</a>
				
			<br/>
			
        
			
			
				<a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCIGCIBA">Adding Behavior to Your Enterprise Objects</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF101" title="The Movies Application"></a><h2>The Movies Application</h2><p>The Movies application has two pages, each of which allows you to access information from the database in different ways: </p><ul class="ul"><li class="li"><p><em>MovieSearch</em> (the main page) lets you search for movies that match user-specified criteria. For example, you can search for all comedies starting with the letter “A”. Once you find the movie you’re looking for, you can make changes to its data or delete it. You can also use this page to insert new movies into the database.</p></li><li class="li"><p><em>MovieDetails</em> displays the actors who star in a selected movie and the roles those actors play. You can add new roles, change the name of a role, and assign a different actor to a role.</p><div class="item_figure"><img src = "../art/main.gif" alt = "image: ../art/main.gif" width="251" height="405"></div><div class="item_figure"><img src = "../art/detail.gif" alt = "image: ../art/detail.gif" width="402" height="382"></div></li></ul><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF102" title="Enterprise Objects and the Movies Database"></a><h2>Enterprise Objects and the Movies Database</h2><p>Enterprise <a name="//apple_ref/doc/uid/TP30001016-CH205-DontLinkElementID_79"></a>Objects Framework manages the interaction between the database and objects in the Movies application. Its primary responsibility is to fetch data from relational databases into <em>enterprise objects</em>. An enterprise object, like any other object, couples data with methods for operating on that data. In addition, an enterprise object has properties that map to stored data. Enterprise object classes typically correspond to database tables. An enterprise object instance corresponds to a single row or record in a database table.</p><p>The Movies application centers around three kinds of enterprise objects: Movies, MovieRoles, and Talents. A movie has many roles, and talents (or actors) play those roles.</p><p>The Movie, MovieRole, and Talent enterprise objects in the Movies application correspond to tables in a relational database. For example, the Talent enterprise object corresponds to the TALENT table in the database, that has LAST_NAME and FIRST_NAME columns. The Talent enterprise object class in turn has <code>lastName</code> and <code>firstName</code> instance variables. In an application, Talent objects are instantiated using the data from a corresponding database row, as shown in the following figure:</p><br/><div><img src = "../art/dbtoeo.gif" alt = "image: ../art/dbtoeo.gif" width="316" height="220"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF103" title="Enterprise Objects and Relationships"></a><h3>Enterprise Objects and Relationships</h3><p>Relational databases model not just individual entities, but entities’ relationships to one another. For example, a movie has zero, one, or more roles. This is modeled in the database by both the MOVIE table and MOVIE_ROLE table having a MOVIE_ID column. In the MOVIE table, MOVIE_ID is a <em>primary key</em>, while in MOVIE_ROLE it’s a <em>foreign</em><em>key</em>.</p><p>A primary key is a column or combination of columns whose values are guaranteed to uniquely identify each row in that table. For example, each row in the MOVIE table has a different value in the MOVIE_ID column, which uniquely identifies that row. Two movies could have the same name but still be distinguished from each other by their MOVIE_IDs. </p><p>A foreign key matches the value of a primary key in another table. The purpose of a foreign key is to identify a relationship from a source table to a destination table. In the following diagram, notice that the value in the MOVIE_ID column for both MOVIE_ROLE rows is 501. This matches the value in the MOVIE_ID column of the “Alien” MOVIE row. In other words, “Ripley” and “Ash” are both roles in the movie “Alien.”</p><br/><div><img src = "../art/dbrel.gif" alt = "image: ../art/dbrel.gif" width="281" height="145"></div><br/><p>Suppose you fetch a Movie object. Enterprise Objects Framework takes the value for the movie’s MOVIE_ID attribute and looks up movie roles with the corresponding MOVIE_ID foreign key. The framework then assembles a network of enterprise objects that connects a Movie object with its MovieRole objects. As shown below, a Movie object has an array of its MovieRoles, and the MovieRoles each have a Movie.</p><br/><div><img src = "../art/eogrph.gif" alt = "image: ../art/eogrph.gif" width="281" height="267"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF104" title="Defining the Model"></a><h2>Defining the Model</h2><p>A <em>model </em>associates database columns with instance variables of objects. It also specifies relationships between objects in terms of database join criteria. You create model files using the EOModeler application. The wizard can assist you in creating a model using the schema information from an existing database as a starting point. You can then use EOModeler to modify the model.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF105" title="Creating a New Model File"></a><h3>Creating a New Model File</h3><ol class="ol"><li class="li"><p>Launch EOModeler.</p><p>The EOModeler application is located in the WebObjects application group.</p></li><li class="li"><p>Choose Model > New.</p><p>The wizard’s adaptor selection panel appears. An <em>adaptor</em> is a mechanism that connects your application to a database. WebObjecject provides a JDBC adaptor that enables you to access any JDBC-compliant database. Make sure that JDBC is selected in the selection list.</p></li><li class="li"><p>Click Next.</p><div class="item_figure"><img src = "../art/eomnewmodelwizardjdbc.gif" alt = "image: ../art/eomnewmodelwizardjdbc.gif" width="320" height="170"></div><p>This panel lets you specify connection information to your database. The only information required for the tutorial is the URL. On the URL field type “jdbc:openbase://localhost/WOMovies” without the quotes.</p></li><li class="li"><p>Click OK.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF106" title="Choosing What to Include in Your Model"></a><h3>Choosing What to Include in Your Model</h3><p>In this next wizard page, you can specify the degree to which the wizard configures your model.</p><br/><div><img src = "../art/eomnewmodelwizardwhat.gif" alt = "image: ../art/eomnewmodelwizardwhat.gif" width="350" height="248"></div><br/><p>The basic model the wizard creates contains entities, attributes, and relationships. An <em>entity</em> is the part of the database-to-object mapping that associates a database table with an enterprise object class. For example, the Movie entity maps rows from the MOVIE table to Movie objects. Similarly, an <em>attribute</em> associates a database column with an instance variable. For example, the <code>title</code> attribute in the Movie entity maps the TITLE column of the MOVIE table to the <code>title</code> instance variable of Movie objects.</p><p>A <em>relationship</em> is a link between two entities that’s based on attributes of the entities. For example, the Movie entity has a relationship to the MovieRole entity based on the entities’ <code>movieId</code> attributes (although the attributes in this example have the same name in both entities, they don’t have to). This relationship makes it possible to find all of a Movie’s MovieRoles.</p><p>How complete the basic model is depends on the completeness of the schema information inside your database server. For example, the wizard includes relationships in your model only if the server’s schema information specifies foreign key definitions.</p><p>Using the options in this page, you can supplement the basic model with additional information. (Note that the wizard doesn’t modify the underlying database.)</p><ol class="ol"><li class="li"><p>Check the “Assign primary keys to all entities” box.</p><p>Enterprise Objects Framework uses primary keys to uniquely identify enterprise objects and to map them to the appropriate database row. Therefore, you must assign a primary key to each entity you use in your application. The wizard automatically assigns primary keys to the model if it finds primary key information in the database’s schema information.</p><p>Checking this box causes the wizard to prompt you to choose primary keys that aren’t defined in the database’s schema information. If your database doesn’t define them, the wizard later prompts you to choose primary keys.</p></li><li class="li"><p>Check the “Ask about relationships” box.</p><p>If there are foreign key definitions in the database’s schema information, the wizard includes the corresponding relationships in the basic model. However, a definition in the schema information doesn’t provide enough information for the wizard to set all of a relationship’s options. Checking this box causes the wizard to prompt you to provide the additional information it needs to complete the relationship configurations.</p></li><li class="li"><p>Uncheck the “Ask about stored procedures” box.</p><p>Checking this box causes the wizard to read stored procedures from the database’s schema information, display them, and allow you to choose which to include in your model. Because the Movies application doesn’t require the use of any stored procedures, don’t check this box.</p></li><li class="li"><p>Uncheck the “Use custom enterprise objects” box.</p><p>An entity maps a table to enterprise objects by storing the name of a database table (MOVIE, for example) and the name of the corresponding enterprise object class (a Java class, Movie, for example). When deciding what class to map a table to, you have two choices: EOGenericRecord or a custom class. EOGenericRecord is a class whose instances store key-value pairs that correspond to an entity’s properties and the data associated with each property.</p><p>If you don’t check the “Use custom enterprise objects” box, the wizard maps all your database tables to EOGenericRecord. If you do check this box, the wizard maps all your database tables to custom classes. The wizard assumes that each entity is to be represented by a custom class with the same name. For example, a table named MOVIE has an entity named Movie, whose corresponding custom class is also named Movie.</p><p>Use a custom enterprise object class only when you need to add business logic; otherwise use EOGenericRecord. The Movies application uses EOGenericRecord for the Movie entity and custom classes for the Talent and MovieRole entities. Later on, you’ll use EOModeler to specify the custom classes.</p></li><li class="li"><p>Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF107" title="Choosing the Tables to Include"></a><h3>Choosing the Tables to Include</h3><ol class="ol"><li class="li"><p>In the wizard panel, select MOVIE, MOVIE_ROLE, and TALENT in the Tables browser.</p><div class="item_figure"><img src = "../art/eomnewmodelwizardtables.gif" alt = "image: ../art/eomnewmodelwizardtables.gif" width="351" height="250"></div><p>The wizard creates entities only for the tables you select. Since the Movies application doesn’t interact with any of the other tables (for example, DIRECTOR, PLOT_SUMMARY, STUDIO, and TALENT_PHOTO), you don’t need to include them in the model.</p><p>Click on Select None. Then select the MOVIE, MOVIE_ROLE, and TALENT tables. You will need to use the Control key to make your selections.</p></li><li class="li"><p>Click Next.</p></li><li class="li"><p>Click Finish</p><div class="item_figure"><img src = "../art/eomnewmodelwizardfinished.gif" alt = "image: ../art/eomnewmodelwizardfinished.gif" width="352" height="250"></div></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF109" title="Saving the Model"></a><h3>Saving the Model</h3><p>Once the wizard is finished gathering schema information, it’s ready to create the model.</p><ol class="ol"><li class="li"><p>Choose Model > Save.</p><p>Navigate to a directory where you want to save the model.</p></li><li class="li"><p>Type “Movies” in the File name field.</p></li><li class="li"><p>Click Save.</p></li><li class="li"><p>Close EOModeler.</p></li></ol><br/><div><img src = "../art/eomnewmodel.gif" alt = "image: ../art/eomnewmodel.gif" width="373" height="336"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF110" title="Designing the Main Page"></a><h2>Designing the Main Page</h2><p>Every WebObjects application has at least one component—usually named Main—that represents the first page the application displays. In Movies, the Main component represents the MovieSearch page.</p><p>To design the Main component, you’ll use the WebObjects Application Wizard. The wizard performs all the setup that’s necessary to fetch database records and display them in a web page. Specifying different wizard options yields different pages: The MovieSearch page is an example of one of the many different layouts you can generate with the wizard.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF111" title="Starting the WebObjects Application Wizard"></a><h3>Starting the WebObjects Application Wizard</h3><ol class="ol"><li class="li"><p>In Project Builder, choose Project > New.</p></li><li class="li"><p>In the New Project panel, select Java WebObjects Application from the Project Type pop-up list.</p></li><li class="li"><p>Click Browse.</p></li><li class="li"><p>Navigate to a directory where you want to create your new project.</p></li><li class="li"><p>Type Movies in the “File name” field.</p></li><li class="li"><p>Click Save.</p></li><li class="li"><p>In the New Project panel, click OK.</p><p>This starts the WebObjects Application Wizard.</p></li><li class="li"><p>Choose Wizard under Available Assistance.</p><p>With this option, the wizard guides you through the creation of a Main component for your application. When you finish, you can immediately build and run your application without performing any additional steps and without adding any code.</p></li><li class="li"><p>Click Next.</p></li><li class="li"><p>For the “J2EE Integration” window, leave the defaults and click Next.</p></li><li class="li"><p>For the “Web Services” window, leave the defaults and click Next.</p></li><li class="li"><p>In the “Choose EOAdapters” window, make sure JDBC is selected, and click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF112" title="Specifying a Model File"></a><h3>Specifying a Model File</h3><br/><div><img src = "../art/pbnewprojectwizardmodel.gif" alt = "image: ../art/pbnewprojectwizardmodel.gif" width="351" height="252"></div><br/><ol class="ol"><li class="li"><p>Choose “Open existing model”.</p></li><li class="li"><p>Click Browse.</p></li><li class="li"><p>Navigate to the directory where you saved the model.</p></li><li class="li"><p>Select <code>Movies.eomodeld</code>.</p></li><li class="li"><p>Click Open.</p></li><li class="li"><p>Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF113" title="Choosing an Entity"></a><h3>Choosing an Entity</h3><p>In this page, the wizard asks you to choose the entity around which the Main component will be centered. Your Main component centers around the Movie entity.</p><ol class="ol"><li class="li"><p>Select the Movie entity.</p></li><li class="li"><p>Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF114" title="Choosing a Layout"></a><h3>Choosing a Layout</h3><p>The wizard provides several page layout options for formatting objects fetched from the database.</p><ol class="ol"><li class="li"><p>Choose Selected Record.</p></li><li class="li"><p>Choose Matching Records.</p><div class="item_figure"><img src = "../art/pbnewprojectwizardlayout.gif" alt = "image: ../art/pbnewprojectwizardlayout.gif" width="350" height="251"></div><p>Based on your specifications, the wizard shows you a preview of the page it will generate. To see how the wizard’s preview corresponds with the actual page the wizard will create, the finished page is shown below.</p><div class="item_figure"><img src = "../art/runmain.gif" alt = "image: ../art/runmain.gif" width="408" height="298"></div><p>There are three parts to this page: the query part (at the top of the page), which contains fields in which users provide search criteria; the repetition part (in the middle of the page), which contains a list of matching records fetched from the database; and the editing part (at the bottom of the page), which allows you to make changes to the selected record.</p></li><li class="li"><p>In the wizard panel, click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF115" title="Choosing Attributes to Display"></a><h3>Choosing Attributes to Display</h3><p>The next step is to choose which of the Movie entity’s attributes to display in the editing part at the bottom of the page.</p><ol class="ol"><li class="li"><p>Move attributes from the Don’t Include list to the Include list.</p><div class="item_figure"><img src = "../art/pbnewprojectwizardatts.gif" alt = "image: ../art/pbnewprojectwizardatts.gif" width="349" height="249"></div><p>The order in which you add the attributes determines the order in which they appear on the page, so add them in the following order: <code>title</code>, <code>category</code>, <code>dateReleased</code>, and <code>revenue</code>.</p><p>Don’t add any of the remaining attributes (for example, <code>trailerName</code>, <code>studioId</code>, <code>rated</code>, and <code>posterName</code>)—they aren’t used in this tutorial.</p></li><li class="li"><p>Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF116" title="Choosing an Attribute to Display as a Hyperlink"></a><h3>Choosing an Attribute to Display as a Hyperlink</h3><p>You now need to specify the attribute used in the repetition part of the page to identify each record. This attribute will be displayed as a hyperlink. Clicking the hyperlink displays the corresponding record in the detail part of the page.</p><ol class="ol"><li class="li"><p>Add the <code>title</code> attribute to the Include browser.</p></li><li class="li"><p>Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF117" title="Choosing Attributes to Query On"></a><h3>Choosing Attributes to Query On</h3><p>Specify the attributes to display in the query part of the page. The wizard creates search criteria fields for each of the attributes you choose.</p><ol class="ol"><li class="li"><p>Add the <code>title</code> and <code>category</code> attributes to the Include browser.</p></li><li class="li"><p>Click Finish.</p></li></ol><p>When the wizard finishes, your new project is displayed in Project Builder. The wizard has produced all the files and resources for a fully functional, one-page application. All you need to do before running your Movies application is build it.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF118" title="Running Movies"></a><h3>Running Movies</h3><br/><div><a name="//apple_ref/doc/uid/TP30001016-CH205-DontLinkElementID_75" title="Figure 3-1Build and run the application as you did in the previous tutorials."></a><p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF158" title="Figure 3-1Build and run the application as you did in the previous tutorials."></a><strong>Figure 3-1&nbsp;&nbsp;</strong>Build and run the application as you did in the previous tutorials.</p><img src = "../art/runmain2.gif" alt = "Build and run the application as you did in the previous tutorials." width="397" height="338"></div><br/><p>Experiment with the application by entering different search criteria and inserting, updating, and deleting movies. For example:</p><ol class="ol"><li class="li"><p>Search for all movies beginning with the letter “A”.</p><p>Type A in the title field, and click Match.</p></li><li class="li"><p>Change the attributes of one of the movies and click “Save to database.”</p><p>When you’re done, perform another search to verify that your change was saved.</p></li><li class="li"><p>Create a new movie.</p><p>Click Insert/New to create a new, empty movie. Fill out all the fields, and click “Save to database.” Search for your movie to verify that it was saved successfully.</p></li><li class="li"><p>Delete your movie.</p><p>With your movie selected, click Delete and then click “Save to database.” When you’re done, search for the movie again to verify that it’s been deleted.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF119" title="Examining Your Project"></a><h2>Examining Your Project</h2><p>Whenever you create a new project, Project Builder populates the project with ready-made files and directories. What it includes depends on the choices you make in the wizard, so this project has a set of files different from those of the GuestBook project.</p><p>Like GuestBook, the Movies project contains a Main component (<code>Main.wo</code>). It also includes some files that the GuestBook doesn’t have: a model file, and images used by the Main component.</p><p>In Project Builder, navigate to the Movie project’s Resources category. This is where the model, named <code>Movies.eomodeld</code>, is located. Later in this tutorial you’ll use EOModeler to open the model and enhance it.</p><br/><div><img src = "../art/projreso.gif" alt = "image: ../art/projreso.gif" width="339" height="145"></div><br/><p>Navigate to the Web Server Resources category. This is where your project’s images are located: <code>DBWizardUpdate.gif</code>, <code>DBWizardDelete.gif</code>, and <code>DBWizardInsert.gif</code>, for the “Save to database,” “Delete”, and “Insert/New” buttons, respectively.</p><p>The biggest difference between the GuestBook and Movies projects is their Main components. Whereas the Main component you created for the GuestBook project was empty, the Main component for the Movies project contains a fully functional user interface. Also, the <code>Main.java</code> class already contains code that supplies the component with behavior. In the next sections, you’ll examine the Movies project’s <code>Main.wo</code> component and its <code>Main.java</code> class.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF120" title="Examining the Variables"></a><h3>Examining the Variables</h3><ol class="ol"><li class="li"><p>Double-click <code>Main.wo</code> in Project Builder’s Web Components category to open the Main component in WebObjects Builder.</p><p>There are four variables in the object browser: the <code>application</code> and <code>session</code> variables that are available in all components and two others, <code>movie</code> and <code>movieDisplayGroup</code>.</p><p>The<code> movie</code> variable is an enterprise object that represents a row fetched from the MOVIE table. <code>movieDisplayGroup</code> is a <em>display group</em>—an object that interacts with a database, indirectly through classes in the Enterprise Objects Framework. Display groups are used to fetch, insert, update, and delete enterprise objects that are associated with a single entity. The entity of <code>movieDisplayGroup</code> is Movie, which you specified in the wizard’s “Choose an entity” page.</p></li><li class="li"><p>In Project Builder, look at the class file <code>Main.java</code> to see how <code>movie</code> is declared.</p><p>The <code>movie</code> declaration (shown below) declares <code>movie</code> to be an EOEnterpriseObject—a Java interface that describes the general behavior that all enterprise objects must have.</p><div class="codesample"><table><tr><td scope="row"><pre>    /** @TypeInfo Movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    protected EOEnterpriseObject movie;<span></span></pre></td></tr></table></div><p>At runtime, <code>movie</code> is a EOGenericRecord object. Recall that EOGenericRecord is used to represent enterprise objects unless you specify a custom class. Since you didn’t check the “Use custom enterprise objects” box in the wizard’s “Choose what to include in your model” page, your application uses EOGenericRecord for all its entities.</p><p>The comment (/** @TypeInfo Movie */) is used by WebObjects Builder to identify <code>movie</code>’s entity (Movie). Knowing the entity allows WebObjects Builder to display <code>movie</code>’s attributes (<code>category</code>, <code>dateReleased</code>, and so on). You can see <code>movie</code>’s attributes if you select the <code>movie</code> variable in the WebObjects Builder’s object browser.</p></li><li class="li"><p>In Project Builder, examine the <code>movieDisplayGroup</code> declaration in <code>Main.java</code>.</p><p>The declaration (shown below) declares <code>movieDisplayGroup</code> to be a WODisplayGroup.</p><div class="codesample"><table><tr><td scope="row"><pre>    protected WODisplayGroup movieDisplayGroup;<span></span></pre></td></tr></table></div><p>Also note the comment explaining how <code>movieDisplayGroup</code> is initialized. The <code>Main.java</code> class doesn’t have any code to create and initialize the display group. Instead, it’s instantiated from an archive file, <code>Main.woo</code>, that’s stored in the <code>Main.wo</code> component. You shouldn’t edit <code>woo</code> files by hand; they’re maintained by WebObjects Builder. The <code>woo</code> file archiving mechanism is described in more detail later in <span class="content_text"><a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCIJJBDJ">“Specifying a Sort Order.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF121" title="Examining the Bindings"></a><h3>Examining the Bindings</h3><p>Now examine the bindings of your Main component in WebObjects Builder.</p><br/><div><img src = "../art/mainwo.gif" alt = "image: ../art/mainwo.gif" width="414" height="244"></div><br/><p></p><p>Remember that you can use WebObjects Builder’s Inspector to see the bindings for an element’s attributes. Simply select the element to inspect, and click the </p><br/><div><img src = "../art/inspector.gif" alt = "image: ../art/inspector.gif" width="23" height="23"></div><br/><p> button to open the Inspector.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF122" title="Bindings in the Query Part"></a><h4>Bindings in the Query Part</h4><p>In the query part of the component, <code>movieDisplayGroup.queryMatch.title</code> is bound to the title text field. There are similar bindings to the category text fields. The <code>queryMatch</code> bindings allow users to specify search criteria to use when <code>movieDisplayGroup</code> next fetches movies. The Match button is bound to <code>movieDisplayGroup.qualifyDataSource</code>, that actually performs the fetch.</p><p>For example, to display all comedies, a user types “Comedy” in the Category text field, and clicks the Match button. <code>movieDisplayGroup</code> then refetches, selecting only movies whose <code>category</code> values are set to Comedy.</p><br/><div><img src = "../art/queryprt.gif" alt = "image: ../art/queryprt.gif" width="399" height="116"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF123" title="Bindings in the Repetition Part"></a><h4>Bindings in the Repetition Part</h4><p>In the repetition part of the component where matching movies are listed, <code>movieDisplayGroup.displayedObjects</code> is bound to a repetition. More specifically, <code>displayedObjects</code> is bound to the repetition’s <code>list</code> attribute, providing an array of movies for the repetition to iterate over.</p><p>The <code>movie</code> variable is bound to the repetition’s <code>item</code> attribute to hold each movie in turn, and <code>movie.title</code> is bound to the string element inside the repetition. These bindings produce a list of movie titles.</p><br/><div><img src = "../art/repprt.gif" alt = "image: ../art/repprt.gif" width="408" height="86"></div><br/><p></p><p>The repetition’s string element is enclosed in a hyperlink. By clicking a movie title, the user <em>selects</em> the corresponding movie.</p><ol class="ol"><li class="li"><p>Inspect the hyperlink.</p><p>Its <code>action</code> attribute is bound to the action method <code>selectObject</code>.</p><div class="item_figure"><img src = "../art/linkinsp.gif" alt = "image: ../art/linkinsp.gif" width="399" height="99"></div></li><li class="li"><p>Look in the <code>Main.java</code> class to see how the <code>selectObject</code> method is implemented.</p><p>The method (shown below) simply sets the selected object of <code>movieDisplayGroup</code> to the movie the user clicked.</p><div class="codesample"><table><tr><td scope="row"><pre>    public void selectObject() {        movieDisplayGroup.selectObject(movie);    }<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF124" title="Bindings in the Editing Part"></a><h4>Bindings in the Editing Part</h4><p>The text fields in the editing part are all bound to attributes of the <code>movieDisplayGroup </code>object’s<code> selectedObject</code>—the movie on which the user clicked. Typing new values into these fields updates the Movie enterprise object. To actually save the updated values to the database, the user must click the “Save to database” button.</p><br/><div><img src = "../art/editprt.gif" alt = "image: ../art/editprt.gif" width="400" height="145"></div><br/><ol class="ol"><li class="li"><p>Inspect the middle image button.</p><p>Its <code>action</code> attribute is bound to the action method <code>saveChanges</code>.</p></li><li class="li"><p>Look in the <code>Main.java</code> class to see how <code>saveChanges</code> is implemented.</p><p>The method (shown below with comments omitted) simply saves any changes that have been made to <code>movieDisplayGroup</code>’s objects to the database.</p><div class="codesample"><table><tr><td scope="row"><pre>    public void saveChanges() throws Exception {<span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            this.session().defaultEditingContext().saveChanges();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        catch (Exception exception) {<span></span></pre></td></tr><tr><td scope="row"><pre>            NSLog.err.appendln("Cannot save changes ");<span></span></pre></td></tr><tr><td scope="row"><pre>            throw exception;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p><code>this.session()</code> returns a Session object that represents a connection to the application by a single user. A Session object provides access to an EOEditingContext object. The expression</p><div class="codesample"><table><tr><td scope="row"><pre>    this.session().defaultEditingContext().saveChanges();<span></span></pre></td></tr></table></div><p>sends a <code>saveChanges</code> message to the Session’s <code>defaultEditingContext</code>. This default EOEditingContext object manages graphs of objects fetched from the database, and all changes to the database are saved through it. For more information, see the EOEditingContext class specification in the WebObjects API Reference.</p><p>An EOEditingContext’s <code>saveChanges</code> method uses other Enterprise Objects Framework objects to analyze its network of enterprise objects (Movie objects referenced by the application) for changes and then to perform a set of corresponding operations in the database. If an error occurs during this process, <code>saveChanges</code> throws an exception. The <code>Main.java</code><code>saveChanges</code> method simply raises the exception, having the effect of returning a diagnostic page. You could return an error page that explains the reason for the save failure instead, but the application in this tutorial uses the default behavior.</p></li><li class="li"><p>Inspect the first and third image buttons to see what their <code>action</code> attributes are bound to.</p><p>They are bound to the <code>movieDisplayGroup.insert</code> and <code>movieDisplayGroup.delete</code> methods respectively. The WODisplayGroup <code>insert</code> method creates a new enterprise object, then inserts it into the display group’s list of objects just past the current selection. The WODisplayGroup <code>delete</code> method deletes the display group’s selected object. These changes happen only in memory—not in the database. To actually insert a new row in the database (or delete a row), the user must click the “Save to database” button, invoking <code>saveChanges</code> on the session’s EOEditingContext. The editing context analyzes the enterprise objects in memory, determines if any objects have been added, updated, or deleted, and then executes database operations to sync the database with the application.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF125" title="Refining Main.wo"></a><h2>Refining Main.wo</h2><p>You may have noticed that your application doesn’t list fetched movies in any particular order. Also, when you insert a new movie, it appears in the list of movies as a blank line.</p><br/><div><img src = "../art/blankmov.gif" alt = "image: ../art/blankmov.gif" width="385" height="306"></div><br/><p></p><p>In this section you’ll tidy up the user interface to fix these things and a few others. Specifically, you’ll</p><ul class="ul"><li class="li"><p>Configure <code>movieDisplayGroup</code> to sort the movies it displays.</p></li><li class="li"><p>Assign default values to new Movie objects.</p></li><li class="li"><p>Change the way that dates and numbers are displayed.</p></li></ul><p>You can also put the query part of the page in a table and capitalize <code>Main.wo</code>’s text field labels—for example, use “Title” instead of “title” and “Date Released” instead of “dateReleased.”</p><a name="//apple_ref/doc/uid/TP30001016-CH205-BCIJJBDJ" title="Specifying a Sort Order"></a><h3>Specifying a Sort Order</h3><p>You can change your application to sort movies alphabetically without writing any code. Display groups manage sorting behavior, and WebObjects Builder provides a Display Group Options panel for configuring this and other characteristics of display groups.</p><ol class="ol"><li class="li"><p>Double-click the <code>movieDisplayGroup</code> variable in the object browser.</p><p>The Display Group Options panel opens for configuring <code>movieDisplayGroup</code>.</p><div class="item_figure"><img src = "../art/dgoption.gif" alt = "image: ../art/dgoption.gif" width="385" height="261"></div></li><li class="li"><p>Select the <code>title</code> attribute in the Sorting pop-up list.</p></li><li class="li"><p>Select Ascending.</p></li><li class="li"><p>Click OK.</p></li></ol><p>WebObjects Builder stores your settings in an archive that specifies how to create and configure <code>movieDisplayGroup</code> at runtime. The archive is stored inside your Main component in a file named <code>Main.woo</code>. You can’t see the file from Project Builder because you’re not meant to edit it directly, but WebObjects Builder’s object browser shows you which of your component’s variables are initialized from the archive (or <code>woo</code> file) so you don’t have to view its contents directly.</p><br/><div><img src = "../art/mdgvar.gif" alt = "image: ../art/mdgvar.gif" width="392" height="152"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-BCICIHII" title="Specifying Default Values for New Enterprise Objects"></a><h3>Specifying Default Values for New Enterprise Objects</h3><p>When new enterprise objects are created in your application, it’s common to assign default values to some of their properties. For example, in your Movies application it makes sense to assign a default value for the <code>title</code> attribute so a new movie won’t be displayed in the list of movies as a blank line.</p><p>You could write an action method for the Insert/New button instead of binding it directly to the display group <code>insert</code> action method. In the custom action, you would create a new Movie object, assign default values to it, and then insert the new object into the display group. However, there are two additional ways to specify default values for new enterprise objects, without making explicit assignments:</p><ul class="spaceabove"><li class="li"><p>Assign default values in the enterprise object class.</p></li><li class="li"><p>Specify default values using a display group.</p></li></ul><p>For a particular situation, one of the approaches is usually better than the other. If the default values are intrinsic to the enterprise object, assign them in the enterprise object class. For example, consider a Member class with a <code>memberSince</code> property. It’s likely that you would automatically assign the current date to <code>memberSince</code> instead of forcing a user to supply a value. You’ll see how to use this technique in <span class="content_text"><a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCIGCIBA">“Adding Behavior to Your Enterprise Objects.”</a></span></p><p>On the other hand, if the default values are specific to an application or to a particular user interface, explicitly initialize the object in code or specify the default values using a display group. In the Movies application, the need for default values is motivated by Main’s user interface: you need to provide a default value so users can tell when a newly inserted record is selected. In another situation, you might not want a new movie to have a default title; you might instead want a new movie’s title to be blank.</p><p>The Movies application specifies default values for newly created Movie objects using the display group, <code>movieDisplayGroup</code>.</p><ol class="ol"><li class="li"><p>Open <code>Main.java</code> in Project Builder.</p></li><li class="li"><p>Change the Main class’ constructor so that it looks like the following:</p><div class="codesample"><table><tr><td scope="row"><pre>    public Main(WOContext context) {<span></span></pre></td></tr><tr><td scope="row"><pre>        super(context);<span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableDictionary defaultValues = new NSMutableDictionary();<span></span></pre></td></tr><tr><td scope="row"><pre>        defaultValues.setObjectForKey("New Movie Title", "title");<span></span></pre></td></tr><tr><td scope="row"><pre>        movieDisplayGroup.setInsertedObjectDefaultValues(defaultValues);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>This method assigns the value “New Movie Title” as the default value for a new movie’s <code>title</code> attribute. When <code>movieDisplayGroup</code> inserts a new movie (as it does when a user clicks the Insert/New button), it creates a new movie and assigns this default value to that movie.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF126" title="Setting a Date Format"></a><h3>Setting a Date Format</h3><p>To change the way that dates are displayed, you assign a date format to the element that displays the dates.</p><ol class="ol"><li class="li"><p>Using WebObjects Builder, inspect the <code>dateReleased</code> text field, which is near the bottom of the Main component window.</p><p>Notice that the text field has a <code>dateformat</code> attribute that is bound to the string “%m/%d/%Y”. This binding tells the text field that it’s displaying dates and describes how to format them. The %m conversion specifier stands for month as a decimal number, %d stands for day of the month, and %Y stands for year with century.</p></li><li class="li"><p>Click the combo box on the right side of the binding column. Choose ”%d %B %Y”.</p><p>This date format displays dates as 14 Jan 2005. The %b conversion specifier stands for abbreviated month name, and %Y stands for year with century. You can create your own date formats with any of the conversion specifiers defined for dates. For more information, see the NSTimestamp class specification in the WebObjects API Reference.</p><div class="item_figure"><img src = "../art/datefld.gif" alt = "image: ../art/datefld.gif" width="366" height="125"></div></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF127" title="Setting a Number Format"></a><h3>Setting a Number Format</h3><p>In addition to a <code>dateformat</code> attribute, text field elements also have a <code>numberformat</code> attribute.</p><ol class="ol"><li class="li"><p>Inspect the <code>revenue</code> text field.</p><p>The <code>revenue</code> text field’s <code>numberformat</code> attribute has no binding.</p></li><li class="li"><p>Enter “$###,##0.00” as the value of the <code>numberFormat</code> attribute (including the quotes).</p><p>Using this number format, the Movies application formats the number 1750000 as $1,750,000.00. For more information on creating number formats, see the NSNumberFormatter class specification in the WebObjects API Reference.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF128" title="Optional Exercise"></a><h3>Optional Exercise</h3><p>You can tidy up the user interface even further by putting the query part of the page in a table to match the editing part of the page. Also, you should consider capitalizing <code>Main.wo</code>’s text field labels.</p><p>To put the query part of the page in a table, follow these steps:</p><ol class="ol"><li class="li"><p>Put the cursor inside the form element before the “title” text field (in the Query By Example segment).</p></li><li class="li"><img src = "../art/table.gif" alt = "image: ../art/table.gif" width="23" height="23"><p>Click the  button in the toolbar to add a table.</p><p>The table panel appears.</p><div class="item_figure"><img src = "../art/tablepanel.gif" alt = "image: ../art/tablepanel.gif" width="451" height="350"></div></li><li class="li"><p>Enter 2 in the Rows field and 2 in the Columns field.</p></li><li class="li"><p>Enter 0 for in the Border field to remove the appearance of a border.</p></li><li class="li"><p>Uncheck “First row cells are header cells.” The first row text will not appear in bold.</p></li><li class="li"><p>Click OK. The table appears in your page.</p></li><li class="li"><p>Type the labels Title: and Category: in the cells in the first column.</p><p>The table doesn’t resize to accommodate new cell content until you’re done typing; that is, until you move the cursor out of the edited cell.</p></li><li class="li"><p>Cut and paste the query text fields into their corresponding table cells.</p><p>Just click a text field to select it. When a text field is selected, it appears shaded with a box around it. Choose Cut from the Edit menu, double-click the cell to select its text, and choose Paste from the Edit menu.</p></li><li class="li"><p>Delete the old query field labels.</p></li></ol><p>When you’re done, the query part should look like this: </p><br/><div><img src = "../art/fintable.gif" alt = "image: ../art/fintable.gif" width="398" height="54"></div><br/><p>Now edit the text labels in the editing part of the page and put any other finishing touches on the page that you want. The finished component might look something like this:</p><br/><div><img src = "../art/finpage.gif" alt = "image: ../art/finpage.gif" width="395" height="360"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF129" title="Adding the MovieDetails Page"></a><h2>Adding the MovieDetails Page</h2><p>The MovieDetails page shows you the detailed information about a movie you select in the Main page. For this to work, the Main page has to tell the MovieDetails page which movie the user selected. The MovieDetails page keeps track of the selected movie in its own instance variable. In this section, you’ll</p><ul class="ul"><li class="li"><p>Create a new component whose interface you’ll create yourself.</p></li><li class="li"><p>Assign Main’s selected movie to a variable in the MovieDetails page.</p></li><li class="li"><p>Create a way to navigate from Main to MovieDetails and back.</p></li></ul><p>In the sections following this one, you’ll extend the MovieDetails page to display movie roles and the starring actors.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF130" title="Creating the MovieDetails Component"></a><h3>Creating the MovieDetails Component</h3><ol class="ol"><li class="li"><p>In Project Builder, choose File > New in Project.</p></li><li class="li"><p>In the New File panel, click the Web Components suitcase.</p></li><li class="li"><p>Type MovieDetails in the Name field.</p></li><li class="li"><p>Click OK.</p></li><li class="li"><p>In the wizard panel, choose None for available assistance.</p></li><li class="li"><p>Click Finish.</p></li><li class="li"><p>Open the new component, <code>MovieDetails.wo</code>, in WebObjects Builder.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF131" title="Storing the Selected Movie"></a><h3>Storing the Selected Movie</h3><p>Now, in the MovieDetails component, create a variable that holds the application’s selected movie. Later on, you’ll add code to the <code>Main.java</code> class that assigns Main’s selected movie to this variable.</p><ol class="ol"><li class="li"><p>Choose Add Key from the pull-down list.</p><div class="item_figure"><img src = "../art/addvar.gif" alt = "image: ../art/addvar.gif" width="333" height="209"></div></li><li class="li"><p>Name the variable selectedMovie.</p></li><li class="li"><p>Set the variable’s type to Movie.</p><p>Movie isn’t actually a class; it’s an entity. It’s listed in the combo box as a type along with entries for all the entities in your model. When you choose an entity as the type for your variable, WebObjects Builder recognizes that the variable is an enterprise object. Using information in the model, WebObjects Builder can determine the entity’s corresponding enterprise object class and the properties of that class.</p></li><li class="li"><p>Check the “An instance variable” box.</p></li><li class="li"><p>Check the “A method returning the value” box.</p></li><li class="li"><p>Check the “A method setting the value” box.</p></li><li class="li"><p>Click Add.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF132" title="Navigating from Main to MovieDetails"></a><h3>Navigating from Main to MovieDetails</h3><p>To get to the MovieDetails page from the Main page, users use a hyperlink. Clicking the hyperlink should set MovieDetail’s <code>selectedMovie</code> variable and then open the MovieDetails page.</p><ol class="ol"><li class="li"><p>Add a hyperlink at the bottom of the Main component.</p></li><li class="li"><p>Replace the text “Hyperlink” with “Movie Details”.</p><div class="item_figure"><img src = "../art/mnhylink.gif" alt = "image: ../art/mnhylink.gif" width="394" height="98"></div></li><li class="li"><p>Choose Add Action from the pull-down list.</p></li><li class="li"><p>In the Add Action panel, type showDetails in the Name field.</p></li><li class="li"><p>Select MovieDetails from the “Page returned” combo box.</p></li><li class="li"><p>Click Add.</p></li><li class="li"><p>Bind the <code>showDetails</code> action to the hyperlink’s <code>action</code> attribute.</p></li><li class="li"><p>In Project Builder, modify the <code>showDetails</code> action in <code>Main.java</code> to look like the following:</p><div class="codesample"><table><tr><td scope="row"><pre>    public MovieDetails showDetails() {<span></span></pre></td></tr><tr><td scope="row"><pre>        MovieDetails nextPage =<span></span></pre></td></tr><tr><td scope="row"><pre>    (MovieDetails)pageWithName("MovieDetails");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Initialize your component here<span></span></pre></td></tr><tr><td scope="row"><pre>        EOEnterpriseObject selection =<span></span></pre></td></tr><tr><td scope="row"><pre>            (EOEnterpriseObject)movieDisplayGroup.selectedObject();<span></span></pre></td></tr><tr><td scope="row"><pre>        nextPage.setSelectedMovie(selection);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        return nextPage;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>This method creates the MovieDetails page and then invokes its <code>setSelectedMovie</code> method with the movie that’s selected in the Main page. The display group method <code>selectedObject</code> returns its selected object, which, in the Main component, is set when a user clicks a movie title hyperlink.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF133" title="Designing MovieDetails&acirc;&#128;&#153; User Interface"></a><h3>Designing MovieDetails’ User Interface</h3><p>Now lay out the user interface for MovieDetails.</p><ol class="ol"><li class="li"><p>Create a top-level heading with the text Movie Details.</p><p>Recall that to create a top-level heading, you type the text of the heading, select the text, click the <img src = "../art/heading.gif" alt = "image: ../art/heading.gif" width="23" height="23"> button to add a heading element around the text, and then use the Inspector to set the heading’s level, as you did in <span class="content_text"><a href="../GuestBook/GuestBook.html#//apple_ref/doc/uid/TP30001016-CH203-BCIIJJBF">“Using the Inspector.”</a></span></p></li><li class="li"><p>Below the heading, add a string element.</p></li><li class="li"><p>With the string element selected, add a heading.</p><p>This adds a new level-1 heading element around the string. The MovieDetails page will show the title of the selected movie in this heading.</p></li><li class="li"><p>Click &lt;H1> in the path view. The Inspector now displays the Heading Level.</p></li><li class="li"><p>Click 3 in the Heading Inspector.</p></li><li class="li"><p>Add labels and string elements to display the selected movie’s category, date released, and revenue.</p></li><li class="li"><p>Bold the labels.</p></li><li class="li"><p>Bind <code>selectedMovie</code>.<code>title</code> to the <code>value</code> attribute of the first string element (the one in the heading).</p></li><li class="li"><p>Similarly, create bindings for the Category, Date Released, and Revenue strings.</p></li><li class="li"><p>At the bottom of the page, add a horizontal rule.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF134" title="Adding Date and Number Formats"></a><h3>Adding Date and Number Formats</h3><p>String elements have <code>dateformat</code> and <code>numberformat</code> attributes just like text field elements. Create bindings for the Date Released and Revenue strings so that <code>dateReleased</code> and <code>revenue</code> values are displayed the way they are in the Main page.</p><ol class="ol"><li class="li"><p>Add the date format "%d %B %Y" to the Date Released string. You can select the format from the combo box in the Inspector’s binding column.</p></li><li class="li"><p>Add the number format "$###,##0.00" to the Revenue string. You can select the format from the combo box in the Inspector’s binding column.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF135" title="Navigating from MovieDetails to Main"></a><h3>Navigating from MovieDetails to Main</h3><p>Now add a hyperlink to the MovieDetails page so users can navigate back to the Main page from MovieDetails.</p><ol class="ol"><li class="li"><p>Add a hyperlink to the bottom of the page.</p></li><li class="li"><p>Label it Movie Search.</p><div class="item_figure"><img src = "../art/dehylink.gif" alt = "image: ../art/dehylink.gif" width="286" height="46"></div></li><li class="li"><p>Bind the hyperlink’s <code>pageName</code> attribute to the text (including the quotes) "Main". You can select “Main” from the combo box in the inspector’s binding column.</p><p>Recall that the <code>pageName</code> attribute is a mechanism for navigating to another page without writing code. By setting the attribute to “Main”, you’re telling the application to open the MovieSearch page when the hyperlink is clicked.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF136" title="Running Movies"></a><h3>Running Movies</h3><p>Be sure that all your project’s files are saved (including the components in WebObjects Builder), and build and run your application. In the Main page, select a movie and click the Movie Details link. The MovieDetails page should display all the movie’s information.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF137" title="Refining Your Model"></a><h2>Refining Your Model</h2><p>The model created for you by the wizard is just a starting point. For most applications, you need to do some additional work to your model to make it useful in your application. To refine your model so that it can be used in the Movies application, you’ll ultimately need to do all of the following:</p><ul class="ul"><li class="li"><p>Remove primary and foreign keys as class properties.</p></li><li class="li"><p>Add relationships to your model if the wizard didn’t have enough information to add them for you.</p></li><li class="li"><p>Configure your model’s relationships in the Advanced Relationship Inspector.</p></li><li class="li"><p>Generate source files for the Talent class.</p></li></ul><p>These steps are described in more detail throughout the rest of this tutorial.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF138" title="Opening Your Model"></a><h3>Opening Your Model</h3><ol class="ol"><li class="li"><p>In Project Builder, click the Resources category.</p></li><li class="li"><p>Select <code>Movies.eomodeld</code>.</p></li><li class="li"><p>Double-click the model icon.</p><div class="item_figure"><img src = "../art/pbopnmdl.gif" alt = "image: ../art/pbopnmdl.gif" width="352" height="85"></div></li></ol><p></p><p>Project Builder opens your model file in EOModeler, launching EOModeler first if it isn’t already running. EOModeler displays your model in the Model Editor. It lists the entities for the tables you specified in the wizard—Movie, MovieRole, and Talent.</p><br/><div><img src = "../art/mdleditr.gif" alt = "image: ../art/mdleditr.gif" width="482" height="205"></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/TP30001016-CH205-DontLinkElementID_76" title="Note"></a><p><strong>Note:</strong>&nbsp;In the screen captures of EOModeler, there might be other columns displayed in the picture than what EOModeler shows when you run it. These columns can be shown by choosing Add Column at the bottom of EOModeler. To remove a column from being displayed, click the column and press the delete key.</p></div><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF139" title="Removing Foreign Keys as Class Properties"></a><h3>Removing Foreign Keys as Class Properties</h3><p>By default, the wizard makes all of an entity’s attributes, except primary keys, <em>class properties</em>. When an attribute is a class property, it means that the property is a part of your enterprise object, usually as an instance variable.</p><p>You should mark as class properties only those attributes whose values are meaningful in the objects that are created when you fetch from the database. Attributes that are essentially database artifacts, such as primary and foreign keys, shouldn’t be marked as class properties unless the key has meaning to the user and must be displayed in the user interface.</p><p>Eliminating primary and foreign keys as class properties has no adverse effect on how Enterprise Objects Framework manages enterprise objects in your application.</p><ol class="ol"><li class="li"><p>In the left frame (or <em>tree view</em>), click the Movie entity.</p><p>The right frame switches from a view of the entities in the model to a view of Movie’s attributes.</p><p>A <img src = "../art/key.gif" alt = "image: ../art/key.gif" width="18" height="17"> symbol in the first column means that the attribute is a primary key for the selected entity. A <img src = "../art/diamond.gif" alt = "image: ../art/diamond.gif" width="16" height="14"> symbol in the second column means that the attribute is a class property.</p></li><li class="li"><img src = "../art/diamond.gif" alt = "image: ../art/diamond.gif" width="16" height="14"><p>Click in the Class Property column to remove the  symbol for the <code>studioId</code> attribute, which is a foreign key. The wizard didn’t make <code>movieId</code> a class property because it is a primary key.</p></li></ol><br/><div><img src = "../art/rmclsprp.gif" alt = "image: ../art/rmclsprp.gif" width="390" height="113"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF140" title="Adding Relationships to Your Model"></a><h3>Adding Relationships to Your Model</h3><p>The Movies application uses two pairs of inverse relationships. The first pair defines the relationship between the Movie and MovieRole entities, while the second pair defines the relationship between the MovieRole and Talent entities. An Enterprise Objects Framework relationship is <em>directed</em>; that is, a relationship has a source and a destination. Generally, models define a relationship for each direction.</p><ol class="ol"><li class="li"><p>Select the Movie entity.</p><p>The right frame of the Model Editor shows the Movie’s relationships as well as its attributes.</p><div class="item_figure"><img src = "../art/showrels.gif" alt = "image: ../art/showrels.gif" width="391" height="140"></div><p>If your Movie entity doesn’t have a <code>movieRoles</code> relationship, it means that the database server’s schema information for your database didn’t have enough information for the wizard to create them. You need to create them by hand now. The next several steps explain how.</p></li><li class="li"><p>Choose Property > Add Relationship.</p><p>A new relationship named “Relationship” is added in the table view at the bottom of the Model Editor. The new relationship is already selected.</p></li><li class="li"><img src = "../art/inspector.gif" alt = "image: ../art/inspector.gif" width="23" height="23"><p>With the relationship selected in the right frame of the Model Editor, click the   button (in the toolbar) to inspect the relationship.</p><div class="item_figure"><img src = "../art/relinsp.gif" alt = "image: ../art/relinsp.gif" width="372" height="278"></div></li><li class="li"><p>In the Inspector, select the To Many option.</p></li><li class="li"><p>Select MovieRole as the destination entity.</p></li><li class="li"><p>Select <code>movieId</code> in the Source Attributes list.</p></li><li class="li"><p>Select <code>movieId</code> in the Destination Attributes list.</p></li><li class="li"><p>Click Connect.</p><p>EOModeler automatically renames the relationship based on the name of the destination entity. For example, after connecting a to-many relationship from Movie to MovieRole, EOModeler names the relationship “movieRoles”. To-one relationships are named with the singular form of the destination entity’s name. For example, EOModeler names the inverse to-one relationship (from MovieRole to Movie) “movie”.</p><p>If the wizard created your relationship and used a name other than “movieRoles”, consider renaming the relationship. The rest of this tutorial assumes that your relationships are named using EOModeler’s naming convention.</p></li><li class="li"><p>Repeat the steps above to create the following relationships (if they do not already exist):</p><p>A to-one relationship named “movie” in the MovieRole entity where</p><ul class="ul"><li class="li"><p>The destination entity is Movie.</p></li><li class="li"><p>The source attribute is <code>movieId</code>.</p></li><li class="li"><p>The destination attribute is <code>movieId</code>.</p><p>A to-one relationship named “talent” in the MovieRole entity where</p></li><li class="li"><p>The destination entity is Talent.</p></li><li class="li"><p>The source attribute is <code>talentId</code>.</p></li><li class="li"><p>The destination attribute is <code>talentId</code>.</p><p>A to-many relationship named “movieRoles” in the Talent entity where</p></li><li class="li"><p>The destination entity is MovieRole.</p></li><li class="li"><p>The source attribute is <code>talentId</code>.</p></li><li class="li"><p>The destination attribute is <code>talentId</code>.</p></li></ul></li><li class="li"><p>Choose Tools > Diagram View to switch the Model Editor to Diagram View.</p></li></ol><br/><div><img src = "../art/popupbtn.gif" alt = "image: ../art/popupbtn.gif" width="397" height="100"></div><br/><p>At this point your model has all the relationships it needs. The Diagram View gives you an overview of the entities in the model and their relationships to other entities.</p><br/><div><img src = "../art/diagram.gif" alt = "image: ../art/diagram.gif" width="352" height="133"></div><br/><p>You can also use the Diagram View to edit your model. Double-click an attribute or relationship to change its name. To create a relationship and its inverse, Control-drag from the relationship’s source attribute to its destination attribute. </p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF141" title="Using the Advanced Relationship Inspector"></a><h3>Using the Advanced Relationship Inspector</h3><p>There are several additional settings you use to configure a relationship’s referential integrity rules. For these, use the Advanced Relationship Inspector.</p><ol class="ol"><li class="li"><p>Inspect Movie’s <code>movieRoles</code> relationship.</p></li><li class="li"><p>In the Inspector, click the Advanced Relationship button.</p><div class="item_figure"><img src = "../art/advIisp.gif" alt = "image: ../art/advIisp.gif" width="353" height="333"></div></li><li class="li"><p>Ensure that the delete rule is set to Cascade.</p></li><li class="li"><p>Ensure that the Owns Destination box is checked.</p></li><li class="li"><p>Check the Propagate Primary Key box.</p><p>A relationship that propagates its primary key <em>propagates</em> its key value to newly inserted objects in the destination of the relationship. In this case, checking the Propagate Primary Key box means that if you create a new MovieRole and add it to a Movie’s list of MovieRoles, the Movie object automatically assigns its <code>movieId</code> value as the value for the new MovieRole’s <code>movieId</code> property.</p><p>This option is usually used with relationships that own their destination. For more information on propagating primary keys, see <span class="content_text"><a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCIDBJEG">“Where Do Primary Keys Come From?.”</a></span></p></li><li class="li"><p>Ensure that Talent’s <code>movieRoles</code> relationship has its delete rule set to Deny.</p></li><li class="li"><p>Ensure that Talent’s <code>movieRoles</code> relationship owns its destination.</p></li><li class="li"><p>Set Talent’s <code>movieRoles</code> relationship to propagate its primary key.</p></li><li class="li"><p>Choose Model > Save to save your model.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-BCIDBJEG" title="Where Do Primary Keys Come From?"></a><h3>Where Do Primary Keys Come From?</h3><p>Enterprise Objects Framework uses primary keys to identify enterprise objects in memory, and it works best if you never change an enterprise object’s primary key from its initial value. Consequently, applications usually generate and assign primary key values automatically instead of having users provide them. For example, the Movies application assigns a <code>movieId</code> value to a new movie when it’s created, and the value never changes afterward. The Movies interface doesn’t even display <code>movieId</code> values because they aren’t meaningful to users of the application.</p><p>Enterprise Objects Framework provides several mechanisms for generating and assigning unique values to primary key attributes. By default, Enterprise Objects Framework uses a native database mechanism to assign primary key values.</p><p>The Movies application generates primary key values for Movie and Talent objects using the default mechanism, but MovieRole is a special case because:</p><ul class="spaceabove"><li class="li"><p>MovieRole’s primary key is compound. The default behavior of generating a primary key value using a native database mechanism works only on simple (not compound) primary keys.</p></li><li class="li"><p>A MovieRole’s primary key attributes, <code>movieId</code> and <code>talentId</code>, must match the corresponding attributes in the MovieRole’s Movie and Talent objects. The default mechanism generates new, unique values.</p></li></ul><p>Instead of the default mechanism, Enterprise Objects Framework uses primary key propagation to assign primary keys to MovieRole objects. By configuring the Movie’s <code>movieRoles</code> relationship to propagate primary key, the Framework knows to assign a new MovieRole’s <code>movieId</code> to the same value as the <code>movieId</code> of the MovieRole’s Movie. Similarly, a new MovieRole’s <code>talentId</code> is set to the same value as the <code>talentId</code> of the MovieRole’s Talent.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF142" title="Setting Up a Master-Detail Configuration"></a><h2>Setting Up a Master-Detail Configuration</h2><p>So far your Movies application fetches, inserts, updates, and deletes only Movie objects. Considered alone, a Movie object isn’t as interesting as it is when it’s related to actors and roles. In this section, you’ll add MovieRole and Talent objects to the Movies application.</p><p>The relationships defined in your model now come into play. Using Movie’s <code>movieRoles</code> relationship, you can display the MovieRoles for the selected Movie. In this type of configuration, called <em>master-detail</em>, a master display group holds enterprise objects for the source of a relationship, while a detail display group holds records for the destination. As individual records are selected in the master display group, the detail display group gets a new set of enterprise objects to correspond to the selection in the master.</p><p>In the Movies application, the master-detail configuration is built around Movie’s <code>movieRoles</code> relationship. The configuration is split across two pages in the application. The master, <code>movieDisplayGroup</code>, is in the Main component, while the detail is in MovieDetails.</p><p>In this section, you’ll</p><ul class="ul"><li class="li"><p>Create and configure the detail display group.</p></li><li class="li"><p>Extend the MovieDetails user interface to hold MovieRole and Talent information.</p></li></ul><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF143" title="Creating a Detail Display Group "></a><h3>Creating a Detail Display Group </h3><p>You can create a detail display group several different ways. You can write a declaration for it in Project Builder, or you can use WebObjects Builder’s Add Variable/Method command. But the easiest way to create a detail display group is by dragging a relationship from EOModeler into your component, as described below.</p><ol class="ol"><li class="li"><p>In EOModeler’s tree view, expand the Movie entity.</p><div class="item_figure"><img src = "../art/expatree.gif" alt = "image: ../art/expatree.gif" width="398" height="205"></div></li><li class="li"><p>Drag the Movie’s <code>toMovieRole</code> relationship from the tree view into the MovieDetails component’s object browser.</p><div class="item_figure"><img src = "../art/dragent.gif" alt = "image: ../art/dragent.gif" width="365" height="246"></div><p>An Add Display Group panel opens.</p><div class="item_figure"><img src = "../art/adddg.gif" alt = "image: ../art/adddg.gif" width="391" height="87"></div></li><li class="li"><p>In the Add Display Group panel, change the name to movieRoleDisplayGroup.</p></li><li class="li"><p>Click Add and Configure.</p><p>The Display Group Options panel opens so you can immediately configure the newly created display group.</p><div class="item_figure"><img src = "../art/dgoptions.gif" alt = "image: ../art/dgoptions.gif" width="386" height="261"></div><p>Ensure that the “Has detail data source” box is checked. This means that <code>movieRoleDisplayGroup</code> gets its objects from a EODetailDataSource object.</p><p>All display groups use some kind of <em>data source </em>to fetch their objects. A data source is an object that exists primarily as a simple means for a WODisplayGroup to access a store of objects. It’s through a data source that a display group fetches, inserts, updates, and deletes database records.</p><p>An EODetailDataSource is a subclass of EODataSource that’s intended for use in master-detail configurations. A detail data source keeps track of a <em>master object</em> and a <em>detail key</em>. The master object is typically the selected object in a master display group, but a master display group isn’t strictly required. The detail key is the name of the relationship on which the master-detail configuration is based. When a detail display group asks its data source to fetch, the EODetailDataSource simply gets the destination objects from the master object as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    detailObjects = masterObject.valueForKey(detailKey);<span></span></pre></td></tr></table></div><p>In your master-detail configuration, the master object is the selected Movie, and the detail key is <code>movieRoles</code>. When <code>movieRoleDisplayGroup</code> asks its data source for its MovieRole objects, the detail WODisplayGroup returns the objects in the selected Movie’s <code>movieRoles</code> array of MovieRoles. Similarly, when MovieRole objects are inserted or deleted in <code>movieRoleDisplayGroup</code>, they are added and removed from the master object’s <code>movieRoles</code> array.</p></li><li class="li"><p>Set the display group to sort alphabetically by <code>roleName</code>.</p></li><li class="li"><p>Check the “Fetches on load” box.</p><p>When “Fetches on load” is selected, the display group fetches its objects as soon as the component is loaded into the application. You want this feature in the MovieDetails page so that users are immediately presented with the selected movie’s roles. In contrast, the Main page does not fetch on load; it shouldn’t present a list of movies until the user has entered search criteria and clicked Match.</p></li><li class="li"><p>Click OK.</p></li><li class="li"><p>In Project Builder, modify MovieDetail’s <code>setSelectedMovie</code> method to look like the following:</p><div class="codesample"><table><tr><td scope="row"><pre>    public void setSelectedMovie(EOEnterpriseObject newSelectedMovie) {<span></span></pre></td></tr><tr><td scope="row"><pre>        selectedMovie = newSelectedMovie;<span></span></pre></td></tr><tr><td scope="row"><pre>        movieRoleDisplayGroup.setMasterObject(newSelectedMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>With this addition, whenever a user navigates to the MovieDetails page, <code>setSelectedMovie</code> updates the master object of the <code>movieRoleDisplayGroup</code> so it displays the corresponding MovieRole objects.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF144" title="Adding a Repetition"></a><h3>Adding a Repetition</h3><p>Now you’ll extend the user interface of the MovieDetails component to display the actors in the selected movie. Because different movies have different numbers of roles, you need the dynamism of a repetition element. </p><ol class="ol"><li class="li"><p>In the MovieDetails component window, add the bolded text <code>Starring:</code> beneath the Revenue line.</p></li><li class="li"><p>Below the Starring label, add a repetition.</p></li><li class="li"><p>Replace the “Repetition” text with three string elements.</p><p>The strings should all be on the same line, so don’t type carriage returns between them.</p></li><li class="li"><p>Type a space between the first two strings and the word “ as ” (with a space before and after) between the last two.</p></li><li class="li"><p>Add a carriage return after the last string.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF145" title="Configuring a Repetition"></a><h3>Configuring a Repetition</h3><p>Now configure MovieDetails’ repetition in a way similar to the way Main’s repetition is configured. First you need to create a new variable to bind to the repetition’s <code>item</code> attribute.</p><ol class="ol"><li class="li"><p>Use the Add Key command to add a new variable, <code>movieRole,</code> whose type is set to the MovieRole entity.</p><p>Don’t create set and get methods for <code>movieRole</code>. You won’t need accessor methods because the variable is used only within the MovieDetails component and shouldn’t be visible to any other classes.</p></li><li class="li"><p>Bind <code>movieRoleDisplayGroup</code>.<code>displayedObjects</code> to the repetition’s <code>list</code> attribute.</p></li><li class="li"><p>Bind <code>movieRole</code> to the repetition’s <code>item</code> attribute.</p></li><li class="li"><p>Bind <code>movieRole</code>.<code>toTalent</code>.<code>firstName</code> to the <code>value</code> attribute of the first string in the repetition.</p></li><li class="li"><p>Bind <code>movieRole</code>.<code>toTalent</code>.<code>lastName</code> to the <code>value</code> attribute of the second string.</p></li><li class="li"><p>Bind <code>movieRole</code>.<code>roleName</code> to the <code>value</code> attribute of the last string.</p></li></ol><p>When you’re done, the repetition bindings should look like the following:</p><br/><div><img src = "../art/boundrep.gif" alt = "image: ../art/boundrep.gif" width="402" height="69"></div><br/><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF146" title="Running Movies"></a><h3>Running Movies</h3><p>Be sure that all your project’s files are saved (including the components in WebObjects Builder and the model in EOModeler), and build and run your application. In the Main page, select a movie and click the Movie Details link. Now, in addition to displaying all the movie’s information, the Movie Details page should also display the movie’s roles and actors.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF147" title="Updating Objects in the Detail Display Group"></a><h2>Updating Objects in the Detail Display Group</h2><p>In this section, you’ll add the ability to insert, update, and delete movie roles. The MovieDetails page will then look something like this:</p><br/><div><img src = "../art/detail.gif" alt = "image: ../art/detail.gif" width="402" height="382"></div><br/><p>Many of the features in this page are similar to features in the Main page, but in this section you perform by hand the tasks the wizard performed for you to create Main. Already you’ve learned how to create a WODisplayGroup variable and how to bind it to dynamic elements. In this section you’ll</p><ul class="ul"><li class="li"><p>Write code to update a display group’s selected object.</p></li><li class="li"><p>Create and configure a browser.</p></li><li class="li"><p>Create a custom enterprise object class.</p></li><li class="li"><p>Use display group actions to configure image buttons to insert, update, and delete.</p></li></ul><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF148" title="Managing a WODisplayGroup&acirc;&#128;&#153;s Selection"></a><h3>Managing a WODisplayGroup’s Selection</h3><p>Remember how clicking a movie title in the Main page selects the corresponding Movie object in <code>movieDisplayGroup</code>. MovieDetails has a similar behavior for selecting a MovieRole object in <code>movieRoleDisplayGroup</code>.</p><p>First you need to add a hyperlink element around the repetition’s role name string so that users can select a particular MovieRole. When a user clicks one of the movie role hyperlinks, the application should select the corresponding MovieRole object in the <code>movieRoleDisplayGroup</code>. </p><ol class="ol"><li class="li"><p>Select the repetition’s role name string element.</p></li><li class="li"><p>Click the Add WOHyperlink button in the toolbar to add a hyperlink element around the string.</p><p>Now you need to create an action method to invoke when the hyperlink is clicked.</p></li><li class="li"><p>Use the Add Action command in the pull-down list to add an action named <code>selectObject</code>, returning <code>null</code>.</p></li><li class="li"><p>Bind the <code>selectObject</code> method to the hyperlink’s <code>action</code> attribute.</p></li><li class="li"><p>Now write the code for <code>selectObject</code> in <code>MovieDetails.java</code>. Modify the <code>selectObject</code> action to look like the following:</p><div class="codesample"><table><tr><td scope="row"><pre>    public WOComponent selectObject() {<span></span></pre></td></tr><tr><td scope="row"><pre>        movieRoleDisplayGroup.selectObject(movieRole);<span></span></pre></td></tr><tr><td scope="row"><pre>        return null;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF149" title="Adding a Form"></a><h3>Adding a Form</h3><p>Now lay out the user interface used to view and edit the selected MovieRole. When you’re done, it should look like the following:</p><br/><div><img src = "../art/browui.gif" alt = "image: ../art/browui.gif" width="398" height="125"></div><br/><ol class="ol"><li class="li"><p>Add another horizontal rule after the repetition.</p></li><li class="li"><img src = "../art/woform.gif" alt = "image: ../art/woform.gif" width="23" height="23"><p>Use the  button to add a WOForm element between the two horizontal rules.</p></li><li class="li"><img src = "../art/wobrowser.gif" alt = "image: ../art/wobrowser.gif" width="23" height="23"><p>While the Form text is highlighted, click the  button to replace the text with a WOBrowser element.</p></li><li class="li"><p>Beneath the browser (within the bounds of the new form), type the bolded text Role Name:.</p></li><li class="li"><p>Add a text field.</p></li><li class="li"><p>Bind the text field’s <code>value</code> attribute to <code>movieRoleDisplayGroup.selectedObject.roleName</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF150" title="Adding a Talent Display Group"></a><h3>Adding a Talent Display Group</h3><p>The browser you just created is going to display a list of Talent objects. Like a repetition element, a browser has <code>list</code> and <code>item</code> attributes. As the browser moves through its <code>list</code>, the browser sets <code>item</code> to the object at the current index. The Movies application uses a display group to provide the browser with a list of Talent objects, so now you need to create the new display group and a variable to bind to the browser’s <code>item</code> attribute. </p><ol class="ol"><li class="li"><p>Use the Add Key command to create two new instance variables:</p><ul class="ul"><li class="li"><p><code>talentDisplayGroup</code>, whose type is WODisplayGroup</p></li><li class="li"><p><code>talent</code>, whose type is Talent </p><p>You don’t need to add set and get methods for the variables.</p></li></ul></li><li class="li"><p>Using the Display Group Options panel, assign the <code>talentDisplayGroup </code>object’sentity to Talent.</p><p>Remember that to open the Display Group Options panel, simply  double-click the <code>talentDisplayGroup</code> variable in the object browser. The <img src = "../art/dash.gif" alt = "image: ../art/dash.gif" width="9" height="9"> icon initially displayed next to the variable indicates that initialization parameters have not yet been set.</p></li><li class="li"><p>Configure <code>talentDisplayGroup</code> to sort its objects alphabetically (ascending) by <code>lastName</code>.</p></li><li class="li"><p>Configure it to fetch on load and click OK.</p><p>After you configure <code>talentDisplayGroup</code>, the object browser shows a <img src = "../art/check.gif" alt = "image: ../art/check.gif" width="15" height="14"> icon next to the variable.</p></li></ol><p>The Movies application uses a display group to provide Talent objects, but you could fetch the Talent objects from the database without one. Display groups provide a simple way to fetch, insert, update, and delete enterprise objects without writing much, if any, code. To get finer-grained control over these operations, you can work directly with an EOEditingContext object. An editing context can do everything a display group does and much more, but you have to write more code to use one. For more information, see the EOEditingContext class specification in the WebObjects API Reference.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF151" title="Configuring the Browser"></a><h3>Configuring the Browser</h3><p>Create your browser’s bindings. The steps are similar to those for creating bindings for a repetition.</p><ol class="ol"><li class="li"><p>Bind <code>talentDisplayGroup.displayedObjects</code> to the browser’s <code>list</code> attribute.</p></li><li class="li"><p>Bind <code>talent</code> to the browser’s <code>item</code> attribute.</p></li><li class="li"><p>Bind <code>talent.lastName</code> to the browser’s <code>value</code> attribute.</p><p>The <code>value</code> attribute tells the browser what string to display. For each <code>item</code> in its <code>list</code>, the browser evaluates the <code>item</code>’s <code>value</code>.</p><p>The browser in the MovieDetails page should display the actors’ full names, but there isn’t an attribute for full name. In the next section, you’ll create a custom Talent class that implements a <code>fullName</code> method, but for now just use <code>talent.lastName</code> as the <code>value</code> attribute.</p><p>A browser also has a <code>selections</code> attribute that should be bound to an array of objects. A browser’s selection can be zero, one, or many objects; but in the Talent browser, the selection should refer to a single object. Consequently, you need to add two methods to manage the browser’s selection: one to return an array containing the selected Talent and one to set the selected Talent from an array object.</p></li><li class="li"><p>Add the method <code>talentSelection</code> to the <code>MovieDetails.java</code> class as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    public NSArray talentSelection() {<span></span></pre></td></tr><tr><td scope="row"><pre>        EOEnterpriseObject aTalent;<span></span></pre></td></tr><tr><td scope="row"><pre>        EOEnterpriseObject aMovieRole =<span></span></pre></td></tr><tr><td scope="row"><pre>            (EOEnterpriseObject)movieRoleDisplayGroup.selectedObject();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (aMovieRole == null){<span></span></pre></td></tr><tr><td scope="row"><pre>            return null;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        aTalent = (EOEnterpriseObject)aMovieRole.valueForKey("talent");<span></span></pre></td></tr><tr><td scope="row"><pre>        if (aTalent == null){<span></span></pre></td></tr><tr><td scope="row"><pre>            return null;<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            return new NSArray(aTalent);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Because the browser expects an array for its <code>selections</code> attribute, this method packages the selected MovieRole’s <code>talent</code> object in an array. If the selected MovieRole object is <code>null</code>, <code>talentSelection</code> simply returns <code>null</code> to indicate that the browser shouldn’t set a selection.</p></li><li class="li"><p>Add the method <code>setTalentSelection </code>as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    public void setTalentSelection(NSArray talentArray){<span></span></pre></td></tr><tr><td scope="row"><pre>        if (talentArray.count() > 0){<span></span></pre></td></tr><tr><td scope="row"><pre>            EOEnterpriseObject aMovieRole =<span></span></pre></td></tr><tr><td scope="row"><pre>                (EOEnterpriseObject)movieRoleDisplayGroup.selectedObject();<span></span></pre></td></tr><tr><td scope="row"><pre>            EOEnterpriseObject selectedTalent =<span></span></pre></td></tr><tr><td scope="row"><pre>                (EOEnterpriseObject)talentArray.objectAtIndex(0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            aMovieRole.addObjectToBothSidesOfRelationshipWithKey(<span></span></pre></td></tr><tr><td scope="row"><pre>                selectedTalent, "talent");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Again because the browser uses an array for its <code>selections</code> attribute, the <code>setTalentSelection </code>method must take an array as its argument. If the size of <code>talentArray</code> is nonzero, then this method sets the selected MovieRole’s <code>talent</code> to the first object in the array. Note that by default, a user can’t select more than one actor in a browser.</p><p>With the addition of these methods, WebObjects Builder now displays <code>talentSelection</code> in MovieDetail’s object browser.</p></li><li class="li"><p>Save <code>MovieDetails.java</code>.</p></li><li class="li"><p>Bind <code>talentSelection</code> to the browser’s <code>selections</code> attribute.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF152" title="Adding Insert, Save, and Delete Buttons"></a><h3>Adding Insert, Save, and Delete Buttons</h3><p>Now add the buttons that let users insert, save, and delete MovieRoles. When you’re done, it should look like the following:</p><br/><div><img src = "../art/ibuttons.gif" alt = "image: ../art/ibuttons.gif" width="391" height="102"></div><br/><ol class="ol"><li class="li"><p>Inside the form, add three image buttons below the Role Name text field.</p></li><li class="li"><p>Inspect the first active image element.</p></li><li class="li"><p>Bind the <code>filename</code> attribute to the text (including the quotes) "DBWizardInsert.gif".</p></li><li class="li"><p>Follow the same procedure to set the second image’s <code>filename</code> attribute to the text (including the quotes) "DBWizardUpdate.gif".</p></li><li class="li"><p>Set the last image’s <code>filename</code> attribute to the text (including the quotes) "DBWizardDelete.gif".</p><p>The WODisplayGroup class defines the actions <code>insert</code> and <code>delete</code>. You’ll bind to the Insert/New and Delete buttons. It doesn’t, however, provide a save method. You’ll have to provide that yourself.</p></li><li class="li"><p>Copy the <code>saveChanges</code> method from the <code>Main.java</code> class and paste it into the <code>MovieDetails.java</code> class:</p><div class="codesample"><table><tr><td scope="row"><pre>    public void saveChanges() throws Exception {<span></span></pre></td></tr><tr><td scope="row"><pre>        try {<span></span></pre></td></tr><tr><td scope="row"><pre>            this.session().defaultEditingContext().saveChanges();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        catch (Exception exception) {<span></span></pre></td></tr><tr><td scope="row"><pre>            NSLog.err.appendln("Cannot save changes ");<span></span></pre></td></tr><tr><td scope="row"><pre>            throw exception;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div></li><li class="li"><p>Save <code>MovieDetails.java</code>.</p></li><li class="li"><p>Bind <code>movieRoleDisplayGroup.insert</code> to the Insert/New image’s <code>action</code> attribute.</p></li><li class="li"><p>Bind the <code>saveChanges</code> method to the “Save to database” image’s <code>action</code> attribute.</p></li><li class="li"><p>Bind <code>movieRoleDisplayGroup.delete</code> to the Delete image’s <code>action</code> attribute.</p></li><li class="li"><p>Save <code>MovieDetails.wo</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-BCIGCIBA" title="Adding Behavior to Your Enterprise Objects"></a><h2>Adding Behavior to Your Enterprise Objects</h2><p>Right now, the Movies application maps all its entities to the EOGenericRecord class. As the preceding sections illustrate, you can go quite far in an application using just this default enterprise object class, but now you need to add some custom classes to the Movies application.</p><p>In this section, you’ll learn how to:</p><ul class="ul"><li class="li"><p>Generate source code for a custom enterprise object class.</p></li><li class="li"><p>Provide default values in a custom enterprise object class.</p></li></ul><p>You’ll create custom classes for the Talent and MovieRole entities. In the Talent class, you’ll write a <code>fullName</code> method that concatenates a Talent’s first and last names. You’ll use the method to populate MovieDetail’s browser element. In the MovieRole class, you’ll provide default values for newly inserted MovieRoles so they don’t show up in the list of movie roles as a blank line.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF153" title="Specifying Custom Enterprise Object Classes"></a><h3>Specifying Custom Enterprise Object Classes</h3><p>Unless you specify otherwise, EOModeler maps entities to the EOGenericRecord class. When you want to use a custom class instead, you need to specify that custom class in the model.</p><ol class="ol"><li class="li"><p>In EOModeler, inspect the Talent entity.</p></li><li class="li"><p>In the Entity Inspector for Talent, type Talent in the Class field.</p><div class="item_figure"><img src = "../art/entinsp.gif" alt = "image: ../art/entinsp.gif" width="369" height="174"></div></li><li class="li"><p>Set the MovieRole entity’s class to MovieRole.</p></li></ol><p>Now you can generate the source files for your Talent and MovieRole classes.</p><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF154" title="Generating Custom Enterprise Object Classes"></a><h3>Generating Custom Enterprise Object Classes</h3><p>You can easily create a custom class to hold your business logic: EOModeler provides a command to generate enterprise object classes.</p><ol class="ol"><li class="li"><p>In EOModeler, select the Talent entity.</p></li><li class="li"><p>Choose Property > Generate Java Files.</p><p>A Choose Class Name panel opens. If you opened the model file from Project Builder, the Choose Class Name panel displays the project as the destination directory and <code>Talent.java</code> as the default filename.</p></li><li class="li"><p>Ensure that the Movies project directory is selected.</p></li><li class="li"><p>Click Save.</p><p>A panel opens, asking if you want to insert the file in your project.</p></li><li class="li"><p>Click Yes.</p><p>EOModeler creates the source file <code>Talent.java</code> and adds it to your project. </p></li><li class="li"><p>Follow the same procedure for MovieRole.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF155" title="Adding Custom Behavior to Talent"></a><h3>Adding Custom Behavior to Talent</h3><p>Now add the <code>fullName</code> method to Talent and bind it to the browser.</p><ol class="ol"><li class="li"><p>Open <code>Talent.java</code> in Project Builder.</p><p>The class file and implements set and get methods for all of Talent’s class properties (<code>firstName</code> and <code>lastName</code>).</p></li><li class="li"><p>Add the method, <code>fullName</code>, as follows.</p><div class="codesample"><table><tr><td scope="row"><pre>    public String fullName(){<span></span></pre></td></tr><tr><td scope="row"><pre>        return firstName() + " " + lastName();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>After you save, <code>fullName</code> appears in the object browser of WebObjects Builder as a property of Talent.</p></li><li class="li"><p>Bind <code>talent.fullName</code> to the browser’s <code>displayString</code> attribute and unbind the <code>value</code> attribute.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF156" title="Providing Default Values in MovieRole"></a><h3>Providing Default Values in MovieRole</h3><p>As discussed in <span class="content_text"><a href="Movies.html#//apple_ref/doc/uid/TP30001016-CH205-BCICIHII">“Specifying Default Values for New Enterprise Objects,”</a></span> there are two main ways to specify default values for new enterprise objects without making explicit assignments:</p><ul class="spaceabove"><li class="li"><p>Assign default values in the enterprise object class.</p></li><li class="li"><p>Specify default values using a display group.</p></li></ul><p>For the Movie class, you specified default values using a display group. This approach is also the more appropriate choice for the MovieRole class, but you’ll use the other approach for MovieRole just to see how its done.</p><ol class="ol"><li class="li"><p>Open <code>MovieRole.java</code> in Project Builder.</p></li><li class="li"><p>Add the method, <code>awakeFromInsertionInEditingContext</code>, as follows</p><div class="codesample"><table><tr><td scope="row"><pre>    public void awakeFromInsertion(EOEditingContext context){<span></span></pre></td></tr><tr><td scope="row"><pre>        super.awakeFromInsertion(context);<span></span></pre></td></tr><tr><td scope="row"><pre>        setRoleName("New Role");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>This method is automatically invoked right after your enterprise object class creates a new MovieRole and inserts it into an editing context, which happens when you use a display group to insert.</p></li></ol><a name="//apple_ref/doc/uid/TP30001016-CH205-TPXREF157" title="Running Movies"></a><h3>Running Movies</h3><p>Be sure that all your project’s files are saved (including your model file), and build and run your application. Now when a user clicks the Insert/New button on the MovieDetails page, a new MovieRole is inserted, with “New Role” already displayed as the role name.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../GuestBookPlus/GuestBookPlus.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2004-02-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/WOGettingStarted/Movies/Movies.html%3Fid%3DTP30001016-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/WOGettingStarted/Movies/Movies.html%3Fid%3DTP30001016-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/WOGettingStarted/Movies/Movies.html%3Fid%3DTP30001016-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>