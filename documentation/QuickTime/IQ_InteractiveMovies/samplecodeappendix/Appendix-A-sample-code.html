<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Interactive Movies: QTWiredSprite.c Sample Code</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="QTWiredSprite.c Sample Code"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000883-CH214" title="QTWiredSprite.c Sample Code"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../WiredMoviesandSprites-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000594" target="_top">Wired Movies and Sprites</a> &gt; <a href="../preface/QT_Interactive_preface.html#//apple_ref/doc/uid/TP40000883-CH204-DontLinkElementID_69">Interactive Movies</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../quicktimeandsmil/9-QuickTime and SMIL.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../bibliography/QT-biblio.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000883-CH214-DontLinkElementID_108" title="QTWiredSprite.c Sample Code"></a><h1><a name="//apple_ref/doc/uid/TP40000883-CH214-CJBJFHCE" title="QTWiredSprite.c Sample Code"></a>QTWiredSprite.c Sample Code</h1><p>This appendix includes sample code from <code>QTWiredSprite.c</code>. Note this is only a partial code listing. You can download the full sample code at QuickTime Web site at </p><div class="codesample"><table><tr><td scope="row"><pre>http://developer.apple.com/samplecode/Sample_Code/QuickTime/Wired_Movies_and_Sprites.htm<span></span></pre></td></tr></table></div><p>It is also available on the QuickTime SDK. </p><p>Refer to <span class="content_text"><a href="../spritemediahandler/3-Sprite-Media-Handler.html#//apple_ref/doc/uid/TP40000883-CH207-CJBEEIFB">“Chapter 3, Sprite Media Handler,”</a></span> and <span class="content_text"><a href="../authoringwiredmovies/4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIDCFEG">“Chapter 4, Authoring Wired Movies and Sprite Animations,”</a></span> for information on how to use this sample code in your application. </p><div class="codesample"><table><tr><td scope="row"><pre>//  File:       QTWiredSprites.c<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  Contains:   QuickTime wired sprites support for QuickTime movies.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//  Written by: Sean Allen<span></span></pre></td></tr><tr><td scope="row"><pre>//  Revised by: Chris Flick and Tim Monroe<span></span></pre></td></tr><tr><td scope="row"><pre>//              Based (heavily!) on the existing MakeActionSpriteMovie.c<span></span></pre></td></tr><tr><td scope="row"><pre>//              code written by Sean Allen.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  Copyright:  © 1997-1999 by Apple Computer, Inc., all rights reserved.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  Change History (most recent first):<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//     &lt;2>      03/26/98    rtm     made fixes for Windows compiles<span></span></pre></td></tr><tr><td scope="row"><pre>//     &lt;1>      03/25/98    rtm     first file; integrated existing code<span></span></pre></td></tr><tr><td scope="row"><pre>//                                                  with shell framework<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  This sample code creates a wired sprite movie containing one sprite<span></span></pre></td></tr><tr><td scope="row"><pre>//track. The sprite track contains six sprites: two penguins and four<span></span></pre></td></tr><tr><td scope="row"><pre>//buttons.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  The four buttons are initially invisible. When the mouse enters (or<span></span></pre></td></tr><tr><td scope="row"><pre>//  "rolls over") a button, it appears.<span></span></pre></td></tr><tr><td scope="row"><pre>//  When the mouse is clicked inside a button, its image changes to its<span></span></pre></td></tr><tr><td scope="row"><pre>//"pressed" image. When the mouse<span></span></pre></td></tr><tr><td scope="row"><pre>//  is released, its image changes back to its "unpressed" image. If the<span></span></pre></td></tr><tr><td scope="row"><pre>//  mouse is released inside the button,<span></span></pre></td></tr><tr><td scope="row"><pre>//  an action is triggered. The buttons perform the actions of go to<span></span></pre></td></tr><tr><td scope="row"><pre>//  beginning of movie, step backward,<span></span></pre></td></tr><tr><td scope="row"><pre>//  step forward, and go to end of movie.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  The first penguin shows all of the buttons when the mouse enters it,<span></span></pre></td></tr><tr><td scope="row"><pre>//  and hides them when the mouse exits.<span></span></pre></td></tr><tr><td scope="row"><pre>//  The first penguin is the only sprite that has properties that are<span></span></pre></td></tr><tr><td scope="row"><pre>//  overriden by the override sprite samples.<span></span></pre></td></tr><tr><td scope="row"><pre>//  These samples override its matrix (in order to move it) and its image<span></span></pre></td></tr><tr><td scope="row"><pre>//  index (in order to make it "waddle").<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  When the mouse is clicked on the second penguin, it changes its image<span></span></pre></td></tr><tr><td scope="row"><pre>//  index to its "eyes closed" image.<span></span></pre></td></tr><tr><td scope="row"><pre>//  When the mouse is released, it changes back to its normal image. This<span></span></pre></td></tr><tr><td scope="row"><pre>//  makes it appear to blink when clicked on.<span></span></pre></td></tr><tr><td scope="row"><pre>//  When the mouse is released over the penguin, several actions are<span></span></pre></td></tr><tr><td scope="row"><pre>//  triggered. Both penguins' graphics states are<span></span></pre></td></tr><tr><td scope="row"><pre>//  toggled between copyMode and blendMode, and the movie's rate is<span></span></pre></td></tr><tr><td scope="row"><pre>//  toggled between 0 and one.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  The second penguin moves once per second. This occurs whether the<span></span></pre></td></tr><tr><td scope="row"><pre>//  movie's rate is currently 0 or one,<span></span></pre></td></tr><tr><td scope="row"><pre>//  because it is being triggered by a gated idle event. When the penguin<span></span></pre></td></tr><tr><td scope="row"><pre>//  receives the idle event, it changes<span></span></pre></td></tr><tr><td scope="row"><pre>//  its matrix using an action which uses min, max, delta, and wraparound<span></span></pre></td></tr><tr><td scope="row"><pre>//  options.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  The movie's looping mode is set to palindrome by a frame-loaded<span></span></pre></td></tr><tr><td scope="row"><pre>//  action.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  So, our general strategy is as follows (though perhaps not in the<span></span></pre></td></tr><tr><td scope="row"><pre>//  order listed):<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//      (1) Create a new movie file with a single sprite track.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (2) Assign the "no controller" movie controller to the movie.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (3) Set the sprite track's background color, idle event<span></span></pre></td></tr><tr><td scope="row"><pre>//          frequency, and hasActions properties.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (4) Convert our PICT resources to animation codec images with<span></span></pre></td></tr><tr><td scope="row"><pre>//          transparency.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (5) Create a key frame sample containing six sprites and all of<span></span></pre></td></tr><tr><td scope="row"><pre>//          their shared images.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (6) Assign the sprites their initial property values.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (7) Create a frameLoaded event for the key frame.<span></span></pre></td></tr><tr><td scope="row"><pre>//      (8) Create some override samples that override the matrix and<span></span></pre></td></tr><tr><td scope="row"><pre>//          image index properties of the first penguin sprite.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//  NOTES:<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (1) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  There are event types other that mouse related events (for instance,<span></span></pre></td></tr><tr><td scope="row"><pre>//  Idle and FrameLoaded).<span></span></pre></td></tr><tr><td scope="row"><pre>//  Idle events are independent of the movie's rate, and they can be<span></span></pre></td></tr><tr><td scope="row"><pre>//  gated so they are send at most<span></span></pre></td></tr><tr><td scope="row"><pre>//  every n ticks. In our sample movie, the second penguin moves when the<span></span></pre></td></tr><tr><td scope="row"><pre>//  movie's rate is 0,<span></span></pre></td></tr><tr><td scope="row"><pre>//  and moves only once per second because of the value of the sprite<span></span></pre></td></tr><tr><td scope="row"><pre>//  track's idleEventFrequencey property.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (2) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Multiple actions may be executed in response to a single event. In<span></span></pre></td></tr><tr><td scope="row"><pre>//  our sample movie, rolling over<span></span></pre></td></tr><tr><td scope="row"><pre>//  the first penguin shows and hides four different buttons.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (3) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Actions may target any sprite or track in the movie. In our sample<span></span></pre></td></tr><tr><td scope="row"><pre>//  movie, clicking on one penguin<span></span></pre></td></tr><tr><td scope="row"><pre>//  changes the graphics mode of the other.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (4) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Conditional and looping control structures are supported. In our<span></span></pre></td></tr><tr><td scope="row"><pre>// sample movie, the second penguin<span></span></pre></td></tr><tr><td scope="row"><pre>//  uses the "case statement" action.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (5) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Sprite track variables that have not been set have a default value of<span></span></pre></td></tr><tr><td scope="row"><pre>//  0. (The second penguin's<span></span></pre></td></tr><tr><td scope="row"><pre>//  conditional code relies on this.)<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (6) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Wired sprites were previously known as "action sprites". Don't let<span></span></pre></td></tr><tr><td scope="row"><pre>//  the names of some of the utility<span></span></pre></td></tr><tr><td scope="row"><pre>//  functions confuse you. We'll try to update the source code as time<span></span></pre></td></tr><tr><td scope="row"><pre>//  permits.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  *** (7) ***<span></span></pre></td></tr><tr><td scope="row"><pre>//  Penguins don't fly, but I hear they totally shred halfpipes on<span></span></pre></td></tr><tr><td scope="row"><pre>//  snowboards.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre>// header files<span></span></pre></td></tr><tr><td scope="row"><pre>#include "QTWiredSprites.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>// QTWired_CreateWiredSpritesMovie<span></span></pre></td></tr><tr><td scope="row"><pre>// Create a QuickTime movie containing a wired sprites track.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSErr QTWired_CreateWiredSpritesMovie (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short                   myResRefNum = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie                   myMovie = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                   myTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media                   myMedia;<span></span></pre></td></tr><tr><td scope="row"><pre>    StandardFileReply       myReply;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         mySample = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         myActions = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         myBeginButton, myPrevButton, myNextButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myEndButton;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         myPenguinOne, myPenguinTwo,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myPenguinOneOverride;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         myBeginActionButton, myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myNextActionButton, myEndActionButton;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer         myPenguinOneAction, myPenguinTwoAction;<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor                myKeyColor;<span></span></pre></td></tr><tr><td scope="row"><pre>    Point                   myLocation;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                   isVisible, myLayer, myIndex, myResID, i,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean                 hasActions;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                    myFlags = createMovieFileDeleteCurFile |<span></span></pre></td></tr><tr><td scope="row"><pre>                                        createMovieFileDontCreateResFile;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType                  myType = FOUR_CHAR_CODE('none');<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32                  myFrequency;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom                  myEventAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                    myLoopingFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    ModifierTrackGraphicsModeRecord     myGraphicsMode;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                   myErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // create a new movie file and set its controller type<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // ask the user for the name of the new movie file<span></span></pre></td></tr><tr><td scope="row"><pre>    StandardPutFile("\pSprite movie file name:", "\pSprite.mov",<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;myReply);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!myReply.sfGood)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // create a movie file for the destination movie<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = CreateMovieFile(&amp;myReply.sfFile, FOUR_CHAR_CODE('TVOD'), 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myFlags, &amp;myResRefNum, &amp;myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // select the "no controller" movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>    myType = EndianU32_NtoB(myType);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetUserDataItem(GetMovieUserData(myMovie), &amp;myType, sizeof(myType),<span></span></pre></td></tr><tr><td scope="row"><pre>                    kUserDataMovieControllerType, 1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // create the sprite track and media<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myTrack = NewMovieTrack(myMovie, ((long)kSpriteTrackWidth &lt;&lt; 16),<span></span></pre></td></tr><tr><td scope="row"><pre>                            ((long)kSpriteTrackHeight &lt;&lt; 16), kNoVolume);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMedia = NewTrackMedia(myTrack, SpriteMediaType, kSpriteMediaTimeScale, NULL, 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // create a key frame sample containing six sprites and all of their<span></span></pre></td></tr><tr><td scope="row"><pre>    // shared images<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // create a new, empty key frame sample<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;mySample);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.red = 0xffff;                        // white<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.green = 0xffff;<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.blue = 0xffff;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add images to the key frame sample<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToBeginningButtonUp,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToBeginningButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToBeginningButtonDown,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToBeginningButtonDownIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToEndButtonUp, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                kGoToEndButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToEndButtonDown,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToEndButtonDownIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToPrevButtonUp,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToPrevButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToPrevButtonDown,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToPrevButtonDownIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToNextButtonUp,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToNextButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToNextButtonDown,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToNextButtonDownIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinForward, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPenguinForwardIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinLeft, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPenguinLeftIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinRight, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPenguinRightIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinClosed, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                kPenguinClosedIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (myIndex = kPenguinDownRightCycleStartIndex, myResID =<span></span></pre></td></tr><tr><td scope="row"><pre>    kWalkDownRightCycleStart; myIndex &lt;= kPenguinDownRightCycleEndIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex++, myResID++)<span></span></pre></td></tr><tr><td scope="row"><pre>        AddPICTImageToKeyFrameSample(mySample, myResID, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                myIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // assign group IDs to the images<span></span></pre></td></tr><tr><td scope="row"><pre>    AssignImageGroupIDsToKeyFrame(mySample);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // add samples to the sprite track's media<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    BeginMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // go to beginning button with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myBeginButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (1 * kSpriteTrackWidth / 8) -<span></span></pre></td></tr><tr><td scope="row"><pre>                        (kStartEndButtonWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (4 * kSpriteTrackHeight / 5) -<span></span></pre></td></tr><tr><td scope="row"><pre>                        (kStartEndButtonHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kGoToBeginningButtonUpIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myBeginButton, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myLayer, &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // go to previous button with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myPrevButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (3 * kSpriteTrackWidth / 8) -<span></span></pre></td></tr><tr><td scope="row"><pre>                (kNextPrevButtonWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (4 * kSpriteTrackHeight / 5) -<span></span></pre></td></tr><tr><td scope="row"><pre>                (kStartEndButtonHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kGoToPrevButtonUpIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myPrevButton, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myLayer, &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // go to next button with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myNextButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (5 * kSpriteTrackWidth / 8) -<span></span></pre></td></tr><tr><td scope="row"><pre>                    (kNextPrevButtonWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (4 * kSpriteTrackHeight / 5) -<span></span></pre></td></tr><tr><td scope="row"><pre>                    (kStartEndButtonHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kGoToNextButtonUpIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myNextButton, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myLayer, &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // go to end button with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myEndButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (7 * kSpriteTrackWidth / 8) -<span></span></pre></td></tr><tr><td scope="row"><pre>                        (kStartEndButtonWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (4 * kSpriteTrackHeight / 5) -<span></span></pre></td></tr><tr><td scope="row"><pre>                        (kStartEndButtonHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kGoToEndButtonUpIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myEndButton, &amp;myLocation, &amp;isVisible, &amp;myLayer,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // first penguin sprite with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myPenguinOne);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (3 * kSpriteTrackWidth / 8) - (kPenguinWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (kSpriteTrackHeight / 4) - (kPenguinHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kPenguinDownRightCycleStartIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myGraphicsMode.graphicsMode = blend;<span></span></pre></td></tr><tr><td scope="row"><pre>    myGraphicsMode.opColor.red = myGraphicsMode.opColor.green =<span></span></pre></td></tr><tr><td scope="row"><pre>                myGraphicsMode.opColor.blue = 0x8FFF;           // grey<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myPenguinOne, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myLayer, &amp;myIndex, &amp;myGraphicsMode, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // second penguin sprite with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myPenguinTwo);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (5 * kSpriteTrackWidth / 8) - (kPenguinWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (kSpriteTrackHeight / 4) - (kPenguinHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 3;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kPenguinForwardIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myPenguinTwo, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myLayer, &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // add actions to the six sprites<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to beginning button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myBeginButton, kParentAtomIsContainer, &amp;myBeginActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kGoToBeginningButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, kGoToBeginningButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieGoToBeginningAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kGoToBeginningSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myBeginActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><div class="codesample"><table><tr><td scope="row"><pre>    // add go to prev button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPrevButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPrevActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kGoToPrevButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, kGoToPrevButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieStepBackwardAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myPrevActionButton, kGoToPrevSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myPrevActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to next button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myNextButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myNextActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myNextActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kGoToNextButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myNextActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, kGoToNextButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieStepForwardAction(myNextActionButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myNextActionButton, kGoToNextSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myNextActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to end button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myEndButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myEndActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myEndActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kGoToEndButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myEndActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, kGoToEndButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieGoToEndAction(myEndActionButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myEndActionButton, kGoToEndSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myEndActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add penguin one<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPenguinOne, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPenguinOneAction);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // show the buttons on mouse enter and hide them on mouse exit<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseEnter, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToBeginningSpriteID, true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseExit, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToBeginningSpriteID, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseEnter, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToPrevSpriteID, true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseExit, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToPrevSpriteID, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseEnter, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToNextSpriteID, true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseExit, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToNextSpriteID, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseEnter, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToEndSpriteID, true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseExit, 0, NULL, 0, kTargetSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void *)kGoToEndSpriteID, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myPenguinOneAction, kPenguinOneSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myPenguinOneAction);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add penguin two<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPenguinTwo, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPenguinTwoAction);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // blink when clicked on<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPenguinTwoAction,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kPenguinClosedIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPenguinTwoAction,<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, kPenguinForwardIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddQTEventAtom(myPenguinTwoAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventMouseClickEndTriggerButton, &amp;myEventAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // toggle the movie rate and both of the birds' graphics modes<span></span></pre></td></tr><tr><td scope="row"><pre>    QTWired_AddPenguinTwoConditionalActions(myPenguinTwoAction,<span></span></pre></td></tr><tr><td scope="row"><pre>        myEventAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTWired_AddWraparoundMatrixOnIdle(myPenguinTwoAction);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myPenguinTwoAction, kPenguinTwoSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myPenguinTwoAction);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add an action for when the key frame is loaded, to set the movie's<span></span></pre></td></tr><tr><td scope="row"><pre>    // looping mode to palindrome;<span></span></pre></td></tr><tr><td scope="row"><pre>    // note that this will actually be triggered every time the key frame<span></span></pre></td></tr><tr><td scope="row"><pre>    // is reloaded,<span></span></pre></td></tr><tr><td scope="row"><pre>    // so if the operation was expensive we could use a conditional to<span></span></pre></td></tr><tr><td scope="row"><pre>    // test if we've already done it<span></span></pre></td></tr><tr><td scope="row"><pre>    myLoopingFlags = loopTimeBase | palindromeLoopTimeBase;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieSetLoopingFlagsAction(mySample, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>        kQTEventFrameLoaded, myLoopingFlags);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the key frame sample to the sprite track media<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // to add the sample data in a compressed form, you would use a<span></span></pre></td></tr><tr><td scope="row"><pre>    // QuickTime DataCodec to perform the<span></span></pre></td></tr><tr><td scope="row"><pre>    // compression; replace the call to the utility<span></span></pre></td></tr><tr><td scope="row"><pre>    // AddSpriteSampleToMedia with a call to the utility<span></span></pre></td></tr><tr><td scope="row"><pre>    // AddCompressedSpriteSampleToMedia to do this<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSampleToMedia(myMedia, mySample, kSpriteMediaFrameDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>        true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    //AddCompressedSpriteSampleToMedia(myMedia, mySample,<span></span></pre></td></tr><tr><td scope="row"><pre>    // kSpriteMediaFrameDuration, true, zlibDataCompressorSubType, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // add a few override samples to move penguin one and change its<span></span></pre></td></tr><tr><td scope="row"><pre>    // image index<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // original penguin one location<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (3 * kSpriteTrackWidth / 8) - (kPenguinWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (kSpriteTrackHeight / 4) - (kPenguinHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myDelta = (kSpriteTrackHeight / 2) / kNumOverrideSamples;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex = kPenguinDownRightCycleStartIndex;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (i = 1; i &lt;= kNumOverrideSamples; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTRemoveChildren(mySample, kParentAtomIsContainer);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTNewAtomContainer(&amp;myPenguinOneOverride);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        myLocation.h += myDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>        myLocation.v += myDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>        myIndex++;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myIndex > kPenguinDownRightCycleEndIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>            myIndex = kPenguinDownRightCycleStartIndex;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        SetSpriteData(myPenguinOneOverride, &amp;myLocation, NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;myIndex, NULL, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        AddSpriteToSample(mySample, myPenguinOneOverride,<span></span></pre></td></tr><tr><td scope="row"><pre>            kPenguinOneSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>        AddSpriteSampleToMedia(myMedia, mySample,<span></span></pre></td></tr><tr><td scope="row"><pre>            kSpriteMediaFrameDuration, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myPenguinOneOverride);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    EndMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the media to the track<span></span></pre></td></tr><tr><td scope="row"><pre>    InsertMediaIntoTrack(myTrack, 0, 0, GetMediaDuration(myMedia),<span></span></pre></td></tr><tr><td scope="row"><pre>                            fixed1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // set the sprite track properties<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTAtomContainer     myTrackProperties;<span></span></pre></td></tr><tr><td scope="row"><pre>        RGBColor            myBackgroundColor;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // add a background color to the sprite track<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.red = EndianU16_NtoB(0x8000);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.green = EndianU16_NtoB(0);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.blue = EndianU16_NtoB(0xffff);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTNewAtomContainer(&amp;myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyBackgroundColor, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(RGBColor), &amp;myBackgroundColor, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // tell the movie controller that this sprite track has actions<span></span></pre></td></tr><tr><td scope="row"><pre>        hasActions = true;<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyHasActions, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(hasActions), &amp;hasActions, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // tell the sprite track to generate QTIdleEvents<span></span></pre></td></tr><tr><td scope="row"><pre>        myFrequency = EndianU32_NtoB(60);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyQTIdleEventsFrequency, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(myFrequency), &amp;myFrequency, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        myErr = SetMediaPropertyAtom(myMedia, myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // finish up<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    //////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the movie resource to the movie file<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddMovieResource(myMovie, myResRefNum, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                myReply.sfFile.name);<span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (mySample != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(mySample);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myBeginButton != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myBeginButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myPrevButton != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myPrevButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myNextButton != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myNextButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myEndButton != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myEndButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myResRefNum != 0)<span></span></pre></td></tr><tr><td scope="row"><pre>        CloseMovieFile(myResRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myMovie != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeMovie(myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return(myErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>// QTWired_AddPenguinTwoConditionalActions<span></span></pre></td></tr><tr><td scope="row"><pre>// Add actions to the second penguin that transform him (her?) into a two<span></span></pre></td></tr><tr><td scope="row"><pre>// state button<span></span></pre></td></tr><tr><td scope="row"><pre>// that plays or pauses the movie.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>// We are relying on the fact that a "GetVariable" for a variable ID<span></span></pre></td></tr><tr><td scope="row"><pre>// which has never been set<span></span></pre></td></tr><tr><td scope="row"><pre>// will return 0. If we needed a different default value, we could<span></span></pre></td></tr><tr><td scope="row"><pre>// initialize it using the<span></span></pre></td></tr><tr><td scope="row"><pre>// frameLoaded event.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>// A higher-level description of the logic is:<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//  On MouseUpInside<span></span></pre></td></tr><tr><td scope="row"><pre>//     If (GetVariable(DefaultTrack, 1) = 0)<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetMovieRate(1)<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetSpriteGraphicsMode(DefaultSprite, { blend, grey } )<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetSpriteGraphicsMode(GetSpriteByID(DefaultTrack, 5),<span></span></pre></td></tr><tr><td scope="row"><pre>//              { ditherCopy, white } )<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetVariable(DefaultTrack, 1, 1)<span></span></pre></td></tr><tr><td scope="row"><pre>//     ElseIf (GetVariable(DefaultTrack, 1) = 1)<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetMovieRate(0)<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetSpriteGraphicsMode(DefaultSprite, { ditherCopy, white })<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetSpriteGraphicsMode(GetSpriteByID(DefaultTrack, 5),<span></span></pre></td></tr><tr><td scope="row"><pre>//              { blend, grey })<span></span></pre></td></tr><tr><td scope="row"><pre>//        SetVariable(DefaultTrack, 1, 0)<span></span></pre></td></tr><tr><td scope="row"><pre>//     Endif<span></span></pre></td></tr><tr><td scope="row"><pre>//  End<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSErr QTWired_AddPenguinTwoConditionalActions (QTAtomContainer<span></span></pre></td></tr><tr><td scope="row"><pre>                                    theContainer, QTAtom theEventAtom)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myNewActionAtom, myNewParamAtom, myConditionalAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myExpressionAtom, myOperatorAtom, myActionListAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>    short           myParamIndex, myConditionIndex, myOperandIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    float           myConstantValue;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomID        myVariableID;<span></span></pre></td></tr><tr><td scope="row"><pre>    ModifierTrackGraphicsModeRecord     myBlendMode, myCopyMode;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                               myErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myBlendMode.graphicsMode = blend;<span></span></pre></td></tr><tr><td scope="row"><pre>    myBlendMode.opColor.red = myBlendMode.opColor.green =<span></span></pre></td></tr><tr><td scope="row"><pre>                        myBlendMode.opColor.blue = 0x8fff;      // grey<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myCopyMode.graphicsMode = ditherCopy;<span></span></pre></td></tr><tr><td scope="row"><pre>    myCopyMode.opColor.red = myCopyMode.opColor.green =<span></span></pre></td></tr><tr><td scope="row"><pre>                        myCopyMode.opColor.blue = 0xffff;       // white<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddActionAtom(theContainer, theEventAtom, kActionCase,<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;myNewActionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myParamIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddActionParameterAtom(theContainer, myNewActionAtom, myParamIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>                            0, NULL, &amp;myNewParamAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // first condition<span></span></pre></td></tr><tr><td scope="row"><pre>    myConditionIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddConditionalAtom(theContainer, myNewParamAtom, myConditionIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myConditionalAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddExpressionContainerAtomType(theContainer, myConditionalAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myExpressionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddOperatorAtom(theContainer, myExpressionAtom, kOperatorEqualTo,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myOperatorAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myOperandIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myConstantValue = kButtonStateOne;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddOperandAtom(theContainer, myOperatorAtom, kOperandConstant,<span></span></pre></td></tr><tr><td scope="row"><pre>                        myOperandIndex, NULL, myConstantValue);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myOperandIndex = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    myVariableID = kPenguinStateVariableID;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddVariableOperandAtom(theContainer, myOperatorAtom, myOperandIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>                        0, NULL, 0, myVariableID);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddActionListAtom(theContainer, myConditionalAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myActionListAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieSetRateAction(theContainer, myActionListAtom, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        Long2Fix(1));<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetGraphicsModeAction(theContainer, myActionListAtom, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, 0, 0, NULL, &amp;myBlendMode, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetGraphicsModeAction(theContainer, myActionListAtom, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, 0, kTargetSpriteID, (void *)kPenguinOneSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myCopyMode, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteTrackSetVariableAction(theContainer, myActionListAtom, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        kPenguinStateVariableID, kButtonStateTwo, 0, NULL, 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // second condition<span></span></pre></td></tr><tr><td scope="row"><pre>    myConditionIndex = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddConditionalAtom(theContainer, myNewParamAtom, myConditionIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myConditionalAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddExpressionContainerAtomType(theContainer, myConditionalAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myExpressionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddOperatorAtom(theContainer, myExpressionAtom, kOperatorEqualTo,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myOperatorAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myOperandIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myConstantValue = kButtonStateTwo;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddOperandAtom(theContainer, myOperatorAtom, kOperandConstant,<span></span></pre></td></tr><tr><td scope="row"><pre>        myOperandIndex, NULL, myConstantValue);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myOperandIndex = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    myVariableID = kPenguinStateVariableID;<span></span></pre></td></tr><tr><td scope="row"><pre>    AddVariableOperandAtom(theContainer, myOperatorAtom, myOperandIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>        0, NULL, 0, myVariableID);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddActionListAtom(theContainer, myConditionalAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myActionListAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieSetRateAction(theContainer, myActionListAtom, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        Long2Fix(0));<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetGraphicsModeAction(theContainer, myActionListAtom, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, 0, 0, NULL, &amp;myCopyMode, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetGraphicsModeAction(theContainer, myActionListAtom, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL, 0, kTargetSpriteID, (void *)kPenguinOneSpriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;myBlendMode, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteTrackSetVariableAction(theContainer, myActionListAtom, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        kPenguinStateVariableID, kButtonStateOne, 0, NULL, 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    return(myErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>// QTWired_AddWraparoundMatrixOnIdle<span></span></pre></td></tr><tr><td scope="row"><pre>// Add beginning, end, and change matrices to the specified atom<span></span></pre></td></tr><tr><td scope="row"><pre>// container.<span></span></pre></td></tr><tr><td scope="row"><pre>//<span></span></pre></td></tr><tr><td scope="row"><pre>//////////<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSErr QTWired_AddWraparoundMatrixOnIdle (QTAtomContainer theContainer)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MatrixRecord    myMinMatrix, myMaxMatrix, myDeltaMatrix;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            myFlags = kActionFlagActionIsDelta |<span></span></pre></td></tr><tr><td scope="row"><pre>                                kActionFlagParameterWrapsAround;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myActionAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           myErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myMinMatrix.matrix[0][0] = myMinMatrix.matrix[0][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMinMatrix.matrix[0][2] = EndianS32_NtoB(0xffffffff);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMinMatrix.matrix[1][0] = myMinMatrix.matrix[1][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMinMatrix.matrix[1][2] = EndianS32_NtoB(0xffffffff);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMinMatrix.matrix[2][0] = myMinMatrix.matrix[2][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMinMatrix.matrix[2][2] = EndianS32_NtoB(0xffffffff);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myMaxMatrix.matrix[0][0] = myMaxMatrix.matrix[0][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMaxMatrix.matrix[0][2] = EndianS32_NtoB(0x7fffffff);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMaxMatrix.matrix[1][0] = myMaxMatrix.matrix[1][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMaxMatrix.matrix[1][2] = EndianS32_NtoB(0x7fffffff);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMaxMatrix.matrix[2][0] = myMaxMatrix.matrix[2][1] =<span></span></pre></td></tr><tr><td scope="row"><pre>        myMaxMatrix.matrix[2][2] = EndianS32_NtoB(0x7fffffff);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myMinMatrix.matrix[2][1] = EndianS32_NtoB(Long2Fix((1 *<span></span></pre></td></tr><tr><td scope="row"><pre>        kSpriteTrackHeight / 4) - (kPenguinHeight / 2)));<span></span></pre></td></tr><tr><td scope="row"><pre>    myMaxMatrix.matrix[2][1] = EndianS32_NtoB(Long2Fix((3 *<span></span></pre></td></tr><tr><td scope="row"><pre>        kSpriteTrackHeight / 4) - (kPenguinHeight / 2)));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetIdentityMatrix(&amp;myDeltaMatrix);<span></span></pre></td></tr><tr><td scope="row"><pre>    myDeltaMatrix.matrix[2][1] = Long2Fix(1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // change location<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddSpriteSetMatrixAction(theContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>            kParentAtomIsContainer, kQTEventIdle, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;myDeltaMatrix, &amp;myActionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddActionParameterOptions(theContainer, myActionAtom, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>            myFlags, sizeof(myMinMatrix), &amp;myMinMatrix,<span></span></pre></td></tr><tr><td scope="row"><pre>            sizeof(myMaxMatrix), &amp;myMaxMatrix);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    return(myErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../quicktimeandsmil/9-QuickTime and SMIL.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../bibliography/QT-biblio.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-10-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/IQ_InteractiveMovies/samplecodeappendix/Appendix-A-sample-code.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/IQ_InteractiveMovies/samplecodeappendix/Appendix-A-sample-code.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/IQ_InteractiveMovies/samplecodeappendix/Appendix-A-sample-code.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>