<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MoreNetworkSetup - /MoreTextUtils/MoreTextUtils.cp</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; <A HREF="javascript:location.replace('index.html');">MoreNetworkSetup</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxNetworking-date.html" target="_blank">Carbon > Networking</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MoreNetworkSetup</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MoreTextUtils/MoreTextUtils.cp</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/MoreInterfaceLib/MoreInterfaceLib.c</option>
<option value="listing2.html">/MoreInterfaceLib/MoreInterfaceLib.h</option>
<option value="listing3.html">/MoreInterfaceLib/RemoteAccessInterface.h</option>
<option value="listing4.html">/MoreMemory/MoreMemory.c</option>
<option value="listing5.html">/MoreMemory/MoreMemory.h</option>
<option value="listing6.html">/MoreQuickDraw/MoreQuickDraw.cp</option>
<option value="listing7.html">/MoreQuickDraw/MoreQuickDraw.h</option>
<option value="listing8.html">/MoreSetup.h</option>
<option value="listing9.html">/MoreTextUtils/MoreTextUtils.cp</option>
<option value="listing10.html">/MoreTextUtils/MoreTextUtils.h</option>
<option value="listing11.html">/NetworkSetup/MoreNetworkSetup.c</option>
<option value="listing12.html">/NetworkSetup/MoreNetworkSetup.h</option>
<option value="listing13.html">/NetworkSetup/Network Setup SDK Bits/NetworkSetupBigPicture.html</option>
<option value="listing14.html">/NetworkSetup/NetworkSetupHelpers.c</option>
<option value="listing15.html">/NetworkSetup/NetworkSetupHelpers.h</option>
<option value="listing16.html">/NetworkSetup/NetworkSetupTest/NetworkSetupTest.c</option>
<option value="listing17.html">/NetworkSetup/OldStyleAPI/OldOTConfigLib.h</option>
<option value="listing18.html">/NetworkSetup/ReadMe.html</option></select>
				</p>
				</form>
				<p><strong><a href="MoreNetworkSetup.zip">Download Sample</a></strong> (&#147;MoreNetworkSetup.zip&#148;, 139.9K)<BR>
<strong><a href="MoreNetworkSetup.dmg">Download Sample</a></strong> (&#147;MoreNetworkSetup.dmg&#148;, 210.9K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    MoreTextUtils.cp  Contains:    Written by:  Pete Gontier  Copyright:  Copyright (c) 1998 Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):         &lt;6&gt;     20/3/00    Quinn   Added MoreReplaceText and its support routines.  Added                                    MoreStrLen.  Tidied up a little.         &lt;5&gt;      1/3/00    Quinn   Minor Carbonation changes.         &lt;4&gt;     21/4/99    Quinn   Added ValidStringListHandle.         &lt;3&gt;     2/15/99    PCG     InlineGetHandleSize loses the Inline         &lt;2&gt;    11/11/98    PCG     fix header         &lt;1&gt;    11/10/98    PCG     first big re-org at behest of Quinn  Old Change History (most recent first):         &lt;2&gt;    10/23/98    PCG     add GetStringFromLongDouble         &lt;1&gt;     6/16/98    PCG     initial checkin*//////////////////////////////////////////////////////////////////// MoreIsBetter Setup#include &quot;MoreSetup.h&quot;// Our Prototypes#include &quot;MoreTextUtils.h&quot;// Mac OS Interfaces#include &lt;Resources.h&gt;#include &lt;PLStringFuncs.h&gt;#include &lt;Fonts.h&gt;// MIB Prototypes#include &quot;MoreMemory.h&quot;#include &quot;MoreQuickDraw.h&quot;/////////////////////////////////////////////////////////////////pascal OSErr NewStringPtr (ConstStr255Param init, UInt8 maxSize, StringPtr *result){  OSErr err = noErr;  if (!MoreAssert (result &amp;&amp; (!init || (*init &lt;= maxSize))))    err = paramErr;  else  {    *result = StringPtr (NewPtr (1 + (maxSize ? maxSize : (init ? *init : 255))));    if (!*result)      err = MemError ( );    else if (init &amp;&amp; *init)      PLstrcpy (*result,init);    else      **result = 0;  }  return err;}pascal OSErr NewStringListHandle (Handle *h){  DebugStr (&quot;\pThis routine has never been traced.&quot;);  if (!MoreAssert (h))    return nilHandleErr;  *h = NewHandleClear (sizeof (UInt16));  if (!*h)    return MemError ( );  return noErr;}pascal OSErr AppendStringToListHandle (ConstStr255Param str, Handle h){  DebugStr (&quot;\pThis routine has never been traced.&quot;);  OSErr err = noErr;  if (!MoreAssert (h &amp;&amp; *h))    err = nilHandleErr;  else  {    UInt8 dummyZero;    if (!str)    {      dummyZero = 0;      str = &amp;dummyZero;    }    if (!(err = PtrAndHand (str, h, *str + 1)))      (** (UInt16 **) h) += 1;  }  return err;}pascal OSErr GetNewStringList (short resID, tStringListP *newStringList){  OSErr err = noErr;  Handle h = GetResource ('STR#',resID);  if (!h)  {    err = ResError ( );    if (!err) err = resNotFound;  }  else  {    Size handleSize = GetHandleSize (h);    (void) MoreAssert (MemError ( ) == noErr);    if (handleSize &lt; 2)      err = paramErr;    else    {      UInt16  stringCount    = ** (UInt16 **) h;      Size  stringListSize  = sizeof (**newStringList) + (handleSize - 2) +                    (stringCount * sizeof (StringPtr));      *newStringList = (tStringListP) NewPtr (stringListSize);      if (!*newStringList)        err = MemError ( );      else      {        (*newStringList)-&gt;count = stringCount;        if (stringCount)        {          UInt16 index = 0;          StringPtr stringScan = (StringPtr) ((*newStringList)-&gt;list + stringCount);          BlockMoveData (2 + *h, stringScan, handleSize - 2);          do          {            (*newStringList)-&gt;list [index] = stringScan;            stringScan += *stringScan + 1;          }          while (++index &lt; stringCount);        }      }    }    ReleaseResource (h);    (void) MoreAssert (ResError ( ) == noErr);  }  return err;}pascal Boolean ValidStringListHandle(Handle stringList)  // See comment in interface part.{  Boolean result;  UInt16 stringCount;  UInt16 stringIndex;  UInt8* cursor;  UInt8* bound;  ByteCount stringListLength;  result = true;  if (stringList == NULL || *stringList == NULL || GetHandleSize(stringList) &lt; sizeof(UInt16) ) {    result = false;  }  if (result) {    stringCount = *((UInt16 *) *stringList);        stringListLength = GetHandleSize(stringList);        // From here down we have to make sure we do nothing to move    // or purge until we're done with cursor and bound.        cursor = ((UInt8 *)*stringList) + sizeof(UInt16);    bound  = ((UInt8 *)*stringList) + stringListLength;    for (stringIndex = 0; stringIndex &lt; stringCount; stringIndex++) {      if ( cursor &lt; bound ) {        cursor += *cursor + 1;      } else {        result = false;        break;      }    }        if (result) {      if ( cursor != bound ) {        result = false;      }    }  }    return result;}pascal OSErr GetPascalStringFromLongDouble (long double d, SInt8 precision, StringPtr buf){  OSErr err = noErr;  *buf = 0;  //  If client requests more precision than is available, bitch.  if (!MoreAssert (precision &lt; SIGDIGLEN))    err = paramErr;  else  {    //   If precision is less than 0, client is requesting    //  as much precision as is available.    if (precision &lt; 0)      precision = SIGDIGLEN;    //  Try normal notation, and if that overflows,    //  fall back to scientific notation (bleah!).    decimal dec;    decform df = { 1, 0, precision };    num2dec (&amp;df,d,&amp;dec);    if (dec.sig.text [0] == '?')    {      df.style  = 0;      df.digits  = SIGDIGLEN;      num2dec (&amp;df,d,&amp;dec);    }    if (*(dec.sig.text) == '0')      PLstrcpy (buf,&quot;\p0&quot;);    else if (*(dec.sig.text) == 'I')      PLstrcpy (buf,&quot;\p[INF]&quot;);    else if (*(dec.sig.text) == 'N')      PLstrcpy (buf,&quot;\p[NaN]&quot;);    else    {      //  Finally, convert it to a pascal string...      dec2str (&amp;df,&amp;dec,(Ptr)buf);      CopyCStringToPascal( (char *) buf, buf );      //  ...and trim trailing zeroes.//      if (df.style == 1 &amp;&amp; dec.exp &lt; 0)//        while (buf [*buf] == '0')//          *buf -= 1;    }  }  return err;}// gDummyPort is a pointer to a dummy GrafPort whose font is always// the system font.  By setting thePort to this port, we can then safely// call Script Manager that get script information from the current port.static GrafPtr gDummyPort;extern pascal OSStatus InitMoreTextUtils(void)  // See comment in header.{  OSStatus err;  GrafPtr  oldPort;  // Preserve the current port.      GetPort(&amp;oldPort);    // Create gDummyPort.    gDummyPort = (GrafPtr) CreateNewPort();  err = MoreMemError(gDummyPort);  if (err == noErr) {      // CreateNewPort, if it follows the semantics of the old    // OpenPort routine, should set thePort to the new port.    // This assert ensures that behaviour, because the following    // call to TextFont relies on it.        #if MORE_DEBUG      {        GrafPtr junkPort;                GetPort(&amp;junkPort);        MoreAssertQ(junkPort == gDummyPort);      }    #endif    // Set the dummy port's font to the system font.            TextFont(systemFont);  }    SetPort(oldPort);    return err;}extern pascal void TermMoreTextUtils(void)  // See comment in header.{  if (gDummyPort != nil) {    DisposePort( (CGrafPtr) gDummyPort);    gDummyPort = nil;  }}extern pascal void MoreReplaceText(Str255 baseText, ConstStr255Param substitutionText, ConstStr15Param key)  // See comment in header.{  OSStatus err;  GrafPtr  oldPort;  Handle   baseTextH;  Handle   substitutionTextH;  Size     newLength;  UInt8    *tmpKey;  MoreAssertQ(baseText != nil);  MoreAssertQ(substitutionText != nil);  MoreAssertQ(key != nil);  MoreAssertQ(key[0] &lt;= 15);    GetPort(&amp;oldPort);    baseTextH = nil;  substitutionTextH = nil;  // Copy the strings into handles, call ReplaceText, then  // copy the result back into baseText (making sure that  // there is at most 255 bytes in the resulting string).      err = noErr;  if (gDummyPort == nil) {    err = InitMoreTextUtils();  }  if (err == noErr) {    SetPort(gDummyPort);    err = PtrToHand(&amp;baseText[1], &amp;baseTextH, baseText[0]);  }  if (err == noErr) {    err = PtrToHand(&amp;substitutionText[1], &amp;substitutionTextH, substitutionText[0]);  }  if (err == noErr) {    tmpKey = (UInt8 *) key;    err = ReplaceText(baseTextH, substitutionTextH, tmpKey);    if (err &gt;= 0) {      newLength = GetHandleSize(baseTextH);      if (newLength &gt; 255) {        newLength = 255;      }      baseText[0] = newLength;      BlockMoveData(*baseTextH, &amp;baseText[1], newLength);      err = noErr;    }  }    // Clean up.  if (baseTextH != nil) {    DisposeHandle(baseTextH);    MoreAssertQ(MemError() == noErr);  }    if (substitutionTextH != nil) {    DisposeHandle(substitutionTextH);    MoreAssertQ(MemError() == noErr);  }    SetPort(oldPort);    MoreAssert(err == noErr);}extern pascal ByteCount MoreStrLen(const char *str)  // See comment in header.{  ByteCount result;    result = 0;  while ( *str != 0 ) {    result += 1;    str += 1;  }  return result;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MoreNetworkSetup/listing9.html%3Fid%3DDTS10000240-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MoreNetworkSetup/listing9.html%3Fid%3DDTS10000240-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MoreNetworkSetup/listing9.html%3Fid%3DDTS10000240-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>