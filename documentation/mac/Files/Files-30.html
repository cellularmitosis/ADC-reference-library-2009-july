<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using a Preferences File (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING30></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-29.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-31.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-12.html"><B>Chapter 1 - Introduction to File Management</B></A> / <A HREF="Files-19.html"><B>Using Files</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING30-0></A>
<H2><A NAME=MARKER-9-227></A>Using a Preferences File</H2>
 <A NAME=MARKER-2-70></A>Many applications allow the user to alter various settings that control the operation or configuration of the application. For example, your application might allow the user to specify the size and placement of any new windows or the default font used to display text in those windows. You can create a preferences file in which to record user preferences, and your application can retrieve that file whenever it is launched.<P>
 In deciding how to structure your preferences file, it is important to distinguish document-specific settings from application-specific settings. Some user-specifiable settings affect only a particular document. For example, the user might have changed the text font in a particular window. When you save the text in the window, you also want to save the current font setting. Generally you can do this by storing the font name in a resource in the document file's resource fork. Then, when the user opens that document again, you check for the presence of such a resource, retrieve the information stored in it, and set the document font accordingly.<P>
 Some settings, such as a default text font, are not specific to a particular document. You might store such settings in the application's resource fork, but generally it is better to store them in a separate preferences file. The main reason for this is to avoid problems that can arise if an application is located on a server volume. If preferences are stored in resources in the application's resource fork, those preferences apply to all users executing that application. Worse yet, the resources can become corrupted if several different users attempt to alter the settings at the same time.<P>
 Thus, it is best to store application-specific settings in a preferences file. The Operating System provides a special folder in the System Folder, called Preferences, where you can store that file. <A HREF=#MARKER-9-229>Listing 1-18</A> illustrates a way to open your application's preferences file.<P>
<B>Listing 1-18  <A NAME=MARKER-9-229></A>Opening a preferences file</B><P>
<PRE>
PROCEDURE DoGetPreferences;
VAR
   myErr:      OSErr;
   myVRef:     Integer; {volume ref num of Preferences folder}
   myDirID:    LongInt; {dir ID of Preferences folder}
   mySpec:     FSSpec;  {FSSpec for the preferences file}
   myName:     Str255;  {name of the application}
   myRef:      Integer; {ref num of app's resource file; ignored}
   myHand:     Handle;  {handle to Finder information; ignored}
   myRefNum:   Integer; {file reference number}
CONST
   kPrefID = 128;       {resource ID of STR# with filename}
BEGIN
   {Determine the name of the preferences file.}
   GetIndString(myName, kPrefID, 1);
   
   {Find the Preferences folder in the System Folder.}
   myErr := FindFolder(kOnSystemDisk, kPreferencesFolderType,
                      kDontCreateFolder, myVRef, myDirID);
   IF myErr = noErr THEN
      myErr := FSMakeFSSpec(myVRef, myDirID, myName, mySpec);
   IF myErr = noErr THEN
      myRefNum := FSpOpenResFile(mySpec, fsCurPerm);
   
   {Read your preference settings here.}

   CloseResFile(myRefNum);
END;
</PRE>
 The <CODE>DoGetPreferences</CODE> procedure first determines the name of the preferences file it is to open and read. To allow easy localization, you should store the name in a resource of type <CODE>'STR#'</CODE> in your application's resource file. The <CODE>DoGetPreferences</CODE> procedure assumes that the name is stored as the first string in the resource having ID <CODE>kPrefID</CODE>.<P>
 The technique shown here assumes that your preference settings can all be stored in resources. As a result, <A HREF=#MARKER-9-229>Listing 1-18</A> calls the Resource Manager function <CODE>FSpOpenResFile</CODE> to open the resource fork of your preferences file. See the chapter "Resource Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I> for complete details on opening resource files and reading resources from them.<A NAME=MARKER-2-14></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-29.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-31.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
