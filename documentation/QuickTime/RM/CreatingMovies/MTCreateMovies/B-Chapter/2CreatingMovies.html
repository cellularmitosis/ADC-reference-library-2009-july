<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Movie Creation Guide: Creating Movies</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating Movies"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies" title="Creating Movies"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../MovieCreation-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000501" target="_top">Movie Creation</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000906-IntroductiontoQuickTimeMovieCreationGuide-DontLinkElementID_142">QuickTime Movie Creation Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../A-Intro/1Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../C-Chapter/3SequenceGrabberComp.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-SW1" title="Creating Movies"></a>
<h1>Creating Movies</h1>

<p>This chapter describes QuickTime movies and shows you how to create a new movie using the QuickTime Movie Toolbox. A sample program is given, detailing the necessary steps: creating and opening a file to hold the movie, creating the tracks and media structures for audio and video, adding sample data, and adding movie resources to the file. Read this section to see a sample program that will step you through the procedure in tutorial fashion.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_4">Movie Structures</a>
				
			<br/>
			
        
			
			
				<a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_7">QuickTime Movie Characteristics</a>
				
			<br/>
			
        
			
			
				<a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_13">Audio Properties</a>
				
			<br/>
			
        
			
			
				<a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_17">Sample Programs</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_4" title="Movie Structures"></a>
<h2><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-MovieStructures" title="Movie Structures"></a>Movie Structures</h2>
<p>QuickTime movies have a time dimension defined by a time scale and a duration, which are specified by a time coordinate system.  Figure 1-1 illustrates a movie’s time coordinate system. A movie always starts at time 0. The <strong>time</strong> <strong>scale</strong> defines the unit of measure for the movie’s time values. The <strong>duration</strong> specifies how long the movie lasts.</p>
<br/><div><img src = "../Art/time_coord_system.jpg" alt = "A movie's time coordinate system" ></div><br/>
<p>A movie can contain one or more tracks. Each track refers to media data that can be interpreted within the movie’s time coordinate system. Each track begins at the beginning of the movie; however, a track can end at any time. In addition, the actual data in the track may be offset from the beginning of the movie. Tracks with data that does not commence at the beginning of a movie contain empty space that precedes the track data.</p>
<p>At any given point in time, one or more tracks may or may not be enabled.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_144" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
Throughout this book, the term <em>enabled</em> <em>track</em> denotes a track that may become activated if the movie time intersects the track. An enabled track refers to a media that in turn refers to media data.  </p>
</div>
<p>However, no single track needs to be enabled during the entire movie. As you move through a movie, you gain access to the data that is described by each of the enabled tracks.  Figure 1-2 shows a movie that contains five tracks. The lighter shading in each track represents the time offset between the beginning of the movie and the start of the track’s data (this lighter shading corresponds to empty space at the beginning of these tracks). When the movie’s time value is 6, there are three enabled tracks: Video 1 and Audio 1, and Video 2, which is just being enabled. The Other 1 track does not become enabled until the time value reaches 8. The Audio 2 track becomes enabled at time value 10.</p>
<p>A movie can contain one or more <strong>layers.</strong> Each layer contains one or more tracks that may be related to one another. The Movie Toolbox builds up a movie’s visual representation layer by layer. In  Figure 1-2, for example, if the images contained in the Video 1 and Video 2 tracks overlap spatially, the user sees the image that is stored in the front layer. You can assign individual tracks to movie layers using Movie Toolbox functions that are described in <em><a href="../../../MovieInternals/MTTimeSpace/index.html#//apple_ref/doc/uid/TP40000911" target="_top">QuickTime Movie Internals Guide</a></em>.</p>
<br/><div><img src = "../Art/movie_cont_tracks.jpg" alt = "A movie containing several tracks" ></div><br/>
<p>The Movie Toolbox allows you to define both a movie preview and a movie poster for a QuickTime movie. A <strong>movie</strong> <strong>preview</strong> is a short dynamic representation of a movie. Movie previews typically last no more than 3 to 5 seconds, and they should give the user some idea of what the movie contains. (An example of a movie preview is a narrative track.) You define a movie preview by specifying its start time, its duration, and its tracks. A movie may contain tracks that are used only in its preview.</p>
<p>A <strong>movie</strong> <strong>poster</strong> is a single visual image representing the movie. You specify a poster as a point in time in the movie. As with the movie itself and the movie preview, you define which tracks are enabled in the movie poster.</p>
<p>Figure 1-3 shows an example of a movie’s tracks. The video track is used for the movie, the preview, and the poster. The movie audio track is used only for the movie. The preview audio track is used only for the preview. The poster graphic track is used only for the poster.</p>
<br/><div><img src = "../Art/movie_prev_poster.jpg" alt = "A movie, its preview, and its poster" ></div><br/>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_5" title="Tracks"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-Tracks" title="Tracks"></a>Tracks</h3>
<p>A movie can contain one or more tracks. Each track represents a single stream of data in a movie and is associated with a single media. The media has control information that refers to the actual movie data.</p>
<p>All of the tracks in a movie use the movie’s time coordinate system. That is, the movie’s time scale defines the basic time unit for each of the movie’s tracks. Each track begins at the beginning of the movie, but the track’s data might not begin until some time value other than 0. This intervening time is represented by blank space. In an audio track the blank space translates to silence; in a video track the blank space generates no visual image. Each track has its own duration. This duration need not correspond to the duration of the movie. Movie duration always equals the maximum duration of all the tracks. An example of this is shown in  Figure 1-4.</p>
<br/><div><img src = "../Art/track_in_movie.jpg" alt = "A track in a movie" ></div><br/>
<p>A track is always associated with one media. The media contains control information that refers to the data that constitutes the track. The track contains a list of references that identify portions of the media that are used in the track. In essence, these references are an edit list of the media. Consequently, a track can play the data in its media in any order and any number of times.  Figure 1-5 shows how a track maps data from a media into a movie.</p>
<br/><div><img src = "../Art/track_and_media.jpg" alt = "A track and its media" ></div><br/>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_6" title="Media Structures"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-MediaStructures" title="Media Structures"></a>Media Structures</h3>
<p>A media describes the data for a track. The data is not actually stored in the media. Rather, the media contains references to its media data, which may be stored in disk files, on CD-ROM discs, or other appropriate storage devices. Note that the data referred to by one media may be used by more than one movie, though the media itself is not reused.</p>
<p>Each media has its own time coordinate system, which defines the media’s time scale and duration. A media’s time coordinate system always starts at time 0, and it is independent of the time coordinate system of the movie that uses its data. Tracks map data from the movie’s time coordinate system to the media’s time coordinate system. Figure 1-6 shows how tracks perform this mapping.</p>
<p>Each supported data type has its own <strong>media</strong> <strong>handler.</strong> The media handler interprets the media’s data. The media handler must be able to randomly access the data and play segments at rates specified by the movie. The track determines the order in which the media is played in the movie and maps movie time values to media time values.</p>
<p>Figure 1-6 shows the final link to the data. The media in the figure references digital video frames on a CD-ROM disc.</p>
<br/><div><img src = "../Art/media_and_data.jpg" alt = "A media and its data" ></div><br/>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_7" title="QuickTime Movie Characteristics"></a>
<h2><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-QuickTimeMovieCharacteristics" title="QuickTime Movie Characteristics"></a>QuickTime Movie Characteristics</h2>
<p>This section discusses the characteristics that govern playing and storing movies, tracks, and media structures. This section has been divided into the following topics:</p>
<ul class="ul">
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-MovieCharacteristics">Movie Characteristics</a></span> discusses the time, display, and sound characteristics of a QuickTime movie.</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-TrackCharacteristics">Track Characteristics</a></span> describes the characteristics of a movie track.</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-MediaCharacteristics">Media Characteristics</a></span> discusses the characteristics of a media.</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-SpatialProperties">Spatial Properties</a></span> describes how the Movie Toolbox displays a movie, including how the data from each media is collected and transformed prior to display.</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-TheTransformationMatrix">The Transformation Matrix</a></span> describes how matrix operations transform visual elements prior to display.</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-AudioProperties">Audio Properties</a></span> describes how the Movie Toolbox works with a movie’s sound tracks.</p></li>
</ul>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_8" title="Movie Characteristics"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-MovieCharacteristics" title="Movie Characteristics"></a>Movie Characteristics</h3>
<p>A QuickTime movie is represented as a private data structure. Your application never works with individual fields in that data structure. Rather, the Movie Toolbox provides functions that allow you to work with a movie’s characteristics.  Figure 1-7 shows some of the characteristics of a QuickTime movie.</p>
<br/><div><img src = "../Art/movie_characteristics.jpg" alt = "General movie characteristics" ></div><br/>
<p>Every QuickTime movie has some state information, including a creation time and a modification time. These times are expressed in standard Macintosh time format, representing the number of seconds since midnight, January 1, 1904. The creation time indicates when the movie was created. The modification time indicates when the movie was last modified and saved.</p>
<p>Each movie has its own time coordinate system and time scale. Any time values that relate to the movie must be defined using this time scale and must be between 0 and the movie’s duration.</p>
<p>A movie’s preview is defined by its starting time and duration. Both of these time values are expressed in terms of the movie’s time scale. A movie’s poster is defined by its time value, which is in terms of the movie’s time scale. You assign tracks to the movie preview and the movie poster by calling the Movie Toolbox functions that are described later in this chapter.</p>
<p>Your current position in a movie is defined by the movie’s <strong>current</strong> <strong>time.</strong> If the movie is currently playing, this time value is changing. When you save a movie in a movie file, the Movie Toolbox updates the movie’s current time to reflect its current position. When you load a movie from a movie file, the Movie Toolbox sets the movie’s current time to the value found in the movie file.</p>
<p>The Movie Toolbox provides high-level editing functions that work with a movie’s <strong>current</strong> <strong>selection.</strong> The current selection defines a segment of the movie by specifying a start time, referred to as the <strong>selection</strong> <strong>time,</strong> and a duration, called the <strong>selection</strong> <strong>duration.</strong> These time values are expressed using the movie’s time scale.</p>
<p>For each movie currently in use, the Movie Toolbox maintains an <strong>active</strong> <strong>movie</strong> <strong>segment.</strong> The active movie segment is the part of the movie that your application is interested in playing. By default, the active movie segment is set to be the entire movie. You may wish to change this to be some segment of the movie; for example, if you wish to play a user’s selection repeatedly. By setting the active movie segment, you guarantee that the Movie Toolbox uses no samples from outside of that range while playing the movie.</p>
<p>A movie’s display characteristics are specified by a number of elements. The movie has a movie clipping region and a 3-by-3 transformation matrix. The Movie Toolbox uses these elements to determine the spatial characteristics of the movie. See <span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-SpatialProperties">Spatial Properties</a></span> for a complete description of these elements and how they are used by the Movie Toolbox.</p>
<p>When you save a movie, you can establish preferred settings for playback rate and volume. The preferred playback rate is called the <strong>preferred</strong> <strong>rate.</strong> The preferred playback volume is called the <strong>preferred</strong> <strong>volume.</strong> These settings represent the most natural values for these movie characteristics. When the Movie Toolbox loads a movie from a movie file, it sets the movie’s volume to this preferred value. When you start playing the movie, the Movie Toolbox uses the preferred rate. You can then use Movie Toolbox functions to change the rate and volume during playback.</p>
<p>The Movie Toolbox allows your application to store its own data along with a movie. You define the format and content of these data objects. This application-specific data is called <strong>user</strong> <strong>data.</strong> You can use these data objects to store both text and binary data. For example, you can use text user data items to store a movie’s copyright and credit information. The Movie Toolbox provides functions that allow you to set and retrieve a movie’s user data. This data is saved with the movie when you save the movie.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_9" title="Track Characteristics"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-TrackCharacteristics" title="Track Characteristics"></a>Track Characteristics</h3>
<p>A QuickTime track is represented as a private data structure. Your application never works with individual fields in that data structure. Rather, the Movie Toolbox provides functions that allow you to work with a track’s characteristics.  Figure 1-8 shows the characteristics of a QuickTime track.</p>
<br/><div><img src = "../Art/track_characteristics.jpg" alt = "Track characteristics" ></div><br/>
<p>As with movies, each track has some state information, including a creation time and a modification time. These times are expressed in standard Macintosh time format, representing the number of seconds since midnight, January 1, 1904. The creation time indicates when the track was created. The modification time indicates when the track was last modified and saved.</p>
<p>Each track has its own duration value, which is expressed in the time scale of the movie that contains the track.</p>
<p>As has been discussed, movies can contain more than one track. In fact, a movie can contain more than one track of a given type. You might want to create a movie with several sound tracks, each in a different language, and then activate the sound track that is appropriate to the user’s native language. Your application can manage these collections of tracks by assigning each track of a given type to an <strong>alternate</strong> <strong>group.</strong> You can then choose one track from that group to be enabled at any given time. You can select a track from an alternate group based on its language or its <strong>playback</strong> <strong>quality.</strong>  A track’s playback quality indicates its suitability for playback in a given environment. All tracks in an alternate group should refer to the same type of data.</p>
<p>A track’s display characteristics are specified by a number of elements, including track width, track height, a transformation matrix, and a clipping region. See <span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-SpatialProperties">Spatial Properties</a></span> for a complete description of these elements and how they are used by the Movie Toolbox.</p>
<p>Each track has a current volume setting. This value controls how loudly the track plays relative to the movie volume.</p>
<p>Each track contains a media edit list. The edit list contains entries that define how the track’s media is to be used in the movie that contains the track. Each entry in the edit list indicates the starting time and duration of the media segment, along with the playback rate for that segment.</p>
<p>Each track has an associated media. See the next section for more information about media structures and their characteristics.</p>
<p>The Movie Toolbox allows your application to store its own user data along with a track. You define the format and content of these data objects. The Movie Toolbox provides functions that allow you to set and retrieve a track’s user data. This data is saved with the track when you save the movie.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_10" title="Media Characteristics"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-MediaCharacteristics" title="Media Characteristics"></a>Media Characteristics</h3>
<p>As is the case with movies and tracks, a QuickTime media is represented as a private data structure. Your application never works with individual fields in that data structure. Rather, the Movie Toolbox provides functions that allow you to work with a media’s characteristics. Figure 1-9 shows the characteristics of a QuickTime media.</p>
<br/><div><img src = "../Art/media_characteristics.jpg" alt = "Media characteristics" ></div><br/>
<p>Each QuickTime media has some state information, including a creation time and a modification time. These times are expressed in standard Macintosh time format, representing the number of seconds since midnight, January 1, 1904. The creation time indicates when the media was created. The modification time indicates when the media was last modified and saved.</p>
<p>Each media has its own time coordinate system, which is defined by its time scale and duration. Any time values that relate to the media must be defined in terms of this time scale and must be between 0 and the media’s duration.</p>
<p>A media contains information that identifies its language and playback quality. These values are used when selecting one track to present from the tracks in an alternate group.</p>
<p>The media specifies a media handler, which is responsible for the details of loading, storing, and playing media data. The media handler can store state information in the media. This information is referred to as <strong>media</strong> <strong>information.</strong> The media information identifies where the media’s data is stored and how to interpret that data. Typically, this data is stored in a <strong>data</strong> <strong>reference,</strong> which identifies the file that contains the data and the type of data that is stored in the file.</p>
<p>The Movie Toolbox allows your application to store its own user data along with a media. You define the format and content of these data objects. The Movie Toolbox provides functions that allow you to set and retrieve a media’s user data. This data is saved with the media when you save the movie.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_11" title="Spatial Properties"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-SpatialProperties" title="Spatial Properties"></a>Spatial Properties</h3>
<p>When you play a movie that contains visual data, the Movie Toolbox gathers the movie’s data from the appropriate tracks and media structures, transforms the data as appropriate, and displays the results in a window. The Movie Toolbox uses only those tracks that</p>
<ul class="spaceabove">
<li class="li"><p>are not empty</p></li>
<li class="li"><p>contain media structures that reference data at a specified time</p></li>
<li class="li"><p>are enabled in the current movie mode (standard playback, poster mode, or preview mode)</p></li>
</ul>
<p>Consequently, the size, shape, and location of many of these regions may change during movie playback.   This process is quite complicated and involves several phases of clipping and resizing.</p>
<p>The Movie Toolbox shields you from the intricacies of this process by providing two high-level functions, <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/GetMovieBox" target="_top">GetMovieBox</a></code> and <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/SetMovieBox" target="_top">SetMovieBox</a></code>, which allow you to place a movie box at a specific location in the display coordinate system. When you use these functions, the Movie Toolbox automatically adjusts the contents of the movie’s matrix to satisfy your request.</p>
<p>Figure 1-10 provides an overview of the entire process of gathering, transforming, and displaying visual data. Each track defines its own spatial characteristics, which are then interpreted within the context of the movie’s spatial characteristics.</p>
<p>This section describes the process that the Movie Toolbox uses to display a movie. The process begins with the movie data and ends with the final movie display. The phases, which are described in this section, include</p>
<ul class="spaceabove">
<li class="li"><p>the creation of a track rectangle (see Figure 1-11)</p></li>
<li class="li"><p>the clipping of a track’s image (see Figure 1-12)</p></li>
<li class="li"><p>the transformation of a track into the movie coordinate system (see Figure 1-13)</p></li>
<li class="li"><p>the clipping of a movie image (see Figure 1-14)</p></li>
<li class="li"><p>the transformation of a movie into the display coordinate system (see Figure 1-15)</p></li>
<li class="li"><p>the clipping of a movie for final display (see Figure 1-16)</p></li>
</ul>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_145" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
Throughout this book, the term <em>time</em> <em>coordinate</em> <em>system</em> denotes QuickTime’s time-based system. All other instances of the term <em>coordinate</em> <em>system</em> refer to graphic coordinates. </p>
</div>
<br/><div><img src = "../Art/spatial_process_movie.jpg" alt = "Spatial processing of a movie and its tracks" ></div><br/>
<p>Each track defines a rectangle into which its media is displayed. This rectangle is referred to as the <strong>track</strong> <strong>rectangle,</strong> and it is defined by the <strong>track</strong> <strong>width</strong> and <strong>track</strong> <strong>height</strong> values assigned to the track. The upper-left corner of this rectangle defines the origin point of the track’s <em>coordinate</em> <em>system.</em></p>
<p>The media handler associated with the track’s media is responsible for displaying an image into this rectangle. This process is shown in Figure 1-11.</p>
<br/><div><img src = "../Art/track_rectangle.jpg" alt = "A track rectangle" ></div><br/>
<p>The Movie Toolbox next mattes the image in the track rectangle by applying the track matte and the track clipping region. This does not affect the shape of the image; only the display. Both the track matte and the track clipping region are optional.</p>
<p>A <strong>track</strong> <strong>matte</strong> provides a mechanism for mixing images. Mattes contain several bits per pixel and are defined in the track’s coordinate system. The matte can be used to perform a  deep-mask operation on the image in the track rectangle. The Movie Toolbox displays the weighted average of the track and its destination based on the corresponding pixel value in the matte.</p>
<p>The <strong>track</strong> <strong>clipping</strong> <strong>region</strong> is a QuickDraw region that defines a portion of the track rectangle to retain. The track clipping region is defined in the track’s coordinate system. This clipping operation creates the <strong>track</strong> <strong>boundary</strong> <strong>region,</strong> which is the intersection of the track rectangle and the track clipping region.</p>
<p>This process and its results are shown in Figure 1-12.</p>
<br/><div><img src = "../Art/clipping_track_image.jpg" alt = "Clipping a track's image" ></div><br/>
<p>After clipping and matting the track’s image, the Movie Toolbox transforms the resulting image into the movie’s coordinate system. The Movie Toolbox uses a 3-by-3 transformation matrix to accomplish this operation (see <span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-TheTransformationMatrix">The Transformation Matrix</a></span> for a discussion of matrix operations in the Movie Toolbox). The image inside the track boundary region is transformed by the track’s matrix into the movie coordinate system. The resulting area is bounded by the <strong>track</strong> <strong>movie</strong> <strong>boundary</strong> <strong>region.</strong> Figure 1-13 shows the results of this transformation operation.</p>
<br/><div><img src = "../Art/track_trans_movie_coord.jpg" alt = "A track transformed into a movie coordinate system" ></div><br/>
<p>The Movie Toolbox performs this portion of the process for each track in the movie. Once all of the movie’s tracks have been processed, the Movie Toolbox proceeds to transform the complete movie image for display.</p>
<p>The union of all track movie boundary regions for a movie defines the movie’s <strong>movie</strong> <strong>boundary</strong> <strong>region.</strong> The Movie Toolbox combines a movie’s tracks into this single region where layers are applied. Therefore, tracks in back layers may be partially or completely obscured by tracks in front layers. The Movie Toolbox clips this region to obtain the <strong>clipped</strong> <strong>movie</strong> <strong>boundary</strong> <strong>region.</strong> The movie’s <strong>movie</strong> <strong>clipping</strong> <strong>region</strong> defines the portion of the movie boundary region that is to be used. Figure 1-14 shows the process by which a movie is clipped and the resulting clipped movie boundary region.</p>
<br/><div><img src = "../Art/clipping_movie_image.jpg" alt = "Clipping a movie's image" ></div><br/>
<p>After clipping the movie’s image, the Movie Toolbox transforms the resulting image into the display coordinate system. The Movie Toolbox uses a 3-by-3 transformation matrix to accomplish this operation (see <span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-TheTransformationMatrix">The Transformation Matrix</a></span> for a complete discussion of matrix operations in the Movie Toolbox). The image inside the clipped movie boundary region is transformed by the movie’s matrix into the display coordinate system. The resulting area is bounded by the movie display boundary region. Figure 1-15 shows the results of this step.</p>
<br/><div><img src = "../Art/movie_trans_disp_coord.jpg" alt = "A movie transformed to the display coordinate system" ></div><br/>
<p>The rectangle that encloses the movie display boundary region is called the <strong>movie</strong> <strong>box,</strong> as shown in Figure 1-16. You can control the location of a movie’s movie box by adjusting the movie’s transformation matrix.</p>
<br/><div><img src = "../Art/clipping_final_display.jpg" alt = "Clipping a movie for final display" ></div><br/>
<p>Once the movie is in the <strong>display</strong> <strong>coordinate</strong> <strong>system</strong> (that is, the QuickDraw graphics world), the Movie Toolbox performs a final clipping operation to generate the image that is displayed. The movie is clipped with the <strong>movie</strong> <strong>display</strong> <strong>clipping</strong> <strong>region.</strong> When a movie is displayed, the Movie Toolbox ignores the graphics port’s clipping region; this is why there is a movie display clipping region. Figure 1-16 shows this operation.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_12" title="The Transformation Matrix"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-TheTransformationMatrix" title="The Transformation Matrix"></a>The Transformation Matrix</h3>
<p>The Movie Toolbox makes extensive use of transformation matrices to define graphical operations that are performed on movies when they are displayed. A <strong>transformation</strong> <strong>matrix</strong> defines how to map points from one coordinate space into another coordinate space. By modifying the contents of a transformation matrix, you can perform several standard graphical display operations, including translation, rotation, and scaling. The Movie Toolbox provides a set of functions that make it easy for you to manipulate translation matrices. Those functions are discussed in <em><a href="../../../MovieInternals/MTTimeSpace/index.html#//apple_ref/doc/uid/TP40000911" target="_top">QuickTime Movie Internals Guide</a></em>. The remainder of this section provides an introduction to matrix operations in a graphical environment.</p>
<p>The matrix used to accomplish two-dimensional transformations is described mathematically by a 3-by-3 matrix. Figure 1-17 shows a sample 3-by-3 matrix. Note that QuickTime assumes that the values of the matrix elements <em>u</em> and <em>v</em> are always 0.0, and the value of matrix element <em>w</em> is always 1.0.</p>
<br/><div><img src = "../Art/point_trans_3x3_matrix.jpg" alt = "A point transformed by a 3-by-3 matrix" ></div><br/>
<p>During display operations, the contents of a 3-by-3 matrix transform a point (x,y) into a point (x',y') by means of the following equations:</p>
<p>x' = ax + cy + t(x)</p>
<p>y' = bx + dy + t(y)</p>
<p>For example, the matrix shown in Figure 1-18 performs no transformation. It is referred to as the <strong>identity</strong> <strong>matrix.</strong></p>
<br/><div><img src = "../Art/identity_matrix.jpg" alt = "The identity matrix" ></div><br/>
<p>Using the formulas discussed earlier, you can see that this matrix would generate a new point (x',y') that is the same as the old point (x,y):</p>
<p>x'  = 1x + 0y + 0</p>
<p>y'  = 0x + 1y + 0</p>
<p>x' = y and y' = y</p>
<p>In order to move an image by a specified displacement, you perform a translation operation. This operation modifies the x and y coordinates of each point by a specified amount. The matrix shown in  Figure 1-19 describes a translation operation.</p>
<br/><div><img src = "../Art/translation_matrix.jpg" alt = "A matrix that describes a translation operation" ></div><br/>
<p>You can stretch or shrink an image by performing a scaling operation. This operation modifies the x and y coordinates by some factor. The magnitude of the x and y factors governs whether the new image is larger or smaller than the original. In addition, by making the x factor negative, you can flip the image about the x-axis; similarly, you can flip the image horizontally, about the y-axis, by making the y factor negative. The matrix shown in Figure 1-20 describes a scaling operation.</p>
<br/><div><img src = "../Art/scaling_matrix.jpg" alt = "A matrix that describes a scaling operation" ></div><br/>
<p>Finally, you can rotate an image by a specified angle by performing a rotation operation. You specify the magnitude and direction of the rotation by specifying factors for both x and y. The matrix shown in Figure 1-21 rotates an image counterclockwise by an angle <em>q.</em></p>
<br/><div><img src = "../Art/rotation_matrix.jpg" alt = "A matrix that describes a rotation operation" ></div><br/>
<p>You can combine matrices that define different transformations into a single matrix. The resulting matrix retains the attributes of both transformations. For example, you can both scale and translate an image by defining a matrix similar to that shown in Figure 1-22.</p>
<br/><div><img src = "../Art/scale_translate_matrix.jpg" alt = "A matrix that describes a scaling and translation operation" ></div><br/>
<p>You combine two matrices by concatenating them. Mathematically, the two matrices are combined by matrix multiplication. Note that the order in which you concatenate matrices is important; matrix operations are not commutative.</p>
<p>Transformation matrices used by the Movie Toolbox contain the following data types:</p>

<div class="codesample"><table><tr><td scope="row"><pre>[0] [0] Fixed       [1] [0] Fixed       [2] [0] Fract<span></span></pre></td></tr><tr><td scope="row"><pre>[0] [1] Fixed       [1] [1] Fixed       [2] [1] Fract<span></span></pre></td></tr><tr><td scope="row"><pre>[0] [2] Fixed       [1] [2] Fixed       [2] [2] Fract<span></span></pre></td></tr></table></div>

<p>Each cell in this table represents the data type of the corresponding element of a 3-by-3 matrix. All of the elements in the first two columns of a matrix are represented by <code>Fixed</code> values. Values in the third column are represented as <code>Fract</code> values. The <code>Fract</code> data type specifies a 32-bit, fixed-point value that contains 2 integer bits and 30 fractional bits. This data type is useful for accurately representing numbers in the range from -2 to 2.</p>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_13" title="Audio Properties"></a>
<h2><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-AudioProperties" title="Audio Properties"></a>Audio Properties</h2>
<p>This section discusses the sound capabilities of QuickTime and the Movie Toolbox. It has been divided into the following topics:</p>
<ul class="ul">
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-SoundPlayback">Sound Playback</a></span> discusses the playback capabilities of the Movie Toolbox</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-AddingSoundtoVideo">Adding Sound to Video</a></span> discusses several issues you should consider when creating movies that contain both sound and video</p></li>
<li class="li"><p><span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-SoundDataFormats">Sound Data Formats</a></span> describes the formats the Movie Toolbox uses to store sound information</p></li>
</ul>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_14" title="Sound Playback"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-SoundPlayback" title="Sound Playback"></a>Sound Playback</h3>
<p>As is the case with video data, QuickTime movies store sound information in tracks. QuickTime movies may have one or more sound tracks. The Movie Toolbox can play more than one sound at a time by mixing the enabled sound tracks together during playback. This allows you to put together movies with separate music and voice tracks. You can then manipulate the tracks separately but play them together. You can also use multiple sound tracks to store different languages.</p>
<p>There are two main attributes of sound in QuickTime movies: volume and balance. You can control these attributes using the facilities of the Movie Toolbox.</p>
<p>Every QuickTime movie has a current volume setting. This volume setting controls the loudness of the movie’s sound. You can adjust a movie’s current volume by calling the  <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/SetMovieVolume" target="_top">SetMovieVolume</a></code> function. In addition, you can set a preferred volume setting for a movie. This value represents the best volume for the movie. The Movie Toolbox saves this value when you store a movie into a movie file. The value of the current volume is lost. You can set a movie’s preferred volume by calling the  <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/SetMoviePreferredVolume" target="_top">SetMoviePreferredVolume</a></code> function. When you load a movie from a movie file, the Movie Toolbox sets the movie’s current volume to the value of its preferred volume.</p>
<p>Each track in a movie also has a volume setting. A track’s volume governs its loudness relative to other tracks in the movie. You can set a track’s volume by calling the  <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/SetTrackVolume" target="_top">SetTrackVolume</a></code> function.</p>
<p>In the Movie Toolbox, movie and track volumes are represented as 16-bit, fixed-point numbers that range from -1.0 to +1.0. The high-order 8 bits contain the integer portion of the value; the low-order 8 bits contain the fractional part. Positive values denote volume settings, with 1.0 corresponding to the maximum volume on the user’s computer. Negative values are muted, but retain the magnitude of the volume setting so that, by toggling the sign of a volume setting, you can turn off the sound and then turn it back on at the previous level (something like pressing the mute button on a radio).</p>
<p>A track’s volume is scaled to a movie’s volume, and the movie’s volume is scaled to the value the user specifies for speaker volume using the Sound control panel. That is, a movie’s volume setting represents the maximum loudness of any track in the movie. If you set a track’s volume to a value less than 1.0, that track plays proportionally quieter, relative to the loudness of other tracks in the movie.</p>
<p>Each track in a movie has its own balance setting. The balance setting controls the mix of sound between a computer’s two speakers. If the source sound is monaural, the balance setting controls the relative loudness of each speaker. If the source sound is stereo, the balance setting governs the mix of the right and left channels. You can set the balance for a track’s media by calling the <code>SetSoundMediaBalance</code> function. When you save the movie, the balance setting is stored in the movie file.</p>
<p>In the Movie Toolbox, balance values are represented as 16-bit, fixed-point numbers that range from -1.0 to +1.0. The high-order 8 bits contain the integer portion of the value; the low-order 8 bits contain the fractional part. Negative values weight the balance toward the left speaker; positive values emphasize the left channel. Setting the balance to 0 corresponds to a neutral setting.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_15" title="Adding Sound to Video"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-AddingSoundtoVideo" title="Adding Sound to Video"></a>Adding Sound to Video</h3>
<p>Most QuickTime movies contain both sound data and video data. If you are creating an application that plays movies, you do not need to worry about the details of how sound is stored in a movie. However, if you are developing an application that creates movies, you need to consider how you store the sound and video data.</p>
<p>There are two ways to store sound data in a QuickTime movie. The simplest method is to store the sound track as a continuous stream. When you play a movie that has its sound in this form, the Movie Toolbox loads the entire sound track into memory, and then reads the video frames when they are needed for display. While this technique is very efficient, it requires a large amount of memory to store the entire sound, which limits the length of the movie. This technique also requires a large amount of time to read in the entire sound track before the movie can start playing. For this reason, this technique is only recommended when the sound for a movie is fairly small (less than 64 KB).</p>
<p>For larger movies, a technique called <strong>interleaving</strong> must be used so that the sound and video data may be alternated in small pieces, and the data can be read off disk as it is needed. Interleaving allows for movies of almost any length with little delay on startup. However, you must tune the storage parameters to avoid a lower video frame rate and breaks in the sound that result when sound data is read from slow storage devices. In general, the Movie Toolbox hides the details of interleaving from your application. The <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/FlattenMovie" target="_top">FlattenMovie</a></code> and <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/FlattenMovieData" target="_top">FlattenMovieData</a></code> functions allow you to enable and disable interleaving when you create a movie. These functions then interact with the appropriate media handler to correctly interleave the sound and video data for your movie.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_16" title="Sound Data Formats"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-SoundDataFormats" title="Sound Data Formats"></a>Sound Data Formats</h3>
<p>The Movie Toolbox stores sound data in sound tracks as a series of digital samples. Each sample specifies the amplitude of the sound at a given point in time, a format commonly known as <em>linear</em> <em>pulse-code</em> <em>modulation</em> (linear PCM). The Movie Toolbox supports both monaural and stereo sound. For monaural sounds, the samples are stored sequentially, one after another. For stereo sounds, the samples are stored interleaved in a left/right/left/right fashion.</p>
<p>In order to support a broad range of audio data formats, the Movie Toolbox can accommodate a number of different sample encoding formats, sample sizes, sample rates, and compression algorithms. The following paragraphs discuss the details of each of these attributes of movie sound data.</p>
<p>The Movie Toolbox supports two techniques for encoding the amplitude values in a sample: offset-binary and twos-complement. <strong>Offset-binary</strong> <strong>encoding</strong> represents the range of amplitude values as an unsigned number, with the midpoint of the range representing silence. For example, an 8-bit sample stored in offset-binary format would contain sample values ranging from 0 to 255, with a value of 128 specifying silence (no amplitude). Samples in Macintosh sound resources are stored in offset-binary form.</p>
<p><strong>Twos-complement</strong> <strong>encoding</strong> stores the amplitude values as a signed number; in this case silence is represented by a sample value of 0. Using the same 8-bit example, twos-complement values would range from -128 to 127, with 0 meaning silence. The Audio Interchange File Format (AIFF) used by the Sound Manager stores samples in twos-complement form, so it is common to see this type of sound in QuickTime movies.</p>
<p>The Movie Toolbox allows you to store information about the sound data in the sound description. See <span class="content_text"><a href="2CreatingMovies.html#//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingaSoundDescriptionStructure">Creating a Sound Description Structure</a></span> for details of the sound description structure. Sample size indicates the number of bits used to encode the amplitude value for each sample. The size of a sample determines the quality of the sound, since more bits can represent more amplitude values. The basic Macintosh sound hardware supports only 8-bit samples, but the Sound Manager also supports 16-bit and 32-bit sample sizes. The Movie Toolbox plays these larger samples on 8-bit Macintosh hardware by converting the samples to 8-bit format before playing them.</p>
<p>Sample rate indicates the number of samples captured per second. The sample rate also influences the sound quality, because higher rates can more accurately capture the original sound waveform. The basic Macintosh hardware supports an output sampling rate of 22.254 kHz. The Movie Toolbox can support any rate up to 65.535 kHz; as with sample size, the Movie Toolbox converts higher sample rates to rates that can be accommodated by the Macintosh hardware when it plays the sound.</p>
<p>In addition to these sample encoding formats, the Movie Toolbox also supports the Macintosh Audio Compression and Expansion ( MACE) capability of the Sound Manager. This allows compression of the sound data at ratios of 3 to 1 or 6 to 1. Compressing a movie’s sound can yield significant savings in storage and RAM space, at the cost of somewhat lower quality and higher CPU overhead on playback.</p>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_17" title="Sample Programs"></a>
<h2><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-SamplePrograms" title="Sample Programs"></a>Sample Programs</h2>
<p>Creating a movie involves several steps. You must first create and open the movie file that is to contain the movie. You then create the tracks and media structures for the movie. You then add samples to the media structures. Finally, you add the movie resource to the movie file. The sample program in this section, <code>CreateWayCoolMovie</code>, demonstrates this process.</p>
<p>This program has been divided into several segments. The main segment, <code>CreateMyCoolMovieMovie</code> Toolbox, creates and opens the movie file, then invokes other functions to create the movie itself. Once the data has been added to the movie, this function saves the movie in its movie file and closes the file.</p>
<p>The <code>CreateMyCoolMovie</code> function uses the <code>CreateMyVideoTrack</code>  and <code>CreateMySoundTrack</code> functions to create the movie’s tracks. The <code>CreateMyVideoTrack</code> function creates the video track and the media that contains the track’s data. It then collects sample data in the media by calling the <code>AddVideoSamplesToMedia</code> function. Note that this function uses the Image Compression Manager. The <code>CreateMySoundTrack</code> function creates the sound track and the media that contains the sound. It then collects sample data by calling the <code>AddSoundSamplesToMedia</code> function.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_18" title="Main Function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-MainFunction" title="Main Function"></a>Main Function</h3>
<p>The <code>CreateWayCoolMovie</code> program consists of a number of segments, many of which are not included in this sample. Omitted segments deal with general initialization logic and other common aspects of Macintosh programming. The main function, shown in Listing 1-1, shows you how to initialize various parts of the Movie Toolbox and call the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/EnterMovies" target="_top">EnterMovies</a></code> function.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_146" title="Listing 1-1Creating a movie: the main program"></a>
<p class="codesample"><strong>Listing 1-1&nbsp;&nbsp;</strong>Creating a movie: the main program</p>
<div class="codesample"><table><tr><td scope="row"><pre>#include &lt;Types.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Traps.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Menus.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Memory.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Errors.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Fonts.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;QuickDraw.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Resources.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;GestaltEqu.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;FixMath.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Sound.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;string.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include "Movies.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include "ImageCompression.h"<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>void CheckError(OSErr error, Str255 displayString)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        if (error == noErr) return;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (displayString[0] > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>            DebugStr(displayString);<span></span></pre></td></tr><tr><td scope="row"><pre>        ExitToShell();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void InitMovieToolbox (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        OSErr   err;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>        InitGraf (&amp;qd.thePort);<span></span></pre></td></tr><tr><td scope="row"><pre>        InitFonts ();<span></span></pre></td></tr><tr><td scope="row"><pre>        InitWindows ();<span></span></pre></td></tr><tr><td scope="row"><pre>        InitMenus ();<span></span></pre></td></tr><tr><td scope="row"><pre>        TEInit ();<span></span></pre></td></tr><tr><td scope="row"><pre>        InitDialogs (nil);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = EnterMovies ();<span></span></pre></td></tr><tr><td scope="row"><pre>        CheckError (err, "\pEnterMovies" );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void main( void )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        InitMovieToolbox ();<span></span></pre></td></tr><tr><td scope="row"><pre>        CreateMyCoolMovie ();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_19" title="Creating and Opening a Movie File"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingandOpeningaMovieFile" title="Creating and Opening a Movie File"></a>Creating and Opening a Movie File</h3>
<p>The <code>CreateMyCoolMovie</code> function, shown in Listing 1-2, contains the main logic for this program. This function creates and opens a movie file for the new movie. It then establishes a data reference for the movie’s data (note that, if your movie’s data is stored in the same file as the movie itself, you do not have to create a data reference; set the data reference to 0). This function then calls two other functions, <code>CreateMyVideoTrack</code> and <code>CreateMySoundTrack</code>, to create the tracks for the new movie. Once the tracks have been created, <code>CreateMyCoolMovie</code> adds the new resource to the movie file and closes the movie file.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_147" title="Listing 1-2Creating and opening a movie file"></a>
<p class="codesample"><strong>Listing 1-2&nbsp;&nbsp;</strong>Creating and opening a movie file</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define kMyCreatorType 'TVOD'  /* Sample Player's creator type, the<span></span></pre></td></tr><tr><td scope="row"><pre>                                  movie player of choice. You can<span></span></pre></td></tr><tr><td scope="row"><pre>                                  also use your own creator type. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define kPrompt "\pEnter movie file name"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void CreateMyCoolMovie (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Point       where = {100,100};<span></span></pre></td></tr><tr><td scope="row"><pre>    SFReply     theSFReply;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie       theMovie = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec      mySpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       resRefNum = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       resId = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SFPutFile (where, "\pEnter movie file name",<span></span></pre></td></tr><tr><td scope="row"><pre>                            "\pMovie File", nil, &amp;theSFReply);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!theSFReply.good) return;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSMakeFSSpec(theSFReply.vRefNum, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     theSFReply.fName, &amp;mySpec);<span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateMovieFile (&amp;mySpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                'TVOD',<span></span></pre></td></tr><tr><td scope="row"><pre>                                smCurrentScript,<span></span></pre></td></tr><tr><td scope="row"><pre>                                createMovieFileDeleteCurFile,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;resRefNum,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;theMovie );<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError(err, "\pCreateMovieFile");<span></span></pre></td></tr><tr><td scope="row"><pre>    CreateMyVideoTrack (theMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    CreateMySoundTrack (theMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AddMovieResource (theMovie, resRefNum, &amp;resId,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         theSFReply.fName);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError(err, "\pAddMovieResource");<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    if (resRefNum) CloseMovieFile (resRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeMovie (theMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The code listing above adds the movie to the resource fork of the file that it creates. It is possible to create a movie file with no resource fork, and to store the movie in the file’s data fork.</p>
<p>To create a movie file with no resource fork, pass the <code>createMovieFileDontCreateResFile</code> flag when you call <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/CreateMovieFile" target="_top">CreateMovieFile</a></code>. To store the movie into the file’s data fork, call <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/AddMovieResource" target="_top">AddMovieResource</a></code> as shown, but pass <code>kResFileNotOpened</code> as the <code>resRefNum</code> parameter, and pass <code>movieInDataForkResID</code> in the <code>ResID</code> parameter.</p>

<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_20" title="Creating a Video Track in a New Movie"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingaVideoTrackinaNewMovie" title="Creating a Video Track in a New Movie"></a>Creating a Video Track in a New Movie</h3>
<p>The <code>CreateMyVideoTrack</code> function, shown in Listing 1-3, creates a video track in the new movie. This function creates the track and its media by calling the  <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewMovieTrack" target="_top">NewMovieTrack</a></code> and  <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewTrackMedia" target="_top">NewTrackMedia</a></code> functions, respectively. This function then establishes a media-editing session and adds the movie’s data to the media. The bulk of this work is done by the <code>AddVideoSamplesToMedia</code> subroutine. Once the data has been added to the media, this function adds the media to the track by calling the Movie Toolbox’s <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/InsertMediaIntoTrack" target="_top">InsertMediaIntoTrack</a></code> function.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_148" title="Listing 1-3Creating a video track"></a>
<p class="codesample"><strong>Listing 1-3&nbsp;&nbsp;</strong>Creating a video track</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define     kVideoTimeScale 600<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kTrackStart             0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kMediaStart             0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kFix1                   0x00010000<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void    CreateMyVideoTrack (Movie theMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Track           theTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media           theMedia;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect            trackFrame = {0,0,100,320};<span></span></pre></td></tr><tr><td scope="row"><pre>    theTrack = NewMovieTrack (theMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    FixRatio(trackFrame.right,1),<span></span></pre></td></tr><tr><td scope="row"><pre>                                    FixRatio(trackFrame.bottom,1),<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kNoVolume);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( GetMoviesError(), "\pNewMovieTrack" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    theMedia = NewTrackMedia (theTrack, VideoMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    600, // Video Time Scale<span></span></pre></td></tr><tr><td scope="row"><pre>                                    nil, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( GetMoviesError(), "\pNewTrackMedia" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    err = BeginMediaEdits (theMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pBeginMediaEdits" );<span></span></pre></td></tr><tr><td scope="row"><pre>    AddVideoSamplesToMedia (theMedia, &amp;trackFrame);<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    err = EndMediaEdits (theMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pEndMediaEdits" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    err = InsertMediaIntoTrack (theTrack, 0,  /* track start time */<span></span></pre></td></tr><tr><td scope="row"><pre>                                          0,  /* media start time */<span></span></pre></td></tr><tr><td scope="row"><pre>                                            GetMediaDuration (theMedia),<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kFix1);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pInsertMediaIntoTrack" );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_21" title="Adding Video Samples to a Media"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-AddingVideoSamplestoaMedia" title="Adding Video Samples to a Media"></a>Adding Video Samples to a Media</h3>
<p>The <code>AddVideoSamplesToMedia</code> function, shown in Listing 1-4, creates video data frames, compresses each frame, and adds the frames to the media. This function creates its own video data by calling the <code>DrawAFrame</code> function. Note that this function does not temporally compress the image sequence; rather, the function only spatially compresses each frame individually.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_149" title="Listing 1-4Adding video samples to a media"></a>
<p class="codesample"><strong>Listing 1-4&nbsp;&nbsp;</strong>Adding video samples to a media</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define     kSampleDuration             240<span></span></pre></td></tr><tr><td scope="row"><pre>        /* video frames last 240 * 1/600th of a second */<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kNumVideoFrames             29<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kNoOffset                   0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kMgrChoose                  0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kSyncSample                 0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kAddOneVideoSample          1<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kPixelDepth                 16<span></span></pre></td></tr><tr><td scope="row"><pre>void AddVideoSamplesToMedia (Media theMedia,<span></span></pre></td></tr><tr><td scope="row"><pre>                             const Rect *trackFrame)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            maxCompressedSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    GWorldPtr                       theGWorld = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            curSample;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle                          compressedData = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    Ptr                             compressedDataPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ImageDescriptionHandle          imageDesc = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGrafPtr                        oldPort;<span></span></pre></td></tr><tr><td scope="row"><pre>    GDHandle                        oldGDeviceH;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                           err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = NewGWorld (&amp;theGWorld,<span></span></pre></td></tr><tr><td scope="row"><pre>                        16,             /* pixel depth */<span></span></pre></td></tr><tr><td scope="row"><pre>                        trackFrame,<span></span></pre></td></tr><tr><td scope="row"><pre>                        nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                        nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                        (GWorldFlags) 0 );<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (err, "\pNewGWorld");<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    LockPixels (theGWorld->portPixMap);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetMaxCompressionSize (theGWorld->portPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    trackFrame,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0, /* let ICM choose depth */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    codecNormalQuality,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    'rle ',<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (CompressorComponent) anyCodec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;maxCompressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (err, "\pGetMaxCompressionSize" );<span></span></pre></td></tr><tr><td scope="row"><pre>    compressedData = NewHandle(maxCompressedSize);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( MemError(), "\pNewHandle" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    MoveHHi( compressedData );<span></span></pre></td></tr><tr><td scope="row"><pre>    HLock( compressedData );<span></span></pre></td></tr><tr><td scope="row"><pre>    compressedDataPtr = StripAddress( *compressedData );<span></span></pre></td></tr><tr><td scope="row"><pre>    imageDesc = (ImageDescriptionHandle)NewHandle(4);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( MemError(), "\pNewHandle" );<span></span></pre></td></tr><tr><td scope="row"><pre>         <span></span></pre></td></tr><tr><td scope="row"><pre>    GetGWorld (&amp;oldPort, &amp;oldGDeviceH);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetGWorld (theGWorld, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    for (curSample = 1; curSample &lt; 30; curSample++)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        EraseRect (trackFrame);<span></span></pre></td></tr><tr><td scope="row"><pre>        DrawFrame(trackFrame, curSample);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = CompressImage (theGWorld->portPixMap,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    trackFrame,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    codecNormalQuality,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    'rle ',<span></span></pre></td></tr><tr><td scope="row"><pre>                                    imageDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    compressedDataPtr );<span></span></pre></td></tr><tr><td scope="row"><pre>        CheckError( err, "\pCompressImage" );<span></span></pre></td></tr><tr><td scope="row"><pre>         <span></span></pre></td></tr><tr><td scope="row"><pre>        err = AddMediaSample(theMedia,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    compressedData,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0,      /* no offset in data */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (**imageDesc).dataSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    60,     /* frame duration = 1/10 sec */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (SampleDescriptionHandle)imageDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    1,      /* one sample */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0,      /* self-contained samples */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    nil);<span></span></pre></td></tr><tr><td scope="row"><pre>        CheckError( err, "\pAddMediaSample" );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetGWorld (oldPort, oldGDeviceH);<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    if (imageDesc) DisposeHandle ((Handle)imageDesc);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (compressedData) DisposeHandle (compressedData);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theGWorld) DisposeGWorld (theGWorld);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_22" title="Creating Video Data for a Movie"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingVideoDataforaMovie" title="Creating Video Data for a Movie"></a>Creating Video Data for a Movie</h3>
<p>The <code>DrawAFrame</code> function, shown in Listing 1-5, creates video data for this movie. This function draws a different frame each time it is invoked, based on the sample number, which is passed as a parameter.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_150" title="Listing 1-5Creating video data"></a>
<p class="codesample"><strong>Listing 1-5&nbsp;&nbsp;</strong>Creating video data</p>
<div class="codesample"><table><tr><td scope="row"><pre>void DrawFrame (const Rect *trackFrame, long curSample)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Str255 numStr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ForeColor( redColor );<span></span></pre></td></tr><tr><td scope="row"><pre>    PaintRect( trackFrame );<span></span></pre></td></tr><tr><td scope="row"><pre>    ForeColor( blueColor );<span></span></pre></td></tr><tr><td scope="row"><pre>    NumToString (curSample, numStr);<span></span></pre></td></tr><tr><td scope="row"><pre>    MoveTo ( trackFrame->right / 2, trackFrame->bottom / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    TextSize ( trackFrame->bottom / 3);<span></span></pre></td></tr><tr><td scope="row"><pre>    DrawString (numStr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_23" title="Creating a Sound Track"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingaSoundTrack" title="Creating a Sound Track"></a>Creating a Sound Track</h3>
<p>The <code>CreateMySoundTrack</code> function, shown in Listing 1-6, creates the movie’s sound track. This sound track is not synchronized to the video frames of the movie; rather, it is just a separate sound track that accompanies the video data. This function relies upon an <code>'snd</code> <code>'</code> resource for its source sound. The <code>CreateMySoundTrack</code> function uses the <code>CreateSoundDescription</code> function to create the sound description structure for these samples.</p>
<p>As with the <code>CreateMyVideoTrack</code> function discussed earlier, this function creates the track and its media by calling the  <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewMovieTrack" target="_top">NewMovieTrack</a></code> and  <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/NewTrackMedia" target="_top">NewTrackMedia</a></code> functions, respectively. This function then establishes a media-editing session and adds the movie’s data to the media. This function adds the sound samples using a single invocation of the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/AddMediaSample" target="_top">AddMediaSample</a></code> function. This is possible because all the sound samples are the same size and rely on the same sample description (the <code><!--a target="_top" -->SoundDescription<!--/a--></code> structure). If you use this approach, it is often advisable to break up the sound data in the movie, so that the movie plays smoothly. After you create the movie, you can call the <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/FlattenMovie" target="_top">FlattenMovie</a></code> function to create an interleaved version of the movie. Another approach is to call <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/AddMediaSample" target="_top">AddMediaSample</a></code> multiple times, breaking the sound into multiple chunks at that point.</p>
<p>Once the data has been added to the media, this function adds the media to the track by calling the Movie Toolbox’s <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/InsertMediaIntoTrack" target="_top">InsertMediaIntoTrack</a></code> function.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_151" title="Listing 1-6Creating a sound track"></a>
<p class="codesample"><strong>Listing 1-6&nbsp;&nbsp;</strong>Creating a sound track</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define     kSoundSampleDuration 1<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kSyncSample 0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kTrackStart     0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kMediaStart     0<span></span></pre></td></tr><tr><td scope="row"><pre>#define     kFix1           0x00010000<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void CreateMySoundTrack (Movie theMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                               theTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media                               theMedia;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle                              sndHandle = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    SoundDescriptionHandle              sndDesc = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                                sndDataOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                                sndDataSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                                numSamples;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                               err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sndHandle = GetResource ('snd ', 128);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (ResError(), "\pGetResource" );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sndHandle == nil) return;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDesc = (SoundDescriptionHandle) NewHandle(4);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (MemError(), "\pNewHandle" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    CreateSoundDescription (sndHandle,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sndDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;sndDataOffset,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;numSamples,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;sndDataSize );<span></span></pre></td></tr><tr><td scope="row"><pre>                             <span></span></pre></td></tr><tr><td scope="row"><pre>    theTrack = NewMovieTrack (theMovie, 0, 0, kFullVolume);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (GetMoviesError(), "\pNewMovieTrack" );<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    theMedia = NewTrackMedia (theTrack, SoundMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        FixRound ((**sndDesc).sampleRate),<span></span></pre></td></tr><tr><td scope="row"><pre>                                        nil, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError (GetMoviesError(), "\pNewTrackMedia" );<span></span></pre></td></tr><tr><td scope="row"><pre>    err = BeginMediaEdits (theMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pBeginMediaEdits" );<span></span></pre></td></tr><tr><td scope="row"><pre>    err = AddMediaSample(theMedia,<span></span></pre></td></tr><tr><td scope="row"><pre>                    sndHandle,<span></span></pre></td></tr><tr><td scope="row"><pre>                    sndDataOffset,      /* offset in data */<span></span></pre></td></tr><tr><td scope="row"><pre>                    sndDataSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                    1,                  /* duration of each sound sample */<span></span></pre></td></tr><tr><td scope="row"><pre>                    (SampleDescriptionHandle) sndDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                    numSamples,<span></span></pre></td></tr><tr><td scope="row"><pre>                    0,                  /* self-contained samples */<span></span></pre></td></tr><tr><td scope="row"><pre>                    nil );<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pAddMediaSample" );<span></span></pre></td></tr><tr><td scope="row"><pre>                     <span></span></pre></td></tr><tr><td scope="row"><pre>    err = EndMediaEdits (theMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pEndMediaEdits" );<span></span></pre></td></tr><tr><td scope="row"><pre>    err = InsertMediaIntoTrack (theTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0,          /* track start time */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0,          /* media start time */<span></span></pre></td></tr><tr><td scope="row"><pre>                                    GetMediaDuration (theMedia),<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kFix1);<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError( err, "\pInsertMediaIntoTrack" );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sndDesc != nil) DisposeHandle( (Handle)sndDesc);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_24" title="Creating a Sound Description Structure"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-CreatingaSoundDescriptionStructure" title="Creating a Sound Description Structure"></a>Creating a Sound Description Structure</h3>
<p>The <code>CreateSoundDescription</code> function, shown in Listing 1-7, creates a sound description structure that correctly describes the sound samples obtained from the <code>'snd</code> <code>'</code> resource. This function can handle all the sound data formats that are possible in the sound resource. This function uses the <code>GetSndHdrOffset</code> function to locate the sound data in the sound resource.</p>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_152" title="Listing 1-7Creating a sound description"></a>
<p class="codesample"><strong>Listing 1-7&nbsp;&nbsp;</strong>Creating a sound description</p>
<div class="codesample"><table><tr><td scope="row"><pre>/* Constant definitions */<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMACEBeginningNumberOfBytes 6<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMACE31MonoPacketSize 2<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMACE31StereoPacketSize 4<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMACE61MonoPacketSize 1<span></span></pre></td></tr><tr><td scope="row"><pre>#define kMACE61StereoPacketSize 2<span></span></pre></td></tr><tr><td scope="row"><pre>void CreateSoundDescription (Handle sndHandle,<span></span></pre></td></tr><tr><td scope="row"><pre>                                SoundDescriptionHandlesndDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                                long *sndDataOffset,<span></span></pre></td></tr><tr><td scope="row"><pre>                                long *numSamples,<span></span></pre></td></tr><tr><td scope="row"><pre>                                long *sndDataSize )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long                        sndHdrOffset = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                        sampleDataOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    SoundHeaderPtr              sndHdrPtr = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                        numFrames;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                        samplesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                        bytesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    SignedByte                  sndHState;<span></span></pre></td></tr><tr><td scope="row"><pre>    SoundDescriptionPtr         sndDescPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    *sndDataOffset = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    *numSamples = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    *sndDataSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    SetHandleSize( (Handle)sndDesc, sizeof(SoundDescription) );<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckError(MemError(),"\pSetHandleSize");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sndHdrOffset = GetSndHdrOffset (sndHandle);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sndHdrOffset == 0) CheckError(-1, "\pGetSndHdrOffset ");<span></span></pre></td></tr><tr><td scope="row"><pre>                /* we can use pointers since we don't move memory */<span></span></pre></td></tr><tr><td scope="row"><pre>    sndHdrPtr = (SoundHeaderPtr) (*sndHandle + sndHdrOffset);<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr = *sndDesc;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->descSize = sizeof (SoundDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>                /* total size of sound description structure */<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->resvd1 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->resvd2 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->dataRefIndex = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->compressionID = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->packetSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->version = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->revlevel = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndDescPtr->vendor = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (sndHdrPtr->encode)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case stdSH:<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->dataFormat = 'raw ';<span></span></pre></td></tr><tr><td scope="row"><pre>                /* uncompressed offset-binary data */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->numChannels = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>                /* number of channels of sound */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleSize = 8;<span></span></pre></td></tr><tr><td scope="row"><pre>                /* number of bits per sample */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleRate = sndHdrPtr->sampleRate;<span></span></pre></td></tr><tr><td scope="row"><pre>                /* sample rate */<span></span></pre></td></tr><tr><td scope="row"><pre>            *numSamples         = sndHdrPtr->length;<span></span></pre></td></tr><tr><td scope="row"><pre>            *sndDataSize        = *numSamples;<span></span></pre></td></tr><tr><td scope="row"><pre>            bytesPerFrame       = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            samplesPerFrame = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            sampleDataOffset = (Ptr)&amp;sndHdrPtr->sampleArea - (Ptr)sndHdrPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>        case extSH:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            ExtSoundHeaderPtr           extSndHdrP;<span></span></pre></td></tr><tr><td scope="row"><pre>            extSndHdrP = (ExtSoundHeaderPtr)sndHdrPtr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->dataFormat = 'raw ';<span></span></pre></td></tr><tr><td scope="row"><pre>                                    /* uncompressed offset-binary data */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->numChannels = extSndHdrP->numChannels;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    /* number of channels of sound */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleSize = extSndHdrP->sampleSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    /* number of bits per sample */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleRate = extSndHdrP->sampleRate;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    /* sample rate */<span></span></pre></td></tr><tr><td scope="row"><pre>            numFrames = extSndHdrP->numFrames;<span></span></pre></td></tr><tr><td scope="row"><pre>            *numSamples = numFrames;<span></span></pre></td></tr><tr><td scope="row"><pre>            bytesPerFrame = extSndHdrP->numChannels *<span></span></pre></td></tr><tr><td scope="row"><pre>                                            (extSndHdrP->sampleSize / 8);<span></span></pre></td></tr><tr><td scope="row"><pre>            samplesPerFrame = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            *sndDataSize = numFrames * bytesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>            sampleDataOffset = (Ptr)(&amp;extSndHdrP->sampleArea)<span></span></pre></td></tr><tr><td scope="row"><pre>                                            - (Ptr)extSndHdrP;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>             <span></span></pre></td></tr><tr><td scope="row"><pre>        case cmpSH:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            CmpSoundHeaderPtr cmpSndHdrP;<span></span></pre></td></tr><tr><td scope="row"><pre>            cmpSndHdrP = (CmpSoundHeaderPtr)sndHdrPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->numChannels = cmpSndHdrP->numChannels;<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* number of channels of sound */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleSize = cmpSndHdrP->sampleSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* number of bits per sample before compression */<span></span></pre></td></tr><tr><td scope="row"><pre>            sndDescPtr->sampleRate = cmpSndHdrP->sampleRate;<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* sample rate */<span></span></pre></td></tr><tr><td scope="row"><pre>            numFrames = cmpSndHdrP->numFrames;<span></span></pre></td></tr><tr><td scope="row"><pre>            sampleDataOffset =(Ptr)(&amp;cmpSndHdrP->sampleArea)<span></span></pre></td></tr><tr><td scope="row"><pre>                                              - (Ptr)cmpSndHdrP;<span></span></pre></td></tr><tr><td scope="row"><pre>            switch (cmpSndHdrP->compressionID)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case threeToOne:<span></span></pre></td></tr><tr><td scope="row"><pre>                    sndDescPtr->dataFormat = 'MAC3';<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* compressed 3:1 data */<span></span></pre></td></tr><tr><td scope="row"><pre>                    samplesPerFrame = kMACEBeginningNumberOfBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>                    *numSamples = numFrames * samplesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                    switch (cmpSndHdrP->numChannels)<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        case 1:<span></span></pre></td></tr><tr><td scope="row"><pre>                            bytesPerFrame = cmpSndHdrP->numChannels<span></span></pre></td></tr><tr><td scope="row"><pre>                                                * kMACE31MonoPacketSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                        case 2:<span></span></pre></td></tr><tr><td scope="row"><pre>                            bytesPerFrame = cmpSndHdrP->numChannels<span></span></pre></td></tr><tr><td scope="row"><pre>                                                * kMACE31StereoPacketSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                        default:<span></span></pre></td></tr><tr><td scope="row"><pre>                            CheckError(-1, "\pCorrupt sound data" );<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    *sndDataSize = numFrames * bytesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case sixToOne:<span></span></pre></td></tr><tr><td scope="row"><pre>                    sndDescPtr->dataFormat = 'MAC6';<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* compressed 6:1 data */<span></span></pre></td></tr><tr><td scope="row"><pre>                    samplesPerFrame = kMACEBeginningNumberOfBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>                    *numSamples = numFrames * samplesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                    switch (cmpSndHdrP->numChannels)<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        case 1:<span></span></pre></td></tr><tr><td scope="row"><pre>                            bytesPerFrame = cmpSndHdrP->numChannels<span></span></pre></td></tr><tr><td scope="row"><pre>                                                * kMACE61MonoPacketSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                        case 2:<span></span></pre></td></tr><tr><td scope="row"><pre>                            bytesPerFrame = cmpSndHdrP->numChannels<span></span></pre></td></tr><tr><td scope="row"><pre>                                                * kMACE61StereoPacketSize;<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                        default:<span></span></pre></td></tr><tr><td scope="row"><pre>                            CheckError(-1, "\pCorrupt sound data" );<span></span></pre></td></tr><tr><td scope="row"><pre>                            break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    *sndDataSize = (*numSamples) * bytesPerFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                default:<span></span></pre></td></tr><tr><td scope="row"><pre>                    CheckError(-1, "\pCorrupt sound data" );<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }           /* switch cmpSndHdrP->compressionID:*/<span></span></pre></td></tr><tr><td scope="row"><pre>            break;      /* of cmpSH: */<span></span></pre></td></tr><tr><td scope="row"><pre>             <span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            CheckError(-1, "\pCorrupt sound data" );<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>             <span></span></pre></td></tr><tr><td scope="row"><pre>    }                   /* switch sndHdrPtr->encode */<span></span></pre></td></tr><tr><td scope="row"><pre>    *sndDataOffset = sndHdrOffset + sampleDataOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_25" title="Parsing a Sound Resource"></a>
<h3><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-ParsingaSoundResource" title="Parsing a Sound Resource"></a>Parsing a Sound Resource</h3>
<p>The <code>GetSndHdrOffset</code> function, shown in Listing 1-8, parses the specified sound resource and locates the sound data stored in the resource. The <code>GetSndHdrOffset</code> function cruises through a specified <code>'snd</code> <code>'</code> resource. It locates the sound data, if any, and returns its type, offset, and size into the resource.</p>
<p>The <code>GetSndHdrOffset</code> function returns an offset instead of a pointer so that the data is not locked in memory. By returning an offset, the calling function can decide when and if it wants the resource locked down to access the sound data.</p>
<p>The first step in finding this data is to determine if the <code>'snd</code> <code>'</code> resource is format (type) 1 or format (type) 2. A type 2 is easy, but a type 1 requires that you find the number of <code>'snth'</code> resource types specified and then skip over each one, including the <code>init</code> option. Once you do this, you have a pointer to the number of commands in the <code>'snd</code> <code>'</code> resource. When the function finds the first one, it examines the command to find out if it is a sound data command. Since it is a sound resource, the command also has its <code>dataPointerFlag</code> parameter set to 1. When the function finds a sound data command, it returns its offset and type and exits.</p>
<div class="warningbox"><img src="../../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_153" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
Do not send the <code>GetSndHdrOffset</code> function a <code>nil</code> handle; if you do, your system will crash. </p><p>
</p><div class="clear"></div></div>
<a name="//apple_ref/doc/uid/TP40000906-CreatingMovies-DontLinkElementID_154" title="Listing 1-8Parsing a sound resource"></a>
<p class="codesample"><strong>Listing 1-8&nbsp;&nbsp;</strong>Parsing a sound resource</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef SndCommand *SndCmdPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       format;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       numSynths;<span></span></pre></td></tr><tr><td scope="row"><pre>} Snd1Header, *Snd1HdrPtr, **Snd1HdrHndl;<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       format;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       refCount;<span></span></pre></td></tr><tr><td scope="row"><pre>} Snd2Header, *Snd2HdrPtr, **Snd2HdrHndl;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       synthID;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        initOption;<span></span></pre></td></tr><tr><td scope="row"><pre>} SynthInfo, *SynthInfoPtr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>long GetSndHdrOffset (Handle sndHandle)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short howManyCmds;<span></span></pre></td></tr><tr><td scope="row"><pre>    long sndOffset = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    Ptr sndPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    if (sndHandle == nil) return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    sndPtr = *sndHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sndPtr == nil) return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    if ((*(Snd1HdrPtr)sndPtr).format == firstSoundFormat)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        short synths = ((Snd1HdrPtr)sndPtr)->numSynths;<span></span></pre></td></tr><tr><td scope="row"><pre>        sndPtr += sizeof(Snd1Header) + (sizeof(SynthInfo) * synths);<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        sndPtr += sizeof(Snd2Header);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    howManyCmds = *(short *)sndPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>     <span></span></pre></td></tr><tr><td scope="row"><pre>    sndPtr += sizeof(howManyCmds);<span></span></pre></td></tr><tr><td scope="row"><pre>    /*<span></span></pre></td></tr><tr><td scope="row"><pre>    sndPtr is now at the first sound command -- cruise all<span></span></pre></td></tr><tr><td scope="row"><pre>    commands and find the first soundCmd or bufferCmd<span></span></pre></td></tr><tr><td scope="row"><pre>    */<span></span></pre></td></tr><tr><td scope="row"><pre>    while (howManyCmds > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        switch (((SndCmdPtr)sndPtr)->cmd)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            case (soundCmd + dataOffsetFlag):<span></span></pre></td></tr><tr><td scope="row"><pre>            case (bufferCmd + dataOffsetFlag):<span></span></pre></td></tr><tr><td scope="row"><pre>                sndOffset = ((SndCmdPtr)sndPtr)->param2;<span></span></pre></td></tr><tr><td scope="row"><pre>                howManyCmds = 0;/* done, get out of loop */<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            default:                /* catch any other type of commands */<span></span></pre></td></tr><tr><td scope="row"><pre>                sndPtr += sizeof(SndCommand);<span></span></pre></td></tr><tr><td scope="row"><pre>                howManyCmds--;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }                               /* done with all commands */<span></span></pre></td></tr><tr><td scope="row"><pre>    return sndOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>}       /* of GetSndHdrOffset */<span></span></pre></td></tr></table></div>






        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../A-Intro/1Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../C-Chapter/3SequenceGrabberComp.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-01-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/CreatingMovies/MTCreateMovies/B-Chapter/2CreatingMovies.html%3Fid%3DTP40000906-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/CreatingMovies/MTCreateMovies/B-Chapter/2CreatingMovies.html%3Fid%3DTP40000906-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/CreatingMovies/MTCreateMovies/B-Chapter/2CreatingMovies.html%3Fid%3DTP40000906-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>