<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note ME515: Virtual Memory Q&amp;As</title><meta name="keywords" content="Mac OS 7 Virtual Memory 24 bit 32 addressing SCSIRead"><meta name="Description" content="Technical Note ME515: This Technical Note contains a collectionof archived Q&amp;As relating to Virtual Memory--questions sentthe Developer Support Center (DSC) along with answers fromthe DSC engineers. Archived Q&amp;As include: The general formulasfor determining he maximum amount of VM you can have forboth 24- and 32-bit addressing; What happens if the Macintoshruns under System 7 with virtual memory (VM) and parts ofa buffer (filled with a SCSIRead call) are swapped out?">                                       <meta name="categories" content="Memory"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002542" title="Virtual Memory Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note ME515</div>
<div id="pageheadsub">Virtual Memory Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"> 					<a href="#Section1">System 7 virtual memory limits with 24- and 32-bit addressing</a><BR><BR>					<a href="#Section2">Macintosh Virtual Memory and protecting large buffers</a><BR><BR>					<A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;As can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><a name="Section1"></a><h2>System 7 virtual memory limits with 24- and 32-bit addressing</h2><p>Date Written: 11/13/92</p><p>Last reviewed:  3/1/93</p><p>What's the maximum amount of System 7 virtual memory with 24-bit addressing onthe following Macintosh models: Classic II, LC II, IIvx, IIvi, Quadras, Performas, and PowerBooks (except 100)? Is built-in video on those modelsmapped to a NuBus slot space as it is on a Macintosh IIci or IIsi, reducing maximum virtual memory from 14 MB to 13 MB?</p><p>___</p><p>Below you'll find general formulas that you can use to determine the maximumamount of VM you can have for both 24- and 32-bit addressing, as well as acouple of references that explain VM in further detail. Yes, the built-in videoon the Macintosh models you specified are mapped to a NuBus slot space as it ison a Macintosh IIci and IIsi. Think of on-board video as a fake NuBus slot.</p><p>The following four factors determine how much VM these Macintosh models can have:</p><ul type="disc">	<li>24-bit vs. 32-bit addressing<BR><BR></li>	<li>System management (usually allow it 2 MB)<BR><BR></li>	<li>Number of occupied NuBus slots (1 MB for each)<BR><BR></li>	<li>Free disk space.<BR><BR></li></ul><p>24-bit addressing</p><p>-----------------</p><p>The maximum amount of VM that you can have with 24-bit addressing is 16 MB.Note: With 24-bit addressing you're limited to 8 MB physical RAM.</p><p>Take the maximum amount of VM that you can have with 24-bit addressing (16 MB)and subtract 2 MB for system management. Then subtract 1 MB for each occupiedNuBus slot. To determine how much disk space you must have available, take themaximum amount of VM that you can have and add it to the amount of physical RAMthat you have. That's the amount of disk space that you must have free.</p><p>Here's an example for a Macintosh II with 8 MB of physical RAM and 2 occupiedNuBus slots:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>  16 MB  maximum VM with 24-bit addressing  -2 MB  system management  -2 MB  for 2 occupied NuBus slots----  12 MB  maximum VM for 24-bit Macintosh II with 2 occupied NuBus slots  +8 MB  physical RAM installed----  20 MB  required free disk space</pre>	</TD></TR></TABLE></CENTER><p>So for a Macintosh II with 8 MB of physical RAM and 2 occupied NuBus slots, youmust have 20 MB of free disk space to get 12 MB of VM.</p><p>32-bit addressing</p><p>-----------------</p><p>The maximum amount of VM that you can have with 32-bit addressing is 4 GB.Note: with 32-bit addressing your physical RAM limits are determined by thecapabilities of the hardware.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>4000 MB  maximum VM with 32-bit addressing  -2 MB  system management  -2 MB  for 2 occupied NuBus slots----3996 MB    maximum VM for 32-bit Macintosh II with 2 occupied NuBus slots  +8 MB  physical RAM installed----4004 MB  required free disk space</pre>	</TD></TR></TABLE></CENTER><p>Here's a quick chart of physical RAM and NuBus slots for the CPUs that you inquired.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>                                         Expansion slotsCPU                             Physical RAM         NuBus/PDS---------------------------------------------------------------Classic II / Performa 200           2-10                 0LC II / Performa 400                2-10                 1Macintosh IIvx                      4-20                 4Macintosh IIvi                      4-20                 4Macintosh Quadra 700                4-20                 3Macintosh Quadra 900/950            8-64                 6Performa 600                        4-20                 4PowerBook 145                       2-8                  2PowerBook 160/180                   4-14                 2Duo 210/230                         4-12                 2</pre>	</TD></TR></TABLE></CENTER><p>VM XRef:</p><ul type="disc">	<li>Chapter 28 of <i>Inside Macintosh</i> Volume VI, Chapter 28, "Memory Management"<BR><BR></li>	<li><i>develop,</i> Issue #6, page 36, "About 32-Bit Addressing" (Developer CD Series disc path: Periodicals: develop: develop Issue 6)<BR><BR></li>	<li>Macintosh Technical Note "Get Physical" <i>(Developer CD Series</i> disc path: Technical Documentation: Macintosh Technical Notes: Memory: Get Physical)<BR><BR></li></ul><a name="Section2"></a><h2>Macintosh Virtual Memory and protecting large buffers</h2><p>Date Written:  4/25/91</p><p>Last reviewed:  6/14/93</p><p>I'm filling a large buffer with one <code>SCSIRead</code> call. What happens if theMacintosh runs under System 7 with virtual memory (VM) and parts of my bufferare swapped out?</p><p>___</p><p>Parts of your buffer must not be swapped out. Before calling <code>SCSIGet</code>, you mustensure that all code and buffers accessed while the SCSI bus is busy are heldin physical memory. If there isn't enough real memory to allocate a fullbuffer, the application must request smaller blocks (if possible) from the SCSIdevice, because it's not possible to swap in and out any buffer space during asingle I/O operation. Page faults are not serviced while SCSI I/O is inprogress. If SCSI I/O is performed at device driver-level Read or Write calls,VM holds your buffer for you. Otherwise, you are responsible for doing thisyourself. If there is insufficient physical memory for VM to hold your buffersfor you, the Read or Write call fails with an error result.</p><p>In general, I/O buffer space used by drivers must be held in real memory forthe duration of the I/O operation. This is especially true for SCSI I/O becauseVM uses SCSI to swap virtual memory in and out, and encountering another pagefault would cause a bus error. Device Manager-level I/O handles thisautomatically, by holding down the appropriate memory when the driver isentered through a Read or Write call. The Device Manager does not take care ofthis for you when the driver is entered through a Control or Status call,however. If the <code>SCSIRead</code> call is made from within a device driver as a resultof a <code>PBRead</code>, no special action is necessary. Any other type of code must bevery careful not to cause page faults between <code>SCSIGet</code> and <code>SCSIComplete</code>. Thisrequires holding or placing in the system heap any code or data structuresreferenced during this time.</p><P><A HREF="#top">Back to top</A></P>                           <P><A NAME=Downloads></A></P>                  <h2>Downloadables</h2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (30K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/me_515.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/me/me_515.html%3Fid%3DDTS10002542-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/me/me_515.html%3Fid%3DDTS10002542-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/me/me_515.html%3Fid%3DDTS10002542-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>