<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Using Master-Peer Configurations</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.15.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.17.html"><img src="next.gif" border="0" alt="Next"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606254"> </A><A NAME="24267"> </A>Using Master-Peer Configurations</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606144"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606145"> </A>Explains what a master-peer EODatabaseDataSource configuration is, how it differs from a master-detail configuration, when to use it, and how to use it.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606146"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=629344"> </A>EODatabaseDataSources are usually used in a master-detail configuration where an EODatabaseDataSource acts as the master and an EODetailDataSource acts as the detail. However, you can also use two EODatabaseDataSources in a master-peer configuration where one acts as the master and the other acts as the detail (see Figure 1).</P><P CLASS="Body"><A NAME="pgfId=629508"> </A></P><DIV><IMG SRC="ProgrammingTopics-6.gif"></DIV><P CLASS="Figure"><A NAME="pgfId=629507"> </A>Master-Peer Configuration<DIV><IMG SRC="ProgrammingTopics-7.gif"></DIV></P><P CLASS="Body"><A NAME="pgfId=629345"> </A>The peer EODatabaseDataSource in a master-peer configuration operates independently of its master. It goes to the database to fetch its objects and maintains those objects in its own array. Because the peer data source acts independently, if you add or remove objects from the peer, the changes aren't automatically reflected in the master. The database is updated correctly, but the master's relationship array (if it exists) isn't. Consequently, if you're using master-peer and the master has a to-many relationship as a class property, you're responsible for modifying the master's relationship array to keep it in sync with the peer.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=629346"> </A>When to Use Master-Peer</H3><P CLASS="Body"><A NAME="pgfId=629347"> </A>You might want to use a master-peer configuration instead of a master-detail if the master doesn't have a class property that represents a relationship to the peer. With master-detail, the master must have a class property that represents a relationship to the detail, but because a peer does its own fetching, the master in a master-peer doesn't have this restriction.</P><P CLASS="Body"><A NAME="pgfId=629348"> </A>Another scenario in which you might want to use a master-peer configuration is when you need to further qualify the set of objects related to the master's selected object. For example, instead of displaying all of a studio's movies, you want to display only the movies whose revenues are greater than $5,000,000. You can accomplish this by assigning an in-memory qualifier to a display group displaying the detail objects, but if the number of records in the unfiltered set is prohibitively large, the filtering is better performed in the database. Using a master-peer configuration, you can further qualify the peer's set of objects in the database by assigning an auxiliary qualifier. You must also use this auxiliary qualifier approach if the qualifier can't be executed in memory (for example, because it uses custom SQL or accesses properties not in the object graph). For an example of applying an auxiliary qualifier, see <A HREF="ProgrammingTopics.16.html#12316" CLASS="XRef">Creating a Master-Peer Configuration</A>.</P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=629353"> </A><A NAME="12316"> </A>Creating a Master-Peer Configuration</H3><P CLASS="Body"><A NAME="pgfId=629354"> </A>To set up a master-peer configuration, follow these basic steps:</P><OL><LI CLASS="Numbered"><A NAME="pgfId=629355"> </A>Create the master display group and EODatabaseDataSource.</LI><LI CLASS="Numbered"><A NAME="pgfId=629356"> </A>Create the peer display group and EODatabaseDataSource.</LI><LI CLASS="Numbered"><A NAME="pgfId=629357"> </A>Connect the display groups.</LI><LI CLASS="Numbered"><A NAME="pgfId=629358"> </A>Optionally, apply an auxiliary qualifier to the peer's data source.</LI></OL><P CLASS="Body"><A NAME="pgfId=629482"> </A>For an OpenStep application, the easiest way to create a display group and its data source is to drag a model file (or an entity from EOModeler) into a nib in Interface Builder. This action creates an EODisplayGroup and a corresponding EODatabaseDataSource. Using this approach, you can then connect your two display groups as you would for a master-detail configuration, but create an EOMasterPeerAssociation instead of an EOMasterDetailAssociation. </P><P CLASS="Body"><A NAME="pgfId=629483"> </A>For a WebObjects application, start out similarly by dragging a model file (or an entity from EOModeler) into a component in WebObjects Builder to create a WODisplayGroup and a corresponding EODatabaseDataSource. Do this twice, once to create a master display group and again to create the peer. Don't configure your peer display group to have a detail data source as you would for a master-detail configuration. Instead, you must establish the master-peer relationship in code, using the EODataSource method <TT CLASS="Code">qualifyWithRelationshipKey</TT>. The following method demonstrates the procedure:</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629451"> </A>Establishing a master-peer relationship (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=629364"> </A>public void selectObject() {  WODisplayGroup studioDisplayGroup;  // Assume this exists.  WODisplayGroup movieDisplayGroup;   // Assume this exists.   Studio studio;                      // Assume this exists.  EODatabaseDataSource movieDataSource;  movieDataSource = (EODatabaseDataSource)movieDisplayGroup.dataSource();  studioDisplayGroup.selectObject(studio);  movieDataSource.qualifyWithRelationshipKeyAndObject(&quot;toMovie&quot;, studio);  movieDisplayGroup.fetch();}</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629452"> </A>Establishing a master-peer relationship (Objective-C)</H4><PRE CLASS="Code"><A NAME="pgfId=629365"> </A>- (void)selectObject {WODisplayGroup *studioDisplayGroup; // Assume this exists.WODisplayGroup *movieDisplayGroup;  // Assume this exists. Studio *studio;                     // Assume this exists.EODatabaseDataSource *movieDataSource =(EODatabaseDataSource *)[movieDisplayGroup dataSource];[studioDisplayGroup selectObject:studio];[movieDataSource qualifyWithRelationshipKey:@&quot;toMovie&quot; ofObject:studio];[movieDisplayGroup fetch];}</PRE><P CLASS="Body"><A NAME="pgfId=629366"> </A>In this example, the <TT CLASS="Code">selectObject</TT> method is invoked when a user selects a new master object (<TT CLASS="Code">studio</TT>). It updates the selection of the master display group (<TT CLASS="Code">studioDisplayGroup</TT>) and requalifies the peer data source (<TT CLASS="Code">movieDataSource</TT>) to match. The final step is to send a fetch message to the peer display group (<TT CLASS="Code">movieDisplayGroup</TT>) causing <TT CLASS="Code">movieDataSource</TT> to refetch its objects from the database using a newly formed qualifier.</P><P CLASS="Body"><A NAME="pgfId=629367"> </A>For both OpenStep and WebObjects applications, to apply an auxiliary qualifier, use EODatabaseDataSource's <TT CLASS="Code">setAuxiliaryQualifier</TT> method. The following example demonstrates the procedure:</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629453"> </A>Applying an auxiliary qualifier (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=629595"> </A>public Component requalifyMovies() {	  DecimalNumber revenue;              // Assume this exists.  WODisplayGroup movieDisplayGroup;   // Assume this exists.  EOQualifier auxiliaryQualifier;  EODatabaseDataSource movieDataSource;  /* Construct qualifier */  Object qualifierObjects[] = { &quot;revenue&quot;,revenue };  NSArray qualifierComponentArray = new NSArray(qualifierObjects);  auxiliaryQualifier = EOQualifier.qualifierWithQualifierFormat(    &quot;%@ &gt; %@&quot;,qualifierComponentArray);  /* Apply qualifier to peer data source. */  movieDataSource = (EODatabaseDataSource)movieDisplayGroup.dataSource();  movieDataSource.setAuxiliaryQualifier(auxiliaryQualifier);  /* Tell peer controller to fetch. */  movieDisplayGroup.fetch();  return this;}</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629454"> </A>Applying an auxiliary qualifier (Objective-C)</H4><PRE CLASS="Code"><A NAME="pgfId=629372"> </A>- (void)requalifyMovies {NSDecimalNumber *revenue;          // Assume this exists.id movieDisplayGroup;              // Assume this exists.EOQualifier *auxiliaryQualifier = nil;EODatabaseDataSource *movieDataSource;/* Construct qualifier. */	auxiliaryQualifier = [EOQualifier  qualifierWithQualifierFormat:@&quot;%@ &gt; %@&quot;, @&quot;revenue&quot;, revenue];/* Apply qualifier to peer data source. */movieDataSource = (EODatabaseDataSource *)[movieDisplayGroup dataSource];[movieDataSource setAuxiliaryQualifier:auxiliaryQualifier];/* Tell peer controller to fetch. */[movieDisplayGroup fetch];}</PRE><P CLASS="Body"><A NAME="pgfId=629373"> </A>This method constructs a qualifier that selects movies whose revenues are greater than revenue, assigns that qualifier as the auxiliary qualifier for the peer data source (<TT CLASS="Code">movieDataSource</TT>), and then directs the peer display group to fetch. Because the peer display group uses an EODatabaseDataSource instead of an EODetailDataSource, the refetch performs a fetch with the qualifier in the database.</P></DIV></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=624378"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606209"> </A><A HREF="ProgrammingTopics.15.html#27044" CLASS="XRef">Creating a WODisplayGroup</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=629493"> </A>WODisplayGroup</LI><LI CLASS="Bulleted"><A NAME="pgfId=629494"> </A>EODisplayGroup</LI><LI CLASS="Bulleted"><A NAME="pgfId=629495"> </A>EODatabaseDataSource</LI><LI CLASS="Bulleted"><A NAME="pgfId=629496"> </A>EODataSource</LI><LI CLASS="Bulleted"><A NAME="pgfId=629497"> </A>EODetailDataSource</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606211"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606212"> </A>What is a master-peer configuration?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606213"> </A>When do I use a master-peer configuration?</LI><LI CLASS="Bulleted"><A NAME="pgfId=629498"> </A>How do I use a master-peer configuration?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606216"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606217"> </A>Master-peer</LI><LI CLASS="Bulleted"><A NAME="pgfId=629504"> </A>Master-detail</LI><LI CLASS="Bulleted"><A NAME="pgfId=629499"> </A>WODisplayGroup</LI><LI CLASS="Bulleted"><A NAME="pgfId=629500"> </A>EODisplayGroup</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606225"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=602450"> </A>3 February, 1999. Clif Liu. First Draft.</P></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.15.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.17.html"><img src="next.gif" border="0" alt="Next"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>