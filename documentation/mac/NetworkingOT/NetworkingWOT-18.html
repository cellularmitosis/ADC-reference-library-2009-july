<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Configuring and Opening a Provider</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING18></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-17.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-19.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-10.html"><B>Part 1 - Open Transport Essentials</B></A><BR><DD><A HREF="NetworkingWOT-16.html"><B>Chapter 2 - Getting Started With Open Transport</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING18-0></A>
<H1><A NAME=MARKER-9-29></A>Configuring and Opening a Provider</H1>
 After initializing Open Transport but before you can send or receive data, you must configure and open a provider. Providers supply data-oriented services, and are implemented by modules that can be layered to provide the services in which you are interested. To create a provider configuration, you call the function <CODE><A NAME=MARKER-13-39></A><A NAME=MARKER-13-39></A>OTCreateConfiguration</CODE>, passing it a configuration string that describes this layering. The following two sections explain this process in greater detail.<P>
<A NAME=HEADING18-2></A>
<H2><A NAME=MARKER-9-32></A>Creating a Configuration Structure</H2>
 The <CODE>OTCreateConfiguration</CODE> function creates a configuration structure and returns a pointer to it. The configuration string can be the name of a single protocol, such as <CODE>"adsp"</CODE>, <CODE>"tcp",</CODE> or <CODE>"dnr",</CODE> or it can be a comma-separated list of protocol and port names. For instance, the string<P>
<PRE>
<A NAME=MARKER-0-95></A>&quot;adsp,ddp,ltlkB&quot; 
</PRE>
 describes an AppleTalk Data Stream Protocol (ADSP) endpoint provider using the Datagram Delivery Protocol (DDP) with LocalTalk link access provided through the LocalTalk B (Printer) port.<P>
 Open Transport has internally defined defaults for how protocols can be layered upon each other. If you give Open Transport a single protocol name, it checks its defaults to determine which lower layers are missing. Thus, the shorter string <P>
<PRE>
<A NAME=MARKER-0-95></A>&quot;adsp&quot; 
</PRE>
 also describes an identical ADSP endpoint provider (if you have the Printer port configured in the AppleTalk control panel). Likewise, if you skip a protocol layer in the string, Open Transport uses its defaults to try to complete it. For instance, the specification &quot;<CODE>tcp,enet</CODE>&quot; is incomplete because the Transmission Control Protocol (TCP) does not have direct access to Ethernet, so Open Transport puts the default Internet Protocol (IP) between TCP and Ethernet.<P>
 You can also specify options as part of the configuration string. To do this, you need to know which protocols use which options and how to translate the option's constant name, given in the header files, into a string that the configuration functions can parse. See the TCP/IP and AppleTalk chapters for lists of their protocol-specific options and their equivalent string values. But for a simple example, the following configuration string<P>
<PRE>
<A NAME=MARKER-0-95></A>&quot;adsp,ddp(Checksum=1)&quot; 
</PRE>
 describes an ADSP endpoint provider with the DDP checksum option enabled.<P>
 If you want to identify a particular port in the configuration string, you use the port name to do so. Port names are documented in the chapter "Ports". More typically, however, you leave this value blank--for example, using only <CODE>"adsp"</CODE> or &quot;<CODE>adsp, ddp</CODE>&quot;<CODE>,</CODE> which configures the provider with whatever port is specified in the AppleTalk control panel. <P>
 Most protocols have a literal string value that you can use to configure providers. For example, DDP uses &quot;ddp&quot; and ADSP uses &quot;adsp&quot;. There are also constants that identify each protocol, such as <CODE>kDDPName</CODE> and <CODE>kADSPName</CODE>. For a complete list of the AppleTalk constant-string equivalents, see the chapter <A HREF=NetworkingWOT-57.html#HEADING-0-57>"Introduction to AppleTalk"</A> in this book. For information on specifying TCP/IP services, see the chapter <A HREF=NetworkingWOT-51.html#HEADING-0-51>"TCP/IP Services"</A>. <P>
 You can use either a constant or a literal value to create a provider that does not use options and that adheres to the default protocol layering. For example, to configure a DDP endpoint, you could use either of the following lines of code:<P>
<PRE>
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration(&quot;ddp&quot;), 0, NULL, &amp;err); 
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration(kDDPName), 0, NULL, &amp;err);
</PRE>
 To configure more complex providers, it is easier to use the literal strings. Using the constant can be confusing, shown by a comparison of the following lines of code: <P>
<PRE>
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration
      (&quot;adsp(EnableEOM=1),ddp,ltlkB&quot;), 0, NULL, &amp;err) 
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration
      (kADSPName&quot;(EnableEOM=1),&quot;kDDPName&quot;,ltlkB&quot;), 0, NULL, &amp;err);
</PRE>
 Some configurations are not valid and the <CODE>OTCreateConfiguration</CODE> function will return an error if you try to create one. For example, trying to layer ADSP on top of IP will not work.<P>
<A NAME=HEADING18-21></A>
<H2>Opening a Provider</H2>
 You can pass the pointer returned by the function <CODE>OTCreateConfiguration</CODE> to the function that opens the provider, for example, the <CODE>OTOpenEndpoint</CODE> function. Typically, you call the <CODE>OTCreateConfiguration</CODE> function inline while calling the function that creates and opens a provider. Here is an example<P>
<PRE>
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration(&quot;ddp&quot;), 0, NULL, &amp;err); 
</PRE>
 The function you use to open a provider returns a provider reference. You must specify that provider reference whenever you call a function for that provider. For example, if you open an endpoint provider, you must specify its provider reference when you call a function that sends or receives data.<P>
<A NAME=HEADING18-25></A>
<H2><A NAME=MARKER-13-41></A><A NAME=MARKER-9-42></A>Reusing Provider Configurations</H2>
 The functions used to open providers take a pointer to the configuration structure as input, but as part of their processing, they dispose of the original configuration structure. Since typically you use the <CODE>OTCreateConfiguration</CODE> function to create a single provider at a time, this does not present a problem. Occasionally, however, you may want to reuse a configuration structure to create a second identical provider, or you may want to reuse a configuration for which you do not have the configuration string. <P>
 The only way to reuse a configuration structure is to clone it with the <A NAME=MARKER-13-43></A><CODE>OTCloneConfiguration</CODE> function before opening your first provider. Cloning allows you to make multiple copies of the same configuration. For example, you might have only a pointer to a configuration structure, but you want to create ten endpoints, and so you need ten configuration structures. The moment you use the original pointer to create an endpoint, the configuration structure is gone. You can't call the <CODE>OTCreateConfiguration</CODE> function because you don't have the original configuration string; you were only passed the configuration structure. However, you can clone the original configuration structure before opening each endpoint. For additional information, see <A HREF=NetworkingWOT-33.html#MARKER-9-50>"Streamlining Endpoint Creation"</A>.<A NAME=MARKER-13-44></A><P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DT><A HREF="NetworkingWOT-18.html#HEADING18-2">Creating a Configuration Structure</A>
<DD>
<DT><A HREF="NetworkingWOT-18.html#HEADING18-21">Opening a Provider</A>
<DD>
<DT><A HREF="NetworkingWOT-18.html#HEADING18-25">Reusing Provider Configurations</A>
<DD>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-17.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-19.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
