<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Audio Unit Programming Guide: Tutorial: Building a Simple Effect Unit with a Generic View</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Tutorial: Building a Simple Effect Unit with a Generic View"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40003278-CH5" title="Tutorial: Building a Simple Effect Unit with a Generic View"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000428" target="_top">Audio</a> &gt; <a href="../../../CoreAudio-date.html#//apple_ref/doc/uid/TP30000440-TP30000428-TP30000500" target="_top">Core Audio</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40003278-CH1-SW2">Audio Unit Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AQuickTouroftheCoreAudioSDK/AQuickTouroftheCoreAudioSDK.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AudioUnitClassHierarchy/AudioUnitClassHierarchy.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40003278-CH5-SW4" title="Tutorial: Building a Simple Effect Unit with a Generic View"></a><h1>Tutorial: Building a Simple Effect Unit with a Generic View</h1><p>This tutorial chapter leads you through the complete design and development of an effect unit with a generic view. As you work through this tutorial, you take a big step in learning how to develop your own audio units.</p><p>The format of this chapter lets you complete it successfully without having read any of the preceding material. However, to understand what you’re doing, you need to understand the information in <span class="content_text"><a href="../AudioUnitDevelopmentFundamentals/AudioUnitDevelopmentFundamentals.html#//apple_ref/doc/uid/TP40003278-CH7-SW5">“Audio Unit Development Fundamentals”</a></span> and <span class="content_text"><a href="../TheAudioUnit/TheAudioUnit.html#//apple_ref/doc/uid/TP40003278-CH12-SW1">“The Audio Unit.”</a></span></p><p>In particular, to gain the most from this chapter, you should understand:</p><ul class="ul"><li class="li"><p>Properties, parameters, and factory presets</p></li><li class="li"><p>Audio unit types, subtypes, manufacturer IDs, and version numbers</p></li><li class="li"><p>Audio unit life cycle including instantiation, initialization, and rendering</p></li><li class="li"><p>The role of the Core Audio SDK in audio unit development</p></li><li class="li"><p>The role of the AU Lab application and the <code>auval</code> tool in audio unit development</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_51">Overview</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW3">Install the Core Audio Development Kit</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_52">Specify the Function of Your Audio Unit</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW6">Design the Parameter Interface</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_53">Design the Factory Presets</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_54">Collect Configuration Information for the Audio Unit Bundle</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW2">Set Your Company Name in Xcode</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_55">Create and Configure the Project</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW10">Test the Unmodified Audio Unit</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_56">Implement the Parameter Interface</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_57">Implement the Factory Presets Interface</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW8">Implement Signal Processing</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_66">Implement the Tail Time Property</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_67">Validate your Completed Audio Unit</a>
				
			<br/>
			
        
			
			
				<a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW9">Test your Completed Audio Unit</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_51" title="Overview"></a><h2>Overview</h2><p>“Simple” effect units operate on individual audio samples without considering one audio sample’s relationship to another, and without using a processing buffer. You build such an effect unit in this chapter, further simplified by leaving out some advanced audio unit features: a custom view and custom properties.</p><p>Simple effect units can do very basic DSP, such as:</p><ul class="ul"><li class="li"><p>Change level</p></li><li class="li"><p>Add tremolo</p></li></ul><p>Monaural tremolo is a continuous wavering produced by varying an audio channel’s gain at low frequency, on the order of a few Hertz. This figure illustrates monaural tremolo that varies from full gain to silence:</p><br/><div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_80" title="Figure 5-1Monaural tremolo"></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>Monaural tremolo</p><img src = "../Art/au_sine_wave.jpg" alt = "Monaural tremolo" ></div><br/><p>Stereo tremolo is similar but involves continuous left/right panning at a low frequency.</p><p>In this chapter you design and build a monaural tremolo effect that uses the generic view. The steps, described in detail in the following sections, are:</p><ol class="ol"><li class="li"><p>Install the Core Audio development kit if you haven't already done so.</p></li><li class="li"><p>Perform some design work, including:</p><ul class="ul"><li class="li"><p>Specify the sort of DSP your audio unit will perform</p></li><li class="li"><p>Design the parameter interface</p></li><li class="li"><p>Design the factory preset interface</p></li><li class="li"><p>Determine the configuration information for your audio unit bundle, such as the subtype and manufacturer codes, and the version number</p></li></ul></li><li class="li"><p>Create and configure the Xcode project.</p></li><li class="li"><p>Implement your audio unit:</p><ul class="ul"><li class="li"><p>Implement the parameter and preset interfaces.</p></li><li class="li"><p>Implement signal processing—the heart of your audio unit.</p></li></ul></li><li class="li"><p>Finally, validate and test your audio unit.</p></li></ol><p>Your development environment for building any audio unit—simple or otherwise—should include the pieces described under <span class="content_text"><a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40003278-CH1-SW1">“Required Tools for Audio Unit Development”</a></span> in the <span class="content_text"><a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40003278-CH1-SW2">“Introduction.”</a></span> You do not need to refer to the Xcode documentation or the Core Audio SDK documentation to complete the tasks in this chapter.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW3" title="Install the Core Audio Development Kit"></a><h2>Install the Core Audio Development Kit</h2><ol class="ol"><li class="li"><p>If you haven’t already done so, install the most recent Core Audio SDK. It is part of the Xcode Tools installation on the Mac OS X DVD. You can also download it from Apple’s developer website at this location:</p><p><span class="content_text"><a href="http://developer.apple.com/sdk/" target="_top">http://developer.apple.com/sdk/</a></span></p><p>The Core Audio SDK installer places C++ superclasses, example Xcode projects, and documentation at this location on your system:</p><p><code>/Developer/Examples/CoreAudio</code></p><p>The SDK also installs Xcode project templates for audio units at this location on your system:</p><p><code>/Library/Application Support/Apple/Developer Tools/Project Templates/</code></p></li><li class="li"><p>After you have installed the SDK, confirm that Xcode recognizes the audio unit templates, as follows:</p><ul class="ul"><li class="li"><p>Launch Xcode and then choose File > New Project.</p></li><li class="li"><p>In the Assistant window, confirm that there is an Audio Units group.</p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_81" title="Figure 5-2Confirming that the audio unit templates are installed"></a><p><strong>Figure 5-2&nbsp;&nbsp;</strong>Confirming that the audio unit templates are installed</p><img src = "../Art/new_project_assistant.jpg" alt = "Confirming that the audio unit templates are installed" ></div><p>Having confirmed the presence of the Audio Units template group, click Cancel, and then quit Xcode.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_82" title="Note"></a><p><strong>Note:</strong>&nbsp;If there is no Audio Units template group, check whether the SDK files were indeed installed as expected. If not, try installing again. Also make sure you are using the newest version of Xcode.</p></div></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_52" title="Specify the Function of Your Audio Unit"></a><h2>Specify the Function of Your Audio Unit</h2><p>With tools in place, you begin your development of an effect unit by describing its digital signal processing. In this case, you specify an audio unit that provides monaural tremolo at a user selectable rate. You’ll implement the DSP later, but establishing a bird’s eye view up front lets you narrow down the implementation steps.</p><p>Next, pick an audio unit type based on the function the audio unit will perform. Look through the various types of standard audio units in the <code>AUComponent.h</code> file in the Audio Unit framework. Also, refer to the descriptions of types in <em>Audio Unit Specification</em>. The <code>kAudioUnitType_Effect</code>, with four-character code of <code>'aufx'</code>, looks appropriate for this purpose.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW6" title="Design the Parameter Interface"></a><h2>Design the Parameter Interface</h2><p>In this section you work out the parameter portion of the programmatic interface between your audio unit and its view. End users will vary these parameters to control your audio unit in real time.</p><p>First, specify which sound attributes you’d like the user to be able to control. For this project, use the following:</p><ul class="ul"><li class="li"><p>Tremolo frequency—the number of tremolo cycles per second.</p></li><li class="li"><p>Tremolo depth—the mix between the input signal and the signal with tremolo applied. At a depth of 0%, there is no tremolo effect. At a depth of 100%, the effect ranges from full amplitude to silence.</p></li><li class="li"><p>Tremolo waveform—the shape of the tremolo effect, such as sine wave or square wave.</p></li></ul><p>Second, specify for each parameter:</p><ul class="ul"><li class="li"><p><em>User interface name</em> as it appears in the audio unit view</p></li><li class="li"><p><em>Programmatic name</em>, also called the parameter ID, used in the <code><!--a-->GetParameterInfo<!--/a--></code> method in the audio unit implementation file</p></li><li class="li"><p><em>Unit of measurement</em>, such as gain, decibels, or hertz</p></li><li class="li"><p><em>Minimum value</em></p></li><li class="li"><p><em>Maximum value</em></p></li><li class="li"><p><em>Default value</em></p></li></ul><p>The following tables specify the parameter design. You'll use most of these values directly in your code. Specifying a "Description" is for your benefit while developing and extending the audio unit. You can reuse the description later in online help or a user guide.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_83" title="Table 5-1Specification of tremolo frequency parameter"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-1&nbsp;&nbsp;</strong>Specification of tremolo frequency parameter</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>User interface name</p></td><td ><p>Frequency</p></td></tr><tr><td  scope="row"><p>Description</p></td><td ><p>The frequency of the tremolo effect. When this parameter is set to 2 Hz, there are two cycles of the tremolo effect per second. This parameter’s value is continuous, so the user can set any value within the available range. The user adjusts tremolo frequency with a slider.</p></td></tr><tr><td  scope="row"><p>Programmatic name</p></td><td ><p><code>kTremolo_Frequency</code></p></td></tr><tr><td  scope="row"><p>Unit of measurement</p></td><td ><p>Hz</p></td></tr><tr><td  scope="row"><p>Minimum value</p></td><td ><p>0.5</p></td></tr><tr><td  scope="row"><p>Maximum value</p></td><td ><p>10.0</p></td></tr><tr><td  scope="row"><p>Default value</p></td><td ><p>2.0</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_84" title="Table 5-2Specification of tremolo depth parameter"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-2&nbsp;&nbsp;</strong>Specification of tremolo depth parameter</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>User interface name</p></td><td ><p>Depth</p></td></tr><tr><td  scope="row"><p>Description</p></td><td ><p>The depth, or intensity, of the tremolo effect. When set to 0%, there is no tremolo effect. When set to 100%, the tremolo effect ranges over each cycle from silence to unity gain. This parameter’s value is continuous, so the user can set any value within the available range. The user adjusts tremolo depth with a slider.</p></td></tr><tr><td  scope="row"><p>Programmatic name</p></td><td ><p><code>kTremolo_Depth</code></p></td></tr><tr><td  scope="row"><p>Unit of measurement</p></td><td ><p>Percent</p></td></tr><tr><td  scope="row"><p>Minimum value</p></td><td ><p>0.0</p></td></tr><tr><td  scope="row"><p>Maximum value</p></td><td ><p>100.0</p></td></tr><tr><td  scope="row"><p>Default value</p></td><td ><p>50.0</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_85" title="Table 5-3Specification of tremolo waveform parameter"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-3&nbsp;&nbsp;</strong>Specification of tremolo waveform parameter</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>User interface name</p></td><td ><p>Waveform</p></td></tr><tr><td  scope="row"><p>Description</p></td><td ><p>The waveform that the tremolo effect follows. This parameter can take on a set of discrete values. The user picks a tremolo waveform from a menu.</p></td></tr><tr><td  scope="row"><p>Programmatic name</p></td><td ><p><code>kTremolo_Waveform</code></p></td></tr><tr><td  scope="row"><p>Unit of measurement</p></td><td ><p>Indexed</p></td></tr><tr><td  scope="row"><p>one value</p></td><td ><p>Sine</p></td></tr><tr><td  scope="row"><p>another value</p></td><td ><p>Square</p></td></tr><tr><td  scope="row"><p>Default value</p></td><td ><p>Sine</p></td></tr></table></div><p>It's easy to add, delete, and refine parameters later. For example, if you were creating an audio level adjustment parameter, you might start with a linear scale and later change to a logarithmic scale. For the tremolo unit you're building, you might later decide to add additional tremolo waveforms.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_53" title="Design the Factory Presets"></a><h2>Design the Factory Presets</h2><p>Now that you’ve specified the parameters, you can specify interesting combinations of settings, or factory presets. For the tremolo unit, specify two factory presets. These two, invented for this tutorial, provide two easily distinguishable effects:</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_86" title="Table 5-4Specification of Slow &amp;amp; Gentle factory preset"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-4&nbsp;&nbsp;</strong>Specification of Slow &amp; Gentle factory preset</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>User interface name</p></td><td ><p>Slow &amp; Gentle</p></td></tr><tr><td  scope="row"><p>Description</p></td><td ><p>A gentle waver</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Frequency</code> value</p></td><td ><p>2.0 Hz</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Depth</code> value</p></td><td ><p>50%</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Waveform</code> value</p></td><td ><p>Sine</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_87" title="Table 5-5Specification of Fast &amp;amp; Hard factory preset"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-5&nbsp;&nbsp;</strong>Specification of Fast &amp; Hard factory preset</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p>User interface name</p></td><td ><p>Fast &amp; Hard</p></td></tr><tr><td  scope="row"><p>Description</p></td><td ><p>Frenetic, percussive, and intense</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Frequency</code> value</p></td><td ><p>20.0 Hz</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Depth</code> value</p></td><td ><p>90%</p></td></tr><tr><td  scope="row"><p><code>kTremolo_Waveform</code> value</p></td><td ><p>Square</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_54" title="Collect Configuration Information for the Audio Unit Bundle"></a><h2>Collect Configuration Information for the Audio Unit Bundle</h2><p>Now determine your audio unit bundle’s configuration information, such as name and version number. You enter this information into your project’s source files, as described later in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW2">“Create and Configure the Xcode Project.”</a></span> Here's what you determine and collect up front:</p><ul class="ul"><li class="li"><p><em>Audio unit bundle English name</em>, such as Tremolo Unit. Host applications will display this name to let users pick your audio unit.</p></li><li class="li"><p><em>Audio unit programmatic name</em>, such as TremoloUnit. You’ll use this to name your Xcode project, which in turn uses this name for your audio unit’s main class.</p></li><li class="li"><p><em>Audio unit bundle version number</em>, such as 1.0.2.</p></li><li class="li"><p><em>Audio unit bundle brief description</em>, such as "Tremolo Unit version 1.0, copyright © 2006, Angry Audio." This description appears in the Version field of the audio unit bundle’s Get Info window in the Finder.</p></li><li class="li"><p><em>Audio unit bundle subtype</em>, a four-character code that provides some indication (to a person) of what your audio unit does. For this audio unit, use <code>'tmlo'</code>.</p></li><li class="li"><p><em>Company English name</em>, such as Angry Audio. This string appears in the audio unit generic view.</p></li><li class="li"><p><em>Company programmatic name</em>, such as <code>angryaudio</code>. You’ll use this string in the reverse domain name-style identifier for your audio unit.</p></li><li class="li"><p><em>Company four-character code</em>, such as <code>'Aaud'</code>.</p><p>You obtain this code from Apple, as a “creator code,“ by using the <span class="content_text"><a href="http://developer.apple.com/datatype/" target="_top">Data Type Registration</a></span> page. For the purposes of this example, for our fictitious company named Angry Audio, we'll use <code>'Aaud'</code>.</p></li><li class="li"><p><em>Reverse domain name identifier</em>, such as <code>com.angryaudio.audiounit.TremoloUnit</code>. The Component Manager will use this name when identifying your audio unit.</p></li><li class="li"><p><em>Custom icon</em>, for display in the Cocoa generic view—optional but a nice touch. This should be a so-called "Small" icon as built with Apple’s Icon Composer application, available on your system in the <code>/Developer/Applications/Utilities</code> folder.</p></li></ul><a name="//apple_ref/doc/uid/TP40003278-CH5-SW2" title="Set Your Company Name in Xcode"></a><h2>Set Your Company Name in Xcode</h2><p>Set your company name in Xcode (with Xcode not running) if you haven't already done so. Enter the following command in Terminal on one line:</p><div class="codesample"><table><tr><td scope="row"><pre>defaults write com.apple.Xcode PBXCustomTemplateMacroDefinitions '{ORGANIZATIONNAME = "Angry Audio";}'<span></span></pre></td></tr></table></div><p>Now that you have set this so called “expert” preference, Xcode places your company’s name in the copyright notice in the source files of any new project.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_55" title="Create and Configure the Project"></a><h2>Create and Configure the Project</h2><p>Now you create and configure an Xcode project for your audio unit. This section may seem long—it includes many steps and screenshots—but after you are familiar with the configuration process you can accomplish it in about five minutes.</p><p>Launch Xcode and follow these steps:</p><p>1. Choose File > New Project</p><p>2. In the New Project Assistant dialog, choose the Audio Unit Effect template and click Next.</p><br/><div><img src = "../Art/choose_template.jpg" alt = "Choose the Xcode template for the project" ></div><br/><p>3. Name the project TremoloUnit and specify a project directory. Then click Finish.</p><br/><div><img src = "../Art/project_name.jpg" alt = "image: ../Art/project_name.jpg" ></div><br/><p>Xcode creates the project files for your audio unit and the Xcode project window opens.</p><p>At this point, Xcode has used the audio unit project template file to create a subclass of the <code>AUEffectBase</code> class. Your custom subclass is named according to the name of your project. You can find your custom subclass’s implementation file, <code>TremoloUnit.cpp</code>, in the AU Source group in the Xcode Groups &amp; Files pane, shown next.</p><br/><div><img src = "../Art/project_window.jpg" alt = "image: ../Art/project_window.jpg" ></div><br/><p>In later steps, you'll edit methods in your custom subclass to override the superclass’s methods. <code>TremoloUnit.cpp</code> also contains a couple of methods from the <code>AUKernelBase</code> helper class; these are the methods that you later modify to perform digital signal processing.</p><p></p><p>4. With the AU Source group open as shown in the previous step, click <code>TremoloUnitVersion.h</code>. Then click the Editor toolbar button, if necessary, to display the text editor. There are three values to customize in this file: <code>kTremoloUnitVersion</code>,  <code>TremoloUnit_COMP_SUBTYPE</code>, and <code>TremoloUnit_COMP_MANF</code>.</p><p>Scroll down in the editing pane to the definitions of <code>TremoloUnit_COMP_SUBTYPE</code> and <code>TremoloUnit_COMP_MANF</code>. Customize the subtype field with the four-character subtype code that you've chosen. In this example, <code>'tmlo'</code> indicates (to developers and users) that the audio unit lets a user add tremolo.</p><br/><div><img src = "../Art/subtype_and_manuf.jpg" alt = "image: ../Art/subtype_and_manuf.jpg" ></div><br/><p>Also customize the manufacturer name with the unique four-character string that identifies your company.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_88" title="Note"></a><p><strong>Note:</strong>&nbsp;There is no <code>#define</code> statement for component type in the <code>TremoloUnitVersion.h</code> file because you specified the type—effect unit—when you picked the Xcode template for the audio unit. The audio unit bundle type is specified in the <code>AU Source/TremoloUnit.r</code> resource file.</p></div><p>Now set the version number for the audio unit. In the <code>TremoloUnitVersion.h</code> file, just above the definitions for subtype and manufacturer, you’ll see the definition statement for the <code>kTremoloUnitVersion</code> constant. By default, the template sets this constant’s value to 1.0.0, as represented by the hexadecimal number <code>0x00010000</code>. Change this, if you like. See <span class="content_text"><a href="../AudioUnitDevelopmentFundamentals/AudioUnitDevelopmentFundamentals.html#//apple_ref/doc/uid/TP40003278-CH7-SW1">“Audio Unit Identification”</a></span> for how to construct the hexadecimal version number.</p><p> Save the <code>TremoloUnitVersion.h</code> file.</p><p>5. Click the <code>TremoloUnit.r</code> resource file in the "Source/AU Source" group in the Groups &amp; Files pane. There are two values to customize in this file: <code>NAME</code> and <code>DESCRIPTION</code>.</p><ul class="ul"><li class="li"><p><code>NAME</code> is used by the generic view to display both your company name and the audio unit name</p></li><li class="li"><p><code>DESCRIPTION</code> serves as the menu item for users choosing your audio unit from within a host application.</p></li></ul><p>To work correctly with the generic view, the value for <code>NAME</code> must follow a specific pattern:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;company name>: &lt;audio unit name><span></span></pre></td></tr></table></div><p>For this example, use:</p><p><code>Angry Audio: Tremolo Unit</code></p><p> If you have set your company name using the Xcode expert preference as described earlier, it will already be in place in the <code>NAME</code> variable for this project; to follow this example, all you need to do is add a space between Tremolo and Unit in the audio unit name itself. </p><p>The Xcode template provides a default value for <code>DESCRIPTION</code>. If you customize it, keep it short so that the string works well with pop-up menus. The figure shows a customized <code>DESCRIPTION</code>.</p><br/><div><img src = "../Art/resource_file.jpg" alt = "image: ../Art/resource_file.jpg" ></div><br/><p>As you can see in the figure, the resource file uses a <code>#include</code> statement to import the Version header file that you customized in step 4, <code>TremoloUnitVersion.h</code>. The resource file uses values from that header file to define some variables such as component subtype (<code>COMP_SUBTYPE</code>) and manufacturer (<code>COMP_MANUF</code>).</p><p>Save the <code>TremoloUnit.r</code> resource file.</p><p>6. Open the Resources group in the Groups &amp; Files pane in the Xcode project window, and click on the <code>InfoPlist.strings</code> file.</p><br/><div><img src = "../Art/strings.jpg" alt = "image: ../Art/strings.jpg" ></div><br/><p>Using the editor, customize the value for <code>CFBundleGetInfoString</code> using the value you’ve chosen for the audio unit brief description. The figure provides an example. This string appears in the Version field of the audio unit bundle’s Get Info window in the Finder. Save the <code>InfoPlist.strings</code> file.</p><p></p><p>7. Open the Targets group in the Groups &amp; Files pane in the Xcode project window. Double-click the audio unit bundle, which has the same name as your project—in this case, TremoloUnit.</p><br/><div><img src = "../Art/target.jpg" alt = "image: ../Art/target.jpg" ></div><br/><p>The Target Info window opens. Click the Properties tab.</p><br/><div><img src = "../Art/target_info.jpg" alt = "image: ../Art/target_info.jpg" ></div><br/><p>In the Target Info window’s Properties tab, provide values for Identifier, Creator, Version, and, optionally, a path to a Finder icon file for the bundle that you place in the bundle’s <code>Resources</code> folder.</p><p>The audio unit bundle identifier field should follow the pattern:</p><p><code>com.&lt;company_name>.audiounit.&lt;audio_unit_name></code></p><p> For this example, use the identifier:</p><p><code>com.angryaudio.audiounit.TremoloUnit</code></p><p>For the Creator value, use the same four-character string used for the manufacturer field in step 4.</p><p>Xcode transfers all the information from the Properties tab into the audio unit bundle’s <code>Info.plist</code> file. You can open the <code>Info.plist</code> file, if you'd like to inspect it, directly from this dialog using the "Open Info.plist as File" button at the bottom of the window.</p><p>When finished, close the <code>Info.plist</code> file (if you've opened it) or close the Target Info window.</p><p>8. Now configure the Xcode project’s build process to copy your audio unit bundle to the appropriate location so that host applications can use it.</p><p>In the project window, disclose the Products group and the Targets group, as shown in the figure, so that you can see the icon for the audio unit bundle itself (<code>TremoloUnit.component</code>) as well as the build phases (under <code>Targets/TremoloUnit</code>).</p><br/><div><img src = "../Art/copy_files_1.jpg" alt = "image: ../Art/copy_files_1.jpg" ></div><br/><p>9. Now add a new build phase. Right-click (or control-click) the final build phase for TremoloUnit and choose Add > New Build Phase > New Copy Files Build Phase.</p><br/><div><img src = "../Art/copy_files_2.jpg" alt = "image: ../Art/copy_files_2.jpg" ></div><br/><p>The new Copy Files build phase appears at the end of the list, and a dialog opens, titled Copy Files Phase for "TremoloUnit" Info.</p><br/><div><img src = "../Art/copy_files_3.jpg" alt = "image: ../Art/copy_files_3.jpg" ></div><br/><p>Change the Destination pop-up to Absolute Path, as shown in the figure.</p><p>Enter the absolute destination path for the built audio unit bundle in the Full Path field.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_89" title="Note"></a><p><strong>Note:</strong>&nbsp;The copy phase will not work if you enter a tilde (<code>~</code>) character to indicate your home folder. In Xcode 2.4, the Full Path field will let you enter a path by dragging the destination folder into the text field only if you first click in the Full Path field.</p></div><p>You can use either of the valid paths for audio unit bundles, as described in <span class="content_text"><a href="../AudioUnitDevelopmentFundamentals/AudioUnitDevelopmentFundamentals.html#//apple_ref/doc/uid/TP40003278-CH7-SW2">“Audio Unit Installation and Registration.”</a></span> With the full path entered, close the dialog.</p><p>Now drag the <code>TremoloUnit.component</code> icon from the Products group to the new build phase.</p><br/><div><img src = "../Art/copy_files_4.jpg" alt = "image: ../Art/copy_files_4.jpg" ></div><br/><p>You can later change the Copy Files location, if you want, by double clicking the gray Copy Files build phase icon. Alternatively, click the Copy Files icon and then click the Info button in the toolbar.</p><p>At this point, you have have the makings for a working audio unit. You have not yet customized it to do whatever it is that you’ll have it do (in our present case, to provide a single-channel tremolo effect). It’s a good idea to ensure that you can build it without errors, that you can validate it with the auval tool, and that you can use it in a host application. Do this in the next step.</p><p>10. Build the project. You can do this in any of the standard ways: click the Build button in the toolbar, or choose Build from the Build button's menu, or choose Build > Build from the main menu, or type command-B.</p><br/><div><img src = "../Art/first_build.jpg" alt = "image: ../Art/first_build.jpg" ></div><br/><p>If everything is in order, your project will build without error.</p><p>The copy files build phase that you added in the previous step ensures that a copy of the audio unit bundle gets placed in the appropriate location for the Component Manager to find it when a host application launches. The next step ensures that is so, and lets you test that it works in a host application.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW10" title="Test the Unmodified Audio Unit"></a><h2>Test the Unmodified Audio Unit</h2><p>To test the newly built audio unit, use the AU Lab application:</p><ul class="ul"><li class="li"><p>Use the <code>auval</code> tool to verify that Mac OS X recognizes your new audio unit bundle</p></li><li class="li"><p>Launch the AU Lab application</p></li><li class="li"><p>Configure AU Lab to test your new audio unit, and test it</p></li></ul><p>Apple’s Core Audio team provides AU Lab in the <code>/Developer/Applications/Audio</code> folder, along with documentation. You do not need to refer to AU Lab’s documentation to complete this task. The <code>auval</code> command-line tool is part of a standard Mac OS X installation.</p><ol class="ol"><li class="li"><p>In Terminal, enter the command <code>auval -a</code>. If Mac OS X recognizes your new audio unit bundle, you see a listing similar to this one:</p></li></ol><br/><div><img src = "../Art/auval-a.jpg" alt = "image: ../Art/auval-a.jpg" ></div><br/><p>If your Xcode project builds without error, but you do not see the new audio unit bundle in the list reported by the <code>auval</code> tool, double check that you’ve entered the correct path in the Copy Files phase, as described in step 8 of <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW2">“Create and Configure the Xcode Project.”</a></span></p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_90" title="Note"></a><p><strong>Note:</strong>&nbsp;The next few steps in this tutorial will be familiar to you if you went through <span class="content_text"><a href="../AudioUnitDevelopmentFundamentals/AudioUnitDevelopmentFundamentals.html#//apple_ref/doc/uid/TP40003278-CH7-SW8">“Tutorial: Using an Audio Unit in a Host Application”</a></span> in <span class="content_text">“Audio Unit Development Fundamentals.”</span></p></div><p>2. Launch AU Lab and create a new AU Lab document. Unless you’ve configured AU Lab to use a default document style, the Create New Document window opens. If AU Lab was already running, choose File > New to get this window.</p><br/><div><img src = "../Art/au_lab_new_doc_1.jpg" alt = "image: ../Art/au_lab_new_doc_1.jpg" ></div><br/><p>Ensure that the configuration matches the settings shown in the figure: Built-In Audio for the Audio Device, Line In for the Input Source, and Stereo for Output Channels. Leave the window’s Inputs tab unconfigured; you will specify the input later. Click OK.</p><p>A new AU Lab window opens, showing the output channel you specified.</p><br/><div><img src = "../Art/au_lab_new_doc_2.jpg" alt = "image: ../Art/au_lab_new_doc_2.jpg" ></div><br/><p>3. Choose Edit > Add Audio Unit Generator. A dialog opens from the AU Lab window to let you specify the generator unit to serve as the audio source.</p><br/><div><img src = "../Art/au_lab_add_generator.jpg" alt = "image: ../Art/au_lab_add_generator.jpg" ></div><br/><p>In the dialog, ensure that the AUAudioFilePlayer unit is selected in the Generator pop-up. To follow this example, change the Group Name to Player. Click OK.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_91" title="Note"></a><p><strong>Note:</strong>&nbsp;You can change the group name at any time by double-clicking it in the AU Lab window.</p></div><p> The AU Lab window now shows a stereo input track. In addition, an inspector window has opened for the player unit. If you close the inspector, you can reopen it by clicking the rectangular "AU" button near the top of the Player track.</p><br/><div><img src = "../Art/au_lab_file_player_1.jpg" alt = "image: ../Art/au_lab_file_player_1.jpg" ></div><br/><p>4. Add an audio file to the Audio Files list in the player inspector window. Do this by dragging the audio file from the Finder, as shown. Putting an audio file in the player inspector window lets you send audio through the new audio unit. Just about any audio file will do, although a continuous tone is helpful for testing.</p><br/><div><img src = "../Art/au_lab_copy_sound_file.jpg" alt = "image: ../Art/au_lab_copy_sound_file.jpg" ></div><br/><p>Now AU Lab is configured and ready to test your audio unit.</p><p>5. Click the triangular menu button in the first row of the Effects section in the Player track, as shown in the figure.</p><br/><div><img src = "../Art/au_lab_add_effect_1.jpg" alt = "image: ../Art/au_lab_add_effect_1.jpg" ></div><br/><p>A menu opens, listing all the audio units available on your system, arranged by category and manufacturer. There is an Angry Audio group in the pop-up, as shown in the next figure.</p><p>Choose your new audio unit from the Effects first row pop-up.</p><br/><div><img src = "../Art/au_lab_add_effect_2.jpg" alt = "image: ../Art/au_lab_add_effect_2.jpg" ></div><br/><p>AU Lab opens your audio unit’s Cocoa generic view, which appears as a utility window.</p><br/><div><img src = "../Art/generic_view_1.jpg" alt = "image: ../Art/generic_view_1.jpg" ></div><br/><p>The generic view displays your audio unit’s interface as it comes directly from the parameter and property definitions supplied by the Xcode template. The template defines an audio unit that provides level adjustment. Its view, built by the AU Lab host application, features a Gain control. You modify the view in a later step in this task by changing your audio unit’s parameter definitions.</p><p>Refer to <span class="content_text"><a href="../TheAudioUnitView/TheAudioUnitView.html#//apple_ref/doc/uid/TP40003278-CH13-SW3">Table 3-1</a></span> for information on where you define each user interface element for the generic view.</p><p>6. Click the Play button in the AUAudioFilePlayer inspector to send audio through the unmodified audio unit. This lets you ensure that audio indeed passes through the audio unit. Vary the slider in the generic view, as you listen to the audio, to ensure that the parameter is working.</p><p>7. Save the AU Lab document for use later, giving it a name such as “Tremolo Unit Test.trak”. You will use it in the final section of this chapter, <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW9">“Test your Completed Audio Unit.”</a></span></p><p>Next, you'll define your tremolo effect unit’s parameter interface to give a user control over tremolo rate, depth, and waveform.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_56" title="Implement the Parameter Interface"></a><h2>Implement the Parameter Interface</h2><p>Up to this point in developing your audio unit, you have touched very little code. Here, you define the audio unit parameters by editing the source files for the audio unit custom subclass: <code>TremoloUnit.h</code> and <code>TremoloUnit.cpp</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_92" title="Note"></a><p><strong>Note:</strong>&nbsp;There are many steps to perform in this and the remaining tasks in this chapter. It’s a good idea to build your audio unit bundle after each section to check for errors and then correct them.</p></div><p>To define audio unit parameters you do three things:</p><ul class="ul"><li class="li"><p>Name the parameters and give them values in the custom subclass’s header file</p></li><li class="li"><p>Add statements to the audio unit’s constructor method to set up the parameters when the audio unit is instantiated</p></li><li class="li"><p>Override the <code><!--a-->GetParameterInfo<!--/a--></code> method from the SDK’s <code>AUBase</code> class, in the custom subclass’s implementation file, to define the parameters</p></li></ul><p>The code you implement here does not make use of the parameters, per se. It is the DSP code that you implement later, in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW8">“Implement Signal Processing,”</a></span> that makes use of the parameters. Here, you are simply defining the parameters so that they will appear in the audio unit generic view and so that they’re ready to use when you implement the DSP code.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW5" title="Name the Parameters and Set Values"></a><h3>Name the Parameters and Set Values</h3><p>First, name your audio unit’s parameters and provide values for them. Do this by replacing the default parameter definition code in the <code>TremoloUnit.h</code> header file, provided by the Xcode template, with the following code. This listing implements the parameter design from the tables in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW6">“Design the Parameter Interface.”</a></span></p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW11" title="Listing 5-1Parameter names and values (TremoloUnit.h)"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Parameter names and values (<code>TremoloUnit.h</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____TremoloUnit Parameter Constants<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static CFStringRef kParamName_Tremolo_Freq      = CFSTR ("Frequency");    // 1<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kDefaultValue_Tremolo_Freq   = 2.0;                    // 2<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kMinimumValue_Tremolo_Freq   = 0.5;                    // 3<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kMaximumValue_Tremolo_Freq   = 20.0;                   // 4<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static CFStringRef kParamName_Tremolo_Depth     = CFSTR ("Depth");        // 5<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kDefaultValue_Tremolo_Depth  = 50.0;<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kMinimumValue_Tremolo_Depth  = 0.0;<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kMaximumValue_Tremolo_Depth  = 100.0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static CFStringRef kParamName_Tremolo_Waveform  = CFSTR ("Waveform");     // 6<span></span></pre></td></tr><tr><td scope="row"><pre>static const int kSineWave_Tremolo_Waveform     = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>static const int kSquareWave_Tremolo_Waveform   = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>static const int kDefaultValue_Tremolo_Waveform = kSineWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// menu item names for the waveform parameter<span></span></pre></td></tr><tr><td scope="row"><pre>static CFStringRef kMenuItem_Tremolo_Sine       = CFSTR ("Sine");         // 7<span></span></pre></td></tr><tr><td scope="row"><pre>static CFStringRef kMenuItem_Tremolo_Square     = CFSTR ("Square");       // 8<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// parameter identifiers<span></span></pre></td></tr><tr><td scope="row"><pre>enum {                                                                    // 9<span></span></pre></td></tr><tr><td scope="row"><pre>    kParameter_Frequency  = 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    kParameter_Depth      = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kParameter_Waveform   = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kNumberOfParameters   = 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Provides the user interface name for the Frequency (<code>kParamName_Tremolo_Freq</code>) parameter.</p></li><li class="li"><p>Defines a constant for the default value for the Frequency parameter for the tremolo unit, anticipating a unit of Hertz to be defined in the implementation file.</p></li><li class="li"><p>Defines a constant for the minimum value for the Frequency parameter.</p></li><li class="li"><p>Defines a constant for the maximum value for the Frequency parameter.</p></li><li class="li"><p>Provides a user interface name for the Depth (<code>kParamName_Tremolo_Depth</code>) parameter. The following three lines define constants for the default, minimum, and maximum values for the Depth parameter.</p></li><li class="li"><p>Provides a user interface name for the Waveform (<code>kParamName_Tremolo_Waveform</code>) parameter. The following three lines define constants for the minimum, maximum, and default values for the Waveform parameter.</p></li><li class="li"><p>Defines the menu item string for the sine wave option for the Waveform parameter.</p></li><li class="li"><p>Defines the menu item string for the square wave option for the Waveform parameter.</p></li><li class="li"><p>Defines constants for identifying the parameters; defines the total number of parameters.</p></li></ol><p>For each parameter you’ve defined in the <code>TremoloUnit.h</code> file, your audio unit needs:</p><ul class="spaceabove"><li class="li"><p>A corresponding <code>SetParameter</code> statement in the constructor method, as described next in <span class="content_text">“Edit the Constructor Method”</span></p></li><li class="li"><p>A corresponding parameter definition in the <code>GetParameterInfo</code> method, as described later in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW1">“Define the Parameters”</a></span></p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_93" title="Note"></a><p><strong>Note:</strong>&nbsp;At this point, building your audio unit will fail because you have not yet edited the implementation file, <code>TremoloUnit.cpp</code>, to use the new parameter definitions. You work on the <code>TremoloUnit.cpp</code> file in the next few sections.</p></div><a name="//apple_ref/doc/uid/TP40003278-CH5-SW7" title="Edit the Constructor Method"></a><h3>Edit the Constructor Method</h3><p>Next, replace the custom subclass constructor method in the <code>TremoloUnit.cpp</code> file with the code in this section. This code instantiates the audio unit, which includes setting up the parameter names and values that you defined in the previous section.</p><p>For now, the <code>SetParameter</code> statements shown here are the only lines to customize in the constructor method. In a later step you'll add code to define the default factory preset. </p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_94" title="Listing 5-2Setting parameters in the constructor (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>Setting parameters in the constructor (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>TremoloUnit::TremoloUnit (AudioUnit component) : AUEffectBase (component) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CreateElements ();<span></span></pre></td></tr><tr><td scope="row"><pre>    Globals () -> UseIndexedParameters (kNumberOfParameters);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetParameter (                                       // 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kParameter_Frequency,<span></span></pre></td></tr><tr><td scope="row"><pre>        kDefaultValue_Tremolo_Freq<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetParameter (                                       // 2<span></span></pre></td></tr><tr><td scope="row"><pre>        kParameter_Depth,<span></span></pre></td></tr><tr><td scope="row"><pre>        kDefaultValue_Tremolo_Depth<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetParameter (                                       // 3<span></span></pre></td></tr><tr><td scope="row"><pre>        kParameter_Waveform,<span></span></pre></td></tr><tr><td scope="row"><pre>        kDefaultValue_Tremolo_Waveform<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    #if AU_DEBUG_DISPATCHER<span></span></pre></td></tr><tr><td scope="row"><pre>        mDebugDispatcher = new AUDebugDispatcher (this);<span></span></pre></td></tr><tr><td scope="row"><pre>    #endif<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Sets up the first parameter for the audio unit, based on values from the header file. In this project, this parameter controls tremolo frequency. The <code><!--a-->SetParameter<!--/a--></code> method is inherited from superclasses in the Core Audio SDK.</p></li><li class="li"><p>Sets up the second parameter for the audio unit, based on values from the header file.  In this project, this parameter controls tremolo depth.</p></li><li class="li"><p>Sets up the third parameter for the audio unit, based on values from the header file.  In this project, this parameter controls the tremolo waveform.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-SW1" title="Define the Parameters"></a><h3>Define the Parameters</h3><p>Replace the default override of the <code>GetParameterInfo</code> method from the Xcode template, which defines just one default (Gain) parameter. Here, use the three-parameter design described earlier in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW6">“Design the Parameter Interface.”</a></span> </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_95" title="Note"></a><p><strong>Note:</strong>&nbsp;You may want to refer to <span class="content_text"><a href="../TheAudioUnit/TheAudioUnit.html#//apple_ref/doc/uid/TP40003278-CH12-SW15">“Defining and Using Parameters”</a></span> in <span class="content_text">“The Audio Unit”</span> for a description of the role this method plays in the operation of an audio unit. You may want to refer to <span class="content_text"><a href="../TheAudioUnit/TheAudioUnit.html#//apple_ref/doc/uid/TP40003278-CH12-SW21">“Audio Unit Scopes”</a></span> for background on the Global scope as used in this method.</p></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_96" title="Listing 5-3The customized GetParameterInfo method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>The customized <code>GetParameterInfo</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____Parameters<span></span></pre></td></tr><tr><td scope="row"><pre>ComponentResult TremoloUnit::GetParameterInfo (<span></span></pre></td></tr><tr><td scope="row"><pre>        AudioUnitScope          inScope,<span></span></pre></td></tr><tr><td scope="row"><pre>        AudioUnitParameterID    inParameterID,<span></span></pre></td></tr><tr><td scope="row"><pre>        AudioUnitParameterInfo  &amp;outParameterInfo<span></span></pre></td></tr><tr><td scope="row"><pre>) {<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentResult result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    outParameterInfo.flags =    kAudioUnitParameterFlag_IsWritable        // 1<span></span></pre></td></tr><tr><td scope="row"><pre>                                | kAudioUnitParameterFlag_IsReadable;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (inScope == kAudioUnitScope_Global) {                              // 2<span></span></pre></td></tr><tr><td scope="row"><pre>        switch (inParameterID) {<span></span></pre></td></tr><tr><td scope="row"><pre>            case kParameter_Frequency:                                    // 3<span></span></pre></td></tr><tr><td scope="row"><pre>                AUBase::FillInParameterName (<span></span></pre></td></tr><tr><td scope="row"><pre>                    outParameterInfo,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParamName_Tremolo_Freq,<span></span></pre></td></tr><tr><td scope="row"><pre>                    false<span></span></pre></td></tr><tr><td scope="row"><pre>                );<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.unit =                                   // 4<span></span></pre></td></tr><tr><td scope="row"><pre>                    kAudioUnitParameterUnit_Hertz;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.minValue =                               // 5<span></span></pre></td></tr><tr><td scope="row"><pre>                        kMinimumValue_Tremolo_Freq;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.maxValue =                               // 6<span></span></pre></td></tr><tr><td scope="row"><pre>                        kMaximumValue_Tremolo_Freq;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.defaultValue =                           // 7<span></span></pre></td></tr><tr><td scope="row"><pre>                        kDefaultValue_Tremolo_Freq;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.flags                                    // 8<span></span></pre></td></tr><tr><td scope="row"><pre>                        |= kAudioUnitParameterFlag_DisplayLogarithmic;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            case kParameter_Depth:                                        // 9<span></span></pre></td></tr><tr><td scope="row"><pre>                AUBase::FillInParameterName (<span></span></pre></td></tr><tr><td scope="row"><pre>                    outParameterInfo,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParamName_Tremolo_Depth,<span></span></pre></td></tr><tr><td scope="row"><pre>                    false<span></span></pre></td></tr><tr><td scope="row"><pre>                );<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.unit =                                   // 10<span></span></pre></td></tr><tr><td scope="row"><pre>                    kAudioUnitParameterUnit_Percent;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.minValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                    kMinimumValue_Tremolo_Depth;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.maxValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                    kMaximumValue_Tremolo_Depth;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.defaultValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                     kDefaultValue_Tremolo_Depth;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            case kParameter_Waveform:                                     // 11<span></span></pre></td></tr><tr><td scope="row"><pre>                AUBase::FillInParameterName (<span></span></pre></td></tr><tr><td scope="row"><pre>                    outParameterInfo,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParamName_Tremolo_Waveform,<span></span></pre></td></tr><tr><td scope="row"><pre>                    false<span></span></pre></td></tr><tr><td scope="row"><pre>                );<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.unit =                                   // 12<span></span></pre></td></tr><tr><td scope="row"><pre>                    kAudioUnitParameterUnit_Indexed;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.minValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                    kSineWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.maxValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                    kSquareWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre>                outParameterInfo.defaultValue =<span></span></pre></td></tr><tr><td scope="row"><pre>                    kDefaultValue_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            default:<span></span></pre></td></tr><tr><td scope="row"><pre>                result = kAudioUnitErr_InvalidParameter;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        result = kAudioUnitErr_InvalidParameter;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Adds two flags to all parameters for the audio unit, indicating to the host application that it should consider all the audio unit’s parameters to be readable and writable.</p></li><li class="li"><p>All three parameters for this audio unit are in the “global” scope.</p></li><li class="li"><p>The first case in the switch statement, invoked when the view needs information for the <code>kTremolo_Frequency</code> parameter, defines how to represent this parameter in the user interface.</p></li><li class="li"><p>Sets the unit of measurement for the Frequency parameter to Hertz.</p></li><li class="li"><p>Sets the minimum value for the Frequency parameter.</p></li><li class="li"><p>Sets the maximum value for the Frequency parameter.</p></li><li class="li"><p>Sets the default value for the Frequency parameter</p></li><li class="li"><p>Adds a flag to indicate to the host that it should use a logarithmic control for the Frequency parameter.</p></li><li class="li"><p>The second case in the switch statement, invoked when the view needs information for the <code>kTremolo_Depth</code> parameter, defines how to represent this parameter in the user interface.</p></li><li class="li"><p>Sets the unit of measurement for the Depth parameter to percentage. The following three statements set the minimum, maximum, and default values for the Depth parameter.</p></li><li class="li"><p>The third case in the switch statement, invoked when the view needs information for the <code>kTremolo_Waveform</code> parameter, defines how to represent this parameter in the user interface.</p></li><li class="li"><p>Sets the unit of measurement for the Waveform parameter to “indexed,“ allowing it to be displayed as a pop-up menu in the generic view. The following three statements set the minimum, maximum, and default values for the depth parameter. All three are required for proper functioning of the parameter’s user interface.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-SW13" title="Provide Strings for the Waveform Pop-up Menu"></a><h3>Provide Strings for the Waveform Pop-up Menu</h3><p>Now you implement the <code><!--a-->GetParameterValueStrings<!--/a--></code> method, which lets the audio unit’s generic view display the waveform parameter as a pop-up menu.</p><p>A convenient location for this code is after the <code>GetParameterInfo</code> method definition. If you add this method here as suggested, be sure to delete the placeholder method provided by the Xcode template elsewhere in the implementation file.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_97" title="Listing 5-4The customized GetParameterValueStrings method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-4&nbsp;&nbsp;</strong>The customized <code>GetParameterValueStrings</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>ComponentResult TremoloUnit::GetParameterValueStrings (<span></span></pre></td></tr><tr><td scope="row"><pre>    AudioUnitScope          inScope,<span></span></pre></td></tr><tr><td scope="row"><pre>    AudioUnitParameterID    inParameterID,<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayRef              *outStrings<span></span></pre></td></tr><tr><td scope="row"><pre>) {<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((inScope == kAudioUnitScope_Global) &amp;&amp;             // 1<span></span></pre></td></tr><tr><td scope="row"><pre>        (inParameterID == kParameter_Waveform)) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (outStrings == NULL) return noErr;              // 2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFStringRef strings [] = {                         // 3<span></span></pre></td></tr><tr><td scope="row"><pre>            kMenuItem_Tremolo_Sine,<span></span></pre></td></tr><tr><td scope="row"><pre>            kMenuItem_Tremolo_Square<span></span></pre></td></tr><tr><td scope="row"><pre>        };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        *outStrings = CFArrayCreate (                      // 4<span></span></pre></td></tr><tr><td scope="row"><pre>            NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            (const void **) strings,<span></span></pre></td></tr><tr><td scope="row"><pre>            (sizeof (strings) / sizeof (strings [0])),     // 5<span></span></pre></td></tr><tr><td scope="row"><pre>            NULL<span></span></pre></td></tr><tr><td scope="row"><pre>        );<span></span></pre></td></tr><tr><td scope="row"><pre>        return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return kAudioUnitErr_InvalidParameter;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>This method applies only to the waveform parameter, which is in the global scope.</p></li><li class="li"><p>When this method gets called by the <code><!--a-->AUBase::DispatchGetPropertyInfo<!--/a--></code> method, which provides a null value for the <em>outStrings</em> parameter, just return without error.</p></li><li class="li"><p>Defines an array that contains the pop-up menu item names.</p></li><li class="li"><p>Creates a new immutable array containing the menu item names, and places the array in the <em>outStrings</em> output parameter.</p></li><li class="li"><p>Calculates the number of menu items in the array.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_57" title="Implement the Factory Presets Interface"></a><h2>Implement the Factory Presets Interface</h2><p>Next, you define the audio unit factory presets, again by editing the source files for the audio unit custom subclass, <code>TremoloUnit.h</code> and <code>TremoloUnit.cpp</code>.</p><p>The steps, described in detail below, are:</p><ul class="ul"><li class="li"><p>Name the factory presets and give them values.</p></li><li class="li"><p>Modify the TremoloUnit class declaration by adding method signatures for handling factory presets.</p></li><li class="li"><p>Edit the audio unit’s constructor method to set a default factory preset.</p></li><li class="li"><p>Override the <code><!--a-->GetPresets<!--/a--></code> method to set up a factory presets array.</p></li><li class="li"><p>Override the <code><!--a-->NewFactoryPresetSet<!--/a--></code> method to define the factory presets.</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_98" title="Note"></a><p><strong>Note:</strong>&nbsp;The work you do here does not make use of the factory presets, per se. It is the DSP code that you implement in <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW8">“Implement Signal Processing”</a></span> that makes use of the presets. Here, you are simply defining the presets so that they will appear in the audio unit generic view and so that they're ready to use when you implement the DSP code.</p></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_58" title="Name the Factory Presets and Give Them Values"></a><h3>Name the Factory Presets and Give Them Values</h3><p>Define the constants for the factory presets. A convenient location for this code in the <code>TremoloUnit.h</code> header file is below the parameter constants section.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_99" title="Listing 5-5Factory preset names and values (TremoloUnit.h)"></a><p class="codesample"><strong>Listing 5-5&nbsp;&nbsp;</strong>Factory preset names and values (<code>TremoloUnit.h</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____TremoloUnit Factory Preset Constants<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Frequency_Slow = 2.0;    // 1<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Frequency_Fast = 20.0;   // 2<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Depth_Slow     = 50.0;   // 3<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Depth_Fast     = 90.0;   // 4<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Waveform_Slow            // 5<span></span></pre></td></tr><tr><td scope="row"><pre>    = kSineWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre>static const float kParameter_Preset_Waveform_Fast            // 6<span></span></pre></td></tr><tr><td scope="row"><pre>    = kSquareWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kPreset_Slow    = 0,                                      // 7<span></span></pre></td></tr><tr><td scope="row"><pre>    kPreset_Fast    = 1,                                      // 8<span></span></pre></td></tr><tr><td scope="row"><pre>    kNumberPresets  = 2                                       // 9<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static AUPreset kPresets [kNumberPresets] = {                 // 10<span></span></pre></td></tr><tr><td scope="row"><pre>    {kPreset_Slow, CFSTR ("Slow &amp; Gentle")},<span></span></pre></td></tr><tr><td scope="row"><pre>    {kPreset_Fast, CFSTR ("Fast &amp; Hard")}<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static const int kPreset_Default = kPreset_Slow;              // 11<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Defines a constant for the frequency value for the “Slow &amp;amp; Gentle” factory preset.</p></li><li class="li"><p>Defines a constant for the frequency value for the “Fast &amp;amp; Hard” factory preset.</p></li><li class="li"><p>Defines a constant for the depth value for the “Slow &amp;amp; Gentle; Hard” factory preset.</p></li><li class="li"><p>Defines a constant for the depth value for the “Fast &amp;amp; Hard” factory preset.</p></li><li class="li"><p>Defines a constant for the waveform value for the “Slow &amp;amp; Gentle” factory preset.</p></li><li class="li"><p>Defines a constant for the waveform value for the “Fast &amp;amp; Hard” factory preset.</p></li><li class="li"><p>Defines a constant for the “Slow &amp;amp; Gentle” factory preset.</p></li><li class="li"><p>Defines a constant for the “Fast &amp;amp; Hard” factory preset.</p></li><li class="li"><p>Defines a constant representing the total number of factory presets.</p></li><li class="li"><p>Defines an array containing two Core Foundation string objects. The objects contain values for the menu items in the user interface corresponding to the factory presets.</p></li><li class="li"><p>Defines a constant representing the default factory preset, in this case the “Slow &amp; Gentle” preset.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_59" title="Add Method Declarations for Factory Presets"></a><h3>Add Method Declarations for Factory Presets</h3><p>Now, provide method declarations for overriding the <code><!--a-->GetPresets<!--/a--></code> and <code><!--a-->NewFactoryPresetSet<!--/a--></code> methods from the <code>AUBase</code> superclass. Add these method declarations to the <code>public:</code> portion of class declaration in the <code>TremoloUnit.h</code> header file. You implement these methods in a later step in this chapter.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_100" title="Listing 5-6Factory preset method declarations (TremoloUnit.h)"></a><p class="codesample"><strong>Listing 5-6&nbsp;&nbsp;</strong>Factory preset method declarations (<code>TremoloUnit.h</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____TremoloUnit<span></span></pre></td></tr><tr><td scope="row"><pre>class TremoloUnit : public AUEffectBase {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public:<span></span></pre></td></tr><tr><td scope="row"><pre>    TremoloUnit (AudioUnit component);<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>    virtual ComponentResult GetPresets (       // 1<span></span></pre></td></tr><tr><td scope="row"><pre>        CFArrayRef        *outData<span></span></pre></td></tr><tr><td scope="row"><pre>    ) const;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    virtual OSStatus NewFactoryPresetSet (     // 2<span></span></pre></td></tr><tr><td scope="row"><pre>        const AUPreset    &amp;inNewFactoryPreset<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre>protected:<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Declaration for the GetPresets method, overriding the method from the AUBase superclass.</p></li><li class="li"><p>Declaration for the NewFactoryPresetSet method, overriding the method from the AUBase superclass.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_60" title="Set the Default Factory Preset"></a><h3>Set the Default Factory Preset</h3><p>Now you return to the TremoloUnit constructor method, in which you previously added code for setting the audio unit parameters. Here, you add a single statement to set the default factory preset, making use of the <code>kTremoloPreset_Default</code> constant.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_101" title="Listing 5-7Setting the default factory preset in the constructor (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-7&nbsp;&nbsp;</strong>Setting the default factory preset in the constructor (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>TremoloUnit::TremoloUnit (AudioUnit component) : AUEffectBase (component) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CreateElements ();<span></span></pre></td></tr><tr><td scope="row"><pre>    Globals () -> UseIndexedParameters (kNumberOfParameters);<span></span></pre></td></tr><tr><td scope="row"><pre>    // code for setting default values for the audio unit parameters<span></span></pre></td></tr><tr><td scope="row"><pre>    SetAFactoryPresetAsCurrent (                    // 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kPresets [kPreset_Default]<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre>    // boilerplate code for debug dispatcher<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Sets the default factory preset.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_61" title="Implement the GetPresets Method"></a><h3>Implement the GetPresets Method</h3><p>For users to be able to use the factory presets you define, you must add a generic implementation of the <code><!--a-->GetPresets<!--/a--></code> method. The following generic code works for any audio unit that can support factory presets.</p><p>A convenient location for this code in the <code>TremoloUnit.cpp</code> implementation file is after the <code>GetPropertyInfo</code> and <code>GetProperty</code> methods.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_102" title="Note"></a><p><strong>Note:</strong>&nbsp;You can refer to <span class="content_text"><a href="../TheAudioUnit/TheAudioUnit.html#//apple_ref/doc/uid/TP40003278-CH12-SW10">“Control Code: Parameters, Factory Presets, and Properties”</a></span> for an architectural description of the <code><!--a-->GetPresets<!--/a--></code> method, and how it fits into audio unit operation.</p></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_103" title="Listing 5-8Implementing the GetPresets method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-8&nbsp;&nbsp;</strong>Implementing the <code>GetPresets</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____Factory Presets<span></span></pre></td></tr><tr><td scope="row"><pre>ComponentResult TremoloUnit::GetPresets (                     // 1<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayRef *outData<span></span></pre></td></tr><tr><td scope="row"><pre>) const {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (outData == NULL) return noErr;                        // 2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableArrayRef presetsArray = CFArrayCreateMutable (   // 3<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        kNumberPresets,<span></span></pre></td></tr><tr><td scope="row"><pre>        NULL<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (int i = 0; i &lt; kNumberPresets; ++i) {                // 4<span></span></pre></td></tr><tr><td scope="row"><pre>        CFArrayAppendValue (<span></span></pre></td></tr><tr><td scope="row"><pre>            presetsArray,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;kPresets [i]<span></span></pre></td></tr><tr><td scope="row"><pre>        );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *outData = (CFArrayRef) presetsArray;                     // 5<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>The <code><!--a-->GetPresets<!--/a--></code> method accepts a single parameter, a pointer to a CFArrayRef object. This object holds the factory presets array generated by this method.</p></li><li class="li"><p>Checks whether factory presets are implemented for this audio unit.</p></li><li class="li"><p>Instantiates a mutable Core Foundation array to hold the factory presets.</p></li><li class="li"><p>Fills the factory presets array with values from the definitions in the <code>TremoloUnit.h</code> file.</p></li><li class="li"><p>Stores the factory presets array at the <code>outData</code> location.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-SW14" title="Define the Factory Presets"></a><h3>Define the Factory Presets</h3><p>The <code>NewFactoryPresetSet</code> method defines all the factory presets for an audio unit. Basically, for each preset, it invokes a series of <code>SetParameter</code> calls.</p><p>A convenient location for this code in the <code>TremoloUnit.cpp</code> implementation file is after the implementation of the <code>GetPresets</code> method.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_104" title="Listing 5-9Defining factory presets in the NewFactoryPresetSet method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-9&nbsp;&nbsp;</strong>Defining factory presets in the <code>NewFactoryPresetSet</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus TremoloUnit::NewFactoryPresetSet (                         // 1<span></span></pre></td></tr><tr><td scope="row"><pre>    const AUPreset &amp;inNewFactoryPreset<span></span></pre></td></tr><tr><td scope="row"><pre>) {<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32 chosenPreset = inNewFactoryPreset.presetNumber;          // 2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (                                                            // 3<span></span></pre></td></tr><tr><td scope="row"><pre>        chosenPreset == kPreset_Slow ||<span></span></pre></td></tr><tr><td scope="row"><pre>        chosenPreset == kPreset_Fast<span></span></pre></td></tr><tr><td scope="row"><pre>    ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = 0; i &lt; kNumberPresets; ++i) {                  // 4<span></span></pre></td></tr><tr><td scope="row"><pre>            if (chosenPreset == kPresets[i].presetNumber) {<span></span></pre></td></tr><tr><td scope="row"><pre>                switch (chosenPreset) {                             // 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    case kPreset_Slow:                              // 6<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (                              // 7<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Frequency,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Preset_Frequency_Slow<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (                              // 8<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Depth,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Preset_Depth_Slow<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (                              // 9<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Waveform,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Preset_Waveform_Slow<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                    case kPreset_Fast:                             // 10<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Frequency,<span></span></pre></td></tr><tr><td scope="row"><pre>                           kParameter_Preset_Frequency_Fast<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Depth,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Preset_Depth_Fast<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetParameter (<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Waveform,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kParameter_Preset_Waveform_Fast<span></span></pre></td></tr><tr><td scope="row"><pre>                        );<span></span></pre></td></tr><tr><td scope="row"><pre>                        break;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                SetAFactoryPresetAsCurrent (                        // 11<span></span></pre></td></tr><tr><td scope="row"><pre>                    kPresets [i]<span></span></pre></td></tr><tr><td scope="row"><pre>                );<span></span></pre></td></tr><tr><td scope="row"><pre>                return noErr;                                       // 12<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return kAudioUnitErr_InvalidProperty;                           // 13<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>This method takes a single argument of type <code>AUPreset</code>, a structure containing a factory preset name and number.</p></li><li class="li"><p>Gets the number of the desired factory preset.</p></li><li class="li"><p>Tests whether the desired factory preset is defined.</p></li><li class="li"><p>This <code>for</code> loop, and the <code>if</code> statement that follows it, allow for noncontiguous preset numbers.</p></li><li class="li"><p>Selects the appropriate case statement based on the factory preset number.</p></li><li class="li"><p>The settings for the “Slow &amp; Gentle” factory preset.</p></li><li class="li"><p>Sets the Frequency audio unit parameter for the “Slow &amp; Gentle” factory preset.</p></li><li class="li"><p>Sets the Depth audio unit parameter for the “Slow &amp; Gentle” factory preset.</p></li><li class="li"><p>Sets the Waveform audio unit parameter for the “Slow &amp; Gentle” factory preset.</p></li><li class="li"><p>The settings for the “Fast &amp; Hard” factory preset. The three <code>SetParameter</code> statements that follow work the same way as for the other factory preset.</p></li><li class="li"><p>Updates the preset menu in the generic view to display the new factory preset.</p></li><li class="li"><p>On success, returns a value of <code>noErr</code>.</p></li><li class="li"><p>If the host application attempted to set an undefined factory preset, return an error.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-SW8" title="Implement Signal Processing"></a><h2>Implement Signal Processing</h2><p>With the parameter and preset code in place, you now get to the heart of the matter: the digital signal processing code. As described in <span class="content_text"><a href="../TheAudioUnit/TheAudioUnit.html#//apple_ref/doc/uid/TP40003278-CH12-SW14">“Synthesis, Processing, and Data Format Conversion Code,”</a></span> the DSP performed by an <em>n</em>-to-<em>n</em> channel effect unit takes place in the <code>AUKernelBase</code> class, a helper class for the <code>AUEffectBase</code> class. Refer to <span class="content_text"><a href="../AudioUnitDevelopmentFundamentals/AudioUnitDevelopmentFundamentals.html#//apple_ref/doc/uid/TP40003278-CH7-SW11">“Processing: The Heart of the Matter”</a></span> for more on how DSP works in audio units.</p><p>To implement signal processing in an <em>n</em>-to-<em>n</em> channel effect unit, you override two methods from the <code>AUKernelBase</code> class:</p><ul class="ul"><li class="li"><p>The <code><!--a-->Process<!--/a--></code> method, which performs the signal processing</p></li><li class="li"><p>The <code><a href="../../../Reference/CoreAudio/audiocodec/audiocodec.html#//apple_ref/doc/c_ref/Reset" target="_top">Reset</a></code> method, which returns the audio unit to its pristine, initialized state</p></li></ul><p>Along the way, you make changes to the default <code>TremoloUnitKernel</code> class declaration in the <code>TremoloUnit.h</code> header file, and you modify the <code>TremoloUnitKernel</code> constructor method in <code>TremoloUnit.cpp</code>.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_62" title="DSP Design for the Tremolo Effect"></a><h3>DSP Design for the Tremolo Effect</h3><p>The design and implementation of DSP code are central to real world audio unit development—but, as mentioned in the Introduction, they are outside the scope of this document. Nonetheless, this section describes the simple DSP used in this project to illustrate some of the issues involved with adding such code to an effect unit.</p><p>When you create a new audio unit project with an Xcode template, you get an audio unit with minimal DSP. It consists of only a multiplication that applies the value of a gain parameter to each sample of an audio signal. Here, you still use a simple multiplication—but with a bit more math up front, you end up with something a little more interesting; namely, tremolo. As you add the DSP code, you see where each part goes and how it fits in to the audio unit scaffolding.</p><p>The tremolo unit design uses a wave table to describe one cycle of a tremolo waveform. The <code>TremoloUnitKernel</code> class builds the wave table during instantiation. To make the project a bit more useful and instructive, the class builds not one but two wave tables: one representing a sine wave and one representing a pseudo square wave.</p><p>During processing, the tremolo unit uses sequential values from one of its wave tables as gain factors to apply to the audio signal, sample by sample. There’s code to determine which point in the wave table to apply to a given audio sample.</p><p>Following the audio unit parameter design described earlier in this chapter, there is code to vary tremolo frequency, tremolo depth, and the tremolo waveform, all in real time.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-SW12" title="Define Member Variables in the Kernel Class Declaration"></a><h3>Define Member Variables in the Kernel Class Declaration</h3><p>To begin the DSP implementation for the tremolo unit, add some constants as private member variables to the <code>TremoloUnitKernel</code> class declaration. Defining these as private member variables ensures that they are global to the <code>TremolUnitKernel</code> object and invisible elsewhere.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_105" title="Note"></a><p><strong>Note:</strong>&nbsp;As described in comment (1) below, the constructor signature you use here for the kernel helper class differs from the signature supplied in the Xcode template.</p></div><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_106" title="Listing 5-10TremoloUnitKernel member variables (TremoloUnit.h)"></a><p class="codesample"><strong>Listing 5-10&nbsp;&nbsp;</strong><code>TremoloUnitKernel</code> member variables (<code>TremoloUnit.h</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>class TremoloUnit : public AUEffectBase<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>public:<span></span></pre></td></tr><tr><td scope="row"><pre>    TremoloUnit(AudioUnit component);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>protected:<span></span></pre></td></tr><tr><td scope="row"><pre>    class TremoloUnitKernel : public AUKernelBase {<span></span></pre></td></tr><tr><td scope="row"><pre>        public:<span></span></pre></td></tr><tr><td scope="row"><pre>            TremoloUnitKernel (AUEffectBase *inAudioUnit); // 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            virtual void Process (<span></span></pre></td></tr><tr><td scope="row"><pre>                const Float32    *inSourceP,<span></span></pre></td></tr><tr><td scope="row"><pre>                Float32          *inDestP,<span></span></pre></td></tr><tr><td scope="row"><pre>                UInt32           inFramesToProcess,<span></span></pre></td></tr><tr><td scope="row"><pre>                UInt32           inNumChannels,   // equal to 1<span></span></pre></td></tr><tr><td scope="row"><pre>                bool             &amp;ioSilence<span></span></pre></td></tr><tr><td scope="row"><pre>        );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        virtual void Reset();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        private:<span></span></pre></td></tr><tr><td scope="row"><pre>            enum     {kWaveArraySize = 2000};             // 2<span></span></pre></td></tr><tr><td scope="row"><pre>            float    mSine [kWaveArraySize];              // 3<span></span></pre></td></tr><tr><td scope="row"><pre>            float    mSquare [kWaveArraySize];            // 4<span></span></pre></td></tr><tr><td scope="row"><pre>            float    *waveArrayPointer;                   // 5<span></span></pre></td></tr><tr><td scope="row"><pre>            Float32  mSampleFrequency;                    // 6<span></span></pre></td></tr><tr><td scope="row"><pre>            long     mSamplesProcessed;                   // 7<span></span></pre></td></tr><tr><td scope="row"><pre>            enum     {sampleLimit = (int) 10E6};          // 8<span></span></pre></td></tr><tr><td scope="row"><pre>            float    mCurrentScale;                       // 9<span></span></pre></td></tr><tr><td scope="row"><pre>            float    mNextScale;                          // 10<span></span></pre></td></tr><tr><td scope="row"><pre>    };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>Here’s how this code works (skip this explanation if you’re not interested in the math):</p><ol class="ol"><li class="li"><p>The constructor signature in the Xcode template contains a call to the superclass’s constructor, as well as empty braces representing the method body. Remove all of these because you implement the constructor method in the implementation file, as described in the next section.</p></li><li class="li"><p>The number of points in each wave table. Each wave holds one cycle of a tremolo waveform.</p></li><li class="li"><p>The wave table for the tremolo sine wave.</p></li><li class="li"><p>The wave table for the tremolo pseudo square wave.</p></li><li class="li"><p>The wave table to apply to the current audio input buffer.</p></li><li class="li"><p>The sampling frequency, or "sample rate" as it is often called, of the audio signal to be processed.</p></li><li class="li"><p>The number of samples processed since the audio unit started rendering, or since this variable was last set to <code>0</code>. The DSP code tracks total samples processed because:</p><ul class="ul"><li class="li"><p>The main processing loop is based on the number of samples placed into the input buffer…</p></li><li class="li"><p>But the DSP must take place independent of the input buffer size.</p></li></ul></li><li class="li"><p>To keep the value of <code>mSamplesProcessed</code> within a reasonable limit, there's a test in the code to reset it when it reaches this value.</p></li><li class="li"><p>The scaling factor currently in use. The DSP uses a scaling factor to correlate the points in the wave table with the audio signal sampling frequency, in order to produce the desired tremolo frequency. The kernel object keeps track of a “current” and “next” scaling factor to support changing from one tremolo frequency to another without an audible glitch.</p></li><li class="li"><p>The desired scaling factor to use, resulting from a request by the user for a different tremolo frequency.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_63" title="Write the TremoloUnitKernel Constructor Method"></a><h3>Write the TremoloUnitKernel Constructor Method</h3><p>In the constructor method for your custom subclass of the <code>AUKernelBase</code> class, take care of any DSP work that can be done once per instantiation of the kernel object. In the case of the tremolo unit we're building, this includes:</p><ul class="spaceabove"><li class="li"><p>Initializing member variables that require initialization</p></li><li class="li"><p>Filling the two wave tables</p></li><li class="li"><p>Getting the sample rate of the audio stream.</p></li></ul><p>A convenient location for the constructor is immediately below the <code>TremoloUnitEffectKernel</code> pragma mark.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_107" title="Listing 5-11Modifications to the TremoloUnitKernel Constructor (TremolUnit.cpp)"></a><p class="codesample"><strong>Listing 5-11&nbsp;&nbsp;</strong>Modifications to the <code>TremoloUnitKernel</code> Constructor (<code>TremolUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>#pragma mark ____TremoloUnitEffectKernel<span></span></pre></td></tr><tr><td scope="row"><pre>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<span></span></pre></td></tr><tr><td scope="row"><pre>//    TremoloUnit::TremoloUnitKernel::TremoloUnitKernel()<span></span></pre></td></tr><tr><td scope="row"><pre>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<span></span></pre></td></tr><tr><td scope="row"><pre>TremoloUnit::TremoloUnitKernel::TremoloUnitKernel (AUEffectBase *inAudioUnit) :<span></span></pre></td></tr><tr><td scope="row"><pre>    AUKernelBase (inAudioUnit), mSamplesProcessed (0), mCurrentScale (0) // 1<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    for (int i = 0; i &lt; kWaveArraySize; ++i) {                           // 2<span></span></pre></td></tr><tr><td scope="row"><pre>        double radians = i * 2.0 * pi / kWaveArraySize;<span></span></pre></td></tr><tr><td scope="row"><pre>        mSine [i] = (sin (radians) + 1.0) * 0.5;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (int i = 0; i &lt; kWaveArraySize; ++i) {                           // 3<span></span></pre></td></tr><tr><td scope="row"><pre>        double radians = i * 2.0 * pi / kWaveArraySize;<span></span></pre></td></tr><tr><td scope="row"><pre>        radians = radians + 0.32;<span></span></pre></td></tr><tr><td scope="row"><pre>        mSquare [i] =<span></span></pre></td></tr><tr><td scope="row"><pre>            (<span></span></pre></td></tr><tr><td scope="row"><pre>                sin (radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.3 * sin (3 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.15 * sin (5 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.075 * sin (7 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.0375 * sin (9 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.01875 * sin (11 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.009375 * sin (13 * radians) +<span></span></pre></td></tr><tr><td scope="row"><pre>                0.8<span></span></pre></td></tr><tr><td scope="row"><pre>            ) * 0.63;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    mSampleFrequency = GetSampleRate ();                                 // 4<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>The constructor method declarator and constructor-initializer.  In addition to calling the appropriate superclasses, this code initializes two member variables.</p></li><li class="li"><p>Generates a wave table that represents one cycle of a sine wave, normalized so that it never goes negative and so that it ranges between 0 and 1.</p><p>Along with the value of the Depth parameter, this sine wave specifies how to vary the audio gain during one cycle of sine wave tremolo.</p></li><li class="li"><p>Generates a wave table that represents one cycle of a pseudo square wave, normalized so that it never goes negative and so that it ranges between approximately <code>0</code> and approximately <code>1</code>.</p><!-- <comment><Note><Name>Note</Name><Para>The math in this <codeVoice>for</codeVoice> loop was created empirically, using a graphing application (such as Apple's Grapher) to create a nicely smoothed pseudo square wave that produces a usable tremolo effect.</Para></Note></comment> --></li><li class="li"><p>Gets the sample rate for the audio stream to be processed.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_64" title="Override the Process Method"></a><h3>Override the Process Method</h3><p>Put your DSP code into an override of the <code>AUKernelBase</code> class’s <code>Process</code> method. The <code>Process</code> method gets called once each time the host application fills the audio sample input buffer. The method processes the buffer contents, sample by sample, and places the processed audio in the audio sample output buffer.</p><p>It’s important to put as much processing as possible outside of the actual processing loop. The code for the TremoloUnit project demonstrates that the following sort of work gets done just once per audio sample buffer, outside of the processing loop:</p><ul class="spaceabove"><li class="li"><p>Declare all variables used in the method</p></li><li class="li"><p>Get the current values of all the parameters as set by the user via the audio unit’s view</p></li><li class="li"><p>Check the parameters to ensure they're in bounds, and taking appropriate action if they're not</p></li><li class="li"><p>Perform calculations that don't require updating with each sample. In this project's case, this means calculating the scaling factor to use when applying the tremolo wave table.</p></li></ul><p>Inside the processing loop, do only work that must be performed sample by sample:</p><ul class="spaceabove"><li class="li"><p>Perform calculations that must be updated sample by sample. In this case, this means calculating the point in the wave table to use for tremolo gain</p></li><li class="li"><p>Respond to parameter changes in a way that avoids artifacts. In this case, this means switching to a new tremolo frequency, if requested by the user, in a way that avoids any sudden jump in gain.</p></li><li class="li"><p>Calculate the transformation to apply to each input sample. In this case, this means calculating a) the tremolo gain based on the current point in the wave table, and b) the current value of the Depth parameter.</p></li><li class="li"><p>Calculate the output sample that corresponds to the current input sample. In this case, this means applying the tremolo gain and depth factor to the current input sample.</p></li><li class="li"><p>Advance the indexes in the input and output buffers</p></li><li class="li"><p>Advance other indexes involved in the DSP. In this case, this means incrementing the <code>mSamplesProcessed</code> variable.</p></li></ul><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_108" title="Listing 5-12The Process method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-12&nbsp;&nbsp;</strong>The <code>Process</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>void TremoloUnit::TremoloUnitKernel::Process (                        // 1<span></span></pre></td></tr><tr><td scope="row"><pre>    const Float32   *inSourceP,                                       // 2<span></span></pre></td></tr><tr><td scope="row"><pre>    Float32         *inDestP,                                         // 3<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32          inSamplesToProcess,                               // 4<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32          inNumChannels,                                    // 5<span></span></pre></td></tr><tr><td scope="row"><pre>    bool            &amp;ioSilence                                        // 6<span></span></pre></td></tr><tr><td scope="row"><pre>) {<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!ioSilence) {                                                 // 7<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        const Float32 *sourceP = inSourceP;                           // 8<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Float32  *destP = inDestP,                                    // 9<span></span></pre></td></tr><tr><td scope="row"><pre>                 inputSample,                                         // 10<span></span></pre></td></tr><tr><td scope="row"><pre>                 outputSample,                                        // 11<span></span></pre></td></tr><tr><td scope="row"><pre>                 tremoloFrequency,                                    // 12<span></span></pre></td></tr><tr><td scope="row"><pre>                 tremoloDepth,                                        // 13<span></span></pre></td></tr><tr><td scope="row"><pre>                 samplesPerTremoloCycle,                              // 14<span></span></pre></td></tr><tr><td scope="row"><pre>                 rawTremoloGain,                                      // 15<span></span></pre></td></tr><tr><td scope="row"><pre>                 tremoloGain;                                         // 16<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        int      tremoloWaveform;                                     // 17<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        tremoloFrequency = GetParameter (kParameter_Frequency);       // 18<span></span></pre></td></tr><tr><td scope="row"><pre>        tremoloDepth     = GetParameter (kParameter_Depth);           // 19<span></span></pre></td></tr><tr><td scope="row"><pre>        tremoloWaveform  =<span></span></pre></td></tr><tr><td scope="row"><pre>            (int) GetParameter (kParameter_Waveform);                 // 20<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloWaveform == kSineWave_Tremolo_Waveform)  {         // 21<span></span></pre></td></tr><tr><td scope="row"><pre>            waveArrayPointer = &amp;mSine [0];<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            waveArrayPointer = &amp;mSquare [0];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloFrequency &lt; kMinimumValue_Tremolo_Freq)            // 22<span></span></pre></td></tr><tr><td scope="row"><pre>            tremoloFrequency = kMinimumValue_Tremolo_Freq;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloFrequency > kMaximumValue_Tremolo_Freq)<span></span></pre></td></tr><tr><td scope="row"><pre>            tremoloFrequency = kMaximumValue_Tremolo_Freq;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloDepth     &lt; kMinimumValue_Tremolo_Depth)           // 23<span></span></pre></td></tr><tr><td scope="row"><pre>            tremoloDepth     = kMinimumValue_Tremolo_Depth;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloDepth     > kMaximumValue_Tremolo_Depth)<span></span></pre></td></tr><tr><td scope="row"><pre>            tremoloDepth     = kMaximumValue_Tremolo_Depth;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (tremoloWaveform != kSineWave_Tremolo_Waveform             // 24<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;&amp; tremoloWaveform != kSquareWave_Tremolo_Waveform)<span></span></pre></td></tr><tr><td scope="row"><pre>                tremoloWaveform = kSquareWave_Tremolo_Waveform;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        samplesPerTremoloCycle = mSampleFrequency / tremoloFrequency; // 25<span></span></pre></td></tr><tr><td scope="row"><pre>        mNextScale = kWaveArraySize / samplesPerTremoloCycle;         // 26<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // the sample processing loop ////////////////<span></span></pre></td></tr><tr><td scope="row"><pre>        for (int i = inSamplesToProcess; i > 0; --i) {                // 27<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            int index =                                               // 28<span></span></pre></td></tr><tr><td scope="row"><pre>                static_cast&lt;long>(mSamplesProcessed * mCurrentScale) %<span></span></pre></td></tr><tr><td scope="row"><pre>                    kWaveArraySize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if ((mNextScale != mCurrentScale) &amp;&amp; (index == 0)) {      // 29<span></span></pre></td></tr><tr><td scope="row"><pre>                mCurrentScale = mNextScale;<span></span></pre></td></tr><tr><td scope="row"><pre>                mSamplesProcessed = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if ((mSamplesProcessed >= sampleLimit) &amp;&amp; (index == 0))   // 30<span></span></pre></td></tr><tr><td scope="row"><pre>                mSamplesProcessed = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            rawTremoloGain = waveArrayPointer [index];                // 31<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            tremoloGain       = (rawTremoloGain * tremoloDepth -      // 32<span></span></pre></td></tr><tr><td scope="row"><pre>                                tremoloDepth + 100.0) * 0.01;<span></span></pre></td></tr><tr><td scope="row"><pre>            inputSample       = *sourceP;                             // 33<span></span></pre></td></tr><tr><td scope="row"><pre>            outputSample      = (inputSample * tremoloGain);          // 34<span></span></pre></td></tr><tr><td scope="row"><pre>            *destP            = outputSample;                         // 35<span></span></pre></td></tr><tr><td scope="row"><pre>            sourceP           += 1;                                   // 36<span></span></pre></td></tr><tr><td scope="row"><pre>            destP             += 1;                                   // 37<span></span></pre></td></tr><tr><td scope="row"><pre>            mSamplesProcessed += 1;                                   // 38<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>The <code>Process</code> method signature. This method is declared in the <code>AUKernelBase</code> class.</p></li><li class="li"><p>The audio sample input buffer.</p></li><li class="li"><p>The audio sample output buffer.</p></li><li class="li"><p>The number of samples in the input buffer.</p></li><li class="li"><p>The number of input channels. This is always equal to 1 because there is always one kernel object instantiated per channel of audio.</p></li><li class="li"><p>A Boolean flag indicating whether the input to the audio unit consists of silence, with a <code>TRUE</code> value indicating silence.</p></li><li class="li"><p>Ignores the request to perform the <code>Process</code> method if the input to the audio unit is silence.</p></li><li class="li"><p>Assigns a pointer variable to the start of the audio sample input buffer.</p></li><li class="li"><p>Assigns a pointer variable to the start of the audio sample output buffer.</p></li><li class="li"><p>The current audio sample to process.</p></li><li class="li"><p>The current audio output sample resulting from one iteration of the processing loop.</p></li><li class="li"><p>The tremolo frequency requested by the user via the audio unit’s view.</p></li><li class="li"><p>The tremolo depth requested by the user via the audio unit’s view.</p></li><li class="li"><p>The number of audio samples in one cycle of the tremolo waveform.</p></li><li class="li"><p>The tremolo gain for the current audio sample, as stored in the wave table.</p></li><li class="li"><p>The adjusted tremolo gain for the current audio sample, considering the Depth parameter.</p></li><li class="li"><p>The tremolo waveform type requested by the user via the audio unit’s view.</p></li><li class="li"><p>Gets the current value of the Frequency parameter.</p></li><li class="li"><p>Gets the current value of the Depth parameter.</p></li><li class="li"><p>Gets the current value of the Waveform parameter.</p></li><li class="li"><p>Assigns a pointer variable to the wave table that corresponds to the tremolo waveform selected by the user.</p></li><li class="li"><p>Performs bounds checking on the Frequency parameter. If the parameter is out of bounds, supplies a reasonable value.</p></li><li class="li"><p>Performs bounds checking on the Depth parameter. If the parameter is out of bounds, supplies a reasonable value.</p></li><li class="li"><p>Performs bounds checking on the Waveform parameter. If the parameter is out of bounds, supplies a reasonable value.</p></li><li class="li"><p>Calculates the number of audio samples per cycle of tremolo frequency.</p></li><li class="li"><p>Calculates the scaling factor to use for applying the wave table to the current sampling frequency and tremolo frequency.</p></li><li class="li"><p>The loop that iterates over the audio sample input buffer.</p></li><li class="li"><p>Calculates the point in the wave table to use for the current sample. This, along with the calculation of the <code>mNextScale</code> value in comment , is the only subtle math in the DSP for this effect.</p></li><li class="li"><p>Tests if the scaling factor should change, and if it’s safe to change it at the current sample to avoid artifacts. If both conditions are met, switches the scaling factor and resets the <code>mSamplesProcessed</code> variable.</p></li><li class="li"><p>Tests if the mSamplesProcessed variable has grown to a large value, and if it's safe to reset it at the current sample to avoid artifacts. If both conditions are met, resets the <code>mSamplesProcessed</code> variable.</p></li><li class="li"><p>Gets the tremolo gain from the appropriate point in the wave table.</p></li><li class="li"><p>Adjusts the tremolo gain by applying the Depth parameter. With a depth of 100%, the full tremolo effect is applied. With a depth of 0%, there is no tremolo effect applied at all.</p></li><li class="li"><p>Gets an audio sample from the appropriate spot in the audio sample input buffer.</p></li><li class="li"><p>Calculates the corresponding output audio sample.</p></li><li class="li"><p>Places the output audio sample at the appropriate spot in the audio sample output buffer.</p></li><li class="li"><p>Increments the position counter for the audio sample input buffer.</p></li><li class="li"><p>Increments the position counter for the audio sample output buffer.</p></li><li class="li"><p>Increments the count of processed audio samples.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_65" title="Override the Reset Method"></a><h3>Override the Reset Method</h3><p>In your custom subclass’s override of the <code>AUKernelBase</code> class <code>Reset</code> method, you do whatever work is necessary to return the audio unit to its pristine, initialized state.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_109" title="Listing 5-13The Reset method (TremoloUnit.cpp)"></a><p class="codesample"><strong>Listing 5-13&nbsp;&nbsp;</strong>The <code>Reset</code> method (<code>TremoloUnit.cpp</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>void TremoloUnit::TremoloUnitKernel::Reset() {<span></span></pre></td></tr><tr><td scope="row"><pre>    mCurrentScale        = 0;                    // 1<span></span></pre></td></tr><tr><td scope="row"><pre>    mSamplesProcessed    = 0;                    // 2<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s how this code works:</p><ol class="ol"><li class="li"><p>Resets the <code>mCurrentScale</code> member variable to its freshly initialized value.</p></li><li class="li"><p>Resets the <code>mSamplesProcessed</code> member variable to its freshly initialized value.</p></li></ol><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_66" title="Implement the Tail Time Property"></a><h2>Implement the Tail Time Property</h2><p>Finally, to ensure that your audio unit plays well in host applications, implement the tail time property, <code>kAudioUnitProperty_TailTime</code>.</p><p>To do this, simply state in your <code>TremoloUnit</code> class definition that your audio unit supports the property by changing the return value of the <code><!--a-->SupportsTail<!--/a--></code> method to <code>true</code>.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_110" title="Listing 5-14Implementing the tail time property (TremoloUnit.h)"></a><p class="codesample"><strong>Listing 5-14&nbsp;&nbsp;</strong>Implementing the tail time property (<code>TremoloUnit.h</code>)</p><div class="codesample"><table><tr><td scope="row"><pre>virtual bool SupportsTail () {return true;}<span></span></pre></td></tr></table></div>	<p>Given the nature of the DSP your audio unit performs, its tail time is <code>0</code> seconds—so you don’t need to override the <code><!--a-->GetTailTime<!--/a--></code> method. In the <code>AUBase</code> superclass, this method reports a tail time of <code>0</code> seconds, which is what you want your audio unit to report.</p><a name="//apple_ref/doc/uid/TP40003278-CH5-DontLinkElementID_67" title="Validate your Completed Audio Unit"></a><h2>Validate your Completed Audio Unit</h2><p>Now you’ve implemented all of the code for the tremolo unit project. Build the project and correct any errors you see. Then use the auval tool to validate your audio unit.</p><p>1. In Terminal, enter the command to validate the tremolo unit. This consists of the <code>auval</code> command name followed by the <code>-v</code> flag to invoke validation, followed by the type, subtype, and manufacturer codes that identify the tremolo unit. The complete command for this audio unit is:</p><div class="codesample"><table><tr><td scope="row"><pre>auval -v aufx tmlo Aaud<span></span></pre></td></tr></table></div><p>If everything is in order, <code>auval</code> should report that your new audio unit is indeed valid. The figure shows the last bit of the log created by <code>auval</code>:</p><br/><div><img src = "../Art/validation_succeeded.jpg" alt = "image: ../Art/validation_succeeded.jpg" ></div><br/><a name="//apple_ref/doc/uid/TP40003278-CH5-SW9" title="Test your Completed Audio Unit"></a><h2>Test your Completed Audio Unit</h2><p>Your audio unit is ready for you to test in a host application. Apple recommends the AU Lab application for audio unit testing. You may also want to test your audio unit in other hosts. This section describes testing with AU Lab. Follow these steps:</p><p>1. Open the AU Lab document that you saved from the <span class="content_text"><a href="Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW10">“Test the Unmodified Audio Unit”</a></span> section. If you don’t have that document, run through the steps in that section again to set up AU Lab for testing your audio unit.</p><p>2. Your completed audio unit appears with the generic view as shown in the figure:</p><br/><div><img src = "../Art/tremolo_unit_generic_view.jpg" alt = "image: ../Art/tremolo_unit_generic_view.jpg" ></div><br/><p>(You may need to quit and reopen AU Lab for your completed audio unit’s view to appear.)</p><p>Notice the sliders for the Frequency and Depth parameters, the pop-up menu for the Waveform parameter, and the default preset displayed in the Factory Presets pop-up menu.</p><p>3. Click the Play button in the AUAudioFilePlayer utility window. If everything is in order, the file you have selected in the player will play through your audio unit and you’ll hear the tremolo effect.</p><p>4. Experiment with the range of effects available with the tremolo unit: adjust the Frequency, Depth, and Waveform controls while listening to the output from AU Lab.</p><p>5. In the presets menu toward the upper right of the generic view, choose Show Presets.</p><br/><div><img src = "../Art/generic_view_show_presets.jpg" alt = "image: ../Art/generic_view_show_presets.jpg" ></div><br/><p>The presets drawer opens.</p><br/><div><img src = "../Art/generic_view_presets_drawer.jpg" alt = "image: ../Art/generic_view_presets_drawer.jpg" ></div><br/><p>Disclose the presets in the Factory group and verify that the presets that you added to your audio unit, using the <code>NewFactoryPresetSet</code> method, are present. Double-click a preset to load it.</p><p>You can add user presets to the audio unit as follows:</p><ul class="ul"><li class="li"><p>Set the parameters as desired</p></li><li class="li"><p>In the presets menu, choose Save Preset As</p></li><li class="li"><p>In the dialog that appears, enter a name for the preset.</p></li></ul><!-- <Para><comment><Name>What’s Next</Name></comment><Para><comment>In the next chapter, you'll learn how to add a custom Cocoa view to an audio unit.</comment></Para></Para> -->

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AQuickTouroftheCoreAudioSDK/AQuickTouroftheCoreAudioSDK.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AudioUnitClassHierarchy/AudioUnitClassHierarchy.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/MusicAudio/Conceptual/AudioUnitProgrammingGuide/Tutorial-BuildingASimpleEffectUnitWithAGenericView/Tutorial-BuildingASimpleEffectUnitWithAGenericView.html%3Fid%3DTP40003278-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/MusicAudio/Conceptual/AudioUnitProgrammingGuide/Tutorial-BuildingASimpleEffectUnitWithAGenericView/Tutorial-BuildingASimpleEffectUnitWithAGenericView.html%3Fid%3DTP40003278-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/MusicAudio/Conceptual/AudioUnitProgrammingGuide/Tutorial-BuildingASimpleEffectUnitWithAGenericView/Tutorial-BuildingASimpleEffectUnitWithAGenericView.html%3Fid%3DTP40003278-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>