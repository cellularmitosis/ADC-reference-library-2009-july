<html><head><title>Mac OS X
 Manual Page For ip6fw(8)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/8/ip6fw" title="Mac OS X
 Manual Page for ip6fw(8)"><!-- headerDoc=man; indexgroup=Section 8; uid="//apple_ref/doc/man/8/ip6fw"; name=ip6fw(8) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
IP6FW(8)                  BSD System Manager's Manual                 IP6FW(8)

<b>NAME</b>
     <b>ip6fw</b> -- controlling utility for IPv6 firewall

<b>SYNOPSIS</b>
     <b>ip6fw</b> [<b>-q</b>] [<b>-p</b> <u>preproc</u> [<b>-D</b> <u>macro</u>[=<u>value</u>]] [<b>-U</b> <u>macro</u>]] <u>pathname</u>
     <b>ip6fw</b> [<b>-f</b> | <b>-q</b>] flush
     <b>ip6fw</b> [<b>-q</b>] zero [<u>number</u> <u>...</u>]
     <b>ip6fw</b> delete <u>number</u> <u>...</u>
     <b>ip6fw</b> [<b>-aftN</b>] list [<u>number</u> <u>...</u>]
     <b>ip6fw</b> [<b>-ftN</b>] show [<u>number</u> <u>...</u>]
     <b>ip6fw</b> [<b>-q</b>] add [<u>number</u>] <u>action</u> [log] <u>proto</u> from <u>src</u> to <u>dst</u> [via <u>name</u> | <u>ipv6no</u>] [<u>options</u>]

<b>DESCRIPTION</b>
     To ease configuration, rules can be put into a file which is processed using <b>ip6fw</b> as shown in the
     first synopsis line.  An absolute <u>pathname</u> must be used.  The file will be read line by line and
     applied as arguments to the <b>ip6fw</b> utility.

     Optionally, a preprocessor can be specified using <b>-p</b> <u>preproc</u> where <u>pathname</u> is to be piped through.
     Useful preprocessors include <a href="../man1/cpp.1.html#//apple_ref/doc/man/1/cpp">cpp(1)</a> and <a href="../man1/m4.1.html#//apple_ref/doc/man/1/m4">m4(1)</a>.  If <u>preproc</u> doesn't start with a slash (`/') as its
     first character, the usual PATH name search is performed.  Care should be taken with this in environ-<font color="#ffffff" class="whiteout">ments&nbsp;environments</font>
     ments where not all file systems are mounted (yet) by the time <b>ip6fw</b> is being run (e.g. when they are
     mounted over NFS).  Once <b>-p</b> has been specified, optional <b>-D</b> and <b>-U</b> specifications can follow and will
     be passed on to the preprocessor.  This allows for flexible configuration files (like conditionalizing
     them on the local hostname) and the use of macros to centralize frequently required arguments like IP
     addresses.

     The <b>ip6fw</b> code works by going through the rule-list for each packet, until a match is found.  All rules
     have two associated counters, a packet count and a byte count.  These counters are updated when a
     packet matches the rule.

     The rules are ordered by a ``line-number'' from 1 to 65534 that is used to order and delete rules.
     Rules are tried in increasing order, and the first rule that matches a packet applies.  Multiple rules
     may share the same number and apply in the order in which they were added.

     If a rule is added without a number, it is numbered 100 higher than the previous rule.  If the highest
     defined rule number is greater than 65434, new rules are appended to the last rule.

     The delete operation deletes the first rule with number <u>number</u>, if any.

     The list command prints out the current rule set.

     The show command is equivalent to `ip6fw -a list'.

     The zero operation zeroes the counters associated with rule number <u>number</u>.

     The flush operation removes all rules.

     Any command beginning with a `#', or being all blank, is ignored.

     One rule is always present:

                               65535 deny all from any to any

     This rule is the default policy, i.e., don't allow anything at all.  Your job in setting up rules is to
     modify this policy to match your needs.

     The following options are available:

     <b>-a</b>    While listing, show counter values.  See also ``show'' command.

     <b>-f</b>    Don't ask for confirmation for commands that can cause problems if misused (ie; flush).  <u>Note</u>, if
           there is no tty associated with the process, this is implied.

     <b>-q</b>    While adding, zeroing or flushing, be quiet about actions (implies '-f').  This is useful for
           adjusting rules by executing multiple ip6fw commands in a script (e.g. sh /etc/rc.firewall), or
           by processing a file of many ip6fw rules, across a remote login session.  If a flush is performed
           in normal (verbose) mode, it prints a message.  Because all rules are flushed, the message cannot
           be delivered to the login session, the login session is closed and the remainder of the ruleset
           is not processed.  Access to the console is required to recover.

     <b>-t</b>    While listing, show last match timestamp.

     <b>-N</b>    Try to resolve addresses and service names in output.

     <u>action</u>:

         <u>allow</u>             Allow packets that match rule.  The search terminates.  Aliases are <u>pass</u>, <u>permit</u>,
                           and <u>accept</u>.

         <u>deny</u>              Discard packets that match this rule.  The search terminates.  <u>Drop</u> is an alias
                           for <u>deny</u>.

         <u>reject</u>            (Deprecated.) Discard packets that match this rule, and try to send an ICMPv6
                           host unreachable notice.  The search terminates.

         <u>unreach</u> <u>code</u>      Discard packets that match this rule, and try to send an ICMPv6 unreachable
                           notice with code <u>code</u>, where <u>code</u> is a number from zero to 255, or one of these
                           aliases: <u>noroute</u>, <u>admin</u>, <u>notneighbor</u>, <u>addr</u>, or <u>noport</u>, The search terminates.

         <u>reset</u>             TCP packets only.  Discard packets that match this rule, and try to send a TCP
                           reset (RST) notice.  The search terminates (<u>not</u> <u>working</u> <u>yet</u>).

         <u>count</u>             Update counters for all packets that match rule.  The search continues with the
                           next rule.

         <u>skipto</u> <u>number</u>     Skip all subsequent rules numbered less than <u>number</u>.  The search continues with
                           the first rule numbered <u>number</u> or higher.

     If the kernel was compiled with IPV6FIREWALL_VERBOSE, then when a packet matches a rule with the
     ``log'' keyword or a clear/resetlog is performed, a message will be logged to <a href="syslogd.8.html#//apple_ref/doc/man/8/syslogd">syslogd(8)</a>, or, if that
     fails, to the console.  If the kernel was compiled with the IPV6FIREWALL_VERBOSE_LIMIT option, then
     logging will cease after the number of packets specified by the option are received for that particular
     chain entry.  When this limit is reached, the limit and rule number will be logged.  Logging may then
     be re-enabled by clearing the packet counter for that entry.

     The <a href="syslogd.8.html#//apple_ref/doc/man/8/syslogd">syslogd(8)</a> logging and the default log limit are adjustable dynamically through the <a href="sysctl.8.html#//apple_ref/doc/man/8/sysctl">sysctl(8)</a>
     interface.

     <u>proto</u>:

         <u>ipv6</u>              All packets match.  The alias <u>all</u> has the same effect.

         <u>tcp</u>               Only TCP packets match.

         <u>udp</u>               Only UDP packets match.

         <u>ipv6-icmp</u>         Only ICMPv6 packets match.

         <u>&lt;number|name&gt;</u>     Only packets for the specified protocol matches (see <u>/etc/protocols</u> for a com-<font color="#ffffff" class="whiteout">plete&nbsp;complete</font>
                           plete list).

     <u>src</u> and <u>dst</u>:

         <u>&lt;address/prefixlen&gt;</u> [<u>ports</u>]

     The <u>&lt;address/prefixlen&gt;</u> may be specified as:

         <u>ipv6no</u>            An ipv6number of the form fec0::1:2:3:4.

         <u>ipv6no/prefixlen</u>  An ipv6number with a prefix length of the form fec0::1:2:3:4/112.

     The sense of the match can be inverted by preceding an address with the ``not'' modifier, causing all
     other addresses to be matched instead.  This does not affect the selection of port numbers.

     With the TCP and UDP protocols, optional <u>ports</u> may be specified as:

         {port|port-port}[,port[,...]]

     Service names (from <u>/etc/services</u>) may be used instead of numeric port values.  A range may only be
     specified as the first value, and the length of the port list is limited to IPV6_FW_MAX_PORTS (as
     defined in <u>/usr/src/sys/netinet6/ip6</u><b>_</b><u>fw.h</u>) ports.

     Fragmented packets which have a non-zero offset (i.e. not the first fragment) will never match a rule
     which has one or more port specifications.  See the <u>frag</u> option for details on matching fragmented
     packets.

     Rules can apply to packets when they are incoming, or outgoing, or both.  The <u>in</u> keyword indicates the
     rule should only match incoming packets.  The <u>out</u> keyword indicates the rule should only match outgoing
     packets.

     To match packets going through a certain interface, specify the interface using <u>via</u>:

         <u>via</u> <u>ifX</u>           Packet must be going through interface <u>ifX</u>.

         <u>via</u> <u>if*</u>           Packet must be going through interface <u>ifX</u>, where X is any unit number.

         <u>via</u> <u>any</u>           Packet must be going through <u>some</u> interface.

         <u>via</u> <u>ipv6no</u>        Packet must be going through the interface having IPv6 address <u>ipv6no</u>.

     The <u>via</u> keyword causes the interface to always be checked.  If <u>recv</u> or <u>xmit</u> is used instead of <u>via</u>,
     then the only receive or transmit interface (respectively) is checked.  By specifying both, it is pos-<font color="#ffffff" class="whiteout">sible&nbsp;possible</font>
     sible to match packets based on both receive and transmit interface, e.g.:

           ip6fw add 100 deny ip from any to any out recv ed0 xmit ed1

     The <u>recv</u> interface can be tested on either incoming or outgoing packets, while the <u>xmit</u> interface can
     only be tested on outgoing packets.  So <u>out</u> is required (and <u>in</u> invalid) whenever <u>xmit</u> is used.  Speci-<font color="#ffffff" class="whiteout">fying&nbsp;Specifying</font>
     fying <u>via</u> together with <u>xmit</u> or <u>recv</u> is invalid.

     A packet may not have a receive or transmit interface: packets originating from the local host have no
     receive interface. while packets destined for the local host have no transmit interface.

     Additional <u>options</u>:

         frag              Matches if the packet is a fragment and this is not the first fragment of the
                           datagram.  <u>frag</u> may not be used in conjunction with either <u>tcpflags</u> or TCP/UDP
                           port specifications.

         in                Matches if this packet was on the way in.

         out               Matches if this packet was on the way out.

         ipv6options <u>spec</u>  Matches if the IPv6 header contains the comma separated list of options specified
                           in <u>spec</u>.  The supported IPv6 options are: <u>hopopt</u> (hop-by-hop options header),
                           <u>route</u> (routing header), <u>frag</u> (fragment header), <u>esp</u> (encapsulating security pay-<font color="#ffffff" class="whiteout">load),&nbsp;payload),</font>
                           load), <u>ah</u> (authentication header), <u>nonxt</u> (no next header), and <u>opts</u> (destination
                           options header).  The absence of a particular option may be denoted with a ``!''
                           (<u>not</u> <u>working</u> <u>yet</u>).

         established       Matches packets that have the RST or ACK bits set.  TCP packets only.

         setup             Matches packets that have the SYN bit set but no ACK bit.  TCP packets only.

         tcpflags <u>spec</u>     Matches if the TCP header contains the comma separated list of flags specified in
                           <u>spec</u>.  The supported TCP flags are: <u>fin</u>, <u>syn</u>, <u>rst</u>, <u>psh</u>, <u>ack</u>, and <u>urg</u>.  The
                           absence of a particular flag may be denoted with a ``!''.  A rule which contains
                           a <u>tcpflags</u> specification can never match a fragmented packet which has a non-zero
                           offset.  See the <u>frag</u> option for details on matching fragmented packets.

         icmptypes <u>types</u>   Matches if the ICMPv6 type is in the list <u>types</u>.  The list may be specified as
                           any combination of ranges or individual types separated by commas.

<b>CHECKLIST</b>
     Here are some important points to consider when designing your rules:

         <b></b><b><u>oo</u></b>   Remember that you filter both packets going in and out.  Most connections need packets going in
             both directions.

         <b></b><b><u>oo</u></b>   Remember to test very carefully.  It is a good idea to be near the console when doing this.

         <b></b><b><u>oo</u></b>   Don't forget the loopback interface.

<b>FINE</b> <b>POINTS</b>
     There is one kind of packet that the firewall will always discard, that is an IPv6 fragment with a
     fragment offset of one.  This is a valid packet, but it only has one use, to try to circumvent fire-<font color="#ffffff" class="whiteout">walls.&nbsp;firewalls.</font>
     walls.

     If you are logged in over a network, loading the KLD version of <b>ip6fw</b> is probably not as straightfor-<font color="#ffffff" class="whiteout">ward&nbsp;straightforward</font>
     ward as you would think (<u>not</u> <u>supported</u>).  I recommend this command line:

                               kldload /modules/ip6fw_mod.o &amp;&amp; \
                               ip6fw add 32000 allow all from any to any

     Along the same lines, doing an

                               ip6fw flush

     in similar surroundings is also a bad idea.

<b>PACKET</b> <b>DIVERSION</b>
     not supported.

<b>EXAMPLES</b>
     This command adds an entry which denies all tcp packets from <u>hacker.evil.org</u> to the telnet port of
     <u>wolf.tambov.su</u> from being forwarded by the host:

           ip6fw add deny tcp from hacker.evil.org to wolf.tambov.su 23

     This one disallows any connection from the entire hackers network to my host:

           ip6fw add deny all from fec0::123:45:67:0/112 to my.host.org

     Here is a good usage of the list command to see accounting records and timestamp information:

           ip6fw -at l

     or in short form without timestamps:

           ip6fw -a l

<b>SEE</b> <b>ALSO</b>
     <a href="../man4/ip.4.html#//apple_ref/doc/man/4/ip">ip(4)</a>, <a href="../man4/ipfirewall.4.html#//apple_ref/doc/man/4/ipfirewall">ipfirewall(4)</a>, <a href="../man5/protocols.5.html#//apple_ref/doc/man/5/protocols">protocols(5)</a>, <a href="../man5/services.5.html#//apple_ref/doc/man/5/services">services(5)</a>, <a href="reboot.8.html#//apple_ref/doc/man/8/reboot">reboot(8)</a>, <a href="sysctl.8.html#//apple_ref/doc/man/8/sysctl">sysctl(8)</a>, <a href="syslogd.8.html#//apple_ref/doc/man/8/syslogd">syslogd(8)</a>

<b>BUGS</b>
     <u>WARNING!!WARNING!!WARNING!!WARNING!!WARNING!!WARNING!!WARNING!!</u>

     This program can put your computer in rather unusable state.  When using it for the first time, work on
     the console of the computer, and do <u>NOT</u> do anything you don't understand.

     When manipulating/adding chain entries, service and protocol names are not accepted.

<b>AUTHORS</b>
     Ugen J. S. Antsilevich,
     Poul-Henning Kamp,
     Alex Nash,
     Archie Cobbs.

     API based upon code written by Daniel Boulet for BSDI.

<b>HISTORY</b>
     A <b>ip6fw</b> utility first appeared in FreeBSD 4.0.

BSD                             March 13, 2000                             BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man8/ip6fw.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man8/ip6fw.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man8/ip6fw.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
