<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>SCSI Simple Sample - /Src/SCSISimpleSample.h</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; <A HREF="javascript:location.replace('index.html');">SCSI Simple Sample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxSCSI-date.html" target="_blank">Hardware & Drivers > SCSI</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">SCSI Simple Sample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Src/SCSISimpleSample.h</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Src/AsyncSCSI.c</option>
<option value="listing2.html">/Src/AsyncSCSIPresent.c</option>
<option value="listing3.html">/Src/DoGetDriveInfo.c</option>
<option value="listing4.html">/Src/DoListSCSIDevices.c</option>
<option value="listing5.html">/Src/DoReadBlockZero.c</option>
<option value="listing6.html">/Src/DoSCSICommandWithSense.c</option>
<option value="listing7.html">/Src/DoTestUnitReady.c</option>
<option value="listing8.html">/Src/LogManager.c</option>
<option value="listing9.html">/Src/LogManager.h</option>
<option value="listing10.html">/Src/MacSCSICommand.h</option>
<option value="listing11.html">/Src/OriginalSCSI.c</option>
<option value="listing12.html">/Src/scsi.h</option>
<option value="listing13.html">/Src/SCSIBusAPI.c</option>
<option value="listing14.html">/Src/SCSICheckForDevicePresent.c</option>
<option value="listing15.html">/Src/SCSIGetCommandLength.c</option>
<option value="listing16.html">/Src/SCSIGetHighHostBusAdaptor.c</option>
<option value="listing17.html">/Src/SCSIGetInitiatorID.c</option>
<option value="listing18.html">/Src/SCSIGetMaxTargetID.c</option>
<option value="listing19.html">/Src/SCSISimpleSample.h</option>
<option value="listing20.html">/Src/SCSISimpleSample.r</option>
<option value="listing21.html">/Src/SCSISimpleSampleDisplay.c</option>
<option value="listing22.html">/Src/SCSISimpleSampleMain.c</option>
<option value="listing23.html">/Src/StringFormat.c</option>
<option value="listing24.html">/Src/WindowUtilities.c</option></select>
				</p>
				</form>
				<p><strong><a href="SCSI_Simple_Sample.zip">Download Sample</a></strong> (&#147;SCSI_Simple_Sample.zip&#148;, 108.1K)<BR>
<strong><a href="SCSI_Simple_Sample.dmg">Download Sample</a></strong> (&#147;SCSI_Simple_Sample.dmg&#148;, 170.5K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*                SCSISimpleSample.h                *//* * SCSISimpleSample.h * Copyright &copy; 1992-94 Apple Computer Inc. All Rights Reserved. */#ifdef REZ#define kApplicationCreator  '????'      /* Rez can't deal with long hex    */#else#define kApplicationCreator  0x3F3F3F3FL    /* '????' without trigraphs      */#endif#define MBAR_MenuBar    1000#define MENU_Apple      1#define MENU_File      128#define MENU_Edit      129#define MENU_Test      130#define MENU_CurrentBus    131#define MENU_CurrentTarget  132#define MENU_CurrentLUN    133#define STRS_SenseBase    1000#define DLOG_About      128#define kMinWindowWidth    200#define kMinWindowHeight  300#define kLogLines      512#ifndef REZ/* * These definitions are only for the code files. */#ifndef THINK_C        /* MPW includes      */#include &lt;Errors.h&gt;#include &lt;Script.h&gt;#include &lt;Types.h&gt;#include &lt;Resources.h&gt;#include &lt;QuickDraw.h&gt;#include &lt;Fonts.h&gt;#include &lt;Events.h&gt;#include &lt;Windows.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;Memory.h&gt;#include &lt;Menus.h&gt;#include &lt;Lists.h&gt;#include &lt;Printing.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Packages.h&gt;#endif#ifndef TRUE#define TRUE  1#define FALSE  0#endif#ifndef EXTERN#define EXTERN  extern#endif#include &quot;MacSCSICommand.h&quot;#include &quot;LogManager.h&quot;#define kScrollBarWidth    16#define kScrollBarOffset  (kScrollBarWidth - 1)/* * Items in the Apple Menu */enum {  kAppleAbout = 1};/* * Items in the File Menu */enum {  kFileCreateLogFile = 1,  kFileCloseLogFile,  kFileUnused1,  kFilePageSetup,  kFilePrint,  kFileUnused2,  kFileDebug,  kFileUnused3,  kFileQuit};enum EditMenu {  kEditUndo        = 1,  kEditUnused,  kEditCut,  kEditCopy,  kEditPaste,  kEditClear};/* * Items in the test Menu */enum {  kTestEnableNewManager = 1,  kTestEnableAllLogicalUnits,  kTestEnableSelectWithATN,  kTestUnused1,  kTestDoDisconnect,  kTestDontDisconnect,  kTestUnused2,  kTestListSCSIDevices,  kTestGetDriveInfo,  kTestUnitReady,  kTestReadBlockZero,  kTestUnused3,  kTestVerboseDisplay,  kTestDummyLastEntryThankYouANSICCommittee};/* * This is a parameter block for DoSCSICommandWithSense that contains all of the * data needed to perform a SCSI command on either the original or asynchronous * SCSI Managers. Note: some of this is used only by one or the other manager. */struct ScsiCmdBlock {  DeviceIdent      scsiDevice;        /* -&gt; Bus/target/LUN      */  Ptr          bufferPtr;        /* -&gt; data buffer        */  unsigned long    transferSize;      /* -&gt; bytes to transfer      */  unsigned long    transferQuantum;    /* -&gt; polled or blocksize    */  unsigned short    statusByte;        /* &lt;- From Status Phase      */  unsigned long    actualTransferCount;  /* &lt;- Transfer count      */  Boolean        writeToDevice;      /* -&gt; Need data out?      */  unsigned long    scsiFlags;        /* -&gt; asynch flags        */  OSErr        status;          /* &lt;- Current OSErr        */  OSErr        requestSenseStatus;    /* &lt;- From RequestSense      */  SCSI_Command    command;        /* -&gt; Current command      */  SCSI_Sense_Data    sense;          /* &lt;- Gets Sense data      */};typedef struct ScsiCmdBlock ScsiCmdBlock, *ScsiCmdBlockPtr;/* * Notes on the above: *  scsiDevice      Used for both managers, but the original manager *            ignores the bus and LUN designations. The caller *            must stuff the LUN into the command data block. *  bufferPtr      If NULL, no read/write is performed. *  transferSize    If zero, no read/write is performed. *  transferQuantum    This is used by the handshake and TIB setup. Note: *            we support only the simplest &quot;512, 0&quot; handshake *            and TIB. The following values are useful: *              0    transferQuantum := transferSize *              1    force polled read/write *              &gt; 1    blocked read (for example, 512) *  statusByte      Returned from the device *  actualTransfercount Returned in bytes (transferQuantum sets granularity) *  scsiFlags      Set special flags (scsiDontDisconnect) here. *  status        Overall operation status (note special status values) *  requestSenseStatus  Has status of Request Sense (only if status was *            statusErr, indicating that &quot;Check condition&quot; status. */  /* * These are the things the user can choose from the menu: *  ListSCSIDevices        Scan all busses and display info for all *                devices (all targets, all LUNs) *  DeviceInquiry        Execute an Inquiry command for this device *                and display the results. *  TestUnitReady        Execute a Test Unit Ready command for this *                device and display the results. */void            DoListSCSIDevices(void);void            DoGetDriveInfo(    DeviceIdent        scsiDevice,        /* -&gt; Bus/target/LUN  */    Boolean          noIntroMsg,    Boolean          useAsynchManager  );void            DoTestUnitReady(    DeviceIdent        scsiDevice        /* -&gt; Bus/target/LUN  */  );void            DoReadBlockZero(    DeviceIdent        scsiDevice        /* -&gt; Bus/target/LUN  */  );/* * These are low-level commands that are needed to scan the bus. */Boolean            SCSICheckForDevicePresent(    DeviceIdent        scsiDevice,    Boolean          enableAsynchSCSI  );/* * Check whether the asynchronous SCSI Manager may be called for this bus. * This will return a status error if the bus is inaccessable. If successful, * it will set useAsynchManager FALSE only if this bus is managed by a * third-party SCSI hardware interface that operates by patching the * original SCSI Manager traps, or uses some other private interface. */OSErrSCSIBusAPI(    DeviceIdent        scsiDevice,    Boolean          *useAsynchManager  );/* * Get the maximum target for a specified bus. */OSErrSCSIGetMaxTargetID(    DeviceIdent            scsiDevice,    unsigned short          *maxTarget  );/* * Return the number of SCSI busses on this system. */OSErr            SCSIGetHighHostBusAdaptor(    unsigned short      *lastHostBus  );/* * Return the SCSI bus ID of the initiator (Macintosh) on this bus. This will * normally return 7. It always returns 7 if the asynchronous SCSI Manager is * not present on this machine. Errors are serious. */ OSErr            SCSIGetInitiatorID(    DeviceIdent        scsiDevice,    unsigned short      *initiatorID  );/* * TRUE if the asynchronous SCSI Manager is running on this machine. */Boolean            AsyncSCSIPresent(void);/* * All commands are performed by this function. If the asynchronous SCSI Manager * is present, it is called directly. If it is not present, the original SCSI * Manager is called and, if the device returns Check Condition, a Request * Sense command is issued. */void            DoSCSICommandWithSense(    register ScsiCmdBlockPtr  scsiCmdBlockPtr,    Boolean          displayError,    Boolean          enableAsynchSCSI  );/* * The following functions display operation results. */void            ShowSCSIBusID(    DeviceIdent        scsiDevice,        /* -&gt; Bus/target/LUN  */    ConstStr255Param    commandText  );void            ShowRequestSense(    register ScsiCmdBlockPtr  scsiCmdBlockPtr  );/* * This does the actual formatting and display of the Request Sense results */void            DoShowRequestSense(    DeviceIdent        scsiDevice,    OSErr          operationStatus,    OSErr          requestSenseStatus,    const SCSI_CommandPtr  scsiCommand,    const SCSI_Sense_Data  *sensePtr  );void            ShowStatusError(    DeviceIdent        scsiDevice,        /* -&gt; Bus/target/LUN  */    OSErr          errorStatus,    const SCSI_CommandPtr  scsiCommand  );void            DoShowSCSICommand(    const SCSI_CommandPtr  cmdBlock,      /* -&gt; SCSI command      */    ConstStr255Param    message  );/* * The inquiry data is stored in SCB.bufferPtr */void            ShowInquiry(    register ScsiCmdBlockPtr  scsiCmdBlockPtr  );void            DoShowInquiry(    DeviceIdent        scsiDevice,        /* -&gt; Bus/target/LUN  */    const SCSI_Inquiry_Data  *inquiry  );void            ShowDeviceState(    register ScsiCmdBlockPtr  scsiCmdBlockPtr  );void            AppendDeviceID(    StringPtr        result,    DeviceIdent        scsiDevice        /* -&gt; Bus/target/LUN  */  );void            DisplaySCSIErrorMessage(    OSErr          errorStatus,    ConstStr255Param    errorText  );/* * Use the SCSI-II command class to determine the command length. Returns * zero if the length could not be determined. */unsigned short        SCSIGetCommandLength(    const Ptr        cmdBlock  );/* * These two functions are called by DoSCSICommandWithSense to perform the * actual operation. OriginalSCSI uses the Inside Mac IV SCSI Manager, while * AsyncSCSI uses SCSI Manager 4.3. * Return codes: * *  noErr      normal *  unimpErr    AsyncSCSI called, but SCSI Manager 4.3 not installed. *  scCommErr    Could not select this device or bus busy (Original only) *  statusErr    Device returned &quot;Check condition&quot; *  controlErr    Device returned &quot;Busy&quot; (Note: device error) *  ioErr      Other (serious) device status -- bug. *  sc...      Other (Inside Mac IV) SCSI Manager error *  scsi...      Other (SCSI Manager 4.3) error. */OSErr            OriginalSCSI(    unsigned short      targetID,      /* Device ID on this bus  */    const SCSI_CommandPtr  scsiCommand,    /* The actual scsi command  */    unsigned short      cmdBlockLength,    /* -&gt; Length of CDB      */    Boolean          writeToDevice,    /* TRUE to write      */    Ptr            bufferPtr,      /* -&gt; user data buffer    */    unsigned long      transferSize,    /* How much to transfer    */    unsigned long      transferQuantum,  /* TIB setup parameter    */    unsigned long      completionTimeout,  /* Ticks to wait      */    unsigned short      *stsBytePtr,    /* &lt;- status phase byte    */    unsigned long      *actualTransferCount  );/* * AsyncSCSI returns unimpErr if the _SCSIAtomic (SCSI Manager 4.3) * trap is not present. If so, just call the &quot;old&quot; OriginalSCSI. */OSErr            AsyncSCSI(    DeviceIdent        scsiDevice,      /* -&gt; Bus/target/LUN    */    const SCSI_CommandPtr  scsiCommand,    /* The actual scsi command  */    unsigned short      cmdBlockLength,    /* -&gt; Length of CDB      */    Boolean          writeToDevice,    /* TRUE to write      */    Ptr            bufferPtr,      /* -&gt; user data buffer    */    unsigned long      transferSize,    /* How much to transfer    */    unsigned short      scsiHandshake[handshakeDataLength],    SCSI_Sense_Data      *senseDataPtr,    /* Request Sense results  */    unsigned long      senseDataSize,    /* Request Sense data size  */    unsigned long      completionTimeout,  /* Ticks to wait      */    unsigned short      *stsBytePtr,    /* &lt;- status phase byte    */    unsigned long      *actualTransferCount  );/* * String formatting utilities (for debugging/display) *//* * AppendChar writes a character into the string. Note that * it wraps around if the string size exceeds 255 bytes. */#define AppendChar(result, c) (result[++result[0]] = (c))void            AppendUnsigned(    StringPtr        result,    unsigned long      value  );void            AppendSigned(    StringPtr        result,    signed long        value  );void            AppendUnsignedLeadingZeros(    StringPtr        result,    unsigned long      value,    short          fieldWidth,    short          terminatorChar  );void            AppendHexLeadingZeros(    StringPtr        result,    unsigned long      value,    short          fieldWidth  );void            AppendUnsignedInField(    StringPtr        result,    unsigned long      value,    short          fieldWidth  );void            AppendBytes(    StringPtr        result,    const Ptr        source,    unsigned short      length  );void            AppendPascalString(    StringPtr        result,    const StringPtr      value  );void            AppendCString(    StringPtr        result,    const char        *source,    unsigned short      maxLength    /* Ignored if zero  */  );void            AppendOSType(    StringPtr        result,    OSType          value  );/* * Window Utilities */void            DoZoomWindow(    WindowPtr        theWindow,    short          whichPart  );Boolean            DoGrowWindow(    WindowPtr        theWindow,    Point          eventWhere,    short          minimumWidth,    short          minimumHeight  );void            MyDrawGrowIcon(    WindowPtr        theWindow  );/* * Format a block of data into the log. */void            DisplayDataBlock(    Ptr            dataPtr,    unsigned short      dataLength  );/* * Cheap 'n dirty pascal string copy routine. */#define pstrcpy(dst, src) do {              \    StringPtr  _src = (StringPtr) (src);      \    BlockMove(_src, dst, _src[0] + 1);        \  } while (0)/* * Cheap 'n dirty pascal string concat. */#define pstrcat(dst, src) do {              \    StringPtr    _dst = (dst);          \    StringPtr    _src = (StringPtr) (src);    \    short      _len;              \    _len = 255 - _dst[0];              \    if (_len &gt; _src[0]) _len = _src[0];        \    BlockMove(&amp;_src[1], &amp;_dst[1] + _dst[0], _len);  \    _dst[0] += _len;                \  } while (0)/* * Cheap 'n dirty memory clear routine. */#define CLEAR(record) do {                \    register char  *ptr = (char *) &amp;record;    \    register long  size;              \    for (size = sizeof record; size &gt; 0; --size)  \      *ptr++ = 0;                  \  } while (0)#define width(r)  ((r).right - (r).left)#define height(r)  ((r).bottom - (r).top)#define LOG(what)  DisplayLogString(gLogListHandle, (what))#define VERBOSE(what) do {                \    if (gVerboseDisplay)              \      LOG(what);                  \  } while (0)/* * Global variables. */EXTERN WindowPtr        gMainWindow;EXTERN EventRecord        gCurrentEvent;#define EVENT          (gCurrentEvent)EXTERN ListHandle        gLogListHandle;EXTERN THPrint          gPrintHandle;EXTERN Boolean          gQuitNow;EXTERN Boolean          gUpdateMenusNeeded;EXTERN Boolean          gInForeground;/* * These flags are set/cleared by menu options to control the asynchronous SCSI * Manager -- they are not used if the asynchronous manager is not present. *  gEnableNewSCSIManager    FALSE to always use the original manager, *                even if the new manager is present. *  gEnableSelectWithATN    FALSE to supress Select With ATN. *  gDoDisconnect        Set the scsibDoDisconnect flag *  gDontDisconnect        Set the scsibDontDisconnect flag. *                Note: both &quot;do&quot; and &quot;don't&quot; may be set. */EXTERN Boolean          gEnableNewSCSIManager;EXTERN Boolean          gEnableSelectWithATN;EXTERN Boolean          gDoDisconnect;EXTERN Boolean          gDontDisconnect;EXTERN Boolean          gVerboseDisplay;EXTERN MenuHandle        gAppleMenu;EXTERN MenuHandle        gFileMenu;EXTERN MenuHandle        gEditMenu;EXTERN MenuHandle        gTestMenu;EXTERN MenuHandle        gCurrentBusMenu;EXTERN MenuHandle        gCurrentTargetMenu;EXTERN MenuHandle        gCurrentLUNMenu;EXTERN DeviceIdent        gCurrentDevice;EXTERN unsigned short      gMaxLogicalUnit;EXTERN DeviceIdent        *gDeviceList;EXTERN unsigned short      gMaxDevice;    /* Number of items in gDeviceList  */#endif    /* REZ      */</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/SCSI_Simple_Sample/listing19.html%3Fid%3DDTS10000027-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/SCSI_Simple_Sample/listing19.html%3Fid%3DDTS10000027-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/SCSI_Simple_Sample/listing19.html%3Fid%3DDTS10000027-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>