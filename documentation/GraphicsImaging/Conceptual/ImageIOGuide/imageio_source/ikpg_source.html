<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Image I/O Programming Guide: Creating and Using Image Sources</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating and Using Image Sources"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005462-CH218" title="Creating and Using Image Sources"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../imageio_intro/ikpg_intro.html#//apple_ref/doc/uid/TP40005462-CH201-TPXREF101">Image I/O Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../imageio_basics/ikpg_basics.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ikpg_dest/ikpg_dest.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005462-CH218-SW3" title="Creating and Using Image Sources"></a><h1>Creating and Using Image Sources</h1><p>An image source abstracts the data-access task and eliminates the need for you to manage data through a raw memory buffer. An image source can  contain more than one image, thumbnail images, and properties for each image and the image file. When you are working with image data and your application runs in Mac OS X v10.4 or later, image sources are the preferred way to move image data into your application. After creating a <code>CGImageSource</code> object, you can obtain images, thumbnails, image properties, and other image information using the functions described in <em><a href="../../../Reference/CGImageSource/index.html#//apple_ref/doc/uid/TP40001399" target="_top">CGImageSource Reference</a></em>.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_4">Creating an Image From an Image Source</a>
				
			<br/>
			
        
			
			
				<a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_5">Creating a Thumbnail Image From an Image Source</a>
				
			<br/>
			
        
			
			
				<a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_6">Incrementally Loading an Image</a>
				
			<br/>
			
        
			
			
				<a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_7">Displaying Image Properties</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_4" title="Creating an Image From an Image Source"></a><h2>Creating an Image From an Image Source</h2><p>One of the most common tasks you’ll perform with the Image I/O framework is to create an image from an image source, similar to what’s shown in <span class="content_text">Listing 1-1</span>. This example shows how to create an image source from a path name and then extract the image. When you create an image source object, you can provide a hint as to the format of the image source file. </p><p>When you create an image from an image source, you must specify an index and you can provide a dictionary of properties (key-value pairs) to specify such things as whether to create a thumbnail or allow caching.  <em><a href="../../../Reference/CGImageSource/index.html#//apple_ref/doc/uid/TP40001399" target="_top">CGImageSource Reference</a></em> and <em><a href="../../../Reference/CGImageProperties_Reference/index.html#//apple_ref/doc/uid/TP40005103" target="_top">CGImageProperties Reference</a></em> list keys and the expected data type of the value for each key. </p><p>You need to supply an index value because some image file formats allow multiple images to reside in the same source file. For an image source file that contains only one image, pass <code>0</code>. You can find out the number of images in an image source file by calling the function <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceGetCount" target="_top">CGImageSourceGetCount</a></code>.</p><a name="//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_8" title="Listing 2-1Creating an image from an image source"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Creating an image from an image source</p><div class="codesample"><table><tr><td scope="row"><pre>CGImageRef MyCreateCGImageFromFile (NSString* path)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the URL for the pathname passed to the function.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSURL             url = [NSURL fileURLWithPath:path];<span></span></pre></td></tr><tr><td scope="row"><pre>    CGImageRef        myImage = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGImageSourceRef  myImageSource;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDictionary      myOptions = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef       myKeys[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    CFTypeRef         myValues[2];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Set up options if you want them. The options here are for caching the image<span></span></pre></td></tr><tr><td scope="row"><pre>    // in a decoded form and for using floating-point values if the image<span></span></pre></td></tr><tr><td scope="row"><pre>    // format supports them.<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeys[0] = kCGImageSourceShouldCache;<span></span></pre></td></tr><tr><td scope="row"><pre>    myValues[0] = (CFTypeRef)kCFBooleanTrue;<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeys[1] = kCGImageSourceShouldAllowFloat;<span></span></pre></td></tr><tr><td scope="row"><pre>    myValues[1] = (CFTypeRef)kCFBooleanTrue;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create the dictionary<span></span></pre></td></tr><tr><td scope="row"><pre>    myOptions = CFDictionaryCreate(NULL, (const void **) myKeys,<span></span></pre></td></tr><tr><td scope="row"><pre>                   (const void **) myValues, 2,<span></span></pre></td></tr><tr><td scope="row"><pre>                   &amp;kCFTypeDictionaryKeyCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>                   &amp; kCFTypeDictionaryValueCallBacks);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create an image source from the URL.<span></span></pre></td></tr><tr><td scope="row"><pre>    myImageSource = CGImageSourceCreateWithURL((CFURLRef)url, myOptions);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Make sure the image source exists before continuing<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myImageSource == NULL){<span></span></pre></td></tr><tr><td scope="row"><pre>        fprintf(stderr, "Image source is NULL.");<span></span></pre></td></tr><tr><td scope="row"><pre>        return  NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create an image from the first item in the image source.<span></span></pre></td></tr><tr><td scope="row"><pre>    myImage = CGImageSourceCreateImageAtIndex(myImageSource,<span></span></pre></td></tr><tr><td scope="row"><pre>                                           0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                           NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(myImageSource);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Make sure the image exists before continuing<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myImage == NULL){<span></span></pre></td></tr><tr><td scope="row"><pre>         fprintf(stderr, "Image not created from image source.");<span></span></pre></td></tr><tr><td scope="row"><pre>         return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return myImage;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_5" title="Creating a Thumbnail Image From an Image Source"></a><h2>Creating a Thumbnail Image From an Image Source</h2><p>Some image source files contain thumbnail images that you can retrieve. If thumbnails aren’t already present, Image I/O gives you the option of creating them. You can also specify a maximum thumbnail size and whether to apply a transform to the thumbnail image.</p><p><span class="content_text">Listing 2-2</span> shows how to create an image source from data, set up an dictionary that contains options related to the thumbnail, and then create a thumbnail image. You use the <code>kCGImageSourceCreateThumbnailWithTransform</code> key to specify whether the thumbnail image should be rotated and scaled to match the orientation and pixel aspect ratio of the full image.</p><a name="//apple_ref/doc/uid/TP40005462-CH218-SW4" title="Listing 2-2Creating a thumbnail image"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Creating a thumbnail image</p><div class="codesample"><table><tr><td scope="row"><pre>CGImageRef MyCreateThumbnailImageFromData (NSData * data, int imageSize)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGImageRef        myImage = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGImageSourceRef  myImageSource;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDictionary      myOptions = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef       myKeys[3];<span></span></pre></td></tr><tr><td scope="row"><pre>    CFTypeRef         myValues[3];<span></span></pre></td></tr><tr><td scope="row"><pre>    CFNumberRef       thumbnailSize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Package the integer as a  CFNumber object. Using CFTypes allows you<span></span></pre></td></tr><tr><td scope="row"><pre>   // to more easily create the options dictionary later.<span></span></pre></td></tr><tr><td scope="row"><pre>   thumbnailSize = CFNumberCreate(NULL, kCFNumberIntType, &amp;imageSize);<span></span></pre></td></tr><tr><td scope="row"><pre>   // Create an image source from NSData; no options.<span></span></pre></td></tr><tr><td scope="row"><pre>   myImageSource = CGImageSourceCreateWithData((CFDataRef)data,<span></span></pre></td></tr><tr><td scope="row"><pre>                                               NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>   // Make sure the image source exists before continuing<span></span></pre></td></tr><tr><td scope="row"><pre>   if (myImageSource == NULL){<span></span></pre></td></tr><tr><td scope="row"><pre>        fprintf(stderr, "Image source is NULL.");<span></span></pre></td></tr><tr><td scope="row"><pre>        return  NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre>   // Set up the thumbnail options<span></span></pre></td></tr><tr><td scope="row"><pre>   myKeys[0] = kCGImageSourceCreateThumbnailWithTransform;<span></span></pre></td></tr><tr><td scope="row"><pre>   myValues[0] = (CFTypeRef)kCFBooleanTrue;<span></span></pre></td></tr><tr><td scope="row"><pre>   myKeys[1] = kCGImageSourceCreateThumbnailFromImageIfAbsent;<span></span></pre></td></tr><tr><td scope="row"><pre>   myValues[1] = (CFTypeRef)kCFBooleanTrue;<span></span></pre></td></tr><tr><td scope="row"><pre>   myKeys[2] = kCGImageSourceThumbnailMaxPixelSize;<span></span></pre></td></tr><tr><td scope="row"><pre>   myValues[2] = (CFTypeRef)thumbnailSize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   myOptions = CFDictionaryCreate(NULL, (const void **) myKeys,<span></span></pre></td></tr><tr><td scope="row"><pre>                   (const void **) myValues, 2,<span></span></pre></td></tr><tr><td scope="row"><pre>                   &amp;kCFTypeDictionaryKeyCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>                   &amp; kCFTypeDictionaryValueCallBacks);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  // Create the thumbnail image using the specified options<span></span></pre></td></tr><tr><td scope="row"><pre>  myThumbnailImage = CGImageSourceCreateThumbnailAtIndex(myImageSource,<span></span></pre></td></tr><tr><td scope="row"><pre>                                          0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                          myOptions);<span></span></pre></td></tr><tr><td scope="row"><pre>  // Release the options dictionary and the image source,<span></span></pre></td></tr><tr><td scope="row"><pre>  // when you no longer need them.<span></span></pre></td></tr><tr><td scope="row"><pre>  CFRelease(myOptions);<span></span></pre></td></tr><tr><td scope="row"><pre>  CFRelease(myImageSource);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Make sure the thumbnail image exists before continuing.<span></span></pre></td></tr><tr><td scope="row"><pre>   if (myThumbnailImage == NULL){<span></span></pre></td></tr><tr><td scope="row"><pre>         fprintf(stderr, "Thumbnail image not created from image source.");<span></span></pre></td></tr><tr><td scope="row"><pre>         return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   return myThumbnailImage;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_6" title="Incrementally Loading an Image"></a><h2>Incrementally Loading an Image</h2><p>If you have a very large image, or are loading image data over the web, you may want to create an incremental image source so that you can draw the image data as you accumulate it. You need to perform the following tasks to load an image incrementally from a <code>CFData</code> object:</p><ol class="ol"><li class="li"><p>Create the <code>CFData</code> object for accumulating the image data.</p></li><li class="li"><p>Create an incremental image source by calling the function <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceCreateIncremental" target="_top">CGImageSourceCreateIncremental</a></code>.</p></li><li class="li"><p>Add image data to the <code>CFData</code> object.</p></li><li class="li"><p>Call the function <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceUpdateData" target="_top">CGImageSourceUpdateData</a></code>, passing the <code>CFData</code> object and a Boolean value (<code>bool</code> data type) that specifies whether the data parameter contains the entire image, or just partial image data. In any case, the data parameter must contain all the image file data accumulated up to that point. </p></li><li class="li"><p>If you have accumulated enough image data, create an image by calling <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceCreateImageAtIndex" target="_top">CGImageSourceCreateImageAtIndex</a></code>, draw the partial image, and then release it.</p></li><li class="li"><p>Check to see if you have all the data for an image by calling the function <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceGetStatusAtIndex" target="_top">CGImageSourceGetStatusAtIndex</a></code>. If the image is complete, this function returns <code>kCGImageStatusComplete</code>. If the image is not complete, repeat steps 3 and 4 until it is.</p></li><li class="li"><p>Release the incremental image source.</p></li></ol><a name="//apple_ref/doc/uid/TP40005462-CH218-DontLinkElementID_7" title="Displaying Image Properties"></a><h2>Displaying Image Properties</h2><p>Digital photos are tagged with a wealth of information about the image—image dimensions, resolution, orientation, color profile, aperture, metering mode, focal length, creation date, keywords, caption, and much more. This information is extremely useful for image handling and editing, but only if the data is exposed in the user interface. Although the <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceCopyPropertiesAtIndex" target="_top">CGImageSourceCopyPropertiesAtIndex</a></code> function retrieves a dictionary of all the properties associated with an image in an image source, you’ll need to write code that traverses that dictionary to retrieve and then display that information. </p><p>In this section you’ll take a close look at a routine from the <em><a href="../../../../../samplecode/ImageApp/index.html#//apple_ref/doc/uid/DTS10003685" target="_top">ImageApp</a></em> sample code, which is an image display application that you can download and experiment with. One of the features of the <em><a href="../../../../../samplecode/ImageApp/index.html#//apple_ref/doc/uid/DTS10003685" target="_top">ImageApp</a></em> sample code is an Image Info panel that displays a thumbnail image and image properties for the currently active image, as shown in  <span class="content_text">Figure 2-1</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40005462-CH218-SW1" title="Figure 2-1An Info panel that displays image properties"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>An Info panel that displays image properties</p><img src = "../art/info_properties.jpg" alt = "An Info panel that displays image properties" ></div><br/><p>You can take a look at the <code>ImageInfoPanel.h</code> and <code>ImageInfoPanel.m</code> files for all the implementation details of this panel; you’ll also need to look at the nib file for the project to see how the panel and bindings are set up. To get an idea of how you can use <code>CGImageSource</code> functions to support an image editing application, take a look at <span class="content_text">Listing 2-3</span>. A detailed explanation for each numbered line of code appears following the listing. (Keep in mind that this routine is not a standalone routine—you can’t simply paste it into your own program. It is an excerpt from the <em><a href="../../../../../samplecode/ImageApp/index.html#//apple_ref/doc/uid/DTS10003685" target="_top">ImageApp</a></em> sample code.)</p><a name="//apple_ref/doc/uid/TP40005462-CH218-SW2" title="Listing 2-3A routine that creates an image source and retrieves properties"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>A routine that creates an image source and retrieves properties</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) setURL:(NSURL*)url<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([url isEqual:mUrl])<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [mUrl autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>    mUrl = [url retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGImageSourceRef source = CGImageSourceCreateWithURL((CFURLRef)url, NULL); <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (source)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSDictionary* props =<span></span></pre></td></tr><tr><td scope="row"><pre>           (NSDictionary*) CGImageSourceCopyPropertiesAtIndex(source, 0, NULL); <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        [mTree setContent:[self propTree:props]]; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        [props release];<span></span></pre></td></tr><tr><td scope="row"><pre>        NSDictionary* thumbOpts = [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>            (id)kCFBooleanTrue, (id)kCGImageSourceCreateThumbnailWithTransform,<span></span></pre></td></tr><tr><td scope="row"><pre>            (id)kCFBooleanTrue, (id)kCGImageSourceCreateThumbnailFromImageIfAbsent,<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSNumber numberWithInt:128], (id)kCGImageSourceThumbnailMaxPixelSize,<span></span></pre></td></tr><tr><td scope="row"><pre>            nil]; <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        CGImageRef image = CGImageSourceCreateThumbnailAtIndex(source, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                      (CFDictionaryRef)thumbOpts); <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        [mThumbView setImage:image]; <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        CGImageRelease(image); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        [mFilePath setStringValue:[mUrl path]]; <span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        NSString* uti = (NSString*)CGImageSourceGetType(source); <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>        [mFileType setStringValue:[NSString stringWithFormat:@"%@\n%@",<span></span></pre></td></tr><tr><td scope="row"><pre>                        ImageIOLocalizedString(uti), uti]]; <span>// 10</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFDictionaryRef fileProps = CGImageSourceCopyProperties(source, nil); <span>// 11</span></pre></td></tr><tr><td scope="row"><pre>        [mFileSize setStringValue:[NSString stringWithFormat:@"%@ bytes",<span></span></pre></td></tr><tr><td scope="row"><pre>            (id)CFDictionaryGetValue(fileProps, kCGImagePropertyFileSize)]]; <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else  <span>// 13</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [mTree setContent:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mThumbView setImage:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mFilePath setStringValue:@""];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mFileType setStringValue:@""];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mFileSize setStringValue:@""];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates an image source object from the URL passed to the routine.</p></li><li class="li"><p>Copies the properties for the image located at index location <code>0</code>. Some image file formats can support more than one image, but this example assumes a single image (or that the image of interest is always the first one in the file). The <code><a href="../../../Reference/CGImageSource/Reference/reference.html#//apple_ref/c/func/CGImageSourceCopyPropertiesAtIndex" target="_top">CGImageSourceCopyPropertiesAtIndex</a></code> function returns a <code>CFDictionary</code> object. Here, the code casts the <code>CFDictionary</code> as an <code>NSDictionary</code> object, as these data types are interchangeable (sometimes referred to as toll-free bridged). </p><p>The dictionary that’s returned contains properties that are key-value pairs. However, some of the values are themselves dictionaries that contain properties. Take a look at <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span> and you’ll see not only simple key-value pairs (such as Color Model-RGB) but you’ll also see Exif properties, IPTC Properties, JFIF Properties, and TIFF Properties, each of which is a dictionary. Clicking a disclosure triangle for one of these displays the properties in that dictionary. You’ll need to get these dictionaries and their properties so they can be displayed appropriately in the Info panel. That’s what the next step accomplishes.</p></li><li class="li"><p>Extracts properties from the dictionary and sets them to a tree controller. If you look at the <code>ImageInfoPanel.h</code> file, you’ll see that the <code>mTree</code> variable is an <code>NSTreeController</code> object that is an outlet in Interface Builder. This controller manages a tree of objects. In this case, the objects are properties of the image. </p><p>The <code>propTree:</code> method is provided in the <code>ImageInfoPanel.m</code> file. It’s purpose is to traverse the property dictionary retrieved in the previous step, extract the image properties, and build the array that’s bound to the <code>NSTreeController</code> object.</p><p>The properties appears in table of keys and values in <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span>.</p></li><li class="li"><p>Sets up a dictionary of options to use when creating an image from the image source. Recall that options are passed in a dictionary. The Info panel shown in <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span> displays a thumbnail image. The code here sets up options that creates a thumbnail that is rotated and scaled to the same orientation and aspect ratio of the full image. If a thumbnail does not already exist, one is created, and its maximum pixel size will be 128 by 128 pixels.</p></li><li class="li"><p>Creates a thumbnail image from the first image in the image source, using the options set up in the previous step.</p></li><li class="li"><p>Sets the thumbnail image to the view in the Info panel.</p></li><li class="li"><p>Releases the image; it is no longer needed.</p></li><li class="li"><p>Extracts the path from the URL passed to the method, and sets the string to the text field that’s bound to the Info panel. This is the Path text field in <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span>.</p></li><li class="li"><p>Gets the uniform type identifier of the image source. (This can be different from the type of the images in the source.)</p></li><li class="li"><p>Calls a function to retrieve the localized string for the UTI (<code>ImageIOLocalizedString</code> is declared in <code>ImagePanel.m</code>) and then sets the string to the text field that’s bound to the Info panel. This is the Type text field in  <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span>.</p></li><li class="li"><p>Retrieves a dictionary of the properties associated with the image source. These properties apply to the container (such as the file size), not necessarily the individual images in the image source.</p></li><li class="li"><p>Retrieves the file size value from the image source dictionary obtained in the previous step, then sets the associated string to the text field that’s bound to the Info panel. This is the Size text field shown in <span class="content_text"><a href="ikpg_source.html#//apple_ref/doc/uid/TP40005462-CH218-SW1">Figure 2-1</a></span>.</p></li><li class="li"><p>If the source is not created, makes sure that all the fields in the user interface reflect that fact.</p></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../imageio_basics/ikpg_basics.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ikpg_dest/ikpg_dest.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-02<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/ImageIOGuide/imageio_source/ikpg_source.html%3Fid%3DTP40005462-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/ImageIOGuide/imageio_source/ikpg_source.html%3Fid%3DTP40005462-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/ImageIOGuide/imageio_source/ikpg_source.html%3Fid%3DTP40005462-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>