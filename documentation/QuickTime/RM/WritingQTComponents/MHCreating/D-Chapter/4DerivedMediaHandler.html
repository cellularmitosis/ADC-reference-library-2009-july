<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Component Creation Guide: Derived Media Handler Support</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Derived Media Handler Support"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport" title="Derived Media Handler Support"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../QuickTimeComponentCreation-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000595" target="_top">QuickTime Component Creation</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000898-IntroductiontoQuickTimeComponentCreationGuide-DontLinkElementID_38">QuickTime Component Creation Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../C-Chapter/3CreatingaDerivedMed.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../E-Chapter/5PreviewComponents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-SW1" title="Derived Media Handler Support"></a>
<h1>Derived Media Handler Support</h1>

<p>This chapter describes the functions and constants that your derived media handler may support and the data structure that your component may use to interact with the base media handler.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_11">Data Structure</a>
				
			<br/>
			
        
			
			
				<a href="4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_12">Component Manager Flag</a>
				
			<br/>
			
        
			
			
				<a href="4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_13">Functions</a>
				
			<br/>
			
        
			
			
				<a href="4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_20">Constants</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_11" title="Data Structure"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DataStructure" title="Data Structure"></a>Data Structure</h2>
<p>The <code><!--a target="_top" -->GetMovieCompleteParams<!--/a--></code> data type defines the layout of the complete movie parameter structure used by the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaInitialize" target="_top">MediaInitialize</a></code> function:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    short               version;                /* version; always 1 */<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie               theMovie;               /* movie identifier */<span></span></pre></td></tr><tr><td scope="row"><pre>    Track               theTrack;               /* track identifier */<span></span></pre></td></tr><tr><td scope="row"><pre>    Media               theMedia;               /* media identifier */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeScale           movieScale;             /* movie's time scale */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeScale           mediaScale;             /* media's time scale */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue           movieDuration;          /* movie's duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue           trackDuration;          /* track's duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue           mediaDuration;          /* media's duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed               effectiveRate;          /* media's effective rate */<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeBase            timeBase;               /* media's time base */<span></span></pre></td></tr><tr><td scope="row"><pre>    short               volume;                 /* media's volume */<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed               width;                  /* width of display area */<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed               height;                 /* height of display area */<span></span></pre></td></tr><tr><td scope="row"><pre>    MatrixRecord        trackMovieMatrix;       /* transformation matrix */<span></span></pre></td></tr><tr><td scope="row"><pre>    CGrafPtr            moviePort;              /* movie's graphics port */<span></span></pre></td></tr><tr><td scope="row"><pre>    GDHandle            movieGD;                /* movie's graphics device */<span></span></pre></td></tr><tr><td scope="row"><pre>    PixMapHandle        trackMatte;             /* track's matte */<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer     inputMap;               /* media's input map */<span></span></pre></td></tr><tr><td scope="row"><pre>} GetMovieCompleteParams;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><code>version</code></p></td>
<td ><p>Specifies the version of this structure. This field is always set to 1.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>theMovie</code></p></td>
<td ><p>Identifies the movie that contains the current media's track. This movie identifier is supplied by the Movie Toolbox. Your component may use this identifier to obtain information about the movie that is using your media.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>theTrack</code></p></td>
<td ><p>Identifies the track that contains the current media. This track identifier is supplied by the Movie Toolbox. Your component may use this identifier to obtain information about the track that contains your media. For example, you might call the Movie Toolbox's <code>GetTrackNextInterestingTime</code> function in order to examine the track's edit list.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>theMedia</code></p></td>
<td ><p>Identifies the current media. This media identifier is supplied by the Movie Toolbox. Your derived media handler can use this identifier to read samples or sample descriptions from the current media, using the Movie Toolbox's <code>GetMediaSample</code> and <code>GetMediaSampleDescription</code> functions.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>movieScale</code></p></td>
<td ><p>Specifies the time scale of the movie that contains the current media's track. If the Movie Toolbox changes the movie's time scale, the toolbox calls your derived media handler's <code>MediaSetMovieTimeScale</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>mediaScale</code></p></td>
<td ><p>Specifies the time scale of the current media. If the Movie Toolbox changes your media's time scale, the toolbox calls your derived media handler's <code>MediaSetMediaTimeScale</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>movieDuration</code></p></td>
<td ><p>Contains the movie's duration. This value is expressed in the movie's time scale.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>trackDuration</code></p></td>
<td ><p>Contains the track's duration. This value is expressed in the movie's time scale.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>mediaDuration</code></p></td>
<td ><p>Contains the media's duration. This value is expressed in the media's time scale.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>effectiveRate</code></p></td>
<td ><p>Contains the media's effective rate. This rate ties the media's time scale to the passage of absolute time, and does not necessarily correspond to the movie's rate. This value takes into account any master time bases that may be serving the media's time base. The value of this field indicates the number of time units (in the media's time scale) that pass each second. This rate is represented as a 32-bit, fixed-point number. The high-order 16 bits contain the integer portion, and the low-order 16 bits contain the fractional portion. The rate is negative when time is moving backward for the media. Whenever the Movie Toolbox changes your media's effective rate, it calls your derived media handler's <code>MediaSetRate</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>timeBase</code></p></td>
<td ><p>Identifies the media's time base.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>volume</code></p></td>
<td ><p>Contains the media's current volume setting. This value is represented as a 16-bit, fixed-point number. The high-order 8 bits contain the integer portion; the low-order 8 bits contain the fractional part. Volume values range from -1.0 to 1.0. Negative values play no sound but preserve the absolute value of the volume setting. If the Movie Toolbox changes your media's volume, it calls your derived media handler's <code>MediaGSetVolume</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>width</code></p></td>
<td ><p>Indicates the width, in pixels, of the track rectangle. This field, along with the <code>height</code> field, specifies a rectangle that surrounds the image that is displayed when the current media is played. This value corresponds to the x coordinate of the lower-right corner of the rectangle and is expressed as a fixed-point number. If the Movie Toolbox modifies this rectangle, the toolbox calls your derived media handler's <code>MediaSetDimensions</code> function. Note that your media need not present only a rectangular image. The Movie Toolbox can use a clipping region to cause your media's image to be displayed in a region of arbitrary shape, and it can use a matte to control the image's transparency. The toolbox calls your derived media handler's <code>MediaSetClip</code> function whenever it changes your media's clipping region. The <code>trackMatte</code> field in this structure specifies a matte region.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>height</code></p></td>
<td ><p>Indicates the height, in pixels, of the track rectangle. This value corresponds to the y coordinate of the lower-right corner of the rectangle and is expressed as a fixed-point number.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>trackMovieMatrix</code></p></td>
<td ><p>Specifies the matrix that transforms your media's pixels into the movie's coordinate system. The Movie Toolbox obtains this matrix by concatenating the track matrix and the movie matrix. You should use this matrix whenever you are displaying graphical data from your media. Whenever the Movie Toolbox modifies this matrix, it calls your derived media handler's <code>MediaSetMatrix</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>moviePort</code></p></td>
<td ><p>Indicates the movie's graphics port. Whenever the Movie Toolbox changes the movie's graphics world, it calls your derived media handler's <code>MediaSetGWorld</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>movieGD</code></p></td>
<td ><p>Specifies the movie's graphics device. Whenever the Movie Toolbox changes the movie's graphics world, it calls your derived media handler's <code>MediaSetGWorld</code> function.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>trackMatte</code></p></td>
<td ><p>Identifies the matte region assigned to the track that uses your media. This field contains a handle to a pixel map that contains a blend matte. Your component is not responsible for disposing of this matte. If there is no matte, this field is set to <code>nil</code>.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>inputMap</code></p></td>
<td ><p>A reference to the media's input map. The media input map should not be modified or disposed.</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_12" title="Component Manager Flag"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-ComponentManagerFlag" title="Component Manager Flag"></a>Component Manager Flag</h2>
<p>The Component Manager allows you to specify information about your component’s capabilities in the <code>componentFlags</code> field of the component description record. Within this field, the <code>mediaHandlerFlagBaseClient</code> flag indicates that your component is derived from another component. Setting this flag to 1 tells the Component Manager that your component is a client of the base media handler.</p>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_13" title="Functions"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-Functions" title="Functions"></a>Functions</h2>
<p>This section lists the functions that may be supported by derived media handler components.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_44" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
Many of the functions described in this section are optional; your derived media handler may not need to support them. The description of each function discusses the issues you should consider when deciding whether or not to support a specific function.  </p>
</div>
<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_14" title="Managing the Component"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-ManagingtheComponent" title="Managing the Component"></a>Managing the Component</h3>
<p>Derived media handlers provide three functions that allow the Movie Toolbox to manage its relationship with the media handler. The Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaInitialize" target="_top">MediaInitialize</a></code> to give you an opportunity to prepare to provide access to your media. The Movie Toolbox grants processing time to your handler by calling your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaIdle" target="_top">MediaIdle</a></code> function. Your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGGetStatus" target="_top">MediaGGetStatus</a></code> function allows the Movie Toolbox to retrieve status information after calling <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaIdle" target="_top">MediaIdle</a></code>.</p>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_15" title="General Data Management"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-GeneralDataManagement" title="General Data Management"></a>General Data Management</h3>
<p>While the base media handler isolates your component from the details of media data access, your derived media handler still needs to keep track of certain information in order to support movie playback and creation. This section discusses functions that help your media handler manage its information.</p>
<p>Your media handler may store proprietary information in its media. The Movie Toolbox calls two media handler functions in order to give you an opportunity to retrieve or store this information. The <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaPutMediaInfo" target="_top">MediaPutMediaInfo</a></code> function allows you to store your special information in your media. The <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetMediaInfo" target="_top">MediaGetMediaInfo</a></code> function delivers that data to your media handler.</p>
<p>The Movie Toolbox tells your media handler when its track has been enabled or disabled by calling your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetActive" target="_top">MediaSetActive</a></code> function. The Movie Toolbox prepares your handler for playback by calling your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaPreroll" target="_top">MediaPreroll</a></code> function. Whenever your media’s playback rate changes, the Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetRate" target="_top">MediaSetRate</a></code> function. Whenever the track that uses your media is edited, the Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaTrackEdited" target="_top">MediaTrackEdited</a></code> function.</p>
<p>If the Movie Toolbox has called its <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/SetMediaSampleDescription" target="_top">SetMediaSampleDescription</a></code> function on a sample description, it uses the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSampleDescriptionChanged" target="_top">MediaSampleDescriptionChanged</a></code> function to notify your media handler of the change.</p>
<p>The Movie Toolbox allows tracks to be identified by various characteristics. For instance, it is possible to request that all tracks containing audio information be searched. To determine whether a track has a given characteristic, the Movie Toolbox queries the media handler for each track. The Movie Toolbox calls the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaHasCharacteristic" target="_top">MediaHasCharacteristic</a></code> function with the specified characteristic.</p>
<p>The Movie Toolbox uses two functions to inform you about changes to your media’s time environment. The <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetMediaTimeScale" target="_top">MediaSetMediaTimeScale</a></code> function allows the Movie Toolbox to change your media’s time scale. The <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetMovieTimeScale" target="_top">MediaSetMovieTimeScale</a></code> function allows the Movie Toolbox to tell you when the movie’s time scale has changed.</p>
<p>Other useful functions include</p>
<ul class="spaceabove">
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGSetActiveSegment" target="_top">MediaGSetActiveSegment</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaInvalidateRegion" target="_top">MediaInvalidateRegion</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetNextStepTime" target="_top">MediaGetNextStepTime</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaTrackReferencesChanged" target="_top">MediaTrackReferencesChanged</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaTrackPropertyAtomChanged" target="_top">MediaTrackPropertyAtomChanged</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetTrackInputMapReference" target="_top">MediaSetTrackInputMapReference</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetSampleDataPointer" target="_top">MediaGetSampleDataPointer</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaReleaseSampleDataPointer" target="_top">MediaReleaseSampleDataPointer</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaCompare" target="_top">MediaCompare</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetVideoParam" target="_top">MediaSetVideoParam</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetVideoParam" target="_top">MediaGetVideoParam</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetNonPrimarySourceData" target="_top">MediaSetNonPrimarySourceData</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetOffscreenBufferSize" target="_top">MediaGetOffscreenBufferSize</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetHints" target="_top">MediaSetHints</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetName" target="_top">MediaGetName</a></code></p></li>
</ul>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_16" title="Graphics Data Management"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-GraphicsDataManagement" title="Graphics Data Management"></a>Graphics Data Management</h3>
<p>If your media handler draws media data on the screen, you need to manage your media’s graphics environment. The Movie Toolbox uses a number of functions to inform you about changes to the graphics environment. The Movie Toolbox only calls these functions if you have set the <code>handlerHasSpatial</code>  flag to 1 in the flags  parameter of the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetHandlerCapabilities" target="_top">MediaSetHandlerCapabilities</a></code> function.</p>
<p>The Movie Toolbox calls your handler’s <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetGWorld" target="_top">MediaSetGWorld</a></code> function whenever your media’s graphics port or graphics device has changed. The <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetDimensions" target="_top">MediaSetDimensions</a></code> function allows the Movie Toolbox to inform your handler about changes to its spatial dimensions. Whenever either the movie or track matrix changes, the Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetMatrix" target="_top">MediaSetMatrix</a></code> function. Similarly, if your media’s clipping region changes, the Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetClip" target="_top">MediaSetClip</a></code> function.</p>
<p>When it is building up a movie’s image from its component tracks, the Movie Toolbox must be able to determine which tracks are transparent. The Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetTrackOpaque" target="_top">MediaGetTrackOpaque</a></code> function to retrieve this information about your media.</p>
<p>The Movie Toolbox calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetNextBoundsChange" target="_top">MediaGetNextBoundsChange</a></code> function so that it can learn when your media will next change its display shape. When the Movie Toolbox wants to find out the shape of the region into which you draw your media, it calls your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetSrcRgn" target="_top">MediaGetSrcRgn</a></code> function.</p>
<p>Other useful functions include</p>
<ul class="spaceabove">
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetDrawingRgn" target="_top">MediaGetDrawingRgn</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetGraphicsMode" target="_top">MediaGetGraphicsMode</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetGraphicsMode" target="_top">MediaSetGraphicsMode</a></code></p></li>
</ul>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_17" title="Sound Data Management"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-SoundDataManagement" title="Sound Data Management"></a>Sound Data Management</h3>
<p>The Movie Toolbox uses your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGSetVolume" target="_top">MediaGSetVolume</a></code> function to tell your media handler when its sound volume has changed. It uses <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetSoundLocalizationData" target="_top">MediaSetSoundLocalizationData</a></code> to support 3D sound capabilities in a media handler that plays sound.</p>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_18" title="Base Media Handler Utility Function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-BaseMediaHandlerUtilityFunction" title="Base Media Handler Utility Function"></a>Base Media Handler Utility Function</h3>
<p>Apple’s base media handler component provides a utility function, <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetHandlerCapabilities" target="_top">MediaSetHandlerCapabilities</a></code>, which allows you to tell the base handler what your derived handler can do.</p>

<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_19" title="Management of Progressive Downloads"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-ManagementofProgressiveDownloads" title="Management of Progressive Downloads"></a>Management of Progressive Downloads</h3>
<p>The function <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaMakeMediaTimeTable" target="_top">MediaMakeMediaTimeTable</a></code> is called by the base media handler to create a media time table whenever an application or other software calls the Toolbox’s <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTMovieNeedsTimeTable" target="_top">QTMovieNeedsTimeTable</a></code>, <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/GetMaxLoadedTimeInMovie" target="_top">GetMaxLoadedTimeInMovie</a></code>, <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/MakeTrackTimeTable" target="_top">MakeTrackTimeTable</a></code>, or <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/MakeMediaTimeTable" target="_top">MakeMediaTimeTable</a></code> function. When an application or other software calls one of these functions, it allocates an unlocked relocatable memory block for the time table to be returned and passes a handle to it in the offsets parameter. Your derived media handler must resize the block to accommodate the time table it returns.</p>
<p>The time table your derived media handler returns is a two-dimensional array of long integers that is organized so that each row in the table contains values for one data reference. The first column in the table contains values for the time in the media specified by the <code>startTime</code> parameter, and each subsequent column contains values for the point in the media that is later by the value specified by the <code>timeIncrement</code> parameter. Each long integer value in the table specifies the offset, in bytes, from the beginning of the data reference for that point in the media.</p>


<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_20" title="Constants"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-Constants" title="Constants"></a>Constants</h2>
<p>The constants listed in this section support the functions listed in <span class="content_text"><a href="4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-Functions">Functions</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_21" title="Function Flags"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-FunctionFlags" title="Function Flags"></a>Function Flags</h3>

<div class="codesample"><table><tr><td scope="row"><pre>/* flags in flags parameter of MediaSetHandlerCapabilities function */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerHasSpatial               =   1&lt;&lt;0,   /* draws */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerCanClip                  =   1&lt;&lt;1,   /* clips */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerCanMatte                 =   1&lt;&lt;2,   /* reserved */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerCanTransferMode          =   1&lt;&lt;3,   /* does transfer modes */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerNeedsBuffer              =   1&lt;&lt;4,   /* use offscreen buffer */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerNoIdle                   =   1&lt;&lt;5,   /* never draws */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerNoScheduler              =   1&lt;&lt;6,   /* schedules self */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerWantsTime                =   1&lt;&lt;7,   /* needs more time */<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerCGrafPortOnly            =   1&lt;&lt;8    /* color only */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* values for inFlags parameter of MediaIdle function */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    mMustDraw                       =       1&lt;&lt;3,   /* must draw now */<span></span></pre></td></tr><tr><td scope="row"><pre>    mAtEnd                          =       1&lt;&lt;4,   /* current time<span></span></pre></td></tr><tr><td scope="row"><pre>                                         corresponds to end of movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    mPreflightDraw                  =       1&lt;&lt;5    /* must not draw */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* values for outFlags parameter of MediaIdle function */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    mDidDraw                        =       1&lt;&lt;0,   /* did draw */<span></span></pre></td></tr><tr><td scope="row"><pre>    mNeedsToDraw                    =       1&lt;&lt;2    /* needs to draw */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_22" title="Component Types and Characteristics"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-ComponentTypesandCharacteristics" title="Component Types and Characteristics"></a>Component Types and Characteristics</h3>

<div class="codesample"><table><tr><td scope="row"><pre>/* component type and subtype values */<span></span></pre></td></tr><tr><td scope="row"><pre>#define MediaHandlerType          'mhlr'    /* derived media handler */<span></span></pre></td></tr><tr><td scope="row"><pre>#define BaseMediaType             'gnrc'    /* base media handler */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* constants used in the characteristic parameter of the<span></span></pre></td></tr><tr><td scope="row"><pre>    MediaHasCharacteristic function */<span></span></pre></td></tr><tr><td scope="row"><pre>#define VisualMediaCharacteristic 'eyes'   /* visual media characteristic */<span></span></pre></td></tr><tr><td scope="row"><pre>#define AudioMediaCharacteristic  'ears'   /* audio media characteristic */<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_23" title="Selectors"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-Selectors" title="Selectors"></a>Selectors</h3>

<div class="codesample"><table><tr><td scope="row"><pre>/* selectors for derived media handler components */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaInitializeSelect              = 0x501,  /* MediaInitialize */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* MediaSetHandlerCapabilities */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetHandlerCapabilitiesSelect  = 0x502,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaIdleSelect                    = 0x503,  /* MediaIdle */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetMediaInfoSelect            = 0x504,  /* MediaGetMediaInfo */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaPutMediaInfoSelect            = 0x505,  /* MediaPutMediaInfo */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetActiveSelect               = 0x506,  /* MediaSetActive */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetRateSelect                 = 0x507,  /* MediaSetRate */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGGetStatusSelect              = 0x508,  /* MediaGGetStatus */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaTrackEditedSelect             = 0x509,  /* MediaTrackEdited */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetMediaTimeScaleSelect       = 0x50A,  /* MediaSetMediaTimeScale */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetMovieTimeScaleSelect       = 0x50B,  /* MediaSetMovieTimeScale */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetGWorldSelect               = 0x50C,  /* MediaSetGWorld */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetDimensionsSelect           = 0x50D,  /* MediaSetDimensions */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetClipSelect                 = 0x50E,  /* MediaSetClip */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetMatrixSelect               = 0x50F,  /* MediaSetMatrix */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetTrackOpaqueSelect          = 0x510,  /* MediaGetTrackOpaque */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetGraphicsModeSelect         = 0x511,  /* MediaSetGraphicsMode */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetGraphicsModeSelect         = 0x512,  /* MediaGetGraphicsMode */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGSetVolumeSelect              = 0x513,  /* MediaGSetVolume */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSetSoundBalanceSelect         = 0x514,  /* MediaSetSoundBalance */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetSoundBalanceSelect         = 0x515,  /* MediaGetSoundBalance */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetNextBoundsChangeSelect   = 0x516, /* MediaGetNextBoundsChange */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaGetSrcRgnSelect               = 0x517,  /* MediaGetSrcRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaPrerollSelect                 = 0x518,  /* MediaPreroll */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* MediaSampleDescriptionChanged */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaSampleDescriptionChangedSelect = 0x519,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaHasCharacteristicSelect       = 0x51A  /* MediaHasCharacteristic */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-DontLinkElementID_24" title="Media Video Parameters"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-MediaVideoParameters" title="Media Video Parameters"></a>Media Video Parameters</h3>
<p>The <code>whichparam</code> parameter to the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetVideoParam" target="_top">MediaSetVideoParam</a></code> and <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaGetVideoParam" target="_top">MediaGetVideoParam</a></code> functions specifies which video parameter you want to adjust. QuickTime defines these constants that you can use to configure the <code>whichparam</code> parameter.</p>

<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamBrightness  = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamContrast    = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamHue         = 3,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamSharpness   = 4,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamSaturation  = 5,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamBlackLevel  = 6,<span></span></pre></td></tr><tr><td scope="row"><pre>    kMediaVideoParamWhiteLevel  = 7<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kMediaVideoParamBrightness</code></p></td>
<td ><p>The brightness value controls the overall brightness of the digitized video image. Brightness values range from 0 to 65,535, where 0 is the darkest possible setting and 65,535 is the lightest possible setting.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamContrast</code></p></td>
<td ><p>The contrast value ranges from 0 to 65,535, where 0 represents no change to the basic image and larger values increase the contrast of the video image (that is, increase the slope of the transform).</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamHue</code></p></td>
<td ><p>Hue is similar to the tint control on a television. It is specified in degrees with complementary colors set 180 degrees apart (red is 0 degrees, green is +120 degrees, and blue is -120 degrees). QuickTime supports hue values that range from 0 (-180 degrees shift in hue) to 65,535 (+179 degrees shift in hue), where 32,767 represents a 0 degrees shift in hue.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamSharpness</code></p></td>
<td ><p>The sharpness value ranges from 0 to 65,535, where 0 represents no sharpness filtering and 65,535 represents full sharpness filtering. Higher values result in a visual impression of increased picture sharpness</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamSaturation</code></p></td>
<td ><p>The saturation value controls color intensity. For example, at high saturation levels, red appears to be red; at low saturation, red appears pink. Valid saturation values range from 0 to 65,535, where 0 is the minimum saturation value and 65,535 specifies maximum saturation.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamBlackLevel</code></p></td>
<td ><p>Black level refers to the degree of blackness in an image.The highest setting produces an all-black image; on the other hand, the lowest setting yields little, if any, black even with black objects in the scene. Black level values range from 0 to 65,535, where 0 represents the maximum black value and 65,535 represents the minimum black value.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kMediaVideoParamWhiteLevel</code></p></td>
<td ><p>White level refers to the degree of whiteness in an image. White level values range from 0 to 65,535, where 0 represents the minimum white value and 65,535 represents the maximum white value</p></td>
</tr>

</table></div>





        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../C-Chapter/3CreatingaDerivedMed.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../E-Chapter/5PreviewComponents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-01-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/D-Chapter/4DerivedMediaHandler.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/D-Chapter/4DerivedMediaHandler.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/D-Chapter/4DerivedMediaHandler.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>