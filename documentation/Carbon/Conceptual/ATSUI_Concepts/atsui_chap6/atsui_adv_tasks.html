<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>ATSUI Programming Guide: Advanced Tasks: Substituting Fonts and Modifying Layouts</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Advanced Tasks: Substituting Fonts and Modifying Layouts"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000032" title="Advanced Tasks: Substituting Fonts and Modifying Layouts"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../atsui_chap1/atsui_intro.html#//apple_ref/doc/uid/TP30000027-TP1">ATSUI Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap5/atsui_interact_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap7/atsui_direct_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000032-TP1" title="Advanced Tasks: Substituting Fonts and Modifying Layouts"></a><h1>Advanced Tasks: Substituting Fonts and Modifying Layouts</h1><p>The tasks described in this chapter provide examples of some of the more sophisticated ways you can use ATSUI to control how Unicode text is rendered. Before you read this chapter you should be familiar with the tasks outlined in Chapter 4, <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TP1">“Basic Tasks: Working With Objects and Drawing Text.”</a></span> </p><p>This chapter provides information on advanced tasks in the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF138">“Using Font Fallback Objects”</a></span> shows how to create and use a font fallback object to specify how ATSUI should search for a substitute font when a glyph is unavailable.</p></li><li class="li"><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF141">“Setting a Baseline”</a></span> describes how to draw a line of text whose glyphs use different baselines. In particular, you’ll see how to draw drop capitals.</p></li><li class="li"><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF146">“Kerning Text”</a></span> explains how to adjust the overlap between glyphs, including how to suppress the kerning specified by the font designer. </p></li><li class="li"><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF148">“Adjusting Interglyph Positions ”</a></span> shows how to change the normal tracking setting for a font. </p></li><li class="li"><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF137">“Retrieving Glyph Metrics”</a></span> explains how to obtain resolution-independent and resolution-dependent metrics for a glyph.</p></li></ul><p>If you want to use ATSUI to manipulate glyph data directly, you should read <span class="content_text"><a href="../atsui_chap7/atsui_direct_tasks.html#//apple_ref/doc/uid/TP30000033-TP1">“Direct-Access Tasks: Working With Glyph Data,”</a></span> <span class="content_text"><a href="../atsui_chap7/atsui_direct_tasks.html#//apple_ref/doc/uid/TP30000033-TP1">“Direct-Access Tasks: Working With Glyph Data.”</a></span></p><p>This chapter provides a number of code samples to illustrate how to substitute fonts and modify text layout. You can obtain the sample applications from which this code is taken, as well as additional code samples, from the developer sample code website:</p><p><span class="content_text"><a href="../../../../../samplecode/" target="_top">http://developer.apple.com/samplecode/</a></span></p><a name="//apple_ref/doc/uid/TP30000032-TPXREF138" title="Using Font Fallback Objects"></a><h2>Using Font Fallback Objects</h2><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1023"></a><p>There may be situations in which ATSUI cannot draw a glyph with the assigned font because the font does not have the glyph in its repertoire. In these cases, you can turn on automatic font substitution<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1024"></a> by calling the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetTransientFontMatching" target="_top">ATSUSetTransientFontMatching</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1025"></a>. This function is applied to a text layout object; you need to call it for each text layout object that needs automatic font substitution. You can also use this function to turn off automatic font substitution.</p><p>You can use the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetTransientFontMatching" target="_top">ATSUSetTransientFontMatching</a></code> to set up ATSUI to scan all valid fonts on the user’s system until it finds a suitable substitute font. The substitute font is the first valid font ATSUI finds. If ATSUI doesn’t find any suitable replacements for a font, it uses a glyph from the Last Resort font to represent unavailable characters. </p><p>If you want ATSUI to identify a substitute font, but you do not want ATSUI to automatically perform the font substitution, you can call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUMatchFontsToText" target="_top">ATSUMatchFontsToText</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1026"></a>.</p><p>When you use transient font matching, you can specify one of the following search methods<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1027"></a> for finding a font match:</p><ul class="ul"><li class="li"><p><code>kATSUDefaultFontFallbacks</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1028"></a> specifies to use ATSUI’s default font search method. ATSUI searches through all available fonts on the system for one that matches any text that cannot be drawn with the font specified in the current ATSU style object (<code>ATSUStyle</code>). ATSUI first searches in the standard application fonts for various languages. If that fails, it searches through the remaining fonts on the system in whatever order the Font Manager returns them. After ATSUI has searched all the fonts in the system, any unmatched text is drawn with the last-resort font.</p></li><li class="li"><p><code>kATSULastResortOnlyFontFallbacks</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1029"></a> specifies that ATSUI should use the Last Resort font if the assigned font does not contain the needed glyphs.</p></li><li class="li"><p><code>kATSUSequentialFallbacksPreferred</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1030"></a> specifies that ATSUI should first search sequentially through the list of supplied fonts before it searching through all available fonts on the system.</p></li><li class="li"><p><code>kATSUSequentialFallbacksExclusive</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1031"></a> specifies that ATSUI should search exclusively through the list of supplied fonts. ATSUI use the Last Resort font if it does not find a match in the list of supplied fonts.</p></li></ul><p>If you want to specify a search order, then you must create a font fallback object<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1032"></a> and call the function <code>ATSUSetObjFontFallbacks</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1033"></a> to associate a font fallback method with the font fallback object. This function takes the following parameters:</p><ul class="ul"><li class="li"><p><code>iFontFallbacks</code> ,a font fallback object created by calling the function <code>ATSUCreateFontFallbacks</code>.</p></li><li class="li"><p><code>iFontFallbacksCount</code>, a value that specifies the number of fonts ATSUI is to search. Typically this is the number of font IDs in the <code>iFonts</code> array.</p></li><li class="li"><p><code>iFonts</code>, a pointer to the first <code>ATSUFontID</code> value in an array of the font IDs that you want ATSUI to search.</p></li><li class="li"><p><code>iFontFallbackMethod</code>, a constant that specifies a font fallback method that identifies the order in which ATSUI is to search.</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_26" title="Tip"></a><p><strong>Tip:</strong>&nbsp;You should use the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetObjFontFallbacks" target="_top">ATSUSetObjFontFallbacks</a></code> instead of the function <code><a href="../../../Reference/ATSUI_Reference/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSUSetFontFallbacks" target="_top">ATSUSetFontFallbacks</a></code>. The function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetObjFontFallbacks" target="_top">ATSUSetObjFontFallbacks</a></code> supports the use of font fallbacks on a per text-layout-object basis whereas the function <code><a href="../../../Reference/ATSUI_Reference/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSUSetFontFallbacks" target="_top">ATSUSetFontFallbacks</a></code> operates on a global scope. For best performance, you should not use font fallbacks on a global scope since other elements in the application or system could change the global fallbacks. Such changes could cause inconsistent results or needless reinitialization.</p></div><p>After you’ve associated a font fallback search method with a font fallback object, you can call the function <code>ATSUSetLayoutControls</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1034"></a> to associate the font fallback object<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1035"></a> with a text layout object. </p><p>The code in listing <span class="content_text">Listing 5-1</span> shows how to create a font fallback object, associate a font fallback method with it, and then associate the font fallback object with a text layout object. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30000032-BCIJJCGF" title="Listing 5-1Code that creates and sets up a font fallback object for a text layout object"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Code that creates and sets up a font fallback object for a text layout object</p><div class="codesample"><table><tr><td scope="row"><pre>ATSUFontFallbacks       myFontFallbacks;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>ATSUAttributeTag        theTags[2];<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>ByteCount               theSizes[2];<span></span></pre></td></tr><tr><td scope="row"><pre>ATSUAttributeValuePtr   theValues<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ATSUCreateFontFallbacks (&amp;myFontFallbacks);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>ATSUSetObjFontFallbacks (myFontFallbacks,<span></span></pre></td></tr><tr><td scope="row"><pre>                        myNumFontIDs,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myFontIDArray,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kATSUSequentialFallbacksPreferred);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>theTags[0]      = kATSULineFontFallbacksTag;<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>theSizes[0]     = sizeof (ATSUFontFallbacks);<span></span></pre></td></tr><tr><td scope="row"><pre>theValues[0]    = &amp;myFontFallbacks;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ATSUSetLayoutControls (myLayout, 1, theTags, theSizes, theValues);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>ATSUSetTransientFontMatching (myLayout, true);<span>// 7</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares storage for the font fallback object.</p></li><li class="li"><p>Declares variables for a triple (attribute tag, size, value).</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCreateFontFallbacks" target="_top">ATSUCreateFontFallbacks</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1036"></a> to create an opaque font fallback object.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetObjFontFallbacks" target="_top">ATSUSetObjFontFallbacks</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1037"></a> to assign a font-search method (<code>kATSUSequentialFallbacksPreferred</code>) to the font fallback object. The number of fonts in the font list is <code>myNumFontIDs</code>, and the font list is <code>myFontIDArray</code>. This means ATSUI first searches sequentially through the list of fonts specified in the array <code>myFontIDArray</code>. If a font is not found, then ATSUI searches in other fonts available in the user’s system.</p></li><li class="li"><p>Sets up a triple (tag, size, value) to specify the font fallback object you want to associate with the text layout object.</p></li><li class="li"><p>Calls the function <code>ATSUSetLayoutControls</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1038"></a> to associate the triple with the text layout object whose font-search method you want to specify.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetTransientFontMatching" target="_top">ATSUSetTransientFontMatching</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1039"></a> to turn on transient font matching for this text layout object. Associating the font fallback object with the text layout object doesn’t have an effect unless transient font matching is turned on.<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1040"></a></p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_27" title="Tip"></a><p><strong>Tip:</strong>&nbsp; Don’t create and then dispose of a font fallback object each time you need to use it. Instead, create a font fallback object<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1041"></a> and keep it around as long as possible. You can associate the same font fallback object with different text layout objects.</p></div><a name="//apple_ref/doc/uid/TP30000032-TPXREF141" title="Setting a Baseline"></a><h2>Setting a Baseline</h2><p>ATSUI lets you modify the baseline in two ways: </p><ul class="ul"><li class="li"><p>You can set a baseline other than that specified by the font.</p></li><li class="li"><p>You can specify baseline delta values to use when ATSUI draws text. </p></li></ul><p>You set a baseline<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1042"></a> by specifying a baseline class value<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1043"></a> for the baseline class attribute tag (<code>kATSUBaselineClassTag</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1044"></a>). The most common baseline classes are listed in <span class="content_text">Table 5-1</span>. Baseline classes are specified by a font designer and are not available unless the font designer has chosen to specify them.</p><p>Baseline delta values<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1045"></a> specify how much (in points) to deviate from the current baseline. Positive delta values specify a location above the current baseline and negative values specify a location below the current baseline. You set the baseline delta values by specifying an array of delta values for the baseline values attribute tag (<code>kATSULineBaselineValuesTag</code>).</p><a name="//apple_ref/doc/uid/TP30000032-BBCGBADE" title="Table 5-1Common baseline classes "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 5-1&nbsp;&nbsp;</strong>Common baseline classes </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Baseline class</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Specifies </p></th></tr><tr><td  scope="row"><p><code>kBSLNRomanBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1046"></a></p></td><td ><p>A baseline on which glyphs sit.</p></td></tr><tr><td  scope="row"><p><code>kBSLNIdeographicCenterBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1047"></a></p></td><td ><p>A font-defined baseline on which to center ideographs.</p></td></tr><tr><td  scope="row"><p><code>kBSLNIdesographicLowBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1048"></a></p></td><td ><p>A font-defined baseline on which ideographs are drawn.</p></td></tr><tr><td  scope="row"><p><code>kBSLNHangingBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1049"></a></p></td><td ><p>A font-defined baseline from which glyphs hang.</p></td></tr><tr><td  scope="row"><p><code>kBSLNMathBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1050"></a></p></td><td ><p>A font-defined baseline on which to position mathematical symbols.</p></td></tr><tr><td  scope="row"><p><code>kBSLNLastBaseline</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1051"></a></p></td><td ><p>The last baseline.</p></td></tr><tr><td  scope="row"><p><code>kBSLNNumBaselineClasses</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1052"></a></p></td><td ><p>The number of baseline classes. You can use this value if you need to iterate through baseline classes.</p></td></tr><tr><td  scope="row"><p><code>kBSLNNoBaselineOverride</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1053"></a></p></td><td ><p>The standard baseline setting from the current font.</p></td></tr></table></div><p>To set a baseline, you need to perform these tasks:</p><ol class="ol"><li class="li"><p>Set up a style object for the baseline class you want to use. </p><p>You can reuse this style as needed. <span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF166">Listing 5-2</a></span> shows a function that sets up a style object for a baseline class. The function sets up a triple (tag, size, value) for the baseline class style attribute. A detailed explanation for each numbered line of code appears following the listing.</p></li><li class="li"><p>Apply the style object to the appropriate runs of text in your text layout object.</p></li><li class="li"><p>Calculate baseline delta values for the text associated with your text layout object.</p><p>You call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCalculateBaselineDeltas" target="_top">ATSUCalculateBaselineDeltas</a></code>, passing the style object for which you want to calculate baseline delta values, the baseline class to use, and an array (<code>BslnBaselineRcord</code>) of <code>Fixed</code> values. On output, the array contains baseline offsets that specify distances in points from the default baseline to each of the other baseline types in the style object.</p></li><li class="li"><p>Associate the baseline delta values with your text layout object.</p><p><span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-BBCJCHHJ">Listing 5-3</a></span> shows a function that sets up baseline delta values for a text layout object. The function sets up a triple (tag, size, value) for the baseline value layout attribute. A detailed explanation for each numbered line of code appears following the listing.</p></li><li class="li"><p>Draw the text.</p></li></ol><a name="//apple_ref/doc/uid/TP30000032-TPXREF166" title="Listing 5-2A function that sets the baseline class for a style object"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>A function that sets the baseline class for a style object</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MySetBaselineClass (ATSUStyle myStyle,<span></span></pre></td></tr><tr><td scope="row"><pre>                                BslnBaselineClass myBaselineClass)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeTag        theTag;<span></span></pre></td></tr><tr><td scope="row"><pre>    ByteCount               theSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeValuePtr   theValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theTag = kATSUBaselineClassTag;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    theSize = (ByteCount) sizeof (BslnBaselineClass);<span></span></pre></td></tr><tr><td scope="row"><pre>    theValue = (ATSUAttributeValuePtr) &amp;baselineClass;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUSetAttributes (myStyle, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;theTag, &amp;theSize, &amp;theValue);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Sets up a triple (tag, size, value) for the baseline class attribute.</p></li><li class="li"><p>Associates the baseline class attribute with a style object.</p></li></ol><a name="//apple_ref/doc/uid/TP30000032-BBCJCHHJ" title="Listing 5-3A function that sets baseline values for a text layout object"></a><p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>A function that sets baseline values for a text layout object</p><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1054"></a><div class="codesample"><table><tr><td scope="row"><pre>status MySetBaselineValues (ATSUTextLayout myTextLayout,<span></span></pre></td></tr><tr><td scope="row"><pre>                             BslnBaselineRecord myBaselineRec)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeTag        theTag;<span></span></pre></td></tr><tr><td scope="row"><pre>    ByteCount               theSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeValuePtr   theValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theTag = kATSULineBaselineValuesTag;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    theValueSize = (ByteCount) sizeof (BslnBaselineRecord);<span></span></pre></td></tr><tr><td scope="row"><pre>    theValue = (ATSUAttributeValuePtr) baselineRec;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUSetLayoutControls (myTextLayout, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;theTag, &amp;theSize, &amp;theValue);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Sets up a triple (tag, size, value) for the baseline values attribute.</p></li><li class="li"><p>Associates the baseline values attribute with a text layout object.</p></li></ol><p>You can set baselines to achieve special effects. <span class="content_text">Figure 5-1</span> shows a line of text drawn normally followed by a line of text that uses drop capitals<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1055"></a>. A drop capital is a special effect created by altering both the baseline and the size of uppercase glyphs in a line of text. The first line of text in <span class="content_text">Figure 5-1</span> is drawn using a Roman baseline. The uppercase glyphs in the second line of text are drawn using a hanging baseline and the size of these glyphs is also larger than those in the first line. The lowercase glyphs in the second line are drawn using a Roman baseline.</p><br/><div><a name="//apple_ref/doc/uid/TP30000032-TPXREF165" title="Figure 5-1Text drawn using a Roman baseline and a hanging baseline for capitals "></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>Text drawn using a Roman baseline and a hanging baseline for capitals </p><img src = "../art/dropcaps.gif" alt = "Text drawn using a Roman baseline and a hanging baseline for capitals" width="225" height="113"></div><br/><p>You can perform the following tasks to achieve a drop capitals effect:</p><ol class="ol"><li class="li"><p>Set up a drop-capitals style object that has two attributes: one to specify a hanging baseline as the baseline class and another to specify the point size. </p><p>The drop-capitals effect usually draws uppercase glyphs in a point size larger than that used for lowercase glyphs. You can keep this style object around and use it whenever drop capitals are needed.</p><p>See <span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF166">Listing 5-2</a></span> for information on setting the baseline class for a style object.</p></li><li class="li"><p>Apply the drop-capitals style object to the appropriate runs of text in your text layout object.</p><p>You should apply this style only to the uppercase glyphs. In the example, the drop-capitals style object is applied to “D” and “C”. </p></li><li class="li"><p>Use the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCalculateBaselineDeltas" target="_top">ATSUCalculateBaselineDeltas</a></code> to calculate baseline delta values for the text associated with your text layout object.</p></li><li class="li"><p>Associate the baseline delta values with your text layout object.</p><p>See <span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-BBCJCHHJ">Listing 5-3</a></span> for information on associating baseline values with a text layout object.</p></li><li class="li"><p>Draw the text.</p><p>The lowercase glyphs are drawn using the default Roman baseline and no baseline delta values, while the uppercase glyphs are drawn using the hanging baseline and the appropriate baseline delta values.</p></li></ol><a name="//apple_ref/doc/uid/TP30000032-TPXREF146" title="Kerning Text"></a><h2>Kerning Text</h2><p><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1056"></a>Kerning increases the overlap between glyphs that fit together naturally. As such, it does not apply evenly to all glyphs in a style run. ATSUI uses information supplied by the font to determine how much to increase or decrease the space between glyphs. In the general case, this amount can depend on more than just the two adjacent glyphs. The amount of kerning can also depend on the preceding or following glyphs, or even on glyphs in other parts of the line.</p><p>You can control how much kerning is applied to text, or you can specify that no kerning should occur. Kerning is controlled by the style attribute <code>kATSUKerningInhibitFactorTag</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1057"></a>. As its name implies, when you associate a value with the <code>kATSUKerningInhibitFactorTag</code> you specify to what degree to inhibit the kerning set by the font designer. </p><p>If you set the value associated with this tag to <code>1</code>, kerning is inhibited completely. If you set the value to <code>0</code>, kerning is used to the full amount specified by the font designer. If you specify a value between <code>0</code> and <code>1</code>, kerning is reduced. The specific amount of reduction is based on the values specified by the font designer. If glyphs aren’t usually kerned, then kerning inhibition has no effect. If glyphs are usually kerned, then ATSUI uses the value you provide to calculate a percentage of what’s specified by the font designer.</p><p><span class="content_text">Listing 5-4</span> shows a function that sets a kerning inhibition value for a style object. A detailed explanation for each numbered line of code follows the listing. </p><a name="//apple_ref/doc/uid/TP30000032-TPXREF162" title="Listing 5-4A function that sets kerning inhibition for a style object"></a><p class="codesample"><strong>Listing 5-4&nbsp;&nbsp;</strong>A function that sets kerning inhibition for a style object</p><div class="codesample"><table><tr><td scope="row"><pre>status MySetKerningInhibitFactor (ATSUStyle myStyleObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                                Fract kerningInhibitFactor)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeTag        theTag;<span></span></pre></td></tr><tr><td scope="row"><pre>    ByteCount               theSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeValuePtr   theValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theTag = kATSUKerningInhibitFactorTag;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    theSize = (ByteCount) sizeof(Fract);<span></span></pre></td></tr><tr><td scope="row"><pre>    theValue = (ATSUAttributeValuePtr) &amp;kerningInhibitFactor;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUSetAttributes (myStyleObject, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;theTag, &amp;theSize, &amp;theValue);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>The <code><!--a-->MySetKerningInhibitFactor<!--/a--></code> function takes two parameters, a previously created style object and a kerning inhibition value. Values can be from <code>0</code> to <code>1.0</code>, with <code>0</code> having no effect on kerning and <code>1.0</code> specifying not to use kerning.</p></li><li class="li"><p>Sets up a triple (tag, size, value) for the kerning inhibition attribute.</p></li><li class="li"><p>Associates the kerning inhibition attribute with a style object.</p></li></ol><p>After you have associated a kerning inhibition value with a style object, you must then call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetRunStyle" target="_top">ATSUSetRunStyle</a></code> to associate the style object with the run of text whose kerning you want to inhibit. If you want to affect kerning for an entire text object, you can supply this style object when you create the text layout object.<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1058"></a></p><a name="//apple_ref/doc/uid/TP30000032-TPXREF148" title="Adjusting Interglyph Positions "></a><h2>Adjusting Interglyph Positions </h2><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1059"></a><p>You can expand or contract the spacings of all glyphs in a style run by applying a tracking setting to that style run. The tracking setting controls the relative proportion of font-defined adjustments to apply to interglyph positions. (See <span class="content_text"><a href="../atsui_chap3/atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TP1">“ATSUI Style and Text Layout Objects”</a></span> for more information on the tracking setting style attribute.)</p><p>You can set and retrieve the tracking setting using the <code>kATSUTrackingTag</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1060"></a> style attribute tag. Specifying a tracking setting of <code>0</code> means to space “normally” according to the specifications set by the font designer. That does not necessarily mean that no adjustment to spacing occurs. The font designer may decide that normal spacing includes some spacing adjustment in certain point size ranges. A positive tracking setting increases interglyph position while a negative one decreases the interglyph position.</p><p><span class="content_text">Listing 5-5</span> shows a function that sets a tracking value for a style object<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1061"></a>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000032-TPXREF164" title="Listing 5-5A function that sets a tracking value"></a><p class="codesample"><strong>Listing 5-5&nbsp;&nbsp;</strong>A function that sets a tracking value</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MySetTracking (ATSUStyle theStyle, Fixed myTrackingValue)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus                status = noERR;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeTag        theTag;<span></span></pre></td></tr><tr><td scope="row"><pre>    ByteCount               theSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeValuePtr   theValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theTag = kATSUTrackingTag;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    theSize = (ByteCount) sizeof(Fixed);<span></span></pre></td></tr><tr><td scope="row"><pre>    theValue = (ATSUAttributeValuePtr) &amp;myTrackingValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUSetAttributes (theStyle,<span></span></pre></td></tr><tr><td scope="row"><pre>                            1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;theTag,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;theValueSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;theValue);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>The <code>MySetTracking</code> function takes a style object and the tracking value you want to associate with the style object. The value must be a <code>Fixed</code> value; positive for loose tracking and negative for tight tracking.</p></li><li class="li"><p>Sets up a triple (tag, size, value) for the tracking attribute.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetAttributes" target="_top">ATSUSetAttributes</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1062"></a> to associate the tracking value with the style object.</p></li></ol><p>Whenever you want to apply a tracking setting to a line of text, you can include code similar to that shown in <span class="content_text">Listing 5-6</span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000032-TPXREF163" title="Listing 5-6Code that applies a tracking setting to a line of text"></a><p class="codesample"><strong>Listing 5-6&nbsp;&nbsp;</strong>Code that applies a tracking setting to a line of text</p><div class="codesample"><table><tr><td scope="row"><pre>    myTrackingValue =  Long2Fix (-4);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    status = MySetTracking (myStyle, myTrackingValue);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, TrackSettingFailed);<span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUSetRunStyle (myTextLayout, myStyle,<span></span></pre></td></tr><tr><td scope="row"><pre>                            theOffset, theUniLen);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUDrawText (myTextLayout, theOffset,<span></span></pre></td></tr><tr><td scope="row"><pre>                    theUniLen, penX, penY);<span>// 4</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Assigns a <code>Fixed</code> value as the tracking value. In this case, the negative value indicates a reduction in interglyph positions—tight tracking.</p></li><li class="li"><p>Calls the function <code>MySetTracking</code> (see <span class="content_text"><a href="atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF164">Listing 5-5</a></span>) to associate the tracking value with the style object.</p></li><li class="li"><p>Calls the function <code>ATSUSetRunStyle</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1063"></a> to associate the style object with the run of text whose tracking you want to modify.</p></li><li class="li"><p>Calls the function <code>ATSUDrawText</code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1064"></a> to render the text onscreen. This line of code assumes you have already determined values for the text offset and length of text to be drawn, as well as the pen location. You must make sure you supply the appropriate parameter values when you call <code>ATSUDrawText</code>. <a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1065"></a></p></li></ol><a name="//apple_ref/doc/uid/TP30000032-TPXREF137" title="Retrieving Glyph Metrics"></a><h2>Retrieving Glyph Metrics</h2><p>ATSUI lets you retrieve the ideal<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1066"></a> (resolution-independent) glyph<a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1067"></a> metrics by calling the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUGlyphGetIdealMetrics" target="_top">ATSUGlyphGetIdealMetrics</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1068"></a> and the screen (resolution-dependent) metrics by calling the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUGlyphGetScreenMetrics" target="_top">ATSUGlyphGetScreenMetrics</a></code><a name="//apple_ref/doc/uid/TP30000032-DontLinkElementID_1069"></a>.</p><p>You can use the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUGlyphGetIdealMetrics" target="_top">ATSUGlyphGetIdealMetrics</a></code> to obtain</p><ul class="ul"><li class="li"><p>the advance of the glyph—the amount by which the pen is advanced after drawing the glyph</p></li><li class="li"><p>the origin-side bearing of the glyph—the offset from the glyph origin to the beginning of the glyph image </p></li><li class="li"><p>the end-side bearing of the glyph—the offset from the end of the glyph image to the end of the glyph advance</p></li></ul><p>You can use the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUGlyphGetScreenMetrics" target="_top">ATSUGlyphGetScreenMetrics</a></code> to obtain</p><ul class="ul"><li class="li"><p>the device advance—the number of pixels of the advance for the glyph as actually drawn on the screen</p></li><li class="li"><p>the top-left point of the glyph in device coordinates </p></li><li class="li"><p>the height and width of the glyph in pixels; the glyph specified by these values may overlap with other glyphs when drawn </p></li><li class="li"><p>the origin-side bearing and trailing-side bearing in pixels</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap5/atsui_interact_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap7/atsui_direct_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap6/atsui_adv_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap6/atsui_adv_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap6/atsui_adv_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>