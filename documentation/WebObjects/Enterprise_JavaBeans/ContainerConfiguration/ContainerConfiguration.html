<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Enterprise JavaBeans (Legacy): Configuring Applications</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Configuring Applications"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000102" title="Configuring Applications"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../LegacyTechnologies/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000592" target="_top">WebObjects</a> &gt; <a href="../AboutThisBook/AboutThisBook.html#//apple_ref/doc/uid/TP30000097-TPXREF101">Enterprise JavaBeans (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../FrameworkDevelopment/FrameworkDevelopment.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ConfigurationReference/ConfigurationReference.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000102-BBCIDBBE" title="Configuring Applications"></a><h1>Configuring Applications</h1><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_74"></a>This chapter shows how to configure a bean-client application project so that it can use resources like databases and JavaMail connections, explains how to ensure that each enterprise bean is bound to the appropriate resources, and shows how you can improve the performance of applications through the use of the <code>WOEJBTransport</code> property.</p><p>You need to configure three major items before deploying a bean-client application: </p><ul class="ul"><li class="li"><p><strong>Transaction manager</strong>. This is where you define the data sources that your enterprise beans use to connect to the data stores that hold their data, and the JavaMail connections they use for messaging.</p></li><li class="li"><p><strong>Persistence manager</strong>. Here you map the fields of your CMP (container-managed persistence) beans to columns in tables of your databases so that the container can perform database transactions for the beans.</p></li><li class="li"><p><strong>EJB container</strong>. This is where you set bean-deployment properties such as method transactions and permissions.</p></li></ul><p>You configure bean-client applications by editing the files in <span class="content_text">Table 6-1</span>.</p><a name="//apple_ref/doc/uid/TP30000102-BBCHEIDB" title="Table 6-1The configuration files of a bean-client application"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-1&nbsp;&nbsp;</strong>The configuration files of a bean-client application</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Filename</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Purpose</p></th></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_75"></a><code>TransactionManagerConfiguration.xml</code></p></td><td ><p>Defines data sources and JavaMail<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_76"></a> connections.</p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_77"></a><code>GlobalTransactionConfiguration.xml</code></p></td><td ><p>Defines the JNDI name of a remote data store.</p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_78"></a><code>CMPConfiguration.xml</code></p></td><td ><p>Defines bean-to-table and field-to-column mapping.</p></td></tr><tr><td  scope="row"><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_79"></a><code>OpenEJBConfiguration.xml</code></p></td><td ><p>Defines enterprise-bean deployment behavior for the container.</p></td></tr></table></div><p>The chapter is divided in the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCBEIHD">“Configuration Overview”</a></span> provides you with a checklist of items you need to review in the configuration files that WebObjects creates by default.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BAJFIIHD">“Transaction Manager Configuration ”</a></span> explains how to configure the transaction manager.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCIEHIF">“Persistence Manager Configuration ”</a></span> describes how to map enterprise- bean fields to table columns.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCBBEHE">“Container Configuration”</a></span> covers the configuration of the EJB container.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCEEFBG">“Using External Containers”</a></span> shows how to configure client applications to use an external EJB container.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BAJJCGGF">“Communication Transport Between Bean Clients and Containers”</a></span> explains how communication between client applications and bean containers can be streamlined.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BAJBCIFE">“Generating the EJB Configuration Files”</a></span> discusses the regeneration of the EJB configuration files of a bean-client application project.</p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BAJFADDG">“EJB Container Operation Logging”</a></span> describes how to configure application logging.</p></li></ul><a name="//apple_ref/doc/uid/TP30000102-BBCBEIHD" title="Configuration Overview"></a><h2>Configuration Overview</h2><p>This section gives you a quick look at the configuration process for bean-client applications. It lists the major points you need to look at before deploying your application. It’s divided in the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCDCFAC">“Configuring the Transaction Manager”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCBJIIC">“Configuring the EJB Container ”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCDEAJF">“Configuring the Persistence Manager”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000102-BBCDCFAC" title="Configuring the Transaction Manager"></a><h3>Configuring the Transaction Manager</h3><p>The <code>TransactionManagerConfiguration.xml</code> file is where you enter connection information, such as user name and password, for the data stores that your application’s CMP beans use. You also configure JavaMail. The <code>OpenEJBConfiguration.xml</code> file determines what you need to configure in this file: the data stores, or JavaMail.</p><p>If your enterprise beans use container-managed persistence (the <code>OpenEJBConfiguration.xml</code> file contains the string “<code>&lt;res-type>javax.sql.DataSource&lt;/res-type></code>”), you need to configure at least one data source<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_80"></a>.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF114" title="Listing 6-1Example dataSource element of the TransactionManagerConfiguration.xml file"></a><p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>Example <code>dataSource</code> element of the <code>TransactionManagerConfiguration.xml</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;dataSource><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;name>DefaultDatabase&lt;/name><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;class>tyrex.resource.jdbc.xa.EnabledDataSource&lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;jar>file:/Users/Shared/JDBCDrivers/oracle/oracle8.1.7.1.zip&lt;/jar><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;config><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;driverName>jdbc:oracle:thin:@xsrv3.apple.com:1521:sqa&lt;/driverName><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;driverClassName>oracle.jdbc.OracleDriver&lt;/driverClassName><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;user>ejb&lt;/user><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;password>ejb&lt;/password><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/config><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;limits><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;maximum>100&lt;/maximum><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;minimum>10&lt;/minimum><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;initial>10&lt;/initial><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;maxRetain>300&lt;/maxRetain><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;timeout>50&lt;/timeout><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/limits><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dataSource><span></span></pre></td></tr></table></div>	<p>If your enterprise beans do not use container-managed persistence, you need to delete the <code>resources</code> element from the <code>TransactionManagerConfiguration.xml</code> file, which includes everything between the <code>&lt;resources></code> tag and the <code>&lt;/resources></code> tag as well as the tags themselves.</p><p>If you need to access more than one data store, you can add <code>dataSource</code> elements for each additional data store. See <span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BAJFIIHD">“Transaction Manager Configuration ”</a></span> for more information.</p><p>If your enterprise beans make use of JavaMail<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_81"></a> (the <code>OpenEJBConfiguration.xml</code> file contains the string “<code>&lt;resource-type>javax.mail.Session&lt;/resource-type></code>”), you need to configure JavaMail.</p><p>To configure JavaMail in the <code>TransactionManagerConfiguration.xml</code> file, add this to the data-source section and customize as necessary:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;javamail><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;name>DefaultSMTPServer&lt;/name><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;property><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>mail.smtp.host&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;value>post.office.com&lt;/value><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/property><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/javamail><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000102-BBCBJIIC" title="Configuring the EJB Container "></a><h3>Configuring the EJB Container </h3><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_82"></a><p>Once you have defined the resources that your enterprise beans utilize, you have to review the container environment that WebObjects defined for you in the <code>OpenEJBConfiguration.xml</code> file:</p><ul class="spaceabove"><li class="li"><p>Data sources and JavaMail-connection factories.</p><p>If your enterprise beans use more than one data source or rely on JavaMail (as defined in the <code>TransactionManagerConfiguration.xml</code> file, you have to make sure that each bean is linked to the appropriate data source or JavaMail connection factory (through the <code>res-id</code> element inside <code>resource-ref</code>) in the <code>OpenEJBConfiguration.xml</code> file. See <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCHJCAI">“resource-ref element.”</a></span></p></li><li class="li"><p>Environment entries.</p><p>Scan the file for <code>env-entry</code> elements and make sure that they contain the appropriate values for your situation. See <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCBCCAJ">“env-entry element.”</a></span></p></li><li class="li"><p>Method-transaction settings.</p><p>Make sure that the <code>trans-attribute</code> element of <code>method-transaction</code> elements is set to the appropriate transaction type. If the enterprise bean does not define the transaction type for a method, WebObjects sets it to <code>Required</code>. See <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-TPXREF112">“query element,”</a></span> and <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCBGEEG">“method-transaction element”</a></span> for details.</p></li><li class="li"><p>One <code>entity-container</code> element per database.<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_83"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_84"></a></p><p>When your CMP beans use more than one database, you need to</p><ul class="nested"><li class="nested li"><p>group the CMP beans that use the same data store under the same <code>entity-container</code> element</p></li><li class="nested li"><p>create a global transaction manager configuration file by duplicating the <code>GlobalTransactionConfiguration.xml</code> file and changing "<code>Global_TX_Database</code>" so that it names the additional data source (for example, "<code>Global_TX_Personnel</code>")</p></li></ul><p>In general, you should use the following grouping<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_85"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_86"></a>:</p><ul class="nested"><li class="nested li"><p>one <code>entity-container</code> element per distinct database that encloses its corresponding CMP<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_87"></a> beans (for more information, see <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCDJJEB">“entity-container element”</a></span>)</p></li><li class="nested li"><p>one <code>stateless-session-container</code> element that encloses all stateless beans</p></li><li class="nested li"><p>one <code>stateful-session-container</code> element that encloses all stateful beans</p></li></ul></li></ul><a name="//apple_ref/doc/uid/TP30000102-BBCDEAJF" title="Configuring the Persistence Manager"></a><h3>Configuring the Persistence Manager</h3><p>This section explains how to configure the container for CMP beans. If your application doesn’t use CMP beans, you don’t need to configure the files mentioned here. In fact, the files are only present in your project when at least one of the enterprise-bean frameworks in the project uses container-managed persistence.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF102" title="GlobalTransactionConfiguration.xml"></a><h4>GlobalTransactionConfiguration.xml</h4><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_88"></a><p>This is where you define the JNDI name of a remote data store. It must be identical to the name used in the <code>resource-ref</code> element of a bean in the <code>CMPConfiguration.xml</code> file. You must have one global-transaction configuration file per data store.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF103" title="CMPConfiguration.xml"></a><h4>CMPConfiguration.xml</h4><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_89"></a><p>This is where you map enterprise beans to tables and their fields (or instance variables) to columns in those tables. You also define a bean’s identity or primary key and configure key-value generators. This is an example of a <code>CMPConfiguration.xml</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE mapping PUBLIC "-//EXOLAB/Castor Mapping DTD Version 1.0//EN"<span></span></pre></td></tr><tr><td scope="row"><pre>                         "http://castor.exolab.org/mapping.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;mapping><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;class key-generator="MAX" identity="mPropID" name="webobjectsexamples.realestate.property.PropertyCMPBean"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;map-to table="EJB_PROPERTY"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropID" type="java.lang.Integer"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ID" type="integer"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropAddress" type="java.lang.String"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ADDR" type="varchar"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropDate" type="java.util.Date"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_LIST_DATE" type="date"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropPrice" type="float"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ASK_PRICE" type="real"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/mapping><span></span></pre></td></tr></table></div><p>For more information, see <span class="content_text"><a href="ContainerConfiguration.html#//apple_ref/doc/uid/TP30000102-BBCIEHIF">“Persistence Manager Configuration .”</a></span></p><a name="//apple_ref/doc/uid/TP30000102-BAJFIIHD" title="Transaction Manager Configuration "></a><h2>Transaction Manager Configuration </h2><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_90"></a><p>WebObjects includes the Tyrex transaction manager. You configure it through the <code>TransactionManagerConfiguration.xml</code> file.</p><p>The only item you need to configure for the transaction manager is the domain. A transaction domain provides centralized management of transactions. It defines the policy for all transactions created from that domain, such as default timeout, maximum number of open transactions, support, and journaling. In addition, the domain maintains resource managers such as JDBC data sources and JCA (J2EE Connector Architecture) connectors.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_2" title="Note"></a><p><strong>Note:</strong>&nbsp;If your application uses only session beans and does not need to access a data store, you must remove the <code>resources</code> element from the <code>TransactionManagerConfiguration.xml</code> file.</p></div><p>This is an example of a <a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_91"></a><code>TransactionManagerConfiguration.xml</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;domain><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;name>default&lt;/name><span></span></pre></td></tr><tr><td scope="row"><pre>   &lt;resources><span></span></pre></td></tr><tr><td scope="row"><pre>     &lt;dataSource><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;name>DefaultDatabase&lt;/name><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;class>tyrex.resource.jdbc.xa.EnabledDataSource&lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;jar>/Library/Java/Extensions/OpenBaseJDBC.jar&lt;/jar><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;config><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;driverName>jdbc:openbase://localhost/Person&lt;/driverName><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;driverClassName>com.openbase.jdbc.ObDriver&lt;/driverClassName><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;transactionTimeout>60&lt;/transactionTimeout><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;isolationLevel>Serializable&lt;/isolationLevel><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/config><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;limits><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;maximum>100&lt;/maximum><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;minimum>10&lt;/minimum><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;initial>10&lt;/initial><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;maxRetain>300&lt;/maxRetain><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;timeout>50&lt;/timeout><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/limits><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dataSource><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;/resources><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/domain><span></span></pre></td></tr></table></div><p>For details on how to write the transaction manager configuration file, see <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCIFIGJ">“Elements of the Transaction Manager Configuration File.”</a></span></p><a name="//apple_ref/doc/uid/TP30000102-BBCIEHIF" title="Persistence Manager Configuration "></a><h2>Persistence Manager Configuration </h2><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_92"></a><p>Container-managed persistence is handled by the Castor JDO<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_93"></a> component. It generates SQL statements that the container uses to update information in a database. All you have to do is map a database’s table columns to entity beans’ fields.</p><p>The persistence manager configuration files specify how the persistence manager obtains a connection to a data store, the mapping between Java classes and the corresponding data-store elements, and the service provider to use to talk to the data store.</p><p>These are supported database servers<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_94"></a>:</p><ul class="ul"><li class="li"><p>Generic JDBC engine</p></li><li class="li"><p>Oracle 7 and Oracle 8</p></li><li class="li"><p>Sybase 11 and SQL Anywhere</p></li><li class="li"><p>Microsoft SQL Server</p></li><li class="li"><p>DB/2</p></li><li class="li"><p>PostgreSQL 6.5 and 7</p></li><li class="li"><p>Hypersonic SQL</p></li><li class="li"><p>InstantDB</p></li><li class="li"><p>Interbase</p></li><li class="li"><p>MySQL</p></li><li class="li"><p>SAP DB</p></li></ul><p>You configure the persistence manager by editing three files:</p><ul class="ul"><li class="li"><p><code>CMPConfiguration.xml</code></p><p>This file defines the correspondence between table columns and the fields of your enterprise beans. It also defines how CMP beans are made persistent. This mapping is used in global transaction configuration files.</p></li><li class="li"><p><code>GlobalTransactionConfiguration.xml</code></p><p>This file defines the configuration that the persistence manager uses when a client uses an enterprise bean with a transaction context. This configuration requires that the data source be specified in the JNDI registry. The persistence manager creates the data-store connection, which can be used in bean-managed as well as container-managed persistence beans.</p></li></ul><a name="//apple_ref/doc/uid/TP30000102-TPXREF104" title="Mapping Enterprise Beans to Database Tables"></a><h3>Mapping Enterprise Beans to Database Tables</h3><p>One of the tasks you need to perform to accomplish bean persistence is to map the enterprise bean fields to be persisted to table columns or other types of permanent storage. You accomplish this by editing the <code>CMPConfiguration.xml</code> file.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF105" title="The Mapping File"></a><h4>The Mapping File</h4><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_95"></a><p>The mapping information you enter in the <code>CMPConfiguration.xml</code> file is written from the point of view of the enterprise bean and describes how the contents of the bean’s fields are translated to and from permanent storage.</p><p>This is an example of the contents of the <code>CMPConfiguration.xml</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE mapping PUBLIC "-//EXOLAB/Castor Mapping DTD Version 1.0//EN"<span></span></pre></td></tr><tr><td scope="row"><pre>                         "http://castor.exolab.org/mapping.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;mapping><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;class key-generator="MAX" identity="mPropID" name="webobjectsexamples.realestate.property.PropertyCMPBean"><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;map-to table="EJB_PROPERTY"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropID" type="java.lang.Integer"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ID" type="integer"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropAddress" type="java.lang.String"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ADDR" type="varchar"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropDate" type="java.util.Date"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_LIST_DATE" type="date"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;field direct="true" name="mPropPrice" type="float"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;sql name="PROP_ASK_PRICE" type="real"/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/field><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/class><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/mapping><span></span></pre></td></tr></table></div><p>For details in how to write the <code>CMPConfiguration.xml</code> file, see <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCJBCBC">“Elements of the Component-Managed Persistence Configuration File.”</a></span></p><a name="//apple_ref/doc/uid/TP30000102-TPXREF106" title="Primary Keys"></a><h4>Primary Keys</h4><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_96"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_97"></a><p>The persistence manager can generate the values of identity properties automatically with the key generator. When the enterprise bean’s <code>create</code> method is invoked, the persistence manager sets the value of the identity property to the value obtained from the key generator. The key generator can use one of several algorithms available to generate the value. You can use generic algorithms or algorithms specific to a data store. For details on setting the algorithm to use for an enterprise bean’s identity property, see <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCDAGCC">“class element”</a></span> and <span class="content_text"><a href="../ConfigurationReference/ConfigurationReference.html#//apple_ref/doc/uid/TP30000103-BBCGIHID">“key-generator element.”</a></span></p><p>You can use the key generator only under the following conditions:</p><ul class="spaceabove"><li class="li"><p>The primary-key value is not determined from the arguments to the bean’s <code>ejbCreate</code> method.</p></li><li class="li"><p>The bean’s identity can be determined through a single field of numeric (<code>byte</code> through <code>long</code>) or String type.</p></li></ul><p>The following sections describe the key-generator algorithms you can use.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF107" title="MAX"></a><h5>MAX</h5><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_98"></a><p><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_99"></a>This generic algorithm fetches the maximum value of the primary key (<code>MAX</code>) and locks the record found until the end of the transaction. When the transaction ends, the value generated is <code>MAX + 1</code>. Because of the lock, concurrent transactions that use the same algorithm wait until the end of the original transaction to obtain a new primary-key value. Note that it is still possible to perform multiple inserts during the same transaction.</p><p>With this algorithm, duplicate-key exceptions are almost completely avoided. The only case in which they might occur is when inserting a row into an empty table because there are no rows to lock. In this case, the value generated is <code>1</code>.</p><p>This is an example definition of a key generator using the MAX algorithm:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key-generator name="MAX"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;param name="table" value="PERSON"/><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;param name="key-column" value="PERSON_ID"/><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/key-generator><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000102-TPXREF108" title="HIGH/LOW"></a><h5>HIGH/LOW</h5><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_100"></a><p>This generic algorithm needs an auxiliary table or sequence table containing a unique column (the key column) that stores table names and a numeric (<code>integer</code>, <code>bigint</code>, or <code>numeric</code>) column used to reserve primary-key values.</p><p>The following table describes the parameters used by the HIGH/LOW key generator.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF115" title="Table 6-2HIGH/LOW key generator parameters"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-2&nbsp;&nbsp;</strong>HIGH/LOW key generator parameters</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use</p></th></tr><tr><td  scope="row"><p><code>table</code></p></td><td ><p>Sequence-table name.</p></td><td ><p>Mandatory</p></td></tr><tr><td  scope="row"><p><code>key-column</code></p></td><td ><p>Name of the column containing table names.</p></td><td ><p>Mandatory</p></td></tr><tr><td  scope="row"><p><code>value-column</code></p></td><td ><p>Name of the column used to reserve primary-key values.</p></td><td ><p>Mandatory</p></td></tr><tr><td  scope="row"><p><code>grab-size</code></p></td><td ><p>Number of primary-key values the key generator reserves at a time.</p></td><td ><p>Optional; default="<code>10</code>"</p></td></tr><tr><td  scope="row"><p><code>same-connection</code></p></td><td ><p>Indicates whether the key generator must use the same connection when accessing the sequence table. Values: (<code>true</code> or <code>false</code>). Must be set to <code>true</code> when working in an EJB environment.</p></td><td ><p>Optional; default="<code>false</code>"</p></td></tr><tr><td  scope="row"><p><code>global</code></p></td><td ><p>Indicates whether the key generator produces globally unique keys. Values: (<code>true</code> or <code>false</code>).</p></td><td ><p>Optional; default="<code>false</code>"</p></td></tr></table></div><p>The first time the key generator is called, it finds the row for the target table in the sequence table, locks it, reads the last reserved primary-key value, increases it by the grab size (the number of primary-key values to reserve at a time), and unlocks the row. In subsequent requests for primary-key values for the same target table, the key generator provides primary-key values from the reserved values until it runs out. When it has no more primary-key values, it accesses the sequence table to obtain a new group of primary-key values.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_3" title="Note"></a><p><strong>Note:</strong>&nbsp;The sequence table must be in the same database as the table for which primary-key values are to be generated. When working with multiple databases, you must have one sequence table in each database that contains a table for which the key generator is to provide primary-key values.</p></div><p>If <code>grab-size</code> is set to <code>1</code>, the sequence tables contain the true maximum primary-key value at all times. In this case, the HIGH/LOW key generator is essentially equivalent to the MAX key generator.</p><p>If <code>global</code> is set to <code>true</code>, the sequence table contains only one row instead of one row per table. The key generator uses this row for all tables.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF109" title="UUID"></a><h5>UUID</h5><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_101"></a><p>This algorithm generates global unique primary-key values. The value generated is a combination of the host’s IP address, the current time in milliseconds since 1970, and a static counter. The complete key consists of a 30-character, fixed-length string. This algorithm has no parameters. The primary-key column must be of type <code>char</code>, <code>varchar</code>, or <code>longvarchar</code>.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF110" title="IDENTITY"></a><h5>IDENTITY</h5><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_102"></a><p>The IDENTITY key generator can be used only with auto-increment primary-key columns (identities) in Sybase ASE/ASA, MS SQL Server, MySQL, and Hypersonic SQL.</p><p>After an insert, except when using MySQL or Hypersonic SQL, the key generator obtains the primary-key value from the <code>@@identity</code> system variable, which contains the last identity value for the current database connection. When using MySQL, the system function <code>LAST_INSERT_ID()</code> is used. For Hypersonic SQL, <code>IDENTITY()</code> is used.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF111" title="SEQUENCE"></a><h5>SEQUENCE</h5><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_103"></a><p>This algorithm can be used with only Oracle, Oracle8i, PostgreSQL, Interbase, and SAP DB. It generates keys using sequences.</p><p>The following table describes the parameters for the SEQUENCE key generator.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF116" title="Table 6-3SEQUENCE key generator parameters"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-3&nbsp;&nbsp;</strong>SEQUENCE key generator parameters</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use</p></th></tr><tr><td  scope="row"><p><code>sequence</code></p></td><td ><p>Sequence name.</p></td><td ><p>Optional; default="<code>{0}_seq</code>"</p></td></tr><tr><td  scope="row"><p><code>returning</code></p></td><td ><p>RETURNING mode for Oracle8i. Values: (<code>true</code> or <code>false</code>)</p></td><td ><p>Optional; default="<code>false</code>"</p></td></tr><tr><td  scope="row"><p><code>increment</code></p></td><td ><p>Increment for Interbase.</p></td><td ><p>Optional; default="<code>1</code>"</p></td></tr><tr><td  scope="row"><p><code>trigger</code></p></td><td ><p>Indicates whether there is a trigger that generates primary-key values.</p></td><td ><p>Optional; default="<code>false</code>"</p></td></tr></table></div><p>Usually a sequence is used for only one table. Therefore, in general, you have to define one key generator per table. However, if you adhere to a naming convention for sequences, you can use one key generator for multiple tables.</p><p>For example, if you always obtain sequence names by adding <code>_seq</code> to the name of the corresponding table, you can set <em>sequence</em> to "<code>{0}_seq</code>" (the default).</p><p>The way this key generator performs its function depends on the data store being used.</p><p>With PostgreSQL<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_104"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_105"></a>, this key generator performs <code>SELECT nextval(sequence_name)</code> before the insert and produces the identity value that is then used when it performs <code>INSERT</code>.</p><p>With Interbase<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_106"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_107"></a>, the key generator performs <code>SELECT gen_id(sequence_name, increment) from rdb$database</code> before the insert.</p><p>With Oracle<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_108"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_109"></a>, with <code>returning</code> set to <code>"false"</code> by default, and with SAP DB, the key generator transforms the insert statement generated by the persistence manager to the form <code>INSERT INTO table_name (pk_name, ...) VALUES (sequence_name.nextval, ...)</code>, executes it, and then it performs <code>SELECT sequene_name.currval FROM table_name</code> to obtain the identity value.</p><p>With Oracle8i, when you set <code>returning</code> to "<code>true</code>", <code>RETURNING primary_key_name INTO ?</code> is appended to the insert statement shown above, which is a more efficient procedure to generate primary-key values. Therefore, the persistence manager fetches the identity value when it executes the insert statement (both the insertion and the procurement of the identity value occur in one statement).</p><p>If your table has an <code>on_Insert</code> trigger, like the one listed below, that already generates values for the table’s primary key, you can set <code>trigger</code> to "<code>true</code>".</p><div class="codesample"><table><tr><td scope="row"><pre>create or replace trigger "trigger_name"<span></span></pre></td></tr><tr><td scope="row"><pre>before insert on "table_name" for each row<span></span></pre></td></tr><tr><td scope="row"><pre>begin<span></span></pre></td></tr><tr><td scope="row"><pre>    select "sequence_name".nextval into :new."pk_name" from dual;<span></span></pre></td></tr><tr><td scope="row"><pre>end;<span></span></pre></td></tr></table></div><p>This prevents <code>"sequence_name".nextval</code> from being pulled twice: first during the insert and then in the trigger. It’s also useful in combination with <code>returning="true"</code> for Oracle, in which case you may not specify the sequence name.<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_110"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_111"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_112"></a></p><a name="//apple_ref/doc/uid/TP30000102-BBCDIDHF" title="Defining Data Sources"></a><h3>Defining Data Sources</h3><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_113"></a><p>Global data-source configuration files tell the transaction manager how to locate a data store using JNDI. They contain the mapping between enterprise beans and tables in a database. The transaction manager then uses the information in <code>TransactionManagerConfiguration.xml</code> to create database connections.</p><p>The persistence manager can obtain a connection to a data store in one of three ways:</p><ul class="spaceabove"><li class="li"><p>using a JDBC 2.0 driver and URL</p></li><li class="li"><p>using a JDBC 2.0 data source</p></li><li class="li"><p>using a JNDI data source</p></li></ul><p>If you are deploying the application inside a J2EE environment, you should use the JNDI method because it allows the application server to manage connection pooling and distributed transactions.</p><p>To allow for concurrent transactions and to ensure data integrity, two data-store definitions should never use overlapping mappings.</p><p>The following is the JNDI configuration of a global data store:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;database name="ebiz" engine="oracle"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;jndi name="java:comp/env/jdbc/mydb"/><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;mapping href="Contents/Resources/CMPConfiguration.xml"/><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/database><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000102-BBCBBEHE" title="Container Configuration"></a><h2>Container Configuration</h2><p>The <a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_114"></a><code>OpenEJBConfiguration.xml</code> file contains deployment information, as well as transaction and security details. Its contents are divided in two sections: containers, and facilities. WebObjects writes this file for you. However, you need to make additions, especially regarding the transaction type for methods and mapping physical roles to logical roles.</p><a name="//apple_ref/doc/uid/TP30000102-TPXREF112" title="Containers Section"></a><h3>Containers Section</h3><p>This section of the EJB configuration file holds four types of elements: <code>containers</code>, <code>security-role</code>, <code>method-permission</code>, and <code>method-transaction</code>.</p><p>The <code>containers</code> element can contain three types of elements: <code>stateless-session-container</code>, <code>stateful-session-container</code>, and <code>entity-container</code>. Each of these elements holds definitions for the corresponding types of enterprise beans: stateless session bean, stateful session bean, and entity bean (CMP and BMP).</p><p>One or more logical security roles are defined using <a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_115"></a><code>security-role</code> elements. Physical security roles are mapped to logical security roles in the facilities section of the file. You have to define the logical security roles that you want to use in an application. Then, you assign those roles to the methods of the enterprise beans—using <code>method-permission</code><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_116"></a> elements—as you see fit.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_4" title="Note"></a><p><strong>Note:</strong>&nbsp; WebObjects generates a default role and assigns it to all method permissions. You have to add the roles adequate for your situation and assign them to each of the methods of your enterprise beans through <code>method-permission</code> elements.</p></div><p>The <a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_117"></a><code>method-transaction</code> element tells the container how to manage transactions for each method invocation. You must determine what kind of transaction attribute each enterprise bean’s methods should have, and modify the contents of the <code>method-transaction</code> element as appropriate. <span class="content_text">Table 6-4</span> provides a brief explanation of transaction attributes.</p><a name="//apple_ref/doc/uid/TP30000102-BBCJCJCF" title="Table 6-4Transaction attributes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-4&nbsp;&nbsp;</strong>Transaction attributes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Transaction attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Meaning</p></th></tr><tr><td  scope="row"><p><code>NotSupported</code></p></td><td ><p>The current transaction is suspended until the method ends.</p></td></tr><tr><td  scope="row"><p><code>Supports</code></p></td><td ><p>If in a transaction, the method is included in it.</p></td></tr><tr><td  scope="row"><p><code>Required</code></p></td><td ><p>The method must be invoked within a transaction. Otherwise, a new transaction is created for the method.</p></td></tr><tr><td  scope="row"><p><code>RequiresNew</code></p></td><td ><p>A new transaction is always created for the method.</p></td></tr><tr><td  scope="row"><p><code>Mandatory</code></p></td><td ><p>The method must be invoked within a transaction. Otherwise, a <code>javax.transaction.TransactionRequiredException</code> is thrown.</p></td></tr><tr><td  scope="row"><p><code>Never</code></p></td><td ><p>The method must never be invoked within a transaction. Otherwise, a <code>java.rmi.RemoteException</code> is thrown.</p></td></tr></table></div><p><span class="content_text">Listing 6-2</span> shows an example of the containers section of the EJB configuration file:</p><a name="//apple_ref/doc/uid/TP30000102-BAJHDGCB" title="Listing 6-2Example containers section of the OpenEJBConfiguration.xml file"></a><p class="codesample"><strong>Listing 6-2&nbsp;&nbsp;</strong>Example containers section of the <code>OpenEJBConfiguration.xml</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;container-system><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;containers><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;stateless-session-container><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;container-name>Basic Stateless Container&lt;/container-name><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;stateless-bean><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;description>deployment descriptor for HelloBean&lt;/description><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;display-name>HelloBean&lt;/display-name><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;ejb-deployment-id>HelloBean&lt;/ejb-deployment-id><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;home>com.my.ejb.HelloHome&lt;/home><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;remote>com.my.ejb.Hello&lt;/remote><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;ejb-class>com.my.ejb.HelloBean&lt;/ejb-class><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;transaction-type>Container&lt;/transaction-type><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/stateless-bean><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/stateless-session-container><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/containers><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;security-role><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;role-name>everyone&lt;/role-name><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/security-role><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;method-permission><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;role-name>everyone&lt;/role-name><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;method><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;ejb-deployment-id>HelloBean&lt;/ejb-deployment-id><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;method-name>*&lt;/method-name><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/method><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/method-permission><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;method-transaction><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;method><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;ejb-deployment-id>HelloBean&lt;/ejb-deployment-id><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;method-intf>Remote&lt;/method-intf><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;method-name>message&lt;/method-name><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;method-params/><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/method><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;trans-attribute>NotSupported&lt;/trans-attribute><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/method-transaction><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/container-system><span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000102-TPXREF113" title="Facilities Section"></a><h3>Facilities Section</h3><p>This section of the EJB configuration file specifies the runtime environment: proxy-generation attributes, remote JNDI contexts, database connections, and J2EE services. The elements used are <code>intra-vm-server</code>, <code>remote-jndi-contexts</code>, <code>connectors</code>, and <code>services</code>, respectively. You should not edit this part of the <code>OpenEJBConfiguration.xml</code> file.</p><a name="//apple_ref/doc/uid/TP30000102-BBCEEFBG" title="Using External Containers"></a><h2>Using External Containers</h2><p>You may want to use an external EJB container<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_118"></a> instead of an internal one in your bean-client applications when you already have a powerful, reliable container. In this case, you need to remove all the configuration files listed at the beginning of this chapter from your project.</p><p>To configure your application to use a single, external EJB container, you need to set system properties when you launch your application. You can set them through the command line. The following list shows the properties you need to set for various EJB containers:</p><ul class="ul"><li class="li"><p>OpenEJB<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_119"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_120"></a></p><div class="codesample"><table><tr><td scope="row"><pre>-Djava.naming.factory.initial=org.openorb.rmi.jndi.CtxFactory<span></span></pre></td></tr><tr><td scope="row"><pre>-Djava.naming.provider.url=<span></span></pre></td></tr><tr><td scope="row"><pre>corbaloc::1.2@&lt;HOST>:&lt;NAMESERVICE_PORT>/NameService"<span></span></pre></td></tr><tr><td scope="row"><pre>-Dorg.omg.CORBA.ORBClass=org.openorb.CORBA.ORB<span></span></pre></td></tr><tr><td scope="row"><pre>-Dorg.omg.CORBA.ORBSingletonClass=org.openorb.CORBA.ORBSingleton<span></span></pre></td></tr><tr><td scope="row"><pre>-Djavax.rmi.CORBA.StubClass=org.openorb.rmi.system.StubDelegateImpl<span></span></pre></td></tr><tr><td scope="row"><pre>-Djavax.rmi.CORBA.UtilClass=org.openorb.rmi.system.UtilDelegateImpl<span></span></pre></td></tr><tr><td scope="row"><pre>-Djavax.rmi.CORBA.PortableRemoteObjectClass= org.openorb.rmi.system.PortableRemoteObjectDelegateImpl<span></span></pre></td></tr></table></div></li><li class="li"><p>iPlanet<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_121"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_122"></a></p><div class="codesample"><table><tr><td scope="row"><pre>-Djava.naming.factory.initial=com.sun.jndi.cosnaming.CNCtxFactory<span></span></pre></td></tr><tr><td scope="row"><pre>-Djava.naming.provider.url=iiop://$&lt;HOST>:$&lt;NAMESERVICE_PORT><span></span></pre></td></tr></table></div></li><li class="li"><p>Web Logic<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_123"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_124"></a></p><div class="codesample"><table><tr><td scope="row"><pre>-Djava.naming.factory.initial=weblogic.jndi.WLInitialContextFactory<span></span></pre></td></tr><tr><td scope="row"><pre>-Djava.naming.provider.url=t3://&lt;HOST>:&lt;NAMESERVICE_PORT><span></span></pre></td></tr></table></div></li><li class="li"><p>WebSphere<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_125"></a><a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_126"></a></p><div class="codesample"><table><tr><td scope="row"><pre>-Djava.naming.factory.initial= com.ibm.websphere.naming.WsnInitialContextFactory<span></span></pre></td></tr><tr><td scope="row"><pre>-Djava.naming.provider.url=iiop://&lt;HOST>:&lt;NAMESERVICE_PORT>"<span></span></pre></td></tr></table></div></li></ul><p>If you want to use more than one EJB container in an application, you have to set these properties through application code. For example, to set the JNDI context for the Web Logic EJB container, you would add the following method listed in <span class="content_text">Listing 6-3</span>.<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_127"></a></p><a name="//apple_ref/doc/uid/TP30000102-BAJJJBGD" title="Listing 6-3The initialContext method setting external-container properties"></a><p class="codesample"><strong>Listing 6-3&nbsp;&nbsp;</strong>The <code>initialContext</code> method setting external-container properties</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Obtains the JNDI context.<span></span></pre></td></tr><tr><td scope="row"><pre> * @return the JNDI context.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public static Context initialContext() throws NamingException {<span></span></pre></td></tr><tr><td scope="row"><pre>    Properties properties = new Properties();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    properties.put(Context.INITIAL_CONTEXT_FACTORY, "weblogic.jndi.WLInitialContextFactory");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    properties.put(Context.PROVIDER_URL, "t3://&lt;HOST>:&lt;NAMESERVICE_PORT>");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return new InitialContext(properties);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000102-BAJJCGGF" title="Communication Transport Between Bean Clients and Containers"></a><h2>Communication Transport Between Bean Clients and Containers</h2><p>Bean-client applications can communicate with bean containers using one of two transports: Common Object Request Broker Architecture (CORBA) or intra virtual machine. You determine how clients communicate with bean containers through the <code>WOEJBTransport</code> property. It can have one of two values: <code>OpenORB</code> for the CORBA transport or <code>IntraVM</code> for the intra-VM transport.</p><p>Using CORBA requires that bean frameworks be built with EJB stubs. See <span class="content_text"><a href="../FrameworkDevelopment/FrameworkDevelopment.html#//apple_ref/doc/uid/TP30000101-BBCICJDI">“Generating EJB Stubs”</a></span> for information on generating EJB stubs when building bean frameworks. You must use CORBA when the client application and the bean container do not run on the same virtual machine.</p><p>When you know that the bean client and the container run on the same virtual machine, you should set the <code>WOEJBTransport</code> property to <code>IntraVM</code>. This streamlines communication between bean client and container as well as facilitate debugging your enterprise beans in Project Builder.</p><a name="//apple_ref/doc/uid/TP30000102-BAJBCIFE" title="Generating the EJB Configuration Files"></a><h2>Generating the EJB Configuration Files</h2><p>After you add bean frameworks to an existing bean-client project, you need to regenerate the EJB configuration files. Also, WebObjects 5.2, bean-client projects do not require the <code>LocalTransactionConfiguration.xml</code> file. Therefore, you need to delete the file from the projects and regenerate the remaining configuration files.</p><p>To regenerate the configuration files of a bean-client project, run OpenEJBTool<a name="//apple_ref/doc/uid/TP30000102-DontLinkElementID_128"></a> with the bean-client project path and the path of each of the bean frameworks it uses, as shown below.</p><div class="codesample"><table><tr><td scope="row"><pre>% cd /System/Library/WebObjects/JavaApplications/OpenEJBTool.woa<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>% ./OpenEJBTool -o &lt;bean-client_project_path> &lt;bean-framework0_path> ... &lt;bean-frameworkN_path><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000102-BAJFADDG" title="EJB Container Operation Logging"></a><h2>EJB Container Operation Logging</h2><p>EJB-container operations are logged using Log4J, which is an open-source package that allows you to turn on logging for an application without changing its source code. Logging is configured through the <code>logging.conf</code> file, which is placed in the Resources group of a project. <span class="content_text">Listing 6-4</span> shows the <code>logging.conf</code> file. You modify this file to change the debugging level for the container. For information and documentation on Log4J, see <span class="content_text"><a href="http://jakarta.apache.org/log4j" target="_blank">http://jakarta.apache.org/log4j</a></span>.</p><a name="//apple_ref/doc/uid/TP30000102-BAJDAFCC" title="Listing 6-4Logging.conf file"></a><p class="codesample"><strong>Listing 6-4&nbsp;&nbsp;</strong><code>Logging.conf</code> file</p><div class="codesample"><table><tr><td scope="row"><pre># This file sets up log4j logging for the EJB container<span></span></pre></td></tr><tr><td scope="row"><pre>#<span></span></pre></td></tr><tr><td scope="row"><pre># The default setup will log error messages to stdout<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>log4j.rootCategory=warn, R<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Fileappender<span></span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.F=org.apache.log4j.FileAppender<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Edit this line to suit you application name<span></span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.F.file=/tmp/application.log<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.F.layout=org.apache.log4j.PatternLayout<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.F.layout.ConversionPattern=%5p [%t] (%C:%L) - %m%n<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Console Appender<span></span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.R=org.apache.log4j.ConsoleAppender<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.R.layout=org.apache.log4j.PatternLayout<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.R.layout.ConversionPattern=%5p [%t] (%C:%L) - %m%n<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>log4j.appender.R.Target=System.err<span>// 9</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># General logging for the EJB container<span></span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.OpenEJB=debug<span>// 10</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>### logging for Container-Managed Persistence<span></span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.CastorCMP=debug<span>// 11</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>### CORBA layer logging<span></span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.CORBA-Adapter=warn<span>// 12</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>### logging of transaction handling<span></span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.Transactions=info<span>// 13</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>### Transaction Manager and Connection Pool logging<span></span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.default=debug<span>// 14</span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.ots=debug<span>// 15</span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.security=debug<span>// 16</span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.resource=debug<span>// 17</span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.resource.castor=debug<span>// 18</span></pre></td></tr><tr><td scope="row"><pre>#log4j.category.tyrex.resource.DefaultDatabase=debug<span>// 19</span></pre></td></tr></table></div><p>The line numbered 1 configures the logging level of the root category and the output channel. In this case, <code>warn</code> tells Log4J that it should log warnings only. This setting applies to all the subcategories of <code>rootCategory</code> that do not override it. The second argument indicates which appender to use: <code>R</code> for the console output and <code>F</code> for file output.</p><p>The lines numbered 2 through 5 configure file logging. You must change only lines 3 through 5, however.</p><p>The lines numbered 6 through 9 configure console logging.</p><p>The lines numbered 10 through 19 configure the logging level of several components.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../FrameworkDevelopment/FrameworkDevelopment.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ConfigurationReference/ConfigurationReference.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2004 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2004-10-05<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/Enterprise_JavaBeans/ContainerConfiguration/ContainerConfiguration.html%3Fid%3DTP30001012-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/Enterprise_JavaBeans/ContainerConfiguration/ContainerConfiguration.html%3Fid%3DTP30001012-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/Enterprise_JavaBeans/ContainerConfiguration/ContainerConfiguration.html%3Fid%3DTP30001012-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>