<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Connecting to a Scripting Component(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING332></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-331.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-333.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-331.html"><B>Chapter 10 - Scripting Components</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING332-0></A>
<H1><A NAME=MARKER-9-70></A>Connecting to a Scripting Component</H1>
 <A NAME=MARKER-2-304></A><A NAME=MARKER-2-72></A>To manipulate and execute scripts written in different scripting languages, your application can use Component Manager routines either to open a connection with each corresponding scripting component individually or to open a single connection with the generic scripting component. The generic scripting component, in turn, attempts to open connections dynamically with the appropriate scripting component for each script. By opening a connection with the generic scripting component, your application can load and execute scripts created by any scripting component that is registered with the Component Manager on the current computer.<P>
 In general, you should use the generic scripting component to execute and manipulate existing scripts and a specific scripting component when you create new scripts. When you call <CODE>OSACompile</CODE> or <CODE>OSAStartRecording</CODE>, the generic scripting component examines the script ID to determine which scripting component to use. If instead of a script ID you pass the constant <CODE>kOSANullScript</CODE> to these routines, the generic scripting component uses its current <B>default scripting component.</B> Each instance of the generic scripting component has its own default scripting component. From the user's point of view, the default scripting component corresponds to the scripting language selected in the Script Editor application when the user first creates a new script. <A NAME=MARKER-2-73></A><P>
 The generic scripting component provides routines you can use to get and set the default scripting component, determine which scripting component created a particular script, and perform other useful tasks when you are using multiple scripting components. See the section <A HREF=IAC-403.html#MARKER-9-271>"Generic Scripting Component Routines,"</A> which begins on <A HREF=IAC-403.html#MARKER-9-271>page 10-83</A>, for descriptions of these routines.<P>
 You can use the Component Manager function <CODE>OpenComponent</CODE> to open a connection to a scripting component you specify with the component identifier returned by the <CODE>FindNextComponent</CODE> function. You can also use the <CODE>OpenDefaultComponent</CODE> function to open a scripting component without calling the <CODE>FindNextComponent</CODE> function. <P>
 The <CODE>OpenComponent</CODE> and <CODE>OpenDefaultComponent</CODE> functions return a component instance. This value identifies your application's connection to a component. You must supply this value whenever you call a standard scripting component routine.<A NAME=MARKER-2-74></A> <A NAME=MARKER-2-75></A><P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-9-76></A>Your application may maintain several connections to a single component, or it may have connections to several components at the same time. Because some scripting components (including the current version of AppleScript) can execute only one script at a time per component instance, a multithreaded application must provide a separate component instance for each script that it compiles or executes while it is simultaneously executing other scripts.<EM></EM><A NAME=MARKER-2-77></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The Component Manager type code for scripting components that support the routines described in this chapter is <CODE>'osa '</CODE>, and the subtype code for the generic scripting component is <CODE>'scpt'</CODE>. <A NAME=MARKER-2-78></A> <A NAME=MARKER-2-79></A><P>
<PRE>
CONST
   kOSAComponentType                      = 'osa ';
   kOSAGenericscriptingComponentSubtype   = 'scpt';
</PRE>
 You can open a connection to a scripting component by calling the <CODE>OpenDefaultComponent</CODE> function, which returns a component instance. For example, this code opens a connection with the generic scripting component and stores the returned value in an application-defined variable:<P>
<PRE>
VAR
   gScriptingComponent: ComponentInstance;
{open connection to generic scripting component}
gScriptingComponent := OpenDefaultComponent(kOSAComponentType, 
                         kOSAGenericscriptingComponentSubtype);
</PRE>
 The generic scripting component in turn opens connections with other scripting components as necessary. The generic scripting component provides routines you can use to get instances of other scripting components when you want to use component-specific routines.<P>
 It is also possible to open an explicit connection directly with a specific scripting component such as AppleScript:<P>
<PRE>
VAR
   gScriptingComponent: ComponentInstance;
{open connection to AppleScript component}
gScriptingComponent := OpenDefaultComponent(kOSAComponentType,
                                             kAppleScriptSubtype);
</PRE>
 The scripting component routines described in this chapter include eight groups of optional routines that scripting components can support. If necessary, you can use the <CODE>FindNextComponent</CODE> function and other Component Manager routines to find a scripting component that supports a specific group of routines or to determine whether a particular scripting component supports a specific group of routines. <A NAME=MARKER-2-100></A><P>
 When you call <CODE>FindNextComponent</CODE>, you can provide, in a component description record (a data structure of type <CODE>ComponentDescription</CODE>), information about the scripting component you wish to find. The flag bits in the <CODE>componentFlags</CODE> field of a component description record provide this information. To find a scripting component that supports a specific group of optional routines, you can specify one or more of these constants in the <CODE>componentFlags</CODE> field: <P>
<PRE>
CONST
   kOSASupportsCompiling      = $0002;
   kOSASupportsGetSource      = $0004; 
   kOSASupportsAECoercion     = $0008; 
   kOSASupportsAESending      = $0010; 
   kOSASupportsRecording      = $0020; 
   kOSASupportsConvenience    = $0040; 
   kOSASupportsDialects       = $0080; 
   kOSASupportsEventHandling  = $0100; 
</PRE>
 The routines that correspond to these constants are described in <A HREF=IAC-361.html#MARKER-9-202>"Optional Scripting Component Routines,"</A> which begins on <A HREF=IAC-361.html#MARKER-9-202>page 10-45</A>. <A NAME=MARKER-2-134></A><P>
<DL>
<DT><B>Note</B>
<DD>Although the generic scripting component supports all the scripting component routines represented by these flags, the support it can actually provide depends on the individual components with which it opens connections.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A HREF=#MARKER-9-82>Listing 10-1</A> shows how you can use these flags and the <CODE>FindNextComponent</CODE> function to locate a scripting component with specific characteristics. The <CODE>componentFlags</CODE> field of the component description record passed to <CODE>FindNextComponent</CODE> specifies the flags <CODE>kOSASupportsCompiling</CODE> and <CODE>kOSASupportsGetSource</CODE>. Because the <CODE>componentFlagsMask</CODE> field also specifies these flags, the <CODE>FindNextComponent</CODE> function locates a scripting component that supports these routines, regardless of whether or not it supports any others. The <CODE>FindNextComponent</CODE> function returns a component identifier that you can then use to get more information about the component or to open it. <P>
<B>Listing 10-1  <A NAME=MARKER-9-82></A>Locating a scripting component that supports specific optional routines<A NAME=MARKER-2-197></A></B><P>
<PRE>
FUNCTION MyConnectToScripting (VAR scriptingComponent: ComponentInstance)
                              : OSAError;
VAR
   descr, descr2: componentDescription;
   comp:          component;
   myErr:         OSErr;
BEGIN
   {fill in the fields of the component description record}
   {first specify component type, subtype, and manufacturer}
   descr.componentType := kOSAComponentType; {must be scripting component}
   descr.componentSubType := OSType(0); {any OSA component matching spec}
   descr.componentManufacturer := OSType(0); {don't care about manufacturer}
   
   {specify component flags and flags mask}
   descr.componentFlags := kOSASupportsCompiling + kOSASupportsGetSource;
   descr.componentFlagsMask := 
      kOSASupportsCompiling + kOSASupportsGetSource;

   {locate and open the specified component}
   comp := FindNextComponent(Component(0), descr); {0 indicates all }
                                                   { registered components }
                                                   { will be searched}
   {check whether the found component is the generic scripting component; }
   { if so, skip it and find the next matching component}
   myErr := GetComponentInfo(comp, descr2, NIL, NIL, NIL);
   IF descr2.componentSubType = kOSAGenericScriptingComponentSubtype THEN
      comp := FindNextComponent(comp, descr);
   IF comp = 0 THEN 
      MyConnectToScripting := kComponentNotFound
   ELSE 
   BEGIN
      scriptingComponent := OpenComponent(comp);
      IF scriptingComponent = 0 THEN 
         MyConnectToScripting := kComponentNotFound
      ELSE 
         MyConnectToScripting := noErr;
   END;
END;
</PRE>
 Because the generic scripting component supports all the standard scripting component routines, the <CODE>MyConnectToScripting</CODE> function in <A HREF=#MARKER-9-82>Listing 10-1</A> checks whether the found component is the generic scripting component and, if so, skips it. If for any reason <CODE>FindNextComponent</CODE> can't locate and open a scripting component that supports the specified routines, <CODE>MyConnectToScripting</CODE> returns the application-defined constant <CODE>kComponentNotFound</CODE>.<P>
 For more information about locating and opening components with specific characteristics, see the chapter "Component Manager" in <I>Inside Macintosh: More Macintosh Toolbox.</I> <A NAME=MARKER-2-84></A> <A NAME=MARKER-2-120></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-331.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-333.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
