<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>About Apple Event Handlers(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING101></A>



<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-94.html"><B>Chapter 3 - Introduction to Apple Events</B></A> / <A HREF="IAC-99.html"><B>Responding to Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING101-0></A>
<H2>About Apple Event Handlers</H2>
 <A NAME=MARKER-2-303></A>Your Apple event handlers must generally perform the following tasks:<P>
<UL>
<LI>extract the parameters and attributes from the Apple event
<LI>check that all the required parameters have been extracted
<LI>locate any Apple event objects specified by object specifier records in the Apple event parameters
<LI>if your application needs to interact with the user, use the <CODE>AEInteractWithUser</CODE> function to bring it to the foreground
<LI>perform the action requested by the Apple event
<LI>dispose of any copies of descriptor records that have been created
<LI>add information to the reply Apple event if requested<P>
</UL>
 This section describes how your application's Apple event handlers can use the Apple Event Manager to accomplish some of these tasks. The chapter "Responding to Apple Events" in this book provides detailed information about handling Apple events and interacting with the user.<P>
<A NAME=HEADING101-10></A>
<H3>Extracting and Checking Data</H3>
 You must use Apple Event Manager functions to extract the data from Apple events. You can also use Apple Event Manager functions to extract data from descriptor records, descriptor lists, and AE records. Most of these routines are available in two forms: they either return a copy of the data in a buffer or return a copy of the descriptor record for the data, including a copy of the data. <P>
 The following list shows the main functions you can use to access the data of an Apple event:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Function<TH>Description <TR>
<TD>AEGetParamPtr<TD>Uses a buffer to return a copy of the data contained in an Apple event parameter. Usually used to extract data of fixed length or known maximum length; for example, to extract the result code from the <CODE>keyErrorNumber</CODE> parameter of a reply Apple event.<TR>
<TD>AEGetParamDesc<TD>Returns a copy of the descriptor record or descriptor list for an Apple event parameter. Usually used to extract data of variable length; for example, to extract the descriptor list for a list of alias records specified in the direct parameter of the Open Documents event.<TR>
<TD>AEGetAttributePtr<TD>Uses a buffer to return a copy of the data contained in an Apple event attribute. Used to extract data of fixed length or known maximum length; for example, to determine the source of an Apple event by extracting the data from the <CODE>keyEventSourceAttr</CODE> attribute.<TR>
<TD>&nbsp;<TD>&nbsp;<TR>
<TD>AEGetAttributeDesc<TD>Returns a copy of the descriptor record for an attribute. Used to extract data of variable length; for example, to make a copy of a descriptor record containing the address of an application.<TR>
<TD>AECountItems<TD>Returns the number of descriptor records in a descriptor list. Used, for example, to determine the number of alias records for documents specified in the direct parameter of the <BR>Open Documents event.<TR>
<TD>AEGetNthPtr<TD>Uses a buffer to return a copy of the data for a descriptor record contained in a descriptor list. Used to extract data of fixed length or known maximum length; for example, to extract the name and location of a document from the descriptor list specified in the direct parameter of the <BR>Open Documents event.<TR>
<TD>AEGetNthDesc<TD>Returns a copy of a descriptor record from a descriptor list. Used to extract data of variable length; for example, to get the descriptor record containing an alias record from the list specified in the direct parameter of the Open Documents event.</TABLE>
<P>
 You can specify the descriptor type of the resulting data for these functions; if this type is different from the descriptor type of the attribute or parameter, the Apple Event Manager attempts to coerce it to the specified type. In the direct parameter of the Open Documents event, for example, each descriptor record in the descriptor list is an alias record; each alias record specifies a document to be opened. As explained in the chapter "Introduction to File Management" of <I>Inside Macintosh: Files,</I> all your application usually needs is the file system specification (<CODE>FSSpec</CODE>) record of the document. When you extract the descriptor record from the descriptor list, you can request that the Apple Event Manager return the data to your application as a file system specification record instead of an alias record.<P>
 After extracting all known Apple event parameters, your handler should check that it retrieved all the parameters that the source application considered to be required. To do so, determine whether the <CODE>keyMissedKeywordAttr</CODE> attribute exists. If so, your handler has not retrieved all the required parameters, and it should return an error.<P>
 Although the <I>Apple Event Registry: Standard Suites</I> defines Apple event parameters as either required or optional, the Apple Event Manager does not enforce the definitions of required and optional events. Instead, the source application specifies, when it sends the event, which Apple event parameters the target can treat as if they were optional. For more information about optional parameters, see <A HREF=IAC-198.html#MARKER-9-35>"Specifying Optional Parameters for an Apple Event,"</A> which begins on <A HREF=IAC-198.html#MARKER-9-35>page 5-7</A>.<P>
 If any of the Apple event parameters include object specifier records, your handler should use the <CODE>AEResolve</CODE> function, other Apple Event Manager routines, and your own application-defined functions to locate the corresponding Apple event objects. For more information about locating Apple event objects, see <A HREF=IAC-106.html#MARKER-9-232>"Working With Object Specifier Records,"</A> which begins on <A HREF=IAC-106.html#MARKER-9-232>page 3-27</A>.<P>
<A NAME=HEADING101-17></A>
<H3>Interacting With the User</H3>
 In some cases, the server may need to interact with the user when it handles an Apple event. For example, your handler for the Print Documents event may need to display a print options dialog box and get settings from the user before printing. By specifying flags to the <CODE>AESetInteractionAllowed</CODE> function, you can set preferences to allow user interaction with your application (a) only when your application is sending the Apple event to itself, (b) only when the client application is on the same computer as your application, or (c) for any event sent by any client application on any computer. In addition, your handler should always use the <CODE>AEInteractWithUser</CODE> function before displaying a dialog box or alert box or otherwise interacting with the user. The <CODE>AEInteractWithUser</CODE> function determines whether user interaction can occur and takes appropriate action depending on the circumstances.<P>
 Both the client and server specify their preferences for user interaction: the client specifies whether the server should be allowed to interact with the user, and the server specifies when it allows user interaction while processing an Apple event. The Apple Event Manager does not allow a server application to interact with the user in response to a client application's Apple event unless at least two conditions are met: First, the client application must set flags in the <CODE>sendMode</CODE> parameter of the <CODE>AESend</CODE> function indicating that user interaction is allowed. Second, the server application must either set no user interaction preferences, in which case <CODE>AEInteractWithUser</CODE> assumes that only interaction with a client on the local computer is allowed; or it must set flags to the <CODE>AESetInteractionAllowed</CODE> function indicating that user interaction is allowed. <P>
 If these two conditions are met and if <CODE>AEInteractWithUser</CODE> determines that both the client and server applications allow user interaction under the current circumstances, <CODE>AEInteractWithUser</CODE> brings your application to the foreground if it isn't already in the foreground. Your application can then display its dialog box or alert box or otherwise interact with the user. The <CODE>AEInteractWithUser</CODE> function brings your server application to the front either directly or after the user responds to a notification request.<P>
 For detailed information about how to specify flags to the <CODE>AESetInteractionAllowed</CODE> function and how the Apple Event Manager determines whether user interaction is allowed, see the section <BR><A HREF=IAC-126.html#MARKER-9-408>"Interacting With the User,"</A> which begins on <A HREF=IAC-126.html#MARKER-9-408>page 4-45</A>.<P>
<A NAME=HEADING101-22></A>
<H3>Performing the Requested Action and Returning a Result</H3>
 When your application responds to an Apple event, it should perform the standard action requested by that event. For example, your application should respond to the Open Documents event by opening the specified documents in titled windows just as if the user had selected each document from the Finder and then chosen Open from the File menu. <P>
 Many Apple events can ask your application to return data. For instance, if your application is a spelling checker, the client application might expect your application to return data in the form of a list of misspelled words. <A HREF=IAC-107.html#MARKER-9-245>Figure 3-14 on page 3-32</A> shows a similar example: a Get Data event that asks the server application to locate a specific Apple event object and return the data associated with it. <P>
 If the client application requests a reply, the Apple Event Manager prepares a reply Apple event by passing a default reply Apple event to your handler. If the client application does not request a reply, the Apple Event Manager passes a <B>null descriptor record</B>--that is, a descriptor record of type <CODE>typeNull</CODE> whose data handle has the value <CODE>NIL</CODE>--to your handler instead of a default reply Apple event. The default reply Apple event has no parameters when it is passed to your handler, but your handler can add parameters to it. If your application is a spelling checker, for example, you can return a list of misspelled words in a parameter. However, your handler should check whether the reply Apple event exists before attempting to add any attributes or parameters to it. Any attempt to add an Apple event attribute or parameter to a null descriptor record generates an error. <A NAME=MARKER-21-126></A><P>
 When you extract a descriptor record using the <CODE>AEGetParamDesc</CODE>, <CODE>AEGetAttributeDesc</CODE>, <CODE>AEGetNthDesc</CODE>, or <CODE>AEGetKeyDesc</CODE> function, the Apple Event Manager creates a copy of the descriptor record for you to use. When your handler is finished using a copy of a descriptor record, you should dispose of it--and thereby deallocate the memory used by its data--by calling the <CODE>AEDisposeDesc</CODE> function.<P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-9-219></A>Outputs from functions such as <CODE>AEGetKeyPtr</CODE> and other routines whose names end in <CODE>-Ptr</CODE> use a buffer rather than a descriptor record to return data. Because these functions don't require the use of <CODE>AEDisposeDesc</CODE>, it is preferable to use them for any data that is not identified by a handle.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Your Apple event handler should always set its function result either to <CODE>noErr</CODE> if it successfully handles the Apple event or to a nonzero result code if an error occurs. If your handler returns a nonzero result code, the Apple Event Manager adds a <CODE>keyErrorNumber</CODE> parameter to the reply Apple event (unless you have already added a <CODE>keyErrorNumber</CODE> parameter). This parameter contains the result code that your handler returns. The client should check whether the <CODE>keyErrorNumber</CODE> parameter exists to determine whether your handler performed the requested action. In addition to returning a result code, your handler can also return an error string in the <CODE>keyErrorString</CODE> parameter of the reply Apple event. The client can use this string in an error message to the user.<P>
 If the client application requested a reply, the Apple Event Manager returns the reply Apple event, which is identified by the event class <CODE>kCoreEventClass</CODE> and by the event ID <CODE>kAEAnswer</CODE>. When the client has finished using the reply Apple event, it should dispose of both the reply event and the original event--and thereby deallocate the memory they use--by calling the <CODE>AEDisposeDesc</CODE> function. The Apple Event Manager takes care of disposing both the Apple event and the reply Apple event after a server application's handler returns to <CODE>AEProcessAppleEvent</CODE>, but a server application is responsible for disposing of any Apple event data structures it creates while extracting data from the Apple event.<P>
 <A HREF=#MARKER-9-220>Figure 3-12</A> shows the entire process of responding to an Apple event. <P>
<B>Figure 3-12  <A NAME=MARKER-9-220></A><A NAME=MARKER-21-224></A>Responding to an Open Documents event<A NAME=MARKER-9-73></A> <EM><A NAME=MARKER-2-25></A></EM><A NAME=MARKER-21-224></A> <A NAME=MARKER-2-386></A><A NAME=MARKER-2-41></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/AE-L-16.jpg"><P>
 When your handler returns a result code to the Apple Event Manager, you have finished your response to the client application's Apple event.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
