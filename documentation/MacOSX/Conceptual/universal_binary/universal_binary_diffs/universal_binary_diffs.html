<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Universal Binary Programming Guidelines, Second Edition: Architectural Differences</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Architectural Differences"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002217-CH240" title="Architectural Differences"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index-date.html#//apple_ref/doc/uid/TP30000440-TP30000471" target="_top">Mac OS X</a> &gt; <a href="../universal_binary_intro/universal_binary_intro.html#//apple_ref/doc/uid/TP40002217-CH204-TPXREF101">Universal Binary Programming Guidelines, Second Edition</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_compiling/universal_binary_build.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_byte_swap/universal_binary_swap.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40002217-CH240-TPXREF101" title="Architectural Differences"></a><h1>Architectural Differences</h1>
<p>The PowerPC and the x86 architectures have some fundamental differences that can prevent code written for one architecture from running properly on the other architecture. The extent to which you need to change your PowerPC code so that it runs natively on an Intel-based Macintosh computer depends on how much of your code is processor specific. This chapter describes the major differences between architectures, organized alphabetically by topic. You can use the information to identify the parts of your code that are likely to be problematic.</p>

<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-283985">Alignment</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-283997">Bit Fields</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-281833">Byte Order</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-281333">Calling Conventions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-BAJDEDII">Code on the Stack: Disabling Execution</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-283274">Data Type Conversions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-CJBEEGHA">Data Types</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-281261">Divide-By-Zero Operations</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-BAJGDABG">Extensible Firmware Interface (EFI)</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-281104">Floating-Point Equality Comparisons</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-BCIHEIHA">Structures and Unions</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-278752">See Also</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002217-CH240-283985" title="Alignment"></a><h2>Alignment</h2>
<p>All PowerPC instructions are 4 bytes in size and must be 4-byte aligned. x86 instructions are variable in size (from 1 to >10 bytes), and as a consequence do not need to be aligned.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-283997" title="Bit Fields"></a><h2>Bit Fields</h2>
<p>The value of a signed, 1-bit bit field is either <code>0</code>, <code>1</code>, or<code> –1</code>, depending on the compiler, architecture, optimization level, and so forth. Code that compares the value of a bit field to 1 may not work if the bit field is signed, so you will want to use unsigned 1-bit bit fields. Keep in mind that the order of bit fields in memory can be reversed between architectures.</p>
<p>For more information on issues related to endian format, see <span class="content_text"><a href="../universal_binary_byte_swap/universal_binary_swap.html#//apple_ref/doc/uid/TP40002217-CH243-TPXREF101">“Swapping Bytes.”</a></span> See also <span class="content_text"><a href="../universal_binary_tips/universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-291864">“Archived Bit Fields”</a></span> and <span class="content_text"><a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-282754">“Structures and Unions.”</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-281833" title="Byte Order"></a><h2>Byte Order</h2>
<p>Microprocessor architectures commonly use two different byte-ordering methods (little-endian and big-endian) to store the individual bytes of multibyte data formats in memory. This difference becomes critically important if you try to read data from files that were created on a computer that uses a different byte ordering than yours. You also need to consider byte ordering when you send and receive data through a network connection and handle networking data. The difference in byte ordering can produce incorrect results if you do not account for this difference. For example, the order of bytes in memory of a scalar type is architecture-dependent, as shown in <span class="content_text"><a href="universal_binary_diffs.html#//apple_ref/doc/uid/TP40002217-CH240-282052">Listing 2-1</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-282052" title="Listing 2-1Code that illustrates byte-ordering differences"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-BAJCEECE" title="Listing 2-1Code that illustrates byte-ordering differences"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Code that illustrates byte-ordering differences</p>
<div class="codesample"><table><tr><td scope="row"><pre>unsigned char charVal;<span></span></pre></td></tr><tr><td scope="row"><pre>unsigned long value = 0x12345678;<span></span></pre></td></tr><tr><td scope="row"><pre>unsigned long *ptr = &amp;value;<span></span></pre></td></tr><tr><td scope="row"><pre>charVal = *(unsigned char*)ptr;<span></span></pre></td></tr></table></div>
<p>On a processor that uses little-endian addressing the variable <code>charVal</code> takes on the value 0x78. On a processor that uses big-endian addressing the variable <code>charVal</code> takes on the value 0x12. To make this code architecture-independent, change the last line in <span class="content_text">Listing 2-1</span> to the following:</p>
<p><code>charVal = (unsigned char)*ptr;</code> </p>
<p>For a detailed discussion of byte ordering and strategies that you can use to account for byte-ordering differences, see <span class="content_text"><a href="../universal_binary_byte_swap/universal_binary_swap.html#//apple_ref/doc/uid/TP40002217-CH243-TPXREF101">“Swapping Bytes.”</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-281333" title="Calling Conventions"></a><h2>Calling Conventions</h2>
<p>The x86 C-language calling convention (application binary interface, or ABI) specifies that arguments to functions are passed on the stack. The PowerPC ABI specifies that arguments to functions are passed in registers. Also, x86 has far fewer registers, so many local variables use the stack for their storage. Thus, programming errors, or other operations that access past the end of a local variable array or otherwise incorrectly manipulate values on the stack may be more likely to crash applications on x86 systems than on PowerPC.</p>
<p>For detailed information about the IA-32 ABI, see <em><a href="../../../../DeveloperTools/Conceptual/LowLevelABI/index.html#//apple_ref/doc/uid/TP40002521" target="_top">Mac OS X ABI Function Call Guide</a></em>. This document describes the function-calling conventions used in all the architectures supported by Mac OS X. See also <span class="content_text"><a href="../universal_binary_abi_32/universal_binary_abi_a.html#//apple_ref/doc/uid/TP40002217-CH246-TPXREF101">“32-Bit Application Binary Interface.”</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-284822" title="Code on the Stack: Disabling Execution"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-BAJDEDII" title="Code on the Stack: Disabling Execution"></a><h2>Code on the Stack: Disabling Execution</h2>
<p>Intel processors include a bit that prevents code from being executed on the stack. On Intel-based Macintosh computers, this bit is always set to <code>On</code>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-283274" title="Data Type Conversions"></a><h2>Data Type Conversions</h2>
<p>For some data type conversions, such as casting a string to a long and converting a floating-point type to an integer type, the PowerPC and x86 architectures perform differently. When the microprocessor converts a floating-point type to an integer type, it discards the fractional part of the value. The behavior is undefined if the value of the integral part cannot be represented by the integer type.</p>
<p><span class="content_text">Listing 2-2</span> shows an example of the sort of code that is architecture-dependent. You would need to modify this code to make it architecture-independent. On a PowerPC microprocessor, the variable <code>x</code> shown in the listing is equal to <code>7fffffff</code> or <code>INTMAX</code>. On an x86 microprocessor, the variable <code>x</code> is equal to <code>80000000</code> or <code>INTMIN</code>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-283320" title="Listing 2-2Architecture-dependent code"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-TPXREF161" title="Listing 2-2Architecture-dependent code"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Architecture-dependent code</p>
<div class="codesample"><table><tr><td scope="row"><pre>int main (int argc, const char * argv[])<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    double  a;<span></span></pre></td></tr><tr><td scope="row"><pre>    int     x;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    a = 5000000.0 * 6709000.5;  // or any really big value<span></span></pre></td></tr><tr><td scope="row"><pre>    x = a;<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("x = %08x \n",x);<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH240-282240" title="Data Types"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-CJBEEGHA" title="Data Types"></a><h2>Data Types</h2>
<p>A <code>long double</code> is 16 bytes on both architectures, but only 80 bits are significant in <code>long double</code> data types on Intel-based Macintosh computers.</p>
<p>A <code>bool</code> data type is a single byte on an x86 system, but four bytes on a PowerPC architecture. This size difference can cause alignment problems. You should use fixed-size data types to avoid alignment problems. (The <code>bool</code> data type is not the Carbon <code>Boolean</code> type, which is a fixed size of 1 byte.)</p>
<p>Existing document formats that include the <code>bool</code> data type as part of a data structure that is written directly to disk can be problematic because the data structure might not be laid out the same on both architectures. If you update the data structure definition to use the <code>UInt32</code> data type or another fixed-size four-byte data type, the structure should then be portable, although you must swap bytes appropriately.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-281261" title="Divide-By-Zero Operations"></a><h2>Divide-By-Zero Operations</h2>
<p>An integer divide-by-zero operation is fatal on an x86 system but the operation continues on a PowerPC system, where it returns zero. (A floating point divide-by-zero behaves the same on both architectures.) If you get a crash log that mentions <code>EXC_I386_DIV (divide by zero)</code>, your program divided by zero. Mod operations perform a divide, so a mod-by-zero operation produces a divide-by-zero exception. To fix a divide-by-zero exception, find the place in your program corresponding to that operation. Then add code that checks for a denominator of zero before performing the divide operation.</p>
<p>For example, change this:</p>
<div class="codesample"><table><tr><td scope="row"><pre> int a = b % c;    // Divide by zero can happen here;<span></span></pre></td></tr></table></div>
<p>to this:</p>
<div class="codesample"><table><tr><td scope="row"><pre>int a;<span></span></pre></td></tr><tr><td scope="row"><pre>if (c != 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>     a = b % c;<span></span></pre></td></tr><tr><td scope="row"><pre> } else {<span></span></pre></td></tr><tr><td scope="row"><pre>     a = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH240-284855" title="Extensible Firmware Interface (EFI)"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-BAJGDABG" title="Extensible Firmware Interface (EFI)"></a><h2>Extensible Firmware Interface (EFI)</h2>
<p>Intel-based Macintosh computers use extensible firmware interface (EFI). EFI provides a flexible and adaptable interface between Mac OS X and the platform firmware. This change should be transparent to most developers, but may affect some, such as those who write boot drivers.</p>
<p>For more information on the EFI specification, see <span class="content_text"><a href="http://www.intel.com/technology/efi/" target="_blank">http://www.intel.com/technology/efi/</a></span></p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-281104" title="Floating-Point Equality Comparisons"></a><h2>Floating-Point Equality Comparisons</h2>
<p>The results of a floating-point equality comparison are architecture-dependent. Whether the comparison works depends on a number of things, including the compiler, the surrounding code, all compiler flags in use (particularly optimization flags), and the current floating-point mode for the thread. If your floating-point comparison is currently working on PowerPC, you may need to inspect it on an Intel-based Macintosh computer.</p>
<p>You can use the GCC flag <code>-Wfloat-equal</code> to receive a warning for floating-point equality comparisons. For details on this option, see Section 3.8 of the <em><a href="../../../../DeveloperTools/gcc-4.0.1/gcc/index.html#//apple_ref/doc/uid/TP40001838" target="_top">GNU C/C++/Objective-C 4.0.1 Compiler User Guide</a></em></p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-282754" title="Structures and Unions"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-BCIHEIHA" title="Structures and Unions"></a><h2>Structures and Unions</h2>
<p>The fields in a structure can be sensitive to their defined order. Structures must either be properly ordered or accessed by the field name directly.</p>
<p>When a union has components that could be affected by byte order, use a form similar to that shown in <span class="content_text">Listing 2-3</span>. Code that sets <code>wch</code> and then reads <code>hi</code> and <code>lo</code> as the high and low bytes of <code>wch</code> will work correctly. The same is true for the reverse direction. Code that sets <code>hi</code> and <code>lo</code> and then reads <code>wch</code> will get the same value on both architectures. For another example, see the <code>WideChar</code> union that’s defined in the <code>IntlResources.h</code> header file.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH240-283779" title="Listing 2-3A union whose components can be affected by byte order"></a><a name="//apple_ref/doc/uid/TP40002217-CH240-BAJDJGIA" title="Listing 2-3A union whose components can be affected by byte order"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>A union whose components can be affected by byte order</p>
<div class="codesample"><table><tr><td scope="row"><pre>union WChar{<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned short wch;<span></span></pre></td></tr><tr><td scope="row"><pre>    struct {<span></span></pre></td></tr><tr><td scope="row"><pre>#if __BIG_ENDIAN__<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char hi;<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char lo;<span></span></pre></td></tr><tr><td scope="row"><pre>#else<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char lo;<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char hi;<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr><tr><td scope="row"><pre>    } s;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH240-278752" title="See Also"></a><h2>See Also</h2>
<p>The ISO standard for the C programming language—ISO/IEC 9899—is a valuable reference that you can use to investigate code portability issues, many of which may not be immediately obvious. You can find this reference in a number of locations on the web, including:</p>
<p><span class="content_text"><a href="http://www.iso.org/" target="_blank">http://www.iso.org/</a></span></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_compiling/universal_binary_build.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_byte_swap/universal_binary_swap.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_diffs/universal_binary_diffs.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_diffs/universal_binary_diffs.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_diffs/universal_binary_diffs.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>