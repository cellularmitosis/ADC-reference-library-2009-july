<html><head><title>Mac OS X Server
 Manual Page For Apache(3pm)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3pm/Apache" title="Mac OS X Server
 Manual Page for Apache(3pm)"><a name="//apple_ref/doc/man/3/Apache" title="Mac OS X Server
 Manual Page for Apache(3pm)"><!-- headerDoc=man; indexgroup=Section 3pm; uid="//apple_ref/doc/man/3pm/Apache"; name=Apache(3pm) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with Mac&nbsp;OS&nbsp;X&nbsp;Server.  It is
not available on standard Mac OS X (client) installations.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
Apache(3)                            User Contributed Perl Documentation                           Apache(3)



<b>NAME</b>
       Apache - Perl interface to the Apache server API

<b>SYNOPSIS</b>
          use Apache ();

<b>DESCRIPTION</b>
       This module provides a Perl interface the Apache API.  It is here mainly for <b>mod_perl</b>, but may be
       used for other Apache modules that wish to embed a Perl interpreter.  We suggest that you also
       consult the description of the Apache C API at <a href="http://www.apache.org/docs/">http://www.apache.org/docs/</a>

<b>THE</b> <b>REQUEST</b> <b>OBJECT</b>
       The request object holds all the information that the server needs to service a request.  Apache
       <b>Perl*Handler</b>s will be given a reference to the request object as parameter and may choose to update
       or use it in various ways.  Most of the methods described below obtain information from or update the
       request object.  The perl version of the request object will be blessed into the <b>Apache</b> package, it
       is really a "request_rec*" in disguise.

       Apache-&gt;request([$r])
           The Apache-&gt;request method will return a reference to the request object.

           <b>Perl*Handler</b>s can obtain a reference to the request object when it is passed to them via @_.
           However, scripts that run under <b>Apache::Registry</b>, for example, need a way to access the request
           object.  <b>Apache::Registry</b> will make a request object available to these scripts by passing an
           object reference to "Apache-&gt;request($r)".  If handlers use modules such as <b>CGI::Apache</b> that need
           to access "Apache-&gt;request", they too should do this (e.g. <b>Apache::Status</b>).

       $r-&gt;as_string
           Returns a string representation of the request object.  Mainly useful for debugging.

       $r-&gt;main
           If the current request is a sub-request, this method returns a blessed reference to the main
           request structure.  If the current request is the main request, then this method returns "undef".

       $r-&gt;prev
           This method returns a blessed reference to the previous (internal) request structure or "undef"
           if there is no previous request.

       $r-&gt;next
           This method returns a blessed reference to the next (internal) request structure or "undef" if
           there is no next request.

       $r-&gt;last
           This method returns a blessed reference to the last (internal) request structure.  Handy for
           logging modules.

       $r-&gt;is_main
           Returns true if the current request object is for the main request.  (Should give the same result
           as "!$r-&gt;main", but will be more efficient.)

       $r-&gt;is_initial_req
           Returns true if the current request is the first internal request, returns false if the request
           is a sub-request or internal redirect.

       $r-&gt;allowed($bitmask)
           Get or set the allowed methods bitmask. This allowed bitmask should be set whenever a 405 (method
           not allowed) or 501 (method not implemented) answer is returned. The bit corresponding to the
           method number should be set.

              unless ($r-&gt;method_number == M_GET) {
                $r-&gt;allowed($r-&gt;allowed | (1&lt;&lt;M_GET) | (1&lt;&lt;M_HEAD) | (1&lt;&lt;M_OPTIONS));
                return HTTP_METHOD_NOT_ALLOWED;
              }

<b>SUB</b> <b>REQUESTS</b>
       Apache provides a sub-request mechanism to lookup a uri or filename, performing all access checks,
       etc., without actually running the response phase of the given request.  Notice, we have dropped the
       "sub_req_" prefix here.  The "request_rec*" returned by the lookup methods is blessed into the
       <b>Apache::SubRequest</b> class.  This way, "destroy_sub_request()" is called automatically during
       "Apache::SubRequest-&gt;DESTROY" when the object goes out of scope.  The <b>Apache::SubRequest</b> class
       inherits all the methods from the <b>Apache</b> class.

       $r-&gt;lookup_uri($uri)
              my $subr = $r-&gt;lookup_uri($uri);
              my $filename = $subr-&gt;filename;

              unless(-e $filename) {
                  warn "can't stat $filename!\n";
              }

       $r-&gt;lookup_file($filename)
              my $subr = $r-&gt;lookup_file($filename);

       $subr-&gt;run
              if($subr-&gt;run != OK) {
                  $subr-&gt;log_error("something went wrong!");
              }

<b>CLIENT</b> <b>REQUEST</b> <b>PARAMETERS</b>
       In this section we will take a look at various methods that can be used to retrieve the request
       parameters sent from the client.  In the following examples, <b>$r</b> is a request object blessed into the
       <b>Apache</b> class, obtained by the first parameter passed to a handler subroutine or <u>Apache-&gt;request</u>

       $r-&gt;method( [$meth] )
           The $r-&gt;method method will return the request method.  It will be a string such as "GET", "HEAD"
           or "POST".  Passing an argument will set the method, mainly used for internal redirects.

       $r-&gt;method_number( [$num] )
           The $r-&gt;method_number method will return the request method number.  The method numbers are
           defined by the M_GET, M_POST,... constants available from the <b>Apache::Constants</b> module.  Passing
           an argument will set the method_number, mainly used for internal redirects and testing
           authorization restriction masks.

       $r-&gt;bytes_sent
           The number of bytes sent to the client, handy for logging, etc.

       $r-&gt;the_request
           The request line sent by the client, handy for logging, etc.

       $r-&gt;proxyreq
           Returns true if the request is proxy http.  Mainly used during the filename translation stage of
           the request, which may be handled by a "PerlTransHandler".

       $r-&gt;header_only
           Returns true if the client is asking for headers only, e.g. if the request method was <b>HEAD</b>.

       $r-&gt;protocol
           The $r-&gt;protocol method will return a string identifying the protocol that the client speaks.
           Typical values will be "HTTP/1.0" or "HTTP/1.1".

       $r-&gt;hostname
           Returns the server host name, as set by full URI or Host: header.

       $r-&gt;request_time
           Returns the time that the request was made.  The time is the local unix time in seconds since the
           epoch.

       $r-&gt;uri( [$uri] )
           The $r-&gt;uri method will return the requested URI minus optional query string, optionally changing
           it with the first argument.

       $r-&gt;filename( [$filename] )
           The $r-&gt;filename method will return the result of the <u>URI</u> <u>--&gt;</u> <u>filename</u> translation, optionally
           changing it with the first argument if you happen to be doing the translation.

       $r-&gt;location
           The $r-&gt;location method will return the path of the &lt;Location&gt; section from which the current
           "Perl*Handler" is being called.

       $r-&gt;path_info( [$path_info] )
           The $r-&gt;path_info method will return what is left in the path after the <u>URI</u> <u>--&gt;</u> <u>filename</u>
           translation, optionally changing it with the first argument if you happen to be doing the
           translation.

       $r-&gt;args( [$query_string] )
           The $r-&gt;args method will return the contents of the URI <u>query</u> <u>string</u>.  When called in a scalar
           context, the entire string is returned.  When called in a list context, a list of parsed <u>key</u> =&gt;
           <u>value</u> pairs are returned, i.e. it can be used like this:

              $query = $r-&gt;args;
              %in    = $r-&gt;args;

           $r-&gt;args can also be used to set the <u>query</u> <u>string</u>. This can be useful when redirecting a POST
           request.

       $r-&gt;headers_in
           The $r-&gt;headers_in method will return a %hash of client request headers.  This can be used to
           initialize a perl hash, or one could use the $r-&gt;<u>header</u><b>_</b><u>in()</u> method (described below) to retrieve
           a specific header value directly.

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. This requires <u>Apache::Table</u>.

       $r-&gt;header_in( $header_name, [$value] )
           Return the value of a client header.  Can be used like this:

              $ct = $r-&gt;header_in("Content-type");
              $r-&gt;header_in($key, $val); #set the value of header '$key'

       $r-&gt;content
           The $r-&gt;content method will return the entity body read from the client, but only if the request
           content type is "application/x-www-form-urlencoded".  When called in a scalar context, the entire
           string is returned.  When called in a list context, a list of parsed <u>key</u> =&gt; <u>value</u> pairs are
           returned.  *NOTE*: you can only ask for this once, as the entire body is read from the client.

       $r-&gt;read($buf, $bytes_to_read, [$offset])
           This method is used to read data from the client, looping until it gets all of $bytes_to_read or
           a timeout happens.

           An offset may be specified to place the read data at some other place than the beginning of the
           string.

           In addition, this method sets a timeout before reading with "$r-&gt;soft_timeout".

       $r-&gt;get_remote_host
           Lookup the client's DNS hostname. If the configuration directive <b>HostNameLookups</b> is set to off,
           this returns the dotted decimal representation of the client's IP address instead. Might return
           <u>undef</u> if the hostname is not known.

       $r-&gt;get_remote_logname
           Lookup the remote user's system name.  Might return <u>undef</u> if the remote system is not running an
           RFC 1413 server or if the configuration directive <b>IdentityCheck</b> is not turned on.

       $r-&gt;user( [$user] )
           If an authentication check was successful, the authentication handler caches the user name here.
           Sets the user name to the optional first argument.

       More information about the client can be obtained from the <b>Apache::Connection</b> object, as described
       below.

       $c = $r-&gt;connection
           The $r-&gt;connection method will return a reference to the request connection object (blessed into
           the <b>Apache::Connection</b> package).  This is really a "conn_rec*" in disguise.  The following
           methods can be used on the connection object:

           $c-&gt;remote_host
               If the configuration directive <b>HostNameLookups</b> is set to on:  then the first time
               "$r-&gt;get_remote_host" is called the server does a DNS lookup to get the remote client's host
               name.  The result is cached in "$c-&gt;remote_host" then returned. If the server was unable to
               resolve the remote client's host name this will be set to "". Subsequent calls to
               "$r-&gt;get_remote_host" return this cached value.

               If the configuration directive <b>HostNameLookups</b> is set to off: calls to "$r-&gt;get_remote_host"
               return a string that contains the dotted decimal representation of the remote client's IP
               address. However this string is not cached, and "$c-&gt;remote_host" is undefined. So, it's best
               to to call "$r-&gt;get_remote_host" instead of directly accessing this variable.

           $c-&gt;remote_ip
               The dotted decimal representation of the remote client's IP address.  This is set by the
               server when the connection record is created so is always defined.

               You can also set this value by providing an argument to it. This is helpful if your server is
               behind a squid accelerator proxy which adds a X-Forwarded-For header.

           $c-&gt;local_addr
               A packed SOCKADDR_IN in the same format as returned by "pack_sockaddr_in" in Socket,
               containing the port and address on the local host that the remote client is connected to.
               This is set by the server when the connection record is created so it is always defined.

           $c-&gt;remote_addr
               A packed SOCKADDR_IN in the same format as returned by "pack_sockaddr_in" in Socket,
               containing the port and address on the remote host that the server is connected to.  This is
               set by the server when the connection record is created so it is always defined.

               Among other things, this can be used, together with "$c-&gt;local_addr", to perform RFC1413
               ident lookups on the remote client even when the configuration directive <b>IdentityCheck</b> is
               turned off.

               Can be used like:

                  use Net::Ident qw (lookupFromInAddr);
                  ...
                  my $remoteuser = lookupFromInAddr ($c-&gt;local_addr,
                                                     $c-&gt;remote_addr, 2);

               Note that the lookupFromInAddr interface does not currently exist in the <b>Net::Ident</b> module,
               but the author is planning on adding it soon.

           $c-&gt;remote_logname
               If the configuration directive <b>IdentityCheck</b> is set to on:  then the first time
               "$r-&gt;get_remote_logname" is called the server does an RFC 1413 (ident) lookup to get the
               remote users system name. Generally for UNI* systems this is their login. The result is
               cached in "$c-&gt;remote_logname" then returned.  Subsequent calls to "$r-&gt;get_remote_host"
               return the cached value.

               If the configuration directive <b>IdentityCheck</b> is set to off: then "$r-&gt;get_remote_logname"
               does nothing and "$c-&gt;remote_logname" is always undefined.

           $c-&gt;user( [$user] )
               Deprecated, use "$r-&gt;user" instead.

           $c-&gt;auth_type
               Returns the authentication scheme used to successfully authenticate "$r-&gt;user", if any.

           $c-&gt;aborted
               Returns true if the client stopped talking to us.

           $c-&gt;fileno( [$direction] )
               Returns the client file descriptor. If $direction is 0, the input fd is returned. If
               $direction is not null or ommitted, the output fd is returned.

               This can be used to detect client disconnect without doing any I/O, e.g. using IO::Select.

<b>SERVER</b> <b>CONFIGURATION</b> <b>INFORMATION</b>
       The following methods are used to obtain information from server configuration and access control
       files.

       $r-&gt;dir_config( $key )
           Returns the value of a per-directory variable specified by the "PerlSetVar" directive.

              # &lt;Location /foo/bar&gt;
              # PerlSetVar  Key  Value
              # &lt;/Location&gt;

              my $val = $r-&gt;dir_config('Key');

           Keys are case-insensitive.

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. See <u>Apache::Table</u>.

       $r-&gt;dir_config-&gt;get( $key )
           Returns the value of a per-directory array variable specified by the "PerlAddVar" directive.

              # &lt;Location /foo/bar&gt;
              # PerlAddVar  Key  Value1
              # PerlAddVar  Key  Value2
              # &lt;/Location&gt;

              my @val = $r-&gt;dir_config-&gt;get('Key');

           Alternatively in your code you can extend the setting with:

             $r-&gt;dir_config-&gt;add(Key =&gt; 'Value3');

           Keys are case-insensitive.

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. See <u>Apache::Table</u>.

       $r-&gt;requires
           Returns an array reference of hash references, containing information related to the <b>require</b>
           directive.  This is normally used for access control, see Apache::AuthzAge for an example.

       $r-&gt;auth_type
           Returns a reference to the current value of the per directory configuration directive <b>AuthType</b>.
           Normally this would be set to "Basic" to use the basic authentication scheme defined in RFC 1945,
           <u>Hypertext</u> <u>Transfer</u> <u>Protocol</u> <u>--</u> <u>HTTP/1.0</u>. However, you could set to something else and implement
           your own authentication scheme.

       $r-&gt;auth_name
           Returns a reference to the current value of the per directory configuration directive <b>AuthName</b>.
           The AuthName directive creates protection realm within the server document space. To quote RFC
           1945 "These realms allow the protected resources on a server to be partitioned into a set of
           protection spaces, each with its own authentication scheme and/or authorization database." The
           client uses the root URL of the server to determine which authentication credentials to send with
           each HTTP request. These credentials are tagged with the name of the authentication realm that
           created them.  Then during the authentication stage the server uses the current authentication
           realm, from "$r-&gt;auth_name", to determine which set of credentials to authenticate.

       $r-&gt;document_root( [$docroot] )
           When called with no argument, returns a reference to the current value of the per server
           configuration directive <b>DocumentRoot</b>. To quote the Apache server documentation, "Unless matched
           by a directive like Alias, the server appends the path from the requested URL to the document
           root to make the path to the document."  This same value is passed to CGI scripts in the
           "DOCUMENT_ROOT" environment variable.

           You can also set this value by providing an argument to it. The following example dynamically
           sets the document root based on the request's "Host:" header:

              sub trans_handler
                {
                   my $r = shift;
                   my ($user) = ($r-&gt;header_in('Host') =~ /^[^\.]+/);
                   $r-&gt;document_root("/home/$user/www");
                   return DECLINED;
                }

              PerlTransHandler trans_handler

       $r-&gt;server_root_relative( [$relative_path] )
           If called without any arguments, this method returns the value of the currently-configured
           "ServerRoot" directory.

           If a single argument is passed, it concatenates it with the value of "ServerRoot". For example
           here is how to get the path to the <u>error</u><b>_</b><u>log</u> file under the server root:

            my $error_log = $r-&gt;server_root_relative("logs/error_log");

           See also the next item.

       Apache-&gt;server_root_relative( [$relative_path] )
           Same as the previous item, but this time it's used without a request object. This method is
           usually needed in a startup file. For example the following startup file modifies @INC to add a
           local directory with perl modules located under the server root and after that loads a module
           from that directory.

             BEGIN {
                 use Apache():
                 use lib Apache-&gt;server_root_relative("lib/my_project");
             }
             use MyProject::Config ();

       $r-&gt;allow_options
           The "$r-&gt;allow_options" method can be used for checking if it is OK to run a perl script.  The
           <b>Apache::Options</b> module provides the constants to check against.

              if(!($r-&gt;allow_options &amp; OPT_EXECCGI)) {
                  $r-&gt;log_reason("Options ExecCGI is off in this directory",
                                 $filename);
              }

       $r-&gt;get_server_port
           Returns the port number on which the server is listening.

       $s = $r-&gt;server
           Return a reference to the server info object (blessed into the <b>Apache::Server</b> package).  This is
           really a "server_rec*" in disguise.  The following methods can be used on the server object:

       $s = Apache-&gt;server
           Same as above, but only available during server startup for use in "&lt;Perl&gt;" sections, <b>PerlRequire</b>
           or <b>PerlModule</b>.

       $s-&gt;server_admin
           Returns the mail address of the person responsible for this server.

       $s-&gt;server_hostname
           Returns the hostname used by this server.

       $s-&gt;port
           Returns the port that this servers listens too.

       $s-&gt;is_virtual
           Returns true if this is a virtual server.

       $s-&gt;names
           Returns the wild-carded names for ServerAlias servers.

       $s-&gt;dir_config( $key )
           Alias for Apache::dir_config.

       $s-&gt;warn
           Alias for Apache::warn.

       $s-&gt;log_error
           Alias for Apache::log_error.

       $s-&gt;uid
           Returns the numeric user id under which the server answers requests.  This is the value of the
           User directive.

       $s-&gt;gid
           Returns the numeric group id under which the server answers requests.  This is the value of the
           Group directive.

       $s-&gt;loglevel
           Get or set the value of the current LogLevel. This method is added by the Apache::Log module,
           which needs to be pulled in.

               use Apache::Log;
               print "LogLevel = ", $s-&gt;loglevel;
               $s-&gt;loglevel(Apache::Log::DEBUG);

           If using Perl 5.005+, the following constants are defined (but not exported):

               Apache::Log::EMERG
               Apache::Log::ALERT
               Apache::Log::CRIT
               Apache::Log::ERR
               Apache::Log::WARNING
               Apache::Log::NOTICE
               Apache::Log::INFO
               Apache::Log::DEBUG

       $r-&gt;get_handlers( $hook )
           Returns a reference to a list of handlers enabled for $hook. $hook is a string representing the
           phase to handle. The returned list is a list of references to the handler subroutines.

                   $list = $r-&gt;get_handlers( 'PerlHandler' );

       $r-&gt;set_handlers( $hook, [\&amp;handler, ... ] )
           Sets the list if handlers to be called for $hook. $hook is a string representing the phase to
           handle. The list of handlers is an anonymous array of code references to the handlers to install
           for this request phase. The special list "[ \&amp;OK ]" can be used to disable a particular phase.

                   $r-&gt;set_handlers( PerlLogHandler =&gt; [ \&amp;myhandler1, \&amp;myhandler2 ] );
                   $r-&gt;set_handlers( PerlAuthenHandler =&gt; [ \&amp;OK ] );

       $r-&gt;push_handlers( $hook, \&amp;handler )
           Pushes a new handler to be called for $hook. $hook is a string representing the phase to handle.
           The handler is a reference to a subroutine to install for this request phase. This handler will
           be called before any configured handlers.

                   $r-&gt;push_handlers( PerlHandler =&gt; \&amp;footer);

       $r-&gt;current_callback
           Returns the name of the handler currently being run. This method is most useful to
           PerlDispatchHandlers who wish to only take action for certain phases.

                   if($r-&gt;current_callback eq "PerlLogHandler") {
                           $r-&gt;warn("Logging request");
                   }

<b>SETTING</b> <b>UP</b> <b>THE</b> <b>RESPONSE</b>
       The following methods are used to set up and return the response back to the client.  This typically
       involves setting up $r-&gt;<u>status()</u>, the various content attributes and optionally some additional
       $r-&gt;<u>header</u><b>_</b><u>out()</u> calls before calling $r-&gt;<u>send</u><b>_</b><u>http</u><b>_</b><u>header()</u> which will actually send the headers to
       the client.  After this a typical application will call the $r-&gt;<u>print()</u> method to send the response
       content to the client.

       $r-&gt;send_http_header( [$content_type] )
           Send the response line and all headers to the client.  Takes an optional parameter indicating the
           content-type of the response, i.e. 'text/html'.

           This method will create headers from the $r-&gt;<u>content</u><b>_</b><u>xxx()</u> and $r-&gt;<u>no</u><b>_</b><u>cache()</u> attributes
           (described below) and then append the headers defined by $r-&gt;header_out (or $r-&gt;err_header_out if
           status indicates an error).

       $r-&gt;get_basic_auth_pw
           If the current request is protected by Basic authentication, this method will return OK.
           Otherwise, it will return a value that ought to be propagated back to the client (typically
           AUTH_REQUIRED).  The second return value will be the decoded password sent by the client.

              ($ret, $sent_pw) = $r-&gt;get_basic_auth_pw;

       $r-&gt;note_basic_auth_failure
           Prior to requiring Basic authentication from the client, this method will set the outgoing HTTP
           headers asking the client to authenticate for the realm defined by the configuration directive
           "AuthName".

       $r-&gt;handler( [$meth] )
           Set the handler for a request.  Normally set by the configuration directive "AddHandler".

              $r-&gt;handler( "perl-script" );

       $r-&gt;notes( $key, [$value] )
           Return the value of a named entry in the Apache "notes" table, or optionally set the value of a
           named entry.  This table is used by Apache modules to pass messages amongst themselves. Generally
           if you are writing handlers in mod_perl you can use Perl variables for this.

              $r-&gt;notes("MY_HANDLER" =&gt; OK);
              $val = $r-&gt;notes("MY_HANDLER");

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. This requires <u>Apache::Table</u>.

       $r-&gt;pnotes( $key, [$value] )
           Like $r-&gt;notes, but takes any scalar as an value.

              $r-&gt;pnotes("MY_HANDLER" =&gt; [qw(one two)]);
              my $val = $r-&gt;pnotes("MY_HANDLER");
              print $val-&gt;[0];     # prints "one"

           Advantage over just using a Perl variable is that $r-&gt;pnotes gets cleaned up after every request.

       $r-&gt;subprocess_env( $key, [$value] )
           Return the value of a named entry in the Apache "subprocess_env" table, or optionally set the
           value of a named entry. This table is used by mod_include.  By setting some custom variables
           inside a perl handler it is possible to combine perl with mod_include nicely.  If you say, e.g.
           in a PerlHeaderParserHandler

              $r-&gt;subprocess_env(MyLanguage =&gt; "de");

           you can then write in your .shtml document:

              &lt;!--#if expr="$MyLanguage = en" --&gt;
              English
              &lt;!--#elif expr="$MyLanguage = de" --&gt;
              Deutsch
              &lt;!--#else --&gt;
              Sorry
              &lt;!--#endif --&gt;

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. This requires <u>Apache::Table</u>.

       $r-&gt;content_type( [$newval] )
           Get or set the content type being sent to the client.  Content types are strings like
           "text/plain", "text/html" or "image/gif".  This corresponds to the "Content-Type" header in the
           HTTP protocol.  Example of usage is:

              $previous_type = $r-&gt;content_type;
              $r-&gt;content_type("text/plain");

       $r-&gt;content_encoding( [$newval] )
           Get or set the content encoding.  Content encodings are string like "gzip" or "compress".  This
           correspond to the "Content-Encoding" header in the HTTP protocol.

       $r-&gt;content_languages( [$array_ref] )
           Get or set the content languages.  The content language corresponds to the "Content-Language"
           HTTP header and is an array reference containing strings such as "en" or "no".

       $r-&gt;status( $integer )
           Get or set the reply status for the client request.  The <b>Apache::Constants</b> module provide
           mnemonic names for the status codes.

       $r-&gt;status_line( $string )
           Get or set the response status line.  The status line is a string like "200 Document follows" and
           it will take precedence over the value specified using the $r-&gt;<u>status()</u> described above.

       $r-&gt;headers_out
           The $r-&gt;headers_out method will return a %hash of server response headers.  This can be used to
           initialize a perl hash, or one could use the $r-&gt;<u>header</u><b>_</b><u>out()</u> method (described below) to
           retrieve or set a specific header value directly.

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. This requires <u>Apache::Table</u>.

       $r-&gt;header_out( $header, $value )
           Change the value of a response header, or create a new one.  You should not define any "Content-
           XXX" headers by calling this method, because these headers use their own specific methods.
           Example of use:

              $r-&gt;header_out("WWW-Authenticate" =&gt; "Basic");
              $val = $r-&gt;header_out($key);

       $r-&gt;err_headers_out
           The $r-&gt;err_headers_out method will return a %hash of server response headers.  This can be used
           to initialize a perl hash, or one could use the $r-&gt;<u>err</u><b>_</b><u>header</u><b>_</b><u>out()</u> method (described below) to
           retrieve or set a specific header value directly.

           The difference between headers_out and err_headers_out is that the latter are printed even on
           error, and persist across internal redirects (so the headers printed for ErrorDocument handlers
           will have them).

           Will return a <u>HASH</u> reference blessed into the <u>Apache::Table</u> class when called in a scalar context
           with no "key" argument. This requires <u>Apache::Table</u>.

       $r-&gt;err_header_out( $header, [$value] )
           Change the value of an error response header, or create a new one.  These headers are used if the
           status indicates an error.

              $r-&gt;err_header_out("Warning" =&gt; "Bad luck");
              $val = $r-&gt;err_header_out($key);

       $r-&gt;no_cache( $boolean )
           This is a flag that indicates that the data being returned is volatile and the client should be
           told not to cache it. "$r-&gt;no_cache(1)" adds the headers "Pragma: no-cache" and "Cache-control:
           no-cache" to the reponse, therefore it must be called before "$r-&gt;send_http_header".

       $r-&gt;print( @list )
           This method sends data to the client with "$r-&gt;write_client", but first sets a timeout before
           sending with "$r-&gt;soft_timeout". This method is called instead of CORE::print when you use
           <u>print()</u> in your mod_perl programs.

           This method treats scalar references specially. If an item in @list is a scalar reference, it
           will be dereferenced before printing. This is a performance optimization which prevents unneeded
           copying of large strings, and it is subtly different from Perl's standard <u>print()</u> behavior.

           Example:

              $foo = \"bar"; print($foo);

           The result is "bar", not the "SCALAR(0xDEADBEEF)" you might have expected. If you really want the
           reference to be printed out, force it into a scalar context by using "print(scalar($foo))".

           The print-a-scalar-reference feature is now deprecated. There are known bugs when using it and
           it's not supported by mod_perl 2.0. If you have a scalar reference containing a string to be
           printed, dereference it before sending it to print.

       $r-&gt;send_fd( $filehandle )
           Send the contents of a file to the client.  Can for instance be used like this:

             open(FILE, $r-&gt;filename) || return 404;
             $r-&gt;send_fd(FILE);
             close(FILE);

       $r-&gt;internal_redirect( $newplace )
           Redirect to a location in the server namespace without telling the client. For instance:

              $r-&gt;internal_redirect("/home/sweet/home.html");

       $r-&gt;internal_redirect_handler( $newplace )
           Same as <u>internal</u><b>_</b><u>redirect</u>, but the <u>handler</u> from $r is preserved.

       $r-&gt;custom_response($code, $uri)
           This method provides a hook into the <b>ErrorDocument</b> mechanism, allowing you to configure a custom
           response for a given response code at request-time.

           Example:

               use Apache::Constants ':common';

               sub handler {
                   my($r) = @_;

                   if($things_are_ok) {
                       return OK;
                   }

                   #&lt;Location $r-&gt;uri&gt;
                   #ErrorDocument 401 /error.html
                   #&lt;/Location&gt;

                   $r-&gt;custom_response(AUTH_REQUIRED, "/error.html");

                   #can send a string too
                   #&lt;Location $r-&gt;uri&gt;
                   #ErrorDocument 401 "sorry, go away"
                   #&lt;/Location&gt;

                   #$r-&gt;custom_response(AUTH_REQUIRED, "sorry, go away");

                   return AUTH_REQUIRED;
               }

<b>SERVER</b> <b>CORE</b> <b>FUNCTIONS</b>
       $r-&gt;soft_timeout($message)
       $r-&gt;hard_timeout($message)
       $r-&gt;kill_timeout
       $r-&gt;reset_timeout
           (Documentation borrowed from http_main.h)

           There are two functions which modules can call to trigger a timeout (with the per-virtual-server
           timeout duration); these are hard_timeout and soft_timeout.

           The difference between the two is what happens when the timeout expires (or earlier than that, if
           the client connection aborts) --- a soft_timeout just puts the connection to the client in an
           "aborted" state, which will cause http_protocol.c to stop trying to talk to the client, but
           otherwise allows the code to continue normally.  <u>hard</u><b>_</b><u>timeout()</u>, by contrast, logs the request,
           and then aborts it completely --- <u>longjmp()</u>ing out to the <u>accept()</u> loop in http_main.  Any
           resources tied into the request resource pool will be cleaned up; everything that is not will
           leak.

           <u>soft</u><b>_</b><u>timeout()</u> is recommended as a general rule, because it gives your code a chance to clean up.
           However, <u>hard</u><b>_</b><u>timeout()</u> may be the most convenient way of dealing with timeouts waiting for some
           external resource other than the client, if you can live with the restrictions.

           When a hard timeout is in scope, critical sections can be guarded with <u>block</u><b>_</b><u>alarms()</u> and
           <u>unblock</u><b>_</b><u>alarms()</u> --- these are declared in alloc.c because they are most often used in
           conjunction with routines to allocate something or other, to make sure that the cleanup does get
           registered before any alarm is allowed to happen which might require it to be cleaned up; they *
           are, however, implemented in http_main.c.

           <u>kill</u><b>_</b><u>timeout()</u> will disarm either variety of timeout.

           <u>reset</u><b>_</b><u>timeout()</u> resets the timeout in progress.

       $r-&gt;post_connection($code_ref)
       $r-&gt;register_cleanup($code_ref)
           Register a cleanup function which is called just before $r-&gt;pool is destroyed.

              $r-&gt;register_cleanup(sub {
                  my $r = shift;
                  warn "registered cleanup called for ", $r-&gt;uri, "\n";
              });

           Cleanup functions registered in the parent process (before forking) will run once when the server
           is shut down:

              #PerlRequire startup.pl
              warn "parent pid is $$\n";
              Apache-&gt;server-&gt;register_cleanup(sub { warn "server cleanup in $$\n"});

           The <u>post</u><b>_</b><u>connection</u> method is simply an alias for <u>register</u><b>_</b><u>cleanup</u>, as this method may be used to
           run code after the client connection is closed, which may not be a <u>cleanup</u>.

<b>CGI</b> <b>SUPPORT</b>
       We also provide some methods that make it easier to support the CGI type of interface.

       $r-&gt;<u>send</u><b>_</b><u>cgi</u><b>_</b><u>header()</u>
           Take action on certain headers including <u>Status:</u>, <u>Location:</u> and <u>Content-type:</u> just as mod_cgi
           does, then calls $r-&gt;<u>send</u><b>_</b><u>http</u><b>_</b><u>header()</u>.  Example of use:

              $r-&gt;send_cgi_header(&lt;&lt;EOT);
              Location: /foo/bar
              Content-type: text/html

              EOT

<b>ERROR</b> <b>LOGGING</b>
       The following methods can be used to log errors.

       $r-&gt;log_reason($message, $file)
           The request failed, why??  Write a message to the server errorlog.

              $r-&gt;log_reason("Because I felt like it", $r-&gt;filename);

       $r-&gt;log_error($message)
           Uh, oh.  Write a message to the server errorlog.

              $r-&gt;log_error("Some text that goes in the error_log");

       $r-&gt;warn($message)
           For pre-1.3 versions of apache, this is just an alias for "log_error".  With 1.3+ versions of
           apache, this message will only be send to the error_log if <b>LogLevel</b> is set to <b>warn</b> or higher.

<b>UTILITY</b> <b>FUNCTIONS</b>
       Apache::unescape_url($string)
             $unescaped_url = Apache::unescape_url($string)

           Handy function for unescapes.  Use this one for filenames/paths. Notice that the original $string
           is mangled in the process (because the string part of PV shrinks, but the variable is not
           updated, to speed things up).

           Use unescape_url_info for the result of submitted form data.

       Apache::unescape_url_info($string)
           Handy function for unescapes submitted form data.  In opposite to unescape_url it translates the
           plus sign to space.

       Apache::perl_hook($hook)
           Returns true if the specified callback hook is enabled:

              for (qw(Access Authen Authz ChildInit Cleanup Fixup
                      HeaderParser Init Log Trans Type))
              {
                  print "$_ hook enabled\n" if Apache::perl_hook($_);
              }

<b>GLOBAL</b> <b>VARIABLES</b>
       $Apache::Server::Starting
           Set to true when the server is starting.

       $Apache::Server::ReStarting
           Set to true when the server is starting.

<b>SEE</b> <b>ALSO</b>
       <a href="../man1/perl.1.html#//apple_ref/doc/man/1/perl"><u>perl</u>(1)</a>, <a href="Apache__Constants.3pm.html#//apple_ref/doc/man/3/Apache::Constants"><u>Apache::Constants</u>(3)</a>, <a href="Apache__Registry.3pm.html#//apple_ref/doc/man/3/Apache::Registry"><u>Apache::Registry</u>(3)</a>, <a href="Apache__Debug.3pm.html#//apple_ref/doc/man/3/Apache::Debug"><u>Apache::Debug</u>(3)</a>, <a href="Apache__Options.3pm.html#//apple_ref/doc/man/3/Apache::Options"><u>Apache::Options</u>(3)</a>,
       <a href="CGI__Apache.3pm.html#//apple_ref/doc/man/3/CGI::Apache"><u>CGI::Apache</u>(3)</a>

       Apache C API notes at "<a href="http://www.apache.org/docs/">http://www.apache.org/docs/</a>"

<b>AUTHORS</b>
       Perl interface to the Apache C API written by Doug MacEachern with contributions from Gisle Aas,
       Andreas Koenig, Eric Bartley, Rob Hartill, Gerald Richter, Salvador Ortiz and others.



perl v5.8.8                                      2007-07-17                                        Apache(3)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/Apache.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/Apache.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/Apache.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
