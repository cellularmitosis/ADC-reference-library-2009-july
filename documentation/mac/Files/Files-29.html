<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Opening Files at Application Startup Time (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING29></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-12.html"><B>Chapter 1 - Introduction to File Management</B></A> / <A HREF="Files-19.html"><B>Using Files</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING29-0></A>
<H2>Opening Files at Application Startup Time</H2>
 <A NAME=MARKER-2-54></A><A NAME=MARKER-2-221></A>A user often launches your application by double-clicking one of its document icons or by selecting one or more document icons and choosing the Open command in the Finder's File menu. In these cases, your application needs to determine which files the user selected so that it can open each one and display its contents in a window. There are two ways in which your application can determine this.<P>
 If the user opens a file from the Finder and if your application supports high-level events, the Finder sends it an Open Documents event. Your application then needs to determine which file or files to open and react accordingly. For a complete description of how to process the Open Documents event, see the chapter "Apple Event Manager" in <I><A HREF="../IAC/IAC-2.html">Inside Macintosh: Interapplication Communication</A></I>.<P>
<DL>
<DT><B>IMPORTANT</B>
<DD>If at all possible, your application should support high-level events. You should use the techniques illustrated in this section only if your application doesn't support high-level events.  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 If your application does not support high-level events, you need to ask the Finder at application launch time whether or not the user launched the application by selecting some documents. You can do this by calling the <CODE>CountAppFiles</CODE> procedure and seeing whether the count of files is 1 or more. Then you can call the procedures GetAppFiles and ClrAppFiles to retrieve the information about the selected files. The technique is illustrated in <A HREF=#MARKER-9-222>Listing 1-17</A>.<P>
 The CountAppFiles procedure determines how many files, if any, the user selected at application startup time. If the value of the myNum parameter is nonzero, then myJob contains a value that indicates whether the files were selected for opening or printing. Currently, myJob can have one of two values:<P>
<PRE>
CONST
   appOpen  =  0;    {open the document(s)}
   appPrint =  1;    {print the document(s)}
</PRE>
<B>Listing 1-17  <A NAME=MARKER-9-222></A>Opening files at application launch time</B><P>
<PRE>
PROCEDURE DoInitFiles;
VAR
   myNum:   Integer;    {number of files to be opened or printed}
   myJob:   Integer;    {open or print the files?}
   index:   Integer;    {index of current file}
   myFile:  AppFile;    {file info}
   mySpec:  FSSpec;     {file system specification}
   myErr:   OSErr;
BEGIN
   CountAppFiles(myJob, myNum);
   IF myNum &gt; 0 THEN                         {user selected some files}
      IF myJob = appOpen THEN                {files are to be opened}
         FOR index := 1 TO myNum DO
            BEGIN
               GetAppFiles(index, myFile);   {get file info from Finder}
               myErr := FSMakeFSSpec(myFile.vRefNum, 0, myFile.fName,
                                    mySpec); {make an FSSpec to hold info}
               myErr := DoOpenFile(mySpec);  {read in file's data}
               ClrAppFiles(index);           {show we've got the info}
            END;
END;
</PRE>
 In <A HREF=#MARKER-9-222>Listing 1-17</A>, if the files are to be opened, then DoInitFiles obtains information about them by calling the GetAppFiles procedure for each one. The GetAppFiles procedure returns the information in a record of type AppFile.<A NAME=MARKER-2-150></A><P>
<PRE>
TYPE AppFile   =
   RECORD
      vRefNum:    Integer;    {working directory reference number}
      fType:      OSType;     {file type}
      versNum:    Integer;    {version number; ignored}
      fName:      Str255;     {filename}
   END;
</PRE>
 Because the function DoOpenFile takes an FSSpec record as a parameter, DoInitFiles next converts the information returned in the myFile parameter into an FSSpec record, using FSMakeFSSpec. Then DoInitFiles calls DoOpenFile to read the file data and ClrAppFiles to let the Finder know that it has processed the information for that file.<A NAME=MARKER-2-138></A><P>
<DL>
<DT><B>Note</B>
<DD>The vRefNum field of an AppFile record does not contain a volume reference number; instead it contains a working directory reference number, which encodes both the volume reference number and the parent directory ID. (That's why the second parameter passed to FSMakeFSSpec in <A HREF=#MARKER-9-222>Listing 1-17</A> is 0.)<EM></EM><A NAME=MARKER-9-377></A><A NAME=MARKER-2-226></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
