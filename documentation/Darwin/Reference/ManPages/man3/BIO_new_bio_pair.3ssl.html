<html><head><title>Mac OS X Developer Tools
 Manual Page For BIO_new_bio_pair(3ssl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3ssl/BIO_new_bio_pair" title="Mac OS X Developer Tools
 Manual Page for BIO_new_bio_pair(3ssl)"><a name="//apple_ref/doc/man/3/BIO_new_bio_pair" title="Mac OS X Developer Tools
 Manual Page for BIO_new_bio_pair(3ssl)"><!-- headerDoc=man; indexgroup=Section 3ssl; uid="//apple_ref/doc/man/3ssl/BIO_new_bio_pair"; name=BIO_new_bio_pair(3ssl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
BIO_s_bio(3)                                       OpenSSL                                      <a href="BIO_s_bio.3ssl.html#//apple_ref/doc/man/3/BIO_s_bio">BIO_s_bio(3)</a>



<b>NAME</b>
       BIO_s_bio, BIO_make_bio_pair, BIO_destroy_bio_pair, BIO_shutdown_wr, BIO_set_write_buf_size,
       BIO_get_write_buf_size, BIO_new_bio_pair, BIO_get_write_guarantee, BIO_ctrl_get_write_guarantee,
       BIO_get_read_request, BIO_ctrl_get_read_request, BIO_ctrl_reset_read_request - BIO pair BIO

<b>SYNOPSIS</b>
        #include &lt;openssl/bio.h&gt;

        BIO_METHOD *BIO_s_bio(void);

        #define BIO_make_bio_pair(b1,b2)   (int)BIO_ctrl(b1,BIO_C_MAKE_BIO_PAIR,0,b2)
        #define <!-- a -->BIO_destroy_bio_pair(b)<!-- /a -->    (int)BIO_ctrl(b,BIO_C_DESTROY_BIO_PAIR,0,NULL)

        #define <!-- a -->BIO_shutdown_wr(b)<!-- /a --> (int)BIO_ctrl(b, BIO_C_SHUTDOWN_WR, 0, NULL)

        #define BIO_set_write_buf_size(b,size) (int)BIO_ctrl(b,BIO_C_SET_WRITE_BUF_SIZE,size,NULL)
        #define BIO_get_write_buf_size(b,size) (size_t)BIO_ctrl(b,BIO_C_GET_WRITE_BUF_SIZE,size,NULL)

        int BIO_new_bio_pair(BIO **bio1, size_t writebuf1, BIO **bio2, size_t writebuf2);

        #define <!-- a -->BIO_get_write_guarantee(b)<!-- /a --> (int)BIO_ctrl(b,BIO_C_GET_WRITE_GUARANTEE,0,NULL)
        size_t BIO_ctrl_get_write_guarantee(BIO *b);

        #define <!-- a -->BIO_get_read_request(b)<!-- /a -->    (int)BIO_ctrl(b,BIO_C_GET_READ_REQUEST,0,NULL)
        size_t BIO_ctrl_get_read_request(BIO *b);

        int BIO_ctrl_reset_read_request(BIO *b);

<b>DESCRIPTION</b>
       <u>BIO</u><b>_</b><u>s</u><b>_</b><u>bio()</u> returns the method for a BIO pair. A BIO pair is a pair of source/sink BIOs where data
       written to either half of the pair is buffered and can be read from the other half. Both halves must
       usually by handled by the same application thread since no locking is done on the internal data
       structures.

       Since BIO chains typically end in a source/sink BIO it is possible to make this one half of a BIO
       pair and have all the data processed by the chain under application control.

       One typical use of BIO pairs is to place TLS/SSL I/O under application control, this can be used when
       the application wishes to use a non standard transport for TLS/SSL or the normal socket routines are
       inappropriate.

       Calls to <u>BIO</u><b>_</b><u>read()</u> will read data from the buffer or request a retry if no data is available.

       Calls to <u>BIO</u><b>_</b><u>write()</u> will place data in the buffer or request a retry if the buffer is full.

       The standard calls <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>pending()</u> and <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>wpending()</u> can be used to determine the amount of
       pending data in the read or write buffer.

       <u>BIO</u><b>_</b><u>reset()</u> clears any data in the write buffer.

       <u>BIO</u><b>_</b><u>make</u><b>_</b><u>bio</u><b>_</b><u>pair()</u> joins two separate BIOs into a connected pair.

       <u>BIO</u><b>_</b><u>destroy</u><b>_</b><u>pair()</u> destroys the association between two connected BIOs. Freeing up any half of the
       pair will automatically destroy the association.

       <u>BIO</u><b>_</b><u>shutdown</u><b>_</b><u>wr()</u> is used to close down a BIO <b>b</b>. After this call no further writes on BIO <b>b</b> are
       allowed (they will return an error). Reads on the other half of the pair will return any pending data
       or EOF when all pending data has been read.

       <u>BIO</u><b>_</b><u>set</u><b>_</b><u>write</u><b>_</b><u>buf</u><b>_</b><u>size()</u> sets the write buffer size of BIO <b>b</b> to <b>size</b>.  If the size is not initialized
       a default value is used. This is currently 17K, sufficient for a maximum size TLS record.

       <u>BIO</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>buf</u><b>_</b><u>size()</u> returns the size of the write buffer.

       <u>BIO</u><b>_</b><u>new</u><b>_</b><u>bio</u><b>_</b><u>pair()</u> combines the calls to <u>BIO</u><b>_</b><u>new()</u>, <u>BIO</u><b>_</b><u>make</u><b>_</b><u>bio</u><b>_</b><u>pair()</u> and <u>BIO</u><b>_</b><u>set</u><b>_</b><u>write</u><b>_</b><u>buf</u><b>_</b><u>size()</u>
       to create a connected pair of BIOs <b>bio1</b>, <b>bio2</b> with write buffer sizes <b>writebuf1</b> and <b>writebuf2</b>. If
       either size is zero then the default size is used.  <u>BIO</u><b>_</b><u>new</u><b>_</b><u>bio</u><b>_</b><u>pair()</u> does not check whether <b>bio1</b> or
       <b>bio2</b> do point to some other BIO, the values are overwritten, <u>BIO</u><b>_</b><u>free()</u> is not called.

       <u>BIO</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>guarantee()</u> and <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>guarantee()</u> return the maximum length of data that
       can be currently written to the BIO. Writes larger than this value will return a value from
       <u>BIO</u><b>_</b><u>write()</u> less than the amount requested or if the buffer is full request a retry.
       <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>guarantee()</u> is a function whereas <u>BIO</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>guarantee()</u> is a macro.

       <u>BIO</u><b>_</b><u>get</u><b>_</b><u>read</u><b>_</b><u>request()</u> and <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>get</u><b>_</b><u>read</u><b>_</b><u>request()</u> return the amount of data requested, or the
       buffer size if it is less, if the last read attempt at the other half of the BIO pair failed due to
       an empty buffer.  This can be used to determine how much data should be written to the BIO so the
       next read will succeed: this is most useful in TLS/SSL applications where the amount of data read is
       usually meaningful rather than just a buffer size. After a successful read this call will return
       zero.  It also will return zero once new data has been written satisfying the read request or part of
       it.  Note that <u>BIO</u><b>_</b><u>get</u><b>_</b><u>read</u><b>_</b><u>request()</u> never returns an amount larger than that returned by
       <u>BIO</u><b>_</b><u>get</u><b>_</b><u>write</u><b>_</b><u>guarantee()</u>.

       <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>reset</u><b>_</b><u>read</u><b>_</b><u>request()</u> can also be used to reset the value returned by <u>BIO</u><b>_</b><u>get</u><b>_</b><u>read</u><b>_</b><u>request()</u>
       to zero.

<b>NOTES</b>
       Both halves of a BIO pair should be freed. That is even if one half is implicit freed due to a
       <u>BIO</u><b>_</b><u>free</u><b>_</b><u>all()</u> or <u>SSL</u><b>_</b><u>free()</u> call the other half needs to be freed.

       When used in bidirectional applications (such as TLS/SSL) care should be taken to flush any data in
       the write buffer. This can be done by calling <u>BIO</u><b>_</b><u>pending()</u> on the other half of the pair and, if any
       data is pending, reading it and sending it to the underlying transport. This must be done before any
       normal processing (such as calling <u>select()</u> ) due to a request and <u>BIO</u><b>_</b><u>should</u><b>_</b><u>read()</u> being true.

       To see why this is important consider a case where a request is sent using <u>BIO</u><b>_</b><u>write()</u> and a response
       read with <u>BIO</u><b>_</b><u>read()</u>, this can occur during an TLS/SSL handshake for example. <u>BIO</u><b>_</b><u>write()</u> will
       succeed and place data in the write buffer. <u>BIO</u><b>_</b><u>read()</u> will initially fail and <u>BIO</u><b>_</b><u>should</u><b>_</b><u>read()</u> will
       be true. If the application then waits for data to be available on the underlying transport before
       flushing the write buffer it will never succeed because the request was never sent!

<b>RETURN</b> <b>VALUES</b>
       <u>BIO</u><b>_</b><u>new</u><b>_</b><u>bio</u><b>_</b><u>pair()</u> returns 1 on success, with the new BIOs available in <b>bio1</b> and <b>bio2</b>, or 0 on
       failure, with NULL pointers stored into the locations for <b>bio1</b> and <b>bio2</b>. Check the error stack for
       more information.

       [XXXXX: More return values need to be added here]

<b>EXAMPLE</b>
       The BIO pair can be used to have full control over the network access of an application. The
       application can call <u>select()</u> on the socket as required without having to go through the SSL-<font color="#ffffff" class="whiteout">interface.&nbsp;SSLinterface.</font>
       interface.

        BIO *internal_bio, *network_bio;
        ...
        BIO_new_bio_pair(internal_bio, 0, network_bio, 0);
        SSL_set_bio(ssl, internal_bio, internal_bio);
        SSL_operations();
        ...

        application |   TLS-engine
           |        |
           +----------&gt; SSL_operations()
                    |     /\    ||
                    |     ||    \/
                    |   BIO-pair (internal_bio)
           +----------&lt; BIO-pair (network_bio)
           |        |
         socket     |

         ...
         SSL_free(ssl);                /* implicitly frees internal_bio */
         BIO_free(network_bio);
         ...

       As the BIO pair will only buffer the data and never directly access the connection, it behaves non-
       blocking and will return as soon as the write buffer is full or the read buffer is drained. Then the
       application has to flush the write buffer and/or fill the read buffer.

       Use the <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>pending()</u>, to find out whether data is buffered in the BIO and must be transfered to
       the network. Use <u>BIO</u><b>_</b><u>ctrl</u><b>_</b><u>get</u><b>_</b><u>read</u><b>_</b><u>request()</u> to find out, how many bytes must be written into the
       buffer before the <u>SSL</u><b>_</b><u>operation()</u> can successfully be continued.

<b>WARNING</b>
       As the data is buffered, <u>SSL</u><b>_</b><u>operation()</u> may return with a ERROR_SSL_WANT_READ condition, but there
       is still data in the write buffer. An application must not rely on the error value of <u>SSL</u><b>_</b><u>operation()</u>
       but must assure that the write buffer is always flushed first. Otherwise a deadlock may occur as the
       peer might be waiting for the data before being able to continue.

<b>SEE</b> <b>ALSO</b>
       <a href="SSL_set_bio.3ssl.html#//apple_ref/doc/man/3/SSL_set_bio"><u>SSL</u><b>_</b><u>set</u><b>_</b><u>bio</u>(3)</a>, <a href="ssl.3ssl.html#//apple_ref/doc/man/3/ssl"><u>ssl</u>(3)</a>, <a href="bio.3ssl.html#//apple_ref/doc/man/3/bio"><u>bio</u>(3)</a>, <a href="BIO_should_retry.3ssl.html#//apple_ref/doc/man/3/BIO_should_retry"><u>BIO</u><b>_</b><u>should</u><b>_</b><u>retry</u>(3)</a>, <a href="BIO_read.3ssl.html#//apple_ref/doc/man/3/BIO_read"><u>BIO</u><b>_</b><u>read</u>(3)</a>



0.9.7l                                           2002-12-12                                     <a href="BIO_s_bio.3ssl.html#//apple_ref/doc/man/3/BIO_s_bio">BIO_s_bio(3)</a>
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/BIO_new_bio_pair.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/BIO_new_bio_pair.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/BIO_new_bio_pair.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
