<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MoofWarsOld - /MoofEncoder/GridEncode.cp</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGames-date.html">Games</a> &gt; <A HREF="javascript:location.replace('index.html');">MoofWarsOld</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Games/index.html" target="_blank">Reference Library > Games</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MoofWarsOld</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/MoofEncoder/GridEncode.cp</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/MoofEncoder/AppConditionals.h</option>
<option value="listing2.html">/MoofEncoder/Color Search Procs.cp</option>
<option value="listing3.html">/MoofEncoder/Color Search Procs.h</option>
<option value="listing4.html">/MoofEncoder/GridEncode.cp</option>
<option value="listing5.html">/MoofEncoder/GridEncode.h</option>
<option value="listing6.html">/MoofEncoder/GridTilesFormat.h</option>
<option value="listing7.html">/MoofEncoder/ICL8Encode.cp</option>
<option value="listing8.html">/MoofEncoder/ICL8Encode.h</option>
<option value="listing9.html">/MoofEncoder/main.cp</option>
<option value="listing10.html">/MoofEncoder/main.h</option>
<option value="listing11.html">/MoofEncoder/PICTEncode.cp</option>
<option value="listing12.html">/MoofEncoder/PICTEncode.h</option>
<option value="listing13.html">/MoofEncoder/PICTMask.cp</option>
<option value="listing14.html">/MoofEncoder/PICTMask.h</option>
<option value="listing15.html">/MoofWars/AppConditionals.h</option>
<option value="listing16.html">/MoofWars/GridTilesFormat.h</option>
<option value="listing17.html">/MoofWars/MoofWars.cp</option>
<option value="listing18.html">/MoofWars/MoofWars.h</option>
<option value="listing19.html">/MoofWars/TCommandTimer.cp</option>
<option value="listing20.html">/MoofWars/TCommandTimer.h</option>
<option value="listing21.html">/MoofWars/TEnemySprite.cp</option>
<option value="listing22.html">/MoofWars/TEnemySprite.h</option>
<option value="listing23.html">/MoofWars/TShipSprite.cp</option>
<option value="listing24.html">/MoofWars/TShipSprite.h</option>
<option value="listing25.html">/MoofWars/TShotSprite.cp</option>
<option value="listing26.html">/MoofWars/TShotSprite.h</option>
<option value="listing27.html">/MoofWars/TSprite.cp</option>
<option value="listing28.html">/MoofWars/TSprite.h</option>
<option value="listing29.html">/MoofWars/TSpriteCollection.cp</option>
<option value="listing30.html">/MoofWars/TSpriteCollection.h</option>
<option value="listing31.html">/MoofWars/TTileCollection.cp</option>
<option value="listing32.html">/MoofWars/TTileCollection.h</option>
<option value="listing33.html">/MoofWars/TTileGrid.cp</option>
<option value="listing34.html">/MoofWars/TTileGrid.h</option>
<option value="listing35.html">/Tim's Libraries/Common Stuff.h</option>
<option value="listing36.html">/Tim's Libraries/Error Macros.h</option>
<option value="listing37.html">/Tim's Libraries/Scaling.cp</option>
<option value="listing38.html">/Tim's Libraries/Scaling.h</option>
<option value="listing39.html">/Tim's Libraries/TGraphic.cp</option>
<option value="listing40.html">/Tim's Libraries/TGraphic.h</option>
<option value="listing41.html">/Tim's Libraries/TGraphicCollection.cp</option>
<option value="listing42.html">/Tim's Libraries/TGraphicCollection.h</option></select>
				</p>
				</form>
				<p><strong><a href="MoofWarsOld.zip">Download Sample</a></strong> (&#147;MoofWarsOld.zip&#148;, 222.9K)<BR>
<strong><a href="MoofWarsOld.dmg">Download Sample</a></strong> (&#147;MoofWarsOld.dmg&#148;, 287.5K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    GridEncode.cp  Contains:  This is just a very simple encoder that shows how to build GRID and TILE resources.        The TILE resource is a set of 32x32x1 byte tiles.  This encoder takes a picture and        dices it into 32x32 tiles, which it writes out to output file.  It then builds a        standard grid, repeating the original picture as a pattern across the grid.          Eventually, it would be nice to make a program that lets someone graphically edit        the available list of tiles and the actual GRID resource, much like any number        of map editors out for various games.  Written by: Timothy Carroll    Copyright:  Copyright &copy; 1996-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/1/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        2/24/97    Timothy Carroll  Now explicitly include main.h        8/15/96    Timothy Carroll Initial Release        */#include &lt;Resources.h&gt;#include &quot;Main.h&quot;#include &quot;GridEncode.h&quot;#include &quot;GridTilesFormat.h&quot;#include &quot;Error Macros.h&quot;OSStatus GridTileEncode (short inputFileResNum, short outputFileResNum){  OSStatus    theErr;  short      saveResNum;    // Used to compile the tile resource  PicHandle    tilePict = NULL;  GWorldPtr    tileWorld = NULL;  PixMapHandle  tilePix = NULL;    CGrafPtr     savePort;  GDHandle     saveDevice;    Rect      pictRect;  long      width, height, numTiles;  long      tileRowBytes;  Ptr        tileBaseAddress;    long      x, y, loop;    Ptr        destPtr, srcPtr;  CellGridType  *gridPtr;  CellGridType  currentValue;    // Our output handles  Handle      tile = NULL;  Handle      grid = NULL;    // Whether or not we've written it out as a resource  Boolean      tileIsResource = false, gridIsResource = false;      saveResNum = CurResFile();  UseResFile (inputFileResNum);  // First thing is to copy the color table resource to the output.  theErr = CopyResource (inputFileResNum, outputFileResNum,'clut', kAppColorTableResID);  FAIL_OSERR (theErr, &quot;\pFailed to copy the color table to the destination file&quot;)  // Load the color table and the graphic we want to dice into pieces  gAppColorTable = GetCTable( kAppColorTableResID );  FAIL_NIL (gAppColorTable, &quot;\pFailed to load the color table&quot;)    tilePict = (PicHandle) Get1Resource ('PICT', kPICTInputResID);  theErr = ResError();  FAIL_OSERR (theErr, &quot;\pFailed to load the pict&quot;)  FAIL_NIL (tilePict, &quot;\pFailed to load the pict&quot;)    // Create a GWorld and draw our PICT into it.    pictRect = (**tilePict).picFrame;    pictRect.right -= pictRect.left;  pictRect.left = 0;  pictRect.bottom -= pictRect.top;  pictRect.top = 0;    theErr = NewGWorld(&amp;tileWorld, kPreferredDepth, &amp;pictRect, gAppColorTable, NULL, keepLocal);  FAIL_OSERR (theErr, &quot;\pCouldn't allocate GWorld for encoding&quot;)  FAIL_NIL (tileWorld, &quot;\pCouldn't allocate GWorld for encoding&quot;)    tilePix  = GetGWorldPixMap(tileWorld);  FAIL_NIL (tilePix, &quot;\pCouldn't get the GWorld's PixMap&quot;)  FAIL_FALSE ( LockPixels(tilePix), &quot;\pCouldn't lock GWorld PixMap&quot;)    GetGWorld (&amp;savePort, &amp;saveDevice);  SetGWorld (tileWorld, NULL);    EraseRect (&amp;pictRect);  DrawPicture (tilePict, &amp;pictRect);    SetGWorld (savePort, saveDevice);  // We're done with the picture, release it  ReleaseResource ((Handle) tilePict);  tilePict = NULL;  // Time to build the tile resource.  We're going to dice it into as many  // 32x32 tiles as we can.  Any partial data to the bottom or the right will  // be ignored -- we only build complete tiles.    width = pictRect.right / 32;  height = pictRect.bottom / 32;  numTiles = width * height + 1;  // Our first tile is always an all black tile, for the &quot;borders&quot;    tile = NewHandleClear (sizeof (TileCollectionResHeader) + numTiles*kTileSize);  theErr = MemError();  FAIL_OSERR (theErr, &quot;\p Failed to create the tile resource file&quot;)  FAIL_NIL (tile, &quot;\p Failed to create the tile resource file&quot;)  // Fill in the tile header.  (**((TileCollectionResHeader **) tile)).version = 0;  (**((TileCollectionResHeader **) tile)).depth = kPreferredDepth;  (**((TileCollectionResHeader **) tile)).flags = 0;  (**((TileCollectionResHeader **) tile)).numTiles = numTiles;    tileBaseAddress = ( Ptr) GetPixBaseAddr( tilePix );  tileRowBytes = ( **tilePix ).rowBytes &amp; 0x3fff;    destPtr = (*tile) + sizeof (TileCollectionResHeader);    // First tile, we just fill with black  for (loop = 0; loop &lt; 32; loop++)  {    ((UInt32 *) destPtr)[0] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[1] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[2] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[3] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[4] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[5] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[6] = 0xFFFFFFFF;    ((UInt32 *) destPtr)[7] = 0xFFFFFFFF;    destPtr += 32;  }  // Iterate over each tile and copy 1K of data to the destination  for (x = 0; x &lt; width; x++)  {    for (y = 0; y &lt; height; y++)    {      srcPtr = tileBaseAddress + 32*y*tileRowBytes + 32*x;      for (loop = 0; loop &lt; 32; loop++)      {        register UInt32 temp1, temp2, temp3, temp4, temp5, temp6, temp7, temp8;        temp1 = ((UInt32 *) srcPtr)[0];        temp2 = ((UInt32 *) srcPtr)[1];        temp3 = ((UInt32 *) srcPtr)[2];        temp4 = ((UInt32 *) srcPtr)[3];        temp5 = ((UInt32 *) srcPtr)[4];        temp6 = ((UInt32 *) srcPtr)[5];        temp7 = ((UInt32 *) srcPtr)[6];        temp8 = ((UInt32 *) srcPtr)[7];        ((UInt32 *) destPtr)[0] = temp1;        ((UInt32 *) destPtr)[1] = temp2;        ((UInt32 *) destPtr)[2] = temp3;        ((UInt32 *) destPtr)[3] = temp4;        ((UInt32 *) destPtr)[4] = temp5;        ((UInt32 *) destPtr)[5] = temp6;        ((UInt32 *) destPtr)[6] = temp7;        ((UInt32 *) destPtr)[7] = temp8;        srcPtr += tileRowBytes;        destPtr += 32;      }    }  }    // Tile resource is done.  Dispose of the GWorld  DisposeGWorld ( tileWorld);  tileWorld = NULL;      // Time to create the GRID resource  grid = NewHandle (sizeof (TileGridResHeader) +               sizeof (CellGridType)*kGridWidth*kGridHeight);  theErr = MemError();  FAIL_OSERR (theErr, &quot;\p Failed to allocate memory for GRID resource&quot;)  FAIL_NIL (grid, &quot;\p Failed to allocate memory for GRID resource&quot;)    // Fill in the header  (**((TileGridResHeader **) grid)).version = 0;  (**((TileGridResHeader **) grid)).flags = 0;  (**((TileGridResHeader **) grid)).tileResID = kOutputResID;  (**((TileGridResHeader **) grid)).width = kGridWidth;  (**((TileGridResHeader **) grid)).height = kGridHeight;  (**((TileGridResHeader **) grid)).defaultTile = 0;  // our black tile    // Point to the start of the grid data.  gridPtr = (CellGridType * ) ((Ptr)(*grid) + sizeof (TileGridResHeader));    // Fill in each tile  for (x = 0; x &lt; kGridWidth; x++)  {    for (y = 0; y &lt; kGridWidth; y++)    {      currentValue = (y % height)*height + (x % width) +1;      *gridPtr = currentValue;      gridPtr++;    }  }  // Write the resources out to the output file.  UseResFile (outputFileResNum);    AddResource( tile, TileCollectionResType, kOutputResID, &quot;\p&quot; );  theErr = ResError();  FAIL_OSERR (theErr, &quot;\pFailed to add the TILE resource to the file&quot;)  tileIsResource = true;      WriteResource( tile );  theErr = ResError();  FAIL_OSERR (theErr, &quot;\pFailed to write the TILE resource to the file&quot;)    ReleaseResource( tile );  tile = NULL;  AddResource( grid, TileGridResType, kOutputResID, &quot;\p&quot; );  theErr = ResError();  FAIL_OSERR (theErr, &quot;\pFailed to add the GRID resource to the file&quot;)  gridIsResource = true;    WriteResource( grid );  FAIL_OSERR (theErr, &quot;\pFailed to write the GRID resource to the file&quot;)  theErr = ResError();    ReleaseResource( grid );  grid = NULL;      // Build the grid resource;    goto cleanup;    error:  if (theErr == noErr)    theErr = paramErr;      cleanup:    UseResFile (saveResNum);    if (tilePict != NULL)    ReleaseResource ((Handle) tilePict);      if (tileWorld != NULL)    DisposeGWorld (tileWorld);      if (gAppColorTable != NULL)    DisposeCTable (gAppColorTable);      gAppColorTable = NULL;    if (tile)    if (tileIsResource)      ReleaseResource (tile);    else      DisposeHandle (tile);         if (grid)    if (gridIsResource)      ReleaseResource (grid);    else      DisposeHandle (grid);  return theErr;}  </pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MoofWarsOld/listing4.html%3Fid%3DDTS10000057-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MoofWarsOld/listing4.html%3Fid%3DDTS10000057-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MoofWarsOld/listing4.html%3Fid%3DDTS10000057-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>