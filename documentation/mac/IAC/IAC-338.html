<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using a Script Context to Handle an Apple Event(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING338></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-337.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-339.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-331.html"><B>Chapter 10 - Scripting Components</B></A> / <A HREF="IAC-333.html"><B>Using Scripting Component Routines</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING338-0></A>
<H2><A NAME=MARKER-9-135></A>Using a Script Context to Handle an Apple Event</H2>
 The preceding sections describe how you can load, compile, modify, and execute scripts under circumstances determined by your application. Your application can use these techniques to associate a script with an Apple event object or application object and execute the script when the user manipulates the object in some way. <A NAME=MARKER-2-136></A> <A NAME=MARKER-2-189></A> <A NAME=MARKER-2-286></A><P>
 Another way to execute a script is to use a script context (called a <B>script object</B> in AppleScript) to handle an Apple event. To do this, your application passes both the event and the script context to <CODE>OSAExecuteEvent</CODE> or <CODE>OSADoEvent</CODE>. You can also associate script contexts with Apple event objects--that is, objects in your application that can be identified by object specifier records. If an Apple event acts on an object with which a script context is associated, your application attempts to use the script context to handle the Apple event.<P>
 For example, <A HREF=IAC-298.html#MARKER-9-77>Figure 7-7 on page 7-22</A> shows how you can use a general Apple event handler to provide initial processing for all Apple events received by your application. <A HREF=#MARKER-9-139>Listing 10-7</A> shows an example of such a handler. <P>
 You install a general Apple event handler like the one in <A HREF=#MARKER-9-139>Listing 10-7</A> in your application's special handler dispatch table using the constant <CODE>keyPreDispatch</CODE>: <P>
<PRE>
myErr := AEInstallSpecialHandler(keyPreDispatch,
                               @MyGeneralAppleEventHandler, 
                               FALSE);
</PRE>
 When it receives an Apple event, the <CODE>MyGeneralAppleEventHandler</CODE> function in <A HREF=#MARKER-9-139>Listing 10-7</A> first extracts the event's direct parameter. It then calls another application-defined function, <CODE>MyGetAttachedScript</CODE>, which checks whether the direct parameter contains an object specifier record, calls <CODE>AEResolve</CODE> to locate the corresponding Apple event object, and returns a script ID for any script context attached to that object.<P>
 If a script context is associated with the object, <CODE>MyGeneralAppleEventHandler</CODE> passes the script context's script ID and the Apple event to the <CODE>OSADoEvent</CODE> function. Otherwise, <CODE>MyGeneralAppleEventHandler</CODE> returns <CODE>errAEEventNotHandled</CODE>, which causes the Apple Event Manager to look for an appropriate handler in the application's Apple event dispatch table or elsewhere using standard Apple event dispatching.<P>
 The <CODE>OSADoEvent</CODE> function in <A HREF=#MARKER-9-139>Listing 10-7</A> takes a component instance that identifies a connection with the generic scripting component. (If it has not already done so, the generic scripting component in turn opens a connection with the scripting component that created the script context.) In addition to the component instance, the Apple event, and the script ID for the script context, <CODE>OSADoEvent</CODE> takes a parameter that indicates no mode flags are set and a <CODE>VAR</CODE> parameter that contains any reply Apple event returned as a result of handling the event. <P>
 If the scripting component determines that a script context can't handle the specified event (for example, if an AppleScript script context doesn't include statements that handle the event), <CODE>OSADoEvent</CODE> returns <CODE>errAEEventNotHandled</CODE>. If <CODE>OSADoEvent</CODE> attempts to use the script context to handle the event, the function returns a reply event that contains either the resulting script value or, if an error occurred, information about the error.<P>
 The script context shown in <A HREF=IAC-298.html#MARKER-9-77>Figure 7-7</A> contains an AppleScript handler for the Move event. Such handlers exist only as AppleScript statements in a script context and do not have corresponding entries in an application's Apple event dispatch table. However, a handler in a script context can modify or override the actions performed by an application's standard Apple event handlers installed in its Apple event dispatch table. The next section, <A HREF=IAC-339.html#MARKER-9-142>"Supplying a Resume Dispatch Function,"</A> describes how this works.<P>
<B>Listing 10-7  <A NAME=MARKER-9-139></A>A general Apple event handler that uses the <CODE>OSADoEvent</CODE> function<A NAME=MARKER-2-140></A></B><P>
<PRE>
FUNCTION MyGeneralAppleEventHandler (event: AppleEvent; 
                                     reply: AppleEvent;
                                     refcon: LongInt): OSErr;
VAR
   dp, resultDesc:   AEDesc;
   scriptID:         OSAID;
   myErr, ignoreErr: OSErr;
   myOSAErr:         OSAError;
BEGIN
   {get the direct parameter}
   myErr := AEGetParamDesc(event, keyDirectObject, typeWildCard, 
                           dp);
   {get script ID for script context attached to object }
   { specified in direct parameter}
   IF MyGetAttachedScript(dp, scriptID) THEN 
      {execute the handler in the script context handler and, if }
      { necessary, the default Apple event handler}
      myOSAErr := OSADoEvent(gScriptingComponent, event, 
                              scriptID, kOSAModeNull, reply)
   ELSE
      myOSAErr := errAEEventNotHandled;
   ignoreErr := AEDisposeDesc(dp);
   MyGeneralAppleEventHandler := OSErr(myOSAErr);
END; 
</PRE>
 For more information about <CODE>OSADoEvent</CODE>, <CODE>OSAExecuteEvent</CODE>, and other routines related to the use of script contexts to handle Apple events, see <A HREF=IAC-390.html#MARKER-9-248>page 10-70</A>.<A NAME=MARKER-21-348></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-337.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-339.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
