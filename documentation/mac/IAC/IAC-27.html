<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Receiving Apple Events From the Edition Manager(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING27></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A> / <A HREF="IAC-26.html"><B>Using the Edition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H2><A NAME=MARKER-21-71></A>Receiving Apple Events From the Edition Manager</H2>
 Applications that use the Edition Manager must support Apple events. This requires that your application support the required Open Documents event and Apple events sent by the Edition Manager. See the chapter "Introduction to Apple Events" in this book for general information on Apple events.<A NAME=MARKER-21-32></A><P>
 Apple events sent by the Edition Manager arrive as high-level events. The <CODE>EventRecord</CODE> data type defines the event record.<P>
<PRE>
TYPE EventRecord =
   RECORD
      what:       Integer;    {kHighLevelEvent}
      message:    LongInt;    {'sect'}
      when:       LongInt;
      where:      Point;      {'read', 'writ', 'cncl', 'scrl'}
      modifiers:  Integer;
   END;
</PRE>
 The Edition Manager can send these Apple events with the event class and event ID as shown here:<A NAME=MARKER-2-144></A><A NAME=MARKER-2-5></A><A NAME=MARKER-2-6></A><A NAME=MARKER-2-7></A><P>
<UL>
<LI>Section Read events (<CODE>'sect' 'read'</CODE>)<A NAME=MARKER-2-8></A>
<LI>Section Write events (<CODE>'sect' 'writ'</CODE>)<A NAME=MARKER-2-9></A>
<LI>Section Cancel events (<CODE>'sect' 'cncl'</CODE>)<A NAME=MARKER-2-10></A>
<LI>Section Scroll events (<CODE>'sect' 'scrl'</CODE>)<A NAME=MARKER-2-11></A><P>
</UL>
 Each time your application creates a publisher or a subscriber, the Edition Manager registers its section. When an edition is updated, the Edition Manager scans its list to locate registered subscribers. For each registered subscriber that is set up to receive updated editions automatically, your application receives a Section Read event.<A NAME=MARKER-2-12></A><P>
 If the Edition Manager discovers that an edition file is missing while registering a publisher, it creates a new edition file and sends the publisher a Section Write event. <P>
 When you receive a Section Cancel event, you need to cancel the specified section. Note that the current Edition Manager does not send you Section Cancel events, but you do need to provide a handler for future expansion.<P>
 If the user selects a subscriber within a document and then selects Open Publisher in the subscriber options dialog box, the publishing application receives the Open Documents event and opens the document containing the publisher. The publishing application also receives a Section Scroll event. Scroll to the location of the publisher, display this section on the user's screen, and turn on its border.<P>
 See <A HREF=IAC-30.html#MARKER-9-121>"Opening and Closing a Document Containing Sections" beginning on page 2-22</A> for detailed information on registering and unregistering a section and writing data to an edition. See <A HREF=IAC-319.html#MARKER-9-14>"Using Publisher and Subscriber Options" beginning on page 2-43</A> for information on publisher and subscriber options.<P>
 After receiving an Apple event sent by the Edition Manager, use the Apple Event Manager to extract the section handle. In addition, you must also call the <CODE>IsRegisteredSection</CODE> function to determine whether the section is registered. It is possible (because of a race condition) to receive an event for a section that you recently disposed of or unregistered. One way to ensure that an event corresponds to a valid section is to call the <CODE>IsRegisteredSection</CODE> function after you receive an event. <A NAME=MARKER-2-17></A><A NAME=MARKER-2-18></A> <P>
<PRE>
err := IsRegisteredSection (sectionH);
</PRE>
 <A HREF=#MARKER-9-85>Listing 2-1</A> illustrates how to use the Apple Event Manager and install an event handler to handle Section Read events. You can write similar code for Section Write events, Section Scroll events, and Section Cancel events.<A NAME=MARKER-9-286></A><P>
<B>Listing 2-1  <A NAME=MARKER-9-85></A><A NAME=MARKER-21-86></A>Accepting Section Read events and verifying if a section is registered</B><P>
<PRE>
{the following goes in your initialization code}
myErr := AEInstallEventHandler(sectionEventMsgClass {'sect'},
                               sectionReadMsgID {'read'},
                               @MyHandleSectionReadEvent, 0,
                               FALSE);

{this is the routine the Apple Event Manager calls when a }
{ Section Read event arrives}

FUNCTION MyHandleSectionReadEvent(theAppleEvent,
                                  reply: AppleEvent;
                                  refCon: LongInt): OSErr;
VAR
   myErr:      OSErr;
   sectionH:   SectionHandle;
BEGIN
   {get section handle out of Apple event message buffer}
   myErr := MyGetSectionHandleFromEvent(theAppleEvent, sectionH);
   IF myErr = noErr THEN
   BEGIN
      IF IsRegisteredSection(sectionH) = noErr THEN
         {if section is registered, read the new data}
         MyHandleSectionReadEvent := DoSectionRead(sectionH);
   END 
   ELSE
      MyHandleSectionReadEvent := myErr;
END; {MyHandleSectionReadEvent}


{this routine reads in subscriber data and updates its display}
FUNCTION DoSectionRead(subscriber: SectionHandle): OSErr;
BEGIN
   {your code here}
END;  {DoSectionRead}
{this is part of your Apple event-handling code}
FUNCTION MyGetSectionHandleFromEvent(theAppleEvent: AppleEvent;
                                     VAR sectionH: SectionHandle)
                                     : OSErr;
VAR
   ignoreType:    DescType;
   ignoreSize:    Size;
BEGIN
   {parse section handle out of message buffer}
   MyGetSectionHandleFromEvent
      := AEGetParamPtr( theAppleEvent,    {event to parse}
                        keyDirectObject,  {look for direct }
                                          { object}
                        typeSectionH,     {want a SectionHandle}
                        ignoreType,       {ignore type it could }
                                          { get}
                        @sectionH,        {put SectionHandle }
                                          { here}
                        SizeOf(sectionH), {size of storage for }
                                          { SectionHandle}
                        ignoreSize);      {ignore storage it }
                                          { used}
END; {MyGetSectionHandleFromEvent} 
</PRE>
 In addition to the Section Read, Section Write, Section Cancel, and Section Scroll events, your application can also respond to the Create Publisher event. For more information on this event, as well as additional information on how to handle Apple events, see the chapter "Responding to Apple Events" in this book. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
