<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Obtaining Data From a Print File(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING319></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-318.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-320.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-306.html"><B>Chapter 7 - QuickDraw GX Stream Format</B></A> / <A HREF="GXEnvironment-316.html"><B>Using QuickDraw GX Stream Format</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING319-0></A>
<H2><A NAME=MARKER-9-128></A>Obtaining Data From a Print File</H2>
 Any suitably equipped Macintosh computer with QuickDraw GX installed can read and print <A NAME=MARKER-2-129></A>portable digital document print files created by your application. You may want to use the public data in a QuickDraw GX print file for other purposes. <A HREF=#MARKER-9-130>Listing 7-11</A> reads a portable digital document print file and returns the page count. For more information on print files and portable digital documents, see the chapters "Introduction to QuickDraw GX Printing" and "Core Printing Features" of <I><A HREF="../../GXPrinting/GXPrinting-2.html">Inside Macintosh: QuickDraw GX Printing</A></I>. <P>
<B>Listing 7-11  <A NAME=MARKER-9-130></A>Obtaining the page count from a portable digital document print file</B><P>
<PRE>
#define nrequire( x, LABEL ) if((x)) goto LABEL
   
/* Returns the page count from an open print file */
   
   Parameters:-&gt; short dataRefNum:reference to the spool file
                    &lt;- long *pageCount:returns page count
   Returns:    OSErr
   Preconditions:dataRefNum != NULL
   Postconditions:none */

OSErr DespoolPageCount (short dataRefNum, long *pageCount);
OSErr DespoolPageCount (short dataRefNum, long *pageCount) {

   register OSErr anErr;
            long pageDirOffset, numPages;
            long dataLen;
/* position to read offset to page directory */
   anErr = SetFPos(dataRefNum, fsFromStart, (long) (kHeaderSize + 
sizeof(long)));
   nrequire (anErr, SetPageDirOffsetPos);
   
   /* read offset to page directory */
   dataLen = sizeof(pageDirOffset);
   anErr = FSRead(dataRefNum, &amp;dataLen, &amp;pageDirOffset);
   nrequire (anErr, ReadPageDirOffsetPos);
   
/* move to page directory */
   anErr = SetFPos(dataRefNum, fsFromStart, (long) (pageDirOffset));
   nrequire (anErr, SetPageDirPos);
   
/* read number of pages */
   dataLen = sizeof(numPages);
   anErr = FSRead(dataRefNum, &amp;dataLen, &amp;numPages);
   nrequire (anErr, ReadNumPages);
   
   *pageCount = numPages;/* Return the result */
   
   ncheck (anErr);
   return anErr;

/* exception handling*/
ReadNumPages:
SetPageDirPos:
ReadPageDirOffsetPos:
SetPageDirOffsetPos:
   return anErr;
}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-318.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-320.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
