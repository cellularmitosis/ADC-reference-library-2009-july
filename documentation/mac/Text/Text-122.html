<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>TECustomHook(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING122></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-121.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-123.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-40.html"><B>Chapter 2 - TextEdit</B></A> / <A HREF="Text-56.html"><B>TextEdit Reference</B></A><BR><DL><DD><A HREF="Text-67.html"><B>Routines</B></A> / <A HREF="Text-121.html"><B>Customizing TextEdit</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING122-0></A>
<H3><A NAME=MARKER-9-553></A><A NAME=MARKER-21-554></A>TECustomHook</H3>
 The <A NAME=MARKER-2-261></A><CODE>TECustomHook</CODE> procedure replaces a default TextEdit hook routine with a customized routine and returns the address of the replaced routine.<P>
<PRE>
PROCEDURE TECustomHook (which: TEIntHook; VAR addr: ProcPtr; 
                        hTE: TEHandle);
</PRE>
<DL>
<DT><CODE>which</CODE>
<DD> The hook whose default routine is to be replaced.
<DT><CODE>addr</CODE>
<DD> On input, the address of your customized procedure.
<DT>
<DD> On output, the <CODE>addr</CODE> parameter contains the address of the routine that was previously installed in the field identified by the <CODE>which</CODE> parameter. This address is returned so that you can daisy-chain routines.
<DT><CODE>hTE</CODE>
<DD> A handle to the edit record to be modified.
</DL>
<A NAME=HEADING122-7></A>
<H5>DESCRIPTION</H5>
 The <CODE>TECustomHook</CODE> procedure lets you alter the behavior of TextEdit to better suit your application's requirements and those of the script systems installed. If you replace a default hook routine with a customized version that you write in a high-level language, such as Pascal or C, you need to provide assembly-language glue code that utilizes the registers for your high-level language routine. The register contents for each of the hook routines are described in this section under "Assembly-Language Information."<P>
 The end-of-line hook, width measurement hook, new width measurement hook, text width measurement hook, draw hook. and hit test hook fields are hook fields in the TextEdit dispatch record. The <CODE>which</CODE> parameter identifies the hook whose default routine is to be replaced; you use the following constants to specify a value for this parameter.
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Constant<TH>Value<TH>Description<TR>
<TD><A NAME=MARKER-2-46></A><CODE>intEOLHook</CODE><TD>0<TD>End-of-line hook<TR>
<TD><A NAME=MARKER-2-47></A>intDrawHoo<CODE>k</CODE><TD>1<TD>Draw hook<TR>
<TD><A NAME=MARKER-2-247></A>intWidthHoo<CODE>k</CODE><TD>2<TD>Width measurement hook <TR>
<TD><A NAME=MARKER-2-250></A>intHitTestHoo<CODE>k</CODE><TD>3<TD>Hit test hook<TR>
<TD><A NAME=MARKER-2-252></A>intNWidthHoo<CODE>k</CODE><TD>6<TD>New width measurement hook <TR>
<TD><A NAME=MARKER-2-131></A>intTextWidthHoo<CODE>k</CODE><TD>7<TD>Text width measurement hook (low-memory global width measurement hook) </TABLE>
<P>
<A NAME=HEADING122-10></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The end-of-line hook, width measurement hook, new width measurement hook, text width measurement hook, draw hook, and hit test hook fields are hook fields in the TextEdit dispatch record. When you use <CODE>TECustomHook</CODE> to replace the default routines installed in these hook fields with customized ones, remember that the replacement routine must preserve all registers except those specified as containing return values.<P>
<A NAME=HEADING122-12></A>
<H4><A NAME=MARKER-2-556></A>End-of-Line Hook Registers</H4>
 You specify the <CODE>intEOLHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the end-of-line hook routine as the one you want to replace. This hook routine determines whether an incoming character is an end-of-line character. It tests the character, sets the appropriate status flags in the status register, and returns. The default action is to compare the character with $0D (a carriage return).
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Character to compare (byte)<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>Z<TD> (Zero) flag in the status register clear if end-of-line character; set otherwise.</TABLE>
<P>
<A NAME=HEADING122-14></A>
<H4><A NAME=MARKER-2-545></A>Draw Hook Registers</H4>
 You specify the <CODE>intDrawHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the drawing hook routine as the one you want to replace. The draw hook routine is called any time the components of a line are drawn. The appropriate font, style, and size characteristics have already been set into the current port by the time this routine is called. By default, the address of the QuickDraw <CODE>DrawText</CODE> procedure is stored in the draw hook field.<P>
 If your application is using outline (TrueType) fonts, TextEdit has also set the <CODE>preserveGlyph</CODE> parameter of the Font Manager's <A NAME=MARKER-2-256></A><CODE>SetPreserveGlyph</CODE> procedure to <CODE>FALSE</CODE>, so your customized hook procedure may need to reset this parameter if your application depends on it.<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Offset into text (word)<TR>
<TD>D1<TD>Length of text to draw (word)<TR>
<TD>A0<TD>Pointer to text to draw<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>
</CODE><P>
<A NAME=HEADING122-17></A>
<H4>Width Measurement Hook <A NAME=MARKER-2-559></A>Registers</H4>
 You specify the <CODE>intWidthHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the width measurement hook routine as the one you want to replace. The width measurement hook routine measures portions of a line of text. It is used when only the Roman script system is installed and the field contains the address of a customized routine. It is supported for backward compatibility. In all other cases, when more than one script system is installed or when the width measurement hook field has not been customized, TextEdit calls the routine whose address is installed in the new width measurement hook field.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Length (in bytes) of text to measure (word)<TR>
<TD>D1<TD>First byte of text to measure (word)<TR>
<TD>A0<TD>Pointer to text buffer<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>
<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D1<TD>Pixel width of measured text (word)</TABLE>
</CODE><P>
<A NAME=HEADING122-19></A>
<H4><A NAME=MARKER-9-560></A><A NAME=MARKER-2-536></A>Hit Test Hook Registers</H4>
 You specify the <CODE>intHitTestHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the hit test hook routine as the one you want to replace. The hit test hook routine determines the glyph position in a line given the pixel width from the left edge of the view rectangle. For system software before System 7, the default action is to call the QuickDraw <CODE>TextWidth</CODE> function to determine if the pixel width of the measured text is greater than the input width. If it is, then the hit test hook routine calls the QuickDraw <CODE>PixelToChar</CODE> function and returns. For System 7, the default action is to call the QuickDraw <CODE>PixelToChar</CODE> function.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Length of text block (style run) to measure (word)<TR>
<TD>D1<TD>Pixel width from start of text block (word)<TR>
<TD>D2<TD>Slop (should equal 0) (word)<TR>
<TD>A0<TD>Pointer to start of text block<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D0<TD>Pixel width to character offset in text block <BR>(low word)<P>A Boolean that is <CODE>TRUE</CODE> if a character offset corresponding to the given pixel width was found (high word). Otherwise, <CODE>FALSE</CODE>.<TR>
<TD>D1<TD>Character offset (word)<TR>
<TD>D2<TD>A Boolean that is <CODE>TRUE</CODE> if the pixel width falls within the leading edge of the character (low word). Otherwise, <CODE>FALSE</CODE>.<P>TextEdit also uses the least significant bit of the high word. If the hit test hook routine calls <CODE>PixelToChar</CODE>, TextEdit sets this bit. If it uses <CODE>TextWidth</CODE>, TextEdit clears this bit. Your customized routine needs to do the same if you call either <CODE>PixelToCha</CODE>r or <CODE>TextWidth</CODE> (high word). See the chapter "QuickDraw Text" in this book for more about these routines.</TABLE>
<P>
<DL>
<DT><B>Note</B>
<DD>In earlier versions of TextEdit, the value in register D2 on entry was not always used. If you daisy-chain in a routine and then call <CODE>the</CODE> hit test hook routine, D2 must be 0 (on entry).<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING122-22></A>
<H4>New Width Measurement Hook Registers</H4>
 You specify the <CODE>intNWidthHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the new width measurement hook routine as the one you want to replace. The new width measurement hook routine measures portions of a line of text when a non-Roman script system is installed. It is also used when only a Roman script system is installed and the width hook field does not contain the address of a customized routine. The default procedure calls <CODE>CharToPixel</CODE> or <CODE>TextWidth</CODE>, depending on the primary line direction. The appropriate font, style, and size characteristics have already been set into the current graphics port by the time this routine is called.<P>
 The new width measurement hook routine is called to measure text for both Roman and non-Roman script systems, so make sure that your customized routine is script-aware.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Overall style run length, bounded by the line end (word)<TR>
<TD>D1<TD>Offset position within style run on the current line (word)<TR>
<TD>D2<TD>Slop (low word); direction flag (high word)<TR>
<TD>A0<TD>Pointer to text buffer<TR>
<TD>A2<TD>Pointer to current line start (from TextEdit's <CODE>lineStarts</CODE> array)<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>
<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D1<TD>Pixel width of measured text (word)</TABLE>
</CODE><P>
<A NAME=HEADING122-25></A>
<H4><A NAME=MARKER-2-562></A>Text Width Measurement Hook Registers</H4>
 You specify the <CODE>intTextWidthHook</CODE> constant as the value of the <CODE>which</CODE> parameter to identify the low-memory global text width measurement hook routine as the one you want to replace. By default, this hook field contains the address of the QuickDraw <CODE>TextWidth</CODE> function and provides a way to replace TextEdit's use of <CODE>TextWidth</CODE>. The new width measurement hook routine uses the routine whose address is installed in this field.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>Length (in bytes) of text to be measured (word)<TR>
<TD>D1<TD>Offset in text of first byte to measure (word)<TR>
<TD>A0<TD>Pointer to text to measure<TR>
<TD>A3<TD>Pointer to the edit record<TR>
<TD>A4<TD>Locked handle to the edit record</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D1<TD>Pixel width of measured text (word)</TABLE>
<P>
<A NAME=HEADING122-27></A>
<H5>SEE ALSO</H5>
 For more information about the <CODE>SetPreserveGlyph</CODE> procedure, see the chapter "Font Manager" in this book. For more information about <CODE>DrawText</CODE>, <CODE>TextWidth</CODE>, <CODE>PixelToChar</CODE>, and <CODE>CharToPixel</CODE>, see the chapter "QuickDraw Text" in this book.<P>
<A NAME=HEADING122-29></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Take the following precautions if you replace a default routine:<P>
<UL>
<LI>Before placing the address of your routine in the TextEdit dispatch record, strip the addresses, using the Operating System Utilities <CODE>StripAddress</CODE> function, to guarantee that your application is 32-bit clean. For more information, see <I><A HREF="../OSUtilities/OSUtilities-2.html">Inside Macintosh: Operating System Utilities</A></I>.
<LI>Before replacing a TextEdit routine with a customized one, determine whether more than one script system is installed, and, if so, ensure that your customized routine accommodates all of the installed script systems. This avoids the problem of your customized routine producing results that are incompatible with the Script Manager.
<LI>When you use assembly language, note that all registers must be preserved except those specified as containing return values. Registers A3 contains a pointer to the edit record and Register A4 contains a handle to it. You can obtain line start positions from the <CODE>lineStarts</CODE> array in the edit record. Register A5 is always valid. Refer to <CODE>TECustomHook</CODE> in the "TextEdit Reference" section for complete coverage of the register content requirements for all hook routines.<A NAME=MARKER-2-330></A><P>
</UL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-121.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-123.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
