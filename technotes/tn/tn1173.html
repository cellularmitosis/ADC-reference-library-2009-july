<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1173: Understanding Open Transport Asset Tracking</title>    <meta name="keywords" content="Open Transport asset client programming interface providers memory"><meta name="categories" content="Networking"><meta name="week-posted" content="Oct 30, 2000 - Nov 3, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003012" title="Understanding Open Transport Asset Tracking"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/idxCarbon-date.html" target="_blank">Networking > Carbon</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1173</div>
<div id="pageheadsub">Understanding Open Transport Asset Tracking</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>            <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc -->         <P id = "menutext"><A HREF="#GoalsAndProblems">Goals and Problems</A><BR><BR><A HREF="#TheOriginalSolution">The Original Solution</A><BR><BR><A HREF="#TheCarbonSolution">The Carbon Solution</A><BR><BR><A HREF="#BackToTheFuture">Back to the Future</A><BR><BR><A HREF="#Summary">Summary</A><BR><BR><A HREF="#Changes">Change History</A><BR><BR><A HREF = "#References">References</A><br><br><A HREF = "#Downloads">Downloadables</A></p> <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">	This                  Technote describes how Open Transport tracks                  assets, like memory and providers, which it                  allocates on your behalf. Open Transport's approach                  to asset tracking was poorly documented in the                  past, and that contributed to a number of common                  developer programming errors.			</p>			<p id="introtext">				This technote describes the asset tracking                  mechanism used for the existing Open Transport                  programming interface, and how that mechanism has                  been "tuned up" for Carbon.			</p>			<p id="introtext">				This Technote is directed at all programmers who                  use the Open Transport client programming                  interface. </p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Sep 20 1999]</h3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content -->                  <P><A NAME=GoalsAndProblems></A></P>                                    <H2>Goals and Problems</H2>                  <P>Open Transport regularly allocates assets onyour behalf. For example, every time you open anendpoint, Open Transport creates an internal datastructure to hold the state of that endpoint.Whenever Open Transport allocates an asset, itassociates the asset with the particular clientthat allocated it, so when the client terminates,Open Transport can clean up the assets itallocated.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>         In the context of this and other Open         Transport technotes, "client" refers to         some program that uses the standard Open         Transport programming interface, not to         the client in a client/server         protocol.</P>  </TD></TR></TABLE></CENTER><BR><BR>   <P>Open Transport tracks two important classes ofassets, providers (endpoints, mappers, serviceproviders) and memory (allocated by<CODE>OTAllocMem</CODE> and <CODE>OTAlloc</CODE>).Open Transport also has infrastructure to trackdeferred tasks, system tasks, timer tasks, and rawstreams, although these assets are not actuallytracked by the current Open Transportimplementation on traditional Mac OS.</P><P>Other parts of Mac OS implement variousdifferent asset tracking schemes:</P><UL>   <LI>Most assets are tracked by process. When   such an asset is allocated, it is tagged as   belonging to the process that was running at the   time (as returned by   <CODE>GetCurrentProcess</CODE>). This approach   is used for assets such as windows, resource   maps, file reference numbers, serial ports (when   a serial port arbitrator is installed), and   temporary memory.</LI>      <LI>Other assets are tracked by heap zone. When   such an asset is allocated, it is tagged as   belonging to the current heap (the value   returned by <CODE>GetZone</CODE>). This approach   is used for assets such as code fragment   connections and component instances.</LI>      <LI>Some assets are not tracked at all. For   example, the system does not track who opened a   device driver (except serial ports).   Consequently, the classic networking stack,   which was replaced by Open Transport, did not do   any asset tracking.</LI></UL><P>Unfortunately, Open Transport cannot use any ofthe asset tracking schemes described above. TheOpen Transport programming interface is typicallycalled at deferred task time, and tracking assetsby the current process or heap zone does not makesense at deferred task time.</P><P>For example, imagine that your application calls<CODE>OTAllocMem</CODE> from a deferred task. Thedeferred task might run while the Finder is thecurrent application. If Open Transport trackedassets based on the current process, it woulderroneously think that the Finder allocated thismemory.</P><P>Because of these problems, Open Transport 1.0introduced a new asset tracking mechanism, which is<A HREF="#TheOriginalSolution">described in thenext section</A>. However, this mechanism provedsomewhat confusing to developers, so <A HREF="#TheCarbonSolution">Carbon</A>introduces a much clearer mechanism, based onexplicit contexts.</P>         <BR><P><A HREF="#top">Back to top</A></P>                 <P><A NAME=TheOriginalSolution></A></P><H2>The Original Solution</H2><P>This section describes how Open Transport tracksassets for pre-Carbon clients, and the rules youshould follow when building pre-Carbonsoftware.</P><H3>The Basics</H3><P>Open Transport tracks assets for pre-Carbonclients by means of a global variable, named<CODE>__gOTClientRecord</CODE>, which is staticallylinked into your program's data section (A5 worldfor 68K code). When you call an Open Transportasset-creation routine, you are actually calling astatically linked stub, which in turn calls a real,dynamically linked variant of the routine. Thisdynamically linked routine, whose name ends in"Priv", has as an extra parameter which is theaddress of the client record.</P><P>For example, when you call<CODE>OTOpenEndpoint</CODE>, you're actuallycalling the statically linked stub shown below.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>// Prototype of dynamically linked routine.&nbsp;extern pascal EndpointRef OTOpenEndpointPriv(              OTConfiguration* config,              OTOpenFlags oflag,              TEndpointInfo* info,              OSStatus* err,              OTClientRecord *client);&nbsp;// Statically linked stub routine which is linked into your program.&nbsp;extern pascal EndpointRef OTOpenEndpoint(              OTConfiguration* config,              OTOpenFlags oflag,              TEndpointInfo* info,              OSStatus* err){    return OTOpenEndpointPriv(config, oflag, info, err, &amp;__gOTClientRecord);}</pre></TD></TR></TABLE></CENTER><BR><BR>     <P>The "Priv" routine is the real entry point intothe operating system, exported by the OpenTransport shared libraries. Open Transport uses theaddress of the client record to uniquely identifythe client creating the asset, and tags the assetas belonging to that client. When the clientterminates (either it calls<CODE>CloseOpenTransport</CODE> or an applicationclient terminates unexpectedly, <A HREF="#ApplicationsVersusExtensions">seebelow</A>), Open Transport disposes of any assetsthe client "leaked."</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>         The contents of the         <CODE>__gOTClientRecord</CODE> variable         are private to Open Transport. You should         not modify this variable, or depend on its         value.</P></TD></TR></TABLE></CENTER><BR><BR>     <P>The <CODE>__gOTClientRecord</CODE> and thestatically linked stub routines are obtained from astatic object file to which you link your program.For PowerPC software, this file is an XCOFF objectfile whose name ends with "PPC.o". A typicalPowerPC program links with this static object file,containing the client record and the stub routines(for application clients, this is"OpenTransportAppPPC.o"), and a CFM stub library("OpenTransportLib"), which references thedynamically linked asset-creation "Priv" routinesand other, non-asset creation, routines.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>         For more information about linking with         Open Transport libraries, see DTS Q&amp;A         NW 18 <a href="../../qa/nw/nw18.html">Open         Transport Libraries</A>.</P>         </TD></TR></TABLE></CENTER><BR><BR>      <H3><A NAME=ApplicationsVersusExtensions></A>Applicationsversus Extensions</H3><P>To further complicate matters, Open Transporthas two sets of static object files. The set whosename contains "App" is only suitable forapplications, while the set whose name contains"Extn" is suitable for other, non-application code(system extensions, shared libraries, MPW tools,and so on). Your choice of libraries affects thefollowing.</P><UL>   <LI>Automatic Cleanup - If you link to the "App"   libraries, Open Transport will patch   <CODE>_ExitToShell</CODE> to automatically call   <CODE>CloseOpenTransport</CODE> for you (if you   haven't) when you application quits.</LI>      <LI>Client Pool - If you link with the "App"   libraries, your client pool is located in the   application zone. If you link with the "Extn"   libraries, your client pool is located in the   system zone. See DTS Technote 1128 <A HREF="tn1128.html">Understanding   Open Transport Memory Management</A> for details   on client pools.</LI></UL><H3>Rules for Clients</H3><P>Open Transport's asset tracking strategy has anumber of important consequences fordevelopers.</P><UL>   <LI>You must call <CODE>InitOpenTransport</CODE>   once (and only once) for each global data   section (A5 world for 68K) you have. If you have   an application and a shared library, both of   which need to create endpoints, you must call   <CODE>InitOpenTransport</CODE> once for the   application and once for the shared   library.</LI>      <LI>If you are writing non-application code, you   must remember to call   <CODE>CloseOpenTransport</CODE> before your   global data section unloads. If you're writing   an application, Open Transport's   <CODE>_ExitToShell</CODE> patch should clean up   automatically for you, however DTS recommends   that your application not rely on this safety   net in the typical case. In general, you should   call <CODE>CloseOpenTransport</CODE> once for   each time you've called   <CODE>InitOpenTransport</CODE>.</LI>      <LI>If you are writing a 68K code resource that   calls Open Transport, it is vital that you have   a valid A5 (or global) world. This is because   the Open Transport client record is a global   variable allocated in your code resource's A5   world. The Open Transport libraries   (specifically "OpenTransport.o" and   "OpenTransportExtn.o") reference this variable   using A5-relative addresses. An A4 "global   world" (as used by Metrowerks and Symantec   compilers) is not sufficient.<BR>      <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>            If you are using the Metrowerks            CodeWarrior environment to build a code            resource that calls Open Transport, you            should base it on the <A HREF="ftp://ftp.apple.com/developer/Sample_Code/Networking/OTCodeResource.sit">OTCodeResource</A>            sample, which shows how to use Open            Transport's A5-based libraries in an            A4-based code resource. It is important            that you use version 1.0.1b1 (or later)            of this sample. Earlier versions had a            crashing bug.</P>     </TD></TR></TABLE></CENTER><BR><BR>      </LI>      <LI>A code resource cannot "borrow" the A5 world   from its host application when calling Open   Transport. This technique, which is commonly   used by plug-ins that need to call QuickDraw, is   not possible for Open Transport clients because   there's no guarantee that the host application   has an Open Transport client record. Even if it   does, there's no way to find the offset of the   client record in the host's data section.</LI>      <LI>If you transfer providers from one Open   Transport client to another (from a shared   library to your application, say, or between   applications), you must call   <CODE>OTTransferProviderOwnership</CODE> to   ensure that Open Transport knows that the   provider now belongs to the new client.   Otherwise, when the previous owner calls   <CODE>CloseOpenTransport</CODE>, Open Transport   will clean up the provider from underneath   you.</LI>      <LI>Any non-application code should use the   "Extn" libraries. When deciding which libraries   to link with, you should ask yourself "Do I want   my connection to Open Transport to be cleaned up   automatically when <CODE>_ExitToShell</CODE> is   called?" and "Are my global variables guaranteed   to be around when <CODE>_ExitToShell</CODE> is   called?" If both answers are "Yes," use the   "App" libraries, otherwise use the "Extn"   libraries.</LI>      <LI>When debugging Open Transport programs in   MacsBug, you will not be able to find symbols   for the stub routines. For example, you won't be   able to put a transition vector break on   "InitOpenTransport"; you should put it on   "InitOpenTransportPriv" instead.</LI></UL><H3><A NAME=TrackedAssets></A>Tracked Assets</H3><P>The follow table shows exactly which routinesare have "Priv" variants. Except as noted below,the assets created by these routines are tracked byOpen Transport and will be disposed of when theclient calls <CODE>CloseOpenTransport</CODE>.</P><TABLE BORDER=1>   <TR>      <td valign=top width=180 align=left>         <P><B>Initialization and         Termination</B></P>      </TD>      <td width=280 align=left>         <P><CODE>InitOpenTransport<BR>         CloseOpenTransport<BR>         OTRegisterAsClient<BR>         OTUnregisterAsClient<BR>         OTTransferOwnership</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Memory</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTAllocMem<BR>         OTAlloc<BR>         OTFreeMem (1)<BR>         t_alloc</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Provider Open and Close</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTOpenEndpoint<BR>         OTAsyncOpenEndpoint<BR>         OTOpenAppleTalkServices<BR>         OTAsyncOpenAppleTalkServices<BR>         OTOpenInternetServices<BR>         OTAsyncOpenInternetServices<BR>         OTOpenMapper<BR>         OTAsyncOpenMapper<BR>         OTOpenProvider<BR>         OTAsyncOpenProvider<BR>         OTCloseProvider<BR>         t_open<BR>         t_close</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Raw Stream Open and Close</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTStreamOpen (2)<BR>         OTAsyncStreamOpen (2)<BR>         OTOpenEndpointOnStream (2)<BR>         OTOpenProviderOnStream (2)<BR>         OTStreamPipe (2)<BR>         stream_open (2)<BR>         stream_pipe (2)</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Task Creation</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTCreateDeferredTask (2)<BR>         OTCreateSystemTask (2)</CODE></P>      </TD>   </TR></TABLE><P><B>Notes:</B></P><OL>   <LI><CODE>OTFreeMemPriv</CODE> is only exported   for the benefit of clients linked with the Open   Transport 1.1 and earlier libraries. Clients   linked with the Open Transport 1.1.1 and higher   libraries will call directly into a dynamically   linked version of <CODE>OTFreeMem</CODE> which   automatically works out which client allocated   the memory.</LI>      <LI>These routines have "Priv" variants so that   a future version of Open Transport can track   their assets. The assets created by these   routines are not tracked by current versions of   Open Transport.</LI></OL>                                <BR><P><A HREF="#top">Back to top</A></P>                 <P><A NAME=TheCarbonSolution></A></P><H2>The Carbon Solution</H2><P>The original solution to the Open Transportasset tracking problem was creative, but it has anumber of problems.</P><UL>   <LI>Lack of Understanding - The original   solution was poorly documented and therefore   badly understood, which resulted in many asset   tracking related crashes. For example, linking a   code resource with the "App" libraries will   cause a crash when the host application quits,   as Open Transport's <CODE>_ExitToShell</CODE>   patch tries to execute code that has been   unloaded.</LI>      <LI>Linker Semantics - Mac OS programmers are   not used to providing semantic content through   their choice of linker libraries. Any such   approach is inherently error prone.</LI>      <LI>Static Object Files - Alternative   development environment (Java runtimes, BASIC   implementations, Forth interpreters, C++ cross   compilers, and so on) have easy mechanisms to   provide access to CFM libraries. However, Open   Transport's static object files - in MPW   <CODE>'OBJ '</CODE> format for 68K or XCOFF   format for PowerPC - present serious   difficulties for anyone using these alternative   environments.</LI></UL><P>To address these problems - especially theproblems with static object files - the designersof Carbon chose to restructure the Open Transportprogramming interface for Carbon programs. Thisminor update, which is in line with the general"tune up" goal of Carbon, is described in the nextsection.</P><H3>The Basics</H3><P>The Open Transport programming interface forCarbon programs makes the client record an explicitparameter to the routines which need it. Forexample, rather than call<CODE>OTOpenEndpoint</CODE>, in Carbon you mustcall <CODE>OTOpenEndpointInContext</CODE>. Thisroutine takes an addition parameter of type<CODE>OTClientContextPtr</CODE>, which representsthe client which is opening the endpoint.</P><P>Your program must create an Open Transportcontext explicitly by calling<CODE>InitOpenTransportInContext</CODE>. Thisroutine, whose prototype is shown below, takes twoparameters. You use the first parameter toexplicitly tell Open Transport whether you are anapplication or extension client. The secondparameter returns the client context pointer, whichyou must pass to other asset-creation routines.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>extern pascal OSStatus InitOpenTransportInContext(          OTInitializationFlags flags,          OTClientContextPtr *outClientContext);</pre></TD></TR></TABLE></CENTER><BR><BR>    <P><A NAME=AppContext></A>Carbon also includes theconcept of a default application context. If youpass<CODE>kInitOTForApplicationMask</CODE>to the <CODE>flags</CODE> parameter of<CODE>InitOpenTransportInContext</CODE>, youinitialize this default application context. Fromthere on, you can pass <CODE>nil</CODE> to any"InContext" routine to tell it to act in thisdefault context.</P><P>Finally, to help application developers maintainsource code compatibility between their Carbon andpre-Carbon source bases, the Carbon designersintroduced a set of macros that map the pre-Carbonroutines to their Carbon equivalents. For example,the following macro allows you to open an endpointunder Carbon without changing your pre-Carbonsource.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>#define OTOpenEndpoint(config, oflag, info, err) \        OTOpenEndpointInContext(config, oflag, info, err, NULL)</pre></TD></TR></TABLE></CENTER><BR><BR>   <P>To access these macros, you must define the<CODE>OTCARBONAPPLICATION</CODE> compile-timevariable. These macros are only suitable forapplication developers because they always use thedefault application context. Shared libraries mustalways use the "InContext" routines.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left>         <P><B>Note:</B><BR>         The macro for InitOpenTransport is shown         below.</P>         </TD></TR></TABLE></CENTER>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>#define InitOpenTransport() \        InitOpenTransportInContext(kInitOTForApplicationMask, NULL)</pre></TD></TR></TABLE></CENTER><BR><BR>                                <P>This macro         assumes that it is safe to pass NULL to         the <CODE>outClientContext</CODE>         parameter. This is true for all versions         of the API except:</P>                  <UL>            <LI>CarbonLib            1.0.1 and earlier</LI>                        <LI>OTClassicContext            (<A HREF="#BackToTheFuture">see            below</A>)            1.0b3 and earler</LI>         </UL>                  <P>If your         application supports these environments         you should initialize Open Transport with         the following code to avoid a write to         NULL.</P>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>{    OTClientContextPtr junkClientContext;    err = InitOpenTransportInContext(kInitOTForApplicationMask, &amp;junkClientContext);}</pre></TD></TR></TABLE></CENTER><BR><BR>             <H3>Tracked Assets In Carbon</H3><P>The follow table shows exactly which routinesare "InContext" under Carbon. Except as notedbelow, the assets created by these routines aretracked by Open Transport and will be disposed ofwhen the client calls<CODE>CloseOpenTransportInContext</CODE>. This listis significantly shorter than the list of "Priv"routines <A HREF="#TrackedAssets">given earlier</A>because Carbon does not support many low-level OpenTransport routines.</P><TABLE BORDER=1>   <TR>      <td valign=top width=180 align=left>         <P><B>Initialization and         Termination</B></P>      </TD>      <td width=280 align=left>         <P><CODE>InitOpenTransportInContext<BR>         CloseOpenTransportInContext</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Memory</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTAllocMemInContext<BR>         OTAllocInContext</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Provider Open and Close</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTOpenEndpointInContext<BR>         OTAsyncOpenEndpointInContext<BR>         OTOpenMapperInContext<BR>         OTAsyncOpenMapperInContext<BR>         OTOpenAppleTalkServicesInContext<BR>         OTAsyncOpenAppleTalkServicesInContext<BR>         OTOpenInternetServicesInContext<BR>         OTAsyncOpenInternetServicesInContext</CODE></P>      </TD>   </TR>   <TR>      <td valign=top width=180 align=left>         <P><B>Task Creation</B></P>      </TD>      <td width=280 align=left>         <P><CODE>OTCreateDeferredTaskInContext         (1)<BR>         OTCreateTimerTaskInContext (1)</CODE></P>      </TD>   </TR></TABLE><P><B>Notes:</B></P><OL>   <LI>These assets are tracked by the Mac OS X   implementation of the Open Transport programming   interface, but are not tracked by current   versions of Open Transport on traditional Mac   OS.</LI></OL>                               <BR><P><A HREF="#top">Back to top</A></P>                 <P><A NAME=BackToTheFuture></A></P><H2>Back to the Future</H2><P>The Carbon solution to Open Transport assettracking is such a good thing that we thought you'dlike it for non-Carbon code as well. This is nowpossible, using the new "OpenTransportClientPPC.o"library. This library gives non-Carbon softwareaccess to the "InContext" Open Transport calls.</P><P>You can get the new library by downloading acopy of the DTS sample code <A href="../../samplecode/Sample_Code/Networking/OTClassicContext.htm">OTClassicContext</A>.The library will also be included in future versionof the OT SDK.</P><P>The primary advantage of using this library itthat it greatly simplifies the process ofmaintaining an Open Transport source base thatbuilds for both Carbon and non-Carbonplatforms.</P>                                <BR><P><A HREF="#top">Back to top</A></P>                 <P><A NAME=Summary></A></P><H2>Summary</H2><P>Understanding how Open Transport tracks assetsis important when writing applications, sharedlibraries, code resources, and other software thatcalls Open Transport reliably. The most importantrule for pre-Carbon clients is that you must call<CODE>InitOpenTransport</CODE> and<CODE>CloseOpenTransport</CODE> once per globaldata section. The Carbon programming interface toOpen Transport makes this requirement explicit andsimplifies the Open Transport asset trackingstory.</P>                    <a name="References"></a>   <H2>References</H2>            <p>DTS Sample Code <A href="../../samplecode/Sample_Code/Networking/OTClassicContext.htm">OTClassicContext</A></p>      <p>DTS Q&amp;A NW 18 <a href="../../qa/nw/nw18.html">Open   Transport Libraries</A></p>      <p>DTS Technote 1128 <A HREF="tn1128.html">Understanding   Open Transport Memory Management</A></p>      <p><a href="../../documentation/mac/NetworkingOT/NetworkingWOT-2.html">Inside   Macintosh: Networking with Open   Transport</A></p>      <p>DTS Sample Code <A HREF="ftp://ftp.apple.com/developer/Sample_Code/Networking/OTCodeResource.sit">OTCodeResource</A></p>      <p><a href="../../documentation/Carbon/CarbonSpecification/CarbonSpecTOC.html">Carbon   Specification</A></p>      <p>DTS Q&amp;A NW 36 <a href="../../qa/nw/nw36.html">Calling   CloseOpenTransport When Writing an   Application</A></p><a name="Changes"></a><H2>Change History</H2>                                   <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-August-1999</P>               </TD>               <td align="left">                  <P>First released.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-October-2000</P>               </TD>               <td align="left">                  <P>Added the <A HREF="#BackToTheFuture"> Back tothe Future</A> section.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>03-November-2000</P>               </TD>               <td align="left">                  <P>Corrected the discussionabout <A HREF="#AppContext">initializingthe applicationcontext</A> anddocumented a bug in CarbonLib 1.0 andOTClassicContext 1.0b3.</P>               </TD>            </TR>             </TABLE>         <BR><P><A HREF="#top">Back to top</A></P><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (72K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn1173.pdf">Download</A></P></TD>  </TR> </table></center>  <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1173.html%3Fid%3DDTS10003012-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1173.html%3Fid%3DDTS10003012-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1173.html%3Fid%3DDTS10003012-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>