<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note QD04: Colorizing With CopyBits</title><meta name="keywords" content="Mac OS 8 QuickDraw CopyBits CopyMask bizarre colorizing background foreground"><meta name="Description" content="Technical Note QD04: This Technical Note details some ofthe bizarre coloring effects which may occur if CopyBitsand CopyMask are used unexpectedly. An example of using thesefunctions unexpectedly is calling them when the backgroundand foreground colors are not black and white.">                                       <meta name="categories" content="QuickDraw"><meta name="week-posted" content="Oct 26, 1987 - Nov 6, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002717" title="Colorizing With CopyBits"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QD04</div>
<div id="pageheadsub">Colorizing With CopyBits</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">What Happens</A><BR><BR><A HREF="#Section2">Possible Problems</A><BR><BR><A HREF="#Section3">How To Colorize - An Example</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext"><i>Inside Macintosh Volume V</i> states that the foreground and background colorsare applied to an image during a <code>CopyBits</code> or <code>CopyMask</code> call.Accidental use of this feature can create bizarre coloring effects. This noteexplains what happens, how to avoid problems, and how to use it.   </p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Nov 01 1987]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><H2>What Happens</h2><p>Color QuickDraw has a feature that will allow you to convert a monochrome imageto a color image. During a <code>CopyBits</code> or <code>CopyMask</code> call, if theforeground and background colors are not black and white, respectively, ColorQuickDraw performs the following operation on every pixel being copied:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    NOTE: color table index = pixel value    s = color table index of source pixel    fg = color table index of foreground color    bg = color table index of background color    ColoredPixelValue = (NOT(s) AND bg) OR (s AND fg)</pre>	</TD></TR></TABLE></CENTER><p>If your source image contains only black and white pixels, then all blackpixels would become the foreground color and all white pixels would become thebackground color. This is because the color table index for white is all zerosand the color table index for black is all ones.</p><p>For example, suppose your source image was a 4-bit deep color <code>PixMap</code>.Then the color table index for white (in binary) is 0000 and the index forblack is 1111. And let's suppose that your foreground color is green with anindex of 1101 while your background color is red with an index of 0011. Thenfor the black pixels, the above procedure produces:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    ColoredPixelValue = (NOT(1111) AND 0011) OR (1111 AND 1101)         1101         = (  0000    AND 0011) OR (1111 AND 1101)</pre>	</TD></TR></TABLE></CENTER><p>And the operation on the white pixels yields:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    ColoredPixelValue = (NOT(0000) AND 0011) OR (0000 AND 1101)         0011         = (  1111    AND 0011) OR (0000 AND 1101)</pre>	</TD></TR></TABLE></CENTER><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><H2>Possible Problems</h2><p>This colorizing will only work on 2-color (i.e. black and white) images, andthen only if those colors occupy the first and last entries in the color table.Trying to colorize colors that are not the first and last color table entrieswill yield unexpected results.</p><p>This is mainly due to the fact that the colorizing algorithm uses a pixel'scolor table index value rather than its actual RGB color. To illustrate this,let's assume that foreground and background colors are as above, and your imagecontains yellow with a color table index of 1000. The colorizing operationwould give:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    ColoredPixelValue = (NOT(1000) AND 0011) OR (1000 AND 1101)         1011         = (  0111    AND 0011) OR (1000 AND 1101)</pre>	</TD></TR></TABLE></CENTER><p>Since the color table may have any RGB color at the resulting index position,the final color may not even be close to the source, foreground, or background colors.</p><p>Similar things occur if you are trying to colorize a black and white image whenwhite and black do not occupy the first and last positions in the color table.</p><p>The bottom line rules for <code>CopyBits</code>ing in a color environment are these:</p><ul type="circle">	<li>Thou shalt set thy background color to white and thy foreground color to black before calling <code>CopyBits</code> or <code>CopyMask</code>, unless thou art coloring a monochrome image.</li>	<li>Thou shalt, when colorizing, make sure that the first color table entry is white and the last color table entry is black.</li></ul><p>The second rule is easy to follow because the default color tables areconstructed properly, and if you are using the Palette Manager (and you are,right?) then it will make sure that the color tables obey this rule.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><H2>How To Colorize - An Example</h2><p>This code fragment shows how to implement a color fill, like the paint bucketin MacPaint. It relies on three main things: <code>SeedCFill</code> for calculatingthe fill area, <code>CopyMask</code> for actually changing the bits, and QuickDrawcolorizing.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE PaintBucket(where: Point; paintColor: RGBColor);    VAR        savedFG    : RGBColor;        offBits    : BitMap;    BEGIN        {First, create an offscreen bitmap.}        offBits.bounds := myWindow^.portRect;        WITH offBits.bounds DO BEGIN            offBits.rowBytes := ((right - left + 15) DIV 16) * 2;            offBits.baseAddr := NewPtr((bottom-top) * offBits.rowBytes);        END;        {Check MemError here! Make sure NewPtr succeeded!}        SeedCFill(myWindow^.portBits,offBits,myWindow^.portRect,            myWindow^.portRect,where.h,where.v,NIL,0);        GetForeColor(savedFG);        RGBForeColor(paintColor);        CopyMask(offBits,offBits,myWindow^.portBits,myWindow^.portRect,            myWindow^.portRect,myWindow^.portRect);        RGBForeColor(savedFG);        DisposPtr(offBits.BaseAddr);    END;</pre>	</TD></TR></TABLE></CENTER><p>The variable <code>offBits</code> is an offscreen <code>BitMap</code> (not a<code>PixMap</code>) with <code>bounds</code> = <code>myWindow^.portRect</code>.<code>SeedCFill</code> effectively creates, in the offscreen <code>BitMap</code>,  amonochrome image of the bits that we want to paint. Since <code>offBits</code>contains the exact bits that we want to paint, it is used as both the sourceimage and the mask for <code>CopyMask</code>.</p><p>By setting the foreground color to the desired paint color, the result is acolorized version of the mask (the paint area) being copied onto the window's<code>PixMap</code> without affecting any other bits.</p><P><A HREF="#top">Back to top</A></p><a name="References"></a><h2>References</h2><P>Color QuickDraw</p>         <a name="Downloads"></a>         <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qd_04.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qd/qd_04.html%3Fid%3DDTS10002717-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qd/qd_04.html%3Fid%3DDTS10002717-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qd/qd_04.html%3Fid%3DDTS10002717-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>