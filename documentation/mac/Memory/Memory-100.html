<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MoveHHi (IM: M)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING100></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Memory-99.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-101.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Memory-2.html"><B>Memory</B></A> / <BR><DD><A HREF="Memory-56.html"><B>Chapter 2 - Memory Manager</B></A> / <A HREF="Memory-60.html"><B>Memory Manager Reference</B></A><BR><DL><DD><A HREF="Memory-62.html"><B>Memory Manager Routines</B></A> / <A HREF="Memory-94.html"><B>Managing Relocatable Blocks</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING100-0></A>
<H3><A NAME=MARKER-11-374></A><A NAME=MARKER-9-375></A>MoveHHi<A NAME=MARKER-2-180></A><A NAME=MARKER-2-183></A><A NAME=MARKER-2-73></A></H3>
 If you plan to lock a relocatable block for a short period of time, use the <CODE>MoveHHi</CODE> procedure, which moves the block to the top of the heap and thus helps prevent heap fragmentation.<P>
<PRE>
PROCEDURE MoveHHi (h: Handle);
</PRE>
<DL>
<DT><CODE>h</CODE>
<DD> A handle to a relocatable block.
</DL>
<A NAME=HEADING100-4></A>
<H5>DESCRIPTION</H5>
 The <CODE>MoveHHi</CODE> procedure attempts to move the relocatable block referenced by the handle <CODE>h</CODE> upward until it reaches a nonrelocatable block, a locked relocatable block, or the top of the heap.<P>
<DL>
<DT><B>WARNING</B>
<DD>If you call <CODE>MoveHHi</CODE> to move a handle to a resource that has its <CODE>resChanged</CODE> bit set, the Resource Manager updates the resource by using the <CODE>WriteResource</CODE> procedure to write the contents of the block to disk. If you want to avoid this behavior, call the Resource Manager procedure <CODE>SetResPurge(FALSE)</CODE> before you call <CODE>MoveHHi</CODE>, and then call <CODE>SetResPurge(TRUE)</CODE> to restore the default setting.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 By using the <CODE>MoveHHi</CODE> procedure on relocatable blocks you plan to allocate for short periods of time, you help prevent islands of immovable memory from accumulating in (and thus fragmenting) the heap.<P>
 Do not use the <CODE>MoveHHi</CODE> procedure to move blocks you plan to lock for long periods of time. The <CODE>MoveHHi</CODE> procedure moves such blocks to the top of the heap, perhaps preventing other blocks already at the top of the heap from moving down once they are unlocked. Instead, use the <CODE>ReserveMem</CODE> procedure before allocating such blocks, thus keeping them in the bottom partition of the heap, where they do not prevent relocatable blocks from moving.<P>
 If you frequently lock a block for short periods of time and find that calling <CODE>MoveHHi</CODE> each time slows down your application, you might consider leaving the block always locked and calling the <CODE>ReserveMem</CODE> procedure before allocating it.<P>
 Once you move a block to the top of the heap, be sure to lock it if you do not want the Memory Manager to move it back to the middle partition as soon as it can. (The <CODE>MoveHHi</CODE> procedure cannot move locked blocks; be sure to lock blocks after, not before, calling <CODE>MoveHHi</CODE>.)<P>
<DL>
<DT><B>Note</B>
<DD>Using the <CODE>MoveHHi</CODE> procedure without taking other precautionary measures to prevent heap fragmentation is useless, because even one small nonrelocatable or locked relocatable block in the middle of the heap might prevent <CODE>MoveHHi</CODE> from moving blocks to the top of <BR>the heap.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING100-12></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Because the <CODE>MoveHHi</CODE> procedure moves memory, you should not call it at interrupt time.<P>
 Don't call <CODE>MoveHHi</CODE> on blocks in the system heap. Don't call <CODE>MoveHHi</CODE> from a desk accessory.<P>
<A NAME=HEADING100-15></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The registers on entry and exit for <CODE>MoveHHi</CODE> are
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN = LEFT colspan=2>Registers on entry<TR>
<TD>A0<TD>Handle to move</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH ALIGN = LEFT colspan=2>Registers on exit<TR>
<TD>D0<TD>Result code</TABLE>
<P>
<A NAME=HEADING100-17></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>nilHandleErr<TD>-109<TD><CODE>NIL</CODE> master pointer<TR>
<TD>memLockedErr<TD>-117<TD>Block is locked<A NAME=MARKER-2-33></A></TABLE>
</H5>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Memory-99.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-101.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Memory-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
