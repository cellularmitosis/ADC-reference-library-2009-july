<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<script language="JavaScript" src="frametest.js"></script>
<TITLE> ConvertFromUnicodeToText</TITLE><LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a>
<!-- start of header -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of header --><A HREF="TEC.82.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.85.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.87.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A><br>
<font face="Geneva,Helvetica,Arial" size="1"><b><br>
		PATH<spacer type="horizontal" size="5">&nbsp;</b></font><a href="../../../mac8.html"><font face="Geneva,Helvetica,Arial" size="1">Mac OS 8 and 9 Developer Documentation</a>  <b>&gt;</b> Text Encoding Conversion Manager<br>
		<img src="images/im_smblue.gif" width="116" height="8"><img src="images/space.gif" width="6" height="11">Programming With the Text Encoding Conversion Manager</font><br>
		<br>
		<hr>

</DIV>
<H1>
<A NAME="pgfId=7554">
 </A>
<A NAME="21458">
 </A>
ConvertFromUnicodeToText</H1>
<P>
<A NAME="pgfId=7541">
 </A>
Converts a string from Unicode to the specified encoding. </P>
<TT>
<A NAME="pgfId=26000">
 </A>
pascal OSStatus ConvertFromUnicodeToText ( <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextInfo iUnicodeToTextInfo, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iUnicodeLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConstUniCharArrayPtr iUnicodeStr,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptionBits iControlFlags, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount iOffsetCount, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset iOffsetArray[], <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount *oOffsetCount, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset oOffsetArray[], <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iOutputBufLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oInputRead, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oOutputLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogicalAddress oOutputStr);</TT>
<DL COMPACT>
<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26004">
 </A>
<TT>iUnicodeToTextInfo</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=7064">
 </A>
 A Unicode converter object of type <TT>UnicodeToTextInfo</TT> for converting text from Unicode. You use the function <A HREF="TEC.83.html" CLASS="XRef"><TT>CreateUnicodeToTextInfo</TT></A> or <A HREF="TEC.84.html" CLASS="XRef"><TT>CreateUnicodeToTextInfoByEncoding</TT></A> to obtain a Unicode converter object to specify for this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26015">
 </A>
<TT>iUnicodeLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3654">
 </A>
The length in bytes of the Unicode string to be converted. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26024">
 </A>
<TT>iUnicodeStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3655">
 </A>
A pointer to the Unicode string to be converted. If the input text is UTF-8, which is supported for versions 1.2.1 or later of the converter, you must cast the UTF-8 buffer pointer to <TT>ConstUniCharArrayPtr</TT> before you can pass it as this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26033">
 </A>
<TT>iControlFlags</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3656">
 </A>
Conversion control flags. You can use these bitmasks to set the control flags that apply to this function:<TT> kUnicodeUseFallbacksMask kUnicodeKeepInfoMask kUnicodeVerticalFormMask kUnicodeLooseMappingsMask kUnicodeStringUnterminatedMask kUnicodeForceASCIIRangeMask kUnicodeNoHalfwidthCharsMask</TT></DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26063">
 </A>
<TT>iControlFlags</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=18272">
 </A>
 			 <TT>kUnicodeDefaultDirectionMask</TT> 	 	<TT>kUnicodeLeftToRightMask</TT> 		 <TT>kUnicodeRightToLeftMask</TT></DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=3659">
 </A>
For a description of these control flags, see <A HREF="TEC.6d.html" CLASS="XRef">
Conversion Control Flags</A>
. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26081">
 </A>
<TT>iOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3662">
 </A>
The number of offsets contained in the array provided by the <TT>iOffsetArray</TT> parameter. Your application supplies this value. If you don't want offsets returned to you, specify <TT>0</TT> (zero) for this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26090">
 </A>
<TT>iOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3663">
 </A>
An array of type <TT>ByteOffset</TT>. On input, you specify the array that gives an ordered list of significant byte offsets pertaining to the Unicode source string to be converted. These offsets may identify font or style changes, for example, in the source string. If you don't want offsets returned to your application, specify <TT>NULL</TT> for this parameter and <TT>0</TT> (zero) for <TT>iOffsetCount</TT>. All offsets must be less than <TT>iUnicodeLen</TT>. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26099">
 </A>
<TT>oOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3664">
 </A>
A pointer to an <TT>ItemCount</TT>. On output, this value contains the number of offsets that were mapped in the output stream. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26108">
 </A>
<TT>oOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3665">
 </A>
An array of type <TT>ByteOffset</TT>. On output, this array contains the corresponding new offsets for the converted string in the new encoding.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26117">
 </A>
<TT>iOutputBufLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3666">
 </A>
The length in bytes of the output buffer pointed to by the <TT>oOutputStr</TT> parameter. Your application supplies this buffer to hold the returned converted string. The <TT>oOutputLen</TT> parameter may return a byte count that is less than this value if the converted byte string is smaller than the buffer size you allocated.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26126">
 </A>
<TT>oInputRead</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3667">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value gives the number of bytes of the Unicode string that were converted. If the function returns a <TT>kTECUnmappableElementErr</TT> result code, this parameter returns the number of bytes that were converted before the error occurred. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26135">
 </A>
<TT>oOutputLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3668">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value give the length in bytes of the converted text stream. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26144">
 </A>
<TT>oOutputStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=13363">
 </A>
A value of type <TT>LogicalAddress</TT>. On input, this value points to a buffer for the converted string. On output, the buffer holds the converted text string. (For guidelines on estimating the size of the buffer needed, see the following discussion.) </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=26153">
 </A>
<I CLASS="italics">
function result</I>
 </DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=16772">
 </A>
A result code. The function returns a <TT>noErr</TT> result code if it has completely converted the Unicode string to the destination encoding without using fallback characters. If the function returns the <TT>paramErr</TT> or <TT>kTECGlobalsUnavailableErr</TT> result codes, it did not convert the string.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16773">
 </A>
If the function returns <TT>kTECTableFormatErr</TT>, the code encountered a table in an unknown format. The function did not completely convert the input string (and may not have converted any of it).</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16774">
 </A>
If the function returns <TT>kTECBufferBelowMinimumSizeErr</TT>, the output buffer was too small to allow conversion of any part of the input string. You need to increase the size of the output buffer and try again.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16775">
 </A>
If the function returns the <TT>kTECUsedFallbacksStatus</TT> result code, the function has completely converted the string using one or more fallback characters. This can only happen if you set the Unicode-use-fallbacks control flag.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16776">
 </A>
If the function returns <TT>kTECOutputBufferFullErr</TT>, the output buffer was not big enough to completely convert the input; <TT>oInputRead</TT> indicates the amount of input converted. You can call the function again with another output buffer (or with the same output buffer, after copying its contents) to convert the remainder of the Unicode string.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16777">
 </A>
If the function returns <TT>kTECPartialCharErr</TT>, the Unicode input string ended with an incomplete UTF-8 character (can only happen for UTF-8 input). If you have subsequent input text available, you can append the unconverted input from this call to the beginning of the subsequent input text and call the function again.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16778">
 </A>
If the function returns <TT>kTECUnmappableElementErr</TT>, an input text element could not be mapped to the destination encoding. The function did not completely convert the Unicode input string. This can only happen if you did not set the Unicode-use-fallbacks control flag. You can set this flag and convert the remaining unconverted input, or take some other action.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16779">
 </A>
If the function returns <TT>kTextUndefinedElementErr</TT>, the Unicode input string included a value which is undefined for the specified Unicode version. The function did not completely convert the input string, and fallback handling will not be invoked. You can resume conversion from a point beyond the offending Unicode character, or take some other action.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=16780">
 </A>
If the function returns <TT>kTextIncompleteElementErr</TT>, then either the input string included a text element which is too long for the internal buffers, or the input string ended with a text element which may be incomplete (this latter case can only happen if you set the <TT>kUnicodeStringUnterminatedMask</TT> control flag). The function did not completely convert the input string, and fallback handling will not be invoked.</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=14326">
 </A>
For additional information, see <A HREF="TEC.20.html" CLASS="XRef">
Text Encoding Conversion Manager Result Codes</A>
 in the chapter <A HREF="TEC.18.html" CLASS="XRef">
Basic Text Types Reference</A>
</DD><P>

</DL COMPACT>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=13365">
 </A>
DISCUSSION</H5>
<P>
<A NAME="pgfId=3672">
 </A>
The <TT>ConvertFromUnicodeToText</TT> function converts a Unicode text string to the destination encoding you specify in the Unicode mapping structure that you pass to the function <A HREF="TEC.83.html" CLASS="XRef"><TT>CreateUnicodeToTextInfo</TT></A> or <A HREF="TEC.84.html" CLASS="XRef"><TT>CreateUnicodeToTextInfoByEncoding</TT></A> when you call them to obtain a Unicode converter object for the conversion process. You pass the returned object to <TT>ConvertFromUnicodeToText</TT> as the <TT>iUnicodeToTextInfo</TT> parameter. <P>


<A NAME="pgfId=3676">
 </A>
In addition to converting the Unicode string, <TT>ConvertFromUnicodeToText</TT> can map offsets for style or font information from the source text string to the returned converted string. The converter reads the application-supplied offsets and returns the corresponding new offsets in the converted string. If you do not want font or style information offsets mapped to the resulting string, you should pass <TT>NULL</TT> for <TT>iOffsetArray</TT> and <TT>0</TT> (zero) for <TT>iOffsetCount</TT>. <P>


<A NAME="pgfId=3677">
 </A>
Your application must allocate a buffer to hold the resulting converted string and pass a pointer to the buffer in the <TT>oOutputStr</TT> parameter. To determine the size of the output buffer to allocate, you should consider the size and content of the Unicode source string in relation to the type of encoding to which it will be converted. For example, for many encodings, such as MacRoman and Shift-JIS, the size of the returned string will be between half the size and the same size as the source Unicode string. However, for some encodings that are not Mac OS ones, such as EUC-JP, which has some 3-byte characters for Kanji, the returned string could be larger than the source Unicode string. For MacArabic and MacHebrew, the result will usually be less than half the size of the Unicode string. <P>


<A NAME="pgfId=15587">
 </A>
This function modifies the contents of the Unicode converter object you passed as the <TT>iUnicodeToTextInfo</TT> parameter.</P>
</DIV>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=3691">
 </A>
SEE ALSO</H5>
<P>
<A NAME="pgfId=3692">
 </A>
 The function <A HREF="TEC.80.html" CLASS="XRef"><TT>ConvertFromTextToUnicode</TT></A></P>
</DIV>
<HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 13 Dec 99)<P><A HREF="TEC.82.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.85.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.87.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A>

<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY>
</HTML>
