<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>About the System Error Handler (IM: U)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING29></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="OSUtilities-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="OSUtilities-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="OSUtilities-222.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="OSUtilities-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="OSUtilities-2.html"><B>Operating System Utilities</B></A> / <BR><DD><A HREF="OSUtilities-28.html"><B>Chapter 2 - System Error Handler</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING29-0></A>
<H1>About the System Error Handler</H1>
 <A NAME=MARKER-2-55></A><A NAME=MARKER-2-40></A>The System Error Handler employs a mechanism that allows for display of simple alert boxes even when the Control Manager, Dialog Manager, and Memory Manager might not be able to function properly. System Error Handler alert boxes can therefore be displayed at times when the Dialog Manager cannot be called. This mechanism is useful at two times. First, at system startup time, the Dialog Manager may not yet have been initialized. Second, after a system error occurs, using the Dialog Manager or Memory Manager may be impossible or cause a system crash.<A NAME=MARKER-2-13></A><P>
 Because the System Error Handler cannot use Dialog Manager resources to store representations of its alert boxes, it defines its own resource, the system error alert table resource<B>,</B> to store such information. This resource type is described in <A HREF=OSUtilities-36.html#MARKER-9-76>"The System Error Alert Table Resource" beginning on page 2-16</A>. The <B>system alert table resource</B> defines for each system error the contents of the system alert box to be displayed. For example, depending on the system error that occurred, the system error alert box may contain one or more buttons, typically a Restart and a Continue button.<P>
 At system startup time, the System Error Handler presents the <B>system startup alert box</B>, shown in <A HREF=#MARKER-9-46>Figure 2-1</A>.<A NAME=MARKER-2-28></A><P>
<B>Figure 2-1  <A NAME=MARKER-9-46></A>The system startup alert box<A NAME=MARKER-9-66></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ERR-S-01.jpg"><P>
 The system startup alert box can take different forms. In particular, if an error occurs during the startup process, the System Error Handler might inform the user of the error by displaying an additional line of information in the alert box. The System Error Handler also uses the system startup alert box to post special messages to inform the user about the status of the system. For example, in System 7 and later, if the user holds down the Shift key while starting up, system extensions are disabled, and the system startup alert box includes the message "Extensions off." This is illustrated in <A HREF=#MARKER-9-49>Figure 2-2</A>.<A NAME=MARKER-2-84></A><P>
<B>Figure 2-2  <A NAME=MARKER-9-49></A>The system startup alert box when extensions have been disabled</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ERR-S-02.jpg"><P>
 Other messages that may be displayed at startup time include "Debugger Installed," "Disassembler Installed," and "System 7.1 needs more memory to start up."<A NAME=MARKER-2-17></A><P>
 The System Error Handler also displays an alert box when the Operating System or some other software invokes the <CODE>SysError</CODE> procedure. <A HREF=OSUtilities-170.html#MARKER-9-16>Figure 2-3</A> illustrates a <B>system error alert box,</B> sometimes called a <B>bomb box.</B> The conditions under which a system error occur are described in the next section, "System Errors.<A NAME=MARKER-2-18></A>"<P>
<B>Figure 2-3  <A NAME=MARKER-9-16></A>The system error alert box<A NAME=MARKER-2-19></A></B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ERR-S-03.jpg"><P>
 The system error alert box presents some information about the type of error that has occurred and also includes buttons to allow possible recovery from the error. The user may click the Restart button, in which case the System Error Handler attempts to restart the computer. (Such attempts are not always successful, and the computer may freeze, forcing the user to flip the power switch or depress the reset switch.) Some system error alert boxes have Continue buttons. If the user clicks the Continue button, the System Error Handler attempts to execute the application's resume procedure. Resume procedures are discussed in <A HREF=#MARKER-9-64>"Resume Procedures" on page 2-11</A>. If no resume procedure has been defined, then only the Restart button is available.<A NAME=MARKER-2-21></A><A NAME=MARKER-2-20></A><P>
<DL>
<DT><B>Note</B>
<DD>The layout and form of the system error alert box have changed considerably in different versions of system software. In early versions of system software, there was always a Resume button, which had the same effect as the Continue button, but it was grayed out when no resume procedure was defined. The Resume and Restart buttons were both at the left of the alert box. In some versions of system software, information about the type of error was displayed at the bottom of the alert box, and the ID information may have been conveyed in words ("bus error") instead of numbers ("ID = 1"). However, your application should not need to be familiar with the layout of the system error alert box.<EM></EM><A NAME=MARKER-2-40></A><A NAME=MARKER-2-39></A><A NAME=MARKER-2-22></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 A close examination of the button in <A HREF=OSUtilities-170.html#MARKER-9-16>Figure 2-3</A> reveals that the button has a different appearance from that of buttons displayed by the Control Manager. This is because the System Error Handler does not use the Control Manager to create buttons. Instead, it draws the buttons itself and highlights them when the mouse is clicked within the button area.<A NAME=MARKER-9-1></A><P>
<A NAME=HEADING29-16></A>
<H2><A NAME=MARKER-2-60></A><A NAME=MARKER-9-61></A>System Errors</H2>
 A <B>system error</B> is the result of the detection of a problem by the microprocessor or the Operating System. For example, if your application attempts to execute a system software routine that is not available on a certain Macintosh computer, the microprocessor detects the exception. The Operating System then calls the <CODE>SysError</CODE> procedure to produce a system error alert box. Similarly, the Operating System itself might detect a problem; for example, it might detect that a menu record that is needed has been purged. In this case, the Operating System calls <CODE>SysError</CODE> directly.<P>
 Your application can also call <CODE>SysError</CODE> if it detects that something that never should happen actually has happened. Ordinarily, it is more graceful for an application to use the Dialog Manager to warn the user that an error has occurred. You should call the <CODE>SysError</CODE> procedure only if there is reason to believe that an abnormal condition could prevent the Dialog Manager from working correctly. The Dialog Manager is described in the chapter "Dialog Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>.<A NAME=MARKER-9-42></A><P>
 Associated with each type of system error is a <B>system error ID.</B> This ID is typically presented to the user in the system error alert box. Although the system error IDs are meaningless to most users, a user can report the ID to you, thus possibly making it easier for you to track down the problem and provide the user with a solution.<P>
 <A HREF=#MARKER-9-1>Table 2-1</A> lists and briefly describes the system error IDs that are currently defined. Note, however, that sometimes system error IDs may be misleading. For example, your application might make an invalid memory reference that does not cause a system error immediately. However, the effects of that reference could cause another problem leading to a system error of a different type.<P>
 Note also that some system errors occur in the ordinary course of an application's execution but are handled by the Operating System with no need to display an error message to the user. For example, when virtual memory is in operation and an application attempts to access memory that has been paged out, a bus error is generated. Because the Virtual Memory Manager intercepts the bus error and determines that memory needs to be paged in, this error is generated transparently to the user.<A NAME=MARKER-2-2></A> If possible, when a system error occurs, the System Error Handler stops execution of the application that caused the error and displays an alert box with the message "Application has unexpectedly quit." (See <A HREF=#MARKER-9-66>Figure 2-4 on page 2-12</A> for an example of this alert box.)<P>
 
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-1></A><B>Table 2-1<A NAME=MARKER-2-114></A>System error IDs</B> </CAPTION>
<TH>ID and name<A NAME=MARKER-2-24></A><TH>Explanation<TR>
<TD>1 (Bus error)<TD>A memory reference was invalid. This is the most common type of system error.<P>An application might have tried to access memory in another application's partition or in a portion of memory not accessible to the application.<P>Typically, this error occurs if your application uses a handle<BR>or pointer reference that is no longer valid or was never valid. For example, if your application does not initialize a variable of type <CODE>Handle</CODE> or <CODE>Ptr</CODE> to the correct value and then tries to use that value as a memory reference, a bus error could occur.<BR>Or if you have made an error in performing pointer arithmetic,<BR>a bus error could occur.<P>This error could also occur if your application attempts to<BR>access a block of memory that has been moved or disposed of. Once your application disposes of a block of memory, either directly or indirectly, all pointer and handle references to<BR>that block of memory are invalid and could cause bus errors.<P>If your application dereferences a handle, calls a routine that could move or purge memory, and then relies on the master pointer value, a bus error could occur. See <I><A HREF="../Memory/Memory-2.html">Inside Macintosh: Memory</A></I> for more information.<P>If your application is careless in using the Memory Manager's <CODE>BlockMove</CODE> procedure or another technique to copy bytes directly, data structures used by the Memory Manager could be altered and a bus error generated.<A NAME=MARKER-2-26></A><TR>
<TD>2 (Address error)<TD>A reference to a word (2 bytes) or long word (4 bytes) was not on a word boundary. <P>An address error is often simply a bus error in which the memory reference happens to be odd. Thus, any programming errors that could cause a bus error might result in an address error as well. Indeed, sometimes the same programming error can generate both types of errors if you execute the offending code several times.<P>Address errors are often microprocessor-specific. That is, code that executes correctly on MC68030 microprocessors might generate an address error on MC68000 microprocessors. This is most likely to be a problem for assembly-language programmers.<A NAME=MARKER-9-28></A><TR>
<TD colspan=2>&nbsp;<TR>
<TD>3 (Illegal instruction)<TD>The microprocessor attempted to execute an instruction not defined for that version of the microprocessor. This might occur if you set a compiler to generate MC68030 code and then attempt to execute that code on a MC68000 microprocessor. Attempting to execute PowerPC code on a MC680x0 microprocessor could also cause this problem.<P>Typically, this problem occurs only if you are programming in assembly language or if your compiler generates illegal instructions. If your application (either intentionally or unintentionally) modifies its own code while executing, then this problem could also occur. <A NAME=MARKER-2-28></A><TR>
<TD>4 (Zero divide)<TD>The microprocessor received a signed divide (<CODE>DIVS</CODE>) or unsigned divide (<CODE>DIVU</CODE>) instruction, but the divisor was 0.<BR>When you write code that performs the division operation,<BR>you should ensure that the divisor can never be 0, unless you are using Operating System or SANE numeric types that support division by 0.<A NAME=MARKER-2-33></A><A NAME=MARKER-2-24></A><A NAME=MARKER-2-140></A><TR>
<TD>5 (Check exception)<TD>The microprocessor executed a check-register-against-bounds (<CODE>CHK</CODE>) instruction and detected an out-of-bounds value. If you are programming in a high-level language, this might occur<BR>if you have enabled range-checking and a value is out of range (for example, you attempt to access the sixth element of a five-element array).<A NAME=MARKER-9-105></A><A NAME=MARKER-0-25></A><TR>
<TD>6 (TrapV exception)<TD><A NAME=MARKER-2-27></A>The microprocessor executed a trap-on-overflow (<CODE>TRAPV</CODE>) instruction and detected an overflow. If you are programming<BR>in a high-level language, this might occur if you have enabled integer-arithmetic overflow checking and an overflow occurs.<A NAME=MARKER-2-3></A><A NAME=MARKER-2-13></A><TR>
<TD>7 (Privilege violation)<TD>The Macintosh computer was in a mode that did not allow execution of the specified microprocessor instruction. This should not happen because the Macintosh computer always runs in supervisor mode. However, if you are programming in assembly language, this error could occur if you execute an erroneous return-from-execution (<CODE>RTE</CODE>) instruction.<A NAME=MARKER-2-30></A><A NAME=MARKER-2-15></A><TR>
<TD>8 (Trace exception)<TD>The trace bit in the status register is set. Debuggers use this error to force code execution to stop at a certain point. If you are programming in a high-level language, this system error should always be intercepted by your low-level debugger.<A NAME=MARKER-2-91></A><TR>
<TD>9 (A-line exception)<TD>The trap dispatcher failed to execute the specified system software routine. This error might occur if you attempt to execute a Toolbox routine that is not defined in the version of the system software that is running.<A NAME=MARKER-9-4></A><TR>
<TD>10 (F-line exception)<TD><A NAME=MARKER-9-27></A>Your application executed an illegal instruction.<TR>
<TD>11 (Miscellaneous exception)<TD>The microprocessor invoked an exception not covered by system error IDs 1 to 10. This exception might be generated in the case of a hardware failure.<A NAME=MARKER-2-22></A><TR>
<TD>12 (Unimplemented core routine)<TD>The Operating System encountered an unimplemented trap number.<A NAME=MARKER-0-54></A><TR>
<TD>13 (Spurious interrupt)<TD>The interrupt vector table entry for a particular level of interrupt is <CODE>NIL</CODE>. This error usually occurs with level 4, 5, 6, or 7 interrupts. Typically, this error should affect only developers of low-level device drivers, NuBus cards, and other expansion devices.<A NAME=MARKER-2-3></A><TR>
<TD>14 (I/O system error)<TD>A Device Manager or Operating System queue operation failed. This might occur if the File Manager attempts to remove an entry from an I/O request queue, but the queue entry has an invalid queue type (perhaps the queue entry is unlocked). Or this might occur as a result of a call to <CODE>Fetch</CODE> or <CODE>Stash</CODE>, but the <CODE>dCtlQHead</CODE> field was <CODE>NIL</CODE>. This error can also occur if your driver has purged a needed device control entry<A NAME=MARKER-2-87></A> (DCE).<A NAME=MARKER-2-123></A><TR>
<TD>15 (Segment loader error)<TD>A call was made to load a code segment, but a call to <CODE>GetResource</CODE> to read the segment into memory failed. This could occur if your application attempts to load a segment that does not exist, or if your application attempts to load a segment but there is not enough memory for it in the application heap. When an attempt to load a code resource with resource ID 0 fails, a system error with ID 26 is generated instead.<A NAME=MARKER-2-22></A><TR>
<TD>16 (Floating-point error)<TD>The halt bit in the floating-point environment word was set.<A NAME=MARKER-2-44></A><TR>
<TD>17-24 (Can't load package)<TD>The Package Manager attempted to load a package into memory, but the call to <CODE>GetResource</CODE> failed. This could occur because the system file is corrupted, or because there is not enough memory for the package to be loaded. For example, if you call a List Manager routine when memory is very low, the <CODE>SysError</CODE> procedure could be executed.<TR>
<TD>25 (Out of memory)<TD>The requested memory block could not be allocated in the heap because there is insufficient free space. Typically, a Toolbox routine generates this system error if it requires heap space to run but there is insufficient space. Your application should prevent this from occurring by ensuring that it always leaves enough memory for Toolbox operations. See <I><A HREF="../Memory/Memory-2.html">Inside Macintosh: Memory</A></I> for more details.<A NAME=MARKER-9-50></A><P>You can also get this error if the Package Manager was unable<BR>to load the Apple Event Manager (Pack 8). See the chapter "Package Manager" in this book for an explanation of this error.<TR>
<TD colspan=2>&nbsp;<TR>
<TD>26 (Segment loader error)<TD>A call was made to load a code segment with resource ID 0, but the call to <CODE>GetResource</CODE> failed. This usually occurs if your application attempts to execute a nonexecutable file.<A NAME=MARKER-2-51></A><P>You can also get this error if the Package Manager was unable<BR>to load the Program-to-Program Communications (PPC) Toolbox package (Pack 9). See the chapter "Package Manager" in this book for an explanation of this error.<TR>
<TD>27 (File map destroyed)<TD>The File Manager encountered a paradox. A logical block number was found that is greater than the number of the last logical block on the volume or less than the logical block number of the first allocation block on the volume. The disk is probably corrupted.<A NAME=MARKER-2-52></A><TR>
<TD>28 (Stack overflow error)<TD>The Operating System detected that the application's stack collided with its heap. This could happen when a deeply nested routine is executed or when interrupt routines use more stack space than available. If your application relies on recursion,<BR>it should monitor the size of the stack to prevent such an error from occurring.<P>If this error occurs simply because your application attempted to execute a deeply nested routine, you can prevent this from occurring by increasing the minimum size of the stack at application startup. Because the size of the stack may differ from one Macintosh model to another, an application might encounter no problems on a Macintosh LC but crash on a Macintosh Plus, for example. For more information, see <I><A HREF="../Memory/Memory-2.html">Inside Macintosh: Memory</A></I>.<A NAME=MARKER-2-62></A><P>You can also get this error if the Package Manager was unable<BR>to load the Edition Manager (Pack 11). See the chapter "Package Manager" in this book for an explanation of this error.<TR>
<TD>30 (Disk insertion required)<TD>A necessary disk is not available. The System Error Handler responds to this error by requesting that the user insert the requested disk. Often, the user can cancel this alert box by pressing Command-period repeatedly; in certain circumstances, however, pressing Command-period repeatedly can lead to a system crash.<A NAME=MARKER-2-65></A><P>You can also get this error if the Package Manager was unable<BR>to load the Data Access Manager (Pack 13). See the chapter "Package Manager" in this book for an explanation of this error.<TR>
<TD>31 (Wrong disk inserted)<TD>The user inserted the incorrect disk in response to a disk-insertion request. The System Error Handler ejects the disk and allows the user to insert another.<A NAME=MARKER-9-21></A><P>You can also get this error if the Package Manager was unable<BR>to load the Help Manager (Pack 14). See the chapter "Package Manager" in this book for an explanation of this error.<TR>
<TD>33 (Negative <CODE>zcbFree</CODE> value)<TD>The Memory Manager's calculation of the number of bytes free in a heap zone (that is, the value of the <CODE>zcbFree</CODE> field) resulted in a negative number. Your application might have used up too much memory in the heap zone, or the heap is corrupted<A NAME=MARKER-2-77></A><TR>
<TD>41 (Finder not found)<TD>The Operating System could not locate the Finder on the disk. The disk might be corrupted.<A NAME=MARKER-2-80></A><TR>
<TD>84 (Menu purged)<TD>The Menu Manager attempted to access information about a menu, but the menu record was purged. You should ensure that all menus stored in your application's resource file are marked as unpurgeable.<A NAME=MARKER-2-127></A><TR>
<TD>100 (Can't mount system startup<BR>        volume)<TD>The Operating System could not mount the system startup volume and thus is unable to read the system resource file into memory. The startup volume could be corrupted or broken. Your application can force startup on another volume by clearing parameter RAM, as discussed in the chapter "Parameter RAM Utilities" in this book.<TR>
<TD>32767 (Default system error)<TD>This is the default system error that executes when an undefined problem occurs. Your application can call the <CODE>SysError</CODE> procedure with this value.<A NAME=MARKER-9-15></A><A NAME=MARKER-2-36></A><A NAME=MARKER-9-22></A><A NAME=MARKER-2-57></A></TABLE>
<P>
<A NAME=HEADING29-23></A>
<H2><A NAME=MARKER-9-64></A>Resume Procedures<A NAME=MARKER-2-4></A></H2>
 The Operating System supports a mechanism that allows your application to resume execution after a system error if the user clicks the Continue button (or the Resume button in earlier versions of system software). When initializing the Dialog Manager using the <CODE>InitDialogs</CODE> procedure, your application passes a pointer to a resume procedure or passes <CODE>NIL</CODE> if no resume procedure is desired. A resume procedure takes no parameters.<P>
 In general, you should not write code to allow an application to continue to execute normally after a system error has occurred. Because current versions of system software allow multiple applications to be open at once, a system error could affect other processes than the one that is executing. Indeed, the System Error Handler often simply stops execution of the application that caused the error rather than present the system error alert box. In this case, the Finder reports that the application has unexpectedly quit, as shown in <A HREF=#MARKER-9-66>Figure 2-4</A>.<P>
<B>Figure 2-4  <A NAME=MARKER-9-66></A>Handling of a nonfatal system error in System 7</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/ERR-S-04.jpg"><P>
 An application that attempts to resume execution after a system error is likely to encounter the same problem again and might even encounter more serious problems. In early versions of system software, such an attempt constituted a harmless last-ditch effort by an application to salvage itself. In current versions of system software, such an attempt may cause a <B>fatal system error</B>--that is, a system error that crashes the entire system--even if the initial system error was nonfatal.<P>
 If your application is designed to work with System 7 only, you should always pass <CODE>NIL</CODE> to <CODE>InitDialogs</CODE> and forego a resume procedure. You might alternatively pass a pointer to a simple resume procedure that simply quits the program, as illustrated in <A HREF=#MARKER-9-67>Listing 2-1</A>.<P>
<B>Listing 2-1  <A NAME=MARKER-9-67></A>A simple resume procedure</B><P>
<PRE>
PROCEDURE MyResumeProc;
BEGIN
   ExitToShell;
END;
</PRE>
 If you wish, you might write a custom resume procedure that you install only on Macintosh computers running versions of system software prior to System 7. Typically, such resume procedures simply jump to the beginning of the application's main event loop and hope for the best. Because Pascal does not permit a procedure to include a GOTO statement that references a label outside its scope, resume procedures typically are written in assembly language.<P>
<DL>
<DT><B>WARNING</B>
<DD>Implementing a resume procedure is not an adequate substitute for quality assurance. Your application should not, for example, allow the user to open so many documents that memory runs out, causing a system error. Calling the System Error Handler's <CODE>SysError</CODE> procedure to report a problematic condition to the user might cause a system crash even if no crash would have otherwise occurred and even if your application uses the simple resume procedure defined in <A HREF=#MARKER-9-67>Listing 2-1</A>.<EM></EM><A NAME=MARKER-2-64></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="OSUtilities-28.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="OSUtilities-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="OSUtilities-222.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="OSUtilities-30.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="OSUtilities-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
