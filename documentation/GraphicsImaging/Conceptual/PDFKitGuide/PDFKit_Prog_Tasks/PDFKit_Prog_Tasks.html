<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>PDF Kit Programming Guide: PDF Kit Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="PDF Kit Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001863-CH202" title="PDF Kit Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Cocoa-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000495" target="_top">Cocoa</a> &gt; <a href="../PDFKit_Prog_Intro/PDFKit_Prog_Intro.html#//apple_ref/doc/uid/TP40001863-CH203-DontLinkElementID_29">PDF Kit Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../PDFKit_Prog_Conc/PDFKit_Prog_Conc.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PDFKit_Prog_Rev/PDFKit_Prog_Rev.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_31" title="PDF Kit Tasks"></a><h1><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDIADBJ" title="PDF Kit Tasks"></a>PDF Kit Tasks</h1><p>This chapter shows how you can implement common tasks with PDF Kit.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_17">Implementing a PDFView</a>
				
			<br/>
			
        
			
			
				<a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_18">PDF Kit in Preview</a>
				
			<br/>
			
        
			
			
				<a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_19">Creating Outlines</a>
				
			<br/>
			
        
			
			
				<a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_20">Searching a PDF Document</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_17" title="Implementing a PDFView"></a><h2>Implementing a PDFView</h2><p>Most developers will simply want to display PDF information in their views, so PDFView will fit the bill nicely. </p><p>A PDFView user interface element is available in Interface Builder, so you should use that wherever you want your application to display PDF content. Note that you need to install the PDF Kit palette in <code>/Developer/Extras/Palettes/PDFKit.palette</code> to make PDFViews available.</p><p>To add the PDFKit palette in Interface Builder, select the Palettes tab in the Preferences panel. Click the Add… button, navigate to the <code>/Developer/Extras/Palettes</code> folder, and select the PDFKit palette. Next, select the Customize Toolbar menu item in the Tools/Palettes menu and drag the PDFKit palette to the toolbar to make it visible.  </p><p>After adding the PDFView element in your nib file, you can add PDF content from your application by calling the PDFDocument method <code>initWithURL</code>. For example, you could use code like the following:</p><div class="codesample"><table><tr><td scope="row"><pre>PDFDocument *pdfDoc;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pdfDoc = [[[PDFDocument alloc] initWithURL: [NSURL fileURLWithPath: [self fileName]]] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>[_pdfView setDocument: pdfDoc];<span></span></pre></td></tr></table></div><p>Alternatively, if your PDF data is stored in a different form, you can use the PDFDocument method <code>initWithData:</code>. Users can also drag-and-drop documents into the view. </p><p>The resulting PDFView handles the basic functionality required to view and navigate through a PDF document. Simple scrolling and live links work automatically, and you also get a contextual menu to handle scaling and navigation. To experiment with the “free” features of a PDFView, you can simply drag a PDF document into your view while in interface test mode in Interface Builder. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_18" title="PDF Kit in Preview"></a><h2>PDF Kit in Preview</h2><p>Preview in Mac OS X v10.4 uses PDF Kit, so you can use this application as a guide to see what is possible in your own PDF views. Many method calls in PDF Kit have a comparable menu item in Preview. <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABIDBCE">Table 3-1</a></span> shows the correspondance between the various menu items and their API equivalents. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_32" title="Table 2-1Preview Menu Items versus PDF Kit methods"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABIDBCE" title="Table 2-1Preview Menu Items versus PDF Kit methods"></a><strong>Table 2-1&nbsp;&nbsp;</strong>Preview Menu Items versus PDF Kit methods</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Menu</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Submenu</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Method</p></th></tr><tr><td  scope="row"><p>View</p></td><td ><p>PDF Display</p></td><td ><p>PDFView: <code>- setDisplayMode:</code> and <code>- setDisplayBox:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Zoom In</p></td><td ><p>PDFView: <code>- zoomIn:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Zoom Out</p></td><td ><p>PDFView: <code>- zoomOut:</code></p></td></tr><tr><td  scope="row"><p>Go</p></td><td ><p>Next</p></td><td ><p>PDFView: <code>- goToNextPage:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Previous</p></td><td ><p>PDFView: <code>- goToPreviousPage:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Go to Page</p></td><td ><p>PDFView: <code>- goToPage:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>First</p></td><td ><p>PDFView: <code>- goToFirstPage:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Last</p></td><td ><p>PDFView: <code>- goToLastPage:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Back</p></td><td ><p>PDFView: <code>- goBack:</code></p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Forward</p></td><td ><p>PDFView: <code>- goForward:</code></p></td></tr><tr><td  scope="row"><p>Tools</p></td><td ><p>Rotate Left</p></td><td ><p>PDFPage: <code>- setRotation:</code> to <code>- rotation </code>-90</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Rotate Right</p></td><td ><p>PDFPage: <code>- setRotation:</code> to <code>- rotation </code>+90</p></td></tr><tr><td  scope="row"><p></p></td><td ><p>Annotation</p></td><td ><p><code>initWithBounds:</code>for the appropriate annotation subclass (such as PDFAnnotationCircle)</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_19" title="Creating Outlines"></a><h2>Creating Outlines</h2><p>Many PDF documents contain outlines, so your application will usually want to display this information as well.</p><p>Note that because some PDF documents do not contain outline information, you should probably make the outline display an optional element in your user interface. For example, you can display outlines in a drawer, which can be closed if not needed. </p><p>You can use the NSOutlineView class to display your PDF outlines. Instances of this class automatically display the outline hierarchy with disclosure triangles and live links to the appropriate PDF pages. <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABGIHFJ">Listing 3-1</a></span> shows how you might do so. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_33" title="Listing 2-1Loading PDF outline information"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABGIHFJ" title="Listing 2-1Loading PDF outline information"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Loading PDF outline information</p><div class="codesample"><table><tr><td scope="row"><pre>_outline = [[[_pdfView document] outlineRoot] retain];<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (_outline)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [_noOutlineText removeFromSuperview];<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        _noOutlineText = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        [_outlineView reloadData];<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [[_outlineView enclosingScrollView] removeFromSuperview];<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        _outlineView = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Obtains the root (topmost) outline element. <code>_outline</code> is an instance of PDFOutline.</p></li><li class="li"><p>If a root outline exists, removes placeholder text indicating “No Outline.”</p></li><li class="li"><p>Loads PDF outline information into the outline view. The outline view calls your delegate methods to determine the elements in the outline hierarchy. </p></li><li class="li"><p>If the root outline does not exist, removes the outline view, leaving behind placeholder text. </p></li></ol><p>After you invoke the <code>reloadData</code> method, the outline view calls various data source delegate methods to populate the outline. These delegate methods are defined in the NSOutlineViewDataSource protocol. Your application must implement these methods so that the proper PDF data is added to the outline. </p><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABHBDAD">Listing 3-2</a></span> shows the delegate method for obtaining the number of childen, which simply returns the value obtained by the PDFOutline method <code>numberOfChildren</code>. If the item parameter is <code>NULL</code>, this method returns the number of children for the root outline.</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_34" title="Listing 2-2Delegate method for determining the number of children"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABHBDAD" title="Listing 2-2Delegate method for determining the number of children"></a><strong>Listing 2-2&nbsp;&nbsp;</strong>Delegate method for determining the number of children</p><div class="codesample"><table><tr><td scope="row"><pre>- (int) outlineView: (NSOutlineView *) outlineView numberOfChildrenOfItem: (id) item<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (item == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (_outline)<span></span></pre></td></tr><tr><td scope="row"><pre>            return [_outline numberOfChildren];<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return [(PDFOutline *)item numberOfChildren];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p></p><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABDDFBI">Listing 3-3</a></span> shows the delegate method for obtaining a particular child outline by calling the PDFOutline method <code>childAtIndex</code>. If the item parameter is <code>NULL</code>, this method returns the appropriate child of the root outline.</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_35" title="Listing 2-3Delegate method for obtaining a child element"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABDDFBI" title="Listing 2-3Delegate method for obtaining a child element"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Delegate method for obtaining a child element</p><div class="codesample"><table><tr><td scope="row"><pre>- (id) outlineView: (NSOutlineView *) outlineView child: (int) index ofItem: (id) item<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (item == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (_outline)<span></span></pre></td></tr><tr><td scope="row"><pre>            return [[_outline childAtIndex: index] retain];<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return [[(PDFOutline *)item childAtIndex: index] retain];<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABBEHJJ">Listing 3-4</a></span> shows a delegate method for determining if an outline element is expandable (that is, whether it has child outlines). </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_36" title="Listing 2-4Delegate method for determining if an element has children"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABBEHJJ" title="Listing 2-4Delegate method for determining if an element has children"></a><strong>Listing 2-4&nbsp;&nbsp;</strong>Delegate method for determining if an element has children</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) outlineView: (NSOutlineView *) outlineView isItemExpandable: (id) item<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (item == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (_outline)<span></span></pre></td></tr><tr><td scope="row"><pre>            return ([_outline numberOfChildren] > 0);<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            return NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return ([(PDFOutline *)item numberOfChildren] > 0);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABCDAAC">Listing 3-5</a></span> shows a delegate method for obtaining an outline element’s label, which calls the PDFOutline method <code>label</code>. The label is simply the string that is displayed in the outline view (for example, a chapter title).</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_37" title="Listing 2-5Delegate method for obtaining an element&acirc;&#128;&#153;s contents"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABCDAAC" title="Listing 2-5Delegate method for obtaining an element&acirc;&#128;&#153;s contents"></a><strong>Listing 2-5&nbsp;&nbsp;</strong>Delegate method for obtaining an element’s contents</p><div class="codesample"><table><tr><td scope="row"><pre>- (id) outlineView: (NSOutlineView *) outlineView<span></span></pre></td></tr><tr><td scope="row"><pre>        objectValueForTableColumn: (NSTableColumn *) tableColumn<span></span></pre></td></tr><tr><td scope="row"><pre>        byItem: (id) item<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [(PDFOutline *)item label];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When the user selects an outline element, your application should update the PDF display to show the page corresponding to that element. The simplest way to do so is to call the PDFView’s <code>goToDestination</code> method, as shown in <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDHGBDG">Listing 3-6</a></span>. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_38" title="Listing 2-6Displaying the page associated with an outline element"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDHGBDG" title="Listing 2-6Displaying the page associated with an outline element"></a><strong>Listing 2-6&nbsp;&nbsp;</strong>Displaying the page associated with an outline element</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) takeDestinationFromOutline: (id) sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [_pdfView goToDestination: [[sender itemAtRow:<span></span></pre></td></tr><tr><td scope="row"><pre>                                [sender selectedRow]] destination]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In addition, if the user scrolls or otherwise moves through the document, your application should update the outline to highlight the outline element that corresponds to the currently displayed page. You can do so by installing a notification handler to be called each time the page changes (that is, when PDFViewPageChangedNotification is posted). <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDIIAIJ">Listing 3-7</a></span> hows how you might do so. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_39" title="Listing 2-7Updating the outline when the page changes"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDIIAIJ" title="Listing 2-7Updating the outline when the page changes"></a><strong>Listing 2-7&nbsp;&nbsp;</strong>Updating the outline when the page changes</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) pageChanged: (NSNotification *) notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned int    newPageIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    int             numRows;<span></span></pre></td></tr><tr><td scope="row"><pre>    int             i;<span></span></pre></td></tr><tr><td scope="row"><pre>    int             newlySelectedRow;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ([[_pdfView document] outlineRoot] == NULL)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    newPageIndex = [[_pdfView document] indexForPage: <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                                            [_pdfView currentPage]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Walk outline view looking for best firstpage number match.<span></span></pre></td></tr><tr><td scope="row"><pre>    newlySelectedRow = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    numRows = [_outlineView numberOfRows];<span></span></pre></td></tr><tr><td scope="row"><pre>    for (i = 0; i &lt; numRows; i++)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        PDFOutline  *outlineItem;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Get the destination of the given row....<span></span></pre></td></tr><tr><td scope="row"><pre>        outlineItem = (PDFOutline *)[_outlineView itemAtRow: i];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ([[_pdfView document] indexForPage:<span></span></pre></td></tr><tr><td scope="row"><pre>                    [[outlineItem destination] page]] == newPageIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            newlySelectedRow = i;<span></span></pre></td></tr><tr><td scope="row"><pre>            [_outlineView selectRow: newlySelectedRow<span></span></pre></td></tr><tr><td scope="row"><pre>                                        byExtendingSelection: NO];<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else if ([[_pdfView document] indexForPage:<span></span></pre></td></tr><tr><td scope="row"><pre>                    [[outlineItem destination] page]] > newPageIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            newlySelectedRow = i - 1;<span></span></pre></td></tr><tr><td scope="row"><pre>            [_outlineView selectRow: newlySelectedRow<span></span></pre></td></tr><tr><td scope="row"><pre>                                        byExtendingSelection: NO];<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (newlySelectedRow != -1)<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        [_outlineView scrollRowToVisible: newlySelectedRow];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Checks to see if a root outline exists. If not, then there is no outline to update, so simply return. </p></li><li class="li"><p>Obtains the index value for the current page. The PDFView method <code>currentPage</code> returns the PDFPage object, and the PDFDocument method <code>indexForPage</code> returns the actual index for that page. This index value is zero-based, so it doesn’t necessarily correspond to a page number. </p></li><li class="li"><p>Iterate through each visible element in the outline, checking to see if one of the following occurs:</p><ul class="ul"><li class="li"><p>The index of an outline element matches the index of the new page. If so, highlight this element (using the NSTableView method <code>selectRow:byExtendingSelection</code>).</p></li><li class="li"><p>The index of the outline element is larger than the index of the page. If so, a match was not possible as the index corresponds to a hidden child of a visible element. In this case, use <code>selectRow</code> to highlight the parent outline element (the current row -1 ). </p></li></ul></li><li class="li"><p>Call the NSTableView method <code>scrollRowToVisible</code> to adjust the outline view (if necessary) to make the highlighted element visible. </p></li></ol><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_20" title="Searching a PDF Document"></a><h2>Searching a PDF Document</h2><p>Users often need to search through a PDF document. PDF Kit offers two methods for doing so: </p><ul class="ul"><li class="li"><p>Searching string-by-string through the document. That is, when the user searches for <em>string</em>, PDF Kit returns the first occurrence of the string. Additional searches (“Find Again”) return successive instances of <em>string</em>. This search method is synchronous.</p></li><li class="li"><p>Obtaining a listing of all occurrences of <em>string</em> in a document. This search method may be synchronous or asynchronous. </p></li></ul><p>For simple string-by-string searching, your application can simply call the PDFDocument method <code>findString:fromSelection:withOptions:</code>. </p><div class="codesample"><table><tr><td scope="row"><pre>- (PDFSelection *) findString:(NSString *)string<span></span></pre></td></tr><tr><td scope="row"><pre>         fromSelection:PDFSelection *selection:withOptions:(int)options<span></span></pre></td></tr></table></div><p>To display the selection returned, you can call the PDFView method <code>setCurrentSelection</code>, which highlights the selection, followed by <code>scrollSelectionToVisible</code>. </p><p>You can specify the following options:</p><ul class="ul"><li class="li"><p><code>NSCaseInsensitiveSearch</code>: Ignore case when making a match.</p></li><li class="li"><p><code>NSLiteralSearch</code>: Search for contiguous words, separated by spaces. </p></li><li class="li"><p><code>NSBackwardsSearch</code>: Search backwards from the current selection. </p></li></ul><p>By passing <code>NULL</code> for the selection, you can begin the search from the beginning (or end) of the document. By passing the most recent match for the selection, you can implement “Find Again” behavior. If the <code>findString</code> call returns <code>NULL</code>, that means that either the string was not found, or the search reached the end (or beginning) of the document. </p><p>To obtain all the occurrences of a given string, you can use either of the following PDFDocument methods:</p><ul class="ul"><li class="li"><p><code>findString:withOptions:</code> to synchronously obtain an NSArray object holding all the matches</p></li><li class="li"><p><code>beginFindString:withOptions:</code> to asynchronously begin a search for all occurrences. PDF Kit calls your delegate method each time a match is found. </p></li></ul><p>Unless you are sure that the search will be brief, you should choose to use <code>beginFindString:withOptions:</code></p><p>As this is an asynchronous search, PDFDocument includes two other useful find-related methods:</p><ul class="ul"><li class="li"><p><code>isFinding</code> to determine if a search in currently in progress</p></li><li class="li"><p><code>cancelFindString</code> to terminate a current search. </p></li></ul><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABJFEBH">Listing 3-8</a></span> shows how you might initiate a search:</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_40" title="Listing 2-8Beginning an asynchronous search"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABJFEBH" title="Listing 2-8Beginning an asynchronous search"></a><strong>Listing 2-8&nbsp;&nbsp;</strong>Beginning an asynchronous search</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) doFind: (id) sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([[_pdfView document] isFinding])<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        [[_pdfView document] cancelFindString];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (_searchResults == NULL)<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        _searchResults = [[NSMutableArray arrayWithCapacity: 10] retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [[_pdfView document] beginFindString: [sender stringValue] <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                withOptions: NSCaseInsensitiveSearch];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here is how the code works:</p><ol class="ol"><li class="li"><p>Cancels any current searches. </p></li><li class="li"><p>Allocates a mutable array to hold the search results if one does not already exist. </p></li><li class="li"><p>Calls the PDFDocument method <code>beginFindString:withOptions:</code> with the desired search string.</p></li></ol><p>During the search, PDF Kit sends out notifications that your application can react to:</p><ul class="ul"><li class="li"><p>PDFDocumentDidBeginFindNotification</p></li><li class="li"><p>PDFDocumentDidEndFindNotification</p></li><li class="li"><p>PDFDocumentDidBeginPageFindNotification</p></li><li class="li"><p>PDFDocumentDidEndPageFindNotification</p></li><li class="li"><p>PDFDocumentDidFindMatchNotification</p></li></ul><p>The first two notifications are sent when the search starts, or finishes a search. You can use these notifications to set up and remove progress bars or any other initializations.</p><p>The begin and end page notifications are sent when the search begins or ends searching a page in the document. You can use these notifications to update a progress bar or page counter. </p><p>The find match notification is sent whenever a match is found for the search string. Typically you will want to obtain the string selection and store it in an array for later display. However, in most cases it may be easier to use the PDFDocument delegate method <code>didMatchString</code>, which automatically passes you the matching selection. <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDBEJHG">Listing 3-9</a></span> shows how you might implement a delegate to take each matching string and add it to an array of search results in an NSTableView. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_41" title="Listing 2-9Adding search results to a table view"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDBEJHG" title="Listing 2-9Adding search results to a table view"></a><strong>Listing 2-9&nbsp;&nbsp;</strong>Adding search results to a table view</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) didMatchString: (PDFSelection *) instance<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Add page label to our array.<span></span></pre></td></tr><tr><td scope="row"><pre>    [_searchResults addObject: [instance copy]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Force a reload.<span></span></pre></td></tr><tr><td scope="row"><pre>    [_searchTable reloadData];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here <code>_searchResults</code> is an instance of NSMutableArray, and <code>_searchTable</code> is an instance of NSTableView. </p><p>To make sure that the NSTableView displays the search results correctly, you need to implement delegate data source methods (similar to those required for NSOutlineView). These delegate methods are defined in the NSTableDataSource protocol. </p><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDECBDA">Listing 3-10</a></span> shows a delegate method for determining the number of rows in the table view. This method simply obtains the number of items in the search results by calling the NSMutableArray method <code>count</code>.</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_42" title="Listing 2-10Determining the number of rows in the table"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDECBDA" title="Listing 2-10Determining the number of rows in the table"></a><strong>Listing 2-10&nbsp;&nbsp;</strong>Determining the number of rows in the table</p><div class="codesample"><table><tr><td scope="row"><pre>- (int) numberOfRowsInTableView: (NSTableView *) aTableView<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return ([_searchResults count]);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDBIFFJ">Listing 3-11</a></span> shows a delegate data source method for obtaining the value of a particular column.</p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_43" title="Listing 2-11Obtaining the value for a column"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDBIFFJ" title="Listing 2-11Obtaining the value for a column"></a><strong>Listing 2-11&nbsp;&nbsp;</strong>Obtaining the value for a column</p><div class="codesample"><table><tr><td scope="row"><pre>- (id) tableView: (NSTableView *) aTableView objectValueForTableColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            (NSTableColumn *) theColumn<span></span></pre></td></tr><tr><td scope="row"><pre>            row: (int) rowIndex<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([[theColumn identifier] isEqualToString: @"page"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return ([[[[_searchResults objectAtIndex: rowIndex] pages]<span></span></pre></td></tr><tr><td scope="row"><pre>                     objectAtIndex: 0] label]);<span></span></pre></td></tr><tr><td scope="row"><pre>    else if ([[theColumn identifier] isEqualToString: @"section"])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSString    *label = [[[_pdfView document] outlineItemForSelection:<span></span></pre></td></tr><tr><td scope="row"><pre>                         [_searchResults objectAtIndex: rowIndex]] label];<span></span></pre></td></tr><tr><td scope="row"><pre>        return label;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The table view calls this method whenever it needs to determine the value of a particular table element (such as when preparing the table for display). </p><p>The search results table in this example contains only two columns: the page containing the hit and the outline section that contains the hit. (In a more sophisticated example, you may want to display a portion of the text containing the matching string, as Preview does.) You reference these columns using the identifier tags you specified for them in the NSTableColumn inspector window in Interface Builder (as shown in <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-CHDFCFCJ">Figure 3-1</a></span>). </p><br/><div><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_44" title="Figure 2-1Assigning column identifiers in Interface Builder"></a><p><a name="//apple_ref/doc/uid/TP40001863-CH202-CHDFCFCJ" title="Figure 2-1Assigning column identifiers in Interface Builder"></a><strong>Figure 2-1&nbsp;&nbsp;</strong>Assigning column identifiers in Interface Builder</p><img src = "../Art/identifying_columns.gif" alt = "Assigning column identifiers in Interface Builder" width="497" height="398"></div><br/><p>For this example: </p><ul class="ul"><li class="li"><p>If the column identifier is “page,” return the page number of the hit by calling the PDFSelection method <code>pages</code>.</p></li><li class="li"><p>If the column identifier is “section,” return the outline label for the selection by calling the PDFDocument method <code>outlineItemForSelection</code>.</p></li></ul><p>When the user selects an item in the search results, your application should display the corresponding page. <span class="content_text"><a href="PDFKit_Prog_Tasks.html#//apple_ref/doc/uid/TP40001863-CH202-BABGGEHB">Listing 3-12</a></span> shows how you might do so using an NSTableView notification. </p><a name="//apple_ref/doc/uid/TP40001863-CH202-DontLinkElementID_45" title="Listing 2-12Handling a selection in the table"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001863-CH202-BABGGEHB" title="Listing 2-12Handling a selection in the table"></a><strong>Listing 2-12&nbsp;&nbsp;</strong>Handling a selection in the table</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) tableViewSelectionDidChange: (NSNotification *) notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int rowIndex;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // What was selected.  Skip out if the row has not changed.<span></span></pre></td></tr><tr><td scope="row"><pre>    rowIndex = [(NSTableView *)[notification object] selectedRow];<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (rowIndex >= 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [_pdfView setCurrentSelection: <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                    [_searchResults objectAtIndex: rowIndex]];<span></span></pre></td></tr><tr><td scope="row"><pre>        [_pdfView scrollSelectionToVisible: self];<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>A table view sends the NSTableViewSelectionDidChangeNotification when an item is selected, and calls your delegate method <code>tableViewSelectionDidChange</code>. Here is how the code works:</p><ol class="ol"><li class="li"><p>Checks to see if the selection is valid. </p></li><li class="li"><p>Sets the current selection to the one that the user clicked.</p></li><li class="li"><p>Updates the PDF view to show the page containing the selection. </p></li></ol><p>For more information about implementing these delegate methods, see <em><a href="../../../../Cocoa/Conceptual/TableView/index.html#//apple_ref/doc/uid/10000026i" target="_top">Table View Programming Guide</a></em> in Cocoa User Experience Documentation. </p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../PDFKit_Prog_Conc/PDFKit_Prog_Conc.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PDFKit_Prog_Rev/PDFKit_Prog_Rev.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/PDFKitGuide/PDFKit_Prog_Tasks/PDFKit_Prog_Tasks.html%3Fid%3DTP40001863-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/PDFKitGuide/PDFKit_Prog_Tasks/PDFKit_Prog_Tasks.html%3Fid%3DTP40001863-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/PDFKitGuide/PDFKit_Prog_Tasks/PDFKit_Prog_Tasks.html%3Fid%3DTP40001863-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>