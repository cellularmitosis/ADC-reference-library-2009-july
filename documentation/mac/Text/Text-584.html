<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The KeyTranslate Function and the Keyboard-Layout Resource(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING584></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-583.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-585.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-570.html"><B>Appendix C - Keyboard Resources</B></A> / <A HREF="Text-582.html"><B>Keyboard-Layout Resource (Type 'KCHR')</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING584-0></A>
<H2><A NAME=MARKER-9-72></A>The KeyTranslate Function and the Keyboard-Layout Resource</H2>
 <A NAME=MARKER-2-73></A>During the process of key translation, the Event Manager <CODE>KeyTranslate</CODE> function applies the virtual key code and the state of the modifier keys to the keyboard-layout resource to determine a character code. <A HREF=Text-571.html#MARKER-9-12>Table C-2 on page C-6</A> shows the meanings of the keyboard modifier bits in the high-order byte of the <CODE>modifiers</CODE> field of an event record (defined by the <CODE>EventRecord</CODE> data type). The <CODE>KeyTranslate</CODE> function uses the byte value determined by the settings of these bits to control the selection of tables in the keyboard-layout resource.<P>
 <A HREF=#MARKER-9-76>Figure C-7</A> gives an overview of how the parts of the keyboard-layout resource are <BR>used. It starts when the user presses a key or combination of keys, and the Event Manager passes the virtual key code and the state of the modifier keys to the <CODE>KeyTranslate</CODE> function:<P>
<OL>
<LI>First, <CODE>KeyTranslate</CODE> treats the modifier state information--8 bits, each bit indicating the state of one modifier key--as a byte whose value is used as an index into the 256-byte table-selection index to get a table code. The table code specifies which <BR>of the 128-byte character-mapping tables to use to map the virtual key code to a character code.
<LI><CODE>KeyTranslate</CODE> uses the virtual key code as an index into the selected character-mapping table. If the table has a nonzero entry for the virtual key code, that entry is the desired character code. <CODE>KeyTranslate</CODE> returns that character code and the Event Manager posts a key-down event--<I>unless</I> the previous keypress had been a dead key. See step 4.
<LI>If the entry in the character-mapping table is 0, <CODE>KeyTranslate</CODE> searches the dead-key table. It looks for a match with both the virtual key code and the table number fields in a dead-key record. If there is no match, <CODE>KeyTranslate</CODE> returns 0. If there is a match,the dead-key information is preserved in the <CODE>state</CODE> parameter of the <CODE>KeyTranslate</CODE> function. <CODE>KeyTranslate</CODE> returns 0, so no event is posted, but the state information affects how the next virtual key code is to be processed.
<LI><A NAME=MARKER-2-74></A>If the previous key was a dead key, <CODE>KeyTranslate</CODE> searches the completion table in the dead-key record corresponding to the previous keypress. If the character code of the current keypress matches the first byte of any completion record in the completion table, the second byte in the record is substituted for it. If it does not match any first bytes in the completion table, the current character code is preceded by the no-match character found at the end of the dead key record and <CODE>KeyTranslate</CODE> returns both characters.<P>
<A NAME=MARKER-2-94></A>For instance, in the U.S. keyboard-layout resource the Option-E combination is a dead key. When pressed, no character appears on the screen, but the <CODE>state</CODE> parameter of <CODE>KeyTranslate</CODE> is modified to hold the information that the dead key for the acute accent (\xA5) has been pressed. If the next character is a valid completer key (such as a, e, i, o, or u), <CODE>KeyTranslate</CODE> returns the equivalent substitution character (&aacute;, &eacute;, &iacute;, &oacute;, &uacute;), an event is posted, and the character appears on the screen. If the next character is not a valid completer (for example, x), <CODE>KeyTranslate</CODE> returns <I>both</I> the no-match character (typically the accent character by itself) and the current character code; two events are posted, and both characters appear on the screen (\xA5x).<P>
</OL>
 As far as your application is concerned, no event is generated by pressing a dead key. The only information you receive regarding the dead key is after the fact. When the user produces "&Aacute;" by pressing Option-E followed by "A", you receive a single event containing a virtual key code corresponding to "A", no modifiers, and a character <BR>code of "&Aacute;".<P>
<B>Figure C-7  <A NAME=MARKER-9-76></A><A NAME=MARKER-21-77></A>Inside the keyboard-layout resource</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/KR_L-14.jpg">
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-583.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-585.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
