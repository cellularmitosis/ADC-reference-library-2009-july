<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Core Image Programming Guide: Using Core Image Filters</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using Core Image Filters"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001185-CH203" title="Using Core Image Filters"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../ci_intro/ci_intro.html#//apple_ref/doc/uid/TP30001185-CH201-TPXREF101">Core Image Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ci_concepts/ci_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ci_custom_filters/ci_custom_filters.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001185-CH203-TPXREF101" title="Using Core Image Filters"></a><h1>Using Core Image Filters</h1><p>Apple provides more than 100 image processing filters with Core Image. It’s easy for any developer who wants to support image processing in an application to use these built-in filters. It’s just as easy to use third-party image processing filters, as long as these filters are packaged as an image unit and installed in an appropriate location. </p><p>This chapter shows how to perform a variety of tasks related to applying filters to images:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-SW4">“Adding the Quartz Core Framework”</a></span> describes how to include Core Image in your Xcode project.</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-SW2">“Loading Image Units”</a></span> tells how to load third-party image units. (If you want to create an image unit, see <span class="content_text"><a href="../ci_image_units/ci_image_units.html#//apple_ref/doc/uid/TP30001185-CH208-SW12">“Packaging Filters as Image Units”</a></span> and <em><a href="../../ImageUnitTutorial/index.html#//apple_ref/doc/uid/TP40004531" target="_top">Image Unit Tutorial</a></em>.)</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJFBJDI">“Getting a List of Filters and Attributes”</a></span> describes how to programmatically find out which filters are available and what the attributes of each filter are.</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDDCEE">“Processing an Image”</a></span> shows the basics of applying a filter to a single image.</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJGIDBF">“Using Transition Effects”</a></span> discusses how to use filters that are applied over time to create such effects as fades and dissolves.</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJIBEIF">“Imaging Dynamical Systems”</a></span> describes how to accumulate the effect of a filter.</p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDAHAD">“Applying a Filter to Video”</a></span> discusses what’s needed to apply a Core Image filter to a video stream.</p></li></ul><a name="//apple_ref/doc/uid/TP30001185-CH203-SW4" title="Adding the Quartz Core Framework"></a><h2>Adding the Quartz Core Framework</h2><p>To use Core Image in Xcode, you need to import the Quartz Core framework. To import this frameworks in Xcode:</p><ol class="ol"><li class="li"><p>Open Xcode and create a Cocoa application.</p></li><li class="li"><p>Choose Project > Add to Project.</p></li><li class="li"><p>Navigate to <code>System/Library/Frameworks</code>, choose the QuartzCore.framework and click Add. </p></li><li class="li"><p>In the sheet that appears, click Add.</p></li></ol><a name="//apple_ref/doc/uid/TP30001185-CH203-SW2" title="Loading Image Units"></a><h2>Loading Image Units</h2><p>The built-in filters supplied by Apple are loaded automatically. The only filters you need to load are third-party filters packaged as image units. An image unit, which is simply a bundle, can contain one or more image processing filters. If the image unit is installed in one of the locations shown in <span class="content_text">Table 2-1</span>, then it can be used by any application that calls one of the <code>load</code> methods provided by the <code>CIPlugin</code> class and shown in <span class="content_text">Table 2-1</span>. You need to load image units only once. For example, to load all globally installed image units, you could add the following line of code to an initialization routine in your application.</p><div class="codesample"><table><tr><td scope="row"><pre>  [CIPlugIn loadAllPlugIns];<span></span></pre></td></tr></table></div><p>After calling the <code>load</code> method, you proceed the same as you would for using any of the image processing filters provided by Apple.  Follow the instructions in the rest of this chapter.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-SW1" title="Table 2-1Methods used to load image units"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Methods used to load image units</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Method</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comment</p></th></tr><tr><td  scope="row"><p><code>loadAllPlugIns</code></p></td><td ><p>Scans image unit directories (<code>/Library/Graphics/Image Units</code> and <code>~/Library/Graphics/Image Units</code>) for files that have the <code>.plugin</code> extension and then loads the image unit.</p></td></tr><tr><td  scope="row"><p><code>loadNonExecutablePlugIns</code></p></td><td ><p>Scans image unit directories (<code>/Library/Graphics/Image Units</code> and <code>~/Library/Graphics/Image Units</code>) for files that have the <code>.plugin</code> extension and then loads only the kernels of the image unit. That is, it loads only those files that have the <code>.cikernel</code> extension. This call does not execute any of the image unit code.</p></td></tr><tr><td  scope="row"><p><code>loadPlugIn:allowNonExecutable:</code></p></td><td ><p>Loads the image unit at the location specified by the <code>url</code> argument. Pass <code>true</code> for the <code>allowNonExecutable</code> argument if you want to load only the kernels of the image unit without executing any of the image unit code. </p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJFBJDI" title="Getting a List of Filters and Attributes"></a><h2>Getting a List of Filters and Attributes</h2><p>Core Image has two methods you can use to discover exactly which filters are available—<code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterNamesInCategory:" target="_top">filterNamesInCategory:</a></code> and <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterNamesInCategories:" target="_top">filterNamesInCategories:</a></code>. Filters are categorized to make the list more manageable. If you know a filter category, you can find out the filters available for that category by calling the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterNamesInCategory:" target="_top">filterNamesInCategory:</a></code> and supplying one of the category constants listed in <span class="content_text">Table 2-2</span>, <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BCIIBJDB">Table 2-3</a></span>, or <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BCICDDGI">Table 2-4</a></span>.</p><p>If you want to find all available filters for a list of categories, you can call the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterNamesInCategories:" target="_top">filterNamesInCategories:</a></code>, supplying an array of category constants from those listed in the tables. The method returns an <code>NSArray</code> object populated with the filter names for each category. You can obtain a list of all filters for all categories by supplying <code>nil</code> instead of an array of category constants. </p><p>A filter can be a member of more than one category. A category can specify:</p><ul class="ul"><li class="li"><p>The type of effect produced by the filter (color adjustment, distortion, and so forth). See <span class="content_text">Table 2-2</span>.</p></li><li class="li"><p>The usage of the filter (still image, video, high dynamic range, and so forth). See <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BCIIBJDB">Table 2-3</a></span>.</p></li><li class="li"><p>Whether the filter is provided by Core Image (built-in). See <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BCICDDGI">Table 2-4</a></span>.</p></li></ul><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJEGAIC" title="Table 2-2Filter category constants for effect types"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>Filter category constants for effect types</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Effect type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Indicates</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryDistortionEffect" target="_top">kCICategoryDistortionEffect</a></code></p></td><td ><p>Distortion effects, such as bump, twirl, hole</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryGeometryAdjustment" target="_top">kCICategoryGeometryAdjustment</a></code></p></td><td ><p>Geometry adjustment, such as affine transform, crop, perspective transform</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryCompositeOperation" target="_top">kCICategoryCompositeOperation</a></code></p></td><td ><p>Compositing, such as source over, minimum, source atop, color dodge blend mode</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryHalftoneEffect" target="_top">kCICategoryHalftoneEffect</a></code></p></td><td ><p>Halftone effects, such as screen, line screen, hatched</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryColorAdjustment" target="_top">kCICategoryColorAdjustment</a></code></p></td><td ><p>Color adjustment, such as gamma adjust, white point adjust, exposure</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryColorEffect" target="_top">kCICategoryColorEffect</a></code></p></td><td ><p>Color effect, such as hue adjust, posterize</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryTransition" target="_top">kCICategoryTransition</a></code></p></td><td ><p>Transitions between images, such as dissolve, disintegrate with mask, swipe</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryTileEffect" target="_top">kCICategoryTileEffect</a></code></p></td><td ><p>Tile effect, such as parallelogram, triangle, op</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryGenerator" target="_top">kCICategoryGenerator</a></code></p></td><td ><p>Image generator, such as stripes, constant color, checkerboard</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryGradient" target="_top">kCICategoryGradient</a></code></p></td><td ><p>Gradient, such as axial, radial, Gaussian</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryStylize" target="_top">kCICategoryStylize</a></code></p></td><td ><p>Stylize, such as pixellate, crystallize</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategorySharpen" target="_top">kCICategorySharpen</a></code></p></td><td ><p>Sharpen, luminance</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryBlur" target="_top">kCICategoryBlur</a></code></p></td><td ><p>Blur, such as Gaussian, zoom, motion</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BCIIBJDB" title="Table 2-3Filter category constants for filter usage"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-3&nbsp;&nbsp;</strong>Filter category constants for filter usage</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use </p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Indicates</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryStillImage" target="_top">kCICategoryStillImage</a></code></p></td><td ><p>Can be used for still images</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryInterlaced" target="_top">kCICategoryInterlaced</a></code></p></td><td ><p>Can be used for interlaced images</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryNonSquarePixels" target="_top">kCICategoryNonSquarePixels</a></code></p></td><td ><p>Can be used for nonsquare pixels</p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryHighDynamicRange" target="_top">kCICategoryHighDynamicRange</a></code></p></td><td ><p>Can be used for high-dynamic range pixels</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BCICDDGI" title="Table 2-4Filter category constants for filter origin"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-4&nbsp;&nbsp;</strong>Filter category constants for filter origin</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Filter origin</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Indicates</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/doc/c_ref/kCICategoryBuiltIn" target="_top">kCICategoryBuiltIn</a></code></p></td><td ><p>A filter provided by Core Image</p></td></tr></table></div><p>After you obtain a list of filter names, you can retrieve the attributes for a filter by creating a <code>CIFilter</code> object and calling the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/instm/CIFilter/attributes" target="_top">attributes</a></code> as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>CIFilter *myFilter;<span></span></pre></td></tr><tr><td scope="row"><pre>NSDictionary *myFilterAttributes;<span></span></pre></td></tr><tr><td scope="row"><pre>myFilter = [CIFilter filterWithName:@"CIExposureFilter"];<span></span></pre></td></tr><tr><td scope="row"><pre>myFilterAttributes = [myFilter attributes];<span></span></pre></td></tr></table></div><p>You replace the string “CIExposureFilter” with the name of the filter you are interested in. Attributes include such things as name, categories, class, minimum, and maximum. See <em><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/index.html#//apple_ref/doc/uid/TP40003960" target="_top">CIFilter Class Reference</a></em> for the complete list of attributes that can be returned.</p><p>Filter names and attributes provide all the information you need to build a user interface that allows users to choose a filter and control its input parameters. The attributes for a filter tell you how many input parameters the filter has, the parameter names, the data type, and the minimum, maximum, and default values. </p><p><span class="content_text">Listing 2-1</span> shows code that gets filter names and builds a dictionary of filters by functional categories. The code retrieves filters in these categories—<code>kCICategoryGeometryAdjustment</code>, <code>kCICategoryDistortionEffect</code>, <code>kCICategorySharpen</code>, and <code>kCICategoryBlur</code>—but builds the dictionary based on application-defined functional categories—Distortion and Focus. Functional categories are useful for organizing filter names in a menu that makes sense for the user. The code does not iterate through all possible Core Image filter categories, but you can easily extend this code by following the same process.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJCCHCE" title="Listing 2-1Code that builds a dictionary of filters by functional categories"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Code that builds a dictionary of filters by functional categories</p><div class="codesample"><table><tr><td scope="row"><pre>categories = [[NSMutableDictionary alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>NSMutableArray  *array;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>array = [NSMutableArray arrayWithArray:<span></span></pre></td></tr><tr><td scope="row"><pre>            [CIFilter filterNamesInCategory:<span></span></pre></td></tr><tr><td scope="row"><pre>                 kCICategoryGeometryAdjustment]];<span></span></pre></td></tr><tr><td scope="row"><pre>[array addObjectsFromArray:<span></span></pre></td></tr><tr><td scope="row"><pre>            [CIFilter filterNamesInCategory:<span></span></pre></td></tr><tr><td scope="row"><pre>                 kCICategoryDistortionEffect]];<span></span></pre></td></tr><tr><td scope="row"><pre>[categories setObject: [self buildFilterDictionary: array]<span></span></pre></td></tr><tr><td scope="row"><pre>             forKey: @"Distortion"];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>array = [NSMutableArray arrayWithArray:<span></span></pre></td></tr><tr><td scope="row"><pre>            [CIFilter filterNamesInCategory: kCICategorySharpen]];<span></span></pre></td></tr><tr><td scope="row"><pre>[array addObjectsFromArray:<span></span></pre></td></tr><tr><td scope="row"><pre>            [CIFilter filterNamesInCategory: kCICategoryBlur]];<span></span></pre></td></tr><tr><td scope="row"><pre>[categories setObject: [self buildFilterDictionary: array]<span></span></pre></td></tr><tr><td scope="row"><pre>             forKey:@"Focus"];<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 2-2</span> shows the <code>buildFilterDictionary</code> routine called in <span class="content_text">Listing 2-1</span>. This routine builds a dictionary of attributes for each of the filters in a functional category. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJIBGDE" title="Listing 2-2Building a dictionary of filters by functional name"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Building a dictionary of filters by functional name</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSMutableDictionary *)buildFilterDictionary: (NSArray *)names<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableDictionary  *td, *catfilters;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDictionary         *attr;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString             *classname;<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter             *filter;<span></span></pre></td></tr><tr><td scope="row"><pre>    int                   i;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catfilters = [NSMutableDictionary dictionary];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for(i=0 ; i&lt;[names count] ; i++)<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        classname = [names objectAtIndex: i];<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        filter = [CIFilter filterWithName: classname];<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if(filter)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            attr = [filter attributes];<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            td   = [NSMutableDictionary dictionary];<span></span></pre></td></tr><tr><td scope="row"><pre>            [td setObject: classname forKey: @"class"];<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            [catfilters setObject: td<span></span></pre></td></tr><tr><td scope="row"><pre>                         forKey:[attr objectForKey:@"name"]];<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            NSLog(@" could not create '%@' filter", classname);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return catfilters;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Takes an array of filter names as an input parameter. Recall from <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJCCHCE">Listing 2-1</a></span> that this array can be a concatenation of filter names from more than one Core Image filter category. In this example, the array is based upon functional categories set up by the application (Distortion or Focus).</p></li><li class="li"><p>Iterates through the array for each filter name in the array.</p></li><li class="li"><p>Retrieves the filter name from the names array.</p></li><li class="li"><p>Retrieves the filter object for the filter name.</p></li><li class="li"><p>Retrieves the attributes dictionary for a filter.</p></li><li class="li"><p>Sets the name of the filter attributes dictionary.</p></li><li class="li"><p>Adds the filter attribute dictionary for that filter to the category filter dictionary.</p></li></ol><p>If your application provides a user interface, it can consult a filter dictionary to create and update the user interface. For example, filter attributes that are Boolean would require a checkbox or similar user interface element, and attributes that vary continuously over a range could use a slider. You can use the maximum and minimum values as the basis for text labels. The default attribute setting would dictate the initial setting in the user interface.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001185-CH203-SW5" title="Note"></a><p><strong>Note:</strong>&nbsp;Applications that run in Mac OS X v10.5 and later can use the CIFilter Image Kit additions to provide a filter browser and a view for setting filter input parameters. See <em><a href="../../../Reference/IKFilterUIAddition/index.html#//apple_ref/doc/uid/TP40004667" target="_top">CIFilter Image Kit Additions</a></em> and <em><a href="../../ImageKitProgrammingGuide/index.html#//apple_ref/doc/uid/TP40004907" target="_top">Image Kit Programming Guide</a></em>. </p>A client that hosts an image unit should not display user interface elements for a filter that has unknown data types or classes. This ensures that image unit host applications will work in the future if new data types and classes are added to the API. </p></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDDCEE" title="Processing an Image"></a><h2>Processing an Image</h2><p>You can apply Core Image filters to images in any format supported by Mac OS X which, in Mac OS X v10.5 and later, includes RAW image data (see “RAW Image Options” in <em><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/index.html#//apple_ref/doc/uid/TP40003960" target="_top">CIFilter Class Reference</a></em>).</p><p>The steps to process an image with a Core Image filter are:</p><ol class="ol"><li class="li"><p>Create a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/cl/CIContext" target="_top">CIContext</a></code> object. </p></li><li class="li"><p>Get the image to process. </p></li><li class="li"><p>Create a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/cl/CIFilter" target="_top">CIFilter</a></code> object for the filter to apply to the image.</p></li><li class="li"><p>Set the default values for the filter.</p></li><li class="li"><p>Set the filter parameters.</p></li><li class="li"><p>Apply one or more filters.</p></li><li class="li"><p>Draw the processed image.</p></li></ol><p>The details for performing each step are in the sections that follow. You’ll see how to apply three filters to the image shown in <span class="content_text">Figure 2-1</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDCEDH" title="Figure 2-1The original image"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>The original image</p><img src = "../art/no_filter.gif" alt = "The original image" width="271" height="223"></div><br/><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJHFEBG" title="Create a Core Image Context"></a><h3>Create a Core Image Context</h3><p>In Core Image, images are evaluated to a Core Image context which represents a drawing destination. You can create a Core Image context:</p><ul class="spaceabove"><li class="li"><p>By calling the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/Reference/Reference.html#//apple_ref/occ/instm/NSGraphicsContext/CIContext" target="_top">CIContext</a></code> method of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/Reference/Reference.html#//apple_ref/occ/cl/NSGraphicsContext" target="_top">NSGraphicsContext</a></code> class</p></li><li class="li"><p>From a Quartz 2D graphics context</p></li><li class="li"><p>From an OpenGL graphics context</p></li></ul><p>You create one Core Image context per window rather than one per view.</p><p>The <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/Reference/Reference.html#//apple_ref/occ/instm/NSGraphicsContext/CIContext" target="_top">CIContext</a></code> method of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/Reference/Reference.html#//apple_ref/occ/cl/NSGraphicsContext" target="_top">NSGraphicsContext</a></code> class returns a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/cl/CIContext" target="_top">CIContext</a></code> object that you can use to render into the <code>NSGraphicsContext</code> object. The <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/cl/CIContext" target="_top">CIContext</a></code> object is created on demand and remains in existence for the lifetime of its owning <code>NSGraphicsContext</code> object. You create the Core Image context using a line of code similar to the following:</p><p><code>[[NSGraphicsContext currentContext] CIContext]</code></p><p>For more information on this method, see <em><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/index.html#//apple_ref/doc/uid/TP40004049" target="_top">NSGraphicsContext Class Reference</a></em>.</p><p>You can create a Core Image context from a Quartz 2D graphics context using code similar to that shown in <span class="content_text">Listing 2-3</span>, which is an excerpt from the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/drawRect:" target="_top">drawRect:</a></code> method in a Cocoa application. You get the current <code>NSGraphicsContext</code>, convert that to a Quartz 2D graphics context (<code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/tdef/CGContextRef" target="_top">CGContextRef</a></code>), and then provide the Quartz 2D graphics context as an argument to the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/clm/CIContext/contextWithCGContext:options:" target="_top">contextWithCGContext:options:</a></code> method of the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/cl/CIContext" target="_top">CIContext</a></code> class. For information on Quartz 2D graphics contexts, see <em><a href="../../drawingwithquartz2d/index.html#//apple_ref/doc/uid/TP30001066" target="_top">Quartz 2D Programming Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJIADGI" title="Listing 2-3Creating a Core Image context from a Quartz 2D graphics context"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Creating a Core Image context from a Quartz 2D graphics context</p><div class="codesample"><table><tr><td scope="row"><pre>if(context == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    context = [CIContext contextWithCGContext:<span></span></pre></td></tr><tr><td scope="row"><pre>                    [[NSGraphicsContext currentContext] graphicsPort]<span></span></pre></td></tr><tr><td scope="row"><pre>                    options: nil]<span></span></pre></td></tr><tr><td scope="row"><pre>    [context retain];}<span></span></pre></td></tr></table></div><p>The code in <span class="content_text">Listing 2-4</span> shows how to set up a Core Image context from the current OpenGL graphics context. It’s important  that the pixel format for the context includes the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSOpenGLPixelFormat_Class/Reference/Reference.html#//apple_ref/c/econst/NSOpenGLPFANoRecovery" target="_top">NSOpenGLPFANoRecovery</a></code> constant as an attribute. Otherwise Core Image may not be able to create another context that share textures with this one. You must also make sure that you pass a pixel format whose data type is <code><a href="../../../Reference/CGL_OpenGL/Reference/reference.html#//apple_ref/c/tdef/CGLPixelFormatObj" target="_top">CGLPixelFormatObj</a></code>, as shown in the listing. For more information on pixel formats and OpenGL, see <em><a href="../../OpenGL-MacProgGuide/index.html#//apple_ref/doc/uid/TP40001987" target="_top">OpenGL Programming Guide for Mac OS X</a></em>.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJBGABC" title="Listing 2-4Creating a Core Image context from an OpenGL graphics context"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Creating a Core Image context from an OpenGL graphics context</p><div class="codesample"><table><tr><td scope="row"><pre>CIContext *myCIContext;<span></span></pre></td></tr><tr><td scope="row"><pre>const NSOpenGLPixelFormatAttribute attr[] = {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSOpenGLPFAAccelerated,<span></span></pre></td></tr><tr><td scope="row"><pre>        NSOpenGLPFANoRecovery,<span></span></pre></td></tr><tr><td scope="row"><pre>        NSOpenGLPFAColorSize, 32,<span></span></pre></td></tr><tr><td scope="row"><pre>        0<span></span></pre></td></tr><tr><td scope="row"><pre>    };<span></span></pre></td></tr><tr><td scope="row"><pre>pf = [[NSOpenGLPixelFormat alloc] initWithAttributes:(void *)&amp;attr];<span></span></pre></td></tr><tr><td scope="row"><pre>myCIContext = [CIContext contextWithCGLContext: CGLGetCurrentContext()<span></span></pre></td></tr><tr><td scope="row"><pre>                                pixelFormat: [pf CGLPixelFormatObj]<span></span></pre></td></tr><tr><td scope="row"><pre>                                options: nil];<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-SW6" title="Get the Image to Process"></a><h3>Get the Image to Process</h3><p>Core Image filters process Core Image images (<code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/cl/CIImage" target="_top">CIImage</a></code> objects). <span class="content_text">Table 2-5</span> lists the methods that create a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/cl/CIImage" target="_top">CIImage</a></code> object. The method you use depends on the source of the image. Keep in mind that a <code>CIImage</code> object is really an image recipe; Core Image doesn’t actually produce any pixels until it’s called on to render results to a destination.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJJHBDA" title="Table 2-5Methods used to create an image"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-5&nbsp;&nbsp;</strong>Methods used to create an image</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Image source</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Methods</p></th></tr><tr><td  scope="row"><p>URL</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithContentsOfURL:" target="_top">imageWithContentsOfURL:</a></code></p><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithContentsOfURL:options:" target="_top">imageWithContentsOfURL:options:</a></code></p></td></tr><tr><td  scope="row"><p>Quartz 2D image (<code><a href="../../../Reference/CGImage/Reference/reference.html#//apple_ref/c/tdef/CGImageRef" target="_top">CGImageRef</a></code>)</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCGImage:" target="_top">imageWithCGImage:</a></code></p><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCGImage:options:" target="_top">imageWithCGImage:options:</a></code></p></td></tr><tr><td  scope="row"><p>Quartz 2D layer (<code><a href="../../../Reference/CGLayer/Reference/reference.html#//apple_ref/c/tdef/CGLayerRef" target="_top">CGLayerRef</a></code>)</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCGLayer:" target="_top">imageWithCGLayer:</a></code></p><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCGLayer:options:" target="_top">imageWithCGLayer:options:</a></code></p></td></tr><tr><td  scope="row"><p>OpenGL texture</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithTexture:size:flipped:colorSpace:" target="_top">imageWithTexture:size:flipped:colorSpace:</a></code></p></td></tr><tr><td  scope="row"><p>Bitmap data</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithBitmapData:bytesPerRow:size:format:colorSpace:" target="_top">imageWithBitmapData:bytesPerRow:size:format:colorSpace:</a></code></p><p><code><!--a target="_top" -->imageWithImageProvider:size:width:format:colorSpace:options:<!--/a--></code></p></td></tr><tr><td  scope="row"><p>NSCIImageRep</p></td><td ><p><code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/CIImage_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/CIImage/initWithBitmapImageRep:" target="_top">initWithBitmapImageRep:</a></code> See <span class="content_text"><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSCIImageRep_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40001602" target="_top">NSCIImageRep</a></span> for more information on this Application Kit addition.</p></td></tr><tr><td  scope="row"><p>Encoded data (an image in memory)</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithData:" target="_top">imageWithData:</a></code></p><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithData:options:" target="_top">imageWithData:options:</a></code></p></td></tr><tr><td  scope="row"><p>CVImageBuffer</p></td><td ><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCVImageBuffer:" target="_top">imageWithCVImageBuffer:</a></code></p><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/clm/CIImage/imageWithCVImageBuffer:options:" target="_top">imageWithCVImageBuffer:options:</a></code></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-SW3" title="Create, Set Up, and Apply Filters"></a><h3>Create, Set Up, and Apply Filters</h3><p><span class="content_text">Listing 2-5</span> shows how to create, set up, and apply a hue filter. You use the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterWithName:" target="_top">filterWithName:</a></code> method to create a filter whose type is specified by the <code>name</code> argument. The hue adjust filter is named CIHueAdjust. You can obtain a list of filter names by following the instructions in <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJFBJDI">“Getting a List of Filters and Attributes”</a></span> or you can look up a filter name in <em><a href="../../../Reference/CoreImageFilterReference/index.html#//apple_ref/doc/uid/TP40004346" target="_top">Core Image Filter Reference</a></em>.  The input values for a filter are undefined when you first create it, which is why you either need to call the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/instm/CIFilter/setDefaults" target="_top">setDefaults</a></code> method to set the default values or supply values for all input parameters at the time you create the filter by calling the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterWithName:keysAndValues:" target="_top">filterWithName:keysAndValues:</a></code>.</p><p>If you don’t know the input parameters for a filter, you can get an array of them using the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/instm/CIFilter/inputKeys" target="_top">inputKeys</a></code>. (Or, you can look up the input parameters for most of the built-in filters in <em><a href="../../../Reference/CoreImageFilterReference/index.html#//apple_ref/doc/uid/TP40004346" target="_top">Core Image Filter Reference</a></em>.) Set a value for each input parameter whose default value you want to change by calling the method <code>setValue:forKey:</code>. </p><p><span class="content_text">Listing 2-5</span> sets two input parameters—the input image and the input angle. Filters, except for generator filters, require an input image. Some require two or more images or textures. The input angle for the hue adjustment filter refers to the location of the hue in the HSV and HLS color spaces. This is an angular measurement that can vary from 0.0 to 2 pi. A value of 0 indicates the color red; the color green corresponds to 2/3 pi radians, and the color blue is 4/3 pi radians.</p><p>The last line in <span class="content_text">Listing 2-5</span> requests the value that corresponds to the <code>outputImage</code> key. When you request the output image, Core Image evaluates the input parameters and stores the calculations necessary to produce the resulting image. The image is not actually rendered. You can apply another filter and continue the process of applying filters until you want to render the result.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJBFIDD" title="Listing 2-5Creating, setting up, and applying a hue filter"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Creating, setting up, and applying a hue filter</p><div class="codesample"><table><tr><td scope="row"><pre>hueAdjust = [CIFilter filterWithName:@"CIHueAdjust"];<span></span></pre></td></tr><tr><td scope="row"><pre>[hueAdjust setDefaults];<span></span></pre></td></tr><tr><td scope="row"><pre>[hueAdjust setValue: myCIImage forKey: @"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>[hueAdjust setValue: [NSNumber numberWithFloat: 2.094]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputAngle"];<span></span></pre></td></tr><tr><td scope="row"><pre>result = [hueAdjust valueForKey: @"outputImage"];<span></span></pre></td></tr></table></div><p>If you use one of the Core Image draw methods to render the output image from  <span class="content_text">Listing 2-5</span>, you’ll see what’s shown in <span class="content_text">Figure 2-2</span>. Next you’ll see how to apply two more filters to the image—gloom (CIGloom) and bump distortion (CIBumpDistortion).</p><p>The gloom filter does just that—makes an image gloomy by dulling its highlights. Notice that the code in <span class="content_text">Listing 2-6</span> is very similar to that shown in <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJBFIDD">Listing 2-5</a></span>. It creates a filter and sets default values for the gloom filter. This time, the input image is the output image from the hue adjustment filter. It’s that easy to chain filters together!</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJFJJGJ" title="Figure 2-2The image after applying the color controls filter"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>The image after applying the color controls filter</p><img src = "../art/one_filter.gif" alt = "The image after applying the color controls filter" width="311" height="255"></div><br/><p>The gloom filter has two input parameters. Rather than use the default values, which you could do, the code sets the input radius to <code>25</code> and the input intensity to <code>0.75</code>. The input radius specifies the extent of the effect, and can vary from 0 to 100 with a default value of 10. Recall that you can find the minimum, maximum, and default values for a filter programmatically by retrieving the attribute dictionary for the filter. </p><p>The input intensity is a scalar value that specifies a linear blend between the filter output and the original image. The minimum is 0.0, the maximum is 1.0, and the default value is 1.0.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJEJAIC" title="Listing 2-6Creating, setting up, and applying a gloom filter"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>Creating, setting up, and applying a gloom filter</p><div class="codesample"><table><tr><td scope="row"><pre>gloom = [CIFilter filterWithName:@"CIGloom"];<span></span></pre></td></tr><tr><td scope="row"><pre>[gloom setDefaults];<span></span></pre></td></tr><tr><td scope="row"><pre>[gloom setValue: result forKey: @"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>[gloom setValue: [NSNumber numberWithFloat: 25]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputRadius"];<span></span></pre></td></tr><tr><td scope="row"><pre>[gloom setValue: [NSNumber numberWithFloat: 0.75]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputIntensity"];<span></span></pre></td></tr><tr><td scope="row"><pre>result = [gloom valueForKey: @"outputImage"];<span></span></pre></td></tr></table></div><p>The code requests the output image but does not draw the image. You’ll see how to draw the image in the next section. <span class="content_text">Figure 2-2</span> shows what the image would look like if you drew it at this point after processing it with both the hue adjustment and gloom filters.</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-SW7" title="Figure 2-3The image after applying the hue adjustment and gloom filters"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>The image after applying the hue adjustment and gloom filters</p><img src = "../art/hue_and_gloom.gif" alt = "The image after applying the hue adjustment and gloom filters" width="318" height="259"></div><br/><p>The bump distortion filter (CIBumpDistortion) creates a bulge in an image that originates at a specified point. <span class="content_text">Listing 2-7</span> shows how to create, set up, and apply this filter to the output image from the previous filter, the gloom filter. By now you should be an expert. First, create the filter by providing its name. Then, set the defaults and set the input image to the previous result. The bump distortion takes three parameters: a location that specifies the center of the effect, the radius of the effect, and the input scale. The input scale specifies the direction and the amount of the effect. The default value is –0.5. The range is –10.0 through 10.0. A value of 0 specifies no effect. A negative value creates an outward bump; a positive value creates an inward bump.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJBGEJJ" title="Listing 2-7Creating, setting up, and applying the bump distortion filter"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Creating, setting up, and applying the bump distortion filter</p><div class="codesample"><table><tr><td scope="row"><pre>bumpDistortion = [CIFilter filterWithName:@"CIBumpDistortion"];<span></span></pre></td></tr><tr><td scope="row"><pre>[bumpDistortion setDefaults];<span></span></pre></td></tr><tr><td scope="row"><pre>[bumpDistortion setValue: result forKey: @"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>[bumpDistortion setValue: [CIVector vectorWithX:200 Y:150  ]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputCenter"];<span></span></pre></td></tr><tr><td scope="row"><pre>[bumpDistortion setValue: [NSNumber numberWithFloat: 100]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputRadius"];<span></span></pre></td></tr><tr><td scope="row"><pre>[bumpDistortion setValue: [NSNumber numberWithFloat:  3.0]<span></span></pre></td></tr><tr><td scope="row"><pre>                    forKey: @"inputScale"];<span></span></pre></td></tr><tr><td scope="row"><pre>result = [bumpDistortion valueForKey: @"outputImage"];<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-SW8" title="Draw the Result"></a><h3>Draw the Result</h3><p>Drawing the result triggers the processor-intensive operations (GPU or CPU). Core Image provides two methods for drawing:</p><ul class="spaceabove"><li class="li"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/instm/CIContext/drawImage:atPoint:fromRect:" target="_top">drawImage:atPoint:fromRect:</a></code>, which renders a region of an image to a point in the context destination.</p></li><li class="li"><p><code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/instm/CIContext/drawImage:inRect:fromRect:" target="_top">drawImage:inRect:fromRect:</a></code>, which renders a region of an image to a rectangle in the context destination.</p></li></ul><p>The following code renders the hue-adjusted, gloom-filtered, bump-distorted image from the previous section:</p><div class="codesample"><table><tr><td scope="row"><pre>[myCIContext  drawImage: result<span></span></pre></td></tr><tr><td scope="row"><pre>                atPoint: CGPointZero<span></span></pre></td></tr><tr><td scope="row"><pre>               fromRect: contextRect];<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 2-4</span> shows the rendered image. In this case, Core Image draws the image at <code>(0,0)</code>, which is <code>CGPointZero</code>, and draws into the entire context destination. </p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJJDHAH" title="Figure 2-4The image after applying the hue adjustment, gloom, and bump distortion filters"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>The image after applying the hue adjustment, gloom, and bump distortion filters</p><img src = "../art/color_gloom_bump.gif" alt = "The image after applying the hue adjustment, gloom, and bump distortion filters" width="319" height="261"></div><br/><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJGIDBF" title="Using Transition Effects"></a><h2>Using Transition Effects</h2><p>Transitions are typically used between images in a slide show or to switch from one scene to another in video. These effects are rendered over time and require that you set up a timer. This section shows how to set up and apply the copy machine transition filter—CICopyMachine—to two still images. The copy machine transition creates a light bar similar to what you see in a copy machine. The light bar sweeps across the initial image to reveal the target image. <span class="content_text">Figure 2-5</span> shows what this filter looks like before, partway through, and after the transition from an image of ski boots to an image of a skier.</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJFGHHA" title="Figure 2-5A copy machine transition from ski boots to a skier"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>A copy machine transition from ski boots to a skier</p><img src = "../art/transition.jpg" alt = "A copy machine transition from ski boots to a skier" ></div><br/><p>Transition filters require the following tasks:</p><ol class="ol"><li class="li"><p>Create Core Image images (<code><a href="../../../Reference/QuartzCoreFramework/Classes/CIImage_Class/Reference/Reference.html#//apple_ref/occ/cl/CIImage" target="_top">CIImage</a></code> objects) to use for the transition.</p></li><li class="li"><p>Set up and schedule a timer.</p></li><li class="li"><p>Create a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/cl/CIContext" target="_top">CIContext</a></code> object.</p></li><li class="li"><p>Create a <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/cl/CIFilter" target="_top">CIFilter</a></code> object for the filter to apply to the image. </p></li><li class="li"><p>Set the default values for the filter.</p></li><li class="li"><p>Set the filter parameters.</p></li><li class="li"><p>Set the source and the target images to process. </p></li><li class="li"><p>Calculate the time.</p></li><li class="li"><p>Apply the filter.</p></li><li class="li"><p>Draw the result.</p></li><li class="li"><p>Repeat steps 8–10 until the transition is complete.</p></li></ol><p>You’ll notice that many of these tasks are the same as those required to process an image using a filter other than a transition filter. What’s different is the need to set up a timer and to repeatedly draw the effect at various time intervals throughout the transition.</p><p>The <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSNibAwaking_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/awakeFromNib" target="_top">awakeFromNib</a></code> method, shown in <span class="content_text">Listing 2-8</span>, gets two images (<code>boots.jpg</code> and <code>skier.jpg</code>) and sets them as the source and target images. Using the <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSTimer_Class/Reference/NSTimer.html#//apple_ref/occ/cl/NSTimer" target="_top">NSTimer</a></code> class, a timer is set to repeat every 1/30 second. Note the variables <code>thumbnailWidth</code> and <code>thumbnailHeight</code>. These are used to constrain the rendered images to the view set up in Interface Builder.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001185-CH203-SW9" title="Note"></a><p><strong>Note:</strong>&nbsp; The <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSAnimation_Class/Reference/Reference.html#//apple_ref/occ/cl/NSAnimation" target="_top">NSAnimation</a></code> class, introduced in Mac OS X v10.4, implements timing for animation in Cocoa. If you use <code>NSAnimation</code> instead of <code>NSTimer</code>, you can set up more than one slide show to play transitions at the same time, using only one timing device. For more information see the documents <em><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSAnimation_Class/index.html#//apple_ref/doc/uid/TP40004002" target="_top">NSAnimation Class Reference</a></em>  and <em><a href="../../../../Cocoa/Conceptual/AnimationGuide/index.html#//apple_ref/doc/uid/TP40003592" target="_top">Animation Programming Guide for Cocoa</a></em>. See also the <em><a href="../../../../../samplecode/CIAnnotation/index.html#//apple_ref/doc/uid/DTS10003682" target="_top">CIAnnotation</a></em><em><a href="../../../../../samplecode/CIAnnotation/index.html#//apple_ref/doc/uid/DTS10003682" target="_top">CIAnnotation</a></em> sample application. </p></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJGAACJ" title="Listing 2-8Getting images and setting up a timer"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Getting images and setting up a timer</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTimer    *timer;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSURL      *url;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    thumbnailWidth  = 340.0;<span></span></pre></td></tr><tr><td scope="row"><pre>    thumbnailHeight = 240.0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    url   = [NSURL fileURLWithPath: [[NSBundle mainBundle]<span></span></pre></td></tr><tr><td scope="row"><pre>                    pathForResource: @"boots" ofType: @"jpg"]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setSourceImage: [CIImage imageWithContentsOfURL: url]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    url   = [NSURL fileURLWithPath: [[NSBundle mainBundle]<span></span></pre></td></tr><tr><td scope="row"><pre>                    pathForResource: @"skier" ofType: @"jpg"]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setTargetImage: [CIImage imageWithContentsOfURL: url]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    timer = [NSTimer scheduledTimerWithTimeInterval: 1.0/30.0<span></span></pre></td></tr><tr><td scope="row"><pre>                        target: self<span></span></pre></td></tr><tr><td scope="row"><pre>                        selector: @selector(timerFired:)<span></span></pre></td></tr><tr><td scope="row"><pre>                        userInfo: nil<span></span></pre></td></tr><tr><td scope="row"><pre>                        repeats: YES];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    base = [NSDate timeIntervalSinceReferenceDate];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSRunLoop currentRunLoop] addTimer: timer<span></span></pre></td></tr><tr><td scope="row"><pre>                                forMode: NSDefaultRunLoopMode];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSRunLoop currentRunLoop] addTimer: timer<span></span></pre></td></tr><tr><td scope="row"><pre>                                forMode: NSEventTrackingRunLoopMode];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You set up a transition filter just as you’d set up any other filter. <span class="content_text">Listing 2-9</span> uses the method <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/clm/CIFilter/filterWithName:" target="_top">filterWithName:</a></code> to create the filter. It then calls <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIFilter_Class/Reference/Reference.html#//apple_ref/occ/instm/CIFilter/setDefaults" target="_top">setDefaults</a></code> to initialize all input parameters. The code sets the extent to correspond with the thumbnail width and height that is declared in the <code>awakeFromNib:</code> method shown in <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJGAACJ">Listing 2-8</a></span>. </p><p>The routine uses the thumbnail variables to specify the center of the effect. For this example, the center of the effect is the center of the image, but it doesn’t have to be.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDAGFG" title="Listing 2-9Setting up the transition filter"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Setting up the transition filter</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)setupTransition<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CIVector  *extent;<span></span></pre></td></tr><tr><td scope="row"><pre>    float      w,h;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    w      = thumbnailWidth;<span></span></pre></td></tr><tr><td scope="row"><pre>    h      = thumbnailHeight;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    extent = [CIVector vectorWithX: 0  Y: 0  Z: w  W: h];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    transition  = [CIFilter filterWithName: @"CICopyMachineTransition"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [transition setDefaults];<span></span></pre></td></tr><tr><td scope="row"><pre>    [transition setValue: extent<span></span></pre></td></tr><tr><td scope="row"><pre>                forKey: @"inputExtent"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [transition   retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>drawRect:</code> routine for the copy machine transition effect is shown in <span class="content_text">Listing 2-10</span>. This routine sets up a rectangle that’s the same size as the view and then sets up a floating-point value for the rendering time. If the <code>CIContext</code> object hasn’t already been created, the routine creates one. If the transition is not yet set up, the routine calls the <code>setupTransition</code> method (see <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDAGFG">Listing 2-9</a></span>). Finally, the routine calls the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIContext_Class/Reference/Reference.html#//apple_ref/occ/instm/CIContext/drawImage:atPoint:fromRect:" target="_top">drawImage:atPoint:fromRect:</a></code> method, passing the image that should be shown for the rendering time. The <code>imageForTransition:</code> method, shown in <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJIEFCF">Listing 2-11</a></span>, applies the filter and returns the appropriate image for the rendering time.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJFIIGD" title="Listing 2-10The drawRect: method for the copy machine transition effect"></a><p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>The drawRect: method for the copy machine transition effect</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)drawRect: (NSRect)rectangle<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    float   t;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect  cg = CGRectMake(NSMinX(rectangle), NSMinY(rectangle),<span></span></pre></td></tr><tr><td scope="row"><pre>                    NSWidth(rectangle), NSHeight(rectangle));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    t   = 0.4*([NSDate timeIntervalSinceReferenceDate] - base);<span></span></pre></td></tr><tr><td scope="row"><pre>    if(context == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        context = [CIContext contextWithCGContext:<span></span></pre></td></tr><tr><td scope="row"><pre>                        [[NSGraphicsContext currentContext] graphicsPort]<span></span></pre></td></tr><tr><td scope="row"><pre>                             options: nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        [context retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if(transition == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>        [self setupTransition];<span></span></pre></td></tr><tr><td scope="row"><pre>     [context drawImage: [self imageForTransition: t + 0.1]<span></span></pre></td></tr><tr><td scope="row"><pre>                         atPoint: cg.origin<span></span></pre></td></tr><tr><td scope="row"><pre>                         fromRect: cg];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>imageForTransition:</code> method figures out, based on the rendering time, which image is the source image and which one is the target image. It’s set up to allow a transition to repeatedly loop. If your application applies a transition that doesn’t loop, it would not need the if-else construction shown in <span class="content_text">Listing 2-11</span>. </p><p>The routine sets the <code>inputTime</code> value based on the rendering time passed to the <code>imageForTransition:</code> method. It applies the transition, passing the output image from the transition to the crop filter (CICrop). Cropping ensures the output image fits in the view rectangle. The routine returns the cropped transition image to the <code>drawRect:</code> method, which then draws the image.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJIEFCF" title="Listing 2-11Applying the transition filter"></a><p class="codesample"><strong>Listing 2-11&nbsp;&nbsp;</strong>Applying the transition filter</p><div class="codesample"><table><tr><td scope="row"><pre>- (CIImage *)imageForTransition: (float)t<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter  *crop;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if(fmodf(t, 2.0) &lt; 1.0f)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [transition setValue: sourceImage  forKey: @"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>        [transition setValue: targetImage  forKey: @"inputTargetImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [transition setValue: targetImage  forKey: @"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>        [transition setValue: sourceImage  forKey: @"inputTargetImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [transition setValue: [NSNumber numberWithFloat:<span></span></pre></td></tr><tr><td scope="row"><pre>                            0.5*(1-cos(fmodf(t, 1.0f) * M_PI))]<span></span></pre></td></tr><tr><td scope="row"><pre>                forKey: @"inputTime"];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    crop = [CIFilter filterWithName: @"CICrop"<span></span></pre></td></tr><tr><td scope="row"><pre>                    keysAndValues: @"inputImage",<span></span></pre></td></tr><tr><td scope="row"><pre>                            [transition valueForKey: @"outputImage"],<span></span></pre></td></tr><tr><td scope="row"><pre>                    @"inputRectangle", [CIVector vectorWithX: 0  Y: 0<span></span></pre></td></tr><tr><td scope="row"><pre>                                        Z: thumbnailWidth<span></span></pre></td></tr><tr><td scope="row"><pre>                                        W: thumbnailHeight],<span></span></pre></td></tr><tr><td scope="row"><pre>                    nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    return [crop valueForKey: @"outputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Each time the timer that you set up fires, the display must be updated. <span class="content_text">Listing 2-12</span> shows a <code>timerFired:</code> routine that does just that.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJEJHBA" title="Listing 2-12Using the timer to update the display"></a><p class="codesample"><strong>Listing 2-12&nbsp;&nbsp;</strong>Using the timer to update the display</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)timerFired: (id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setNeedsDisplay: YES];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Finally, <span class="content_text">Listing 2-13</span> shows the housekeeping that needs to be performed if your application switches the source and target images, as the example does.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJCBDGH" title="Listing 2-13Setting source and target images"></a><p class="codesample"><strong>Listing 2-13&nbsp;&nbsp;</strong>Setting source and target images</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)setSourceImage: (CIImage *)source<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [source retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    [sourceImage release];<span></span></pre></td></tr><tr><td scope="row"><pre>    sourceImage = source;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)setTargetImage: (CIImage *)target<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [target retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    [targetImage release];<span></span></pre></td></tr><tr><td scope="row"><pre>    targetImage = target;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJIBEIF" title="Imaging Dynamical Systems"></a><h2>Imaging Dynamical Systems</h2><p>A dynamical system is one whose state changes over time using a calculation that is based on the current state of the system. Complex phenomena—fluid dynamics, stellar formation, saxophone multiphonics, self-organizing systems, and so forth—are typically modeled using iterative functions whose output is presented in graphical format. Imaging dynamical systems requires a way to feed the output of the system back to the input. Imaging these types of systems is not quite as simple as chaining a lot of filters together, as shown in <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDDCEE">“Processing an Image.”</a></span> Rather, there needs to be a way to accumulate image output so that it can affect the next iteration. Core Image provides the <code>CIImageAccumulator</code> class for just this purpose. An image accumulator object enables feedback-based image processing for such things as the iterative painting operations required by fluid dynamics simulations.</p><p>The code in this section shows how to use a <code>CIImageAccumulator</code> object, but not for anything as complex as modeling dynamical systems. Instead, you’ll see how to use an image accumulator to implement a simple painting application called MicroPaint. A user drags the mouse on a canvas to apply paint. A simple button press sprays a dab of paint. A color well lets the user change color. The user can create output similar to that shown in <span class="content_text">Figure 2-6</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJEJHII" title="Figure 2-6Output from MicroPaint"></a><p><strong>Figure 2-6&nbsp;&nbsp;</strong>Output from MicroPaint</p><img src = "../art/micropaint_example.gif" alt = "Output from MicroPaint" width="274" height="315"></div><br/><p>The “image” starts as a blank canvas. MicroPaint uses an image accumulator to collect the paint applied by the user. When the user clicks Clear, MicroPaint resets the image accumulator to a white canvas. The three essential tasks for using an image accumulator for the MicroPaint application are:</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJDADBH">“Create and Initialize an Image Accumulator Object”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJBHEEA">“Set Up and Apply a Filter to the Image Accumulator”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-BAJBFDHF">“Create a CIContext Object and Draw the Image”</a></span></p></li></ol><p>The interface file for the MicroPaint application is shown in <span class="content_text">Listing 2-14</span>. The routines for obtaining mouse location and updating the user interface aren’t discussed here. The tasks necessary to set up and use an image accumulator are discussed in the sections that follow. (The CIMicroPaint sample application is somewhat similar to the MicroPaint application discussed here. You might also want to look at that application, which is available after you install the developer tools on your hard disk, in Developer > Examples > Quartz > Core Image.) </p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJFGAAJ" title="Listing 2-14The interface for the MicroPaintView"></a><p class="codesample"><strong>Listing 2-14&nbsp;&nbsp;</strong>The interface for the MicroPaintView</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MicroPaintView : NSView<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL initialized;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSBundle *bundle;<span></span></pre></td></tr><tr><td scope="row"><pre>    CIImageAccumulator *_canvas;<span></span></pre></td></tr><tr><td scope="row"><pre>    // User interface<span></span></pre></td></tr><tr><td scope="row"><pre>    NSColor *color;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet NSColorWell *colorWell;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet NSButton *clearButton;<span></span></pre></td></tr><tr><td scope="row"><pre>    // For tracking the brush and making an evenly-spaced set of paint dabs<span></span></pre></td></tr><tr><td scope="row"><pre>    NSPoint lastPt;<span></span></pre></td></tr><tr><td scope="row"><pre>    float lastPressure;<span></span></pre></td></tr><tr><td scope="row"><pre>    float distance;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)awakeFromNib;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)drawRect:(NSRect)r;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)deposit:(NSPoint)pt pressure:(float)pressure;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)colorWellAction:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)clearButtonAction:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDADBH" title="Create and Initialize an Image Accumulator Object"></a><h3>Create and Initialize an Image Accumulator Object</h3><p>The <code>canvas</code> routine shown in <span class="content_text">Listing 2-15</span> creates and initializes an image accumulator object. The bounds of the image accumulator object are set to the bounds of the view, using a 32 bit-per-pixel, fixed-point pixel format (<code><!--a target="_top" -->kCIFormatARGB8<!--/a--></code>). The routine also sets up and initializes a constant color generator filter (CIConstantColorGenerator) with the color white. Then it uses the output of the constant color filter to initialize the image accumulator image. The <code>canvas</code> routine sets a blank (white) canvas the first time the application launches and anytime the user clicks the clear button. Otherwise, the routine returns the current image accumulator.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJCFCIH" title="Listing 2-15Creating and initializing an image accumulator"></a><p class="codesample"><strong>Listing 2-15&nbsp;&nbsp;</strong>Creating and initializing an image accumulator</p><div class="codesample"><table><tr><td scope="row"><pre>- (CIImageAccumulator *)canvas<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect r;<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter *f;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRect bounds;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (_canvas == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        bounds = [self bounds];<span></span></pre></td></tr><tr><td scope="row"><pre>        r = CGRectMake(bounds.origin.x, bounds.origin.y,<span></span></pre></td></tr><tr><td scope="row"><pre>                        bounds.size.width, bounds.size.height);<span></span></pre></td></tr><tr><td scope="row"><pre>        _canvas = [[CIImageAccumulator alloc] initWithExtent:r<span></span></pre></td></tr><tr><td scope="row"><pre>                        format:kCIFormatARGB8];<span></span></pre></td></tr><tr><td scope="row"><pre>        f = [CIFilter filterWithName:@"CIConstantColorGenerator"<span></span></pre></td></tr><tr><td scope="row"><pre>                keysAndValues:@"inputColor",<span></span></pre></td></tr><tr><td scope="row"><pre>                [CIColor colorWithRed:1.0 green:1.0 blue:1.0 alpha:1.0],<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        [_canvas setImage:[f valueForKey:@"outputImage"]];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return _canvas;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJBHEEA" title="Set Up and Apply a Filter to the Image Accumulator"></a><h3>Set Up and Apply a Filter to the Image Accumulator</h3><p>MicroPaint provides its own filter—a dab filter—that applies paint to the canvas. The filter calculates where and how much paint to apply based upon the location of the mouse (or pen), the brush size and brush spacing (constants defined by the application), and the pressure, which can vary if the user paints with a pressure-sensitive device.</p><p>The dab filter is part of the MicroPaint application bundle. Its implementation isn’t discussed here. If you want to create and use your own filters, see <span class="content_text"><a href="../ci_custom_filters/ci_custom_filters.html#//apple_ref/doc/uid/TP30001185-CH207-TPXREF101">“Creating Custom Filters.”</a></span></p><p>The <code>deposit:pressure:</code> method shown in <span class="content_text">Listing 2-16</span> is called whenever there is a mouse-down or mouse-dragged event. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDHFEJ" title="Listing 2-16Setting up and applying the dab filter to the accumulated image"></a><p class="codesample"><strong>Listing 2-16&nbsp;&nbsp;</strong>Setting up and applying the dab filter to the accumulated image</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)deposit:(NSPoint)pt pressure:(float)pressure<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter *myFilter;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect r;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myFilter = [CIFilter filterWithName:@"DabFilter"];<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    [myFilter setValue:[CIVector vectorWithX:pt.x Y:pt.y] <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        forKey:@"inputCenter"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [myFilter setValue:[CIColor colorWithRed:[color redComponent]<span></span></pre></td></tr><tr><td scope="row"><pre>                         green:[color greenComponent]<span></span></pre></td></tr><tr><td scope="row"><pre>                         blue:[color blueComponent] alpha:1.0]<span></span></pre></td></tr><tr><td scope="row"><pre>        forKey:@"inputColor"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [myFilter setValue:[NSNumber numberWithFloat:brushsize * 0.5]<span></span></pre></td></tr><tr><td scope="row"><pre>        forKey:@"inputRadius"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [myFilter setValue:[NSNumber numberWithFloat:pressure]<span></span></pre></td></tr><tr><td scope="row"><pre>        forKey:@"inputOpacity"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [myFilter setValue:[[self canvas] image]  <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        forKey:@"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>    r.origin = CGPointMake(pt.x - brushsize * 0.5,<span></span></pre></td></tr><tr><td scope="row"><pre>                            pt.y - brushsize * 0.5);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    r.size = CGSizeMake(brushsize, brushsize);<span></span></pre></td></tr><tr><td scope="row"><pre>    [[self canvas] setImage:[myFilter valueForKey:@"outputImage"] dirtyRect:r];<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    [self setNeedsDisplay:YES];<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates a filter for the dab filter.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001185-CH203-SW10" title="Note"></a><p><strong>Note:</strong>&nbsp; The dab filter is a custom filter created by the application. The process for using custom filters is the same as for using Core Image filters. You create a <code>CIFilter</code> object using the name assigned to the filter, set the input values, and obtain the output image. If you package your filter as an image unit, you must first load it. See <span class="content_text"><a href="ci_tasks.html#//apple_ref/doc/uid/TP30001185-CH203-SW2">“Loading Image Units”</a></span> for details.</p></div></li><li class="li"><p>Sets the input values for the dab filter.</p></li><li class="li"><p>Sets the image accumulator image as the input image to the dab filter.</p></li><li class="li"><p>Calculates the dirty rectangle, which is based on the location of the mouse and the brush size set by the application.</p></li><li class="li"><p>Sets the image accumulator image to the output of the dab filter, but only in the area specified by the dirty rectangle.</p></li><li class="li"><p>Sets the display to be updated, which calls the <code>drawRect:</code> routine for the view.</p></li></ol><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJBFDHF" title="Create a CIContext Object and Draw the Image"></a><h3>Create a CIContext Object and Draw the Image</h3><p>The <code>drawRect:</code> method shown in <span class="content_text">Listing 2-17</span> is called when the <code>deposit:pressure:</code> method sets the display for updating. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJIBGDD" title="Listing 2-17The drawRect routine for the Mouse Paint application"></a><p class="codesample"><strong>Listing 2-17&nbsp;&nbsp;</strong>The drawRect routine for the Mouse Paint application</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)drawRect:(NSRect)rect<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect cg;<span></span></pre></td></tr><tr><td scope="row"><pre>    CIContext *context = [[NSGraphicsContext currentContext] CIContext];<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    cg = CGRectMake(NSMinX(rect), NSMinY(rect),<span></span></pre></td></tr><tr><td scope="row"><pre>                 NSWidth(rect), NSHeight(rect));<span></span></pre></td></tr><tr><td scope="row"><pre>    [context drawImage:[[self canvas] image] <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                atPoint:cg.origin<span></span></pre></td></tr><tr><td scope="row"><pre>                fromRect:cg];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Creates a Core Image context by calling the <code>NSGraphicsContext</code> method <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSGraphicsContext_Class/Reference/Reference.html#//apple_ref/occ/instm/NSGraphicsContext/CIContext" target="_top">CIContext</a></code>. You need to create the context only once; always reuse the <code>CIContext</code> object when you can. </p></li><li class="li"><p>Draws the image returned by the <code>CIImageAccumulator</code> object at the origin <code>(0,0)</code>, using the full size of the view.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30001185-CH203-SW11" title="Tip"></a><p><strong>Tip:</strong>&nbsp;If you repeatedly call Core Image without returning to your application run loop, it’s best to surround each batch of Core Image invocations with their own autorelease pool. This practice prevents your application from using more memory than necessary—which is important when you manipulate images.</p></div><a name="//apple_ref/doc/uid/TP30001185-CH203-BAJDAHAD" title="Applying a Filter to Video"></a><h2>Applying a Filter to Video</h2><p>Core Image and Core Video can work together to achieve a variety of effects. For example, you can use a color correction filter on a video shot under water to correct for the fact that water absorbs red light faster than green and blue light. There are many more ways you can use these technologies together. </p><p>Follow these steps to apply a Core Image filter to a video displayed using Core Video:</p><ol class="ol"><li class="li"><p>When you subclass <code>NSView</code> to create a view for the video, declare a <code>CIFilter</code> object in the interface, similar to what’s shown in this code:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MyVideoView : NSView<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRecursiveLock *lock;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTMovie         *qtMovie;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTVisualContextRef      qtVisualContext;<span></span></pre></td></tr><tr><td scope="row"><pre>    CVDisplayLinkRef        displayLink;<span></span></pre></td></tr><tr><td scope="row"><pre>    CVImageBufferRef        currentFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter                *effectFilter;<span></span></pre></td></tr><tr><td scope="row"><pre>    id              delegate;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>When you initialize the view with a frame, you create a <code>CIFilter</code> object  for the filter and set the default values using code similar to the following:</p><div class="codesample"><table><tr><td scope="row"><pre>effectFilter = [[CIFilter filterWithName:@"CILineScreen"] retain];<span></span></pre></td></tr><tr><td scope="row"><pre>[effectFilter setDefaults];<span></span></pre></td></tr></table></div><p>This example uses the Core Image filter CILineScreen, but you’d use whatever is appropriate for your application.</p></li><li class="li"><p>Set the filter input parameters, except for the input image. </p></li><li class="li"><p>Each time you render a frame, you need to set the input image and draw the output image. Your <code>renderCurrentFrame</code> routine would look similar to the following. Note that this example, to avoid interpolation, uses integer coordinates when it draws the output. </p><div class="codesample"><table><tr><td scope="row"><pre>- (void)renderCurrentFrame<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRect      frame = [self frame];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if(currentFrame)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        CGRect      imageRect;<span></span></pre></td></tr><tr><td scope="row"><pre>        CIImage     *inputImage, *outputImage;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        inputImage = [CIImage imageWithCVImageBuffer:currentFrame];<span></span></pre></td></tr><tr><td scope="row"><pre>        imageRect = [inputImage extent];<span></span></pre></td></tr><tr><td scope="row"><pre>        [effectFilter setValue:inputImage forKey:@"inputImage"];<span></span></pre></td></tr><tr><td scope="row"><pre>        [[[NSGraphicsContext currentContext] CIContext]<span></span></pre></td></tr><tr><td scope="row"><pre>            drawImage:[effectFilter valueForKey:@"outputImage"]<span></span></pre></td></tr><tr><td scope="row"><pre>            atPoint:CGPointMake(<span></span></pre></td></tr><tr><td scope="row"><pre>             (int)((frame.size.width - imageRect.size.width) * 0.5),<span></span></pre></td></tr><tr><td scope="row"><pre>             (int)((frame.size.height - imageRect.size.height) * 0.5))<span></span></pre></td></tr><tr><td scope="row"><pre>            fromRect:imageRect];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In your <code>dealloc</code> method, make sure you release the filter.</p></li></ol><p>The following sample applications apply Core Image filters to video:</p><ul class="ul"><li class="li"><p><em><a href="../../../../../samplecode/CIVideoDemoGL/index.html#//apple_ref/doc/uid/DTS10003623" target="_top">CIVideoDemoGL</a></em> demonstrates using Core Image with QuickTime through Core Video.</p></li><li class="li"><p><em><a href="../../../../../samplecode/QTCoreImage101/index.html#//apple_ref/doc/uid/DTS10003719" target="_top">QTCoreImage101</a></em> is a Cocoa application that demonstrates how to render a QuickTime Movie using Core Image filters, Core Video, and Visual Contexts.</p></li></ul><p>You can download these and other sample applications from the <span class="content_text"><a href="../../../../../samplecode/GraphicsImaging/idxQuartz-date.html#doclist" target="_top">ADC Reference Library</a></span>  (<span class="content_text"><a href="../../../../../samplecode/GraphicsImaging/idxQuartz-date.html#//apple_ref/doc/uid/TP30000925-TP30000424-TP30000559" target="_top">Sample Code > Graphics &amp; Imaging > Quartz</a></span>).</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ci_concepts/ci_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ci_custom_filters/ci_custom_filters.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_tasks/ci_tasks.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_tasks/ci_tasks.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/CoreImaging/ci_tasks/ci_tasks.html%3Fid%3DTP30001185-4.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>