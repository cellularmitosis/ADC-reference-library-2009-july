<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Application Architecture Overview: Document Architecture</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Document Architecture"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20000921" title="Document Architecture"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DesignGuidelines-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000556" target="_top">Design Guidelines</a> &gt; <a href="../index.html" target="_top">Application Architecture Overview</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="AppFeatures.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Scripting.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20000921-CACCAIAC" title="Document Architecture"></a><hr /><H1>Document Architecture</H1><p>This article begins by describing the Model-View-Controller (MVC) design pattern because this pattern informs application design that is most supportive of scripting, document-based applications, and undo. It does not fully describe the MVC design pattern in any formal way, because that’s not really its purpose, but it does discuss the pattern enough to give some background for the remaining discussion. More information about MVC is presented in the <em><a href="../../CocoaFundamentals/index.html#//apple_ref/doc/uid/TP40002974" target="_top">Cocoa Fundamentals Guide</a></em>. In addition, <em><a href="../../CocoaBindings/index.html#//apple_ref/doc/uid/10000167i" target="_top">Cocoa Bindings Programming Topics</a></em> explains how you can use Cocoa bindings technology to keep model and view values synchronized.</p><p>The document architecture in the Application Kit is based on three classes: <code>NSDocument</code>, <code>NSWindowController</code>, and <code>NSDocumentController</code>. <code>NSDocument</code> is the principal class. It represents a single document in your application. Developers must subclass <code>NSDocument</code> to give it knowledge of the application’s model layer and to implement persistence (loading and saving). <code>NSWindowController</code> objects own and control the application’s user interface. An <code>NSDocument</code> object has one or more <code>NSWindowController</code> objects. Developers often subclass <code>NSWindowController</code> to add specific knowledge of the view layer that the controller is responsible for managing. <code>NSDocumentController</code> is a singleton class. Each document-based application has a single instance of <code>NSDocumentController</code> to track and manage all open documents. Developers typically don’t need to subclass <code>NSDocumentController</code>.</p><p>You can find more information about the document architecture in the <em><a href="../../Documents/index.html#//apple_ref/doc/uid/10000006i" target="_top">Document-Based Applications Overview</a></em>.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="DocumentArchitecture.html#//apple_ref/doc/uid/20000921-1058226">NSDocuments Are Model-Controllers</a>
				
			<br/>
			
        
			
			
				<a href="DocumentArchitecture.html#//apple_ref/doc/uid/20000921-1058245">NSWindowControllers Are View-Controllers</a>
				
			<br/>
			
        
			
			
				<a href="DocumentArchitecture.html#//apple_ref/doc/uid/20000921-1058259">Type Information and NSDocumentControllers</a>
				
			<br/>
			
        
			
			
				<a href="DocumentArchitecture.html#//apple_ref/doc/uid/20000921-1058324">Typical Usage Patterns</a>
				
			<br/>
			
        
			
			
				<a href="DocumentArchitecture.html#//apple_ref/doc/uid/20000921-1058385">Documents and Scripting</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20000921-1058226" title="NSDocuments Are Model-Controllers"></a><h2>NSDocuments Are Model-Controllers</h2><p><code>NSDocument</code> is a model-controller class. Its main job is to own and manage the model objects that make up a document and to provide a way of saving those objects to a file and reloading them later. Any and all objects that are part of the persistent state of a document should be considered part of that document’s model. Sometimes the <code>NSDocument</code> object itself has some data that would be considered part of the model. For example, the Sketch example application has a subclass of <code>NSDocument</code> named <code>SKTDrawDocument</code>; objects of this class might have an array of <code>SKTGraphic</code> objects that comprises the model of the document. In addition to the actual <code>SKTGraphic</code> objects, the <code>SKTDrawDocument</code> object contains some data that should technically be considered part of the model because the order of the graphics within the document’s array matters in determining the front-to-back ordering of the <code>SKTGraphic</code> objects.</p><p>An <code>NSDocument</code> object should not contain or require the presence of any objects that are specific to the application’s user interface. Although a document can own and manage <code>NSWindowController</code> objects—which present the document visually and allow the user to edit it—it should not depend on these objects being there. For example, it might be desirable to have a document open in your application without having it visually displayed. For instance, a script might have opened a document to do some processing on it. If the script does not need the user to become involved in the processing, the script might want the document to be opened, manipulated, saved, and closed again, without it ever appearing onscreen.</p><a name="//apple_ref/doc/uid/20000921-1058245" title="NSWindowControllers Are View-Controllers"></a><h2>NSWindowControllers Are View-Controllers</h2><p><code>NSWindowController</code> is a view-controller class. Its main job is to own and manage the view objects that are used to display and edit a document. A document that is visible to the user has one or more <code>NSWindowController</code> objects to own and manage the visual presentation. Although you can use an <code>NSWindowController</code> instance, most often you must subclass <code>NSWindowController</code> to add specific knowledge of the interface. An <code>NSWindowController</code> object usually gets its interface from a nib file. Subclasses often add outlets and actions for the controls and views within the nib file and the <code>NSWindowController</code> object usually acts as the file’s owner for the nib.</p><p>In very simple cases where there is only one window for a document, you may want your <code>NSDocument</code> class to have outlets and actions for the nib. In this case, the <code>NSDocument</code> subclass acts as the file’s owner for the nib, but it still creates an <code>NSWindowController</code> instance to own and manage the objects that are loaded from the nib. If you do choose to adopt this approach when quickly prototyping an application, you should be careful to localize the portions of your code that deal with the user interface, so you can later extract them from the document and put them into a custom window controller as your application becomes more complex.</p><a name="//apple_ref/doc/uid/20000921-1058259" title="Type Information and NSDocumentControllers"></a><h2>Type Information and NSDocumentControllers</h2><p>An <code>NSDocumentController</code> object manages documents. It keeps track of all open documents; it knows how to create new documents and how to open existing documents. It knows how to find open documents given either a window whose window controller refers to the document or the path of the file the document was loaded from. Developers typically won’t have to worry about what it does. <code>NSDocumentController</code> knows how to read and use the metadata that a document-based application provides about the types of documents it can open. <code>NSDocumentController</code> can provide information based on that metadata, such as lists of file types supported by an application and which <code>NSDocument</code> subclasses are used for them.</p><p>All document-based applications declare information about the document types they support in the information property list (<code>Info.plist</code>) of the application. Xcode provides an editor for creating and modifying this metadata. See the <code>NSDocumentController</code> class specification for details on the <code>Info.plist</code> keys required by the document architecture and how to include this metadata in your application project.</p><p>The metadata in the information property list declares the types of documents supported by an application. Cocoa defines a set of abstract types; these types are usually the same as the pasteboard type that represents such data. For each abstract type, the <code>Info.plist</code> lists specific information such as:</p><ul class="ul"><li class="li"><p>The file extensions used to identify files of that type</p></li><li class="li"><p>The HFS four-letter type code for files of that type</p></li><li class="li"><p>The icon the Finder should use to display files of that type </p></li><li class="li"><p>The subclass of <code>NSDocument</code> used by an application to deal with files of that type</p></li></ul><p><code>NSDocumentController</code> loads all this type information and uses it. When <code>NSDocumentController</code> runs an open panel it obtains the list of all file extensions for document types that your application can read; it passes that list to the open panel so that it can list the files that can be opened. When the user actually chooses a file to open, the <code>NSDocumentController</code> object uses the metadata to identify the subclass of <code>NSDocument</code> to use to create the document and load its data.</p><a name="//apple_ref/doc/uid/20000921-1058324" title="Typical Usage Patterns"></a><h2>Typical Usage Patterns</h2><p>You can use the document architecture in three general ways. The following discussion starts with the simplest and proceeds to the most complex.</p><p>The simplest way to use the document architecture is appropriate for documents that have only one window and are simple enough that there isn’t much benefit in splitting the controller layer into a model-controller and a view-controller. In this case, the developer needs only to create a subclass of <code>NSDocument</code>. The <code>NSDocument</code> subclass provides storage for the model and the ability to load and save document data. It also has any outlets and actions required for the user interface. It overrides <code>windowNibName</code> to return the nib file name used for documents of this type. <code>NSDocument</code> automatically creates an <code>NSWindowController</code> instance to manage that nib file, but the <code>NSDocument</code> object itself serves as the nib file’s file’s owner.</p><p>If your document has only one window, but it is complex enough that you’d like to split up some of the logic in the controller layer, you can subclass <code>NSWindowController</code> as well as <code>NSDocument</code>. In this case, any outlets and actions and other behavior that is specific to the management of the user interface goes into the <code>NSWindowController</code> subclass. Your <code>NSDocument</code> subclass must override <code>makeWindowControllers</code> instead of <code>windowNibName</code>. The <code>makeWindowControllers</code> method should create an instance of your <code>NSWindowController</code> subclass and add it to the list of managed window controllers with <code>addWindowController:</code>. The <code>NSWindowController</code> should be the file’s owner for the nib file because this creates better separation between the view-related logic and the model-related logic. This approach is recommended for all but the most simple cases.</p><p>If your document requires multiple windows (or allows multiple windows) on a single document you should subclass <code>NSWindowController</code> as well as <code>NSDocument</code>. In your <code>NSDocument</code> subclass you override <code>makeWindowControllers</code> just as in the second procedure described above. However, in this case you might create more than one instance of <code>NSWindowController</code>, possibly from different subclasses of <code>NSWindowController</code>. Some applications need several different windows to represent one document. Therefore you probably need several different subclasses of <code>NSWindowController</code> and you must create one of each in <code>makeWindowControllers</code>. Some applications need only one window for a document but want to allow the user to create several copies of the window for a single document (sometimes this is called a multiple-view document) so that the user can have each window scrolled to a different position, or displayed in different ways. In this case, your <code>makeWindowControllers</code> may only create one <code>NSWindowController</code> instance, but there will be a menu command or similar control that allows the user to create others.</p><a name="//apple_ref/doc/uid/20000921-1058385" title="Documents and Scripting"></a><h2>Documents and Scripting</h2><p>Scripting support is mostly automatic for applications based on the document architecture, for several reasons. First, <code>NSDocument</code> and the other classes in the document architecture directly implement the standard document scripting class (as expected by AppleScript) and automatically support many of the scripting commands that apply to documents. Second, because the document architecture is intended to work with application designs that use MVC separation, and because scripting support depends on many of the same design points, applications that use the document architecture are already in better shape to support scripting than other applications that are not designed that way. Finally, the document plays an important role in the scripting API of most applications; <code>NSDocument</code> knows how to fill that role and provides a good starting point for allowing scripted access to the model layer of your application.</p><p>If an application is not based on the document architecture, making it scriptable requires that you duplicate work you would otherwise get for free. The TextEdit application project (distributed with Mac OS X) shows how to make a document-based application that is not based on <code>NSDocument</code> scriptable. See the Sketch example project for an example of how to implement a scriptable <code>NSDocument</code>-based application.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="AppFeatures.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Scripting.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-08-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/AppArchitecture/Concepts/DocumentArchitecture.html%3Fid%3D10000005i-2.4&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/AppArchitecture/Concepts/DocumentArchitecture.html%3Fid%3D10000005i-2.4&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/AppArchitecture/Concepts/DocumentArchitecture.html%3Fid%3D10000005i-2.4&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
