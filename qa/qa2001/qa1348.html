<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><title>Technical Q&amp;A QA1348: Sequence Grabber - Using the SGDataProc for Sound</title><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><meta name="keywords" content="Sequence Grabber, DataProc, Sound Channel, SGChannel."><meta name="Description" content="This Q&amp;A discusses how you can use a Sound SGChannel with the Sequence Grabber DataProc"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR=WHITE><a name="//apple_ref/doc/uid/DTS10003221" title="Sequence Grabber - Using the SGDataProc for Sound"></a><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxMovieCreation-date.html">Movie Creation</a> &gt; </p><!-- end_header_information --><!-- begin_titles_information --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1348</div>
<div id="pageheadsub">Sequence Grabber - Using the SGDataProc for Sound</div>
</h1>
</td></tr></table></CENTER><!-- end_titles_information --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <TD align="left"><hr width=500 align=center><!-- begin_document_contents --><P id=p2>Q: I'm currently working with the <a href="../../samplecode/SGDataProcSample/SGDataProcSample.html" target="_blank">SGDataProcSample</a> and I'd like to know if it's possible to use the same technique with a Sound <code>SGChannel</code> to process audio as it's being captured just as the sample does for a Video <code>SGChannel</code>.</P>						<P id=p4>A: Yes, you certainly can. When capturing video and sound, the <code>SGChannel</code> parameter passed to the <code>SGDataProc</code>  will  either be the Video <code>SGChannel</code>, or the Sound <code>SGChannel</code>. You can check which of these was passed each time through the callback and proceed accordingly.</P>						<P id=p4>When you register your <code>SGDataProc</code> callback, you are handed the buffers just as they will be written to disk. By default, the Sound <code>SGChannel</code> (<code>SoundMediaType</code>) will internally buffer its audio data in approximately 1 second increments. This means your <code>SGDataProc</code> will be called approximately once a second with audio data. You can alter this behavior by calling <code>SGSetSoundRecordChunkSize</code> and set the seconds per chunk parameter to a higher or lower value depending on your needs.</P>						<p id=p4>You will also need to be aware of the <code>writeType</code> parameter passed to your <code>SGDataProc</code>. When working with a Video <code>SGChannel</code>, the <code>writeType</code> parameter will always equal <code>seqGrabWriteAppend</code>. However, this is not the case for sound. The Sound <code>SGChannel</code> writes data differently that the Video <code>SGChannel</code>, it first reserves a block, and then writes a block during the next <code>SGIdle</code> call. This means that when <code>writeType</code> equals <code>seqGrabWriteReserve</code>, the pointer (<code>Ptr p</code>) passed to your <code>SGDataProc</code> should be disregarded and you can return immediately without doing any work. When <code>writeType</code> equals <code>seqGrabWriteFill</code>, the data can be processed.</p>						<div align="center">							<table border=0 cellpadding=3 width=550>								<tr>									<td bgcolor="#E6E6E6" scope="row">										<p><b>Note:</b><br>											SGSetSoundRecordChunkSize takes a <code>long</code> for &quot;number of seconds per chunk&quot;. If you want to record chunks in durations shorter than one second, you must pass in a negative <code>Fixed</code> point value (rather than an <code>SInt32</code>). For example, if you want <code>0.5</code> second chunks, you should pass <code>0xFFFF8000</code> (<code>-0.5</code> in <code>Fixed</code> point). </p>									</td>								</tr>							</table>						</div>						<P id=p4>Remember that the Sound <code>SGChannel</code> uses the Sound Manager to acquire its audio data and the data will always be presented in interleaved buffers in whatever format was selected using an API such as <code>SGSettingsDialog</code>. The default format is 16-bit twos complement ('<code>twos</code>' - see note below) and is designated by the &quot;<code>NONE</code>&quot; compression type. If some other format such as 32-bit float or 24-bit integer was chosen, the data presented in the <code>DataProc</code> will be different. If a compressed format such as QDesign was chosen, the data will already have been compressed into packets.</P>						<p id=p4>If you would like to process the data in some interesting way, maybe by accessing the left and right channel separately or by passing the data to some AudioUnit, you will always need to de-interleave the data yourself. This could be done using an <code>AudioConverter</code> (see <code>AudioConverter.h</code>). In this case you're much better off grabbing from the Sound <code>SGChannel</code> using the default '<code>twos</code>' format, then letting the conversion happen once. This can be done by using  a single <code>AudioConverter</code> and converting from 16-bit signed integer interleaved, to 32-bit Float deinterleaved which can then be consumed by Core Audio.</p>						<P id=p4>As mentioned above, <code>SGSetSoundRecordChunkSize</code> can be used to get lower latency by setting the <code>seconds</code> parameter to a lower value. The <code>SGDataProc</code> will then be passed smaller chunks of audio data more frequently.</P>						<p id=p4><!-- warning starts here --></p>						<CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550><TR><TD BGCOLOR="#E6E6E6">										<P><B>Note:</B><BR>											The default capture format is 16-bit twos complement, the samples range from a minimum value of 0x8000 (-32768) to a maximum value 0x7fff (32767).</P>									</TD></TR></TABLE></CENTER>						<!-- warning ends here --><br>						<h3>References:</h3>						<ul>							<li><a href="../../documentation/quicktime/APIREF/SOURCESIII/sgsetdataproc.htm" target="_blank">SetSGDataProc</a>							<li><a href="../../documentation/quicktime/APIREF/SOURCESIII/sgdataproc.htm" target="_blank">SGDataProc</a>							<li><a href="../../documentation/QuickTime/APIREF/SOURCESIII/sgsetsoundrecordchunksize.htm" target="_blank">SGSetSoundRecordChunkSize</a>							<li><a href="../../documentation/MusicAudio/Reference/CoreAudio/audio_toolbox/chapter_4_section_3.html" target="_blank">Using the Audio Toolbox</a>							<li><a href="../../documentation/MusicAudio/Reference/CoreAudio/book_intro/chapter_1_section_1.html#//apple_ref/doc/uid/TP30001108-CH201" target="_blank">Core Audio Documentation</a>						</ul>						<hr width=500 align=center>						<!-- begin_date --><H4 ALIGN=center>[Apr 06, 2004]</H4><!-- end_date --><!-- end_document_contents --></TD></TR></TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1348.html%3Fid%3DDTS10003221-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1348.html%3Fid%3DDTS10003221-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1348.html%3Fid%3DDTS10003221-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>