<html><head><title>Mac OS X
 Manual Page For getaddrinfo(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/getaddrinfo" title="Mac OS X
 Manual Page for getaddrinfo(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/getaddrinfo"; name=getaddrinfo(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
GETADDRINFO(3)           BSD Library Functions Manual           GETADDRINFO(3)

<b>NAME</b>
     <b>freeaddrinfo</b>, <b>getaddrinfo</b> -- socket address structure to host and service name

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/socket.h&gt;</b>
     <b>#include</b> <b>&lt;netdb.h&gt;</b>

     <u>void</u>
     <b>freeaddrinfo</b>(<u>struct</u> <u>addrinfo</u> <u>*ai</u>);

     <u>int</u>
     <b>getaddrinfo</b>(<u>const</u> <u>char</u> <u>*restrict</u> <u>nodename</u>, <u>const</u> <u>char</u> <u>*restrict</u> <u>servname</u>,
         <u>const</u> <u>struct</u> <u>addrinfo</u> <u>*restrict</u> <u>hints</u>, <u>struct</u> <u>addrinfo</u> <u>**restrict</u> <u>res</u>);

<b>DESCRIPTION</b>
     The <b>getaddrinfo</b>() function is used to get a list of IP addresses and port numbers for host <u>nodename</u> and
     service <u>servname</u>.  It is a replacement for and provides more flexibility than the <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a> and
     <a href="getservbyname.3.html#//apple_ref/doc/man/3/getservbyname">getservbyname(3)</a> functions.

     The <u>nodename</u> and <u>servname</u> arguments are either pointers to NUL-terminated strings or the null pointer.
     An acceptable value for <u>nodename</u> is either a valid host name or a numeric host address string consist-<font color="#ffffff" class="whiteout">ing&nbsp;consisting</font>
     ing of a dotted decimal IPv4 address or an IPv6 address.  The <u>servname</u> is either a decimal port number
     or a service name listed in <a href="../man5/services.5.html#//apple_ref/doc/man/5/services">services(5)</a>.  At least one of <u>nodename</u> and <u>servname</u> must be non-null.

     <u>hints</u> is an optional pointer to a struct addrinfo, as defined by &lt;<u>netdb.h&gt;</u>:

     struct addrinfo {
             int ai_flags;           /* input flags */
             int ai_family;          /* protocol family for socket */
             int ai_socktype;        /* socket type */
             int ai_protocol;        /* protocol for socket */
             socklen_t ai_addrlen;   /* length of socket-address */
             struct sockaddr *ai_addr; /* socket-address for socket */
             char *ai_canonname;     /* canonical name for service location */
             struct addrinfo *ai_next; /* pointer to next in list */
     };

     This structure can be used to provide hints concerning the type of socket that the caller supports or
     wishes to use.  The caller can supply the following structure elements in <u>hints</u>:

     <u>ai</u><b>_</b><u>family</u>      The protocol family that should be used.  When <u>ai</u><b>_</b><u>family</u> is set to PF_UNSPEC, it means
                    the caller will accept any protocol family supported by the operating system.

     <u>ai</u><b>_</b><u>socktype</u>    Denotes the type of socket that is wanted: SOCK_STREAM, SOCK_DGRAM, or SOCK_RAW.  When
                    <u>ai</u><b>_</b><u>socktype</u> is zero the caller will accept any socket type.

     <u>ai</u><b>_</b><u>protocol</u>    Indicates which transport protocol is desired, IPPROTO_UDP or IPPROTO_TCP.  If
                    <u>ai</u><b>_</b><u>protocol</u> is zero the caller will accept any protocol.

     <u>ai</u><b>_</b><u>flags</u>       <u>ai</u><b>_</b><u>flags</u> is formed by OR'ing the following values:

                    AI_CANONNAME    If the AI_CANONNAME bit is set, a successful call to <b>getaddrinfo</b>() will
                                    return a NUL-terminated string containing the canonical name of the
                                    specified hostname in the <u>ai</u><b>_</b><u>canonname</u> element of the first addrinfo
                                    structure returned.

                    AI_NUMERICHOST  If the AI_NUMERICHOST bit is set, it indicates that <u>nodename</u> should be
                                    treated as a numeric string defining an IPv4 or IPv6 address and no name
                                    resolution should be attempted.

                    AI_PASSIVE      If the AI_PASSIVE bit is set it indicates that the returned socket
                                    address structure is intended for use in a call to <a href="../man2/bind.2.html#//apple_ref/doc/man/2/bind">bind(2)</a>.  In this
                                    case, if the <u>nodename</u> argument is the null pointer, then the IP address
                                    portion of the socket address structure will be set to INADDR_ANY for an
                                    IPv4 address or IN6ADDR_ANY_INIT for an IPv6 address.

                                    If the AI_PASSIVE bit is not set, the returned socket address structure
                                    will be ready for use in a call to <a href="../man2/connect.2.html#//apple_ref/doc/man/2/connect">connect(2)</a> for a connection-oriented
                                    protocol or <a href="../man2/connect.2.html#//apple_ref/doc/man/2/connect">connect(2)</a>, <a href="../man2/sendto.2.html#//apple_ref/doc/man/2/sendto">sendto(2)</a>, or <a href="../man2/sendmsg.2.html#//apple_ref/doc/man/2/sendmsg">sendmsg(2)</a> if a connectionless
                                    protocol was chosen.  The IP address portion of the socket address
                                    structure will be set to the loopback address if <u>nodename</u> is the null
                                    pointer and AI_PASSIVE is not set.

     All other elements of the addrinfo structure passed via <u>hints</u> must be zero or the null pointer.

     If <u>hints</u> is the null pointer, <b>getaddrinfo</b>() behaves as if the caller provided a struct addrinfo with
     <u>ai</u><b>_</b><u>family</u> set to PF_UNSPEC and all other elements set to zero or NULL.

     After a successful call to <b>getaddrinfo</b>(), <u>*res</u> is a pointer to a linked list of one or more addrinfo
     structures.  The list can be traversed by following the <u>ai</u><b>_</b><u>next</u> pointer in each addrinfo structure
     until a null pointer is encountered.  The three members <u>ai</u><b>_</b><u>family,</u> <u>ai</u><b>_</b><u>socktype,</u> and <u>ai</u><b>_</b><u>protocol</u> in each
     returned addrinfo structure are suitable for a call to <a href="../man2/socket.2.html#//apple_ref/doc/man/2/socket">socket(2)</a>.  For each addrinfo structure in the
     list, the <u>ai</u><b>_</b><u>addr</u> member points to a filled-in socket address structure of length <u>ai</u><b>_</b><u>addrlen</u>.

     This implementation of <b>getaddrinfo</b>() allows numeric IPv6 address notation with scope identifier, as
     documented in chapter 11 of draft-ietf-ipv6-scoping-arch-02.txt.  By appending the percent character
     and scope identifier to addresses, one can fill the sin6_scope_id field for addresses.  This would make
     management of scoped addresses easier and allows cut-and-paste input of scoped addresses.

     At this moment the code supports only link-local addresses with the format.  The scope identifier is
     hardcoded to the name of the hardware interface associated with the link (such as ne0).  An example is
     ``fe80::1%ne0'', which means ``fe80::1 on the link associated with the ne0 interface''.

     The current implementation assumes a one-to-one relationship between the interface and link, which is
     not necessarily true from the specification.

     All of the information returned by <b>getaddrinfo</b>() is dynamically allocated: the addrinfo structures
     themselves as well as the socket address structures and the canonical host name strings included in the
     addrinfo structures.

     Memory allocated for the dynamically allocated structures created by a successful call to <b>getaddrinfo</b>()
     is released by the <b>freeaddrinfo</b>() function.  The <u>ai</u> pointer should be a addrinfo structure created by a
     call to <b>getaddrinfo</b>().

<b>RETURN</b> <b>VALUES</b>
     <b>getaddrinfo</b>() returns zero on success or one of the error codes listed in <a href="gai_strerror.3.html#//apple_ref/doc/man/3/gai_strerror">gai_strerror(3)</a> if an error
     occurs.

<b>EXAMPLES</b>
     The following code tries to connect to ``www.kame.net'' service ``http'' via a stream socket.  It loops
     through all the addresses available, regardless of address family.  If the destination resolves to an
     IPv4 address, it will use an AF_INET socket.  Similarly, if it resolves to IPv6, an AF_INET6 socket is
     used.  Observe that there is no hardcoded reference to a particular address family.  The code works
     even if <b>getaddrinfo</b>() returns addresses that are not IPv4/v6.

           struct addrinfo hints, *res, *res0;
           int error;
           int s;
           const char *cause = NULL;

           memset(&amp;hints, 0, sizeof(hints));
           hints.ai_family = PF_UNSPEC;
           hints.ai_socktype = SOCK_STREAM;
           error = getaddrinfo("www.kame.net", "http", &amp;hints, &amp;res0);
           if (error) {
                   errx(1, "%s", gai_strerror(error));
                   /*NOTREACHED*/
           }
           s = -1;
           for (res = res0; res; res = res-&gt;ai_next) {
                   s = socket(res-&gt;ai_family, res-&gt;ai_socktype,
                       res-&gt;ai_protocol);
                   if (s &lt; 0) {
                           cause = "socket";
                           continue;
                   }

                   if (connect(s, res-&gt;ai_addr, res-&gt;ai_addrlen) &lt; 0) {
                           cause = "connect";
                           <!-- a -->close(s)<!-- /a -->;
                           s = -1;
                           continue;
                   }

                   break;  /* okay we got one */
           }
           if (s &lt; 0) {
                   err(1, "%s", cause);
                   /*NOTREACHED*/
           }
           freeaddrinfo(res0);

     The following example tries to open a wildcard listening socket onto service ``http'', for all the
     address families available.

           struct addrinfo hints, *res, *res0;
           int error;
           int s[MAXSOCK];
           int nsock;
           const char *cause = NULL;

           memset(&amp;hints, 0, sizeof(hints));
           hints.ai_family = PF_UNSPEC;
           hints.ai_socktype = SOCK_STREAM;
           hints.ai_flags = AI_PASSIVE;
           error = getaddrinfo(NULL, "http", &amp;hints, &amp;res0);
           if (error) {
                   errx(1, "%s", gai_strerror(error));
                   /*NOTREACHED*/
           }
           nsock = 0;
           for (res = res0; res &amp;&amp; nsock &lt; MAXSOCK; res = res-&gt;ai_next) {
                   s[nsock] = socket(res-&gt;ai_family, res-&gt;ai_socktype,
                       res-&gt;ai_protocol);
                   if (s[nsock] &lt; 0) {
                           cause = "socket";
                           continue;
                   }

                   if (bind(s[nsock], res-&gt;ai_addr, res-&gt;ai_addrlen) &lt; 0) {
                           cause = "bind";
                           close(s[nsock]);
                           continue;
                   }
                   (void) listen(s[nsock], 5);

                   nsock++;
           }
           if (nsock == 0) {
                   err(1, "%s", cause);
                   /*NOTREACHED*/
           }
           freeaddrinfo(res0);

<b>LEGACY</b> <b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/types.h&gt;</b>
     <b>#include</b> <b>&lt;sys/socket.h&gt;</b>
     <b>#include</b> <b>&lt;netdb.h&gt;</b>

     The include file &lt;<u>sys/types.h&gt;</u> is necessary.

<b>SEE</b> <b>ALSO</b>
     <a href="../man2/bind.2.html#//apple_ref/doc/man/2/bind">bind(2)</a>, <a href="../man2/connect.2.html#//apple_ref/doc/man/2/connect">connect(2)</a>, <a href="../man2/send.2.html#//apple_ref/doc/man/2/send">send(2)</a>, <a href="../man2/socket.2.html#//apple_ref/doc/man/2/socket">socket(2)</a>, <a href="gai_strerror.3.html#//apple_ref/doc/man/3/gai_strerror">gai_strerror(3)</a>, <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a>, <a href="getnameinfo.3.html#//apple_ref/doc/man/3/getnameinfo">getnameinfo(3)</a>,
     <a href="getservbyname.3.html#//apple_ref/doc/man/3/getservbyname">getservbyname(3)</a>, <a href="resolver.3.html#//apple_ref/doc/man/3/resolver">resolver(3)</a>, <a href="../man5/hosts.5.html#//apple_ref/doc/man/5/hosts">hosts(5)</a>, <!-- a -->resolv.conf(5)<!-- /a -->, <a href="../man5/services.5.html#//apple_ref/doc/man/5/services">services(5)</a>, <a href="../man7/hostname.7.html#//apple_ref/doc/man/7/hostname">hostname(7)</a>, <a href="../man8/named.8.html#//apple_ref/doc/man/8/named">named(8)</a>

     R. Gilligan, S. Thomson, J. Bound, J. McCann, and W. Stevens, <u>Basic</u> <u>Socket</u> <u>Interface</u> <u>Extensions</u> <u>for</u>
     <u>IPv6</u>, RFC 3493, February 2003.

     S. Deering, B. Haberman, T. Jinmei, E. Nordmark, and B. Zill, <u>IPv6</u> <u>Scoped</u> <u>Address</u> <u>Architecture</u>,
     internet draft, draft-ietf-ipv6-scoping-arch-02.txt, work in progress material.

     Craig Metz, "Protocol Independence Using the Sockets API", <u>Proceedings</u> <u>of</u> <u>the</u> <u>freenix</u> <u>track:</u> <u>2000</u>
     <u>USENIX</u> <u>annual</u> <u>technical</u> <u>conference</u>, June 2000.

<b>STANDARDS</b>
     The <b>getaddrinfo</b>() function is defined by the IEEE Std 1003.1g-2000 (``POSIX.1'') draft specification
     and documented in RFC 3493, ``Basic Socket Interface Extensions for IPv6''.

BSD                            December 20, 2004                           BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/getaddrinfo.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/getaddrinfo.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/getaddrinfo.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
