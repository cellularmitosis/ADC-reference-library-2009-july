<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Catalog Files (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING105></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-104.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-106.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-99.html"><B>Data Organization on Volumes</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING105-0></A>
<H2><A NAME=MARKER-9-550></A>Catalog Files</H2>
 <A NAME=MARKER-2-551></A>The File Manager uses a file called the <B>catalog file</B> to maintain information about the hierarchy of files and directories on a volume. A catalog file is organized as a B*-tree file and hence consists of a header node, index nodes, leaf nodes, and (if necessary) map nodes. The allocation block number of the first file extent of the catalog file (and hence of the file's header node) is stored in the MDB; when the volume is mounted, that information is copied into that volume's volume control block. From the header node, the File Manager can obtain the node number of the catalog file's root node; from the root node, the File Manager can find the entire catalog file.<P>
 <A NAME=MARKER-2-552></A><A NAME=MARKER-2-553></A>Each node of the catalog file is assigned a unique <B>catalog node ID (CNID).</B> For directories, the CNID is the directory ID; for files, it's the file ID. For any given file or directory, the parent ID is the CNID of the parent directory. The first 16 CNIDs are reserved for use by Apple Computer, Inc., and include the following standard assignments:<A NAME=MARKER-2-554></A> 
<TABLE BORDER="0" CELLPADDING=3><TD>CNID<TD>Assignment<TR>
<TD>1<TD>Parent ID of the root directory<TR>
<TD>2<TD>Directory ID of the root directory<TR>
<TD>3<TD>File number of the extents file<TR>
<TD>4<TD>File number of the catalog file<TR>
<TD>5<TD>File number of the bad allocation block file<A NAME=MARKER-2-191></A><A NAME=MARKER-2-192></A></TABLE>
<P>
 You need to know only two things about a catalog file in addition to the information given earlier in this chapter in <A HREF=Files-104.html#MARKER-9-501>"B*-Trees"</A>:<P>
<UL>
<LI>the format of the catalog key used in index and leaf nodes
<LI>the format of the leaf node data records<P>
</UL>
 These formats are described in the following two sections.<P>
<A NAME=HEADING105-7></A>
<H3><A NAME=MARKER-9-555></A>Catalog File Keys</H3>
 The key that the File Manager uses to navigate the catalog file is simple: for a given file or directory, the key consists principally of the name of that file or directory and its parent directory ID. With the exception of a volume reference number (which is not needed here), this mirrors the standard way to specify a file or directory with the high-level HFS routines. You can describe a catalog file key using a record of the <CODE>CatKeyRec</CODE> data type.<A NAME=MARKER-2-556></A><P>
<PRE>
TYPE CatKeyRec    =              {catalog key record}
RECORD
   ckrKeyLen:     SignedByte;    {key length}
   ckrResrv1:     SignedByte;    {reserved}
   ckrParID:      LongInt;       {parent directory ID}
   ckrCName:      Str31;         {catalog node name}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-557></A>ckrKeyLen</CODE>
<DD> The length (in bytes) of the rest of the key. The value in this field does not include the byte occupied by the field itself. If this field contains 0, the key indicates a deleted record.
<DT><CODE><A NAME=MARKER-2-558></A>ckrResrv1</CODE>
<DD> Reserved.
<DT><A NAME=MARKER-2-559></A><CODE>ckrParID</CODE>
<DD> The catalog node ID of the parent directory.
<DT><CODE><A NAME=MARKER-2-560></A>ckrCName</CODE>
<DD> The name of the file or directory whose catalog entry is to be found. This field is padded with null characters if necessary to have the next record data or pointer begin on a word boundary.
</DL>
 You should pay special attention to the fact that the catalog key differs slightly depending on whether it occurs in a record in an index node or a leaf node. If the key occurs in a pointer record (hence in an index node), the <CODE>ckrCName</CODE> field always occupies a full 32 bytes and the <CODE>ckrKeyLen</CODE> field always contains the value $25.<P>
 If, however, the catalog file key occurs in a data record (hence in a leaf node), then the <CODE>ckrCName</CODE> field varies in length; it occupies only the number of bytes required to hold the file or directory name, suitably padded so that the data following it begins on a word boundary. In that case, the <CODE>ckrKeyLen</CODE> field varies as well and may contain values from $7 to $25.<A NAME=MARKER-2-561></A><P>
<A NAME=HEADING105-16></A>
<H3>Catalog File Data Records</H3>
 A catalog file leaf node can contain four different types of records:<A NAME=MARKER-2-562></A><P>
<UL>
<LI>Directory records. A directory record contains information about a single directory.
<LI>File records. A file record contains information about a single file.
<LI>Directory thread records. A directory thread record provides a link between a directory and its parent directory. It allows the File Manager to find the name and directory ID of the parent of a given directory.
<LI>File thread records. A file thread record provides a link between a file and its parent directory. It allows the File Manager to find the name and directory ID of the parent of a given file.<P>
</UL>
 Each record is defined by a variant of the <CODE>CatDataType</CODE> data type.<P>
<PRE>
TYPE CatDataType  =  (cdrDirRec, cdrFilRec, cdrThdRec,
                      cdrFThdRec);
TYPE CatDataRec   =           {catalog data records}
RECORD
   cdrType:       SignedByte; {record type}
   cdrResrv2:     SignedByte; {reserved}
CASE CatDataType OF
cdrDirRec:                    {directory record}
  (dirFlags:      Integer;    {directory flags}
   dirVal:        Integer;    {directory valence}
   dirDirID:      LongInt;    {directory ID}
   dirCrDat:      LongInt;    {date and time of creation}
   dirMdDat:      LongInt;    {date and time of last modification}
   dirBkDat:      LongInt;    {date and time of last backup}
   dirUsrInfo:    DInfo;      {Finder information}
   dirFndrInfo:   DXInfo;     {additional Finder information}
   dirResrv:      ARRAY[1..4] OF LongInt);
                              {reserved}
cdrFilRec:                    {file record}
  (filFlags:      SignedByte; {file flags}
   filTyp:        SignedByte; {file type}
   filUsrWds:     FInfo;      {Finder information}
   filFlNum:      LongInt;    {file ID}
   filStBlk:      Integer;    {first alloc. blk. of data fork}
   filLgLen:      LongInt;    {logical EOF of data fork}
   filPyLen:      LongInt;    {physical EOF of data fork}
   filRStBlk:     Integer;    {first alloc. blk. of resource fork}
   filRLgLen:     LongInt;    {logical EOF of resource fork}
   filRPyLen:     LongInt;    {physical EOF of resource fork}
   filCrDat:      LongInt;    {date and time of creation}
   filMdDat:      LongInt;    {date and time of last modification}
   filBkDat:      LongInt;    {date and time of last backup}
   filFndrInfo:   FXInfo;     {additional Finder information}
   filClpSize:    Integer;    {file clump size}
   filExtRec:     ExtDataRec; {first data fork extent record}
   filRExtRec:    ExtDataRec; {first resource fork extent record}
   filResrv:      LongInt);   {reserved}
cdrThdRec:                    {directory thread record}
  (thdResrv:      ARRAY[1..2] OF LongInt;
                              {reserved}
   thdParID:      LongInt;    {parent ID for this directory}
   thdCName:      Str31);     {name of this directory}
cdrFThdRec:                   {file thread record}
  (fthdResrv:     ARRAY[1..2] OF LongInt;
                              {reserved}
   fthdParID:     LongInt;    {parent ID for this file}
   fthdCName:     Str31);     {name of this file}
END;
</PRE>
 The first two fields of a catalog data record are common to all four variants. Each variant also includes its own unique fields.<P>
<B>Field descriptions common to all variants</B><P>
<DL>
<DT><A NAME=MARKER-2-564></A><CODE>cdrType</CODE>
<DD> The type of catalog data record. This field can contain one of four values:<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Value<TH>Meaning<TR>
<TD>&nbsp;<TD>1<TD>Directory record<TR>
<TD>&nbsp;<TD>2<TD>File record<TR>
<TD>&nbsp;<TD>3<TD>Directory thread record<TR>
<TD>&nbsp;<TD>4<TD>File thread record</TABLE>
</CODE>
<DT><CODE><A NAME=MARKER-2-565></A>cdrResrv2</CODE>
<DD> Reserved.
</DL>
<B>Field descriptions for the <CODE>cdrDirRec</CODE> variant</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-566></A>dirFlags</CODE>
<DD> Directory flags. 
<DT><CODE><A NAME=MARKER-2-567></A>dirVal</CODE>
<DD> The directory valence (the number of files in this directory).
<DT><CODE><A NAME=MARKER-2-568></A>dirDirID</CODE>
<DD> The directory ID.
<DT><CODE><A NAME=MARKER-2-569></A>dirCrDat</CODE>
<DD> The date and time this directory was created.
<DT><CODE><A NAME=MARKER-2-570></A>dirMdDat</CODE>
<DD> The date and time this directory was last modified.
<DT><CODE><A NAME=MARKER-2-571></A>dirBkDat</CODE>
<DD> The date and time this directory was last backed up.
<DT><CODE><A NAME=MARKER-2-572></A>dirUsrInfo</CODE>
<DD> Information used by the Finder.
<DT><CODE><A NAME=MARKER-2-573></A>dirFndrInfo</CODE>
<DD> Additional information used by the Finder.
<DT><CODE><A NAME=MARKER-2-574></A>dirResrv</CODE>
<DD> Reserved.
</DL>
<B>Field descriptions for the <CODE>cdrFilRec</CODE> variant</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-575></A>filFlags</CODE>
<DD> File flags. This is interpreted as a bitmap; currently the following bits are defined:<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>0<TD>If set, file is locked and cannot be written to.<TR>
<TD>&nbsp;<TD>1<TD>If set, a file thread record exists for this file.<TR>
<TD>&nbsp;<TD>7<TD>If set, the file record is used.</TABLE>
</CODE>
<DT><CODE><A NAME=MARKER-2-576></A>filTyp</CODE>
<DD> The file type. This field should always contain 0.
<DT><CODE><A NAME=MARKER-2-577></A>filUsrWds</CODE>
<DD> The file's Finder information.
<DT><CODE><A NAME=MARKER-2-578></A>filFlNum</CODE>
<DD> The file ID.
<DT><CODE><A NAME=MARKER-2-579></A>filStBlk</CODE>
<DD> The first allocation block of the data fork.
<DT><CODE><A NAME=MARKER-2-580></A>filLgLen</CODE>
<DD> The logical EOF of the data fork.
<DT><CODE><A NAME=MARKER-2-581></A>filPyLen</CODE>
<DD> The physical EOF of the data fork.
<DT><CODE><A NAME=MARKER-2-582></A>filRStBlk</CODE>
<DD> The first allocation block of the resource fork.
<DT><CODE><A NAME=MARKER-2-583></A>filRLgLen</CODE>
<DD> The logical EOF of the resource fork.
<DT><CODE><A NAME=MARKER-2-584></A>filRPyLen</CODE>
<DD> The physical EOF of the resource fork.
<DT><CODE><A NAME=MARKER-2-585></A>filCrDat</CODE>
<DD> The date and time this file was created.
<DT><CODE><A NAME=MARKER-2-586></A>filMdDat</CODE>
<DD> The date and time this file was last modified.
<DT><CODE><A NAME=MARKER-2-587></A>filBkDat</CODE>
<DD> The date and time this file was last backed up.
<DT><CODE><A NAME=MARKER-2-588></A>filFndrInfo</CODE>
<DD> Additional information used by the Finder.
<DT><CODE><A NAME=MARKER-2-589></A>filClpSize</CODE>
<DD> The file clump size.
<DT><CODE><A NAME=MARKER-2-590></A>filExtRec</CODE>
<DD> The first extent record of the file's data fork.
<DT><CODE><A NAME=MARKER-2-591></A>filRExtRec</CODE>
<DD> The first extent record of the file's resource fork.
<DT><CODE><A NAME=MARKER-2-592></A>filResrv</CODE>
<DD> Reserved.
</DL>
<B>Field descriptions for the <CODE>cdrThdRec</CODE> variant</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-593></A>thdResrv</CODE>
<DD> Reserved. 
<DT><CODE><A NAME=MARKER-2-594></A>thdParID</CODE>
<DD> The directory ID of the parent of the associated directory.
<DT><CODE><A NAME=MARKER-2-595></A>thdCName</CODE>
<DD> The name of this directory.
</DL>
<B>Field descriptions for the <CODE>cdrFThdRec</CODE> variant</B><P>
<DL>
<DT><CODE><A NAME=MARKER-2-596></A>fthdResrv</CODE>
<DD> Reserved. 
<DT><CODE><A NAME=MARKER-2-597></A>fthdParID</CODE>
<DD> The directory ID of the parent of the associated file.
<DT><CODE><A NAME=MARKER-2-598></A>fthdCName</CODE>
<DD> The name of this file.<A NAME=MARKER-2-599></A>
</DL>
 As you can see, a file thread record is exactly the same as a directory thread record except that the associated object is a file, not a directory.<A NAME=MARKER-2-600></A><A NAME=MARKER-2-601></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-104.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-106.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
