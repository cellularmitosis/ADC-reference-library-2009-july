<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Web Services Core Programming Guide: Using the Web Services Core Framework</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using the Web Services Core Framework"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000985-CH101" title="Using the Web Services Core Framework"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000429" target="_top">Networking</a> &gt; <a href="../../../InternetWeb-date.html#//apple_ref/doc/uid/TP30000440-TP30000429-TP30000526" target="_top">Internet &amp; Web</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30000985-CH1-DontLinkElementID_19">Web Services Core Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Overview/Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000985-CH101-SW1" title="Using the Web Services Core Framework"></a><h1>Using the Web Services Core Framework</h1><p>The fundamental task in using web services is invoking an operation. This is a moderately complex process. This chapter contains two sections. The first section, <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP30000985-CH101-SW2">“Creating and Invoking Operations,”</a></span> explains the steps and provides illustrative code snippets. The second section, <span class="content_text"><a href="Tasks.html#//apple_ref/doc/uid/TP30000985-CH101-SW3">“Example: Calling a SOAP Operation With HTTP Authentication,”</a></span> is an annotated example with downloadable sample code you can build and run.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP30000985-CH101-SW2">Creating and Invoking Operations</a>
				
			<br/>
			
        
			
			
				<a href="Tasks.html#//apple_ref/doc/uid/TP30000985-CH101-SW3">Example: Calling a SOAP Operation with HTTP Authentication</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000985-CH101-SW2" title="Creating and Invoking Operations"></a><h2>Creating and Invoking Operations</h2><p>To call an XML-RPC or SOAP service on a remote server, you need to create an invocation reference, define the parameters and parameter order, pass in the settings, then invoke the service. The invocation reference includes a URL, an operation name, and a protocol (SOAP or XML-RPC). The parameters and settings vary depending on the selected protocol—SOAP parameters are named, for example, whereas RPC parameters are numbered. SOAP requires a namespace and usually a SOAP action header in the settings as well. In addition, there are debug properties you can set. </p><p>The following sections describe the steps in more detail.</p><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_12" title="The Invocation Reference"></a><h3>The Invocation Reference</h3><p>You create the <code>WSMethodInvocationRef</code> object by using the function <code>WSMethodInvocationCreate</code>, which takes a URL (<code>CFURLRef</code> or <code>NSURL</code>), an operation name (<code>CFStringRef</code>), and a protocol. The protocol is one of these <code>CFStringRef</code> constants: </p><ul class="spaceabove"><li class="li"><p>kWSXMLRPCProtocol</p></li><li class="li"><p>kWSSOAP2001Protocol</p></li></ul><p>Pass in the URL of the service, the name of the operation, and the protocol:</p><div class="codesample"><table><tr><td scope="row"><pre>NSURL *url = [NSURL URLWithString:@"http://localhost:8888/"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *methodName = @"echo";<span></span></pre></td></tr><tr><td scope="row"><pre>WSMethodInvocationRef mySoapRef = WSMethodInvocationCreate((CFURLRef)url,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 (CFStringRef)methodName,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    kWSSOAP2001Protocol);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_13" title="The Operation Parameters"></a><h3>The Operation Parameters</h3><p>Create a dictionary of the operation parameters and an array establishing the parameter order, then pass references to the dictionary and array to <code>WSMethodInvocationSetParameters</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>NSDictionary *params = [NSDictionary dictionaryWithObject:@"firstParamName"<span></span></pre></td></tr><tr><td scope="row"><pre>                                                          forKey:@"firstParam"];<span></span></pre></td></tr><tr><td scope="row"><pre> NSArray *paramOrder = [NSArray arrayWithObject:@"firstParam"];<span></span></pre></td></tr><tr><td scope="row"><pre> WSMethodInvocationSetParameters(mySoapRef, (CFDictionaryRef)params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            (CFArrayRef)paramOrder);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_14" title="The Invocation Properties"></a><h3>The Invocation Properties</h3><p>Call <code>WSMethodInvocationSetProperty</code> with the appropriate settings for the operation. For example, a SOAP call requires a namespace and a SOAP action header (some SOAP implementations require a header even if it is empty). You might also want to set the request to allow redirects and to turn on the debug properties so that the raw XML is included in the returned dictionary, along with the parsed data.</p><div class="codesample"><table><tr><td scope="row"><pre>    NSString *namespace = @"http://localhost:8888/";<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDictionary *reqHeaders = [NSDictionary dictionaryWithObject:@"" forKey:@"SOAPAction"];<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSSOAPMethodNamespaceURI,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             (CFStringRef)namespace);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSHTTPExtraHeaders,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             (CFDictionaryRef)reqHeaders);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef,    kWSHTTPFollowsRedirects,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre> // set debug props<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSDebugIncomingBody,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSDebugIncomingHeaders,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSDebugOutgoingBody,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(mySoapRef, kWSDebugOutgoingHeaders,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             kCFBooleanTrue);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_15" title="Invoking the Operation"></a><h3>Invoking the Operation</h3><p>Once you’ve created the invocation reference and added the settings and the properties, you can invoke the operation. Typically, you then use the CFNetwork framework to check the status of your post—which saves you the trouble of trying to parse a nonresponse in the event of a challenge or network error—using the constant <code>kWSHTTPResponseMessage</code> as an identifier for the web services request.</p><div class="codesample"><table><tr><td scope="row"><pre>NSDictionary *result = (NSDictionary *)WSMethodInvocationInvoke(mySoapRef);<span></span></pre></td></tr><tr><td scope="row"><pre>// get HTTP response from SOAP request so we can see the status code<span></span></pre></td></tr><tr><td scope="row"><pre>CFHTTPMessageRef res = (CFHTTPMessageRef)<span></span></pre></td></tr><tr><td scope="row"><pre>                       [result objectForKey:(id)kWSHTTPResponseMessage];<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_16" title="Invoking the Operation Asynchronously"></a><h3>Invoking the Operation Asynchronously</h3><p>Because network delays tend to be unpredictably long, you normally want to invoke operations asynchronously, using <code>WSMethodInvocationScheduleWithRunLoop</code>, and providing a callback on your run loop to handle the response. You can re-schedule the invocation after it completes. Set your callback using <code>WSMethodInvocationSetCallBack</code>.</p><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_17" title="Dealing With The Response"></a><h3>Dealing With The Response</h3><p>If there are no network, transport, or web services faults, the invocation returns a method response dictionary, either synchronously or on your callback. (Set your callback using <code>WSMethodInvocationSetCallBack</code>). If you know what the keys are for the values you want, you can retrieve the returned data from the dictionary using the keys. </p><p>Alternatively, you can request the <code>kWSMethodInvocationResult</code> and parse the XML yourself. If you prefer, you can pass in an expected result parameter name before invoking the operation, in which case <code>kWSMethodInvocationResult</code> will be an alias to the parameter that you want.</p><p>Because the response dictionary may contain the raw XML as well as the deserialized data, there may be more than one instance of the data in the dictionary.</p><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_18" title="Adding Custom Serializers and Deserializers"></a><h3>Adding Custom Serializers and Deserializers</h3><p>If the CFTypes for the data you are working with have corresponding WSTypes, invoking the operation automatically serializes the outbound data from the dictionary into XML and deserializes the returned data from XML into a dictionary. If you need to work with more complex data types, you can write your own serializer and deserializer callbacks. These callbacks are called when the method invocation encounters the specified data type in an outbound dictionary or an inbound XML response.</p><p>Set the callbacks using <code>WSMethodInvocationAddSerializationOverride</code> and <code>WSMethodInvocationAddDeserializationOverride</code>.</p><a name="//apple_ref/doc/uid/TP30000985-CH101-SW3" title="Example: Calling a SOAP Operation with HTTP Authentication"></a><h2>Example: Calling a SOAP Operation with HTTP Authentication</h2><p>This example calls a SOAP method over HTTP. Web services commonly require authentication, so this example sends the SOAP request and, if challenged, authenticates. You can download the sample code from <span class="content_text"><a href="http://developer.apple.com/internet/webservices/SOAP_AuthExample.dmg" target="_top">http://developer.apple.com/internet/webservices/SOAP_AuthExample.dmg</a></span>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000985-CH101-DontLinkElementID_26" title="Downloading and Running a Server"></a><p><strong>Downloading and Running a Server:</strong>&nbsp;You can download a small Java program that acts as a SOAP server on your local host. This gives the example code something to talk to, and gives you the ability to test and debug both sides of the transaction. Download the SOAP server from <span class="content_text"><a href="http://developer.apple.com/internet/webservices/SOAP_AuthExample.dmg" target="_top">http://developer.apple.com/internet/webservices/SOAP_AuthExampleServer.dmg</a></span>. </p>Once you have downloaded and unzipped the server, run it on port 8888 by typing <code>java -jar SOAP_AuthExampleServer 8888</code> from the console.</p>The SOAP server exposes one method, <code>Echo(string)</code>, which takes a single string parameter and echoes it back to the client. The server challenges the request, but accepts any user name and password in response. </p></div><p>As shown in the example code, begin by declaring or fetching the data that makes up the parameters and other details of the SOAP request, including the SOAP method name, method namespace, request parameters, request parameter order, and SOAP action HTTP header. The SOAP method in this case is named <code>echo</code> and takes a single string parameter named <code>param</code>. If the call is successful, the method echoes the string parameter ("I hear an echo.”) in the SOAP response. Create a dictionary of parameters and their names for SOAP calls (for XML-RPC calls, use ordinal numbers for the parameters instead of names) and an array containing the parameters in order.</p><div class="codesample"><table><tr><td scope="row"><pre>// SOAP request settings<span></span></pre></td></tr><tr><td scope="row"><pre>NSURL *url = [NSURL URLWithString:@"http://localhost:8888/"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *method = @"echo";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *namespace = @"http://localhost:8888/";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// SOAP request params<span></span></pre></td></tr><tr><td scope="row"><pre>NSDictionary *params = [NSDictionary dictionaryWithObject:@"I hear an echo."<span></span></pre></td></tr><tr><td scope="row"><pre>                                                   forKey:@"param"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSArray *paramOrder = [NSArray arrayWithObject:@"param"];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// SOAP request http headers -- some server implementations require even empty SOAPAction headers<span></span></pre></td></tr><tr><td scope="row"><pre>NSDictionary *reqHeaders = [NSDictionary dictionaryWithObject:@"" forKey:@"SOAPAction"];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p>It's generally easier to work with Cocoa objects, as shown, and cast the objects to Core Foundation types when necessary. This approach takes advantage of the toll-free bridging between Cocoa and Core Foundation, and makes many common tasks—such as memory management—easier. That said, you can make the same calls from C or C++.</p><p>The URL for this example points to the SOAP server running on port 8888 on the local host. Values for the method namespace and SOAPAction HTTP headers are also declared. Many SOAP server implementations require the presence of an empty SOAP action header even if the method itself does not specifically require a header value. Creating a dictionary with an empty value for the <code>SOAPAction</code> key and attaching it to the SOAP request forces an empty SOAP action header to be sent along with the request.</p><p>Next, a SOAP request is created from the settings above. A SOAP request is represented as a <code>WSMethodInvocationRef</code> type.</p><div class="codesample"><table><tr><td scope="row"><pre>// create SOAP request<span></span></pre></td></tr><tr><td scope="row"><pre>WSMethodInvocationRef soapReq = createSOAPRequest(url, method, namespace, params, paramOrder, reqHeaders);<span></span></pre></td></tr></table></div><p>Next, creation of the SOAP request is delegated to the <code>createSOAPRequest</code> function, which returns a <code>WSMethodInvocationRef</code> object.</p><div class="codesample"><table><tr><td scope="row"><pre>// Custom function to create SOAP request<span></span></pre></td></tr><tr><td scope="row"><pre>WSMethodInvocationRef createSOAPRequest(NSURL *url,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NSString *method,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NSString *namespace,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NSDictionary *params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NSArray *paramOrder,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        NSDictionary *reqHeaders)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationRef soapReq = WSMethodInvocationCreate((CFURLRef)url,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                             (CFStringRef)method,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                             kWSSOAP2001Protocol);<span></span></pre></td></tr><tr><td scope="row"><pre>    // set SOAP params<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetParameters(soapReq, (CFDictionaryRef)params, (CFArrayRef)paramOrder);<span></span></pre></td></tr><tr><td scope="row"><pre>    // set method namespace<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSSOAPMethodNamespaceURI, (CFStringRef)namespace);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Add HTTP headers (with SOAPAction header)<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSHTTPExtraHeaders, (CFDictionaryRef)reqHeaders);<span></span></pre></td></tr><tr><td scope="row"><pre>    // for good measure, make the request follow redirects.<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq,    kWSHTTPFollowsRedirects, kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    // set debug props<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSDebugIncomingBody,    kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSDebugIncomingHeaders, kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSDebugOutgoingBody,    kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>    WSMethodInvocationSetProperty(soapReq, kWSDebugOutgoingHeaders, kCFBooleanTrue);<span></span></pre></td></tr><tr><td scope="row"><pre>   return soapReq;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Note that in addition to creating the SOAP request, several debug properties of the <code>WSMethodInvocationRef</code> object are also set to true. This causes the raw XML contents of the SOAP request and response messages to be included in the result dictionary returned from executing the SOAP request. Viewing this raw XML can be extremely helpful in debugging SOAP client code.</p><p>The next step is to invoke the initial SOAP request. Do this using the <code>WSMethodInvocationInvoke</code> function, which returns a dictionary containing the SOAP response and other debug information.</p><p>Since the service accessed requires HTTP basic authentication, expect the HTTP headers of the SOAP response to contain authentication challenge information. To respond to the authentication challenge, retrieve the HTTP response from the result dictionary using the <code>kWSHTTPResponseMessage</code> key. The HTTP response is represented by a <code>CFHTTMessageRef</code> object.</p><div class="codesample"><table><tr><td scope="row"><pre>// invoke SOAP request<span></span></pre></td></tr><tr><td scope="row"><pre>NSDictionary *result = (NSDictionary *)WSMethodInvocationInvoke(soapReq);<span></span></pre></td></tr><tr><td scope="row"><pre>// get HTTP response from SOAP request so we can see response HTTP status code<span></span></pre></td></tr><tr><td scope="row"><pre>CFHTTPMessageRef res = (CFHTTPMessageRef)[result objectForKey:(id)kWSHTTPResponseMessage];<span></span></pre></td></tr></table></div><p>Now check for an HTTP response code of 401 or 407, which would signal an HTTP authentication challenge. If an authentication challenge is returned, you must:</p><ol class="ol"><li class="li"><p>Extract the HTTP response headers from the first SOAP response. These headers contain the necessary authentication challenge information.</p></li><li class="li"><p>Create a new <code>CFHTTMessageRef</code> object to represent a new HTTP request.</p></li><li class="li"><p>Gather user name and password information by prompting the user or by querying some external data source.</p></li><li class="li"><p>Combine the user name and password with the authentication challenge information from the initial SOAP response to create credentials.</p></li><li class="li"><p>Attach the credentials to the newly-created HTTP request.</p></li><li class="li"><p>Create a new SOAP request and combine it with the new HTTP request to produce a SOAP request with the necessary authentication credentials attached.</p></li><li class="li"><p>Invoke the new SOAP request.</p></li></ol><div class="codesample"><table><tr><td scope="row"><pre>// get status<span></span></pre></td></tr><tr><td scope="row"><pre>int resStatusCode = CFHTTPMessageGetResponseStatusCode(res);<span></span></pre></td></tr><tr><td scope="row"><pre>// if response status code indicates auth challenge, attempt to add authorization<span></span></pre></td></tr><tr><td scope="row"><pre>while (401 == resStatusCode || 407 == resStatusCode) {<span></span></pre></td></tr><tr><td scope="row"><pre>CFHTTPAuthenticationRef auth = CFHTTPAuthenticationCreateFromResponse(kCFAllocatorDefault, res);<span></span></pre></td></tr><tr><td scope="row"><pre>// extract details of the auth challenge to display<span></span></pre></td></tr><tr><td scope="row"><pre>// when prompting the user for username and password information<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *scheme = [(NSString *)CFHTTPAuthenticationCopyMethod(auth) autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *realm  = [(NSString *)CFHTTPAuthenticationCopyRealm(auth)  autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>NSArray *domains = [(NSArray *)CFHTTPAuthenticationCopyDomains(auth) autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>NSLog(@"Providing auth info for \nscheme: %@\n, realm: %@\n, domains: %@",       scheme, realm, domains);<span></span></pre></td></tr><tr><td scope="row"><pre>// Replace with a user prompt or fetch data from remote source<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *username = @"uName";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *password = @"pWord";<span></span></pre></td></tr><tr><td scope="row"><pre>// create custom http request with authorization<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *reqMethod = @"POST";<span></span></pre></td></tr><tr><td scope="row"><pre>CFHTTPMessageRef req = CFHTTPMessageCreateRequest(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                  (CFStringRef)reqMethod,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                  (CFURLRef)url,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                  kCFHTTPVersion1_1);<span></span></pre></td></tr><tr><td scope="row"><pre>// add auth creds to request.<span></span></pre></td></tr><tr><td scope="row"><pre>Boolean success = CFHTTPMessageAddAuthentication(req,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 res,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 (CFStringRef)username,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 (CFStringRef)password,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 false);<span></span></pre></td></tr><tr><td scope="row"><pre>if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"failed to add auth to request");<span></span></pre></td></tr><tr><td scope="row"><pre>    return EXIT_FAILURE;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// create a new SOAP request<span></span></pre></td></tr><tr><td scope="row"><pre>soapReq = createSOAPRequest(url, method, namespace, params, paramOrder, reqHeaders);<span></span></pre></td></tr><tr><td scope="row"><pre>// add HTTP request auth creds to SOAP request<span></span></pre></td></tr><tr><td scope="row"><pre>WSMethodInvocationSetProperty(soapReq, kWSHTTPMessage, req);<span></span></pre></td></tr><tr><td scope="row"><pre>// send SOAP request again<span></span></pre></td></tr><tr><td scope="row"><pre>result = (NSDictionary *)WSMethodInvocationInvoke(soapReq);<span></span></pre></td></tr><tr><td scope="row"><pre>NSLog(@"result: %@", result);<span></span></pre></td></tr></table></div><p>At this point, the console should reflect the string you sent to the SOAP server. You have successfully invoked a service, responded to HTTP authentication challenge, serialized your outbound query, and deserialized the response.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Overview/Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-01-06<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Networking/Conceptual/UsingWebservices/Tasks/Tasks.html%3Fid%3DTP30000985-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Networking/Conceptual/UsingWebservices/Tasks/Tasks.html%3Fid%3DTP30000985-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Networking/Conceptual/UsingWebservices/Tasks/Tasks.html%3Fid%3DTP30000985-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>