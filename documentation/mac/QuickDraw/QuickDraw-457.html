<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Printing Manager (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING457></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-456.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-458.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-406.html"><B>Chapter 9 - Printing Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING457-0></A>
<H1>Summary of the Printing Manager</H1>
<A NAME=HEADING457-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING457-2></A>
<H3>Constants</H3>
<PRE>
CONST
   iPrPgFst       = 1;        {page range constant--first page}
   iPrRelease     = 3;        {current version number of the printer driver}
   iPrPgFract     = 120;      {page scale factor}
   iPFMaxPgs      = 128;      {maximum pages in spool file}
   iPrPgMax       = 9999;     {page range constant--last page}

   {PrCtlCall constants for the iWhichCtl parameter}
   iPrBitsCtl     = 4;        {print a bitmap object}
   iPrIOCtl       = 5;        {perform text streaming}
   iPrEvtCtl      = 6;        {print object specified in lParam1 parameter}
   iPrDevCtl      = 7;        {device control command}

   {constants used with iPrBitsCtl (in the lParam1 parameter of PrCtlCall)}
   lScreenBits    = $00000000;   {resolution is 80 x 72 dpi}
   lPaintBits     = $00000001;   {resolution is 72 x 72 dpi}
   lHiScreenBits  = $00000002;   {resolution is 160 x 144 dpi}
   lHiPaintBits   = $00000003;   {resolution is 144 x 144 dpi}

   {constants used with iPrEvtCtl (in the lParam3 parameter of PrCtlCall)}
   lPrEvtAll      = $0002FFFD;   {the entire screen}
   lPrEvtTop      = $0001FFFD;   {the frontmost window}

   {constants used with iPrDevCtl (in the lParam1 parameter of PrCtlCall)}
   lPrReset       = $00010000;   {reserved}
   lPrLineFeed    = $00030000;   {paper advance}
   lPrLFStd       = $0003FFFF;   {carriage return with line feed}
   lPrLFSixth     = $0003FFFF;   {used for low-level call for ImageWriter}
   lPrPageEnd     = $00020000;   {end page}
   lPrDocOpen     = $00010000;   {open document for printing}
   lPrPageOpen    = $00040000;   {open page for printing}
   lPrPageClose   = $00020000;   {close page for printing}
   lPrDocClose    = $00050000;   {close document for printing}

   bDraftLoop     = 0;        {draft-quality printing}
   bSpoolLoop     = 1;        {deferred printing}
   bUser1Loop     = 2;        {reserved}
   bUser2Loop     = 3;        {reserved}

   iPrSavPFil     = -1;       {problem saving print file}
   iPrAbort       = $0080;    {the user pressed Command-period}

   iFMgrCtl    = 8;           {File Mgr's dialog-hook proc's control number}
   pPrGlobals  = $00000944;   {PrVars low memory area}

   iPrDrvrRef     = -3;       {reference number of printer driver}

   {opcodes used with PrGeneral}
   getRslDataOp   = 4;        {get resolutions for the current printer}
   setRslOp       = 5;        {set resolutions for a TPrint record}
   draftBitsOp    = 6;        {force enhanced draft-quality printing}
   noDraftBitsOp  = 7;        {cancel enhanced draft-quality printing}
   getRotnOp      = 8;        {get page orientation of a TPrint record}

   {result codes from PrGeneral}
   noSuchRsl      = 1;        {resolution not supported}
</PRE>
<A NAME=HEADING457-4></A>
<H3>Data Types</H3>
<PRE>
TYPE 
   TPPrint = ^TPrint;         {pointer to a TPrint record}
   THPrint = ^TPPrint;        {handle to a TPrint record}
   TPrint =                   {print record}
   RECORD
      iPrVersion: Integer;    {reserved}
      prInfo:     TPrInfo;    {resolution of device &amp; page rectangle}
      rPaper:     Rect;       {paper rectangle}
      prStl:      TPrStl;     {printer driver number &amp; feed type}
      prInfoPT:   TPrInfo;    {reserved}
      prXInfo:    TPrXInfo;   {reserved}
      prJob:      TPrJob;     {information from the job dialog box}
      printX:     ARRAY[1..19] OF Integer;
                              {reserved}
   END;
TPPrInfo = ^TPrInfo;
   TPrInfo =                  {printer information record}
   RECORD
      iDev:    Integer;       {reserved}
      iVRes:   Integer;       {vertical resolution of printer, in dpi}
      iHRes:   Integer;       {horizontal resolution of printer, in dpi}
      rPage:   Rect;          {the page rectangle}
   END;
TPPrJob = ^TPrJob;
   TPrJob =                      {print job record}
   RECORD
      iFstPage:   Integer;       {first page of page range}
      iLstPage:   Integer;       {last page of page range}
      iCopies:    Integer;       {number of copies}
      bJDocLoop:  SignedByte;    {printing method: draft or deferred}
      fFromUsr:   Boolean;       {reserved}
      pIdleProc:  PrIdleProcPtr; {pointer to an idle procedure}
      pFileName:  StringPtr;     {spool filename: NIL for default}
      iFileVol:   Integer;       {spool file volume; set to 0 initially}
      bFileVers:  SignedByte;    {spool file version; set to 0 initially}
      bJobX:      SignedByte;    {reserved}
   END;
TPPrStl = ^TPrStl;
   TPrStl =                   {printing style record}
   RECORD
      wDev:    Integer;       {device number of printer}
      iPageV:  Integer;       {reserved}
      iPageH:  Integer;       {reserved}
      bPort:   SignedByte;    {reserved}
      feed:    TFeed;         {feed type}
   END;
TPPrStatus = ^TPrStatus;
   TPrStatus =                {printing status record}
   RECORD
      iTotPages:  Integer;    {total pages in print file}
      iCurPage:   Integer;    {current page number}
      iTotCopies: Integer;    {total copies requested}
      iCurCopy:   Integer;    {current copy number}
      iTotBands:  Integer;    {reserved}
      iCurBand:   Integer;    {reserved}
      fPgDirty:   Boolean;    {TRUE if current page has been written to}
      fImaging:   Boolean;    {reserved}
      hPrint:     THPrint;    {handle to the active TPrint record}
      pPrPort:    TPPrPort;   {pointer to the active printing graphics port}
      hPic:       PicHandle;  {handle to the active picture}
   END;
TPPrDlg = ^TPrDlg;
   TPrDlg =                            {print dialog box record}
   RECORD
      Dlg:        DialogRecord;        {a dialog record}
      pFltrProc:  ModalFilterProcPtr;  {pointer to event filter}
      pItemProc:  PItemProcPtr;        {pointer to item-handling function}
      hPrintUsr:  THPrint;             {handle to a TPrint record}
      fDoIt:      Boolean;             {TRUE means user clicked OK}
      fDone:      Boolean;             {TRUE means user clicked OK or Cancel}
      lUser1:     LongInt;             {storage for your application}
      lUser2:     LongInt;             {storage for your application}
      lUser3:     LongInt;             {storage for your application}
      lUser4:     LongInt;             {storage for your application}
   END;
TPPrPort = ^TPrPort;
   TPrPort =                  {printing graphics port record}
   RECORD
      gPort:      GrafPort;   {graphics port for printing}
      gProcs:     QDProcs;    {procedures for printing in the graphics port}
      lGParam1:   LongInt;    {reserved}
      lGParam2:   LongInt;    {reserved}
      lGParam3:   LongInt;    {reserved}
      lGParam4:   LongInt;    {reserved}
      fOurPtr:    Boolean;    {reserved}
      fOurBits:   Boolean;    {reserved}
   END;
TFeed = (feedCut,feedFanfold,feedMechCut,feedOther);
TScan = (scanTB,scanBT,scanLR,scanRL);
TPRect = ^Rect; 
PrIdleProcPtr = ProcPtr;
PItemProcPtr = ProcPtr;
PDlgInitProcPtr = ProcPtr;
{records used by PrGeneral}
TGnlData = 
   RECORD
      iOpCode:    Integer; {opcode passed to PrGeneral}
      iError:     Integer; {result code returned by PrGeneral}
      lReserved:  LongInt; {more fields here depending on opcode}
   END;
TGetRslBlk =               {get-resolution record}
   RECORD
      iOpCode:    Integer;    {the getRslDataOp opcode}
      iError:     Integer;    {result code returned by PrGeneral}
      lReserved:  LongInt;    {reserved}
      iRgType:    Integer;    {printer driver version number}
      xRslRg:     TRslRg;     {x-direction resolution range}
      yRslRg:     TRslRg;     {y-direction resolution range}
      iRslRecCnt: Integer;    {number of resolution records}
      rgRslRec:   ARRAY[1..27] OF TRslRec;
                              {array of resolution records}
   END;
TRslRg = 
   RECORD
      iMin:    Integer; {minimum resolution supported}
      iMax:    Integer; {maximum resolution supported}
   END;
TRslRec = 
   RECORD
      iXRsl:   Integer; {discrete resolution, x direction}
      iYRsl:   Integer; {discrete resolution, y direction}
   END;
TSetRslBlk =               {set-resolution record}
   RECORD
      iOpCode:    Integer;    {the setRslOp opcode}
      iError:     Integer;    {result code returned by PrGeneral}
      lReserved:  LongInt;    {reserved}
      hPrint:     THPrint;    {handle to the current TPrint record}
      iXRsl:      Integer;    {x-direction resolution you want}
      iYRsl:      Integer;    {y-direction resolution you want}
   END;
TDftBitsBlk =              {draft bits record}
   RECORD
      iOpCode:    Integer;    {draftBitsOp or noDraftBitsOp opcode}
      iError:     Integer;    {result code returned by PrGeneral}
      lReserved:  LongInt;    {reserved}
      hPrint:     THPrint;    {handle to the current TPrint record}
   END;
TGetRotnBlk =              {page orientation record}
   RECORD
      iOpCode:    Integer;    {the getRotnOp opcode}
      iError:     Integer;    {result code returned by PrGeneral}
      lReserved:  LongInt;    {reserved}
      hPrint:     THPrint;    {handle to current TPrint record}
      fLandscape: Boolean;    {TRUE if user selected landscape printing}
      bXtra:      SignedByte; {reserved}
   END;
</PRE>
<A NAME=HEADING457-26></A>
<H3>Printing Manager Routines</H3>
<A NAME=HEADING457-27></A>
<H4>Opening and Closing the Printing Manager</H4>
<PRE>
PROCEDURE PrOpen;
PROCEDURE PrClose;
</PRE>
<A NAME=HEADING457-30></A>
<H4>Initializing and Validating TPrint Records</H4>
<PRE>
PROCEDURE PrintDefault      (hPrint: THPrint);
FUNCTION PrValidate         (hPrint: THPrint): Boolean;
</PRE>
<A NAME=HEADING457-33></A>
<H4>Displaying and Customizing the Print Dialog Boxes</H4>
<PRE>
FUNCTION PrStlDialog        (hPrint: THPrint): Boolean;
FUNCTION PrJobDialog        (hPrint: THPrint): Boolean;
FUNCTION PrDlgMain          (hPrint: THPrint; pDlgInit: PDlgInitProcPtr):
Boolean;
FUNCTION PrStlInit          (hPrint: THPrint): TPPrDlg;
FUNCTION PrJobInit          (hPrint: THPrint): TPPrDlg;
PROCEDURE PrJobMerge        (hPrintSrc: THPrint; hPrintDst: THPrint);
</PRE>
<A NAME=HEADING457-40></A>
<H4>Printing a Document</H4>
<PRE>
FUNCTION PrOpenDoc          (hPrint: THPrint; pPrPort: TPPrPort; 
                             pIOBuf: Ptr): TPPrPort;
PROCEDURE PrCloseDoc        (pPrPort: TPPrPort);
PROCEDURE PrOpenPage        (pPrPort: TPPrPort; pPageFrame: TPRect);
PROCEDURE PrClosePage       (pPrPort: TPPrPort);
PROCEDURE PrPicFile         (hPrint: THPrint; pPrPort: TPPrPort; 
                             pIOBuf: Ptr; pDevBuf: Ptr; 
                             VAR prStatus: TPrStatus);
</PRE>
<A NAME=HEADING457-46></A>
<H4>Optimizing Printing</H4>
<PRE>
PROCEDURE PrGeneral         (pData: Ptr);
</PRE>
<A NAME=HEADING457-48></A>
<H4>Handling Printing Errors</H4>
<PRE>
FUNCTION PrError            : Integer;
PROCEDURE PrSetError        (iErr: Integer);
</PRE>
<A NAME=HEADING457-51></A>
<H4>Low-Level Routines</H4>
<PRE>
FUNCTION PrDrvrVers         : Integer;
PROCEDURE PrDrvrOpen;
PROCEDURE PrDrvrClose;
FUNCTION PrDrvrDCE: Handle;
PROCEDURE PrCtlCall         (iWhichCtl: Integer; lParam1: LongInt;
                             lParam2: LongInt; lParam3: LongInt);
</PRE>
<A NAME=HEADING457-57></A>
<H3>Application-Defined Routines</H3>
<PRE>
PROCEDURE MyDoPrintIdle;
FUNCTION MyPrDialogAppend   (hPrint: THPrint): TPPrDlg;
</PRE>
<A NAME=HEADING457-60></A>
<H2>C Summary</H2>
<A NAME=HEADING457-61></A>
<H3>Constants</H3>
<PRE>
enum {
   iPrPgFst    = 1,     /* page range constant--first page */
   iPrRelease  = 3,     /* current version number of the printer driver */
   iPrPgFract  = 120,   /* page scale factor */
   iPFMaxPgs   = 128,   /* maximum pages in spool file */
   iPrPgMax    = 9999,  /* page range constant--last page */

   /* PrCtlCall constants for the iWhichCtl parameter */
   iPrBitsCtl     = 4,  /* print a bitmap object */
   iPrIOCtl       = 5,  /* perform text streaming */
   iPrEvtCtl      = 6,  /* print object specified in lParam1 parameter */
   iPrDevCtl      = 7,  /* device control command */

   /* constants used with iPrBitsCtl (in the lParam1 parameter 
      of PrCtlCall) */
   lScreenBits    = 0,           /* resolution is 80 x 72 dpi */
   lPaintBits     = 1,           /* resolution is 72 x 72 dpi */
   lHiScreenBits  = 0x00000002,  /* resolution is 160 x 144 dpi */
   lHiPaintBits   = 0x00000003,  /* resolution is 144 x 144 dpi */

   /* constants used with iPrEvtCtl (in the lParam3 parameter 
      of PrCtlCall) */
   lPrEvtAll      = 0x0002FFFD,  /* the entire screen */
   lPrEvtTop      = 0x0001FFFD,  /* the frontmost window */
/* constants used with iPrDevCtl (in the lParam1 parameter 
      of PrCtlCall) */
   lPrReset       = 0x00010000,  /* reserved */
   lPrLineFeed    = 0x00030000,  /* paper advance */
   lPrLFStd       = 0x0003FFFF,  /* carriage return with line feed */
   lPrLFSixth     = 0x0003FFFF,  /* used for low-level call for 
                                    ImageWriter */
   lPrPageEnd     = 0x00020000,  /* end page */
   lPrDocOpen     = 0x00010000,  /* open document for printing */
   lPrPageOpen    = 0x00040000,  /* open page for printing */
   lPrPageClose   = 0x00020000,  /* close page for printing */
   lPrDocClose    = 0x00050000,  /* close document for printing */
bDraftLoop     = 0,           /* draft-quality printing */
   bSpoolLoop     = 1,           /* deferred printing */
   bUser1Loop     = 2,           /* reserved */
   bUser2Loop     = 3,           /* reserved */
iPrSavPFil     = -1,          /* problem saving print file */
   iPrAbort       = 0x0080,      /* the user pressed Command-period */

   iFMgrCtl       = 8,           /* File Mgr's dialog-hook proc's control 
                                    number */
   pPrGlobals     = 0x00000944,     /* PrVars low memory area */

   iPrDrvrRef     = -3, /* reference number of printer driver */

   /* opcodes used with PrGeneral */
   getRslDataOp   = 4,  /* get resolutions for the current printer */
   setRslOp       = 5,  /* set resolutions for a TPrint record */
   draftBitsOp    = 6,  /* force enhanced draft-quality printing */
   noDraftBitsOp  = 7,  /* cancel enhanced draft-quality printing */
   getRotnOp      = 8,  /* get page orientation of a TPrint record */

   /* result code from PrGeneral */
   noSuchRsl      = 1,  /* resolution not supported */
};
</PRE>
<A NAME=HEADING457-66></A>
<H3>Data Types</H3>
<PRE>
struct TPrint {         /* print record */
   short    iPrVersion; /* reserved */
   TPrInfo  prInfo;     /* resolution of device &amp; page rectangle */
   Rect     rPaper;     /* paper rectangle */
   TPrStl   prStl;      /* printer driver number &amp; feed type */
   TPrInfo  prInfoPT;   /* reserved */
   TPrXInfo prXInfo;    /* reserved */
   TPrJob   prJob;      /* information from the job dialog box */ 
   short    printX[19]; /* reserved */
};
typedef struct TPrint TPrint;
typedef TPrint *TPPrint, **THPrint;
struct TPrInfo {        /* printer information record */
   short    iDev;       /* reserved */
   short    iVRes;      /* vertical resolution of printer, in dpi */
   short    iHRes;      /* horizontal resolution of printer, in dpi */
   Rect     rPage;      /* the page rectangle */
};
typedef struct TPrInfo TPrInfo;
typedef TPrInfo *TPPrInfo;
struct TPrJob {         /* print job record */
   short    iFstPage;   /* first page of page range */
   short    iLstPage;   /* last page of page range */
   short    iCopies;    /* number of copies */
   char     bJDocLoop;  /* printing method: draft or deferred */
   Boolean  fFromUsr;   /* reserved */
   PrIdleProcPtr
            pIdleProc;  /* pointer to an idle procedure */
   StringPtr
            pFileName;  /* spool filename: NIL for default */
   short    iFileVol;   /* spool file volume; set to 0 initially */
   char     bFileVers;  /* spool file version; set to 0 initially */
   char     bJobX;      /* reserved */
};
typedef struct TPrJob TPrJob;
typedef TPrJob *TPPrJob;
struct TPrStl {      /* printing style record */
   short    wDev;    /* device number of printer */
   short    iPageV;  /* reserved */
   short    iPageH;  /* reserved */
   char     bPort;   /* reserved */
   TFeed    feed;    /* feed type */
};
typedef struct TPrStl TPrStl;
typedef TPrStl *TPPrStl;
struct TPrStatus {         /* printing status record */
   short       iTotPages;  /* total pages in print file */
   short       iCurPage;   /* current page number */
   short       iTotCopies; /* total copies requested */
   short       iCurCopy;   /* current copy number */
   short       iTotBands;  /* reserved */
   short       iCurBand;   /* reserved */
   Boolean     fPgDirty;   /* TRUE if current page has been written to */
   Boolean     fImaging;   /* reserved */
   THPrint     hPrint;     /* handle to the active TPrint record */
   TPPrPort    pPrPort;    /* pointer to the active printing graphics port */
   PicHandle   hPic;       /* handle to the active picture */
};
typedef struct TPrStatus TPrStatus;
typedef TPrStatus *TPPrStatus;
struct TPrDlg {               /* print dialog box record */
   DialogRecord   Dlg;        /* a dialog record */
   ModalFilterProcPtr
                  pFltrProc;  /* pointer to event filter */
   PItemProcPtr   pItemProc;  /* pointer to item-handling function */
   THPrint        hPrintUsr;  /* handle to a TPrint record */
   Boolean        fDoIt;      /* TRUE means user clicked OK */
   Boolean        fDone;      /* TRUE means user clicked OK or Cancel */
   long           lUser1;     /* storage for your application */
   long           lUser2;     /* storage for your application */
   long           lUser3;     /* storage for your application */
   long           lUser4;     /* storage for your application */
};
typedef struct TPrDlg TPrDlg;
typedef TPrDlg *TPPrDlg;
typedef pascal TPPrDlg (*PDlgInitProcPtr)(THPrint hPrint);
truct TPrPort {         /* printing graphics port record */
   GrafPort gPort;      /* graphics port for printing */
   QDProcs  gProcs;     /* procedures for printing in the graphics port */
   long     lGParam1;   /* reserved */
   long     lGParam2;   /* reserved */
   long     lGParam3;   /* reserved */
   long     lGParam4;   /* reserved */
   Boolean  fOurPtr;    /* reserved */
   Boolean  fOurBits;   /* reserved */
};
typedef struct TPrPort TPrPort;
typedef TPrPort *TPPrPort;
enum {feedCut,feedFanfold,feedMechCut,feedOther};
typedef unsigned char TFeed;
enum {scanTB,scanBT,scanLR,scanRL};
typedef unsigned char TScan;
typedef Rect *TPRect;
typedef pascal void (*PrIdleProcPtr)(void);
typedef pascal void (*PItemProcPtr)(DialogPtr theDialog, short item);
/* structures used by PrGeneral */
struct TGnlData {
   short iOpCode;    /* opcode passed to PrGeneral */
   short iError;     /* result code returned by PrGeneral */
   long  lReserved;  /* more fields here depending on call */
};
typedef struct TGnlData TGnlData;
struct TGetRslBlk {        /* get-resolution record */
   short    iOpCode;       /* the getRslDataOp opcode */
   short    iError;        /* result code returned by PrGeneral */
   long     lReserved;     /* reserved */
   short    iRgType;       /* printer driver version number */
   TRslRg   xRslRg;        /* x-direction resolution range */
   TRslRg   yRslRg;        /* y-direction resolution range */
   short    iRslRecCnt;    /* number of resolution records */
   TRslRec  rgRslRec[27];  /* array of resolution records */
};
typedef struct TGetRslBlk TGetRslBlk;
struct TRslRg {   
   short    iMin;          /* minimum resolution supported */
   short    iMax;          /* maximum resolution supported */
};
typedef struct TRslRg TRslRg;
struct TRslRec {  
   short    iXRsl;         /* discrete resolution, x direction */
   short    iYRsl;         /* discrete resolution, y direction */
};
typedef struct TRslRec TRslRec;
struct TSetRslBlk {        /* set-resolution record */
   short    iOpCode;       /* the setRslOp opcode */
   short    iError;        /* result code returned by PrGeneral */
   long     lReserved;     /* reserved */
   THPrint  hPrint;        /* handle to the current TPrint record */
   short    iXRsl;         /* x-direction resolution you want */
   short    iYRsl;         /* y-direction resolution you want */
};
typedef struct TSetRslBlk TSetRslBlk;
struct TDftBitsBlk {       /* draft bits record */
   short    iOpCode;       /* draftBitsOp or noDraftBitsOp opcode */
   short    iError;        /* result code returned by PrGeneral */
   long     lReserved;     /* reserved */
   THPrint  hPrint;        /* handle to the current TPrint record */
};
typedef struct TDftBitsBlk TDftBitsBlk;
struct TGetRotnBlk {       /* page orientation record */
   short    iOpCode;       /* the getRotnOp opcode */
   short    iError;        /* result code returned by PrGeneral */
   long     lReserved;     /* reserved */
   THPrint  hPrint;        /* handle to current TPrint record */
   Boolean  fLandscape;    /* TRUE if user selected landscape printing */
   char     bXtra;         /* reserved */
};
typedef struct TGetRotnBlk TGetRotnBlk;
</PRE>
<A NAME=HEADING457-88></A>
<H3>Printing Manager Functions</H3>
<A NAME=HEADING457-89></A>
<H4>Opening and Closing the Printing Manager</H4>
<PRE>
pascal void PrOpen              (void); 
pascal void PrClose             (void); 
</PRE>
<A NAME=HEADING457-92></A>
<H4>Initializing and Validating TPrint Records</H4>
<PRE>
pascal void PrintDefault        (THPrint hPrint); 
pascal Boolean PrValidate       (THPrint hPrint); 
</PRE>
<A NAME=HEADING457-95></A>
<H4>Displaying and Customizing the Print Dialog Boxes</H4>
<PRE>
pascal Boolean PrStlDialog      (THPrint hPrint); 
pascal Boolean PrJobDialog      (THPrint hPrint); 
pascal Boolean PrDlgMain        (THPrint hPrint, PDlgInitProcPtr pDlgInit); 
pascal TPPrDlg PrStlInit        (THPrint hPrint); 
pascal TPPrDlg PrJobInit        (THPrint hPrint); 
pascal void PrJobMerge          (THPrint hPrintSrc, THPrint hPrintDst); 
</PRE>
<A NAME=HEADING457-102></A>
<H4>Printing a Document</H4>
<PRE>
pascal TPPrPort PrOpenDoc       (THPrint hPrint, TPPrPort pPrPort, Ptr pIOBuf); 
pascal void PrCloseDoc          (TPPrPort pPrPort); 
pascal void PrOpenPage          (TPPrPort pPrPort, TPRect pPageFrame); 
pascal void PrClosePage         (TPPrPort pPrPort); 
pascal void PrPicFile           (THPrint hPrint, TPPrPort pPrPort, Ptr pIOBuf,
                                 Ptr pDevBuf, TPrStatus *prStatus); 
</PRE>
<A NAME=HEADING457-108></A>
<H4>Optimizing Printing</H4>
<PRE>
pascal void PrGeneral           (Ptr pData); 
</PRE>
<A NAME=HEADING457-110></A>
<H4>Handling Printing Errors</H4>
<PRE>
pascal short PrError            (void); 
pascal void PrSetError          (short iErr);
</PRE>
<A NAME=HEADING457-113></A>
<H4>Low-Level Functions</H4>
<PRE>
pascal short PrDrvrVers         (void);
pascal void PrDrvrOpen          (void); 
pascal void PrDrvrClose         (void); 
pascal Handle PrDrvrDCE         (void); 
pascal void PrCtlCall           (short iWhichCtl, long lParam1,
                                 long lParam2, long lParam3); 
</PRE>
<A NAME=HEADING457-119></A>
<H3>Application-Defined Functions</H3>
<PRE>
pascal void MyDoPrintIdle       (void);
pascal TPPrDlg MyPrDialogAppend
                                (THPrint hPrint);
</PRE>
<A NAME=HEADING457-123></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING457-124></A>
<H3>Data Structures</H3>
<A NAME=HEADING457-125></A>
<H4>TPrint Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>iPrVersion<TD>word<TD>printer driver version that initialized this record<TR>
<TD>2<TD>prInfo<TD>14 bytes<TD><CODE>TPrInfo</CODE> data structure with resolution of device and page rectangle<TR>
<TD>16<TD>rPaper<TD>8 bytes<TD>paper rectangle<TR>
<TD>24<TD>prStl<TD>8 bytes<TD><CODE>TPrStl</CODE> data structure with printer driver number and feed type<TR>
<TD>32<TD>prInfoPT<TD>14 bytes<TD><CODE>TPrInfo</CODE> data structure; reserved<TR>
<TD>46<TD>prXInfo<TD>16 bytes<TD><CODE>TPrXInfo</CODE> data structure; reserved<TR>
<TD>62<TD>prJob<TD>20 bytes<TD><CODE>TPrJob</CODE> data structure with printing information from the job dialog box<TR>
<TD>82<TD>printX<TD>40 bytes<TD>reserved</TABLE>
</H4>
<A NAME=HEADING457-126></A>
<H4>TPrInfo Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>iDev<TD>6 bytes<TD>first word is reserved; second word contains vertical resolution of printer, in dpi; third word contains horizontal resolution of printer, in dpi<TR>
<TD>6<TD>rPage<TD>8 bytes<TD>the page rectangle</TABLE>
</H4>
<A NAME=HEADING457-127></A>
<H4>TPrJob Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>iFstPage<TD>word<TD>first page of page range<TR>
<TD>2<TD>iLstPage<TD>word<TD>last page of page range<TR>
<TD>4<TD>iCopies<TD>word<TD>number of copies<TR>
<TD>6<TD>bJDocLoop<TD>1 byte<TD>printing method: draft or deferred<TR>
<TD>7<TD>fFromApp<TD>1 byte<TD>reserved<TR>
<TD>8<TD>pIdleProc<TD>long<TD>pointer to an idle procedure<TR>
<TD>12<TD>pFileName<TD>long<TD>spool filename: <CODE>NIL</CODE> for default<TR>
<TD>16<TD>iFileVol<TD>word<TD>spool file volume: set to 0 initially<TR>
<TD>18<TD>bFileVers<TD>1 byte<TD>spool file version: set to 0 initially</TABLE>
</H4>
<A NAME=HEADING457-128></A>
<H4>TPrStl Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>wDev<TD>word<TD>device number of the current printer (in the high-order byte of this field); the low-order byte of this field is reserved<TR>
<TD>2<TD>iPageV<TD>word<TD>reserved<TR>
<TD>4<TD>iPageH<TD>word<TD>reserved<TR>
<TD>7<TD>feed<TD>1 byte<TD>paper feed type</TABLE>
</H4>
<A NAME=HEADING457-129></A>
<H4>TPrStatus Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>iTotPages<TD>word<TD>total pages in print file<TR>
<TD>2<TD>iCurPage<TD>word<TD>current page number<TR>
<TD>4<TD>iTotCopies<TD>word<TD>total copies requested<TR>
<TD>6<TD>iCurCopy<TD>word<TD>current copy number<TR>
<TD>8<TD>iTotBands<TD>word<TD>reserved<TR>
<TD>10<TD>iCurBand<TD>word<TD>reserved<TR>
<TD>12<TD>fPgDirty<TD>1 byte<TD><CODE>TRUE</CODE> if current page has been written to<TR>
<TD>13<TD>fImaging<TD>1 byte<TD>reserved<TR>
<TD>14<TD>hPrint<TD>long<TD>handle to the active <CODE>TPrint</CODE> data structure<TR>
<TD>18<TD>pPrPort<TD>long<TD>pointer to the active printing graphics port<TR>
<TD>22<TD>hPic<TD>long<TD>handle to the active picture</TABLE>
</H4>
<A NAME=HEADING457-130></A>
<H4>TPrDlg Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>dlg<TD>168 bytes<TD>a dialog record<TR>
<TD>168<TD>pFltrProc<TD>long<TD>pointer to event filter<TR>
<TD>172<TD>pItemProc<TD>long<TD>pointer to item-handling function<TR>
<TD>176<TD>hPrintUsr<TD>long<TD>handle to <CODE>TPrint</CODE> data structure<TR>
<TD>180<TD>fDoIt<TD>1 byte<TD><CODE>TRUE</CODE> means user clicked OK<TR>
<TD>181<TD>fDone<TD>1 byte<TD><CODE>TRUE</CODE> means user clicked OK or Cancel<TR>
<TD>182<TD>lUser1<TD>long<TD>storage for your application<TR>
<TD>186<TD>lUser2<TD>long<TD>storage for your application<TR>
<TD>190<TD>lUser3<TD>long<TD>storage for your application<TR>
<TD>194<TD>lUser4<TD>long<TD>storage for your application</TABLE>
</H4>
<A NAME=HEADING457-131></A>
<H4>TPrPort Data Structure
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>gPort<TD>178 bytes<TD>graphics port and procedures for printing</TABLE>
</H4>
<A NAME=HEADING457-132></A>
<H3>Trap Macros</H3>
<A NAME=HEADING457-133></A>
<H4>Trap Macros Requiring Routine Selectors</H4>
<PRE>
_PrGlue</PRE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>$C8000000<TD>PrOpen<TR>
<TD>$D0000000<TD>PrClose<TR>
<TD>$20040480<TD>PrintDefault<TR>
<TD>$52040498<TD>PrValidate<TR>
<TD>$2A040484<TD>PrStlDialog<TR>
<TD>$32040488<TD>PrJobDialog<TR>
<TD>$4A040894<TD>PrDlgMain<TR>
<TD>$3C04040C<TD>PrStlInit<TR>
<TD>$44040410<TD>PrJobInit<TR>
<TD>$5804089C<TD>PrJobMerge<TR>
<TD>$04000C00<TD>PrOpenDoc<TR>
<TD>$08000484<TD>PrCloseDoc<TR>
<TD>$10000808<TD>PrOpenPage<TR>
<TD>$1800040C<TD>PrClosePage<TR>
<TD>$60051480<TD>PrPicFile<TR>
<TD>$BA000000<TD>PrError<TR>
<TD>$C0000200<TD>PrSetError<TR>
<TD>$70070480<TD>PrGeneral<TR>
<TD>$94000000<TD>PrDrvrDCE<TR>
<TD>$9A000000<TD>PrDrvrVers<TR>
<TD>$80000000<TD>PrDrvrOpen<TR>
<TD>$88000000<TD>PrDrvrClose<TR>
<TD>$A0000E00<TD>PrCtlCall</TABLE>


<A NAME=HEADING457-135></A>
<H3>Global Variable
<TABLE BORDER="0" CELLPADDING=3><TD>PrintErr<TD>Printing error.</TABLE>
</H3>
<A NAME=HEADING457-136></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>iPrAbort<TD>128<TD>Application or user requested cancel<TR>
<TD>opNotImpl<TD>2<TD>Requested <CODE>PrGeneral</CODE> opcode not implemented in the current printer driver<TR>
<TD>noSuchRsl<TD>1<TD>Resolution requested with the <CODE>PrGeneral</CODE> procedure is not supported<TR>
<TD>noErr<TD>0<TD>No error<TR>
<TD>iPrSavPFil<TD>-1<TD>Problem saving print file<TR>
<TD>controlErr<TD>-17<TD>Unimplemented control instructions; the Device Manager returns this result code<TR>
<TD>iIOAbort<TD>-27<TD>I/O error<TR>
<TD>iMemFullErr<TD>-108<TD>There is not enough room in the heap zone<TR>
<TD>resNotFound<TD>-192<TD>The current printer driver does not support <CODE>PrGeneral</CODE>; you should clear this error with a call to <CODE>PrSetError</CODE> with a parameter value of 0; otherwise, <CODE>PrError</CODE> might still contain this error next time you check it <TR>
<TD>PAPNoCCBs<TD>-4096<TD>There are no free connect control blocks (CCBs) available<TR>
<TD>PAPBadRefnum<TD>-4097<TD>Bad connection reference number<TR>
<TD>PAPActive<TD>-4098<TD>The request is already active<TR>
<TD>PAPTooBig<TD>-4099<TD>The write request is too big<TR>
<TD>PAPConnClosed<TD>-4100<TD>The connection is closed<TR>
<TD>PAPNoPrinter<TD>-4101<TD>The printer is not found, is closed, or is not selected<TR>
<TD>&nbsp;<TD>-8131<TD>Printer not responding<TR>
<TD>manualFeedTOErr<TD>-8132<TD>A timeout occurred (that is, no communication has occurred with the printer for two minutes); this is usually caused by an extremely long imaging time or a dropped connection<TR>
<TD>generalPSErr<TD>-8133<TD>A PostScript error occurred during transmission of data to the printer; this is most often caused by a bug in the application-supplied PostScript code<TR>
<TD>zoomRangeErr<TD>-8160<TD>The print image enlarged by the user with the Page Setup dialog box overflows the available page resolution<TR>
<TD>errBadFontKeyType<TD>-8976<TD>Font found in printer is not Type 1, TrueType, or bitmapped font<TR>
<TD>errPSStateUnderflow<TD>-8977<TD>PostScript stack underflow while restoring graphics state<TR>
<TD>errNoPattern<TD>-8978<TD>The pixel pattern could not be found and could not be built<TR>
<TD>errBadConverterID<TD>-8979<TD>The <CODE>'PDEF'</CODE> converter doesn't exist<TR>
<TD>errNoPagesSpooled<TD>-8980<TD>Application called <CODE>PrOpenDoc</CODE> and <CODE>PrCloseDoc</CODE> without calling <CODE>PrOpenPage</CODE> and <CODE>PrClosePage</CODE> in between<TR>
<TD>errNullColorInfo<TD>-8981<TD>The <CODE>getColor</CODE> function called with null <CODE>GetColorInfo</CODE> handle<TR>
<TD>errPSFileNameNull<TD>-8982<TD>The filename pointer for the spool file is null<TR>
<TD>errSpoolFolderIsAFile<TD>-8983<TD>The spool folder is a file instead of a folder<TR>
<TD>errBadConverterIndex<TD>-8984<TD>When saving a spool file to disk, the value <CODE>fileTypeIndex</CODE> field had no matching entry in the driver<TR>
<TD>errDidNotDownloadFont<TD>-8985<TD>A PostScript outline could not be found for a PostScript font, and there is no associated <CODE>'sfnt'</CODE> resource<TR>
<TD>errBitmapFontMissing<TD>-8986<TD>Unable to build bitmap for font<TR>
<TD>errPSFileName<TD>-8987<TD>PostScript file isn't named<TR>
<TD>errCouldNotMakeNumberedFilename<TD>-8989<TD>Could not make a unique filename for the spool file<TR>
<TD>errBadSpoolFileVersion<TD>-8990<TD>Bad version number in header of spool file<TR>
<TD>errNoProcSetRes<TD>-8991<TD>The resource describing needed procedure sets is unavailable for the PostScript prolog<TR>
<TD>errInLineTimeout<TD>-8993<TD>The printer is not responding<TR>
<TD>errUnknownPSLevel<TD>-8994<TD>The PostScript level has an unknown value<TR>
<TD>errFontNotFound<TD>-8995<TD>Font query reply didn't match any fonts in list of PostScript names<TR>
<TD>errSizeListBad<TD>-8996<TD>The size list contained an entry that could not be reconciled with the typeface list<TR>
<TD>errFaceListBad<TD>-8997<TD>Entry could not be found in typeface list<TR>
<TD>errNotAKey<TD>-8998<TD>Key for desired font number and style could not be found in font table</TABLE>
</H2>
 <A NAME=MARKER-2-624></A><P>


</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-456.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-458.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
