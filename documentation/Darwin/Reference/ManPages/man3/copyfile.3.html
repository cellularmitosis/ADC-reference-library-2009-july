<html><head><title>Mac OS X
 Manual Page For copyfile(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/copyfile" title="Mac OS X
 Manual Page for copyfile(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/copyfile"; name=copyfile(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
COPYFILE(3)              BSD Library Functions Manual              COPYFILE(3)

<b>NAME</b>
     <b>copyfile</b>, <b>fcopyfile</b>, <b>copyfile_state_alloc</b>, <b>copyfile_state_free</b>, <b>copyfile_state_get</b>, <b>copyfile_state_set</b>
     -- copy a file

<b>LIBRARY</b>
     Standard C Library (libc, -lc)

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;copyfile.h&gt;</b>

     <u>int</u>
     <b>copyfile</b>(<u>const</u> <u>char</u> <u>*from</u>, <u>const</u> <u>char</u> <u>*to</u>, <u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>copyfile</u><b>_</b><u>flags</u><b>_</b><u>t</u> <u>flags</u>);

     <u>int</u>
     <b>fcopyfile</b>(<u>int</u> <u>from</u>, <u>int</u> <u>to</u>, <u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>copyfile</u><b>_</b><u>flags</u><b>_</b><u>t</u> <u>flags</u>);

     <u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u>
     <b>copyfile_state_alloc</b>(<u>void</u>);

     <u>int</u>
     <b>copyfile_state_free</b>(<u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>);

     <u>int</u>
     <b>copyfile_state_get</b>(<u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>uint32</u><b>_</b><u>t</u> <u>flag</u>, <u>void</u> <u>*</u> <u>dst</u>);

     <u>int</u>
     <b>copyfile_state_set</b>(<u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> <u>state</u>, <u>uint32</u><b>_</b><u>t</u> <u>flag</u>, <u>const</u> <u>void</u> <u>*</u> <u>src</u>);

<b>DESCRIPTION</b>
     These functions are used to copy a file's data and/or metadata.  (Metadata consists of permissions,
     extended attributes, access control lists, and so forth.)

     The <b>copyfile_state_alloc</b>() function initializes a <u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> object (which is an opaque data
     type).  This object can be passed to <b>copyfile</b>() and <b>fcopyfile</b>(); <b>copyfile_state_get</b>() and
     <b>copyfile_state_set</b>() can be used to manipulate the state (see below).  The <b>copyfile_state_free</b>() func-<font color="#ffffff" class="whiteout">tion&nbsp;function</font>
     tion is used to deallocate the object and its contents.

     The <b>copyfile</b>() function can copy the named <u>from</u> file to the named <u>to</u> file; the <b>fcopyfile</b>() function
     does the same, but using the file descriptors of already-opened files.  If the <u>state</u> parameter is the
     return value from <b>copyfile_state_alloc</b>(), then <b>copyfile</b>() and <b>fcopyfile</b>() will use the information from
     the state object; if it is NULL, then both functions will work normally, but less control will be
     available to the caller.  The <u>flags</u> parameter controls which contents are copied:

     COPYFILE_ACL    Copy the source file's access control lists.

     COPYFILE_STAT   Copy the source file's POSIX information (mode, modification time, etc.).

     COPYFILE_XATTR  Copy the source file's extended attributes.

     COPYFILE_DATA   Copy the source file's data.

     These values may be or'd together; several convenience macros are provided:

     COPYFILE_SECURITY  Copy the source file's POSIX and ACL information; equivalent to
                        (COPYFILE_STAT|COPYFILE_ACL).

     COPYFILE_METADATA  Copy the metadata; equivalent to (COPYFILE_SECURITY|COPYFILE_XATTR).

     COPYFILE_ALL       Copy the entire file; equivalent to (COPYFILE_METADATA|COPYFILE_DATA).

     The <b>copyfile</b>() and <b>fcopyfile</b>() functions can also have their behavior modified by the following flags:

     COPYFILE_CHECK         Return a bitmask (corresponding to the <u>flags</u> argument) indicating which contents
                            would be copied; no data are actually copied.  (E.g., if <u>flags</u> was set to
                            COPYFILE_CHECK|COPYFILE_METADATA, and the <u>from</u> file had extended attributes but
                            no ACLs, the return value would be COPYFILE_XATTR .)

     COPYFILE_PACK          Serialize the <u>from</u> file.  The <u>to</u> file is an AppleDouble-format file.

     COPYFILE_UNPACK        Unserialize the <u>from</u> file.  The <u>from</u> file is an AppleDouble-format file; the <u>to</u>
                            file will have the extended attributes, ACLs, resource fork, and FinderInfo data
                            from the <u>to</u> file, regardless of the <u>flags</u> argument passed in.

     COPYFILE_EXCL          Fail if the <u>to</u> file already exists.  (This is only applicable for the <b>copyfile</b>()
                            function.)

     COPYFILE_NOFOLLOW_SRC  Do not follow the <u>from</u> file, if it is a symbolic link.  (This is only applicable
                            for the <b>copyfile</b>() function.)

     COPYFILE_NOFOLLOW_DST  Do not follow the <u>to</u> file, if it is a symbolic link.  (This is only applicable
                            for the <b>copyfile</b>() function.)

     COPYFILE_MOVE          Unlink (remove) the <u>from</u> file.  (This is only applicable for the <b>copyfile</b>()
                            function.)

     COPYFILE_UNLINK        Unlink the <u>to</u> file before starting.  (This is only applicable for the <b>copyfile</b>()
                            function.)

     COPYFILE_NOFOLLOW      This is a convenience macro, equivalent to
                            (COPYFILE_NOFOLLOW_DST|COPYFILE_NOFOLLOW_SRC).

     The <b>copyfile_state_get</b>() and <b>copyfile_state_set</b>() functions can be used to manipulate the
     <u>copyfile</u><b>_</b><u>state</u><b>_</b><u>t</u> object returned by <b>copyfile_state_alloc</b>().  In both functions, the <u>dst</u> parameter's
     type depends on the <u>flag</u> parameter that is passed in.

     COPYFILE_STATE_SRC_FD

     COPYFILE_STATE_DST_FD        Get or set the file descriptor associated with the source (or destination)
                                  file.  If this has not been initialized yet, the value will be -2.  The
                                  <u>dst</u> (for <b>copyfile_state_get</b>()) and <u>src</u> (for <b>copyfile_state_set</b>()) parame-<font color="#ffffff" class="whiteout">ters&nbsp;parameters</font>
                                  ters are pointers to <u>int</u>.

     COPYFILE_STATE_SRC_FILENAME

     COPYFILE_STATE_DST_FILENAME  Get or set the filename associated with the source (or destination) file.
                                  If it has not been initialized yet, the value will be NULL.  For
                                  <b>copyfile_state_set</b>(), the <u>src</u> parameter is a pointer to a C string (i.e.,
                                  <u>char*</u> <u>);</u> <b>copyfile_state_set</b>() makes a private copy of this string.  For
                                  <b>copyfile_state_get</b>() function, the <u>dst</u> parameter is a pointer to a pointer
                                  to a C string (i.e., <u>char**</u> <u>);</u> the returned value is a pointer to the
                                  <u>state</u> <u>'s</u> copy, and must not be modified or released.

     COPYFILE_STATE_QUARANTINE    Get or set the quarantine information with the source file.  The <u>src</u>
                                  parameter is a pointer to a <u>qtn</u><b>_</b><u>file</u><b>_</b><u>t</u> object (see <u>&lt;quarantine.h&gt;</u> <u>).</u> In
                                  the case of COPYFILE_STATE_SET, the object is cloned; in the case of
                                  COPYFILE_STATE_GET, the object is simply returned, and it is up to the
                                  caller to clone it if desired.

<b>RETURN</b> <b>VALUES</b>
     Except when given the COPYFILE_CHECK flag, <b>copyfile</b>() and <b>fcopyfile</b>() return less than 0 on error, and
     0 on success.  All of the other functions return 0 on success, and less than 0 on error.

<b>ERRORS</b>
     <b>copyfile</b>() and <b>fcopyfile</b>() will fail if:

     [EINVAL]           Either the <u>from</u> or <u>to</u> parameter was a NULL pointer ( <b>copyfile</b>(<u>),</u>) or a negative num-<font color="#ffffff" class="whiteout">ber&nbsp;number</font>
                        ber ( <b>fcopyfile</b>(<u>).</u>)

     [ENOMEM]           A memory allocation failed.

     [ENOTSUP]          The source file was not a directory, symbolic link, or regular file.
     In addition, both functions may set errno via an underlying library or system call.

<b>EXAMPLES</b>
           /* Initialize a state variable */
           copyfile_state_t s;
           s = copyfile_state_alloc();
           /* Copy the data and extended attributes of one file to another */
           copyfile("/tmp/f1", "/tmp/f2", s, COPYFILE_DATA | COPYFILE_XATTR);
           /* Convert a file to an AppleDouble file for serialization */
           copyfile("/tmp/f2", "/tmp/tmpfile", NULL, COPYFILE_ALL | COPYFILE_PACK);
           /* Release the state variable */
           <!-- a -->copyfile_state_free(s)<!-- /a -->;
           /* A more complex way to call copyfile() */
           s = copyfile_state_alloc();
           copyfile_state_set(s, COPYFILE_STATE_SRC_FILENAME, "/tmp/foo");
           /* One of src or dst must be set... rest can come from the state */
           copyfile(NULL, "/tmp/bar", s, COPYFILE_ALL);
           /* Now copy the same source file to another destination file */
           copyfile(NULL, "/tmp/car", s, COPYFILE_ALL);
           <!-- a -->copyfile_state_free(s)<!-- /a -->;

<b>BUGS</b>
     Both <b>copyfile</b>() functions lack a way to set the input or output block size.

<b>HISTORY</b>
     The <b>copyfile</b>() API was introduced in Mac OS X 10.5.

BSD                             April 27, 2006                             BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/copyfile.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/copyfile.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/copyfile.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
