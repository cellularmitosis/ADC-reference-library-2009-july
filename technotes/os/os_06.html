<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OS06: Control Strip Modules</title><meta name="keywords" content="Mac OS 8 Control Strip writing Modules sdev SBIsControlStripVisible SBLoadPreferences"><meta name="Description" content="Technical Note OS06: This Technical Note discusses controlstrip modules and details how to write a new module. Thisis accomplished by providing a description of the controlstrip, the resources required of the module file, the messagesfrom the Control Strip that a module must respond to, thelist of utility routines supplied by the Control Strip tothe module, and the Gestalt selectors used by the ControlStrip to return information to the world.">                                       <meta name="categories" content="Operating System"><meta name="week-posted" content="Jun 27, 1994 - Jul 1, 1994"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002592" title="Control Strip Modules"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OS06</div>
<div id="pageheadsub">Control Strip Modules</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><br><A HREF="#References">References</A><BR><br>                  <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">We discuss Control Strip modules and how to write a new module.  Thisinformation originally appeared in the <i>PowerBook 520, 520c, 540, 540cDeveloper Note.</i>  It is being published as a Technical Note for ease ofaccess. The information in the <i>PowerBook 520, 520c, 540, 540c DeveloperNote</i> is obsolete. All future updates to this documentation will happenwithin this Technical Note.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>July 01 1994</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->          <P><A NAME=Section1></A></P><h2>Introduction</h2><h3>Topics</h3><ul><li>Adding a Control Strip</li><li>Module Interface</li><li>Module Reentrancy</li><li>Control Strip Module Reference</li><li>Utility Routines</li><li>Gestalt Selectors</li></ul><p>The Control Strip is a control panel that provides the operating environmentfor Control Strip modules. It runs on any Macintosh PowerBook computer withSystem 7.0 or later.</p><p>The Control Strip is implemented in a private layer that appears in front ofthe windows in all the application layers so that the windows will not obscureit. The user can move the window for the Control Strip to any location on thedisplay as long as the right or left edge of the strip is anchored to the rightor left edge of the display.  Figure 1 shows a Control Strip fully opened, withsome imaginary modules added.</p><p align=center><img src="images/os_06_001.gif" alt="Figure 1" width=368 height=27></p><p align=center><b>Figure 1</b>. Control Strip, opened</p><p>The Control Strip has a tab on its unanchored end. The user can drag the tab toadjust the length of the strip or hold down the Option key and drag the tab tomove the strip to a new position. The user can reduce the Control Strip to justdisplay the tab alone, by clicking the tab. Clicking the tab when the ControlStrip is hidden makes the Control Strip visible again.</p><p>The different parts of the Control Strip either display status information oract as buttons. When the user clicks a button, it is highlighted; some buttonsalso display additional elements such as pop-up menus.</p><p>By holding down the Option key and clicking a display area, the user can dragthe display area to another position in the Control Strip.</p><p>The Control Strip software provides a standard screen location for a collectionof individual modules that provide status and control functions.</p><p>The Control Strip is implemented in software as a shell with individual controland status modules added. The Control Strip software draws the strip that actsas the background for the individual modules. Each module is responsible fordrawing the icons and other objects that make up its user interface.</p><p>The only required resource in a module file is a resource containing the codenecessary for the module to interact with the Control Strip.  A module file maycontain more than one code resource if it is to provide support for more thanone function. In that case, each module in the file is loaded and initializedseparately and treated as an independent entity.</p><p>If a file contains only a single code resource, the resource may be unnamed,and the module will be referenced by its filename. If more than one module iscontained within a module file, each module is required to have a unique namedescribing its functionality.</p><p>All other resources in a module file are optional, but there are several thatare recommended in order to support a custom icon and version information. Therecommended resources are:</p><ul type="disc">	<li><code>'BNDL'</code></li>	<li><code>'FREF'</code></li>	<li><code>'ICN#'</code>, <code>'icl4'</code>, <code>'icl8'</code>, <code>'ics#'</code>, <code>'ics4'</code>, <code>'ics8'</code></li>	<li>signature resource (same type as file's creator)</li>	<li>'vers', ID=1</li></ul><p>Developers should confine their resources to the range 256-32767.</p><p>The module's interface to the Control Strip consists of a code resource of type<code>'sdev'</code>.  This code is responsible for performing all of the functionsrequired by the Control Strip (see below) as well as any functions that arecustom to the module itself. The module's entry point is at the beginning ofthe resource and is defined as</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal long ControlStripModule(long message,                               long params,                               Rect *statusRect,                               GrafPtr statusPort);</pre>	</TD></TR></TABLE></CENTER><p>Interactions between a module and the Control Strip are managed by passing messages to the module to tell it what to do or to obtain information about the module and itscapabilities. Each module is required to observe Pascal register saving conventions.  A module may trash registers <code>D0</code>, <code>D1</code>, <code>D2</code>, <code>A0</code>, and <code>A1</code>, but must preserve all other registers across its call.</p><p><code>message</code>    A message number, from the list in the section "Control StripModule Messages", that tells the module what action to perform.</p><p><code>params</code>    The result returned by the initialize call to the module.  Thiswould typically be the handle to the module's private variables.  It will bepassed to the module on all subsequent calls.  (Control Strip modules are coderesources, so they need to use the techniques described in Technote PT 35 -Stand-Alone Code, <i>ad nauseam</i> in order to use global variables.)</p><p><code>statusRect</code>    A pointer to a rectangle defining the area that a module maydraw within.</p><p><code>statusPort</code>    A pointer to the Control Strip's graphics port. This will beeither a color or black-and-white graphics port depending on which PowerBookModel the Control Strip is running on.</p><p>The result value returned by the module will vary depending on the message sent to it. Results for each message are described in the sections on the individual messages.</p><p>Any module that makes calls to routines such as <code>GetNextEvent</code>,<code>ModalDialog</code> or <code>PopUpMenuSelect</code> should assume that it could becalled reentrantly; that is, the module could be called again while the initialcall is still in progress.  Situations to avoid are such things as reusing asingle parameter block for multiple calls.</p><p>Instead of using a single parameter block, it's better, if possible, toallocate the parameter block on the stack.  In the case of asynchronous calls,using the stack could cause problems; in that case, preventing the block'sreuse should be sufficient.</p><p>If you need to lock and unlock your global variables, it's better to use<code>HGetState</code> and <code>HLock</code> at the beginning of the call, and <code>HSetState</code> at the end, so that the state is restored to what it was on entry.</p><p>Control strip modules interact with the Control Strip software in three ways:by accepting messages, by calling utility routines, and by calling Gestaltselectors. The next three sections describe each of those interactions.</p><p>All Control Strip modules must respond to messages from the Control Strip. Thefollowing messages have been defined:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre><b>Message name     number  Description </b>sdevInitModule      0       Initialize the modulesdevCloseModule     1       Clean up before being closedsdevFeatures        2       Return the feature bitssdevGetDisplayWidth 3       Return the width of the module's displaysdevPeriodicTickle  4       Periodically called when nothing else is happeningsdevDrawStatus      5       Update the interface in the Control StripsdevMouseClick      6       User has clicked on the module's display areasdevSaveSettings    7       Save any changed settings in the module's preferences filesdevShowBalloonHelp 8       Display a help balloon, if the module has one</pre>	</TD></TR></TABLE></CENTER><p>The <code>sdevInitModule</code> message is the first message sent to a module afterthe module has been loaded from its file.  Initialization allows the module toinitialize its variables and to determine whether it can run on a particularmachine: for example, if the module's function is to display batteryinformation it can run only on a PowerBook.</p><p>The module needs to load and detach any resources in the module's resource filethat will be used, because the resource file will not be kept permanently open.What that means is that your code can't use <code>GetResource</code>() or the liketo retrieve the handle to one of the module's resources on a subsequent call.Typically you would allocate space in your global variables for handles tothose detached resources.</p><p>The <code>sdevInitModule</code> message returns a result depending on its successat installing itself.  A positive result <code>(&gt;=0)</code> indicates successfulinstallation.  This result value will be passed to the module on all subsequentcalls.  A negative result indicates an error condition, and installation of themodule is aborted by the Control Strip software.  The module will not receive aclose message when installation has been aborted.</p><p>The <code>sdevCloseModule</code> message is sent to a module when it should beclosed.  Typically the module itself will decide when this ought to happen.When the module receives this message, it should dispose of all the detachedresources it loaded as well as its global storage.  No result is expected.</p><p>The <code>sdevFeatures</code> message queries the module for the features itsupports.  It returns as its result a long consisting of 1 bits for supportedfeatures and 0 bits for unsupported features.  All undefined bits are reservedby Apple for future features, and must be set to 0.  The bits are defined as:</p><p><code>sdevWantMouseClicks</code>    0 If this bit is set, the Control Strip willnotify the module of mouse down events.  If this bit is not set, the ControlStrip assumes that the module only displays status information with no userinteraction.</p><p><code>sdevDontAutoTrack</code> 1 If this bit is set, the Control Strip highlights themodule's display and then calls the module to perform mouse tracking; this bitis usually set when, for example, a module has a pop-up menu associated withit.  If this bit is cleared, the Control Strip tracks the cursor until themouse button is released, then sends an <code>sdevMouseClick</code> message to themodule to notify it that there was a mouse-down event.</p><p><code>sdevHasCustomHelp</code> 2 If this bit is set, the module is responsible fordisplaying its own help messages, which can be customized depending on itscurrent state.  If the bit is cleared, the Control Strip will display a generichelp message when the cursor passes over the module's display area and Balloon Help is on.</p><p><code>sdevKeepModuleLocked</code> 3 If this bit is set, the module's code will be keptlocked in the heap.  This bit should be set only if the module is passing theaddress of one of its routines to the outside world (for example, installingitself in a queue).</p><p>The <code>sdevGetDisplayWidth</code> message is sent to a module to determine howmuch horizontal space (in pixels) its display currently requires on the Control Strip.  The module should return the number of pixels as its result.  The returned width should not bethe maximum width it requires for any configuration, but should reflect how much space it currently requires, because it's possible for a module to request that its display be resized.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>You should be conservative in your use of Control Strip displayspace, which is limited.  Because several modules could be requesting space,it's possible that your module could be shoved off the end.</p></TD></TR></TABLE></CENTER><BR>    <p>The <code>sdevPeriodicTickle</code> message is passed to the module periodically toallow the module to update its display due to changes in its state.  You shouldnot assume any minimum or maximum interval between tickles.  The module shouldreturn, as its result, a long that signals requests for actions from theControl Strip software.  All undefined bits in the result are reserved forfuture use by Apple and must be set to 0.  The bits are defined as:</p><p><code>sdevResizeDisplay</code> 0 If this bit is set, the module needs to resize itsdisplay.  The Control Strip will send a <code>sdevGetDisplayWidth</code> message tothe module and followed by a <code>sdevDrawStatus</code> message so that the modulecan update its display.</p><p><code>sdevNeedToSave</code> 1 If this bit is set, the module needs to save changedsettings to disk.  The Control Strip software will mark the request but maydefer the actual save operation to a better time (for example, when the harddisk is spinning).</p><p><code>sdevHelpStateChange</code> 2 If this bit is set, the module's state has changedso it needs to update its help message.  If a help balloon is being displayedfor this module, the Control Strip software will remove it and put up a newhelp balloon for the current state.</p><p><code>sdevCloseNow</code> 3 If this bit is set, the module is requesting to be closed.The Control Strip software will call the module to save its settings, then call it again to close itself.</p><p>The <code>sdevDrawStatus</code> message indicates that the module has to redraw itsdisplay to reflect the most recent state. This message is typically  sent whenthe user clicks on the module's display area, when any of  the module'sdisplays is resized, or when the Control Strip itself  needs to be updated,perhaps in response to a screen saver  deactivation.</p><p>The <code>statusRect</code> parameter points to a rectangle bounding the module'sdisplay  area, in local coordinates. All drawing done by a module within  thebounds of the Control Strip must be limited to the module's  display rectangle.The graphics port's <code>clipRgn</code> will be set to  the visible portion ofthis rectangle so you can draw all the elements in the display. If you need tochange the <code>clipRgn</code>, you should observe the initial <code>clipRgn</code> toavoid  drawing over other items in the Control Strip.</p><p>When the user clicks in a module's display area, the Control Strip softwarecalls the module with the <code>sdevMouseClick</code> message if the<code>sdevWantMouseClicks</code> bit is set in the module's features.</p><p>If the <code>sdevDontAutoTrack</code> bit is also set, the Control Strip draws themodule's display in its highlighted state and then sends the <code>sdevMouseClick</code> message to the module.  If the <code>sdevDontAutoTrack</code> bit is not set, the Control Strip software tracks the cursor until the mouse button is released.  If the cursor is still within the module's display area, the Control Strip software sends the<code>sdevMouseClick</code> message to notify the module that a click occurred.  In either case, the module can then perform the appropriate function in response to a mouse-down event.</p><p>This message returns the same result as the <code>sdevPeriodicTickle</code> message.</p><p>The <code>sdevSaveSettings</code> message is passed to the module when the ControlStrip software has determined that it's a good time to save configurationinformation to the disk.  This message will be sent only if the module hadpreviously set the <code>sdevNeedToSave</code> bit in the result of a <code>sdevPeriodicTickle</code> or <code>sdevMouseClick</code> message.  The module should return an error code (File Manager, Resource Manager, or the like) indicating the success of the save operation.  The Control Strip software will continue to send this message to the module until the module returns a result of 0, indicating a successful save.</p><p>The Control Strip software calls the module with the <code>sdevShowBalloonHelp</code> message if Balloon Help is turned on, the module has previously set the <code>sdevHasCustomHelp</code> bit in its features, and thecursor is over the module's display area. The module should then call the Help Manager to display a help balloon describing the current state of the module. The module should return a value of 0 if it's successful or an appropriateerror result if not.</p><p>The Control Strip software provides a set of utility routines that areavailable to Control Strip modules.  They are provided to promote a consistentuser interface within the Control Strip and to reduce the amount of duplicatedcode that each module would have to include to support common functions.</p><p>The utility routines are called through a selector-based trap,<code>_ControlStripDispatch</code> (<code>$AAF2</code>).  If an unimplemented routineis called, it will return <code>paramErr</code> as the result.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>These routines should not be called at interrupt time because they all move memory.</P></TD></TR></TABLE></CENTER><BR>   <p>You can use the <code>SBIsControlStripVisible</code> routine to find out whether the Control Strip is visible.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal Boolean SBIsControlStripVisible();</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBIsControlStripVisible</code> routine returns a <code>Boolean</code> valueindicating whether or not the Control Strip is currently visible.  It returns avalue of true if the Control Strip is visible, or a value of false if it'shidden.</p><p>It is possible for this call to return a value of true even when the ControlStrip is not visible. That happens whenever the Control Strip is not accessiblein the current environment. As soon as that condition changes, the ControlStrip becomes visible again and the returned value correctly reflects theactual state.</p><p>You can use the <code>SBShowHideControlStrip</code> routine to show or hide theControl Strip.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal void SBShowHideControlStrip(Boolean showIt);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBShowHideControlStrip</code> routine determines the visibility state forthe Control Strip based on the value of the <code>showIt</code> parameter.  Passinga value of true makes the Control Strip visible, and passing a value of falsehides it.  Modules shouldn't typically need to call this routine, but it'sprovided as a means for other software to hide the Control Strip when it mightget in the way.</p><p>Calling <code>SBShowHideControlStrip</code> with a <code>showIt</code> value of truemay or may not show the Control Strip, depending on the current environment: ifthe Control Strip is not accessible, it does not become visible. If a<code>showIt</code> value of true is passed to this routine, then when theenvironment changes, the Control Strip will become visible.</p><p>You can use the <code>SBSafeToAccessStartupDisk</code> routine to find out whetherthe internal hard disk is spinning so that your software can determine whetherto make a disk access or postpone it until a time when the disk is alreadyspinning.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal Boolean SBSafeToAccessStartupDisk();</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBSafeToAccessStartupDisk</code> routine returns a <code>Boolean</code> valueof true if the disk is spinning and false if it is not.</p><p>You can use the <code>SBOpenModuleResourceFile</code> routine to open a moduleresource file.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal short SBOpenModuleResourceFile(OSType fileCreator);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBOpenModuleResourceFile</code> routine opens the resource fork of themodule file whose creator is fileCreator, and returns the file's referencenumber as its result.  If the file cannot be found or opened,<code>SBOpenModuleResourceFile</code> returns a result of -1.</p><p><code>SBOpenModuleResourceFile</code> provides a means for a module to load in large orinfrequently used resources that it doesn't usually need, but that it requiresfor a particular operation.</p><p>You can use the <code>SBLoadPreferences</code> routine to load a resource from a preferences file.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal OSErr SBLoadPreferences(ConstStr255Param prefsResourceName,                               Handle *preferences);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBLoadPreferences</code> routine loads a resource containing a module'sconfiguration information from the Control Strip's preferences file. The<code>prefsResourceName</code> parameter points to a Pascal string containing thename of the resource. The <code>preferences</code> parameter points to a variablethat will hold a handle to the resource read from the file.  The handle doesnot need to be preallocated.</p><p>If either <code>prefsResourceName</code> or <code>preferences</code> contains a nilpointer, <code>SBLoadPreferences</code> does nothing and returns a result of<code>paramErr</code>. If the resource is successfully loaded, it returns a resultof 0.  <code>SBLoadPreferences</code> can also return other Memory Manager andResource Manager errors if it fails during some part of the process.</p><p>You can use the <code>SBSavePreferences</code> routine to save a resource to a preferences file. </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal OSErr SBSavePreferences(ConstStr255Param prefsResourceName,                               Handle preferences);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBSavePreferences</code> routine saves a resource containing a module'sconfiguration information to the Control Strip's preferences file. The<code>prefsResourceName</code> parameter points to a Pascal string containing thename of the resource. The <code>preferences</code> parameter contains a handle to ablock of data which will be written to the file.</p><p>If either <code>prefsResourceName</code> or <code>preferences</code> has a nil value,<code>SBSavePreferences</code> does nothing and returns a result of <code>paramErr</code>. If the resource is successfully saved, <code>SBSavePreferences</code> returns a result of 0. <code>SBSavePreferences</code> can also return other Memory Manager and Resource Manager errors if it fails during some part of the process.</p><p>You can use the <code>SBGetDetachedIndString</code> routine to get a string from a detached resource.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal void SBGetDetachedIndString(StringPtr theString,                                   Handle stringList,                                   short whichString);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBGetDetachedIndString</code> routine is the detached resource version of<code>GetIndString</code>.  The parameter <code>theString</code> points to a Pascalstring; <code>stringList</code> is a handle to a detached 'STR#' resource; and<code>whichString</code> is the index (1-n) into the array of Pascal stringscontained in the detached resource.  <code>SBGetDetachedIndString</code> will copythe string whose index is <code>whichString</code> into the space pointed to by<code>theString</code>.  If <code>whichString</code> is out of range, <code>SBGetDetachedIndString</code> will return a zero-length string.</p><p>You can use the <code>SBGetDetachIconSuite</code> routine to set up a detached icon suite.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal OSErr SBGetDetachIconSuite(Handle *theIconSuite,                                  short theResID,                                  unsigned long selector);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBGetDetachIconSuite</code> routine creates a new icon suite, loads allof the requested icons, and then detaches the icons. The parameter<code>theIconSuite</code> points to the location where the handle to the icon suitewill be stored; the parameter <code>theResID</code> is the resource ID of the iconsthat make up the icon suite; and the parameter <code>selector</code> tells whichicons should be loaded into the suite.  The <code>selector</code> parameter shouldtypically contain one (or a combination of) the following values:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>svAllLargeData    0x000000FF    load large 32-by-32-pixel icons ('ICN#', 'icl4', 'icl8')svAllSmallData    0x0000FF00    load small 16-by-16-pixel icons ('ics#', 'ics4', 'ics8')svAllMiniData    0x00FF0000    load mini 12-by-12-pixel icons ('icm#', 'icm4', 'icm8')</pre>	</TD></TR></TABLE></CENTER><p>These values may be OR-ed together to load combinations of icon sizes.<code>SBGetDetachIconSuite</code> returns an appropriate error code if it'sunsuccessful, or 0 if it was able to load the icon suite.  Note that if none ofthe icons comprising the icon suite could be found, the call returns the error<code>resNotFound</code>.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>You should call <code>SBGetDetachIconSuite</code> only when themodule's resource file is open, which is typically the case during a module'sinitialization call.</p></TD></TR></TABLE></CENTER><BR>    <p>You can use the <code>SBTrackpopupMenu</code> routine to manage a pop-up menu.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal short SBTrackpopupMenu(const Rect *moduleRect,                              MenuHandle theMenu);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBTrackpopupMenu</code> routine handles setting up and displaying apop-up menu associated with a module.  The module should pass a pointer to itsdisplay rectangle and a handle to the menu to use.  The menu will be displayedjust above or below the module's display rectangle, allowing the user to viewthe current configuration or to change the settings.  <code>SBTrackpopupMenu</code>returns which menu item was selected, or 0 if no item was selected because theuser moved the cursor outside the menu's bounds.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Warning:</B><BR>Menus are displayed in the Control Strip's font, so don't usethe <code>CheckItem</code>() routine to mark menu items, because a checkmark issupported only in the system font.  Use the <code>SetItemMark</code>() routineinstead and pass it a bullet (*).</p></TD></TR></TABLE></CENTER><BR>    <p>You can use the <code>SBTrackSlider</code> routine to display and set an arbitraryparameter.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal short SBTrackSlider(const Rect *moduleRect,                           short ticksOnSlider,                           short initialValue);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBTrackSlider</code> routine displays an unlabeled slider above themodule's display rectangle.  You can use the slider for displaying and settingthe state of an arbitrary parameter. The parameter <code>moduleRect</code> containsa pointer to the module's display rectangle; <code>ticksOnSlider</code> is theupper bounds of the value returned by the slider; and <code>initialValue</code> isthe starting position (0 to ticksOnSlider-1).   When the user releases themouse button, <code>SBTrackSlider</code> returns the final position.</p><p>You can use the <code>SBShowHelpString</code> routine to display a Help balloon.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal OSErr SBShowHelpString(const Rect *moduleRect,                              StringPtr helpString);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBShowHelpString</code> routine displays a module's Help balloon.  Themodule passes a pointer to its display rectangle and a pointer to a Pascalstring, and the routine displays the balloon if possible.  If the help stringhas a length of 0 or the Help Manager is unable to display a balloon, an errorresult is returned. If <code>SBShowHelpString</code> successfully displays the Helpballoon, it returns a result of 0.</p><p>You can use the <code>SBGetBarGraphWidth</code> routine to find out the how wide abar graph drawn by <code>SBDrawBarGraph</code> (described next) will be so that amodule can calculate its display width.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal short SBGetBarGraphWidth(short barCount);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBGetBarGraphWidth</code> routine returns the width of a bar graphcontaining <code>barCount</code> segments.  If <code>barCount</code> has a value lessthan 0, the <code>SBGetBarGraphWidth</code> routine returns a width of 0.</p><p>You can use the <code>SBDrawBarGraph</code> routine to draw a bar graph.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal void SBDrawBarGraph(short level,                           short barCount,                           short direction,                           Point barGraphTopLeft);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBDrawBarGraph</code> routine draws a bar graph containing the number ofsegments specified by the <code>barCount</code> parameter in a module's displayarea. If the value of <code>barCount</code> is less than or equal to 0,<code>SBDrawBarGraph</code> does nothing.</p><p>The bar graph is drawn relative to the location specified by<code>barGraphTopLeft</code>.</p><p>Figure 2 shows the way the point <code>barGraphTopLeft</code> determines the position of the bar graph.</p><p align=center><img src="images/os_06_002.gif" alt="Figure 2" width=192 height=67></p><p align=center><b>Figure 2</b>. Positioning a bar graph</p><p>The <code>level</code> parameter determines how many segments are highlighted. Thevalue of level should be in the range of <code>0</code> to <code>barCount-1.</code> Ifthe value of <code>level</code> is less than 0, no segments in the bar graph arehighlighted; if <code>level</code> is greater than or equal to <code>barCount</code>,all segments in the bar graph are highlighted.</p><p>The <code>direction</code> parameter specifies which way the bar graph will bedrawn to show a larger level.  It should be one of the following values:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#define BarGraphSlopeLeft   -1   // max end of sloping graph is on the left#define BarGraphFlatRight   0    // max end of flat graph is on the right#define BarGraphSlopeRight  1    // max end of sloping graph is on the right</pre>	</TD></TR></TABLE></CENTER><p>Figure 3 shows the resulting bar graph for each direction value.  The arrowsindicate which way an increasing level value is displayed.  For sloped versionsof the bar graph, the number of segments specified by the <code>barCount</code>value may not be larger than 8.  If a larger <code>barCount</code> value is passed,<code>SBDrawBarGraph</code> draws nothing.</p><p align=center><img src="images/os_06_003.gif" alt="Figure 3" width=312 height=46></p><p align=center><b>Figure 3</b>. Directions of a bar graph</p><p>You should use the <code>SBModalDialogInContext</code> in place of the<code>ModalDialog</code> routine to keep background applications from getting runwhile your modal dialog window is visible.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal void SBModalDialogInContext(ModalFilterProcPtr filterProc,                                   short *itemHit);</pre>	</TD></TR></TABLE></CENTER><p>The <code>SBModalDialogInContext</code> routine is a special version of<code>ModalDialog</code> that doesn't allow background applications to get timewhile a modal dialog window is visible.</p><p>The Control Strip software installs two Gestalt selectors to return informationto the outside world.  One selector returns software attributes, and the otherreturns the software version.</p><p>The selector <code>gestaltControlStripAttr ('sdev')</code> returns 32 bitsdescribing the software attributes of this version of the Control Strip.  Thefollowing bits are defined:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>gestaltControlStripExists        0    1 = Control Strip is installedgestaltControlStripVersionFixed    1    1 = Gestalt selector has been fixed</pre>	</TD></TR></TABLE></CENTER><p>The <code>gestaltControlStripVersionFixed</code> indicates that the correct Gestaltselector has been implemented for the Control Strip.  An early version of Control Strip software used an incorrect Gestalt selector (it was incorrectly using <code>'sdvr'</code>, which conflicted with a PowerTalk selector.)</p><p>The selector <code>gestaltControlStripVersion ('csvr') </code>returns the versionof Control Strip software that is installed.  The format of the returnedversion is the same as that of the numeric part of a <code>'vers'</code> resource, that is:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Bits 31-24    Major part of the version, in BCDBits 23-20    Minor part of the version, in BCDBits 19-16    Bug release version, in BCDBits 15-&nbsp;8    Release stage:        $80=final        $60=beta        $40=alpha        $20=developmentBits 7-&nbsp;0    Revision level of nonreleased version, in binary</pre>	</TD></TR></TABLE></CENTER><p>Thus, if the software version were 1.5.3b25, the <code>gestaltControlStripVersion</code> selector would return $01536019.</p> <P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><p>Technical Note PT 35 - Stand-Alone Code, <i>ad nauseam</i></p> <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (108K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/os_06.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/os/os_06.html%3Fid%3DDTS10002592-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/os/os_06.html%3Fid%3DDTS10002592-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/os/os_06.html%3Fid%3DDTS10002592-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>