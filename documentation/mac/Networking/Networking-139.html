<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>dspWrite(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING139></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-138.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-140.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-98.html"><B>Chapter 5 - AppleTalk Data Stream Protocol (ADSP) </B></A> / <A HREF="Networking-115.html"><B>ADSP Reference</B></A><BR><DL><DD><A HREF="Networking-122.html"><B>Routines</B></A> / <A HREF="Networking-136.html"><B>Maintaining an ADSP Connection and Using It to Exchange Data</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING139-0></A>
<H3>dspWrite <A NAME=MARKER-2-426></A></H3>
 <A NAME=MARKER-2-427></A>The <CODE>dspWrite</CODE> routine writes bytes into a connection end's send queue for ADSP or ASDSP to transmit across a connection. When ASDSP is used and the encrypt bit is <BR>set, ASDSP encrypts the data before sending it. You use the <CODE>PBControl</CODE> function to <BR>call the <CODE>dspWrite</CODE> routine. See <A HREF=Networking-122.html#MARKER-9-273>"Routines" on page 5-43</A> for a description of the <CODE>PBControl</CODE> function.<A NAME=MARKER-2-34></A><P>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result.<TR>
<TD>--><TD>ioCRefNum<TD>Integer<TD>The driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always <CODE>dspWrite</CODE> for this function.<TR>
<TD>--><TD>ccbRefNum<TD>Integer<TD>The CCB reference number.<TR>
<TD>--><TD>reqCount<TD>Integer<TD>The requested number of bytes.<TR>
<TD><--<TD>actCount<TD>Integer<TD>The actual number of bytes written.<TR>
<TD>--><TD>dataPtr<TD>Ptr<TD>A pointer to the data buffer.<TR>
<TD>--><TD>eom<TD>Byte<TD>For ADSP: a flag indicating end of message. For ASDSP: a flag indicating end of <BR>message or encryption.<TR>
<TD>--><TD>flush<TD>Byte<TD>A flag indicating whether to send <BR>buffered data. </TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>csCode</CODE>
<DD> The routine selector, always <CODE>dspWrite</CODE> for this routine.
<DT><CODE>ccbRefNum</CODE>
<DD> The connection control block (CCB) reference number that the <CODE>dspInit</CODE> routine returned.
<DT><CODE>reqCount</CODE>
<DD> The number of bytes to write.
<DT><CODE>actCount</CODE>
<DD> The actual number of bytes written to the send queue. 
<DT><CODE>dataPtr</CODE> 
<DD> A pointer to the buffer from which ADSP or ASDSP should read the data that is to be sent.
<DT><CODE>eom</CODE>
<DD> For ADSP, a flag indicating if the last byte written to the send queue was a logical end-of-message indicator. If the last byte constitutes an EOM, you set this parameter to 1. If not, you set this parameter to 0. The high-order bits of the <CODE>eom</CODE> parameter are reserved for use by ADSP; you must leave these bits equal to 0.<A NAME=MARKER-2-433></A><A NAME=MARKER-2-434></A><A NAME=MARKER-2-435></A><A NAME=MARKER-2-436></A>
<DT>
<DD> For ASDSP, if this is a secure connection, this field constitutes two single-bit flags instead of a zero/nonzero byte. If set to 1, bit 0 indicates the end of message; if set to 1, bit 1 turns on encryption. Note that ASDSP checks this flag on the first write of the connection and the first write following a write for which the end-of-message flag (bit 0 of the <CODE>eom</CODE> field) is set.
<DT><CODE>flush</CODE>
<DD> A flag indicting whether or not ADSP or ASDSP should immediately send the data in the send queue to the remote connection. Set <CODE>flush</CODE> to 1 to cause ADSP or ASDSP to immediately transmit any data in the send queue that has not already been transmitted. Set <CODE>flush</CODE> to 0 to allow data to accumulate in the send queue until another condition occurs that causes data to be transmitted. The high-order bits of the <CODE>flush</CODE> parameter are reserved for use by ADSP or ASDSP; you must leave these bits equal to 0.<A NAME=MARKER-2-437></A>
</DL>
<A NAME=HEADING139-11></A>
<H5>DESCRIPTION<A NAME=MARKER-2-438></A></H5>
 The <CODE>dspWrite</CODE> routine  sends data across an ADSP or ASDSP connection. The send queue contains all data that has been sent to ADSP or ASDSP for transmission and that has not yet been acknowledged. Some of the data in the send queue might have already been transmitted, but ADSP or ASDSP retains it in the send queue until the remote connection end acknowledges its receipt in case the data has to be retransmitted. The <CODE>dspWrite</CODE> routine completes execution when it has copied all of the data from the data buffer into the send queue.<P>
 ADSP or ASDSP transmits the data in the send queue when the remote connection end has room to accept the data and one of the following conditions occurs:<P>
<UL>
<LI>You call the <CODE>dspWrite</CODE> routine with the flush parameter set to a nonzero number.
<LI>The number of bytes in the send queue equals or exceeds the blocking factor. (You use the <CODE>sendBlocking</CODE> parameter to the <CODE>dspOptions</CODE> routine to set the blocking factor.)
<LI>The send timer expires.
<LI>A connection event requires that the local connection end send an acknowledgment packet to the remote connection end.<P>
</UL>
 For an ADSP <CODE>dspWrite</CODE> call, you can set the <CODE>reqCount</CODE> parameter to 0 and the <CODE>eom</CODE> parameter to 1 to indicate that the last byte you sent the previous time you called the <CODE>dspWrite</CODE> routine was the end of the message. You can set the <CODE>reqCount</CODE> parameter to a value larger than the size of the send queue. If you do so, the <CODE>dspWrite</CODE> routine writes as much data as it can into the send queue, sends the data and waits for acknowledg-<BR>ment, and then writes more data into the send queue until it has written the amount of data you requested. In this case, the routine does not complete execution until it has finished writing all of the data into the send queue. <P>
 For an ASDSP <CODE>dspWrite</CODE> call, you can set the encrypt bit of the <CODE>eom</CODE> field (bit 1) of the DSP parameter block. Note that ASDSP checks this flag on the first write of the connec-<BR>tion or the first write following a write for which the end-of-message flag (bit 0 of the <CODE>eom</CODE> field) is set. You can set the end-of-message bit (bit 0) of the <CODE>eom</CODE> field to indicate the end of the message.<P>
<UL>
<LI>To set the encrypt bit, you use the <CODE>dspEncryptMask</CODE> mask or the <BR><CODE>dspEncryptBit</CODE> constant.
<LI>To set the end-of-message bit, you use the <CODE>dspEOMMask</CODE> mask or the <BR><CODE>dspEOMBit</CODE> constant. <P>
</UL>
 <A NAME=MARKER-2-439></A>Set the <CODE>flush</CODE> parameter to 1 to cause ADSP to immediately transmit any data in the send queue that has not already been transmitted. Set the <CODE>flush</CODE> parameter to 0 to allow data to accumulate in the send queue until another condition occurs that causes data to be transmitted. <P>
 If you want to encrypt all messages, you can simply set the encrypt bit on all calls to the <CODE>dspWrite</CODE> function.<A NAME=MARKER-2-44></A><P>
<A NAME=HEADING139-24></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>dspWrite</CODE> routine from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>dspWrite</CODE> in the <CODE>csCode</CODE> field of the parameter block. <A NAME=MARKER-2-133></A><P>
<A NAME=HEADING139-26></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>errState<TD>-1278<TD>Connection is not open<TR>
<TD>errAborted<TD>-1279<TD>Request aborted by <CODE>dspRemove</CODE> or <CODE>dspClose</CODE> routine<TR>
<TD>errRefNum<TD>-1280<TD>Bad connection reference number</TABLE>
</H5>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-138.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-140.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
