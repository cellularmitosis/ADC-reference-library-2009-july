<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Ruby and Python Programming Topics for Mac OS X: Building a RubyCocoa Application: A Tutorial</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Building a RubyCocoa Application: A Tutorial"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005425" title="Building a RubyCocoa Application: A Tutorial"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DesignGuidelines-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000556" target="_top">Design Guidelines</a> &gt; <a href="../index.html" target="_top">Ruby and Python Programming Topics for Mac OS X</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="RubyPythonMacOSX.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Using RubyOSA.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40005425-SW1" title="Building a RubyCocoa Application: A Tutorial"></a><hr /><H1>Building a RubyCocoa Application: A Tutorial</H1><p>This tutorial demonstrates how easy it is to create a RubyCocoa application using the developer applications Xcode and Interface Builder. It walks you through the steps for constructing the RSS Photo Viewer application, which is an example project installed in <code>&lt;Xcode>/Examples/Ruby/RubyCocoa</code>. It assumes you have some knowledge of Ruby but not of RubyCocoa, and it assumes that you might be fairly new to the Mac OS X development environment.</p><p>When it is built and run, the RSS Photo Viewer (shown in <span class="content_text">Figure 1</span>) lets you view photos that are accessed through a URL identifying an RSS feed. It enables you to scroll through the photos and zoom in on selected ones. </p><br/><div><a name="//apple_ref/doc/uid/TP40005425-SW2" title="Figure 1The RSS Photo Viewer application"></a><p><strong>Figure 1&nbsp;&nbsp;</strong>The RSS Photo Viewer application</p><img src = "../Art/rssphotoviewer.jpg" alt = "The RSS Photo Viewer application" ></div><br/><p>By completing this tutorial you will gain familiarity with the following RubyCocoa development tasks on Mac OS X:</p><ul class="ul"><li class="li"><p>Creating and setting up a RubyCocoa project</p></li><li class="li"><p>Using Interface Builder to construct a user interface</p></li><li class="li"><p>Defining a RubyCocoa class</p></li><li class="li"><p>Defining and connecting outlets and actions</p></li><li class="li"><p>Responding to delegation and data-source messages</p></li><li class="li"><p>Implementing accessor methods</p></li><li class="li"><p>Integrating a custom Ruby class</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-DontLinkElementID_1">Creating and Configuring a RubyCocoa Project</a>
				
			<br/>
			
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW12">Defining Classes, Targets, and Actions</a>
				
			<br/>
			
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW6">Creating the User Interface</a>
				
			<br/>
			
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-DontLinkElementID_3">Connecting the Outlet and Actions</a>
				
			<br/>
			
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW7">Implementing the Custom Window Controller</a>
				
			<br/>
			
        
			
			
				<a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW8">Implementing a Custom Ruby Class</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005425-DontLinkElementID_1" title="Creating and Configuring a RubyCocoa Project"></a><h2>Creating and Configuring a RubyCocoa Project</h2><p>There are several Xcode templates for RubyCocoa projects of various types: simple applications, document-based applications, Core Data applications, and Core Data document-based applications. The RSS Photo Viewer uses the simple RubyCocoa application template.</p><ol class="ol"><li class="li"><p>In Xcode, choose New Project from the File menu.</p></li><li class="li"><p>In the New Project assistant, select the Cocoa-Ruby Application template and click Next.</p><div class="item_figure"><img src = "../Art/rc_xcode_assistant.jpg" alt = "Choosing a RubyCocoa application project template" ></div></li><li class="li"><p>In the subsequent window, name the project folder “RSSPhotoViewer” and identify in a suitable location in the file system. Click Next.</p></li></ol><a name="//apple_ref/doc/uid/TP40005425-DontLinkElementID_2" title="Anatomy of a RubyCocoa Project"></a><h3>Anatomy of a RubyCocoa Project</h3><p>At first glance the project window looks like any other Cocoa project (see <span class="content_text">Figure 2</span>). It has the necessary frameworks (including the RubyCocoa framework, a nib file with the main menu, the information property list (<code>Info.plist</code>), and the <code>main.m</code> file.</p><br/><div><a name="//apple_ref/doc/uid/TP40005425-SW4" title="Figure 2The initial project window for the RSS Photo Viewer project"></a><p><strong>Figure 2&nbsp;&nbsp;</strong>The initial project window for the RSS Photo Viewer project</p><img src = "../Art/rc_project_template.jpg" alt = "The initial project window for the RSS Photo Viewer project" ></div><br/><p>However, it does have one file that you don’t find in regular Cocoa application projects: <code>rb_main.rb</code>. When you build a RubyCocoa application, the Ruby scripts of the project are put in the <code>Resources</code> directory of the application bundle. If the application is double-clicked, the <code>rb_main.rb</code> script gets those Ruby and RubyCocoa files and loads them; if a RubyCocoa script is run from the command line (for debugging), however, the script instead calls the <code><a href="../../../Reference/ApplicationKit/Miscellaneous/AppKit_Functions/Reference/reference.html#//apple_ref/c/func/NSApplicationMain" target="_top">NSApplicationMain</a></code> function. </p><p>Next add one line to the <code>rb_main.rb</code> script, the “<code>include OSX</code>” statement, as shown in <span class="content_text">Listing 1</span>. By including the OSX module in the main scope, you are able to access RubyCocoa classes and methods directly—that is, without having to use the <code>OSX::</code> prefix.</p><a name="//apple_ref/doc/uid/TP40005425-SW13" title="Listing 1The rb_main.rb script"></a><p class="codesample"><strong>Listing 1&nbsp;&nbsp;</strong>The <code>rb_main.rb</code> script</p><div class="codesample"><table><tr><td scope="row"><pre>require 'osx/cocoa'<span></span></pre></td></tr><tr><td scope="row"><pre># add the following line:<span></span></pre></td></tr><tr><td scope="row"><pre>include OSX<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>def rb_main_init<span></span></pre></td></tr><tr><td scope="row"><pre>  path = OSX::NSBundle.mainBundle.resourcePath.fileSystemRepresentation<span></span></pre></td></tr><tr><td scope="row"><pre>  rbfiles = Dir.entries(path).select {|x| /\.rb\z/ =~ x}<span></span></pre></td></tr><tr><td scope="row"><pre>  rbfiles -= [ File.basename(__FILE__) ]<span></span></pre></td></tr><tr><td scope="row"><pre>  rbfiles.each do |path|<span></span></pre></td></tr><tr><td scope="row"><pre>    require( File.basename(path) )<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre>end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if $0 == __FILE__ then<span></span></pre></td></tr><tr><td scope="row"><pre>  rb_main_init<span></span></pre></td></tr><tr><td scope="row"><pre>  OSX::NSApplicationMain(0, nil)<span></span></pre></td></tr><tr><td scope="row"><pre>end<span></span></pre></td></tr></table></div><p>But what invokes the <code>rb_main.rb</code> script to begin with? Cocoa applications by default look for the execution entry point (that is, the function <code><!--a-->main<!--/a--></code>) in <code>main.m</code>. However, this file in a RubyCocoa application project has different content than it does in a regular Cocoa application. As shown in <span class="content_text">Listing 2</span>, the <code><!--a-->main<!--/a--></code> function in RubyCocoa projects calls function <code><!--a-->RBApplicationMain<!--/a--></code>, which takes as its first argument a string referencing <code>rb_main.rb</code>, and runs the script. </p><a name="//apple_ref/doc/uid/TP40005425-SW3" title="Listing 2The main.m file in a RubyCocoa project"></a><p class="codesample"><strong>Listing 2&nbsp;&nbsp;</strong>The <code>main.m</code> file in a RubyCocoa project</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;RubyCocoa/RBRuntime.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int<span></span></pre></td></tr><tr><td scope="row"><pre>main(int argc, const char* argv[])<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  return RBApplicationMain("rb_main.rb", argc, argv);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005425-SW12" title="Defining Classes, Targets, and Actions"></a><h2>Defining Classes, Targets, and Actions</h2><p>The RSS Photo Viewer project has one significant source file, <code>RSSWindowController.rb</code>. This file contains definitions of two custom classes, a RubyCocoa subclass of <code><a href="../../../Reference/ApplicationKit/Classes/NSWindowController_Class/Reference/Reference.html#//apple_ref/occ/cl/NSWindowController" target="_top">NSWindowController</a></code> and a simple custom Ruby subclass. We’ll start with the <code>NSWindowController</code> subclass and define the outlets and actions that are used to control the user interface.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005425-DontLinkElementID_28" title="Note"></a><p><strong>Note:</strong>&nbsp;An outlet is an archived connection between one object and another object (and is specified as an instance variable of one object). An action is a method invoked in an object (usually a custom object) called the target when another object such as a button or slider is manipulated; Interface Builder also archives the connection between the target and the other object (called a control). For more on these concepts, see “<span class="content_text"><a href="../../CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html#//apple_ref/doc/uid/TP40002974-CH7" target="_top">Communicating With Objects</a></span>“ in <em><a href="../../CocoaFundamentals/index.html#//apple_ref/doc/uid/TP40002974" target="_top">Cocoa Fundamentals Guide</a></em>.</p></div><p>To add a RubyCocoa source file to the project, complete the following steps in the Xcode project:</p><ol class="ol"><li class="li"><p>Choose New File from the File menu.</p></li><li class="li"><p>Select “Ruby NSWindowController subclass” in the New File assistant window. Click Next.</p></li><li class="li"><p>In the subsequent assistant window name the new file “RSSRubyController.rb” and click Next.</p><p>Xcode adds the file to the RSSPhotoViewer project.</p></li></ol><p>The template file for the RubyCocoa subclass of <code>NSWindowController</code> includes some initial code: a <code>require ‘osx/cocoa’</code> statement and an initial definition of the subclass. Change the name of this subclass from “RSSRubyController” (the name of the file) to “RSSWindowController”:</p><div class="codesample"><table><tr><td scope="row"><pre>class RSSWindowController &lt; NSWindowController<span></span></pre></td></tr><tr><td scope="row"><pre>end<span></span></pre></td></tr></table></div><p>Expand this initial class definition by typing the code shown in <span class="content_text">Listing 3</span>.</p><a name="//apple_ref/doc/uid/TP40005425-SW5" title="Listing 3Defining the outlet and actions of the RSSWindowController class"></a><p class="codesample"><strong>Listing 3&nbsp;&nbsp;</strong>Defining the outlet and actions of the RSSWindowController class</p><div class="codesample"><table><tr><td scope="row"><pre>require 'osx/cocoa'<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>class RSSWindowController &lt; NSWindowController<span></span></pre></td></tr><tr><td scope="row"><pre>    ib_outlet :imageBrowserView<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    # Actions<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    def zoomChanged(sender)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    end<span></span></pre></td></tr><tr><td scope="row"><pre>    ib_action :zoomChanged<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    def parse(sender)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    end<span></span></pre></td></tr><tr><td scope="row"><pre>    ib_action :parse<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>end<span></span></pre></td></tr></table></div><p>You just defined the outlet (<code>imageBrowserView</code>) and the two actions (<code>zoomChanged</code> and <code>parse</code>) that the <code>RSSWindowController</code> class uses for communicating with objects in the user interface. (In <span class="content_text"><a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW6">“Creating the User Interface”</a></span> you’ll connect the outlet and actions to their user-interface objects.) To define an outlet use the <code>ib_outlet</code> method of the OSX module followed by the Ruby symbol “:imageBrowserView”. You define an action by defining a method with a single argument named <code>sender</code>—the sender is the user-interface object sending the action message—followed by the <code>ib_action</code> method and the symbolized method name. Leave the action methods unimplemented for now; we’ll return to them in <span class="content_text"><a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW7">“Implementing the Custom Window Controller.”</a></span> </p><p>The next step is to import the <code>RSSWindowController</code> class, along with its action and outlet definitions, into the application’s nib file. </p><ol class="ol"><li class="li"><p>Double-click the nib file <code>MainMenu.nib</code> in the Xcode project window to open it in Interface Builder.</p></li><li class="li"><p>Open the Library window (if it isn’t displayed) by selecting Library from the Tools menu. </p></li><li class="li"><p>Locate the generic Object in the object library (that is, the browser in the Library window), either by browsing or search for it by typing “Object” in the window’s search field.</p><div class="item_figure"><img src = "../Art/rc_generic_object.jpg" alt = "Generic object in the Library window" ></div><p>Drag this object into the nib file window, the window in this case with the title of MainMenu.nib.</p><div class="item_figure"><img src = "../Art/nib_file_win.jpg" alt = "nib file window" ></div><p>The nib file window, which is sometimes called the nib document window, lets you examine the contents of a nib file. The default mode shows the top-level objects of the nib file—that is, those objects that are the top-level objects of an object graph (such as a window or menu) or that are standalone objects, such as controllers, which own no subordinate objects.</p></li><li class="li"><p>With the generic object selected, open the Identity pane of the inspector by choosing Identity Inspector from the Tools menu. </p></li><li class="li"><p>In the Class field, type “RSSWindowController” and press Return.</p><div class="item_figure"><img src = "../Art/rc_assign_ctlr_class.jpg" alt = "Assigning a class to a proxy object." ></div></li></ol><p>Completing the above steps imports the class into Interface Builder and assigns it as the class of the proxy object, which you can then use for target and action connections. This application is now “aware” of the <code>RSSWindowController</code> class, and automatically notices any future changes to the class—for example, additions of actions or removals of outlets. </p><a name="//apple_ref/doc/uid/TP40005425-SW6" title="Creating the User Interface"></a><h2>Creating the User Interface</h2><p>The user interface of the RSS Photo Viewer application is simple. It is a single-window application, and on that window are only three objects:  </p><ul class="ul"><li class="li"><p>A labeled text field for specifying a URL</p></li><li class="li"><p>A slider for zooming a selected image</p></li><li class="li"><p>An Image Kit browser view for displaying the images</p></li></ul><p>The Library window contains ready-made objects for the labeled text field and the slider. You drag these objects from the Library onto the window (provided by default) and then resize them, reposition them, and configure their other attributes. But before you do this, make sure the window is large enough to hold the objects. Using the image in <span class="content_text"><a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW2">Figure 1</a></span> as a guide, resize the window by dragging the tab on the lower-right corner of the window.</p><p>Now that your attention is on the window, give it a title. Select its icon in the nib file window (if it isn’t already selected), and choose Attributes Inspector from the Tools menu to open the Attributes pane (or click the  <img src = "../Art/rc_attrib_button.jpg" alt = "The button for the Attributes pane" >button at the top of the inspector).  Enter “RSS Photo Viewer” in the Title field.</p><br/><div><img src = "../Art/rc_win_title.jpg" alt = "Setting the window title." ></div><br/><p>Follow these steps to add and configure the URL text field:</p><ol class="ol"><li class="li"><p>In the object library find the Text Field object (you can search for it by typing “text field” in the Library window’s search field).</p></li><li class="li"><p>Drag this object (not Text Field Cell) and drop it on the upper part of the window.</p></li><li class="li"><p>Resize the text field using the resize handles on the edges of the object. (Make sure you leave space for the “URL” label”). Reposition it if necessary by dragging it over the window’s “surface.“</p></li><li class="li"><p>Locate the Label object in the object and drag it to a point left of the text field. </p><p>This object is a text field too, but it is preconfigured to be read-only and to have a gray background.</p></li><li class="li"><p>Double-click “Label” and type “URL:” in place of the selected text. Resize the label if necessary and position it close to the text field.</p></li></ol><p>You’ll notice as you move these objects around and resize them that blue lines appear. These are guide lines showing you how to place objects in relation to each other as recommended in the <em><a href="../../../../UserExperience/Conceptual/AppleHIGuidelines/index.html#//apple_ref/doc/uid/20000957" target="_top">Apple Human Interface Guidelines</a></em>.</p><p>Next find the horizontal slider in the object library and drag it to the lower part of the window. You will need to configure this object, following these steps:</p><ol class="ol"><li class="li"><p>Resize the object to about twice its default length.</p></li><li class="li"><p>Select the object and open the inspector to the Attributes pane (Tools > Attributes Inspector).)</p></li><li class="li"><p>Set the number of tick marks and the minimum, maximum, and current values as shown in this example:</p><div class="item_figure"><img src = "../Art/rc_slider_attrib.jpg" alt = "Configuring the slider's attributes" ></div><p>Also make sure the Enabled and Continuous boxes in the Control slice are checked. Note that the inspector here is showing you the attributes belonging to the various inheritance layers of the slider: as an <code><a href="../../../Reference/ApplicationKit/Classes/NSSlider_Class/Reference/Reference.html#//apple_ref/occ/cl/NSSlider" target="_top">NSSlider</a></code> object, as an <code><a href="../../../Reference/ApplicationKit/Classes/NSControl_Class/Reference/Reference.html#//apple_ref/occ/cl/NSControl" target="_top">NSControl</a></code> object, and as an <code><a href="../../../Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> object.</p></li></ol><p>The final piece in the user interface of the RSS Photo Viewer application is the Image Kit image browser view (an <code><a href="../../../../GraphicsImaging/Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> object). Because this Objective-C framework does not yet include an Interface Builder plug-in for its view objects, we will have to use the Custom View library object as a proxy, and then assign the <code>IKImageBrowserView</code> class to this proxy. Interface Builder is aware of this class, however, because the Application Kit framework has a dependency on the Quartz umbrella framework, which includes the Image Kit framework.  The steps for setting up the image browser view are the following: </p><ol class="ol"><li class="li"><p>Find the Custom View object in the object library and drag it onto the window.</p><div class="item_figure"><img src = "../Art/rc_custom_view.jpg" alt = "The Custom View in the Library window" ></div></li><li class="li"><p>Resize the Custom View object to fill the space below the URL text field and above the slider.</p><p>Note the blue guide lines for placement and resizing boundaries.</p></li><li class="li"><p>With the Custom View selected, open the Identity pane of the inspector.</p></li><li class="li"><p>Type “IKImageBrowserView” in the Class field and press Return.</p><div class="item_figure"><img src = "../Art/rc_assign_ikibv.jpg" alt = "Assigning the IKImageBrowserView class to Custom View" ></div></li></ol><p>Save the nib file. The RSS Photo Viewer application’s user interface is now complete. The next step is to hook up your outlet and action connections.</p><a name="//apple_ref/doc/uid/TP40005425-DontLinkElementID_3" title="Connecting the Outlet and Actions"></a><h2>Connecting the Outlet and Actions</h2><p>Before we leave Interface Builder and return to Xcode we need to connect the outlet and actions we defined in <span class="content_text"><a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW12">“Defining Classes, Targets, and Actions”</a></span> to their targets. Let’s start with the outlet from the <code>RSSWindowController</code> class to the <code>IKImageBrowserView</code> object.</p><ol class="ol"><li class="li"><p>Select the <code>RSSWindowController</code> object in the nib file window and right-click (or Control-click) the mouse.</p><p>The connections panel appears for that object, showing its possible connections.</p></li><li class="li"><p>Click the mouse pointer in the circle next to the <code>imageBrowserView</code> outlet and drag a line to the <code>IKImageBrowserView</code> object.</p><div class="item_figure"><img src = "../Art/rc_outlet_connect.jpg" alt = "Connecting an outlet" ></div></li><li class="li"><p>Release the mouse button. </p></li></ol><p>Next connect the action parse from the URL text field to the target object (<code>RSSWindowController</code>).</p><ol class="ol"><li class="li"><p>Select the object in the nib file window representing <code>RSSWindowController</code> and right-click (or Control-click) the mouse..</p></li><li class="li"><p>In the connections panel, drag a line from the circle next to parse in the Received Actions slice and drag it to the URL field.</p><div class="item_figure"><img src = "../Art/rc_connect_action.jpg" alt = "Coneecting an action to its target" ></div></li><li class="li"><p>Release the mouse button.</p></li></ol><p>Complete the same sequence of steps for the slider object and the <code>zoomChanged</code> action. Then save the nib file and return to the Xcode project.</p><a name="//apple_ref/doc/uid/TP40005425-SW7" title="Implementing the Custom Window Controller"></a><h2>Implementing the Custom Window Controller</h2><p>The implementation code of the RSS Photo Viewer application is centered around the programmatic interface of the <code><a href="../../../../GraphicsImaging/Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> class of the Image Kit framework. The <code>RSSWindowController</code> class implements methods of informal protocols for data sources and delegates and calls <code>IKImageBrowserView</code> methods to set up and control the image browser. The RSSPhoto class, which you’ll implement in <span class="content_text"><a href="BuildingRubyCocoaAppl.html#//apple_ref/doc/uid/TP40005425-SW8">“Implementing a Custom Ruby Class”</a></span> is a simple Ruby class that conforms to informal-protocol methods for objects that represent items in the image browser.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005425-DontLinkElementID_29" title="Note"></a><p><strong>Note:</strong>&nbsp;The Image Kit framework was introduced in Mac OS X version 10.5 (Leopard).</p></div><p>Now it’s time to write some code. We’ll start by completing the implementation of the <code>RSSWindowController</code> class. Open <code>RSSRubyController.rb</code> in Xcode and add the following method:</p><div class="codesample"><table><tr><td scope="row"><pre> def awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>    @cache = []<span></span></pre></td></tr><tr><td scope="row"><pre>    @imageBrowserView.setAnimates(true)<span></span></pre></td></tr><tr><td scope="row"><pre>    @imageBrowserView.setDataSource(self)<span></span></pre></td></tr><tr><td scope="row"><pre>    @imageBrowserView.setDelegate(self)<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr></table></div><p>The Application Kit framework sends the <code><a href="../../../Reference/ApplicationKit/Protocols/NSNibAwaking_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/awakeFromNib" target="_top">awakeFromNib</a></code> message to all interested objects when all nib-file objects have been unarchived and loaded into memory. This method presents an opportunity for controller objects to perform initializations involving objects unarchived from nib files (view objects). The <code>awakeFromNib</code> method of <code>RSSWindowController</code> sets the <code>animates</code> property of the <code>IKImageBrowserView</code> object and assigns itself as the delegate and data source of that object. It also initializes a <code>@cache</code> instance variable, a Ruby Array object that contains the current collection of RSSPhoto objects (representing photos).</p><p>Next insert two more <code>require</code> statements after the <code>require ‘osx/cocoa’</code> statement. </p><div class="codesample"><table><tr><td scope="row"><pre>require 'rss'<span></span></pre></td></tr><tr><td scope="row"><pre>require 'open-uri'<span></span></pre></td></tr></table></div><p>As you’ll soon see, the <code>RSSWindowController</code> class uses the open-uri library for accessing HTTP resources. It also uses the RSS library for accessing information disseminated on the Internet through the RSS protocol.</p><p>Implement the <code>zoomChanged</code> and <code>parse</code> action methods as shown in <span class="content_text">Listing 4</span>.:</p><a name="//apple_ref/doc/uid/TP40005425-SW10" title="Listing 4Implementing the action methods"></a><p class="codesample"><strong>Listing 4&nbsp;&nbsp;</strong>Implementing the action methods</p><div class="codesample"><table><tr><td scope="row"><pre>def zoomChanged(sender)<span></span></pre></td></tr><tr><td scope="row"><pre>    @imageBrowserView.setZoomValue(sender.floatValue)<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def parse(sender)<span></span></pre></td></tr><tr><td scope="row"><pre>    begin<span></span></pre></td></tr><tr><td scope="row"><pre>      uri = URI.parse(sender.stringValue.to_s)<span></span></pre></td></tr><tr><td scope="row"><pre>      raise "Invalid URL" unless uri.respond_to?(:read)<span></span></pre></td></tr><tr><td scope="row"><pre>      @parser = RSS::Parser.parse(uri.read, false)<span></span></pre></td></tr><tr><td scope="row"><pre>      @cache.clear<span></span></pre></td></tr><tr><td scope="row"><pre>      @imageBrowserView.reloadData<span></span></pre></td></tr><tr><td scope="row"><pre>    rescue => e<span></span></pre></td></tr><tr><td scope="row"><pre>      NSRunAlertPanel("Can't parse URL", e.message, 'OK', nil, nil)<span></span></pre></td></tr><tr><td scope="row"><pre>    end<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr></table></div><p>There are a few things to note about this code:</p><ul class="ul"><li class="li"><p>The <code>zoomChanged</code> message is sent when the user moves the slider under the image browser; the implementation here gets the new float value from the <code>sender</code> of the message (the slider) and sets the zoom factor of the image browser to that value.</p></li><li class="li"><p>In implementing its <code>parse</code> action method, the <code>RSSWindowController</code> class uses the <code>parse</code> method of the open-uri library’s URI class to validate the URL fetched from the text field (via the <code>sender.stringValue</code> call) and create a URI object from it. If the URL is not valid, it raises an exception.</p></li><li class="li"><p>It then uses the <code>parse</code> method of the RSS library to parse the RSS stream referenced by the URI object and store the individual RSS entries in a Parser object referenced by the <code>@parser</code> instance variable.  It then clears the local cache of photos and tells the image browser to reload its data.</p></li><li class="li"><p>If any of the foregoing steps raises an exception, the parse method of the <code>RSSWindowController</code> class handles it by displaying an alert panel using the Application Kit’s  <code><a href="../../../Reference/ApplicationKit/Miscellaneous/AppKit_Functions/Reference/reference.html#//apple_ref/c/func/NSRunAlertPanel" target="_top">NSRunAlertPanel</a></code> function.</p></li></ul><p>When the <code>IKImageBrowserView</code> object receives a <code><a href="../../../../GraphicsImaging/Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/instm/IKImageBrowserView/reloadData" target="_top">reloadData</a></code>message, it requests from its data source—in this case, the <code>RSSWindowController</code> object—the images to display by sending it first a <code>numberOfItemsInImageBrowser</code>. Depending on the number of items returned by this method (assuming it’s a positive value), the <code>IKImageBrowserView</code> object then sends one or more <code><!--a target="_top" -->imageBrowser:itemAtIndex:<!--/a--></code> messages to its data source. <span class="content_text">Listing 5</span> shows how <code>RSSWindowController</code> implements the methods invoked by these messages.</p><a name="//apple_ref/doc/uid/TP40005425-SW11" title="Listing 5Implementing the data-source and delegate methods"></a><p class="codesample"><strong>Listing 5&nbsp;&nbsp;</strong>Implementing the data-source and delegate methods</p><div class="codesample"><table><tr><td scope="row"><pre>  def numberOfItemsInImageBrowser(browser)<span></span></pre></td></tr><tr><td scope="row"><pre>    @parser ? @parser.items.length : 0<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def imageBrowser_itemAtIndex(browser, index)<span></span></pre></td></tr><tr><td scope="row"><pre>    photo = @cache[index]<span></span></pre></td></tr><tr><td scope="row"><pre>    if photo.nil?<span></span></pre></td></tr><tr><td scope="row"><pre>      item = @parser.items[index]<span></span></pre></td></tr><tr><td scope="row"><pre>      url = item.description.scan(/img src="([^"]+)/).first.first<span></span></pre></td></tr><tr><td scope="row"><pre>      photo = RSSPhoto.new(url)<span></span></pre></td></tr><tr><td scope="row"><pre>      @cache[index] = photo<span></span></pre></td></tr><tr><td scope="row"><pre>    end<span></span></pre></td></tr><tr><td scope="row"><pre>    return photo<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def imageBrowser_cellWasDoubleClickedAtIndex(browser, index)<span></span></pre></td></tr><tr><td scope="row"><pre>    NSWorkspace.sharedWorkspace.openURL(@cache[index].url)<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr></table></div><p>Let’s examine the interesting aspects of this code, especially the RubyCocoa parts. The <code>imageBrowser_itemAtIndex</code> and <code>imageBrowser_cellWasDoubleClickedAtIndex</code> methods illustrate the RubyCocoa convention of replacing all keyword colons of Objective-C method signatures with underscores, except for the final colon. The implementation of <code>imageBrowser_itemAtIndex</code> checks if the photo referenced by the index value (of the browser) is in its cache of photos; it the photo doesn’t exist, it gets the corresponding URL from the RSS Parser object and with that creates a <code>RSSPhoto</code> object, adds it to the cache, and returns it to the image browser, which displays the photo. (You will implement the <code>RSSPhoto</code> class in the following section, <span class="content_text">“Implementing a Custom Ruby Class.”</span>)</p><p>Recall that in <code>awakeFromNib</code> you set the <code>RSSWindowController</code> object to be the delegate of the <code>IKImageBrowserView</code> object. The image browser sends the <code>imageBrowser_cellWasDoubleClicked</code> message to its delegate when a user clicks on an image. This implementation uses the <code>NSWorkspace</code> method <code><a href="../../../Reference/ApplicationKit/Classes/NSWorkspace_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWorkspace/openURL:" target="_top">openURL:</a></code> to open the image in the preferred application.</p><a name="//apple_ref/doc/uid/TP40005425-SW8" title="Implementing a Custom Ruby Class"></a><h2>Implementing a Custom Ruby Class</h2><p>The RSSPhoto class is a simple Ruby subclass in that it implicitly inherits from the root Ruby class. Although it doesn’t inherit from a Cocoa class, as does RSSWindowController, it does implement the required methods of the <code><a href="../../../../GraphicsImaging/Reference/IKImageBrowserItem_Protocol/IKImageBrowserItem_Reference.html#//apple_ref/occ/cat/IKImageBrowserItem" target="_top">IKImageBrowserItem Protocol</a></code> informal protocol. By doing so, it represents an image that can be displayed in the <code><a href="../../../../GraphicsImaging/Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> object. . </p><p><span class="content_text">Listing 6</span> shows the RubyCocoa code used in implementing the RSSPhoto class, which is included in the <code>RSSRubyController.rb</code> file. The <code>imageUID</code>, <code>imageRepesentationType</code>, and <code>imageRepresentation</code> method implementations are required by the <code>IKImageBrowserItem</code> protocol. The <code>imageRepresentation</code> class provides the image browser with the <code>NSImage</code> object to display, using the <code><a href="../../../Reference/ApplicationKit/Classes/NSImage_Class/Reference/Reference.html#//apple_ref/occ/instm/NSImage/initByReferencingURL:" target="_top">initByReferencingURL:</a></code> initializer; note how this method uses Ruby syntax to lazily create the image object.</p><a name="//apple_ref/doc/uid/TP40005425-SW9" title="Listing 6Implementation of the RSSPhoto class"></a><p class="codesample"><strong>Listing 6&nbsp;&nbsp;</strong>Implementation of the RSSPhoto class</p><div class="codesample"><table><tr><td scope="row"><pre>class RSSPhoto<span></span></pre></td></tr><tr><td scope="row"><pre>  attr_reader :url<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def initialize(url)<span></span></pre></td></tr><tr><td scope="row"><pre>    @urlString = url<span></span></pre></td></tr><tr><td scope="row"><pre>    @url = NSURL.alloc.initWithString(url)<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  # IKImageBrowserItem protocol conformance<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def imageUID<span></span></pre></td></tr><tr><td scope="row"><pre>    @urlString<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def imageRepresentationType<span></span></pre></td></tr><tr><td scope="row"><pre>    :IKImageBrowserNSImageRepresentationType<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  def imageRepresentation<span></span></pre></td></tr><tr><td scope="row"><pre>    @image ||= NSImage.alloc.initByReferencingURL(@url)<span></span></pre></td></tr><tr><td scope="row"><pre>  end<span></span></pre></td></tr><tr><td scope="row"><pre>end<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="RubyPythonMacOSX.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Using RubyOSA.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/RubyPythonCocoa/Articles/BuildingRubyCocoaAppl.html%3Fid%3DTP40004936-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/RubyPythonCocoa/Articles/BuildingRubyCocoaAppl.html%3Fid%3DTP40004936-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/RubyPythonCocoa/Articles/BuildingRubyCocoaAppl.html%3Fid%3DTP40004936-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
