<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Cocoa Scripting Guide: How Cocoa Applications Handle Apple Events</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How Cocoa Applications Handle Apple Events"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001239" title="How Cocoa Applications Handle Apple Events"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../Scripting-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000569" target="_top">Scripting &amp; Automation</a> &gt; <a href="../SApps_intro/SAppsIntro.html#//apple_ref/doc/uid/TP40001982-BCICHGIE">Cocoa Scripting Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SApps_script_classes/SAppsScriptClasses.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SApps_evolution/SAppsEvolution.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/20001239-BBCBCIJE" title="How Cocoa Applications Handle Apple Events"></a><h1>How Cocoa Applications Handle Apple Events</h1><p>Whether your application is scriptable or not, Cocoa provides automatic handling for certain Apple events that all applications receive. This chapter describes Cocoa's default support for handling those Apple events and what your application must do to support or modify the default behavior. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-SW4">Apple Event Handling Overview</a>
				
			<br/>
			
        
			
			
				<a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-BBCCJHBA">Apple Events Sent by the Mac OS</a>
				
			<br/>
			
        
			
			
				<a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-BBCIDFHG">Installing an Apple Event Handler</a>
				
			<br/>
			
        
			
			
				<a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-BBCIJGHC">Suspending and Resuming Apple Events and Script Commands</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001239-SW4" title="Apple Event Handling Overview"></a><h2>Apple Event Handling Overview</h2><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_242"></a>All Mac OS X applications that present a graphical user interface should be able to respond to certain Apple events that are sent by the Mac OS. These events, sometimes called the <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_243"></a><strong>required events</strong>, include those the application can receive at launch (the <code>open application</code>, <code>open documents</code>, <code>print documents</code>, and <code>open contents</code> events), as well as others it receives when already running (again including <code>open documents</code> and <code>print documents</code>, as well as the <code>reopen</code> and  <code>quit</code> events). These events can also be sent by other applications and by users executing scripts. </p><p>If an application is scriptable, it can receive additional events that target the scriptable features it supports.</p><a name="//apple_ref/doc/uid/20001239-BBCCFDFG" title="Basics of Apple Event Handling"></a><h3>Basics of Apple Event Handling</h3><p>Applications work with the Apple Event Manager to receive and extract information from Apple events. The processing of Apple events typically follows this pattern:</p><ol class="ol"><li class="li"><p>For the Apple events an application expects to receive, it registers callback routines, called Apple event handlers, with the Apple Event Manager.</p></li><li class="li"><p>When the application receives an Apple event, it uses the Apple Event Manager to dispatch the event to the appropriate event handler and to identify the object or objects in the application on which to perform the specified operation. (The details vary depending on the programming environment in use.)</p></li></ol><p>You can read more about this process in <em><a href="../../../../AppleScript/Conceptual/AppleEvents/index.html#//apple_ref/doc/uid/TP40001449" target="_top">Apple Events Programming Guide</a></em> and <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>. The implementation of code to handle Apple events can be somewhat complex. However, Cocoa provides a lot of built-in support for handling Apple events, minimizing the need for your application to work directly with Apple event data structures or the Apple Event Manager.</p><a name="//apple_ref/doc/uid/20001239-SW1" title="Handling Apple Events in a Cocoa Application"></a><h3>Handling Apple Events in a Cocoa Application</h3><p>For every Cocoa application, the Application Kit automatically installs event handlers for Apple events it knows how to handle, including those sent by the Mac OS. These event handlers implement a default behavior, described in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1117769">“Apple Events Sent by the Mac OS,”</a></span>  that in some cases depends on code implemented by your application.</p><a name="//apple_ref/doc/uid/20001239-SW5" title="Nonscriptable Applications"></a><h4>Nonscriptable Applications</h4><p>A nonscriptable application can support or modify the default behavior provided by the Application Kit's Apple event handlers in these ways:</p><ul class="spaceabove"><li class="li"><p>It can implement or override the appropriate methods invoked by the Cocoa handlers, as described in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1117769">“Apple Events Sent by the Mac OS.”</a></span> This is the standard mechanism.</p></li><li class="li"><p>It can install handlers to supersede the ones installed by Cocoa. To replace a specific event handler, read the information about that event in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1117769">“Apple Events Sent by the Mac OS,”</a></span> then read how to install a new handler in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1134389">“Installing an Apple Event Handler.”</a></span></p></li></ul><p>A nonscriptable application can also install handlers for other Apple events. But if your nonscriptable application needs to install many handlers, you should consider making it scriptable.</p><a name="//apple_ref/doc/uid/20001239-SW6" title="Scriptable Applications"></a><h4>Scriptable Applications</h4><p>A scriptable application can support or modify the default behavior provided by the Application Kit's Apple event handlers in the same ways a nonscriptable application can (by implementing or overriding the appropriate methods, or by installing a replacement event handler).</p><p>For other Apple events, a scriptable application doesn't typically install handlers directly (although it is free to do so) because it can use the script command mechanism. That mechanism, which automatically installs handlers based on information in the application's sdef file, is summarized in <span class="content_text"><a href="../SApps_about_apps/SAppsAboutApps.html#//apple_ref/doc/uid/TP40001976-SW6">“Snapshot of Cocoa Scripting”</a></span> and described in more detail in <span class="content_text"><a href="../SApps_script_cmds/SAppsScriptCmds.html#//apple_ref/doc/uid/20001242-BBCBCIJE">“Script Commands.”</a></span></p><div class="importantbox"><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_14" title="Important:"></a><p><strong>Important:</strong>&nbsp;Your scriptable application should not attempt to provide script command classes to override the Apple event handlers installed by the Application Kit. Because your scriptability information is not loaded until your application receives an Apple event for which no command has been registered, the handlers installed by the Application Kit can be invoked before your handlers are installed.<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_244"></a></p><p></p></div><a name="//apple_ref/doc/uid/20001239-1117769" title="Apple Events Sent by the Mac OS"></a><a name="//apple_ref/doc/uid/20001239-BBCCJHBA" title="Apple Events Sent by the Mac OS"></a><h2>Apple Events Sent by the Mac OS</h2><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_245"></a>The following sections describe Apple events your application is likely to receive from the Mac OS, the response that is expected, and the default behavior supplied by the Application Kit. Your application can implement, or in some cases override, the appropriate methods to support or modify the default behavior. (These events can also be sent by scripts or by other applications.)</p><a name="//apple_ref/doc/uid/20001239-1132198" title="Open Application"></a><h3>Open Application</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_246"></a>The <code>open application</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_247"></a> (or <code>launch</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_248"></a>) Apple event is received when the application is launched. The application should perform any tasks required when a user launches it without opening or printing any documents.</p><div class="notebox"><a name="//apple_ref/doc/uid/20001239-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;The application will instead receive an <code>open documents</code> event if it is launched in response to a user double-clicking a document icon.</p></div><p>Here is how the <code>open application</code> event is handled in Mac OS X version 10.4:</p><ol class="ol"><li class="li"><p>The application is launched.</p></li><li class="li"><p>The application determines if a new, untitled document should be created by invoking the application delegate’s <code>applicationShouldOpenUntitledFile:</code> method. If the application delegate does not implement this method, a new untitled document is created. Implement this method if you want to control that behavior (whether or not your application is <code>NSDocument</code>-based.)</p></li><li class="li"><p>If the application delegate responds to <code>applicationOpenUntitledFile:</code>, that message is sent.</p><p>Otherwise:</p><ul class="ul"><li class="li"><p>If the application is <code>NSDocument</code>-based, the shared <code>NSDocumentController</code> is sent this message:</p><p><code>openUntitledDocumentAndDisplay:error:</code></p><p>You can modify the default behavior by overriding this method. Or you can override the methods this method invokes (described in the Mac OS X version 10.4 documentation for <code><a href="../../../Reference/ApplicationKit/Classes/NSDocumentController_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDocumentController" target="_top">NSDocumentController</a></code>).</p></li><li class="li"><p>It the application is not document-based, for a document to be created, your application delegate must implement this method:</p><p><code>applicationOpenUntitledFile:</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_249"></a></p></li></ul></li></ol><p>Starting in Mac OS X version 10.4, an <code>open application</code> Apple event may contain information about whether the application was launched as a login item or as a service item. If so, the application typically should only perform actions suitable to the environment in which it is launched. For example, an application launched as a service item may not wish to open an untitled document.</p><p>For more information on how your application can check for the presence of launch information, see “Launch Apple Event Constants” in “Apple Event Manager Constants” in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p><a name="//apple_ref/doc/uid/20001239-1119454" title="Reopen"></a><h3>Reopen</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_250"></a>The <code>reopen</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_251"></a> (or <code>reopen application</code>)<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_252"></a> Apple event is received when the application is reopened—for example, when the application is open but not frontmost, and the user clicks its icon in the Dock. The application should perform appropriate tasks—for example, it might create a new document if none is open.</p><p>Here is how the <code>reopen application</code> event is handled:</p><ol class="ol"><li class="li"><p>The application delegate is sent this message (if it implements the method):</p><p><code>applicationShouldHandleReopen:hasVisibleWindows:</code></p></li><li class="li"><p>If the method returns <code>YES</code>, and if there are no open windows, it attempts to create a new untitled document in the same way as for the <code>open application</code> event.</p></li></ol><p>You can modify the default behavior by implementing the method of the application delegate.</p><a name="//apple_ref/doc/uid/20001239-1119823" title="Open"></a><h3>Open</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_253"></a>The <code>open</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_254"></a> (or <code>open documents</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_255"></a>) Apple event is received when the application should open a list of one or more documents. For example, the user may have selected document files in the Finder and double-clicked.</p><p>Here is how the <code>open documents</code> event is handled in Mac OS X version 10.4 (v10.4):</p><ul class="spaceabove"><li class="li"><p>If the application is <code>NSDocument</code>-based, the <code>NSDocumentController</code> is sent this message, once for each document to be opened:</p><div class="codesample"><table><tr><td scope="row"><pre>openDocumentWithContentsOfURL:display:error:<span></span></pre></td></tr></table></div><p>For your application to customize opening of documents in response to the <code>open documents</code> Apple event, it can override this method. Or it can override the methods this method invokes. These methods are described in the Mac OS X v10.4 documentation for <code><a href="../../../Reference/ApplicationKit/Classes/NSDocumentController_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDocumentController" target="_top">NSDocumentController</a></code>, which also describes how the default implementation handles compatibility with previous versions of the Mac OS.</p></li><li class="li"><p>If the application is not <code>NSDocument</code>-based:</p><ol class="ol"><li class="li"><p>The application delegate is sent this message, if it responds to it:</p><p><code>application:openFiles:</code></p></li><li class="li"><p>If the delegate does not respond to that message, the handler checks, in the order listed, whether the application delegate responds to one of the following messages, and if so, sends it:</p><div class="codesample"><table><tr><td scope="row"><pre>openTempFile:<span></span></pre></td></tr><tr><td scope="row"><pre>openFiles:<span></span></pre></td></tr><tr><td scope="row"><pre>openFile:<span></span></pre></td></tr></table></div><p>For your application to open documents in response to this Apple event, it must implement one of these methods.</p></li></ol></li></ul><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_256"></a>Starting in Mac OS X version 10.4, the <code>open documents</code> Apple event may contain an optional parameter containing search text from a <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_257"></a>Spotlight search that specified the documents to be opened. This parameter is identified by the keyword <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_258"></a><code>keyAESearchText</code>. The application should make a reasonable effort to indicate occurrences of the search text in each opened document—for example by selecting the text and scrolling the first or primary occurrence into view. The Application Kit does not currently handle this parameter, but you can provide your own implementation by adding code like that shown in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-SW3">Listing 10-1</a></span> to your method that opens files, such as <code>application:openFiles:</code>.</p><a name="//apple_ref/doc/uid/20001239-SW3" title="Listing 10-1Extracting the search text parameter from the current Apple event"></a><p class="codesample"><strong>Listing 10-1&nbsp;&nbsp;</strong>Extracting the search text parameter from the current Apple event</p><div class="codesample"><table><tr><td scope="row"><pre>    NSString    *searchString = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    searchString = [[[[NSAppleEventManager sharedAppleEventManager]<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        currentAppleEvent]<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        paramDescriptorForKeyword:keyAESearchText]<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        stringValue];<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    // Application-specific code to highlight the searched-for text, if any.<span>// 5</span></pre></td></tr></table></div><p>Here's what this code snippet does:</p><ol class="ol"><li class="li"><p>It invokes the <code>sharedAppleEventManager</code> class method of the <code><a href="../../../Reference/Foundation/Classes/NSAppleEventManager_Class/Reference/Reference.html#//apple_ref/occ/cl/NSAppleEventManager" target="_top">NSAppleEventManager</a></code> class to get an instance of the shared manager.</p></li><li class="li"><p>It invokes the <code>currentAppleEvent</code> method of the <code>NSAppleEventManager</code> object to get the Apple event that is being handled on the current thread, if any, as an <code><a href="../../../Reference/Foundation/Classes/NSAppleEventDescriptor_Class/Reference/Reference.html#//apple_ref/occ/cl/NSAppleEventDescriptor" target="_top">NSAppleEventDescriptor</a></code>.</p></li><li class="li"><p>It invokes the <code>paramDescriptorForKeyword:</code> method of that class, passing the key <code>keyAESearchText</code> (and obtaining another instance of <code>NSAppleEventDescriptor</code>).</p></li><li class="li"><p>It invokes the <code>stringValue</code> method of that class to get the search text, if any, coercing it to Unicode text.</p></li><li class="li"><p>It selects instances of the specified text, if any, in the document, as appropriate for the application (not shown). For example, it might scroll the primary instance into view.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/20001239-SW8" title="Note"></a><p><strong>Note:</strong>&nbsp;For information on the document scriptability features provided by Cocoa, see <span class="content_text"><a href="../SApps_implement/SAppsImplement.html#//apple_ref/doc/uid/20000037-1089105">“Use the Document Architecture.”</a></span><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_259"></a></p></div><a name="//apple_ref/doc/uid/20001239-1122706" title="Print"></a><h3>Print</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_260"></a>The <code>print</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_261"></a> (or <code>print documents</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_262"></a>) Apple event is received when the application should print a list of one or more documents.</p><p>Here is how the <code>print</code> event is handled in Mac OS X version 10.4:</p><ul class="spaceabove"><li class="li"><p>If the application is <code>NSDocument</code>-based, each document to be printed is sent this message:</p><div class="codesample"><table><tr><td scope="row"><pre>printDocumentWithSettings:showPrintPanel:delegate:didPrintSelector:contextInfo:<span></span></pre></td></tr></table></div>	<p>Documents are opened automatically before printing, if necessary. If a document is opened just for printing, it is closed when printing is complete.</p><p>You can modify the default behavior by overriding the methods this method invokes (described in the Mac OS X v10.4 documentation for <code><a href="../../../Reference/ApplicationKit/Classes/NSDocumentController_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDocumentController" target="_top">NSDocumentController</a></code>).</p></li><li class="li"><p>If the application is not <code>NSDocument</code>-based, the handler checks, in the order listed, whether the application delegate responds to one of the following messages, and if so, sends it:</p><div class="codesample"><table><tr><td scope="row"><pre>printFiles:withSettings:showPrintPanels:<span></span></pre></td></tr><tr><td scope="row"><pre>printFiles:<span></span></pre></td></tr><tr><td scope="row"><pre>printFile:<span></span></pre></td></tr></table></div><p>For your application to print documents in response to this Apple event, it must implement one of these methods.</p></li></ul><a name="//apple_ref/doc/uid/20001239-1121328" title="Open Contents"></a><h3>Open Contents</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_263"></a>The <code>open contents</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_264"></a> Apple event is available starting in Mac OS version 10.4. This Apple event is sent when content, such as text or an image, is dropped on the application icon—for example, when a dragged image is dropped on the icon in the Dock. The application should use the content in an appropriate way—for example, if a document is open, it might insert the content at the current insertion point;  if no document is open, it might open a new document and insert the provided text or image.</p><p>If your application provides a service that can accept the type of data in a received <code>open contents</code> Apple event, the default handler will use the service.</p><p>Here is how the <code>open contents</code> event is handled:</p><ol class="ol"><li class="li"><p>It invokes this method of the application delegate, to give the application a chance to set up services: <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_265"></a><code>applicationDidFinishLaunching:</code></p><p>This is unique, in that for all the other Apple events described here, <code>applicationDidFinishLaunching:</code> is called <em>after</em> the described event handling behavior takes place.</p></li><li class="li"><p>It invokes Carbon's default <code>open contents</code> Apple event handler, which uses the application-provided service. (Carbon behavior is described in "Common Apple Events Sent by the Mac OS" in <span class="content_text"><a href="../../../../AppleScript/Conceptual/AppleEvents/responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206" target="_top">Responding to Apple Events</a></span> in <em><a href="../../../../AppleScript/Conceptual/AppleEvents/index.html#//apple_ref/doc/uid/TP40001449" target="_top">Apple Events Programming Guide</a></em>.</p></li></ol><p>You can modify the default behavior by installing your own <code>open contents</code> Apple event handler. The structure of the event is similar to the <code>open documents</code> event. The direct parameter consists of a list of content data items to be opened. The descriptor type for each item in the list indicates the type of the content (<code>'PICT'</code>, <code>'TIFF'</code>, <code>'utf8'</code>, and so on).</p><a name="//apple_ref/doc/uid/20001239-1121178" title="Quit"></a><h3>Quit</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_266"></a>The <code>quit</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_267"></a> (or <code>quit application</code>) Apple event is received when your application is terminated.</p><p>Here is how the <code>quit</code> event is handled:</p><ul class="spaceabove"><li class="li"><p>If the application is <code>NSDocument</code>-based, the behavior depends on the <code>saving</code> parameter, which has one of these three values:</p><ul class="nested"><li class="nested li"><p><code>NSSaveOptionsNo</code>: The application quits without sending a <code>close</code> message to any document.</p></li><li class="nested li"><p><code>NSSaveOptionsYes</code>: Each unmodified document is sent a <code>close</code> message; each modified document is sent the following message: <code>saveDocumentWithDelegate:didSaveSelector:contextInfo:</code></p></li><li class="nested li"><p><code>NSSaveOptionsAsk</code>: (This is the default value if no <code>saving</code> parameter is supplied in the event.) If there are modified documents open, the <code>NSDocumentController</code> sends itself this message:</p><div class="codesample"><table><tr><td scope="row"><pre>reviewUnsavedDocumentsWithAlertTitle:cancellable:delegate:didReviewAllSelector:contextInfo:<span></span></pre></td></tr></table></div>	</li></ul></li><li class="li"><p>If the application is not <code>NSDocument</code>-based, the application delegate is sent this message (if it is implemented):</p><p><code>applicationShouldTerminate:<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_268"></a></code></p><p>You can modify the default behavior by implementing this method.</p></li></ul><a name="//apple_ref/doc/uid/20001239-SW9" title="Constants for Apple Event Handlers Installed by the Application Kit"></a><h3>Constants for Apple Event Handlers Installed by the Application Kit</h3><p><span class="content_text">Table 10-1</span> shows the constants for the <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_269"></a>Apple event handlers installed by the Application Kit to handle events sent by the Mac OS. Each of these events has the same event class, <code>kCoreEventClass</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_270"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_271"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_272"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_273"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_274"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_275"></a>, which has the value <code>'aevt'</code>. Your application can use these constants for the event class and event ID when installing replacement handlers to modify standard behavior.</p><p>These Apple event constants are defined in <code>AppleEvents.h</code>, a header in <code>AE.framework</code>, a subframework of <code>ApplicationServices.framework</code>. These and other constants are described in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p><a name="//apple_ref/doc/uid/20001239-SW2" title="Table 10-1Event class IDs for Apple events sent by the Mac OS"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 10-1&nbsp;&nbsp;</strong>Event class IDs for Apple events sent by the Mac OS</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Apple event</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Event ID</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th></tr><tr><td  scope="row"><p><code>open application</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_276"></a> (or <code>launch</code>)</p></td><td ><p><code>kAEOpenApplication</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_277"></a></p></td><td ><p><code>'oapp'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_278"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_279"></a></p></td></tr><tr><td  scope="row"><p><code>reopen</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_280"></a></p></td><td ><p><code>kAEReopenApplication</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_281"></a></p></td><td ><p><code>'rapp'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_282"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_283"></a></p></td></tr><tr><td  scope="row"><p><code>open</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_284"></a> (or <code>open documents</code>)</p></td><td ><p><code>kAEOpenDocuments</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_285"></a></p></td><td ><p><code>'odoc'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_286"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_287"></a></p></td></tr><tr><td  scope="row"><p><code>print</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_288"></a> (or <code>print documents</code>)</p></td><td ><p><code>kAEPrintDocuments</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_289"></a></p></td><td ><p><code>'pdoc'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_290"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_291"></a></p></td></tr><tr><td  scope="row"><p><code>open contents</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_292"></a></p></td><td ><p><code>kAEOpenContents</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_293"></a></p></td><td ><p><code>'ocon'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_294"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_295"></a></p></td></tr><tr><td  scope="row"><p><code>quit</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_296"></a> (or <code>quit application</code>)</p></td><td ><p><code>kAEQuitApplication</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_297"></a></p></td><td ><p><code>'quit'</code><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_298"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_299"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_300"></a></p></td></tr></table></div><a name="//apple_ref/doc/uid/20001239-1134389" title="Installing an Apple Event Handler"></a><a name="//apple_ref/doc/uid/20001239-BBCIDFHG" title="Installing an Apple Event Handler"></a><h2>Installing an Apple Event Handler</h2><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_301"></a>Your application, whether scriptable or not, can install Apple event handlers directly. This generally makes sense in the following cases:</p><ul class="ul"><li class="li"><p>You want to customize the default handling of one of the events for which the Application Kit installs a handler, but you can't do so in the standard way, by implementing or overriding the methods described in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1117769">“Apple Events Sent by the Mac OS.”</a></span></p><p>For example, you might want to install a handler for the <code>open contents</code> Apple event to override its default behavior.</p></li><li class="li"><p>You have not made your application scriptable, but you need to handle certain Apple events not supported automatically by the Application Kit.</p><p>If you find yourself handling more than a few Apple events this way, consider making your application scriptable to take advantage of Cocoa scripting's built-in support for handling Apple events.</p></li></ul><p>To install an Apple event handler, you invoke this method of the <code>NSAppleEventManager</code> class:</p><p><code>setEventHandler:andSelector:forEventClass:andEventID:</code></p><p>The signature for the new handler should match the one shown in <span class="content_text">Listing 10-2</span>.</p><a name="//apple_ref/doc/uid/20001239-BBCHEACI" title="Listing 10-2Signature of an event handler function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001239-1134429" title="Listing 10-2Signature of an event handler function"></a><strong>Listing 10-2&nbsp;&nbsp;</strong>Signature of an event handler function</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)handleAppleEvent:(NSAppleEventDescriptor *)event withReplyEvent:(NSAppleEventDescriptor *)replyEvent;<span></span></pre></td></tr></table></div><p>A good place to install event handlers is in the <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_302"></a><code>applicationWillFinishLaunching:</code> method of the application delegate. At that point, the Application Kit has installed its default event handlers, so if you install a handler for one of the same events, it will replace the Application Kit version.</p><a name="//apple_ref/doc/uid/20001239-SW10" title="Installing a Get URL Handler"></a><h3>Installing a Get URL Handler</h3><p><span class="content_text">Listing 10-3</span> shows how you could install a handler for the <code>get URL</code> Apple event.<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_303"></a></p><div class="notebox"><a name="//apple_ref/doc/uid/20001239-SW11" title="Note"></a><p><strong>Note:</strong>&nbsp;To work with URL events, your application will have to specify one or more keys for the <code>CFBundleURLTypes</code> dictionary in its information property list file. These keys are described in the section "CFBundleURLTypes” in <span class="content_text"><a href="../../../../MacOSX/Conceptual/BPRuntimeConfig/Articles/PListKeys.html#//apple_ref/doc/uid/20001431" target="_top">Property List Key Reference</a></span> in <em><a href="../../../../MacOSX/Conceptual/BPRuntimeConfig/index.html#//apple_ref/doc/uid/10000170i" target="_top">Runtime Configuration Guidelines</a></em>.</p></div><a name="//apple_ref/doc/uid/20001239-BBCJBDBI" title="Listing 10-3Installing an Apple event handler in a Cocoa application"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001239-1134469" title="Listing 10-3Installing an Apple event handler in a Cocoa application"></a><strong>Listing 10-3&nbsp;&nbsp;</strong>Installing an Apple event handler in a Cocoa application</p><div class="codesample"><table><tr><td scope="row"><pre>NSAppleEventManager *appleEventManager = [NSAppleEventManager sharedAppleEventManager];<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>[appleEventManager setEventHandler:self andSelector:@selector(handleGetURLEvent:withReplyEvent:) forEventClass:kInternetEventClass andEventID:kAEGetURL];<span>// 2</span></pre></td></tr></table></div><p>Here’s what the code in <span class="content_text">Listing 10-3</span> does:</p><ol class="ol"><li class="li"><p>It gets a reference to the shared Apple Event Manager object.</p></li><li class="li"><p>It invokes a method of that object to install the new handler, passing:</p><ul class="ul"><li class="li"><p>A reference to the delegate object, <code>self</code>, which will handle the event.</p></li><li class="li"><p>A selector for the new <code>get URL</code> handler (shown in <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-BABCBBCJ">Listing 10-4</a></span>).</p></li><li class="li"><p>The event class constant for the Apple event (from the header <code>HIServices/InternetConfig.h</code> in the Application Services framework).</p></li><li class="li"><p>The event ID constant for the Apple event (from the header <code>HIServices/InternetConfig.h</code> in the Application Services framework).</p></li></ul><p>If an event handler is already installed for the specified event class and event ID, it is replaced.</p></li></ol><a name="//apple_ref/doc/uid/20001239-SW12" title="Implementing the Get URL Handler"></a><h3>Implementing the Get URL Handler</h3><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_304"></a><span class="content_text">Listing 10-4</span> provides a template for the event handler. This code resides in the implementation of your application delegate. After this handler has been installed, it is invoked whenever the application receives a <code>get URL</code> Apple event. The Apple event is passed to the handler as an instance of <code>NSAppleEventDescriptor</code>. </p><a name="//apple_ref/doc/uid/20001239-BABCBBCJ" title="Listing 10-4Implementation of a get URL Apple event handler"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001239-1134583" title="Listing 10-4Implementation of a get URL Apple event handler"></a><strong>Listing 10-4&nbsp;&nbsp;</strong>Implementation of a get URL Apple event handler</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)handleGetURLEvent:(NSAppleEventDescriptor *)event withReplyEvent:(NSAppleEventDescriptor *)replyEvent<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Extract the URL from the Apple event and handle it here.<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_305"></a><span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The implementation details are left to you, but they require using methods of the <code><a href="../../../Reference/Foundation/Classes/NSAppleEventDescriptor_Class/Reference/Reference.html#//apple_ref/occ/cl/NSAppleEventDescriptor" target="_top">NSAppleEventDescriptor</a></code> class to extract the URL from the direct parameter of the Apple event, then performing the required operation with it (typically displaying the referenced page in a window). For a similar example, see <span class="content_text"><a href="SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-SW3">Listing 10-1</a></span>.</p><a name="//apple_ref/doc/uid/20001239-1134778" title="Suspending and Resuming Apple Events and Script Commands"></a><a name="//apple_ref/doc/uid/20001239-BBCIJGHC" title="Suspending and Resuming Apple Events and Script Commands"></a><h2>Suspending and Resuming Apple Events and Script Commands</h2><p><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_306"></a><a name="//apple_ref/doc/uid/20001239-DontLinkElementID_307"></a>Starting with Mac OS X version 10.3, the  <code>NSAppleEventManager</code> class provides methods for suspending and resuming an individual Apple event. These methods are of use for applications that respond to Apple events without using the built-in Cocoa scripting support. For applications that do take advantage of the Cocoa scripting support, <code>NSScriptCommand</code> provides methods for suspending and resuming execution of a script command.</p><p>An application typically suspends an Apple event (or a script command) when it performs an asynchronous operation, so that the application won’t receive any more Apple events from the same script until it completes handling of the current event (or script command). For example, suppose the application must display a sheet as part of obtaining information to return in a reply Apple event. If so, it can suspend Apple events (or a script command) before displaying the sheet, insert information into the reply Apple event after the user dismisses the sheet, then resume. This need to suspend and resume can occur with other asynchronous operations (including those that may be open-ended or take a long time to complete).</p><p>To suspend an Apple event, you use the <code>NSAppleEventManager</code> method <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_308"></a><code>suspendCurrentAppleEvent</code>, which returns a suspension ID (<code><a href="../../../Reference/Foundation/Miscellaneous/Foundation_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/NSAppleEventManagerSuspensionID" target="_top">NSAppleEventManagerSuspensionID</a></code>) for an Apple event being handled on the current thread. You can pass this suspension ID to <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_309"></a><code>appleEventForSuspensionID:</code> to get an Apple event descriptor for the suspended event, or to <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_310"></a><code>replyAppleEventForSuspensionID:</code> to get a descriptor for the corresponding reply Apple event. To resume a suspended Apple event, you pass the associated suspension ID to <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_311"></a><code>resumeWithSuspensionID:</code>. In Mac OS X version 10.4, this method can be invoked in any thread.</p><p>To suspend a script command, use the <code>NSScriptCommand</code> method <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_312"></a><code>suspendExecution</code>. This method suspends execution of a script command if the receiver is being executed in the current thread by the built-in Cocoa scripting support (that is, the receiver would be returned by <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_313"></a><code>[NSScriptCommand currentCommand]</code>). You use <a name="//apple_ref/doc/uid/20001239-DontLinkElementID_314"></a><code>resumeExecutionWithResult:</code> to resume a suspended script command. In Mac OS X version 10.4, this method can be invoked in any thread.<a name="//apple_ref/doc/uid/20001239-DontLinkElementID_315"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SApps_script_classes/SAppsScriptClasses.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SApps_evolution/SAppsEvolution.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-03-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/ScriptableCocoaApplications/SApps_handle_AEs/SAppsHandleAEs.html%3Fid%3DTP40002164-2.4&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/ScriptableCocoaApplications/SApps_handle_AEs/SAppsHandleAEs.html%3Fid%3DTP40002164-2.4&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/ScriptableCocoaApplications/SApps_handle_AEs/SAppsHandleAEs.html%3Fid%3DTP40002164-2.4&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>