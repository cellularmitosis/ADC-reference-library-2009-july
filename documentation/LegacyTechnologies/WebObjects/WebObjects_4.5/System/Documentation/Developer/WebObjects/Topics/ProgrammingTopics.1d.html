<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Creating EOQualifiers Programmatically</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1c.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1e.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=616587"> </A><A NAME="21221"> </A>Creating EOQualifiers Programmatically</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=616588"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=616592"> </A>Describes the basics of programmatically building an EOQualifier.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=617496"> </A>Description</H2><P CLASS="Body"><A NAME="pgfId=620635"> </A>An EOQualifier specifies which objects to fetch from a database or filter in an array. It is the Enterprise Objects Framework equivalent to the SQL <TT CLASS="Code">WHERE</TT> clause, but it is designed to work with graphs of objects rather than rows in a database. EOQualifiers are used in conjunction with EOSortOrderings to create EOFetchSpecifications. See the programming topic <A HREF="ProgrammingTopics.1c.html#39919" CLASS="XRef">Creating Fetch Specifications Programmatically</A> for more information about EOSortOrderings and EOFetchSpecifications.</P><P CLASS="Body"><A NAME="pgfId=619558"> </A>The easiest way to create an EOQualifier is using the EOQualifier static method <TT CLASS="Code">qualifierWithQualifierFormat</TT>, as follows: </P><PRE CLASS="Code"><A NAME="pgfId=617731"> </A>EOQualifier qual = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620654"> </A>  (formatString, args);</PRE><P CLASS="Body"><A NAME="pgfId=617750"> </A>This method takes as an argument a format string somewhat like that used with the standard C <TT CLASS="Code">printf()</TT> function. The format string can embed strings, numbers, and other objects using the conversion specification <TT CLASS="Code">%@</TT>. The second argument to <TT CLASS="Code">qualifierWithQualifierFormat</TT> is an NSArray that contains the value or result to substitute for any <TT CLASS="Code">%@</TT> conversion specifications. This allows qualifiers to be built dynamically. To embed a percent sign (<TT CLASS="Code">%</TT>) in the qualifier use <TT CLASS="Code">%%</TT>. Note: If you use an unrecognized character in a conversion specification (for example, <TT CLASS="Code">%x</TT>), an exception is thrown. </P><P CLASS="Body"><A NAME="pgfId=619354"> </A>In Objective-C, the equivalent code looks like this:</P><PRE CLASS="Code"><A NAME="pgfId=619355"> </A>EOQualifier qual;<A NAME="pgfId=620655"> </A>qual = [EOQualifier qualifierWithQualifierFormat:<A NAME="pgfId=620656"> </A>  formatString, arg1, arg2, ... ]</PRE><P CLASS="Body"><A NAME="pgfId=617757"> </A>For example, suppose you have a Movie entity with the properties <TT CLASS="Code">title</TT>, <TT CLASS="Code">category</TT>, <TT CLASS="Code">revenue</TT>, <TT CLASS="Code">dateReleased</TT>, and <TT CLASS="Code">toMovieRole</TT> (representing a to-many relationship to the movie's roles), and a MovieRole entity with a <TT CLASS="Code">roleName</TT> property. Furthermore, you want to find all movies that start with a user-specified string in <TT CLASS="Code">searchTitle</TT> and grossed more than a user-specified amount of money in <TT CLASS="Code">searchRevenue</TT>. The following code builds an EOQualifier that finds these movies.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=620870"> </A>Building a qualifier (Java)</H4><PRE CLASS="Code"><A NAME="pgfId=617766"> </A>String searchTitle;     // Assume this exists<A NAME="pgfId=620657"> </A>Integer searchRevenue;  // Assume this exists<A NAME="pgfId=620658"> </A><A NAME="pgfId=620659"> </A>String wildTitle = searchTitle + &quot;*&quot;;<A NAME="pgfId=620660"> </A>EOQualifier myQualifier;<A NAME="pgfId=620661"> </A>NSArray args = new NSArray(new Object[] {wildTitle,&quot;revenue&quot;,searchRevenue});<A NAME="pgfId=620666"> </A>myQualifier = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620667"> </A>    (&quot;title caseInsensitiveLike %@ AND %@ &lt; %@&quot;, args);<A NAME="pgfId=620668"> </A></PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=619390"> </A>Building a qualifier (Objective-C)</H4><PRE CLASS="Code"><A NAME="pgfId=620863"> </A>NSString searchTitle;   // Assume this exists<A NAME="pgfId=620669"> </A>int searchRevenue;      // Assume this exists<A NAME="pgfId=620670"> </A><A NAME="pgfId=620671"> </A>NSString wildTitle;<A NAME="pgfId=620672"> </A>EOQualifier myQualifier;<A NAME="pgfId=620673"> </A><A NAME="pgfId=620674"> </A>wildTitle = [NSString stringWithFormat:@&quot;%@*&quot;,searchTitle];<A NAME="pgfId=620675"> </A>myQualifier = [EOQualifier qualifierWithQualifierFormat<A NAME="pgfId=620676"> </A>    @&quot;title caseInsensitiveLike %@ AND %@ &lt; %d&quot;,<A NAME="pgfId=620677"> </A>    wildTitle,@&quot;revenue&quot;,searchRevenue];<A NAME="pgfId=620678"> </A></PRE><P CLASS="Body"><A NAME="pgfId=617806"> </A>Note that in Objective-C, the <TT CLASS="Code">%d</TT>, <TT CLASS="Code">%f</TT>, and <TT CLASS="Code">%s</TT> <TT CLASS="Code">printf()</TT> formats are supported in addition to <TT CLASS="Code">%@</TT>.</P><P CLASS="Body"><A NAME="pgfId=619407"> </A>String literals are expressed in single quotes. However, the <TT CLASS="Code">%@</TT> conversion specification is never surrounded by single quotes. </P><PRE CLASS="Code"><A NAME="pgfId=617809"> </A>// For a literal string value such as Smith, you use single quotes.<A NAME="pgfId=620679"> </A>EOQualifier.qualifierWithQualifierFormat(&quot;lastName = 'Smith'&quot;, null);<A NAME="pgfId=620680"> </A><A NAME="pgfId=620681"> </A>// For the conversion specification %@, you don't use quotes<A NAME="pgfId=620682"> </A>args = NSMutableArray(&quot;Jones&quot;);<A NAME="pgfId=620683"> </A>EOQualifier.qualifierWithQualifierFormat(&quot;lastName = %@&quot;, args);</PRE><P CLASS="Body"><A NAME="pgfId=617829"> </A>The operators you can use in constructing qualifiers are <TT CLASS="Code">=</TT>, <TT CLASS="Code">==</TT>, <TT CLASS="Code">&lt;&gt;</TT>, <TT CLASS="Code">&lt;</TT>, <TT CLASS="Code">&gt;</TT>, <TT CLASS="Code">&lt;=</TT>, <TT CLASS="Code">&gt;=</TT>, <TT CLASS="Code">like</TT>, and <TT CLASS="Code">caseInsensitiveLike</TT>. The <TT CLASS="Code">like</TT> and <TT CLASS="Code">caseInsensitiveLike</TT> operators can be used with wildcards to perform pattern matching, as described below. </P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=617857"> </A>Using Wildcards and the like Operator</H3><P CLASS="Body"><A NAME="pgfId=617859"> </A>When you use the <TT CLASS="Code">like</TT> or <TT CLASS="Code">caseInsensitiveLike</TT> operator in a qualifier expression, you can use the wildcard characters <TT CLASS="Code">*</TT> and <TT CLASS="Code">?</TT> to perform pattern matching, for example: </P><PRE CLASS="Code"><A NAME="pgfId=617862"> </A>&quot;lastName like 'Jo*'&quot;</PRE><P CLASS="Body"><A NAME="pgfId=617865"> </A>matches Jones, Johnson, Jolsen, Josephs, and so on. </P><P CLASS="Body"><A NAME="pgfId=617867"> </A>The <TT CLASS="Code">?</TT> character just matches a single character, for example: </P><PRE CLASS="Code"><A NAME="pgfId=617870"> </A>&quot;lastName like 'Jone?'&quot;</PRE><P CLASS="Body"><A NAME="pgfId=617873"> </A>matches Jones. </P><P CLASS="Body"><A NAME="pgfId=617875"> </A>The asterisk character (<TT CLASS="Code">*</TT>) is only interpreted as a wildcard in expressions that use the <TT CLASS="Code">like</TT> or <TT CLASS="Code">caseInsensitiveLike</TT> operator. For example, in the following statement, the character <TT CLASS="Code">*</TT> is treated as a literal value, not as a wildcard: </P><PRE CLASS="Code"><A NAME="pgfId=617878"> </A>&quot;lastName = 'Jo*'&quot;</PRE><P CLASS="Body"><A NAME="pgfId=618781"> </A>Note that when you combine wildcards with the <TT CLASS="Code">%@</TT> conversion specification, you must put the wildcard in the argument and not the conversion:</P><PRE CLASS="Code"><A NAME="pgfId=618789"> </A>// CORRECT:<A NAME="pgfId=620684"> </A>keyword = &quot;Jo&quot;;<A NAME="pgfId=620685"> </A>NSArray args = new NSArray (keyword+&quot;*&quot;);<A NAME="pgfId=620686"> </A>EOQualifier myQualifier = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620687"> </A>    (&quot;lastName like %@&quot;,args);</PRE><P CLASS="Body"><A NAME="pgfId=618820"> </A>The following code won't work:</P><PRE CLASS="Code"><A NAME="pgfId=618819"> </A>// WRONG:<A NAME="pgfId=620688"> </A>keyword = &quot;Jo&quot;;<A NAME="pgfId=620689"> </A>NSArray args = new NSArray (keyword);<A NAME="pgfId=618818"> </A>EOQualifier myQualifier = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620690"> </A>    (&quot;lastName like %@*&quot;,args);</PRE></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=617922"> </A>Joining Qualifiers</H3><P CLASS="Body"><A NAME="pgfId=617924"> </A>The EOAndQualifier and EOOrQualifier subclasses of EOQualifier can be used to form boolean combinations of qualifiers. For example, the EOAndQualifier is itself a qualifier that is the logical AND of its constituent qualifiers. In the following code, <TT CLASS="Code">myQualifier1</TT> is equivalent to <TT CLASS="Code">myQualifier2</TT>.</P><PRE CLASS="Code"><A NAME="pgfId=618905"> </A>NSMutableArray args = new NSMutableArray();<A NAME="pgfId=620691"> </A>args.addObject(EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620692"> </A>    (&quot;title like 'S*'&quot;));<A NAME="pgfId=620693"> </A>args.addObject(EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620694"> </A>    (&quot;revenue &gt; 500000&quot;));<A NAME="pgfId=620695"> </A>EOAndQualifier myQualifier1 = EOAndQualifier(args);<A NAME="pgfId=620696"> </A><A NAME="pgfId=620697"> </A>EOQualifier myQualifier2 = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620698"> </A>    (&quot;title like 'S*' AND revenue &gt; 500000&quot;);</PRE><P CLASS="Body"><A NAME="pgfId=619004"> </A>The EONotQualifier forms the logical NOT of its constituent qualifier and can be used with EOAndQualifier and EOOrQualifier to form complex boolean qualifiers.</P><P CLASS="Body"><A NAME="pgfId=619533"> </A>Using the boolean EOQualifier subclasses is often more convenient than using <TT CLASS="Code">qualifierWithQualifierFormat</TT> when forming qualifiers by iterating over enumerated objects. An example is building keyword searches. The following code example builds a qualifier based on an NSArray of keywords. The qualifier filters the Movies database for all Talents that have all of the keywords in their names, the movie roles they star in, or the movies they star in.</P><PRE CLASS="Code"><A NAME="pgfId=619032"> </A>NSArray keywords;   // Assume exists<A NAME="pgfId=620699"> </A>NSMutableArray qualifierArray = new NSMutableArray();<A NAME="pgfId=620700"> </A>Enumeration e = keywords.objectEnumerator();<A NAME="pgfId=620701"> </A>while (e.hasMoreElements()) {<A NAME="pgfId=620702"> </A>    String kw = e.nextElement();<A NAME="pgfId=619036"> </A>    kw = &quot;*&quot; + kw + &quot;*&quot;;<A NAME="pgfId=620703"> </A>    String qualifierString =<A NAME="pgfId=620704"> </A>        &quot;firstName caseInsensitiveLike %@ OR &quot; +<A NAME="pgfId=620705"> </A>        &quot;lastName caseInsensitiveLike %@ OR &quot; +<A NAME="pgfId=620706"> </A>        &quot;toMovieRole.roleName caseInsensitiveLike %@ OR &quot; +<A NAME="pgfId=620707"> </A>        &quot;toMovieRole.toMovie.title caseInsensitiveLike %@&quot;;<A NAME="pgfId=620709"> </A>    EOQualifier tempQualifier = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=620710"> </A>        (qualifierString,new NSArray (new Object[] {kw,kw,kw,kw}));<A NAME="pgfId=620711"> </A>    qualifierArray.addObject (tempQualifier);<A NAME="pgfId=620712"> </A>}<A NAME="pgfId=620713"> </A>EOQualifier qualifier = new EOAndQualifier(qualifierArray);<A NAME="pgfId=620714"> </A></PRE></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=617703"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=616658"> </A><A HREF="ProgrammingTopics.1c.html#39919" CLASS="XRef">Creating Fetch Specifications Programmatically</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=620648"> </A><A HREF="ProgrammingTopics.1e.html#35104" CLASS="XRef">Creating Sort Orderings</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=616663"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=616664"> </A>How do I programmatically create an EOQualifier?</LI><LI CLASS="Bulleted"><A NAME="pgfId=616665"> </A>How do I use wildcards with an EOQualifier?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=616667"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=617656"> </A>Qualifier</LI><LI CLASS="Bulleted"><A NAME="pgfId=617657"> </A>Wildcard</LI><LI CLASS="Bulleted"><A NAME="pgfId=617658"> </A><TT CLASS="Code">SELECT</TT></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=616673"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=617669"> </A>10 March, 1999. Clif Liu. First Draft.</P><P CLASS="Body"><A NAME="pgfId=617676"> </A></P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1c.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1e.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>