<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>L802Attach(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING254></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-253.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-255.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-235.html"><B>Chapter 10 - Link-Access Protocol (LAP) Manager</B></A> / <A HREF="Networking-243.html"><B>LAP Manager Reference</B></A><BR><DL><DD><A HREF="Networking-246.html"><B>Routines</B></A> / <A HREF="Networking-253.html"><B>Attaching and Detaching 802.2 Protocol Handlers</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING254-0></A>
<H3><A NAME=MARKER-9-170></A>L802Attach<A NAME=MARKER-2-102></A></H3>
 The <CODE>L802Attach</CODE> routine attaches to the LAP Manager a protocol handler for a specific IEEE 802.2 protocol type.<P>
<A NAME=HEADING254-2></A>
<H5>DESCRIPTION</H5>
 You call the <CODE>L802Attach</CODE> routine from assembly language by placing the routine selector of 21 in the D0 register and the reference number of the Ethernet, token ring, or FDDI driver in the D2 register that the <CODE>OpenSlot</CODE> or <CODE>OpenDriver</CODE> function returns. Then, you execute a JSR instruction to an offset 2 bytes past the start of the LAP Manager. The start of the LAP Manager is contained in the global variable <CODE>LAPMgrPtr</CODE> ($B18). <P>
 Here are the register contents that you supply on entry and the value that is returned <BR>to you.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>21<TR>
<TD>D2<TD>Reference number of hardware device driver<TR>
<TD>A0<TD>Pointer to your protocol handler<TR>
<TD>A1<TD>Pointer to protocol-type specification</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D0<TD>Nonzero if error </TABLE>
 <P>
 You must put a pointer to your protocol handler in the A0 register and a pointer to the protocol-type specification for this protocol handler in the A1 register. The protocol-type specification consists of one or more protocol-type fields, each preceded by a length byte. The LAP Manager reads the fields in the 802.2 data packet header to determine to which protocol handler (if any) to deliver the packet. The first type field in your protocol specification is the 1-byte DSAP. If the DSAP type field is equal to <CODE>$AA</CODE>, then the packet is a SNAP packet. In this case, the protocol-type specification must contain a second type field, the 5-byte SNAP type. If the SNAP type field is <CODE>$00000080F3</CODE>, indicating the AppleTalk Address Resolution Protocol (AARP), then the protocol-type specification must contain a third type field, the 4-byte AARP protocol type. Terminate the list of protocol-type fields with a byte of zeros.<A NAME=MARKER-2-172></A><A NAME=MARKER-2-173></A><A NAME=MARKER-2-174></A><A NAME=MARKER-2-175></A><P>
 <A NAME=MARKER-2-176></A>The following protocol-type specification, for example, is for the permanent LAP Manager protocol handler for an 802.3 packet <A NAME=MARKER-2-177></A>containing AppleTalk data. The .ENET driver would deliver this packet to the LAP Manager. The first byte, <CODE>$01</CODE>, is the length byte for the first protocol-type field (the DSAP type field), <CODE>$AA</CODE>, contained in the second byte. The DSAP value of <CODE>$AA</CODE> is reserved for use with protocol-type specifications that include a SNAP field. The third byte, <CODE>$05</CODE>, is the length byte for the next protocol-type field, the SNAP type field, <CODE>$0800078098</CODE>. The SNAP value of <CODE>$08 00 07 80 9B</CODE> is reserved for AppleTalk data. The final byte (<CODE>$00</CODE>) terminates the type specification.<P>
<PRE>
01 AA 05 08 00 07 80 9B 00
</PRE>
 <A NAME=MARKER-9-92></A>The following protocol-type specification is for the permanent LAP Manager protocol handler for an <A NAME=MARKER-2-60></A>802.3 packet to be delivered to the EtherTalk AARP handler. Notice that the SNAP field is followed by an additional type field, the AARP protocol type.<P>
<PRE>
01 AA 05 00 00 00 80 F3 04 00 01 80 9B 00
</PRE>
 The SNAP value of <CODE>$00 00 00 80 F3</CODE> is reserved for AARP data. The AARP protocol type value of <CODE>$00 01 80 9B</CODE> is reserved for Ethernet AARP packets.<P>
<A NAME=HEADING254-11></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 For token ring, the Apple Computer, Inc. specification for the device driver that <BR>the hardware vendor must implement requires that the driver process only SNAP packets, that is, packets with a SAP value of $AA. For Ethernet and FDDI, your <BR>protocol can receive packets with a SAP value of $AA or any other SAP value. <P>
 You can only use the <CODE>L802Attach</CODE> routine if the hardware device driver interface conforms to the Apple specification for that driver type. <P>
<A NAME=HEADING254-14></A>
<H5>RESULT CODES</H5>
 The <CODE>L802Attach</CODE> routine returns a nonzero value in the D0 register if there is an error. <P>
<A NAME=HEADING254-16></A>
<H5>SEE ALSO</H5>
 See the <A HREF=Networking-253.html#MARKER-9-162>"The LAP Manager and 802.2 Protocol Packets" on page 10-21</A> and the ANSI/IEEE standard 802.2 for more information about 802.2 protocols, and see <I>Inside AppleTalk,</I> second edition, for more information about AARP.<P>
 See <I><A HREF="../Devices/Devices-2.html">Inside Macintosh: Devices</A></I> for information on <A NAME=MARKER-2-42></A>the <CODE>OpenSlot</CODE> functi<A NAME=MARKER-2-181></A>on.<A NAME=MARKER-2-107></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-253.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-255.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
