<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating and Updating an Active Input Area(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING454></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-453.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-455.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-409.html"><B>Chapter 7 - Text Services Manager</B></A> / <A HREF="Text-425.html"><B>Text Services Manager Reference</B></A><BR><DL><DD><A HREF="Text-453.html"><B>Apple Event Handlers Supplied by Client Applications</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING454-0></A>
<H3>Creating and Updating an Active Input Area</H3>
 The text service component uses the Update Active Input Area Apple event to request that your client application create and update an active input area, and accept confirmed text. For details on active input areas, see <A HREF=Text-414.html#MARKER-9-81>"Inline Input" on page 7-11</A>.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2><A NAME=MARKER-9-1></A>Update Active Input Area--Creating and Updating an Active Input Area (Continued)<TR>
<TD><A NAME=MARKER-2-131></A>Event class<TD>kTextServiceClass<TR>
<TD>Event ID<TD>kUpdateActiveInputArea<TR>
<TD>Requested action<TD rowspan=2>Update a range of text. Specify any necessary highlighting with offsets in the optional <CODE>keyAEHiliteRange</CODE> parameter.<TR>
<TD>&nbsp;<TR>
<TD>Required parameters<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-204></A>Keyword:<TD>keyAETSMDocumentRefcon<TR>
<TD>Descriptor type:<TD>typeLongInteger<TR>
<TD>Data:<TD>A TSM document specifier (reference constant) supplied by the application in a prior call to the <CODE>NewTSMDocument</CODE> function (see <A HREF=Text-431.html#MARKER-9-231>page 7-50</A>). This value is associated with the TSM document whose active input area is to be updated.<TR>
<TD><A NAME=MARKER-9-101></A>Keyword:<TD>keyAEServerInstance<TR>
<TD>Descriptor type:<TD>typeComponentInstance<TR>
<TD>Data:<TD>A component instance value created by a prior call to the Component Manager <CODE>OpenComponent</CODE> function. This value identifies the text service component.<TR>
<TD><A NAME=MARKER-2-137></A>Keyword:<TD>keyAETheData<TR>
<TD>Descriptor type:<TD>typeChar<TR>
<TD>Data:<TD>Text data that has been processed in some way by a text service component.<TR>
<TD><A NAME=MARKER-2-232></A>Keyword:<TD>keyAEScriptTag<TR>
<TD>Descriptor type:<TD>typeIntlWritingCode<TR>
<TD>Data:<TD>The script code and language code associated with the text returned in the <CODE>keyAETheData</CODE> parameter. The information is passed in a script-language record, as defined on <A HREF=Text-423.html#MARKER-9-202>page 7-42</A>.<TR>
<TD>Required parameters<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-28></A>Keyword:<TD>keyAEFixLength<TR>
<TD>Descriptor type:<TD>typeLongInteger<TR>
<TD>Data:<TD>The length of the confirmed text in the active inline area.<P>If the value of <CODE>keyAEFixLength</CODE> is -1, the text contained in the <CODE>keyAETheData</CODE> parameter is to completely replace the current selection in the application window. In this case, there is to be no active input area, the text is all considered to be confirmed, and is to be made part of the body text of the client application.<P>If the value is 0, an active input area is in process, but there is no completely confirmed text being sent.<P>If the value is greater than 0, the text specified in the <CODE>keyAETheData</CODE> parameter up to the indicated offset is confirmed data and should be consumed by the application. The Text Services Manager considers any text beyond the offset specified by the <CODE>keyAEFixLength</CODE> parameter to be inside the active input area with the starting point of the active input area at that offset. This is illustrated in <A HREF=#MARKER-9-298>Figure 7-11</A>.</TABLE>
<P>
<B>Figure 7-11  <A NAME=MARKER-9-298></A>Updating text in an active input area
<TABLE BORDER="0" CELLPADDING=3><TH colspan=3>Update Active Input Area--Creating and Updating an Active Input Area (continued) (Continued)<TR>
<TD colspan=2>Optional parameters<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-104></A>Keyword:<TD>keyAEHiliteRange<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeTextRangeArray<TD>&nbsp;<TR>
<TD>Data:<TD colspan=2>An array that specifies the ranges of text to be highlighted in <BR>the active input area. It also specifies caret position. There are <BR>5 types of highlighting:<TR>
<TD>&nbsp;<TD>Constant<TD>Applies to<TR>
<TD>&nbsp;<TD><A NAME=MARKER-2-30></A>kCaretPosition<TD>The caret position only<TR>
<TD>&nbsp;<TD><A NAME=MARKER-2-233></A>kRawText<TD>All of the unconverted text<TR>
<TD>&nbsp;<TD><A NAME=MARKER-2-106></A>kSelectedRawText<TD>Part of the unconverted text<TR>
<TD>&nbsp;<TD><A NAME=MARKER-9-287></A>kConvertedText<TD>All of the converted text<TR>
<TD>&nbsp;<TD><A NAME=MARKER-2-295></A>kSelectedConvertedText<TD>Part of the converted text<TR>
<TD>&nbsp;<TD colspan=2>For instance, the input method may have the application highlight all raw text with a gray underline; but if it needs to further highlight a selection within that raw text, it may specify a different underline for the selected raw text. The text range array is an array of text-range records, each of which has this form:<P><A NAME=MARKER-2-296></A>TYPE TextRange =<BR>  RECORD<BR>    <A NAME=MARKER-2-36></A>fStart:           LongInt;<BR>    <A NAME=MARKER-2-37></A>fEnd:             LongInt;<BR>    <A NAME=MARKER-2-38></A>fHiliteStyle:     Integer;<BR>  END;<P>For the text-range record whose highlight style is <CODE>kCaretPosition</CODE>, both <CODE>fStart</CODE> and <CODE>fEnd</CODE> are the same and denote the position of the caret.<P>Negative values for a text range mean that the specified range only adds to, rather than replaces, any current highlighting for the specified type of text.<TR>
<TD colspan=2>Optional parameters<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-39></A>Keyword:<TD>keyAEUpdateRange<TD><CODE></CODE><TR>
<TD>Descriptor type:<TD>typeTextRangeArray<TD><CODE></CODE><TR>
<TD>Data:<TD colspan=2>An array of text-range records that indicates the update range of the active input area (in many circumstances, not all of the active input area needs updating). Update Active Input Area always uses the text-range records in the text range array in pairs. The first record (0) specifies a range of old text (text in the inline buffer) to be updated; the second record (1) specifies the range of text in <CODE>keyAETheData</CODE> that is to replace that old text. In general, the record <I>n</I> (<I>n</I> &gt;= 0, <I>n</I> is an even number) specifies the range of old text to be updated and the record <I>n</I> + 1 specifies the range of new text to replace the corresponding old text. (The <CODE>fHiliteStyle</CODE> field is ignored.)<TR>
<TD><A NAME=MARKER-2-40></A>Keyword:<TD>keyAEPinRange<TD><CODE></CODE><TR>
<TD>Descriptor type:<TD>typeTextRange<TD><CODE></CODE><TR>
<TD>Data:<TD colspan=2>A text range record that specifies a start offset and and an end offset that should be scrolled into view if the text specified by these offsets is not already in view. (The <CODE>fHiliteStyle</CODE> field is ignored.)<TR>
<TD><A NAME=MARKER-2-41></A>Keyword:<TD>keyAEClauseOffsets<TD><CODE></CODE><TR>
<TD>Descriptor type:<TD><CODE>typeOffsetArray</CODE><TD><CODE></CODE><TR>
<TD>Data:<TD colspan=2>An offset array (defined by the <CODE>OffsetArray</CODE> data type) that specifies offsets of word or clause boundaries of the new text. Offsets are from the start of the active input area. Applications can use this information for word selection or other purposes.<P><A NAME=MARKER-2-42></A>TYPE OffsetArray =<BR>  RECORD<BR>    fNumOfOffsets: Integer;<BR>    fOffset: ARRAY[0..0] of LongInt;<BR>  END;<P><A NAME=MARKER-2-43></A>The <CODE>numOfOffsets</CODE> field contains an integer that specifies the number of offsets in the offset array. The <CODE><A NAME=MARKER-2-44></A>fOffset</CODE> field is an array of long integers with the number of entries specified in the <CODE>numOfOffsets</CODE> field.<TR>
<TD colspan=2>Return parameter<TD>&nbsp;<TR>
<TD>Keyword:<TD><CODE>keyErrorNumber</CODE><TD><CODE></CODE><TR>
<TD>Descriptor type:<TD><CODE>typeShortInteger</CODE><TD>&nbsp;<TR>
<TD>Data:<TD colspan=2>Any errors that the application needs to return to the text service component. The application must pass Memory Manager, TextEdit, or other errors that it receives through to the component; otherwise, it should pass 0 (<CODE>noErr</CODE>).</TABLE>
</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TSM-04.jpg">
 The text range array data structure used in the <CODE>keyAEHiliteRange</CODE> <BR>and <CODE>keyAEUpadateRange</CODE> parameters described above is defined by the <CODE>TextRangeArray</CODE> data type:<P>
<PRE>
TYPE TextRangeArray = 
   RECORD
      fNumOfRanges:  Integer;
      fRange:        ARRAY[0..0] of TextRange;
   END;
</PRE>
 The <CODE>fNumOfRanges</CODE> field contains an integer that indicates how many text ranges this array holds. The <CODE>fRange</CODE> field contains a series of text-range records. (If the array consists of more than one text-range record, the size of the array must be calculated as <CODE>fNumOfRanges * SizeOf(fRange)</CODE>.)<P>
 For sample code that handles the Update Active Input Area Apple event, see <A HREF=Text-419.html#MARKER-9-164>Listing 7-7 on page 7-26</A>.<A NAME=MARKER-2-299></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-453.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-455.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
