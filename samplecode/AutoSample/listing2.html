<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>AutoSample - /Controller.m</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/ScriptingAutomation/index.html">Scripting & Automation</a> &gt; <a href="../../samplecode/ScriptingAutomation/idxAutomator-date.html">Automator</a> &gt; <A HREF="javascript:location.replace('index.html');">AutoSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">AutoSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Controller.m</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Controller.h</option>
<option value="listing2.html">/Controller.m</option>
<option value="listing3.html">/main.m</option>
<option value="listing4.html">/ReadMe.txt</option></select>
				</p>
				</form>
				<p><strong><a href="AutoSample.zip">Download Sample</a></strong> (&#147;AutoSample.zip&#148;, 170.8K)<BR>
<strong><a href="AutoSample.dmg">Download Sample</a></strong> (&#147;AutoSample.dmg&#148;, 237.3K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/* File: Controller.m

Abstract: implementation for main window's controller.

Version: 1.0

(c) Copyright 2007 Apple, Inc. All rights reserved.

IMPORTANT:  This Apple software is supplied to 
you by Apple, Inc. (&quot;Apple&quot;) in 
consideration of your agreement to the following 
terms, and your use, installation, modification 
or redistribution of this Apple software 
constitutes acceptance of these terms.  If you do 
not agree with these terms, please do not use, 
install, modify or redistribute this Apple 
software.

In consideration of your agreement to abide by 
the following terms, and subject to these terms, 
Apple grants you a personal, non-exclusive 
license, under Apple's copyrights in this 
original Apple software (the &quot;Apple Software&quot;), 
to use, reproduce, modify and redistribute the 
Apple Software, with or without modifications, in 
source and/or binary forms; provided that if you 
redistribute the Apple Software in its entirety 
and without modifications, you must retain this 
notice and the following text and disclaimers in 
all such redistributions of the Apple Software. 
Neither the name, trademarks, service marks or 
logos of Apple Computer, Inc. may be used to 
endorse or promote products derived from the 
Apple Software without specific prior written 
permission from Apple.  Except as expressly 
stated in this notice, no other rights or 
licenses, express or implied, are granted by 
Apple herein, including but not limited to any 
patent rights that may be infringed by your 
derivative works or by other works in which the 
Apple Software may be incorporated.

The Apple Software is provided by Apple on an &quot;AS 
IS&quot; basis.  APPLE MAKES NO WARRANTIES, EXPRESS OR 
IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED 
WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY 
AND FITNESS FOR A PARTICULAR PURPOSE, REGARDING 
THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE 
OR IN COMBINATION WITH YOUR PRODUCTS.

IN NO EVENT SHALL APPLE BE LIABLE FOR ANY 
SPECIAL, INDIRECT, INCIDENTAL OR CONSEQUENTIAL 
DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS 
OF USE, DATA, OR PROFITS; OR BUSINESS 
INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, 
REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION OF 
THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER 
UNDER THEORY OF CONTRACT, TORT (INCLUDING 
NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN 
IF APPLE HAS BEEN ADVISED OF THE POSSIBILITY OF 
SUCH DAMAGE.
*/


#import &quot;Controller.h&quot;


@implementation Controller


  /* tell the compiler to synthasize the property accessors
  for our instance variables. */
  
@synthesize workflows, runningWorkflow;



  /* display the selected workflow. */
- (BOOL)displaySelectedWorkflow {

    /* get the selected row from the workflow table. */
  NSUInteger theRow = [workflowTable selectedRow];

    /* if there is a selection and we are not running
    the selected workflow, then we can display the
    workflow selected in the list. */
  if ( theRow != -1 &amp;&amp; ! self.runningWorkflow ) {
  
      /* retrieve the first item in the selection */
    NSDictionary* selectedEntry = [[tableContent arrangedObjects] objectAtIndex: theRow];
  
      /* retrieve the selected application from our list of applications. */
    AMWorkflow* selectedWorkflow =
      (AMWorkflow*) [selectedEntry objectForKey:@&quot;workflow&quot;];

      /* ask the AMWorkflowController to display the selected workflow */
    [workflowController setWorkflow: selectedWorkflow];
      
      /* set the window title */
    [myWindow setTitle: (NSString*) [selectedEntry objectForKey:@&quot;name&quot;]];

    return YES;
    
  } else {
  
    return NO;
    
  }
}


  /* awakeFromNib is called after our MainMenu.nib file has been loaded
  and the main window is ready for use.  Here, we finish initializing
  our content for display in the window.  */
- (void)awakeFromNib {
  
    /* we're only using the AMWorkflowView for display */
  [workflowView setEditable: NO];  

    /* set up the data for NSTableView.  We'll store a list of
    NSDictonary records each containing some information about the
    workflow.  We'll display the name of the workflow's file in the
    window.  */
    
    /* set up an array for storing the table information */
  NSMutableArray *theWorkflows = [[[NSMutableArray alloc] initWithCapacity:20] autorelease];
  
    /* retrieve a list of all of the workflows stored in the application's
    resourced folder. */
  NSArray *workflowPaths = [[NSBundle mainBundle]
    pathsForResourcesOfType:@&quot;workflow&quot; inDirectory:@&quot;workflows&quot;];
    
    /* iterate through the paths, adding them to our table information
    as we go.  */
  for ( NSString* nthWorkflowPath in workflowPaths ) {
    NSError *wfError = nil;
    
      /* convert the path into an URL */
    NSURL* nthWorkflowURL = [NSURL fileURLWithPath:nthWorkflowPath isDirectory:NO];

      /* allocate and initialize the workflow */
    AMWorkflow* nthWorkflow = [[AMWorkflow alloc]
      initWithContentsOfURL:nthWorkflowURL error: &amp;wfError];

    if ( nthWorkflow ) {
    
        /* calculate the file name without path or extension */
      NSString* nthFileName = [[nthWorkflowPath componentsSeparatedByString:@&quot;/&quot;] lastObject];
      NSString* nthDisplayName = [nthFileName substringToIndex:([nthFileName length] - 9)];

        /* add the workflow to the list */
      [theWorkflows addObject:
        [NSDictionary dictionaryWithObjectsAndKeys:
          nthDisplayName, @&quot;name&quot;, /* name displayed in list */
          nthWorkflowPath, @&quot;path&quot;, /* complete path to the bundle */
          nthWorkflow, @&quot;workflow&quot;, /* initialized AMWorkflow */
          nil]];
    }
  }
  
    /* set the workflows */
  self.workflows = theWorkflows;

    /* if there are any workflows in the list, then select and display the first one */
  if ([self.workflows count] &gt; 0 ) {
    [workflowTable selectRowIndexes:
        [NSIndexSet indexSetWithIndex:0] byExtendingSelection:NO];
    [self displaySelectedWorkflow];
  }

}



  /* NSApplication delegate method - for convenience. We have set the
  File's Owner's delegate to our Controller object in the MainMenu.nib file. */
- (BOOL)applicationShouldTerminateAfterLastWindowClosed:(NSApplication *)sender {
  return YES;
}






  /* NSTableView delegate methods.
  We have set our controller object as the NSTableView's delegate in the MainMenu.nib file.  */

  /* selectionShouldChangeInTableView: is called when the user has clicked in the
  table view in a way that will cause the selection to change.  This method allows us
  to decide if we would like to allow the selection to change and the response
  we return depends on if we are running a selection - we don't allow the selection
  to change while a workflow is running. */ 
- (BOOL)selectionShouldChangeInTableView:(NSTableView *)tableView {

    /* if the current selected workflow is running, don't change the selection. */
  if ( self.runningWorkflow ) {
  
      /* display an alert explaining why the selection cannot be changed. */
      
      /* get the name of the action that is running now. */
    NSString* selectedWorkflow =
      (NSString*) [(NSDictionary*)
        [[tableContent arrangedObjects] objectAtIndex: [workflowTable selectedRow]] objectForKey:@&quot;name&quot;];
        
      /* display a modal sheet explaining why the selection cannot be changed. */
    NSBeginInformationalAlertSheet(
        [NSString stringWithFormat:@&quot;The '%@' action is running.&quot;, selectedWorkflow],
        @&quot;OK&quot;, nil, nil, myWindow, nil, nil, nil, nil,
        [NSString stringWithFormat:
          @&quot;You cannot select another action until the '%@' action has finished running.&quot;,
          selectedWorkflow]
      );
  }
  
    /* return true only if we are not in the middle of running an action. */
  return ! self.runningWorkflow;
}

  /* tableViewSelectionIsChanging: is called after the selection has changed.  All there
  is to do here is update the workflow displayed in the AMWorkflowView to show the newly
  selected workflow. */
- (void)tableViewSelectionIsChanging:(NSNotification *)aNotification {
  [self displaySelectedWorkflow];
}





  /* AMWorkflowController delegate methods.  In these routines we adjust the
  value of our runningWorkflow property.  Key value bindings to this property
  defined in our interface file take care of enabling/disabling the run/stop buttons,
  and displaying the progress bar. */
  
- (void)workflowControllerWillRun:(AMWorkflowController *)controller {
  self.runningWorkflow = YES;
}


- (void)workflowControllerDidRun:(AMWorkflowController *)controller {
  self.runningWorkflow = NO;
}


- (void)workflowControllerDidStop:(AMWorkflowController *)controller {
  self.runningWorkflow = NO;
}


@end


</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/AutoSample/listing2.html%3Fid%3DDTS10004313-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/AutoSample/listing2.html%3Fid%3DDTS10004313-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/AutoSample/listing2.html%3Fid%3DDTS10004313-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>