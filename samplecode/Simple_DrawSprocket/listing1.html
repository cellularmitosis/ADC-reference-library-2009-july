<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Simple DrawSprocket - /Simple DrawSprocket Main.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Simple DrawSprocket</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxGraphicsImaging-date.html" target="_blank">Carbon > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Simple DrawSprocket</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Simple DrawSprocket Main.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Simple DrawSprocket Main.c</option></select>
				</p>
				</form>
				<p><strong><a href="Simple_DrawSprocket.zip">Download Sample</a></strong> (&#147;Simple_DrawSprocket.zip&#148;, 34.2K)<BR>
<strong><a href="Simple_DrawSprocket.dmg">Download Sample</a></strong> (&#147;Simple_DrawSprocket.dmg&#148;, 95.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    Simple DrawSprocket Main.c  Contains:  Template for standard Macintosh Application using DrawSprocket        Cmd-Q to exit.  Written by:  Geoff Stahl (ggs)  Copyright:  Copyright (c) 1999 Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.*/// Building with DrawSprocket 1.7//#define kDSp17 1// system includes ----------------------------------------------------------#include &lt;MacMemory.h&gt;#include &lt;Events.h&gt;#include &lt;Fonts.h&gt;#include &lt;Windows.h&gt;#include &lt;TextEdit.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Sound.h&gt;#include &lt;SoundInput.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;OSUtils.h&gt;#include &lt;Devices.h&gt;#include &lt;Resources.h&gt;#include &lt;Folders.h&gt;#include &lt;DrawSprocket.h&gt;#include &lt;stdio.h&gt;// project includes ---------------------------------------------------------// function declarations ----------------------------------------------------void InitToolbox(void);void GraphicsInitAttributes(DSpContextAttributes *inAttributes);Boolean SetUp (void);void DoMenu (SInt32 menuResult);void DoKey (SInt8 theKey, SInt8 theCode);void DoUpdate (void);void CToPStr (register const char *inString, Str255 * outString );void DoEvent (void);void CleanUp (void);// statics/globals (internal only) ------------------------------------------// Menu defsenum {  kMenuApple = 128,  kMenuFile = 129,    kAppleAbout = 1,  kFileDoNothing = 1,  kFileQuit,    kActiveSleep = 0,    kInActiveSleep = 32767};NumVersion gVersionDSp;Boolean gDone = false;SInt32 gSleepTime = kActiveSleep;RGBColor grgbColor = {0x4000,0x6000,0x6000};DSpContextReference gTheContext;GDHandle ghGD;// functions (internal/private) ---------------------------------------------void InitToolbox (void){  MenuHandle menu;  SInt16 modifiers = 0;  EventRecord event;  short x;  for (x = 0; x &lt; 3; x++)    MoreMasters ();    MaxApplZone ();  InitGraf((Ptr) &amp;qd.thePort);  InitFonts();  InitWindows();  InitMenus();  TEInit();  InitDialogs(nil);  InitCursor();    qd.randSeed =  TickCount();  // init events  EventAvail(everyEvent, &amp;event);  modifiers |= event.modifiers;  EventAvail(everyEvent, &amp;event);  modifiers |= event.modifiers;  EventAvail(everyEvent, &amp;event);  modifiers |= event.modifiers;  // Init Menus  menu = NewMenu (kMenuApple, &quot;\p\024&quot;);      // new  apple menu  InsertMenu (menu, 0);              // add menu to end  AppendResMenu(menu, 'DRVR');    menu = NewMenu (kMenuFile, &quot;\pFile&quot;);      // new menu  InsertMenu (menu, 0);              // add menu to end  AppendMenu (menu, &quot;\pDo Nothing;Quit/Q&quot;); // add items    DrawMenuBar();} // --------------------------------------------------------------------------void GraphicsInitAttributes(DSpContextAttributes *inAttributes){  BlockZero (inAttributes, sizeof (DSpContextAttributes));}// --------------------------------------------------------------------------Boolean SetUp (void){  OSErr err = noErr;  DSpContextAttributes theAttributes;  DisplayIDType displayID;    InitToolbox ();    // Do DrawSprocket Setup    if ((Ptr) kUnresolvedCFragSymbolAddress == (Ptr) DSpStartup)  {    DebugStr(&quot;\pDSp extension not loaded\n&quot;);    return false;  }  if (noErr != DSpStartup ())  {    DebugStr(&quot;\pUnable to startup DSp\n&quot;);    return false;  }      // Find DSp version (just to show how)#ifdef kDSp17  if ((Ptr) kUnresolvedCFragSymbolAddress == (Ptr) DSpGetVersion) #endif  {    // must be 1.1.4 or earlier so look at extension    short resFileSave, resFileDSp;    short vRefDSp;    long dirIDDSp;    FSSpec fsSpecDSp;    OSErr err;    Handle hVersion;        // assume 1.0 version to start with (worst case)    gVersionDSp.majorRev = 1;    gVersionDSp.minorAndBugRev = 0;    gVersionDSp.stage = 0x80;    gVersionDSp.nonRelRev = 0;    resFileSave = CurResFile();    SetResLoad (false);    // search application directory for debug lib    resFileDSp = OpenResFile (&quot;\pDrawSprocketDebugLib&quot;);    err = ResError ();    if (fnfErr == err)    {      // search application directory for lib      resFileDSp = OpenResFile (&quot;\pDrawSprocketLib&quot;);      err = ResError ();      if (fnfErr == err)      {        // search extensions folder for debug lib        FindFolder (kOnSystemDisk, kExtensionFolderType, kDontCreateFolder, &amp;vRefDSp, &amp;dirIDDSp);        FSMakeFSSpec (vRefDSp, dirIDDSp, &quot;\pDrawSprocketLib&quot;, &amp;fsSpecDSp);        resFileDSp = FSpOpenResFile (&amp;fsSpecDSp, fsRdPerm);        err = ResError ();        if (fnfErr == err)        {          // search extensions folder directory for lib          FSMakeFSSpec (vRefDSp, dirIDDSp, &quot;\pDrawSprocketDebugLib&quot;, &amp;fsSpecDSp);          resFileDSp = FSpOpenResFile (&amp;fsSpecDSp, fsRdPerm);          err = ResError ();        }      }    }    // if we have an open resource file and no error    if ((noErr == err) &amp;&amp; (-1 != resFileDSp))    {      SetResLoad (true);      hVersion = GetResource ('vers', 1);       err = ResError ();      if ((noErr == err) &amp;&amp; (NULL != hVersion))      {        gVersionDSp.majorRev = *(((unsigned char *)*hVersion) + 0);        gVersionDSp.minorAndBugRev = *(((unsigned char *)*hVersion) + 1);        gVersionDSp.stage = *(((unsigned char *)*hVersion) + 2);        gVersionDSp.nonRelRev = *(((unsigned char *)*hVersion) + 3);        ReleaseResource (hVersion);      }      UseResFile(resFileSave);      CloseResFile(resFileDSp);    }    }#ifdef kDSp17  else    gVersionDSp = DSpGetVersion ();#endif  GraphicsInitAttributes (&amp;theAttributes);    theAttributes.displayWidth      = 640;  theAttributes.displayHeight      = 480;  theAttributes.colorNeeds      = kDSpColorNeeds_Require;  theAttributes.displayDepthMask    = kDSpDepthMask_8;  theAttributes.displayBestDepth    = 8;  theAttributes.backBufferDepthMask  = kDSpDepthMask_All;      // must be specified even if only fornt buffer is needed  theAttributes.backBufferBestDepth  = 8;  theAttributes.pageCount        = 1;              // only the front buffer is needed  // use two above if you want to swap buffers to animate    // will display user dialog if context selection is required otherwise as find best context  err = DSpUserSelectContext(&amp;theAttributes, 0L, nil, &amp;gTheContext);  if (noErr != err)  {    DebugStr(&quot;\pA suitable display context could not be found.&quot;);    return false;  }  DSpSetBlankingColor(&amp;grgbColor);    // get our device for future use  err =  DSpContext_GetDisplayID (gTheContext, &amp;displayID);  if (noErr != err)  {    DebugStr(&quot;\pDSpContext_GetDisplayID () had an error.&quot;);    return false;  }  // get GDHandle for ID'd device  err = DMGetGDeviceByDisplayID (displayID, &amp;ghGD, false);  if (noErr != err)  {    DebugStr(&quot;\pDMGetGDeviceByDisplayID() had an error.&quot;);    return false;  }    // reserve our context  err = DSpContext_Reserve (gTheContext, &amp;theAttributes);  if (noErr != err)  {    DebugStr(&quot;\pUnable to create the display!&quot;);    return false;  }  HideCursor();  err = DSpContext_FadeGammaOut (NULL, NULL);          // remove for debug  if (noErr != err)    DebugStr(&quot;\pUnable to fade the display!&quot;);  // activate our context  err = DSpContext_SetState (gTheContext, kDSpContextState_Active);  if (noErr != err)  {    DSpContext_FadeGammaIn (NULL, NULL);      DebugStr(&quot;\pUnable to set the display!&quot;);    return false;  }      err = DSpContext_FadeGammaIn (NULL, NULL);    if(noErr != err)    DebugStr(&quot;\pUnable to fade the display!&quot;);  return true;}// --------------------------------------------------------------------------void DoMenu (SInt32 menuResult){  SInt16 theMenu;  SInt16 theItem;  Str255 daName;  MenuRef theMenuHandle;      theMenu = HiWord(menuResult);  theItem = LoWord(menuResult);  theMenuHandle = GetMenuHandle(theMenu);  switch (theMenu)  {    case kMenuApple:      switch (theItem)      {        case kAppleAbout:          break;        default:          OpenDeskAcc(daName);          break;      }      break;    case kMenuFile:      switch (theItem)      {        case kFileDoNothing:          break;        case kFileQuit:          gDone = true;          break;      }      break;  }  HiliteMenu(0);  DrawMenuBar();}// --------------------------------------------------------------------------void DoKey (SInt8 theKey, SInt8 theCode){  #pragma unused (theKey, theCode)}//---------------------------------------------------------------------------// Copy C string to Pascal stringvoid CToPStr (register const char *inString, Str255 * outString )    // copies in to out{    register unsigned char x = 0;  do  {    *(((char*)outString) + 1 + x) = *(inString + x);    x++;  }  while ((*(inString + x) != 0)  &amp;&amp; (x &lt; 256));  *((char*)outString) = (char) x;                  }// --------------------------------------------------------------------------void DoUpdate (void){  OSStatus err;  CGrafPtr pCGrafFrontBuffer, pCGrafSave = NULL;  GDHandle hGDSave;  RGBColor rgbSave, rgbRed = {0x7FFF, 0x0000, 0x0000}, rgbWhite = {0xFFFF, 0xFFFF, 0xFFFF};  short fNum, len;  Str255 aStr = &quot;\p&quot;;  char aChar[256];  err = DSpContext_GetFrontBuffer (gTheContext, &amp;pCGrafFrontBuffer);    if (err != noErr)  {    DebugStr(&quot;\pUnable to get front buffer&quot;);    return;  }      GetGWorld (&amp;pCGrafSave, &amp;hGDSave);  SetGWorld (pCGrafFrontBuffer, ghGD);  GetForeColor (&amp;rgbSave);    // draw here  RGBForeColor (&amp;rgbRed);  PaintRect (&amp;pCGrafFrontBuffer-&gt;portRect);  RGBForeColor (&amp;rgbWhite);  // set text  GetFNum(&quot;\pGeneva&quot;, &amp;fNum);  TextFont(fNum);  TextSize(12);    // draw centered to screen  sprintf (aChar, &quot;%d x %d&quot;, pCGrafFrontBuffer-&gt;portRect.right - pCGrafFrontBuffer-&gt;portRect.left, pCGrafFrontBuffer-&gt;portRect.bottom - pCGrafFrontBuffer-&gt;portRect.top);  CToPStr (aChar, &amp;aStr);  len = StringWidth (aStr);   MoveTo ((short) (pCGrafFrontBuffer-&gt;portRect.left + (pCGrafFrontBuffer-&gt;portRect.right - pCGrafFrontBuffer-&gt;portRect.left) / 2 - (len / 2)), 18);  DrawString(aStr);    RGBForeColor (&amp;rgbSave);  SetGWorld (pCGrafSave, hGDSave);/*    OSErr err;  CGrafPtr pCGrafFrontBuffer, pCGrafSave = NULL;  GDHandle hGD = NULL;  RGBColor rgbRed = {0x7FFF, 0x0000, 0x0000};  err = DSpContext_GetFrontBuffer (gTheContext, &amp;pCGrafFrontBuffer);    if (noErr != err)    DebugStr(&quot;\pUnable to get front buffer&quot;);          GetGWorld (&amp;pCGrafSave, &amp;hGD);  SetGWorld (pCGrafFrontBuffer, ghGD);    // draw here  RGBForeColor (&amp;rgbRed);  MoveTo (0, 0);  LineTo (640, 480);  MoveTo (640, 0);  LineTo (0, 480);    SetGWorld (pCGrafSave, hGD);*/}// --------------------------------------------------------------------------void DoEvent (void){  OSErr err = noErr;  EventRecord theEvent;  SInt16 whatPart;  SInt32 menuResult;  WindowRef whichWindow;  SInt8 theKey;  SInt8 theCode;  Boolean fProcessed = false;    if (WaitNextEvent(everyEvent, &amp;theEvent, gSleepTime, NULL))  {    DSpProcessEvent(&amp;theEvent, &amp;fProcessed);    if (false == fProcessed)    {      switch (theEvent.what)      {        case mouseDown:          whatPart = FindWindow(theEvent.where, &amp;whichWindow);          switch (whatPart)          {            case inGoAway:              break;            case inMenuBar:              DrawMenuBar();              menuResult = MenuSelect(theEvent.where);              if (HiWord(menuResult) != 0)                DoMenu(menuResult);              break;            case inSysWindow:              SystemClick(&amp;theEvent, whichWindow);              break;          }          break;        case keyDown:        case autoKey:          theKey = theEvent.message &amp; charCodeMask;          theCode = (theEvent.message &amp; keyCodeMask) &gt;&gt; 8;          if ((theEvent.modifiers &amp; cmdKey) != 0)          {            menuResult = MenuKey(theKey);            if (HiWord(menuResult) != 0)              DoMenu (menuResult);          }          else            DoKey (theKey, theCode);          break;        case updateEvt:          BeginUpdate((WindowRef) theEvent.message);          DoUpdate();          EndUpdate((WindowRef) theEvent.message);          break;        case diskEvt:          break;        case osEvt:          if (0x01000000 &amp; theEvent.message)    //  Suspend/resume event          {            // need to handle DSp suspend resume events here            if (0x00000001 &amp; theEvent.message)  //  Resume            {              err = DSpContext_FadeGammaOut (NULL, NULL);          // remove for debug              if (noErr != err)                DebugStr(&quot;\pUnable to fade the display!&quot;);              // activate our context              err = DSpContext_SetState (gTheContext, kDSpContextState_Active);              if (noErr != err)                DebugStr(&quot;\pUnable to set the display!&quot;);                              err = DSpContext_FadeGammaIn (NULL, NULL);                if(noErr != err)                DebugStr(&quot;\pUnable to fade the display!&quot;);                              HideCursor ();              gSleepTime = kActiveSleep;            }            else  // suspend            {                err = DSpContext_FadeGammaOut (NULL, NULL);          // remove for debug              if (noErr != err)                DebugStr(&quot;\pUnable to fade the display!&quot;);              // pause our context              err = DSpContext_SetState (gTheContext, kDSpContextState_Paused);              if (noErr != err)                DebugStr(&quot;\pUnable to set the display!&quot;);                              err = DSpContext_FadeGammaIn (NULL, NULL);                if(noErr != err)                DebugStr(&quot;\pUnable to fade the display!&quot;);                            ShowCursor ();              gSleepTime = kInActiveSleep;            }          }          break;        case kHighLevelEvent:          AEProcessAppleEvent(&amp;theEvent);          break;      }    } // if DSp  }  else  {    // idle tasks  }}// --------------------------------------------------------------------------void CleanUp (void){  OSErr err = noErr;  err = DSpContext_FadeGammaOut (NULL, NULL);          // remove for debug  if (noErr != err)    DebugStr(&quot;\pUnable to fade the display!&quot;);  err = DSpContext_SetState (gTheContext, kDSpContextState_Inactive);  if (noErr != err)    DebugStr(&quot;\pUnable to set the display!&quot;);      err = DSpContext_FadeGammaIn (NULL, NULL);    if(noErr != err)    DebugStr(&quot;\pUnable to fade the display!&quot;);      ShowCursor ();  err = DSpContext_Release (gTheContext);  if (noErr != err)     DebugStr (&quot;\pDSpContext_Release error&quot;);      err = DSpShutdown ();  if (noErr != err)     DebugStr (&quot;\pDSpShutdown error&quot;);}// --------------------------------------------------------------------------int main (void){  if (SetUp ())  {    DoUpdate ();    while (!gDone)     {      DoEvent ();    }  }  CleanUp ();  return 0;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Simple_DrawSprocket/listing1.html%3Fid%3DDTS10000169-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Simple_DrawSprocket/listing1.html%3Fid%3DDTS10000169-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Simple_DrawSprocket/listing1.html%3Fid%3DDTS10000169-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>