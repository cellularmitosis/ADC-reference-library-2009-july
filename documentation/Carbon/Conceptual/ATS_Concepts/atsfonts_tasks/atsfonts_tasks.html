<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Apple Type Services for Fonts Programming Guide: Managing Fonts: ATS Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Managing Fonts: ATS Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000110" title="Managing Fonts: ATS Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../atsfonts_intro/atsfonts_intro.html#//apple_ref/doc/uid/TP30000108-DontLinkElementID_15">Apple Type Services for Fonts Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsfonts_concepts/atsfonts_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsfonts_revhistory/atsfonts_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000110-SW2" title="Managing Fonts: ATS Tasks"></a><h1>Managing Fonts: ATS Tasks</h1><p>This chapter provides sample code and instructions for most of the programming tasks you can accomplish with ATS for Fonts. It also provides guidelines that you can follow to increase performance and make efficient use of memory in your application. You’ll find details in this chapter about the following tasks:</p><ul class="ul"><li class="li"><p>Enumerating fonts and font families. You can restrict an enumeration by providing a filter, a context, and/or a scope.</p></li><li class="li"><p>Activating and deactivating fonts. You can activate and deactivate fonts that are under the control of your application.</p></li><li class="li"><p>Subscribing to notifications. Notifications allow your application to track changes in the font database, which is more efficient than polling for them.</p></li><li class="li"><p>Notifying ATS of fonts your application activates or deactivates. The system can then make these fonts available (or unavailable) to other applications.</p></li><li class="li"><p>Handling font queries. Font utility applications use the ATS query mechanism to provide fonts to other applications that need them.</p></li><li class="li"><p>Supporting a Fonts panel. The Fonts panel is the preferred user interface for fonts in Mac OS X.</p></li><li class="li"><p>Storing font information in a document. If your application stores the appropriate font information, it can retrieve the information whenever the document is opened.</p></li><li class="li"><p>Obtaining font metrics. ATS for Fonts lets you obtain the most common font metrics, such as ascent, descent, and leading.</p></li><li class="li"><p>Migrating data types from the Font Manager. You can convert Font Manger data types to ones that are compatible with ATS for Fonts.</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-DontLinkElementID_6">Guidelines for Using ATS for Fonts</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW4">Enumerating Font Families and Fonts</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW29">Activating and Deactivating Fonts</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW5">Setting Up Notifications</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW14">Notifying ATS for Fonts of Actions</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW30">Handling Font Queries</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW3">Providing a Fonts Panel in a Carbon Application</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-DontLinkElementID_9">Storing Font Information in a Document</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-DontLinkElementID_10">Getting Font Metrics</a>
				
			<br/>
			
        
			
			
				<a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-DontLinkElementID_11">Migrating Data Types from the Font Manager</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_6" title="Guidelines for Using ATS for Fonts"></a><h2>Guidelines for Using ATS for Fonts</h2><p>There are a number of guidelines you should follow to assure optimal performance and efficient memory use when you use ATS for Fonts. This section summarizes them. The code in this chapter shows you how to apply most of the following guidelines: </p><ul class="ul"><li class="li"><p>Restrict an iteration to the fonts or font families for which your application needs information. If you need to gather information about all the installed fonts, you should do so once and then cache the results because iterating over all fonts can degrade performance. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW4">“Enumerating Font Families and Fonts”</a></span> for more information.</p></li><li class="li"><p>Implement the Fonts panel instead of the Font menu. Applications that run in Mac OS X should have a consistent user interface. The Fonts panel, formerly available only to Cocoa applications, is now available to Carbon applications in Mac OS X. To be consistent with Cocoa applications, Carbon applications should provide a Fonts panel. You should only provide a Font menu if your application runs in Mac OS 9. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW3">“Providing a Fonts Panel in a Carbon Application”</a></span> for more information. </p></li></ul><ul class="ul"><li class="li"><p>Set up notifications to keep informed of changes in the font database. This lets you avoid querying the generation seed in the font database to track changes. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW5">“Setting Up Notifications”</a></span> for more information.</p></li><li class="li"><p>Avoid iterating through font tables if you can obtain the desired information by using a high-level function. For example, if you need to obtain a font name, use the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontFamilyGetQuickDrawName" target="_top">ATSFontFamilyGetQuickDrawName</a></code>.</p></li><li class="li"><p>Assess your application’s performance by running such tools as tops or ThreadViewer. These tools can help you to gauge how often your code triggers ATS server messaging and other behavior. You can use that information t to optimize your code. </p></li></ul><a name="//apple_ref/doc/uid/TP30000110-SW4" title="Enumerating Font Families and Fonts"></a><h2>Enumerating Font Families and Fonts</h2><p>ATS for Fonts provides several functions you can use to enumerate the fonts and font families available in Mac OS X. You can enumerate fonts and font families in the following ways:</p><ul class="ul"><li class="li"><p>Create an iterator and then use the iterator from within a loop to enumerate fonts or font families. Provide your code in the loop to process the enumerated fonts or font families appropriately. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW6">“Enumerating Font Families From Within a Loop”</a></span> and <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW7">“Enumerating Fonts From Within a Loop”</a></span> for more information.</p></li><li class="li"><p>Write a customized function that can process each enumerated font or font family appropriately. Let ATS for Fonts automatically iterate through fonts or font families and apply your customized function for you. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW8">“Enumerating Using an Applier Function”</a></span> for more information.</p></li></ul><p>Regardless of which method you choose to enumerate fonts or font families, an enumeration is restricted by the context, filter, and scoping options applied to it. </p><p><strong>Context</strong> refers to the font’s accessibility and can be local or global. A font whose context is local can be accessed by your application. A font whose context is global can be accessed by all applications on a system.</p><p>A <strong>filter</strong> consists of one or more restrictions that you define to reduce the number fonts or font families returned during an iteration. For example, you could restrict a font iteration to all those fonts that have the same manufacturer’s name.</p><p><strong>Scope</strong> refers to whether a font’s use is restricted or unrestricted. Fonts with a restricted scope can be used only by your application whereas fonts with an unrestricted scope can be used by any application.</p><p>When you specify both a context and a scope, the enumeration is constrained as shown in <span class="content_text">Table 2-1</span>.</p><a name="//apple_ref/doc/uid/TP30000110-SW27" title="Table 2-1The interaction of context and scope in an enumeration"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>The interaction of context and scope in an enumeration</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Local context</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Global context</p></th></tr><tr><td  scope="row"><p>Restricted scope</p></td><td ><p>Fonts activated locally to your application</p></td><td ><p>Only globally activated fonts</p></td></tr><tr><td  scope="row"><p>Unrestricted scope</p></td><td ><p>Globally activated fonts and fonts activated locally to your application. This is the default.</p></td><td ><p>All fonts, which include globally activated fonts and all other fonts activated locally for an application. Font utilities typically need to know all fonts on the system.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000110-SW6" title="Enumerating Font Families From Within a Loop"></a><h3>Enumerating Font Families From Within a Loop</h3><p><span class="content_text">Listing 2-1</span> shows code that creates an iterator to enumerate all the font families in an application’s context. Your application would need to add code that does something with the fonts it retrieves. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW9" title="Listing 2-1Enumerating font families"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Enumerating font families</p><div class="codesample"><table><tr><td scope="row"><pre>status = ATSFontFamilyIteratorCreate ( <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                        kATSFontContextLocal, <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myFontFilter <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myRefConData <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                        kATSOptionFlagsUnRestrictedScope, <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myFamilyIterator);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        status = ATSFontFamilyIteratorNext (&amp;myFamilyIterator,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myFamilyRef); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Add your code here to do something with font family information.<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else if (status == kATSIterationScopeModified) <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = ATSFontFamilyIteratorReset (<span></span></pre></td></tr><tr><td scope="row"><pre>                            kATSFontContextLocal,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontFilter<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myRefConData<span></span></pre></td></tr><tr><td scope="row"><pre>                            kATSOptionFlagsUnrestrictedScope,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFamilyIterator);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Add your code here to take any actions needed because of the<span></span></pre></td></tr><tr><td scope="row"><pre>            // reset operation.<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>status = ATSFontFamilyIteratorRelease (&amp;myFamilyIterator); <span>// 8</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontFamilyIteratorCreate" target="_top">ATSFontFamilyIteratorCreate</a></code> to create the iterator you use to enumerate font families.</p></li><li class="li"><p>Sets up a local context. If you want to set up a global context. use the constant <code>kATSFontContextGlobal</code>.</p></li><li class="li"><p>Passes a pointer to an ATS font filter. This is optional. If you do not want to apply a filter to the iteration, pass <code>NULL</code>. The ATS font filter data structure lets you specify a generation, a font family, or a callback function as a filter.</p></li><li class="li"><p>Passes a pointer to data needed by a font filter callback function. Pass <code>NULL</code> if you aren’t using a font filter callback or if the callback doesn’t require any data passed to it.</p></li><li class="li"><p>Sets up an unrestricted scope. If you want to set up a restricted scope, use the constant <code>kATSOptionFlagsRestrictedScope</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_17" title="Note"></a><p><strong>Note:</strong>&nbsp;When you iterate using a local context and an unrestricted scope, you enumerate the default font families. This includes all globally activated font families and those activated locally to your application.</p></div></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontFamilyIteratorNext" target="_top">ATSFontFamilyIteratorNext</a></code> to obtain the next font family in the iteration.</p></li><li class="li"><p>Checks to make sure the font database hasn’t been changed. If it has, resets the iterator to the start of the iteration. The result code <code>kATSIterationScopeModified</code> indicates one or more changes occurred in the font database since you started the iteration. In most cases, you should reset the iterator.</p></li><li class="li"><p>Releases the font family iterator. You must do this when you no longer need the iterator. If you plan to use the iterator again in your application, you can reset it rather than release it.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW7" title="Enumerating Fonts From Within a Loop"></a><h3>Enumerating Fonts From Within a Loop</h3><p><span class="content_text">Listing 2-2</span> shows code that creates an iterator to enumerate all the fonts in an application’s context. Your application would need to add code that does something with the fonts it retrieves. Error-handling code has been omitted to make the sample function more readable. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW10" title="Listing 2-2Creating an iterator"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Creating an iterator</p><div class="codesample"><table><tr><td scope="row"><pre>status = ATSFontIteratorCreate ( <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                kATSFontContextGlobal,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                &amp;myFilter,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                &amp;myRefConData,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                kATSOptionFlagsRestrictedScope,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                &amp;FontIterator);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        status = ATSFontIteratorNext (&amp;myFontIterator,&amp;myFontRef)<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        if (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Add your code here to do something with font information.<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else if (status == kATSIterationScopeModified)<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = ATSFontIteratorReset (<span></span></pre></td></tr><tr><td scope="row"><pre>                            kATSFontContextGlobal,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontFilter<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myRefConData<span></span></pre></td></tr><tr><td scope="row"><pre>                            kATSOptionFlagsRestrictedScope,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontIterator);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Add your code here to take any actions needed because of the<span></span></pre></td></tr><tr><td scope="row"><pre>            // reset operation.<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>status = ATSFontIteratorRelease (&amp;myFontIterator);<span>// 8</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontIteratorCreate" target="_top">ATSFontIteratorCreate</a></code> to create the iterator you use to enumerate fonts.</p></li><li class="li"><p>Sets up a global context. If you want to set up a local context. use the constant <code>kATSFontContextLocal</code>.</p></li><li class="li"><p>Passes a pointer to an ATS font filter. This is optional. If you do not want to apply a filter to the iteration, pass <code>NULL</code>. The ATS font filter data structure lets you specify a generation, a font family, or a callback function as a filter.</p></li><li class="li"><p>Passes a pointer to data needed by a font filter callback function. Pass <code>NULL</code> if you aren’t using a font filter callback or if the callback doesn’t require any data passed to it.</p></li><li class="li"><p>Sets up a restricted scope. If you want to set up an unrestricted scope, use the constant <code>kATSOptionFlagsUnrestrictedScope</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_18" title="Note"></a><p><strong>Note:</strong>&nbsp;When you iterate using a global context and a restricted scope, you enumerate only those fonts that are activated globally. Locally activated fonts, including those activated locally for your application, are not enumerated.</p></div></li><li class="li"><p>Calls the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontIteratorNext" target="_top">ATSFontIteratorNext</a></code> to obtain the next font in the iteration.</p></li><li class="li"><p>Checks to make sure the font database hasn’t been changed. If it has, resets the iterator to the start of the iteration. The result code <code>kATSIterationScopeModified</code> indicates one or more changes occurred in the font database since you started the iteration. In most cases, you should reset the iterator.</p></li><li class="li"><p>Releases the font iterator. You must do this when you no longer need the iterator. If you plan to use the iterator again in your application, you can reset it rather than release it.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW8" title="Enumerating Using an Applier Function"></a><h3>Enumerating Using an Applier Function</h3><p>If you want to enumerate fonts or font families that are activated locally and have an unrestricted scope, you can call the function <code>ATSFontApplyFunction</code>. This function applies the custom function you supply to each item in an enumeration. By using <code>ATSFontApplyFunction</code>, you can avoid writing a loop to iterate and process each font or font family in an enumeration. </p><p>The function <code>ATSFontFamilyApplyFunction</code> iterates only through default fonts or font families. The default includes globally activated fonts or font families and fonts or font families that are activated locally to your application. You can’t specify any other context or scope options.</p><p>The custom function you supply can perform any task appropriate to your application. <span class="content_text">Listing 2-3</span> shows a function that increments a counter for each valid font reference passed to the function. Your custom function can be as simple or complicated as needed.</p><a name="//apple_ref/doc/uid/TP30000110-SW11" title="Listing 2-3A function that counts font references"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>A function that counts font references</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyFontApplierFunction (ATSFontRef myFontRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            void* myFontRefCon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myFontRef)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        *(ItemCount*) myFontRefCon += 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        status = paramErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 2-4</span> shows a function that supplies the custom function from <span class="content_text">Listing 2-3</span> to the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontApplyFunction" target="_top">ATSFontApplyFunction</a></code>. </p><a name="//apple_ref/doc/uid/TP30000110-SW12" title="Listing 2-4A function that uses an applier function to enumerate fonts"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>A function that uses an applier function to enumerate fonts</p><div class="codesample"><table><tr><td scope="row"><pre>static OSStatus MyEnumerateFonts (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSFontApplyFunction (MyFontApplierFunction,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 &amp;myApplierRefCon);<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000110-SW29" title="Activating and Deactivating Fonts"></a><h2>Activating and Deactivating Fonts</h2><p>You can control which fonts are available to your users by activating and deactivating fonts. Fonts are activated and deactivated in groups defined by their representation in the file system in the file formats supported by ATS for fonts. Fonts must be in one of the formats listed in <span class="content_text"><a href="../atsfonts_concepts/atsfonts_concepts.html#//apple_ref/doc/uid/TP30000109-SW9">“Font Formats and File Types.”</a></span></p><p>There are two ATS for Fonts functions available to activate fonts:</p><ul class="ul"><li class="li"><p><code>ATSFontActivateFromFileReference</code>. This is the preferred function for you to use in Mac OS X v10.5 and later. In earlier versions of Mac OS X, you can use <code><a href="../../../Reference/ATS/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSFontActivateFromFileSpecification" target="_top">ATSFontActivateFromFileSpecification</a></code>.</p></li><li class="li"><p><code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontActivateFromMemory" target="_top">ATSFontActivateFromMemory</a></code>. You should use this function only when you have raw TrueType data that needs to be activated. </p></li></ul><p>You can deactivate any font you’ve activated with an ATS function by calling the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontDeactivate" target="_top">ATSFontDeactivate</a></code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_19" title="Note"></a><p><strong>Note:</strong>&nbsp; You should use caution if you deactivate a font that you activated globally because its deactivation impacts any application that uses that font.</p></div><p>When you activate a font, you can specify a local or global context. A font whose context is local can be accessed by the local user. This includes fonts available only to the local user as well as those that can be accessed by all users on a system. A font whose context is global is one that can be accessed by all users on a system. If you do not specify a context, ATS for Fonts uses a local context by default.</p><p>In Mac OS X, font data should be stored in the data fork. If you have a font in which the data is stored in the resource fork, you can activate this font by supplying the constant <code>kATSOptionFlagsUseDataForkAsResourceFork</code> in the <code>iOptions</code> parameter of one of the ATS font activation functions. </p><p><span class="content_text">Listing 2-5</span> shows how to activate a font from a file specification, and then deactivate the font. The font is activated locally. On output, the parameter <code>myFontcontainer</code> points to the activated font’s container. You need the font container to deactivate the font, as shown in the listing. A detailed explanation for each numbered line of code appears following the listing.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_20" title="Note"></a><p><strong>Note:</strong>&nbsp;You should use <code>ATSFontActivateFromFileSpecification</code> only in Mac OS X v10.4 and earlier. In Mac OS X v10.5 and later, this function is deprecated, so you should instead use <code>ATSFontActivateFromFileReference</code>.</p></div><a name="//apple_ref/doc/uid/TP30000110-SW13" title="Listing 2-5Activating and deactivating a font in Mac OS X v10.4 and earlier"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Activating and deactivating a font in Mac OS X v10.4 and earlier</p><div class="codesample"><table><tr><td scope="row"><pre>status = ATSFontActivateFromFileSpecification (<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontFileSpec,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                            kATSFontContextLocal,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                            kATSFontFormatUnspecified,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                            NULL,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                            kATSOptionFlagsDefault,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontContainer);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = ATSFontDeactivate (myFontContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                        kATSOptionFlagsDefault);<span>// 8</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Passes the file specification for the font to be activated.</p></li><li class="li"><p>Specifies a local context. When you use this option, the activated font is accessible only from within your application. You could also specify a global context by passing the constant <code>kATSFontContextGlobal</code>.</p></li><li class="li"><p>Specifies a format identifier. You should pass <code>kATSFontFormatUnspecified</code> because the system automatically determines the format of the font.</p></li><li class="li"><p>Passes <code>NULL</code> because this parameter is reserved for future use.</p></li><li class="li"><p>Passes the default options flag. If you want to activate a font directory that contains subdirectories, you must pass the option <code>kATSOptionFlagsProcessSubdirectories</code>. There are a number of other flags available for you to pass, see <em>Apple Type Services for Fonts Reference</em> for details. </p></li><li class="li"><p>Passes a reference to a font container that on return points to the container that references the activated font. You need the font container to deactivate a font.</p></li><li class="li"><p>Passes <code>NULL</code> because this parameter is reserved for future use. </p></li><li class="li"><p>Passes the default options flag. If you plan to call this function a number of times to deactivate several fonts, you can pass <code>kATSOptionFlagsDoNotNotify</code>. Then, when you are done deactivating fonts, you can call the function <code>ATSFontNotify</code> to signal ATS for Fonts to notify other applications of the font deactivations. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW14">“Notifying ATS for Fonts of Actions”</a></span> for more information.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW5" title="Setting Up Notifications"></a><h2>Setting Up Notifications</h2><p>Notifications are messages you can receive from ATS for Fonts that inform you of changes to the font database. Available starting in Mac OS X 10.2, notifications provide an efficient way for your application to keep up-to-date on font activations and deactivations. </p><p>Notifications aren’t sent to you automatically. Your application must subscribe to them and must supply a callback function to handle any notification you receive. Once you sign up to receive notifications, you never need to check the generation of the font database to track changes. You also don’t need to iterate periodically through fonts and font families to check for changes. </p><p>You can set up notifications in your application by following these steps: </p><ol class="ol"><li class="li"><p>Create a callback to handle the notification. Your callback can update the user interface or perform other tasks as appropriate. Your callback should look similar to the following:</p><div class="codesample"><table><tr><td scope="row"><pre>static void MyNotificationCallback (ATSFontNotificationInfoRef Info,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    void * refCon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Your code to handle the notification<span></span></pre></td></tr><tr><td scope="row"><pre>    MyRefreshFontUserInterface (. . .);<span></span></pre></td></tr><tr><td scope="row"><pre>}   ]<span></span></pre></td></tr></table></div></li><li class="li"><p>Inform ATS for Fonts to send your application notifications by calling the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontNotificationSubscribe" target="_top">ATSFontNotificationSubscribe</a></code> and registering the callback you created as shown in the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>status = ATSFontNotificationSubscribe (<span></span></pre></td></tr><tr><td scope="row"><pre>                    MyNotificationCallback,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kATSFontNotifyOptionDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                    NULL, // iRefCon<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;notifyRef );<span></span></pre></td></tr></table></div><p>As of Mac OS X v10.4, the <code>iRefCon</code> parameter is an arbitrary 32-bit value specified by your application and that you want passed to your callback function. You can pass <code>NULL</code> if your callback does not need any data or if your application runs in an earlier version of Mac OS X.</p></li><li class="li"><p>When your application no longer needs to receive notifications, call the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontNotificationUnsubscribe" target="_top">ATSFontNotificationUnsubscribe</a></code>, as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>status = ATSFontNotificationUnsubscribe (notifyRef);<span></span></pre></td></tr></table></div><p>You must supply the notification reference you obtained when you subscribed to notifications.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_21" title="Note"></a><p><strong>Note:</strong>&nbsp;Subscriptions are cumulative. You must unsubscribe from each notification you subscribed to. Subscriptions are cleaned up automatically when your applications quits.</p></div><a name="//apple_ref/doc/uid/TP30000110-SW14" title="Notifying ATS for Fonts of Actions"></a><h2>Notifying ATS for Fonts of Actions</h2><p>If your application is a font utility or other application that manages fonts, you may need to notify ATS for Fonts of your actions by calling the function <code>ATSFontNotify</code>. Other applications can sign up to receive notifications of your actions by calling the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontNotificationSubscribe" target="_top">ATSFontNotificationSubscribe</a></code>. When you call the function <code>ATSFontNotify</code>, ATS for Fonts notifies all subscribers of your actions.</p><p>When you call the function <code>ATSFontNotify</code> you must supply a notification action (<code>ATSFontNotifyAction</code>). If your application activates or deactivates fonts, you should pass <code>kATSFontNotifyActionFontsChanged</code>. If your application makes changes to a font directory, you should pass the constant <code>kATSFontNotifyActionDirectoriesChanged</code>. You can also optionally supply a pointer to the data you want ATS for Fonts to pass to the applications who subscribe to notifications. You can pass <code>NULL</code> if there is no data associated with your action.</p><p>It’s best to call the function <code>ATSFontNotify</code> after your application makes a batch of changes rather than calling this function after each change you make. For example, if your application calls the functions <code><a href="../../../Reference/ATS/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSFontActivateFromFileSpecification" target="_top">ATSFontActivateFromFileSpecification</a></code> (Mac OS X v10.4 and earlier), <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontActivateFromFileReference" target="_top">ATSFontActivateFromFileReference</a></code> (Mac OS X v10.5 and later), or <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontDeactivate" target="_top">ATSFontDeactivate</a></code> multiple times to activate and deactivate fonts, you can set the <code>iOptions</code> parameter in these functions to <code>kATSOptionFlagsDoNotNotify</code> set. When you are done activating and deactivating fonts you can call the function <code>ATSFontNotify</code> with the <code>action</code> parameter set to <code>kATSFontNotifyActionFontsChanged</code>. Then ATS notifies all applications who subscribe to notifications of the changes you made.</p><a name="//apple_ref/doc/uid/TP30000110-SW30" title="Handling Font Queries"></a><h2>Handling Font Queries</h2><p>If your application is a font utility that activates and deactivates fonts, you can register with ATS for Fonts to handle font queries. <span class="content_text">Figure 2-1</span> shows the path of a font query. The application asks the ATS client for a font. The ATS client passes the request to any font utility that is registered to receive queries. When the font utility finds the font, it obtains the file specification of the font, and then activates the font using the appropriate ATS function calls. </p><p>The query, activation, and notification process is opaque to the application that needs the font. The font activation appears to happen automatically because the application needing the font is not required to do anything to activate the font. Font activation occurs behind the scenes, provided the font is available to be activated somewhere on the system.</p><br/><div><a name="//apple_ref/doc/uid/TP30000110-SW15" title="Figure 2-1Font queries and the ATS server"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Font queries and the ATS server</p><img src = "../art/fontquerycomm.gif" alt = "Font queries and the ATS server" width="242" height="175"></div><br/><p>You must do the following to set up your Carbon or Cocoa application to handle font queries:</p><ol class="ol"><li class="li"><p>Create a callback to handle any font queries sent to your application. Your callback should look similar to the following: </p><div class="codesample"><table><tr><td scope="row"><pre>CFPropertyListRef MyQueryCallback (ATSFontQueryMessageID msgID,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFPropertyListRef data,<span></span></pre></td></tr><tr><td scope="row"><pre>                    void * refCon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFPropertyListRef    reply = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (msgID)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kATSQueryActivateFontMessage:<span></span></pre></td></tr><tr><td scope="row"><pre>            // Your code to parse and handle the property list data<span></span></pre></td></tr><tr><td scope="row"><pre>            // passed from the query.<span></span></pre></td></tr><tr><td scope="row"><pre>            reply = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return reply;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW16">Listing 2-6</a></span> for an example of a function that parses and handles the property list data passed from the query. The property list data is passed in the form of a Core Foundation dictionary (<code>CFDictionary</code>).</p><p>This callback only handles the case of a font activation query. You would need to add cases for other types of queries should these be available in the future. Font activation queries should always return <code>NULL</code> as shown in this example. </p></li><li class="li"><p>Register for queries by calling the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSCreateFontQueryRunLoopSource" target="_top">ATSCreateFontQueryRunLoopSource</a></code> as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>CFRunLoopSourceRef source =<span></span></pre></td></tr><tr><td scope="row"><pre>            ATSCreateFontQueryRunLoopSource (0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    MyQueryCallback,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    NULL);<span></span></pre></td></tr></table></div><p>The function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSCreateFontQueryRunLoopSource" target="_top">ATSCreateFontQueryRunLoopSource</a></code> creates a Core Foundation run loop source reference (<code>CFRunLoopSourceRef</code>) to convey font queries from the ATS server to your font utility application</p></li><li class="li"><p>Add the run loop source you obtained from the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSCreateFontQueryRunLoopSource" target="_top">ATSCreateFontQueryRunLoopSource</a></code> by writing code similar to the following:</p><div class="codesample"><table><tr><td scope="row"><pre>CFRunLoopAddSource (CFRunLoopGetCurrent(),<span></span></pre></td></tr><tr><td scope="row"><pre>                    source,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kCFRunLoopDefaultMode);<span></span></pre></td></tr></table></div><p>The function <code><a href="../../../../CoreFoundation/Reference/CFRunLoopRef/Reference/reference.html#//apple_ref/doc/c_ref/CFRunLoopGetCurrent" target="_top">CFRunLoopGetCurrent</a></code> returns the run loop for the current thread. The function <code><a href="../../../../CoreFoundation/Reference/CFRunLoopRef/Reference/reference.html#//apple_ref/doc/c_ref/CFRunLoopAddSource" target="_top">CFRunLoopAddSource</a></code> adds an input source to the current run loop. The input source monitors the run loop for a font query. When it detects a font query, it invokes your callback. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_22" title="Note"></a><p><strong>Note:</strong>&nbsp;If your application does not have a Core Foundation run loop (for example, a faceless server application), you must explicitly set up a run loop before you can receive queries.</p></div></li></ol><p>In the general case, a font query is packaged as a Core Foundation property list (<code><a href="../../../../CoreFoundation/Reference/CFPropertyListRef/Reference/reference.html#//apple_ref/c/tdef/CFPropertyListRef" target="_top">CFPropertyListRef</a></code>). A missing-font query in particular uses a Core Foundation dictionary (<code><a href="../../../../CoreFoundation/Reference/CFDictionaryRef/Reference/reference.html#//apple_ref/c/tdef/CFDictionaryRef" target="_top">CFDictionaryRef</a></code>) that contains key-value pairs to specify the needed font. You need to obtain information from the dictionary, such as the font’s name, to determine whether you manage the font in question. You may also need to look up other values in the dictionary to determine what you must do to satisfy the query. </p><p><span class="content_text">Listing 2-6</span> shows a function (<code>MyHandleFontRequest</code>) that looks for the queried font by various names. When the name is found, the function translates it to a a file specification, then calls the function <code><a href="../../../Reference/ATS/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSFontActivateFromFileSpecification" target="_top">ATSFontActivateFromFileSpecification</a></code> to activate the font. A detailed explanation for each numbered line of code appears following the listing.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_23" title="Note"></a><p><strong>Note:</strong>&nbsp;You should use <code>ATSFontActivateFromFileSpecification</code> only in Mac OS X v10.4 and earlier. In Mac OS X v10.5 and later, this function is deprecated, so you should instead use <code>ATSFontActivateFromFileReference</code>.</p></div><a name="//apple_ref/doc/uid/TP30000110-SW16" title="Listing 2-6A function that handles a font query in Mac OS X v10.4 and earlier"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>A function that handles a font query in Mac OS X v10.4 and earlier</p><div class="codesample"><table><tr><td scope="row"><pre>void MyHandleFontRequest (CFDictionaryRef theDict)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef theName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    const FSSpec* fontFileSpec = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSFontContainerRef = myFontContainerRef;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (CFDictionaryContainsKey (theDict, kATSQueryQDFamilyName)) <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        theName = CFDictionaryGetValue (theDict, kATSQueryQDFamilyName);<span></span></pre></td></tr><tr><td scope="row"><pre>        fontFileSpec = MyFindByQDFamilyName (theName );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if (CFDictionaryContainsKey (theDict, kATSQueryFontName)) <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        theName = CFDictionaryGetValue(theDict, kATSQueryFontName);<span></span></pre></td></tr><tr><td scope="row"><pre>        fontFileSpec = MyFindByFontName (theName);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if (CFDictionaryContainsKey (theDict,<span></span></pre></td></tr><tr><td scope="row"><pre>                         kATSQueryFontPostScriptName))<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        theName = CFDictionaryGetValue (theDict,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 kATSQueryFontPostScriptName);<span></span></pre></td></tr><tr><td scope="row"><pre>        fontFileSpec = MyFindByPostScriptName (theName);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    // If needed, you can add code to handle other query types.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (fontFileSpec != NULL) <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        status = ATSFontActivateFromFileSpecification (<span></span></pre></td></tr><tr><td scope="row"><pre>                                 fontFileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 kATSFontContextGlobal,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 kATSFontFormatUnspecified,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 myFontContainerRef);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks to see if the <code>CFDictionary</code> contains the <code>kATSQueryQDFamilyName</code> key. If the key is in the dictionary, then the code obtains the QuickDraw family name of the font and calls your function (<code>MyFindByQDFamilyName</code>) to obtain the file specification associated with the name. </p></li><li class="li"><p>If the name hasn’t been found yet, checks to see if the <code>CFDictionary</code> contains the <code>kATSQueryFontName</code> key. If the key is in the dictionary, then the code obtains the full name of the font and calls your function (<code>MyFindByFontName</code>) to obtain the file specification associated with the full font name. </p></li><li class="li"><p>If the name hasn’t been found yet, checks to see if the <code>CFDictionary</code> contains the <code>kATSQueryFontPostScriptName</code> key. If the key is in the dictionary, then the code obtains the PostScript name derived from the font's <code>FOND</code> resource or from the font’s <code>sfnt</code> name table. Then calls your function (<code>MyFindByPostScriptName</code>) to obtain the file specification associated with the PostScript font name. </p></li><li class="li"><p>Checks to see if a value is assigned to the font file specification. </p></li><li class="li"><p>Activates the file specification for the requested font. Because you are activating the font in response to a query from another applications, you need to specify a global context (<code>kATSFontContextGlobal</code>) so the font is available to all applications. You should always pass <code>kATSFontFormatUnspecified</code>, as the system automatically detects the format of the font. If you want to deactivate the font later, you must pass a font container reference (<code>myFontContainerRef</code>) and retain the container returned to you by the function <code><a href="../../../Reference/ATS/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ATSFontActivateFromFileSpecification" target="_top">ATSFontActivateFromFileSpecification</a></code>. To deactivate the font, you pass the font container reference to the function <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontDeactivate" target="_top">ATSFontDeactivate</a></code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW3" title="Providing a Fonts Panel in a Carbon Application"></a><h2>Providing a Fonts Panel in a Carbon Application</h2><p>In Mac OS X the Fonts panel is the preferred user interface for users to specify font family, typeface, size, and color settings for text. See <span class="content_text"><a href="../atsfonts_concepts/atsfonts_concepts.html#//apple_ref/doc/uid/TP30000109-SW8">“Font User Interface”</a></span> for a detailed description and screenshot of a Fonts panel. Cocoa applications already use the Fonts panel. With the introduction of the Fonts Panel programming interface, Carbon applications can provide the Fonts panel instead of the Font menu that was used in Mac OS 9. This section shows you how to set up and handle the Carbon events that associated with a Fonts panel. </p><p>To support a Fonts panel in a Carbon application, your application must perform the following tasks:</p><ul class="ul"><li class="li"><p>show and hide the Fonts panel</p></li><li class="li"><p>handle a selection event in the Fonts panel</p></li><li class="li"><p>programmatically set a selection in the Fonts panel</p></li><li class="li"><p>handle a change of user focus from one document to another</p></li></ul><p>Each of these tasks is described in the sections that follow.</p><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_7" title="Showing and Hiding the Fonts Panel"></a><h3>Showing and Hiding the Fonts Panel</h3><p>It is your application’s responsibility to provide an interface by which the user can activate and deactivate the Fonts panel. Typically users can open the Fonts panel by choosing a Show Fonts menu item from a Format menu. The keyboard equivalent for this item should be command-T. When the Fonts panel is open, your application should change the menu item to Hide Fonts. Your may choose instead to provide a button or other mechanism to activate and deactivate the Fonts panel. What you choose to do depends on the needs of your application.</p><p>You can use Interface Builder to provide a Format menu with a Show Fonts menu item. In Interface Builder, you must type the four-character code <code>shfp</code> in the Command text field, as shown in <span class="content_text">Figure 2-2</span>. The constant <code>kHICommandShowHideFontPanel</code> is defined by the Carbon Event Manager to be the <code>shfp</code> HI command, which is why you must provide this four-character code as the command for the Show Fonts Panel menu item. You can use Project Builder to write code that handles the <code>kHICommandShowHideFontPanel</code> command issued by the Show Fonts Panel menu item. </p><br/><div><a name="//apple_ref/doc/uid/TP30000110-SW28" title="Figure 2-2Setting the command for the Show Fonts menu item"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>Setting the command for the Show Fonts menu item</p><img src = "../art/showfontscommand.gif" alt = "Setting the command for the Show Fonts menu item" width="520" height="390"></div><br/><p>When the user closes the Fonts panel, either by clicking on its close button or using an application-supplied human interface element (such as a Hide Fonts Panel menu item), the Fonts panel sends a Carbon event of class <code>kEventClassFont</code> and of type <code>kEventFontPanelClosed</code> to the event target your application specified in its most recent call to <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>. This allows your application to update any menu items or other controls whose state may need to change because the Fonts panel has closed. Your application must have a Carbon event handler installed to detect this event. </p><p><span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW17">Listing 2-7</a></span> shows an application event handler that handles the Carbon events <code>kHICommandShowHideFontPanel</code> and <code>kEventFontPanelClosed</code>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW17" title="Listing 2-7An function that handles events related to the Fonts panel"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>An function that handles events related to the Fonts panel</p><div class="codesample"><table><tr><td scope="row"><pre>pascal OSStatus MyApplicationEventHandler (EventHandlerCallRef myHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            EventRef event, void *userData)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    HICommand   command;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32  eventClass;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32  eventKind;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    eventClass = GetEventClass(event);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (eventClass)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassCommand:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>                    GetEventParameter (event, kEventParamDirectObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            typeHICommand, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            sizeof (HICommand),<span></span></pre></td></tr><tr><td scope="row"><pre>                                            NULL, &amp;command);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    switch (command.commandID)<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        case kHICommandShowHideFontPanel:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                                status = FPShowHideFontPanel();<span></span></pre></td></tr><tr><td scope="row"><pre>                                if (FPIsFontPanelVisible)<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                                {<span></span></pre></td></tr><tr><td scope="row"><pre>                                    // Your code to set the menu item to Hide Fonts<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                                }<span></span></pre></td></tr><tr><td scope="row"><pre>                                else<span></span></pre></td></tr><tr><td scope="row"><pre>                                {<span></span></pre></td></tr><tr><td scope="row"><pre>                                    // Your code to set the menu item to Show Fonts<span></span></pre></td></tr><tr><td scope="row"><pre>                                }<span></span></pre></td></tr><tr><td scope="row"><pre>                        break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>         case kEventClassFont:<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>         {<span></span></pre></td></tr><tr><td scope="row"><pre>             eventKind  = GetEventKind (event);<span></span></pre></td></tr><tr><td scope="row"><pre>             switch (eventKind)<span></span></pre></td></tr><tr><td scope="row"><pre>             {<span></span></pre></td></tr><tr><td scope="row"><pre>                    case kEventFontPanelClosed:<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                        // Your code to set the menu item to Show Fonts<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                    case kEventFontSelection:<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                        status = MyGetFontSelection (event);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>             }<span></span></pre></td></tr><tr><td scope="row"><pre>         }<span></span></pre></td></tr><tr><td scope="row"><pre>         break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventClass" target="_top">GetEventClass</a></code> to obtain the event class.</p></li><li class="li"><p>Checks to see if the event class is a command event. </p></li><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to obtain the HI command from the event.</p></li><li class="li"><p>If the HI command is <code>kHICommandShowHideFontPanel</code>, calls the Fonts Panel function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/FPShowHideFontPanel" target="_top">FPShowHideFontPanel</a></code>. Calling the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/c/func/FPShowHideFontPanel" target="_top">FPShowHideFontPanel</a></code> displays the Fonts panel if it is not currently displayed, and hides it if it is currently displayed.</p><p>The result code <code>fontPanelShowErr</code> is returned if, for unknown reasons, the Fonts panel cannot be made visible. Specific result codes, such as <code>memFullErr</code> can also be returned</p><p>The Fonts panel opens with the system’s default settings unless you first set the selection information by calling the Fonts Panel function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>. See <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW1">“Setting a Selection in the Fonts Panel”</a></span> for more information.</p></li><li class="li"><p>Calls the Fonts Panel function <code>FPIsFontPanelVisible</code> to determine if the Fonts panel is now visible. Your application should provide code to the menu item (or other user interface element) appropriately.</p></li><li class="li"><p>Checks to see if the event class is a font event.</p></li><li class="li"><p>If the event kind is a close event, you must provide code to set the menu item (or other user interface element) appropriately.</p></li><li class="li"><p>If the event kind is a font selection event, calls your function to handle font selection. Font selection events are discussed in <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW18">“Handling a Selection Event in the Fonts Panel.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW18" title="Handling a Selection Event in the Fonts Panel"></a><h3>Handling a Selection Event in the Fonts Panel</h3><p>As the user selects font settings from the Fonts panel, your application receives a font-selection Carbon event (<code>kEventFontSelection</code>) from the Fonts panel. The settings selected by the user in the Fonts panel are passed as event parameters in the <code>kEventFontSelection</code> event. Your application simply extracts as many of the parameters as it can from the event and applies the font settings appropriately. </p><p>The event type <code>kEventFontSelection</code> contains parameters that reflect the current Fonts panel settings. Provided your application has a Carbon event handler installed to detect this event, it can obtain the parameters listed in <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW19">Table 2-2</a></span>. <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW17">Listing 2-7</a></span> shows an application event handler that detects the event type <code>kEventFontSelection</code> and calls the function show in <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW20">Listing 2-8</a></span>.</p><a name="//apple_ref/doc/uid/TP30000110-SW19" title="Table 2-2Parameters for the event the kEventFontSelection"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>Parameters for the event the <code>kEventFontSelection</code></caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>kEventParamATSUFontID</code></p></td><td ><p><code>typeATSUFontID</code></p></td><td ><p>Specifies the font ID of the selected font.</p></td></tr><tr><td  scope="row"><p><code>kEventParamATSUFontSize</code></p></td><td ><p><code>typeATSUSize</code></p></td><td ><p>Specifies the size of the font as a <code>Fixed</code> value.</p></td></tr><tr><td  scope="row"><p><code>kEventParamFMFontFamily</code></p></td><td ><p><code>typeFMFontFamily</code></p></td><td ><p>Specifies the font family reference of the font.</p></td></tr><tr><td  scope="row"><p><code>kEventParamFMFontStyle</code></p></td><td ><p><code>typeFMFontStyle</code></p></td><td ><p>Specifies the QuickDraw style of the font.</p></td></tr><tr><td  scope="row"><p><code>kEventParamFMFontSize</code></p></td><td ><p><code>typeFMFontSize</code></p></td><td ><p>Specifies the size of the font as an integer.</p></td></tr><tr><td  scope="row"><p><code>kEventParamFontColor</code></p></td><td ><p><code>typeFontColor</code></p></td><td ><p>Specifies the color of the text as <code>RGBColor</code>.</p></td></tr></table></div><p>The function in <span class="content_text">Listing 2-8</span> (<code>MyGetFontSelection</code>) obtains the font family, font style, and font size from a selection made by the user in the Fonts panel. You can just as easily extract the ATSUI font and size parameters using the parameters and types shown in <span class="content_text">Table 2-2</span>. A detailed explanation for each numbered line of code appears following the listing. </p><a name="//apple_ref/doc/uid/TP30000110-SW20" title="Listing 2-8A function that obtains the current selection in the Fonts panel"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>A function that obtains the current selection in the Fonts panel</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyGetFontSelection (EventRef event)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    FMFontFamilyInstance    instance;       <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    FMFontSize              fontSize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    instance.fontFamily = kInvalidFontFamily;<span></span></pre></td></tr><tr><td scope="row"><pre>    instance.fontStyle = normal;<span></span></pre></td></tr><tr><td scope="row"><pre>    fontSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetEventParameter (event, kEventParamFMFontFamily,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    typeFMFontFamily, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    sizeof (instance.fontFamily),<span></span></pre></td></tr><tr><td scope="row"><pre>                                    NULL, &amp;(instance.fontFamily));<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    check_noerr (status);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetEventParameter (event, kEventParamFMFontStyle,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    typeFMFontStyle, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    sizeof (instance.fontStyle),<span></span></pre></td></tr><tr><td scope="row"><pre>                                    NULL, &amp;(instance.fontStyle));<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    check_noerr (status);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetEventParameter (event, kEventParamFMFontSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    typeFMFontSize, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    sizeof( fontSize), NULL, &amp;fontSize);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    check_noerr (status);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares and initializes variables used to get font information.</p></li><li class="li"><p>Calls the Carbon Event Manager function <code>GetEventParameter</code> to extract the font family parameter, passing these parameters:</p><ul class="ul"><li class="li"><p>the event</p></li><li class="li"><p>the event parameter name <code>kEventParamFMFontFamily</code></p></li><li class="li"><p>the event parameter type</p></li><li class="li"><p><code>NULL</code>, to indicate not to return the actual type of the parameter, which is not needed in this case</p></li><li class="li"><p>the size of the event parameter value</p></li><li class="li"><p><code>NULL</code>, to indicate not to return the actual size of the parameter, which is not needed in this case</p></li><li class="li"><p>on output, points to the font size of the selection</p></li></ul></li><li class="li"><p>Checks for errors before continuing. This is always something your application should do, even though, for clarity, error-checking code is sometimes omitted from the sample code in this book. </p></li><li class="li"><p>Calls the Carbon Event Manager function <code>GetEventParameter</code> to extract the font style parameter. Similar to the previous call to this function, passes <code>NULL</code> to indicate the actual type and size of the parameter need not be returned.</p></li><li class="li"><p>Calls the Carbon Event Manager function <code>GetEventParameter</code> to extract the font size parameter. Similar to the previous call to this function, passes <code>NULL</code> to indicate the actual type and size of the parameter need not be returned.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-SW1" title="Setting a Selection in the Fonts Panel"></a><h3>Setting a Selection in the Fonts Panel</h3><p>You can programmatically set a selection in the Fonts panel by calling the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>. You can call this function even when the Fonts panel is not open or visible. When the Fonts panel becomes visible later, the style information specified in the most recent call to <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> is selected. </p><p><span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW21">Listing 2-9</a></span> shows a function (<code><!--a-->MySetFontSelection<!--/a--></code>) that passes an ATSUI style object (<code>ATSUStyle</code>) to the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> to set up a selection in the Fonts panel. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW21" title="Listing 2-9A function that programmatically sets a selection in the Fonts panel"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>A function that programmatically sets a selection in the Fonts panel</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MySetFontSelection (WindowRef thisWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUStyle           myStyle;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeTag    myTags[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    ByteCount           mySizes[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUAttributeValuePtr   myValues[2];<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSUFontID          theFontID;<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed               theFontSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    HIObjectRef     myHIObjectTarget;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUCreateStyle (&amp;myStyle);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    verify_noerr (ATSUFindFontFromName ("Times Roman",<span></span></pre></td></tr><tr><td scope="row"><pre>                            strlen ("Times Roman"),<span></span></pre></td></tr><tr><td scope="row"><pre>                            kFontFullName, kFontNoPlatform,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kFontNoScript, kFontNoLanguage,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;theFontID) );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myTags[0] = kATSUFontTag;<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    mySizes[0] = sizeof (theFontID);<span></span></pre></td></tr><tr><td scope="row"><pre>    myValues[0] = &amp;theFontID;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theFontSize = Long2Fix (36);    <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    myTags[1] = kATSUSizeTag;<span></span></pre></td></tr><tr><td scope="row"><pre>    mySizes[1] = sizeof(theFontSize);<span></span></pre></td></tr><tr><td scope="row"><pre>    myValues[1] = &amp;theFontSize;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    verify_noerr (ATSUSetAttributes (myStyle, 2,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myTags, mySizes, myValues) );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    myHIObjectTarget = (HIObjectRef) GetWindowEventTarget (thisWindow);  <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    SetFontInfoForSelection (kFontSelectionATSUIType,<span></span></pre></td></tr><tr><td scope="row"><pre>                            1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myStyle,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myHIObjectTarget);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUDisposeStyle (myStyle);<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares variables necessary to set up an ATSUI style for two style attributes. Each attribute in an ATSUI style consists of three values (a triple)—an attribute tag, the value associated with the tag, and the size of the value. See <em>ATSUI Reference</em> for a list of the style attribute tags you can supply.</p></li><li class="li"><p>Declares an <code>HIObjectRef</code> variable. You need to pass a value of this type to the function <code>SetFontInfoForSelection</code>. An HI object (<code>HIObject</code>) is an HI Toolbox data type; it is the base class for a variety of objects that appear in the user interface. An HI object can receive events and can have event handlers installed on it. See the HIObject reference documentation for more information:</p><p><span class="content_text"><a href="http://developer.apple.com/documentation/Carbon/Reference/HIObjectReference/index.html" target="_top">http://developer.apple.com/documentation/Carbon/Reference/HIObjectReference/index.html</a></span></p></li><li class="li"><p>Calls the ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCreateStyle" target="_top">ATSUCreateStyle</a></code> to create and initialize an ATSUI style object. The newly-created style object contains default values for style attributes, font features, and font variations.</p></li><li class="li"><p>Calls the ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUFindFontFromName" target="_top">ATSUFindFontFromName</a></code> to obtain the font ID for the specified font. </p></li><li class="li"><p>Declares a triple (tag, size, value) for the font ID attribute. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_24" title="Note"></a><p><strong>Note:</strong>&nbsp;A triple is a set of three values that consist of an attribute tag, a value for that tag, and the size of the value. In ATSUI, triples are used to specify style, line, and layout attributes. </p></div></li><li class="li"><p>Declares a triple for the font size attribute. Font size must be specified as a <code>Fixed</code> value, which is why the code calls the macro <code>Long2Fix</code> prior to assigning the font size to the <code>myValues</code> array.</p></li><li class="li"><p>Calls the ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUSetAttributes" target="_top">ATSUSetAttributes</a></code> to associate the font ID and font size attributes with the ATSUI style object.</p></li><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowEventTarget" target="_top">GetWindowEventTarget</a></code> to obtain the window that should be associated with the selection event. You’d typically set a selection in the Fonts panel to reflect the style selected in the active document window (or the default setting for a newly-opened document window). You need the resulting value (<code>EventTargetRef</code>), cast as an <code>HIObjectRef</code>, to pass to the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> in the next step.</p></li><li class="li"><p>Calls the Fonts Panel function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> to set the selection in the Fonts panel with these parameters:</p><ul class="ul"><li class="li"><p><code>kFontSelectionATSUIType</code> specifies the style is an ATSUI style and not a QuickDraw style.</p></li><li class="li"><p>the size of the style array. </p></li><li class="li"><p>a pointer to the ATSUI style object that contains the attribute information you want to set in the Fonts panel.</p></li><li class="li"><p>a reference to the Carbon Event Manager HI object to which subsequent Fonts panel events should be sent. This should be the window or control holding the current user focus, or the application itself. The value can change from one call to another, as the user focus shifts. If this value is <code>NULL</code>, the Fonts panel sends events to the application target as returned by the function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetApplicationEventTarget" target="_top">GetApplicationEventTarget</a></code>.</p></li></ul></li><li class="li"><p>Calls the ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUDisposeStyle" target="_top">ATSUDisposeStyle</a></code> to dispose of the <code>ATSUStyle</code> data structure. If you plan to use the same style again in your application, you don’t need to dispose of the style now. It is more efficient to reuse <code>ATSUStyle</code> data structure than to recreate them. </p></li></ol><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_8" title="Handling Change of User Focus"></a><h3>Handling Change of User Focus</h3><p>The <strong>user focus</strong> is the part of your application's user interface toward which keyboard input is directed; it can be a window, a control, or any other user interface element. For the Fonts panel, your application needs to track user focus only for those user interface elements to which you want Fonts panel events sent.</p><p>In <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW22">Figure 2-3</a></span> the user focus is in the top window while in <span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW23">Figure 2-4</a></span> the user focus is in the window on the right side. Compare the Fonts panel in one figure with the Fonts panel in the other figure. As the user focus changes, so do the selections in the Fonts panel. Your application should behave in a similar manner when the user focus changes.</p><br/><div><a name="//apple_ref/doc/uid/TP30000110-SW22" title="Figure 2-3User focus in the top window "></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>User focus in the top window </p><img src = "../art/userfocus1.gif" alt = "User focus in the top window" width="397" height="282"></div><br/><p>To handle changes in the user focus, when a Carbon event target (typically a control or window) gains the focus, your application calls the Fonts Panel function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>, providing the Fonts panel with style run information for the currently selected text. If the Fonts panel is visible when this function is called, its contents are updated to reflect the style run information passed to the Fonts panel. </p><br/><div><a name="//apple_ref/doc/uid/TP30000110-SW23" title="Figure 2-4User focus in the window on the right side"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>User focus in the window on the right side</p><img src = "../art/userfocus2.gif" alt = "User focus in the window on the right side" width="469" height="285"></div><br/><p>If the Fonts panel is not visible, there is no user-visible effect. However, the information supplied by <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> is saved so that when the Fonts panel becomes visible again, the correct settings are displayed. The function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> also lets your application specify the event target to which Fonts panel-related Carbon events should be sent.</p><p>When the user focus shifts, the component receiving the focus calls <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> to register itself as the new event target (even if <code>iNumStyles</code> is still 0). The component that relinquishes focus should call the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>, specifying 0 for <code>iNumStyles</code> parameter and <code>NULL</code> for <code>iEventTarget</code> parameter. This tells the Fonts panel that its settings are to be cleared. In the case that there is not another window open to receive focus, you need to set the Fonts panel to its default settings. </p><p>For example, if your application supports multiple windows, you can install a Carbon event handler to check for window class events (<code>kEventClassWindow</code>) that are event kinds <code>kEventWindowFocusAcquired</code> and <code>kEventWindowFocusRelinquish</code>. In response to these two event kinds, you call the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>.</p><p><span class="content_text"><a href="atsfonts_tasks.html#//apple_ref/doc/uid/TP30000110-SW24">Listing 2-10</a></span> shows a function (<code><!--a-->MyWindowEventHandler<!--/a--></code>) that is installed on every document window to handle user-focus events in an application. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW24" title="Listing 2-10A  function that handles user-focus events"></a><p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>A  function that handles user-focus events</p><div class="codesample"><table><tr><td scope="row"><pre>pascal OSStatus MyWindowEventHandler (EventHandlerCallRef myHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        EventRef event, void * userData)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32      eventClass = GetEventClass (event);<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowRef   thisWindow = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (eventClass)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassWindow:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            switch (GetEventKind (event))<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventWindowFocusRelinquish:<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    SetFontInfoForSelection (kFontSelectionATSUIType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0, NULL, NULL);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kEventWindowFocusAcquired: <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    status = GetEventParameter (event,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kEventParamDirectObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    typeWindowRef, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    sizeof (WindowRef), NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;thisWindow);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                   status = MySetFontSelection (thisWindow);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>         }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks for a focus-relinquish event. In this example, the settings are cleared. If there is not another window to receive focus, you should set the Fonts panel to its default settings.</p></li><li class="li"><p>Clears the Fonts panel settings. The constant <code>kFontSelectionATSUIType</code> specifies to use an <code>ATSUStyle</code> collection instead of QuickDraw style. When you clear the Fonts panel settings, you need to set the window target (the last parameter to the function <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code>) to <code>NULL</code>. </p></li><li class="li"><p>Checks for a focus-acquired event.</p></li><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to obtain a window reference to the window that acquired the focus. </p></li><li class="li"><p>In the case of a focus-acquired event, the code calls a the function <code><!--a-->MySetFontSelection<!--/a--></code> to set the font family, font style, and font size to values appropriate for the window. The <code><!--a-->MySetFontSelection<!--/a--></code> function calls <code><a href="../../../Reference/FontsWindow/Reference/reference.html#//apple_ref/doc/c_ref/SetFontInfoForSelection" target="_top">SetFontInfoForSelection</a></code> to set the selection in the Fonts panel and set the window target to the window that acquired the focus. </p><p>Your application would need to supply a function that sets fonts selections appropriately. For example, you may need to retrieve font settings from the document attached to the window that acquires user focus.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_9" title="Storing Font Information in a Document"></a><h2>Storing Font Information in a Document</h2><p>You may need to store font information in a document to ensure that the next time the document opens the correct fonts are used. Fonts have several names, any of which can be stored with a document and retrieved each time the document is opened, even if the document is opened on another system. The following are the different font names you can store in a document:</p><ul class="ul"><li class="li"><p>font family name and style. (used by QuickDraw)</p></li><li class="li"><p>PostScript font name. (used by Cocoa and Quartz)</p></li><li class="li"><p>unique name (full font name plus the font manufacturer name). (Used by Multilingual Text Engine)</p></li><li class="li"><p>full font name </p></li></ul><p>Unlike font names which are part of a font’s data, data types, such as <code>ATSFontRef</code> and <code>ATSFontFamilyRef</code> represent values that are arbitrarily assigned by ATS for Fonts at system startup. These values can change when the system is restarted, so you shouldn’t use them to store font information. You can, however, use an ATS font reference (<code>ATSFontRef</code>) to obtain a font name by passing the reference to the appropriate function. You can use the following functions to obtain a font name from an ATS font reference:</p><ul class="ul"><li class="li"><p><code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontFamilyGetQuickDrawName" target="_top">ATSFontFamilyGetQuickDrawName</a></code> obtains the QuickDraw font family name.</p></li><li class="li"><p><code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetPostScriptName" target="_top">ATSFontGetPostScriptName</a></code> obtains the PostScript name for a font.</p></li><li class="li"><p><code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontFamilyGetName" target="_top">ATSFontFamilyGetName</a></code> obtains the full font family name.</p></li><li class="li"><p><code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetName" target="_top">ATSFontGetName</a></code> obtains the full font name.</p></li></ul><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_10" title="Getting Font Metrics"></a><h2>Getting Font Metrics</h2><p>You can use ATS for Fonts to obtain a variety of horizontal and vertical font metrics, including the ascent, descent, and leading. You call the functions <code>ATSFontGetHorizontalMetrics</code> or <code>ATSFontGetVerticalMetrics</code> to get the measurements you need. ATS for Fonts returns the measurements in an <code>ATSFontMetrics</code> data structure. If one or more metrics are not available for a font, then the appropriate fields in the <code>ATSFontMetrics</code> data structure are set to <code>0</code>. See <em> ATS for Fonts Reference</em> for details on which measurements are contained in this data structure.</p><p>Calling either of the functions to get metrics is straightforward, as shown in <span class="content_text">Listing 2-11</span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000110-SW25" title="Listing 2-11A function that obtains font metrics"></a><p class="codesample"><strong>Listing 2-11&nbsp;&nbsp;</strong>A function that obtains font metrics</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyGetFontMetrics (ATSFontRef fontRef)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ATSFontMetrics  horizontalMetrics,<span></span></pre></td></tr><tr><td scope="row"><pre>                    verticalMetrics;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSFontGetHorizontalMetrics (fontRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;horizontalMetrics);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    // Your code to do something with the metrics<span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSFontGetVerticalMetrics(fontRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;verticalMetrics);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    // Your code to do something with the metrics<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetHorizontalMetrics" target="_top">ATSFontGetHorizontalMetrics</a></code> to obtain the horizontal metrics for the font specified by <code>fontRef</code>. The second parameter is an options flag reserved for future use, so you should pass <code>0</code>. If one or more of the horizontal metrics are not available for the font, then the appropriate fields in the <code>ATSFontMetrics</code> data structure are set to <code>0</code>.</p></li><li class="li"><p>Calls <code><a href="../../../Reference/ATS/Reference/reference.html#//apple_ref/doc/c_ref/ATSFontGetVerticalMetrics" target="_top">ATSFontGetVerticalMetrics</a></code> to obtain the vertical metrics for the font specified by <code>fontRef</code>. The second parameter is an options flag reserved for future use, so you should pass <code>0</code>. If one or more of the vertical metrics are not available for the font, then the appropriate fields in the <code>ATSFontMetrics</code> data structure are set to <code>0</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000110-DontLinkElementID_11" title="Migrating Data Types from the Font Manager"></a><h2>Migrating Data Types from the Font Manager</h2><p>There are two sets of programming interfaces you can use in Mac OS X that you can use to manage fonts—ATS for Fonts and the Font Manager. This document focuses on using ATS for Fonts, the programming interface designed for font management in Mac OS X. The Font Manager is designed for Mac OS 9 but can be used as a compatibility path from Mac OS 9 to Mac OS X. The Font Manager is discussed in detail in <em><a href="../../Managing_FontManager/index.html#//apple_ref/doc/uid/TP30000982" target="_top">Managing Fonts: QuickDraw</a></em> and <em><a href="../../../Reference/Font_Manager/index.html#//apple_ref/doc/uid/TP30000051" target="_top">Font Manager Reference</a></em>.</p><p>When you migrate code from the Font Manager to ATS for Fonts, keep in mind the difference between the data types used in each API. Although there are parallels between the data types used to reference fonts and font families in the two programming interfaces, the base types are different. The <code>ATSFontFamilyRef</code> data type is an opaque 32-bit value while the <code>FMFontFamily</code> data type is a signed 16-bit integer, so you should avoid type casting or implicit type promotion when working with these data types. Instead, use the conversion functions defined for the font family references by the QuickDraw framework to protect your software from any changes or differences in the way these two data types are generated. </p><p>The <code>FMFont</code> and <code>ATSUFontID</code> data types are equivalent so you can use them interchangeably with the functions provided by the Font Manager and ATSUI in the QuickDraw framework. However, you must use the functions listed in <span class="content_text">Table 2-3</span> to convert between Font Manager and ATS for Fonts data types. See <em>Font Manager Reference</em> for more information on these functions.</p><a name="//apple_ref/doc/uid/TP30000110-SW26" title="Table 2-3Functions that convert between Font Manager and ATS for Fonts data types "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-3&nbsp;&nbsp;</strong>Functions that convert between Font Manager and ATS for Fonts data types </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Function</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data type obtained</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data type provided</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Font_Manager/Reference/reference.html#//apple_ref/doc/c_ref/FMGetATSFontRefFromFont" target="_top">FMGetATSFontRefFromFont</a></code></p></td><td ><p><code>ATSFontRef</code></p></td><td ><p><code>FMFont</code></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetATSFontFamilyRefFromFontFamily" target="_top">FMGetATSFontFamilyRefFromFontFamily</a></code></p></td><td ><p><code>ATSFontFamilyRef</code></p></td><td ><p><code>FMFontFamily</code></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Font_Manager/Reference/reference.html#//apple_ref/doc/c_ref/FMGetFontFromATSFontRef" target="_top">FMGetFontFromATSFontRef</a></code></p></td><td ><p><code>FMFont</code></p></td><td ><p><code>ATSFontRef</code></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/Font_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FMGetFontFamilyFromATSFontFamilyRef" target="_top">FMGetFontFamilyFromATSFontFamilyRef</a></code></p></td><td ><p><code>FMFontFamily</code></p></td><td ><p><code>ATSFontFamilyRef</code></p></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsfonts_concepts/atsfonts_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsfonts_revhistory/atsfonts_revhistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ATS_Concepts/atsfonts_tasks/atsfonts_tasks.html%3Fid%3DTP30000981-1.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ATS_Concepts/atsfonts_tasks/atsfonts_tasks.html%3Fid%3DTP30000981-1.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ATS_Concepts/atsfonts_tasks/atsfonts_tasks.html%3Fid%3DTP30000981-1.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>