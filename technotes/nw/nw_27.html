<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW27: AOCE SMPReadContent Function</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW27: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Aug 29, 1994 - Sep 2, 1994"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002568" title="AOCE SMPReadContent Function"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW27</div>
<div id="pageheadsub">AOCE SMPReadContent Function</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Section1">Some sample code, explained</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note attempts to clarify certain aspects of the AOCE StandardMail Package SMPReadContent routine, as described in <i>Inside Macintosh: AOCEApplication Interfaces,</i>  pages 3-98 through 3-102, and also discusses someundocumented features of the call.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Sep 01 1994]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>The AOCE Standard Mail Package <code>SMPReadContent</code> routine is used to reada segment from a letter's standard-interchange-format block. The routine isdefined as follows (refer to <i>Inside Macintosh: AOCE ApplicationInterfaces</i>, pages 3-81 through 3-84 for a complete description):</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal OSErr SMPReadContent(WindowPtr window,                    MailSegmentMask segmentTypeMask,                    void *buffer,                    unsigned long bufferSize,                    unsigned long *dataSize,                    StScrpRec *textScrap,                    ScriptCode *script,                    MailSegmentType *segmentType,                    Boolean *endOfScript,                    Boolean *endOfSegment.                    Boolean *endOfContent                    long *segmentLength,                    long *segmentID);</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section1"></a><h2>Some Sample Code, Explained</h2><p>Shown below is some sample code that demonstrates the proper usage of the call.The code reads all of the styled text blocks from a letter'sstandard-interchange-format block.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#define kBufferSize 1024OSErr DoReadMyContent(WindowPtr window);OSErr DoReadMyContent(WindowPtr window){Ptr dataBuffer;unsigned long bufferSize,dataSize;StScrpRec *textScrap;ScriptCode script;MailSegmentType segmentType;Boolean endOfScript,endOfSegment,endOfContent;long segmentLength,segmentID;OSErr err;   /* allocate data buffer */   dataBuffer = NewPtr(kBufferSize);   if (MemError()!=noErr)     return MemError();   bufferSize = kBufferSize;   /* allocate scrap record */   textScrap = (StScrpRec *)NewPtr(sizeof(StScrpRec));   if (MemError()!=noErr)     return MemError();   /* read all of the styled text blocks */   do   {     textScrap-&gt;scrpNStyles = sizeof(ScrpSTTable)/sizeof(ScrpSTElement);     segmentID = 0;     err =SMPReadContent(window,kMailStyledTextSegmentMask,dataBuffer,bufferSize&amp;dataSize,textScrap,&amp;script,&amp;segmentType,&amp;endOfScript,&amp;endOfSegment,&amp;endOfContent,&amp;segmentLength,&amp;segmentID);     if (dataSize&gt;0)     {       /* we got a styled text block */       /* process the styled text block here */     }   } while ((err==noErr) &amp;&amp; (endOfContent==false));   DisposPtr((Ptr)textScrap);   DisposPtr(dataBuffer);   return err;</pre>	</TD></TR></TABLE></CENTER><p>The <code>segmentID</code> parameter represents the ID of the segment. It isimportant to note that this parameter is passed by reference. It is both aninput and an output. Basically, <code>segmentID </code>is used to providerandom-access reference to the content in a letter.  If you repeatedly pass 0for <code>segmentID</code>, <code>SMPReadContent</code> will sequentially give you allof the content blocks in the letter.  Upon return from each of the<code>SMPReadContent</code> calls, <code>segmentID </code>will be set to the ID of thesegment returned. This is so you can later call <code>SMPReadContent</code> to reada specific block of content out of a letter.</p> <p>This is useful in case you want to know what all of the blocks are in a letterwithout actually reading the data associated with all of the blocks.  Forexample, you might only want to download a QuickTime movie in a letter if theuser clicks on the spot where the movie is in the letter.</p><p>Also, it is possible to determine the size of a given segment without actuallyhaving to read the data into a buffer. Simply pass 0 in the <code>bufferSize</code>parameter and the length of the segment will be returned in the<code>segmentLength</code> parameter. This is nice in that it enables you to seeahead of time how much buffer space you will need to allocate for a givensegment (in case you need to retrieve it at a later time, for example).</p><p>In our example above we always set <code>segmentID </code>to 0, since we just wantto index through all of the available content.</p><p>Some other things to note in the above code:</p><ul type="disc">	<li>it's necessary to re-set <code>segmentID </code>to 0 for each call, otherwise, the system will treat the non-zero <code>segmentID </code>as an index into the content you just read, and you'll get the same content over and over:</li>	<li>it's necessary to set <code>textScrap-&gt;scrpNStyles</code> for each call to <code>SMPReadContent</code>   that returns scrap information.  Again, this field is both an input and   output.  On input, it specifies how many styles your scrap record can hold,   and on output, it returns how many were read</li> 	<li>even though we're only requesting data on styled text content blocks   (<code>kMailStyledTextSegmentMask</code>), <code>SMPReadContent</code> will return the <code>segmentID</code>,   <code>segmentLength</code>, and <code>segmentType</code> for other non-styled text blocks in the   letter.  However, <code>SMPReadContent</code> will always return a <code>dataSize</code> of 0 for these   blocks, and will always set <code>endOfBlock</code> to true for these blocks (since you   don't want to read them at all).  This is useful, since you could set the   <code>segmentTypeMask</code> to 0 and still get a list of all the blocks in a letter   without actually reading any information</li> 	<li>the <code>segmentID</code>, <code>segmentLength</code>, and <code>segmentType</code> fields are only valid for the   first <code>SMPReadContent</code> call <i>within</i> a segment.  Our buffer size in the above   code is 1024 bytes.  If the styled text block we were reading were bigger   than 1024 bytes, <code>SMPReadContent</code> would return information out of this larger   block across multiple calls.  Only in the first call for the block are these   three parameters valid as outputs.  You should still always reset <code>segmentID</code>   to 0 (or the segment you want to read from), however.</li> 	<li>this last point seems obvious, but don't declare your scrap record as a   non-dynamically allocated local variable.  This structure is <i>huge</i> and will   eat up all of your stack space.  Use <code>NewPtr</code> to allocate the structure instead.</li></ul><P><A HREF="#top">Back to top</A></P>  <a name="References"></a><h2>References:</h2><P><i>Inside Macintosh</i> <i>: AOCE Application Interfaces</i></p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_27.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_27.html%3Fid%3DDTS10002568-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_27.html%3Fid%3DDTS10002568-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_27.html%3Fid%3DDTS10002568-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>