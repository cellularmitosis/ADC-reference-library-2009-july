<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1133: The New PrGeneral Version Opcode</title>       <meta name="keywords" content="Mac OS 8 LaserWriter PrGeneral version opcode structure kPrVersionOp wDEV">    <meta name="Description" content="Technical Note TN1133: This Technical Note discusses thePrGeneral Version Opcode, kPrVersionOp, and details whatapplication developers and printer driver developers needto know about it."><meta name="categories" content="Printing"><meta name="week-posted" content="Jun 1, 1998 - Jun 5, 1998"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002972" title="The New PrGeneral Version Opcode"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/idxHardwareDrivers-date.html" target="_blank">Printing > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1133</div>
<div id="pageheadsub">The New PrGeneral Version Opcode</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><center><table width="600" cellpadding="0" cellspacing="0" border="0"> <tr> <td align="left" scope="row"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr>         <td width=300 valign="top" align=left>             <table border="0" width="300" cellpadding="0" cellspacing="0">                 <tr>             <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                 </tr>                 <tr bgcolor="#e6e6e6">                     <td background="images/tnmenubody.gif" width=300 align=left>                         <span id="menutitle">                             CONTENTS                             <br>                             <br>                         </span>                     </td>                 </tr>                 <tr bgcolor="#e6e6e6">                     <td background="images/tnmenubody.gif" width=300 align=left>                         <!-- begin_toc -->                         <p id="menutext">         <A HREF = "#New">The New PrGeneral Opcode</A><BR><BR>                  <A HREF = "#Developers">What Printer Driver Developers Need to Know</A><BR><BR>                  <A HREF = "#Applications">What Application Developers Need to Know</A><BR><BR>                  <A HREF = "#GoForth">Go Forth and Print!</A><BR><BR>         <A HREF = "#Registration">wDev Registration</A><BR><BR>                  <A HREF = "#References">References</A><BR><BR>		<A HREF = "#Changes">Change History</A><BR><BR>                  <A HREF = "#Downloads">Downloadables</A></p>          <!-- end_toc -->                  </td>                 </tr>                 <tr>                     <td width=300 align=left scope="row">                         <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                     </td>                 </tr>             </table>         </td>         <td width=300 valign="top" align=left>             <!-- begin_intro_text -->             <P id = "introtext">The Settings Library (<CODE>SettingsLib</CODE>), introduced in LaserWriter 8.5.1, allows applications to access and change the information created by LaserWriter 8 when a desktop printer is created. <CODE>SettingsLib</CODE> prevents contention over the printer database between different parts of a printer driver, different printer drivers, and other printer database clients such as the Desktop Print Monitor. The printer database is stored in the LaserWriter 8 preferences file. The Settings Library is especially useful for applications that previously relied on the format of the <code>PAPA</code> resource in the LaserWriter 8 driver. With the introduction of LaserWriter 8.5.1, the size of the <code>PAPA</code> resource changed, and applications that depended upon its size broke. Since the resource size may change again in the future, Apple has introduced this library to prevent such problems. This Technote overviews the Settings Library APIs.</P><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Jun 01 1998]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content --><P>For the past 12 years, printer driver developers have used the print record's <code>wDev</code> field in the <CODE>TPrStl</CODE> data structure to store their device information. Specifically, they've consistently used the high-order byte of this field  -- commonly known as the <code>wDev</code> ID  -- to store the device code. Unfortunately, due to the design limitations of the print record and the <code>wDev</code> field, the Printing Manager allowed for a maximum of only 256 IDs. Surprisingly enough (ha ha), with the expansion of the printer market, we're running out of numbers! As a result, with LaserWriter driver version 8.4, we've added a <CODE>PrGeneral</CODE> opcode and new structures to the Printing Manager so developers can work around this limitation. </p><P>This Technote is directed at both printer driver and application developers.  You need to add code to support this new information, but the changes are minimal. Below is sample code that shows you how to  retrieve the new version information when your application is looking for the features of a particular printer driver properly.</p><BR><P><A HREF="#top">Back to top</A></P><A NAME="New"></A><H2>The New PrGeneral Opcode: kPrVersionOp</H2><P>LaserWriter driver version 8.4 introduced several new <code>PrGeneral</code> opcodes, including a new opcode for driver version information: <CODE>kPrVersionOp</CODE>. Using <CODE>kPrVersionOp</CODE> is now the recommended way for applications to find out the printer driver currently in use. Remember that for printer drivers that haven't been updated to use this new <code>PrGeneral</code> opcode, your application needs to keep its <code>wDev</code>-checking code as well. </p><P>For more information on the extended print record opcodes introduced with LaserWriter version 8.4, read the Print Hints column <a href="http://developer.apple.com/dev/techsupport/develop/issue27/printhints.html">The All-New LaserWriter     Driver Version 8.4</A> in <I>develop</I> Issue 27. There you'll find a table that lists all the other <code>PrGeneral</code> opcodes supported in Apple printer drivers. See the article <a href="http://developer.apple.com/dev/techsupport/develop/bysubject/printing.html">Meet PrGeneral, the Trap That Makes the Most of the Printing Manager</A> in <I>develop</I> Issue 3 for more information on <code>PrGeneral</code>. </p><BR><P><A HREF="#top">Back to top</A></P><A NAME="Developers"></A><H2>What Printer Driver Developers Need to Know</H2><P>From now on, Apple's Developer Support Center will assign all printer drivers a <code>wDev</code> ID of 255. If you have an old <code>wDev</code> ID number (which is less than 255), you should still use the number you were assigned so that you don't break any applications that vary their behavior based on your driver's <code>wDev</code>. In addition, you should implement the new <CODE>kPrVersionOp</CODE> opcode as described here so that new applications can take advantage of it with your driver.</p><P>Listing 1 shows the new opcode and structures that you'll need to implement in your PDEF 7 resource. You need to place your creator type in the <CODE>driver.creator</CODE> field of the <CODE>TPrVersion</CODE> structure. You should also place your version number in <CODE>driver.release</CODE> so that application developers know what version of the driver is available. </p><P>The release and interfaces fields have the same format as the first long in a 'vers' resource -- that is, the following four 1-byte values: a major version number, a minor version number, a revision stage (development = 0x20, alpha = 0x40, beta = 0x60, and release = 0x80), and a prerelease version number. </p><P>Listing 1. The new version opcode and structures</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>enum {...    kPrVersionOp = 22         // LaserWriter version 8.4 and later only};typedef struct {    OSType architecture;         // Architecture (for example, 'pwpc', 'm68k')    OSType creator;             // Driver's creator type (for example, 'AAPL')    unsigned long release;         // Release number (for example, 0x8480)    unsigned long interfaces;     // Interfaces version (for example, 0x8480)} TVersion;typedef struct {    short iOpCode;             // Must be kPrVersionOp    short iError;             // For returning errors    long lReserved;         // Reserved, set to 0    TVersion driver;         // Driver information    TVersion reserved;         // Reserved, set to 0} TPrVersion;</pre></TD></TR></TABLE></CENTER><BR><BR><P>That's all you'll need to do to support the new <code>PrGeneral</code> opcode in your driver--hard to believe, but true!</p><BR><P><A HREF="#top">Back to top</A></P><A NAME="Applications"></A><H2>What Application Developers Need to Know</H2><P>Although Apple doesn't recommend that application developers check the <code>wDev</code> field of the print record, many do. They assume that the <code>wDev</code> value means they can count on certain features being present in the printer. For instance, many developers assume that a <code>wDev</code> of <I>3</I> means the printer driver supports PostScript<img src="images/tn1133_001.gif" align=top alt="WW Dev" width=11 height=12>. In fact, it indicates only that the current printer uses the Apple LaserWriter driver. This leaves out the possibility that a user has a non-Apple PostScript printer driver with an ID of, say, 243. </p><P>Even though Apple doesn't recommend that application developers rely on the <code>wDev</code> field (or the new <code>PrGeneral</code> opcode, for that matter), if you're going to change application behavior based on the number or creator returned, at least do so properly so that your applications don't break with future releases of printer drivers. We recommend that you use the <code>PrGeneral</code> <CODE>kPrVersionOp</CODE> opcode, if available, to get the structure and then check the <Code>driver.creator</code> and <code>driver.release</code> fields to determine the current printer driver and version (see Listing 1). You should also continue to support the old <code>wDev</code> method for printer drivers that have not yet updated to the new <code>PrGeneral</code> opcode. For your reference, the <code>PrGeneral</code> Version sample that accompanies this column shows how to retrieve the version and <code>wDev</code> information properly.</p><BR><P><A HREF="#top">Back to top</A></P><A NAME="GoForth"></A><H2>Go Forth and Print!</H2><P>As you can see, the changes that printer driver and application developers need to make to support the new <code>PrGeneral</code> opcode are minimal. We've already adopted this new method with the LaserWriter version 8.4.x drivers. We hope you will, too!</p><BR><P><A HREF="#top">Back to top</A></P><A NAME="Registration"></A><H2> wDev Registration</H2><P>Although from all printer drivers will now be assigned a <code>wDev</code> ID of 255, we still request that you register your printer driver with Apple's Developer Support Center to avoid creator type conflicts. To do so, register at our <a href="http://developer.apple.com/dev/wdev">wDev registration page</A>. You need to provide the following information:</p><UL TYPE=DISC>    <LI>Company name and address</li>    <LI>Contact name, phone number, and e-mail address </li>    <LI>Make and model of device supported (for example, Apple LaserWriter 16/600) </li>    <LI>Type of connection (for example, serial) </li>    <LI>Creator type (for example, 'AAPL') </li></UL><P>You'll receive confirmation of your registration within five to ten working days. If you have questions about <code>wDev</code> registration, write to devprograms@apple.com.</p><BR><P><A HREF="#top">Back to top</A></P><A NAME="References"></A><h2>References</h2>    <p><a href="http://developer.apple.com/dev/techsupport/develop/issue27/printhints.html">Print Hints: The All-New LaserWriter Driver Version 8.4</A> by Dave Polaschek, <I>develop</I> Issue 27. </p>    <p><a href="http://developer.apple.com/dev/techsupport/develop/bysubject/printing.html">Meet PrGeneral, the Trap that Makes the Most of the Printing Manager</A> by Pete "Luke" Alexander, <I>develop</I> Issue 3. </p><A NAME=Changes></A>                  <H2>Change History</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-June-1997</P>               </TD>               <td align="left">                  <P>Originally published in <I>MacTech</I> magazine.</P>               </TD>            </TR>		</TABLE>  <BR><P><A HREF="#top">Back to top</A></P>        <A NAME="Downloads"></A>         <h2>Downloadables</h2>        <center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600">         <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P>            </TD>            <td align="left">               <p>Acrobat version of this Note (60K).</P>            </TD>            <td width=60 align=left>               <p><A HREF="pdf/tn1133.pdf">Download</A></P>            </TD>          </TR>         </TABLE></center><BR><BR>         <BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1133.html%3Fid%3DDTS10002972-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1133.html%3Fid%3DDTS10002972-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1133.html%3Fid%3DDTS10002972-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>