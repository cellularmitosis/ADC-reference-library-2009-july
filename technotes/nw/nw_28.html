<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW28: Constructing a Business Card DSSpec</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW28: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Aug 29, 1994 - Sep 2, 1994"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002569" title="Constructing a Business Card DSSpec"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxInterapplicationCommunication-date.html" target="_blank">Carbon > Interapplication Communication</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW28</div>
<div id="pageheadsub">Constructing a Business Card DSSpec</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Section1">Building a DSSpec</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note describes how to create an AOCE catalog servicesspecification structure (DSSpec) for an AOCE business card catalog item, givenjust a file system specification record (FSSpec) for the item.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Sep 01 1994]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>The AOCE catalog services specification structure, defined by the<code>DSSpec</code> data type (see <i>Inside Macintosh</i> :<i>AOCE ApplicationInterfaces</i>  2-36), is used throughout AOCE for performing various taskssuch as getting and setting attributes in a record, specifying messageaddresses, etc. Many of the AOCE software routines defined in <i>InsideMacintosh</i> :<i>AOCE Application Interfaces</i> will give you a<code>DSSpec</code> for a given catalog item. For example, the Standard Catalogpackage contains a Catalog-Browsing panel, which allows the user to selectrecords in catalogs. Once a selection is made, the selected item is returned asa <code>DSSpec</code> structure.</p><p>However, there are instances where you will be given just an <code>FSSpec</code>for a catalog item, and you will need to construct a <code>DSSpec</code> structurefor that same item. For example, if your application uses the Drag Manager tohandle dragging HFS objects onto your application's windows, it's possible thatyou will receive a drag of an HFS object that represents an AOCE catalog item(like a business card). In this case, all you are given for the object is an<code>FSSpec</code> structure. If you wanted to use some of the routines defined inthe AOCE Catalog Manager on that item, you would need to pass a<code>RecordID</code> or <code>DSSpec</code> structure describing that item.</p><P><A HREF="#top">Back to top</A></P><a name="Section1"></a><h2>Building a DSSpec</h2><p>The following describes how to construct a <code>DSSpec</code> (from just a<code>FSSpec</code>) for a business card. Basically, business cards are degeneratepersonal catalogs containing a distinguished record. To find the distinguishedrecord, we look for a pseudonym with a known type. By enumerating thatpseudonym you can find the distinguished record. The process is as follows:</p><ul type="disc">	<li>Open the business card with <code>DirOpenPersonalDirectory</code> to get the reference number. </li><li>Use <code>DirEnumerateGet</code> to get the distinguished record's <code>CID</code> (the <code>CID</code> and reference number are enough to access the record).</li></ul><p>To make a fully specified <code>packedDSSpec</code>:</p><ul type="disc">	<li>Call <code>DirGetNameAndType</code> passing the <code>CID</code> gotten above, to get the distinguished record's type (use the file name as the record's name. If it is not the same, it is OK to set the record's name to the file name). </li><li>Call <code>DirMakePersonalDirectoryRLI</code>, using the business card reference number to get the <code>RLI</code>. </li><li>Create the <code>packedDSSpec</code> using the <code>OCEPackedDSSpecSize</code> and <code>OCEPackedDSSpec</code> routines.</li></ul><h3>Code Example</h3><p>Here is the code, written in MPW C. You call the <code>ConstructPackedDSSpec</code>routine, passing a valid <code>FSSpec</code> along with a pointer to an empty<code>PackedDSSpecPtr</code> type variable. The code then returns a pointer to avalid <code>PackedDSSpec</code> structure in the <code>packedDSSpecPtr</code>parameter:</p>  <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>  /* global data */#define  kEnumBufferSize  (4096)  /* Working data buffer *//***************************************************************** *    ConstructPackedDSSpec * *     main code that builds a packedDSSpec struct from an FSSpec *     for a Business Card. *****************************************************************/OSErr ConstructPackedDSSpec( FSSpecPtr        fsspecPtr,                             PackedDSSpecPtr  *packedDSSpecPtr ){OSErr            err;unsigned short   packedSpecSize;DSSpec           dsspec;RecordID         rid;RString          name,type;PackedRLI        packedRLI;LocalRecordID    localRID;CreationID       cid;      name.dataLength = kRStringMaxBytes;      type.dataLength = kRStringMaxBytes;      OCENewLocalRecordID(&amp;name,&amp;type,&amp;cid,&amp;localRID);      OCENewRecordID(&amp;packedRLI,&amp;localRID,&amp;rid);      err = GetRecordID(fsspecPtr,                        &amp;rid,                        OCEGetIndRecordType(kBusinessCardRecTypeNum));      if (err == noErr)      {         dsspec.extensionType = kOCEentnDSSpec;         dsspec.extensionSize = 0;         dsspec.extensionValue = NULL;         dsspec.entitySpecifier = &amp;rid;         packedSpecSize = OCEPackedDSSpecSize(&amp;dsspec);         *packedDSSpecPtr = (PackedDSSpecPtr)NewPtr(packedSpecSize);         err = MemError();         if (err == noErr)         {            err = OCEPackDSSpec(&amp;dsspec, *packedDSSpecPtr, packedSpecSize);         }      }    return (err);}/***************************************************************** *    GetRecordID * * *****************************************************************/OSErr GetRecordID( FSSpecPtr     fsspec,                   RecordIDPtr   ridPtr,                   RStringPtr    recordType){OSErr             err;DirParamBlock     pb;    pb.openPersonalDirectoryPB.fsSpec = fsspec;    pb.openPersonalDirectoryPB.accessRequested = fsRdPerm;     /* get reference number for Business Card */    err = DirOpenPersonalDirectory(&amp;pb);    if (err == noErr)    {       err = DoEnumerateGet( pb.openPersonalDirectoryPB.dsRefNum,                             (long)&amp;ridPtr-&gt;local,                             recordType);       if (err == noErr)       {          pb.getNameAndTypePB.identity = 0;          pb.getNameAndTypePB.aRecord = ridPtr;          err = DirGetNameAndType (&amp;pb, false);          if (err == noErr)          {             pb.makePersonalDirectoryRLIPB.fromFSSpec = fsspec;             pb.makePersonalDirectoryRLIPB.pRLIBufferSize = kRLIMaxBytes;             pb.makePersonalDirectoryRLIPB.pRLI = ridPtr-&gt;rli;             err = DirMakePersonalDirectoryRLI(&amp;pb);           }        }        DirClosePersonalDirectory(&amp;pb);     } return (err);}/***************************************************************** *    DoEnumerateGet * * *****************************************************************/OSErr DoEnumerateGet(short        dsRefNum,                     long         clientData,                     RStringPtr   recordType){OSErr          err;RStringPtr     typeList[1];DirParamBlock  dirParamBlock;Ptr            buffer;#define        GET   (dirParamBlock.enumerateGetPB)#define        PARSE (dirParamBlock.enumerateParsePB)   buffer = NewPtr(kEnumBufferSize);   if (buffer == NULL)      err = MemError();   else   {      GET.dsRefNum = dsRefNum;      GET.identity = 0;      GET.aRLI = NULL;    /* ignored if non-zero dsRefNum is passed */      GET.startingPoint = 0;      GET.sortBy = kSortByType;      GET.sortDirection = kSortForwards;      typeList[0] = recordType;      GET.typesList = &amp;typeList;      GET.typeCount = 1;      GET.enumFlags = kEnumPseudonymMask;      GET.includeStartingPoint = true;      GET.matchNameHow = kMatchAll;      GET.matchTypeHow = kExactMatch;      GET.getBuffer = buffer;      GET.getBufferSize = kEnumBufferSize;      err = DirEnumerateGet (&amp;dirParamBlock, false);      if (err == noErr || err == kOCEMoreData)      {         PARSE.clientData = clientData;         PARSE.eachEnumSpec = myForEachDirEnumSpec;         err = DirEnumerateParse (&amp;dirParamBlock, false);      }   }   return (err);#undef GET#undef PARSE}/***************************************************************** *    myForEachDirEnumSpec * * *****************************************************************/static pascal Boolean myForEachDirEnumSpec (long clientData,                                            const DirEnumSpec *enumSpec){OSErr err;   if ((enumSpec-&gt;enumFlag &amp; kEnumPseudonymMask))    {          err = OCECopyLocalRecordID(&amp;enumSpec-&gt;u.recordIdentifier,                                   (LocalRecordIDPtr)clientData);          return (true);  /* stop, we found it */    }    else          return (false);  /* get next one */</pre>	</TD></TR></TABLE></CENTER><a name="References"></a><h2>References:</h2><P><i>Inside Macintosh</i> :<i>AOCE Application Interfaces</i> </p><P><i>Inside Macintosh</i> :<i>Files</i></p><P>Drag Manager Programmer's Guide</p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_28.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_28.html%3Fid%3DDTS10002569-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_28.html%3Fid%3DDTS10002569-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_28.html%3Fid%3DDTS10002569-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>