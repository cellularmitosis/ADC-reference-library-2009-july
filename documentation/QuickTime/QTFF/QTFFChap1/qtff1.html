<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime File Format Specification: Overview of QTFF</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Overview of QTFF"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000939-CH203" title="Overview of QTFF"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> &gt; <a href="../../../../reference/QuickTime/index.html#//apple_ref/doc/uid/TP30001281-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../reference/QuickTime/idxFileFormatSpecification-date.html#//apple_ref/doc/uid/TP30001281-TP30000433-TP30000509" target="_top">File Format Specification</a> &gt; <a href="../QTFFPreface/qtffPreface.html#//apple_ref/doc/uid/TP40000939-CH202-TPXREF101">QuickTime File Format Specification</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../QTFFPreface/qtffPreface.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../QTFFChap2/qtff2.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_16" title="Overview of QTFF"></a><h1><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCGDDDF" title="Overview of QTFF"></a>Overview of QTFF</h1>

<p>QuickTime movies are stored on disk, using two basic
structures for storing information: atoms (also known as simple
atoms or classic atoms), and QT atoms. To understand how QuickTime movies are stored, you need to understand the basic atom structures described in this chapter. Most atoms you encounter
in the QuickTime File Format are simple or classic atoms. Both simple atoms and QT
atoms, however, allow you to construct arbitrarily complex hierarchical data
structures. Both also allow your application to ignore data they don’t understand. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_3">Metadata</a>
				
			<br/>
			
        
			
			
				<a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-39013">Atoms</a>
				
			<br/>
			
        
			
			
				<a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-39017">QT Atoms and Atom Containers</a>
				
			<br/>
			
        
			
			
				<a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-39025">QuickTime Movie Files</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_3" title="Metadata"></a><h2>Metadata</h2><p> A QuickTime file stores the description of its media separately
from the media data. The description, or <strong>metadata</strong>, is called the
movie resource, movie atom, or simply the movie, and contains information
such as the number of tracks, the video compression format, and timing
information. The movie resource also contains an index describing
where all the media data is stored. </p><p>The media data is the actual sample data, such as video frames
and audio samples, used in the movie. The media data may be stored
in the same file as the QuickTime movie, in a separate file, in multiple
files, in alternate sources such as databases or real-time streams, or
in some combination of these.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-39013" title="Atoms"></a><h2>Atoms</h2>
<p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_215"></a>The
basic data unit in a QuickTime file is the atom. Each atom contains
size and type fields that precede any other data. The size field
indicates the total number of bytes in the atom, including the size
and type fields. The type field specifies the type of data stored
in the atom and, by implication, the format of that data. In some
cases, the size and type fields are followed by a version field
and a flags field. An atom with these version and flags fields is
sometimes called a <strong>full atom</strong>.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_17" title="Note"></a><p><strong>Note:</strong>&nbsp;An <strong>atom</strong>,
as described in this document, is functionally identical to a <strong>box</strong>,
as described in the ISO specifications for MPEG-4 and JPEG-2000. An
atom that includes version and flags fields is functionally identical to
a <strong>full box</strong> as defined in those specifications.</p></div>
<p>Atom types are specified by a 32-bit unsigned integer, typically interpreted
as a four-character ASCII code. Apple, Inc. reserves all four-character
codes consisting entirely of lowercase letters. Unless otherwise
stated, all data in a QuickTime movie is stored in big-endian byte
ordering, also known as network byte ordering, in which the most
significant bytes are stored and transmitted first. </p>
<p>Atoms are hierarchical in nature. That is, one atom can contain other
atoms, which can contain still others, and so on. This hierarchy
 is sometimes described in terms of a parent, children, siblings, grandchildren, and
so on. An atom that contains other atoms is called a <strong>container
atom</strong>. The <strong>parent atom</strong> is the container
atom exactly one level above a given atom in the heirarchy.</p>
<p>For example, a movie atom contains several different kinds
of atoms, including one track atom for each track in the movie.
The track atoms, in turn, contain one media atom each, along with
other atoms that define other track characteristics. The movie atom
is the parent atom of the track atoms. The track atoms are siblings.
The track atoms are parent atoms of the media atoms. The movie atom
is <em>not</em> the parent of the media atoms, because
it is more than one layer above them in the hierarchy.</p>
<p>An atom that does not contain other atoms is called a <strong>leaf
atom</strong>, and typically contains data as one or more fields
or tables. Some leaf atoms act as flags or placeholders, however,
and contain no data beyond their size and type fields. </p>
<p>The format of the data stored within a given atom cannot always be
determined by the type field of the atom alone; the type of the
parent atom may also be significant. In other words, a given atom
type can contain different kinds of information depending on its
parent atom. For example, the profile atom inside a movie atom contains
information about the movie, while the profile atom inside a track
atom contains information about the track. This means that all QuickTime
file readers must take into consideration not only the atom type,
but also the atom’s containment hierarchy.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-38190" title="Atom Layout "></a><h3>Atom
Layout </h3>
<p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_216"></a><span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38946">Figure 1-1</a></span> shows
the layout of a sample atom. Each atom carries its own size and
type information as well as its data. Throughout this document,
the name of a container atom (an atom that contains other atoms,
including other container atoms) is printed in a gray box, and the
name of a <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_217"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_218"></a>leaf
atom (an atom that contains no other atoms) is printed in a white
box. Leaf atoms contain data, usually in the form of tables.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-38946" title="Figure 1-1A sample atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCCGGGJ" title="Figure 1-1A sample atom"></a><p><strong>Figure 1-1&nbsp;&nbsp;</strong>A sample atom</p><img src = "../art/qt_l_027.gif" alt = "A sample atom" width="159" height="270"></div><br/>
<p>A leaf atom, as shown in <span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38946">Figure 1-1</a></span>, simply contains a series
of data fields accessible by offsets. </p>
<p>Atoms within container atoms do not generally have to be in
any particular order, unless such an order is specifically called
out in this document. One such example is the handler description
atom, which must come before the data being handled. For example, a
media handler description atom must come before a media information atom,
and a data handler description atom must come before a data information
atom.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-38195" title="Atom Structure"></a><h3>Atom
Structure</h3>
<p>Atoms consist of a header, followed by atom data. The header
contains the atom’s size and type fields, giving the size of the
atom in bytes and its type. It may also contain an extended size
field, giving the size of a large atom as a 64-bit integer. If an
extended size field is present, the size field is set to 1. The
actual size of an atom cannot be less than 8 bytes (the minimum
size of the type and size fields).</p>
<p>Some atoms also contain version and flags fields. These are
sometimes called full atoms. The flag and version fields are not
treated as part of the atom header in this document; they are treated
as data fields specific to each atom type that contains them. Such
fields must always be set to zero, unless otherwise specified.</p>
<p>An atom header consists of the following fields:</p>
<dl class="termdef">	<dt>Atom size</dt>
<dd><p>A 32-bit integer that indicates the size of the atom,
including both the atom header and the atom’s contents, including
any contained atoms. Normally, the <code>size</code> field
contains the actual size of the atom, in bytes, expressed as a 32-bit
unsigned integer. However, the <code>size</code> field
can contain special values that indicate an alternate method of
determining the atom size. (These special values are normally used
only for media data (<a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_219"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_220"></a><code>'mdat'</code>)
atoms.) 

If the <code>size</code> field is
set to 0, which is allowed only for a top-level atom, this is the
last atom in the file and it extends to the end of the file. 

If the <code>size</code> field is
set to 1, then the actual size is given in the <code>extended
size</code> field, an optional 64-bit field that
follows the <code>type</code> field.
This accommodates media data atoms that contain more than 2^32 bytes.

<span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38950">Figure 1-2</a></span> shows
how to calculate the size of an atom.</p></dd>
<dt>Type </dt>
<dd><p>A 32-bit integer that contains the type of the atom.
This can often be usefully treated as a four-character field with
a mnemonic value, such as <code>'moov' (0x6D6F6F76)</code> for
a movie atom, or <code>'trak' (0x7472616B)</code> for
a track atom, but non-ASCII values (such as <code>0x00000001</code>)
are also used.

Knowing an atom's type allows you to interpret its data. An atom's
data can be arranged as any arbitrary collection of fields, tables,
or other atoms. The data structure is specific to the atom type.
An atom of a given type has a defined data structure.

If your application encounters an atom of an unknown type, it should
not attempt to interpret the atom's data. Use the atom's <code>size</code> field
to skip this atom and all of its contents. This allows a degree
of forward compatibility with extensions to the QuickTime file format. </p><div class="warningboxdef"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicondef" /><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_18" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;

The internal structure of a given type of atom can
change when a new version is introduced. Always check the version
field, if one exists. Never attempt to interpret data that falls
outside of the atom, as defined by the Size or Extended Size fields.</p><p></p><div class="clear"></div></div></dd>
<dt>Extended Size</dt>
<dd><p>If the <code>size</code> field
of an atom is set to 1, the <code>type</code> field
is followed by a 64-bit <code>extended size</code> field,
which contains the actual size of the atom as a 64-bit unsigned
integer. This is used when the size of a media data atom exceeds 2^32
bytes. </p></dd></dl>
<p>When the <code>size</code> field
contains the actual size of the atom, the <code>extended
size</code> field is not present. This means that
when a QuickTime atom is modified by adding data, and its size crosses
the 2^32 byte limit, there is no <code>extended size</code> field
in which to record the new atom size. Consequently, it is not always
possible to enlarge an atom beyond 2^32 bytes without copying its
contents to a new atom. </p>
<p>To prevent this inconvenience, media data atoms are typically
created with a 64-bit placeholder atom immediately preceding them
in the movie file. The placeholder atom has a type of <code>kWideAtomPlaceholderType</code> (<code>'wide'</code>).
Much like a <code>'free'</code> or <code>'skip'</code> atom,
the <code>'wide'</code> atom is reserved
space, but in this case the space is reserved for a specific purpose.
If a <code>'wide'</code> atom immediately
precedes a second atom, the second atom can be extended from a 32-bit
size to a 64-bit size simply by starting the atom header 8 bytes
earlier (overwriting the <code>'wide'</code> atom),
setting the <code>size</code> field
to 1, and adding an <code>extended size</code> field.
This way the offsets for sample data do not need to be recalculated.</p>
<p>The<code> 'wide' </code>atom
is exactly 8 bytes in size, and consists solely of its <code>size</code> and <code>type</code> fields.
It contains no other data.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_19" title="Note"></a><p><strong>Note:</strong>&nbsp;A common error
is thinking that the <code>'wide'</code> atom
contains the extended size. The <code>'wide'</code> atom
is merely a placeholder that can be overwritten if necessary, by
an atom header containing an <code>extended size</code> field.</p></div>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-38950" title="Figure 1-2Calculating atom sizes"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCGAAAH" title="Figure 1-2Calculating atom sizes"></a><p><strong>Figure 1-2&nbsp;&nbsp;</strong>Calculating atom sizes</p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_221"></a>
<img src = "../art/qt_l_210.gif" alt = "Calculating atom sizes" width="517" height="169"></div><br/>
<a name="//apple_ref/doc/uid/TP40000939-CH203-39017" title="QT Atoms and Atom Containers"></a><h2>QT
Atoms and Atom Containers</h2>
<p> <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_222"></a>QT atoms are an
enhanced data structure that provide a more general-purpose storage format
and remove some of the ambiguities that arise when using simple
atoms. A QT atom has an expanded header; the size and type fields
are followed by fields for an atom ID and a count of child atoms.</p>
<p>This allows multiple child atoms of the same type to be specified
through identification numbers. It also makes it possible to parse
the contents of a QT atom of unknown type, by walking the tree of
its child atoms.</p>
<p>QT atoms are normally wrapped in an <strong>atom container</strong>,
a data structure with a header containing a lock count. Each atom
container contains exactly one <strong>root</strong> atom, which
is the QT atom. Atom containers are not atoms, and are not found
in the hierarchy  of atoms that makes up a QuickTime movie file.
Atom containers may be found as data structures inside some atoms,
however. Examples include media input maps and media property atoms.</p>
<div class="importantbox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_20" title="Important:"></a><p><strong>Important:</strong>&nbsp;
An <strong>atom container</strong> is <em>not</em> the
same as a <strong>container atom</strong>. An atom container is
a <em>container</em>, not an atom.</p><p></p></div>
<p><span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38956">Figure 1-3</a></span> depicts the layout of a QT atom. Each QT atom starts
with a QT atom container header, followed by the root atom. The
root atom’s type is the QT atom’s type. The root atom contains
any other atoms that are part of the structure. </p>
<p>Each container atom starts with a QT atom header followed
by the atom’s contents. The contents are either child atoms or
data, but never both. If an atom contains children, it also contains
all of its children’s data and descendents. The root atom is always
present and never has any siblings.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-38956" title="Figure 1-3QT atom layout"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCCDHEJ" title="Figure 1-3QT atom layout"></a><p><strong>Figure 1-3&nbsp;&nbsp;</strong>QT atom layout</p><img src = "../art/qt_l_200.gif" alt = "QT atom layout" width="164" height="450"></div><br/>
<p>A QT atom container header contains the following data:</p>
<dl class="termdef">	<dt>Reserved</dt>
<dd><p>A 10-byte element that must be set to 0.</p></dd>
<dt>Lock count</dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd></dl>
<p>Each QT atom header contains the following data:</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>A 32-bit integer that indicates the size of the atom
in bytes, including both the QT atom header and the atom’s contents.
If the atom is a leaf atom, then this field contains the size of
the single atom. The size of container atoms includes all of the
contained atoms. You can walk the atom tree using the size and child
count fields. </p></dd>
<dt>Type </dt>
<dd><p>A 32-bit integer that contains the type of the atom.
If this is the root atom, the type value is set to <code>'sean'</code>.</p></dd>
<dt>Atom ID</dt>
<dd><p>A 32-bit integer that contains the atom’s ID value.
This value must be unique among its siblings. The root atom always
has an atom ID value of 1.</p></dd>
<dt>Reserved</dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd>
<dt>Child count</dt>
<dd><p>A 16-bit integer that specifies the number of child
atoms that an atom contains. This count only includes immediate
children. If this field is set to 0, the atom is a leaf atom and
only contains data.</p></dd>
<dt>Reserved</dt>
<dd><p>A 32-bit integer that must be set to 0.</p></dd></dl>
<a name="//apple_ref/doc/uid/TP40000939-CH203-56068" title="QT Atom Containers"></a><h3>QT
Atom Containers</h3>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_223"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_224"></a>QuickTime
atom container is a basic structure for storing information in QuickTime.
An atom container is a tree-structured hierarchy of QT atoms. You
can think of a newly created QT atom container as the root of a
tree structure that contains no children.</p>
<p>An atom container is a container, not an atom. It has a reserved
field and a lock count in its header, not a size field and type
field. Atom containers are not found in the atom hierarchy of a
QuickTime movie file, because they are not atoms. They may be found
as data inside some atoms, however, such as in media input maps,
media property atoms, video effects sample data, and tween sample
data.</p>
<p>A <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_225"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_226"></a>QT atom
container contains QT atoms, as shown in <span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-56103">Figure 1-4</a></span>. Each QT atom contains either
data or other atoms. If a QT atom contains other atoms, it is a <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_227"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_228"></a>parent atom
and the atoms it contains are its <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_229"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_230"></a>child atoms. Each
parent’s child atom is uniquely identified by its atom type and <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_231"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_232"></a>atom ID. A QT
atom that contains data is called a <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_233"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_234"></a>leaf atom.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-56103" title="Figure 1-4QT atom container with parent and child atoms"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCFDABB" title="Figure 1-4QT atom container with parent and child atoms"></a><p><strong>Figure 1-4&nbsp;&nbsp;</strong>QT atom container with parent and
child atoms</p><img src = "../art/qtml_05.gif" alt = "QT atom container with parent and child atoms" width="348" height="231"></div><br/>
<p>Each QT atom has an offset that describes the atom’s position
within the QT atom container. In addition, each QT atom has a type
and an ID. The atom type describes the kind of information the atom
represents. The atom ID is used to differentiate child atoms of
the same type with the same parent; an atom’s ID must be unique
for a given parent and type. In addition to the atom ID, each atom
has a 1-based index that describes its order relative to other child
atoms of the same parent with the same atom type. You can uniquely identify
a QT atom in one of three ways:</p>
<ul class="spaceabove"><li class="li"><p>By its offset within its QT atom container</p></li>
<li class="li"><p>By its parent atom, type, and index</p></li>
<li class="li"><p>By its parent atom, type, and ID</p></li></ul>
<p>You can store and retrieve atoms in a QT atom container by
index, ID, or both. For example, to use a QT atom container as a
dynamic array or tree structure, you can store and retrieve atoms
by index. To use a QT atom container as a database, you can store
and retrieve atoms by ID. You can also create, store, and retrieve
atoms using both ID and index to create an arbitrarily complex,
extensible data structure.</p>
<div class="warningbox"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_21" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
Since QT atoms are offsets into a data structure, they
can be changed during editing operations on QT atom containers,
such as inserting or deleting atoms. For a given atom, editing child atoms
is safe, but editing sibling or parent atoms invalidates that atom’s
offset.</p><p></p><div class="clear"></div></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_22" title="Note"></a><p><strong>Note:</strong>&nbsp;For cross-platform
purposes, all data in a QT atom is expected to be in big-endian
format. However, leaf data can be little-endian if it is custom
to an application.</p></div>
<p><span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-56196">Figure 1-5</a></span> shows a QT atom container that has two child atoms.
The first child atom (offset = 10) is a leaf atom that has an atom
type of <code>'abcd'</code>, an ID
of 1000, and an index of 1. The second child atom (offset = 20)
has an atom type of <code>'abcd'</code>,
an ID of 900, and an index of 2. Because the two child atoms have
the same type, they must have different IDs. The second child atom
is also a parent atom of three atoms.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-56196" title="Figure 1-5A QT atom container with two child atoms"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCIJFAJ" title="Figure 1-5A QT atom container with two child atoms"></a><p><strong>Figure 1-5&nbsp;&nbsp;</strong>A QT atom container with two child
atoms</p><img src = "../art/qtml_06.jpg" alt = "A QT atom container with two child atoms" ></div><br/>
<p>The first child atom (offset = 30) has an atom type of <code>'abcd'</code>,
an ID of 100, and an index of 1. It does not have any children,
nor does it have data. The second child atom (offset = 40) has an
atom type of <code>'word'</code>,
an ID of 100, and an index of 1. The atom has data, so it is a leaf atom.
The second atom (offset = 40) has the same ID as the first atom
(offset = 30), but a different atom type. The third child atom (offset
= 50) has an atom type of <code>'abcd'</code>,
an ID of 1000, and an index of 2. Its atom type and ID are the same
as that of another atom (offset = 10) with a different parent.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_23" title="Note"></a><p><strong>Note:</strong>&nbsp;If you are working
with the QuickTime API, you do not need to parse QT atoms. Instead,
the QT atom functions can be used to create atom containers, add
atoms to and remove atoms from atom containers, search for atoms
in atom containers, and retrieve data from atoms in atom containers. </p></div>
<p>Most QT atom functions take two parameters to specify a particular
atom: the atom container that contains the atom, and the offset
of the atom in the atom container data structure. You obtain an
atom’s offset by calling either <code>QTFindChildByID</code> or <code>QTFindChildByIndex</code>.
An atom’s offset may be invalidated if the QT atom container that contains
it is modified.</p>
<p>When calling any QT atom function for which you specify a
parent atom as a parameter, you can pass the constant <code>kParentAtomIsContainer</code> as
an atom offset to indicate that the specified parent atom is the
atom container itself. For example, you would call the <code>QTFindChildByIndex</code> function
and pass <code>kParentAtomIsContainer</code> constant
for the parent atom parameter to indicate that the requested child
atom is a child of the atom container itself.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-39025" title="QuickTime Movie Files"></a><h2>QuickTime
Movie Files</h2>
<p>The QuickTime file format describes the characteristics of
QuickTime movie files. A QuickTime movie file contains a QuickTime
movie resource, or else points to one or more external sources using
movie references. The media samples used by the movie (such as video
frames or groups of audio samples) may be included in the movie
file, or may be external to the movie file in one or more files,
streams, or other sources.</p>
<p>A QuickTime movie is not limited to video and audio; it may
use any subset or combination of media types that QuickTime supports,
including video, sound, still images, text, Flash, 3D models, and
virtual reality panoramas. It supports both time-based and nonlinear
interactive media.</p>
<p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_235"></a>In
file systems that support filename extensions, QuickTime movie files
should have an extension of <code>.mov</code>.
On the Macintosh platform, QuickTime files have a Mac OS file type
of <code>'MooV'</code>. QuickTime
movie files should always be associated with the <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_236"></a>MIME type <code>"video/quicktime"</code><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_237"></a>,
whether or not the movie contains video. </p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_24" title="Note"></a><p><strong>Note:</strong>&nbsp;In file systems
that support both a resource fork and a data fork, the movie resource
may be contained in the resource fork. The default, however, is
for the movie resource to be contained in the data fork for all
file systems. If media sample data is included in the movie file,
it is always in the data fork.</p></div>
<p>A QuickTime movie file is structured as a collection of atoms that together identify the file as a QuickTime movie, describe
the structure of the movie, and may contain the sample data
needed to play the movie. Not all atoms are required. </p>
<p>The file format is extensible, and from time to time new atom
types are introduced. If your application encounters an unknown
atom type in a QuickTime file, it should simply ignore it. This
allows the file format to be extended without breaking existing
applications, and provides a measure of forward compatibility. Because
the first field in any atom contains its size, including any contained
atoms, it is easy to skip to the end of an unknown atom type and
continue parsing the file.</p>
<p>Generally speaking, atoms can be present in any order. Do
not conclude that a particular atom is not present until you have
parsed all the atoms in the file.</p>
<p>An exception is the file type atom, which typically identifies
the file as a QuickTime movie. If present, this atom precedes any
movie atom, movie data, preview, or free space atoms. If you encounter
one of these other atom types prior to finding a file type atom,
you may assume the file type atom is not present. (This atom is
introduced in the <em>QuickTime File Format Specification</em> for 2004,
and is not present in QuickTime movie files created prior to 2004). </p>
<p>While other atoms can be in any order, unless specified in
this document, for practical reasons there is a recommended order
you should use when creating a QuickTime movie file. For example,
the atom containing the movie resource should precede any atoms containing
the movie's sample data. If you follow this recommended atom order,
it is possible to play a movie over a network while the movie file
is in the process of downloading.</p>
<p>A QuickTime movie file must contain a movie atom, which contains
either the movie structure or a reference to one or more alternate
movie sources external to the file. Generally speaking, these alternate
sources will be QuickTime movie files that contain movie structures.</p>
<p>A QuickTime movie file typically contains one or more movie
data atoms, which contain media sample data such as video frames
and groups of audio samples. There may be no movie data atoms in
the file, however, as the movie may depend on sample data external to
the movie file, such as external data files or live streams on the
Internet. A single movie data atom may contain sample data for a
variety of different media. Generally speaking, it is possible to
contain all the media samples used by a movie in a single movie
data atom. Movie data atoms can be quite large, and sometimes exceed
2^32 bytes.</p>
<p><span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38968">Figure 1-6</a></span> shows the essential atom types in a QuickTime movie file within which other atoms are stored. In addition, the file may contain free space atoms, preview
atoms, and other atoms not enumerated in this file format specification.
Unknown atom types should be ignored.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-38968" title="Figure 1-6The structure of a QuickTime movie file"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCCDGFD" title="Figure 1-6The structure of a QuickTime movie file"></a><p><strong>Figure 1-6&nbsp;&nbsp;</strong>The structure of a QuickTime movie file</p>
<img src = "../art/qtff_07.gif" alt = "The structure of a QuickTime movie file" width="175" height="381"></div><br/>
<p><span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-42897">Table 1-1</a></span> lists the basic atom types. </p><a name="//apple_ref/doc/uid/TP40000939-CH203-42897" title="Table 1-1Basic atom types of a QuickTime file"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-TPXREF101" title="Table 1-1Basic atom types of a QuickTime file"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<caption class="tablecaption"><strong>Table 1-1&nbsp;&nbsp;</strong>Basic atom types of a QuickTime file</caption>

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Atom type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use</p></th>
</tr>


<tr>
<td  scope="row"><p><code>'ftyp'</code></p></td>
<td ><p>File type compatibility—identifies the file type and
differentiates it from similar file types, such as MPEG-4 files
and JPEG-2000 files.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_238"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_239"></a><code>'moov'</code></p></td>
<td ><p>Movie resource metadata about the movie (number and type
of tracks, location of sample data, and so on). Describes where
the movie data can be found and how to interpret it.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_240"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_241"></a><code>'mdat'</code></p></td>
<td ><p>Movie sample data—media samples such as video frames
and groups of audio samples. Usually this data can be interpreted
only by using the movie resource.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_242"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_243"></a><code>'free'</code></p></td>
<td ><p>Unused space available in file.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_244"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_245"></a><code>'skip'</code></p></td>
<td ><p>Unused space available in file.</p></td>
</tr>
<tr>
<td  scope="row"><p>'<code><a href="../../Reference/QTRef_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/wide" target="_top">wide</a></code>'</p></td>
<td ><p>Reserved space—can be overwritten by an extended size
field if the following atom exceeds 2^32 bytes, without displacing
the contents of the following atom.</p></td>
</tr>
<tr>
<td  scope="row"><p><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_246"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_247"></a><code>'pnot'</code></p></td>
<td ><p>Reference to movie preview data.</p></td>
</tr>

</table></div>
<p>The following sections describe these basic atom types (except
for the movie atom) in more detail, including descriptions of other
atoms that each basic atom may contain. The movie atom is described separately
in <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-SW1">“Movie Atoms”</a></span></p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-54179" title="The File Type Compatibility Atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-CJBCBIFF" title="The File Type Compatibility Atom"></a><h3>The
File Type Compatibility Atom</h3><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_248"></a>
<p>The file type atom allows the reader to determine whether
this is a type of file that the reader understands. Specifically,
the file type atom identifies the file type specifications the file
is compatible with. This allows the reader to distinguish among
closely related file types, such as QuickTime movie files, MPEG-4, and
JPEG-2000 files (all of which may contain file type atoms, movie
atoms, and movie data atoms). </p>
<p>When a file is compatible with more than one specification,
the file type atom lists all the compatible types and indicates
the preferred brand, or best use, among the compatible types. For
example, a music player using a QuickTime-compatible file format might
identify a file’s best use as a music file for that player but
also identify it as a QuickTime movie.</p>
<p>The file type atom serves a further purpose of distinguishing
among different versions or specifications of the same file type,
allowing it to convey more information than the file extension or
MIME type alone. The file type atom also has the advantage of being
internal to the file, where it is less subject to accidental alteration
than a file extension or MIME type.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_25" title="Note"></a><p><strong>Note:</strong>&nbsp;The file type
atom described here is functionally identical to the file type box
defined in the ISO specifications for MPEG-4 and JPEG-2000.</p></div>
<p>The file type atom is optional, but strongly recommended.
If present, it must be the first significant atom in the file, preceding
the movie atom (and any free space atoms, preview atom, or movie
data atoms).</p>
<p>The file type atom has an atom type value of <code>'ftyp'</code> and
contains the following fields:</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>A 32-bit unsigned integer that specifies the number
of bytes in this atom. </p></dd>
<dt>Type</dt>
<dd><p>A 32-bit unsigned integer that identifies the atom type,
typically represented as a four-character code; this field must
be set to <code>'ftyp'. </code></p></dd>
<dt>Major_Brand</dt>
<dd><p>A 32-bit unsigned integer that should be set to <code>'qt
'</code> (note the two trailing ASCII space characters)
for QuickTime movie files. If a file is compatible with multiple
brands, all such brands are listed in the <em>Compatible_Brands</em> fields,
and the <em>Major_Brand</em> identifies the
preferred brand or best use.</p></dd>
<dt>Minor_Version</dt>
<dd><p>A 32-bit field that indicates the file format specification
version. For QuickTime movie files, this takes the form of four
binary-coded decimal values, indicating the century, year, and month
of the <em>QuickTime File Format Specification</em>, followed by a binary
coded decimal zero. For example, for the June 2004 minor version,
this field is set to the BCD values <code>20 04 06 00</code>.</p></dd>
<dt>Compatible_Brands[ ]</dt>
<dd><p>A series of unsigned 32-bit integers listing compatible
file formats. The major brand must appear in the list of compatible
brands. One or more “placeholder” entries with value zero are
permitted; such entries should be ignored.</p></dd></dl>
<p>If none of the Compatible_Brands fields is set to <code>'qt
'</code>, then the file is not a QuickTime movie file and is
not compatible with this specification. Applications should return
an error and close the file, or else invoke a file importer appropriate
to one of the specified brands, preferably the major brand. QuickTime
currently returns an error when attempting to open a file whose
file type, file extension, or MIME type identifies it as a QuickTime
movie, but whose file type atom does not include the <code>'qt
'</code> brand.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_26" title="Note"></a><p><strong>Note:</strong>&nbsp;A common source
of this error is an MPEG-4 file incorrectly named with the <code>.mov</code> file extension
or with the MIME type incorrectly set to “video/quicktime”.
MPEG-4 files are automatically imported by QuickTime only when they
are correctly identified as MPEG-4 files using the Mac OS file type,
file extension, or MIME type.</p></div>
<p>If you are creating a file type that is fully compatible with
the QuickTime file format, one of the Compatible_Brand fields must
be set to <code>'qt '</code>; otherwise QuickTime
will not recognize the file as a QuickTime movie. </p>
<div class="warningbox"><img src="../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_27" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
Use of the QuickTime file format in this manner is
subject to license from Apple, Inc.</p><p></p><div class="clear"></div></div>
<a name="//apple_ref/doc/uid/TP40000939-CH203-55464" title="Free Space Atoms"></a><h3>Free Space Atoms</h3><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_249"></a>
<p>Both <code><!--a  -->free<!--/a--></code> and <code><!--a  -->skip<!--/a--></code> atoms
designate unused space in the movie data file. These atoms consist
of only an atom header (size and type fields), followed by the appropriate
number of bytes of free space. When reading a QuickTime movie, your
application may safely skip these atoms. When writing or updating
a movie, you may reuse the space associated with these atom types. </p>
<p>A <code><a href="../../Reference/QTRef_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/wide" target="_top">wide</a></code> atom typically precedes
a movie data atom. The <code><a href="../../Reference/QTRef_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/wide" target="_top">wide</a></code> atom
consists only of a type and size field. This occupies 8 bytes—enough
space to add an extended size field to the header of the atom that
follows, without displacing the contents of that atom. If an atom grows
to exceed 2^32 bytes in size, and it is preceded by a <code><a href="../../Reference/QTRef_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/wide" target="_top">wide</a></code> atom,
you may create a new atom header containing an extended size field
by overwriting the existing atom header and the preceding <code><a href="../../Reference/QTRef_DataTypes/Reference/reference.html#//apple_ref/doc/c_ref/wide" target="_top">wide</a></code> atom. </p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-55478" title="Movie Data Atoms"></a><h3>Movie
Data Atoms</h3>
<p>As with the free and skip atoms, the <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_250"></a>movie data atom is structured quite
simply. It consists of an atom header (atom size and type fields),
followed by the movie’s media data. Your application can understand
the data in this atom only by using the metadata stored in the movie
atom. This atom can be quite large, and may exceed 2^32 bytes, in
which case the size field will be set to 1, and the header will
contain a 64-bit extended size field.</p>
<a name="//apple_ref/doc/uid/TP40000939-CH203-38240" title="Preview Atoms"></a><h3>Preview
Atoms</h3>
<p>The <a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_251"></a>preview
atom contains information that allows you to find the preview image associated
with a QuickTime movie. The preview image, or poster, is a representative image
suitable for display to the user in, for example, Open dialog boxes. <span class="content_text"><a href="qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-38972">Figure 1-7</a></span> depicts the
layout of the preview atom.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40000939-CH203-38972" title="Figure 1-7The layout of a preview atom"></a><a name="//apple_ref/doc/uid/TP40000939-CH203-BBCGFDFE" title="Figure 1-7The layout of a preview atom"></a><p><strong>Figure 1-7&nbsp;&nbsp;</strong>The layout of a preview atom</p>
<img src = "../art/qt_l_201.gif" alt = "The layout of a preview atom" width="198" height="186"></div><br/>
<p>The preview atom has an atom type value of <code>'pnot'</code> and,
following its atom header, contains the following fields:</p>
<dl class="termdef">	<dt>Size</dt>
<dd><p>A 32-bit integer that specifies the number of bytes
in this preview atom. </p></dd>
<dt>Type</dt>
<dd><p>A 32-bit integer that identifies the atom type; this
field must be set to <code>'pnot'. </code></p></dd>
<dt>Modification date</dt>
<dd><p>A 32-bit unsigned integer containing a date that indicates
when the preview was last updated. The data is in standard Macintosh
format. </p></dd>
<dt>Version number</dt>
<dd><p>A 16-bit integer that must be set to 0.</p></dd>
<dt>Atom type</dt>
<dd><p>A 32-bit integer that indicates the type of atom that
contains the preview data. Typically, this is set to <code>'PICT'</code> to
indicate a QuickDraw picture.</p></dd>
<dt>Atom index</dt>
<dd><p>A 16-bit integer that identifies which atom of the specified
type is to be used as the preview. Typically, this field is set
to 1 to indicate that you should use the first atom of the type
specified in the atom type field.</p></dd></dl>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000939-CH203-DontLinkElementID_28" title="Note"></a><p><strong>Note:</strong>&nbsp;This specification
defines the preview atom primarily for backward compatibility. Current
practice is normally to define movie previews by placing information
in the movie header atom. See <span class="content_text"><a href="../QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-56313">“Movie Header Atoms.”</a></span></p></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../QTFFPreface/qtffPreface.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../QTFFChap2/qtff2.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-09-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/QTFF/QTFFChap1/qtff1.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/QTFF/QTFFChap1/qtff1.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/QTFF/QTFFChap1/qtff1.html%3Fid%3DTP40000939-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>