<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1108: Unknown Sound Features</title>       <meta name="keywords" content="Mac OS 8 Sound Manager features volume panning channels multiple">    <meta name="Description" content="Technical Note TN1108: This Technical Note documents themore obscure features of the                                    Sound Manager. The Sound Manager features that thisTechnote talks about are:   Multiple Sound Output channels,Multiple Sound Input Channels, Volume and Panning, and  Monitoring a Sound Channel."><meta name="categories" content="Sound"><meta name="week-posted" content="Sep 29, 1997 - Oct 3, 1997"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002948" title="Unknown Sound Features"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/idxMusicAudio-date.html" target="_blank">Hardware & Drivers > Audio</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1108</div>
<div id="pageheadsub">Unknown Sound Features</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><center><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">          <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><p id="menutext">         <A HREF = "#Section1">The little known features of the Sound Manager</A><BR><BR>         <A HREF = "#Section2">Multiple Sound Output Channels</A><BR><BR>                  <A HREF = "#Section3">Multiple Sound Input Channels</A><BR><BR>                  <A HREF = "#Section4">Volume and Panning</A><BR><BR>                  <A HREF = "#Section5">Monitoring a Sound Channel</A><BR><BR>                  <A HREF = "#Summary">Summary</A><br><BR>         <A HREF="#References">References</a><BR><BR>                              <A HREF="#Downloads">Downloadables</A></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left>			<!-- begin_intro_text --><p id="introtext">Many developers have complained          about features they felt were lacking in the Sound Manager.  However,          many features which were believed to be lacking were actually available,          just under documented.  This Technote is meant to document the more obscure          features of the Sound Manager.</p>         <p id="introtext">This Technote is directed at application and hardware developers who workwith the Sound Manager and want to be sure that they are getting the mostout of the Sound Manager and their products.</p> <BR><BR><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 06 1998]</h3><!-- end_date -->        </td>    </tr></table> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content -->         <A NAME="Section1"></A><H2>The little known features of the Sound Manager</H2>The Sound Manager features that this Technote talks about are:<BR><A HREF = "#Section2">Multiple Sound Output channels</A><P>How to output more than just a stereo sound. Using the techniques talkedabout here an application can simultaneously output sound on as many channelsas the Macintosh has.</p><A HREF = "#Section3">Multiple Sound Input Channels</A><P>How to record more than just a stereo sound. Using the techniques talkedabout here, an application can simultaneously record sound via as many inputsources as the Macintosh has.</p><A HREF = "#Section4">Volume and Panning</A><P>How you can perform snazzy audio effects.</p><A HREF = "#Section5">Monitoring a Sound Channel</A><P>How to use sound components to monitor the sound output level of a particularsound channel.</p> <BR><P><A HREF="#top">Back to top</A></P><A NAME="Section2"></A>                  <H2>Multiple Sound Output Channels</H2>                  <P>The Sound Manager has supported this starting with Sound Manager 3.0          which shipped with System 7.0.  <I>Inside Macintosh: Sound</I> page 2-128 mentions          this feature but doesn't describe how it is used.</P>                  <P>When you call <CODE>SndNewChannel</CODE> one of the parameters passed is a          long, which          specifies the initialization parameters for the channel.  Normally, developers          just pass nil, or <CODE>initMono</CODE> or <CODE>initStereo</CODE>, but you can          also pass          <CODE>kUseOptionalOutputDevice</CODE> (which is defined to be -1).</p>        <P>The use of <CODE>kUseOptionalOutputDevice</CODE> will allow you to specify a         different         output component to have the sound played through.  With <CODE>kUseOptionalOutputDevice</CODE>,         a developer is able to play sounds simultaneously on as many output devices as         are installed.  For instance, a hardware developer who has a six-channel card         could make three stereo output components (one for each pair of output channels)         and the <CODE>kUseOptionalOutputDevice</CODE> selector would allow developers writing software         to this card to play three stereo sounds simultaneously.</p>        <P>The <CODE>kUseOptionalOutputDevice</CODE> selector works like this:</p>         <P>First, you have to find the component instance of the output component          you wish to use (this example finds the AIFF Writer sample output component):</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>    //Find our output component's instance    outputDev.componentType = 'sdev';    outputDev.componentSubType = 'AIFW';    outputDev.componentManufacturer = 'appl';    outputDev.componentFlags = 0;    outputDev.componentFlagsMask = 0;    theAIFWComponent = FindNextComponent (0, &amp;outputDev);</pre></TD></TR></TABLE></CENTER><BR><BR>        <P>A generic routine to find all sound output components such as:</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>    long FindAllsdevs (Component ** componentsArray) {    Component                   foundComponent,                                aComponent;    ComponentDescription        looking;    long                        numComponents,                                i;    aComponent                      = 0;    looking.componentType           = kSoundOutputDeviceType; // 'sdev'    looking.componentSubType        = 0;    looking.componentManufacturer   = 0;    looking.componentFlags          = 0;    looking.componentFlagsMask      = 0;    numComponents = CountComponents (&amp;looking);    *componentsArray = (Component*)NewPtr (sizeof (Component) * numComponents);    if (componentsArray == nil) {        numComponents = 0;      // won't be able to list them anyway    }    for (i = 0; i &lt; numComponents; i++) {        foundComponent = FindNextComponent (aComponent, &amp;looking);        (*componentsArray)[i] = foundComponent;        aComponent = foundComponent;    // continue looking    }    return numComponents;}</pre></TD></TR></TABLE></CENTER><BR><BR><P>would be used to present the user with a list of sound output channels so that they could output multi-channel (greater than 2 channel) sounds without the sound having to be mixed down to two channels.</p><P>Now, all that is left to do is to make a new sound channel which will use the selected output device:</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>err = SndNewChannel (&amp;theOptionalOutputChan, kUseOptionalOutputDevice,     (long)theAIFWComponent, nil);</pre></TD></TR></TABLE></CENTER><BR><BR><P>This is all there is to it.  Whenever a sound is played through <CODE>theOptionalOutputChan </CODE>the sound will not go to the built-in hardware: instead, it will go to the AIFF Writer output device (which could just as easily be the third and fourth channels of a multiple-channel output card).</p><P>So, what does a developer of multiple-channel hardware have to do to allow the use of the <CODE>theOptionalOutputChan</CODE> selector?</p><P>Not much.  All that has to be done is to make an output component for each pair of output channels the hardware supports. If your hardware has only two channels, one output component is all that is needed. If your hardware has 20 output channels, 10 output components would be required.</p><P>I can almost hear developers now: "Ten output components?!?  Are you crazy?!?"</p><P>No. Because of the reusability inherent to components, all that is really required is ten '<CODE>thng</CODE>' resources that register the same output component ten times as if it was ten different output components.</p><P>The output component should be written in such a way that the actual hardware channels it outputs to are abstracted: that way, one code base can talk to all available channels.  The output component just looks at itself at register time to determine which output channels it controls and saves this information in its globals.  The additional code required is very minor: just enough code to keep track of which channels to output on.</p>                <B>Note:</B><BR> You can get the Speech Manager to talk through an optional output channel as well.  Call <CODE>NewSpeechChannel</CODE> as you normally would and then call <CODE>SetSpeechInfo</CODE> with the <CODE>soSoundOutput</CODE> selector and the component instance of the output component:<BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>err = SetSpeechInfo (theAIFWSpeechChan, soSoundOutput, &amp;theAIFWComponent);</pre></TD></TR></TABLE></CENTER><BR><BR> <BR><P><A HREF="#top">Back to top</A></P>         <A NAME="Section3"></A>                  <H2>Multiple Sound Input Channels</H2>                  <P>This works in much the same way as multiple sound output channels.          The difference is, with sound input, a driver is required rather than a component.</P>                  <p>Because an application can open as many sound input drivers as are available,          all that an application must do is call <CODE>SPBOpenDevice</CODE> multiple times,          each time with          the name of each sound input drivers.</p>         <P>The Sound Manager provides a call which allows a developer to easily          enumerate all the available sound input drivers.</p>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>SPBGetIndexedDevice (index, drvrName, &amp;drvrIcon);</pre></TD></TR></TABLE></CENTER><BR><BR>        <P>By pass an index starting at one (1) and incrementing it until an error          is returned, you can quickly and easily build a list of all available sound          input drivers.</p>         <H3>The QuickTime Way</H3>                  <P>You can also simply use, QuickTime to do your recording by using the          Sequence Grabber to set the input source and do the recording.</p>         <P>This code will bring up the QuickTime sequence grabber sound input panel:</p>                <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>    ComponentResult     err;    SGChannel           sgSoundChanRef;    SeqGrabComponent    sgComponent;    sgComponent = OpenDefaultComponent (SeqGrabComponentType, 0);    err = SGInitialize (sgComponent);    if (err == noErr) {        err = SGNewChannel (sgComponent, SoundMediaType, &amp;sgSoundChanRef);    }    if (err == noErr) {        err = SGSettingsDialog (sgComponent, sgSoundChanRef, 0, nil, 0L, nil, nil);    }    return err;}</pre></TD></TR></TABLE></CENTER><BR><BR><P><img src="images/tn1108_001.gif" alt="Sound Source" width=492 height=228></P><P>One of the nice features of using QuickTime to record sounds is that QuickTime will rate: convert a sound for you, so that you can effectively record at any arbitrary sample rate, instead of being limited to recording at the sample rates that the specific sound input driver offers.</p><P>Making multiple sound input drivers for a hardware vendor is a little more work for the developer, who has to completely duplicate the driver: but that is what is required.</p> <BR><P><A HREF="#top">Back to top</A></P><A NAME="Section4"></A>                  <H2>Volume and Panning</H2>                  <P>Adjusting the volume of a sound playing through the Sound Manager          can be done with <CODE>volumeCmd</CODE> issued with a <CODE>SndDoImmediate</CODE>          call as          this code demonstrates:</P>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>    SndCommand      theCmd;    UInt16      rightVol, leftVol;    theCmd.cmd = volumeCmd;    theCmd.param2 = (rightVol &lt;&lt; 16) | leftVol;    err = SndDoImmediate(chan, &amp;theCmd);</pre></TD></TR></TABLE></CENTER><BR><BR>                          <P>The left and right volumes are actually 16-bit fixed point numbers.           Like their 32-bit counterpart, the high 8 bits are the integer portion          of the volume and the low 8 bits are the fractional portion of the volume.           For example, a volume setting of <CODE>0x01000100</CODE> would be full volume on both          channels, while a setting of <CODE>0x01000080</CODE> would be full volume on the right          channel and half volume on the left channel.</p>         <P>A timed sequence of such calls with increasing values for the left volume and          decreasing values for the right volume would make the sound pan from left          to right.</p>         <P>Some developers may be asking, "What happens if I set the volume for a channel          above <CODE>0x0100</CODE>?"  The answer is: the sound gets louder.  That's right, with          <CODE>volumeCmd</CODE> you can overdrive the sound level for that loud crunchy sound so many          rockers look for.</p><H3>The QuickTime Way</H3><P>Another (probably better) way to control the volume and panning of sounds is to use QuickTime, The utility knife. Using QuickTime 2.1 modifiers track allows you to play sounds with complex effects.</p><H3>Tween Media handlers</H3><P>Using the Tween Media handlers supplied by QuickTime 2.5, developers only need to specify the start and stop volume values for each sound channel; the Tween component generates all the intermediate volume values.  This is in contrast with QuickTime 2.1, which did not have the Tween Media handlers; volume pans would have to be done with numerous discrete values.  The Tween Media handlers simplify things by allowing the developer to simply specify start and stop values; the Tween Media handler takes care of coming up with the correct discrete value as the movie (sound) progresses.</p><P>For more information about how to use Tween Media handlers, see chapter 13 of the <A HREF = "ftp://ftp-applenet.apple.com/pub/quicktime/qt_25_developers_guide.pdf.hqx">"Developer'sGuide: QuickTime for Macintosh version 2.5".</A></p><P>Modifier tracks are talked about in <A HREF = "ftp://ftp-applenet.apple.com/pub/quicktime/qt_25_developers_guide.pdf.hqx">"Developer'sGuide: QuickTime for Macintosh version 2.5"</A> starting on page 1-21.</p> <BR><P><A HREF="#top">Back to top</A></P>         <A NAME="Section5"></A>                  <H2>Monitoring a Sound Channel</H2>                  <P>Some developers wish to monitor sound output channels for various purposes,          such as level metering.  In the past, such an activity was very difficult because          there is no easy way to get the Sound Manager's buffer; you had to guess          where you were in the currently playing sound.</p><P>Sound Manager 3.2.1 helps to solve this problem by allowing users to install pre-mixer components.  These are components that are installed in the component chain right before the Apple Mixer component.</p><P>A pre-mixer component sees the converted sound data from the channel it is installed on.  That is, it sees the uncompressed, rate-converted, channel-converted, and size-converted data that the Apple Mixer is going to mix in with the other currently playing sounds.</p><P>Currently, there is no way to install a post-mixer component which would see the mixed result of all sound channels. Well, actually there is, they are called sound output components.</p><P>Writing a pre-mixer component is just like writing any other sound component see <I>Inside Macintosh: Sound</I> chapter 4 for the required selectors a sound component must support.</p><P>To install a pre-mixer component, you use a new <CODE>SPBSetDeviceInfo</CODE> selector, <CODE>siPreMixerSoundComponent</CODE> and pass a pointer to <CODE>SoundComponentLink</CODE> that describes the pre-mixer component you want installed.</p><P>This sample function shows how to create a simple sound channel with a specific pre-mixer component installed on that sound channel.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>SndChannelPtr CreateChannelWithPreMixer (SndCallBackUPP callbackRoutine, OSType pmcSubTye){    SoundComponentLink  preMixerCmp;    SndChannelPtr       theChannel = nil;    OSErr               err;    /* create a new sound channel */    err = SndNewChannel (&amp;theChannel, sampledSynth, 0,      callbackRoutine);    if (err == noErr) {        /* define the pre-mixer component */        preMixerCmp.description.componentType = kSoundEffectsType;        preMixerCmp.description.componentSubType = pmcSubTye;        preMixerCmp.description.componentManufacturer = 0;        preMixerCmp.description.componentFlags = 0;        preMixerCmp.description.componentFlagsMask = 0;        preMixerCmp.mixerID = nil;        preMixerCmp.linkID = nil;    }    if (err == noErr) {        /* install the pre-mixer component BEFORE the Apple Mixer */        err = SndSetInfo (theChannel, siPreMixerSoundComponent, &amp;preMixerCmp);    }    if (err != noErr) {        theChannel = nil;    }    return (theChannel);}</pre></TD></TR></TABLE></CENTER><BR><BR><P>To send and receive information to and from your pre-mixer component, use the <CODE>SndSetInfo</CODE> and <CODE>SndGetInfo</CODE> functions, respectively.  For example, this call could get the current value from your level meter component:</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>err = SndGetInfo (theChannel, LMValue, &amp;level);</pre></TD></TR></TABLE></CENTER><BR><BR>         <H3>Significant Restriction</H3>         <P>There is one significant restriction on pre-mixer components -- they          cannot increase the length of the sound.  This is an important restriction          if you happen to be writing a reverb or fade component.  In order for these          types of effects to work correctly, the sounds that are played must have          long silent endings that the component can replace with its effect.           A pre-mixer component can shorten the length of a sound, but it cannot          increase it.</p> <BR><P><A HREF="#top">Back to top</A></P>         <A NAME="Summary"></A>                  <H2>Summary</H2>                  <P>These are some of the lesser known features of the Sound Manager.  Now that you know them, I hope you will be able to take advantage of them and produce some of the best sounding applications on the planet.</p> <BR><P><A HREF="#top">Back to top</A></P><A NAME="References"></A><H2>References</H2>            <p><a href="../../documentation/mac/Sound/Sound-2.html">            <I>Inside Macintosh: Sound</I></A></p><p><A HREF = "http://quicktime.apple.com/dev/devsnd.html">The Sound Manager's web page</A></p><p><A HREF = "ftp://ftp.quicktime.apple.com/developer/QuickTime/sound/soundadd.pdf">SoundManager addendum</A></p><p><A HREF = "tn1048.html">Technote1048: Some Sound Advice: Getting the Most Out of the Sound Manager</A></p>     <BR><P><A HREF="#top">Back to top</A></P>        <A NAME="Downloads"></A>         <br><h2>Downloadables</h2>        <TABLE BORDER=0 CELLPADDING=3 WIDTH="600">          <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P>            </TD>            <td align="left">               <p>Acrobat version of this Note (124K).</P>            </TD>            <td width=60 align=left>               <p><A HREF="pdf/tn1108.pdf">Download</A></P>            </TD>          </TR>        </TABLE><BR><BR>   <BR><P><A HREF="#top">Back to top</A></P>        </td></tr></table></center><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1108.html%3Fid%3DDTS10002948-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1108.html%3Fid%3DDTS10002948-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1108.html%3Fid%3DDTS10002948-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>