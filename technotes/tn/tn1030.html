<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1030: A Technique for Estimating the Total RAM You Need for a QuickTime VR Project</title>    <meta name="keywords" content="Mac OS 8 QuickTime VR calculating RAM total memory Tools">    <meta name="Description" content="Technical Note TN1030: This Technical Note details how muchRAM a QuickTime VR project may need and provides tips onrecognizing and avoiding common memory-related problems.Therefore methods for determining the minimum amount of RAMand methods for calculating the total RAM are provided."><meta name="categories" content="QuickTime VR"><meta name="week-posted" content="Jan 29, 1996 - Feb 2, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002872" title="A Technique for Estimating the Total RAM You Need for a QuickTime VR Project"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/idxVirtualReality-date.html" target="_blank">QuickTime > Virtual Reality</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1030</div>
<div id="pageheadsub">A Technique for Estimating the Total RAM You Need for a QuickTime VR Project</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><P id = "menutext"><A HREF = "#RTFToC1">A Method for Estimating the Minimum RAM</a><br><br><A HREF = "#RTFToC2">Calculating Total RAM</a><br><br><A HREF = "#RTFToC3">Memory Requirements for Other QTVR Tools</a><br><br><A HREF = "#RTFToC4">Using Virtual Memory</a><br><br><A HREF = "#Summary">Summary</a><br><br><A HREF = "#References">References</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr><tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->  <P id = "introtext">When using the QTVR Authoring Tools to create a panorama, the most common problems arise from not having enough memory to accomplish the task. If you follow the recommendations in the QTVR Reference Manual, shooting with a 15mm lens and scanning your panoramas to PhotoCD and using the 768 x 512 resolution images, 40 MB of total RAM ought to be enough to get the job done.</p><P id = "introtext">But if, like some QTVR producers, you want to use higher resolution images or longer lenses for your project, you may need more RAM. This Technote, which is aimed at QTVR producers, will help you assess how much RAM you'll need and provide you with tips on how to recognize and avoid common memory-related problems.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>&nbsp;[Feb 1 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name="RTFToC1"></a><h2>A Method for Estimating the Minimum RAM</h2><P>MPW is by far the tool that needs the most RAM. Typically, a QTVR project requires that you allocate at least 30 MB to execute the QTVR tools that MPW calls, specifically stitch, which takes up the lion's share of memory. The other MPW tools, such as p2mv, are not significant in terms of the maximum or total amount of memory you need.</p><P>p2mv (PICT to movie) is a tool that dices the panorama PICT which has been stitched into equally-sized tiles and then packages them as a QuickTime Movie. The msnm tool (make single node movie) takes the diced QuickTime Movie and adds the extra parameters that QuickTime VR needs to complete the panorama movie.</p><P>The stitcher, running under MPW, requires enough RAM to buffer 3 copies of a panorama in order to stitch, rotate and crop the image.</p><P>Because a panorama is technically a series of flat images wrapped into a cylinder, the surface of the cylinder is what determines the amount of memory your project needs.</p><h3>Steps To Estimate RAM Requirements</h3><P>To estimate roughly the minimum amount of RAM you'll need, follow these steps: </P><OL><LI> Decide if you'll be using your camera in portrait mode (recommended) or landscape mode.</li><LI> Mount your camera accordingly on a tripod.</li><LI> Looking through the lens, rotate the camera clockwise, aligning the left edge of the frame to the previous frame's right edge.</li><LI> Count the minimum number of photos you need to complete a 360 degree panorama with no overlap.<BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Important:</B><BR>Alternatively, if you have the horizontal and vertical field of view angles for the lens you want to use, you can calculate the number of images needed to complete a 360 degree panorama. Using the lens in portrait mode, divide 360 by the vertical angle to get the minimum number of images. If in landscape mode, divide by the horizontal angle.</P></TD></TR></TABLE></CENTER><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The number of overlapping images won't change the RAM requirements because the overlapping portions don't increase the size of the cylinder. The advantage of having generous (+50%) overlap is that it allows the stitcher to even out dark and light exposures with the -blend option. Changing the orientation of the camera changes only the height of the cylinder, while the circumference stays the same. </P></TD></TR></TABLE></CENTER><BR></li><LI>Decide on what resolution you want to use, keeping in mind that a lower resolution image is going to have a smaller panorama and less detail.<BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Input devices typically offer a multiple resolutions. For example: PhotoCD  offers five different resolutions, including 768x512, 384x256, and 1536x1024. The QuickTake 150 camera offers you only two:  640x480 and 320x240, as do most video digitizers.</P></TD></TR></TABLE></CENTER><BR></li></OL><P>Steps one through five outline the procedures you need to follow in order to determine the variables in the RAM requirements equation.</p><h3>The Formula</h3><P>Here are the factors you need to calculate the RAM requirements equation:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>i        (number of images with zero overlap to complete                            360 degrees)b = 2        (number of buffers )w = 1.44    (10% default work border)t=2        (number of temporary input images)h        (horizontal input image resolution)v        (vertical input image resolution)d = 4        (bit depth in bytes)k = 1024    (bytes per kilobyte)((i*b*w) + t)*h*v*d/k = the KB RAM requirements</pre>	</TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>To convert kilobytes into megabytes, divide by 1024</P></TD></TR></TABLE></CENTER><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The MPW partition should be set to have at least 1 MB for code and the rest for the image buffers.</P></TD></TR></TABLE></CENTER><BR><h3>Two Sample Calculations</h3><P>Example #1: If your 18mm lens in portrait format has about 65  of horizontal field of view, and you take 6 images to make a complete rotation, using the 768 x 512 resolution PhotoCD images, your cylinder size will be: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>((6x2x1.44)+2)x768x512x4/1024 = 29614 KB</pre>	</TD></TR></TABLE></CENTER><P>Therefore, you'll need a minimum of 31 MB of RAM for MPW.</p><P>Example #2: Using the standard QuickTake 150 digital camera in portrait mode requires a minimum of 14 images to complete a 360 degree panorama.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>((14x2x1.44)+2)x640x480x4/1024 = 50784 KB</pre>	</TD></TR></TABLE></CENTER><P>The irony is that the QuickTake camera, which is perceived as a low-end solution, actually requires more RAM than the 18mm SLR. However, if you use landscape mode with your QuickTake camera, the buffers will only need 38 MB.</p><h3>Setting the MPW Memory Partition</h3><P>You can set MPW's Minimum and Preferred size in the Get Info dialog from the Finder.</p><P>Unless you have lots of extra memory, you should quit all other applications before launching MPW. A typical Macintosh 7.5 System will need 5-10 MB of RAM -- more if you have extra extensions installed. If you install only a basic system, it's possible to reduce its memory needs to less than 5 MB.</p><P>QuickTime loads into the system heap, so you need to make sure there is at least 1 MB for the system to grow when it loads QuickTime. Not having this free space may cause unexpected errors. If you get errors while stitching, use About This Macintosh in the Apple menu to confirm that MPW has enough RAM and that there is still 1 MB of free space.</p><P><A HREF="#top">Back to top</A></P><a name="RTFToC2"></a><h2>Calculating Total RAM</h2><P>After figuring the amount of RAM needed for MPW, add the following to your subtotal: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>System (10 MB) + Free space (1 MB) + MPW (RAM requirements) = Total RAM</pre>	</TD></TR></TABLE></CENTER><h3>A Practical Configuration: A Personal Example</h3><P>My camera system with an 18mm lens requires a minimum of 31+11 = 42 MB of RAM. Fortunately, I have 72 MB in my Power Macintosh 8100, and this allows me to stitch images captured with my second camera: the QuickTake 150. This also lets me run multiple tools concurrently, which saves me the time of relaunching whenever I change tasks.</p><h3>Other Variables That Affect Memory Requirements</h3><P>These calculations should only be considered estimates. A number of other factors may cause the stitcher to require more memory in order to build a panorama. For example, a hand-held panorama often requires a larger image border to accommodate the "stair-stepping" that occurs when the images are skewed and poorly aligned. To insure proper stitching, you may need to add another 20% memory to handle these worse-case situations.</p><h3>Increasing or Reducing the Amount of RAM</h3><P>If you want to increase or reduce the amount of RAM you need, there are three important variables you must take into account: </P><ul><li>orientation of the camera, i.e., portrait or landscape</li><li>the field of view of the lens, i.e., wide angle or ultra wide angle</li><li>the resolution of the images, i.e., hi-res, lo-res. </li></ul><P>As an example, I prefer to work with lo-res PhotoCD images. When I'm proofing my work I may use a half-size image, which dramatically speeds up the time it takes to build a panorama and also uses four times less RAM.</p><P><A HREF="#top">Back to top</A></P><a name="RTFToC3"></a><h2>Memory Requirements for Other QTVR Tools</h2><P>Although the QTVR dicer (the p2mv MPW tool) requires a lot of memory, it is always proportionally less than the stitcher.</p><P>A common problem encountered by QTVR developers is not increasing the partition size of HyperCard to 20 MB required by the Scene Editor.</p><P>Object movies require only as much RAM as needed for the Video Capture tools. Five megabytes of free space should be sufficient for most cases.</p><P><A HREF="#top">Back to top</A></P><a name="RTFToC4"></a><h2>Using Virtual Memory</h2><P>If you want to work with images requiring more RAM than you have, you can do so by turning on virtual memory. Virtual memory, however, really slows things down, often by as much as a factor of 10. But it may allow you to accomplish things that would otherwise require lots of expensive RAM. Plan on using virtual memory as an exception rather than the rule for your QTVR projects.</p><h3>A Bench Test </h3><P>One weekend I ran some timing tests, stitching large panoramas with virtual memory on. The reason I performed the tests was to see if I could push the limits of how large a panorama QuickTime VR could stitch.</p><P>I used a Nikon N90, 18mm lens, Kaidan universal pan head to take 12 portrait shots per node. I shot the scene indoors with fluorescent lights. The negatives were scanned onto a PhotoCD and then stitched on a PowerPC 8100/80 with 72 MB of RAM. I ran a benchmark with virtual memory turned off, and then the others with virtual memory set to 480 MB! </P><P>I stitched them first in an MPW partition that used all but 10 MB of free space. All Easy Install Macintosh 7.5.1 system extensions were enabled.</p><P>For the largest size, I played it safe and turned off the -outWidth, -outHeight parameters and resized the panorama.srcPict with Adobe Photoshop. I thought I could dice it with less virtual memory, but eventually diced them all with 300MB of virtual memory. I wanted to use less than 480 MB because speed was a consideration.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Perhaps a more realistic test would be one using a 60 MB RAM system compared to a 16 MB + 44 MB (VM) system, but this was not feasible given my time constraints. </P></TD></TR></TABLE></CENTER><BR><h3>Timing Results from the Experiment</h3><P>Table 1 shows the timing results from the experiment. Note that all times are in Hours: Minutes: Seconds, rounded off.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Resolu-tion     VM  stitch Time    Output Size       p2mv        msnm768     off    00: 07: 22    6.3 MB        0: 01: 58       0: 00: 03192     on    00: 01: 00    0.416 MB     0: 00: 15       0: 00: 04768     on    00: 13: 00    6.3 MB        0: 07: 30       0: 00: 201536     on    04: 45: 00     25 MB        0: 47: 20       0: 00: 453072     on    55: 05: 00    100 MB        3: 00: 00       0: 02: 00</pre>	</TD></TR><TR><td align="left"><b>Table 1</b> - Timing results with virtual memory on and off</td></tr></TABLE></CENTER><P>You can stitch 100MB panoramas if you have lots of time (as I did, for example -- 3 days!) The resulting movie I made was 8.7 MB, so it was not exactly practical for the World Wide Web and displayed about 2 frames/second on the PowerPC 8100, which was unacceptably choppy.</p><P>If you have more time than money, it's possible to use virtual memory rather than add RAM and still build big panoramas, with lots of detail.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>This does not change the official QTVR recommended minimum RAM configurations.  Proceed at your own risk. </P></TD></TR></TABLE></CENTER><BR><P><A HREF="#top">Back to top</A></P><a name="Summary"></a><h2>Summary</h2><P>It's possible to estimate your project's RAM requirements using the formula provided in this Technote. Note that these are minimum estimates. The most common problems are caused by not having enough RAM. The choice is clear: invest in the purchase of sufficient RAM to meet your QTVR development needs.</p><BR><P><A HREF="#top">Back to top</A></P> <a name="References"></a><h2>References</h2><p><A HREF = "tn1029.html">Technote 1029, "Getting Up to Speed with QuickTime VR: Notes from the Field."</a></p><P>QTVR Authoring Tool Suite</p><BR><P><A HREF="#top">Back to top</A></P>          <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (64K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1030.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1030.html%3Fid%3DDTS10002872-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1030.html%3Fid%3DDTS10002872-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1030.html%3Fid%3DDTS10002872-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>