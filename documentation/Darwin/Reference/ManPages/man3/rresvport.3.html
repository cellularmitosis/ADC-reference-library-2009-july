<html><head><title>Mac OS X
 Manual Page For rresvport(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/rresvport" title="Mac OS X
 Manual Page for rresvport(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/rresvport"; name=rresvport(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
RCMD(3)                  BSD Library Functions Manual                  <!-- a -->RCMD(3)<!-- /a -->

<b>NAME</b>
     <b>rcmd</b>, <b>rresvport</b>, <b>iruserok</b>, <b>ruserok</b>, <b>rcmd_af</b>, <b>rresvport_af</b>, <b>iruserok_sa</b> -- routines for returning a
     stream to a remote command

<b>LIBRARY</b>
     Standard C Library (libc, -lc)

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;unistd.h&gt;</b>

     <u>int</u>
     <b>rcmd</b>(<u>char</u> <u>**ahost</u>, <u>int</u> <u>inport</u>, <u>const</u> <u>char</u> <u>*locuser</u>, <u>const</u> <u>char</u> <u>*remuser</u>, <u>const</u> <u>char</u> <u>*cmd</u>, <u>int</u> <u>*fd2p</u>);

     <u>int</u>
     <b>rresvport</b>(<u>int</u> <u>*port</u>);

     <u>int</u>
     <b>iruserok</b>(<u>u</u><b>_</b><u>long</u> <u>raddr</u>, <u>int</u> <u>superuser</u>, <u>const</u> <u>char</u> <u>*ruser</u>, <u>const</u> <u>char</u> <u>*luser</u>);

     <u>int</u>
     <b>ruserok</b>(<u>const</u> <u>char</u> <u>*rhost</u>, <u>int</u> <u>superuser</u>, <u>const</u> <u>char</u> <u>*ruser</u>, <u>const</u> <u>char</u> <u>*luser</u>);

     <u>int</u>
     <b>rcmd_af</b>(<u>char</u> <u>**ahost</u>, <u>int</u> <u>inport</u>, <u>const</u> <u>char</u> <u>*locuser</u>, <u>const</u> <u>char</u> <u>*remuser</u>, <u>const</u> <u>char</u> <u>*cmd</u>, <u>int</u> <u>*fd2p</u>,
         <u>int</u> <u>af</u>);

     <u>int</u>
     <b>rresvport_af</b>(<u>int</u> <u>*port</u>, <u>int</u> <u>af</u>);

     <u>int</u>
     <b>iruserok_sa</b>(<u>const</u> <u>void</u> <u>*addr</u>, <u>int</u> <u>addrlen</u>, <u>int</u> <u>superuser</u>, <u>const</u> <u>char</u> <u>*ruser</u>, <u>const</u> <u>char</u> <u>*luser</u>);

<b>DESCRIPTION</b>
     The <b>rcmd</b>() function is used by the super-user to execute a command on a remote machine using an authen-<font color="#ffffff" class="whiteout">tication&nbsp;authentication</font>
     tication scheme based on reserved port numbers.  The <b>rresvport</b>() function returns a descriptor to a
     socket with an address in the privileged port space.  The <b>ruserok</b>() function is used by servers to
     authenticate clients requesting service with <b>rcmd</b>().  All three functions are present in the same file
     and are used by the <a href="../man8/rshd.8.html#//apple_ref/doc/man/8/rshd">rshd(8)</a> server (among others).

     The <b>rcmd</b>() function looks up the host <u>*ahost</u> using <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a>, returning -1 if the host does not
     exist.  Otherwise <u>*ahost</u> is set to the standard name of the host and a connection is established to a
     server residing at the well-known Internet port <u>inport</u>.

     If the connection succeeds, a socket in the Internet domain of type SOCK_STREAM is returned to the
     caller, and given to the remote command as <u>stdin</u> and <u>stdout</u>.  If <u>fd2p</u> is non-zero, then an auxiliary
     channel to a control process will be set up, and a descriptor for it will be placed in <u>*fd2p</u>.  The con-<font color="#ffffff" class="whiteout">trol&nbsp;control</font>
     trol process will return diagnostic output from the command (unit 2) on this channel, and will also
     accept bytes on this channel as being UNIX signal numbers, to be forwarded to the process group of the
     command.  If <u>fd2p</u> is 0, then the <u>stderr</u> (unit 2 of the remote command) will be made the same as the
     <u>stdout</u> and no provision is made for sending arbitrary signals to the remote process, although you may
     be able to get its attention by using out-of-band data.

     The protocol is described in detail in <a href="../man8/rshd.8.html#//apple_ref/doc/man/8/rshd">rshd(8)</a>.

     The <b>rresvport</b>() function is used to obtain a socket to which an address with a Privileged Internet port
     is bound.  This socket is suitable for use by <b>rcmd</b>() and several other functions.  Privileged Internet
     ports are those in the range 0 to 1023.  Only the super-user is allowed to bind an address of this sort
     to a socket.

     The <b>iruserok</b>() and <b>ruserok</b>() functions take a remote host's IP address or name, as returned by the
     <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a> routines, two user names and a flag indicating whether the local user's name is that
     of the super-user.  Then, if the user is <u>NOT</u> the super-user, it checks the <u>/etc/hosts.equiv</u> file.  If
     that lookup is not done, or is unsuccessful, the <u>.rhosts</u> in the local user's home directory is checked
     to see if the request for service is allowed.

     If this file does not exist, is not a regular file, is owned by anyone other than the user or the
     super-user, or is writable by anyone other than the owner, the check automatically fails.  Zero is
     returned if the machine name is listed in the ``<u>hosts.equiv</u>'' file, or the host and remote user name
     are found in the ``<u>.rhosts</u>'' file; otherwise <b>iruserok</b>() and <b>ruserok</b>() return -1.  If the local domain
     (as obtained from <a href="gethostname.3.html#//apple_ref/doc/man/3/gethostname">gethostname(3)</a>) is the same as the remote domain, only the machine name need be spec-<font color="#ffffff" class="whiteout">ified.&nbsp;specified.</font>
     ified.

     The <b>iruserok</b>() function is strongly preferred for security reasons.  It requires trusting the local DNS
     at most, while the <b>ruserok</b>() function requires trusting the entire DNS, which can be spoofed.

     The functions with an ``_af'' or ``_sa'' suffix, i.e., <b>rcmd_af</b>(), <b>rresvport_af</b>() and <b>iruserok_sa</b>(),
     work the same as the corresponding functions without a suffix, except that they are capable of handling
     both IPv6 and IPv4 ports.

     The ``_af'' suffix means that the function has an additional <u>af</u> argument which is used to specify the
     address family, (see below).  The <u>af</u> argument extension is implemented for functions that have no
     binary address argument.  Instead, the <u>af</u> argument specifies which address family is desired.

     The ``_sa'' suffix means that the function has general socket address and length arguments.  As the
     socket address is a protocol independent data structure, IPv4 and IPv6 socket address can be passed as
     desired.  The <u>sa</u> argument extension is implemented for functions that pass a protocol dependent binary
     address argument.  The argument needs to be replaced with a more general address structure to support
     multiple address families in a general way.

     The functions with neither an ``_af'' suffix nor an ``_sa'' suffix work for IPv4 only, except for
     <b>ruserok</b>() which can handle both IPv6 and IPv4.  To switch the address family, the <u>af</u> argument must be
     filled with AF_INET, or AF_INET6.  For <b>rcmd_af</b>(), PF_UNSPEC is also allowed.

<b>DIAGNOSTICS</b>
     The <b>rcmd</b>() function returns a valid socket descriptor on success.  It returns -1 on error and prints a
     diagnostic message on the standard error.

     The <b>rresvport</b>() function returns a valid, bound socket descriptor on success.  It returns -1 on error
     with the global value <u>errno</u> set according to the reason for failure.  The error code EAGAIN is over-<font color="#ffffff" class="whiteout">loaded&nbsp;overloaded</font>
     loaded to mean ``All network ports in use.''

<b>SEE</b> <b>ALSO</b>
     <a href="../man1/rlogin.1.html#//apple_ref/doc/man/1/rlogin">rlogin(1)</a>, <a href="../man1/rsh.1.html#//apple_ref/doc/man/1/rsh">rsh(1)</a>, <a href="../man2/intro.2.html#//apple_ref/doc/man/2/intro">intro(2)</a>, <!-- a -->rexec(3)<!-- /a -->, <a href="../man8/rexecd.8.html#//apple_ref/doc/man/8/rexecd">rexecd(8)</a>, <a href="../man8/rlogind.8.html#//apple_ref/doc/man/8/rlogind">rlogind(8)</a>, <a href="../man8/rshd.8.html#//apple_ref/doc/man/8/rshd">rshd(8)</a>

     W. Stevens and M. Thomas, <u>Advanced</u> <u>Socket</u> <u>API</u> <u>for</u> <u>IPv6</u>, RFC2292.

     W. Stevens, M. Thomas, and E. Nordmark, <u>Advanced</u> <u>Socket</u> <u>API</u> <u>for</u> <u>IPv6</u>, draft-ietf-ipngwg-<font color="#ffffff" class="whiteout">rfc2292bis-01.txt.&nbsp;draft-ietf-ipngwgrfc2292bis-01.txt.</font>
     rfc2292bis-01.txt.

<b>HISTORY</b>
     Most of these functions appeared in 4.2BSD.  <b>rresvport_af</b>() appeared in RFC2292, and was implemented by
     the WIDE project for the Hydrangea IPv6 protocol stack kit.  <b>rcmd_af</b>() appeared in draft-ietf-ipngwg-<font color="#ffffff" class="whiteout">rfc2292bis-01.txt,&nbsp;draft-ietf-ipngwgrfc2292bis-01.txt,</font>
     rfc2292bis-01.txt, and was implemented in the WIDE/KAME IPv6 protocol stack kit.  <b>iruserok_sa</b>()
     appeared in discussion on the IETF ipngwg mailing list, and was implemented in FreeBSD 4.0.

BSD                              March 3, 2000                             BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/rresvport.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/rresvport.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/rresvport.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
