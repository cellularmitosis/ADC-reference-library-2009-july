<html><head><title>Mac OS X Developer Tools
 Manual Page For Tcl_MutexFinalize(3tcl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3tcl/Tcl_MutexFinalize" title="Mac OS X Developer Tools
 Manual Page for Tcl_MutexFinalize(3tcl)"><a name="//apple_ref/doc/man/3/Tcl_MutexFinalize" title="Mac OS X Developer Tools
 Manual Page for Tcl_MutexFinalize(3tcl)"><!-- headerDoc=man; indexgroup=Section 3tcl; uid="//apple_ref/doc/man/3tcl/Tcl_MutexFinalize"; name=Tcl_MutexFinalize(3tcl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
Threads(3)                                 Tcl Library Procedures                                 <!-- a -->Threads(3)<!-- /a -->



____________________________________________________________________________________________________________

<b>NAME</b>
       Tcl_ConditionNotify,   Tcl_ConditionWait,  Tcl_ConditionFinalize,  Tcl_GetThreadData,  Tcl_MutexLock,
       Tcl_MutexUnlock, Tcl_MutexFinalize, Tcl_CreateThread, Tcl_JoinThread - Tcl thread support.

<b>SYNOPSIS</b>
       <b>#include</b> <b>&lt;tcl.h&gt;</b>

       void
       <b>Tcl_ConditionNotify</b>(<u>condPtr</u>)

       void
       <b>Tcl_ConditionWait</b>(<u>condPtr,</u> <u>mutexPtr,</u> <u>timePtr</u>)

       void
       <b>Tcl_ConditionFinalize</b>(<u>condPtr</u>)

       Void *
       <b>Tcl_GetThreadData</b>(<u>keyPtr,</u> <u>size</u>)

       void
       <b>Tcl_MutexLock</b>(<u>mutexPtr</u>)

       void
       <b>Tcl_MutexUnlock</b>(<u>mutexPtr</u>)

       void
       <b>Tcl_MutexFinalize</b>(<u>mutexPtr</u>)

       int
       <b>Tcl_CreateThread</b>(<u>idPtr,</u> <u>threadProc,</u> <u>clientData,</u> <u>stackSize,</u> <u>flags</u>)

       int
       <b>Tcl_JoinThread</b>(<u>id,</u> <u>result</u>)

<b>ARGUMENTS</b>
       Tcl_Condition       <u>*condPtr</u>  (in)      A condition variable, which must be associated with  a  mutex
                                               lock.

       Tcl_Condition       <u>*mutexPtr</u> (in)      A mutex lock.

       Tcl_Time            <u>*timePtr</u>  (in)      A  time  limit  on the condition wait.  NULL to wait forever.
                                               Note that a polling value of  0  seconds  doesn't  make  much
                                               sense.

       Tcl_ThreadDataKey   <u>*keyPtr</u>   (in)      This  identifies  a  block  of thread local storage.  The key
                                               should be static and process-wide, yet each thread  will  end
                                               up associating a different block of storage with this key.

       int                 <u>*size</u>     (in)      The  size  of the thread local storage block.  This amount of
                                               data is allocated and initialized to zero the first time each
                                               thread calls <b>Tcl_GetThreadData</b>.

       Tcl_ThreadId        <u>*idPtr</u>    (out)     The referred storage will contain the id of the newly created
                                               thread as returned by the operating system.

       Tcl_ThreadId        <u>id</u>        (in)      Id of the thread waited upon.

       Tcl_ThreadCreateProc          <u>threadProc</u>(in)
                                               This procedure will act as the <b>main()</b> of  the  newly  created
                                               thread. The specified <u>clientData</u> will be its sole argument.

       ClientData          <u>clientData</u>(in)      Arbitrary information. Passed as sole argument to the <u>thread</u>-<font color="#ffffff" class="whiteout">Proc.&nbsp;threadProc.</font>
                                               <u>Proc</u>.

       int                 <u>stackSize</u> (in)      The size of the stack given to the new thread.

       int                 <u>flags</u>     (in)      Bitmask containing flags allowing the caller to modify behav-<font color="#ffffff" class="whiteout">iour&nbsp;behaviour</font>
                                               iour of the new thread.

       int                 <u>*result</u>   (out)     The  referred  storage  is used to place the exit code of the
                                               thread waited upon into it.
____________________________________________________________________________________________________________

<b>INTRODUCTION</b>
       Beginning with the 8.1 release, the Tcl core is thread safe, which allows you to incorporate Tcl into
       multithreaded  applications  without customizing the Tcl core.  To enable Tcl multithreading support,
       you must include the <b>--enable-threads</b> option to <b>configure</b> when you configure  and  compile  your  Tcl
       core.

       An  important constraint of the Tcl threads implementation is that <u>only</u> <u>the</u> <u>thread</u> <u>that</u> <u>created</u> <u>a</u> <u>Tcl</u>
       <u>interpreter</u> <u>can</u> <u>use</u> <u>that</u> <u>interpreter</u>.  In other words, multiple threads can not access the  same  Tcl
       interpreter.   (However,  as was the case in previous releases, a single thread can safely create and
       use multiple interpreters.)

       Tcl does provide <b>Tcl_CreateThread</b> for creating threads. The caller can  determine  the  size  of  the |
       stack  given  to  the  new  thread  and  modify  the  behaviour through the supplied <u>flags</u>. The value |
       <b>TCL_THREAD_STACK_DEFAULT</b> for the <u>stackSize</u> indicates that the default size as specified by the  oper- |
       ating  system  is  to  be  used  for  the new thread. As for the flags, currently are only the values |
       <b>TCL_THREAD_NOFLAGS</b> and <b>TCL_THREAD_JOINABLE</b> defined. The first of them invokes the  default  behaviour |
       with no specialties. Using the second value marks the new thread as <u>joinable</u>. This means that another |
       thread can wait for the such marked thread to exit and join it.                                       |

       Restrictions: On some unix systems the pthread-library does not contain the functionality to  specify |
       the  stacksize  of  a thread. The specified value for the stacksize is ignored on these systems. Both |
       Windows and Macintosh currently do not support joinable threads. This flag value is therefore ignored |
       on these platforms.

       Tcl  does provide <b>Tcl_ExitThread</b> and <b>Tcl_FinalizeThread</b> for terminating threads and invoking optional
       per-thread exit handlers.  See the <b>Tcl_Exit</b> page for more information on these procedures.

       The <b>Tcl_JoinThread</b> function is provided to allow threads to wait upon the  exit  of  another  thread, |
       which must have been marked as joinable through usage of the <b>TCL_THREAD_JOINABLE</b>-flag during its cre- |
       ation via <b>Tcl_CreateThread</b>.                                                                           |

       Trying to wait for the exit of a non-joinable thread or a thread which is already  waited  upon  will |
       result  in  an error. Waiting for a joinable thread which already exited is possible, the system will |
       retain the necessary information until after the call to <b>Tcl_JoinThread</b>.  This means that not calling |
       <b>Tcl_JoinThread</b> for a joinable thread will cause a memory leak.

       Tcl  provides  <b>Tcl_ThreadQueueEvent</b>  and <b>Tcl_ThreadAlert</b> for handling event queueing in multithreaded
       applications.  See the <b>Notifier</b> manual page for more information on these procedures.

       In this release, the Tcl language itself provides no support for creating multithreaded scripts  (for
       example,  scripts  that could spawn a Tcl interpreter in a separate thread).  If you need to add this
       feature at this time, see the <u>tclThreadTest.c</u> file in the Tcl source distribution for an experimental
       implementation  of a Tcl "Thread" package implementing thread creation and management commands at the
       script level.


<b>DESCRIPTION</b>
       A mutex is a lock that is used  to  serialize  all  threads  through  a  piece  of  code  by  calling
       <b>Tcl_MutexLock</b>  and  <b>Tcl_MutexUnlock</b>.   If  one  thread  holds  a  mutex,  any  other  thread  calling
       <b>Tcl_MutexLock</b> will block until <b>Tcl_MutexUnlock</b> is called.  A mutex can be destroyed after its use  by |
       calling  <b>Tcl_MutexFinalize</b>.   The  result of locking a mutex twice from the same thread is undefined. |
       On some platforms it will result in a deadlock.  The <b>Tcl_MutexLock</b>, <b>Tcl_MutexUnlock</b> and  <b>Tcl_MutexFi</b>-<font color="#ffffff" class="whiteout">nalize&nbsp;Tcl_MutexFinalize</font>
       <b>nalize</b> procedures are defined as empty macros if not compiling with threads enabled.

       A  condition  variable is used as a signaling mechanism: a thread can lock a mutex and then wait on a
       condition variable with <b>Tcl_ConditionWait</b>.  This atomically releases the mutex lock  and  blocks  the
       waiting  thread  until  another  thread calls <b>Tcl_ConditionNotify</b>.  The caller of <b>Tcl_ConditionNotify</b>
       should have the associated mutex held by previously calling <b>Tcl_MutexLock</b>, but this is not  enforced.
       Notifying  the condition variable unblocks all threads waiting on the condition variable, but they do
       not proceed until the mutex is released with <b>Tcl_MutexUnlock</b>.  The implementation  of  <b>Tcl_Condition</b>-<font color="#ffffff" class="whiteout">Wait&nbsp;Tcl_ConditionWait</font>
       <b>Wait</b> automatically locks the mutex before returning.

       The  caller  of <b>Tcl_ConditionWait</b> should be prepared for spurious notifications by calling <b>Tcl_Condi</b>-<font color="#ffffff" class="whiteout">tionWait&nbsp;Tcl_ConditionWait</font>
       <b>tionWait</b> within a while loop that tests some invariant.

       A condition variable can be destroyed after its use by calling <b>Tcl_ConditionFinalize</b>.                 |

       The <b>Tcl_ConditionNotify</b>, <b>Tcl_ConditionWait</b> and <b>Tcl_ConditionFinalize</b> procedures are defined as  empty |
       macros if not compiling with threads enabled.

       The  <b>Tcl_GetThreadData</b>  call  returns a pointer to a block of thread-private data.  Its argument is a
       key that is shared by all threads and a size for the block of storage.  The storage is  automatically
       allocated  and initialized to all zeros the first time each thread asks for it.  The storage is auto-<font color="#ffffff" class="whiteout">matically&nbsp;automatically</font>
       matically deallocated by <b>Tcl_FinalizeThread</b>.

<b>INITIALIZATION</b>
       All of these synchronization objects are self initializing.  They are implemented as opaque  pointers
       that  should  be  NULL  upon first use.  The mutexes and condition variables are either cleaned up by |
       process exit handlers (if living that long) or explicitly by calls to <b>Tcl_MutexFinalize</b> or <b>Tcl_Condi-</b> |
       <b>tionFinalize</b>.  Thread local storage is reclaimed during <b>Tcl_FinalizeThread</b>.

<b>CREATING</b> <b>THREADS</b>
       The  API  to  create  threads  is not finalized at this time.  There are private facilities to create
       threads that contain a new Tcl interpreter, and to send scripts among threads.  Dive into  tclThread-<font color="#ffffff" class="whiteout">Test.c&nbsp;tclThreadTest.c</font>
       Test.c and tclThread.c for examples.

<b>SEE</b> <b>ALSO</b>
       Tcl_GetCurrentThread,   Tcl_ThreadQueueEvent,  Tcl_ThreadAlert,  Tcl_ExitThread,  Tcl_FinalizeThread,
       Tcl_CreateThreadExitHandler, Tcl_DeleteThreadExitHandler

<b>KEYWORDS</b>
       thread, mutex, condition variable, thread local storage



Tcl                                                  8.1                                          <!-- a -->Threads(3)<!-- /a -->
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/Tcl_MutexFinalize.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/Tcl_MutexFinalize.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/Tcl_MutexFinalize.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
