<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Overriding the Standard Initialization Interface (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING375></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-374.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-376.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-367.html"><B>Chapter 5 - Disk Initialization Manager</B></A> / <A HREF="Files-372.html"><B>Using the Disk Initialization Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING375-0></A>
<H2><A NAME=MARKER-2-61></A><A NAME=MARKER-2-62></A><A NAME=MARKER-2-63></A>Overriding the Standard Initialization Interface</H2>
 The disk initialization dialog box provides an easy-to-use, standard interface for initializing and reinitializing disks. However, if you wish, you can use three low-level Disk Initialization Manager functions that accomplish the three stages of disk initialization without presenting any user interface. The three functions are <CODE>DIFormat</CODE>, <CODE>DIVerify</CODE>, and <CODE>DIZero</CODE>. The <CODE>DIFormat</CODE> function attempts to format the disk, the <CODE>DIVerify</CODE> function verifies whether the format was successful, and the <CODE>DIZero</CODE> function updates the newly initialized volume's characteristics and attempts to spare any bad blocks on the disk.<P>
 <A HREF=#MARKER-9-64>Listing 5-3</A> shows how to reinitialize a disk without using the standard interface. The low-level functions work only if the disk is not already mounted in the disk drive. Therefore, <A HREF=#MARKER-9-64>Listing 5-3</A> uses high-level File Manager calls to unmount the volume and to remember the volume's name, so that it can be restored later. Because you are no longer using the standard interface, you must define the <CODE>DoError</CODE> procedure so that you can alert the user about an error.<P>
<B>Listing 5-3  <A NAME=MARKER-9-64></A>Reinitializing a validly formatted disk without using the standard interface</B><P>
<PRE>
PROCEDURE DoEraseDisk (driveNum: Integer);
VAR
   myErr:         OSErr;                     {result code}
   volName:       Str255;                    {name of volume}
   oldVRefNum:    Integer;                   {to unmount volume}
   oldFreeBytes:  LongInt;                   {for GetVInfo call}
BEGIN
   DILoad;                                   {load Disk Init. Manager}
   myErr := GetVInfo(driveNum, @volName, oldVRefNum, oldFreeBytes);
                                             {remember name of volume}
   IF myErr = noErr THEN
      myErr := UnmountVol(@volName, oldVRefNum);
                                             {unmount the disk}
   IF myErr = noErr THEN
      myErr := DIFormat(driveNum);           {format the disk}
   IF myErr = noErr THEN
      myErr := DIVerify(driveNum);           {verify format}
   IF myErr = noErr THEN
      myErr := DIZero(driveNum, volName);    {update volume information}
   IF myErr &lt;&gt; noErr THEN
      DoError(myErr);                        {respond to error}
   DIUnload;                                 {unload Disk Init. Manager}
END;
</PRE>
 If you wish, you can also respond to a user's insertion of an uninitialized or damaged disk by simply formatting the disk without using the standard interface. <A HREF=#MARKER-9-65>Listing 5-4</A> defines a procedure for this purpose. <A HREF=#MARKER-9-65>Listing 5-4</A> differs from <A HREF=#MARKER-9-64>Listing 5-3</A> only in that it does not begin by unmounting the volume (because the File Manager does not mount uninitialized or damaged disks).<P>
<B>Listing 5-4  <A NAME=MARKER-9-65></A>Initializing an uninitialized disk without using the standard interface</B><P>
<PRE>
PROCEDURE DoInitDisk (driveNum: Integer; volName: Str255);
VAR
   myErr:         OSErr;                     {result code}
BEGIN
   DILoad;                                   {load Disk Init. Manager}
   myErr := DIFormat(driveNum);              {format the disk}
   IF myErr = noErr THEN
      myErr := DIVerify(driveNum);           {verify format}
   IF myErr = noErr THEN
      myErr := DIZero(driveNum, volName);    {update volume information}
   IF myErr &lt;&gt; noErr THEN
      DoError(myErr);                        {respond to error}
   DIUnload;                                 {unload Disk Init. Manager}
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-374.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-376.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
