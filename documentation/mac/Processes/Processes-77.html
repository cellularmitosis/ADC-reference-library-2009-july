<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Types of VBL Tasks (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING77></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-76.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-78.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-74.html"><B>Chapter 4 - Vertical Retrace Manager</B></A> / <A HREF="Processes-75.html"><B>About the Vertical Retrace Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING77-0></A>
<H2><A NAME=MARKER-9-30></A>Types of VBL Tasks<A NAME=MARKER-2-123></A></H2>
 <A NAME=MARKER-2-32></A>There are two general types of VBL tasks. A<B> slot-based VBL task</B> is linked to an external video monitor.<B> </B>Because different monitors can have different refresh rates and hence might execute VBL tasks at different times, the Vertical Retrace Manager maintains a separate task queue for each video device attached to the computer. When a VBL interrupt occurs for a particular device, the Vertical Retrace Manager executes any tasks in the queue for the slot holding that monitor's video card. You can install a slot-based VBL task by calling the <CODE>SlotVInstall</CODE> function.<A NAME=MARKER-2-33></A><A NAME=MARKER-2-34></A><A NAME=MARKER-2-36></A><P>
 For Macintosh computers that have only a built-in monitor (such as a Macintosh Plus or Macintosh Classic), there is no need to isolate VBL tasks into separate queues. Instead, the Operating System maintains just one task queue and processes the tasks in that queue when it receives a VBL interrupt. A VBL task that is not linked to an external video device is known as a <B>system-based VBL task. </B>You can install a system-based VBL task by calling the <CODE>VInstall</CODE> function.<B><A NAME=MARKER-2-37></A><A NAME=MARKER-2-52></A></B><P>
 To maintain compatibility on modular Macintosh computers for software that uses the <CODE>VInstall</CODE> function, the Operating System generates a special interrupt at a frequency identical to the retrace rate on compact Macintosh computers. This special interrupt is generated approximately 60.15 times a second and mimics the vertical retrace interrupt on compact models. This ensures that application tasks installed using the <CODE>VInstall</CODE> function, as well as periodic system tasks such as updating the tick count and checking whether the stack has expanded into the heap, are performed as usual.<P>
 To ensure the synchronization of your VBL task with the retracing of the screen, you should check whether the <CODE>SlotVInstall</CODE> function is available in the current operating environment. If it is, you should use the slot-based routines to install and remove your VBL task. If not, you should use the system-based routines.<A NAME=MARKER-2-148></A><P>
 However, even if you synchronize your VBL task to the retracing of the screen correctly, tasks may not always execute as scheduled. Some types of system activity, such as disk access, may cause VBL interrupts to be disabled temporarily. (This is why cursor movement sometimes becomes jerky during disk operations.) Also, if a VBL task takes longer to perform than the time it takes to retrace the screen, other interrupt tasks may miss one or more vertical retrace interrupts.<A NAME=MARKER-2-20></A><A NAME=MARKER-2-29></A><A NAME=MARKER-2-38></A><A NAME=MARKER-2-70></A><P>
 Like all interrupt tasks, VBL tasks cannot do everything that ordinary routines can. The following list summarizes the operations that VBL tasks should not perform. A VBL task that violates one of these rules may cause a system crash:<A NAME=MARKER-2-47></A><P>
<UL>
<LI>A VBL task must not allocate, move, or purge memory, or call any Toolbox routines that might do so.
<LI>A VBL task must preserve all registers other than A0-A3 and D0-D3.
<LI>A VBL task cannot call a routine from another code segment unless it sets up the application's<DFN> A5</DFN> world properly. In addition, that segment must already be loaded in memory.
<LI>A VBL task cannot access your application global variables unless it sets up the application's<DFN> A5</DFN> world properly. This technique is explained in <A HREF=Processes-84.html#MARKER-9-98>"Accessing Application Global Variables in a VBL Task,"</A> beginning on <A HREF=Processes-84.html#MARKER-9-98>page 4-13</A>.
<LI>A VBL task's code and any data accessed during the execution of the task must be locked into physical memory if virtual memory is in operation.<A NAME=MARKER-2-48></A><A NAME=MARKER-2-100></A><A NAME=MARKER-2-50></A><P>
</UL>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-76.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-78.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
