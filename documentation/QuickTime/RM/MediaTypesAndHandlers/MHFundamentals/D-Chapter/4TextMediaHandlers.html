<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Media Types and Media Handlers Guide: Text Media Handlers</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Text Media Handlers"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers" title="Text Media Handlers"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../MediaTypesMediaHandlers-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000543" target="_top">Media Types &amp; Media Handlers</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000899-IntroductiontoQuickTimeMediaTypesandMediaHandlersGuide-DontLinkElementID_81">QuickTime Media Types and Media Handlers Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../C-Chapter/3VideoandSoundMediaH.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../E-Chapter copy 5/5TimecodeMediaHandle.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers-SW1" title="Text Media Handlers"></a>
<h1>Text Media Handlers</h1>

<p>Applications do not normally interact with media handlers directly; applications make calls to the Movie Toolbox, which calls media handlers as needed. The material in this chapter will be primarily of interest to developers whose applications will allow the creation or editing of text tracks in QuickTime movies.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="4TextMediaHandlers.html#//apple_ref/doc/uid/TP40000899-TextMediaHandlers-DontLinkElementID_11">Text Operations</a>
				
			<br/>
			
        
			
			
				<a href="4TextMediaHandlers.html#//apple_ref/doc/uid/TP40000899-TextMediaHandlers-DontLinkElementID_12">Text Media Handler Functions</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers-DontLinkElementID_11" title="Text Operations"></a>
<h2><a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers-TextOperations" title="Text Operations"></a>Text Operations</h2>
<p>You can use text media handlers to</p>
<ul class="ul">
<li class="li"><p>add plain or styled text samples to a movie</p></li>
<li class="li"><p>indicate scrolling and highlighting properties for the text</p></li>
<li class="li"><p>search for text</p></li>
<li class="li"><p>highlight specified text</p></li>
</ul>
<p>A particular text sample has a default font, size, typeface, and color as well as a location (text box) within the track bounds to be drawn. The data format allows you to include style run information for the text. You can set flags to clip the display to the text box, inhibit automatic scaling of text as the track bounds are scaled, scroll the text, and specify if text is to be displayed at all.</p>
<p>The Movie Toolbox provides functions to help you add text samples to a track. You can use the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code> function to add text to a media. The <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code> function allows you to specify a <code>TextEdit</code> handle (which may have multiple style runs) to be added to a media. The <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddHiliteSample" target="_top">TextMediaAddHiliteSample</a></code> function allows you to indicate highlighting for text that has just been added with the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code> or <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code> function.</p>
<p>The format of the text data that is added to the media is a 16-bit length word followed by the text. The length word specifies the number of bytes in the text. Optionally, one or more atoms of additional data may follow. An atom is structured as a 32-bit length word followed by a 32-bit type followed by some data. The length word includes the size of the data as well as the length and type fields (in other words, the size of the data plus 8).</p>
<p>Text atom types include the <code>style</code> atom (<code>'styl'</code>), the shrunken text box atom (<code>'tbox'</code>), the highlighting atom (<code>'hlit'</code>), the scroll delay atom (<code>'dlay'</code>), and the highlight color atom (<code>'hclr'</code>).</p>
<p>The format of the <code>style</code> atom is the same as TextEdit&#8217;s <code>StScrpRec</code> data type. A <code>StScrpRec</code> data type is a short integer specifying the number of style runs followed by that number of <code><!--a target="_top" -->ScrpSTElement<!--/a--></code> data types, each specifying a different style run.</p>
<p>The shrunken text box atom is added when you set the <code>dfShrinkTextBoxToFit</code> display flag (in the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code> or <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code> function). Its format is simply the rectangle of the shrunken box (16 bytes total, including length and type).</p>
<p>The highlighting atom is added if the <code>hiliteStart</code> and <code>hiliteEnd</code> parameters are set appropriately in the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code> or <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code> function. When <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddHiliteSample" target="_top">TextMediaAddHiliteSample</a></code> is called, an empty text sample (the first 2 bytes are 0) with a highlighting atom is added to the media. The format is two long integers indicating the start and end of the highlighting (16 bytes total).</p>
<p>The scroll delay atom specifies the scroll delay for a sample. It is a long value that specifies the delay time. It consists of 12 bytes, including the length and type fields.</p>
<p>The highlight color atom specifies the highlight color for a sample. Its format is an <code><!--a target="_top" -->RGBColor<!--/a--></code> data type (that is, 2 bytes red, 2 bytes green, and 2 bytes blue). It consists of 14 bytes, including the length and type fields.</p>

<a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers-DontLinkElementID_12" title="Text Media Handler Functions"></a>
<h2><a name="//apple_ref/doc/uid/TP40000899-TextMediaHandlers-TextMediaHandlerFunctions" title="Text Media Handler Functions"></a>Text Media Handler Functions</h2>
<p>The following functions can be used with text media handler components. They support such tasks as adding plain or styled text samples to a movie, setting scrolling and highlighting, and text searching.</p>
<ul class="ul">
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaSetTextSampleData" target="_top">TextMediaSetTextSampleData</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddHiliteSample" target="_top">TextMediaAddHiliteSample</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaFindNextText" target="_top">TextMediaFindNextText</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaHiliteTextSample" target="_top">TextMediaHiliteTextSample</a></code></p></li>
<li class="li"><p><code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaSetTextProc" target="_top">TextMediaSetTextProc</a></code></p></li>
</ul>
<p>The <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code>, <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code>, and <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddHiliteSample" target="_top">TextMediaAddHiliteSample</a></code> functions convert text into the text media format and add it to the media. To use these functions, you need to:</p>
<ul class="ul">
<li class="li"><p>create a text track and media</p></li>
<li class="li"><p>call the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/BeginMediaEdits" target="_top">BeginMediaEdits</a></code> function</p></li>
<li class="li"><p>call the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTextSample" target="_top">TextMediaAddTextSample</a></code>, <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddTESample" target="_top">TextMediaAddTESample</a></code>, or <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaAddHiliteSample" target="_top">TextMediaAddHiliteSample</a></code> function, as appropriate</p></li>
<li class="li"><p>call the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/EndMediaEdits" target="_top">EndMediaEdits</a></code> function</p></li>
<li class="li"><p>call the <code><a href="../../../../Reference/QTRef_TrackAndMedia/Reference/reference.html#//apple_ref/c/func/InsertMediaIntoTrack" target="_top">InsertMediaIntoTrack</a></code> function</p></li>
</ul>
<p>Movie import and export components help to get common data types (such as <code>'PICT'</code> or <code>'snd</code> <code>'</code>) into and out of movies easily. The text import component allows you to get text into a movie using the following principles:</p>
<ul class="ul">
<li class="li"><p>If you try to paste text, the text is inserted at the current position. The text import component tries to find an existing text track that fits the text.</p></li>
<li class="li"><p>If no text tracks exist and there is an insertion operation, the newly created text track has the same position and size as the movie box.</p></li>
<li class="li"><p>If there is an addition operation (using the Shift key), the new track is added below the movie at a height that fits the text.</p></li>
<li class="li"><p>If a text track exists but the text does not fit, a new text track with sufficient height to accommodate the text is created in the same location as the existing one.</p></li>
<li class="li"><p>If you hold down the Option key when you paste, the text is added in parallel at some default duration.</p></li>
<li class="li"><p>If you hold down both the Option and Shift keys, the duration of the text is determined by the length of the current selection.</p></li>
<li class="li"><p>If style information is on the Clipboard, it is used; otherwise, the text appears in the default 12-point application font, centered, in white on a black background.</p></li>
</ul>
<p>If you want more control over how the text is added (for example, if you want to set some display flags or a new track position), your application must:</p>
<ul class="ul">
<li class="li"><p>intercept the text paste</p></li>
<li class="li"><p>instantiate its own text import component using the component type <code>'eat</code> <code>'</code> and component subtype <code>'TEXT'</code></p></li>
<li class="li"><p>use functions including <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetSampleDuration" target="_top">MovieImportSetSampleDuration</a></code>, <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetSampleDescription" target="_top">MovieImportSetSampleDescription</a></code>, <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetDimensions" target="_top">MovieImportSetDimensions</a></code>, and&#160;<code>MovieImportSetAuxilliaryData</code> (with <code>'styl'</code> and a <code>StScrpHandle</code> data type)</p></li>
<li class="li"><p>call the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportHandle" target="_top">MovieImportHandle</a></code> function with the text data</p></li>
<li class="li"><p>adjust the location of the track, if desired (since the text import component may place it below the movie box)</p></li>
</ul>
<p>The Movie Toolbox provides functions that allow you to search for and highlight text. You can use the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaFindNextText" target="_top">TextMediaFindNextText</a></code> function to search for text in a text track, and the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaHiliteTextSample" target="_top">TextMediaHiliteTextSample</a></code> function to highlight specified text in a text track.</p>
<p>You can use the <code><a href="../../../../Reference/QTRef_MovieManager/Reference/reference.html#//apple_ref/c/func/TextMediaSetTextProc" target="_top">TextMediaSetTextProc</a></code> function to specify a customized function whenever a new text sample is added to a movie.</p>
<p>You can use the <code>MyTextProc</code> callback to pass a handle to a specified sample containing formatted text, along with the movie in which the text is being displayed, a pointer to a flag variable, and your reference constant. You specify the desired operations on the text and return an indication of whether you want to display the text in the <code>displayFlag</code> parameter.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../C-Chapter/3VideoandSoundMediaH.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../E-Chapter copy 5/5TimecodeMediaHandle.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/MediaTypesAndHandlers/MHFundamentals/D-Chapter/4TextMediaHandlers.html%3Fid%3DTP40000899-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/MediaTypesAndHandlers/MHFundamentals/D-Chapter/4TextMediaHandlers.html%3Fid%3DTP40000899-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/MediaTypesAndHandlers/MHFundamentals/D-Chapter/4TextMediaHandlers.html%3Fid%3DTP40000899-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>