<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1227: Why does my identity matrix look strange?</title><meta name="keywords" content="QuadToQuadMatrix, Identity Matrix, MatrixRecord"><meta name="Description" content="Technical Q&amp;A QA1227: This Q&amp;A discusses the MatrixRecordand QuadToQuadMatrix."><meta name="categories" content="QuickTime Movie Toolbox"><meta name="week-posted" content="Jan 13, 2003 - Jan 17, 2003"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001750" title="Why does my identity matrix look strange?"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1227</div>
<div id="pageheadsub">Why does my identity matrix look strange?</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>						<P id=p2>Q: I'm trying to understand why my QuckTime identity matrix doesn't seem correct. I thought a QuickTime identity matrix is supposed to be:<br>						</p>						<div align="center">							<pre><code>1 0 0</code></pre>							<pre><code>0 1 0</code></pre>							<pre><code>0 0 1</code></pre>						</div>						<P id=p2>But whenever I create one using <code>SetIdentityMaxtix, </code>I get the following:<br>						</p>						<div align="center">							<pre><code>1 0 0</code></pre>							<pre><code>0 1 0</code></pre>							<pre><code>    0 0 16384</code></pre>						</div>						<P id=p2>      Am I doing something wrong? What does the number 16384 mean?</p>						<P id=p4>A: While a <code>MatrixRecord</code> is declared as a 3-by-3 array of Fixed values, the last column of this structure is actually interpreted as Fract. Therefore, the number 16384 is really just 1.0 as a Fract.<br>						</p>						<p id=p4>      Here's a closer look:</p>						<p id=p4>      A Fixed is a 16-bit signed integer plus a 16-bit fraction.<br>							      A Fract is a 2-bit signed integer plus a 30-bit fraction.</p>						<div align="center">							<table border=0 cellpadding=4 width=550>								<tr>									<td bgcolor="#E6E6E6" align=left scope="row">										<pre><code>typedef long Fixed;</code><code>typedef long Fract;</code></pre>										<pre><code>struct MatrixRecord {     </code><code>Fixed matrix[3][3];</code><code>};</code><code>typedef struct MatrixRecord MatrixRecord;</code></pre>									</td>								</tr>							</table>						</div>						<P id=p4>Each cell in Figure 1 represents the data type of the corresponding element of a 3-by-3 matrix. The elements in the first two columns of a matrix are represented by Fixed values. The elements in the third column, although declared as Fixed, are represented internally as Fract values. The Fract data type specifies a 32-bit, fixed-point value that contains 2 integer bits and 30 fractional bits.</p>						<div align="center">							<table border=0 cellpadding=4 width=384>								<tr>									<td bgcolor="#E6E6E6" align=left scope="row">										<pre><code>[0][0]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1][0]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[2][0]Fract[0][1]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1][1]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[2][1]Fract[0][2]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1][2]Fixed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[2][2]Fract</code></pre>									</td>								</tr>								<tr>									<td align="left" scope="row">										<p><b>Figure 1</b>. MatrixRecord</p>									</td>								</tr>							</table>						</div>						<P id=p4>This is done because the last column defines non-affine (perspective) transformations. These transforms require additional precision in the math, but not as much range for the values.</p>						<P id=p4>Because this last column of values have a complex mapping between the element value and behavior, they are quite difficult to set up properly on your own. QuickTime provides the <code>QuadToQuadMatrix</code> API which can be used to set up a perspective matrix, and can also be used to perform any transformation (scale, rotate, skew, and so on) with a minimal amount of brainwork.</p>						<div align="center">							<table border=0 cellpadding=4 width=550>								<tr>									<td bgcolor="#E6E6E6" align=left scope="row">										<pre><code>OSErr QuadToQuadMatrix(const Fixed *source,                       const Fixed *dest, MatrixRecord *map);</code></pre>									</td>								</tr>								<tr>									<td align="left" scope="row">										<div align="left">											<p><b>Figure 2</b>. QuadToQuadMatrix API</p>										</div>									</td>								</tr>							</table>						</div>						<div align="left">							<p>This call takes four initial points, four final points, and defines a matrix that will map between them.</p>						</div>						<P id=p4>The following is an example of using <code>QuadToQuadMatrix</code> to build a matrix that performs a Star Wars type &quot;scroll into the distance&quot; effect. The function simply starts with your source points (x, y) top left, top right, bottom right and bottom left. Then sets up the destination points top left + 20 in x, + 40 in y, top right - 20 in x, + 40 in y, bottom right and bottom left.</p>						<div align="center">							<table border=0 cellpadding=4 width=550>								<tr>									<td bgcolor="#E6E6E6" align=left scope="row">										<pre>void SetPerspectiveMatrix(Rect &amp;inRect, MatrixRecord &amp;outMatrix){    <code>FixedPoint source[4], dest[4];</code></pre>										<pre><code>    source[0].x = Long2Fix(</code>inRect<code>-&gt;left);    source[0].y = Long2Fix(</code>inRect<code>-&gt;top);    source[1].x = Long2Fix(</code>inRect<code>-&gt;right);    source[1].y = Long2Fix(</code>inRect<code>-&gt;top);    source[2].x = Long2Fix(</code>inRect<code>-&gt;right);    source[2].y = Long2Fix(</code>inRect<code>-&gt;bottom);    source[3].x = Long2Fix(</code>inRect<code>-&gt;left);    source[3].y = Long2Fix(</code>inRect<code>-&gt;bottom);</code></pre>										<pre><code>    dest[0].x = Long2Fix(</code>inRect<code>-&gt;left + 20);    dest[0].y = Long2Fix(</code>inRect<code>-&gt;top + 40);    dest[1].x = Long2Fix(</code>inRect<code>-&gt;right - 20);    dest[1].y = Long2Fix(</code>inRect<code>-&gt;top + 40);    dest[2].x = Long2Fix(</code>inRect<code>-&gt;right);    dest[2].y = Long2Fix(</code>inRect<code>-&gt;bottom);    dest[3].x = Long2Fix(</code>inRect<code>-&gt;left);    dest[3].y = Long2Fix(</code>inRect<code>-&gt;bottom);</code></pre>										<pre><code>    QuadToQuadMatrix((Fixed *)source, (Fixed *)dest, </code>outMatrix<code>);}</code></pre>									</td>								</tr>								<tr>									<td align="left" scope="row">										<p><b>Listing 1</b>. Example use of QuadToQuadMatrix</p>									</td>								</tr>							</table>							<br>						</div>						<hr width=500 align=center>						<!-- begin_date --><H4 ALIGN=center>[Jan 03 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1227.html%3Fid%3DDTS10001750-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1227.html%3Fid%3DDTS10001750-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1227.html%3Fid%3DDTS10001750-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>