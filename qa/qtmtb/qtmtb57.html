<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QTMTB57: How do I decompress individual frames into an offscreen?</title>	<meta name="keywords" content="Offscreen drawing, Video Frame, GWorld"><meta name="Description" content="Technical Q&amp;A QTMTB57: Methods for scaling and decompressingindividual frames of a video track into an offscreen RGBbuffer so the pixels can be further manipulated."><meta name="categories" content="QuickTime Movie Toolbox"><meta name="week-posted" content="Apr 24, 2000 - Apr 28, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002027" title="How do I decompress individual frames into an offscreen?"></a> <!-- white background --><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxMovieBasics-date.html">Movie Basics</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QTMTB57</div>
<div id="pageheadsub">How do I decompress individual frames into an offscreen?</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER>			<!-- -->						<!-- Document Body --><table cellspacing="0" cellpadding="0" border="0" WIDTH="600"><tr><td align="left" scope="row"><hr width=500 align=center><p id=p2>Q: How can you scale and decompress individual frames of a video track into an offscreen RGB buffer so the pixels can be further manipulated?</p><P id=p4>A: The code snippets below show how a single frame can be drawn into a <CODE>GWorld</CODE>. Once the <CODE>GWorld</CODE> is created, use <CODE>SetMovieGWorld()</CODE> to specify the <CODE>GWorld</CODE> you would like the movie to draw into. Use <CODE>GetMovieNextInterestingTime()</CODE> to find the places where the movie will display a new video sample (frame), then set the movie position using <CODE>SetMovieTimeValue()</CODE>. The time value passed to <CODE>SetMovieTimeValue()</CODE> is returned by <CODE>GetMovieNextInterestingTime()</CODE>. Finally, task the movie using <CODE>MovieTask()</CODE>, which performs the actual drawing into your <CODE>GWorld</CODE>. You will end up with the <CODE>GWorld</CODE> containing the frame pixels ready for manipulation.</p><P ID=p4><CODE>GWorlds</CODE> are very flexible and can contain pixel formats other than RGB. For more information regarding <CODE>GWorlds</CODE> and drawing, refer to the following technical documentation:</p><UL TYPE="circle">	<LI><a href="../../documentation/quicktime/qtdevdocs/INMAC/MACWIN/imOffGraphWorlds.1.htm">http://developer.apple.com/documentation/quicktime/qtdevdocs/INMAC/MACWIN/imOffGraphWorlds.1.htm</A></li>	<LI><a href="http://developer.apple.com/quicktime/icefloe/dispatch008.html">http://developer.apple.com/quicktime/icefloe/dispatch008.html</A></li>	<LI><a href="http://developer.apple.com/quicktime/icefloe/dispatch016.html">http://developer.apple.com/quicktime/icefloe/dispatch016.html</A></li>	<LI><a href="../../technotes/tn/tn1182.html">http://developer.apple.com/technotes/tn/tn1182.html</A></li>	<LI><a href="../../documentation/mac/QuickDraw/QuickDraw-302.html">http://developer.apple.com/documentation/mac/QuickDraw/QuickDraw-302.html</A></li></UL><P ID=p4>The full sample application called <CODE>VideoFrameToGWorld</CODE> can be found on the QuickTime Sample Code page:</P><UL TYPE="circle">	<LI><a href="../../samplecode/Sample_Code/QuickTime.htm">http://www.developer.apple.com/samplecode/Sample_Code/QuickTime.htm</A></UL><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>    /* Globals */GWorldPtr gSrcGWorld = NULL;Movie gMovie = NULL;    /* set current time value to beginning of the movie */TimeValue gMovieTime = 0;UInt32 gFrameCount = -1;UInt32 gFrameNumber = 0;    /* CountThemFrames    Count the number of video &quot;frames&quot; in the movie by stepping    through all of the video &quot;interesting times&quot;, or in other words,    the places where the movie displays a new video sample. The time    between these interesting times is not necessarily constant. */void CountThemFrames( void ) {    OSType whichMediaType = VIDEO_TYPE;    short flags = nextTimeMediaSample + nextTimeEdgeOK;    TimeValue duration;    TimeValue theTime = 0;    while (theTime &gt;= 0) {        gFrameCount++;        GetMovieNextInterestingTime(gMovie,                            flags,                            1,                            &amp;whichMediaType,                            theTime,                            0,                            &amp;theTime,                            &amp;duration);        /* after the first interesting time, don't include        the time we are currently at. */        flags = nextTimeMediaSample;    }}    /* MakeGWorld    Get the bounding rectangle of the movie and create a    32-bit gworld with those dimensions.  This GWorld will    be used for rendering movie frames into. */void MakeGWorld( void ) {    Rect srcRect;    Rect portRect;    OSErr err = noErr;        /* get the movies dimensions */    GetMovieBox(gMovie,&amp;srcRect);    err = NewGWorld(&amp;gSrcGWorld,                k32ARGBPixelFormat,                &amp;srcRect,                NULL,                NULL,                0);    BailError(err);        /* make sure to lock the PixMap */    LockPixels(GetGWorldPixMap(gSrcGWorld));        /* erase */    SetGWorld(gSrcGWorld,NULL);    GetPortBounds(gSrcGWorld, &amp;portRect);    EraseRect(&amp;portRect);        /* tell the movie to draw into the GWorld */    SetMovieGWorld(gMovie, gSrcGWorld,  GetGWorldDevice(gSrcGWorld));bail:    return;}    /* NextFrame    Get the next frame of the movie, set the movie time    for that frame, then task the movie which will draw    the frame to the GWorld.  Modify the movie matrix so    the next frame will be rotated just for fun, and    finally, draw the frame number on top of the image    and inval the window rect. */void NextFrame( void ) {    if ( gFrameNumber &lt; gFrameCount ) {        TimeValue duration;            /* get the next frame of the source movie */        short   flags = nextTimeMediaSample;        OSType  whichMediaType = VIDEO_TYPE;            /* if this is the first frame, include the            frame we are currently on */        if (gFrameNumber == 0)            flags |= nextTimeEdgeOK;            /* skip to the next interesting time and            get the duration for that frame */        GetMovieNextInterestingTime(gMovie,                            flags,                            1,                            &amp;whichMediaType,                            gMovieTime,                            0,                            &amp;gMovieTime,                            &amp;duration);            /* set the time for the frame and give            time to the movie toolbox */        SetMovieTimeValue(gMovie,gMovieTime);            /* tasking the movie does the actual draw */        MoviesTask(gMovie,0);    }    /* You now have pixels you can    play with in the GWorld! */}</pre></TD></TR></TABLE></CENTER><BR><BR><!-- begin_date --><H4 ALIGN=center>[Apr 24 2000]</H4><!-- end_date --></td></tr></table></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qtmtb/qtmtb57.html%3Fid%3DDTS10002027-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qtmtb/qtmtb57.html%3Fid%3DDTS10002027-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qtmtb/qtmtb57.html%3Fid%3DDTS10002027-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>