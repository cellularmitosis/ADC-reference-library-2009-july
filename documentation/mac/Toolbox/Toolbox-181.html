<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MyMenuDef(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING181></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-180.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-182.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-89.html"><B>Chapter 3 - Menu Manager</B></A> / <A HREF="Toolbox-107.html"><B>Menu Manager Reference</B></A><BR><DL><DD><A HREF="Toolbox-179.html"><B>Application-Defined Routine</B></A> / <A HREF="Toolbox-180.html"><B>The Menu Definition Procedure</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING181-0></A>
<H3>MyMenuDef</H3>
 You can provide your own menu definition procedure if you need special features in a menu other than those provided by the standard menu definition procedure. This section describes how to define your own menu definition procedure, defines the parameters passed to your procedure by the Menu Manager, and describes the general actions your procedure should perform.<P>
<PRE>
PROCEDURE MyMenuDef (message: Integer; theMenu: MenuHandle;
                     VAR menuRect: Rect; hitPt: Point; 
                     VAR whichItem: Integer);
</PRE>
<DL>
<DT>message
<DD> A number that identifies the operation that the menu definition proce- dure should perform. The <CODE>message</CODE> parameter can contain any one of these values:
</DL>
<PRE>
	<CODE>CONST
      mDrawMsg       = 0; {draw the menu}
      mChooseMsg     = 1; {tell which item was chosen }
                          { and highlight it}
      mSizeMsg       = 2; {calculate menu dimensions}
      mPopUpMsg      = 3; {calculate rectangle of }
                          { the pop-up box}</CODE>
</PRE>
<DL>
<DT>
<DD> Your menu definition procedure should not respond to any value other than the four constants listed above.
<DT>theMenu
<DD> A handle to the menu record of the menu that the operation should affect.
<DT>menuRect
<DD> The rectangle (in global coordinates) in which the menu is located; the Menu Manager provides this information to the menu definition procedure only when the value in the message parameter is the <CODE>mDrawMsg</CODE> or <CODE>mChooseMsg</CODE> constant. 
<DT>
<DD> When the value in the message parameter is the <CODE>mPopUpMsg</CODE> constant, the menu definition procedure should calculate and then return the dimensions of the pop-up box in this parameter. When the value in the message parameter is the <CODE>mSizeMsg</CODE> constant, the menu definition procedure should calculate the horizontal and vertical dimensions of the menu rectangle and store these values in the <CODE>menuWidth</CODE> and <CODE>menuHeight</CODE> fields of the menu record.
<DT>hitPt
<DD> A mouse location (in global coordinates). The Menu Manager provides<DFN> </DFN>information in this parameter to the menu definition procedure when the value in the message parameter is the <CODE>mChooseMsg</CODE> or <CODE>mPopUpMsg</CODE> constant. When the menu definition procedure receives the <CODE>mChooseMsg</CODE> constant in the message parameter, it should determine whether the mouse location specified in the hitPt parameter is in an enabled menu item and highlight or unhighlight the item specified in the whichItem parameter appropriately. When the menu definition procedure receives the <CODE>mPopUpMsg</CODE> constant in the message parameter, the <CODE>hitPt</CODE> parameter contains the top-left coordinates of the closed pop-up box, which your procedure can use to calculate the rectangle of the open pop-up box.
<DT>whichItem
<DD> The item number of the last item chosen from this menu (or 0 if an item hasn't been chosen). The Menu Manager provides<DFN> </DFN>information in this parameter to the menu definition procedure when the value in the message parameter is the <CODE>mChooseMsg</CODE> constant. When the menu definition procedure receives the <CODE>mChooseMsg</CODE> constant in the <BR>message parameter, it should determine whether the mouse location specified in the hitPt parameter is in an enabled menu item. If so, the menu definition procedure should unhighlight the item specified by <BR>the whichItem parameter, highlight the new item, and return the new item number in whichItem. If the mouse location isn't in an enabled menu item, the menu definition procedure should unhighlight the <BR>item specified by the whichItem parameter and return 0 in the <BR>whichItem parameter.
</DL>
<A NAME=HEADING181-11></A>
<H5>DESCRIPTION</H5>
 The Menu Manager calls your menu definition procedure whenever it needs your definition procedure to perform a certain action on a specific menu. The action <BR>your menu definition procedure should perform depends on the value of the <BR><CODE>message</CODE> parameter.<P>
 If you provide your own menu definition procedure, store it in a resource of type <CODE>'MDEF'</CODE> and include its resource ID in the description of each menu that uses your own definition procedure. If you create a menu using <CODE>GetMenu</CODE> (or <CODE>GetNewMBar</CODE>), the Menu Manager reads the menu definition procedure into memory and stores a handle to it in the <CODE>menuProc</CODE> field of the menu's menu record. <P>
 If you create a menu using <CODE>NewMenu</CODE>, the Menu Manager stores a handle to the standard menu definition procedure in the <CODE>menuProc</CODE> field of the menu's menu record. In this case you must replace the value in the <CODE>menuProc</CODE> field with a handle to your own procedure and then call the <CODE>CalcMenuSize</CODE> procedure. If your menu definition procedure is in a resource file, you can get its handle by using the Resource Manager to read it from the resource file into memory. However, note that you should usually store your menus in resources (rather than using <CODE>NewMenu</CODE>) to make your application easier to localize. See the "Resource Manager" chapter in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I> for information on the Resource Manager.<P>
 The menu definition procedure is responsible for drawing the contents of the menu and its menu items, determining whether the cursor is in a displayed menu, highlighting and unhighlighting menu items, and calculating a menu's dimensions.<P>
 When the Menu Manager requests your menu definition procedure to perform an action on a menu, it provides your procedure with a handle to its menu record. This allows your procedure to access the data in the menu record and to use any data in the variable data portion of the menu record to appropriately handle the menu items.<P>
 When the Menu Manager creates a menu as a result of an application calling <CODE>GetMenu</CODE> or <CODE>GetNewMBar</CODE>, it fills out the <CODE>menuID</CODE>, <CODE>menuProc</CODE>, <CODE>enableFlags</CODE>, <CODE>menuTitle</CODE>, and <CODE>itemDefinitions</CODE> fields of the menu record according to its resource definition. If the menu is managed by your menu definition procedure, the Menu Manager calls your procedure (specifying <CODE>mSizeMsg</CODE>) to calculate and fill in the <CODE>menuHeight</CODE> and <CODE>menuWidth</CODE> fields of the menu record. The menu items are described by a variable length field (<CODE>itemDefinitions</CODE>) in the menu record. Your menu definition procedure can define and use this variable-length data in any manner it chooses. <A NAME=MARKER-2-693></A><P>
 For pop-up menus that are not implemented as controls, the Menu Manager uses the menu definition procedure to support pop-up menus. If your menu definition procedure supports pop-up menus, it should respond appropriately to the <CODE>mPopUpMsg</CODE> constant.<P>
 The Menu Manager specifies the <CODE>mPopUpMsg</CODE> constant in the <CODE>message</CODE> parameter and calls your menu definition procedure whenever it needs to calculate the rectangle bounded by the pop-up box for a pop-up menu that is managed by your menu definition procedure. The parameter <CODE>theMenu</CODE> contains a handle to the menu record <BR>of the pop-up menu, the <CODE>hitPt</CODE> parameter contains the top-left coordinates of the pop- up box, and <CODE>whichItem</CODE> contains the previously chosen item. Your menu definition procedure should calculate the rectangle in which the pop-up menu is to appear <BR>and return this rectangle in the <CODE>menuRect</CODE> parameter. If the menu is so large that it scrolls, return the actual top of the menu in the <CODE>whichItem</CODE> parameter. For pop-up menus, your menu definition procedure also must place the pop-up menu's scrolling information in the global variables <CODE>TopMenuItem</CODE> and <CODE>AtMenuBottom</CODE>. Place in <CODE>TopMenuItem</CODE> the pixel value of the top of the scrollable menu, and place in <CODE>AtMenuBottom</CODE> the pixel value of the bottom of the scrollable menu.<P>
<DL>
<DT><B>Note</B>
<DD>Your menu definition procedure should not assume that the A5 <BR>register is properly set up, so your procedure can't refer to any of <BR>the QuickDraw global variables. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING181-21></A>
<H5>SEE ALSO</H5>
 For additional information on how your menu definition procedure should respond when it receives the <CODE>mDrawMsg</CODE>, <CODE>mChooseMsg</CODE>, or <CODE>mSizeMsg</CODE> constant in the <CODE>message</CODE> parameter, see <A HREF=Toolbox-106.html#MARKER-9-448>"Writing Your Own Menu Definition Procedure"</A> beginning on <A HREF=Toolbox-106.html#MARKER-9-448>page 3-87</A>.<A NAME=MARKER-2-694></A>  <A NAME=MARKER-2-695></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-180.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-182.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
