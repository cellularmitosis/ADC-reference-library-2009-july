<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Component Creation Guide: Creating a Derived Media Handler Component</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating a Derived Media Handler Component"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent" title="Creating a Derived Media Handler Component"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../QuickTimeComponentCreation-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000595" target="_top">QuickTime Component Creation</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000898-IntroductiontoQuickTimeComponentCreationGuide-DontLinkElementID_38">QuickTime Component Creation Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2AboutQuickTimeMedia.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4DerivedMediaHandler.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-SW1" title="Creating a Derived Media Handler Component"></a>
<h1>Creating a Derived Media Handler Component</h1>

<p>This chapter describes the process of creating a derived media handler component. It provides an example of creating a derived media handler component and defines its component and request flags. The functional interface that your derived media handler component must support is described in <span class="content_text"><a href="../D-Chapter/4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-SW1">Derived Media Handler Support</a></span>.</p>
<p>Before reading this section, you should be familiar with how to create components.</p>
<p>Apple has defined the <code>MediaHandlerType</code> component type value (<code>'mhlr'</code>) for media handler components. All components of this type have the same type value.</p>
<p>Apple has also defined a functional interface for derived media handler components. For information about the functions that your component must support, see <span class="content_text"><a href="../D-Chapter/4DerivedMediaHandler.html#//apple_ref/doc/uid/TP40000898-DerivedMediaHandlerSupport-SW1">Derived Media Handler Support</a></span>.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="3CreatingaDerivedMed.html#//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_6">A Sample Derived Media Handler Component</a>
				
			<br/>
			
        
			
			
				<a href="3CreatingaDerivedMed.html#//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_10">Request Processing</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_6" title="A Sample Derived Media Handler Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-ASampleDerivedMediaHandlerComponent" title="A Sample Derived Media Handler Component"></a>A Sample Derived Media Handler Component</h2>
<p>This section supplies a sample program that implements a derived media handler component for PICT images.</p>
<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_7" title="Implementing the Required Component Functions"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-ImplementingtheRequiredComponentFunctions" title="Implementing the Required Component Functions"></a>Implementing the Required Component Functions</h3>
<p>Listing 2-1 supplies the component dispatchers for the media handler component for PICT images together with the required functions.</p>
<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_41" title="Listing 2-1Implementing the required media handler component functions"></a>
<p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Implementing the required media handler component functions</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentInstance       self;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentInstance       parent;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentInstance       delegateComponent;<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed                   width;<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed                   height;<span></span></pre></td></tr><tr><td scope="row"><pre>    MatrixRecord            matrix;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media                   media;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                   track;<span></span></pre></td></tr><tr><td scope="row"><pre>} PictGlobalsRecord, *PictGlobals;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictMediaDispatch (ComponentParameters *params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             Handle storage)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = badComponentSelector;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentFunction componentProc = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (params->what) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictOpen; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictClose; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictCanDo; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictVersion; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentTargetSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictVersion; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaInitializeSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictInitialize; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaIdleSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictIdle; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaSetDimensionsSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictSetDimensions; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaSetMatrixSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = PictSetMatrix; break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (componentProc)<span></span></pre></td></tr><tr><td scope="row"><pre>        err = CallComponentFunctionWithStorage (storage, params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                             componentProc);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        err = DelegateComponentCall (params, ((PictGlobals)<span></span></pre></td></tr><tr><td scope="row"><pre>                                                 storage)->delegateComponent);<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictCanDo (PictGlobals globals,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            short ftnNumber)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (ftnNumber) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentTargetSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaInitializeSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaIdleSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaSetDimensionsSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMediaSetMatrixSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            return true;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            return ComponentFunctionImplemented<span></span></pre></td></tr><tr><td scope="row"><pre>                                (globals->delegateComponent, ftnNumber);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictVersion (PictGlobals globals)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0x00020001;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictOpen(PictGlobals globals,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* allocate storage */<span></span></pre></td></tr><tr><td scope="row"><pre>    globals = (PictGlobals)NewPtrClear(sizeof(PictGlobalsRecord));<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = MemError()) return err;<span></span></pre></td></tr><tr><td scope="row"><pre>    SetComponentInstanceStorage(self, (Handle)globals);<span></span></pre></td></tr><tr><td scope="row"><pre>    globals->self = self;<span></span></pre></td></tr><tr><td scope="row"><pre>    globals->parent = self;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* find a base media handler to serve as a delegate */<span></span></pre></td></tr><tr><td scope="row"><pre>    globals->delegateComponent =<span></span></pre></td></tr><tr><td scope="row"><pre>                OpenDefaultComponent (MediaHandlerType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             BaseMediaType);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (globals->delegateComponent)<span></span></pre></td></tr><tr><td scope="row"><pre>        PictTarget(globals, self); /* set up the calling chain */<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposePtr((Ptr)globals);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = cantOpenHandler;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictClose (PictGlobals globals,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (globals) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (globals->delegateComponent)<span></span></pre></td></tr><tr><td scope="row"><pre>            CloseComponent(globals->delegateComponent);<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposePtr((Ptr)globals);<span></span></pre></td></tr><tr><td scope="row"><pre>    }   <span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictTarget(PictGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         ComponentInstance parentComponent)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* remember who is at the top of your calling chain */<span></span></pre></td></tr><tr><td scope="row"><pre>    store->parent = parentComponent;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* and inform your delegate component of the change */<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentSetTarget(store->delegateComponent, parentComponent);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_8" title="Initializing a Derived Media Handler Component"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-InitializingaDerivedMediaHandlerComponent" title="Initializing a Derived Media Handler Component"></a>Initializing a Derived Media Handler Component</h3>
<p>The derived media handler component is initialized by the Movie Toolbox’s calling of the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaInitialize" target="_top">MediaInitialize</a></code> function. You should then report the derived media handler capabilities to the base media handler before the Movie Toolbox starts working with your media by calling the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetHandlerCapabilities" target="_top">MediaSetHandlerCapabilities</a></code> function from your <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaInitialize" target="_top">MediaInitialize</a></code> function.</p>
<p>Listing 2-2 is the initialization function for a derived media handler. The <code>PictInitialize</code> function stores the initial height, width, track movie matrix, media, and track of the derived media handler component. From <code>PictInitialize</code>, the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetHandlerCapabilities" target="_top">MediaSetHandlerCapabilities</a></code> function is called to inform the base media handler of its existence and features.</p>
<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_42" title="Listing 2-2Initializing a derived media handler"></a>
<p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Initializing a derived media handler</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult PictInitialize (PictGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                          GetMovieCompleteParams *gmc)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* remember some useful parameters */<span></span></pre></td></tr><tr><td scope="row"><pre>    store->width = gmc->width;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->height = gmc->height;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->matrix = gmc->trackMovieMatrix;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->media = gmc->theMedia;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->track = gmc->theTrack;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* tell the base media handler about your derived<span></span></pre></td></tr><tr><td scope="row"><pre>        media handler */<span></span></pre></td></tr><tr><td scope="row"><pre>    MediaSetHandlerCapabilities(store->delegateComponent,<span></span></pre></td></tr><tr><td scope="row"><pre>    handlerHasSpatial, handlerHasSpatial);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_9" title="Drawing the Media Sample"></a>
<h3><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DrawingtheMediaSample" title="Drawing the Media Sample"></a>Drawing the Media Sample</h3>
<p>The Movie Toolbox provides processing time to your derived media handler to display samples by calling the <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaIdle" target="_top">MediaIdle</a></code> function. Your media handler may use this time to play its media sample. The code in  Listing 2-3 allows the derived media handler component to draw the current media sample (in this case, a PICT image).</p>
<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_43" title="Listing 2-3Drawing the media sample"></a>
<p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Drawing the media sample</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult PictIdle (PictGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                   TimeValue atMediaTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                   long flagsIn, long *flagsOut,<span></span></pre></td></tr><tr><td scope="row"><pre>                                   const TimeValue *tr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect r;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle sample = NewHandle (0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = MemError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* get the current sample */<span></span></pre></td></tr><tr><td scope="row"><pre>    err = GetMediaSample (store->media, sample, 0, nil,<span></span></pre></td></tr><tr><td scope="row"><pre>                                atMediaTime, nil, 0, 0, 0, 0, 0, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* draw it using the current matrix */<span></span></pre></td></tr><tr><td scope="row"><pre>    SetRect (&amp;r, 0, 0, FixRound (store->width),<span></span></pre></td></tr><tr><td scope="row"><pre>                FixRound (store->height));<span></span></pre></td></tr><tr><td scope="row"><pre>    TransformRect (&amp;store->matrix, &amp;r, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    EraseRect (&amp;r);<span></span></pre></td></tr><tr><td scope="row"><pre>    DrawPicture ((PicHandle)sample, &amp;r);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeHandle (sample);<span></span></pre></td></tr><tr><td scope="row"><pre>    *flagsOut |= mDidDraw;          /* let Movie Toolbox know you drew<span></span></pre></td></tr><tr><td scope="row"><pre>                                        something */<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictSetDimensions (PictGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             Fixed width,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             Fixed height)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* remember the new track */<span></span></pre></td></tr><tr><td scope="row"><pre>    store->width = width;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->height = height;<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult PictSetMatrix (PictGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         MatrixRecord *trackMovieMatrix)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* remember the new display matrix */<span></span></pre></td></tr><tr><td scope="row"><pre>    store->matrix = *trackMovieMatrix;<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-DontLinkElementID_10" title="Request Processing"></a>
<h2><a name="//apple_ref/doc/uid/TP40000898-CreatingaDerivedMediaHandlerComponent-RequestProcessing" title="Request Processing"></a>Request Processing</h2>
<p>Because your derived media handler is based on the base media handler component, you avoid many of the details involved in creating a media handler. However, your derived media handler must observe a few rules when processing service requests. These rules are as follows:</p>
<ul class="ul">
<li class="li"><p>When you receive an open request from the Component Manager, in addition to the other processing you perform on your own behalf, you must also open a connection to the base media handler component. You should save the component instance that is returned by the Component Manager so that your media handler can use the services of the base media handler.</p></li>
<li class="li"><p>The base media handler has a component type of <code>MediaHandlerType</code> (which is set to <code>'mhlr'</code>) and a component subtype of <code>BaseMediaType</code> (which is set to <code>'gnrc'</code>). You can use these values with the Component Manager’s <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/OpenDefaultComponent" target="_top">OpenDefaultComponent</a></code> function to open a connection to the base media handler.</p></li>
<li class="li"><p>At this time, you must also tell the base media handler that your handler is derived from it. Use the Component Manager’s <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/OpenComponent" target="_top">OpenComponent</a></code> function to create a component instance of your media handler as a descendant of the base media handler. After calling that function, you should send the <code>kComponentSetTargetSelect</code> request to the base media handler, so that it knows your media handler is derived from it. Use the Component Manager’s <code><a href="../../../../../Carbon/Reference/Component_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/ComponentSetTarget" target="_top">ComponentSetTarget</a></code> function to send a target request.</p></li>
<li class="li"><p>When you receive a close request from the Component Manager, be sure to close your handler’s connection to the base media handler component. Use the Component Manager’s <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/CloseComponent" target="_top">CloseComponent</a></code> function.</p></li>
<li class="li"><p>Your derived media handler must support the target request, so that your component can be used by other media handlers.</p></li>
<li class="li"><p>Be sure to pass all unsupported service requests to the base media handler component. Use the Component Manager’s <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/DelegateComponentCall" target="_top">DelegateComponentCall</a></code> function to pass these requests to the base media handler.</p></li>
<li class="li"><p>If your media handler component competes for potentially scarce system resources, your component should release those resources when you aren’t using them. For example, if you are creating a media handler that uses sound, you might use sound channels. Because there are a limited number of sound channels available, your component should free its channels whenever your media is not playing or has been stopped. You can reallocate the channels when you start playing or your component’s <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaPreroll" target="_top">MediaPreroll</a></code> function is called.</p></li>
</ul>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2AboutQuickTimeMedia.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4DerivedMediaHandler.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-01-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/C-Chapter/3CreatingaDerivedMed.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/C-Chapter/3CreatingaDerivedMed.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/WritingQTComponents/MHCreating/C-Chapter/3CreatingaDerivedMed.html%3Fid%3DTP40000898-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>