<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TE15: TextEdit: Advice &amp; Descent</title>                                       <meta name="categories" content="Text"><meta name="week-posted" content="May 26, 1986 - Jun 6, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002823" title="TextEdit: Advice & Descent"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTextFonts-date.html">Text & Fonts</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/TextFonts/index.html" target="_blank">Reference Library > Text & Fonts</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TE15</div>
<div id="pageheadsub">TextEdit: Advice &amp; Descent</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">TESelRect</A><BR><BR><A HREF="#Section2">TEDoText</A><BR><BR><A HREF="#Section3">TEScrpLength</A><BR><BR><A HREF="#Section4">CharWidth</A><BR><BR><A HREF="#Section5">Clikloops</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This technical note will point out some bugs (and possible workarounds), andother items of interest for the TextEdit programmer.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Mar 01 1988]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>TESelRect</h2><p>Multiple line selections are often more complex shapes than simple rectangles.If this is the case, the <code>teSelRect</code> field of the <code>TERec</code> is setto the last (bottommost) rectangle in the selection. The <code>teHiHook</code> iscalled to invert each line of the selection.</p><p>The ROM limits the selection range (i.e. the lines that get set into<code>teSelRect</code>) to only those lines which will fit into the<code>viewRect</code>. This means that <code>teSelRect</code> will be left at the lastvisible line. (The old 64K ROMs made all the calls for the complete selectionand just let clipping take care of the rest.)</p><P><A HREF="#top">Back to top</A></p><a name=Section2></A><h2>TEDoText</h2><p>The parameters of this special hook into TextEdit need a little additionalexplanation. <code>D3</code> and <code>D4</code> are described on page 391 of <i>InsideMacintosh Volume I</i> as being the first and last characters to be redrawn.This is true but specific to the -1 "<code>DoDraw</code>" case. In fact, all thecalls to <code>TEDoText</code> are interested in these first and last characterpositions. They determine the selection for a (1) highlight call, the caretposition for a (-2) <code>DoCaret</code> call (where <code>D4</code> is ignored as it'sassumed to equal <code>D3</code>), etc.</p><p>Note that the <code>DoCaret</code> (-2) call behaves differently than described in<i>Inside Macintosh</i>, as well. Good old page 391 says it sets up the penposition for caret drawing. Since an <code>InvertRect</code> call is used to drawthe caret if you use the default <code>teCarHook</code>, the ROMs just set up<code>teSelRect</code>, they don't bother with the QuickDraw pen.</p><P><A HREF="#top">Back to top</A></p><a name=Section3></A><h2>TEScrpLength</h2><p>Inside Macintosh describes <code>TEScrpLength</code> as a long integer; indeed,four bytes are reserved for this value with the intent of someday using thatrange of values. However, the ROMs use word operations in their accesses to<code>TEScrpLength</code> and make word calculations with it. This means that thehigh word of <code>TEScrpLength</code> is used for calculations. This is somethingto watch out for.</p><P><A HREF="#top">Back to top</A></p><a name=Section4></A><h2>CharWidth</h2><p><i>Inside Macintosh</i> says that <code>CharWidth</code> takes stylistic variationsinto account when determining the width of a character. In fact, for<i>italic</i> and <em>outlined</em> styles the extra width is not taken intoaccount. TextEdit relies on <code>CharWidth</code> for positioning of the caret,etc. If you have chosen to use, for instance, italic style in your TE recordyou will find that as you type the caret actually overlaps the character to theleft and so when the caret is erased some of that character will get erased,too. This is somewhat disconcerting to the user but the program will stillfunction correctly.</p><P><A HREF="#top">Back to top</A></p><a name=Section5></A><h2>Clikloops</h2><p>If you add your own click loop and try to do something like update scroll barsyou may run into trouble. Before your routine gets called, TextEdit will haveset clipping down to just the <code>viewRect</code>. You will have to save away theold clipping region, set it out to sufficient size (-32767, -32767, 32767,32767 is probably OK), do your drawing, then restore TextEdit's clipping areaso that it can function properly.</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P>TextEdit</p><P><A HREF = "te_14.html">M.TE.TEScrollBug</a></p><P><A HREF = "te_18.html">M.TE.EOLAmbiguity</a></p><P><A HREF = "te_16.html">M.TE.TextEditBugs</a></p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/te_15.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/te/te_15.html%3Fid%3DDTS10002823-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/te/te_15.html%3Fid%3DDTS10002823-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/te/te_15.html%3Fid%3DDTS10002823-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>