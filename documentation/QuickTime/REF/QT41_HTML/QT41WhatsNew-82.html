<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML><head><script language="JavaScript" src="../../frametest.js"></script><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1"><META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css"><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><!-- Link line removed --><TITLE> A Change in the Loading Model</TITLE><script language=javascript> window.parent.focus(); </script></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: QuickTime Reference</I><P>| <A HREF="QT41WhatsNew-81.html">Previous</A> | <A HREF="QT41WhatsNew-1.html">Chapter Contents</A> | <A HREF="QT41WhatsNew.html">Chapter Top</A> | <A HREF="QT41WhatsNew-83.html">Next</A> |</P><!-- QTnavbar end --><H1 CLASS="H2-Heading2"><A NAME="pgfId-38642"></A>A Change in the Loading Model</H1><P CLASS="T1-Text1"><A NAME="pgfId-30091"></A>The loading model has changed from this </P><P CLASS="T1-Text1"><A NAME="pgfId-30092"></A><TT>NewMovieFrom</TT>...   &lt;playable&gt;     &lt;complete&gt;</P><P CLASS="T1-Text1"><A NAME="pgfId-30093"></A>to this </P><P CLASS="T1-Text1"><A NAME="pgfId-30094"></A><TT>NewMovieFrom</TT>...   &lt;incomplete&gt;   &lt;playable&gt;  &lt;complete&gt;</P><P CLASS="T1-Text1"><A NAME="pgfId-30095"></A>In the old model, you could play the movie but not all the data would be made available. In the new model, when the movie is loaded -- i.e., between the time it is loaded and playable -- it doesn't &quot;know&quot; its tracks, or its structure. </P><P CLASS="T1-Text1"><A NAME="pgfId-48786"></A>During this &lt;incomplete&gt; phase querying the movie for its characteristics is not helpful. Only at the point where it is playable can such queries be useful.</P><P CLASS="T1-Text1"><A NAME="pgfId-30096"></A>To determine when such queries are useful or to enable or disable behavior, a new QuickTime Movie Toolbox API has been introduced in QuickTime 4.1. This is the <TT>GetMovieLoadState </TT>function.</P><TT><A NAME="pgfId-55573"></A>pascal long GetMovieLoadState( Movie theMovie );</TT><P CLASS="T1-Text1"><A NAME="pgfId-30098"></A>The <TT>GetMovieLoadState </TT>routine returns a value that indicates the state of the loading process.</P><TT><A NAME="pgfId-55577"></A>kMovieLoadStateLoading&nbsp;&nbsp;//&nbsp;searching&nbsp;for&nbsp;movie&nbsp;resource<BR>kMovieLoadStatePlayable&nbsp;//&nbsp;movie&nbsp;fully&nbsp;formed,&nbsp;fast-start&nbsp;would&nbsp;work<BR>kMovieLoadStateComplete&nbsp;//&nbsp;all&nbsp;media&nbsp;data&nbsp;is&nbsp;available</TT><P CLASS="T1-Text1"><A NAME="pgfId-30100"></A>These values are ordered so that the values treated as numbers conform to this rule:</P><TT><A NAME="pgfId-55581"></A>kMovieLoadStateLoading &lt; kMovieLoadStatePlayable <BR>                                                &lt; kMovieLoadStateComplete</TT><P CLASS="T1-Text1"><A NAME="pgfId-30102"></A>This allows code to perform relative comparisons against these milestones to determine if certain operations make sense. </P><P CLASS="T1-Text1"><A NAME="pgfId-38663"></A>There is also an additional state <TT>kMovieLoadStateError</TT> indicating that the loading of the movie failed. This typically means that a URL could not be found or loaded. This has a negative value, so that the above rule becomes:</P><TT><A NAME="pgfId-55585"></A>kMovieLoadStateError &lt; kMovieLoadStateLoading &lt; kMovieLoadStatePlayable &lt; <BR>kMovieLoadStateComplete</TT><P CLASS="T1-Text1"><A NAME="pgfId-48793"></A>If the value is less than complete, then you should not assume that you can save it. </P><BLOCKQUOTE><B>Note:&nbsp;&nbsp;</B><A NAME="pgfId-30105"></A>If the load state is negative, then this indicates an error has occurred. </P></BLOCKQUOTE><P CLASS="T1-Text1"><A NAME="pgfId-42720"></A>Not all states will be seen by a client. A completely local movie will transition directly to <TT>kMovieLoadStateComplete</TT>. A local movie with media stored on a slow connection will probably transition to <TT>kMovieLoadStatePlayable</TT> since fast-starting will occur.</P><P CLASS="T1-Text1"><A NAME="pgfId-30106"></A>By way of a quick example of code using this new information, consider how the load state might be used by an application updated to recognize <A NAME="marker-46150"></A>asynchronous movie loading. Assume that it called the <TT>NewMovieFromDataRef</TT> function to open a URL:</P><TT><A NAME="pgfId-55589"></A>err = NewMovieFromDataRef( &amp;theMovie, newMovieActive | newMovieAsyncOK,<BR>                            nil, url, URLDataHandlerSubType );</TT><P CLASS="T1-Text1"><A NAME="pgfId-30108"></A>and periodically it will check the movie to see if it has reached a particular state of interest:</P><TT><A NAME="pgfId-55593"></A>void&nbsp;checkOnMovie(&nbsp;MovieInfo&nbsp;movieInfo&nbsp;)<BR>{<BR>&nbsp;&nbsp;&nbsp;long&nbsp;loadState;<BR>loadState&nbsp;=&nbsp;GetMovieLoadState(movieInfo-&gt;theMovie);<BR><BR>&nbsp;&nbsp;&nbsp;if&nbsp;(movieInfo-&gt;loadState&nbsp;==&nbsp;loadState)&nbsp;&nbsp;//&nbsp;didn't&nbsp;change<BR>&nbsp;&nbsp;&nbsp;return;<BR><BR>&nbsp;&nbsp;&nbsp;movieInfo-&gt;loadState&nbsp;=&nbsp;loadState;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;new&nbsp;state<BR><BR>&nbsp;&nbsp;&nbsp;if&nbsp;(loadState&nbsp;&lt;&nbsp;0)&nbsp;{<BR>//&nbsp;failed&nbsp;to&nbsp;load&nbsp;the&nbsp;movie&nbsp;so&nbsp;tell&nbsp;the&nbsp;user&nbsp;and&nbsp;dispose&nbsp;of&nbsp;movie<BR>&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;if&nbsp;(loadState&nbsp;&lt;&nbsp;kMovieLoadStatePlayable)&nbsp;{<BR>//&nbsp;just&nbsp;keep&nbsp;tasking&nbsp;the&nbsp;movie&nbsp;so&nbsp;it&nbsp;gets&nbsp;time&nbsp;to&nbsp;load<BR>&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;if&nbsp;(loadState&nbsp;&lt;&nbsp;kMovieLoadStateComplete)&nbsp;{<BR>//&nbsp;we&nbsp;just&nbsp;became&nbsp;playable<BR>//&nbsp;get&nbsp;movie&nbsp;box&nbsp;and&nbsp;size&nbsp;window<BR>//&nbsp;put&nbsp;a&nbsp;movie&nbsp;controller&nbsp;on&nbsp;this&nbsp;movie<BR>//&nbsp;update&nbsp;other&nbsp;UI&nbsp;appropriately<BR>//&nbsp;check&nbsp;for&nbsp;auto&nbsp;play<BR>&nbsp;&nbsp;&nbsp;}<BR><BR><BR>&nbsp;&nbsp;&nbsp;if&nbsp;(loadState&nbsp;&gt;=&nbsp;kMovieLoadStateComplete)&nbsp;{<BR><BR>//&nbsp;now&nbsp;we&nbsp;know&nbsp;all&nbsp;media&nbsp;data&nbsp;is&nbsp;available&nbsp;and&nbsp;we&nbsp;might<BR>//&nbsp;only&nbsp;now&nbsp;allow&nbsp;the&nbsp;user&nbsp;to&nbsp;perform&nbsp;a&nbsp;self-contained&nbsp;save<BR>//&nbsp;or&nbsp;an&nbsp;export<BR>&nbsp;&nbsp;&nbsp;}<BR>}</TT><P CLASS="T1-Text1"><A NAME="pgfId-30110"></A>Until the movie has reached its playable state, an application should not try to attach a movie controller, since the user data that allows the QuickTime Movie Toolbox to choose the type of movie controller will not be available. Also, the application should call the <TT>MoviesTask</TT> function to give it time to continue loading.</P><P CLASS="T1-Text1"><A NAME="pgfId-30111"></A>This offers a way to detect the difference between when the movie is fast-starting and therefore its data is not all available and when it is fully loaded. This is useful in enabling certain menu items only appropriate when all media is accessible.</P><P CLASS="T1-Text1"><A NAME="pgfId-30113"></A>In the future, it is expected that new and useful states will be added. However, it will be done in such a way that the above ordering still holds.</P><H4><A HREF="QT41WhatsNew-83.html" CLASS="Hypertext">GetMovieStatus Updated</A></H4><H4><A HREF="QT41WhatsNew-84.html" CLASS="Hypertext">Other API Additions</A></H4><hr>&#169; 2000 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: QuickTime Reference</I><P>| <A HREF="QT41WhatsNew-81.html">Previous</A> | <A HREF="QT41WhatsNew-1.html">Chapter Contents</A> | <A HREF="QT41WhatsNew.html">Chapter Top</A> | <A HREF="QT41WhatsNew-83.html">Next</A> |</P><!-- QTnavbar end --></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>