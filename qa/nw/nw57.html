<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A NW57: Using Legacy Ethernet Driver Processes on a PowerMac G3</title><meta name="keywords" content="Mac OS 8 G3 Legacy Ethernet Driver API Processes Shim"><meta name="Description" content="Technical Q&amp;A NW57: Q&amp;A explains why a Legacy applicationwhich uses Ethernet Driver APIs will not run on Power MacintoshG3s that use Mac Os 8.1. Includes a description of EthernetShims and how they work."><meta name="categories" content="Networking"><meta name="week-posted" content="Feb 8, 1999 - Feb 12, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001469" title="Using Legacy Ethernet Driver Processes on a PowerMac G3"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A NW57</div>
<div id="pageheadsub">Using Legacy Ethernet Driver Processes on a PowerMac G3</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><hr width=500 align=center><p id=p2><B>Q:</B> I have a legacy application which uses the outdated Ethernet Driver APIs as described in the ENET.h interface file. The application has worked on all Power Macintosh models except for the Power Macintosh G3 systems using Mac OS 8.1. Is there any way for this application to work on a Power Macintosh G3 system?</P><p id=p4>A: There is a known issue with the older Power Macintosh G3 systems: the processes which used the legacy Ethernet APIs no longer work on these systems. These processes could not open the built-in Ethernet driver. This problem was addressed with the Power Macintosh G3 systems released beginning January 1999.</p><p id=p4><B>Ethernet Shim History</B></P><p id=p4>With the release of the first PCI-based Power Macintosh systems, an Ethernet shim was built into the System to support processes which used the Ethernet Driver API. On a PCI Power Macintosh, the Ethernet driver is native PowerPC code and is based on the Data Link Provider Interface (DLPI) for communications with client processes. TheEthernet Shim translates the Ethernet Driver API calls into DLPIequivalents and passes them on to the built-in driver. For incomingpackets, the DLPI driver passes appropriate packets to the Ethernetshim, which in turns calls the Ethernet protocol handler, or looks fora queued <CODE>ENETRead</CODE> parameter block call to pass the packet.</P><p id=p4>The Ethernet shim was designed to support only the built-inEthernet device, and not PCI Ethernet cards which are plugged into thevarious slots. The use of this shim required a specific coding changefor some processes. In order to use the shim, the process could notuse the <CODE>OpenDriver</CODE> call. Instead, the process was required to use the Slot Manager call <CODE>SGetTypeSRsrc</CODE> to identify the built-in Ethernet service, then use the <CODE>OpenSlot</CODE> call to open the Ethernet device in slot 0 to obtain the device <CODE>refNum</CODE>. The device <CODE>refNum</CODE> is used in allsubsequent calls to the legacy .ENET API. Refer to <a href="../../documentation/mac/Networking/Networking-262.html#HEADING262-6" target="_blank">Inside Macintosh:Networking, Chapter 11 Listing 11-1</A> for an example of this method. This code change applies to legacy Ethernet processesonly.</p><p id=p4><B>How the Ethernet Shim Works</B></P><p id=p4>The Ethernet shim works by registering a device <CODE>sRsrc</CODE> with the Slot Manager for the built-in Ethernet hardware. When the <CODE>SGetTypeSRsrc</CODE> call is made to identify Ethernet services present, the device <CODE>sRsrc</CODE> for the built-in port, is returned. By using the <CODE>OpenSlot</CODE> call, the shim unit table driver was loaded and the driver <CODE>refNum</CODE> returned to the caller. The driver shim processed the standard<CODE>Open</CODE>, <CODE>Control</CODE>, <CODE>Status</CODE>, and <CODE>Close</CODE> calls to the Ethernet driver by translating each call into their DLPI (Data Link Provider Interface) message equivalent, and passing them to the DLPI driver for the built-in Ethernet hardware. The shim driver installed a packet handler with the DLPI driver so that it would be notified of incoming packets destined for the Ethernet shim clients.</P><p id=p4>The shim driver process worked well until the release of the Power Macintosh G3 system. With the Power Macintosh G3 systems released in 1997 - 1998, a change to the ROM broke the mechanism by which theEthernet shim was able to register built-in Ethernet services withthe Slot Manager. As a result, the calls to <CODE>SGetNextSRsrc</CODE> and <CODE>OpenSlot</CODE> fail.</P><p id=p4><B>Workaround</B></P><p id=p4>A workaround was implemented for Mac OS 8.5 such that,during startup, the System identified the original Power Macintosh G3systems and installed the .ENET device driver into the unit table. Aproblem with this solution was that most legacy processes hadalready made the change to using the <CODE>OpenSlot</CODE> call; they no longer used the <CODE>OpenDriver</CODE> call. Many of these legacy processes included backup code to try to open the .ENET0 driver using the <CODE>OpenDriver</CODE> call, if the call to open a slot-based Ethernet driver failed. To accommodate these processes, Mac OS 8.5 also installs a copy of the ethernet shim driver with the .ENET0 name. If the legacy software still fails, then a possible alternative is to modify the code to make the <CODE>OpenDriver</CODE> call on the .ENET driver, if the <CODE>OpenSlot</CODE> call fails.</P><p id=p4>To summarize, it is a known issue that processes which use thelegacy Ethernet API will fail when run on a Power Macintosh G3 systemreleased in 1997 or 1998 running either Mac OS 8.0 or 8.1.This problem may be solved by using Mac OS 8.5 on theseaffected systems.</P></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Feb 08 1999]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/nw/nw57.html%3Fid%3DDTS10001469-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/nw/nw57.html%3Fid%3DDTS10001469-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/nw/nw57.html%3Fid%3DDTS10001469-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center> </BODY></HTML>