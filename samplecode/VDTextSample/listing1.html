<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>VDTextSample - /VDTextSample.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxJava-date.html">Java</a> &gt; <A HREF="javascript:location.replace('index.html');">VDTextSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Java/index.html" target="_blank">Reference Library > Java</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">VDTextSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/VDTextSample.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/VDTextSample.c</option></select>
				</p>
				</form>
				<p><strong><a href="VDTextSample.zip">Download Sample</a></strong> (&#147;VDTextSample.zip&#148;, 54.1K)<BR>
<strong><a href="VDTextSample.dmg">Download Sample</a></strong> (&#147;VDTextSample.dmg&#148;, 116.5K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    VDTextSample.c    Written by:  Larry Lai, DTS  Copyright:  &copy; 1995 by Apple Computer, Inc., all rights reserved.  This snippet shows you how to draw and erase text to the video  preview image without causing flickers on the screen. It only   works with 'vdig's that support key color (Quadra 660AV, 840AV,   630 and PowerMac 6100/7100/8100 AVs). Read &quot;Inside Macintosh:   QuickTime Component&quot; Video Digitizer Component chapter for more   information.    Change History (most recent first):    &lt;1&gt;  2/22/95 LL  create first working version.      3/10/95  LL  add about-this-app box.  To Do:     *//* HEADER FILES */#include  &lt;Types.h&gt;#include  &lt;Memory.h&gt;#include  &lt;QuickDraw.h&gt;#include  &lt;Palettes.h&gt;#include  &lt;QDOffscreen.h&gt;#include  &lt;Errors.h&gt;#include  &lt;Fonts.h&gt;#include  &lt;Dialogs.h&gt;#include  &lt;Windows.h&gt;#include  &lt;Menus.h&gt;#include  &lt;Events.h&gt;#include  &lt;OSUtils.h&gt;#include  &lt;Resources.h&gt;#include  &lt;ToolUtils.h&gt;#include  &lt;AppleEvents.h&gt;#include  &lt;GestaltEqu.h&gt;#include  &lt;Processes.h&gt;#include  &lt;Aliases.h&gt;#include  &lt;MixedMode.h&gt;#include  &lt;LowMem.h&gt;#include   &lt;Sound.h&gt;#include  &lt;Movies.h&gt;#include  &lt;QuickTimeComponents.h&gt;#include   &lt;ImageCompression.h&gt;/* DEFINES */#define  appleID      128      #define  appleMenu    0#define  aboutMeCommand  1#define  fileID      129#define textCommand    1#define  quitCommand   3#define  aboutMeDLOG    128#define  okButton    1#define  kSoundID    128#define  kBruceIconItem  4/* FUNCTION PROTOTYPES*/void CheckError(OSErr error, Str255 displayString);Boolean  IsQuickTimeInstalled(void);void initialize(void);WindowPtr makeWindow(void);SeqGrabComponent makeSequenceGrabber (WindowPtr aWindow);void makeGrabChannels (  SeqGrabComponent anSG,            SGChannel *videoChannel,            SGChannel *soundChannel,            const Rect *bounds, Boolean willRecord);void EraseVideo(SeqGrabComponent aSG, WindowPtr aWindow, SGChannel theChannel);void ShowAboutMeDialog(void);void DoCommand(long mResult);pascal Boolean MyFilter(DialogPtr inputDialog, EventRecord *myDialogEvent, short *theDialogItem);/* GLOBALS */Boolean  done = false;Boolean showString = true;Boolean  menuKey = false;MenuHandle mymenu0, mymenu1;WindowPtr  theWindow;SeqGrabComponent  theSG;SGChannel  videoChannel, soundChannel;/* FUNCTIONS */void CheckError(OSErr error, Str255 displayString){  if(error == noErr) return;  if(displayString[0] &gt; 0)    DebugStr(displayString);  ExitToShell();}Boolean  IsQuickTimeInstalled(void){  short   error;  long  result;    error = Gestalt(gestaltQuickTime, &amp;result);  return  (error == noErr);}void ShowAboutMeDialog(void){  GrafPtr savePort;  DialogPtr theDialog;  Handle  theSound;  short itemHit;  GetPort(&amp;savePort);  theDialog = GetNewDialog(aboutMeDLOG, nil, (WindowPtr) - 1);  SetPort(theDialog);  do  {    ModalDialog((ModalFilterProcPtr) MyFilter, &amp;itemHit);    switch(itemHit){      case kBruceIconItem:        /* don't mess with Bruce */              theSound = GetResource('snd ', kSoundID);                if (theSound != nil) {                  SndPlay(nil, (SndListHandle)theSound, false);                    ReleaseResource(theSound);                }                break;                        }  } while (itemHit != okButton);  CloseDialog(theDialog);  SetPort(savePort);  return;}// True confession: this was stolen from C.K's &quot;DialogBits.c&quot;.pascal Boolean MyFilter(DialogPtr inputDialog, EventRecord *myDialogEvent, short *theDialogItem){    Rect tempRect;    short tempItem;    Handle tempHandle;    Point tempPoint;    Point mousePoint;    Boolean hiLit = false;    Boolean returnVal = false;  if (myDialogEvent-&gt;what == mouseDown) {        mousePoint = (myDialogEvent-&gt;where);        GlobalToLocal(&amp;mousePoint);        /* First see if we're in Bruce */        GetDItem(inputDialog, kBruceIconItem, &amp;tempItem, &amp;tempHandle, &amp;tempRect);        if (PtInRect(mousePoint, &amp;tempRect)) {            /* invert my icon, and track it whilst the user holds the mouse down */            InvertRect(&amp;tempRect);            hiLit = true;            while (StillDown()) {                GetMouse(&amp;tempPoint);                       /* returns point in local coords */                if (PtInRect(tempPoint, &amp;tempRect)) {                    /* in the rect.  See if it's hilighted or not */                    if (hiLit == false) {                        hiLit = true;                        InvertRect(&amp;tempRect);                    }                } else {                    /* not in the rectangle.  If it's hilit, get rid of that */                    if (hiLit == true) {                        hiLit = false;                        InvertRect(&amp;tempRect);                    }                }            }            if (hiLit == true) {                /* if it's still hilited when the mouse comes up, then that means the */                /* user stayed in and wants to take this icon action */                InvertRect(&amp;tempRect);                      /* clear the hiliting if it's still lit */                *theDialogItem = kBruceIconItem;                returnVal = true;                           /* telling the Dialog Manager we handled it, pass item back */            }        }   }  return returnVal;}void initialize(void){   OSErr  err;  short  i;    InitGraf (&amp;qd.thePort);  InitFonts();  InitWindows();  InitMenus();  TEInit();  InitDialogs(nil);  MaxApplZone();    for (i = 0; i&lt;=10; i++)    MoreMasters();    if(!IsQuickTimeInstalled())    CheckError(-1, &quot;\pPlease install QuickTime and try again.&quot;);      err = EnterMovies();  CheckError(err, &quot;\pUnable to initialize Movie Toolbox.&quot;);      /*  Set up menus.  */  mymenu0 = GetMenu(appleID);  AddResMenu(mymenu0, 'DRVR');  InsertMenu(mymenu0, 0);  mymenu1 = GetMenu(fileID);  InsertMenu(mymenu1, 0);  DrawMenuBar();}WindowPtr makeWindow(void){  WindowPtr   aWindow;  Rect     windowRect = {0, 0, 240, 320};  Rect    bestRect;    /* figure out the best monitor for the window */  GetBestDeviceRect (nil, &amp;bestRect);    /* put the window in the top left corner of that monitor */  OffsetRect(&amp;windowRect, bestRect.left + 10, bestRect.top + 50);    /* create the window */  aWindow = NewCWindow(nil, &amp;windowRect, &quot;\pPreviewer&quot;,            true, noGrowDocProc, (WindowPtr)-1,            true, 0);        /* and set the port to the new window */  SetPort(aWindow);    return aWindow;  }main (void){  OSErr    err = noErr;  char    key;  initialize();  theWindow = makeWindow();  theSG = makeSequenceGrabber(theWindow);  if(!theSG) return;    makeGrabChannels(theSG, &amp;videoChannel, &amp;soundChannel,           &amp;theWindow-&gt;portRect, false);    if((videoChannel == nil) &amp;&amp; (soundChannel == nil))    CheckError(err, &quot;\pCan't start preview&quot;);      err = SGStartPreview(theSG);  CheckError(err, &quot;\pCan't start preview&quot;);    while(!done) {    ICMAlignmentProcRecord alignProc;    short  part;    WindowPtr  whichWindow;    EventRecord  theEvent;        GetNextEvent(everyEvent, &amp;theEvent);        switch(theEvent.what) {      case nullEvent: /*give the sequence grabber time */        err = SGIdle (theSG);        if(err ) done = true;        break;              case updateEvt:         if(theEvent.message == (long) theWindow) {            /* inform the sequesnce grabber of the update */          SGUpdate(theSG, nil);          EraseVideo(theSG, theWindow, videoChannel);          BeginUpdate(theWindow);          EndUpdate(theWindow);            /*and swallow the update event */        }        break;            case mouseDown:        part = FindWindow(theEvent.where,                      &amp;whichWindow);        switch(part) {          case inSysWindow:            SystemClick(&amp;theEvent, whichWindow);            break;          case inMenuBar:            DoCommand(MenuSelect(theEvent.where));            case inContent:            /* pause until mouse button is released */            SGPause(theSG, true);            while (StillDown())            ;            SGPause(theSG, false);            EraseVideo(theSG, theWindow, videoChannel);            break;          case inGoAway:            done = TrackGoAway (theWindow, theEvent.where);            break;          case inDrag:            /*pause when dragging window so video doesn't draw in              the wrong place */            SGPause (theSG, true);            SGGetAlignmentProc(theSG, &amp;alignProc);            DragAlignedWindow(theWindow,                      theEvent.where,                      &amp;qd.screenBits.bounds,                      nil, &amp;alignProc);            SGPause(theSG, false);            EraseVideo(theSG, theWindow, videoChannel);            break;        }        break;            case keyDown:      case autoKey:          key = theEvent.message &amp; charCodeMask;          if (theEvent.modifiers &amp; cmdKey)            if (theEvent.what == keyDown)              DoCommand(MenuKey(key));          break;      }  }      /*clean up*/  SGStop (theSG);  CloseComponent(theSG);  DisposeWindow (theWindow);}void DoCommand(long mResult){  int theMenu;  short theItem;  Str255 daName;  GrafPtr saveThePort;  theItem = LoWord(mResult);  theMenu = HiWord(mResult);  switch (theMenu)  {    case appleID:      if (theItem == aboutMeCommand)        ShowAboutMeDialog();      else      {        GetMenuItemText(mymenu0, theItem, daName);        GetPort(&amp;saveThePort);        (void)OpenDeskAcc(daName);        SetPort(saveThePort);      }      break;    case fileID:      switch (theItem)      {        case textCommand:          showString = 1 - showString;          menuKey = true;          EraseVideo(theSG, theWindow, videoChannel);          break;        case quitCommand:          done = true;          break;        default:          break;      }      break;  }  HiliteMenu(0);  return;}  SeqGrabComponent makeSequenceGrabber (WindowPtr aWindow){  SeqGrabComponent anSG;  OSErr err = noErr;    /* open up the default sequence grabber */  anSG = OpenDefaultComponent (SeqGrabComponentType, 0);  if (anSG) {      /* initialize the default sequence grabber component */    err = SGInitialize(anSG);    if (!err ) {      /* set the sequence grabber's graphics world to the         specified window */      err = SGSetGWorld (anSG, (CGrafPtr) aWindow, nil);    }  }  if (err &amp;&amp; anSG) {    /* clean up on failure */    CloseComponent(anSG);    anSG = nil;  }  return anSG;}void makeGrabChannels (SeqGrabComponent anSG,            SGChannel *videoChannel,            SGChannel *soundChannel,            const Rect *bounds, Boolean willRecord){  OSErr  err;  long  usage;  /*figure out th usage */    usage = seqGrabPreview;  if(willRecord)    usage |= seqGrabRecord;  /* create a video channel */  err = SGNewChannel (anSG, VideoMediaType, videoChannel);  if(!err) {    /* set boundries for new video channel */    err = SGSetChannelBounds (*videoChannel, bounds);    /*set usage for new video channel */    if(!err)      err = SGSetChannelUsage (*videoChannel,                    usage | seqGrabPlayDuringRecord);          if(err) {        /* clean up on failure */        SGDisposeChannel(anSG, *videoChannel);        *videoChannel = nil;    }  }    /* create a sound channel */  err = SGNewChannel (anSG, SoundMediaType, soundChannel);  if(!err){    /*set usage of new sound channel */    err = SGSetChannelUsage (*soundChannel, usage);    if(err){      /* clean up on failure */      SGDisposeChannel(anSG, *soundChannel);      *soundChannel = nil;    }  }}void EraseVideo(SeqGrabComponent aSG, WindowPtr aWindow, SGChannel theChannel){  GrafPtr            savePort;  GDHandle          saveGD;  RGBColor          oldColor, rgb, myRGBColor;  VideoDigitizerComponent    aVDIG;  long            index;  OSErr            error;  aVDIG = SGGetVideoDigitizerComponent(theChannel);      error = VDGetKeyColor(aVDIG, &amp;index);  if(error == noErr){        /* yellow is the color for the text on display */      myRGBColor.red = 0xFC00;    myRGBColor.green = 0xF37D;    myRGBColor.blue = 0x052F;      GetPort(&amp;savePort);    saveGD = GetGDevice();    SetGDevice(GetMainDevice());    SetPort(aWindow);      if(!showString &amp;&amp; menuKey){          Index2Color(index, &amp;rgb);        GetForeColor(&amp;oldColor);        RGBForeColor(&amp;rgb);        PaintRect(&amp;((GrafPtr) aWindow)-&gt;portRect);        RGBForeColor(&amp;oldColor);        menuKey = false;    }        if(showString){        MoveTo (30,30);      TextFont (applFont);      TextSize (14);      RGBForeColor(&amp;myRGBColor);      DrawString(&quot;\pCupertino News&quot;);      }    SetPort(savePort);    SetGDevice(saveGD);  }  else  {      /* can not find the key color, let's us bail */      SysBeep(10);      Alert(129, nil);          done = true;  }  }</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/VDTextSample/listing1.html%3Fid%3DDTS10000337-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/VDTextSample/listing1.html%3Fid%3DDTS10000337-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/VDTextSample/listing1.html%3Fid%3DDTS10000337-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>