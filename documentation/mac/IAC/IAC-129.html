<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Requesting User Interaction(IM:IC)</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" ="A" NAME="HEADING129"></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-128.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="IAC-130.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-126.html"><B>Interacting With the User</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING129-0"></A>
<H2>Requesting User Interaction</H2>
 <A NAME="MARKER-2-235"></A>If your server application needs to interact with the user for any reason, it must call the <CODE>AEInteractWithUser</CODE> function to make sure it is in the foreground before it actually interacts with the user. When <CODE>AEInteractWithUser</CODE> allows user interaction (based on the client's and server's preferences), <CODE>AEInteractWithUser</CODE> brings the server application to the foreground--either directly or after the user responds to a notification request--and then returns a <CODE>noErr</CODE> result code. If <CODE>AEInteractWithUser</CODE> brings the server to the foreground directly, the client returns to the foreground immediately after the server has finished interacting with the user. If <CODE>AEInteractWithUser</CODE> brings the server to the foreground after the user responds to a notification request, the server remains in the foreground after completing the user interaction.<P>
 The <CODE>AEInteractWithUser</CODE> function specifies how long your handler is willing to wait for a response from the user. For example, if the timeout value is 900 ticks (15 seconds) and the Apple Event Manager posts a notification request, the Notification Manager begins to display a blinking icon in the upper-right corner of the screen, then removes the notification request (and the blinking icon) if the user does not respond within 15 seconds. (The discussion that follows describes some restrictions on the icons that can be displayed in this situation.)<P>
 Note that the timeout value passed to the <CODE>AEInteractWithUser</CODE> function is separate from the timeout value passed to the <CODE>AESend</CODE> function, which specifies how long the client application is willing to wait for the reply or return receipt from the server application. If <CODE>AEInteractWithUser</CODE> does not receive a response from the user within the specified time, <CODE>AEInteractWithUser</CODE> returns <CODE>errAETimeout</CODE>. <P>
 You may want to give the user a method of setting the interaction level. For example, some users may not want to be interrupted while background processing of an Apple event occurs, or they may not want to respond to dialog boxes when your application is handling Apple events sent from another computer.<P>
 <A HREF="#MARKER-9-439">Listing 4-14</A> illustrates the use of the <CODE>AEInteractWithUser</CODE> function. You call this function before your application displays a dialog box or otherwise interacts with the user when processing an Apple event. You specify a timeout value, a pointer to a Notification Manager record, and the address of an idle function as parameters to <CODE>AEInteractWithUser</CODE>.<P>
<B>Listing 4-14  <A NAME="MARKER-9-439"></A><A NAME="MARKER-21-440"></A>Using the <CODE>AEInteractWithUser</CODE> function</B><P>
<PRE>
myErr := AEInteractWithUser(kAEDefaultTimeout, gMyNotifyRecPtr, 
                            @MyIdleFunction);
IF myErr &lt;&gt; noErr THEN
   {the attempt to interact failed; do any error handling}
   DoError(myErr)
ELSE
   {interact with the user by displaying a dialog box }
   { or by interacting in any other way that is necessary}
   DisplayMyDialogBox; 
</PRE>
 You can set a timeout value, in ticks, in the first parameter to <CODE>AEInteractWithUser</CODE>. Use the <CODE>kAEDefaultTimeout</CODE> constant if you want the Apple Event Manager to use a default value for the timeout value. The Apple Event Manager uses a timeout value of about one minute if you specify this constant. You can also specify the <CODE>kNoTimeOut</CODE> constant if your application is willing to wait an indefinite amount of time for a response from the user. Usually you should provide a timeout value, so that your application can complete processing of the Apple event in a reasonable amount of time. <A NAME="MARKER-2-111"></A><P>
 If you specify <CODE>NIL</CODE> instead of a Notification Manager record in the second parameter of <CODE>AEInteractWithUser</CODE>, the Apple Event Manager looks for an application icon with the ID specified by the application's bundle (<CODE>'BNDL'</CODE>) resource and the application's file reference (<CODE>'FREF'</CODE>) resource. The Apple Event Manager first looks for an <CODE>'SICN'</CODE> resource with the specified ID; if it can't find an <CODE>'SICN'</CODE> resource, it looks for the <CODE>'ICN#'</CODE> resource and compresses the icon to fit in the menu bar. The Apple Event Manager won't look for any members of an icon family other than the icon specified in the <CODE>'ICN#'</CODE> resource.<P>
 If the application doesn't have <CODE>'SICN'</CODE> or <CODE>'ICN#'</CODE> resources, or if it doesn't have a file reference resource, the Apple Event Manager passes <CODE>NIL</CODE> to the Notification Manager, and no icon appears in the upper-right corner of the screen. Therefore, if you want to display any icon other than those of type <CODE>'SICN'</CODE> or <CODE>'ICN#'</CODE>, you must specify a notification record as the second parameter to the <CODE>AEInteractWithUser</CODE> function. <A NAME="MARKER-2-132"></A><P>
<DL>
<DT><B>Note</B>
<DD>If you want the Notification Manager to use a color icon when it posts a notification request, you should provide a Notification Manager record that specifies a <CODE>'cicn'</CODE> resource.<EM></EM>  <IMG ALIGN="BOTTOM" SRC="graphics/diamond.gif">
</DL>
 The <CODE>AEInteractWithUser</CODE> function posts a notification request only when user interaction is allowed and the <CODE>kAECanSwitchLayer</CODE> flag in the <CODE>keyInteractLevelAttr</CODE> attribute is not set.<A NAME="MARKER-2-443"></A><P>
 The last parameter to <CODE>AEInteractWithUser</CODE> specifies an idle function provided by your application. Your idle function should handle any update events, null events, operating-system events, or activate events while your application is waiting to be brought to the front. See <A HREF="IAC-202.html#MARKER-9-123">"Writing an Idle Function" on page 5-22</A> for more information. <P>
 <A HREF="#MARKER-9-444">Figure 4-1</A> illustrates a situation in which a client application (a forms application) might request a service from a server application (a database application). To perform this service, the server application must interact with the user.<P>
<B>Figure 4-1  <A NAME="MARKER-9-444"></A>A document with a button that triggers a Get Data event</B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/AES-01.gif"><P>
 <A HREF="#MARKER-9-444">Figure 4-1</A> shows part of an electronic form used to enter information about an order received by telephone. If the customer has ordered from the company before, the user can quickly retrieve the customer's address and telephone number by clicking the Retrieve Customer Info button. In response, the forms application sends a Get Data event to a database application (SurfDB) currently open on the same computer. The Get Data event sent by the forms application (the client application for the ensuing transaction) asks SurfDB (the server) to locate the customer's name in a table of addresses and return the customer's address. When the forms application receives the reply Apple event, it can add the address data to the appropriate fields in the order form.<P>
 If SurfDB, as the server application, locates more than one entry for the specified customer name, it needs to interact with the user to determine which data to return in the reply Apple event. To interact with the user, the server application must be in the foreground, so that it can display a dialog box like the one shown in <A HREF="#MARKER-9-445">Figure 4-2</A>.<P>
<B>Figure 4-2  <A NAME="MARKER-9-445"></A>A server application displaying a dialog box that requests information from the user</B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/AES-02.gif"><P>
 <A HREF="#MARKER-9-446">Figure 4-3</A>, <A HREF="#MARKER-9-447">Figure 4-4</A>, and <A HREF="#MARKER-9-448">Figure 4-5</A> illustrate two methods of dealing with this situation. <A HREF="#MARKER-9-446">Figure 4-3</A> shows the behavior of the server application that is common to both methods. In both cases, the server uses <CODE>AESetInteractionAllowed</CODE> to set its own interaction level to <CODE>kAEInteractWithLocal</CODE>. After calling <CODE>AEResolve</CODE> to locate the requested data, the server application discovers that two addresses match the name the user typed into the electronic form. The server then calls <CODE>AEInteractWithUser</CODE> with a timeout value of <CODE>kAEDefaultTimeout</CODE> so it can find out which address the user wants. <P>
<B>Figure 4-3  <A NAME="MARKER-9-446"></A>Handling user interaction</B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/AE-L-21.jpg"><P>
 <A HREF="#MARKER-9-447">Figure 4-4</A> shows the circumstances in which the server application's call to <CODE>AEInteractWithUser</CODE> shown in <A HREF="#MARKER-9-446">Figure 4-3</A> will cause the Apple Event Manager to bring the server application directly to the foreground. The client application sets the <CODE>kAECanInteract</CODE>, <CODE>kAECanSwitchLayer</CODE>, and <CODE>kAEWaitReply</CODE> flags in the <CODE>sendMode</CODE> parameter of the <CODE>AESend</CODE> function when it sends the Get Data event shown in the figure. These flags indicate that the client application expects the user to wait until the address appears in the appropriate fields of the electronic form before continuing with any other work. In this case, an automatic layer switch will not surprise the user and will avoid the additional user action required to respond to a notification request, so <CODE>AEInteractWithUser</CODE> brings the server application directly to the foreground and returns a <CODE>noErr</CODE> result code. The server application then displays the dialog box requesting that the user select the desired customer. <P>
 After the user selects the desired customer and clicks OK, the server application's Get Data event handler returns. The Apple Event Manager immediately brings the client application to the foreground, and the client application displays the requested customer information in the appropriate fields. <P>
<B>Figure 4-4  <A NAME="MARKER-9-447"></A>Handling user interaction with the <CODE>kAEWaitReply</CODE> flag set</B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/AE-L-22.jpg"><P>
 <A HREF="#MARKER-9-448">Figure 4-5</A> shows the circumstances in which the server application's call to <CODE>AEInteractWithUser</CODE> in <A HREF="#MARKER-9-446">Figure 4-3</A> will cause the Apple Event Manager to post a notification request rather than bringing the server application directly to the foreground. <P>
<B>Figure 4-5  <A NAME="MARKER-9-448"></A>Handling user interaction with the <CODE>kAEQueueReply</CODE> flag set <A NAME="MARKER-2-449"></A> <A NAME="MARKER-2-450"></A></B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/AE-L-27.jpg"><P>
 The only difference between the Get Data event shown in <A HREF="#MARKER-9-447">Figure 4-4</A> and the Get Data event shown in <A HREF="#MARKER-9-448">Figure 4-5</A> is that the client application has set the <CODE>kAEQueueReply</CODE> flag instead of the <CODE>kAEWaitReply</CODE> flag in the <CODE>sendMode</CODE> parameter of <CODE>AESend</CODE> and has not set the <CODE>kAECanSwitchLayer</CODE> flag. This combination of flags indicates that the client application expects the user to continue filling in other parts of the form, such as the items being ordered; the address will just appear after a while, provided there is no duplicate name. In this case, an automatic layer switch would disrupt the user's work. Instead of bringing the server application directly to the foreground, <CODE>AEInteractWithUser</CODE> uses the Notification Manager to post a notification request.<P>
 After the user has responded to the request and has brought the server application to the foreground, <CODE>AEInteractWithUser</CODE> returns a <CODE>noErr</CODE> result code, and the server application displays the dialog box requesting that the user select the desired customer. When the user selects a customer and clicks OK, the server application's Get Data event handler returns. Because the user brought the server to the foreground manually, the server remains in the foreground after the handler returns. <A NAME="MARKER-9-120"></A><P>
</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="IAC-128.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="IAC-130.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><BR>7 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
