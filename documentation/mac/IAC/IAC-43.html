<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Calling an Edition Opener(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING43></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-42.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-44.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A> / <A HREF="IAC-40.html"><B>Subscribing to Non-Edition Files</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING43-0></A>
<H2><A NAME=MARKER-9-363></A><A NAME=MARKER-21-364></A>Calling an Edition Opener</H2>
 You use the <CODE>CallEditionOpenerProc</CODE> function to call an edition opener. Since the Edition Manager is a package that may move, a real pointer cannot be safely returned for the standard opener and I/O routines. The system opener and the <BR>I/O routines are returned as a value that is not a valid address to a procedure. The <CODE>CallEditionOpenerProc</CODE> and <CODE>CallFormatIOProc</CODE> functions check for these values and call the system openers.<P>
 You should never assume that a value for a system opener is a fixed constant.<A NAME=MARKER-2-365></A><P>
<PRE>
err := CallEditionOpenerProc (selector, PB, routine);
</PRE>
 Set the <CODE>selector</CODE> parameter to one of the edition opener verbs. The edition opener verbs include<A NAME=MARKER-2-366></A><A NAME=MARKER-2-272></A><P>
<UL>
<LI><CODE>eoCanSubscribe</CODE>
<LI><CODE>eoOpen</CODE>
<LI><CODE>eoClose</CODE>
<LI><CODE>eoOpenNew</CODE>
<LI><CODE>eoCloseNew</CODE><P>
</UL>
 The <CODE>PB</CODE> parameter of the <CODE>CallEditionOpenerProc</CODE> function is an edition opener parameter block.<A NAME=MARKER-2-589></A><P>
<PRE>
TYPE EditionOpenerParamBlock = 
   RECORD
      info:          EditionInfoRecord;   {edition container to }
                                          { be subscribed to}
      sectionH:      SectionHandle;       {publisher or }
                                          { subscriber }
                                          { requesting open}
      document:      FSSpecPtr;           {document passed}
      fdCreator:     OSType;              {Finder creator type}
      ioRefNum:      LongInt;             {reference number}
      ioProc:        FormatIOProcPtr;     {routine to read }
                                          { formats}
      success:       Boolean;             {reading or writing }
                                          { was successful}
      formatsMask:   SignedByte;          {formats required to }
                                          { subscribe}
   END;
</PRE>
 The <CODE>routine</CODE> parameter of the <CODE>CallEditionOpenerProc</CODE> function is a pointer to an edition opener function.<P>
 The following list shows which fields of the edition opener parameter block are used by the edition opener verbs:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Opener verb<TH>&nbsp;<TH>Field<TH>Description<TH>Called by  <TR>
<TD>eoCanSubscribe<TD>--><TD><CODE>info</CODE><TD>Edition container to subscribe to.<TD rowspan=3><CODE>NewSubscriberDialog</CODE>function for a subscriber<TR>
<TD>&nbsp;<TD>--><TD><CODE>formatsMask</CODE><TD>Formats required to subscribe.<TR>
<TD>&nbsp;<TD><--<TD>Return value<TD>A <CODE>noErr</CODE> code indicates that an edition container can be subscribed to. A <CODE>noTypeErr</CODE> code indicates that an edition container cannot be subscribed to.<TR>
<TD>eoOpen<TD>--><TD><CODE>info</CODE><TD>Edition container to open for reading.<TD rowspan=7><CODE>OpenEdition</CODE> and <CODE>GetStandardFormats</CODE> functions for a subscriber<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>sectionH</CODE><TD rowspan=2>Subscriber section requesting open or <CODE>NIL</CODE>.<TR>
<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2><--<TD rowspan=2><CODE>ioRefNum</CODE><TD rowspan=2>Reference number for use by I/O routine. Not the same as <CODE>EditionRefNum</CODE>.<TR>
<TR>
<TD>&nbsp;<TD><--<TD><CODE>ioProc</CODE><TD>I/O routine to call to read formats.<TR>
<TD>&nbsp;<TD><--<TD>Return value<TD>A <CODE>noErr</CODE> code or appropriate error code.<TR>
<TD rowspan=2>eoClose<TD rowspan=2>--><TD rowspan=2><CODE>info</CODE><TD rowspan=2>Edition container to be closed for reading.<TD rowspan=9><CODE>CloseEdition</CODE> and <CODE>GetStandardFormats</CODE> functions for a subscriber<TR>
<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>sectionH</CODE><TD rowspan=2>Subscriber section requesting close or <CODE>NIL</CODE>.<TR>
<TR>
<TD>&nbsp;<TD>--><TD><CODE>ioRefNum</CODE><TD>Value returned by <CODE>eoOpen</CODE>.<TR>
<TD>&nbsp;<TD>--><TD><CODE>ioProc</CODE><TD>Value returned by <CODE>eoOpen</CODE>.<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>success</CODE><TD rowspan=2>Success value passed to the <CODE>CloseEdition</CODE> function.<TR>
<TR>
<TD>&nbsp;<TD><--<TD>Return value<TD>A <CODE>noErr</CODE> code or appropriate error code.<TR>
<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TR>
<TD>eoOpenNew<TD>--><TD><CODE>info</CODE><TD>Edition container to open for writing.<TD rowspan=12><CODE>OpenNewEdition</CODE> function for a publisher<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>sectionH</CODE><TD rowspan=2>Publisher section requesting open or <CODE>NIL</CODE>.<TR>
<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>document</CODE><TD rowspan=2>Document pointer passed into the <CODE>OpenNewEdition</CODE> function.<TR>
<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>fdCreator</CODE><TD rowspan=2>The <CODE>fdCreator</CODE> passed into the <CODE>OpenNewEdition</CODE> function.<TR>
<TR>
<TD rowspan=3>&nbsp;<TD rowspan=3><--<TD rowspan=3><CODE>ioRefNum</CODE><TD rowspan=3>Reference number for use by I/O routine. Not the same as <CODE>EditionRefNum</CODE>.<TR>
<TR>
<TR>
<TD>&nbsp;<TD><--<TD><CODE>ioProc</CODE><TD>I/O routine to call to write formats.<TR>
<TD>&nbsp;<TD><--<TD>Return value<TD>A <CODE>noErr</CODE> code or appropriate error code.<TR>
<TD rowspan=2>eoCloseNew<TD rowspan=2>--><TD rowspan=2><CODE>info</CODE><TD rowspan=2>Edition container to be closed after writing.<TD rowspan=9><CODE>CloseEdition</CODE> function for a publisher<TR>
<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>sectionH</CODE><TD rowspan=2>Publisher section requesting close or <CODE>NIL</CODE>.<TR>
<TR>
<TD>&nbsp;<TD>--><TD><CODE>ioRefNum</CODE><TD>Value returned by <CODE>eoOpenNew</CODE>.<TR>
<TD>&nbsp;<TD>--><TD><CODE>ioProc</CODE><TD>Value returned by <CODE>eoOpenNew</CODE>.<TR>
<TD rowspan=2>&nbsp;<TD rowspan=2>--><TD rowspan=2><CODE>success</CODE><TD rowspan=2>Success value passed to the <CODE>CloseEdition</CODE> function.<TR>
<TR>
<TD>&nbsp;<TD><--<TD>Return value<TD>A <CODE>noErr</CODE> code or appropriate error code.</TABLE>
<P>
 As <A HREF=#MARKER-9-371>Listing 2-9</A> demonstrates, you install your own edition opener function by first saving the current opener and then installing your own opener. The listing also shows an edition opener, the <CODE>MyEditionOpener</CODE> function. When it receives the <CODE>eoCanSubscribe</CODE> opener verb, the <CODE>MyEditionOpener</CODE> function calls another application-defined routine, <CODE>MyCanSubscribe</CODE>. The Edition Manager sends your edition opener this verb to help it build the list of files displayed by the <CODE>NewSubscriber</CODE> function. The <CODE>MyCanSubscribe</CODE> function returns <CODE>noErr</CODE> if it can subscribe to the file; otherwise, it calls the original edition opener to handle the request.<A NAME=MARKER-2-268></A><A NAME=MARKER-2-270></A><P>
<B>Listing 2-9  <A NAME=MARKER-9-371></A><A NAME=MARKER-21-372></A>Using your own edition opener function</B><P>
<PRE>
VAR
   gOriginalOpener: EditionOpenerProcPtr;{global variable}

PROCEDURE MyInstallMyOpener;
BEGIN
   FailOSErr(GetEditionOpenerProc(gOriginalOpener));
   FailOSErr(SetEditionOpenerProc(@MyEditionOpener));
END; {MyInstallMyOpener}

FUNCTION MyEditionOpener (selector: EditionOpenerVerb; 
                          VAR PB: EditionOpenerParamBlock) 
                           : OSErr; 
BEGIN
   WITH PB DO
   BEGIN
      CASE selector OF
         eoCanSubscribe:
            MyEditionOpener := MyCanSubscribe(PB);
         eoOpen:
            MyEditionOpener := MyEditionOpen(PB);
         eoClose:
            MyEditionOpener := MyEditionClose(PB);
         OTHERWISE
            {call the original edition opener}
            MyEditionOpener 
               := CallEditionOpenerProc(selector, PB,
                                       gOriginalOpener);
      END; {of CASE}
   END; {of WITH}
END; {MyEditionOpener}

FUNCTION MyCanSubscribe (VAR PB: EditionOpenerParamBlock): OSErr;
BEGIN
   {check file type to see if it is a file you can emulate as an }
   { edition}
   IF PB.info.fdType = {for example}'PICT' THEN
      MyCanSubscribe := noErr
   ELSE {otherwise, let the saved edition opener decide}
         MyCanSubscribe := CallEditionOpenerProc(eoCanSubscribe,
                                             PB, gOriginalOpener);
END; {MyCanSubscribe}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-42.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-44.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
