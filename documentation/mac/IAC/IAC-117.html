<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Accepting an Apple Event(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING117></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-116.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-118.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-116.html"><B>Handling Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING117-0></A>
<H2><A NAME=MARKER-9-210></A><A NAME=MARKER-21-211></A>Accepting an Apple Event</H2>
 <A NAME=MARKER-2-212></A><A NAME=MARKER-2-232></A><A NAME=MARKER-2-11></A><A NAME=MARKER-2-257></A>To accept or send Apple events (or any other high-level events), you must set the appropriate flags in your application's <CODE>'SIZE'</CODE> resource and include code to handle high-level events in your application's main event loop. <P>
 Two flags in the <CODE>'SIZE'</CODE> resource determine whether an application receives high-level events: <A NAME=MARKER-2-216></A><P>
<UL>
<LI>The <CODE>isHighLevelEventAware</CODE> flag must be set for your application to receive any high-level events.<A NAME=MARKER-2-12></A><A NAME=MARKER-9-77></A>
<LI>The <CODE>localAndRemoteHLEvents</CODE> flag must be set for your application to receive high-level events sent from another computer on the network.<A NAME=MARKER-2-28></A><A NAME=MARKER-2-220></A><P>
</UL>
 Note that in order for your application to respond to Apple events sent from remote computers, the user of your application must also allow network users to link to your application. The user does this by selecting your application in the Finder, choosing Sharing from the File menu, and clicking the Allow Remote Program Linking checkbox. If the user has not yet started program linking, the Sharing command offers to display the Sharing Setup control panel so that the user can start program linking. The user must also authorize remote users for program linking by using the Users &amp; Groups control panel. Program linking and setting up authenticated sessions are described in the chapter "Program-to-Program Communications Toolbox" in this book.<A NAME=MARKER-2-221></A><P>
 For a complete description of the <CODE>'SIZE'</CODE> resource, see the chapter "Event Manager" in <I>Inside Macintosh: Macintosh Toolbox Essentials.</I> <P>
 Apple events (and other high-level events) are identified by a message class of <CODE>kHighLevelEvent</CODE> in the <CODE>what</CODE> field of the event record. You can test the <CODE>what</CODE> field of the event record to determine whether the event is a high-level event.<A NAME=MARKER-2-82></A><A NAME=MARKER-21-49></A><P>
 <A HREF=#MARKER-9-224>Listing 4-1</A> is an example of a procedure called from an application's main event loop to handle events, including high-level events. The procedure determines the type of event received and then calls another routine to take the appropriate action.<P>
<B>Listing 4-1  <A NAME=MARKER-9-224></A><A NAME=MARKER-21-225></A>A <CODE>DoEvent</CODE> procedure<A NAME=MARKER-2-219></A></B><P>
<PRE>
PROCEDURE DoEvent (event: EventRecord);
BEGIN       
   CASE event.what OF         {determine the type of event}
      mouseDown:
         DoMouseDown (event);
      .
      . {handle other kinds of events}
      .
      {handle high-level events, including Apple events}
      kHighLevelEvent: DoHighLevelEvent (event);
   END;
END; 
</PRE>
 <A HREF=#MARKER-9-227>Listing 4-2</A> is an example of a procedure that handles both Apple events and the high-level event identified by the event class <CODE>mySpecialHLEventClass</CODE> and the event ID <CODE>mySpecialHLEventID</CODE>. Note that, in most cases, you should use Apple events to communicate with other applications. <P>
<B>Listing 4-2  <A NAME=MARKER-9-227></A>A <CODE>DoHighLevelEvent</CODE> procedure for handling Apple events and other high-level events<A NAME=MARKER-2-232></A></B><P>
<PRE>
PROCEDURE DoHighLevelEvent (event: EventRecord);
VAR
   myErr: OSErr;
BEGIN
   IF (event.message = LongInt(mySpecialHLEventClass)) AND
      (LongInt(event.where) = LongInt(mySpecialHLEventID)) 
   THEN
      {it's a high-level event that doesn't use AEIMP}
      myErr := HandleMySpecialHLEvent(event)
   ELSE
      {otherwise, assume that the event is an Apple event}
      myErr := AEProcessAppleEvent(event);
   
   {check and handle error}
   IF myErr &lt;&gt; noErr THEN DoError(myErr);
END;
</PRE>
 If your application accepts high-level events that do not follow the Apple Event Interprocess Messaging Protocol (AEIMP), you must dispatch these high-level events before calling <CODE>AEProcessAppleEvent</CODE>. To dispatch high-level events that do not follow AEIMP, you should check the event class, the event ID, or both for each event to see whether your application can handle the event. <P>
 After receiving a high-level event (and, if appropriate, checking whether it is a high-level event other than an Apple event), your application typically calls the <CODE>AEProcessAppleEvent</CODE> function. The <CODE>AEProcessAppleEvent</CODE> function determines the type of Apple event received, gets the event buffer that contains the parameters and attributes of the Apple event, and calls the corresponding Apple event handler in your application.<P>
 You should provide an Apple event handler for each Apple event that your application supports. This handler is responsible for performing the action requested by the Apple event and if necessary can return data in the reply Apple event. <P>
 If the client application requests a reply, the Apple Event Manager passes a default reply Apple event to your handler. If the client application does not request a reply, the Apple Event Manager passes a null descriptor record (a descriptor record of descriptor type <CODE>typeNull</CODE> and a data handle whose value is <CODE>NIL</CODE>) to your handler instead of a default reply Apple event.<P>
 After your handler finishes processing the Apple event and adds any parameters to the reply Apple event, it must return a result code to <CODE>AEProcessAppleEvent</CODE>. If the client application is waiting for a reply, the Apple Event Manager returns the reply Apple event to the client.<A NAME=MARKER-2-23></A><A NAME=MARKER-2-252></A><A NAME=MARKER-2-86></A><A NAME=MARKER-21-142></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-116.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-118.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
