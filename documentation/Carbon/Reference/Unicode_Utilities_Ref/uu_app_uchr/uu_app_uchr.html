<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Unicode Utilities Reference: Specification for &#39;uchr&#39;</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Specification for &#39;uchr&#39;"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000133" title="Specification for &#39;uchr&#39;"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> &gt; <a href="../../../../../reference/Carbon/index.html#//apple_ref/doc/uid/TP30001281-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../../../reference/Carbon/idxTextFonts-date.html#//apple_ref/doc/uid/TP30001281-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../index.html" target="_top">Unicode Utilities Reference</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Reference/reference.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../uu_ref_docrevhist/uu_ref_docrevhist.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000133-DontLinkElementID_4" title="Specification for &#39;uchr&#39;"></a><h1><a name="//apple_ref/doc/uid/TP30000133-TP1" title="Specification for &#39;uchr&#39;"></a>Specification for 'uchr'</h1><p>The Unicode keyboard-layout (<code>'uchr'</code>) resource contains the data necessary to map virtual key codes to Unicode character codes for a given keyboard layout. Each installed script system has one or more keyboard-layout resources, which may be of type <code>'uchr'</code> or <code>'KCHR'</code> (an older, non-Unicode keyboard-layout format). There may be one or more keyboard-layout resources for each language or region, depending upon the preference of the user. </p>
<p>The <code>'uchr'</code> resource ID is determined as for the <code>'KCHR'</code> resource, with one exception. That is, typically the resource ID for each Unicode keyboard-layout resource is within the range of resource ID numbers for its script system. The ID number of the default keyboard-layout resource for a script system is specified in the <code>itlbKeys</code> field of the scriptâ€™s international bundle (<code>'itlb'</code>) resource. The exception to this is that if a given <code>'uchr'</code> resource specifies any Unicode characters that are not within the range of a single Mac OS encoding (or are not in any Mac OS encoding), then you must use a negative number for the resource.</p>
<p>For a given resource ID, the system may contain a <code>'KCHR'</code> resource, a <code>'uchr'</code> resource, or both. If both a <code>'KCHR'</code> resource and a <code>'uchr'</code> resource are present, they must have the same ID, and the <code>'uchr'</code> resource should match the behavior of the <code>'KCHR'</code> resource. The keyboard menu shows each keyboard layout as a single entry, regardless of whether it is specified by a <code>'KCHR'</code>, a <code>'uchr'</code>, or both.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000133-DontLinkElementID_5" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>'uchr'</code> resource contains offsets to tables that may be in any order. A <code>'uchr'</code> resource may be created in any data-description language that allows the specification of arbitrary binary data.</p></div>

<a name="//apple_ref/doc/uid/TP30000133-475515" title="Unicode Keyboard-Layout Resource Format "></a><a name="//apple_ref/doc/uid/TP30000133-BAJDJDIB" title="Unicode Keyboard-Layout Resource Format "></a><h2>Unicode Keyboard-Layout Resource Format </h2>
<p>The <code>'uchr'</code> format consists of a header information section and five key mapping data sections, as shown in <span class="content_text">Figure A-1</span>.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-475536" title="Figure A-1Overview of a &#39;uchr&#39; resource"></a><a name="//apple_ref/doc/uid/TP30000133-BAJDFBGF" title="Figure A-1Overview of a &#39;uchr&#39; resource"></a><p><strong>Figure A-1&nbsp;&nbsp;</strong>Overview of a 'uchr' resource</p>
<img src = "../art/resourcelayout.gif" alt = "Overview of a 'uchr' resource" width="232" height="201"></div><br/>
<p>The header section of a compiled <code>'uchr'</code> resource contains a structure of type <code>UCKeyboardLayout</code> and an optional structure of type <code>UCKeyLayoutFeatureInfo</code>. See for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-475570" title="Figure A-2&#39;uchr&#39; resource header"></a><a name="//apple_ref/doc/uid/TP30000133-BAJGHGDB" title="Figure A-2&#39;uchr&#39; resource header"></a><p><strong>Figure A-2&nbsp;&nbsp;</strong>'uchr' resource header</p>
<img src = "../art/resourceheader.gif" alt = "'uchr' resource header" width="471" height="221"></div><br/>
<p>The elements in the header section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the resource header format</p></li>
<li class="li"><p>the version of the data in this resource</p></li>
<li class="li"><p>an offset to a <code>UCKeyLayoutFeatureInfo</code> structure, if any</p></li>
<li class="li"><p>a count of the <code>UCKeyboardTypeHeader</code> structures that follow</p></li>
<li class="li"><p>an array of structures of type <code>UCKeyboardTypeHeader</code>; each <code>UCKeyboardTypeHeader</code> entry specifies a range of physical keyboard types and contains offsets to each of the key mapping sections to be used for that range of keyboard types</p><ul class="nested"><li class="nested li"><p>first keyboard type in this entry</p></li>
<li class="nested li"><p>last keyboard type in this entry</p></li>
<li class="nested li"><p>offset to the <code>UCKeyModifiersToTableNum</code> structure (required)</p></li>
<li class="nested li"><p>offset to the <code>UCKeyToCharTableIndex</code> structure (required)</p></li>
<li class="nested li"><p>offset to the <code>UCKeyStateRecordsIndex</code> structure (optional, may be 0 if there is no table)</p></li>
<li class="nested li"><p>offset to the <code>UCKeyStateTerminators</code> structure (optional, may be 0 if there is no table)</p></li>
<li class="nested li"><p>offset to the <code>UCKeySequenceDataIndex</code> structure (optional, may be 0 if there is no table)</p></li></ul></li>
<li class="li"><p>the format of the <code>UCKeyLayoutFeatureInfo</code> structure</p></li>
<li class="li"><p>a reserved field</p></li>
<li class="li"><p>a value of type <code>UniCharCount</code>, specifying the longest possible output string to be produced by this <code>'uchr'</code> resource</p></li></ul>
<p>There may be a variable number of each of the following <code>'uchr'</code> key mapping sections.</p>
<p>The first key mapping section contains a structure of type <code>UCKeyModifiersToTableNum</code>, which maps a modifier key combination to a particular key-code-to-character table number; and alignment bytes. There may be multiple instances of this entire key mapping section. See <span class="content_text">Figure A-3</span> for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-475746" title="Figure A-3&#39;uchr&#39; modifier combination to key-code-to-character table number map"></a><a name="//apple_ref/doc/uid/TP30000133-BAJHEFEE" title="Figure A-3&#39;uchr&#39; modifier combination to key-code-to-character table number map"></a><p><strong>Figure A-3&nbsp;&nbsp;</strong>'uchr' modifier combination to key-code-to-character table number map</p><img src = "../art/modifiercombination.gif" alt = "'uchr' modifier combination to key-code-to-character table number map" width="444" height="155"></div><br/>
<p>The elements in the first key mapping section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the format of the <code>UCKeyModifiersToTableNum</code> structure</p></li>
<li class="li"><p>the table number for modifier combinations that are outside of the range of the <code>tableNum</code> fieldâ€™s array; that is, the default (fallback) table number</p></li>
<li class="li"><p>the range of modifier bit combinations for which there are entries in the <code>tableNum</code> fieldâ€™s array</p></li>
<li class="li"><p>n an array of indexes into the key-code-to-character table offsets contained in the <code>UCKeyToCharTableIndex</code> structure in the next section</p></li>
<li class="li"><p>alignment bytes (to a 4-byte boundary)</p></li></ul>
<p>The second key mapping section contains a structure of type <code>UCKeyToCharTableIndex</code>; the list of key-code-to-character tables, each of which maps a virtual key code to a 16-bit <code>UCKeyOutput</code> value; and alignment bytes. There may be multiple instances of this entire key mapping section. See <span class="content_text">Figure A-4</span> for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-475830" title="Figure A-4&#39;uchr&#39; key-code-to-character tables"></a><a name="//apple_ref/doc/uid/TP30000133-BAJFBGDB" title="Figure A-4&#39;uchr&#39; key-code-to-character tables"></a><p><strong>Figure A-4&nbsp;&nbsp;</strong>'uchr' key-code-to-character tables</p>
<img src = "../art/keycode.gif" alt = "'uchr' key-code-to-character tables" width="426" height="185"></div><br/>
<p>The elements in the second key mapping section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the format of the <code>UCKeyToCharTableIndex</code> structure</p></li>
<li class="li"><p>the number of virtual key codes supported by this resource</p></li>
<li class="li"><p>a count of the key-code-to-character tables</p></li>
<li class="li"><p>an array of offsets from the beginning of the resource to each of the key-code-to-character tables</p></li>
<li class="li"><p>an array of key-code-to-character tables containing values of type <code>UCKeyOutput</code> </p></li>
<li class="li"><p>alignment bytes (to a 4-byte boundary)</p></li></ul>
<p>The third key mapping section is a map to dead-key state records. It contains a structure of type <code>UCKeyStateRecordsIndex</code>, which is an index to <code>UCKeyStateRecord</code> structures; a variable number of dead-key state records of type <code>UCKeyStateRecord</code>; and alignment bytes. There may be multiple instances of this entire key mapping section (or 0; this section need not be present if no <code>UCKeyOutput</code> value refers to a dead-key state record). See <span class="content_text">Figure A-5</span> for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-475919" title="Figure A-5&#39;uchr&#39; dead-key state records"></a><a name="//apple_ref/doc/uid/TP30000133-BAJBDIJJ" title="Figure A-5&#39;uchr&#39; dead-key state records"></a><p><strong>Figure A-5&nbsp;&nbsp;</strong>'uchr' dead-key state records</p>
<img src = "../art/deadkeyrecords.gif" alt = "'uchr' dead-key state records" width="431" height="225"></div><br/>
<p>The elements in the third key mapping section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the format of the <code>UCKeyStateRecordsIndex</code> structure</p></li>
<li class="li"><p>a count of the dead-key state records to follow</p></li>
<li class="li"><p>an array of offsets from the beginning of the resource to each of the <code>UCKeyStateRecord</code> values following</p></li></ul>
<p>Immediately following the <code>UCKeyStateRecordsIndex</code> structure are a variable number of values of type <code>UCKeyStateRecord</code>. Any keycode-modifier combination which initiates a dead-key state or which is a valid terminator of a dead-key state refers to one of these records. However, these records also permit more complex dead-key state processing, such as a series of transitions from one dead-key state directly into another in which each transition can emit a sequence of one or more Unicode characters. Each record contains</p>
<ul class="ul"><li class="li"><p>a value of type <code>UCKeyCharSeq</code> specifying the character(s) produced by the input keycode when no dead-key state is currently in effect</p></li>
<li class="li"><p>a value specifying the dead-key state produced by the input keycode when no dead-key state is currently in effect</p></li>
<li class="li"><p>a count of the elements in the <code>stateEntryData</code> fieldâ€™s array</p></li>
<li class="li"><p>the format of the data in the <code>stateEntryData</code> fieldâ€™s array</p></li>
<li class="li"><p>an array of dead-key state entry data; each entry maps from the current dead-key state to the character(s) that are produced or to the following dead-key state, if any</p></li>
<li class="li"><p>alignment bytes (to a 4-byte boundary)</p></li></ul>
<p>The fourth key mapping section contains a structure of type <code>UCKeyStateTerminators</code> and alignment bytes. This is an optional list of default terminators (characters or sequences) for each state; if this table is not present or does not extend far enough to have a terminator for the state, nothing is output when the state terminates. There may be multiple (or 0) instances of this entire key mapping section. See <span class="content_text">Figure A-6</span> for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-476040" title="Figure A-6&#39;uchr&#39; default dead-key state terminators"></a><a name="//apple_ref/doc/uid/TP30000133-BAJIDECI" title="Figure A-6&#39;uchr&#39; default dead-key state terminators"></a><p><strong>Figure A-6&nbsp;&nbsp;</strong>'uchr' default dead-key state terminators</p>
<img src = "../art/deadkeyterminators.gif" alt = "'uchr' default dead-key state terminators" width="425" height="125"></div><br/>
<p>The elements in the fourth key mapping section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the format of the <code>UCKeyStateTerminators</code> structure</p></li>
<li class="li"><p>a count of default dead-key state terminators contained in the <code>keyStateTerminators</code> fieldâ€™s array</p></li>
<li class="li"><p>an array of default dead-key state terminators, described as values of type <code>UCKeyCharSeq</code> </p></li>
<li class="li"><p>alignment bytes (to a 4-byte boundary)</p></li></ul>
<p>The fifth key mapping section of the resource is an optional list of character sequences; it contains a structure of type <code>UCKeySequenceDataIndex</code> and Unicode character sequences. This permits a single keypress to generate a sequence of characters, or to generate a single character outside the range that can be represented directly by a <code>UCKeyOutput</code> or <code>UCKeyCharSeq</code> value. There may be multiple (or 0) instances of this entire key mapping section. See <span class="content_text">Figure A-7</span> for an illustration of this section.</p>
<br/><div><a name="//apple_ref/doc/uid/TP30000133-476119" title="Figure A-7&#39;uchr&#39; character key sequences"></a><a name="//apple_ref/doc/uid/TP30000133-BAJHICIH" title="Figure A-7&#39;uchr&#39; character key sequences"></a><p><strong>Figure A-7&nbsp;&nbsp;</strong>'uchr' character key sequences</p>
<img src = "../art/charactersequences.gif" alt = "'uchr' character key sequences" width="432" height="155"></div><br/>
<p>The elements in the fifth key mapping section of a <code>'uchr'</code> resource are</p>
<ul class="ul"><li class="li"><p>the format of the <code>UCKeySequenceDataIndex</code> structure</p></li>
<li class="li"><p>a count of the Unicode character sequences that follow the <code>UCKeySequenceDataIndex</code> structure</p></li>
<li class="li"><p>an array of offsets from the beginning of the <code>UCKeySequenceDataIndex</code> structure to the Unicode character sequences that follow it</p></li>
<li class="li"><p>an array of Unicode character sequences</p></li>
<li class="li"><p>alignment bytes (to a 4-byte boundary)</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Reference/reference.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../uu_ref_docrevhist/uu_ref_docrevhist.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Reference/Unicode_Utilities_Ref/uu_app_uchr/uu_app_uchr.html%3Fid%3DTP30000122-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Reference/Unicode_Utilities_Ref/uu_app_uchr/uu_app_uchr.html%3Fid%3DTP30000122-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Reference/Unicode_Utilities_Ref/uu_app_uchr/uu_app_uchr.html%3Fid%3DTP30000122-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>