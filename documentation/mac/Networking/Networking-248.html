<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>LAPAddATQ(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING248></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-247.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-249.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-235.html"><B>Chapter 10 - Link-Access Protocol (LAP) Manager</B></A> / <A HREF="Networking-243.html"><B>LAP Manager Reference</B></A><BR><DL><DD><A HREF="Networking-246.html"><B>Routines</B></A> / <A HREF="Networking-247.html"><B>Adding and Removing AppleTalk Transition Queue Entries</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING248-0></A>
<H3><A NAME=MARKER-11-135></A><A NAME=MARKER-9-136></A>LAPAddATQ<A NAME=MARKER-2-10></A></H3>
 The <CODE>LAPAddATQ</CODE> function adds an entry to the AppleTalk Transition Queue.<P>
<PRE>
FUNCTION LAPAddATQ (theATQEntry: ATQEntryPtr): OSErr;
</PRE>
<DL>
<DT><CODE><A NAME=MARKER-9-57></A>theATQEntry</CODE>
<DD> A pointer to a record of type <CODE>ATQEntry</CODE> to be added to the AppleTalk Transition Queue. 
</DL>
<A NAME=HEADING248-4></A>
<H5>DESCRIPTION</H5>
 You use the <CODE>LAPAddATQ</CODE> function to add an entry for your application to the AppleTalk Transition Queue. Before you call the <CODE>LAPAddATQ</CODE> function, you must create an AppleTalk Transition Queue entry record of type <CODE>ATQEntry</CODE> that defines your entry. <A HREF=Networking-245.html#MARKER-9-128>"The AppleTalk Transition Queue Entry" on page 10-25</A> describes the <CODE>ATQEntry</CODE> record. You provide a pointer to this record as the value of the <CODE>theATQEntry</CODE> parameter when you call the <CODE>LAPAddATQ</CODE> function. <P>
 In the <CODE>CallAddr</CODE> field of the AppleTalk Transition Queue entry record, you provide a pointer to a routine that the LAP Manager is to call when an AppleTalk transition event occurs. The LAP Manager calls your routine to notify you when any of the following events occurs:<P>
<UL>
<LI>A process opens the .MPP driver.
<LI>A process requests permission to close AppleTalk.
<LI>A process closes the .MPP driver.
<LI>A request to close AppleTalk is canceled. One of the routines pointed to by an entry in the AppleTalk Transition Queue denies permission to close AppleTalk, and so the request to do so is canceled.
<LI>A process calls the <CODE>ATEvent</CODE> procedure or the <CODE>ATPreFlightEvent</CODE> function to send its own AppleTalk transition event to the entries in the AppleTalk Transition Queue.
<LI>A process reports that it is changing the flagship name.
<LI>A process makes a request to change the flagship name.
<LI>A request to change the flagship name is canceled. One process denies another's request to change the flagship name, and so the request is canceled.
<LI>The network connectivity has changed. This transition event is sent if a node is connected to an AppleTalk network and, for some reason, a particular interconnected AppleTalk network is longer be reachable.
<LI>The cable range for the current network has been changed. 
<LI>The speed of the CPU has been changed.<P>
</UL>
<A NAME=HEADING248-18></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 You must allocate nonrelocatable memory for the <CODE>ATQEntry</CODE> record and not alter or manipulate this memory until you remove the AppleTalk Transition Queue entry from the transition queue using the <CODE>LAPRmvATQ</CODE> function. <P>
 When LAP Manager calls your transition event handler routine, the LAP Manager passes parameters to your routine using the C stack calling conventions, and expects your routine to return a result in register D0. If you write your transition event handler routine in Pascal, you must use an assembly glue code routine. For a sample glue code routine, see <A HREF=Networking-240.html#MARKER-9-37>"Writing a Transition Event Handler Routine Using Pascal" beginning on page 10-10</A>.<P>
<A NAME=HEADING248-21></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 <A NAME=MARKER-13-139></A>From assembly language, you add an AppleTalk Transition Queue entry by placing a routine selector in the D0 register, placing a pointer to your AppleTalk Transition Queue entry in the A0 register, and executing a JSR instruction to an offset past the start of the LAP Manager. The start of the LAP Manager is contained in the global variable <CODE>LAPMgrPtr</CODE> ($B18). The offset to the LAP Manager routines is given by the constant <CODE>LAPMgrCall</CODE> (2).<A NAME=MARKER-2-50></A><A NAME=MARKER-9-96></A><A NAME=MARKER-2-142></A>
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on entry<TR>
<TD>D0<TD>23<TR>
<TD>A0<TD>Pointer to AppleTalk Transition Queue entry</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>Registers on exit<TR>
<TD>D0<TD>Result code</TABLE>
<P>
<A NAME=HEADING248-23></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error</TABLE>
</H5>
<A NAME=HEADING248-24></A>
<H5>SEE ALSO </H5>
 <A HREF=Networking-239.html#MARKER-9-22>"Adding an Entry to the AppleTalk Transition Queue" on page 10-7</A> describes the process of creating an AppleTalk Transition Queue entry and adding it to the <A NAME=MARKER-9-16></A>queue. <A NAME=MARKER-2-119></A><P>
 For the details of each transition, see <A HREF=Networking-240.html#MARKER-9-35>"How the LAP Manager Calls Your Transition Event Handler Routine" beginning on page 10-8</A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-247.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-249.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
