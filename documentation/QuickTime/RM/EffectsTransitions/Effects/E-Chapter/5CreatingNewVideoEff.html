<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Video Effects and Transitions Guide: Creating New Video Effects</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating New Video Effects"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects" title="Creating New Video Effects"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../VideoEffectsTransitions-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000588" target="_top">Video Effects &amp; Transitions</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000868-IntroductiontoQuickTimeVideoEffectsandTransitionsGuide-DontLinkElementID_130">QuickTime Video Effects and Transitions Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../D-Chapter/4Built-inQuickTimeVi.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../F-Chapter/6VideoEffectsAPI.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SW1" title="Creating New Video Effects"></a>
<h1>Creating New Video Effects</h1>

<p>This chapter discusses how to write your own video effects. If you are only interested in building applications that use effects, you can skip this chapter.</p>
<p>QuickTime video effects are implemented as Component Manager components, the standard mechanism for extending QuickTime. To implement your own effect, you create a new <strong>effect</strong> <strong>component.</strong> An effect component is a specialized type of image decompressor component.</p>
<p>This chapter walks you through the implementation of a sample effect component. The sample effect is built on a framework of code that you can reuse when you implement your own effect component.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_61">What Effects Components Do</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_62">The Effect Component Interface</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_63">Supplying Parameter Description Information</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_64">Implementing the EffectBegin and EffectRenderFrame Functions</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_70">Handling Multiple Formats</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_74">The Sample Effect Component</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_79">Writing an Effect Component Using the Framework</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_89">Adding an 'atms' Resource to your Component</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_92">The Parameter Description Format</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_94">Special Description Types</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_104">Tweening Parameters</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_105">Slide</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_106">Parameter Descriptions</a>
				
			<br/>
			
        
			
			
				<a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_107">Component-Defined Functions</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_61" title="What Effects Components Do"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-WhatEffectsComponentsDo" title="What Effects Components Do"></a>What Effects Components Do</h2>
<p>The basic task of every effect component is very simple. The component is passed zero or more source frames and must produce a single destination frame. The destination frame is the source frame or frames after processing by the effect-rendering algorithm.</p>
<p>The component must provide a set of services that QuickTime can call. These services allow QuickTime (or any other client software that uses your component) to perform actions such as these:</p>
<ul class="ul">
<li class="li"><p>Open a connection to your component.</p></li>
<li class="li"><p>Retrieve information about your effect, particularly descriptions of the parameters your effect can take.</p></li>
<li class="li"><p>Set the source or sources for the effect.</p></li>
<li class="li"><p>Set the destination for the effect.</p></li>
<li class="li"><p>Request that a single frame of the effect be rendered.</p></li>
<li class="li"><p>Cancel the rendering of a frame.</p></li>
<li class="li"><p>Close the connection to your component.</p></li>
</ul>
<p>Your effect component must be able to service such requests. To do so, it implements a set of standard <strong>interface</strong> <strong>functions</strong> that are called through a <strong>component</strong> <strong>dispatch</strong> function. Details of these functions are given in the section <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectComponentInterface">The Effect Component Interface</a></span>.</p>
<p>The main task of the effect component is to implement the specific algorithm that transforms source frames into a destination frame. You need to supply versions of your algorithm for each bit depth and pixel format that your component supports. Choosing which bit depths and pixel formats to support, and implementing algorithms for each combination of these, are a significant part of building your effect component.</p>
<p>In addition, your effect component must provide a <strong>parameter</strong> <strong>description</strong> that describes the parameters that the effect takes. The parameter description can be used by the software that is calling your component to construct a user interface that allows users to change the value of the parameters sent to your component. This is described in detail in the section <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SupplyingParameterDescriptionInformation">Supplying Parameter Description Information</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_62" title="The Effect Component Interface"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectComponentInterface" title="The Effect Component Interface"></a>The Effect Component Interface</h2>
<p>Effect components, as with all other types of QuickTime components, must implement a defined set of functions. To ease the component development process, the Generic Effect component is provided for you. This component implements many of the &#8220;housekeeping&#8221; functions that all components must perform. In most cases, these default implementations are appropriate for your effect, and you simply delegate these functions to the generic effect component. In the rare instances when you need to provide your own implementations of one of these basic functions, you can override the generic version and provide your own implementation.</p>
<p>By delegating many of the functions to the generic effect, you not only decrease the number of functions you must implement, you also produce a smaller effect component, because common code is stored only once, in the generic effect.</p>
<p>The framework code provided in the dimmer effect sample (<span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheDimmerEffect">The Dimmer Effect</a></span>), shows how to delegate interface functions to the generic effect component.</p>
<p>Your component must provide implementations for these functions:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>Open</code></p></td>
<td ><p>Opens a connection between the client software and your component.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>Close</code></p></td>
<td ><p>Closes the connection between the client and your component.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>Version</code></p></td>
<td ><p>Returns the version number of your component.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>EffectSetup</code></p></td>
<td ><p>Called once before a sequence of frames are rendered. This gives your effect the chance to set up variables that will alter their value during the execution of a sequence of frames.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>EffectBegin</code></p></td>
<td ><p>Called once before a frame is rendered. Your component can safely perform operations that move memory when this function is called.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>EffectRenderFrame</code></p></td>
<td ><p>Called to render a frame. Because this function can be called asynchronously, it is not safe to perform operations that may move memory during this call.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>EffectCancel</code></p></td>
<td ><p>Cancels the rendering of a frame. If your component supports asynchronous operation, this function can be called while a frame is being rendered.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetParameterListHandle</code></p></td>
<td ><p>Returns a parameter description atom container, as described in the section "Supplying Parameter Description Information" [link s Creating New Video Effects].</p></td>
</tr>
<tr>
<td  scope="row"><p><code>GetCodecInfo</code></p></td>
<td ><p>Returns information to the codec manager about the capabilities of your component.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>EffectGetSpeed</code></p></td>
<td ><p>Returns the approximate number of frames per second that your effect is capable of transforming.</p></td>
</tr>

</table></div>
<p>These functions can be categorized into four groups. The <code>Open</code> and <code>Close</code> functions deal with maintaining a connection between your component and client software. In most cases, you can implementation these functions using the sample code provided by Apple without modification.</p>
<p>The <code>Version</code>, <code>GetParameterListHandle</code>, <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/GetCodecInfo" target="_top">GetCodecInfo</a></code> and <code>EffectGetSpeed</code> functions return information about your component. The most important of these functions is <code>GetParameterListHandle</code>, which returns a description of the parameters that your effect can take. See <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SupplyingParameterDescriptionInformation">Supplying Parameter Description Information</a></span> for more details of this what this function should do.</p>
<p>The <code>EffectSetup</code> function is called immediately before your component is required to render a sequence of frames. On entry, the function contains a description of the sequence that is about to be rendered. Most importantly, it describes the bit depth and pixel format of the sources that your component has to deal with. Your <code>Setup</code> function can then verify that your component can handle these formats. If it cannot, <code>EffectSetup</code> should return the &#8220;closest&#8221; bit depth and pixel format combination that it can handle, and QuickTime will generate versions of the sources and destination in the requested format. This ensures that your effect component is given source and destination buffers in a format that it understands. See <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectRenderFrameFunction">The EffectRenderFrame Function</a></span> for more details.</p>
<p>The most significant function group contains the <code>EffectBegin</code>, <code>EffectRenderFrame</code>, and <code>EffectCancel</code> functions. These functions contain the implementation of your effect algorithm. In most cases, you can implement the <code>EffectCancel</code> function simply by using the sample code provided by Apple. The implementation of the <code>EffectBegin</code> and <code>RenderFrame</code> functions is covered in <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ImplementingtheEffectBeginandEffectRenderFrameFunctions">Implementing the EffectBegin and EffectRenderFrame Functions</a></span>.</p>
<p>Full details of the interface functions your component must supply are given in <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ComponentDefinedFunctions">Component-Defined Functions</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_63" title="Supplying Parameter Description Information"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SupplyingParameterDescriptionInformation" title="Supplying Parameter Description Information"></a>Supplying Parameter Description Information</h2>
<p>Your effect component must supply information that describes the parameters that your effect takes. This information is used to create an appropriate user interface for setting the parameters to your effect. The parameter description lists your effect&#8217;s parameters and their data types and indicates the appropriate selection interface for each parameter, such as a slider or a pull-down list, as well as information such as the minimum, maximum, and default values for each parameter. Each parameter is described using a specific format, which is shown in <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheParameterDescriptionFormat">The Parameter Description Format</a></span>.</p>
<p>Your effect component returns its parameter description information through the <code>GetParameterListHandle</code> function. The easiest way to provide this information back to the client software is to add an <code><!--a target="_top" -->'atms'<!--/a--></code> resource to your component. The <code><!--a target="_top" -->'atms'<!--/a--></code> resource contains the parameter descriptions in the required format. You can then retrieve the resource by calling the <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/GetComponentResource" target="_top">GetComponentResource</a></code> function, returning it to the client through your implementation of <code>GetParameterListHandle</code>, as shown in Listing&#160;4-1.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_142" title="Listing 4-1Implementing the GetParameterListHandle function using GetComponentResource"></a>
<p class="codesample"><strong>Listing 4-1&nbsp;&nbsp;</strong>Implementing the GetParameterListHandle function using GetComponentResource</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult GetParameterListHandle(EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Handle *theHandle) <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;err = GetComponentResource((Component) glob-&#62;self,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OSTypeConst('atms'),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kEffectatmsRes,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;theHandle);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>By implementing the <code>GetParameterListHandle</code> function in this way, you can simplify the process of packaging the necessary information in the proper format.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_64" title="Implementing the EffectBegin and EffectRenderFrame Functions"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ImplementingtheEffectBeginandEffectRenderFrameFunctions" title="Implementing the EffectBegin and EffectRenderFrame Functions"></a>Implementing the EffectBegin and EffectRenderFrame Functions</h2>
<p>The core of implementing an effect component is implementing the <code>EffectBegin</code> and <code>EffectRenderFrame</code> functions. Together, these functions handle the rendering of a single frame of the effect.</p>
<p>The <code>EffectBegin</code> function is called immediately before each frame is to be rendered. It is guaranteed that this function is never called from an interrupt, so it is safe to perform actions that could move memory within this function. In general, the <code>EffectBegin</code> function should set up the internal state of your component so it has all the information it needs to render a single frame.</p>
<p>The <code>EffectRenderFrame</code> function is called to actually render the frame. This can be called at interrupt time, so it is not safe to move or allocate memory in this function. You should also take care not to call functions that would do so. Your <code>EffectRenderFrame</code> function should actually render a single frame of your effect.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_65" title="The EffectBegin function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectBeginfunction" title="The EffectBegin function"></a>The EffectBegin function</h3>
<p>The main tasks that the <code>EffectBegin</code> function should perform are:</p>
<ul class="spaceabove">
<li class="li"><p>Ensure that the effect component has valid references to the current sources. If the component does not have a reference to the sources, or the sources have changed since the last call to <code>EffectBegin</code>, they must be updated.</p></li>
<li class="li"><p>Ensure that the component has a valid reference to the current destination. If the component does not have a reference to the destination, or the destination has changed since the last call to <code>EffectBegin</code>, it must be updated.</p></li>
<li class="li"><p>Ensure that the component has the current parameter values. If the source or destination has changed, or the component does not currently have values for the effect parameters, these parameter values are read.</p></li>
<li class="li"><p>If any of the parameter values are tweened, tweening is performed to determine the actual value for those parameters.</p></li>
</ul>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_66" title="Checking Source and Destination References"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-CheckingSourceandDestinationReferences" title="Checking Source and Destination References"></a>Checking Source and Destination References</h3>
<p>The following code checks to see if the destination has changed since the last call to the <code>EffectBegin</code> function:</p>

<div class="codesample"><table><tr><td scope="row"><pre>if (p-&#62;conditionFlags &#38; (codecConditionNewClut+<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codecConditionFirstFrame+codecConditionNewDepth+<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;codecConditionNewDestination+codecConditionNewTransform))<span></span></pre></td></tr></table></div>

<p>If this evaluates to <code>true</code>, the destination has changed. This expression checks a series of flags that are passed to the <code>EffectBegin</code> function in the <code>conditionsFlags</code> field of the <code>decompressParams</code> parameter. When the destination is changed, QuickTime sets these flags to alert the effect component to update its internal state.</p>
<p>The most important information that you need to store about the new destination is its base address and its <code>rowBytes</code> value. These values allow you to draw onto the destination surface.</p>
<p>Listing&#160;4-2 shows an example function that stores information in the effect component&#8217;s global data structure about the destination <code><!--a target="_top" -->PixMap<!--/a--></code> passed to the function.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_143" title="Listing 4-2Storing information about a new destination frame"></a>
<p class="codesample"><strong>Listing 4-2&nbsp;&nbsp;</strong>Storing information about a new destination frame</p>
<div class="codesample"><table><tr><td scope="row"><pre>static long BlitterSetDest(BlitGlobals*glob, &#160;&#160;&#160;// input: our globals<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;PixMap&#160;&#160;*dstPixMap, &#160;&#160;&#160;&#160;// input: pixels we will draw into<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Rect&#160;&#160;&#160;&#160;*dstRect)&#160;&#160;&#160;&#160;&#160;&#160;&#160;// input: area of pixels we will draw into<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;offsetH,offsetV;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;char&#160;&#160;&#160;&#160;*baseAddr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Calculate the based address according to the format of the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// destination PixMap<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;offsetH = (dstRect-&#62;left - dstPixMap-&#62;bounds.left);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (dstPixMap-&#62;pixelSize == 16)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;offsetH &#60;&#60;= 1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// 1 pixel = 2 bytes<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (dstPixMap-&#62;pixelSize == 32)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;offsetH &#60;&#60;= 2;&#160;&#160;&#160;&#160;&#160;&#160;// 1 pixel = 4 bytes<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result = -1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// this is a data format we can't handle<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;offsetV = (dstRect-&#62;top - dstPixMap-&#62;bounds.top)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* dstPixMap-&#62;rowBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;baseAddr = dstPixMap-&#62;baseAddr + offsetH + offsetV;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;glob-&#62;dstBaseAddr = baseAddr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;glob-&#62;dstRowBytes = dstPixMap-&#62;rowBytes;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return result;<span></span></pre></td></tr><tr><td scope="row"><pre>} // BlitterSetDest<span></span></pre></td></tr></table></div>

<p>The process for checking for new sources is broadly similar. The <code><!--a target="_top" -->CodecDecompressParams<!--/a--></code> data structure passed into the <code>EffectBegin</code> function has a field called <code>majorSourceChangeSeed</code>. This contains a seed number generated from the characteristics of the set of sources for the effect. If the sources change, the <code>majorSourceChangeSeed</code> value will also change, so the effect can store the current value in its global data structure and compare it to the current value. If they are different, the effect knows its sources have changed.</p>
<p>When the effect detects that one or more of its sources have changed, it must iterate through all its sources and reload information about them.</p>
<p>Listing&#160;4-3 shows example code that performs these operations. Listing&#160;4-4 shows the <code>BlitterSetSource</code> function that is called by this example code. The <code>BlitterSetSource</code> function is analogous to the <code>BlitterSetDest</code> function shown in Listing&#160;4-2.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_144" title="Listing 4-3Checking for source changes"></a>
<p class="codesample"><strong>Listing 4-3&nbsp;&nbsp;</strong>Checking for source changes</p>
<div class="codesample"><table><tr><td scope="row"><pre>// Check to see if one or more sources have changed<span></span></pre></td></tr><tr><td scope="row"><pre>if (p-&#62;majorSourceChangeSeed != glob-&#62;majorSourceChangeSeed)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// grab start of input chain for this effect<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;source = effect-&#62;source;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// we can play with up to kMaxSources sources, so go get them<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;while (source != nil &#38;&#38; numSources &#60; kMaxSources)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// now give that source to our blitter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = BlitterSetSource(glob, numSources, source);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (err != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;source = source-&#62;next;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;++numSources;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_145" title="Listing 4-4Storing information about a new source frame"></a>
<p class="codesample"><strong>Listing 4-4&nbsp;&nbsp;</strong>Storing information about a new source frame</p>
<div class="codesample"><table><tr><td scope="row"><pre>static long BlitterSetSource(BlitGlobals*glob, &#160;&#160;&#160;&#160;&#160;// input: our globals<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long sourceNumber,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// input: source index to set<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;CDSequenceDataSourcePtr source)&#160;&#160;&#160;&#160;&#160;// input: source value<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (sourceNumber &#62;= kMaxSources)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// too many sources for us to handle<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// a source we can handle, save it away<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = RequestImageFormat(source, glob-&#62;width, glob-&#62;height,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;glob-&#62;dstPixelFormat); <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;glob-&#62;sources[sourceNumber].src = source;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;glob-&#62;sources[sourceNumber].src = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;return (err);<span></span></pre></td></tr><tr><td scope="row"><pre>} // BlitterSetSource<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_67" title="Reading Parameter Values"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ReadingParameterValues" title="Reading Parameter Values"></a>Reading Parameter Values</h3>
<p>Listing&#160;4-5 shows how to read the value of a non-tweened parameter. The <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTFindChildByID" target="_top">QTFindChildByID</a></code> function is used to retrieve the atom containing the parameter value. The parameter value is then copied from the atom using the function <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCopyAtomDataToPtr" target="_top">QTCopyAtomDataToPtr</a></code>. If the value is successfully copied, it is endian-flipped to ensure it is in native-endian format (parameter values are always stored in big-endian format). If the copy failed, a default value is provided.</p>
<p>The value retrieved from the parameter is stored in the component&#8217;s global data structure (called, in this example, <code>global</code> -&#62; <code>blitter</code> ). This allows the value to be used by other functions, notably the component&#8217;s <code>EffectRenderFrame</code> function.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_146" title="Listing 4-5Reading a parameter value"></a>
<p class="codesample"><strong>Listing 4-5&nbsp;&nbsp;</strong>Reading a parameter value</p>
<div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;data = p-&#62;data;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtom&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;atom;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtomID&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;atomID = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;actSize;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Find the 'sden' atom<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;atom = QTFindChildByID((QTAtomContainer) &#38;data,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OSTypeConst('sden'), // The name of the parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;atomID,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // The ID of the parameter <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Copy the parameter value from the atom<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (QTCopyAtomDataToPtr((QTAtomContainer) &#38;data,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;atom,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;false,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sizeof(long),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;((glob-&#62;blitter).scratchDensity),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;actSize)!=noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// If the copy failed, use a default value for this parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;((glob-&#62;blitter).scratchDensity) = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Otherwise, the copy succeeded, so endian flip and store the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// parameter value<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;((glob-&#62;blitter).scratchDensity) = EndianS32_BtoN(((glob-&#62;blitter).scratchDensity));<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>If the parameter value can contain a tweened value, you can use code similar to that shown in Listing&#160;4-6 to retrieve the parameter value. The functions <code>InitializeTweenGlobals</code> and <code>CreateTweenRecord</code> are utility functions that Apple provides as part of the dimmer effect sample framework (see <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheSampleEffectComponent">The Sample Effect Component</a></span>).</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_147" title="Listing 4-6Reading a tweened parameter value"></a>
<p class="codesample"><strong>Listing 4-6&nbsp;&nbsp;</strong>Reading a tweened parameter value</p>
<div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Ptr &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;data = p-&#62;data;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSErr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;err = InitializeTweenGlobals(&#38;glob-&#62;tweenGlobals, p);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (err!=noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Make our tweener, return if we already have it<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;err = CreateTweenRecord(&#38;glob-&#62;tweenGlobals,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;glob-&#62;percentage,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OSTypeConst('pcnt'),&#160;&#160;&#160;&#160;// The name of the parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// The ID of the parameter <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sizeof(Fixed),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kTweenTypeFixed,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void*) 0,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void*) fixed1,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;effect-&#62;frameTime.virtualDuration);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (err!=noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;glob-&#62;initialized = true;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_68" title="Tweening Parameter Values"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TweeningParameterValues" title="Tweening Parameter Values"></a>Tweening Parameter Values</h3>
<p>If you have specified that one or more of your parameter&#8217;s values can be tweened, you need to implement code to perform the tweening in the <code>EffectBegin</code> function.</p>
<p>Listing&#160;4-7 shows an example of tweening a parameter value. The current frame time is retrieved and subtracted from the effect&#8217;s <code>virtualStartTime</code>. This calculates how far through the execution of the current effect sequence we are, expressed as a percentage.</p>
<p>With this information, the code then calls <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTDoTween" target="_top">QTDoTween</a></code> to interpolate the parameter value, leaving the resulting value in <code>glob</code> -&#62; <code>comp1Tween</code>.<code>tweenData</code>.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_148" title="Listing 4-7Tweening parameter values"></a>
<p class="codesample"><strong>Listing 4-7&nbsp;&nbsp;</strong>Tweening parameter values</p>
<div class="codesample"><table><tr><td scope="row"><pre>wide&#160;&#160;&#160;&#160;percentage;<span></span></pre></td></tr><tr><td scope="row"><pre>// Find out how far through the effect we are<span></span></pre></td></tr><tr><td scope="row"><pre>percentage = effect-&#62;frameTime.value;<span></span></pre></td></tr><tr><td scope="row"><pre>CompSub(&#38;effect-&#62;frameTime.virtualStartTime, &#38;percentage);<span></span></pre></td></tr><tr><td scope="row"><pre>// Tween our parameters and get the current value for this frame, prepare<span></span></pre></td></tr><tr><td scope="row"><pre>// to render it when the EffectRenderFrame happens<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Fixed&#160;&#160;&#160;thePercentage;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (glob-&#62;percentage.tween)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;QTDoTween(glob-&#62;percentage.tween, percentage.lo,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;glob-&#62;percentage.tweenData, nil, nil, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;thePercentage = **(Fixed**) (glob-&#62;percentage.tweenData);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// If we are before the half-way point of this transition, we should<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// be fading the first source to black<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if (thePercentage &#60; fixed1/2)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(glob-&#62;blitter).direction = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(glob-&#62;blitter).dimValue = FixedToInt(FixMul(IntToFixed(512), thePercentage));<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Otherwise, we are fading up onto the new source<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;else<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(glob-&#62;blitter).direction = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(glob-&#62;blitter).dimValue = FixedToInt(FixMul(IntToFixed(512),<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;thePercentage)) - 255; <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_69" title="The EffectRenderFrame Function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectRenderFrameFunction" title="The EffectRenderFrame Function"></a>The EffectRenderFrame Function</h3>
<p>The <code>EffectRenderFrame</code> function is called to actually render a single frame of your effect. This is where you transform the sources of your effect into the destination frame, using the algorithm that implements your effect.</p>
<p>This is also where you have to handle multiple bit depth and pixel format combinations.</p>
<p>Internally, QuickTime stores bitmaps in a wide variety of formats. The system can handle images in a number of bit depths and with many different pixel formats. Effect components must have some ability to handle source and destination frames that are at any of the bit depths and in any of the pixel formats that QuickTime supports.</p>
<p>Obviously, providing a separate implementation of your effect algorithm for every combination of bit depth and pixel format could be an enormous task. Fortunately, QuickTime provides mechanisms for you to limit the number of formats you have to explicitly support.</p>
<p>When your effect component&#8217;s <code>EffectSetup</code> function is called, it is passed information about the bit depth and pixel formats that the source frames are in. Your component should examine the formats and react in one of two ways:</p>
<ul class="spaceabove">
<li class="li"><p>If the format is one of those which your effect does support, the <code>EffectSetup</code> function does nothing.</p></li>
<li class="li"><p>If the format is not supported by your effect, <code>EffectSetup</code> returns the nearest format that is supported.</p></li>
</ul>
<p>In the second case, where you do not directly support the format, QuickTime automatically creates buffers in the format returned by <code>EffectSetup</code>. The source frames are written into the buffer before <code>EffectRenderFrame</code> is called, so that source data is always available in a supported format. The destination frame is also buffered, and QuickTime automatically transforms the image into the required format for you.</p>
<p>This way, you only need to support a limited number of image formats, and QuickTime will ensure that <code>EffectRenderFrame</code> isn&#8217;t called with data in any other format.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_149" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
If your effect does not handle the bit depth and pixel format combination passed to the <code>Setup</code> function, and it requests an alternative format, QuickTime generates new offscreen buffers for each source and destination frame your effect uses. This will result in a memory and execution time overhead for your effect. If you want your effect to execute quickly in a wide range of circumstances, your effect should explicitly handle as many bit depth and pixel format combinations as possible.  </p>
</div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_70" title="Handling Multiple Formats"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-HandlingMultipleFormats" title="Handling Multiple Formats"></a>Handling Multiple Formats</h2>
<p>Although you can write separate versions of your effect algorithm for each combination of bit depth and pixel format, Apple recommends that you implement your effect algorithm once for each bit depth. You should then use the Apple-supplied <strong>blit</strong> <strong>macros</strong> to automatically generate versions of these implementations for each supported pixel format. This significantly reduces the number of separate implementations you have to maintain, and allows easy support of multiple pixel formats.</p>
<p>The blit macros are contained in the file <code>BltMacros</code>.<code>h</code>, which is included with the sample effect framework code.</p>
<p>To use the blit macros in your effect component, you must store each bit depth implementation of your effect algorithm in a separate file. These files are then included into the effect component&#8217;s main source code file multiple times, once per pixel format supported. Each inclusion is surrounded by <code>#define</code> statements that define the pixel format version to be generated.</p>
<p>Each file uses a <code>#include</code> <code></code> statement to include <code>BltMacros</code>.<code>h</code>, and all operations that read pixels from a source buffer or write pixels to the destination buffer are performed using appropriate macros.</p>
<p>The macros are automatically converted to the correct operations for the pixel format when the file is included into the main source code. This generates a version of the algorithm for each pixel format.</p>
<p>Finally, code is put into place in the effect component&#8217;s <code>EffectRenderFrame</code> function, which calls the appropriate generated algorithm according to the current bit depth and pixel format of the source buffers.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_71" title="Implementing a Bit-depth Specific Version of Your Algorithm"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ImplementingaBitdepthSpecificVersionofYourAlgorithm" title="Implementing a Bit-depth Specific Version of Your Algorithm"></a>Implementing a Bit-depth Specific Version of Your Algorithm</h3>
<p>Listing&#160;4-8 shows an example implementation of an effect algorithm. The code uses the blit macros to read pixels from the source frame and write them to the destination frame. This example shows a filter that changes a single source. It also shows how to read and alter a single pixel at a time; other effects may handle multiple pixels at a time for efficiency.</p>
<p>The sample shows the following operations for each pixel of the source frame:</p>
<ul class="spaceabove">
<li class="li"><p>Retrieving the next pixel from the source, using the <code>Get16</code> (which reads a 16-bit pixel from a memory address) and <code>cnv16SPFto16RG</code> <code></code> (which converts a 16-bit pixel in the current pixel format to the standardized 16-bit ARGB format) macros to handle pixel format conversion;</p></li>
<li class="li"><p>Decomposing the pixel into alpha, red, green and blue components;</p></li>
<li class="li"><p>Reassembling the alpha, red, green and blue components into a standardized ARGB pixel value;</p></li>
<li class="li"><p>Writing the pixel value to the destination buffer, using the <code>cnv16RGto16DPF</code> (which converts the 16-bit standardized format pixel back into the current buffer&#8217;s 16-bit pixel format) and <code>Set16</code> (which writes a 16-bit pixel to a memory address) macros to handle pixel format conversion.</p></li>
</ul>
<p>The actual effect implementation, which would alter the alpha, red, green and blue values of each pixel according to the effect specification, is not shown in this example code.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_150" title="Listing 4-8A sample effect algorithm for 16-bit frames"></a>
<p class="codesample"><strong>Listing 4-8&nbsp;&nbsp;</strong>A sample effect algorithm for 16-bit frames</p>
<div class="codesample"><table><tr><td scope="row"><pre>#include &#60;BltMacros.h&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>void EffectFilter16(BlitGlobals *glob);<span></span></pre></td></tr><tr><td scope="row"><pre>void EffectFilter16(BlitGlobals *glob)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;height = glob-&#62;height;&#160;&#160;&#160;&#160;&#160;&#160;// Local copy of the height of<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// the buffers <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;UInt16&#160;&#160;*srcA = glob-&#62;sources[0].srcBaseAddr;&#160;&#160;&#160;// Local pointer to<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// the first source image <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;UInt16&#160;&#160;*dst = glob-&#62;dstBaseAddr;&#160;&#160;&#160;// Local pointer to the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// destination <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;srcABump;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;dstBump;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Work out the source and destination "bumps". The rowBytes value<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// gives you the number of bytes in each scanline of an image. This<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// is not necessarily the same as the number of pixels in a scanline<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// multiplied by the number of bytes each pixel occupies. When<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// we copy pixels from source to destination, via our effect<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// algorithm, we need to account for this discrepancy. The following<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// lines lines pre-calculate the differences.<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;srcABump = glob-&#62;sources[0].srcRowBytes - (glob-&#62;width * 2);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;dstBump = glob-&#62;dstRowBytes - (glob-&#62;width * 2);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Now, for every scanline in the source image we are dealing with...<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;while (height--)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;long &#160;&#160;&#160;width = glob-&#62;width;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// ...iterate through every pixel in that scanline<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;while (width--)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;UInt16 &#160;&#160;&#160;&#160;&#160;thePixelValue;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Retrieve the next pixel value<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;thePixelValue = Get16(srcA);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;srcA++;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Call to blit macros to ensure the pixel format is<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// converted appropriately<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cnv16SPFto16RG(thePixelValue);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Get the alpha, red, green and blue values of the pixel<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alpha = 0x8000 &#38; thePixelValue;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;red  = (thePixelValue &#38; 0x7C00) &#62;&#62; 10;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;green = (thePixelValue &#38; 0x03E0) &#62;&#62; 5;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blue = (thePixelValue &#38; 0x001F) &#62;&#62; 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// IMPLEMENT YOUR EFFECT ALGORITHM HERE ON EACH PIXEL<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Re-assemble the A, R, G and B values into a 16-bit<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// destination pixel<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;thePixelValue = alpha | (red &#60;&#60; 10) | (green &#60;&#60; 5)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;| (blue &#60;&#60; 0));  <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Set the destination pixel,first passing it through the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// appropriate blit macro to<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// ensure the correct pixel format conversion is performed<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cnv16RGto16DPF(thePixelValue);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Set16(dst, thePixelValue);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dst++;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Bump the source and destination pointers we are using, to<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// avoid problems when moving from one scanline to the next<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;srcA = (void *) (((Ptr) srcA) + srcABump);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dst = (void *) (((Ptr) dst) + dstBump);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_72" title="Including the Bit-depth Implementations in Your Effect Code"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-IncludingtheBitdepthImplementationsinYourEffectCode" title="Including the Bit-depth Implementations in Your Effect Code"></a>Including the Bit-depth Implementations in Your Effect Code</h3>
<p>Once you have produced separate implementations of your effect algorithm for each bit depth you support, you need to include these in your main effect source code file. Each bit depth implementation is included once for every pixel format you support.</p>
<p>Listing&#160;4-9 shows statements to include the 16-bit implementation of the effect into the main effect source code file. The implementation is included three times, for the following pixel formats:</p>
<ul class="spaceabove">
<li class="li"><p>Big-endian 555 RGB</p></li>
<li class="li"><p>Little-endian 555 RGB</p></li>
<li class="li"><p>Little-endian 565 RGB</p></li>
</ul>
<p>The result of the code in Listing&#160;4-9 is that your effect source code contains three separate versions of the effect algorithm for handling 16-bit sources. These are named <code>EffectFilter16BE555</code>, <code>EffectFilter16LE555</code>, and <code>EffectFilter16LE565</code>, respectively.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_151" title="Listing 4-9Including the 16-bit implementation into the main effect source code"></a>
<p class="codesample"><strong>Listing 4-9&nbsp;&nbsp;</strong>Including the 16-bit implementation into the main effect source code</p>
<div class="codesample"><table><tr><td scope="row"><pre>// 16-bit, Big Endian 555 pixel format<span></span></pre></td></tr><tr><td scope="row"><pre>#define EffectFilter16 EffectFilter16BE555<span></span></pre></td></tr><tr><td scope="row"><pre>#define srcIs16BE555 1<span></span></pre></td></tr><tr><td scope="row"><pre>#define dstIs16BE555 1<span></span></pre></td></tr><tr><td scope="row"><pre>#include "EffectFilter16.c"<span></span></pre></td></tr><tr><td scope="row"><pre>#undef EffectFilter16<span></span></pre></td></tr><tr><td scope="row"><pre>#undef srcIs16BE555<span></span></pre></td></tr><tr><td scope="row"><pre>#undef dstIs16BE555<span></span></pre></td></tr><tr><td scope="row"><pre>// 16-bit, Little Endian, 555 pixel format<span></span></pre></td></tr><tr><td scope="row"><pre>#define EffectFilter16 EffectFilter16LE555<span></span></pre></td></tr><tr><td scope="row"><pre>#define srcIs16LE555 1<span></span></pre></td></tr><tr><td scope="row"><pre>#define dstIs16LE555 1<span></span></pre></td></tr><tr><td scope="row"><pre>#include "EffectFilter16.c"<span></span></pre></td></tr><tr><td scope="row"><pre>#undef EffectFilter16<span></span></pre></td></tr><tr><td scope="row"><pre>#undef srcIs16LE555<span></span></pre></td></tr><tr><td scope="row"><pre>#undef dstIs16LE555<span></span></pre></td></tr><tr><td scope="row"><pre>// 16-bit, Little Endian, 565 pixel format<span></span></pre></td></tr><tr><td scope="row"><pre>#define EffectFilter16 EffectFilter16LE565<span></span></pre></td></tr><tr><td scope="row"><pre>#define srcIs16LE565 1<span></span></pre></td></tr><tr><td scope="row"><pre>#define dstIs16LE565 1<span></span></pre></td></tr><tr><td scope="row"><pre>#include "EffectFilter16.c"<span></span></pre></td></tr><tr><td scope="row"><pre>#undef EffectFilter16<span></span></pre></td></tr><tr><td scope="row"><pre>#undef srcIs16LE565<span></span></pre></td></tr><tr><td scope="row"><pre>#undef dstIs16LE565<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_73" title="Calling the Effect Implementations from EffectRenderFrame"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-CallingtheEffectImplementationsfromEffectRenderFrame" title="Calling the Effect Implementations from EffectRenderFrame"></a>Calling the Effect Implementations from EffectRenderFrame</h3>
<p>Finally, you must provide code inside your <code>EffectRenderFrame</code> function to call the appropriate implementation of your effect algorithm, depending on the pixel format and bit depth of the source frames you are dealing with. Listing&#160;4-10 shows how to do this for the 16-bit pixel formats.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_152" title="Listing 4-10Calling pixel format specific versions of the 16-bit effect implementation"></a>
<p class="codesample"><strong>Listing 4-10&nbsp;&nbsp;</strong>Calling pixel format specific versions of the 16-bit effect implementation</p>
<div class="codesample"><table><tr><td scope="row"><pre>switch (glob-&#62;dstPixelFormat)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;case k16BE555PixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectFilter16BE555(glob);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;case k16LE565PixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectFilter16LE565(glob);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;case k16LE555PixelFormat:<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectFilter16LE555(glob);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The code to handle the 32-bit pixel formats is an easy extension of the code shown in this section, and can be found in the sample effect component included in the QuickTime SDK and described in detail in the next section.</p>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_74" title="The Sample Effect Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheSampleEffectComponent" title="The Sample Effect Component"></a>The Sample Effect Component</h2>
<p>This section introduces you to the sample effect component supplied as part of the QuickTime SDK. It takes you through the parts of the code that you will need to change in order to implement your own effect component.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_75" title="The Dimmer Effect"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheDimmerEffect" title="The Dimmer Effect"></a>The Dimmer Effect</h3>
<p>The sample effect described in this section is a dimmer effect. This simple effect fades the first source to black, then fades up to show the second source. The source code for this effect is provided as a CodeWarrior Pro project as part of the QuickTime SDK.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_76" title="The Standard Effect Framework"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheStandardEffectFramework" title="The Standard Effect Framework"></a>The Standard Effect Framework</h3>
<p>Much of the code required to implement an effect component is the same for all components. Apple has provided a framework of code that you can adapt to create your own effect components. In most cases, you only have to change limited portions of the framework code to create your new component.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_77" title="Structure of the Framework"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-StructureoftheFramework" title="Structure of the Framework"></a>Structure of the Framework</h3>
<p>The effect framework is one approach to writing effects components. It has been designed to provide most of the basic code required to implement an effect component, leaving the implementation of the effect algorithm to you. It should be possible to write most effects using the framework, though you may need to adapt the framework code for more complex effect components.</p>
<p>The framework implements the required component functions for an effect. The main body of the framework is the <code>Effect</code>.c file, which contains the source code for the framework and an implementation of the dimmer effect. This file is made up of four main parts:</p>
<ul class="spaceabove">
<li class="li"><p>The <strong>global</strong> <strong>data</strong> <strong>structures</strong> used by the framework. You will need to update some of the data structures to reflect the capabilities of the effect you are implementing.</p></li>
<li class="li"><p>The <strong>dispatcher</strong> is the entry point to your component. Because all effects components have the same set of component functions, you should not need to alter the dispatcher.</p></li>
<li class="li"><p>The <strong>internal</strong> <strong>functions</strong> are the set of functions that actually execute your effect. This is where most of your own code will be added.</p></li>
<li class="li"><p>The <strong>component</strong> <strong>functions</strong> are the standard functions called by the dispatcher. These functions call the internal functions to actually execute the effect. For most effects, you won&#8217;t need to change much code in this section.</p></li>
</ul>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_78" title="Naming Conventions"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-NamingConventions" title="Naming Conventions"></a>Naming Conventions</h3>
<p>All the function and data structure names in the framework are arbitrary. The names have been chosen to reflect their purpose, but you are free to change the names, as long as they remain internally consistent.</p>
<p>If you choose to change the names of the component functions, you will have to change the <code>CALLCOMPONENT_BASENAME</code> <code>#define</code> in <code>Effect</code>.<code>c</code>. This defines the root of the name used for component functions. For example, if <code>CALLCOMPONENT_BASENAME</code> is set to <code>SlideEffect</code>, then the Open component function must be called <code>SlideEffectOpen</code>, the Close component function must be called <code>SlideEffectClose</code>, and so forth.</p>
<p>Apple recommends that you do not change the names used in the framework.</p>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_79" title="Writing an Effect Component Using the Framework"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-WritinganEffectComponentUsingtheFramework" title="Writing an Effect Component Using the Framework"></a>Writing an Effect Component Using the Framework</h2>
<p>The effect component framework is provided for you to simplify the development of QuickTime video effects components.</p>
<p>The QuickTime SDK includes the folder <code>DimmerEffect</code>, which contains the framework, complete with associated resources and makefiles. See the <code>ReadMe</code> file in the <code>DimmerEffect</code> folder for full installation and use instructions.</p>
<p>To adapt the dimmer framework to create your own component, search through the source code file <code>Effect</code>.c for the comments <code>CHANGE</code>. These comments mark the sections of the source code you will need to change to write your own effect.</p>
<p>The following sections take you through the specific changes you need to make to the framework. All the changes except the last, which implements the actual effect algorithm, are made to the <code>Effect</code>.c file.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_80" title="Synchronous vs. Asynchronous Processing"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SynchronousvsAsynchronousProcessing" title="Synchronous vs. Asynchronous Processing"></a>Synchronous vs. Asynchronous Processing</h3>
<p>The first change you may need to make is to the following <code>#define</code> :</p>

<div class="codesample"><table><tr><td scope="row"><pre>#define kMaxAsyncFrames 0<span></span></pre></td></tr></table></div>

<p>This value defines the number of frames that can be queued for asynchronous rendering by this effect. If your effect declares that is can handle more than <code>0</code> asynchronous frames, frames may be queued for rendering. If you wish to render synchronously, set <code>kMaxAsyncFrames</code> to 0; otherwise set it to the number of frames that can be held in the queue.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_81" title="Defining the Number of Sources"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DefiningtheNumberofSources" title="Defining the Number of Sources"></a>Defining the Number of Sources</h3>
<p>Most effects require one or more sources to operate on, though some effects (such as Apple&#8217;s fire effect) operate without any sources. The dimmer effect uses two sources: the first is the source to fade to black, the second is the source to fade up on. Most effects transition between two sources. Sometimes, effects control the transition between two scenes by blending in one or more other sources, in which case the effect may require three or more sources. You may also want to implement a filter effect that has only a single source and produces a transformed version of that source.</p>
<p>You set the value of <code>kMaxSources</code> to the maximum number of sources required by the effect. Effects that can take more than one source should be prepared to handle the case when fewer than the maximum number of sources are actually provided. For example, if your effect expects two sources to transition between and a third source to use as a mask, your code must handle the case where only the two transition sources are provided. In this case you should use a default mask instead of a third source.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_82" title="Adding to the Global Data Structures"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-AddingtotheGlobalDataStructures" title="Adding to the Global Data Structures"></a>Adding to the Global Data Structures</h3>
<p>The framework defines two global data structures: <code>BlitGlobals</code> and <code>EffectGlobals</code>. The <code>BlitGlobals</code> structure holds information related to drawing a single frame of the effect, while the <code>EffectGlobals</code> holds data for the entire effect as it is executed. These data structures are global to an instance of the effect component. That is, if you have multiple instances of the component opened, each instance gets its own copy of both data structures.</p>
<p>You can add fields to the <code>BlitGlobals</code> data structure to hold information specific to your effect. A set of standard fields are already defined, which hold information used by the framework. You can add your own effect-specific fields between the <code>CHANGE</code> and <code>END</code> <code>CHANGE</code> comments.</p>
<p>The example defines two fields, <code>dimValue</code> and <code>direction</code>. These hold the current dim value for the effect and a flag indicating whether it is fading down or up, respectively. Because the dimmer fades the first scene down to black then fades up on the second scene, it also needs to store the dim value between individual frames. This value is stored in the <code>dimValue</code> field of <code>BlitGlobals</code>.</p>
<p>You can also add fields to the <code>EffectGlobals</code> structure. Generally, you will read the values for the parameters to your effect in these fields so that they can be referenced while the effect executes.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_83" title="Preflighting the Blitter"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-PreflightingtheBlitter" title="Preflighting the Blitter"></a>Preflighting the Blitter</h3>
<p>The internal function <code>BlitterPreflight</code> is called from <code>EffectSetup</code> before the first frame of the effect is rendered. This function&#8217;s main task is to validate the bit depth that the effect is being requested to support.</p>
<p>The bit depth that the effect is being asked to operate at is passed in the <code>depth</code> parameter to <code>BlitterPreflight</code>. The function should return in the same parameter the bit depth at which it wants to operate.</p>
<p>For example, the dimmer effect can operate on 16-bit or 32-bit sources. If either of these values is passed in, it simply returns <code>depth</code> unaltered. If any other bit depth is requested, it sets <code>depth</code> to 16, the default bit depth for this effect.</p>
<p>Your effect should validate the bit depth passed in a similar way. Apple recommends that your effect support at least 16- and 32-bit depths.</p>
<p>When you set the <code>depth</code> parameter to a different value than it was on entry to <code>BlitterPreflight</code>, QuickTime creates an offscreen buffer for the sources and destination of the effect. All data is passed through these offscreen buffers, to ensure that your effect only sees data in a format it can handle.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_84" title="Setting the Destination"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SettingtheDestination" title="Setting the Destination"></a>Setting the Destination</h3>
<p>The <code>BlitterSetDest</code> function is called from <code>EffectBegin</code> and is passed the effect&#8217;s destination, in the form of a <code><!--a target="_top" -->PixMap<!--/a--></code>. The <code>BlitterSetDest</code> function should calculate the base address and <code>rowBytes</code> values for the destination and store these in the <code>BlitGlobals</code> data structure for future reference.</p>
<p>You need to make changes to this function only if your effect supports destinations in bit depths other than 16-bit and 32-bit.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_85" title="The BlitterRenderFrame function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheBlitterRenderFramefunction" title="The BlitterRenderFrame function"></a>The BlitterRenderFrame function</h3>
<p>This function calls the functions that implement your effect algorithm. The function names to be called are those generated by the blit macros.</p>
<p>The example code supports the three most common pixel formats in 16-bit and 32-bit. If your effect needs to support other bit depths or pixel formats, you need to update the <code>switch</code> statement in this function so that the appropriate drawing functions are called.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_86" title="The EffectsFrameClose function"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheEffectsFrameClosefunction" title="The EffectsFrameClose function"></a>The EffectsFrameClose function</h3>
<p>This function is called when the client software has finished using your component. At this time, your component should dispose of any memory it allocated. In particular, you should call <code>DisposeTweenRecord</code> for each tween record you allocated and then call <code>DisposeTweenGlobals</code>.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_87" title="Reading the Effect Parameters"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ReadingtheEffectParameters" title="Reading the Effect Parameters"></a>Reading the Effect Parameters</h3>
<p>The parameters of the effect are read in the <code>EffectsFrameEffectBegin</code> function. Your effect should read its parameter values in the section between the <code>CHANGE</code> and <code>END</code> <code>CHANGE</code> comments, reading either non-tweened or (more frequently) tweened values. Example code for both these cases is given in  <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ReadingParameterValues">Reading Parameter Values</a></span>.</p>
<p>Once you have read in the parameter values, you need to tween those parameters that contain tween records. This code should be placed between the second pair of <code>CHANGE</code> and <code>END</code> <code>CHANGE</code> comments. Again, example code to do this is supplied, see <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TweeningParameterValues">Tweening Parameter Values</a></span>.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_88" title="Implementing your Effect"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ImplementingyourEffect" title="Implementing your Effect"></a>Implementing your Effect</h3>
<p>The last <code>stage</code> in adapting the framework is to implement your effect algorithm. You need to provide one implementation per bit depth that your effect explicitly supports, and each implementation must be placed in a separate file. These files are named <code>EffectFilter16</code>.c, <code>EffectFilter32</code>.c, and so forth.</p>
<p>The dimmer effect code provides an example of the pixel manipulations that an effect will typically perform, and shows how to use the blit macros to support multiple pixel formats at a given bit depth.</p>
<p>Clearly, the details of these routines are entirely dependent on the effect being implemented.</p>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_89" title="Adding an &#39;atms&#39; Resource to your Component"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-AddinganatmsResourcetoyourComponent" title="Adding an &#39;atms&#39; Resource to your Component"></a>Adding an 'atms' Resource to your Component</h2>
<p>The <code><!--a target="_top" -->'atms'<!--/a--></code> resource for your effect contains two sets of information. The first set contains the effect information that is used to construct the standard parameters dialog box. This includes items such as the name of your effect and optional copyright information.</p>
<p>The second set contains the parameter information, which is a description of each parameter that your effect takes. If your effect does not take parameters, there is no information in this set.</p>
<p>The structure of an <code><!--a target="_top" -->'atms'<!--/a--></code> <code></code> resource is as follows:</p>

<div class="codesample"><table><tr><td scope="row"><pre>resource 'atms' (kEffectatmsRes) {<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;&#xA0;&#xA0;7,<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// The resource body goes here<span></span></pre></td></tr><tr><td scope="row"><pre>&#xA0;};<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>

<p>The header for this resource contains two items: the resource ID, and the number of root level atoms the resource contains.</p>
<p>The first line contains the ID of the <code><!--a target="_top" -->'atms'<!--/a--></code> resource. In this example, the identifier that is used (<code>kEffectatmsRes</code> ) is also used in the call to <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/GetComponentResource" target="_top">GetComponentResource</a></code> in Listing&#160;4-1. This ensures that the right <code><!--a target="_top" -->'atms'<!--/a--></code> resource is read by QuickTime.</p>
<p>The second line contains the number of root atoms in the resource. Each <code><!--a target="_top" -->'atms'<!--/a--></code> resource contains a number of atoms. The number in the second line must contain a count of the number of first-level atoms in the resource.</p>
<div class="warningbox"><img src="../../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_153" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
It is critical that you update this number if you add or delete atoms from your <code><!--a target="_top" -->'atms'<!--/a--></code> resource. If this number is larger than the number of atoms in your effect, your effect component can cause QuickTime to crash. If this number is smaller than the number of atoms actually in the resource, users will not be able to adjust the values of some parameters.  </p><p>
</p><div class="clear"></div></div>
<p>The body of the <code><!--a target="_top" -->'atms'<!--/a--></code> resource consists of a number of atom declarations. Each declaration has a header that contains</p>
<ul class="ul">
<li class="li"><p>the atom name</p></li>
<li class="li"><p>the atom ID</p></li>
<li class="li"><p>the number of children in the declaration</p></li>
</ul>
<p>Each header is followed by the atom&#8217;s data, which is one or more typed values, such as a <code>string</code> or a <code>long</code>, or a set of child atoms.</p>
<p>Listing&#160;4-11 shows an example atom that contains a single typed value as its data. Note that the value is a type followed by the data itself. The number of children of the atom is declared as <code>noChildren</code> because the atom contains a typed value.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_154" title="Listing 4-11An example &#39;atms&#39; atom declaration"></a>
<p class="codesample"><strong>Listing 4-11&nbsp;&nbsp;</strong>An example 'atms' atom declaration</p>
<div class="codesample"><table><tr><td scope="row"><pre>kParameterTitleName, kParameterTitleID, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;string { "Dimmer2 Effect Parameters" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_90" title="The Standard Information in an &#39;atms&#39; Resource"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheStandardInformationinanatmsResource" title="The Standard Information in an &#39;atms&#39; Resource"></a>The Standard Information in an 'atms' Resource</h3>
<p>The standard information stored in an <code><!--a target="_top" -->'atms'<!--/a--></code> resource is made up of three required atoms and five optional atoms.</p>
<p>The three required atoms are</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterTitleName</code></p></td>
<td ><p>a <code>string</code> used as the title of the standard parameters dialog box. An example of a <code>kParameterTitleName</code> atom declaration is shown in  Listing&#160;4-11.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterWhatName</code></p></td>
<td ><p>an <code>OSType</code> containing the name of this effect component.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterSourceCountName</code></p></td>
<td ><p>a long integer containing the maximum number of sources that the effect can take.</p></td>
</tr>

</table></div>
<p>The five optional atoms are</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterAlternateCodecName</code></p></td>
<td ><p>an <code>OSType</code> containing the unique identifier of another effect component that should be used to replace this effect if this effect cannot be used.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterInfoLongName</code></p></td>
<td ><p>a <code>string</code> containing the long version of the name of the effect.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterInfoCopyright</code></p></td>
<td ><p>a <code>string</code> containing a copyright statement for the effect.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterInfoDescription</code></p></td>
<td ><p>a <code>string</code> containing a brief description of what the effect does.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterInfoWindowTitle</code></p></td>
<td ><p>a <code>string</code> containing the title of the window that displays the information contained in the optional atoms.</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_91" title="The Parameter Information in an &#39;atms&#39; Resource"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheParameterInformationinanatmsResource" title="The Parameter Information in an &#39;atms&#39; Resource"></a>The Parameter Information in an 'atms' Resource</h3>
<p>For each parameter of the effect, your <code><!--a target="_top" -->'atms'<!--/a--></code> resource must contain a set of atoms in the <code><!--a target="_top" -->'atms'<!--/a--></code> resource that describes that parameter. This description includes the name of the parameter, the type and range of values it can take, and hints on appropriate user interface element for setting this parameter.</p>
<p>A complete description of the information you need to provide for each parameter can be found in <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheParameterDescriptionFormat">The Parameter Description Format</a></span>.</p>
<p>For a basic parameter, there are five atoms that you should supply:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterAtomTypeAndID</code></p></td>
<td ><p>contains the type and ID of the parameter (an <code>OSType</code> and a <code>long</code> integer, respectively), the atom flags for the parameter, and a <code>string</code> containing the name of the parameter.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterDataType</code></p></td>
<td ><p>a long integer containing the type of the parameter, such as <code>kParameterTypeDataFixed</code>.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterDataRange</code></p></td>
<td ><p>a set of typed values describing the range of values the parameter can take. The number and type of values you supply depend on the value of the <code>kParameterDataType</code> atom.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterDataBehavior</code></p></td>
<td ><p>two long integer values containing the behavior type, such as <code>kParameterItemControl</code> for a slider, and any flags, such as <code>kAtomNotInterpolated</code> for a parameter that cannot be tweened.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterDataDefaultItem</code></p></td>
<td ><p>the default value of the parameter. Again, the type of this value will depend on the type of the <code>kParameterDataType</code> atom. This atom must be a correctly-formatted parameter atom that can be passed back to your component by client software without modification.</p></td>
</tr>

</table></div>
<p>An example of a basic parameter description is shown in Listing&#160;4-12.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_155" title="Listing 4-12An example set of parameter description atoms"></a>
<p class="codesample"><strong>Listing 4-12&nbsp;&nbsp;</strong>An example set of parameter description atoms</p>
<div class="codesample"><table><tr><td scope="row"><pre>kParameterAtomTypeAndID, 101, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType { "sden" };&#160;&#160;&#160;&#160;&#160;&#160;// atomType--the name of this parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "1" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// atomID--this is atom number 1<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kAtomNotInterpolated; // atomFlags--this parameter cannot be tweened<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;string { "Scratch Density" }; // atomName--the name of the parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// as it will appear in the standard parameters dialog box<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataType, 101, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kParameterTypeDataLong;&#160;&#160;&#160;&#160;&#160;// dataType--this parameter contains a<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// long value <span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataRange, 101, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "0" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;// minimumValue<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "25" };&#160;&#160;&#160;&#160;&#160;&#160;// maximumValue<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "1" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;// scaleFactor--no scaling is applied to this<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "0" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;// precision--0 indicates that this parameter is<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// not a floating-point value<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataBehavior, 101, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kParameterItemControl;&#160;&#160;// behaviorType--this parameters should be<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// represented by a slider<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "0" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// behaviorFlags - no flags<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataDefaultItem, 101, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "5" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// the default value of the parameter<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_92" title="The Parameter Description Format"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheParameterDescriptionFormat" title="The Parameter Description Format"></a>The Parameter Description Format</h2>
<p>The parameter description data structure is a <code>QTAtomContainer</code> structure that, when filled out by the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code> call, contains a set of <code>QTAtoms</code> for each parameter of the effect. These atoms define the base type of the parameter, the legal range of values that can be stored in it, and hints for displaying a user interface to set values for the parameter.</p>
<p>The atoms in a parameter description are described in the following sections. The order in which the atoms are stored in the <code>QTAtomContainer</code> structure is important. Applications should present parameters to the user in the same order that they are contained in the parameter description.</p>
<p>Each of the atom types in a parameter description has a name; you will find constants for these in <code>ImageCodec</code>.<code>h</code>. You should use these constants when retrieving atoms from the data structure. The data stored in the atoms of the parameter description is structured, and the <code>struct</code> definitions are given in the atom descriptions below.</p>
<p>Many of the atoms must be present to create a valid parameter description. Some are optional, as noted.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_93" title="Parameter Atom Type and ID"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterAtomTypeandID" title="Parameter Atom Type and ID"></a>Parameter Atom Type and ID</h3>
<p>This atom contains information about the type and ID of the parameter. The data is contained in the following structure:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtomType&#160;&#160;atomType;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtomID&#160;&#160;&#160;&#160;atomID;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;atomFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Str255&#160;&#160;&#160;&#160;&#160;&#160;atomName;<span></span></pre></td></tr><tr><td scope="row"><pre>} ParameterAtomTypeAndID;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>atomType</code></p></td>
<td ><p>This field contains either a unique identifier for the parameter or the value <code>kNoAtom</code>. The unique identifier is a four character <code>OSType</code> that you use to retrieve the parameter's value. If this field contains <code>kNoAtom</code>, the "parameter" being described is actually a group description; groups are described in "Special Description Types" [link s Creating New Video Effects].</p></td>
</tr>
<tr>
<td  scope="row"><p><code>atomID</code></p></td>
<td ><p>This field contains the ID of this parameter.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>atomFlags</code></p></td>
<td ><p>This field can contain one of the predefined values: <code>kAtomNoFlags</code>, <code>kAtomNotInterpolated</code>, or <code>kAtomInterpolateIsOptional</code>.  If it contains <code>kAtomNotInterpolated</code>, the user interface allows users to enter only a single value for this parameter, and this value remains constant while the effect is playing.  If it contains <code>kAtomNoFlags</code>, the user interface allows users to enter a set of values for the parameter. This set of values are stored in a tween atom, and the value of the parameter is interpolated between these values during effect playback.  If it contains <code>kAtomInterpolateIsOptional</code>, the user interface defaults to allowing a single value for the parameter. If the user interface supports an "advanced" mode of operation, then a tween value can be entered for this parameter when the user interface is in this mode. An example of an advanced mode is the standard parameters dialog box: if you hold down the option key while selecting an effect, any parameters that have the <code>kAtomInterpolateIsOptional</code> flag set will allow a tween value to be entered.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>atomName</code></p></td>
<td ><p>The name of this parameter. This <code>string</code> value is used as the name of the control displayed in the standard parameter dialog box to enter a value for this parameter. This atom is required.</p></td>
</tr>

</table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_94" title="Special Description Types"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SpecialDescriptionTypes" title="Special Description Types"></a>Special Description Types</h2>
<p>If the parameter atom type and ID atom of a parameter description contains the constant <code>kNoAtom</code>, this indicates that the value being described is not a parameter to the effect but is a group. Besides groups, two further special cases are covered in the following sections: enumeration lists and source counts.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_95" title="Groups"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-Groups" title="Groups"></a>Groups</h3>
<p>It is sometimes useful to treat a set of parameters as a group. For example, you might want to label a group of parameters that jointly control something, align a group of controls, or enclose a set of parameters in a box. The grouping mechanism allows you to specify a set of parameters and the attributes that are applied to the group.</p>
<p>If the parameter data type and ID atom of a description contains child atoms, rather than data, it defines a group. A group is a set of related atoms, where the relationship amongst them can be based on attributes such as:</p>
<ul class="spaceabove">
<li class="li"><p>layout; for example, the group is a set of text labels that should be aligned.</p></li>
<li class="li"><p>spatial; for example, the items in the group should be placed side by side to optimize dialog box layout.</p></li>
<li class="li"><p>naming; the items in the group are related controls that should be displayed under a single heading in the dialog box.</p></li>
<li class="li"><p>usage; a pair of long integers may together specify a coordinate. In this case, they can be grouped together and the group&#8217;s parameter data usage atom set to <code>kParameterUsagePoint</code>.</p></li>
</ul>
<p>Groups can be nested within one another as needed. Groups can optionally have a name, which allows your application to place grouped parameters within a panel or tabbed group under that name.</p>
<p>Listing&#160;4-13 shows an example of a group, which in this case contains a single parameter description.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_156" title="Listing 4-13An example group atom from an &#39;atms&#39; resource definition."></a>
<p class="codesample"><strong>Listing 4-13&nbsp;&nbsp;</strong>An example group atom from an 'atms' resource definition.</p>
<div class="codesample"><table><tr><td scope="row"><pre>kParameterAtomTypeAndID, 100, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType { "none" };&#160;&#160;&#160;&#160;&#160;&#160;// Use 'none' as this is not a real parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "0" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kAtomNoFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;string { "" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataBehavior, 100, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kParameterItemGroupDivider; // Use a divider to separate this group<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kGroupNoFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataType, 100, 1*5, &#160;&#160;// 1 parameter * 5 atoms to describe each<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//parameter <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterAtomTypeAndID, 3, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType { "pMul" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "1" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kAtomNotInterpolated;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;string { "Pre-multiply color" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataType, 3, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kParameterTypeDataRGBValue;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataRange, 3, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "0" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "0" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "0" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataBehavior, 3, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;kParameterItemColorPicker;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "0" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>kParameterDataDefaultItem, 3, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;short { "65535" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_96" title="Enumeration Lists"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-EnumerationLists" title="Enumeration Lists"></a>Enumeration Lists</h3>
<p>When an enumerated type is required for a parameter value, a new enumeration list is placed directly into the root atom container. Enumeration lists are arrays of name-and-value pairings in the following format:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;value;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Str255&#160;&#160;name;<span></span></pre></td></tr><tr><td scope="row"><pre>} EnumValuePair;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;enumCount;&#160;&#160;// number of enumeration items to follow<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;EnumValuePair&#160;&#160;&#160;values[1];&#160;&#160;// values and names for them<span></span></pre></td></tr><tr><td scope="row"><pre>} EnumListRecord;<span></span></pre></td></tr></table></div>

<p>The type of an enumeration list atom is <code>kParameterEnumList</code> (<code>'enum'</code> ). Listing&#160;4-14 shows an enumeration list that contains three elements.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_157" title="Listing 4-14An example enumeration list from an &#39;atms&#39; resource definition"></a>
<p class="codesample"><strong>Listing 4-14&nbsp;&nbsp;</strong>An example enumeration list from an 'atms' resource definition</p>
<div class="codesample"><table><tr><td scope="row"><pre>kParameterEnumList, 1, noChildren,<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long { "3" };&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// No of elements in the enum<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long {"1"}; string { "Straight Alpha" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long {"2"}; string { "Pre-multiply Alpha" };<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long {"3"}; string { "Reverse Alpha" };<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_97" title="Source Count"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SourceCount" title="Source Count"></a>Source Count</h3>
<p>The source count atom (<code>kParameterSourceCountName</code>, <code>'srcs'</code> ) contains a single long integer value that defines the maximum number of sources that this effect can accept. The atom is always placed in the root atom container of the parameter description.</p>
<p>The source count atom is required.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_98" title="Parameter Data Type"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDataType" title="Parameter Data Type"></a>Parameter Data Type</h3>
<p>This atom defines the type of the data for this parameter. It contains data in the following structure:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType&#160;&#160;dataType;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>dataType</code></p></td>
<td ><p>This field contains the type of the value that is stored in this parameter. This can be one of the following values:</p></td>
</tr>

</table></div>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterTypeDataText</code></p></td>
<td ><p>editable text item</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataLong</code></p></td>
<td ><p>integer value</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataEnum</code></p></td>
<td ><p>enumerated lookup value</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataFixed</code></p></td>
<td ><p>fixed point value</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataDouble</code></p></td>
<td ><p>IEEE 64 bit floating point value</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataBitField</code></p></td>
<td ><p>bit field (Boolean) value</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataRGBValue</code></p></td>
<td ><p>RGBColor data</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataImage</code></p></td>
<td ><p>reference to an image</p></td>
</tr>

</table></div>
<p>This atom is required.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_99" title="Parameter Alternate Data Type"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterAlternateDataType" title="Parameter Alternate Data Type"></a>Parameter Alternate Data Type</h3>
<p>This atom defines a preferred data type for the parameter. If the system your application is running on does not support this preferred data type, the data type specified in the parameter data type atom will be used instead.</p>
<p>Use the alternate data type atom if you would prefer to use a data type that is not supported on all platforms, and use the parameter data type atom to specify a fall-back data type for systems that do not support your preferred data type.</p>
<p>For example, if the parameter alternate data type is <code>kParameterTypeDataColorValue</code>, the parameter holds a value of type <code>CMColor</code> <code></code> on systems that have the ColorSync extension. On systems that do not have ColorSync, whatever is specified in the parameter data type (such as an <code>RGBValue</code> ) is used instead.</p>
<p>This atom&#8217;s data is stored in a <code><!--a target="_top" -->ParameterAlternateDataType<!--/a--></code> data structure, which in turn relies on the <code><!--a target="_top" -->ParameterAlternateDataEntry<!--/a--></code> data structure.</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType&#160;&#160;&#160;&#160;&#160;&#160;dataType;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// The type of the data<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtomType&#160;&#160;alternateAtom;&#160;&#160;// The atom to use for alternate data<span></span></pre></td></tr><tr><td scope="row"><pre>} ParameterAlternateDataEntry;<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alternateCount; <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ParameterAlternateDataEntry&#160;&#160;&#160;&#160;&#160;alternates[];<span></span></pre></td></tr><tr><td scope="row"><pre>} ParameterAlternateDataType;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>dataType</code></p></td>
<td ><p>This field in the <code>ParameterAlternateDataEntry</code> structure can take one of the following values:</p></td>
</tr>

</table></div>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterTypeDataColorValue</code></p></td>
<td ><p>CM color data</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataCubic</code></p></td>
<td ><p>Cubic Beziers</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterTypeDataNURB</code></p></td>
<td ><p>Nurbs</p></td>
</tr>

</table></div>
<p>The parameter alternate data type atom is optional.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_100" title="Parameter Data Range"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDataRange" title="Parameter Data Range"></a>Parameter Data Range</h3>
<p>The Parameter Data Range atom defines the legal range of values that the parameter can take. It also defines a scaling constant that defines how the legal range of values can be translated into a range that is more suitable for display in a user interface. For example, a value with a range of 0-255 might be scaled as 0-100 for user input.</p>
<p>The atom&#8217;s data is structured as a <code>RangeRecord</code>, defined below. The exact format of this data depends on the data type of the parameter being described.</p>

<div class="codesample"><table><tr><td scope="row"><pre>// 'text'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;maxChars;&#160;&#160;&#160;// Maximum length of the string<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;maxLines;&#160;&#160;&#160;// Number of editing lines (typically 1)<span></span></pre></td></tr><tr><td scope="row"><pre>} StringRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// 'long'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;minValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Minimum value the long can be <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;maxValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Maximum value the long can be <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;scaleValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Scaling constant<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;precisionDigits;&#160;&#160;&#160;&#160;// number of digits of precision<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// when editing via typing <span></span></pre></td></tr><tr><td scope="row"><pre>} LongRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// 'enum'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;enumID;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// The ID of the 'enum' atom in the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// root container to search <span></span></pre></td></tr><tr><td scope="row"><pre>} EnumRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// 'fixd'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Fixed&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;minValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Minimum value the Fixed can be <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Fixed&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;maxValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Maximum value the Fixed can be <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;Fixed&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;scaleValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Scaling constant<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;precisionDigits;&#160;&#160;&#160;&#160;// number of digits of precision<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// when editing via typing <span></span></pre></td></tr><tr><td scope="row"><pre>} FixedRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// 'doub'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTFloatDouble&#160;&#160;&#160;minValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Minimum value of parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTFloatDouble&#160;&#160;&#160;maxValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Maximum value of parameter<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTFloatDouble&#160;&#160;&#160;scaleValue;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Scaling constant<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;precisionDigits;&#160;&#160;&#160;&#160;// number of digits of precision<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// when editing via typing <span></span></pre></td></tr><tr><td scope="row"><pre>} DoubleRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// 'bool'<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;maskValue;&#160;&#160;// value to mask on/off to set/clear the<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// boolean <span></span></pre></td></tr><tr><td scope="row"><pre>} BooleanRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// 'rgb '<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;RGBColor&#160;&#160;&#160;&#160;minColor;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Minimum value the RGBColor can be<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;RGBColor&#160;&#160;&#160;&#160;maxColor;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Maximum value the RGBColor can be<span></span></pre></td></tr><tr><td scope="row"><pre>} RGBRangeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>// The RangeRecord data structure is the union of all of the above<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;union<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LongRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;longRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EnumRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;enumRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FixedRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fixedRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DoubleRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;doubleRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;StringRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;stringRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;BooleanRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;booleanRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;RGBRangeRecord&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rgbRange;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} u;<span></span></pre></td></tr><tr><td scope="row"><pre>} RangeRecord;<span></span></pre></td></tr></table></div>

<p>The <code>minValue</code> and <code>maxValue</code> fields of the <code>DoubleRangeRecord</code> data structure can take, in addition to an actual <code>QTFloatDouble</code> value, the following predefined values:</p>
<ul class="spaceabove">
<li class="li"><p><code>kNoMinimumDouble</code>; ignore the minimum value</p></li>
<li class="li"><p><code>kNoMaximumDouble</code>; ignore the maximum value</p></li>
<li class="li"><p><code>kNoScaleDouble</code>; don&#8217;t perform any scaling of value</p></li>
</ul>
<p>The <code>minValue</code> and <code>MaxValue</code> fields of the <code><!--a target="_top" -->LongRangeRecord<!--/a--></code> data structure can take, in addition to an actual long integer value, the following predefined values:</p>
<ul class="spaceabove">
<li class="li"><p><code>kNoMinimumLongFixed</code>; ignore minimum value</p></li>
<li class="li"><p><code>kNoMaximumLongFixed</code>; ignore maximum value</p></li>
<li class="li"><p><code>kNoScaleLongFixed</code>; don&#8217;t perform any scaling of value</p></li>
<li class="li"><p><code>kNoPrecision</code>; allow as many digits as format</p></li>
</ul>
<p>The Parameter Data Range atom is required, except for group descriptions.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_101" title="Parameter Data Behavior"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDataBehavior" title="Parameter Data Behavior"></a>Parameter Data Behavior</h3>
<p>The Parameter Data Behavior atom contains user interface hints that suggest to the client application how a parameter should be displayed.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_158" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
These user interface hints can be ignored by your application if you have a specific interface style you wish to implement. However, Apple recommends that you use the editing mechanisms suggested for the parameter whenever possible. If your application does not use the suggested behavior, you will present an inconsistent and potentially confusing interface to your users.  </p>
</div>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;QTAtomID &#160;&#160;&#160;groupID;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long &#160;&#160;&#160;&#160;&#160;&#160;&#160;controlValue;<span></span></pre></td></tr><tr><td scope="row"><pre>} ControlBehaviors;<span></span></pre></td></tr></table></div>


<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType&#160;&#160;behaviorType;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;long&#160;&#160;&#160;&#160;behaviorFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;union<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ControlBehaviorscontrols;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;} u;<span></span></pre></td></tr><tr><td scope="row"><pre>} ParameterDataBehavior;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>behaviorType</code></p></td>
<td ><p>This field contains a value that specifies a user interface for editing the parameter's value. This field should contain one of the following pre-defined values:</p></td>
</tr>

</table></div>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterItemEditText</code></p></td>
<td ><p>the parameter should be edited using an edit text field.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemEditLong</code></p></td>
<td ><p>the parameter should be edited using an edit text field that only accepts numerical entries.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemEditFixed</code></p></td>
<td ><p>the parameter should be edited using an edit text field that accepts floating-point numerical entries.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemPopUp</code></p></td>
<td ><p>the parameter should be edited using a pop-up menu. This data behavior should only be used with parameters whose data type is <code>kParameterTypeDataEnum;</code> the pop-up menu is populated from the enumeration values.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemRadioCluster</code></p></td>
<td ><p>the parameter should be edited using a group of radio buttons. This data behavior should only be used with parameters whose data type is <code>kParameterTypeDataEnum</code> ; the radio buttons are created from the enumeration values</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemCheckBox</code></p></td>
<td ><p>the parameter should be edited using a checkbox This data behavior should only be used with parameters whose data type is <code>kParameterTypeDataBitField</code>.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemControl</code></p></td>
<td ><p>the parameter should be edited using a standard control appropriate to the data type of the parameter. For parameters that accept a scalar value, such as a <code>Fixed</code> or a <code>Long</code>, the control used is a slider.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemLine</code></p></td>
<td ><p>a horizontal line is drawn in above the control that manipulates this parameter's value.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemRectangle</code></p></td>
<td ><p>a rectangle is drawn around the control that manipulates this parameter's value.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemColorPicker</code></p></td>
<td ><p>the parameter should be edited using a color swatch and picker.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemGroupDivider</code></p></td>
<td ><p>start of a new group of items.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemStaticText</code></p></td>
<td ><p>the parameter's name is displayed as a static text field.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemDragImage</code></p></td>
<td ><p>the parameter should be edited as an image that accepts drag and drop entry of new images.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterItemDragPath</code></p></td>
<td ><p>the parameter should be edited as a path display that allows the user to drag out a new path.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>behaviorFlags</code></p></td>
<td ><p>This field can take one or more of the following values:</p></td>
</tr>

</table></div>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Flag</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kGraphicsNoFlags</code></p></td>
<td ><p>no options for graphics.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGraphicsFlagsGray</code></p></td>
<td ><p>any lines or rectangles that are drawn have a grayscale appearance. If this option is not set, lines and rectangles are drawn in black.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGroupNoFlags</code></p></td>
<td ><p>no options for the group.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGroupAlignText</code></p></td>
<td ><p>the controls in the group are aligned.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGroupSurroundBox</code></p></td>
<td ><p>the controls in the group are surrounded with a box.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGroupMatrix</code></p></td>
<td ><p>display the controls in the group in a matrix, if such an arrangement is possible.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kGroupNoName</code></p></td>
<td ><p>do not display the name of the group.</p></td>
</tr>

</table></div>
<p>The <code>behaviorFlags</code> values allow you to optionally show or hide a group depending on the value entered into a parameter. This allows you to express simple conditionals within a standard parameters dialog box. For example, you may want a pop-up menu with a set of fixed options, and an 'Others...' option; if the user chooses 'others', a text edit field is enabled to allow users to enter their own value.</p>
<p>To do this, you can use the <code>kDisableWhenLessThan</code> flag to specify that the group containing the text control is disabled when the user chooses any value in the pop-up menu that is less than the last, 'Others...' option.</p>
<p>The following flags are available to control selective disabling of groups. For each of these flags, the ID of the group to be disabled is stored in the <code>groupID</code> field of the <code>controls</code> data structure. The value that is used in the comparison operation is stored in the <code>controlValue</code> field of the <code>controls</code> data structure.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Flag</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kDisableWhenNotEqual</code></p></td>
<td ><p>When the value chosen for this parameter is not equal to <code>controlValue,</code> disable the group <code>groupID.</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kDisableWhenEqual</code></p></td>
<td ><p>When the value chosen for this parameter is equal to <code>controlValue,</code> disable the group <code>groupID.</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kDisableWhenLessThan</code></p></td>
<td ><p>When the value chosen for this parameter is less than the <code>controlValue,</code> disable the group <code>groupID.</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>kDisableWhenGreaterThan</code></p></td>
<td ><p>When the value chosen for this parameter is greater than the <code>controlValue,</code> disable the group <code>groupID.</code></p></td>
</tr>

</table></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_159" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
You can only disable groups, not individual parameters. However, you can create a group with no visual attributes that contains a single parameter.  </p>
</div>
<p>The parameter data behavior atom is required.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_102" title="Parameter Data Usage"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDataUsage" title="Parameter Data Usage"></a>Parameter Data Usage</h3>
<p>The parameter data usage atom defines the intended use of the data in the parameter. This information can be used by your application to provide a more appropriate user interface for a parameter or group of parameters. For example, if your application knows that a set of four long integer values actually represent a rectangle, it can present a graphical display of the rectangle, rather than simply displaying four numeric input fields.</p>
<p>The data in this atom is stored in the following data structure:</p>

<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;OSType&#160;&#160;usageType;<span></span></pre></td></tr><tr><td scope="row"><pre>} ParameterDataUsage;<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>usageType</code></p></td>
<td ><p>This field defines the actual use that a parameter or group of parameters. It can take one of the following values:</p></td>
</tr>

</table></div>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>kParameterUsagePixels</code></p></td>
<td ><p>The parameters in the group contain a set of pixels.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageRectangle</code></p></td>
<td ><p>The parameters in the group contain the top-left and bottom-right coordinates of a rectangle.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsagePoint</code></p></td>
<td ><p>The parameters in the group contain the coordinates of a point.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsage3DPoint</code></p></td>
<td ><p>The parameters in the group contain the X,Y,Z coordinates of a 3D point.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsage3by3Matrix</code></p></td>
<td ><p>The parameters in the group contain a 3x3 matrix of values.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageDegree</code></p></td>
<td ><p>The parameter contains degrees.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageRadians</code></p></td>
<td ><p>The parameter contains radians.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsagePercent</code></p></td>
<td ><p>The parameter contains a percentage.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageSeconds</code></p></td>
<td ><p>The parameter contains seconds.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageMilliseconds</code></p></td>
<td ><p>The parameter contains milliseconds.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>kParameterUsageMicroseconds</code></p></td>
<td ><p>The parameter contains microseconds.</p></td>
</tr>

</table></div>
<p>The parameter data usage atom is optional.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_103" title="Parameter Data Default Item"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDataDefaultItem" title="Parameter Data Default Item"></a>Parameter Data Default Item</h3>
<p>The parameter data default item atom contains the default value for the parameter. This value is stored in a QuickTime atom and can be copied directly into the parameter or into an effect description; an application does not need to understand the contents or format of the atom in order to do this.</p>
<p>The parameter data default item atom is required, except for group descriptions.</p>


<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_104" title="Tweening Parameters"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TweeningParameters" title="Tweening Parameters"></a>Tweening Parameters</h2>
<p>An important property of effect parameters is that many can be tweened, and some must be tweened. Tweening is QuickTime&#8217;s general purpose interpolation mechanism (see <em><a href="../../../MediaTypesAndHandlers/MHFundamentals/index.html#//apple_ref/doc/uid/TP40000899" target="_top">QuickTime Media Types and Media Handlers Guide</a></em>). This allows the value of the parameter to change as the effect executes.</p>
<p>For example, the slide effect built into QuickTime (see <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-Slide">Slide</a></span>) has an angle parameter. This controls the angle from which the second source will slide over the first during the execution of the effect. If this parameter contains a single value, the second source will slide over the first in a straight line from the selected angle. However, if the parameter contains two values, the angle will be interpolated between these values during the execution of the effect. This allows you to specify a curved slide effect.</p>
<p>In fact, any valid tween record can be specified as the parameter value, not just records containing pairs of values. The QuickTime tweening mechanism supports tween records that contain more than two values and that specify the interpolation algorithm used to produce intermediate values. However, the standard parameters dialog box allows only a pair of values to be entered, and the appropriate default interpolator is used. The standard parameter dialog box presents the user with a pair of values for parameters that must be tweened. Parameters that are optionally tweened, such as the angle for the slide effect, are set to a single value by default. In order to set an optionally-tweened parameter to a tweened value, the user must hold down the Option key when selecting the effect in the dialog box.</p>
<p>An application can provide its own user interface for entering multiple tween values for a parameter and choosing an appropriate tweener to perform interpolation, if required.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_160" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
Effect component authors do not need to write code to handle all the possible combinations of tween record types, as the details of the tween record are handled by using the standard QuickTime tweening APIs.  </p>
</div>
<p>For more details on specifying which parameter values can contain tween values, see  <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterAtomTypeandID">Parameter Atom Type and ID</a></span>. For more details on supporting tweened parameters in your effect component, see  <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TweeningParameterValues">Tweening Parameter Values</a></span>.</p>
<p>Refer to <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheParameterDescriptionFormat">The Parameter Description Format</a></span> for a complete description of the possible parameter descriptions you can place in your <code><!--a target="_top" -->'atms'<!--/a--></code> resource.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_105" title="Slide"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-Slide" title="Slide"></a>Slide</h2>
<p><code>kSlideTransitionType</code> <code>('slid')</code></p>
<p>In a slide effect, source B slides onto the screen to cover source A. The angle from which source B enters the frame is stored in a parameter, with 0 degrees being the top of the screen.</p>
<p>The slide effect takes a maximum of two sources and has two parameters.</p>
<p>Use the descriptions below to help you understand what the parameters do. To learn how to use parameter atoms, see <span class="content_text"><a href="../B-Chapter/2HowToAddQuickTimeVi.html#//apple_ref/doc/uid/TP40000868-HowToAddQuickTimeVideoEffects-AddingVideoEffectstoaQuickTimeMovie">Adding Video Effects to a QuickTime Movie</a></span>.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Name</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Code</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>QTAtom Type</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p>Percentage</p></td>
<td ><p><code>'pcnt'</code></p></td>
<td ><p><code>kParameterTypeDataFixed</code>     Always a tween</p></td>
<td ><p>This parameter contains a tween. As&#160;the effect progresses, QuickTime renders the frame of the effect indicated by the tween's current value, as a percentage of the whole effect. For&#160;example, if the tween goes from 0&#160;to 100, the effect renders completely; if the tween goes from 25 to 75, rendering begins 25% into the effect and terminates 75% through the effect.</p></td>
</tr>
<tr>
<td  scope="row"><p>Slide angle</p></td>
<td ><p><code>'angl'</code></p></td>
<td ><p><code>kParameterTypeDataFixed</code>     Can be a tween</p></td>
<td ><p>The angle from which source B will enter the frame. This value is expressed in degrees, with <code>0</code> degrees defined as the top of the screen.</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_106" title="Parameter Descriptions"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ParameterDescriptions" title="Parameter Descriptions"></a>Parameter Descriptions</h2>
<p>Each effect component supplies a <strong>parameter</strong> <strong>description</strong> data structure that describes in detail the set of parameters that the effect has.</p>
<p>This section describes the parameter description format in detail. You need this information if you are writing an effect component. If you are writing an effect component, you should provide a parameter description as part of an <code><!--a target="_top" -->'atms'<!--/a--></code> resource (see <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-SupplyingParameterDescriptionInformation">Supplying Parameter Description Information</a></span> for more details).</p>
<p>You may also need this information if you are writing an application that presents its own user interface for setting effect parameters. In this case, you will need to parse parameter descriptions to generate appropriate controls to set parameter values. Most applications can simply use the <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCreateStandardParameterDialog" target="_top">QTCreateStandardParameterDialog</a></code> function, and do not need to parse effect parameter descriptions.</p>
<p>Any software that uses an effect can request its parameter description. Typically, the parameter description is then passed to <code><a href="../../../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/c/func/QTCreateStandardParameterDialog" target="_top">QTCreateStandardParameterDialog</a></code> or especially, <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecCreateStandardParameterDialog" target="_top">ImageCodecCreateStandardParameterDialog</a></code>. These functions use the parameter description to display a user interface that allows users to choose the values of the parameters.</p>
<p>Your are free to use the information in an effect&#8217;s parameter description in other ways. For example, your application can use the default value atoms to construct an effect description.</p>
<p>Parameter descriptions are stored in a <code>QTAtomContainer</code> structure, and an application retrieves an effect&#8217;s description by calling <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code>. This function takes a component instance and returns the parameter description for that component.</p>
<p>The code shown in Listing&#160;4-15 opens the component specified in the variable <code>subType</code>. The code sets up the component description, then finds and opens the requested component. It then calls the <code><a href="../../../../Reference/QTRef_ImageCodec/Reference/reference.html#//apple_ref/c/func/ImageCodecGetParameterList" target="_top">ImageCodecGetParameterList</a></code> function to fill out the parameter description for this effect.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_161" title="Listing 4-15Opening the image decompressor component"></a>
<p class="codesample"><strong>Listing 4-15&nbsp;&nbsp;</strong>Opening the image decompressor component</p>
<div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Set up a component description<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cd.componentType &#160;&#160;&#160;= 'imdc';&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Effects are image decompressor<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// components <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cd.componentSubType = subType;&#160;&#160;&#160;&#160;&#160;&#160;// This is the name of the effect<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//(e.g. 'smpt') <span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cd.componentManufacturer &#160;&#160;&#160;= 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cd.componentFlags &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;cd.componentFlagsMask &#160;&#160;&#160;&#160;&#160;&#160;= 0;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Find the required component. If it can't be found, generate an<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// error<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;if ((theComponent = FindNextComponent(theComponent, &#38;cd))==0)<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;{<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = paramErr;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;}<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Open the component<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;gCompInstance = OpenComponent(theComponent);<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;// Get the parameter description for the effect<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;ImageCodecGetParameterList(gCompInstance, &#38;parameterDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>An application can parse the returned parameter description using the standard QuickTime APIs that query <code>QTAtomContainer</code> data structures. This can be useful if you are writing an application that creates its own interface for users to customize effects.</p>
<p>This section describes the general format of the data returned in a parameter description.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_107" title="Component-Defined Functions"></a>
<h2><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-ComponentDefinedFunctions" title="Component-Defined Functions"></a>Component-Defined Functions</h2>
<p>This section defines the effect-specific functions that you may supply in your effect components. This section is only of interest to developers who are creating their own effects components; if you are writing an application that uses QuickTime video effects, you can skip this section.</p>
<p>The functions defined in this section are those called by the Component Manager through your component&#8217;s dispatch function (see <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-WhatEffectsComponentsDo">What Effects Components Do</a></span>).</p>
<p>These functions include</p>
<ul class="ul">
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectSetup">MyEffectSetup</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectBegin">MyEffectBegin</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectRenderFrame">MyEffectRenderFrame</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectCancel">MyEffectCancel</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetCodecInfo">MyEffectGetCodecInfo</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetParameterListHandle">MyEffectGetParameterListHandle</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetSpeed">MyEffectGetSpeed</a></span></p></li>
<li class="li"><p><span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectValidateParameters">MyEffectValidateParameters</a></span></p></li>
</ul>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_162" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
The interfaces to these functions are described assuming you are using Apple&#8217;s component dispatch helper code and the sample effect framework as described in <span class="content_text"><a href="5CreatingNewVideoEff.html#//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-TheSampleEffectComponent">The Sample Effect Component</a></span>. Apple strongly recommends that you re-use these code samples where possible when implementing your own effect components.  </p>
</div>
<p>If you are using the sample effect component, you can use the default implementations of several of these functions in most circumstances.</p>
<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_108" title="MyEffectSetup"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectSetup" title="MyEffectSetup"></a>MyEffectSetup</h3>
<p>The Component Manager calls this function when a sequence of frames is about to be rendered.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectSetup (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CodecDecompressParams *decompressParams);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>decompressParams</code></p></td>
<td ><p>Information about the sequence that is about to be decompressed.</p></td>
</tr>

</table></div>
<p>This function is called immediately before a client application such as MoviePlayer calls your component to render a sequence of frames.</p>
<p>Your component should examine the <code>capabilities</code> field of the <code>decompressParams</code> data structure to ensure that it can meet the requirements for executing this sequence. In particular, it should check the bit depth and pixel format requirements of the sequence. If the sequence requires a bit depth and pixel format combination that your component does not support, this function should return the nearest supported combination in the <code>decompressParams</code> -&#62; <code>capabilities</code> field. In this case, QuickTime will redirect all source and destination bitmaps through offscreen graphics worlds that have the bit depth and pixel format characteristics that you specify.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_109" title="MyEffectBegin"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectBegin" title="MyEffectBegin"></a>MyEffectBegin</h3>
<p>The Component Manager calls this function to request that your component prepare to render a single frame of its effect.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectBegin (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CodecDecompressParams *decompressParams,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectsFrameParamsPtr effect);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>decompressParams</code></p></td>
<td ><p>Information about the current sequence of frames.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>effect</code></p></td>
<td ><p>The parameters describing this frame.</p></td>
</tr>

</table></div>
<p>This function is called immediately before your <code>MyEffectRenderFrame</code> function. Your <code>MyEffectBegin</code> function should ensure that the information it holds about the current source and destination buffers and the parameter values for the effect are valid. If any of these have changed since the last call to <code>MyEffectBegin</code>, the new values should be read from the appropriate data structures.</p>
<p>This function is guaranteed to be called synchronously. In particular, this means you can allocate and move memory, and can call functions that allocate or move memory.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_110" title="MyEffectRenderFrame"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectRenderFrame" title="MyEffectRenderFrame"></a>MyEffectRenderFrame</h3>
<p>The Component Manager calls this function to request that your component render a single frame of its effect.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectRenderFrame (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectsFrameParamsPtr effect);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>effect</code></p></td>
<td ><p>The parameters describing this frame.</p></td>
</tr>

</table></div>
<p>This function is called by a client application when your effect component needs to render a single frame of your effect. This function contains the implementation of your effect.</p>
<div class="warningbox"><img src="../../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_163" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;
This function is <em>not</em> guaranteed to be called synchronously. This means your function implementation must not allocate or move memory, or call any function that allocates or moves memory, in response to this call.  </p><p>
</p><div class="clear"></div></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_111" title="MyEffectCancel"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectCancel" title="MyEffectCancel"></a>MyEffectCancel</h3>
<p>The Component Manager calls this function to stop processing of the current effect.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectCancel (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectsFrameParamsPtr effect);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>effect</code></p></td>
<td ><p>The parameters describing this frame.</p></td>
</tr>

</table></div>
<p>This function is called by a client application (which may be QuickTime) to halt the rendering of the current sequence of frames before the last frame has been rendered. If your component is running synchronously, it should simply return <code>noErr</code> ; no further calls to your <code>MyEffectRenderFrame</code> function will be made for this sequence.</p>
<p>If your component is running asynchronously, this function should dequeue all outstanding render frame requests, then return <code>noErr</code>.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_112" title="MyEffectGetCodecInfo"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetCodecInfo" title="MyEffectGetCodecInfo"></a>MyEffectGetCodecInfo</h3>
<p>The Component Manager calls this function to request information about the component.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectGetCodecInfo (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CodecInfo *info);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>info</code></p></td>
<td ><p>A pointer to the data structure that will contain the codec information.</p></td>
</tr>

</table></div>
<p>This function is called by a client application (which may be QuickTime) to request information about your effect component. Your function should fill out the <code><!--a target="_top" -->CodecInfo<!--/a--></code> data structure passed to it. You can use the <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/GetComponentResource" target="_top">GetComponentResource</a></code> function to retrieve a <code><!--a target="_top" -->'cdci'<!--/a--></code> resource that stores this information if you have provided one in your component.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p><code>noErr</code></p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>0</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>The function successfully filled out the info field.</p></th>
</tr>


<tr>
<td  scope="row"><p><code>paramErr</code></p></td>
<td ><p>-50</p></td>
<td ><p>Your function should return this value if the info parameter contains nil.</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_113" title="MyEffectGetParameterListHandle"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetParameterListHandle" title="MyEffectGetParameterListHandle"></a>MyEffectGetParameterListHandle</h3>
<p>The Component Manager calls this function to request a parameter description for this component.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectGetParameterListHandle (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Handle theHandle);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>theHandle</code></p></td>
<td ><p>A pointer to a handle that will contain the parameter description of this effect.</p></td>
</tr>

</table></div>
<p>This function is called by a client application (which may be QuickTime) to request a parameter description for your effect. This function can use the <code><a href="../../../../../Carbon/Reference/Component_Manager/Reference/reference.html#//apple_ref/c/func/GetComponentResource" target="_top">GetComponentResource</a></code> function to retrieve an<code>'atms'</code> resource that stores this information if you have provided one in your component.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_114" title="MyEffectGetSpeed"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectGetSpeed" title="MyEffectGetSpeed"></a>MyEffectGetSpeed</h3>
<p>The Component Manager calls this function to request information about the rendering speed of this effect component.</p>

<div class="codesample"><table><tr><td scope="row"><pre>long MyEffectGetSpeed (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;QTAtomContainer parameters,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Fixed *pFPS)<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>parameters</code></p></td>
<td ><p>The current parameter values for this effect.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>pFPS</code></p></td>
<td ><p>A pointer to a <code>Fixed</code> value that will contain the rendering speed of this effect on exit.</p></td>
</tr>

</table></div>
<p>This function is called by a client application (which may be QuickTime) to request information about the rendering speed of your effect. This function should return a <code>Fixed</code> value in FPS, which represents the rendering speed in frames-per-second of the effect.</p>
<p>If your effect can render in real time, it should return a value of <code>effectIsRealtime</code>. Otherwise, you should return an estimate of the number of frames your effect can render per second. Because rendering speeds are hardware-dependent, effect authors can choose to measure actual rendering speeds in this function. Alternatively, effect authors can choose to return a single value for all hardware configurations, estimating the value for a reference hardware platform.</p>
<p>Apple recommends that the values returned are rounded down to the nearest common frames-per-second value, such as 15, 24 or 30.</p>

<a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-DontLinkElementID_115" title="MyEffectValidateParameters"></a>
<h3><a name="//apple_ref/doc/uid/TP40000868-CreatingNewVideoEffects-MyEffectValidateParameters" title="MyEffectValidateParameters"></a>MyEffectValidateParameters</h3>
<p>If your effect implements this optional function, the Component Manager calls it whenever the user changes a parameter value in the standard parameter dialog box, or attempts to dismiss the dialog.</p>

<div class="codesample"><table><tr><td scope="row"><pre>ComponentResult MyEffectValidateParameters (<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;EffectGlobals *glob QTAtomContainer parameters,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;QTParameterValidationOptions validationFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;StringPtr errorString);<span></span></pre></td></tr></table></div>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Term</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th>
</tr>


<tr>
<td  scope="row"><p><code>glob</code></p></td>
<td ><p>A pointer to the effect's global data structure.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>parameters</code></p></td>
<td ><p>The current parameter values for this effect.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>validationFlags</code></p></td>
<td ><p>Flags that indicate whether a parameter value has changed or the user is dismissing the standard parameter dialog box.</p></td>
</tr>
<tr>
<td  scope="row"><p><code>errorString</code></p></td>
<td ><p>A <code>StringPtr</code> that is contains an error string explaining to the user why the validation has failed.</p></td>
</tr>

</table></div>
<p>This optional function is called by a client application (which may be QuickTime) when your effect&#8217;s standard parameter dialog box is being displayed. It can be called in two circumstances: if the user changes a parameter value in the dialog box; or if the user dismisses the dialog box by clicking OK.</p>
<p>The purpose of this function is to allow your effect to validate its parameters. The current parameter values are passed to the effect in <code>parameters</code>. If all of these values are valid, this function should return <code>noErr</code>. Otherwise, you should return a <code>paramErr</code> and put an explanatory message in the <code>errorString</code> parameter.</p>





        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../D-Chapter/4Built-inQuickTimeVi.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../F-Chapter/6VideoEffectsAPI.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/E-Chapter/5CreatingNewVideoEff.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/E-Chapter/5CreatingNewVideoEff.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/EffectsTransitions/Effects/E-Chapter/5CreatingNewVideoEff.html%3Fid%3DTP40000868-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>