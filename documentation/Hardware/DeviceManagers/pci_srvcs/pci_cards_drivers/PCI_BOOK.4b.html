<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Startup Sequence in the NewWorld Architecture</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.3a.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.4a.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.4c.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H1.Heading1"><A NAME="pgfId=3502"> </A><A NAME="14179"> </A>Startup Sequence in the NewWorld Architecture<A NAME="marker=3501"> </A></H1><P CLASS="T1.Text1"><A NAME="pgfId=3503"> </A>Here is a high-level view of the execution path taken when a NewWorld-based computer starts up.</P><OL><LI CLASS="N/.NList=1"><A NAME="pgfId=3504"> </A>The POST code runs (preliminary diagnostics, boot beep, initialization, and setup), with possible intervention in the mini nub, a small debugging tool. <A NAME="marker=3505"> </A></LI><LI CLASS="N.NList"><A NAME="pgfId=3506"> </A>Open Firmware initializes and begins execution, including building the device tree and the interrupt trees.<A NAME="marker=3507"> </A></LI><LI CLASS="N.NList"><A NAME="pgfId=3508"> </A>Open Firmware loads the Mac OS ROM file, based on defaults and NVRAM settings.</LI><LI CLASS="N.NList"><A NAME="pgfId=3509"> </A>Open Firmware executes the Forth script in the Mac OS ROM file, which contains instructions to read both the Trampoline code and the compressed Mac OS ROM image and place them into a temporary place in memory. <A NAME="marker=3510"> </A></LI><LI CLASS="N.NList"><A NAME="pgfId=3511"> </A>The Forth script transfers control to the Trampoline code, which functions as the transition between Open Firmware and the beginning of the Mac OS execution.</LI><LI CLASS="N.NList"><A NAME="pgfId=3512"> </A>The Trampoline code decompresses the Mac OS ROM image, gathers information about the system from Open Firmware, creates data structures based on this information, terminates Open Firmware, and rearranges the contents of memory to an interim location in physical memory space. <A NAME="marker=3513"> </A></LI><LI CLASS="N.NList"><A NAME="pgfId=3514"> </A>The Trampoline code transfers control to the <TT CLASS="cv">HardwareInit</TT> routine in the Mac OS ROM bootinfo file.</LI><LI CLASS="N.NList"><A NAME="pgfId=3515"> </A>The <TT CLASS="cv">HardwareInit</TT> routine copies data structures to their correct places in memory, and then calls the NanoKernel.</LI><LI CLASS="N.NList"><A NAME="pgfId=3516"> </A>The NanoKernel fills in its data structures and then calls the 68K emulator.</LI><LI CLASS="N.NList"><A NAME="pgfId=3517"> </A>The 68K emulator initializes itself, then transfers control to the startup initialization code.</LI><LI CLASS="N.NList"><A NAME="pgfId=3518"> </A>The startup initialization code begins execution, initializing data structures and managers, and booting the Mac OS.</LI></OL><P CLASS="T1.Text1"><A NAME="pgfId=3519"> </A>All functions found in the old Mac OS ROM are present in the NewWorld boot process, but occur at different times and places. To accomplish this, the code in the Mac OS ROM Image and POST is simplified, while the Trampoline code addresses the new functionality. <A NAME="marker=3520"> </A></P><H2 CLASS="H2.Heading2TOC"><A HREF="PCI_BOOK.4c.html#pgfId=3522" CLASS="Hypertext">What Is Different</A></H2><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.3a.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.4a.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.4c.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>