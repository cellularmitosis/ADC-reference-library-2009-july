<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Synchronizing QuickDraw and PostScript Printer Drivers (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING468></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-467.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-469.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-465.html"><B>Appendix B - Using Picture Comments for Printing</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING468-0></A>
<H1>Synchronizing QuickDraw and PostScript Printer Drivers</H1>
 <A NAME=MARKER-2-68></A>QuickDraw instructions such as those generated by the <CODE>Move</CODE>, <CODE>MoveTo</CODE>, <CODE>PenPat</CODE>, and <CODE>PenSize</CODE> routines change the state of the current graphics port without going through the standard low-level routines pointed to in the <CODE>QDProcs</CODE> record for the current graphics port. A printer driver takes these changes into account only at the time it executes an actual drawing instruction. The printer driver uses the routines specified in the <CODE>QDProcs</CODE> record at execution time and responds only to those instructions handled by the routines in the <CODE>QDProcs</CODE> record. Therefore, you should flush the state of the printing graphics port explicitly by calling any routine that goes through the <CODE>QDProcs.lineProc</CODE> field, as shown in <A HREF=#MARKER-9-69>Listing B-1</A>, before inserting code using picture comments for a PostScript driver. The use of the application-defined routine <CODE>MyFlushGrafPortState</CODE> shown here is further illustrated in <A HREF=QuickDraw-470.html#MARKER-9-158>Listing B-8 on page B-33</A>.<P>
<B>Listing B-1  <A NAME=MARKER-9-69></A>Synchronizing QuickDraw and the PostScript driver</B><P>
<PRE>
PROCEDURE MyFlushGrafPortState;
VAR
   penInfo: PenState;
BEGIN
   GetPenState(penInfo);   {save pen size}
   PenSize(0,0);           {make it invisible}
   MoveTo(-3200,-3200);    {move the pen way off the page in }
                           { case the printer driver draws a dot }
                           { even with a pen size of (0,0)}
   Line(0,0);              {go through QDProcs.lineProc}
                           {next, restore pen size}
   PenSize(penInfo.pnSize.h, penInfo.pnSize.v);  
END;
</PRE>
 A PostScript printer driver separates the PostScript code generated for text-drawing instructions (which usually involves font queries and, sometimes, font downloading) from the picture comments intended for PostScript devices. In certain cases, this results in apparently nonsequential execution of drawing instructions and may affect clipping regions or have side effects on the drawing operations you include in picture comments. To synchronize the sequence of QuickDraw routines with the generation of PostScript code, you need to flush the buffer maintained by the PostScript driver. You can do this by using the <CODE>PostScriptBegin</CODE> picture comment followed immediately by the <CODE>PostScriptEnd</CODE> picture comment. This causes all PostScript code, generated either by the application or by the printer driver, to be sent to the printer. <A HREF=#MARKER-9-70>Listing B-2</A> shows an application-defined procedure that does this. The use of the application-defined routine <CODE>MyFlushPostScriptState</CODE> shown here is further illustrated in <A HREF=QuickDraw-469.html#MARKER-9-117>Listing B-4 on page B-23</A>.<P>
<B>Listing B-2  <A NAME=MARKER-9-70></A>Flushing the buffer for a PostScript printer driver</B><P>
<PRE>
PROCEDURE MyFlushPostScriptState;
BEGIN
   PicComment(PostScriptBegin, 0, NIL);
   PicComment(PostScriptEnd, 0, NIL);
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-467.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-469.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
