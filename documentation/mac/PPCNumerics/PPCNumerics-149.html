<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Numerics Example Using PowerPC Assembly Language(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<A NAME="HEADING149"></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-148.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-150.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-144.html"><B>Part 3 - Numerics in PowerPC Assembly Language</B></A><BR><DD><A HREF="PPCNumerics-145.html"><B>Chapter 11 - Introduction to Assembly-Language Numerics</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING149-0"></A>
<H1>Numerics Example Using PowerPC Assembly Language</H1>
 <A HREF="#MARKER-9-35">Listing 11-1</A> is a code example that shows when the PowerPC assembly-language numeric features might be useful. The instructions used in this example are described in the Motorola <I>PowerPC 601 RISC Microprocessor User's Manual</I>. This example evaluates the polynomial<P>
 
<MATH>
x<SUP>3</SUP>+2x<SUP>2</SUP>+-5
</MATH>

<P>
 It illustrates the evaluation of a polynomial<P>
 
<MATH>
c<SUB>0</SUB>x<SUP>n</SUP>+c<SUB>1</SUB>x<SUP>n+-1</SUP>+...+c<SUB>n</SUB>
</MATH>

<P>
 using Horner's recurrence<P>
 <EM>
<MATH>
-- c<SUB>0</SUB>
</MATH>

</EM><P>
 <I>
<MATH>
-- (r&#215;x)+c<SUB>j</SUB> for j = 1ton
</MATH>

</I><P>
 On entry, general-purpose register GPR0 contains the degree <I>n</I> (&lt;256) of the polynomial, and floating-point register F1 points to a function argument <I>x</I>. The coefficient table consists of 
<MATH>
n+1
</MATH>

 double-format coefficients, starting with 
<MATH>
c<SUB>0</SUB>
</MATH>

. In this particular polynomial, 
<MATH>
n = 3, c<SUB>0</SUB> = 1, c<SUB>1</SUB>= 2, c<SUB>2</SUB> = 0, and c<SUB>3</SUB ="-5." ="/MATH">

.<P>
<B>Listing 11-1  <A NAME="MARKER-9-35"></A>Polynomial evaluation</B><P>
<PRE>
r0:   equ   0                 # general-purpose register 0
r5:   equ   5                 # general-purpose register 5
f0:   equ   0                 # floating-point register 0
f1:   equ   1                 # floating-point register 1
f2:   equ   2                 # floating-point register 2
CTR:  equ   9                 # Count Register for loops

extern   polyeval{DS}         # export the routine descriptor
extern   .polyeval            # export the entry point
# put the code in a program control section
csect    polyeval{PR}
 
#high-level languages prepend a period to function names
.polyeval:
   lwz      r0,0(r5)          # r0 = degree
   lfd      f0,4(r5)          # f0 = leading coefficient, c0
   addic    r5,r5,4           # r5 = address of leading coeff. &amp;c0
   mtspr    CTR,r0            # CTR = r0
loop:
   lfdu     f2,8(r5)          # f2 = next coefficient 
                              # update r5 = r5 + 8
   fmadd    f0,f0,f1,f2       # f0 = f0 * f1 + f2; ...
                              # res = res * x + c[j]
   bdnz     loop              # CTR = CTR - 1, branch if CTR <IMG BORDER="NONE" SRC="graphics/notequal.gif"> 0
   fmr      f1,f0             # f1 = f0
   blr                        # return through the Link Register
   nop
 
 
#
# Set up the table of contents.  It must include at least the 
# exported routines. It may also contain global data or pointers 
# to data.
#
polyeval_TOC:  tc    polyeval{tc}, polyeval{PR}
 
 
#
# Build a transition vector for all exported routines so they can 
# be accessed through an inter-TOC call.
#
 csect   polyeval{DS}      # it's in a separate control section
 dc.l    .polyeval         # contains the entry point
 dc.l    0                 # loader will fill in correct TOC 
                           # pointer
 dc.l    0                 # save space for environment pointer
</PRE>
 <P>
</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="PPCNumerics-148.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-150.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><BR>13 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
