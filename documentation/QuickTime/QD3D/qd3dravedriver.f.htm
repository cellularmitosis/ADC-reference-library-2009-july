<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Writing Private Draw Context Methods</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=50252"> </A>Writing Private Draw Context Methods</H1><P CLASS="T1.Text1"><A NAME="pgfId=47640"> </A><A NAME="marker=51462"> </A>Once you've written the public draw context methods supported by your drawing engine, you need to write several private draw context methods. In particular, you need to write a <TT CLASS="cv">TQADrawPrivateNew</TT> method to initialize a draw context and a <TT CLASS="cv">TQADrawPrivateDelete</TT> method to delete a draw context. The <TT CLASS="cv">TQADrawPrivateNew</TT> method is called whenever an application creates a new draw context by calling the <TT CLASS="cv">QADrawContextNew</TT> function. <A HREF="qd3dravedriver.f.htm#37138" CLASS="XRef">Listing&nbsp;11</A> illustrates a sample <TT CLASS="cv">TQADrawPrivateNew</TT> method.<A NAME="marker=51467"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=50825"> </A>Listing&nbsp;11<A NAME="37138"> </A>A <TT CLASS="cv">TQADrawPrivateNew</TT> method</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=64010"> </A>TQAError MyDrawPrivateNew (<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQADrawContext&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*drawContext,<BR>&nbsp;&nbsp;&nbsp;&nbsp;const TQADevice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*device,<BR>&nbsp;&nbsp;&nbsp;&nbsp;const TQARect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*rect,<BR>&nbsp;&nbsp;&nbsp;&nbsp;const TQAClip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*clip,<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flags)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyPrivateData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*myData;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Allocate a new MyPrivateData structure and store it in draw context.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;myData = MyDataNew(...);<BR>&nbsp;&nbsp;&nbsp;&nbsp;drawContext-&gt;drawPrivate = (TQADrawPrivate *) myData;<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (!myData) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (kQAOutOfMemory);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Set the method pointers of drawContext to point to our draw methods.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;newDrawContext-&gt;setFloat = MySetFloat;<BR>&nbsp;&nbsp;&nbsp;&nbsp;newDrawContext-&gt;setInt = MySetInt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;...<BR>&nbsp;&nbsp;&nbsp;&nbsp;return(kQANoErr);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=50830"> </A><A NAME="marker=64012"> </A>As you can see, the <TT CLASS="cv">MyDrawPrivateNew</TT> function defined in <A HREF="qd3dravedriver.f.htm#37138" CLASS="XRef">Listing&nbsp;11</A> allocates space for its private data, installs a pointer to that data in the <TT CLASS="cv">drawPrivate</TT> field of the draw context structure, and then installs pointers to all the public draw context methods supported by the drawing engine into the draw context structure.</P><P CLASS="T1.Text1"><A NAME="pgfId=50900"> </A>Your <TT CLASS="cv">TQADrawPrivateDelete</TT> method should simply undo any work done by your <TT CLASS="cv">TQADrawPrivateNew</TT> method. In this case, the delete method just needs to release the private storage allocated by the <TT CLASS="cv">TQADrawPrivateNew</TT> method. <A HREF="qd3dravedriver.f.htm#40383" CLASS="XRef">Listing&nbsp;12</A> shows a sample <TT CLASS="cv">TQADrawPrivateDelete</TT> method.<A NAME="marker=51468"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=50904"> </A>Listing&nbsp;12<A NAME="40383"> </A>A <TT CLASS="cv">TQADrawPrivateDelete</TT> method</P><CODE CLASS="Cv.Code"><A NAME="pgfId=64016"> </A>void MyDrawPrivateDelete (TQADrawPrivate *drawPrivate)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyDataDelete((MyPrivateData *) drawPrivate);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=50941"> </A><A NAME="marker=64018"> </A><A NAME="marker=51469"> </A>You register your private draw context methods with QuickDraw&nbsp;3D RAVE using another private method, the <TT CLASS="cv">TQAEngineGetMethod</TT> method. See <A HREF="qd3dravedriver.11.htm#16727" CLASS="XRef">&quot;Registering a Drawing Engine&quot;</A> for details.<A NAME="marker=51463"> </A></P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>