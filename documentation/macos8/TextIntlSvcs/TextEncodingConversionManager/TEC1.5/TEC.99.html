<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<script language="JavaScript" src="frametest.js"></script>
<TITLE> SetFallbackUnicodeToText </TITLE><LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a>
<!-- start of header -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of header --><A HREF="TEC.98.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.98.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.9a.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A><br>
<font face="Geneva,Helvetica,Arial" size="1"><b><br>
		PATH<spacer type="horizontal" size="5">&nbsp;</b></font><a href="../../../mac8.html"><font face="Geneva,Helvetica,Arial" size="1">Mac OS 8 and 9 Developer Documentation</a>  <b>&gt;</b> Text Encoding Conversion Manager<br>
		<img src="images/im_smblue.gif" width="116" height="8"><img src="images/space.gif" width="6" height="11">Programming With the Text Encoding Conversion Manager</font><br>
		<br>
		<hr>

</DIV>
<H1>
<A NAME="pgfId=13159">
 </A>
<A NAME="40155">
 </A>
SetFallbackUnicodeToText </H1>
<P>
<A NAME="pgfId=13160">
 </A>
Associates an application-defined fallback handler with a specific <TT>UnicodeToTextInfo</TT> Unicode converter object for a single text run to be used with either the function <A HREF="TEC.86.html" CLASS="XRef"><TT>ConvertFromUnicodeToText</TT></A> or <A HREF="TEC.94.html" CLASS="XRef"><TT>ConvertFromUnicodeToPString</TT></A>. </P>
<TT>
<A NAME="pgfId=27197">
 </A>
pascal OSStatus SetFallbackUnicodeToText (<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextInfo iUnicodeToTextInfo, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextFallbackUPP iFallback, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptionBits iControlFlags, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogicalAddress iInfoPtr);</TT>
<DL COMPACT>
<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=27201">
 </A>
<TT>iUnicodeToTextInfo</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=13169">
 </A>
 The Unicode converter object with which the fallback handler is to be associated. You use the function <A HREF="TEC.83.html" CLASS="XRef"><TT>CreateUnicodeToTextInfo</TT></A> or <A HREF="TEC.84.html" CLASS="XRef"><TT>CreateUnicodeToTextInfoByEncoding</TT></A> to obtain a Unicode converter object of this type.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=27212">
 </A>
<TT>iFallback</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=13173">
 </A>
A universal procedure pointer to the application-defined fallback routine. For a description of the function prototype that your fallback handler must adhere to, see <A HREF="TEC.77.html" CLASS="XRef"><TT>UnicodeToTextFallbackProcPtr</TT></A>
. For a description of how to create your own fallback handler, see <A HREF="TEC.9c.html" CLASS="XRef"><TT>MyUnicodeToTextFallbackProc</TT></A>. You should use the <TT>NewUnicodeToTextFallbackProc</TT> macro to convert a pointer to your fallback handler into a <TT>UnicodeToTextFallbackUPP</TT>. See the example in this function's discussion. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=27221">
 </A>
<TT>iControlFlags</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=13180">
 </A>
Control flags that stipulate which fallback handler the Unicode Converter should call--the application-defined fallback handler or the default handler--if a fallback handler is required, and the sequence in which the Unicode Converter should call the fallback handlers if either can be used when the other fails or is unavailable. Control flags can also specify whether the application-defined fallback handler can move memory. See <A HREF="TEC.6e.html" CLASS="XRef">
Fallback-Handler Control Flags</A>
.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=27230">
 </A>
<TT>iInfoPtr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=13184">
 </A>
The address of a block of memory to be passed to the application-defined fallback handler. The Unicode Converter passes this pointer to the application-defined fallback handler as the last parameter when it calls the fallback handler. Your application can use this memory block to store data required by your fallback handler whenever it is called. This is similar in use to a reference constant (refcon). If you don't need to use a memory block, specify <TT>NULL</TT> for this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=27239">
 </A>
<I CLASS="italics">
function result</I>
</DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=14471">
 </A>
A result code. See <A HREF="TEC.20.html" CLASS="XRef">
Text Encoding Conversion Manager Result Codes</A>
 in <A HREF="TEC.18.html" CLASS="XRef">
Basic Text Types Reference</A>
</DD><P>

</DL COMPACT>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=13186">
 </A>
DISCUSSION</H5>
<P>
<A NAME="pgfId=16470">
 </A>
You use this function to specify a fallback handler to be used for converting a Unicode text segment to another encoding when the Unicode Converter cannot convert the text using the mapping table specified by the Unicode converter object passed to the functions <A HREF="TEC.86.html" CLASS="XRef"><TT>ConvertFromUnicodeToText</TT></A>, <A HREF="TEC.8c.html" CLASS="XRef"><TT>ConvertFromUnicodeToTextRun</TT></A>, <TT><A HREF="TEC.94.html" CLASS="XRef"><TT>ConvertFromUnicodeToPString</TT></A></TT>, and <A HREF="TEC.8d.html" CLASS="XRef"><TT>ConvertFromUnicodeToScriptCodeRun</TT></A>. You can define multiple fallback handlers and associate them with different Unicode converter objects, depending on your requirements. <P>


<A NAME="pgfId=13192">
 </A>
The following example shows how to install an application-defined fallback handler. You can name your application-defined fallback handler anything you choose. The name, <TT>MyUnicodeToTextFallbackProc</TT>, used in this example is not significant. However, you must adhere to the parameters, the return type, and the calling convention as expressed in this example, which follows the prototype, because a pointer to this function must be of type <TT>UnicodeToTextFallbackProcPtr</TT> as defined in the <TT>UnicodeConverter.h</TT> header file. <P>


<A NAME="pgfId=13193">
 </A>
The <TT>UnicodeConverter.h</TT> header file also defines the <TT>UnicodeToTextFallbackUPP</TT> type and the <TT>NewUnicodeToTextFallbackProc</TT> macro. See <A HREF="TEC.9b.html" CLASS="XRef">
Application-Defined Function</A>
 for a description of the parameters of an application-defined fallback handler.<P>


<A NAME="pgfId=13197">
 </A>
<B>Listing&nbsp;4-1&nbsp;Installing an Application-Defined Fallback Handler</B></P>
<TT>
<A NAME="pgfId=27250">
 </A>
#include &lt;Types.h&gt;<BR>
#include &lt;Errors.h&gt;<BR>
#include &lt;MixedMode.h&gt;<BR>
#include &lt;TextCommon.h&gt;<BR>
#include &lt;UnicodeConverter.h&gt;<BR>
pascal OSStatus MyUnicodeToTextFallbackProc(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;UniChar *iSrcUniStr, ByteCount iSrcUniStrLen, ByteCount *oSrcConvLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;TextPtr oDestStr, ByteCount iDestStrLen,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oDestConvLen, LogicalAddress iInfoPtr,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ConstUnicodeMappingPtr iUnicodeMappingPtr) {<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</TT>
<TT>
<A NAME="pgfId=27254">
 </A>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* include your actual fallback handler implementation here */<BR>
}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
main () {<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;UnicodeMapping mapping;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextInfo unicodeToTextInfo;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;UnicodeToTextFallbackUPP fallbackProc;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;OSStatus status;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;mapping.unicodeEncoding =<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateTextEncoding(kTextEncodingUnicodeDefault,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kTextEncodingDefaultVariant, kUnicode16BitFormat);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;mapping.otherEncoding = <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CreateTextEncoding(kTextEncodingMacRoman,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kTextEncodingDefaultVariant, kTextEncodingDefaultFormat);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;mapping.mappingVersion = kUnicodeUseLatestMapping;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;status = CreateUnicodeToTextInfo(&amp;mapping, &amp;unicodeToTextInfo);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;fallbackProc =<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewUnicodeToTextFallbackProc(MyUnicodeToTextFallbackProc);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;status = SetFallbackUnicodeToText(unicodeToTextInfo, fallbackProc,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kUnicodeFallbackCustomFirst, NULL);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;status = ConvertFromUnicodeToText(unicodeToTextInfo,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<BR>
}</TT><P>
</DIV>
<HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 13 Dec 99)<P><A HREF="TEC.98.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.98.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.9a.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A>

<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY>
</HTML>
