<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Serial Driver(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING326></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-325.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-327.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-312.html"><B>Chapter 7 - Serial Driver</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING326-0></A>
<H1>Summary of the Serial Driver</H1>
<A NAME=HEADING326-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING326-2></A>
<H3>Constants</H3>
<PRE>
CONST
   {values for the transmission rate in the SerConfig parameter}
   baud300        = 380;         {300 baud}
   baud600        = 189;         {600 baud}
   baud1200       = 94;          {1200 baud}
   baud1800       = 62;          {1800 baud}
   baud2400       = 46;          {2400 baud}
   baud3600       = 30;          {3600 baud}
   baud4800       = 22;          {4800 baud}
   baud7200       = 14;          {7200 baud}
   baud9600       = 10;          {9600 baud}
   baud14400      = 6;           {14400 baud}
   baud19200      = 4;           {19200 baud}
   baud28800      = 2;           {28800 baud}
   baud38400      = 1;           {38400 baud}
   baud57600      = 0;           {57600 baud}
   {values for the number of stop bits in the SerConfig parameter}
   stop10         = 16384;       {1 stop bit}
   stop15         = -32768;      {1.5 stop bits}
   stop20         = -16384;      {2 stop bits}
   {values for the parity in the SerConfig parameter}
   noParity       = 0;           {no parity}
   oddParity      = 4096;        {odd parity}
   evenParity     = 12288;       {even parity}
   {values for the number of data bits in the SerConfig parameter}
   data5          = 0;           {5 data bits}
   data6          = 2048;        {6 data bits}
   data7          = 1024;        {7 data bits}
   data8          = 3072;        {8 data bits}
   {bit mask values to test for indicated errors}
   swOverrunErr   = 1;           {software overrun error}
   breakErr       = 8;           {break occurred}
   parityErr      = 16;          {parity error}
   hwOverrunErr   = 32;          {hardware overrun error}
   framingErr     = 64;          {framing error}
   {bit mask values for the evts field in the SerShk record}
   ctsEvent       = 32;          {CTS change}
   breakEvent     = 128;         {break status change}
   {bit mask value for the xOffHold field of the SerStaRec record}
   dtrNegated     = 64;          {DTR signal was negated}
   xOffWasSent    = 128;         {XOFF character was sent}
</PRE>
<A NAME=HEADING326-10></A>
<H3>Data Types</H3>
<PRE>
TYPE
   SerShk = 
   PACKED RECORD
      fXOn:    Byte;    {XON/XOFF output flow control flag}
      fCTS:    Byte;    {CTS output flow control flag}
      xOn:     Char;    {XON character}
      xOff:    Char;    {XOFF character}
      errs:    Byte;    {mask for errors that will terminate input}
      evts:    Byte;    {mask for status changes that cause events}
      fInX:    Byte;    {XON/XOFF input flow control flag}
      fDTR:    Byte;    {DTR input flow control flag (csCode 14 only)}
   END;
   SerStaRec =
   PACKED RECORD
      cumErrs:    Byte;    {cumulative errors}
      xOffSent:   Byte;    {XOFF sent as input flow control}
      rdPend:     Byte;    {read pending flag}
      wrPend:     Byte;    {write pending flag}
      ctsHold:    Byte;    {CTS flow control hold flag}
      xOffHold:   Byte;    {XOFF flow control hold flag}
   END;
</PRE>
<A NAME=HEADING326-13></A>
<H3>Routines</H3>
<PRE>
FUNCTION SerReset		(refNum: Integer; serConfig: Integer): OSErr;
FUNCTION SerSetBuf		(refNum: Integer; serBPtr: Ptr; 
				serBLen: Integer): OSErr;
FUNCTION SerHShake		(refNum: Integer; flags: SerShk): OSErr;
FUNCTION SerSetBrk		(refNum: Integer): OSErr;
FUNCTION SerClrBrk		(refNum: Integer): OSErr;
FUNCTION SerGetBuf		(refNum: Integer; VAR count: LongInt): OSErr;
FUNCTION SerStatus		(refNum: Integer; VAR serSta: SerStaRec): OSErr;
</PRE>
<A NAME=HEADING326-21></A>
<H2>C Summary</H2>
<A NAME=HEADING326-22></A>
<H3>Constants</H3>
<PRE>
enum {
   /*values for the transmission rate in the SerConfig parameter*/
   baud300        = 380,         /*300 baud*/
   baud600        = 189,         /*600 baud*/
   baud1200       = 94,          /*1200 baud*/
   baud1800       = 62,          /*1800 baud*/
   baud2400       = 46,          /*2400 baud*/
   baud3600       = 30,          /*3600 baud*/
   baud4800       = 22,          /*4800 baud*/
   baud7200       = 14,          /*7200 baud*/
   baud9600       = 10,          /*9600 baud*/
   baud14400      = 6,           /*14400 baud*/
   baud19200      = 4,           /*19200 baud*/
   baud28800      = 2,           /*28800 baud*/
   baud38400      = 1,           /*38400 baud*/
   baud57600      = 0,           /*57600 baud*/
   /*values for the number of stop bits in the SerConfig parameter*/
   stop10         = 16384,       /*1 stop bit*/
   stop15         = -32768,      /*1.5 stop bits*/
   stop20         = -16384,      /*2 stop bits*/
   /*values for the parity in the SerConfig parameter*/
   noParity       = 0,           /*no parity*/
   oddParity      = 4096,        /*odd parity*/
   evenParity     = 12288,       /*even parity*/
   /*values for the number of data bits in the SerConfig parameter*/
   data5          = 0,           /*5 data bits*/
   data6          = 2048,        /*6 data bits*/
   data7          = 1024,        /*7 data bits*/
   data8          = 3072,        /*8 data bits*/
   /*bit mask values to test for indicated errors*/
   swOverrunErr   = 1,           /*software overrun error*/
   breakErr       = 8,           /*break occurred*/
   parityErr      = 16,          /*parity error*/
   hwOverrunErr   = 32,          /*hardware overrun error*/
   framingErr     = 64,          /*framing error*/
   /*bit mask values for the evts field in the SerShk record*/
   ctsEvent       = 32,          /*CTS change*/
   breakEvent     = 128,         /*break status change*/
   /*bit mask value for the xOffHold field of the SerStaRec record*/
   dtrNegated     = 64,          /*DTR signal was negated*/
   xOffWasSent    = 128          /*XOFF character was sent*/
};
</PRE>
<A NAME=HEADING326-30></A>
<H3>Data Types</H3>
<PRE>
struct SerShk {
   char           fXOn;    /*XON/XOFF output flow control flag*/
   char           fCTS;    /*CTS output flow control flag*/
   unsigned char  xOn;     /*XON character*/
   unsigned char  xOff;    /*XOFF character*/
   char           errs;    /*mask for errors that will terminate input*/
   char           evts;    /*mask for status changes that cause events*/
   char           fInX;    /*XON/XOFF input flow control flag*/
   char           fDTR;    /*DTR input flow control flag (csCode 14 only)*/
};
typedef struct SerShk SerShk;
struct SerStaRec {
   char     cumErrs;       /*cumulative errors*/
   char     xOffSent;      /*XOFF sent as input flow control*/
   char     rdPend;        /*read pending flag*/
   char     wrPend;        /*write pending flag*/
   char     ctsHold;       /*CTS flow control hold flag*/
   char     xOffHold;      /*XOFF flow control hold flag*/
};
typedef struct SerStaRec SerStaRec;
</PRE>
<A NAME=HEADING326-33></A>
<H3>Functions</H3>
<PRE>
pascal OSErr SerReset		(short refNum, short serConfig);
pascal OSErr SerSetBuf		(short refNum, Ptr serBPtr, short serBLen);
pascal OSErr SerHShake		(short refNum, const SerShk *flags);
pascal OSErr SerSetBrk		(short refNum);
pascal OSErr SerClrBrk		(short refNum);
pascal OSErr SerGetBuf		(short refNum, long *count);
pascal OSErr SerStatus		(short refNum, SerStaRec *serSta);
</PRE>
<A NAME=HEADING326-41></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING326-42></A>
<H3>Data Structures</H3>
<A NAME=HEADING326-43></A>
<H4>Serial Handshake Record
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>0<TH>fXOn<TH>byte<TH>XON/XOFF output flow control flag<TR>
<TD>1<TD>fCTS<TD>byte<TD>CTS output flow control flag<TR>
<TD>2<TD>xOn<TD>byte<TD>XOn character<TR>
<TD>3<TD>xOff<TD>byte<TD>XOff character<TR>
<TD>4<TD>errs<TD>byte<TD>mask for errors that will terminate input<TR>
<TD><B>X</B><TD>evts<TD>byte<TD>mask for status changes that cause events<TR>
<TD>6<TD>fInX<TD>byte<TD>XON/XOFF input flow control flag<TR>
<TD>7<TD>fDTR<TD>byte<TD>DTR input flow control flag (<CODE>csCode</CODE> 14 only)</TABLE>
 </H4>
<A NAME=HEADING326-44></A>
<H4>Serial Status Record
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>0<TH>cumErrs<TH>byte<TH>cumulative errors<TR>
<TD>1<TD>xOffSent<TD>byte<TD>XOFF sent as input flow control<TR>
<TD>2<TD>rdPend<TD>byte<TD>read pending flag<TR>
<TD>3<TD>wrPend<TD>byte<TD>write pending flag<TR>
<TD>4<TD>ctsHold<TD>byte<TD>CTS flow control hold flag<TR>
<TD><B>X</B><TD>xOffHold<TD>byte<TD>XOFF flow control hold flag</TABLE>
 </H4>
<A NAME=HEADING326-45></A>
<H3>Device Manager Interface</H3>
<A NAME=HEADING326-46></A>
<H4>Status Routines
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Code<TH>Parameters<TH>Function<TR>
<TD>2<TD>long<TD>Return the number of bytes currently in the input data buffer (<CODE>SerGetBuf</CODE>).<TR>
<TD>8<TD>6 bytes<TD>Return status information (<CODE>SerStatus</CODE>).<TR>
<TD>9<TD>word<TD>Return driver version number.</TABLE>
</H4>
<A NAME=HEADING326-47></A>
<H4>Control Routines
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Code<TH>Parameters<TH>Function<TR>
<TD>8<TD>word<TD>Set data rate and character frame (SerReset).<TR>
<TD>9<TD>long, word<TD>Specify either a new input buffer or the default buffer (SerSetBuf).<TR>
<TD>10<TD>8 bytes<TD>Set software handshaking and other control information (SerHShake).<TR>
<TD>11<TD>&nbsp;<TD>Deassert the break signal (SerClrBrk).<TR>
<TD>12<TD>&nbsp;<TD>Assert the break signal (SerSetBrk).<TR>
<TD>13<TD>word<TD>Set baud rate.<TR>
<TD>14<TD><CODE>8 bytes</CODE><TD>Equivalent to control code 10, plus DTR handshaking.<TR>
<TD>16<TD>byte<TD>Set miscellaneous control options.<TR>
<TD>17<TD>&nbsp;<TD>Assert DTR.<TR>
<TD>18<TD>&nbsp;<TD>Negate DTR.<TR>
<TD>19<TD>byte<TD>Simple parity error replacement.<TR>
<TD>20<TD>2 bytes<TD>Extended parity error replacement.<TR>
<TD>21<TD>&nbsp;<TD>Set XOFF state.<TR>
<TD>22<TD>&nbsp;<TD>Clear XOFF state.<TR>
<TD>23<TD>&nbsp;<TD>Send XON for input flow control if XOFF was sent last.<TR>
<TD>24<TD>&nbsp;<TD>Unconditionally send XON for input flow control.<TR>
<TD>25<TD>&nbsp;<TD>Send XOFF for input flow control if XON was sent last.<TR>
<TD>26<TD>&nbsp;<TD>Unconditionally send XOFF for input flow control.<TR>
<TD>27<TD>&nbsp;<TD>Reset serial hardware channel.</TABLE>
</H4>
<A NAME=HEADING326-48></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD><CODE>noErr</CODE><TD>0<TD>No error<TR>
<TD>openErr<TD>-23<TD>Unable to open device driver<TR>
<TD>portInUse<TD>-97<TD>Port is in use<TR>
<TD>portNotCf<TD>-98<TD>Port is not configured</TABLE>
</H2>
</BLOCKQUOTE><P>

<HR>
<center>
<A HREF="Devices-325.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-327.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
