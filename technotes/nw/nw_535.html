<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW535: Datagram Delivery Protocol Q&amp;As</title> <meta name="keywords" content=""><meta name="Description" content="Technical Note NW535: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002577" title="Datagram Delivery Protocol Q&As"></a><a name="top"></a>                                     <!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW535</div>
<div id="pageheadsub">Datagram Delivery Protocol Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext">					<a href="#Section1">Datagram Delivery Protocol (DDP) header checksum field</a><BR><BR>					<a href="#Section2">ZIP Query packet zero checksum value</a><BR><BR>					<a href="#Section3">How to write a DDP read with completion routine</a><BR><BR>					<a href="#Section4">Communication between players in a game on an AT network</a><BR><BR>					 <a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic  - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>Datagram Delivery Protocol (DDP) header checksum field</h2><p>Date Written:  4/2/91</p><p>Last reviewed:  6/14/93</p><p>Does the Macintosh client pay attention to and validate Datagram DeliveryProtocol (DDP) checksums within long DDP packets received?</p><p>DDP is a client of the AppleTalk Transaction Protocol (ATP), which is a clientof the AppleTalk Session Protocol (ASP) and AppleTalk Filing Protocol (AFP).DDP is told by the entity for whom it is a client whether it should usechecksumming. For performance reasons, our version of ATP does not specify thatDDP use the checksum. Both AppleShare and the AppleShare client are out of theloop; neither can specify whether or not to use the DDP checksum. </p><p>The LAP layer performs checksumming, ensuring no on-the-wire corruption. Theonly benefit of DDP checksumming is end-to-end corruption detection when thepacket has travelled over a malicious router that has validly received a DDPpacket on one net, changed the packet, re-computed the LAP checksum, and sentit out on another cable. Because of the performance hit of DDP checksumming andthe rarity of such a malicious router, it was decided not to request DDPchecksumming.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>ZIP Query packet zero checksum value</h2><p>Date Written:  3/3/92</p><p>Last reviewed:  6/14/93</p><p>Is a zero checksum value indicative of no checksum provided with the ZoneInformation Protocol (ZIP) packet?</p><p>True, a zero checksum in any DDP packet with an extended header (including ZIPpackets) indicates that a checksum was not performed. See <i>InsideAppleTalk,</i> 2nd Ed. pages 4-17.</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>How to write a DDP read with completion routine</h2><p>Date Written:  2/28/92</p><p>Last reviewed:  2/28/92</p><p>The PWriteDDP call is nothing like a <code>PReadDDP</code> call. We want to do an AppleTalkDatagram Delivery Protocol (DDP) read with a completion routine (to wait for anecho reply), but with only the old style call, this is impossible. Is acompletion routine for <code>DDPRead</code> possible?</p><p>Because of the <code>ABRecord</code> structure handling implemented in the <code>DDPRead</code> call, anasynchronous version of this call was not possible.  <code>DDPRead</code> implements MemoryManager calls. As a result, no preferred style of call was implemented for<code>DDPRead</code>. The alternative is to alter your process to use the <code>POpenSkt</code> callinstead. As part of the <code>POpenSkt</code> function, you'll need to define a socketlistener.  A sample socket listener can be found in the Technote <A HREF = "nw_14.html">"AppleTalkTimers Explained"</a> (it's written in MPW assembly code). In addition, a sampleprogram called DMZ, on the System 7 Golden Master CD, uses that echo socketlistener code fragment.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>Communication between players in a game on an AT network</h2><p>Date Written:  12/18/90</p><p>Last reviewed:  2/1/91</p><p>How can I use the broadcast mode in an AppleTalk DataGram Delivery Protocol(DDP) layer to communicate with the other players of a game that is on anetwork and not interfere with other network users?</p><p>The broadcast mode may seem like a solution, but Apple doesn't recommend usingbroadcast mode. Applications like games generally end up sending LOTS of updatepackets to other players of the games. If your program broadcasts thosepackets, then all nodes on your network will be interrupted for every packetsent and that can cause performance problems on every machine on a network. InApple supplied software, broadcast mode is only used when packets need to besent to every node on a network. For example, Name Binding Protocol (NBP)Lookup packets are broadcast because the network address is unknown.</p><p>The following suggestions should help implement communications betweenplayers.</p><p>The DDP protocol layer does not guarantee delivery of packets (thedisadvantage), but has very little overhead (the advantage). If you requiredelivery of all packets and can take a small additional performance hit, youshould use the AppleTalk Transaction Protocol (ATP) layer.</p><p>The DDP type you use must be in the range of $10-$FF. The DDP type you chooseto use (in that range) probably won't make a lot of difference unless youdefine multiple clients to DDP within your socket listener. Packets addressedto your socket will get sent to your socket listener. How you use the type isup to you (as long as you stay out of the reserved range).</p><p>You should open a dynamic socket (i.e., use 0 for the socket number and use thesocket number in the range $80-$FE that is returned) with the <code>OpenSocket</code> calland then register a name on the network for that socket with the <code>RegisterName</code>call. If all copies of the game register with the same NBP type, then you canuse the <code>LookupName</code> call to find other players on the network. Once you've foundother players and decided who you're going to play against, you just addresseach DDP packet to the internet address(es) of the other player(s) socket(s).Several multi-player network games I've seen on the Macintosh do just that.(Hint: If you limit games to players on a single network, DDP will use shortheader packets which are slightly faster to send (8 bytes less per packet).)</p><p>If you build a table (array) of network addresses from those playing a game,you can use this algorithm to send a packet to each player.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>BEGIN  { put data into buffer for DDP and set the common parameter block fields: }  { Async Flag, Command, Checksum Flag, Source Socket, DDP Type, BDS Pointer }  { and Destination Network (if limiting play to a single network). }  buildPacket;  FOR Player := 1 to NumberOfPlayers DO    BEGIN      { Set the Destination Node and Destination Socket fields of the }      { parameter block to the network address of a player.  That address }      { would be in an array of network addresses (one for each player). }      setAddress(Player);      { Send the datagram to a player using SendDatagram call. }      doSendDatagram;    END;</pre>	</TD></TR></TABLE></CENTER><BR><br><br>                                     <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_535.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_535.html%3Fid%3DDTS10002577-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_535.html%3Fid%3DDTS10002577-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_535.html%3Fid%3DDTS10002577-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>