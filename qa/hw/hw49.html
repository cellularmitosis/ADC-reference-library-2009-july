<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A HW49: Detecting specific ROM-in-RAM Mac</title>   <meta name="keywords" content="Mac OS 8 detecting Rom-in-Ram feature Name Registry"><meta name="Description" content="Technical Q&amp;A HW49: Q&amp;A explains how to query the Mac machineto get it's particular name but warns against using thisto determine if the machine has a particular feature andpresents a way to do this including sample code for use indetermining if a machine has a particular feature."><meta name="categories" content="Hardware"><meta name="week-posted" content="Oct 4, 1999 - Oct 8, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001321" title="Detecting specific ROM-in-RAM Mac"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/HardwareDrivers/index.html">Hardware & Drivers</a> &gt; <a href="../../technicalqas/HardwareDrivers/idxAppleHardware-date.html">Apple Hardware</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxAppleHardware-date.html" target="_blank">Hardware & Drivers > Apple Hardware</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A HW49</div>
<div id="pageheadsub">Detecting specific ROM-in-RAM Mac</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->			<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center>                  <P id=p2><B>Q:</B> All ROM-in-RAM (New World) Macs                  return 406 (decimal) as their machine ID from                  <CODE>Gestalt</CODE>. How do I determine which Mac                  my software is running on in this case?</p>                                                    <P id=p4><B>A:</B> You will have to query the Name                  Registry to get this information.</P>                                       <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>Do not attempt to infer if a                  feature exists by checking the machine ID. Use the                  Name Registry or <CODE>Gestalt</CODE> to determine                  if a specific feature exists. If checking the                  machine ID is the only way to determine if a                  specific feature exists, <a href="http://developer.apple.com/bugreporter/" target="_blank">file a bug report with                  us</A> so that we can fix                  that.</P></TD></TR></TABLE></CENTER><BR>                                                <P id=p4>You can get the Mac's non-localized                  name from the <CODE>compatible</CODE> property. The                  value is an array of C-style strings, and the name                  is the first entry of the property's value.                  The <CODE>compatible</CODE> property is found at                  the path "Devices:device-tree". For the                  1999 Power Macintosh G3 this value is                  "PowerMac1,1". For the iMac this value is                  "iMac,1".</P>                                          <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>This string is not meant to be shown                  to the user. It is not localized. Do not show this                  string to the user.</P></TD></TR></TABLE></CENTER><BR>                                                                <P id=p4>Because these strings are not localized,                  you can easily test them; just don't show them                  to the user.</P>                                                                      <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Currently, all iMacs have the same                  compatible property value: "iMac,1".</P>                  </TD></TR></TABLE></CENTER><BR>                                              <P id=p4>To tell the difference between the                  original iMac with the Rage II video chip and the                  second revision of the iMac with the Rage Pro video                  chip, you can look for a Name Registry node of                  "Devices:device-tree:pci:ATY,RageIIC_C"                  or                  "Devices:device-tree:pci:ATY,RagePro_C",                  respectively. You can also search for a node with a                  <CODE>name</CODE> property of                  "ATY,RageIIC_C" or                  "ATY,RagePro_C", respectively. Either                  method will work with equal effectiveness.</P>                                    <P id=p4>To tell the difference between the 233MHz                  iMac with a Rage Pro video chip and the 266MHz iMac                  (which also has a Rage Pro video chip), you will                  need to check the <CODE>clock-frequency</CODE>                  property in the CPU node. The best way to do this                  is to search for a node with a                  <CODE>device_type</CODE> property with the value of                  "cpu\0" (the null terminator of the C                  string needs to be passed; it is part of the                  property's value). Once you have found the                  node with the CPU value, you can get the value of                  the <CODE>clock-frequency</CODE> property which is                  in the same node. You cannot just search for                  "clock-frequency" because there are many                  "clock-frequency" entries in the Name                  Registry and you are not guaranteed that the                  "clock-frequency" value you get is the                  one from the CPU node.</P>                                              <P id=p4>Important: I hope that the above serves to                  show how strongly we suggest that you <B>do not</B>                  try to identify specific Macs. Instead you should                  look for specific features (via                  <CODE>Gestalt</CODE>, or some other means) that you                  need, such as FireWire or USB, rather than assuming                  that they are present based solely on the model of                  the computer.</P>                                    <P id=p4>You should always check for what you want,                  rather than assume a specific machine always has                  the feature you want. If you believe that you                  cannot check for a specific feature and are                  therefore relying on the machine ID, please                   <a href="http://developer.apple.com/bugreporter/" target="_blank">file a bug with us</A> so that we                  can have a selector added.</P>                            <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>/* GetMacName returns a Pascal-formatted string with the model property string. * Input  macName - pointer to a buffer where the model property name *                  will be returned, if the call succeeds * * Output function result - noErr indicates that the model name was *                          read successfully *        macName - will contain the model name property if noErr * * Notes: *    Caller is responsible for disposing of macName. Use DisposePtr. */OSStatus GetMacName (StringPtr * macName) {    OSStatus                err             = noErr;    RegEntryID              compatibleEntry;    RegPropertyValueSize    length;    RegCStrEntryNamePtr     compatibleValue;    if (macName != nil) {        *macName = 0;        err = RegistryEntryIDInit (&amp;compatibleEntry);        if (err == noErr) {            err = RegistryCStrEntryLookup (nil, "Devices:device-tree",                &amp;compatibleEntry);        }        if (err == noErr) {            err = RegistryPropertyGetSize (&amp;compatibleEntry,                "compatible", &amp;length);        }        if (err == noErr) {            compatibleValue = (RegCStrEntryNamePtr)NewPtr (length);            err = MemError ();        }        if (err == noErr) {            err = RegistryPropertyGet (&amp;compatibleEntry,                "compatible", compatibleValue,            &amp;length);        }        if (err == noErr) {            SetPtrSize (compatibleValue, strlen (compatibleValue) + 1);            /* SetPtrSize shouldn't fail because we are shrinking the pointer,            but make sure. */            err = MemError ();        }        if (err == noErr) {            *macName = c2pstr (compatibleValue);        }        (void)RegistryEntryIDDispose (&amp;compatibleEntry);    }    return err;}/* GetMacSpeed returns the clock-frequency property of the CPU * Output function result - noErr indicates that the CPU clock-frequency *                    property was read successfully *        cpuFreq   - will contain the clock-frequency property if noErr *                    set to 0 if the clock-frequency could not be read*/OSStatus GetMacSpeed (UInt32 * cpuFreq) {    OSStatus                err             = noErr;    RegEntryID              cpuEntry;    RegEntryIter            cookie          = nil;    RegEntryIterationOp     iterOp          = kRegIterDescendants;    unsigned long           cpuSpeedSize    = sizeof (unsigned long);    char *                  cpuValue        = "cpu";    Boolean                 done;    if (cpuFreq != nil) {        *cpuFreq = 0;    } else {        cpuSpeedSize = 0;    }    if (err == noErr) {        err = RegistryEntryIDInit (&amp;cpuEntry);    }    if (err == noErr) {        err = RegistryEntryIterateCreate (&amp;cookie);    }    if (err == noErr) {        err = RegistryEntrySearch (&amp;cookie, iterOp,            &amp;cpuEntry, &amp;done, "device_type",             cpuValue, strlen (cpuValue) + 1);        if (done != true &amp;&amp; err == noErr) {            (void)RegistryPropertyGet (&amp;cpuEntry,                "clock-frequency", cpuFreq, &amp;cpuSpeedSize);        }    }    (void)RegistryEntryIDDispose (&amp;cpuEntry);    (void)RegistryEntryIterateDispose (&amp;cookie);    return err;}</pre>	</TD></TR></TABLE></CENTER>		                           <P id=p4>This is some sample code that shows how to query         the Name Registry for the name and clock frequency         values.</P>          </td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Oct 05 1999]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/hw/hw49.html%3Fid%3DDTS10001321-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/hw/hw49.html%3Fid%3DDTS10001321-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/hw/hw49.html%3Fid%3DDTS10001321-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>