<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>ATSUI Programming Guide: ATSUI Style and Text Layout Objects</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="ATSUI Style and Text Layout Objects"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000029" title="ATSUI Style and Text Layout Objects"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../atsui_chap1/atsui_intro.html#//apple_ref/doc/uid/TP30000027-TP1">ATSUI Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap2/atsui_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap4/atsui_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000029-TP1" title="ATSUI Style and Text Layout Objects"></a><h1>ATSUI Style and Text Layout Objects</h1><p>This chapter describes the objects that ATSUI uses for text layout and style information: text layout objects and style objects. A <strong>text layout object</strong> contains the information that controls the display and formatting of the text associated with the text layout object. A <strong>style object</strong> contains a collection of stylistic attributes that can be applied to text runs within the text associated with a text layout object.</p><p>Any ATSUI function that sets or retrieves stylistic or layout information uses text layout and style objects, which is why you should read this chapter if you plan to call ATSUI functions in your code. This chapter</p><ul class="ul"><li class="li"><p>describes the information contained in style and text layout objects</p></li><li class="li"><p>provides a description of the ATSUI tags you use to specify style attributes and control text layout</p></li><li class="li"><p>provides illustrations to show how settings effect the way ATSUI renders text </p></li></ul><p>To understand this chapter, you should first read <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TP1">“Typography Concepts.”</a></span></p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF175">Style Objects</a>
				
			<br/>
			
        
			
			
				<a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF157">Text Layout Objects</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000029-TPXREF175" title="Style Objects"></a><h2>Style Objects</h2><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_606"></a><p>ATSUI style objects<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_607"></a> are opaque objects that represent a collection of stylistic attributes. A style object can represent one or more attributes, including information about the following:</p><ul class="ul"><li class="li"><p>Style attributes. You can set attributes such as font, size, color, and directionality, and you can override font-specified default behavior governing how glyphs in a style run are displayed and formatted, including such behavior as kerning and optical alignment.</p></li><li class="li"><p>Font features. You can select or deselect font features (ligatures, swashes, and so forth) to specify whether to employ, and at what level, various special typographic and layout features provided by the font for a particular style run.</p></li><li class="li"><p>Font variations. You can manipulate the font variation axes and values of the font used in a style run to get different stylistic variations built into the font that are available for drawing text. </p></li></ul><p>In ATSUI, a style object is created by calling the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCreateStyle" target="_top">ATSUCreateStyle</a></code> with an <code>ATSUStyle</code> data structure as a parameter. Because style objects are opaque, you must use ATSUI accessor functions to get or set style attributes, font features, font variations, and other information associated with a style object. You’ll see how to use those functions in <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TP1">“Basic Tasks: Working With Objects and Drawing Text.”</a></span> </p><p>Once a style object has been defined, it can be applied to a run<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_608"></a> of text. A <strong>style run</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_609"></a> is a sequence of contiguous characters in memory that share the same style attributes, font features, and font variations. The same style object can be used by more than one style run in one or more text layout objects. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_11" title="Note"></a><p><strong>Note:</strong>&nbsp;ATSUI style objects are thread-safe; you can share them between threads.</p></div><p>The specific style attributes, font variations, and font features that you can manipulate using ATSUI are discussed in the sections that follow.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF176" title="Style Attributes"></a><h3>Style Attributes</h3><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_610"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_611"></a><p>Style attributes<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_612"></a> are a collection of values and settings that override the font-specified behavior for displaying and formatting text in a style run. For example, a text color of red is a style attribute that overrides the default text color of black. </p><p>ATSUI uses a triple to specify an attribute. A <strong>triple</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_613"></a> is an attribute tag, a value for that tag, and the size of the value. Attribute tags are constants. ATSUI provides tags for most style attributes. For example, the ATSUI  tag for text color is <code>kATSURGBAlphaColorTag</code>. Its tag for font size is <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/c/econst/kATSUSizeTag" target="_top">kATSUSizeTag</a></code>. The triples associated with each of these tags are shown in <span class="content_text">Figure 2-1</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF244" title="Figure 2-1Triples for text color and font size style attributes"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>Triples for text color and font size style attributes</p><img src = "../art/triples.gif" alt = "Triples for text color and font size style attributes" width="343" height="46"></div><br/><p>As you can see in <span class="content_text">Figure 2-1</span>, color is specified by data of type <code>ATSURGBAlphaColor</code>, so the size is <code>sizeof(ATSURGBAlphaColor)</code>. The value in the figure is the default color value, which specifies black with an alpha-channel (translucency) setting of 1—<code>(0, 0, 0, 1)</code>. Size is specified by a <code>Fixed</code> value. In this example, the value <code>12.0</code> specifies 12-point size.</p><p>This section discusses most of the style attributes for which ATSUI provides tags. It describes a style attribute, the default setting for the attribute, and in many cases shows the effect of applying the attribute to text. See <em>Inside Mac OS X: ATSUI Reference</em> for a complete reference of the style attribute tags provided by ATSUI. </p><p>You can create a custom attribute tag for a style attribute for which ATSUI does not provide a tag. For more information, see <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-BBCEEIHA">“Custom Attribute Tags.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF298" title="Ascent Attribute Tag"></a><h4>Ascent Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_614"></a><p>The ascent<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_615"></a> attribute tag represents the ascent associated with a style object’s font. You can obtain the ascent value by using the following style attribute tag: </p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUAscentTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_616"></a></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code>; the value must be >= 0.</dd><dt>Default value: </dt><dd>The ascent value of the style’s font with the current point size.</dd><dt>Comment: </dt><dd>This tag is available starting with Mac OS X version 10.2.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF190" title="Baseline Attribute Tag"></a><h4>Baseline Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_617"></a><p>The baseline<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_618"></a> attribute type represents the preferred baseline (such as Roman, hanging, or ideographic-centered) to use for text of a given font in a style run. You can set and retrieve the baseline type value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUBaselineClassTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_619"></a></dd><dt>Data type:</dt><dd><code>BslnBaselineClass</code> (defined in <code>SFNTLayoutTypes.h</code>)</dd><dt>Default value:</dt><dd><code>kATSURomanBaseline</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_620"></a></dd><dt>Comment:</dt><dd> If you want to use the intrinsic baselines, set the value of this tag to <code>kBSLNNoBaselineOverride</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_621"></a>.</dd></dl><p class="clear"></p><p>See <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-CJBBEGGF">Figure 1-8</a></span> for illustrations of baselines. For an example of how to apply a baseline attribute tag to a style, see <span class="content_text"><a href="../atsui_chap6/atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF141">“Setting a Baseline.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF193" title="Caret Angle Attribute Tag"></a><h4>Caret Angle Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_622"></a><p>The caret angle<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_623"></a> attribute tag specifies whether the text caret or edges of a highlighted area are always parallel to the slant of the style run’s text or always perpendicular to the baseline. You can set and retrieve the value of the caret angle using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUNoCaretAngleTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_624"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment:</dt><dd>The default setting is to use the character’s angularity to determine caret angle and the edges of a highlighted area.</dd></dl><p class="clear"></p><p>For example, when the caret appears in italic text or text that has an intrinsic angle, you may want to display an angled<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_625"></a> (slanted) caret rather than a straight one. ATSUI supports this capability by using data present in a font that identifies the intrinsic font angle. <span class="content_text">Figure 2-2</span> shows the position of straight (top line) and angled (bottom line) carets.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BBCJCGBH" title="Figure 2-2Straight and angled caret positions"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>Straight and angled caret positions</p><img src = "../art/carets.gif" alt = "Straight and angled caret positions" width="172" height="117"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF194" title="Cross-Stream Kerning Attribute Tag "></a><h4>Cross-Stream Kerning Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_626"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_627"></a><p><strong>Cross-stream kerning</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_628"></a> is the movement of glyphs (as specified by the font) perpendicular to the line orientation of the text. (For horizontal text, the automatic movement is vertical.) Cross-stream kerning is required for such scripts as Taliq (used in Urdu). It can also be used to assist in the creation of automatic fractions<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_629"></a>. You can set and retrieve the cross-stream kerning value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUSuppressCrossKerningTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_630"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment: </dt><dd>The default setting specifies not to suppress automatic cross-kerning (defined by the font).</dd></dl><p class="clear"></p><p><span class="content_text">Figure 2-3</span> shows how cross-stream kerning raises the minus sign between two uppercase glyphs to reflect the centers of those characters. The text on the left does not use cross-stream kerning whereas the text on the right does.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BAJCCDFD" title="Figure 2-3Cross-stream kerning applied to a minus sign in an equation"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>Cross-stream kerning applied to a minus sign in an equation</p><img src = "../art/crossstreamkerning.gif" alt = "Cross-stream kerning applied to a minus sign in an equation" width="275" height="67"></div><br/><p>For an example of how to apply the cross-stream kerning tag to a style, see <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-BCIDEAIA">“Drawing Equations.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF299" title="Descent Attribute Tag"></a><h4>Descent Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_631"></a><p>The descent<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_632"></a> attribute tag represents the descent associated with a style object’s font. You can obtain the descent value by using the following style attribute tag: </p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUDescentTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_633"></a></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code>; the value must be >= 0. </dd><dt>Default value:</dt><dd>The descent value of the style’s font with the current point size.</dd><dt>Comment: </dt><dd>This tag is available starting with Mac OS X version 10.2. The leading value is not included as part of the descent.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF179" title="Font ID Attribute Tag"></a><h4>Font ID Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_634"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_635"></a><p>A <strong>font ID</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_636"></a> is a value that identifies a font to the font management system. You can set and retrieve the font ID value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUFontTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_637"></a></dd><dt>Data type:</dt><dd><code>ATSUFontID</code></dd><dt>Default value: </dt><dd>The application font for the current script system.</dd><dt>Comments:</dt><dd>If the application font is not usable by ATSUI, the default is Helvetica.</dd></dl><p class="clear"></p><p>The font ID is used by ATSUI functions that retrieve or manipulate fonts. When you copy a style object, you copy the font ID of the font used in the style run in addition to the style object’s style attributes, font features, and font attributes. The font ID does not persist across system startups. In other words, a font does not have the same font ID when the computer is restarted. </p><a name="//apple_ref/doc/uid/TP30000029-TPXREF302" title="Font Matrix Attribute Tag"></a><h4>Font Matrix Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_638"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_639"></a><p>You can associate a font transformation matrix<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_640"></a> with a style object to achieve such effects as reversing glyphs across the x-axis and rotating glyphs You can set and retrieve the font matrix using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUFontMatrixTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_641"></a></dd><dt>Data type:</dt><dd><code>CGAffineTransform</code></dd><dt>Default value:</dt><dd><code>CGAffineTransformIdentity</code>, which is <code>[1, 0, 0, 1, 0, 0]</code></dd><dt>Comment:</dt><dd>This tag is available in Mac OS X version 10.2 and later.</dd></dl><p class="clear"></p><p><span class="content_text">Figure 2-4</span> shows four instances of the phrase “Hello World.” The first instance is drawn normally; no transformation is applied. The second and third instances are the result of scaling the font transformation matrix to stretch or shrink the glyphs. The fourth instance of “Hello World” is created by rotating the transformation matrix. Some of the glyphs overlap in this case because the rotation does not modify the advance widths. </p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BAJJIHHC" title="Figure 2-4Using a font transformation matrix to achieve text effects "></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>Using a font transformation matrix to achieve text effects </p><img src = "../art/transform.gif" alt = "Using a font transformation matrix to achieve text effects" width="251" height="272"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF183" title="Glyph Orientation Attribute Tag "></a><h4>Glyph Orientation Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_642"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_643"></a><p>The <strong>glyph orientation</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_644"></a> of a style run specifies which direction (vertical or horizontal) glyphs<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_645"></a> should be drawn. You can set and retrieve the glyph orientation using the following attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUVerticalCharacterTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_646"></a></dd><dt>Data type:</dt><dd><code>ATSUVerticalCharacterType</code></dd><dt>Default value:</dt><dd><code>kATSUStronglyHorizontal</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_647"></a></dd><dt>Comment:</dt><dd>The other possible value for this tag is <code>kATSUStronglyVertical</code>.<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_648"></a></dd></dl><p class="clear"></p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_12" title="Note"></a><p><strong>Note:</strong>&nbsp;Changing the glyph orientation affects the tracking settings. See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF186">“Tracking Setting Attribute Tag .”</a></span></p></div><p><span class="content_text">Figure 2-5</span> shows two horizontal lines of text. The glyphs in the top line of <span class="content_text">Figure 2-5</span> are vertical and those in the bottom line are horizontal. </p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BBCDBIGJ" title="Figure 2-5Vertical and horizontal glyphs"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>Vertical and horizontal glyphs</p><img src = "../art/rotatedglyphs.gif" alt = "Vertical and horizontal glyphs" width="219" height="98"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF301" title="Glyph Selector Attribute Tag "></a><h4>Glyph Selector Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_649"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_650"></a><p>Fonts that have large character sets, such as Chinese, Japanese, and Korean fonts, can be packaged as glyph collections, or character sets. Many characters in these large font sets are not readily accessible. Using the glyph selector tag allows you access to characters in the fonts by specifying a font-specific glyph ID<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_651"></a> or a collection ID<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_652"></a> (CID<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_653"></a>). You can use the glyph selector attribute tag to specify a glyph ID or collection by using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUGlyphSelectorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_654"></a></dd><dt>Data type:</dt><dd><code>ATSUGlyphSelector</code></dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default specifies to use the glyphs derived by the ATSUI layout process. This tag is available in Mac OS X version 10.2 and later.</dd></dl><p class="clear"></p><p>For more information on CID conventions, see <span class="content_text"><a href="http://www.adobe.com" target="_blank">http://www.adobe.com</a></span>. You can get the variant glyph information from an input method through the Text Services Manager using the Carbon event key, <code>kEventParamTextInputGlyphInfoArray</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_655"></a>.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF184" title="Glyph Width Attribute Tag"></a><h4>Glyph Width Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_656"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_657"></a><p>Glyph width<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_658"></a>s, by default, are specified by font-defined advance widths. You can override the glyph’s default metrics by imposing a width for ATSUI to use. You can set and retrieve the imposed-width value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUImposeWidthTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_659"></a></dd><dt>Data type:</dt><dd><code>ATSUTextMeasurement</code>; the value must be >= 0.</dd><dt>Default value:</dt><dd><code>kATSUNoImposedWidth</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_660"></a></dd><dt>Comment:</dt><dd>The default setting is for glyphs to use their own font-defined advance widths.</dd></dl><p class="clear"></p><p>Imposing a width is useful if you need to embed a picture or other graphic in a line of text. Your application can create a gap at a specific point in that line by using a single whitespace character as its own style run and imposing a width on that style run, as shown in <span class="content_text">Figure 2-6</span>. The specified glyph always has the imposed width, regardless of the point size of the text, to within a single pixel in device resolution. </p><p><span class="content_text">Figure 2-6</span> shows text in which one of the style runs consists of only the whitespace character between the words “As” and “you”. The text is drawn twice. The first time (the top line) with no imposed width and then (the second line) with an imposed width on the whitespace character. By imposing a width on the style run, you can tailor the size of the gap between the words.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF246" title="Figure 2-6A line of text without and with an imposed glyph width "></a><p><strong>Figure 2-6&nbsp;&nbsp;</strong>A line of text without and with an imposed glyph width </p><img src = "../art/imposedwidth.gif" alt = "A line of text without and with an imposed glyph width" width="244" height="103"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF187" title="Hanging Punctuation Attribute Tag  "></a><h4>Hanging Punctuation Attribute Tag  </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_661"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_662"></a><p><strong>Hanging punctuation</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_663"></a> refers to glyphs that extend beyond the left or right margins of the text area and whose widths are not counted when line length is measured. This property is font-specified, and is usually true for “lightweight” punctuation, such as quotation marks or periods. You can set and retrieve the hanging punctuation value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUHangingInhibitFactorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_664"></a></dd><dt>Data type:</dt><dd><code>Fract</code>; must be a fractional value between 0 and 1.0.</dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default setting specifies no adjustment to the font-specified data. </dd></dl><p class="clear"></p><p>The ability to control whether punctuation glyphs can hang permits automatic alignment<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_665"></a> of text lines such as that shown in <span class="content_text">Figure 2-7</span>. Hanging glyphs typically extend beyond the left and right margins of the text area. Their widths are not counted when line length is measured. In <span class="content_text">Figure 2-7</span> the quotation mark on the left and the period on the right are hanging punctuation glyphs.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF251" title="Figure 2-7Hanging punctuation glyphs"></a><p><strong>Figure 2-7&nbsp;&nbsp;</strong>Hanging punctuation glyphs</p><img src = "../art/hanging.gif" alt = "Hanging punctuation glyphs" width="352" height="63"></div><br/><p>By default, ATSUI uses font-specific information to automatically hang punctuation where appropriate. A value of <code>0</code> (the default) indicates that the glyph should hang by the normal amount. Your application has the ability to control the degree to which hanging punctuation occurs by supplying a value other than <code>0</code>. A positive nonzero value lessens the amount of hanging proportionally; a value of <code>1</code> means “no hanging at all.” <span class="content_text">Figure 2-8</span> shows the same line of (justified) text laid out with the default value (top), with a value of <code>0.5</code> (middle), and with a value of <code>1.0</code> (bottom).</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF252" title="Figure 2-8Effects of changing the hanging punctuation attribute"></a><p><strong>Figure 2-8&nbsp;&nbsp;</strong>Effects of changing the hanging punctuation attribute</p><img src = "../art/changehanging.gif" alt = "Effects of changing the hanging punctuation attribute" width="346" height="179"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF196" title="Forced Hanging Glyphs Attribute Tag "></a><h4>Forced Hanging Glyphs Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_666"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_667"></a><p>You can treat glyphs in a style run as hanging punctuation, whether or not the font designer intended them to be. You can set and retrieve the forced hanging punctuation<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_668"></a> setting using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUForceHangingTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_669"></a></dd><dt>Data type:</dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment:</dt><dd>The default setting specifies not to force the character to hang beyond line boundaries.</dd></dl><p class="clear"></p><p><span class="content_text">Figure 2-9</span> shows a line in which the question mark, which is not normally a hanging punctuation glyph, is in its own style run and is defined as hanging, causing the question mark to extend beyond the margin.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF253" title="Figure 2-9A question mark forced to extend beyond the margin"></a><p><strong>Figure 2-9&nbsp;&nbsp;</strong>A question mark forced to extend beyond the margin</p><img src = "../art/forcehanging.gif" alt = "A question mark forced to extend beyond the margin" width="359" height="54"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF191" title="Justification Override Attribute Tag  "></a><h4>Justification Override Attribute Tag  </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_670"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_671"></a><p><strong>Justification override</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_672"></a> represents the degree to which ATSUI should override justification behavior for glyphs in the style run. You can set and retrieve the justification override value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUPriorityJustOverrideTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_673"></a></dd><dt>Data type:</dt><dd><code>ATSUJustWidthDeltaEntryOverride</code></dd><dt>Default value: </dt><dd>Each field has a value of <code>0</code></dd><dt>Comment:</dt><dd>The default setting specifies no overrides.</dd></dl><p class="clear"></p><p>The <code>ATSUJustWidthDeltaEntryOverride</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_674"></a> structure contains an array of four width delta structures, one for each priority level, in index order. The width delta structure contains the information needed to override the distribution behavior of a glyph or set of glyphs during justification. You can use these structures to specify both a change in priority level and distribution behavior.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF188" title="Kerning Attribute Tag"></a><h4>Kerning Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_675"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_676"></a><p><strong>Kerning</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_677"></a> increases the overlap between glyphs that fit together naturally. It does not apply evenly to all glyphs in a style run. You can set and retrieve the kerning value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUKerningInhibitFactorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_678"></a></dd><dt>Data type: </dt><dd><code>Fract</code>; must be a fractional value between 0 and 1.0.</dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default setting specifies no inhibition of font-specified kerning.</dd></dl><p class="clear"></p><p>ATSUI uses information in font tables to determine how much to increase or decrease the space between glyphs. In the general case, this amount can depend on more than just the two adjacent glyphs: It can also depend on preceding or following glyphs, or even on glyphs in other parts of the line. For example, the two pairs of glyphs in <span class="content_text">Figure 2-10</span> might kern, but the triple would not—at least not in the same manner as the two separate pairs.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF255" title="Figure 2-10When kerning can and cannot occur"></a><p><strong>Figure 2-10&nbsp;&nbsp;</strong>When kerning can and cannot occur</p><img src = "../art/kerningwhen.gif" alt = "When kerning can and cannot occur" width="114" height="181"></div><br/><p>To determine caret positions, kerning offset is effectively split between glyphs in a kerned pair. The example in <span class="content_text">Figure 2-11</span> shows where the caret<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_679"></a> would appear between the two glyphs without kerning (left side) and with kerning (right side).</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF256" title="Figure 2-11Caret position between two kerned glyphs"></a><p><strong>Figure 2-11&nbsp;&nbsp;</strong>Caret position between two kerned glyphs</p><img src = "../art/kerningandcarets.gif" alt = "Caret position between two kerned glyphs" width="238" height="124"></div><br/><p>Kerning does not refer to the apparent overlap that can be caused by glyphs that overhang their bounds (glyphs that extend beyond their leading or trailing edges defined by the character origin and advance width), as shown by the Q in <span class="content_text">Figure 2-12</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF254" title="Figure 2-12Apparent kerning by a glyph that extends beyond its advance width"></a><p><strong>Figure 2-12&nbsp;&nbsp;</strong>Apparent kerning by a glyph that extends beyond its advance width</p><img src = "../art/apparentkerning.gif" alt = "Apparent kerning by a glyph that extends beyond its advance width" width="223" height="99"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF295" title="Language Region Attribute Tag  "></a><h4>Language Region Attribute Tag  </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_680"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_681"></a><p>The language region attribute tag represents the regional language code for glyphs in a style run. ATSUI uses the value associated with this tag to determine how to render region-dependent characteristics. You can set and retrieve the language region value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULangRegionTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_682"></a></dd><dt>Data type: </dt><dd><code>RegionCode</code></dd><dt>Default value:</dt><dd><code>GetScriptManagerVariable (smRegionCode)</code></dd><dt>Comment:</dt><dd>Region codes are defined in the Script Manager.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF300" title="Leading Attribute Tag"></a><h4>Leading Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_683"></a><p>The leading<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_684"></a> attribute tag represents the leading associated with a style object’s font. You can obtain the leading value by using the following style attribute tag: </p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULeadingTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_685"></a></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code>; the value must be >= 0.</dd><dt>Default value:</dt><dd>The leading value of the style’s font with the current point size.</dd><dt>Comment:</dt><dd>This tag is available in Mac OS X version 10.2 and later.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF189" title="Ligature Decomposition Attribute Tag  "></a><h4>Ligature Decomposition Attribute Tag  </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_686"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_687"></a><p><strong>Ligature decomposition</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_688"></a> is the breaking up of a ligature into its component glyphs during justification, so that the individual glyphs may more evenly occupy the space allotted to the ligature. You can set and retrieve the ligature decomposition value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUDecompositionFactorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_689"></a></dd><dt>Data type: </dt><dd><code>Fixed</code>; the value must be >= -1.0 and &lt;= 1.0)</dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The value associated with this tag represents the fractional adjustment to the font-specified threshold at which ligature decomposition occurs during justification, with <code>0</code> representing no adjustment to the font-specified threshold.</dd></dl><p class="clear"></p><p>Depending on the amount of white space surrounding a ligature, postcompensation action may replace that ligature with its component glyphs, after which ATSUI recalculates the positions of all glyphs on the line.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF192" title="Ligature Splitting Attribute Tag "></a><h4>Ligature Splitting Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_690"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_691"></a><p><strong>Ligature splitting</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_692"></a> is the division of a ligature for hit-testing purposes into regions corresponding to each of its component glyphs. You can set and retrieve the ligature splitting value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUNoLigatureSplitTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_693"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment:</dt><dd>The default setting specifies that ligatures and compound characters in a style have divisible components.</dd></dl><p class="clear"></p><p>If the value set by the ligature splitting attribute tag is <code>true</code> and the caret position<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_694"></a> is adjacent to a ligature, ATSUI considers the next valid caret position to be at the other side of the entire ligature rather than at any point within it.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF195" title="Optical Alignment Attribute Tag "></a><h4>Optical Alignment Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_695"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_696"></a><p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_697"></a><strong>Optical alignment</strong> is the fine adjustment of glyph positions (as specified by the font) at the ends of lines to give a more even visual appearance to margins. You can set and retrieve the optical alignment<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_698"></a> value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUNoOpticalAlignmentTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_699"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment:</dt><dd>The default setting specifies not to suppress automatic optical positioning alignment.</dd></dl><p class="clear"></p><p>In multiline text, glyphs may seem to line up incorrectly at the margins. This is accounted for by two factors. First, glyph advance widths contain a certain amount of extra white space (side bearing) to account for the normal interglyph spacing. This produces certain anomalies at line margins, because the side bearing varies with font size.</p><p>The second problem is that due to optical effects, curved lines do not appear to line up properly with straight lines. To make them appear to line up, some compensation must occur. On baselines, for example, curved letters such as “C” or “S” are generally designed to extend slightly below the baseline, so that they appear to line up with straight letters such as “H”. </p><p>This same effect should happen at the edges of lines. On the left side of <span class="content_text">Figure 2-13</span>, the “O” in “Oregon” and the “C” in “Connecticut” appear to be indented compared to the “H” and “D” glyphs. However, as shown by the vertical line on the right, the outlines of the four glyphs are exactly aligned. The apparent indentation is an optical effect.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF261" title="Figure 2-13Apparent misalignment of curved letters"></a><p><strong>Figure 2-13&nbsp;&nbsp;</strong>Apparent misalignment of curved letters</p><img src = "../art/curvedmisalignment.gif" alt = "Apparent misalignment of curved letters" width="429" height="168"></div><br/><p>To compensate for these effects, ATSUI applies optical alignment information contained in the font. When determining the leading and trailing edges of a line of text, ATSUI uses the optical leading and trailing edges as specified by the font.</p><p><span class="content_text">Figure 2-14</span> shows the same text as <span class="content_text">Figure 2-13</span>, except that on the left in <span class="content_text">Figure 2-14</span>, the glyphs appear to be aligned. However, as shown by the vertical line on the right, the outlines of the four glyphs are not exactly aligned; the glyphs have been shifted to compensate for optical effects.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF263" title="Figure 2-14Optical alignment at line edges"></a><p><strong>Figure 2-14&nbsp;&nbsp;</strong>Optical alignment at line edges</p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_700"></a><img src = "../art/opticalalignment.gif" alt = "Optical alignment at line edges" width="429" height="168"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF197" title="Postcompensation Justification Attribute Tag"></a><h4>Postcompensation Justification Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_701"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_702"></a><p><strong>Postcompensation justification</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_703"></a> is a set of processes (such as glyph stretching and ligature decomposition) that occur at the end of the justification<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_704"></a> process and should take place after glyph positions have been calculated. You can set and retrieve the postcompensation justification value using the following style attribute tag: </p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUNoSpecialJustificationTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_705"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd><code>false</code></dd><dt>Comment:</dt><dd>The default setting specifies to perform postcompensation justification if needed.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF297" title="Style Rendering Options Attribute Tag "></a><h4>Style Rendering Options Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_706"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_707"></a><p>Style rendering options<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_708"></a> provide you with fine control over how ATSUI renders a style. You can specify whether or not ATSUI should use hinting and whether or not anti-aliasing should be used. You can set and retrieve the style rendering option value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUStyleRenderingOptionsTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_709"></a></dd><dt>Data type: </dt><dd><code>ATSStyleRenderingOptions</code></dd><dt>Default value:</dt><dd><code>kATSStyleNoOptions</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_710"></a></dd><dt>Comment:</dt><dd>See <em>Inside Mac OS X: ATSUI Reference</em> for a complete list of style rendering options.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF296" title="Style Text Locator Attribute Tag "></a><h4>Style Text Locator Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_711"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_712"></a><p>ATSUI uses text-locator information<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_713"></a> to determine where to break text and which options to apply to text breaks. The attribute value associated with this tag (<code>TextBreakLocatorRef</code>) contains the data needed by ATSUI to locate various kinds of text breaks. You can set and retrieve the style text locator value using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUStyleTextLocatorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_714"></a></dd><dt>Data type: </dt><dd><code>TextBreakLocatorRef</code> (an opaque structure defined in Unicode Utilities)</dd><dt>Default value:</dt><dd><code>NULL</code></dd><dt>Comment:</dt><dd>The default value specifies to use the region-derived locator or the default Text Utilities locator.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF311" title="Text Color (RGB) Attribute Tag"></a><h4>Text Color (RGB) Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_715"></a><p>The text color<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_716"></a> attribute tag represents the color of the glyphs in a style run. You can set and retrieve the text color using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUColorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_717"></a></dd><dt>Data type: </dt><dd><code>RGBColor</code></dd><dt>Default value:</dt><dd><code>(0,0,0)</code></dd><dt>Comment:</dt><dd>The default setting designates black.</dd></dl><p class="clear"></p><p>The <code>RGBColor</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_718"></a> structure lets you specify intensity values for the three additive primary colors—red, green, and blue. </p><a name="//apple_ref/doc/uid/TP30000029-TPXREF181" title="Text Color (RGB Alpha) Attribute Tag"></a><h4>Text Color (RGB Alpha) Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_719"></a><p>The text color<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_720"></a> attribute tag represents the color of the glyphs in a style run and the alpha channel<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_721"></a> (translucency<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_722"></a>) setting for those glyphs. You can set and retrieve the text color and alpha channel setting using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSURGBAlphaColorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_723"></a></dd><dt>Data type: </dt><dd><code>ATSURGBAlphaColor</code></dd><dt>Default value:</dt><dd><code>(0,0,0,1)</code></dd><dt>Comment:</dt><dd>The default setting designates black, with an alpha-channel setting of 1.</dd></dl><p class="clear"></p><p>The <code>ATSURGBAlphaColor</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_724"></a> structure lets you specify intensity values for the three additive primary colors—red, green, and blue—as well as an alpha-channel value. </p><a name="//apple_ref/doc/uid/TP30000029-TPXREF180" title="Text Size Attribute Tag"></a><h4>Text Size Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_725"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_726"></a><p>The text size<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_727"></a> attribute tag represents the size, in typographic points<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_728"></a> (72 per inch), of the text in the style run. You can set and retrieve the text size using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUSizeTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_729"></a></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd>The application font size for the current script system.</dd></dl><p class="clear"></p><p>ATSUI uses <code>Fixed</code> values to specify points for coordinates and measurements, rotated text, and angled and dual carets, unlike QuickDraw, which uses integer coordinates.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF186" title="Tracking Setting Attribute Tag "></a><h4>Tracking Setting Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_730"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_731"></a><p><strong>Tracking</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_732"></a> represents the relative proportion of font-defined adjustments to apply to interglyph positions. You can expand or contract the spacings of all glyphs in a style run by applying a tracking value, called the <strong>tracking setting</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_733"></a>, to that style run. You can set and retrieve the tracking setting using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUTrackingTag</code></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>No change to the font-defined adjustments.</dd></dl><p class="clear"></p><p>Tracking<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_734"></a> is different from with-stream shifting because the actual amount of space added or removed is controlled by the font, not by your application. The positional shifts are the result of two-dimensional interpolation based on the tracking setting, the text size in points, and the threshold values present in the font’s tracking table. These threshold values are used to permit nonlinear tracking amounts. For example, a single tracking setting can specify different sets of spacings for text below 8 points, from 8 to 12 points, from 12 to 15, from 15 to 36, and over 36 points if the font designer specifies it.</p><p>Specifying a tracking setting of <code>0</code> means “space normally” according to the specifications set by the font designer. That does not necessarily mean that no adjustment to spacing occurs. The font designer may decide that “normal spacing” includes some spacing adjustment in certain point size ranges.</p><p>The glyph orientation also affects the tracking<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_735"></a> settings. A font designer can specify different spacings for a tracking setting of <code>0</code> (normal spacing) depending on the orientation of the glyphs.</p><p><span class="content_text">Figure 2-15</span> shows the same phrase written three times in a particular font. The top line is drawn when the application specifies a tracking setting of <code>0</code>; the middle is drawn with a large positive tracking setting (<code>+2</code>); and the bottom with a large negative tracking setting (<code>–2</code>).</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF250" title="Figure 2-15Text drawn with three different tracking settings"></a><p><strong>Figure 2-15&nbsp;&nbsp;</strong>Text drawn with three different tracking settings</p><img src = "../art/trackingdiffsettings.gif" alt = "Text drawn with three different tracking settings" width="445" height="123"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF178" title="Text Style Attribute Tags"></a><h4>Text Style Attribute Tags</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_736"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_737"></a><p><strong>Text styles</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_738"></a> are the visual attributes, other than size, applied as a systematic variation to the plain (unstyled) characteristics of a font’s glyphs. The set of text styles supported by ATSUI include bold, italic, underline, condensed, and extended.</p><p>Text style attribute tags are included for compatibility with the <code>Style</code> type used by QuickDraw’s <code><a href="../../../Reference/QuickDraw_Text/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TextFace" target="_top">TextFace</a></code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_739"></a> function. If a font variant for one of these text styles exists, that variant is used. Otherwise, the variant is generated algorithmically. QuickDraw-compatible style features are not supported by all fonts. Some fonts have finer controls for setting QuickDraw text styles; these controls can be accessed with font variations.</p><p>The tags you can use to set and retrieve text style attributes are listed in <span class="content_text">Table 2-1</span> along with the data type for each tag and its default value.</p><a name="//apple_ref/doc/uid/TP30000029-BBCHBIBF" title="Table 2-1Style attribute tags, data types, and default values for text styles"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Style attribute tags, data types, and default values for text styles</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Attribute tag</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Data type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Default value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th></tr><tr><td  scope="row"><p><code>kATSUQDBoldfaceTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_740"></a></p></td><td ><p><code>Boolean</code></p></td><td ><p><code>false</code></p></td><td ><p>The default specifies not boldfaced</p></td></tr><tr><td  scope="row"><p><code>kATSUItalicTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_741"></a></p></td><td ><p><code>Boolean</code></p></td><td ><p><code>false</code></p></td><td ><p>The default specifies not italicized</p></td></tr><tr><td  scope="row"><p><code>kATSUUnderlineTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_742"></a></p></td><td ><p><code>Boolean</code></p></td><td ><p><code>false</code></p></td><td ><p>The default specifies not underlined</p></td></tr><tr><td  scope="row"><p><code>kATSUCondensedTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_743"></a></p></td><td ><p><code>Boolean</code></p></td><td ><p><code>false</code></p></td><td ><p>The default specifies not condensed</p></td></tr><tr><td  scope="row"><p><code>kATSUExtendedTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_744"></a></p></td><td ><p><code>Boolean</code></p></td><td ><p><code>false</code></p></td><td ><p>The default specifies not extended</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000029-BBCHDJAH" title="With-Stream Shift and Cross-Stream Shift Attribute Tags"></a><h4>With-Stream Shift and Cross-Stream Shift Attribute Tags</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_745"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_746"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_747"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_748"></a><p><strong>With-stream shift</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_749"></a> represents a uniform shift parallel to the baseline of the positions of individual pairs or sets of glyphs in the style run. It can be used for manual kerning<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_750"></a> or letter spacing. You can apply with-stream shift before (to the left of) the glyphs of the style run using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUBeforeWithStreamShiftTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_751"></a></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default value represents no adjustment the amount of space to the left edge (or top, for vertical text).</dd></dl><p class="clear"></p><p>You can apply with-stream shift after (to the right of) the glyphs of the style run using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUAfterWithStreamShiftTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_752"></a></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default value represents no adjustment to the amount of space to add to the right edge (or bottom, for vertical text).</dd></dl><p class="clear"></p><p>You can apply both tags (before and after) to the same style run. Positive with-stream shift moves the glyphs farther apart; negative shift moves them closer together. </p><p><strong>Cross-stream shift</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_753"></a> represents the distance to raise or lower glyphs in the style run perpendicular to the text stream. This shift is vertical for horizontal text and horizontal for vertical text. Each glyph in the style run is shifted by the same amount from the baseline. It can be used for superscript and subscript effects. Positive cross-stream shift moves the glyphs upward from the baseline (as in superscripts); negative shift moves them downward (as in subscripts). You can apply cross-stream shift using the following style attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUCrossStreamShiftTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_754"></a></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd><code>0</code></dd><dt>Comment:</dt><dd>The default value represents no adjustment.</dd></dl><p class="clear"></p><p><span class="content_text">Figure 2-16</span> shows an example of a negative and a positive with-stream shift applied before (to the left of) the glyphs of a style run. The glyphs “c” and “d” constitute a single style run. The line is drawn first with no shift, then with a large negative with-stream shift for that style run, and finally with an even larger positive with-stream shift.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BBCDJJEG" title="Figure 2-16Negative and positive with-stream shift"></a><p><strong>Figure 2-16&nbsp;&nbsp;</strong>Negative and positive with-stream shift</p><img src = "../art/withstreamshift.gif" alt = "Negative and positive with-stream shift" width="351" height="21"></div><br/><p><span class="content_text">Figure 2-17</span> illustrates the simultaneous use of with-stream and cross-stream shifts. The layout consists of two style runs of a single glyph each. On the left the layout is drawn with no shifting. On the right, a negative with-stream shift is applied before the “2”, and a positive cross-stream shift is applied to the “2”. The net result is a well-proportioned and well-placed superscript<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_755"></a>. (There are other ways to make superscripts, including the use of superiors; see <span class="content_text"><a href="../atsui_app_features/atsui_appendixB.html#//apple_ref/doc/uid/TP30000035-TPXREF210">“Vertical Position Feature Type .”</a></span>)</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BBCJJDBG" title="Figure 2-17Combined with-stream and cross-stream shift"></a><p><strong>Figure 2-17&nbsp;&nbsp;</strong>Combined with-stream and cross-stream shift</p><img src = "../art/withandcrossshift.gif" alt = "Combined with-stream and cross-stream shift" width="136" height="101"></div><br/><p>When text is shifted in a with-stream direction, the boundary (caret position<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_756"></a>) between pairs of glyphs is adjusted to be halfway between the advance width of the earlier glyph and the origin of the later glyph, as shown in <span class="content_text">Figure 2-18</span>. Using with-stream and cross-stream shifts can give your application a full manual letter-spacing capability.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BAJJGEEC" title="Figure 2-18Caret position between with-stream shifted glyphs"></a><p><strong>Figure 2-18&nbsp;&nbsp;</strong>Caret position between with-stream shifted glyphs</p><img src = "../art/streamshiftcaret.gif" alt = "Caret position between with-stream shifted glyphs" width="274" height="124"></div><br/><a name="//apple_ref/doc/uid/TP30000029-BBCEEIHA" title="Custom Attribute Tags"></a><h4>Custom Attribute Tags</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_757"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_758"></a><p>If Apple provides a tag for an attribute, you should use the tag. In the rare case in which there isn’t a tag available for an attribute you want to control, you can create your own custom<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_759"></a> tag. Apple reserves values <code>0</code> to <code>65,535</code> (<code>0</code> to <code>0x0000FFFF</code>) for Apple-defined attribute tags. Your attribute tag must have a value outside this range.<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_760"></a></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF198" title="Font Variations"></a><h3>Font Variations</h3><p>As you may recall from <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-BAJBJBJH">“Font Variations,”</a></span> a font variation<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_761"></a> is a setting along a particular style variation axis defined by the font designer. The font variations associated with a style object specify the variations that can be applied to the style’s font. A style object may specify the values for any number of variation axes.</p><p>You can use ATSUI to obtain the variation axes and variation settings defined for a font. You can also use ATSUI to supply your own setting for any variation axes defined for the font. If the font does not support the variation axis you specify, your custom variations have no visual effect.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF199" title="Font Features"></a><h3>Font Features</h3><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_762"></a><p><strong>Font features</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_763"></a> are typographic and layout capabilities that can be selected or deselected by an application and that control many aspects of glyph selection, ordering, and positioning. Font features include fundamental controls such as whether or not contextual forms are to be used and details of appearance such as whether or not alternate forms of glyphs are to be used at the beginning of a word. To a large extent, how text looks when it is laid out is a function of the number and kinds of font features chosen. </p><p>Font vendors create tables that implement a set of font features from which your application can pick and choose. The architecture of font features is open-ended; as font vendors create new kinds of features, ATSUI automatically takes advantage of them. When your application selects a group of features, ATSUI uses them, plus any font-specified features not overridden by your feature selections, when it draws the text layout object.</p><p>Font features are grouped into categories called <strong>feature types</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_764"></a>, within which individual<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_765"></a><strong>feature selectors</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_766"></a> are used to define particular feature settings or selections. Feature types can be exclusive<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_767"></a> or nonexclusive<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_768"></a>. If a feature type is <strong>exclusive</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_769"></a> you can choose only one of the available feature selectors, such as whether numbers are to be proportional or fixed-width. If a feature type is <strong>nonexclusive</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_770"></a>, you can enable any number of feature selectors at once. For example, for the ligature feature type you can choose any combination of the available classes of ligatures that the font supports. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_13" title="Note"></a><p><strong>Note:</strong>&nbsp;You can select only those features added to a font by the font designer. If you select features that are not available in a font, you won’t see a change in the glyph’s appearance.</p></div><p>Some features are contextual<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_771"></a> while others are noncontextual<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_772"></a>. The manner in which <strong>contextual features</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_773"></a> are applied to a glyph depends on the glyph’s position compared to adjacent glyphs. Much of ATSUI’s text layout power results from its ability to apply sophisticated contextual processing automatically. </p><p><strong>Noncontextual features</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_774"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_775"></a> are applied in the same manner to a glyph regardless of the adjacent glyphs. These features include the selection of alternate glyph sets to give text a different appearance and glyph substitution for purposes of mathematical typesetting or enhancing typographic sophistication. </p><p><span class="content_text"><a href="../atsui_app_features/atsui_appendixB.html#//apple_ref/doc/uid/TP30000035-TP1">“Font Features”</a></span> describe font features types and the selectors available for each feature type. As feature types can be added at any time, you should check Apple’s font feature registry website for the most up-to-date list of font feature types and selectors: </p><p><span class="content_text"><a href="http://developer.apple.com/fonts/" target="_top">http://developer.apple.com/fonts/</a></span><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_776"></a></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF157" title="Text Layout Objects"></a><h2>Text Layout Objects</h2><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_777"></a><p>Text layout objects<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_778"></a> contain the stylistic information that influences the display and formatting of the text associated with the text layout object. In ATSUI, you can create a text layout object by calling the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUCreateTextLayout" target="_top">ATSUCreateTextLayout</a></code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_779"></a> with an <code>ATSUTextLayout</code> data structure as a parameter. Like style objects, text layout objects are opaque. You use ATSUI accessor functions to retrieve and manipulate the data associated with a text layout object.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_14" title="Note"></a><p><strong>Note:</strong>&nbsp;Beginning with Mac OS X version 10.2, ATSUI text layout objects are thread-safe; you can share them between threads.</p></div><p>Each text layout object contains the text layout attributes, soft line breaks, and style runs that have been set for a block of Unicode text. The text layout object keeps track of the following information:</p><ul class="ul"><li class="li"><p>A pointer to the Unicode text string associated with the text layout object, and the length of the text associated with the object (which could also include a subrange of the text). See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF163">“Text Information.”</a></span></p></li><li class="li"><p>The number of style runs in the text layout object, the length (in bytes) of each style run, and a list of references to the style objects that correspond to the text layout object’s style runs. See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF164">“Style Run Information.”</a></span></p></li><li class="li"><p>Attributes that control the layout of the text at the line and paragraph level. They influence the width of the text area from the left margin to the right margin, the alignment of the text, the justification of the text, the rotation of the text, the direction of the text, the locations of the various baselines for the text, and other layout controls. See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF165">“Line and Layout Attributes .”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000029-TPXREF163" title="Text Information"></a><h3>Text Information</h3><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_780"></a><p>When you create a text layout object, you need to provide a pointer to a Unicode text buffer along with information about the text. You must allocate and manage the memory for the text associated with the text layout object. </p><p>The following is a list of the text-related information you must supply to ATSUI for each text layout object you create:</p><ul class="spaceabove"><li class="li"><p>address of the start of the text array in memory</p><p>ATSUI assumes that the block of text associated with a text layout object is found in memory as a contiguous block. To handle text that is broken up into discontinuous memory blocks, you must use one text layout object for each block.</p></li><li class="li"><p>offset to the beginning of the portion of text to be drawn</p><p>You must specify the portion of the text buffer to which ATSUI should apply style attributes. This allows you to draw only a portion of text—for example, the visible page and the areas immediately around it—and avoid the overhead of drawing the rest of the text. The starting position is represented as a double-byte character offset of type <code>UniCharArrayOffset</code> relative to the beginning of the text buffer.</p><p>ATSUI assumes that the memory between the beginning of the text and the beginning of the text that is to be drawn, contains text. ATSUI may need to examine the text prior to the starting offset to read Unicode control characters that are embedded in the Unicode text string. </p></li><li class="li"><p>length of the text to be drawn </p><p>The length of the text is measured in the number of double-byte Unicode characters of type <code>UniCharCount</code>. </p></li><li class="li"><p>total length (offset plus length of text to be drawn)</p></li></ul><p>For best text-rendering performance, an ATSUI text layout object should contain at least a paragraph of text. </p><a name="//apple_ref/doc/uid/TP30000029-TPXREF285" title="Text Length and Unicode Separator Characters"></a><h4>Text Length and Unicode Separator Characters</h4><p>Typically the text associated with a text layout object spans a block of Unicode text—a sequence of characters terminated by Unicode block separator characters<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_781"></a> such as hard breaks or tabs. However, this does not have to be the case. The text associated with a text layout object may span<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_782"></a> multiple blocks of Unicode text or part of a block. Regardless of whether the text is shorter, longer, or equal to a block of text as defined by Unicode, ATSUI always behaves as if there are Unicode block separator characters preceding and terminating the text associated with the text layout object.</p><p><span class="content_text">Figure 2-19</span> shows the text associated with a text object and calls out the portion of the text to be rendered by ATSUI. Even though ATSUI needs to draw only a portion of the text, ATSUI might scan the remainder of the text block for formatting controls or other information.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF234" title="Figure 2-19A range of text in a text block"></a><p><strong>Figure 2-19&nbsp;&nbsp;</strong>A range of text in a text block</p><img src = "../art/actualtextrange.gif" alt = "A range of text in a text block" width="455" height="130"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF286" title="More About Text Offsets"></a><h4>More About Text Offsets</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_783"></a><p>Although ASTUI requires Unicode text, you should not assume that the caret can move through the text one character at a time by moving at least two bytes at a time. The backing store position of each character in the text relative to the beginning of the text buffer is specified by a double-byte character offset of type <code>UniCharArrayOffset</code>, illustrated in <span class="content_text">Figure 2-20</span>. The <code>UniCharArrayOffset</code> is a zero-based offset that represents the position between two Unicode characters in a text buffer. Because of the possible presence of surrogates, the double-byte <code>UniCharArrayOffset</code> edge offset does not necessarily represent a position between two logical Unicode characters. </p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF232" title="Figure 2-20Text offsets of type UniCharArrayOffset"></a><p><strong>Figure 2-20&nbsp;&nbsp;</strong>Text offsets of type <code>UniCharArrayOffset</code></p><img src = "../art/textoffsets.gif" alt = "Text offsets of type UniCharArrayOffset" width="317" height="105"></div><br/><p>Some ATSUI functions need more information than a text offset. They also need to know whether the offset comes after the preceding character or before the next character. This is important for bidirectional text, where some of the text has a left-to-right direction and some has a right-to-left direction, as shown in <span class="content_text">Figure 2-21</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF233" title="Figure 2-21Bidirectional text"></a><p><strong>Figure 2-21&nbsp;&nbsp;</strong>Bidirectional text</p><img src = "../art/bidirectionaltext.gif" alt = "Bidirectional text" width="359" height="102"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF164" title="Style Run Information"></a><h3>Style Run Information</h3><p>The text associated with a text layout object is divided into one or more style runs<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_784"></a>. Each style run is specified by a style object that contains a collection of style attributes, font features, and font variations that influence the display and formatting of a style run in a text layout object.</p><p><span class="content_text">Figure 2-22</span> shows text that’s divided into twelve style runs. Six of the style runs in the figure are marked with the style attribute unique to that run. The other six runs that aren’t marked have two attributes set—Palatino font and a point size of 18.0.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF235" title="Figure 2-22Text that has twelve style runs"></a><p><strong>Figure 2-22&nbsp;&nbsp;</strong>Text that has twelve style runs</p><img src = "../art/twelvestyleruns.gif" alt = "Text that has twelve style runs" width="457" height="245"></div><br/><p>When you create a text layout object, you must provide the number of style runs in the text, the length of each style run, and the style object for each run. Style objects and style attributes are discussed in detail in <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF175">“Style Objects.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF165" title="Line and Layout Attributes "></a><h3>Line and Layout Attributes </h3><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_785"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_786"></a><p><strong>Line and layout attributes</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_787"></a> control how the lines of text associated with the text layout object are displayed and formatted. Similar to style attributes, ATSUI uses a triple to specify line and layout attributes: an attribute tag, the value of the attribute it sets, and the size (in bytes) of the attribute value. Attribute tags are constants supplied by ATSUI. Attribute values may be a scaler, a structure, or a pointer. </p><p>This section discusses most of the line and layout attributes for which ATSUI provides tags. It describes a line or layout attribute, the default setting for the attribute, and in many cases shows the effect of applying the attribute to a text layout. For the complete list of line and layout attributes that can be applied to a text layout object, see <em>Inside Mac OS X: ATSUI Reference</em>. </p><p>You can create a custom line or layout attribute for an attribute for which ATSUI does not provide a tag. For more information, see <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-BBCEEIHA">“Custom Attribute Tags.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF171" title="Alignment (Flushness) Attribute Tag"></a><h4>Alignment (Flushness) Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_788"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_789"></a><p><strong>Alignment</strong>, or flushness, is the process of placing text in relation to one or both margins, which are the left and right sides (or top and bottom sides) of the text area. You can set and retrieve the alignment<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_790"></a> value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineFlushFactorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_791"></a></dd><dt>Data type: </dt><dd><code>Fract</code></dd><dt>Default value:</dt><dd><code>kATSUStartAlignment</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_792"></a></dd><dt>Comment:</dt><dd>Text is drawn to the right of the left margin for horizontal text, or below the top margin for vertical text.</dd></dl><p class="clear"></p><p>Text can be aligned left (<code>kATSUStartAlignment</code>), right (<code>kATSUEndAlignment</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_793"></a>), or center (<code>kATSUCenterAlignment</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_794"></a>), as shown in <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TPXREF180">Figure 1-16</a></span>. You can also specify a fractional value to align text at any location between the margins. Note in <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TPXREF180">Figure 1-16</a></span> how the words of the text are spaced normally. Unlike justification (see <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF170">“Justification Attribute Tag”</a></span>), alignment does not affect the spacing between words or individual glyphs. </p><p>The alignment attribute has an effect only with text whose width is shorter than the width specified by the width attribute (<code>kATSULineWidthTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_795"></a>), as shown in <span class="content_text">Figure 2-23</span>. You must specify a width if you want to have any alignment other than <code>kATSUStartAlignment</code>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF242" title="Figure 2-23Use of the alignment attribute with text whose width is shorter than the line&acirc;&#128;&#153;s width"></a><p><strong>Figure 2-23&nbsp;&nbsp;</strong>Use of the alignment attribute with text whose width is shorter than the line’s width</p><img src = "../art/useofalignment.gif" alt = "Use of the alignment attribute with text whose width is shorter than the line’s width" width="395" height="159"></div><br/><p>See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF170">“Justification Attribute Tag”</a></span> for additional information on how the width, alignment, and justification attributes interact. </p><a name="//apple_ref/doc/uid/TP30000029-TPXREF173" title="Baseline Offsets Attribute Tag "></a><h4>Baseline Offsets Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_796"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_797"></a><p>Baseline offsets<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_798"></a> specify the positions of different baseline types with respect to one another in a line of text. You can set and retrieve these values using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineBaselineValuesTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_799"></a></dd><dt>Data type: </dt><dd><code>BslnBaselineRecord</code></dd><dt>Default value:</dt><dd><code>0</code> for each entry in the record</dd></dl><p class="clear"></p><p>In general, a style run has a default baseline, the line to which all glyphs are visually aligned when the text is laid out. For example, in a run of Roman text, the default baseline is the Roman baseline, upon which glyphs sit (except for descenders, which extend below the baseline). In some other writing systems, glyphs hang from the baseline. When text in a line comprises runs using multiple baselines, the text layout object uses information in the baseline record to determine how to align the runs with each other.</p><p>The baseline structure contains an array of distances, in points, from a delta of <code>0</code> from the y-coordinate of the layout’s origin to the other baseline types the text layout object contains. Positive values indicate baselines above the default baseline and negative values indicate baselines below it. ATSUI can use these values to position text relative to the default baseline. </p><p><span class="content_text">Figure 2-24</span> shows an example of text with multiple baselines aligned according to information in the baseline structure. Baseline types are described in detail in <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TPXREF162">“Baselines.”</a></span> </p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF243" title="Figure 2-24Text with multiple baselines aligned to the default baseline"></a><p><strong>Figure 2-24&nbsp;&nbsp;</strong>Text with multiple baselines aligned to the default baseline</p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_800"></a><img src = "../art/multiplebaselines.gif" alt = "Text with multiple baselines aligned to the default baseline" width="324" height="90"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF308" title="Font Fallbacks Attribute Tag "></a><h4>Font Fallbacks Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_801"></a><p>The font fallbacks<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_802"></a> attribute specifies a font fallback object<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_803"></a> to use with a text layout<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_804"></a>. You can set and retrieve the font fallback object for a text layout using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineFontFallbacksTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_805"></a></dd><dt>Data type: </dt><dd><code>ATSUFontFallbacks</code></dd><dt>Default value:</dt><dd><code><!--a-->NULL<!--/a--></code></dd></dl><p class="clear"></p><p>Before you use this tag, you must associate a font fallback method with a font fallback object. Then you can call the function <code>ATSUSetLayoutControls</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_806"></a>, passing as parameters the tag <code>kATSULineFontFallbacksTag</code> and the font fallback object you set up previously. For more information on using the font fallbacks attribute tag see <span class="content_text"><a href="../atsui_chap6/atsui_adv_tasks.html#//apple_ref/doc/uid/TP30000032-TPXREF138">“Using Font Fallback Objects.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF170" title="Justification Attribute Tag"></a><h4>Justification Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_807"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_808"></a><p><strong>Justification</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_809"></a> is the process of typographically fitting a line of text to a given width (or height, in the case of vertical text). You can set and retrieve the justification value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineJustificationFactorTag</code></dd><dt>Data type: </dt><dd><code>Fract</code></dd><dt>Default value:</dt><dd><code>kATSUNoJustification</code></dd></dl><p class="clear"></p><p>In ATSUI some of the information that controls justification behavior is contained in the text layout object, whereas other information is contained in the style objects associated with the text layout object. There are several different kinds of justification, including justification with white space, kashidas<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_810"></a>, glyph deformation, and ligature decomposition.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_15" title="Note"></a><p><strong>Note:</strong>&nbsp;Justification can occur only when a line width is also specified.</p></div><p>ATSUI justifies Roman text primarily by adjusting the white space<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_811"></a> between words and glyphs, as shown in <span class="content_text">Figure 2-25</span>. Note that white space is added not only between words but also between glyphs. Also notice that ligatures such as “fi” and “ff” can be broken during justification.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF237" title="Figure 2-25Alignment and justification of Roman text"></a><p><strong>Figure 2-25&nbsp;&nbsp;</strong>Alignment and justification of Roman text</p><img src = "../art/alignandjustifyroman.gif" alt = "Alignment and justification of Roman text" width="201" height="140"></div><br/><p>When Arabic text is justified, ATSUI distributes the available white space on the line by automatically lengthening or shortening the <strong>kashidas</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_812"></a>, which are the extender bars stretching between some of the glyphs of a word, as shown in <span class="content_text">Figure 2-26</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF238" title="Figure 2-26Alignment and justification in Arabic"></a><p><strong>Figure 2-26&nbsp;&nbsp;</strong>Alignment and justification in Arabic</p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_813"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_814"></a><img src = "../art/alignandjustifyarabic.gif" alt = "Alignment and justification in Arabic" width="218" height="147"></div><br/><p>The value of the justification attribute can have fractional values from <code>0</code> through <code>1</code>. A value of <code>0.0</code> means no justification; a value of <code>1.0</code> means full justification using the width set by the width attribute tag <code>kATSULineWidthTag</code>. ATSUI interprets intermediate values, such as <code>0.5</code>, to mean partial justification<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_815"></a> (also called ragged justification<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_816"></a>). <span class="content_text">Figure 2-27</span> shows a line with no justification followed by a partially justified line and a fully justified line. </p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BAJHIEEI" title="Figure 2-27Use of the justification line and layout control attribute"></a><p><strong>Figure 2-27&nbsp;&nbsp;</strong>Use of the justification line and layout control attribute</p><img src = "../art/justificationattribute.gif" alt = "Use of the justification line and layout control attribute" width="365" height="304"></div><br/><p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_817"></a><span class="content_text">Figure 2-28</span> shows how the justification and <a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_818"></a>alignment line and layout attributes interact with values ranging from <code>0.0</code> to <code>1.0</code>. Note that when the user chooses full justification—that is, when the line justification attribute equals <code>1.0</code>—the value set by the alignment attribute tag (<code>kATSULineFlushFactorTag</code>) has no effect.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-TPXREF240" title="Figure 2-28Justification and alignment in a text layout object"></a><p><strong>Figure 2-28&nbsp;&nbsp;</strong>Justification and alignment in a text layout object</p><img src = "../art/justaligninteract.gif" alt = "Justification and alignment in a text layout object" width="414" height="504"></div><br/><p>The width, justification, and alignment attributes interact, and may produce a text layout other than what you expect. <span class="content_text">Table 2-2</span> describe the text layout that results from the interaction of these three attributes set at various values. </p><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_819"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_820"></a><a name="//apple_ref/doc/uid/TP30000029-BBCBGEBD" title="Table 2-2Interactions between the width, justification, and alignment attributes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>Interactions between the width, justification, and alignment attributes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Width</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Justification</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Alignment</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Effect</p></th></tr><tr><td  scope="row"><p>0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>Text is drawn flush left.</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>0</p></td><td ><p>> 0</p></td><td ><p>Text is drawn proportionally around the origin. For example, if the value set by the attribute tag <code>kATSULineFlushFactorTag</code> equals <code>1.0</code>, the right edge of the text aligns to the origin.</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>> 0</p></td><td ><p>0</p></td><td ><p>Text is drawn compressed, flush left.</p></td></tr><tr><td  scope="row"><p>0</p></td><td ><p>> 0</p></td><td ><p>> 0</p></td><td ><p>Text is drawn compressed at the point specified by the attribute tag <code>kATSULineFlushFactorTag</code>.</p></td></tr><tr><td  scope="row"><p>> 0</p></td><td ><p>0</p></td><td ><p>0</p></td><td ><p>Text is drawn flush left, unless the unjustified width is greater than the specified width. In this case, the text is drawn compressed into the specific width.</p></td></tr><tr><td  scope="row"><p>> 0</p></td><td ><p>0 </p></td><td ><p>> 0</p></td><td ><p>Text is drawn at the point specified by the attribute tag <code>kATSULineWidthTag</code> within the specified width (rather than around the origin, as happens when the width is <code>0</code>). If the unjustified width is greater than the specified width, the text is drawn compressed into the specified width.</p></td></tr><tr><td  scope="row"><p>> 0</p></td><td ><p>> 0</p></td><td ><p>0</p></td><td ><p>Text is drawn in the specified width, flush left, unless the value set by the attribute tag <code>kATSULineJustificationFactorTag</code> is equal to <code>1.0</code>. In this case, both edges are flush.</p></td></tr><tr><td  scope="row"><p>> 0</p></td><td ><p>> 0</p></td><td ><p>> 0</p></td><td ><p>Text is drawn in the specified width at the point specified by the attribute tag <code>kATSULineFlushFactorTag</code> within the specified width, unless the value set by the attributes tag <code>kATSULineJustificationFactorTag</code> is equal to <code>1.0</code>. In this case, both edges are flush.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000029-TPXREF305" title="Language Region Attribute Tag "></a><h4>Language Region Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_821"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_822"></a><p>The language attribute tag represents the regional language code for glyphs in a line or text layout. ATSUI uses the value associated with this tag to determine how to render region-dependent characteristics. You can set and retrieve the language region value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineLangRegionTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_823"></a></dd><dt>Data type: </dt><dd><code>RegionCode</code></dd><dt>Default value:</dt><dd><code>kTextRegionDontCare</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_824"></a></dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF309" title="Layout Operation Override Specifier Attribute Tag"></a><h4>Layout Operation Override Specifier Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_825"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_826"></a><p>The layout operation attribute specifies a layout operation (such as morphing or kerning) that you want to handle instead of letting ATSUI perform it. You can set and retrieve the layout operation value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULayoutOperationOverrideTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_827"></a></dd><dt>Data type: </dt><dd><code>ATSULayoutOperationOverrideSpecifier</code></dd><dt>Default value:</dt><dd><code>NULL</code></dd><dt>Comment:</dt><dd>This attribute is available starting with Mac OS X version 10.2.</dd></dl><p class="clear"></p><p>For information on how to use the layout operation override tag, see <span class="content_text"><a href="../atsui_chap7/atsui_direct_tasks.html#//apple_ref/doc/uid/TP30000033-TPXREF144">“Overriding ATSUI Layout Operations .”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF303" title="Line Ascent Attribute Tag"></a><h4>Line Ascent Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_828"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_829"></a><p>The line ascent attribute tag represents the ascent associated with a line of text. You can obtain the line ascent value by using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineAscentTag</code></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code></dd><dt>Default value:</dt><dd>Maximum typographical ascent of all fonts used in a line of text or a text layout. </dd></dl><p class="clear"></p><p>You can retrieve the line ascent value when you need to calculate line height. See <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TPXREF194">“Calculating Line Height.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF304" title="Line Descent Attribute Tag"></a><h4>Line Descent Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_830"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_831"></a><p>The line descent attribute tag represents the sum of the descent and leading associated with a line of text or a text layout object. You can obtain the line descent value by using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineDescentTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_832"></a></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code></dd><dt>Default value:</dt><dd>The maximum line descent and leading of all fonts in a line of text or in a text layout object.</dd></dl><p class="clear"></p><p>You can retrieve the line descent value when you need to calculate line height. See <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TPXREF194">“Calculating Line Height.”</a></span> Note the unlike the style descent value (see <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF299">“Descent Attribute Tag”</a></span>), the line descent value includes the leading value.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF169" title="Line Direction Attribute Tag  "></a><h4>Line Direction Attribute Tag  </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_833"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_834"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_835"></a><p>The <strong>line direction</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_836"></a> attribute specifies a left-to-right or right-to-left direction for the glyphs associated with a text layout object, regardless of their natural direction as specified in the font. You can set and retrieve the line direction value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineDirectionTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_837"></a></dd><dt>Data type: </dt><dd><code>Boolean</code></dd><dt>Default value:</dt><dd>Derived from the system script by calling the function <code><a href="../../../Reference/Script_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetSysDirection" target="_top">GetSysDirection</a></code></dd></dl><p class="clear"></p><p>The dominant direction<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_838"></a> of a line is the overall, controlling direction within which the individual glyph directions are set. If a Hebrew word is embedded in a line of Roman text, the dominant direction for that line is left to right, but the Hebrew word is still laid out right to left, as expected. Conversely, Roman text embedded in a line of Hebrew, in which the dominant direction is right to left, is still displayed left to right. For this reason, dominant direction has significance only in mixed-direction text. </p><p>The ATSUI text layout model accounts for dominant direction as well as glyph direction, automatically performing any reordering needed for correct display of simple mixed-direction lines of text.</p><a name="//apple_ref/doc/uid/TP30000029-TPXREF174" title="Line Layout Options Attribute Tag"></a><h4>Line Layout Options Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_839"></a><p>Line layout options<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_840"></a> allow for fine control over the layout process. You can set and retrieve line layout options using the following attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineLayoutOptionsTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_841"></a></dd><dt>Data type: </dt><dd><code>ATSLineLayoutOptions</code></dd><dt>Default value:</dt><dd><code>kATSUNoLayoutOptions</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_842"></a></dd></dl><p class="clear"></p><p>The value for the line layout option attributes is specified by setting flags of type <code>ATSLineLayoutOptions</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_843"></a>. These flags are described in <span class="content_text">Table 2-3</span>. Note that some of the flags override style attributes set in the style objects associated with the text layout object.</p><a name="//apple_ref/doc/uid/TP30000029-BBCCDEAB" title="Table 2-3Line layout option flags "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-3&nbsp;&nbsp;</strong>Line layout option flags </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Flag</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>kATSLineHasNoHangers</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_844"></a></p></td><td ><p>This value overrides any adjustment to hanging punctuation set for a style run inside the text layout object using the style attribute tag <code>kATSUForceHangingTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_845"></a> or <code>kATSUHangingInhibitFactorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_846"></a>.</p></td></tr><tr><td  scope="row"><p><code>kATSLineHasNoOpticalAlignment</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_847"></a></p></td><td ><p>Indicates that optical alignment of characters at the text margin does not occur. This value overrides any adjustment to optical alignment set for a style run inside the text layout object using the style attribute tag <code>kATSUNoOpticalAlignmentTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_848"></a>.</p></td></tr><tr><td  scope="row"><p><code>kATSLineKeepSpacesOutOfMargin</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_849"></a></p></td><td ><p>Indicates that whenever a space occurs at the end of a line that space is within the margin. (The default is to allow trailing white spaces inside the margin.)</p></td></tr><tr><td  scope="row"><p><code>kATSLineNoSpecialJustification</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_850"></a></p></td><td ><p>This value overrides the setting of postcompensation actions (such as ligature decomposition or kashida insertions) for a style run inside the text layout object using the style attribute tag <code>kATSUNoSpecialJustificationTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_851"></a>.</p></td></tr><tr><td  scope="row"><p><code>kATSLineLastNoJustification</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_852"></a></p></td><td ><p>Indicates that the last line of a paragraph should not be justified. </p></td></tr><tr><td  scope="row"><p><code>kATSLineFractDisable</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_853"></a></p></td><td ><p>Specifies that the displayed line glyph positions will adjust for device metrics and integer origins.</p></td></tr><tr><td  scope="row"><p><code>kATSLineImposeNoAngleForEnds</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_854"></a></p></td><td ><p>Specifies that the carets at the ends of the line are perpendicular to the baseline.</p></td></tr><tr><td  scope="row"><p><code>kATSLineFillOutToWidth</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_855"></a></p></td><td ><p>Specifies that highlights for the line-end characters are extended from <code>0</code> to the specified line width.</p></td></tr><tr><td  scope="row"><p><code>kATSLineTabAdjustEnabled</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_856"></a></p></td><td ><p>Specifies that the tab character width at the end of a line is automatically adjusted to fit the specified line width.</p></td></tr><tr><td  scope="row"><p><code>kATSLineIgnoreFontLeading</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_857"></a></p></td><td ><p>Specifies that any leading value specified by a font or the ATSUI style attribute for leading is ignored.</p></td></tr><tr><td  scope="row"><p><code>kATSLineApplyAntiAliasing</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_858"></a></p></td><td ><p>Specifies that Apple Type Services (ATS) produce anti-aliased glyph images despite system preferences or Quartz settings.</p></td></tr><tr><td  scope="row"><p><code>kATSLineNoAntiAliasing</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_859"></a></p></td><td ><p>Specifies that ATS turn-off anti-aliasing glyph imaging despite system preferences or Quartz settings (negates the <code>kATSLineApplyAntiAliasing</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_860"></a> flag if set).</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableNegativeJustification</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_861"></a></p></td><td ><p>Specifies that if the line width is not sufficient to hold all the line’s glyphs, glyph positions are allowed to extend beyond the line’s assigned width so negative justification is not used.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAutoAdjustDisplayPos</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_862"></a></p></td><td ><p>Specifies that lines with any integer glyph positioning (such as that due to characters that are not anti-aliased or to the <code>kATSLineFractDisable</code> flag being set) do not automatically adjust individual character positions so they are rendered more aesthetically.</p></td></tr><tr><td  scope="row"><p><code>kATSLineUseQDRendering</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_863"></a></p></td><td ><p>Specifies that rendering uses QuickDraw. The default rendering in ATSUI in Mac OS X is to use Quartz in a 4-bit mode unless you specifically set up a Quartz (<code>CGContextRef</code>) context. In this case the default is to use a subpixel 8-bit mode.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllJustification</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_864"></a></p></td><td ><p>Specifies that any justification operations are not run.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllGlyphMorphing</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_865"></a></p></td><td ><p>Specifies that any glyph morphing operations are not run.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllKerningAdjustments</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_866"></a></p></td><td ><p>Specifies that any kerning adjustment operations are not run.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllBaselineAdjustments</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_867"></a></p></td><td ><p>Specifies that any baseline adjustment operations are not run.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllTrackingAdjustments</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_868"></a></p></td><td ><p>Specifies that any tracking adjustment operations are not run.</p></td></tr><tr><td  scope="row"><p><code>kATSLineDisableAllLayoutOperations</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_869"></a></p></td><td ><p>A convenience constant that specifies to turn off all adjustments to justification, morphing, kerning, baseline, and tracking.</p></td></tr><tr><td  scope="row"><p><code>kATSLineUseDeviceMetrics</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_870"></a></p></td><td ><p>Specifies to optimize for onscreen display of text. Rounded device metrics are used instead of fractional path metrics (not anti-aliased).</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000029-TPXREF307" title="Line Truncation Attribute Tag "></a><h4>Line Truncation Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_871"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_872"></a><p>The line truncation<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_873"></a> attribute specifies where truncation should occur and whether any negative justification should also be applied. You can set and retrieve the line truncation value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineTruncationTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_874"></a></dd><dt>Data type: </dt><dd><code>ATSULineTruncation</code></dd><dt>Default value:</dt><dd><code>kATSUTruncateNone</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_875"></a></dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF310" title="Quartz Context Attribute Tag "></a><h4>Quartz Context Attribute Tag </h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_876"></a><p>The Quartz context<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_877"></a> attribute specifies how ATSUI should render text<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_878"></a>. You can set and retrieve the Quartz context value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSUCGContextTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_879"></a></dd><dt>Data type: </dt><dd><code>CGContextRef</code></dd><dt>Default value:</dt><dd><code>NULL</code></dd><dt>Comment:</dt><dd>This tag is available in Mac OS X. The default is for ATSUI to render text using Quartz at an anti-aliasing setting that simulates QuickDraw rendering. That is, a 4-bit pixel-aligned anti-aliasing.</dd></dl><p class="clear"></p><p>You can use this tag to set up ATSUI to draw using Quartz in an 8-bit, subpixel rendering mode. Using this method of rendering, glyph origins are positioned on fractional points, resulting in superior rendering compared to the default 4-bit pixel-aligned rendering. For information on how to use the Quartz context tag to set up a rendering mode, see <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TPXREF183">“Drawing Text Using a Quartz Context.”</a></span></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF168" title="Rotation Attribute Tag"></a><h4>Rotation Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_880"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_881"></a><p>The <strong>rotation</strong><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_882"></a> attribute specifies the angle (in degrees) by which the entire line should be rotated. You can set and retrieve the rotation value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineRotationTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_883"></a></dd><dt>Data type: </dt><dd><code>Fixed</code></dd><dt>Default value:</dt><dd><code>0</code></dd></dl><p class="clear"></p><p>In ATSUI, rotation is counterclockwise. To produce vertical text<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_884"></a>, set the rotation value to <code>-90.0</code> degrees and the value accessed by the style attribute tag <code>kATSUVerticalCharacterTag</code> to the constant <code>kATSUStronglyVertical</code>, as described in <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF183">“Glyph Orientation Attribute Tag .”</a></span></p><p>The line shown on the right side of <span class="content_text">Figure 2-29</span> is rotated -90.0 degrees, but the glyphs have not been rotated. This type of rotation can be used to label the axis of a scientific graph.</p><br/><div><a name="//apple_ref/doc/uid/TP30000029-BBCIIJCE" title="Figure 2-29A horizontal line and a line rotated -90 degrees"></a><p><strong>Figure 2-29&nbsp;&nbsp;</strong>A horizontal line and a line rotated -90 degrees</p><img src = "../art/linerotation.gif" alt = "A horizontal line and a line rotated -90 degrees" width="212" height="139"></div><br/><a name="//apple_ref/doc/uid/TP30000029-TPXREF306" title="Text Locator Attribute Tag"></a><h4>Text Locator Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_885"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_886"></a><p>ATSUI uses text-locator information<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_887"></a> to determine where to break text and which options to apply to text breaks. The attribute value associated with this tag (<code>TextBreakLocatorRef</code>) contains the data needed by ATSUI to locate various kinds of text breaks. You can set and retrieve the text locator value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineTextLocatorTag</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_888"></a></dd><dt>Data type: </dt><dd><code>TextBreakLocatorRef</code> (an opaque structure defined in Unicode Utilities)</dd><dt>Default value:</dt><dd><code>NULL</code></dd><dt>Comment:</dt><dd>The default value specifies to use the region-derived locator or the default Text Utilities locator.</dd></dl><p class="clear"></p><a name="//apple_ref/doc/uid/TP30000029-TPXREF167" title="Width Attribute Tag"></a><h4>Width Attribute Tag</h4><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_889"></a><p>The width<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_890"></a> attribute specifies the desired width<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_891"></a> of a line of text, in typographic points, of the line when drawn as justified or right-aligned text. ATSUI treats vertical text as if it were horizontal. You can set and retrieve the width value using the following line and layout control attribute tag:</p><dl class="table-display"><dt>Attribute tag:</dt><dd><code>kATSULineWidthTag</code></dd><dt>Data type: </dt><dd><code>ATSUTextMeasurement</code></dd><dt>Default value: </dt><dd><code>0</code></dd><dt>Comment: </dt><dd>If you don’t set the line width, you can’t justify and align the text.</dd></dl><p class="clear"></p><p>If a line is not justified or right-aligned, the value set by the width attribute tag <code>kATSULineWidthTag</code> is still used to apply negative justification (unless the <code>kATSLineDisableNegativeJustification</code><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_892"></a> tag is set). <strong>Negative justification</strong> is the process of condensing text that exceeds the specified width so that the text fits the specified width. See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF170">“Justification Attribute Tag”</a></span> for additional information on how the width, alignment, and justification attributes interact.</p><p>If the line contains glyphs with large negative side bearings, hanging punctuation, or optically aligned edges, the final width of the displayed text may be different from the value specified by the width attribute. See <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF187">“Hanging Punctuation Attribute Tag  ”</a></span> and <span class="content_text"><a href="atsui_concepts2.html#//apple_ref/doc/uid/TP30000029-TPXREF195">“Optical Alignment Attribute Tag ”</a></span> for more information.</p><p>If you use the width of the image bounding rectangle<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_893"></a> and the typographic bounding rectangle as a measure of the overall line length, the measurements may be slightly different from each other. See <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TPXREF138">“Text Measurements”</a></span> for more information.<a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_894"></a><a name="//apple_ref/doc/uid/TP30000029-DontLinkElementID_895"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap2/atsui_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap4/atsui_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap3/atsui_concepts2.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap3/atsui_concepts2.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap3/atsui_concepts2.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>