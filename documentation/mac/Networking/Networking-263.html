<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using the Token Ring Driver(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING263></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-262.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-264.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-257.html"><B>Chapter 11 - Ethernet, Token Ring, and Fiber Distributed Data Interface</B></A> / <A HREF="Networking-261.html"><B>Using Ethernet, Token Ring, and FDDI Drivers</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING263-0></A>
<H2>Using the Token Ring Driver </H2>
 <A NAME=MARKER-2-49></A>You can write an application implementing a protocol other than AppleTalk that reads data from and writes it to the token ring driver defined by Apple. <P>
 To write data to the token ring driver and to perform other functions such as adding a functional address for the token ring hardware, you use the Ethernet functions described earlier, with the modifications noted later in this section. To read 802.2 packets from the token ring driver, you need to attach your protocol handler to the LAP Manager. <P>
 The Apple token ring driver implementation supports only the IEEE 802.2 Type 1 protocol and allows for the attachment of only one protocol handler that reads <BR>802.2 packets that contain an SAP value of $AA. <P>
 Although it is possible to attach your own protocol handler at the hardware device driver level, Apple recommends that you not do this because it excludes AppleTalk from using the token ring driver. So that more than one protocol can receive packets from the token ring driver concurrently, Apple recommends that you attach your protocol handler to the LAP Manager. The LAP Manager attaches its own protocol handler to the token ring driver, and when it receives a packet for your protocol, the LAP Manager calls your protocol handler. When it receives a packet for another protocol, such as AppleTalk, the LAP Manager calls that application's protocol handler.<P>
 For a description of how to attach and detach your protocol handler for token ring, see the chapter "Link-Access Protocol (LAP) Manager" included in this book and the discussion of token ring and FDDI in <A HREF=Networking-258.html#MARKER-9-17>"About Ethernet, Token Ring, and FDDI Support" beginning on page 11-3</A> in this chapter. The chapter "Link-Access Protocol (LAP) Manager" also gives more information on the SAP field value for 802.2 Type 1 packets. <P>
<A NAME=HEADING263-6></A>
<H3>Applying Ethernet Functions</H3>
 The Apple token ring driver implements many but not all of the functions that the Apple Ethernet driver implements. <P>
 For those Ethernet functions that do apply to token ring, you use the function for token ring in the same way that you do for Ethernet: you pass parameters in a parameter block and you use the Ethernet control code in the <CODE>csCode</CODE> field to call the function. The only difference is that instead of specifying the Ethernet driver reference number in the parameter block's <CODE>ioRefNum</CODE> field, you specify the token ring driver reference number. Here are the Ethernet functions that apply to token ring: <P>
<UL>
<LI>You use the <CODE>EAddMulti</CODE> function to add a functional address for token ring and the <CODE>EDelMulti</CODE> function to remove one. Be careful not to specify the broadcast address <BR>as a functional address. See <I>Inside AppleTalk</I>, second edition, for a description and the format of functional and broadcast addresses for token ring. 
<LI>You use the <CODE>EWrite</CODE> function to send data to the token ring driver for transmission over the network.<P>
</UL>
 Here are the Ethernet functions that do not apply to token ring: <P>
<UL>
<LI>The <CODE>ERead</CODE> and <CODE>ERdCancel</CODE> functions are not valid for token ring because Apple does not specify a default protocol handler for the token ring driver. These two functions are used exclusively by applications that use the default Ethernet protocol handler. If an application calls these functions for token ring, the driver will return an error. 
<LI>The <CODE>ESetGeneral</CODE> function switches to a mode that allows the .ENET driver to transmit a larger Ethernet data packet than the standard size. Because token ring is not normally restricted to the limited packet size, this function does not apply. However, the token ring driver will return a result of <CODE>noErr</CODE> if you call this function.<P>
</UL>
 There are some other differences between Ethernet and token ring: <P>
<UL>
<LI>The token ring packet size is determined by the token ring hardware developer. However, for Logical Link Control (LLC) type packets, the packet length cannot exceed 1500 bytes.
<LI>The token ring interface uses functional addresses instead of multicast addresses. Be careful not to use the broadcast address for a functional address. For information about both kinds of token ring addresses, see <I>Inside AppleTalk,</I> second edition. 
<LI>For token ring, the vendor who supplies the hardware device driver provides a control panel that allows you to specify an alternative hardware address. (For general information about alternative hardware addresses, see <A HREF=Networking-262.html#MARKER-9-92>"Changing the Ethernet Hardware Address" on page 11-19</A>.)<P>
</UL>
<DL>
<DT><B>Note</B>
<DD>Although you can use the <CODE>EAttachPH</CODE> function to attach a protocol handler to the token ring driver and the <CODE>EDetachPH</CODE> function to <BR>remove one, Apple recommends that you not use these functions. Instead, you should use the LAP Manager's <CODE>L802Attach</CODE> and <CODE>L802Detach</CODE> routines.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING263-19></A>
<H3>Sending and Receiving Data </H3>
 The tasks involved in sending data to and receiving it from a token ring driver are similar to those that you use for Ethernet. The primary difference is that you use the LAP Manager to attach your protocol handler. Any vendor implementing a token ring driver to run on a Macintosh computer must follow rules that direct them to return packet information in the same manner as does the Ethernet driver for 802.2 packets. From the perspective of an application that uses the token ring driver, this means that when the LAP Manager calls your protocol handler, you can expect the token ring hardware addresses that you reference from register A3 to follow the same format that is used for Ethernet addresses, regardless of how the token ring address might appear at the hardware level. <P>
 <A NAME=MARKER-2-103></A>Here are the steps that you follow to send data to and receive it from a token ring driver: <P>
<OL>
<LI>Locate the token ring cards that are installed in the system. Use the Slot Manager to identify installed token ring cards. Use the <CODE>SGetTypeSRsrc</CODE> function described in the Slot Manager chapter of <I><A HREF="../Devices/Devices-2.html">Inside Macintosh: Devices</A></I> to determine which NuBus slots contain token ring cards. To find token ring cards, use the value <CODE>catNetwork</CODE> <CODE>(0x4)</CODE> in the <CODE>spCategory</CODE> field and the value <CODE>typeTokenRing</CODE> <CODE>(0x2)</CODE> in the <CODE>spCType</CODE> field. You should provide a user interface that allows the user to select a specific token ring card in the case that more than one is present.<A NAME=MARKER-9-107></A><A NAME=MARKER-2-43></A><A NAME=MARKER-2-70></A>
<LI><A NAME=MARKER-2-107></A>Use the <CODE>OpenSlot</CODE> function to open the token ring driver. Set the <CODE>ioNamePtr</CODE> field to .TOKN. If you did not locate any NuBus token ring cards in step 1, you should also attempt to open the <A NAME=MARKER-2-108></A>.TOKN0 driver in case non-NuBus token ring hardware is attached to the system. Use the Device Manager's <CODE>OpenDriver</CODE> function to open the .TOKN0 driver. (For information on the <CODE>OpenSlot</CODE> and <CODE>OpenDriver</CODE> functions, see the chapter "Device Manager" in <I><A HREF="../Devices/Devices-2.html">Inside Macintosh: Devices</A></I>.)<P>
Note that this section refers to the .TOKN driver shell, which facilitates multi-<BR>vendor support, as the .TOKN driver. Opening the .TOKN driver shell, which <BR>loads and opens the card's driver, is effectively the same as directly opening the <BR>token ring driver.
<LI>If your application requires a functional address, use <A NAME=MARKER-2-109></A>the <CODE>EAddMulti</CODE> function to register one. Functional addresses are the token ring equivalent of Ethernet and FDDI multicast addresses. (For information on functional addresses, see <I>Inside AppleTalk,</I> second edition. For a description of multicast addresses, see <A HREF=Networking-260.html#MARKER-9-35>"About Multicast Addressing" on page 11-7</A>.)
<LI>Use the LAP Manager's <CODE>L802Attach</CODE> routine to install your protocol handler. (See the chapter "Link-Access Protocol [LAP] Manager" in this book for more information.) 
<LI>Use the <CODE>EWrite</CODE> function to send packets to the token ring driver for transmission across the network. <A NAME=MARKER-9-37></A><A NAME=MARKER-2-33></A>To use the <CODE>EWrite</CODE> function, you provide a pointer to a <A NAME=MARKER-2-148></A>write-data structure. The first buffer in the write-data structure must be at least 14 bytes long: the first 6 bytes of that buffer must contain the destination address. Bytes 13 and 14 must contain the packet length, which must not exceed 1500 bytes. The token ring driver fills in bytes 7-12 with the source address. (For more information on the write-data structure, see <A HREF=Networking-262.html#MARKER-9-57>"Using a Write-Data Structure to Transmit Ethernet Data" on page 11-10</A>.)
<LI>When you are finished using the token ring driver, use the LAP Manager's <CODE>L802Detach</CODE> routine to remove your protocol handler.
<LI>When you are finished using a functional address, use the <CODE>EDelMulti</CODE> function to remove it<A NAME=MARKER-2-50></A>. <P>
</OL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-262.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-264.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
