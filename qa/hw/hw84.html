<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A HW84: Legacy Devices</title>	<meta name="keywords" content="Open Firmware Legacy devices">	<meta name="Description" content="Technical Q&amp;A HW84: Open Firmware Legacy devices."><meta name="categories" content="Hardware"><meta name="week-posted" content="Mar 20, 2000 - Mar 24, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001356" title="Legacy Devices"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/HardwareDrivers/index.html">Hardware & Drivers</a> &gt; <a href="../../technicalqas/HardwareDrivers/idxPCIandPCCard-date.html">PCI and PC Card</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A HW84</div>
<div id="pageheadsub">Legacy Devices</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->			<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id=p2>Q: I've been getting various reports from users about a problem with Open Firmware on almost all Macintoshes. It appears that Open Firmware is incorrectly assigning the same I/O range to several cards on the same PCI bus. Is this a known bug?</p><p id=p4>A: Apple does not know of any reports concerning Open Firmware incorrectly assigning PCI I/O space. What you may be seeing is two or more PC-compatible "legacy" devices being placed into Macintosh PCI slots. A legacy device could be, for instance, a VGA or IDE controller with hard-coded address assignments previously used on an ISA bus. Since both of these controllers are hard wired to the same physical address in PCI I/O space, their address assignments conflict. There is no work around since both controllers expect to use the same address. This was acceptable when a PC had limited expansion capabilities, but must be taken into account when your personal computer has a PCI bus. For details see "PCI Bus Binding to IEEE Std 1275-1994 Standard for Boot (Initialization Configuration) Firmware Revision 2.1" Section 7, Legacy Devices. For your convenience here is that text:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>7. Legacy devices"Legacy" VGA and IDE devices that are implemented on PCI will typically have thesame "hard-decoded" addresses as they did on ISA. Such devices that have FCode can useexplicit indication of their address requirements as described above. However, forcards that have no FCode image, Open Firmware shall assume the standard addressranges and shall create the "reg" property with these ranges, in addition to any relocatable regions that have base registers.For VGA devices (class-code = 0x000100 or 0x030000), the address ranges are:0x3B0-0x3BB (I/O, aliased; t=1)0x3C0-0x3DF (I/O, aliased; t=1)0xA0000-0xBFFFF (Memory, below 1MB, t=1)For IDE devices (class-code = 0x010100), the address ranges are:0x1F0-0x1F7 Primary Command Block (I/O)0x3F6 Primary Control Block (I/O)0x170-0x17F Secondary Command Block (I/O)0x376 Secondary Control Block (I/O)</pre>	</TD></TR></TABLE></CENTER><p id=p4>As you can see, both types of controller expect to be given a physical address range by Open Firmware. You can determine that your device is requesting a non relocatable address range by looking at the <code>reg</code> property in the node for your device. If <CODE>phys.hi bit 31</CODE> is a <CODE>1</CODE>, then your device is requesting a non-relocatable address range. This might not be a problem if one device is requesting non-relocatable address space. However, if your Macintosh has more that one device requesting hard-coded space, then you must check to see if there is a conflict.</p></td></tr></table></CENTER><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Mar 20 2000]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/hw/hw84.html%3Fid%3DDTS10001356-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/hw/hw84.html%3Fid%3DDTS10001356-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/hw/hw84.html%3Fid%3DDTS10001356-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>