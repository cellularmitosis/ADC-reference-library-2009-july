<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Data Browser Programming Guide: Data Browser Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Data Browser Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000968-CH206" title="Data Browser Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../UserExperience-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000465" target="_top">User Experience</a> &gt; <a href="../databrowser_intro/databrowser_intro.html#//apple_ref/doc/uid/TP30000968-CH205-TPXREF101">Data Browser Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../databrowser_concepts/databrowser_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../databrowser_revhistory/databrowser_hx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF101" title="Data Browser Tasks"></a><h1>Data Browser Tasks</h1><p>This chapter provides instructions and sample code on how to implement a data browser in an application. It provides general tips for using the data browser API and shows how to create list and column view data browsers. You’ll also see how to switch between the two views. </p><p>The chapter includes these sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHHCIDB">“Tips for Using the Data Browser API”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJCJJJH">“Displaying Data in a Simple List View”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJFHBAC">“Displaying Hierarchical Data in a List View”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGGEII">“Displaying Data in a Column View”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJIDJAB">“Switching Between List View and Column View”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGGDCD">“Supporting Text Editing”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIGBCCE">“Applying an Operation to Each Item”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIGIFID">“Sorting Items”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIEBJBG">“Supporting Drag and Drop”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIBBCFI">“Providing a Contextual Menu”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIHBEHG">“Providing Help Tags”</a></span></p></li><li class="li"><p><span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BEIDBGFA">“Customizing Drawing, Tracking, and Dragging”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHHCIDB" title="Tips for Using the Data Browser API"></a><h2>Tips for Using the Data Browser API</h2><p>For best results, follow these tips when using a data browser in your application:</p><ul class="ul"><li class="li"><p>Adhere to the guidelines discussed in <em><a href="../../../../UserExperience/Conceptual/AppleHIGuidelines/index.html#//apple_ref/doc/uid/20000957" target="_top">Apple Human Interface Guidelines</a></em>. Using the data browser API doesn’t ensure you’ll have a stunning interface. Only you can do that by following the human interface guidelines.</p></li><li class="li"><p>Text editing works only in list view; don’t plan to make text editing available in column view.</p></li><li class="li"><p>Avoid using pop-up menus and sliders. The implementation is such that these items can look crowded in a data browser. In addition, the rectangle returned by the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/GetDataBrowserItemPartBounds" target="_top">GetDataBrowserItemPartBounds</a></code> for these items doesn’t provide the values you need to make the interface align properly.</p></li></ul><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJCJJJH" title="Displaying Data in a Simple List View"></a><h2>Displaying Data in a Simple List View</h2><p>This section shows how to create the list view data browser shown in <span class="content_text">Figure 2-1</span> and to display data in the list. This data browser has the following characteristics:</p><ul class="ul"><li class="li"><p>It is a list view.</p></li><li class="li"><p>It uses minimal highlighting, does not show the focus ring, has variable column width, can show scroll bars, and has drag select enabled.</p></li><li class="li"><p>It uses a header row and has four columns.</p></li><li class="li"><p>Each column holds text information and can be moved, sorted, and selected.</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJGIEDD" title="Figure 2-1A simple list view"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>A simple list view</p><img src = "../art/slst_ui.gif" alt = "A simple list view" width="367" height="161"></div><br/><p>To create this list, you’ll perform these tasks, each of which is described in the sections that follow:</p><ol class="ol"><li class="li"><p>Design and configure a list view data browser. In Mac OS X, the easiest way to accomplish this task is to use Interface Builder. </p></li><li class="li"><p>Declare the necessary global constants in your Carbon application.</p></li><li class="li"><p>Write an item-data callback that populates the list with data.</p></li><li class="li"><p>Write code that initializes the data browser control.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJJCHHH" title="Design and Configure a List View Data Browser"></a><h3>Design and Configure a List View Data Browser</h3><p>Follow these steps to design and configure the list view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGIEDD">Figure 2-1</a></span>:</p><ol class="ol"><li class="li"><p>Create a new Carbon application in Xcode.</p></li><li class="li"><p>Double-click the <code>main.nib</code> file provided in the new project in the NIB Files folder.</p><p>You access Interface Builder from within Xcode to ensure that the nib file you create is properly bundled with the Xcode project.</p></li><li class="li"><p>Click the empty window (titled Window), and choose Tools > Show Info.</p></li><li class="li"><p>In the Size pane of the Info window, set the width and height to 500 by 180.</p></li><li class="li"><p>Choose Tools > Palettes > Show Palettes.</p></li><li class="li"><p>Click the Carbon Browsers &amp; Tab palette button.</p></li><li class="li"><p>Drag the Data Browser (List View) item to the window.</p></li><li class="li"><p>Drag the data browser control to resize it to fit in the window.</p></li><li class="li"><p>With the data browser control selected, make the Info window active.</p></li><li class="li"><p>In the Control pane, enter a signature and make sure the Enabled option is selected, as shown in <span class="content_text">Figure 2-2</span>. You can enter any signature you’d like, as long as there is at least one uppercase letter. Apple reserves signatures that are all lowercase. For this example, enter <code>SLST</code>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJGEEII" title="Figure 2-2Setting up the Control pane for a list view"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>Setting up the Control pane for a list view</p><img src = "../art/slst_control.gif" alt = "Setting up the Control pane for a list view" width="253" height="339"></div></li><li class="li"><p>In the Attributes pane, make the following settings, as shown in <span class="content_text">Figure 2-3</span>: </p><ul class="ul"><li class="li"><p>Set Hilite Style to Minimal.</p></li><li class="li"><p>Make sure Focus Ring is not selected.</p></li><li class="li"><p>Under Variable, select the Column Width option.</p></li><li class="li"><p>Under Scroll Bars, select Horizontal and Vertical.</p></li><li class="li"><p>Under Selection, make sure Drag Select is selected. If you want to restrict the user to selecting only one item at a time, select Only One. You can leave the other items at the default setting. </p></li><li class="li"><p>Don’t make any changes to the default row height and column width. </p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJIIFEC" title="Figure 2-3Setting up the Attributes pane for a list view"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>Setting up the Attributes pane for a list view</p><img src = "../art/slst_attributes.gif" alt = "Setting up the Attributes pane for a list view" width="200" height="309"></div></li><li class="li"><p>In the List View pane, make these settings, as shown in <span class="content_text">Figure 2-4</span>:</p><ul class="ul"><li class="li"><p>Make sure Has Header is selected. A header is a title row.</p></li><li class="li"><p>Set the number of columns to <code>4</code>.</p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJFFGEH" title="Figure 2-4Setting up a header and number of columns for a list view"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>Setting up a header and number of columns for a list view</p><img src = "../art/slst_listview.gif" alt = "Setting up a header and number of columns for a list view" width="249" height="135"></div></li><li class="li"><p>In the Columns pane, shown in <span class="content_text">Figure 2-5</span>, set the following for column 1:</p><ul class="ul"><li class="li"><p>Title: <code>Title</code></p></li><li class="li"><p>Title Alignment: Left</p></li><li class="li"><p>Title Offset: <code>0</code></p></li><li class="li"><p>Sort Order: Ascendant</p></li><li class="li"><p>Property ID: <code>SONG</code></p></li><li class="li"><p>Property Type: Text</p></li><li class="li"><p>Min Width: <code>100</code></p></li><li class="li"><p>Max Width: <code>400</code></p></li><li class="li"><p>Make sure the column is movable, sortable, and can be selected.</p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJDFAHI" title="Figure 2-5Setting up the Columns pane for a list view"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>Setting up the Columns pane for a list view</p><img src = "../art/slst_column.gif" alt = "Setting up the Columns pane for a list view" width="202" height="310"></div></li><li class="li"><p>In the Columns pane for column 2:</p><ul class="ul"><li class="li"><p>Title: <code>Time</code></p></li><li class="li"><p>Title Alignment: Left</p></li><li class="li"><p>Title Offset: <code>0</code></p></li><li class="li"><p>Sort Order: Ascendant</p></li><li class="li"><p>Property ID: <code>TIME</code></p></li><li class="li"><p>Property Type: Text</p></li><li class="li"><p>Min Width: <code>20</code></p></li><li class="li"><p>Max Width: <code>100</code></p></li><li class="li"><p>Make sure the column is movable, sortable, and can be selected.</p></li></ul></li><li class="li"><p>In the Columns pane for column 3:</p><ul class="ul"><li class="li"><p>Title: <code>Genre</code></p></li><li class="li"><p>Title Alignment: Left</p></li><li class="li"><p>Title Offset: <code>0</code></p></li><li class="li"><p>Sort Order: Ascendant</p></li><li class="li"><p>Property ID: <code>GENR</code></p></li><li class="li"><p>Property Type: Text</p></li><li class="li"><p>Min Width: <code>50</code></p></li><li class="li"><p>Max Width: <code>150</code></p></li><li class="li"><p>Make sure the column is movable, sortable, and can be selected.</p></li></ul></li><li class="li"><p>In the Columns pane for column 4:</p><ul class="ul"><li class="li"><p>Title: <code>MyRating</code></p></li><li class="li"><p>Title Alignment: Left</p></li><li class="li"><p>Title Offset: <code>0</code></p></li><li class="li"><p>Sort Order: Ascendant</p></li><li class="li"><p>Property ID: <code>RATE</code></p></li><li class="li"><p>Property Type: Text</p></li><li class="li"><p>Min Width: <code>75</code></p></li><li class="li"><p>Max Width: <code>100</code></p></li><li class="li"><p>Make sure the column is movable, sortable, and can be selected.</p></li></ul></li><li class="li"><p>Save the file and quit Interface Builder.</p></li></ol><p>When you create a list view data browser for your own application, you’d set the options to support the number of columns and functionality appropriate for your application.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJBCIGF" title="Declare the Necessary Global Constants"></a><h3>Declare the Necessary Global Constants</h3><p>In the previous section, you assigned each of the columns in list view a unique property ID. You have to make sure the code in your Carbon application uses the same property IDs that you assigned in Interface Builder because you refer to the columns from within your application using the property ID. Rather than use the four-character property IDs directly, it’s useful to declare an enumeration of constants set to the property IDs. You’ll use these constants later in an item-data callback to determine which column requires updating.</p><p>In Xcode, open the <code>main.c</code> file and add the following global enumeration to the code:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>        kMyTitleColumn = 'SONG',<span></span></pre></td></tr><tr><td scope="row"><pre>        kMyTimeColumn = 'TIME',<span></span></pre></td></tr><tr><td scope="row"><pre>        kMyGenreColumn = 'GENR',<span></span></pre></td></tr><tr><td scope="row"><pre>        kMyRatingColumn = 'RATE'<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF102" title="Write an Item-Data Callback"></a><h3>Write an Item-Data Callback</h3><p>The item-data callback communicates data between the data browser and your application; it adds and modifies data in the browser. Your application must provide this callback because without it, no data is displayed. The data browser invokes the callback when it needs to display a value for an item. Typically, the callback is invoked under the following conditions:</p><ul class="spaceabove"><li class="li"><p>The user interacts with the data browser by clicking a disclosure triangle to open a container, scrolling, editing text, or performing some other action that changes the display.</p></li><li class="li"><p>Your application calls a function that requires the data browser to add or modify data. For example, the functions <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code>, <code>SetDataBrowserTarget</code>, and <code>SetDataBrowserColumnViewPath</code> cause the data browser to invoke your item-data callback.</p></li></ul><p>An item-data callback consists of a switch statement that responds to application-defined properties that you define in your application as well as to the list of properties shown in <span class="content_text"><a href="../databrowser_concepts/databrowser_concepts.html#//apple_ref/doc/uid/TBD-BEIIGCIC">Table 1-1</a></span>. For each case in the switch statement, you call the appropriate function from the <code><!--a-->SetDataBrowserItemData<!--/a--></code> and <code><!--a-->GetDataBrowserItemData<!--/a--></code> set of functions available in the data browser API. (See <em><a href="../../../Reference/databrow_reference/index.html#//apple_ref/doc/uid/TP30000969" target="_top">Data Browser Reference</a></em> for the complete list of “getting and setting” functions.)</p><p>The data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGIEDD">Figure 2-1</a></span> is a simple list view. The data is not hierarchical, there are no symbolic links, it uses list view, editing is not allowed, and the user cannot change the active or selection states. For this example, an item-data callback simply needs to look for the property ID for a given item ID, and provide the data that’s associated with that item ID, property ID pair by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserItemDataText" target="_top">SetDataBrowserItemDataText</a></code>. </p><p>There are four columns of data, so the switch statement in the item-data callback must respond to the property ID assigned to each column. <span class="content_text">Listing 2-1</span> shows the item-data callback needed to populate the list view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGIEDD">Figure 2-1</a></span>. An explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJCGHBF" title="Listing 2-1An item-data callback that populates a simple list view"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>An item-data callback that populates a simple list view</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus    MyDataBrowserItemDataCallback (ControlRef browser,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemID itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserPropertyID property,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemDataRef itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                Boolean changeValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (!changeValue) switch (property) <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTitleColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[itemID].song); <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTimeColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    myTunesDatabase[itemID].time);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyGenreColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    myTunesDatabase[itemID].genre);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyRatingColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    myTunesDatabase[itemID].rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = errDataBrowserPropertyNotSupported;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else status = errDataBrowserPropertyNotSupported; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Makes sure that this is a set request, and if so, that it examines the property. The <code>changeValue</code> parameter is <code>false</code> for a set request. The property is the same property ID you defined for each column in Interface Builder, and is the same property ID you declared global constants for in your code. </p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserItemDataText" target="_top">SetDataBrowserItemDataText</a></code> to provide the data to display for that item. In this example, all the data in the data browser, regardless of the property ID of the column, is text. Your application needs to use the item ID associated with the data to obtain the appropriate data. In this example, data from a database was previously read into the structure <code>myTunesDatabase</code>. When the data was read, the application assigned an item ID equal to the array location in the <code>myTunesDatabase</code> structure. For a more complex set of data, your application could provide a function that looks up the data location based on the item ID.</p></li><li class="li"><p>Sets <code>status</code> to a result code indicating that get requests are not supported for any property. Get requests need to be supported only if the data in a browser can be edited.</p></li></ol><p>The item-data callback in this example is a simple one. The item-data callbacks in the sections <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJFHBAC">“Displaying Hierarchical Data in a List View,”</a></span> <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGGEII">“Displaying Data in a Column View,”</a></span> and <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJIDJAB">“Switching Between List View and Column View”</a></span> show item-data callbacks that handle progressively more complex situations.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHCJHGG" title="Write Code That Initializes the List View"></a><h3>Write Code That Initializes the List View</h3><p>There are a number of tasks that need to be done to initialize a data browser. You need to:</p><ul class="spaceabove"><li class="li"><p>Get the data browser control that you defined in Interface Builder so that you can then pass it to other functions.</p></li><li class="li"><p>Initialize the data browser callbacks structure and fill it with callbacks appropriate for your application. In this case there is only one callback—an item-data callback.</p></li><li class="li"><p>Load your data.</p></li><li class="li"><p>Populate the data browser with data.</p></li></ul><p><span class="content_text">Listing 2-2</span> shows a function that initializes the list view data browser depicted in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGIEDD">Figure 2-1</a></span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJEHEEA" title="Listing 2-2Initializing a simple list view data browser"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Initializing a simple list view data browser</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyInitializeDataBrowserControl (WindowRef window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    const       ControlID  dbControlID  = { 'SLST', 0 };<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32      i;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32      numRows;<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef  dbControl;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserCallbacks  dbCallbacks;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetControlByID (window, &amp;dbControlID, &amp;dbControl);  <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.version = kDataBrowserLatestCallbacks;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    InitDataBrowserCallbacks (&amp;dbCallbacks);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.u.v1.itemDataCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>            NewDataBrowserItemDataUPP((DataBrowserItemDataProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                         MyDataBrowserItemDataCallback);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    SetDataBrowserCallbacks(dbControl, &amp;dbCallbacks);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    SetAutomaticControlDragTrackingEnabledForWindow (window, true);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    numRows = MyLoadData ();<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    status = AddDataBrowserItems (dbControl, kDataBrowserNoItem, numRows,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL, kDataBrowserItemNoProperty );<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Initializes a control ID variable with the values you set up in Interface Builder for the data browser. </p></li><li class="li"><p>Obtains the data browser using the control ID from the previous step.</p></li><li class="li"><p>Sets the version of the data browser callbacks structure to the latest version.</p></li><li class="li"><p>Initializes a data browser callbacks structure, effectively setting all fields to <code>NULL</code> in preparation for assigning the callback provided by your application.</p></li><li class="li"><p>Creates a universal procedure pointer (UPP) to an item-data callback and assigns the callback to the appropriate field in the data browser callbacks structure.</p></li><li class="li"><p>Installs the callback by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserCallbacks" target="_top">SetDataBrowserCallbacks</a></code>, passing the data browser callbacks structure as a parameter.</p></li><li class="li"><p>Enables automatic drag tracking for the window that contains the data browser. This lets a user drag a column in list view to a new position.</p></li><li class="li"><p>Calls your application’s function to read data from a database in preparation for writing it to the data browser.</p></li><li class="li"><p>Populates the data browser by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code>. This function causes the data browser to invoke your item-data callback, which in turn provides the data browser with the data associated with each row. </p><p>Note that the fourth parameter, the <code>items</code> parameter, is <code>NULL</code>. In all but the most simplest of lists, such as this one, this parameter should be a pointer to an array of item ID values for the items you want to add to the data browser. You supply item ID values based on your own identification scheme. Passing <code>NULL</code> causes the data browser to generate item ID values for you, starting at a value of 1. Calling the function in this way clears whatever items are in the container. Because of this clearing behavior, passing <code>NULL</code> is not recommended unless your application uses a data browser to display a simple list that is populated only once with data. We pass <code>NULL</code> here just to point out the usage of the function. In other examples, we pass application-generated item IDs.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJFHBAC" title="Displaying Hierarchical Data in a List View"></a><h2>Displaying Hierarchical Data in a List View</h2><p>This section shows how to create a data browser that uses list view to display hierarchical data. <span class="content_text">Figure 2-6</span> shows the list that’s created in this section.</p><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJHGAAG" title="Figure 2-6Hierarchical data displayed in a list view"></a><p><strong>Figure 2-6&nbsp;&nbsp;</strong>Hierarchical data displayed in a list view</p><img src = "../art/hlst_ui.gif" alt = "Hierarchical data displayed in a list view" width="403" height="196"></div><br/><p>To create this list, you’ll perform the following tasks:</p><ol class="ol"><li class="li"><p>Design and configure a data browser that uses list view. This example uses the same design and configuration options as that used for the simple list view discussed in the previous example. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJJCHHH">“Design and Configure a List View Data Browser”</a></span> for instructions on performing this task. </p></li><li class="li"><p>Declare the necessary global constants. These are the same constants declared for the simple list view example discussed in the previous example. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJBCIGF">“Declare the Necessary Global Constants”</a></span> for instructions on performing this task.</p></li><li class="li"><p>Write an item-data callback that writes data to the list and sets each item in the list to the appropriate value for the property <code>kDataBrowserItemIsContainerProperty</code>. See <span class="content_text"><a href="../databrowser_intro/databrowser_intro.html#//apple_ref/doc/uid/TP30000968-CH205-TPXREF103">“Write an Item-Data Callback.”</a></span></p></li><li class="li"><p>Write an item-notification callback that responds to a container-opened notification. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHCDCIC">“Write an Item-Notification Callback for Hierarchical Data.”</a></span></p></li><li class="li"><p>Write code that initializes the data browser control. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHJBGBD">“Write Code That Initializes the Data Browser.”</a></span></p></li></ol><p>Tasks 3 through 5 are discussed in the sections that follow. </p><a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF103" title="Write an Item-Data Callback"></a><h3>Write an Item-Data Callback</h3><p>The item-data callback needed for a list view data browser that displays hierarchical data is almost identical to the callback supplied to display nonhierarchical data. There is one difference. In addition to responding to the property IDs of each column, the callback must respond to the API-defined property <code>kDataBrowserItemIsContainerProperty</code>. Your callback checks to see if an item is a container, and if it is, you set the container property to <code>true</code>. Otherwise, set the property to <code>false</code>. The code in <span class="content_text">Listing 2-3</span> shows how to do this. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJHFIDF" title="Listing 2-3An item-data callback for a hierarchical list"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>An item-data callback for a hierarchical list</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus    MyDataBrowserItemDataCallback (ControlRef browser,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemID itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserPropertyID property,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemDataRef itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                Boolean changeValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (!changeValue) switch (property)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTitleColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[itemID].song);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTimeColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[itemID].time);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyGenreColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[itemID].genre);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyRatingColumn:<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[itemID].rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemIsContainerProperty:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataBooleanValue (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     MyCheckIfContainer (itemID));<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else status = errDataBrowserPropertyNotSupported;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Makes sure this is a set request, and if so, examines the property. The <code>changeValue</code> parameter is <code>false</code> for a set request. In this case, the property ID can be one of the unique four-character sequences you assigned to the columns in list view or it can be one of the predefined properties from the data browser API. </p></li><li class="li"><p>Checks for the container property.</p></li><li class="li"><p>Sets the container property for the item to <code>true</code> if the item is a container or <code>false</code> if the item is not a container. Your application determines whether the item is a container or not.</p></li><li class="li"><p>Sets <code>status</code> to a result code indicating that get requests are not supported for any property. Get requests need to be supported only if the data in a browser can be edited.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHCDCIC" title="Write an Item-Notification Callback for Hierarchical Data"></a><h3>Write an Item-Notification Callback for Hierarchical Data</h3><p>The item-notification callback informs your application of actions taken by the user, such as initiating an editing session or opening a container. Your application must provide this callback if it displays hierarchical data in a list view or uses column view. Without it, users cannot open containers in list view or navigate the data hierarchy in column view.</p><p>The data browser communicates changes of its internal state by sending messages to your item-notification callback. Your callback responds to each event notification by taking the appropriate action. In the case of hierarchical data, your application responds to a container-opened notification by populating the data browser with the items that are in the container. <span class="content_text"><a href="../databrowser_concepts/databrowser_concepts.html#//apple_ref/doc/uid/TBD-BEIGGAFF">Table 1-2</a></span> shows the message that can be sent to an item-notification callback. What you choose to handle in your item-notification callback depends on the nature of your application.</p><p>To implement the hierarchical list shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJHGAAG">Figure 2-6</a></span>, you need to respond only to the container opened (<code>kDataBrowserContainerOpened</code>) notification. The data browser handles closing automatically, so you don’t need to handle a container closed notification. <span class="content_text">Listing 2-4</span> shows the code necessary to handle an open container event for the list view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJHGAAG">Figure 2-6</a></span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJDBGJE" title="Listing 2-4An item-notification callback for a hierarchical list"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>An item-notification callback for a hierarchical list</p><div class="codesample"><table><tr><td scope="row"><pre>void MyDataBrowserItemNotificationCallback( ControlRef browser,<span></span></pre></td></tr><tr><td scope="row"><pre>                        DataBrowserItemID itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                        DataBrowserItemNotification message)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (message)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserContainerOpened:<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            int i, myItemsPerContainer;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            myItemsPerContainer = myTunesDatabase[itemID].songsInAlbum;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            DataBrowserItemID myItems [myItemsPerContainer];<span></span></pre></td></tr><tr><td scope="row"><pre>            for ( i = 0; i &lt; myItemsPerContainer; i++)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                        myItems[i] =  MyGetChild (itemID, i);<span></span></pre></td></tr><tr><td scope="row"><pre>            AddDataBrowserItems (browser, itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    myItemsPerContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    myItems, kTitleColumn);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks for a container-opened notification. For this simple example, that’s all this item-notification callback needs to check for. The data browser API defines a number of other item notifications that can be used within this kind of callback.</p></li><li class="li"><p>Retrieves the number of items in this container. You pass this value to the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code>.</p></li><li class="li"><p>Builds an array of the item IDs for the items in the container. This example calls an application-defined function (<code>MyGetChild</code>) that looks up item ID values for items in a container. Your application would need to build an array of item IDs appropriately.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code> to add the items to the container. You supply the item ID of the container, the number of items in the container, an array of the item IDs for the items in the container, and the property ID of the column whose sorting order matches the sorting order of the items array. In this case, passes the property ID of the title column. You can pass <code>kDataBrowserItemNoProperty</code> if the items array is not sorted or if you don’t know the sorting order of your data. You’ll get the best performance from this function if you provide a sorting order.</p><p>After calling <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code>, the data browser invokes your item-data callback to obtain the data to display. For more information on the requests sent to your item-data callback see <span class="content_text"><a href="../databrowser_concepts/databrowser_concepts.html#//apple_ref/doc/uid/TBD-CJBCEGAI">“Adding Items to a Simple List View.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHJBGBD" title="Write Code That Initializes the Data Browser"></a><h3>Write Code That Initializes the Data Browser</h3><p>The initialization function needed for a list view data browser that displays hierarchical data is almost the same as that needed for nonhierarchical data. There are two differences:</p><ul class="spaceabove"><li class="li"><p>You need to assign your item-notification callback UPP to the appropriate field in the data browser callbacks structure.</p></li><li class="li"><p>You must add code to specify which column can display a disclosure triangle next to a container items. </p></li></ul><p>The code you need to add is shown in <span class="content_text">Listing 2-5</span>. Just add this code to the function shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHCJHGG">“Write Code That Initializes the List View.”</a></span></p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJEFDFA" title="Listing 2-5Initializing a hierarchical list view data browser"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Initializing a hierarchical list view data browser</p><div class="codesample"><table><tr><td scope="row"><pre>dbCallbacks.u.v1.itemNotificationCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>                NewDataBrowserItemNotificationUPP(<span></span></pre></td></tr><tr><td scope="row"><pre>                            (DataBrowserItemNotificationProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                             MyDataBrowserItemNotificationCallback);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>SetDataBrowserListViewDisclosureColumn (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kMyTitleColumn,<span></span></pre></td></tr><tr><td scope="row"><pre>                            true);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJGGEII" title="Displaying Data in a Column View"></a><h2>Displaying Data in a Column View</h2><p>This section shows how to create a data browser that uses column view to display data. <span class="content_text">Figure 2-7</span> shows the data browser that’s created in this section. There are two notable features about this data browser:</p><ul class="ul"><li class="li"><p>Each column displays icon and text data. You’ll need to provide the icons to display and the text strings.</p></li><li class="li"><p>The columns are of equal width. A column view data browser can’t have columns of unequal widths.</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJDGIHG" title="Figure 2-7A column view data browser"></a><p><strong>Figure 2-7&nbsp;&nbsp;</strong>A column view data browser</p><img src = "../art/columns.gif" alt = "A column view data browser" width="323" height="133"></div><br/><p>To create this list, you’ll perform the following tasks:</p><ol class="ol"><li class="li"><p>Design and configure a column view data browser. </p></li><li class="li"><p>Write an item-data callback that populates the columns.</p></li><li class="li"><p>Write an item-notification callback that handles container notifications.</p></li><li class="li"><p>Write code that initializes the data browser control.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHDIGEC" title="Design and Configure a Column View Data Browser "></a><h3>Design and Configure a Column View Data Browser </h3><p>Follow these steps to design and configure the column view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJDGIHG">Figure 2-7</a></span>:</p><ol class="ol"><li class="li"><p>Create a new Carbon application in Xcode.</p></li><li class="li"><p>Double-click the <code>main.nib</code> file provided in the new project.</p><p>You access Interface Builder from within Xcode to ensure that the nib file you create is properly bundled with the Xcode project.</p></li><li class="li"><p>Click the window, and choose Tools > Show Info.</p></li><li class="li"><p>Choose Size in the Info window and set the width and height to 250 by 300.</p></li><li class="li"><p>Choose Tools > Palettes > Show Palettes.</p></li><li class="li"><p>Click the Carbon Browsers &amp; Tab palette button.</p></li><li class="li"><p>Drag the Data Browser (Column View) item to the window.</p></li><li class="li"><p>Drag the data browser control to resize it to fit in the window.</p></li><li class="li"><p>With the data browser control selected, make the Info window active.</p></li><li class="li"><p>In the Control pane, enter a signature, and make sure the Enabled option is selected, as shown in <span class="content_text">Figure 2-8</span>. You can enter any signature you like, as long as there is at least one uppercase letter. Apple reserves signatures that are all lowercase. For this example, enter <code>CLVW</code>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJDDDCG" title="Figure 2-8Setting up the Control pane for a column view"></a><p><strong>Figure 2-8&nbsp;&nbsp;</strong>Setting up the Control pane for a column view</p><img src = "../art/cldb_control.gif" alt = "Setting up the Control pane for a column view" width="249" height="339"></div></li><li class="li"><p>In the Attributes pane, make the following settings, as shown in <span class="content_text">Figure 2-9</span>: </p><ul class="ul"><li class="li"><p>Set Hilite Style to Fill.</p></li><li class="li"><p>Make sure Row Height is set to <code>22</code> (the default) and the Column Width is set to <code>250</code>.</p></li><li class="li"><p>Make sure Focus Ring is not selected.</p></li><li class="li"><p>Select Column Width to make it variable.</p></li><li class="li"><p>Select Horizontal and Vertical under Scroll Bars.</p></li><li class="li"><p>Under Selection, do not change the default selections. </p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJHIHCH" title="Figure 2-9Setting up the Attributes pane for a column view"></a><p><strong>Figure 2-9&nbsp;&nbsp;</strong>Setting up the Attributes pane for a column view</p><img src = "../art/cldb_attributes.gif" alt = "Setting up the Attributes pane for a column view" width="204" height="310"></div></li><li class="li"><p>Save the file and quit Interface Builder.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF104" title="Write an Item-Data Callback"></a><h3>Write an Item-Data Callback</h3><p>A column view data browser is populated with data the same way a list view data browser is—through an item-data callback provided by your application. Unlike list view columns, columns in column view do not have property IDs assigned by your application. Instead, every column in column view has the API-defined property <code>kDataBrowserItemSelfIdentityProperty</code>. This is one of the properties to which your item-data callback responds. The two other API-defined properties handled by an item-data callback for a column view are <code>kDataBrowserItemIsContainerProperty</code> and <code>kDataBrowserItemParentContainerProperty</code>. Column view is, by definition, a way to view hierarchically organized data. As such, your item-data callback provides item IDs for the items within a container and for the parent of an item if the item has a parent.</p><p><span class="content_text">Figure 2-6</span> shows the item-data callback needed to populate the column view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJDGIHG">Figure 2-7</a></span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-DontLinkElementID_3" title="Listing 2-6An item-data callback for a column view data browser"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>An item-data callback for a column view data browser</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus    MyDataBrowserItemDataCallback (ControlRef browser,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemID itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserPropertyID property,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemDataRef itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                Boolean changeValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (property)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemSelfIdentityProperty: <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataIcon (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                         MyCheckIfContainer (itemID) ?<span></span></pre></td></tr><tr><td scope="row"><pre>                         icon[kFolder] : icon[kDocument]); <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                         myTunesDatabase[itemID].song); <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemIsContainerProperty: <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataBooleanValue (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    MyCheckIfContainer (itemID));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemParentContainerProperty: <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            DataBrowserItemID myParent;<span></span></pre></td></tr><tr><td scope="row"><pre>            myParent = MyGetParent (itemID); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataItemID (itemData, myParent); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks for the self-identity property. This property is relevant only to column view.</p></li><li class="li"><p>Sets the icon for the item. There are two types of icons used in this example—a folder, used for a container, and a document, used for an item. The code checks to see if the item is a container, and then supplies the appropriate icon. </p></li><li class="li"><p>Sets the text data for the item.</p></li><li class="li"><p>Checks for the container property. It sets the property to <code>true</code> if the item is a container or <code>false</code> if the item is not a container. Your application determines whether the item is a container or not.</p></li><li class="li"><p>Checks for the parent container property. </p></li><li class="li"><p>Calls your routine to look up the item ID for the item’s parent. If the item is at the top of the hierarchy, it has no parent, and the returned value should be <code>0</code>.</p></li><li class="li"><p>Sets the item’s parent ID by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserItemDataItemID" target="_top">SetDataBrowserItemDataItemID</a></code>. If the item has a parent, the data browser calls your item-data callback again with the parent ID. It keeps doing this until the top of the hierarchy is reached. </p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF105" title="Write an Item-Notification Callback"></a><h3>Write an Item-Notification Callback</h3><p>The item-notification callback needed for this column-view data browser is identical to that supplied for the list view data browser that displays hierarchical data. The notification you must respond to is <code>kDataBrowserContainerOpened</code>. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHCDCIC">“Write an Item-Notification Callback for Hierarchical Data”</a></span> for details.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-TPXREF106" title="Write Code That Initializes the Data Browser"></a><h3>Write Code That Initializes the Data Browser</h3><p><span class="content_text">Listing 2-7</span> shows code that initializes the column view data browser shown in <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJDGIHG">Figure 2-7</a></span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHEDCFA" title="Listing 2-7Initializing a column view data browser"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Initializing a column view data browser</p><div class="codesample"><table><tr><td scope="row"><pre>ControlRef MyInitializeDataBrowserControl (WindowRef window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    const       ControlID  dbControlID = {'CLVW', 0};<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef  dbControl;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserCallbacks  dbCallbacks;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetControlByID (window, &amp;dbControlID, &amp;dbControl);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.version = kDataBrowserLatestCallbacks;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    InitDataBrowserCallbacks (&amp;dbCallbacks);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.u.v1.itemDataCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>                NewDataBrowserItemDataUPP((DataBrowserItemDataProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                            MyDataBrowserItemDataCallback);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.u.v1.itemNotificationCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>                NewDataBrowserItemNotificationUPP(<span></span></pre></td></tr><tr><td scope="row"><pre>                    (DataBrowserItemNotificationProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                    MyDataBrowserItemNotificationCallback);  <span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = SetDataBrowserCallbacks(dbControl, &amp;dbCallbacks);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    return dbControl;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Initializes a control variable with the values you set up in Interface Builder for the data browser.</p></li><li class="li"><p>Obtains the data browser using the control ID from the previous steps.</p></li><li class="li"><p>Sets the version of the data browser callbacks structure to the latest version.</p></li><li class="li"><p>Initializes a data browser callback structure, effectively setting all fields to <code>NULL</code> in preparation for assigning the callbacks provided by your application.</p></li><li class="li"><p>Creates a universal procedure pointer (UPP) to your item-data callback and assigns the callback to the appropriate field in the data browser callbacks structure.</p></li><li class="li"><p>Creates a UPP to your item-notification callback and assigns the callback to the appropriate field in the data browser callbacks structure.</p></li><li class="li"><p>Installs the callbacks by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserCallbacks" target="_top">SetDataBrowserCallbacks</a></code>, passing the data browser callbacks structure as a parameter.</p></li></ol><p>The only task left to perform is to populate the data browser with data when your application first launches. You can add a function call to the initialization function here, or to the main part of your application. For a column view data browser, you can call the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserColumnViewPath" target="_top">SetDataBrowserColumnViewPath</a></code> to open the data browser so the specified target item is selected. Calling this function populates the entire data browser, not just the items in the specified path. As an alternative, you can populate the data browser by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserTarget" target="_top">SetDataBrowserTarget</a></code> to add data along a specific path, with the target item selected.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJIDJAB" title="Switching Between List View and Column View"></a><h2>Switching Between List View and Column View</h2><p>This section shows how to create a data browser that opens in list view, but the user can switch to column view. You’ll find it easier to follow the instructions in this section if you have already read the sections <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJFHBAC">“Displaying Hierarchical Data in a List View”</a></span> and <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJGGEII">“Displaying Data in a Column View.”</a></span></p><p>To create a data browser that can switch between list view and column view, perform the following tasks:</p><ol class="ol"><li class="li"><p>Design and configure a data browser that uses list view. The data browser opens in list view, so you’ll use Interface Builder to configure the list view portion of the data browser. You will configure the column view programmatically.</p><p>This example uses the same design and configuration options as that used for the simple list view discussed in the section <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJJCHHH">“Design and Configure a List View Data Browser,”</a></span> except that you’ll set up the Title column to display both icon and text data. This will make the list and column views look more consistent when you switch between them. Follow the instructions in the <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJJCHHH">“Design and Configure a List View Data Browser,”</a></span> but choose Icon and Text as the display type for Column 1. </p></li><li class="li"><p>Set up a menu that allows the user to switch from one view to another. See the section <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHBEBII">“Set Up a Menu for Switching Views.”</a></span></p></li><li class="li"><p>Declare the necessary global constants. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGEIFA">“Declare the Global Constants Needed for Switching.”</a></span></p></li><li class="li"><p>Write an item-data callback that can write data to the data browser regardless of whether its in list or column view. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGFAAC">“Write an Item-Data Callback to Handle Both Views.”</a></span></p></li><li class="li"><p>Write an item-notification callback that handles container notifications. The item-notification callback needed for this data browser is identical to that supplied for the list view data browser that displays hierarchical data. The notification you must respond to is <code>kDataBrowserContainerOpened</code>. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHCDCIC">“Write an Item-Notification Callback for Hierarchical Data”</a></span> for details.</p></li><li class="li"><p>Write code that initializes the data browser control. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHFGEEB">“Write Code That Initializes a Switchable Data Browser.”</a></span></p></li><li class="li"><p>Write code that changes the view style of the browser. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGBEID">“Write Code to Switch Between Views.”</a></span></p></li><li class="li"><p>Write code that configures the data browser for the current view. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHDAFDI">“Configure the Data Browser.”</a></span></p></li><li class="li"><p>Write data to the data browser when the application first launches. See <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHBIFFB">“Populate the Initial List View With Data.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHBEBII" title="Set Up a Menu for Switching Views"></a><h3>Set Up a Menu for Switching Views</h3><p>You can set up any user interface element you’d like for switching views (menu, button, and so forth), but in this example you’ll create a menu in Interface Builder. The View menu shown in <span class="content_text">Figure 2-10</span> contains two menu items—Column and List. You assign each item a command that is issued when the user chooses the menu item from the View menu. In this case the Column menu item is assigned the command <code>'CLVW'</code>, as shown in the figure. You can assign <code>'LSVW'</code> for the List menu item command. Your application needs to handle each of these commands appropriately, as shown in the section <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGBEID">“Write Code to Switch Between Views.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHJFBEJ" title="Figure 2-10Assigning a command to a menu item"></a><p><strong>Figure 2-10&nbsp;&nbsp;</strong>Assigning a command to a menu item</p><img src = "../art/menu_item_info.gif" alt = "Assigning a command to a menu item" width="429" height="339"></div><br/><p>If you are unfamiliar with how to create a menu in Interface Builder, see the following resources:</p><ul class="spaceabove"><li class="li"><p>Managing Menus under Objects in Interface Builder Help</p></li><li class="li"><p><em>Learning Carbon</em>, available from O’Reilly publishers</p></li></ul><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGEIFA" title="Declare the Global Constants Needed for Switching"></a><h3>Declare the Global Constants Needed for Switching</h3><p>When you designed and configured the list view data browser previously (see <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-BAJJCHHH">“Design and Configure a List View Data Browser”</a></span>), you assigned each of the list view columns a unique property ID. You must make sure the code in your Carbon application uses the same property IDs you assigned in Interface Builder because you refer to the columns from within your application using the property ID. Rather than use the four-character property IDs directly, it’s useful to declare an enumeration of constants set to the property IDs. You’ll use these constants later in an item-data callback to determine which column requires updating.</p><p>In addition to the property IDs, you also need to declare constants for the menu commands you set up in Interface Builder. In Xcode, open the <code>main.c</code> file and add the following global enumeration to the code:</p><div class="codesample"><table><tr><td scope="row"><pre>enum<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    kMyTitleColumn = 'TITL',<span></span></pre></td></tr><tr><td scope="row"><pre>    kMyTimeColumn = 'TIME',<span></span></pre></td></tr><tr><td scope="row"><pre>    kMyGenreColumn = 'GENR',<span></span></pre></td></tr><tr><td scope="row"><pre>    kMyRatingColumn = 'RATE',<span></span></pre></td></tr><tr><td scope="row"><pre>    kCommandListView = 'LISV',<span></span></pre></td></tr><tr><td scope="row"><pre>    kCommandColumnView = 'COLV'<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGFAAC" title="Write an Item-Data Callback to Handle Both Views"></a><h3>Write an Item-Data Callback to Handle Both Views</h3><p>An item-data callback for a data browser that switches between views must respond to inquiries from both views. This means your switch statement responds to the property IDs assigned to each list view column, as well as the API-defined properties used for column view columns—<code>kDataBrowserSelfIdentityProperty</code>, <code>kDataBrowserItemIsContainerProperty</code>, and <code>kDataBrowserItemParentContainerProperty</code>. <span class="content_text">Listing 2-8</span> shows an item-data callback for a data browser that switches between views. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHDJDGI" title="Listing 2-8An item-data callback for a data browser that can switch between views"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>An item-data callback for a data browser that can switch between views</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus    MyDataBrowserItemDataCallback (ControlRef browser,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemID itemID,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserPropertyID property,<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserItemDataRef itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                Boolean changeValue)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 index = MyGetIndex (itemID);<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (property)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTitleColumn:<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>           status = SetDataBrowserItemDataIcon (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                        MyCheckIfContainer (itemID) ?<span></span></pre></td></tr><tr><td scope="row"><pre>                        icon[kFolder] : icon[kDocument]);<span></span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserItemDataText (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[index].song);<span></span></pre></td></tr><tr><td scope="row"><pre>             break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyTimeColumn:<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[index].time);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyGenreColumn:<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[index].genre);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMyRatingColumn:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserItemDataText(itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[index].rating);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemSelfIdentityProperty:<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>           status = SetDataBrowserItemDataIcon (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                        MyCheckIfContainer (itemID) ?<span></span></pre></td></tr><tr><td scope="row"><pre>                        icon[kFolder] : icon[kDocument]);<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataText (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myTunesDatabase[index].song);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemIsContainerProperty:<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataBooleanValue (itemData,<span></span></pre></td></tr><tr><td scope="row"><pre>                             MyCheckIfContainer (itemID));<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserItemParentContainerProperty:<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            DataBrowserItemID myParent;<span></span></pre></td></tr><tr><td scope="row"><pre>            myParent = MyGetParent (itemID);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>            status = SetDataBrowserItemDataItemID (itemData, myParent);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks for the title property ID, then sets the icon and text data for the item. Recall that the display type for the title column is icon and text, so you have to set the appropriate icon as well as the text. This example uses a folder icon for a container and a document icon for an item that is not a container. The code checks to see if the item is a container, and then supplies the appropriate icon.</p></li><li class="li"><p>Checks for the time property ID, then sets the text data for the item. This is not the time of day, but the duration of a song, so the data is text.</p></li><li class="li"><p>Checks for the genre property ID, then sets the text data for the item.</p></li><li class="li"><p>Checks for the rating property ID, then sets the text data for the item.</p></li><li class="li"><p>Checks for the self-identity property (relevant only in column view). Sets the icon for the item—a folder, used for a container, or a document, used for an item. Then sets the text data for the item.</p></li><li class="li"><p>Checks for the container property. It sets the property to <code>true</code> if the item is a container or <code>false</code> if the item is not a container. Your application determines whether the item is a container or not.</p></li><li class="li"><p>Checks for the parent container property. </p></li><li class="li"><p>Calls your routine to look up the item ID for the item’s parent. If the item is at the top of the hierarchy, it has no parent, and the returned value should be <code>0</code>.</p></li><li class="li"><p>Sets the item’s parent ID by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserItemDataItemID" target="_top">SetDataBrowserItemDataItemID</a></code>. If the item has a parent, the data browser calls your item-data callback again with the parent ID you provide. It keeps doing this until the top of the hierarchy is reached.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHFGEEB" title="Write Code That Initializes a Switchable Data Browser"></a><h3>Write Code That Initializes a Switchable Data Browser</h3><p>As with any data browser, you initialize the data browser by setting the appropriate callbacks. For a data browser that can switch views, you also need to set the initial view (in this case, list view) and to store configuration information about the list view columns. Whenever the user switches from column view back to list view, you need to retrieve the list view configuration information so you can restore the data browser to the list view state. You’ll declare the following global structures to store list view configuration information for each column in the list. Note that <code>myNumColumns</code> should be replaced with the number of columns you need in list view. </p><div class="codesample"><table><tr><td scope="row"><pre>struct  ListViewColumns{<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserTableViewColumnID column;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserListViewHeaderDesc  description;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct  ListViewColumns  ListViewColumns;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ListViewColumns myListViewColumns[myNumColumns];<span></span></pre></td></tr><tr><td scope="row"><pre>DataBrowserPropertyDesc myColumnPropertyDescription[myNumColumns];<span></span></pre></td></tr></table></div><p>You’ll save list view configuration information to these global data structures in the initialization function shown in <span class="content_text">Listing 2-9</span>, so that later you can restore the configuration. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGBHID" title="Listing 2-9Initializing a data browser that can switch between views"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Initializing a data browser that can switch between views</p><div class="codesample"><table><tr><td scope="row"><pre>ControlRef MyInitializeDataBrowserControl (WindowRef window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    const       ControlID  dbControlID  = {'CLVW', 0};<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlRef  dbControl;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserCallbacks  dbCallbacks;<span></span></pre></td></tr><tr><td scope="row"><pre>    int i;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetControlByID (window, &amp;dbControlID, &amp;dbControl);  <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.version = kDataBrowserLatestCallbacks; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    InitDataBrowserCallbacks (&amp;dbCallbacks);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.u.v1.itemDataCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>                    NewDataBrowserItemDataUPP ((DataBrowserItemDataProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                        MyDataBrowserItemDataCallback); <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    dbCallbacks.u.v1.itemNotificationCallback =<span></span></pre></td></tr><tr><td scope="row"><pre>                    NewDataBrowserItemNotificationUPP (<span></span></pre></td></tr><tr><td scope="row"><pre>                            (DataBrowserItemNotificationProcPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>                             MyDataBrowserItemNotificationCallback);  <span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = SetDataBrowserCallbacks(dbControl, &amp;dbCallbacks);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetDataBrowserListViewDisclosureColumn (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kMyTitleColumn, true); <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    SetDataBrowserSelectionFlags  (dbControl, kDataBrowserSelectOnlyOne); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    SetAutomaticControlDragTrackingEnabledForWindow (window, true); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    SetDataBrowserViewStyle (dbControl, kDataBrowserListView); <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    myListViewColumns[0].column = kTitleColumn; <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    myListViewColumns[1].column = kGenreColumn;<span></span></pre></td></tr><tr><td scope="row"><pre>    myListViewColumns[2].column = kTimeColumn;<span></span></pre></td></tr><tr><td scope="row"><pre>    myListViewColumns[3].column = kRatingColumn;<span></span></pre></td></tr><tr><td scope="row"><pre>    for (i = 0; i &lt; kNumListViewColumns; i++) <span>// 10</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        DataBrowserListViewHeaderDesc description;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        GetDataBrowserListViewHeaderDesc (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                     myListViewColumns[i].column, &amp;description); <span>// 11</span></pre></td></tr><tr><td scope="row"><pre>        myListViewColumns[i].description = description; <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>        myColumnPropertyDescription[i].propertyID =<span></span></pre></td></tr><tr><td scope="row"><pre>                     myListViewColumns[i].column; <span>// 13</span></pre></td></tr><tr><td scope="row"><pre>        if (i == 0)<span>// 14</span></pre></td></tr><tr><td scope="row"><pre>            myColumnPropertyDescription[i].propertyType =<span></span></pre></td></tr><tr><td scope="row"><pre>                                kDataBrowserIconAndTextType;<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            myColumnPropertyDescription[i].propertyType =<span></span></pre></td></tr><tr><td scope="row"><pre>                                kDataBrowserTextType;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return dbControl;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Initializes a control ID variable to the values you set up in Interface Builder to identify the data browser.</p></li><li class="li"><p>Sets the version of the data browser callbacks structure to the current one.</p></li><li class="li"><p>Creates a universal procedure pointer (UPP) to an item-data callback and assigns the callback to the appropriate field in the data browser callback structure.</p></li><li class="li"><p>Creates a UPP to an item-notification callback and assigns the callback to the appropriate field in the data browser callback structure.</p></li><li class="li"><p>Sets the title column as the one to display a disclosure triangle. You need to do this because the data is organized hierarchically. In this instance, the title column either denotes an album or a song title. Album titles disclose song titles.</p></li><li class="li"><p>Sets the selection flags so that only one item can be selected at a time. Your application would set up the selection flags appropriate to its needs.</p></li><li class="li"><p>Enables drag tracking. This allows users to reorder the columns by dragging. The system automatically handles the drag operation for you.</p></li><li class="li"><p>Sets the view style to a list view style. The data browser first opens to a list view but the user can change the view to a column view after the application launches.</p></li><li class="li"><p>Starts to fill the list view column structure with configuration information. This line and the next three lines of code save the property IDs for each column.</p></li><li class="li"><p>Iterates through the columns to save the appropriate configuration information.</p></li><li class="li"><p>Obtains the current list view header description, which you previously set up in Interface Builder.</p></li><li class="li"><p>Assigns the description to the list view column structure.</p></li><li class="li"><p>Assigns the property ID to the column property description structure.</p></li><li class="li"><p>Assigns the appropriate display type to the column property description structure. Recall that you previously set up the title column to contain icon and text data and all other columns to contain text only.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGBEID" title="Write Code to Switch Between Views"></a><h3>Write Code to Switch Between Views</h3><p>In one of the Carbon event handlers for your application you need to write code that checks for, and responds to, the menu commands you set up in Interface Builder. Recall that you declared constants for these commands in the section <span class="content_text"><a href="databrowser_tasks.html#//apple_ref/doc/uid/TP30000968-CH206-CIHGEIFA">“Declare the Global Constants Needed for Switching.”</a></span></p><p>Respond to the menu commands <code>kCommandListView</code> and <code>kCommandColumnView</code> by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserViewStyle" target="_top">SetDataBrowserViewStyle</a></code> with the <code>style</code> parameter set to the appropriate value—either <code>kDataBrowserListView</code> or <code>kDataBrowserColumnView</code>. Then, call your function to configure the data browser for the new view. </p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHDAFDI" title="Configure the Data Browser"></a><h3>Configure the Data Browser</h3><p>Whenever the user switches the view, you must configure the data browser for the new view. <span class="content_text">Listing 2-10</span> shows how to configure each view. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHJDCIJ" title="Listing 2-10Configuring the data browser for each view"></a><p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>Configuring the data browser for each view</p><div class="codesample"><table><tr><td scope="row"><pre>void ConfigureDataBrowser (ControlRef dbControl)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32          i;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32          numAlbums;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserItemID target;<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserViewStyle viewStyle;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    numAlbums = CFStringGetIntValue (CFCopyLocalizedString<span></span></pre></td></tr><tr><td scope="row"><pre>                            (CFSTR("NumAlbums"), NULL));<span></span></pre></td></tr><tr><td scope="row"><pre>    DataBrowserItemID myItems[numAlbums];<span></span></pre></td></tr><tr><td scope="row"><pre>    SetDataBrowserTarget (dbControl, 0);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    GetDataBrowserViewStyle (dbControl, &amp;viewStyle);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (viewStyle)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserListView:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            for (i = 0; i &lt; kNumListViewColumns; i++)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserListViewColumnDesc myColDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>                DataBrowserListViewHeaderDesc description;<span></span></pre></td></tr><tr><td scope="row"><pre>                description = myListViewColumns[i].description;<span></span></pre></td></tr><tr><td scope="row"><pre>                myColDescription.headerBtnDesc =<span></span></pre></td></tr><tr><td scope="row"><pre>                        myListViewColumns[i].description;<span></span></pre></td></tr><tr><td scope="row"><pre>                myColDescription.propertyDesc =<span></span></pre></td></tr><tr><td scope="row"><pre>                     myColumnPropertyDescription[i];<span></span></pre></td></tr><tr><td scope="row"><pre>                status = AddDataBrowserListViewColumn (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                             &amp;myColDescription, i);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserListViewDisclosureColumn (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                             kTitleColumn, true);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            SetDataBrowserSelectionFlags  (dbControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kDataBrowserSelectOnlyOne);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            MyPopulateListView();<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kDataBrowserColumnView:<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            int j = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            MyPopulateColumnView();<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        }break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Sets the target for the data browser to the top level. You could also save the current target at the time the user switches the view, then set the target as the target for the new view.</p></li><li class="li"><p>Gets the view style. This is the view the user just switched to, and that you set when you processed the view command.</p></li><li class="li"><p>Retrieves the previously saved list view configuration and adds each column to the list view by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserListViewColumn" target="_top">AddDataBrowserListViewColumn</a></code>.</p></li><li class="li"><p>Sets the title column as the one that has a disclosure triangle.</p></li><li class="li"><p>Sets a flag to restrict selection in list view to one item at a time. Your application would set whatever user selection flags are appropriate.</p></li><li class="li"><p>Calls your function to populate list view. Your function should build an array of the item IDs for the container items, and then call the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code> to add the container items to the list.</p></li><li class="li"><p>Calls your function to populate column view. Your function can call <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserTarget" target="_top">SetDataBrowserTarget</a></code>, supplying the item ID for the item you want as the target. You must make sure your item-data callback responds to the request <code>kDataBrowserItemParentContainerProperty</code> to ensure the data browser is populated properly.</p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHBIFFB" title="Populate the Initial List View With Data"></a><h3>Populate the Initial List View With Data</h3><p>When your application first launches, you need to read in your data and populate the data browser. The code shown in <span class="content_text">Listing 2-11</span> is from the main part of the application. It calls the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/AddDataBrowserItems" target="_top">AddDataBrowserItems</a></code> for each container to display in the initial list view. Your application needs to take similar action when the application launches. </p><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGDDDE" title="Listing 2-11Reading data and populating the data browser"></a><p class="codesample"><strong>Listing 2-11&nbsp;&nbsp;</strong>Reading data and populating the data browser</p><div class="codesample"><table><tr><td scope="row"><pre>DataBrowserItemID myItemID;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myNumRows = MyLoadData (dbControl);<span></span></pre></td></tr><tr><td scope="row"><pre>for (i = 0; i &lt; MyNumRows; i++)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (MyCheckIfContainer (i))<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        myItemID = MyGetItemID(i);<span></span></pre></td></tr><tr><td scope="row"><pre>        AddDataBrowserItems (dbControl, kDataBrowserNoItem,<span></span></pre></td></tr><tr><td scope="row"><pre>                            1, &amp;myItemID, kTitleColumn);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000968-CH206-CIHGGDCD" title="Supporting Text Editing"></a><h2>Supporting Text Editing</h2><p>The data browser provides built-in text editing capability for columns with the display type <code>kDataBrowserTextType</code> or <code>kDataBrowserIconAndTextType</code>. The user clicks an item in a cell and edits the text displayed in that cell. The editing session is open as long as the user has the cell selected. Your application needs to capture any changes the user makes and save those changes to its internal data store. </p><p>To support text editing in a data browser, follow these steps: </p><ol class="ol"><li class="li"><p>When you create a column that you want users to be able to edit, set the property <code>kDataBrowserPropertyIsEditable</code> to <code>true</code> for that column. Otherwise, the user won’t be able to modify the data in the column. </p></li><li class="li"><p>In the switch statement in your item-data callback, handle the <code>kDataBrowserItemIsEditableProperty</code> inquiry. In response to this inquiry, call the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/SetDataBrowserItemDataBooleanValue" target="_top">SetDataBrowserItemDataBooleanValue</a></code> with the <code>theData</code> parameter set to <code>true</code>. If your application has more than one column that contains editable text, call the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/GetDataBrowserItemDataProperty" target="_top">GetDataBrowserItemDataProperty</a></code> to find out which column is being edited.</p></li><li class="li"><p>After you pass <code>true</code> in response to the <code>kDataBrowserItemIsEditableProperty</code> inquiry, the data browser issues two notifications to your item-notification callback: <code>kDataBrowserEditStarted</code> and <code>kDataBrowserEditStopped</code>. Respond to each of these appropriately. For example, after you’ve been notified that editing has started, you can lock any data that might need to be locked, or update the user interface as needed. After the editing has stopped, you can unlock any locked data or update the user interface.</p></li><li class="li"><p>When the editing session is finished, your item-data callback is invoked with the <code>property</code> parameter set to the ID of the column that was modified and the <code>setValue</code> parameter set to <code>true</code>. Your callback extracts the edited text by calling the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/GetDataBrowserItemDataText" target="_top">GetDataBrowserItemDataText</a></code>, supplying the item ID of the item whose text was modified. You can then make sure the string is valid and decide to accept or reject the new value before saving the edited text to your application’s private data store. If your application decides to reject the edited text, you can inform the user that you are rejecting the edit. </p></li></ol><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIGBCCE" title="Applying an Operation to Each Item"></a><h2>Applying an Operation to Each Item</h2><p>The item-iterator callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemProcPtr" target="_top">DataBrowserItemProcPtr</a></code>) performs a task, defined by your application, on each item in a data browser that meets your criteria. You provide the callback and the criteria for applying it as parameters to the function <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/ForEachDataBrowserItem" target="_top">ForEachDataBrowserItem</a></code>. For example, you could write a callback to remove inactive items or to set values displayed in a data browser to default values.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIGIFID" title="Sorting Items"></a><h2>Sorting Items</h2><p>Items in a list view column can be sorted in ascending or descending order. Items in a container appear in the same sorting order as the items in the parent container. You supply a callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemCompareProcPtr" target="_top">DataBrowserItemCompareProcPtr</a></code>) to handle sorting. Your callback can perform simple sorting or more complex sorting, such as the following:</p><ul class="ul"><li class="li"><p>Sort containers in a hierarchical list independently of each other</p></li><li class="li"><p>Use secondary and tertiary sorting</p></li></ul><p>In either of the complex cases, your callback must keep track of previous sort operations and preserve sorting orders for secondary and tertiary items.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIEBJBG" title="Supporting Drag and Drop"></a><h2>Supporting Drag and Drop</h2><p>If your application wants to support drag-and-drop behavior in a data browser, it can supply callbacks to: </p><ul class="ul"><li class="li"><p>Add an item to a drag object. The callback <code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserAddDragItemProcPtr" target="_top">DataBrowserAddDragItemProcPtr</a></code> is invoked when a drag operation is started and is used to support dragging objects from the data browser. Your callback adds the item to the drag reference passed to it by the data browser.</p></li><li class="li"><p>Determine if a drag object can be accepted in a particular location (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemAcceptDragProcPtr" target="_top">DataBrowserItemAcceptDragProcPtr</a></code>)</p></li><li class="li"><p>Receive a drag item by extracting the item from the drag reference passed to it by the data browser and then processing the item appropriately (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemReceiveDragProcPtr" target="_top">DataBrowserItemReceiveDragProcPtr</a></code>)</p></li><li class="li"><p>Perform drag postprocessing tasks, such as deallocating resources (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserPostProcessDragProcPtr" target="_top">DataBrowserPostProcessDragProcPtr</a></code>)</p></li></ul><p>If you want only to support the ability for the user to change column positions in a list view, you don’t need to provide drag callbacks. </p><p>Any time you want a data browser to support drag-and-drop, you must call the Control Manager function <code><a href="../../../Reference/Control_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetAutomaticControlDragTrackingEnabledForWindow" target="_top">SetAutomaticControlDragTrackingEnabledForWindow</a></code>. This is true even if you want only column dragging or only item dragging.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIBBCFI" title="Providing a Contextual Menu"></a><h2>Providing a Contextual Menu</h2><p>Providing a contextual menu in a data browser is optional. You need to supply two callbacks if you want to support a contextual menu in a data browser—get-contextual-menu (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserGetContextualMenuProcPtr" target="_top">DataBrowserGetContextualMenuProcPtr</a></code>) and select-contextual-menu (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserSelectContextualMenuProcPtr" target="_top">DataBrowserSelectContextualMenuProcPtr</a></code>). The get-contextual-menu callback is called by the data browser when the user Control-clicks an item in the display. <span class="content_text">Figure 2-11</span> shows how such a menu looks; this one is from the Finder.</p><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJEDDFI" title="Figure 2-11A contextual menu in the Finder"></a><p><strong>Figure 2-11&nbsp;&nbsp;</strong>A contextual menu in the Finder</p><img src = "../art/context_menu.gif" alt = "A contextual menu in the Finder" width="229" height="237"></div><br/><p>Your get-contextual-menu callback provides a menu and information about help that is (or is not) available. You can customize the content of the menu and determine what information to provide in it by calling the function <code>GetDataBrowserItems</code> with the <code>state</code> parameter set to <code>kDataBrowserItemIsSelected</code>. This function obtains the items that are selected, which you can then use to choose the appropriate information to supply. </p><p>Your select-contextual-menu callback is invoked by the data browser when the user selects and item from the contextual menu. Your callback can retrieve the selection and take the appropriate action.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIHBEHG" title="Providing Help Tags"></a><h2>Providing Help Tags</h2><p>The item-help-content callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemHelpContentProcPtr" target="_top">DataBrowserItemHelpContentProcPtr</a></code>) is invoked by the data browser when the user hovers the pointer over an item. Your callback fills in a help tag structure provided to you by the data browser and, when requested, disposes of previously supplied help content. As a result of the information you supply, a help tag is displayed similar to that shown in <span class="content_text">Figure 2-12</span>. You are not required to provide this callback. </p><br/><div><a name="//apple_ref/doc/uid/TP30000968-CH206-BAJJHAHE" title="Figure 2-12A help tag in a data browser"></a><p><strong>Figure 2-12&nbsp;&nbsp;</strong>A help tag in a data browser</p><img src = "../art/help_tag.gif" alt = "A help tag in a data browser" width="338" height="138"></div><br/><p>If you want to provide a single help tag for the entire data browser, you can simply type the help tag content into the Help pane of the Info window in Interface Builder. The system takes care of displaying and disposing of the content; a callback is unnecessary.</p><a name="//apple_ref/doc/uid/TP30000968-CH206-BEIDBGFA" title="Customizing Drawing, Tracking, and Dragging"></a><h2>Customizing Drawing, Tracking, and Dragging</h2><p>If you want to control how items are drawn, tracked, and dragged in a list view data browser, you need to set the display type of the columns to custom (<code>kDataBrowserCustomType</code>). (See <span class="content_text"><a href="../databrowser_concepts/databrowser_concepts.html#//apple_ref/doc/uid/TBD-BAJEJCIH">“What Can Be Displayed”</a></span> for more information on display types.) The custom type signals the data browser that, at the very least, you want to handle drawing the items. If you plan to support editing, drag and drop, or anything that requires tracking and hit-testing, you must also handle these tasks because none of these tasks are handled by the data browser for columns that display custom types.</p><p>The data browser API has a suite of callbacks that operate only on custom types:</p><ul class="ul"><li class="li"><p>The draw-item callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserDrawItemProcPtr" target="_top">DataBrowserDrawItemProcPtr</a></code>), which is invoked by the data browser whenever your custom content needs to be drawn. </p></li><li class="li"><p>The edit-item callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserEditItemProcPtr" target="_top">DataBrowserEditItemProcPtr</a></code>), which is invoked by the data browser when a user clicks a custom item.</p></li><li class="li"><p>The hit-testing callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserHitTestProcPtr" target="_top">DataBrowserHitTestProcPtr</a></code>), which determines if the mouse is over content that can be selected or dragged.</p></li><li class="li"><p>The tracking callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserTrackingProcPtr" target="_top">DataBrowserTrackingProcPtr</a></code>), which is invoked after your hit-testing callback returns <code>true</code> and when a mouse-click is inside the content area of the custom item. </p></li><li class="li"><p>The item-drag callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemDragRgnProcPtr" target="_top">DataBrowserItemDragRgnProcPtr</a></code>), which determines which part of an item to use to create a transparent image for a dragged item. </p></li><li class="li"><p>The item-accept callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemAcceptDragProcPtr" target="_top">DataBrowserItemAcceptDragProcPtr</a></code>), which is invoked after your item-drag callback starts a drag operation, determines whether or not the associated item can accept the drag object.</p></li><li class="li"><p>The item-receive callback (<code><a href="../../../Reference/databrow_reference/Reference/reference.html#//apple_ref/doc/c_ref/DataBrowserItemReceiveDragProcPtr" target="_top">DataBrowserItemReceiveDragProcPtr</a></code>), which is called after your item-accept-drag callback has determined that a location can accept a drag object. Your application takes whatever actions are necessary to add the dropped data to the data browser.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../databrowser_concepts/databrowser_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../databrowser_revhistory/databrowser_hx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-08-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/display_databrowser/databrowser_tasks/databrowser_tasks.html%3Fid%3DTP30000968-1.4&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/display_databrowser/databrowser_tasks/databrowser_tasks.html%3Fid%3DTP30000968-1.4&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/display_databrowser/databrowser_tasks/databrowser_tasks.html%3Fid%3DTP30000968-1.4&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>