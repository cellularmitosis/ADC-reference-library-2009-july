<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">

<TITLE> Opening Files</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a><!-- start of banner -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of banner -->

<!-- start of path -->
<font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <a href="../../../../Carbon/index.html#//apple_ref/doc/uid/TP30000420" target="_top">Carbon</a> &gt; <a href="../../../../Carbon/UserExperience-date.html#//apple_ref/doc/uid/TP30000420-TP30000465" target="_top">User Experience</a></font>
<br><br>
<!-- end of path -->

<A HREF="Navigation_Services-12.html"><img src="images/up.gif" border="0" alt="Up"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-12.html"><img src="images/previous.gif" border="0" alt="Previous"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-14.html"><img src="images/next.gif" border="0" alt="Next"></A>
<nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<script type="text/javascript" language="JavaScript"><!--
function loadFrames(){
if (top == self || (parent.frames[1].name != doc))
    top.location.href = '../index.html?' + location.href;
}

if (self != top) {
  // loaded in frames
  document.write('<a href="'+self.location+'" target="_top"><img src="images/hideframes.gif" border="0" alt="Hide Frames"></a>');
  }
else {
  // not loaded frames
	document.write('<a href="JavaScript:loadFrames()"><img src="images/showframes.gif" border="0" alt="Show Frames"></a>');

}
//--></script>
<!-- end Show/Hide frames -->
<HR>
</DIV>
<A NAME="elementId-1011380"></A><A NAME="pgfId-1014907"></A><H1 CLASS="Head2">
<A NAME="26148"></A>Opening Files</H1>
<P CLASS="Para">
<A NAME="pgfId-1014917"></A>The function <CODE CLASS="otherCodeCharacters">
NavGetFile</CODE>
 displays an Open dialog box that prompts the user to select one or more files to open, as shown in Figure 2-1.</P>
<A NAME="pgfId-1014936"></A><H5 CLASS="FigureCaption">
<A NAME="BBJDEFEH"></A>Figure 2-1	<A NAME="38612"></A>Open dialog box</H5>
<DIV>
<IMG SRC="Art/NS-S-24.gif">
</DIV>
<P CLASS="Para">
<A NAME="pgfId-1011444"></A>For a description of the elements of an Open dialog box, see User Interface.</P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1011455"></A>Note: You are strongly encouraged to make all Navigation Services dialog boxes movable by providing an event-handling function. For more information, see Handling Events.</BLOCKQUOTE>
<DIV CLASS="Section">
<A NAME="elementId-1011447"></A><A NAME="pgfId-1028385"></A><H2 CLASS="Head3">
<A NAME="BBJCEAHJ"></A><A NAME="38400"></A>Providing File Opening Options</H2>
<P CLASS="Para">
<A NAME="pgfId-1028410"></A>The Open dialog box's Show pop-up menu allows the user to choose the file types displayed by the browser list. The list of available file types is built from information provided by your application when it calls the <CODE CLASS="otherCodeCharacters">
NavGetFile</CODE>
 function and by the Translation Manager. If you don't want the Show pop-up menu button to be displayed, specify the <CODE CLASS="otherCodeCharacters">
kNavNoTypePopup</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of a structure of type <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 when you pass this structure in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter of a file-opening function such as <CODE CLASS="otherCodeCharacters">
NavGetFile</CODE>
.</P>
<P CLASS="Para">
<A NAME="pgfId-1011494"></A>Navigation Services uses the Translation Manager to produce a list of file types that your application is capable of translating and displays the list to the user through an expanded Show pop-up menu. Figure 2-2 shows an example of a Show pop-up menu with file translation options.</P>
<A NAME="pgfId-1011516"></A><H5 CLASS="FigureCaption">
<A NAME="BBJDEJAC"></A>Figure 2-2	<A NAME="25721"></A>A Show pop-up menu with file translation options</H5>
<DIV>
<IMG SRC="Navigation_Services-9.gif">
</DIV>
<P CLASS="Para">
<A NAME="pgfId-1011522"></A>The first section of the Show menu contains an item called &quot;All Readable Documents.&quot; If the user selects this item, the browser list displays all files of the types shown in the second and third sections of the menu.</P>
<P CLASS="Para">
<A NAME="pgfId-1013601"></A>The second section of the Show menu contains an item called &quot;All &lt;app name&gt; Documents&quot; followed by your application's &quot;native&quot; file types. Native file types are those types you provide in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter of the file-opening function. This parameter uses the same format as an <CODE CLASS="otherCodeCharacters">
'open'</CODE>
 resource and may be loaded from a resource or passed in as a <CODE CLASS="otherCodeCharacters">
NavTypeList</CODE>
 structure created on the fly. </P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1013627"></A>Note: Navigation Services does not automatically load an <CODE CLASS="otherCodeCharacters">
'open'</CODE>
 resource. Your application must pass a pointer to it in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter of the file-opening function.</BLOCKQUOTE>
<P CLASS="Para">
<A NAME="pgfId-1028446"></A>Your application must also contain a <CODE CLASS="otherCodeCharacters">
'kind'</CODE>
 resource with entries for each type of file that you want to include in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter. If you don't provide an entry for a file type, Navigation Services returns a result of <CODE CLASS="otherCodeCharacters">
kNavMissingKindStringErr</CODE>
 (-5699). For more information on <CODE CLASS="otherCodeCharacters">
'kind'</CODE>
 resources, see <SPAN CLASS="emphasis">
Inside Macintosh: More Macintosh Toolbox</SPAN>
.</P>
<P CLASS="Para">
<A NAME="pgfId-1030893"></A>Listing a file type in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter generally limits you to displaying only those files created by your application. If you specify the <CODE CLASS="otherCodeCharacters">
kNavNoTypePopup</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 structure you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter, or if the user selects All Readable Items from the Show menu, Navigation Services will ignore the application signature specified in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter and display all documents of the specified types. If you choose not to specify file types in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter, you can show all files of a particular type in the browser list by using an application-defined filter function. Using a filter function would, for example, allow you to show all text files, regardless of which application created them. For more information on filter functions, see Filtering File Objects.</P>
<P CLASS="Para">
<A NAME="pgfId-1028506"></A>The third section of the expanded Show pop-up menu contains a list of translatable file types provided by the Translation Manager. Typical names for these entries describe an application document type, such as &quot;MoviePlayer document&quot; in Figure 2-2. Navigation Services automatically opens and translates file types recognized by the Translation Manager unless you supply the <CODE CLASS="otherCodeCharacters">
kNavDontAutoTranslate</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 structure you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter. </P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1028583"></A>Note: The translatable files section does not appear if you supply the <CODE CLASS="otherCodeCharacters">
kNavDontAddTranslateItems</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 structure you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter.</BLOCKQUOTE>
<P CLASS="Para">
<A NAME="pgfId-1028606"></A>The last section of the pop-up menu is reserved for the &quot;All Documents&quot; menu item. This item appears if your application supplies the <CODE CLASS="otherCodeCharacters">
kNavAllFilesInPopup</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 structure you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter. This option allows the display of all files, regardless of your application's ability to translate or open them directly. A resource editing application, for example, might take advantage of this option.</P>
</DIV>
<DIV CLASS="Section">
<A NAME="elementId-1011704"></A><A NAME="pgfId-1011712"></A><H2 CLASS="Head3">
<A NAME="BBJDCCIJ"></A><A NAME="25214"></A>Translating Files on Open</H2>
<P CLASS="Para">
<A NAME="pgfId-1028635"></A>If the user selects a file type that is not passed in the <CODE CLASS="otherCodeCharacters">
typeList</CODE>
 parameter, the chosen file must be translated. If the user opens a file called &quot;Doc1&quot; that requires translation, Navigation Services creates a new file called &quot;Doc1 (converted)&quot; with the appropriate file type, in the same directory as the original file. The <CODE CLASS="otherCodeCharacters">
NavGetFile</CODE>
 function automatically performs the translation before returning. However, you can disable this feature by supplying the <CODE CLASS="otherCodeCharacters">
kNavDontAutoTranslate</CODE>
 constant in the <CODE CLASS="otherCodeCharacters">
dialogOptionFlags</CODE>
 field of the structure of type <CODE CLASS="otherCodeCharacters">
NavDialogOptions</CODE>
 you pass in the <CODE CLASS="otherCodeCharacters">
dialogOptions</CODE>
 parameter of the file-opening function. If you disable automatic translation, it is left to your application to call the function <CODE CLASS="otherCodeCharacters">
NavTranslateFile</CODE>
 as needed. </P>
<P CLASS="Para">
<A NAME="pgfId-1015943"></A>You can obtain translation information from the structure of type <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
 that you passed in the <CODE CLASS="otherCodeCharacters">
reply</CODE>
 parameter of the file-opening function. When the file-opening function returns, the <CODE CLASS="otherCodeCharacters">
fileTranslation</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
 structure points to an array of translation records. This array contains one translation record for each file selection identified in the <CODE CLASS="otherCodeCharacters">
selection</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
 structure. If you disable automatic translation, you can use the translation records to provide your own translation.</P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1028668"></A>Note: If a file described in the <CODE CLASS="otherCodeCharacters">
selection</CODE>
 field of the <CODE CLASS="otherCodeCharacters">
NavReplyRecord</CODE>
 structure does not require translation, its corresponding translation record will be empty.</BLOCKQUOTE>
</DIV>
<DIV CLASS="Section">
<A NAME="elementId-1011802"></A><A NAME="pgfId-1011807"></A><H2 CLASS="Head3">
<A NAME="BBJCHBFD"></A>A Sample File-Opening Function</H2>
<P CLASS="Para">
<A NAME="pgfId-1014738"></A>Listing 2-1 shows a sample function illustrating one way to call the function <CODE CLASS="otherCodeCharacters">
NavGetFile</CODE>
. This listing shows how to get default options, modify the options, use an <CODE CLASS="otherCodeCharacters">
'open'</CODE>
 resource, and open multiple files.</P>
<BLOCKQUOTE CLASS="Note">
<A NAME="pgfId-1014778"></A>Note: This listing and other code samples in this document show how to handle an Apple event descriptor of type <CODE CLASS="otherCodeCharacters">
'typeFSS'</CODE>
. Your application should not assume that Navigation Services returns descriptors of any particular type.</BLOCKQUOTE>
<PRE CLASS="CodeLines-Container"><A NAME="pgfId-1028700"></A><H5 CLASS="CodeCaption"><A NAME="BBJCDGBI"></A>Listing 2-1	<A NAME="29249"></A>A sample file-opening function</H5>
<A NAME="pgfId-1032160"></A>OSErr MyOpenDocument(const FSSpecPtr defaultLocationfssPtr)
{
    NavDialogOptions    dialogOptions;
    AEDesc              defaultLocation;
    NavEventUPP         eventProc = NewNavEventProc(myEventProc);
    NavObjectFilterUPP  filterProc = 
                        NewNavObjectFilterProc(myFilterProc);
    OSErr               anErr = noErr;
    
    //  Specify default options for dialog box
    anErr = NavGetDefaultDialogOptions(&amp;dialogOptions);
    if (anErr == noErr)
    {
        //  Adjust the options to fit our needs
        //  Set default location option
        dialogOptions.dialogOptionFlags |= kNavSelectDefaultLocation;
        //  Clear preview option
        dialogOptions.dialogOptionFlags ^= kNavAllowPreviews;
        
        // make descriptor for default location
        anErr = AECreateDesc(typeFSS, defaultLocationfssPtr,
                             sizeof(*defaultLocationfssPtr),
                             &amp;defaultLocation );
        if (anErr == noErr)
        {
            // Get 'open' resource. A nil handle being returned is OK,
            // this simply means no automatic file filtering.
            NavTypeListHandle typeList = (NavTypeListHandle)GetResource(
                                        'open', 128);
            NavReplyRecord reply;
            
            // Call NavGetFile() with specified options and
            // declare our app-defined functions and type list
            anErr = NavGetFile (&amp;defaultLocation, &amp;reply, &amp;dialogOptions,
                                eventProc, nil, filterProc,
                                typeList, nil);
            if (anErr == noErr &amp;&amp; reply.validRecord)
            {
                //  Deal with multiple file selection
                long    count;
                
                anErr = AECountItems(&amp;(reply.selection), &amp;count);
                // Set up index for file list
                if (anErr == noErr)
                {
                    longindex;
                    
                    for (index = 1; index &lt;= count; index++)
                    {
                        AEKeyword   theKeyword;
                        DescType    actualType;
                        Size        actualSize;
                        FSSpec      documentFSSpec;
                        
                        // Get a pointer to selected file
                        anErr = AEGetNthPtr(&amp;(reply.selection), index,
                                            typeFSS, &amp;theKeyword,
                                            &amp;actualType,&amp;documentFSSpec,
                                            sizeof(documentFSSpec),
                                            &amp;actualSize);
                        if (anErr == noErr)
                        {
                            anErr = DoOpenFile(&amp;documentFSSpec);
                        }
                    }
                }
                //  Dispose of NavReplyRecord, resources, descriptors
                anErr = NavDisposeReply(&amp;reply);
            }
            if (typeList != NULL)
            {
                ReleaseResource( (Handle)typeList);
            }
            (void) AEDisposeDesc(&amp;defaultLocation);
        }
    }
    DisposeRoutineDescriptor(eventProc);
    DisposeRoutineDescriptor(filterProc);
    return anErr;
}
</PRE>
<P CLASS="Para">
<A NAME="pgfId-1014792"></A>Listing 2-2 illustrates how your application can open a list of documents by sending itself Apple events.</P>
<PRE CLASS="CodeLines-Container"><A NAME="pgfId-1011879"></A><H5 CLASS="CodeCaption"><A NAME="BBJECADG"></A>Listing 2-2	<A NAME="28179"></A>A sample file-opening function using Apple events</H5>
<A NAME="pgfId-1032168"></A>static void MyOpenWithEvent(FSSpecPtr defaultLocationfssPtr)
{
    AEDesc              defaultLocation;
    NavReplyRecord      navReply;
    NavDialogOptions    dialogOptions;
    NavTypeListHandle   typeList;
    NavEventUPP         eventProc = NewNavEventProc(myEventProc);
    NavObjectFilterUPP  filterProc = 
                        NewNavObjectFilterProc(myFilterProc);
    OSErr               anErr = noErr;
    
    //  Specify default options for dialog box
    anErr = NavGetDefaultDialogOptions( &amp;dialogOptions );
    if (anErr == noErr)
    {
        //  Adjust options to fit our needs
        //  Set default location option
        dialogOptions.dialogOptionFlags |= kNavSelectDefaultLocation;
        //  Clear preview option
        dialogOptions.dialogOptionFlags ^= kNavAllowPreviews;
        
        // make descriptor for default location
        anErr = AECreateDesc(typeFSS, defaultLocationfssPtr,
                             sizeof(*defaultLocationfssPtr),
                             &amp;defaultLocation );
        if (anErr == noErr)
        {
            // Get 'open' resource. A nil handle being returned is OK,
            // this simply means no automatic file filtering.
            typeList = (NavTypeListHandle) GetResource('open', 128);
            
            // Call NavGetFile() with specified options and
            // declare our app-defined functions and type list
            anErr = NavGetFile (&amp;defaultLocation, &amp;navReply,
                                &amp;dialogOptions, eventProc,
                                nil, filterProc, typeList, nil);
    
    if (anErr == noErr &amp;&amp; navReply.validRecord)
    {
        // Obtain process number, set up Apple events
        ProcessSerialNumber processSN = {0, kCurrentProcess};
        AEAddressDesc       targetAddress = {typeNull, nil};
        AppleEvent          theEvent = {typeNull, nil};
        AppleEvent          theReply = {typeNull, nil}

        //  This event is targeted at the current application
        anErr = AECreateDesc(typeProcessSerialNumber, &amp;processSN,
                             sizeof(ProcessSerialNumber),
                             &amp;targetAddress);
        if ( anErr == noErr )
        {
            //  Create an open documents Apple event
            anErr = AECreateAppleEvent(kCoreEventClass, kAEOpenDocuments,
                                        &amp;targetAddress,
                                        kAutoGenerateReturnID,
                                        kAnyTransactionID, &amp;theEvent);
            (void) AEDisposeDesc(&amp;targetAddress);
        }
        if (anErr == noErr)
        {
            //  Put file list into open document Apple event
            anErr = AEPutParamDesc( &amp;theEvent, keyDirectObject,
                                    &amp;(navReply.selection) );
        }
        if (anErr == noErr)
        {
            //  Send open doc event to our app and dispose of descriptors
            anErr = AESend( &amp;theEvent, &amp;theReply, kAENoReply,
                            kAENormalPriority,
                            kAEDefaultTimeout, nil, nil);
            (void) AEDisposeDesc(&amp;theEvent);
            (void) AEDisposeDesc(&amp;theReply);
        }
        (void) NavDisposeReply(&amp;navReply);
    }
    return;
}
</PRE>
</DIV>
<HR>&#169; 2000 Apple Computer, Inc. (Last Updated 18 April 00)<P>
<A HREF="Navigation_Services-12.html"><img src="images/up.gif" border="0" alt="Up"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-12.html"><img src="images/previous.gif" border="0" alt="Previous"></A>
<nobr>&nbsp;</nobr>
<A HREF="Navigation_Services-14.html"><img src="images/next.gif" border="0" alt="Next"></A>
<nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<script type="text/javascript" language="JavaScript"><!--
function loadFrames(){
if (top == self || (parent.frames[1].name != doc))
    top.location.href = '../index.html?' + location.href;
}

if (self != top) {
  // loaded in frames
  document.write('<a href="'+self.location+'" target="_top"><img src="images/hideframes.gif" border="0" alt="Hide Frames"></a>');
  }
else {
  // not loaded frames
	document.write('<a href="JavaScript:loadFrames()"><img src="images/showframes.gif" border="0" alt="Show Frames"></a>');

}
//--></script>
<!-- end Show/Hide frames -->
<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer -->
</BODY>
</HTML>
