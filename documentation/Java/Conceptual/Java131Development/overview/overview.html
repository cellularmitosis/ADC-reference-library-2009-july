<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Java 1.3.1 Development for Mac OS X (Legacy): How Java Is Implemented in Mac OS X</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How Java Is Implemented in Mac OS X"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000705" title="How Java Is Implemented in Mac OS X"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/Java-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000528" target="_top">Java</a> &gt; <a href="../about/about.html#//apple_ref/doc/uid/TP30000704-DontLinkElementID_24">Java 1.3.1 Development for Mac OS X (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../about/about.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../deploying/deploying.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_65" title="How Java Is Implemented in Mac OS X"></a><h1><a name="//apple_ref/doc/uid/TP30000705-TPXREF101" title="How Java Is Implemented in Mac OS X"></a>How Java Is Implemented in Mac OS X</h1><p>Java is included in every copy of Mac OS X and Mac OS X Server. Mac OS X provides full support for Java 2 Platform, Standard Edition (J2SE), and support for much of Java 2 Platform, Enterprise Edition (J2EE).</p><p>Because of the emphasis Apple has placed on integrating Java into the operating system, there are many benefits to developing and deploying Java applications on Mac OS X rather than other platforms. In Mac OS X, Java is not an add-on feature, but an integral part of the operating system. This means that you do not need to deal with installing and configuring the Java Runtime Environment (JRE) or the Java Development Kit (JDK) as you, or the end users of your application, might need to on other platforms. In addition to the Java pieces you are already familiar with, Apple provides extensions and enhancements to these standard Java APIs as well as Java access to some of Apple’s other technologies. With Java on Mac OS X, Apple provides all that you expect in a standard Java 2 implementation while providing the extra value that makes it better on the Macintosh for you as a developer and for your customers.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="overview.html#//apple_ref/doc/uid/TP30000705-TPXREF102">Java Integration in the Operating System</a>
				
			<br/>
			
        
			
			
				<a href="overview.html#//apple_ref/doc/uid/TP30000705-TPXREF105">What Is Included</a>
				
			<br/>
			
        
			
			
				<a href="overview.html#//apple_ref/doc/uid/TP30000705-TPXREF116">Java 2D Graphics Implementation</a>
				
			<br/>
			
        
			
			
				<a href="overview.html#//apple_ref/doc/uid/TP30000705-TPXREF106">The Virtual Machine</a>
				
			<br/>
			
        
			
			
				<a href="overview.html#//apple_ref/doc/uid/TP30000705-TPXREF130">Environmental Differences</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000705-TPXREF102" title="Java Integration in the Operating System"></a><h2>Java Integration in the Operating System</h2><p>At the core of Mac OS X lives a BSD-style UNIX-based operating system called Darwin. On top of that, Apple has built a collection of fundamental technologies for presenting graphics and sound to users far beyond what has been traditionally available in a UNIX-based operating system. Further collections of tools, event loops, and functions/methods yield high-level APIs for application developers. These include:</p><ul class="ul"><li class="li"><p>Carbon for traditional Macintosh developers<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_168"></a></p></li><li class="li"><p>Cocoa, an object-oriented application development environment<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_169"></a></p></li><li class="li"><p>Java, an object-oriented environment for building cross-platform applications</p></li></ul><p><span class="content_text"><a href="overview.html#//apple_ref/doc/uid/TP30000705-BAJDIAAG">Figure 2-1</a></span> depicts the conceptual layout of the Mac OS X operating system. A more extensive analysis of the system as a whole is available in <em>Inside Mac OS X: System Overview</em>. </p><br/><div><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_66" title="Figure 2-1Architecture of Mac OS X"></a><p><a name="//apple_ref/doc/uid/TP30000705-BAJDIAAG" title="Figure 2-1Architecture of Mac OS X"></a><strong>Figure 2-1&nbsp;&nbsp;</strong>Architecture of Mac OS X</p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_170"></a><img src = "../art/cocoajava.gif" alt = "Architecture of Mac OS X" width="276" height="152"></div><br/><p>One of the most obvious advantages of the integration of Java into the operating system can be seen in the user interface of any Swing application. Java on Mac OS X includes a default Aqua look and feel for your Swing applications. You can see from <span class="content_text"><a href="overview.html#//apple_ref/doc/uid/TP30000705-BCIFJHGE">Figure 2-2</a></span> how this can really make your Java applications look great compared to the default look and feel, Metal.</p><br/><div><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_67" title="Figure 2-2Metal and Aqua look and feel on Mac OS X"></a><p><a name="//apple_ref/doc/uid/TP30000705-BCIFJHGE" title="Figure 2-2Metal and Aqua look and feel on Mac OS X"></a><strong>Figure 2-2&nbsp;&nbsp;</strong>Metal and Aqua look and feel on Mac OS X</p><img src = "../art/junit_theme.gif" alt = "Metal and Aqua look and feel on Mac OS X" width="636" height="479"></div><br/><p>Because Mac OS X is a UNIX-based operating system, you have access to BSD tools and technologies useful in software development. You are working with the foundation of a robust, powerful operating system that gives you preemptive multitasking and protected memory.</p><p>In Mac OS X you can also take advantage of the operating system’s other fundamental features. For example, in Mac OS X you can take advantage of the cross-platform QuickTime API through QuickTime for Java. Apple also provides Java access to the Core Audio framework of Mac OS X, OpenGL, Quartz, the Mac OS X font implementation (with support for OpenType, PostScript Type I and TrueType fonts), the Mac OS X spelling and speech frameworks, and the Foundation and Application Kit frameworks of Cocoa.</p><a name="//apple_ref/doc/uid/TP30000705-TPXREF105" title="What Is Included"></a><h2>What Is Included</h2><p>Mac OS X ships with the Java 2 Platform, Standard Edition (J2SE) 1.3.1. Full support of Java 2 means that there is first-class support for Swing, the Collections framework, the Accessibility API, and other APIs from Sun. Support for applets that require Java 2 is also provided. You will also find implementations of the Java2D graphics architecture and the policy-based security model. <a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_171"></a>In addition to the standard parts of J2SE, Mac OS X includes Java Web Start and the security frameworks as well as some packages that were formerly available as part of the Java 2 Enterprise Edition (J2EE) like Remote Method Invocation (RMI) over IIOP, the Java Naming and Directory Interface<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_172"></a> (JNDI), and the Java Database Connectivity (JDBC)<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_173"></a> model.</p><p>The Java implementation is installed in<code> /System/Library/Frameworks/JavaVM.framework</code><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_174"></a>. This includes the virtual machine, the command-line tools, the runtime classes, and the API documentation.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_175"></a> Additional tools and documentation are included with the free Mac OS X Developer Tools and are installed in <code>/Developer/Tools</code> and <code>/Developer/Documentation</code>, respectively.</p><p>The basic command-line tools are installed in <code>/System/Library/Frameworks/JavaVM.framework/Commands</code> with links from <code>/usr/bin</code> so that your scripts and tools work on Mac OS X like they would on other platforms.</p><p>For the most part, the Java 2 Platform Standard Edition version 1.3.1 works on Mac OS X like it does on other platforms. The standard packages you expect to find are all included in every installation of Mac OS X, as are the basic development tools. With the Mac OS X Developer Tools installed, you have a complete Java Development environment as illustrated in </p><br/><div><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_68" title="Figure 2-3Mac OS X as a Java development platform"></a><p><a name="//apple_ref/doc/uid/TP30000705-TPXREF127" title="Figure 2-3Mac OS X as a Java development platform"></a><strong>Figure 2-3&nbsp;&nbsp;</strong>Mac OS X as a Java development platform</p><img src = "../art/java131puzzle.gif" alt = "Mac OS X as a Java development platform" width="390" height="177"></div><br/><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_176"></a>Although the <code>java.sound</code> packages are included with Java in Mac OS X, you cannot currently use them for sound input. You can work around this by using Mac OS X native audio system. You can find more information about the audio architecture of Mac OS X at <span class="content_text"><a href="http://developer.apple.com/audio" target="_top">http://developer.apple.com/audio</a></span>. Specific options for providing audio functionality to your Java application in Mac OS X include these:<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_177"></a></p><ul class="ul"><li class="li"><p>Use QuickTime for Java-based services. This works on Mac OS 9, Mac OS X, and Windows.</p></li><li class="li"><p>Use the Core Audio framework. This API is for Mac OS X only and provides Java classes to access the underlying Core Audio platform services for audio and MIDI in Mac OS X.</p></li><li class="li"><p>Use JNI to provide a native binding to the Core Audio framework directly.</p></li></ul><a name="//apple_ref/doc/uid/TP30000705-TPXREF116" title="Java 2D Graphics Implementation"></a><h2>Java 2D Graphics Implementation</h2><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_178"></a><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_179"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_180"></a>The Mac OS X implementation of the Java2D API is based on Apple’s Quartz graphics engine. The Quartz graphics system improves drawing quality over other platforms’ Java 2D implementation. Because Java on Mac OS X draws its graphics with Quartz, you might notice that images drawn do not match the Sun Java 2D implementation pixel for pixel, especially when anti-aliasing is on. This is because Quartz’s anti-aliasing algorithms for both line art and text are different from Sun’s default implementations, so the rendered pixels do not match exactly. Since anti-aliasing is implemented through the operating system itself, it does not hinder graphics performance. Turning it off for your Java application will probably not affect the speed up your code.</p><p>In Mac OS X, windows are double-buffered, this includes Java windows. Java on Mac OS X attempts to flush the buffer to the screen often enough to have good drawing behavior without compromising performance. If for some reason you need to force window buffers to be flushed immediately, you may do so with <code>Toolkit.sync</code>.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_181"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_182"></a></p><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_183"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_184"></a>Mac OS X provides hardware graphics acceleration for your Java Swing graphics on computers whose video cards have 16 MB or more of video RAM. If enabled, this technology passes Swing and Java 2D graphics calls directly to the video card. This can result in significant speed increases for your graphics-intensive Java applications. See <span class="content_text"><a href="../value_add/value_add.html#//apple_ref/doc/uid/TP30000709-TPXREF120">“Modifying the Default Settings for Hardware Graphics Acceleration”</a></span> for information on changing the default settings of the hardware graphics acceleration.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_185"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_186"></a></p><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_187"></a>Anti-aliasing is on by default for text and graphics, but it can be turned off using the properties described in <span class="content_text"><a href="../system_properties/system_properties.html#//apple_ref/doc/uid/TP30000712-BAJGDFHB">“Mac OS X–Specific Properties,”</a></span> or by calling <code>java.awt.Graphics.setRenderingHint</code> within your Java application. With anti-aliasing on, drawing shapes over each other may cause different results than in Java 1.1. For example, drawing a white line on top of a black line does not completely erase the line; the compositing rules leave some gray pixels around the edges. Also, drawing text multiple times in the same place causes the partially-covered pixels along the edges to get darker and darker, making the text look smudged.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_188"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_189"></a></p><a name="//apple_ref/doc/uid/TP30000705-TPXREF106" title="The Virtual Machine"></a><h2>The Virtual Machine</h2><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_190"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_191"></a><p>The Java platform for Mac OS X is based on the Java HotSpot client virtual machine (VM) from the Sun JDK 1.3.1_03 technology train. Because the VM is based on the HotSpot VM, synching is a low overhead operation. The VM maps Java threads directly to Mach threads. The Darwin kernel (XNU) schedules these Mach threads as it would schedule any other threads in the system giving you true preemptive multitasking.</p><p>One unique aspect of the Mac OS X Java implementation is its use of a technology to enable shared generation of class files. A single shared Java archive for the Java classes in the system is generated once. This archive is regenerated when you update Java. Since each Java application does not need to generate an independent archive at runtime you save both memory and CPU cycles.</p><p>The <code>-server</code> option to Java is different in Mac OS X than on other platforms in that it doesn’t invoke a different VM. The Java VM is the same Java HotSpot Client VM technology. Using the <code>-server</code> flag however, does change a few default settings to values more appropriate to a server type program. For example, a different shared archive generation is used. On Mac OS X Server <code>-server</code> is the default. On Mac OS X, <code>-client</code> is the default.</p><p>Specific guidelines for interacting with the VM are in the following sections.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_192"></a></p><a name="//apple_ref/doc/uid/TP30000705-TPXREF128" title="Performance Profiling Tools"></a><h3>Performance Profiling Tools</h3><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_193"></a><p>To get the most out of your Java applications, you can take advantage of the performance and profiling tools available to you in Mac OS X. Built-in profiling support is provided in flags you can pass in to the VM at runtime. For basic CPU monitoring and profiling, use the <code>-Xrunhprof</code> flag as follows:</p><ul class="spaceabove"><li class="li"><p><code>java -Xrunhprof:cpu=sample</code><em>yourApplication</em></p></li><li class="li"><p><code>java -Xrunhprof:monitor=y</code><em>yourApplication</em></p></li></ul><p>For allocation profiling use the <code>-Xaprof</code> flag. To profile a single thread use <code>-Xprof</code>.</p><p>Third-party tools like Borland’s Optimizeit and Hewlet Packard’s <code>HPjmeter</code> are also valuable tools.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_194"></a></p><a name="//apple_ref/doc/uid/TP30000705-TPXREF110" title="Nonstandard Virtual Machine Options"></a><h3>Nonstandard Virtual Machine Options</h3><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_195"></a>The Mac OS X Java VM includes some nonstandard VM options that you should be aware of. Since these are nonstandard (<code>-X</code>) options, you should keep in mind that these are not guaranteed to be available on other VM implementations, and could change from release to release. These options are set by passing a <code>-X</code><em>optionname</em> flag to the Java runtime (<code>java</code>). You can also see a list of available options by typing <code>java -X</code> in a Terminal window. VM options that have important details to note about them are outlined in <span class="content_text"><a href="overview.html#//apple_ref/doc/uid/TP30000705-BAJEBBAJ">Table 2-1</a></span>. </p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_69" title="Table 2-1HotSpot VM options"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/TP30000705-BAJEBBAJ" title="Table 2-1HotSpot VM options"></a><strong>Table 2-1&nbsp;&nbsp;</strong>HotSpot VM options</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Notes</p></th></tr><tr><td  scope="row"><p><code>-Xdock:name=</code><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_196"></a><em>applicationName</em></p></td><td ><p>Overrides the default application name displayed in the Dock and the menu bar.</p></td></tr><tr><td  scope="row"><p><code>-Xincgc</code></p></td><td ><p>This option is disabled in Mac OS X version 10.2.</p></td></tr><tr><td  scope="row"><p><code>-Xms<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_197"></a></code><em>size</em></p></td><td ><p>Sets the initial Java heap size. The maximum heap limit is about 2 GB.</p></td></tr><tr><td  scope="row"><p><code>-Xms<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_198"></a></code><em>size</em></p></td><td ><p>Sets the initial Java heap size. The maximum heap limit is about 2 GB.</p></td></tr><tr><td  scope="row"><p><code>-Xmx<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_199"></a></code><em>size</em></p></td><td ><p>Sets maximum Java heap size. The maximum heap limit is about 2 GB.</p></td></tr><tr><td  scope="row"><p><code>-XX:+UseTLE</code><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_200"></a></p></td><td ><p>Enables Apple’s thread local eden (TLE) allocation. This allows for more scalable allocation for heavily threaded applications, greatly increasing allocation performance. It is on by default on multiprocessor computers.</p></td></tr><tr><td  scope="row"><p><code>-XX:+PrintJavaStackAtFatalState<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_201"></a></code></p></td><td ><p>Enable Java backtraces to be generated when a crash occurs in native code. Note that this is not guaranteed to work all the time since the crash may destroy some critical data structures.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_202"></a></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000705-TPXREF114" title="The Java Native Interface"></a><h3>The Java Native Interface</h3><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_203"></a><p>Java Native Interface (JNI) in Mac OS X works as you would expect it to on other platforms with a couple of important details to remember. </p><p>JNI libraries are named with the library name used in the <code>System.loadLibrary</code> method of your Java code prefixed by <code>lib</code> and suffixed with <code>.jnilib</code>. For example, <code>System.loadLibrary("hello") </code>loads the library named <code>libhello.jnilib</code>.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_204"></a></p><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_205"></a>In building your JNI libraries, you have two options. You can either build them as bundles or as dynamic shared libraries (sometimes called dylibs). If you are concerned about maintaining backward compatibility with previous versions of Java on Mac OS X, you should build as a bundle; otherwise you will probably want to build as a dylib. Dylibs have the added value of being able to be prebound which speeds up the launch time of your application. They are also a little simpler to build if you have multiple libraries to link together.</p><p>To build as a dynamic shared library, use the <code>-dynamiclib</code> flag. Since your <code>javah</code> produced <code>.h</code> file includes <code>jni.h</code>, you need to make sure you include its source directory. Putting all of that together looks something like this:</p><p><code>cc -c -I/System/Library/Frameworks/JavaVM.framework/Headers</code><em>sourceFile.c</em></p><p><code>cc -dynamiclib -o  libhello.jnilib</code><em>sourceFile.o</em><code>-framework JavaVM</code></p><p>To build a JNI library as a bundle use the <code>-bundle</code> flag:</p><p><code>cc -bundle -I/System/Library/Frameworks/JavaVM.framework/Headers -o libName.jnilib -framework JavaVM</code><em>sourceFiles</em></p><p>For example, if the files <code>hello.c</code> and <code>hola.c</code> contain the implementations of the native methods to be built into a dynamic shared JNI library, and it needs to be called with <code>System.loadLibrary</code>(“hello”), you would build the resultant library, <code>libhello.jnilib</code>, with this code: </p><div class="codesample"><table><tr><td scope="row"><pre>cc -c -I/System/Library/Frameworks/JavaVM.framework/Headers hola.c<span></span></pre></td></tr><tr><td scope="row"><pre>cc -c -I/System/Library/Frameworks/JavaVM.framework/Headers hello.c<span></span></pre></td></tr><tr><td scope="row"><pre>cc -dynamiclib -o libhello.jnilib hola.o hello.o -framework JavaVM<span></span></pre></td></tr></table></div><p>Often JNI libraries have interdependencies. For example assume the following:</p><ul class="spaceabove"><li class="li"><p><code>libA.jnilib</code> contains a function <code><!--a-->foo()<!--/a--></code></p></li><li class="li"><p><code>libB.jnilib</code> needs to link against<code> libA.jnilib</code> to make use of <code><!--a-->foo()<!--/a--></code></p></li></ul><p>This is not a problem if you build your JNI libraries as dynamic shared libraries, but if you build them as bundles this does not work since symbols are private to a bundle. If you need to use bundles for backward compatibility, one solution is to put the common functions into a separate dynamic shared library and link that to the bundle. For example:</p><ol class="ol"><li class="li"><p>Compile the JNI library: </p><p><code>cc -g -I/System/Library/Frameworks/JavaVM.framework/Headers -c -o myJNILib.o myJNILib.c</code></p></li><li class="li"><p>Compile the file with the common functions: </p><p><code>cc -g -I/System/Library/Frameworks/JavaVM.framework/Headers -c -o CommonFunctions.o CommonFunctions.c</code></p></li><li class="li"><p>Build the object file for your common functions as a dynamic shared library: </p><p><code>cc -dynamiclib  -o libCommonFunctions.dylib CommonFunctions.o</code></p></li><li class="li"><p>Build your JNI library as a bundle and link against the dynamic shared library with your common functions in it: </p><p><code>cc -bundle -lCommonFunctions -o libMyJNILib.jnilib myJNILib.o</code></p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_70" title="Note"></a><p><strong>Note:</strong>&nbsp;Once you have built your JNI libraries, make sure to let Java know where they are. You can do this either by passing in the path with the <code>-Djava.library.path</code> option on the command line or in your information property list, or by setting the <code>DYLD_LIBRARY_PATH </code>environment variable.</p></div><p>You can also access native code libraries through JDirect. See <span class="content_text"><a href="../value_add/value_add.html#//apple_ref/doc/uid/TP30000709-TPXREF119">“JDirect”</a></span> for more information on using this Mac–specific technology.</p><a name="//apple_ref/doc/uid/TP30000705-TPXREF130" title="Environmental Differences"></a><h2>Environmental Differences</h2><p>Although the Aqua user interface may belie it, behind the scenes Mac OS X is a UNIX-based operating system. The things you expect to be there are indeed there. At times, however, pieces might be in a slightly different spot than you expect. To make your experience on Mac OS X as smooth as possible, this section looks at where you might expect to find things on Mac OS X and also addresses some of the issues of environment variables.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_71" title="Note"></a><p><strong>Note:</strong>&nbsp;You can access the command line interface to Mac OS X through the Terminal application in <code>/Applications/Utilities/</code>. Terminal launches your user shell. By default this is <code>tcsh</code>, an enhanced C shell. <code>bash</code>, a Bourne compatible-shell, <code>zsh</code>, a <code>ksh</code>-like shell, and <code>csh</code> are also provided.</p></div><a name="//apple_ref/doc/uid/TP30000705-TPXREF135" title="Finding JAVAHOME"></a><h3>Finding JAVAHOME</h3><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_206"></a><p>Many Java applications require you to identify Java’s home directory on your system (<code>JAVAHOME</code>), especially during installation. On Mac OS X this should be set to <code>/Library/Java/Home</code>. You might notice that this is actually a symbolic link to <code>/System/Library/Frameworks/JavaVM.framework/Home</code>. This is the real Java home directory, but since it is owned by the system you should not modify it, nor should you expect that users will be able to modify it on their system. This directory will be modified by software updates from Apple so any changes you make there are volatile. The<code> /Library/Java/Home</code> symlink is provided as an abstraction so that you can be sure that your applications will continue to work when Apple updates either the Java VM or the operating system itself.<code> /Library/Java/Home</code> allows access to the <code>/bin</code> subdirectory where command-line tools like <code>java</code> and <code>javac</code> can be found. These tools are also accessible through <code>/usr/bin</code>.</p><a name="//apple_ref/doc/uid/TP30000705-BABHECEF" title="Where to Put Extensions"></a><h3>Where to Put Extensions</h3><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_207"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_208"></a>Java can be extended by adding custom <code>.jar</code>, <code>.zip</code>, and <code>.class</code> files, as well as native JNI libraries, into an extensions directory. On some platforms this is designated by the<code> java.ext.dir</code> directory. In Mac OS X, put your extensions in <code>/Library/Java/Extensions</code>. Java automatically looks in that directory as it is starting up a VM.</p><p>Putting extensions in <code>/Library/Java/Extensions</code> loads those extensions for any user on that particular computer. If you want to limit which users can use certain extensions, you could put them in the user’s home directory in <code>~/Library/Java/Extensions</code>. You may need to make that directory if it does not already exist. It is important to note that extensions in the user’s directory are loaded first, so if you have duplicate JAR files in your user’s <code>Library/Java/Extensions</code> directory and the system’s <code>/Library/Java/Extensions</code> directory, those in the latter directory may overload classes in the former.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_209"></a><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_210"></a></p><a name="//apple_ref/doc/uid/TP30000705-TPXREF136" title="Where to Put Preferences"></a><h3>Where to Put Preferences</h3><p><a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_211"></a>Some applications store their preferences in the application directory; others store their preferences where the host platform stores its preferences. In Mac OS X, user preferences for an application are stored in the <code>~/Library/Preferences</code> directory. System-level preferences, or preferences that should effect all users should be stored in <code>/Library/Preferences</code>. The standard preference format in Mac OS X is an XML property list, with a title of the form of a reverse URL followed by the <code>.plist</code> extension, for example <code>com.apple.ProjectBulder.plist</code>. This directory can be reached from Java code by appending the string <code>Library/Preferences</code> to the <code>user.home</code> System property.<a name="//apple_ref/doc/uid/TP30000705-DontLinkElementID_212"></a></p><a name="//apple_ref/doc/uid/TP30000705-TPXREF131" title="Setting the Classpath"></a><h3>Setting the Classpath</h3><p>In Mac OS X, you treat the classpath the way you would in any BSD shell. You can use <code>setenv classpath</code><em>newClasspathAddition</em> to add to the classpath for the duration of the current session for that particular Terminal window. You still have to explicitly add a reference to this variable when compiling by typing <code>javac -classpath %CLASSPATH</code><em>filename</em>. You can determine the current value of <code>CLASSPATH</code> with the command <code>echo $CLASSPATH</code>. By default no <code>CLASSPATH</code> variable is explicitly set for the shell, although Java knows to look in the various <code>Library/Java/Extensions</code> folder for developer-supplied JAR files. </p><p>You can avoid retyping the <code>setenv classpath</code> command for each Terminal session by automatically adding paths to your classpath shell startup script (<code>.cshrc</code> or <code>.tcshrc</code> for the default <code>tcsh</code> shell). For example, find or create <code>~/.cshrc</code>. That file should have a line that looks similar to <code>setenv CLASSPATH ".:/Users/username/Projects/HelloWorld/:/Users/username/Projects/HelloWorld/HelloWorld.jar"</code>. In this example, the current directory, the specific directory of a particular project, and a JAR file in that directory are included in the classpath.</p><a name="//apple_ref/doc/uid/TP30000705-TPXREF117" title="Java Output"></a><h3>Java Output</h3><p>When you launch a Java application from the command line, standard output goes to the Terminal window. When you launch a Java application by double clicking it, your Java output is displayed in the Console application in <code>/Applications/Utilities</code>. Applets that use the Java Plug-in may display output in the Java Console.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../about/about.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../deploying/deploying.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-09-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Java/Conceptual/Java131Development/overview/overview.html%3Fid%3DTP40000885-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Java/Conceptual/Java131Development/overview/overview.html%3Fid%3DTP40000885-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Java/Conceptual/Java131Development/overview/overview.html%3Fid%3DTP40000885-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>