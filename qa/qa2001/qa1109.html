<HTML><HEAD>   <title>Technical Q&amp;A QA1109: The similarity field in ImageCodecBandCompress and Key Frames</title>   <META NAME=GENERATOR CONTENT="Claris Home Page 3.0">   <X-CLARIS-WINDOW TOP=42 BOTTOM=980 LEFT=4 RIGHT=755>   <X-CLARIS-TAGVIEW MODE=minimal><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="CodecCompressParams, Similarity, Key Frames, Image Compression,Compressor, Codec"><meta name="Description" content="Technical Q&amp;A QA1109: This Q&amp;A discusses the similarity fieldof the CodecCompressParams structure used in ImageCodecBandCompressto implement Key Framing during compression."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Jan 14, 2002 - Jan 18, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001657" title="The similarity field in ImageCodecBandCompress and Key Frames"></a><P><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxQuickTimeComponentCreation-date.html">QuickTime Component Creation</a> &gt; </p><!-- end_header_information --> <!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1109</div>
<div id="pageheadsub">The similarity field in ImageCodecBandCompress and Key Frames</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --></P><BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>      <TR>         <td align="left">            <P><!-- begin_content -->                        <hr width=500 align=center>                        </P>                        <P id=p2>Q: Can the ImageCodecBandCompress routine of an            Image Compressor ('imco') Component decide when a            compressed frame will be a key frame or not? Or is the            key frame rate fixed?</P>                        <P id=p2>The only information I can find about this is in            the description of the CodecCompressParams structure</P>                        <P id=p4>A: The key frame rate is not automatically            fixed, the codec can decide on whatever rate is            appropriate. However, the explanation of what the codec            developer needs to do can be confusing.</P>                        <P id=p4>The key (no pun intended) is the similarity            field of the CodecCompressParams structure. This is an            OUT field which you need to fill in to indicate the            similarity between adjacent frames.</P>                        <P><BR>            <BR>            </P>                        <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>               <TR>                  <td bgcolor="#E6E6E6" align=left>                     <pre> typedef struct {   ImageSequence          sequenceID;   ImageDescriptionHandle imageDescription;   ...   Fixed                  similarity; /* similarity between adjacent frames */   ...} CodecCompressParams;                     </pre>                  </TD>               </TR>               <TR>                  <td align="left">                     <P><B>Listing 1</B>. CodecCompressParams</P>                  </TD>               </TR>            </TABLE>            </CENTER>                        <P id=p4><BR>            <BR>            The similarity field of the CodecCompressParams structure            indicates the similarity between adjacent frames when            performing temporal compression. Your component should            return a fixed-point number in this field. This value            indicates the relative similarity between the frame just            compressed and the previous frame. Valid values range            from 0 indicating a key frame to 255 indicating an            identical frame.</P>                        <P id=p4>This field is used only by the            ImageCodecBandCompress function.</P>                        <P id=p4>More accurately, you should use the following            values:</P>                        <P>0x00000000 - Indicates a Key Frame</P>                        <P id=p4>0x00010000 - These values indicate frames that            are not exactly identical to the previous frame</P>                        <P id=p4> ...</P>                        <P id=p4>0x00nn0000</P>                        <P id=p4> ...</P>                        <P id=p4>0x00FE0000</P>                        <P id=p4>0x00FF0000 - Indicates that the frame can be            discarded without damage</P>                        <P id=p4>An Image Compressor should only set the            similarity to 0x00FF0000 if the compressed frame may be            discarded without damage. If bad video would result from            discarding a frame, the Compressor should limit            similarity to 0x00FE0000.</P>                        <P id=p4>Under certain circumstances when setting            similarity to a very low value, for example 0x00010000            (the lowest possible value when not a key frame), the            next frame may have it's temporalQuality set to 0,            indicating a key frame is needed. Codec developers should            also be aware that in certain situations the Image            Compression Manager will look at the similarity value            returned by the compressor, and if this value is very            low, will tell the compressor to re-compress the frame as            a key frame. The Image Compression Manager will not do            this if the codecFlagLiveGrab flag is set, or if an            asynchronous completion proc is supplied.</P>                        <P id=p4>IM QuickTime Components : <A href="../../documentation/quicktime/qtdevdocs/INMAC/QTC/imImageComp.10.htm" TARGET="_blank">The            Compression Parameters Structure</A></P>                        <P>                        <hr width=500 align=center>                        </P>                        <!-- begin_date --><H4><CENTER>[Jan 16 2002]</CENTER></H4><!-- end_date -->         </TD>      </TR>   </TABLE>   </CENTER></BLOCKQUOTE><P><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1109.html%3Fid%3DDTS10001657-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1109.html%3Fid%3DDTS10001657-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1109.html%3Fid%3DDTS10001657-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></P></BODY></HTML>