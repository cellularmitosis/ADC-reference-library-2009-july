<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Selecting a Volume (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING311></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-302.html"><B>Chapter 3 - Standard File Package</B></A> / <A HREF="Files-306.html"><B>Using the Standard File Package</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING311-0></A>
<H2><A NAME=MARKER-9-207></A>Selecting a Volume</H2>
 <A NAME=MARKER-2-208></A>You can present the recommended user interface for selecting a volume by calling the <CODE>CustomGetFile</CODE> procedure and passing it the addresses of a custom file filter function and a dialog hook function. See <A HREF=Files-305.html#MARKER-9-51>"Selecting Volumes and Directories" on page 3-10</A> for a description of the appearance and behavior of the volume selection dialog box.<P>
 The file filter function used to select volumes is quite simple; it ensures that only volumes, not files or directories, are listed in the dialog box displayed by <CODE>CustomGetFile</CODE>. <A HREF=#MARKER-9-209>Listing 3-16</A> defines a file filter function you can use to do this.<P>
<B>Listing 3-20  <A NAME=MARKER-9-209></A>A file filter function that lists only volumes</B><P>
<PRE>
FUNCTION MyCustomFileFilter (pb: CInfoPBPtr; myDataPtr: Ptr): Boolean;
CONST
   kFolderBit = 4;                  {bit set in ioFlAttrib for a directory}
BEGIN                               {list volumes only}
   MyCustomFileFilter := TRUE;      {assume you don't list the item}
   IF BTst(pb^.ioFlAttrib, kFolderBit) AND (pb^.ioDrParID = fsRtParID) THEN
      MyCustomFileFilter := FALSE;
END;
</PRE>
 The function <CODE>MyCustomFileFilter</CODE> inspects the appropriate bit in the file attributes (<CODE>ioFlAttrib</CODE>) field of the catalog information parameter block passed to it. If the directory bit is set, <CODE>MyCustomFileFilter</CODE> checks whether the parent directory ID of the directory is equal to <CODE>fsRtParID</CODE>, which is always the parent directory ID of a volume's root directory. If it is, the file filter function returns <CODE>FALSE</CODE>, indicating that the item should appear in the list of volumes; otherwise, the file filter function returns <CODE>TRUE</CODE> to exclude the item from the list.<P>
 A dialog hook function for handling the items in the volume selection dialog box is defined in <A HREF=#MARKER-9-210>Listing 3-21</A>.<P>
<B>Listing 3-21  <A NAME=MARKER-9-210></A>Handling user selections in the volume selection dialog box</B><P>
<PRE>
FUNCTION MyDlgHook (item: Integer; theDialog: DialogPtr; myDataPtr: Ptr):
                   Integer;
VAR
   myType:        Integer;       {menu item selected}
   myHandle:      Handle;        {needed for GetDItem}
   myRect:        Rect;          {needed for GetDItem}
   myName:        Str255;        {new title for Open button}
BEGIN
   MyDlgHook := item;      {default, except in special cases below}
   IF GetWRefCon(WindowPtr(theDialog)) &lt;&gt; LongInt(sfMainDialogRefCon) THEN
      Exit(MyDlgHook);     {this function is only for main dialog box}

   CASE item OF
      sfHookFirstCall:
         BEGIN
            {Set button title and go to desktop.}
            myName := 'Select';
            GetDItem(theDialog, sfItemOpenButton, myType, myHandle, myRect);
            SetCTitle(ControlHandle(myHandle), myName);
            MyDlgHook := sfHookGoToDesktop;
         END;
      sfHookGoToDesktop:         {map Cmd-D to a null event}
         MyDlgHook := sfHookNullEvent;
      sfHookChangeSelection:
         MyDlgHook := sfHookGoToDesktop;
      sfHookGoToNextDrive:       {map Cmd-Left Arrow to a null event}
         MyDlgHook := sfHookNullEvent;
      sfHookGoToPrevDrive:       {map Cmd-Right Arrow to a null event}
         MyDlgHook := sfHookNullEvent;
      sfItemOpenButton, sfHookOpenFolder:
         MyDlgHook := sfItemOpenButton;
      OTHERWISE
         ;
   END;
END;
</PRE>
 You can prompt the user to select a volume by calling the function <CODE>DoGetVolume</CODE> defined in <A HREF=#MARKER-9-211>Listing 3-22</A>.<P>
<B>Listing 3-22  <A NAME=MARKER-9-211></A>Presenting the volume selection dialog box</B><P>
<PRE>
FUNCTION DoGetVolume: StandardFileReply;
VAR
   myReply:          StandardFileReply;
   myTypes:          SFTypeList;          {types of files to display}
   myPoint:          Point;               {upper-left corner of box}
   myNumTypes:       Integer;
   myModalFilter:    ModalFilterYDProcPtr;
   myActiveList:     Ptr;
   myActivateProc:   ActivateYDProcPtr;
CONST
   rGetVolumeDLOG    = 129;               {resource ID of custom dialog box}
BEGIN
   myNumTypes := -1;                      {pass all types of files}
   myPoint.h := -1;                       {center dialog box on screen}
   myPoint.v := -1;
   myModalFilter := NIL;
   myActiveList := NIL;
   myActivateProc := NIL;

   CustomGetFile(@MyCustomFileFilter, myNumTypes, myTypes, myReply,
                  rGetVolumeDLOG, myPoint, @MyDlgHook, myModalFilter, 
                  myActiveList, myActivateProc, @myReply);

   DoGetVolume := myReply;
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
