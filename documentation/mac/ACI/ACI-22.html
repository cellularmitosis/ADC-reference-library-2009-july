<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Creating Palettes </TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING22></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-14.html"><B>Chapter 1 - Palette Manager</B></A> / <A HREF="ACI-21.html"><B>Using the Palette Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING22-0></A>
<H2><A NAME=MARKER-21-103></A>Creating Palettes </H2>
 <A NAME=MARKER-2-104></A>This section shows you several different ways to create a palette. The first example uses the <CODE>NewPalette</CODE> function in a loop to create a 16-color palette with 14 shades of red plus black and white. The second example shows how to create a resource file containing the same 16 colors and shows you how to select the right color set by inhibiting certain colors on different screens. It also shows how to copy a palette from a color table and assign the palette to a window. <P>
<A NAME=HEADING22-2></A>
<H3>Creating a Palette in Code</H3>
 <A NAME=MARKER-9-111></A>The Palette Manager is particularly useful when your application needs to display an image that uses a narrowed or skewed color set. For example, suppose that your application displays PICT images on a 4-bit depth screen and that a particular image contains only shades of red. By default, the system provides a range of colors to use. If your application uses these 16 default colors to display the red PICT file, the display will lose all subtlety. With the Palette Manager, you can create a special palette containing red hues only to display this PICT image. <P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-9-106></A>This example assumes that the PICT image to display uses shades of red. One way to obtain information about a picture to display is by using the Picture Utilities, described in the chapter "Pictures" of <I>Inside Macintosh: Imaging With QuickDraw</I>. The Picture Utilities allow you to obtain various information about a picture to display, including the most used colors in the picture. The Picture Utilities are available in system software version 7.0 and later.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A HREF=#MARKER-9-107>Listing 1-1</A> shows how to create a palette containing shades of red only.<P>
<B>Listing 1-1  <A NAME=MARKER-9-107></A>Creating a red palette </B><P>
<PRE>
PaletteHandle DoMake14RedPalette (void)
{
   long              iterator;
   PaletteHandle     myPalette;
   RGBColor          color;
            
   myPalette = NewPalette(14, nil, pmTolerant, 4000);
   /* check here for nil result */

   color.green = 0;
   color.blue  = 0;
   for (iterator = 0; iterator &lt; 14; iterator++)
   {
      /* range red component from 1/14 to 14/14 */
      /* iterator is a long, so it can safely be multiplied by 65535 */
      color.red = (iterator+1) * 65535 / 14;
      SetEntryColor(myPalette, iterator, &amp;color);
   };
   return ( myPalette );
}
</PRE>
 In <A HREF=#MARKER-9-107>Listing 1-1</A>, the <CODE>DoMake14RedPalette</CODE> function creates a new 14-color palette containing 14 shades of red. The Palette Manager always guarantees that black and white are available to an application so that menus, windows, and other such things display properly. Therefore, you can load at most 14 new colors from a palette into a 16-color lookup table because the Palette Manager will not overwrite white (the first entry) or black (the last entry). <P>
 After defining three variables, the <CODE>DoMake14RedPalette</CODE> function calls the <CODE>NewPalette</CODE> function to create a palette large enough to hold 14 colors. The <CODE>nil</CODE> value passed as the second parameter specifies that the palette not be created from a color lookup table. In this case, the Palette Manager sets all three fields of each color to 0 (black). In essence, <CODE>NewPalette</CODE> has created a palette template. The <CODE>SetEntryColor</CODE> function later fills in, or changes, the color value for each color in the palette. The <CODE>NewPalette</CODE> function defines each color as tolerant with a tolerance of $4000.<P>
 Because this palette contains shades of red only, the green and blue fields of the <CODE>color</CODE> variable are set to 0. The code then defines 14 shades of red in a loop by dividing the maximum red value (65535) by 14 and adding 1/14 of 65,535 each time through the loop. Each time through the loop, the <CODE>SetEntryColor</CODE> function places a shade of red at the next palette entry (identified by <CODE>iterator</CODE>, the iteration variable). When the loop is finished, the first 14 entries in the palette created by the <CODE>NewPalette</CODE> function contain 14 evenly distributed shades of red. <P>
<DL>
<DT><B>Note</B>
<DD>When the Palette Manager uses this palette--after you have attached it to a window with the <CODE>SetPalette</CODE> or <CODE>NSetPalette</CODE> function--it looks at the colors of the color lookup table for the 4-bit display device and determines which of the 14 colors in the palette it must load. It then loads as many of the 14 palette entries as necessary to create the 14 shades of red defined in the palette. The Palette Manager keeps the first entry in the table as white and the last as black and uses the other 14 indexes as necessary to load the shades of red. See <A HREF=ACI-19.html#MARKER-9-84>"How the Palette Manager Allocates Colors for Display" (page 1-17)</A> for more information on how the Palette Manager loads colors from a palette into a color lookup table. <EM></EM><A NAME=MARKER-2-108></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING22-12></A>
<H3><A NAME=MARKER-21-109></A>Creating a Palette in a Resource File</H3>
 <A NAME=MARKER-2-110></A>The format of a palette resource (type <CODE>'pltt'</CODE>) is an image of the palette structure minus the private fields. The private fields in both the header and in each <CODE>ColorInfo</CODE> record are created by the <CODE>GetNewPalette</CODE> function and are reserved for future use. <P>
 <A HREF=#MARKER-9-111>Listing 1-2</A> shows a palette resource with 16 entries as it would appear within a resource file. The black and white entries each have a tolerance value of 0, meaning that their color should be matched exactly. The shades of red have a tolerance of $4000.<P>
<B>Listing 1-2  <A NAME=MARKER-9-111></A><A NAME=MARKER-21-112></A>A palette (<CODE>'pltt'</CODE>) resource </B><P>
<PRE>
resource 'pltt' (128, &quot;Simple Palette&quot;) {
{  /* array ColorInfo: 16 elements */
/* [1]  white */
65535, 65535, 65535, pmTolerant, 0,
/* [2] 2 through 15 are shades of red */
4681, 0, 0,       pmTolerant, $4000,
/* [3] */
9362, 0, 0,       pmTolerant, $4000,
/* [4] */
14043, 0, 0,      pmTolerant, $4000,
/* [5] */
18724, 0, 0,      pmTolerant, $4000,
/* [6] */
23405, 0, 0,      pmTolerant, $4000
/* [7] */
28086, 0, 0,      pmTolerant, $4000,
/* [8] */
32768, 0, 0,      pmTolerant, $4000,
/* [9] */
37449, 0, 0,      pmTolerant, $4000,
/* [10] */
42130, 0, 0,      pmTolerant, $4000,
/* [11] */
46811, 0, 0,      pmTolerant, $4000,
/* [12] */
51492, 0, 0,      pmTolerant, $4000,
/* [13] */
56173, 0, 0,      pmTolerant, $4000,
/* [14] */
60854, 0, 0,      pmTolerant, $4000,
/* [15] */
65535, 0, 0,      pmTolerant, $4000,
/* [16]  black */
0, 0, 0,          pmTolerant, 0
   }
};
</PRE>
 Use the <CODE>GetNewPalette</CODE> function to obtain a <CODE>'pltt'</CODE> resource; it initializes private fields in the palette structure. (Don't use the Resource Manager function <CODE>GetResource</CODE>.) <P>
 The palette defined by the palette resource in <A HREF=#MARKER-9-111>Listing 1-2</A> is identical to the palette created in code in <A HREF=#MARKER-9-107>Listing 1-1</A> in the previous section except that white and black are explicitly placed in the palette in <A HREF=#MARKER-9-111>Listing 1-2</A>. This palette contains black and white and 14 shades of red. The shades of red are defined by setting the green and blue values of each color entry to 0 and distributing the red color in 14 increments from the lowest to the highest value (65535). One possible use of this palette is to display a PICT file that contains only shades of red.<P>
<A NAME=HEADING22-19></A>
<H3><A NAME=MARKER-9-113></A>Selecting the Right Color Set</H3>
 <A NAME=MARKER-2-114></A>Different types of screens (for example, screens with different bit depths) often require different color sets to best display the same image. This section, like the previous section, uses an example of creating a palette to display an image in various shades of red. In addition, the code has been modified to display different colors on different screens. <P>
 <A HREF=#MARKER-9-115>Listing 1-3</A> shows the code to display 14 shades of red on a 4-bit color screen, 254 shades of red on an 8-bit color screen, and no color requests at all on 2-bit screens or grayscale screens. <P>
<B>Listing 1-3  <A NAME=MARKER-9-115></A>Displaying different colors on different types of screens</B><P>
<PRE>
PaletteHandle MyMakeRedPalette (void)
{
   long              iterator;
   PaletteHandle     myPalette;
   RGBColor          color;
            
   myPalette = NewPalette(254+14, nil, 0, 0);
   /* check here for nil result */

   color.green = 0;
   color.blue = 0;
   /* make 14 reds that are inhibited on all 
      screens except 4-bit color */
   for (iterator = 0; iterator &lt; 14; iterator++)
   {
      /* range red component from 1/14 to 14/14 */
      /* iterator is a long, so it can safely be multiplied by 65535 */
      color.red = (iterator+1) * 65535 / 14;
      SetEntryColor(myPalette, iterator, &amp;color);
      SetEntryUsage(myPalette, iterator, pmTolerant+pmInhibitC2+
                           pmInhibitG2+pmInhibitG4+
                           pmInhibitC8+pmInhibitG8, 0);
   };
   /* make 254 reds that are inhibited on all 
      screens except 8-bit color */
   for (iterator = 0; iterator &lt; 255; iterator++)
   {
      /* range red component from 1/254 to 254/254 */
      /* iterator is a longint, so can safely be multiplied by 65535 */
         color.red = (iterator+1) * 65535 / 254;
         SetEntryColor(myPalette, 14+iterator, &amp;color);
         SetEntryUsage(myPalette, 14+iterator, pmTolerant+pmInhibitC2+
                                 pmInhibitG2+pmInhibitG4+
                                 pmInhibitC4+pmInhibitG8, 0);
   };
   return ( myPalette );
}
</PRE>
 In <A HREF=#MARKER-9-115>Listing 1-3</A>, the <CODE>MyMakeRedPalette</CODE> function creates a palette that contains shades of red to optimally display an image that contains shades of red only. The palette contains two less colors than the maximum (14 for a 4-bit screen and 254 for an 8-bit screen) so that black and white are available in the color table. <P>
 After defining three variables, the <CODE>MyMakeRedPalette</CODE> function calls the <CODE>NewPalette</CODE> function to create a palette large enough to hold 268 colors (254 plus 14). The <CODE>nil</CODE> value passed as the second parameter specifies that no color table be used to create the template, in which case all the colors in the palette are set to black. The two <CODE>for</CODE> loops that follow use the <CODE>SetEntryColor</CODE> and <CODE>SetEntryUsage</CODE> functions to change the colors and their use in the palette. <P>
 The first loop creates 14 shades of red. The green and blue values for all the colors are already set to 0. The <CODE>SetEntryColor</CODE> function is called in a loop to set the 14 red values. It specifies 1/14 increments up to the maximum value of 65535. The <CODE>SetEntryUsage</CODE> function specifies that each color is tolerant (it uses the <CODE>pmTolerant</CODE> constant to do this) and that the tolerance is 0 so that each color must match exactly. <P>
 The <CODE>SetEntryUsage</CODE> function also specifies that these 14 colors are to be used only on a 4-bit screen. It does this by inhibiting these colors on all other indexed screens using the constants <CODE>pmInhibitC2</CODE> (inhibit on a 2-bit color screen), <CODE>pmInhibitG2</CODE> (inhibit on a 2-bit grayscale screen), and so on for the other types of indexed screens. <P>
 The second loop creates 254 shades of red. It uses the <CODE>SetEntryColor</CODE> function as the first loop does with the only difference being that the red color value is incremented 1/254 at each iteration rather than 1/14. As in the first loop, the <CODE>SetEntryUsage</CODE> function specifies that each color is tolerant with a tolerance of 0 so that the colors must match exactly. The <CODE>SetEntryUsage</CODE> function also specifies that the colors are to be used only on an 8-bit color screen. It does this by inhibiting the colors on all other indexed screens.<A NAME=MARKER-2-116></A> <P>
<A NAME=HEADING22-29></A>
<H3>Creating a Palette by Copying and Assigning It to a Window</H3>
 <A NAME=MARKER-2-117></A>You can create a palette from the colors in a color table by using the <CODE>NewPalette</CODE> function. It copies the colors from the table and assigns the usage and tolerance values you specify as function parameters. You assign a usage value and a tolerance value that apply to all of the palette's entries, but you can change individual entries with subsequent calls to the <CODE>SetEntryUsage</CODE> function, which can change both the usage and tolerance values of an entry. (If you call <CODE>NewPalette</CODE> without supplying a color table as a source, it creates a palette with all entries equal to black. You can then modify the entries as needed, using the <CODE>SetEntryColor</CODE> and <CODE>SetEntryUsage</CODE> functions.)<P>
<DL>
<DT><B>Note</B>
<DD>Color tables define the colors that are available for pixel images on indexed devices. You can create color tables from either <CODE>ColorTable</CODE> data structures or color table (<CODE>'clut'</CODE>) resources. See the chapter "Color QuickDraw" of <I>Inside Macintosh: Imaging With QuickDraw</I> for more information on color tables.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 For example, suppose you are drawing to an indexed device with a color table containing 14 colors plus black and white and you want a palette in which the fifth color must be matched exactly but the others need only be close. <A HREF=#MARKER-9-118>Listing 1-4</A> shows how to create the palette from the color table and then modify the tolerance value for the fifth entry (remember that color table and palette entries are numbered starting at 0).<P>
<B>Listing 1-4  <A NAME=MARKER-9-118></A>Copying a color table to a palette</B><P>
<PRE>
#define  clutID   68

void DoCreatePalette()
{
   CTabHandle     myColorTable;
   PaletteHandle  myPalette;
   WindowPtr      myWindow;

   myColorTable = GetCTable (clutID);

   /* create a new window */
   myWindow = NewCWindow(nil, &amp;BaseRect, &quot;\pUsing Palette 
                        Manager&quot;, TRUE, documentProc, 
                        (WindowPtr) -1, TRUE, nil);

   /* create a 16-color palette */
   myPalette = NewPalette(16, myColorTable, pmTolerant, $2000);
   /* modify the 5th entry */
   SetEntryUsage(myPalette, 4, 0);

   /* assign the palette to the window */
   SetPalette ((WindowPtr) myWindow, myPalette, TRUE);
}
</PRE>
 After defining three variables (to hold the color table ID, the palette ID, and the window ID), the <CODE>DoCreatePalette</CODE> function uses the <CODE>GetCTable</CODE> function (described in the chapter "Color QuickDraw" of <I>Inside Macintosh: Imaging With QuickDraw</I>) to retrieve the default color-table (<CODE>'clut'</CODE>) resource for a screen with a 4-bit pixel depth. (You can obtain the default color-table resource for a screen by adding 64 to the pixel depth of the screen. Therefore, 68 identifies the color-table resource for a 4-bit pixel depth screen.) The <CODE>NewCWindow</CODE> function (described in the chapter "Window Manager" of <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>) then creates a new color window.<P>
 The <CODE>NewPalette</CODE> function creates a palette from the color-table resource. All colors in the new palette have a tolerance of $2000. The <CODE>SetEntryUsage</CODE> function changes the tolerance of the fifth entry such that an exact match is required.<P>
 Finally, the <CODE>SetPalette</CODE> function assigns the newly created palette to the newly created window. <A NAME=MARKER-2-119></A><P>
<DL>
<DT><B>Note</B>
<DD>You can use either the <CODE>SetPalette</CODE> or <CODE>NSetPalette</CODE> function to assign a palette to a window. <A NAME=MARKER-2-120></A>These functions are identical except that the <CODE>NSetPalette</CODE> function is more versatile in specifying whether the window is to receive updates when the color environment changes. <CODE>NSetPalette</CODE> allows you to specify that the window is to receive updates only when the window is active, updates only when it is not active, all updates, or none. The <CODE>SetPalette</CODE> function only allows the last two settings. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A NAME=MARKER-2-121></A>If you want to change a window's palette momentarily and then restore the first palette, use the <CODE>GetPalette</CODE> function to obtain a handle to a window's current palette and then restore it with either <CODE>SetPalette</CODE> or <CODE>NSetPalette</CODE>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
