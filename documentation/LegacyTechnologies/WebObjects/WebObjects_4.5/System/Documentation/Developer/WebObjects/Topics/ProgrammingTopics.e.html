<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Implementing a Login Panel</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.d.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.f.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=612941"> </A><A NAME="35394"> </A>Implementing a Login Panel</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to use WebObjects to implement a reusable login panel with the HTTP `Basic' Authorization scheme, how to secure the login connection using SSL, and how to validate a login against a custom database.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=606105"> </A>WebObjects applications commonly require authentication code, often in the form of a login panel. This topic implements a login panel class that you can subclass and use in your applications.</P><P CLASS="Body"><A NAME="pgfId=617830"> </A>WebObjects login panels can be implemented in the following ways:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=617833"> </A>Using a basic HTML page with a login form containing text fields and a Submit button</LI><LI CLASS="Bulleted"><A NAME="pgfId=606107"> </A>	Using the HTTP/1.x Basic authentication protocol with the browser's built-in authentication panel</LI></UL><P CLASS="Body"><A NAME="pgfId=606108"> </A>Creating a login form using HTML is very easy but suffers two disadvantages: the login credentials are sent in clear text all the way to the application server, and the page's HTML requires maintenance. HTTP-based access authentication uses a browser's login panel to capture the users login information and encodes (but does not encrypt) the login credentials all the way to the application server. Combining either of these login approaches with a secure connection between the browser and the HTTP server using SSL yields a very secure login solution. </P><P CLASS="Body"><A NAME="pgfId=606109"> </A>This programming topic implements a login using the HTTP 1.x Basic authentication scheme, specified in the HTTP/1.0 and HTTP/1.1 standards. The implementation has two phases: presentation and validation. Presentation involves implementing the HTTP/1.x Basic Authentication scheme, decoding the user's login credentials, and presenting an error response if the login fails. Validation involves validating the user's credentials against a database or authentication server, tracking login attempts, and recording users that have been locked out because they exceeded the maximum number of login attempts.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606110"> </A>Using HTTP/1.x Basic Authentication</H3><P CLASS="Body"><A NAME="pgfId=609419"> </A>HTTP defines a simple challenge-response authentication protocol: when a client requests a secure document, the server challenges the client, whereupon the client supplies his credentials, i.e., a user ID and a password. The documents are organized in &quot;realms&quot;. Once the user is permitted to access a particular realm, his browser will cache the login credentials and respond automatically and transparently to further challenges by the server. The authentication realm can have the following values:				</P><TABLE BORDER="1" CELLPADDING="3"><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellHeading"><A NAME="pgfId=609478"> </A>Realm Value		</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellHeading"><A NAME="pgfId=609480"> </A>Authentication Space</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609482"> </A>Application Name</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609484"> </A>Authenticated one for all application sessions.</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609486"> </A>sessionID</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609488"> </A>Authenticated for a single application session.</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609490"> </A>Page Name	</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609492"> </A>Authenticated for a particular page in all sessions.</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609494"> </A>SessionID+Page Name</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609496"> </A>Authenticated for a particular page in one session.</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609498"> </A>ContextId</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=609500"> </A>Authenticated for one request only.</P></TD></TR></TABLE><P CLASS="Warning"><A NAME="pgfId=609026"> </A><DIV><IMG SRC="ProgrammingTopics-3.gif"></DIV>Note	Once the user exits the browser, all of his 	authenticated realms are lost because<BR>	the browser forgets his username and password.<DIV><IMG SRC="ProgrammingTopics-3.gif"></DIV></P><P CLASS="Body"><A NAME="pgfId=621419"> </A>The state of the authentication process is stored in the <TT CLASS="Code">session</TT> object using the <TT CLASS="Code">authState</TT> variable. Table 1 shows the authentication request-response loop:</P><TABLE BORDER="1" CELLPADDING="3"><B><CAPTION><P CLASS="TableTitle"><A NAME="pgfId=611483"> </A>Request-Response Loop</P></CAPTION></B><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellHeading"><A NAME="pgfId=611489"> </A>Browser</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellHeading"><A NAME="pgfId=611491"> </A>Current Page</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellHeading"><A NAME="pgfId=611493"> </A>Authenticated Page</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=611495"> </A>Submits request for authenticated page.</P><P CLASS="CellBody"><A NAME="pgfId=611496"> </A>Brings up login panel if realm was not previously authenticated.</P><P CLASS="CellBody"><A NAME="pgfId=611497"> </A>Sets authorization header to include the encoded login information and sends authorization request. </P><P CLASS="CellBody"><A NAME="pgfId=611498"> </A>Displays Authenticated page.</P><P CLASS="CellBody"><A NAME="pgfId=611499"> </A>Displays Error page.</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=611501"> </A>Invokes requested method to create page.</P><P CLASS="CellBody"><A NAME="pgfId=611502"> </A>Creates new Authenticated page.</P><P CLASS="CellBody"><A NAME="pgfId=611503"> </A>Sets new page's <TT CLASS="Code">authState</TT> variable to <TT CLASS="Code">&quot;authNeeded&quot;</TT>.</P><P CLASS="CellBody"><A NAME="pgfId=611504"> </A>Returns Authenticated page with modified content and HTTP status. </P><P CLASS="CellBody"><A NAME="pgfId=611505"> </A>Receives same request to invoke method. </P><P CLASS="CellBody"><A NAME="pgfId=611506"> </A>Creates or returns new Authenticated page.</P><P CLASS="CellBody"><A NAME="pgfId=611507"> </A>Returns normal Authenticated page with HTTP status 200.</P><P CLASS="CellBody"><A NAME="pgfId=611508"> </A>Returns Authenticated page with error content and HTTP 403 status. </P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="CellBody"><A NAME="pgfId=611510"> </A>Overrides <TT CLASS="Code">appendToResponse</TT>, invokes<TT CLASS="Code"> super.appendToResponse</TT>, then invokes <TT CLASS="Code">handleAuthorizationRequest</TT></P><P CLASS="CellBody"><A NAME="pgfId=611511"> </A>If <TT CLASS="Code">authState = &quot;authNeeded&quot;</TT>, sets HTTP status to 401, sets the response header to indicate the realm, and sets <TT CLASS="Code">authState</TT> to <TT CLASS="Code">&quot;authLogin&quot;</TT>.</P><P CLASS="CellBody"><A NAME="pgfId=611512"> </A>If <TT CLASS="Code">authState = &quot;authLogin&quot;</TT>, decode and parse encoded login string and perform validation. Sets <TT CLASS="Code">authState </TT>to<TT CLASS="Code"> &quot;accessDenied&quot;</TT> or <TT CLASS="Code">&quot;authenticated&quot;</TT>.             </P><P CLASS="CellBody"><A NAME="pgfId=611513"> </A>If <TT CLASS="Code">authState = &quot;authenticated&quot;</TT>, generates normal response page .</P><P CLASS="CellBody"><A NAME="pgfId=611514"> </A>If <TT CLASS="Code">authState = &quot;accessDenied&quot;</TT>, sets HTTP status to 403 and content to HTTP 403(Unauthorized)</P></TD></TR></TABLE><P CLASS="Body"><A NAME="pgfId=611516"> </A>When your application receives a request for a specific page, or a method invocation in the current page, it can challenge the request by sending a special response that causes the browser to display the authentication panel. </P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606159"> </A>An Example </H3><P CLASS="Body"><A NAME="pgfId=606160"> </A>This application has two pages, implemented in Listings 1 and 2. The <TT CLASS="Code">Main</TT> page is a welcome page with a link to login and continue. The second page is the page containing secure data. In <TT CLASS="Code">Main</TT>, <TT CLASS="Code">anAction()</TT> is invoked when the user's request to login is received. This method creates the new page, a subclass of <TT CLASS="Code">AuthenticatedComponent</TT>, that displays the login panel and validates the login. Once the login is validated, the page returns its normal contents. In Listing 1, the <TT CLASS="Code">page.authenticateComponent()</TT> message flags that <TT CLASS="Code">page</TT> requires authentication. The login panel is displayed when <TT CLASS="Code">page</TT> is returned.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608480"> </A>Java Code for the Main Page</H4><PRE CLASS="Code"><A NAME="pgfId=608482"> </A>public class Main extends WOComponent {<A NAME="pgfId=608484"> </A>    public WOComponent anAction()<A NAME="pgfId=608486"> </A>    {<A NAME="pgfId=608488"> </A>        AuthenticatedComponent page;<A NAME="pgfId=608490"> </A>        page=(AuthenticatedComponent)this.pageWithName(&quot;NewPage&quot;);<A NAME="pgfId=608492"> </A>        page.authenticateComponent(this.session().sessionID());<A NAME="pgfId=608494"> </A>        return page;<A NAME="pgfId=608496"> </A>    }<A NAME="pgfId=608498"> </A>}<A NAME="pgfId=608500"> </A>//NewPage.java code fragment<A NAME="pgfId=608502"> </A>public class NewPage extends AuthenticatedComponent {. . . . . .</PRE><P CLASS="Body"><A NAME="pgfId=621496"> </A></P><P CLASS="Body"><A NAME="pgfId=606178"> </A>When<TT CLASS="Code"> page.authenticateComponent() </TT>is invoked, the <TT CLASS="Code">authState </TT>variable is set to<TT CLASS="Code"> &quot;authNeeded&quot; </TT>and is stored in the session dictionary along with <TT CLASS="Code">authSpace</TT>. In this example <TT CLASS="Code">authSpace</TT> contains the authentication realm; it is set to the <TT CLASS="Code">sessionID</TT> to indicate that authentication is only required once per session.</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608532"> </A>Java Code for the Secure Page</H4><PRE CLASS="Code"><A NAME="pgfId=608534"> </A>public class AuthenticatedComponent extends WOComponent{<A NAME="pgfId=608536"> </A>public void authenticateComponent(String authSpace){<A NAME="pgfId=608538"> </A>    String authState=(String)this.session().objectForKey(&quot;authState&quot;);<A NAME="pgfId=608540"> </A>    if(authState==null){<A NAME="pgfId=608542"> </A>        this.session().setObjectForKey(&quot;authNeeded&quot;,&quot;authState&quot;);<A NAME="pgfId=608544"> </A>        this.session().setObjectForKey(authSpace,&quot;authSpace&quot;);<A NAME="pgfId=608546"> </A>    }<A NAME="pgfId=608548"> </A>...</PRE><P CLASS="Body"><A NAME="pgfId=606192"> </A>The <TT CLASS="Code">appendToResponse()</TT> method, invoked automatically when a page is returned, is overridden to display the login panel. For clarity, this example implements the guts of the response generator in a separate method: <TT CLASS="Code">responseForAuthorization(WOResponse aResponse, String aRealm ), </TT>where parameter <TT CLASS="Code">aRealm </TT>refers to the protection space. The superclass version of<TT CLASS="Code"> appendToResponse()</TT> must be called first to generate the initial WOResponse. </P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608561"> </A>Java Code for Overriding appendToResponse</H4><PRE CLASS="Code"><A NAME="pgfId=608563"> </A>// in the AuthenticatedComponent class<A NAME="pgfId=621761"> </A><A NAME="pgfId=621746"> </A>public void appendToResponse(WOResponse aResponse, WOContext aContext)<A NAME="pgfId=621747"> </A>{<A NAME="pgfId=621748"> </A>    String sessionId;<A NAME="pgfId=621749"> </A>    super.appendToResponse(aResponse, aContext);<A NAME="pgfId=621750"> </A>    sessionId=(String)this.session().objectForKey(&quot;authSpace&quot;);<A NAME="pgfId=621751"> </A>    responseForAuthorization(aResponse, sessionId);<A NAME="pgfId=621752"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=621753"> </A></P><P CLASS="Body"><A NAME="pgfId=621551"> </A></P><P CLASS="Body"><A NAME="pgfId=606204"> </A>Listing 4 shows the <TT CLASS="Code">responseForAuthorization</TT> code which actually generates the response. If the <TT CLASS="Code">authState</TT> is <TT CLASS="Code">&quot;authNeeded&quot;</TT>, the response is initialized with the HTTP status set to 401. The<TT CLASS="Code"> WWW-Authenticate </TT>header is set with the value <TT CLASS="Code">Basic realm=&quot;some sessionID&quot;</TT>. When the browser receives this response, it pops up a login panel requesting the user ID and password. When the user enters this information, the browser sends it back to the web server along with the original request. This request contains an <TT CLASS="Code">Authorization </TT>header and the <TT CLASS="Code">&lt;Base64 encoded&gt; </TT>credentials having the format: <TT CLASS="Code">Basic &lt;userid:password&gt;.</TT> </P><P CLASS="Body"><A NAME="pgfId=606205"> </A>If the validation is unsuccessful, <TT CLASS="Code">responseForAuthorization</TT> returns a response with HTTP status 403 (Unauthorized). If the validation is successful, <TT CLASS="Code">responseForAuthorization</TT> returns the response page unmodified. You can add code to handle users that attempt to login too many times. Possible strategies are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606206"> </A>	Terminate the session after the 403 response is sent by invoking<BR><TT CLASS="Code">WebApplication.session().terminate();<BR></TT>The session will terminate after the response is sent.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606209"> </A>	Record the remote user's IP address and disallow further login attempts from this IP address for a limited time. You can get the IP address of the remote host by reading the value of the <TT CLASS="Code">x-webobjects-remote-host </TT>header from the request, then terminate the session.</LI></UL></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608632"> </A>Java Code for responseForAuthorization</H4><PRE CLASS="Code"><A NAME="pgfId=608634"> </A>String ipAddr=aRequest.headerForKey(&quot;x-webobjects-remote-host&quot;);<A NAME="pgfId=621574"> </A><A NAME="pgfId=608636"> </A>//In AuthenticatedComponent<A NAME="pgfId=608638"> </A>public void responseForAuthorization(WOResponse aResponse,String aRealm )<A NAME="pgfId=608640"> </A>{ <A NAME="pgfId=608642"> </A>    NSData errorBytes;<A NAME="pgfId=608644"> </A>    String errorText= <A NAME="pgfId=621575"> </A>        &quot;&lt;HTML&gt;&lt;BODY&gt;&lt;H2&gt;HTTP/1.0 403 Unauthorized Access&lt;/H2&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;;<A NAME="pgfId=608646"> </A>    String authState=(String)this.session().objectForKey(&quot;authState&quot;);<A NAME="pgfId=608648"> </A>    if(authState!=null  )<A NAME="pgfId=608650"> </A>    {<A NAME="pgfId=608652"> </A>        String encodedAuth=this.context().<A NAME="pgfId=621576"> </A>            request().headerForKey(&quot;authorization&quot;);<A NAME="pgfId=621710"> </A><A NAME="pgfId=608654"> </A>        if(encodedAuth!=null &amp;&amp; authState.equals(&quot;authLogin&quot;))<A NAME="pgfId=608656"> </A>        {<A NAME="pgfId=608658"> </A>            handleAuthorizationRequest(encodedAuth);<A NAME="pgfId=608660"> </A>            authState=(String)this.session().objectForKey(&quot;authState&quot;);<A NAME="pgfId=608662"> </A>        }<A NAME="pgfId=621711"> </A><A NAME="pgfId=621583"> </A>        if(authState.equals(&quot;authenticated&quot;))<A NAME="pgfId=621594"> </A>            return;<A NAME="pgfId=608668"> </A>        else<A NAME="pgfId=621709"> </A>        {<A NAME="pgfId=608670"> </A>            errorBytes = new NSData(errorText.getBytes());<A NAME="pgfId=621601"> </A>            aResponse.setContent(errorBytes);<A NAME="pgfId=608674"> </A>            aResponse.setHeader(new Integer(errorBytes.length()).<A NAME="pgfId=621643"> </A>                toString(), &quot;content-length&quot;);<A NAME="pgfId=608676"> </A>            aResponse.setHeader(&quot;text/html&quot; , &quot;content-type&quot;);<A NAME="pgfId=608678"> </A>            if(authState.equals(&quot;authNeeded&quot;)  )//validation needed<A NAME="pgfId=608680"> </A>            {<A NAME="pgfId=608682"> </A>                aResponse.setStatus(401); //authorization request<A NAME="pgfId=608684"> </A>                aResponse.setHeader(<A NAME="pgfId=621602"> </A>                    &quot;Basic realm=\&quot;&quot; + aRealm + &quot;\&quot;&quot; , &quot;WWW-Authenticate&quot;);<A NAME="pgfId=608686"> </A>                this.session().setObjectForKey(&quot;authLogin&quot;,&quot;authState&quot;);<A NAME="pgfId=608688"> </A>            }<A NAME="pgfId=608690"> </A>            else if(authState.equals(&quot;accessDenied&quot;))<A NAME="pgfId=621609"> </A>                aResponse.setStatus(403);// unauthorized status<A NAME="pgfId=621616"> </A>        }	<A NAME="pgfId=621638"> </A>    }<A NAME="pgfId=621708"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=606254"> </A>Listing 5 shows the code that decodes the credentials and invokes the validation code. The authorization header value is extracted from the request and Base64 decoded with <TT CLASS="Code">sun.misc.BASE64Decoder</TT> (included with the standard Java Developer Kit (JDK)). The decoded header is parsed to extract the user name and password, which are sent to the validation code.</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608742"> </A>Java Code to Extract Credentials</H4><PRE CLASS="Code"><A NAME="pgfId=608744"> </A>//In AuthenticatedComponent<A NAME="pgfId=608746"> </A>public  void handleAuthorizationRequest(String encodedAuth)<A NAME="pgfId=608748"> </A>{<A NAME="pgfId=608750"> </A>    String decodedAuth=null;<A NAME="pgfId=608752"> </A>    EOEnterpriseObject validatedUser;<A NAME="pgfId=608754"> </A>    sun.misc.BASE64Decoder decoder=new sun.misc.BASE64Decoder();<A NAME="pgfId=608756"> </A><A NAME="pgfId=621804"> </A>    //encoded string starts after &quot;Basic &quot;<A NAME="pgfId=608758"> </A>    encodedAuth=encodedAuth.substring(encodedAuth.indexOf(&quot; &quot;)+1);<A NAME="pgfId=608760"> </A>    try{        <A NAME="pgfId=608762"> </A>        decodedAuth=new String(decoder.decodeBuffer((new ByteArrayInputStream<A NAME="pgfId=621805"> </A>            (encodedAuth.getBytes()))));<A NAME="pgfId=608764"> </A>    } catch(IOException ex) {}<A NAME="pgfId=608766"> </A>    <A NAME="pgfId=621806"> </A>    //extract username:password, assume methods and ivars exist<A NAME="pgfId=608768"> </A>    String userName=userNameFromDecodedAuthString(decodedAuth);<A NAME="pgfId=608770"> </A>    String password=passwordFromDecodedAuthString(decodedAuth);<A NAME="pgfId=608772"> </A><A NAME="pgfId=621811"> </A>    //then validate. Again, assume this exists<A NAME="pgfId=608774"> </A>    if ((validatedUser=validateUserNameAndPassword(userName,<A NAME="pgfId=621807"> </A>        password))!=null) {<A NAME="pgfId=608776"> </A>        this.session().setObjectForKey(&quot;authenticated&quot;,&quot;authState&quot;);<A NAME="pgfId=621810"> </A>        this.session().setObjectForKey(validatedUser,&quot;validatedUser&quot;);<A NAME="pgfId=608780"> </A>    } else {<A NAME="pgfId=608784"> </A>       this.session().setObjectForKey(&quot;authNeeded&quot;,&quot;authState&quot;);<A NAME="pgfId=608786"> </A>    }<A NAME="pgfId=608788"> </A>}<A NAME="pgfId=608790"> </A><A NAME="pgfId=621814"> </A>public static String userNameFromDecodedAuthString(String auth) {<A NAME="pgfId=608792"> </A>    if(auth!=null){<A NAME="pgfId=608794"> </A>        StringTokenizer st=new StringTokenizer(auth,&quot;:&quot;,true);<A NAME="pgfId=608796"> </A>        String username;<A NAME="pgfId=608798"> </A>        if(( username=st.nextToken())!=null){<A NAME="pgfId=608800"> </A>            if(!username.equals(&quot;:&quot;)){<A NAME="pgfId=608802"> </A>                return username;<A NAME="pgfId=608804"> </A>            }<A NAME="pgfId=608806"> </A>        }<A NAME="pgfId=608808"> </A>    }<A NAME="pgfId=608810"> </A>    return &quot;&quot;;<A NAME="pgfId=608812"> </A>}<A NAME="pgfId=608814"> </A>public static String passwordFromDecodedAuthString(String auth ) {<A NAME="pgfId=608816"> </A>    if(auth!=null){<A NAME="pgfId=608818"> </A>        StringTokenizer st=new StringTokenizer(auth,&quot;:&quot;,true);<A NAME="pgfId=608820"> </A>        if(st.countTokens()==3){<A NAME="pgfId=608822"> </A>            st.nextToken(); st.nextToken();<A NAME="pgfId=608824"> </A>            return st.nextToken();<A NAME="pgfId=608826"> </A>        }<A NAME="pgfId=608828"> </A>        else if(st.countTokens()==2){<A NAME="pgfId=608830"> </A>            st.nextToken();<A NAME="pgfId=608832"> </A>            String passwd=st.nextToken();<A NAME="pgfId=608834"> </A>            if(!passwd.equals(&quot;:&quot;))<A NAME="pgfId=608836"> </A>                return passwd;<A NAME="pgfId=608838"> </A>        }<A NAME="pgfId=608840"> </A>    }<A NAME="pgfId=608842"> </A>    return &quot;&quot;;<A NAME="pgfId=608844"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=621568"> </A></P></DIV></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606315"> </A>Implementing Validation </H3><P CLASS="Body"><A NAME="pgfId=606316"> </A>Once the login credentials have been received, decoded, and parsed, they must be validated. Several options exist:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606317"> </A>	Authentication on LDAP server</LI><LI CLASS="Bulleted"><A NAME="pgfId=606318"> </A>	Custom database with username, password, access rights, and so on</LI><LI CLASS="Bulleted"><A NAME="pgfId=606319"> </A>	Create a new database connection with users login credentials.</LI></UL><P CLASS="Body"><A NAME="pgfId=606320"> </A>We discuss the second option, authenticating against a custom database with login information. The following example assumes an existing database with user data and an EOModel. Once the login validation method is invoked, a fetch is performed against the login credentials. </P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=608891"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=608893"> </A>//In AuthenticatedComponent<A NAME="pgfId=621835"> </A><A NAME="pgfId=608895"> </A>public EOEnterpriseObject validateUserNameAndPassword <A NAME="pgfId=621836"> </A>    (String username, String password)<A NAME="pgfId=608897"> </A>{<A NAME="pgfId=608899"> </A>    EOQualifier qual;<A NAME="pgfId=608901"> </A>    EOFetchSpecification fs;<A NAME="pgfId=608903"> </A>    NSMutableArray args = new NSMutableArray();<A NAME="pgfId=608905"> </A>    EOEditingContext ec=new EOEditingContext();<A NAME="pgfId=621837"> </A>    args.addObject(username);<A NAME="pgfId=608909"> </A>    args.addObject(password);<A NAME="pgfId=608911"> </A><A NAME="pgfId=621848"> </A>    qual = EOQualifier.qualifierWithQualifierFormat<A NAME="pgfId=621846"> </A>        (&quot;userName = %@ AND password = %@&quot;, args);<A NAME="pgfId=608913"> </A>    fs=new EOFetchSpecification(&quot;Login&quot;, qual, null);<A NAME="pgfId=608915"> </A>    NSArray im=ec.objectsWithFetchSpecification(fs);<A NAME="pgfId=608917"> </A><A NAME="pgfId=621847"> </A>    if(im.count()==1)<A NAME="pgfId=608919"> </A>        return (EOEnterpriseObject)im.objectAtIndex(0);<A NAME="pgfId=608921"> </A>    return null;<A NAME="pgfId=608923"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=621834"> </A></P></DIV></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606341"> </A>How Secure?</H3><P CLASS="Body"><A NAME="pgfId=606342"> </A>Using an HTML or HTTP Authorization login panel by itself does little to protect the login credentials from potential intruders. The login panel based on an HTML form is the least secure, offering no real protection except the ability to hide the user's password on the screen, because the login information is sent in clear text all the way back to the WebObjects application server. </P><P CLASS="Body"><A NAME="pgfId=606343"> </A>Using the browser authentication panel, login information is Base64 encoded all the way to the WebObjects application server. Although safer than clear text, it is easily decoded.</P><P CLASS="Body"><A NAME="pgfId=621849"> </A>Using the Secure Socket Layer (SSL) with either of these login approaches yields an excellent and secure Web application login solution. Even with SSL, the login credentials remain unencrypted between the HTTP server and WebObjects application server. However, this link is usually highly secure, especially if it's behind a firewall. </P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606344"> </A>Securing the Login with SSL</H3><P CLASS="Body"><A NAME="pgfId=606345"> </A>To get a secure connection between the browser and the HTTP server using SSL, two things are needed:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606346"> </A>	An HTTP server &quot;Security Certificate&quot; signed by a Certificate Authority (CA) such as Verisign</LI><LI CLASS="Bulleted"><A NAME="pgfId=606347"> </A>	Redirection of the URL by modifying the URL prefix from <TT CLASS="Code">http://</TT> to <TT CLASS="Code">https://</TT></LI></UL><P CLASS="Body"><A NAME="pgfId=606348"> </A>To redirect the URL, you must modify the location header of the response in the appendToResponse method of the page, session, or application:</P><PRE CLASS="Code"><A NAME="pgfId=606349"> </A>rsp.setHeader(&quot;https://&quot;+this.context().request().headerForKey(&quot;host&quot;)+this.context().componentActionURL(), &quot;location&quot;);</PRE><P CLASS="Body"><A NAME="pgfId=606350"> </A>To make the connection insecure after the login is complete, you can do the following:</P><PRE CLASS="Code"><A NAME="pgfId=606351"> </A>rsp.setHeader(&quot;http://&quot;+this.context().request().headerForKey(&quot;host&quot;)+this.context().componentActionURL(), &quot;location&quot;);</PRE><P CLASS="Body"><A NAME="pgfId=606352"> </A>These methods should be placed in <TT CLASS="Code">responseForAuthorization()</TT>.</P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606353"> </A>Caveats</H3><P CLASS="Body"><A NAME="pgfId=606354"> </A>Netscape HTTP servers will not pass the Authorization header to Common Gateway Interface (CGI) programs; you must use the NSAPI adapter included with WebObjects. Microsoft IIS servers must be configured for &quot;Basic Authentication.&quot; Microsoft Peer Web Server does not directly support &quot;Basic Authentication,&quot; but can be made to work by making the following registry entry in: </P><P CLASS="Body"><A NAME="pgfId=606356"> </A>HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/W3SVC/Parameters</P><P CLASS="Body"><A NAME="pgfId=606357"> </A>Change NTAuthentication 				&quot;NTLM&quot; to NTAuthentication 			&quot;basic&quot; and disable the &quot;Basic Authentication&quot; option in the Internet Service Manager.</P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606361"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606362"> </A>	<A HREF="ProgrammingTopics.1a.html#15933" CLASS="XRef">Fetching with an Editing Context</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606365"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606366"> </A>	How do I create a login panel?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606367"> </A>	How do I use browser authentication in a WebObjects application?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606368"> </A>	How do I implement SSL from a WebObjects application?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606369"> </A>	How can I implement a dedicated database connect per user login?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606370"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606371"> </A>	Login</LI><LI CLASS="Bulleted"><A NAME="pgfId=606372"> </A>	Authentication</LI><LI CLASS="Bulleted"><A NAME="pgfId=606373"> </A>	Security</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606374"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606375"> </A>10 July, 1998. Kelly Kazem. First Draft.</P><P CLASS="Body"><A NAME="pgfId=621897"> </A>19 November, 1998. Clif Liu. Second Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.d.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.f.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>