<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1109: Optimizing QD3D 1.5.3 Apps For Maximum Performance</title>   <meta name="keywords" content="Mac OS 8 Quickdraw 3D optimizing performance accelerators trimesh object"><meta name="Description" content="Technical Note TN1109: This Technical Note presents techniquesnot discussed in the QuickDraw3D (QD3D) documentation whicha developer can use to boost performance in a typical QD3Dapplication. Included is a discussion on 3D accelerators."><meta name="categories" content="QuickDraw 3D"><meta name="week-posted" content="Jan 26, 1998 - Feb 6, 1998"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002949" title="Optimizing QD3D 1.5.3 Apps For Maximum Performance"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/index.html" target="_blank">Reference Library > QuickTime</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1109</div>
<div id="pageheadsub">Optimizing QD3D 1.5.3 Apps For Maximum Performance</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><center><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">          <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><p id="menutext">         <A HREF = "#Section1">Introduction</A><BR><BR>                  <A HREF = "#Section2">Techniques For Optimizing QD3D 1.5.3 Applications For Maximum Performance</A><BR><BR>                  <A HREF = "#Section3">Using 3D Accelerators To Boost Performance</A><BR><BR>          <A HREF = "#Summary">Summary</A><br><BR>         <A HREF="#References">References</a><BR><BR>                              <A HREF="#Downloads">Downloadables</A></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left>            			<!-- begin_intro_text --><p id="introtext">There are a number of          techniques not discussed in the QuickDraw3D (QD3D) documentation          which a developer can use to boost performance in a typical QD3D application.          This Technote presents these techniques. This Technote assumes you are familiar          with 3D graphics fundamentals and QD3D programming as described in the book          <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/QD3D/qd3d_book.htm">3D Graphics Programming With QuickDraw 3D</A> by Addison-Wesley.</p> <BR><BR><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 06 1998]</h3><!-- end_date -->        </td>    </tr></table> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content -->         <A NAME="Section1"></A>                  <H2>Introduction</H2>                  <P>3D software developers continue to add more and more powerful features to their applications. However, as these applications become more and more complex, their overall performance may suffer as well. The current QD3D documentation contains no discussion of how to improve performance in a typical QD3D application. This Technote present some techniques for doing so. Also included is a discussion of what affect 3D accelerators can have on application performance.</P>   <BR><P><A HREF="#top">Back to top</A></P><A NAME="Section2"></A><H2>Techniques For Optimizing QD3D 1.5.3 Applications For Maximum Performance</H2><P>There are a number of things QD3D application developers can do to get maximum performance out of their applications:</P><H3>Use The TriMesh Geometry</H3><H3>TriMesh Performance</H3><P>The trimesh geometry was first introduced with QD3D 1.5 (refer to Philip Schneider's article "<a href="http://developer.apple.com/dev/techsupport/develop/issue28/schneider.html">New QuickDraw3D Geometries</A>" in <I>develop</I> issue 28 for a good discussion of the various QD3D geometries, and to the document "Trimesh.pdf" on the QD3D 1.5.3 SDK for a discussion of the trimesh). With QD3D 1.5.3, performance of the trimesh geometry when used in immediate mode with the interactive renderer is quite good. If you care about speed, you'll definitely want to consider using the trimesh. Depending on your needs, many of the other QD3D geometries may work just as well - but if speed is important, consider using the trimesh. Future versions of QD3D will address performance of the other geometries too.</p><P>Also, if you are going to use the trimesh, be sure and use it correctly to achieve maximum performance. Don't try building one giant trimesh with 10 different texture attributes - that won't work (see the next section discussing materials in trimesh objects).</P>        <H3>Use Only One Texture Per TriMesh Object</H3>                <P>In general you'll get better performance if you use only one texture per         trimesh object.  The texture attribute should be in the trimesh data's         <CODE>triMeshAttributeSet</CODE>.  Don't attempt to apply a texture to individual         triangles or vertices.</P>        <H3>Supply A Bounding-Box For The TriMesh</H3>        <P>The trimesh geometry contains an optional bounding-box parameter         (see the <CODE>bBox</CODE>  parameter in the <CODE>TQ3TriMeshData</CODE> data structure)         that can be provided to accelerate culling/clipping. Do specify a bounding-box when         creating the trimesh geometry and you'll get better performance (however,         make sure the bounding box you specify is correct, or a crash may result).</P>                <H3>Apply Only the Normal &amp; UV Coordinate Vertex Attributes</H3>        <P>Apply only the following vertex attributes to a given object if you want better         performance:  normal (<CODE>kQ3AttributeTypeNormal</CODE>) &amp; UV Coordinate         (<CODE>kQ3AttributeTypeSurfaceUV</CODE>         &amp; <CODE>kQ3AttributeTypeShadingUV</CODE>).</P>        <H3>Reuse As Many Vertices As Possible</H3>        <P>Reuse as many vertices as possible.  Vertices with duplicate coordinates may         have different normals meaning you'll have to make a wasteful duplicate of the vertex.          In such cases, you should consider averaging the normals and removing the duplicate.          This will usually result in a smoothing effect on the geometry, but it will make things         go faster.</P>        <H3>Use the Triangle/Face Attribute Face Normal</H3>        <p>With the current implementation of QD3D version 1.5.3, you'll want to use the face         normal triangle/face attribute, and even then there are cases where you might not want         to do this.  If you do not supply a face normal, QD3D will calculate one for you every         time you render.  In many cases, this will cause QD3D to slow down, since calculating a         normal is slow.  However, if you have a lot of data, and it's unlikely your arrays of         normals stay in the L1 or L2 cache between renderings, then it can be faster to *not*         provide the face normal.</P>        <P>A cache miss can cost more cycles than just letting QD3D recalculate the normal.          In most cases, you'll want to provide the face normal, but run some tests and see if         your application works better without them.</P>                <P>Also, it's best if you make sure the vertices for each triangle are stored in         the counterclockwise direction. Refer to the document "Trimesh.pdf" on the QD3D         1.5.3 SDK for more details.</P>        <H3>Do Your Own Object Culling</H3>        <P>Do your own object culling?  QD3D's object culling uses bounding box culling,         which is fairly accurate and is really the only way to go for a general purpose         library like QD3D, but it's very slow.  You should implement your own object         culling function which does spherical culling.</P>        <P>Also, use backface culling for closed objects (when appropriate), as this         rendering style is likely to be significantly faster than the other backfacing         styles (refer to Chapter 6, "Style Objects", of <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/QD3D/qd3d_book.htm"><I>3D Graphics Programming With         QuickDraw 3D</I></A> for the details).</P>        <H3>Minimize Other Processing While Rendering</H3>                <P>Applications may perform many other activities while rendering, such as drawing         a wireframe view of a scene into another window, updating the coordinates of a         geometry, updating non-QD3D structures, etc. All these activities can have an         effect on rendering. If you can reduce the amount of time spent on these         activities at rendering time, you'll see a performance improvement in your application.</P>        <H3>Minimize Time Given To Background Applications</H3>                <P>Many applications give too much time (via the <CODE>WaitNextEvent</CODE> function)         to background applications while rendering, so no matter how much QD3D acceleration         is available,         there are always a few ticks delay between redraws during rendering. If you can         minimize the amount of time spent servicing background applications, your         application will be that much faster.</P>        <H3>Be Careful When Using Group Objects</H3>                <P>QD3D group objects are convenient for storing and managing objects.         However, many developers fail to realize each group will push and pop the         graphics state at execution time because by default, the group inline flag         (<CODE>kQ3DisplayGroupStateMaskIsInline</CODE>)  is not set (see Chapter 10 "Group Object"         of <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/QD3D/qd3d_book.htm"><I>3D Graphics Programming With QuickDraw 3D</I></A> for the details). Pushing and         popping of the graphics state at execution time for each group object can affect         performance in a bad way. </P>                <P>If you need to push and pop the graphics state manually, use the         <CODE>Q3Push_Submit</CODE> and <CODE>Q3Pop_Submit</CODE> functions.         Developers instead, may want to          implement their own data structures to handle the management of large numbers         of objects.</P>        <H3>Retained vs. Immediate Mode</H3>                <P>Depending upon your particular needs, using immediate mode may be faster than         retained mode. For example, if you are dealing with sphere or cone geometries with         the constant subdivision style set you will probably see a performance improvement         when immediate mode is used.</P>        <P>You'll really need to experiment to see which mode works best for you.         In general, if most of a model remains unchanged from frame to frame, you'll         probably want to use retained mode imaging to create and draw the model. If,         however, many parts of the model do change from frame to frame, you might consider         using immediate mode imaging, creating and rendering of a model on a shape-by-shape basis.         You can, of course, use a combination of retained and immediate mode imaging: you can         create retained objects for the parts of a model that remain static and draw quickly         changing objects in immediate mode. Refer to Chapter 1 of <a href="http://developer.apple.com/documentation/quicktime/qtdevdocs/QD3D/qd3d_book.htm">3D Graphics Programming With         QuickDraw3D</A> for a discussion of both retained and immediate modes.</P>        <H3>Don't Use <CODE>Q3View_Sync</CODE>,         <CODE>TQ3ViewEndFrameMethod</CODE> Unless Necessary</H3>   <P>It's best you not use the <CODE>Q3View_Sync</CODE> or <CODE>TQ3ViewEndFrameMethod</CODE>    functions unless    absolutely necessary when using the interactive renderer. These functions essentially    put the renderer into synchronous mode. Try to avoid doing so, and you'll get better    performance.</P>   <BR><P><A HREF="#top">Back to top</A></P>   <A NAME="Section3"></A><H2>Using 3D Accelerators To Boost Performance</H2><P>There's been an increase lately in the number of 3D graphics accelerator boards  which support QD3D. These accelerators are designed to also improve performance for most QD3D applications. However, many developers are disappointed to find their applications don't exhibit much in the way of improved performance with these boards installed on their systems. One reason for this is many developers are not using the techniques discussed in the previous section for obtaining maximum performance with their QD3D applications. </P><P>When looking at the performance of a given 3D accelerator, it is important you understand most cards accelerate the 3D graphics rasterization process. As you know, rasterization is one process (usually towards the end) in the rendering pipeline. It follows, then, if you are using a geometry in your program which is  computationally expensive, such as a NURB geometry, and your code and geometry calculations take up a great deal of time,  even if a given accelerator could "instantaneously" render polygons you wouldn't see much of a speed improvement in your program.</P><P>It is also likely that at a certain point (application/geometry/complexity), an application will wind up performing at the same speed whether a software renderer or a 3D accelerator board is being used. Developers can experiment to see where exactly this tradeoff takes place.</P><P>If you make rasterization more "expensive", for example by adding high quality (tri-linear mip mapped) texturing, transparency, and/or CSG operations, then you will see a large performance and quality gain over a software renderer (of course this is very much dependent on the 3D accelerator card in use). To really take advantage of a given 3D accelerator card, you need to tailor your application to take advantage of the specific card's features.</P><P>Most cards will, with varying degrees, accelerate QD3D applications, and will often improve substantially the appearance of textures. However, it is possible to bog a card down, as many cards don't properly handle all of the complexity that general purpose applications generate in a scene. </P>   <BR><P><A HREF="#top">Back to top</A></P>   <A NAME="Summary"></A><H2>Summary</H2><P>If you follow the above guidelines, you'll see a big performance boost in your QD3D application. If you don't believe us, and you would like to see how much the above techniques help speed up your application, there is a retail product called <B>3DMF Optimizer</B> from Pangea Software (<A HREF = "http://www.pangeasoft.net/downloads.html">http://www.pangeasoft.net/downloads.html</A>) which uses many of the techniques discussed in this note and let's you see the speed boosts we're talking about.  A demo version of 3DMF Optimizer is available at the URL listed above.</P>   <BR><P><A HREF="#top">Back to top</A></P><A NAME="References"></A><H2>References</H2><P><a href="http://developer.apple.com/documentation/macos8/Legacy/QuickDraw3D/quickdraw3d.html">   <I>3D Graphics Programming With QuickDraw 3D</I>, Addison-Wesley</A></p>   <p><a href="http://developer.apple.com/dev/techsupport/develop/issue28/schneider.html">   "New QuickDraw3D Geometries" by Philip Schneider, <I>develop</I> magazine issue 28</A></p>   <p><A HREF = "http://www.pangeasoft.net/downloads.html"><B>3D Optimizer</B>, from Pangea Software</A></p>    <BR><P><A HREF="#top">Back to top</A></P>        <A NAME="Downloads"></A>         <br><h2>Downloadables</h2>        <center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600">          <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P>            </TD>            <td align="left">               <p>Acrobat version of this Note (62K).</P>            </TD>            <td width=60 align=left>               <p><A HREF="pdf/tn1109.pdf">Download</A></P>            </TD>          </TR>        </TABLE></center><BR><BR>   <BR><P><A HREF="#top">Back to top</A></P>        </td></tr></table></center><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1109.html%3Fid%3DDTS10002949-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1109.html%3Fid%3DDTS10002949-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1109.html%3Fid%3DDTS10002949-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>