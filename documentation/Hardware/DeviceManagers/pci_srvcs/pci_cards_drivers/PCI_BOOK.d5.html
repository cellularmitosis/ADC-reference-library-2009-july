<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Startup Drive Control Request</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d4.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d6.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=4605"> </A>Startup Drive Control Request</H1><P CLASS="T1.Text1"><A NAME="pgfId=4606"> </A>The basic idea for both pre- and post-PCI Power Macintosh computers is that the boot partition has <TT CLASS="cv">kPartitionIsStartup</TT> set in its <TT CLASS="cv">pmStatus</TT> field. At startup time, the driver searches for this partition and adds its drive queue element to the drive queue before the other partitions. When the system subsequently searches for a disk to boot from, it will find this drive queue element and boot from it.</P><P CLASS="T1.Text1"><A NAME="pgfId=4607"> </A>The change with the PCI-based Power Macintosh computers is that the Startup Disk control panel allows the user to choose a startup partition. When the control panel opens, it sends a <TT CLASS="cv">kdgBoot</TT> Driver Gestalt request to the driver of each volume. The result from this request uniquely identifies the partition containing that volume. When the user chooses a startup volume, the control panel sends a <TT CLASS="cv">kcsSetStartupDrive</TT> (csCode 44) control request to the driver. The driver responds to this by modifying the partition map to set the <TT CLASS="cv">kPartitionIsStartup</TT> bit on the partition containing the volume and clear the bit on all other partitions.</P><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=17388"> </A>Note</b></p><P CLASS="Note"><A NAME="pgfId=4608"> </A>The startup drive mechanism is slightly different for Apple computers, such as the iMac computer, that support the NewWorld architecture. The final details were still being ironed out when this document was written. When the information is available, it will be incorporated into the appropriate sections in the documentation that discuss disk drivers and boot issues. </P></blockquote></DIV><DIV><H2 CLASS="H4.Heading4">SetStartupDrive Control Request</H2><P CLASS="T1.Text1">The <TT CLASS="cv">kcsSetStartupDrive</TT> control call (<TT CLASS="cv">csCode</TT> = 44) results when a user selects a drive from the Startup Device control panel in the current version of Mac OS. It indicates to the driver that a volume controlled by that driver (that is, one with its drive number in the <TT CLASS="cv">ioVRefNum</TT> field) is the chosen startup drive. This lets a specific partition selected by the user on a multiply partitioned disk be the startup volume by allowing the driver to control which partition is inserted into the drive queue first. Mass storage drivers (those that control elements in the drive queue) that set the <TT CLASS="cv">driverGestaltEnable</TT> bit must implement this control request or return <TT CLASS="cv">controlErr</TT>.</P></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d4.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d6.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>