<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A GXPD03: QuickDraw GX Printing Extensions</title><meta name="keywords" content="Mac OS 7 QuickDraw GX printing extensions PostScript comments"><meta name="Description" content="Technical Q&amp;A GXPD03: NOTE: QuickDraw GX printer driversand GX printing extensions will not be supported in Mac OS8.0 or in future Mac OS releases. Q&amp;A corrects the code foroverriding GXPostScriptDoDocumentHeader in an extension,so that the writer/user of the extension can add Postscriptcomments to the beginning of PostScript files generated bythe LaserWriter GX Driver."><meta name="categories" content="QuickDraw GX"><meta name="week-posted" content="May 1, 1995 - May 5, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001218" title="QuickDraw GX Printing Extensions"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A GXPD03</div>
<div id="pageheadsub">QuickDraw GX Printing Extensions</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><TABLE BORDER="0"><TR>	<td bgcolor="#e6e6e6" align=left>		<B>Important for all Apple Printing and Graphics Developers: </B><p id=p4>		The information in this Technical Q &amp; A is still relevant up to and including		<A HREF="../../technotes/tn/tn1090.html" target="_blank">Mac OS 7.6</A>		with QuickDraw GX 1.1.5. Beginning with the release of Mac OS 8.0,		however, Apple plans to deliver a system which incorporates QuickDraw GX		graphics and typography <B>only</B>. QuickDraw GX printer drivers and GX printing		extensions will <B>not</B> be supported in Mac OS 8.0 or in future Mac OS releases. Apple's		goal is to simplify the user experience of printing by unifying the Macintosh		graphic and printing architectures and standardizing on the classic Printing		Manager. </P>				For details on Apple's official announcement, refer to 		<A HREF="../../technotes/gxchange.html" target="_blank">		&lt;/dev/technotes/gxchange.html&gt;</A>	</TD></TR></TABLE><BR><p id = p2>Q:  I needed to add some PostScript comments to the beginning of thePostScript files generated by the LaserWriter GX driver. I wrote a GX printingextension to accomplish this, assuming that all I had to do was to override the<code>GXPostScriptDoDocumentHeader</code> message and buffer the desired data using<code>Send_GXBufferData</code>. Here is an example of my code: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr NewPostScriptDoDocumentHeader(gxPostScriptImageDataHdl hImageData) {   OSErr   theStatus=noErr;   chardataBuffer[256];   longbufferLen;   strcpy(dataBuffer, "%%DAVE'S TEST DATA");   bufferLen = strlen(dataBuffer);   theStatus = Send_GXBufferData((Ptr) dataBuffer, bufferLen,gxNoBufferOptions)   if (theStatus != noErr)   return(theStatus);   theStatus = Forward_GXPostScriptDoDocumentHeader(hImageData);   return(theStatus);} // NewPostScriptDoDocumentHeader</pre>	</TD></TR></TABLE></CENTER><p id=p4>Unfortunately,this causes a bus error when <code>Send_GXBufferData</code> is called, even if I put<code>Send_GXBufferData</code> after the call to <code>Forward_GXPostScriptDoDocumentHeader</code>. Myworkaround for this problem was to buffer the data from within an override of<code>GXOpenConnection</code>.</p><p id=p4>On page 4-119 of the QuickDraw GX documentation (<i>Inside Macintosh: QuickDrawGX Printing Extensions and Drivers</i>), it says, You can override this message[<code>GXPostScriptDoDocumentHeader</code>] to build your own document header or to addcomments to a PostScript header. Why doesn't this work?</p><p id=p4>A:  The override in your extension is basically correct, but the order of your codeneeds to be slightly different:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// note that the string is terminated with a &lt;cr&gt;#define kTestStr "%% Dave's test data\n"OSErr NewPostScriptDoDocumentHeader(gxPostScriptImageDataHdl hImageData) {   OSErr   theStatus=noErr ;   char    dataBuffer[256] ;   long    bufferLen ;   theStatus = Forward_GXPostScriptDoDocumentHeader(hImageData);   if (theStatus != noErr)   return(theStatus);   // Note that we do (sizeof(...) -1) below to strip off   // the C string null terminator for the string defined   theStatus = Send_GXBufferData( kTestStr,                                 (sizeof( kTestStr) - 1,                                 0) ;   return(theStatus);} // NewPostScriptDoDocumentHeader</pre>	</TD></TR></TABLE></CENTER><p id=p4>Make sure that the string is terminated with a carriage return. If you're using a#define to allocate static space for the string (this is not recommended),remember that it allocates the string, plus a null terminator. <code>Sizeof</code> thenreturns the size of the string, so you need to subtract 1 from the total. Thisstring should come from a resource or a data/prefs file. </p>  <p id=p4>If you want to add to the header from an application (to avoid writing theextension), you can add an item to the job collection of type <code>'post'</code>, using thetag <code>gxPrintingTagID</code>. If the first character of this item is a '%' character, itwill appear in the job header.</p></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[May 01 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/gxpd/gxpd03.html%3Fid%3DDTS10001218-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/gxpd/gxpd03.html%3Fid%3DDTS10001218-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/gxpd/gxpd03.html%3Fid%3DDTS10001218-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>