<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>SimpleHIMovieViewPlayer - /main.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxQuickTime-date.html">QuickTime</a> &gt; <A HREF="javascript:location.replace('index.html');">SimpleHIMovieViewPlayer</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">SimpleHIMovieViewPlayer</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/main.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/main.c</option></select>
				</p>
				</form>
				<p><strong><a href="SimpleHIMovieViewPlayer.zip">Download Sample</a></strong> (&#147;SimpleHIMovieViewPlayer.zip&#148;, 91.7K)<BR>
<strong><a href="SimpleHIMovieViewPlayer.dmg">Download Sample</a></strong> (&#147;SimpleHIMovieViewPlayer.dmg&#148;, 154.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*
*  File:    main.c of SimpleHIMovieViewPlayer
* 
*  Contains:  Carbon application demonstrating how to use HIMovieView to play movies
*  
*  Version:  1.0
* 
*  Created:  05/20/2005
*  
*  Copyright:  Copyright &copy; 2005 Apple Computer, All Rights Reserved
* 
*  Disclaimer:  IMPORTANT:  This Apple software is supplied to you by Apple Computer, Inc. (&quot;Apple&quot;) in 
*        consideration of your agreement to the following terms, and your use, installation, modification 
*        or redistribution of this Apple software constitutes acceptance of these terms.  If you do 
*        not agree with these terms, please do not use, install, modify or redistribute this Apple 
*        software.
*
*        In consideration of your agreement to abide by the following terms, and subject to these terms, 
*        Apple grants you a personal, non-exclusive license, under Apple's copyrights in this 
*        original Apple software (the &quot;Apple Software&quot;), to use, reproduce, modify and redistribute the 
*        Apple Software, with or without modifications, in source and/or binary forms; provided that if you 
*        redistribute the Apple Software in its entirety and without modifications, you must retain this 
*        notice and the following text and disclaimers in all such redistributions of the Apple Software. 
*        Neither the name, trademarks, service marks or logos of Apple Computer, Inc. may be used to 
*        endorse or promote products derived from the Apple Software without specific prior written 
*        permission from Apple.  Except as expressly stated in this notice, no other rights or 
*        licenses, express or implied, are granted by Apple herein, including but not limited to any 
*        patent rights that may be infringed by your derivative works or by other works in which the 
*        Apple Software may be incorporated.
*
*        The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO WARRANTIES, EXPRESS OR 
*        IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY 
*        AND FITNESS FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE 
*        OR IN COMBINATION WITH YOUR PRODUCTS.
*
*        IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR CONSEQUENTIAL 
*        DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS 
*        OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, 
*        REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER 
*        UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN 
*        IF APPLE HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*               &lt;1&gt; 05/20/05    QT engineering / dts     initial release
*/

#include &lt;Carbon/Carbon.h&gt;
#include &lt;QuickTime/QuickTime.h&gt;

#define DEBUG_ERRORS 1
#if DEBUG_ERRORS

  #undef require_noerr
  #define require_noerr(err, label) \
    if (err != noErr) \
    { \
      printf(&quot;Error: %s[%i]\n&quot;, __FILE__, __LINE__); \
      fflush(stdout); \
      assert(err == noErr); \
      goto label; \
    }
    
#endif

// ID's set up in IB
HIViewID kHIMovieViewID = {'moov', 0};
HIViewID kOptimalSizeID = {'moov', 5};
HIViewID kControllerSizeID = {'moov', 6};

// command IDs
enum {
    kHICommandControllerVisible = 'VIZZ',
    kHICommandAcceptsFocus = 'AFOC',
  kHICommandEditable = 'EDIT',
    kHICommandHandleEditingUI = 'HEUI',
};

// our data
typedef struct MainWindowData {
  WindowRef window;
  NavDialogRef openDialog;
  Movie movie;
  MovieController movieController;
  HIViewRef view;
} MainWindowData, *MainWindowPtr;

// quit application on window closing
static OSStatus MainWindowClosed(EventRef event, MainWindowData *inWindowData)
{
  QuitApplicationEventLoop();
    
  return noErr;
}

// MainWindowResizeToMovie is called from the controll event handler to resize
// the window when the HIMovieView's Optimal Bounds have changed
static OSStatus MainWindowResizeToMovie(MainWindowData *inWindowData)
{
  OSStatus err = noErr;
  HIRect viewBounds;
  HIRect optimalBounds;
    HIPoint minLimits;
  Rect windowBounds;
  EventRef event;
    CFStringRef text;
    
    if (NULL == inWindowData-&gt;movie) return err;
  
  // get the HIView's current bounds
  err = HIViewGetBounds(inWindowData-&gt;view, &amp;viewBounds);
  require_noerr(err, bail);

  // to get the HIView's optimal bounds we create a carbon event and send it to the view
  err = CreateEvent(NULL, kEventClassControl, kEventControlGetOptimalBounds, GetCurrentEventTime(), kEventAttributeUserEvent, &amp;event);
  require_noerr(err, bail);
  err = SendEventToEventTargetWithOptions(event, HIObjectGetEventTarget((HIObjectRef)inWindowData-&gt;view), kEventTargetDontPropagate);
  require_noerr(err, bail);
  err = GetEventParameter(event, kEventParamControlOptimalBounds, typeHIRect, NULL, sizeof(HIRect), NULL, &amp;optimalBounds);
  require_noerr(err, bail);
    
    ReleaseEvent(event);

  // we do the same to get window's minimum bounds
  err = CreateEvent(NULL, kEventClassWindow, kEventWindowGetMinimumSize, GetCurrentEventTime(), kEventAttributeUserEvent, &amp;event);
  require_noerr(err, bail);
  err = SendEventToEventTargetWithOptions(event, GetWindowEventTarget(inWindowData-&gt;window), kEventTargetDontPropagate);
  require_noerr(err, bail);
  err = GetEventParameter(event, kEventParamDimensions, typeHIPoint, NULL, sizeof(HIPoint), NULL, &amp;minLimits);
  require_noerr(err, bail);
    
    // update the text that displays the HIMovieView's optimal bounds
    text = CFStringCreateWithFormat(kCFAllocatorDefault, NULL, CFSTR(&quot;%d x %d&quot;), (UInt32)optimalBounds.size.width, (UInt32)optimalBounds.size.height);
    if (NULL != text) {
    HIViewRef control;
        HIViewFindByID(HIViewGetRoot(inWindowData-&gt;window), kOptimalSizeID, &amp;control);  
        HIViewSetText(control, text);
        CFRelease(text);
    }
    
  // grow window bounds by the difference
  err = GetWindowBounds(inWindowData-&gt;window, kWindowContentRgn, &amp;windowBounds);
  require_noerr(err, bail);

  windowBounds.right += (short)(optimalBounds.size.width - viewBounds.size.width);
  windowBounds.bottom += (short)(optimalBounds.size.height - viewBounds.size.height);
    
    // but make sure and limit it to the minimum size of the window
    if ((windowBounds.right - windowBounds.left) &lt; minLimits.x) windowBounds.right = minLimits.x + windowBounds.left;
    if ((windowBounds.bottom - windowBounds.top) &lt; minLimits.y) windowBounds.bottom = minLimits.y + windowBounds.top;

  err = SetWindowBounds(inWindowData-&gt;window, kWindowContentRgn, &amp;windowBounds);
  require_noerr(err, bail);

bail:
  if (event != NULL)
    ReleaseEvent(event);

  return err;
}

// get the movie and set it on the HIMovieView
static void MainWindowNavOpen(NavCBRecPtr params, MainWindowData *inWindowData)
{
  OSStatus err;
  NavReplyRecord reply;
  AEDesc descriptor;
  FSRef file;
  DataReferenceRecord dataRef = {0};
  QTVisualContextRef visualContext = NULL;  
  Boolean active = TRUE;
  Movie oldMovie = NULL;
    
    // create an array of properties for NewMovieFromProperties
    // these properties describe how to create the new movie
    // see Movies.h for the full list of availale properties
  QTNewMoviePropertyElement newMovieProperties[] = {
    {kQTPropertyClass_DataLocation,     kQTDataLocationPropertyID_DataReference, sizeof(dataRef),       &amp;dataRef,       0},
    {kQTPropertyClass_NewMovieProperty, kQTNewMoviePropertyID_Active,            sizeof(active),        &amp;active,        0},
    {kQTPropertyClass_Context,          kQTContextPropertyID_VisualContext,      sizeof(visualContext), &amp;visualContext, 0},
  };

  // get the FSRef from Navigation Services
  err = NavDialogGetReply(params-&gt;context, &amp;reply);
  require_noerr(err, bail);
  
  err = AECoerceDesc(&amp;reply.selection, typeFSRef, &amp;descriptor);
  NavDisposeReply(&amp;reply);
  require_noerr(err, bail);
  
  err = AEGetDescData(&amp;descriptor, &amp;file, sizeof(FSRef));
  AEDisposeDesc(&amp;descriptor);
  require_noerr(err, bail);

  // create a QuickTime data reference from the FSRef
  err = QTNewDataReferenceFromFSRef(&amp;file, 0, &amp;dataRef.dataRef, &amp;dataRef.dataRefType);
  require_noerr(err, bail);

  // if there's an old movie save it so we can dispose of it if
    // we load up a new movie successfully
  oldMovie = inWindowData-&gt;movie;
  inWindowData-&gt;movie = NULL;
  
    // create a new movie using movie properties
    // when calling this function, you supply a set of input properties that describe the information
    // required to instantiate the movie (its data reference, audio context, visual context, and so on)
  err = NewMovieFromProperties(sizeof(newMovieProperties) / sizeof(newMovieProperties[0]), // the number of properties in the array passed in inputProperties
                                 newMovieProperties,  // a pointer to a property array describing how to instantiate the movie
                                 0,            // number of properties in the array passed in outputProperties
                                 NULL,          // pointer to a property array to receive output parameters - NULL if you don't want this information
                                 &amp;inWindowData-&gt;movie);  // pointer to a variable that receives the new movie
  // make sure to dispose of the dataRef we no longer need it
    DisposeHandle(dataRef.dataRef);
  require_noerr(err, bail);

  // set the HIMovieView's current movie
  err = HIMovieViewSetMovie(inWindowData-&gt;view, inWindowData-&gt;movie);
  require_noerr(err, bail);

  if (oldMovie != NULL)
    DisposeMovie(oldMovie);

bail:
  if (err != noErr &amp;&amp; inWindowData-&gt;movie != NULL) {
    DisposeMovie(inWindowData-&gt;movie);
    inWindowData-&gt;movie = NULL;
  }
}

// Navigation services callback to handle the sheet
static void MainWindowNavEventProc(NavEventCallbackMessage message, NavCBRecPtr params, MainWindowData *inWindowData)
{  
  switch (message) {
  case kNavCBUserAction:
    if (params-&gt;userAction == kNavUserActionOpen)
      MainWindowNavOpen(params, inWindowData);
    break;

  case kNavCBTerminate:
    NavDialogDispose(inWindowData-&gt;openDialog);
    inWindowData-&gt;openDialog = NULL;
    EnableMenuCommand(NULL, kHICommandOpen);
    break;
  default:
      break;
    }
}

// MainWindowOpenMovie is called from the Carbon Command handler when a user wants to open a file
static OSStatus MainWindowOpenMovie(MainWindowData *inWindowData)
{
  OSStatus err = noErr;
  NavDialogCreationOptions options;
  
  DisableMenuCommand(NULL, kHICommandOpen);

  err = NavGetDefaultDialogCreationOptions(&amp;options);
  require_noerr(err, bail);
  
  options.modality = kWindowModalityWindowModal;
  options.parentWindow = inWindowData-&gt;window;
  err = NavCreateGetFileDialog(&amp;options, NULL, (NavEventUPP)&amp;MainWindowNavEventProc, NULL, NULL, inWindowData, &amp;inWindowData-&gt;openDialog);
  require_noerr(err, bail);
  
  err = NavDialogRun(inWindowData-&gt;openDialog);
  if (err == userCanceledErr) err = noErr;
  
bail:
  return err;
}

// MainWindowCommandUpdateStatus is used for taking care of enabling or disabling menu items
// we only care about the edit menu in this sample
static OSStatus MainWindowCommandUpdateStatus(EventRef event, MainWindowData *inWindowData)
{    
  HICommand aCommand;
  GetEventParameter(event, kEventParamDirectObject, typeHICommand, NULL, sizeof(HICommand), NULL, &amp;aCommand);
    
    // the HIMovieView can handle the edit menu for us when it has the editing, editingUI and accepts focus
    // attributes set -- when they're off we need to disable the menu items ourselves
  switch (aCommand.commandID) {
        case kHICommandUndo:
        case kHICommandCut:
        case kHICommandCopy:
        case kHICommandPaste:
        case kHICommandClear:
        case kHICommandSelectAll:
        {
            DisableMenuItem(aCommand.menu.menuRef, aCommand.menu.menuItemIndex);
        }
    }
    
  return eventNotHandledErr;
}

// MainWindowCommandProcess Carbon event handler takes care of menu item selections and
// check box status updating the HIMovieView's attributes as needed
static OSStatus MainWindowCommandProcess(EventRef event, MainWindowData *inWindowData)
{
  OSStatus err;
  HICommandExtended command;
  
  err = GetEventParameter(event, kEventParamDirectObject, typeHICommand, NULL, sizeof(HICommandExtended), NULL, &amp;command);
  require_noerr(err, bail);

  err = eventNotHandledErr;
  
  switch (command.commandID) {
  case kHICommandOpen:
      // open a movie file
    err = MainWindowOpenMovie(inWindowData);
    break;
        
    // take care of the checkboxes
    case kHICommandControllerVisible:
    {
      // change the attribute controlling the visibility of the QuickTime Movie Controller in the HIMovieView
      SInt16 value = GetControlValue(command.source.control);
      if (value) {
        HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewControllerVisibleAttribute, kHIMovieViewNoAttributes);
        } else {
          HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewNoAttributes, kHIMovieViewControllerVisibleAttribute);
        }
      break;
    }
    case kHICommandAcceptsFocus:
    {
      // change the attribute controlling HIMovieView user focus
        // for editing to work HIMovieView must have focus
    SInt16 value = GetControlValue(command.source.control);
      if (value) {
          ControlRef control;
        
            HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewAcceptsFocusAttribute, kHIMovieViewNoAttributes);
            
            // if we're not already focused do it now
            GetKeyboardFocus(inWindowData-&gt;window, &amp;control);
          if (control != inWindowData-&gt;view) {
              SetKeyboardFocus(inWindowData-&gt;window, inWindowData-&gt;view, kControlFocusNextPart);
            }
        } else {
          // clear it
          HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewNoAttributes, kHIMovieViewAcceptsFocusAttribute);
            ClearKeyboardFocus(inWindowData-&gt;window);
        }
        break;
    }
    case kHICommandEditable:
    {
      // change the attribute controlling the ability for HIMovieView to edit the movie being displayed
    SInt16 value = GetControlValue(command.source.control);
      if (value) {
        HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewEditableAttribute, kHIMovieViewNoAttributes);
        } else {
          HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewNoAttributes, kHIMovieViewEditableAttribute);
        }
        break;
    }
    case kHICommandHandleEditingUI:
    {
      // change the attribute controlling the ability for HIMovieView to controll the Edit Menu user interface
        // for this to work, HIMovieView must be editable and have focus
    SInt16 value = GetControlValue(command.source.control);
      if (value) {
        HIMovieViewChangeAttributes(inWindowData-&gt;view, kHIMovieViewHandleEditingHIAttribute, 0);
        } else {
          HIMovieViewChangeAttributes(inWindowData-&gt;view, 0, kHIMovieViewHandleEditingHIAttribute);
        }
        break;
    }
  default:
      break;
    }

bail:
  return err;
}

// MainWindowEventHandler is our standard Carbon event handler
static pascal OSStatus MainWindowEventHandler(EventHandlerCallRef call, EventRef event, void* inUserData )
{
  UInt32 eventClass = GetEventClass(event);
  UInt32 eventKind = GetEventKind(event);
    OSStatus err = eventNotHandledErr;
    
    MainWindowData *data = (MainWindowData*)inUserData;
  require(NULL != data, bail);
    
  switch (eventClass) {
    
    // handle window events
  case kEventClassWindow:
    switch (eventKind) {
        case kEventWindowBoundsChanged:
        {
            HIRect viewBounds;
            CFStringRef text;
            
          // get view's current bounds
      HIViewGetBounds(data-&gt;view, &amp;viewBounds);

            // update the text that displays the Windows current bounds
            text = CFStringCreateWithFormat(kCFAllocatorDefault, NULL, CFSTR(&quot;%d x %d&quot;), (UInt32)viewBounds.size.width, (UInt32)viewBounds.size.height);
            if (NULL != text) {
                HIViewRef control;
                HIViewFindByID(HIViewGetRoot(data-&gt;window), kControllerSizeID, &amp;control);  
                HIViewSetText(control, text);
                CFRelease(text);
            }
            break;
        }
        
        // return the minimum size we want the window to be able to resize to
        case kEventWindowGetMinimumSize:
        {
          HISize controllerSize;
        HIPoint dimensions = { 498, 272 };
        
          controllerSize = HIMovieViewGetControllerBarSize(data-&gt;view);
            dimensions.y += controllerSize.height;
            
            SetEventParameter(event, kEventParamDimensions, typeHIPoint, sizeof(HIPoint), &amp;dimensions);
            
            err = noErr;
        
          break;
    }
        
    case kEventWindowClosed:
      err = MainWindowClosed(event, data);
      break;
            
        default:
      break;
        } // switch
        
        break;
    
    // handle commands
  case kEventClassCommand:
    switch (eventKind) {
        case kEventCommandUpdateStatus:
          err = MainWindowCommandUpdateStatus(event, data);
            break;
    case kEventCommandProcess:
      err = MainWindowCommandProcess(event, data);
      break;
    default:
      break;
        } // switch
        break;
        
  default:
      break;
    }

bail:
  return err;
}

// MovieViewEventHandler handles HIMovieView events
static pascal OSStatus MovieViewEventHandler(EventHandlerCallRef call, EventRef event, void* inUserData)
{
  OSStatus err = eventNotHandledErr;
  UInt32 eventClass = GetEventClass(event);
  UInt32 eventKind = GetEventKind(event);
  MainWindowData *data = (MainWindowData*)inUserData;

  switch (eventClass) {
  case kEventClassMovieView:
    switch (eventKind) {
        
        // the optimal bounds of the HIMovieView has changed so resize the window appropriately
    case kEventMovieViewOptimalBoundsChanged:
      err = MainWindowResizeToMovie(data);
      break;
            
    default:
      break;
        } // switch
        break;
        
  default:
      break;
    }
  
  return err;
}

int main(int argc, char* argv[])
{
  OSStatus err = noErr;
  IBNibRef nib = NULL;
    EventRef event;
    HICommandExtended command = {0, kHICommandOpen};
    
    EventTypeSpec windowEvents[] = {{kEventClassWindow, kEventWindowClosed},
                    {kEventClassWindow, kEventWindowBoundsChanged},
                                    {kEventClassWindow, kEventWindowGetMinimumSize},
                    {kEventClassCommand, kEventCommandUpdateStatus},
                    {kEventClassCommand, kEventCommandProcess}};
    EventTypeSpec viewEvents[] ={{kEventClassMovieView, kEventMovieViewOptimalBoundsChanged}};
    
  MainWindowData windowData = { 0 };

  EnterMovies();
  
    // standard stuff to create a window
  err = CreateNibReference(CFSTR(&quot;main&quot;), &amp;nib);
  require_noerr(err, CantOpenNib);
  
  err = SetMenuBarFromNib(nib, CFSTR(&quot;MenuBar&quot;));
  require_noerr(err, bail);
  
  err = CreateWindowFromNib(nib, CFSTR(&quot;MainWindow&quot;), &amp;windowData.window);
  require_noerr(err, bail);
  
    // grab the movie view from the view hierarchy
  err = HIViewFindByID(HIViewGetRoot(windowData.window), kHIMovieViewID, &amp;windowData.view);
  require_noerr(err, bail);

  // install event handlers
  err = InstallWindowEventHandler(windowData.window, &amp;MainWindowEventHandler, GetEventTypeCount(windowEvents), windowEvents, &amp;windowData, NULL);
  require_noerr(err, bail);  
  err = InstallHIObjectEventHandler((HIObjectRef)windowData.view, &amp;MovieViewEventHandler, GetEventTypeCount(viewEvents), viewEvents, &amp;windowData, NULL);
  require_noerr(err, bail);
  
    // dispose the NIB ref, we don't need it anymore
  DisposeNibReference(nib);
  nib = NULL;
  
    // set inital movie view attributes and show the window
    OptionBits setAttributes = kHIMovieViewAutoIdlingAttribute | kHIMovieViewControllerVisibleAttribute;
    OptionBits clearAttributes = kHIMovieViewEditableAttribute | kHIMovieViewHandleEditingHIAttribute | kHIMovieViewAcceptsFocusAttribute;
  
    err = HIMovieViewChangeAttributes(windowData.view, setAttributes, clearAttributes);
  require_noerr(err, bail);
  
  ShowWindow(windowData.window);
    
    // send an open event to ourselves to bring down the Navigation sheet and grab a movie
    err = CreateEvent(NULL, kEventClassCommand, kEventCommandProcess, GetCurrentEventTime(), kEventAttributeUserEvent, &amp;event);
  require_noerr(err, bail);    
  err = SetEventParameter(event, kEventParamDirectObject, typeHICommand, sizeof(HICommandExtended), &amp;command);
    require_noerr(err, bail);
  err = SendEventToEventTargetWithOptions(event, GetWindowEventTarget(windowData.window), kEventTargetDontPropagate);
  require_noerr(err, bail);
    
    ReleaseEvent(event);
  
    // go...
  RunApplicationEventLoop();

bail:  
  if (nib != NULL)
    DisposeNibReference(nib);

CantOpenNib:
  ExitMovies();

  return err;
}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/SimpleHIMovieViewPlayer/listing1.html%3Fid%3DDTS10003662-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/SimpleHIMovieViewPlayer/listing1.html%3Fid%3DDTS10003662-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/SimpleHIMovieViewPlayer/listing1.html%3Fid%3DDTS10003662-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>