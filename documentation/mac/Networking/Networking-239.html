<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Adding an Entry to the AppleTalk Transition Queue(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING239></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-238.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-240.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-235.html"><B>Chapter 10 - Link-Access Protocol (LAP) Manager</B></A> / <A HREF="Networking-237.html"><B>Using the LAP Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING239-0></A>
<H2><A NAME=MARKER-9-22></A>Adding an Entry to the AppleTalk Transition Queue</H2>
 <A NAME=MARKER-2-4></A><A NAME=MARKER-2-24></A><A NAME=MARKER-2-205></A><A NAME=MARKER-2-127></A>To ensure<A NAME=MARKER-2-27></A> that<A NAME=MARKER-2-186></A> your application is not adversely affected by a transition event, your application places an entry in the AppleTalk Transition Queue. <B></B><P>
 To do this, you must create an <A NAME=MARKER-2-29></A>AppleTalk Transition Queue entry record of type <A NAME=MARKER-2-48></A><CODE>ATQentry</CODE> and give the LAP Manager a pointer to it. See <A HREF=Networking-245.html#MARKER-9-128>"The AppleTalk Transition Queue Entry" on page 10-25</A> for a description of the AppleTalk Transition Queue entry record. This record includes a <CODE>CallAddr</CODE> field that holds a pointer to <A NAME=MARKER-2-97></A>a <B>transition event handler routine</B> that you provide, which is described in the following section <A HREF=Networking-240.html#MARKER-9-35>"How the LAP Manager Calls Your Transition Event Handler Routine."</A> <A NAME=MARKER-2-95></A><P>
 Because you provide the memory for the queue entry, you can add as many fields to the end of the entry as you wish for your own purposes. Whenever the LAP Manager calls your transition event handler routine, it provides you with a pointer to the queue entry so that you can have access to the information you stored at the end of your queue entry.<P>
 After you have created the AppleTalk Transition Queue entry record, you use the <CODE>LAPAddATQ</CODE> function to add the entry to the AppleTalk Transition Queue. You pass a pointer to the entry record as the value of the function's <CODE>theATQEntry</CODE> parameter. <A HREF=#MARKER-9-33>Listing 10-2</A> shows how to do this using assembly language: you place a routine selector in the D0 register, place a pointer to your AppleTalk Transition Queue entry in the A0 register, and execute a JSR instruction to an offset past the start of the LAP Manager. The start of the LAP Manager is contained in the global variable <CODE>LAPMgrPtr</CODE> ($B18). The offset to the LAP Manager routines is given by the constant <CODE>LAPMgrCall</CODE> (2).<P>
<B>Listing 10-2  <A NAME=MARKER-9-33></A>Adding an AppleTalk Transition Queue entry </B><P>
<PRE>
LAPMgrPtr   EQU      $B18           ;entry point for LAP Manager
LAPMgrCall  EQU      2              ;offset to LAP Manager 
                                    ; routines
ATQEntry    EQU      *              ;pointer to ATQ entry

            MOVEQ    #23,D0         ;place routine selector 
                                    ; in D0 
            MOVE.L   LAPMgrPtr,An   ;put pointer to LAP Mgr in An
            MOVE.L   ATQEntry,A0    ;put ATQ entry in A0 
            JSR      LAPMgrCall(An) ;jump to start of LAP Mgr
                                    ; routines
</PRE>
 When you no longer want to be notified of transition events or before your program exits, you use the <CODE>LAPRmvATQ</CODE> function to remove your AppleTalk Transition Queue entry from the queue. <A HREF=#MARKER-9-34>Listing 10-3</A> shows how to do this from assembly language; you place the routine selector in the D0 register, place a pointer to your AppleTalk Transition Queue entry in the A0 register, and execute a JSR instruction to an offset past the start <BR>of the LAP Manager. The start of the LAP Manager is contained in the global variable <CODE>LAPMgrPtr</CODE> ($B18). The offset to the LAP Manager routines is given by the constant <CODE>LAPMgrCall</CODE> (2).<P>
<B>Listing 10-3  <A NAME=MARKER-9-34></A>Removing an AppleTalk Transition Queue entry</B><P>
<PRE>
LAPMgrPtr   EQU      $B18           ;entry point for LAP Manager
LAPMgrCall  EQU      2              ;offset to LAP Manager 
                                    ; routines
ATQEntry    EQU      *              ;pointer to ATQ entry

            MOVEQ    #24,D0         ;place routine selector 
                                    ; in D0 (24 to remove an 
                                    ; entry)
            MOVE.L   LAPMgrPtr,An   ;put pointer to LAP Mgr in An
            MOVE.L   ATQEntry,A0    ;put ATQ entry in A0 
            JSR      LAPMgrCall(An) ;jump to start of LAP Mgr
                                    ; routines
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-238.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-240.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
