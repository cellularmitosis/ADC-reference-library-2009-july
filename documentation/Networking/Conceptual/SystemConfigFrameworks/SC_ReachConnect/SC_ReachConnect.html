<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>System Configuration Programming Guidelines: Determining Reachability and Getting Connected</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Determining Reachability and Getting Connected"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001065-CH204" title="Determining Reachability and Getting Connected"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000429" target="_top">Networking</a> &gt; <a href="../SC_Intro/SC_Intro.html#//apple_ref/doc/uid/TP40001065-CH201-TPXREF101">System Configuration Programming Guidelines</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SC_UnderstandSchema/SC_UnderstandSchema.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SC_RevHistory/SC_RevHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001065-CH204-BHAFBAHI" title="Determining Reachability and Getting Connected"></a><h1>Determining Reachability and Getting Connected</h1><p>This chapter describes the System Configuration reachability and connection APIs. You use the reachability API to determine if data destined for a remote host can leave the local machine. To start or stop a PPP connection, you use the connection API.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH204-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp;The System Configuration connection API supports only PPP-based connections; it does not not help you establish a TCP-based connection. </p></div><p>It is not necessary to have an in-depth understanding of the System Configuration architecture to determine reachability or start a PPP connection. The reachability and connection APIs provide a layer of abstraction that allows an application to make connections without worrying about the state of the network stack.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-TPXREF102">Scope of the Reachability and Connection APIs</a>
				
			<br/>
			
        
			
			
				<a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-SW2">A Reachability and Connection Example</a>
				
			<br/>
			
        
			
			
				<a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-TPXREF103">Using the Reachability API</a>
				
			<br/>
			
        
			
			
				<a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-TPXREF107">Using the Network Connection API</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF102" title="Scope of the Reachability and Connection APIs"></a><h2>Scope of the Reachability and Connection APIs</h2><p>Many types of applications need to find out if a remote host is reachable or to start a PPP-based connection. For example, an application might need to check for software updates that are available from a remote server. In Mac OS X version 10.3 and later, the System Configuration framework provides APIs to accomplish these tasks quickly and easily, without requiring a detailed knowledge of System Configuration architecture. In particular, the reachability and connection APIs do much of their work behind the scenes, so the application does not have to poll for status changes or watch specific keys in the dynamic store. </p><p>The System Configuration reachability API helps an application determine if a remote host is reachable. A remote host is considered reachable if a data packet sent to the host can leave the local computer, regardless of what ultimately happens to the packet. In other words, the reachability of a remote host does not guarantee that the host will receive the data.</p><p>In practice, when a remote host is deemed reachable, but the packets you send to it fail to arrive, the myriad possible reasons for the failure fall into two broad categories:</p><ol class="ol"><li class="li"><p>A part of the Internet connection over which you have no control is broken. For example, the remote host’s server is down.</p></li><li class="li"><p>A part of your local network infrastructure over which you might have control is broken. For example, your modem hasn’t dialed or your AirPort base station is turned off.</p></li></ol><p>The reachability API cannot help you with problems in the first category. As long as data packets can leave the local machine, the remote host is considered reachable. What the reachability API can provide is help diagnosing some of the problems in the second category. If, for example, the modem is currently disconnected, the API can tell you this.</p><p>To further define the scope of the System Configuration reachability and connection APIs, this document uses the following phrases to distinguish between two different types of network connection:</p><ul class="ul"><li class="li"><p><strong>Network transport connection</strong>. This is a TCP-based connection you initiate using, for example, BSD sockets.</p></li><li class="li"><p><strong>Network link connection</strong>. This is a PPP-based connection you initiate by, for example, telling the modem to dial.</p></li></ul><p>The reachability API helps you determine if a remote host is reachable by examining the status of the local network link connection. The connection API allows you to start a network link connection. After you successfully start a network link connection, you use different API (such as Core Foundation networking API) to establish a network transport connection.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-SW2" title="A Reachability and Connection Example"></a><h2>A Reachability and Connection Example</h2><p>Determining reachability and requesting a network link connection often go hand in hand. As an example, consider the running of an email application. The sequence of events might go like this:</p><ol class="ol"><li class="li"><p>The user launches the email application to check her email.</p></li><li class="li"><p>The email application uses the reachability API to find out if the POP server is reachable.</p></li><li class="li"><p>The reachability API tells the application that the POP server is reachable, but that a network link connection must first be made.</p></li><li class="li"><p>The email application asks the user if she wants to dial the modem and she clicks “OK”. (The application might skip this step if the user has set a preference that tells the modem to dial automatically when the email application is launched.)</p></li><li class="li"><p>The email application uses the connection API to start a PPP connection, which causes the modem to dial. At this point, the email application can return to its work.</p></li><li class="li"><p>The reachability API notifies the email application that the network link connection is up and the email application then uses a network transport connection to fetch the email.</p></li></ol><p>After the email application delivers the email to the user, it might or might not cause the PPP connection to drop, depending on the user’s preferences. Either way, when the email application quits, the PPP connection is dropped and, if the email application held the last reference to the connection, the modem disconnects. For more information on connection references, see <span class="content_text"><a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-TPXREF110">“Starting and Stopping a Connection.”</a></span></p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF103" title="Using the Reachability API"></a><h2>Using the Reachability API</h2><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH204-SW3" title="Note"></a><p><strong>Note:</strong>&nbsp; Function names in the System Configuration framework APIs follow Core Foundation function-name conventions. In particular, a function that has “Create” or “Copy” in its name returns a reference you must release. To learn more about Core Foundation memory management policies, see <em><a href="../../../../CoreFoundation/Conceptual/CFMemoryMgmt/index.html#//apple_ref/doc/uid/10000127i" target="_top">Memory Management Programming Guide for Core Foundation</a></em>.</p></div><p>In versions of Mac OS X prior to 10.3, the System Configuration reachability API consisted of two functions. The functions, <code><a href="../../../Reference/SysConfig/SCNetwork/CompositePage.html#//apple_ref/c/func/SCNetworkCheckReachabilityByAddress" target="_top">SCNetworkCheckReachabilityByAddress</a></code> and <code><a href="../../../Reference/SysConfig/SCNetwork/CompositePage.html#//apple_ref/c/func/SCNetworkCheckReachabilityByName" target="_top">SCNetworkCheckReachabilityByName</a></code>, supply information about the reachability of a remote host by providing a set of flags. The flags (defined in <code>SCNetwork.h</code>) indicate, for example, that the specified remote host could be reached using the current network configuration. Unfortunately, these functions encouraged polling because they did not support notifications.</p><p>In Mac OS X version 10.3, the System Configuration framework introduced the SCNetworkReachability API which supports asynchronous notifications of changes in the connection to a remote host. You still get the same set of connection-status flags the previous reachability functions supplied to determine if a connection is required, but you no longer have to poll to find out if a connection attempt is successful. </p><p>Most functions in the new API rely on an <code>SCNetworkReachabilityRef</code> (defined in <code>SCNetworkReachability.h</code>) you use to identify the remote target. You create this reference for a specific address or hostname and use it to add the reference to your run loop and set up a callback function. You can use the information in the connection-status flags to request a network link connection and the new reachability API notifies you when the connection is established.</p><p>You can use the new reachability functions in your application to perform the following tasks:</p><ul class="ul"><li class="li"><p>Create a reference for your target remote host you can use in other reachability functions.</p></li><li class="li"><p>Add the target to your run loop.</p></li><li class="li"><p>Provide a callback function that’s called when the reachability status of your target changes.</p></li><li class="li"><p>Determine if the target is reachable.</p></li></ul><p>The following sections describe how to use the SCNetworkReachability functions to perform these tasks. For a code example demonstrating how to use the SCNetworkReachability API, see <em><a href="../../../../../samplecode/SimpleReach/index.html#//apple_ref/doc/uid/DTS10003238" target="_top">SimpleReach</a></em>.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF104" title="Creating a Reference"></a><h3>Creating a Reference</h3><p>The SCNetworkReachability API provides three functions that create a target reference you can use to monitor the reachability of a remote host:</p><ul class="spaceabove"><li class="li"><p><code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityCreateWithAddress" target="_top">SCNetworkReachabilityCreateWithAddress</a></code></p></li><li class="li"><p><code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityCreateWithAddressPair" target="_top">SCNetworkReachabilityCreateWithAddressPair</a></code></p></li><li class="li"><p><code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityCreateWithName" target="_top">SCNetworkReachabilityCreateWithName</a></code></p></li></ul><p>If you are interested in the reachability of only the remote host, you can use either <code><!--a-->SCNetworkReachabilityCreateWithAddress<!--/a--></code> or <code><!--a-->SCNetworkReachabilityCreateWithName<!--/a--></code>. For <code><!--a-->SCNetworkReachabilityCreateWithAddress<!--/a--></code>, you supply a remote host address in a <code>sockaddr</code> structure. For more information on the <code>sockaddr</code> structure, see the networking <code>man</code> page at <span class="content_text"><a href="../../../../../documentation/Darwin/Reference/ManPages/man4/netintro.4.html" target="_top">http://developer.apple.com/documentation/Darwin/Reference/ManPages/man4/netintro.4.html</a></span>. For <code><!--a-->SCNetworkReachabilityCreateWithName<!--/a--></code>, you supply a remote host name, such as www.apple.com.</p><p>If you need to monitor possible changes to both the local and remote host addresses, you use the <code><!--a-->SCNetworkReachabilityCreateWithAddressPair<!--/a--></code> function. This function returns a reference you can use to find out if:</p><ul class="spaceabove"><li class="li"><p>The address of your local host changes</p></li><li class="li"><p>The remote address becomes unreachable</p></li><li class="li"><p>The network route associated with the remote host changes</p></li></ul><p>All three functions return an object of type <code>SCNetworkReachabilityRef</code> for the remote host, which you can use in any of the other SCNetworkReachability functions.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF105" title="Adding a Target to a Run Loop "></a><h3>Adding a Target to a Run Loop </h3><p>To ensure that your application receives notification when the reachability status of the target remote host changes, you add the target’s <code>SCNetworkReachabilityRef</code> to your application’s run loop. A run loop monitors sources of input to an application. When an input source becomes ready for processing (because some activity occurs), the run loop dispatches control to a callback function associated with the input source. For more information on run loops and modes, see <em><a href="../../../../CoreFoundation/Conceptual/CFRunLoops/index.html#//apple_ref/doc/uid/10000135i" target="_top">Run Loops</a></em>.</p><p>For a network-aware application, the input source is the <code>SCNetworkReachabilityRef</code>, the activity is a change in the target’s connection status, and the callback function is one you provide. Thus, by using the reachability API to add your target to your application’s run loop and to provide a callback function (described in <span class="content_text"><a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-BHABDJCC">“Associating a Callback Function With the Target”</a></span>), you ensure your application will be notified of changes in the target’s reachability. </p><p>To add an <code>SCNetworkReachabilityRef</code> to your application’s run loop, you use the <code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityScheduleWithRunLoop" target="_top">SCNetworkReachabilityScheduleWithRunLoop</a></code> function. You provide the <code>SCNetworkReachabilityRef</code>, a reference to your application’s run loop, and the mode in which the run loop should run, typically the default mode. </p><p>To remove an <code>SCNetworkReachabilityRef</code> from your application’s run loop, you use the <code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityUnscheduleFromRunLoop" target="_top">SCNetworkReachabilityUnscheduleFromRunLoop</a></code> function, which requires the same parameters as the <code>SCNetworkReachabilityScheduleWithRunLoop</code> function.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-BHABDJCC" title="Associating a Callback Function With the Target"></a><h3>Associating a Callback Function With the Target</h3><p>To make use of the notifications the reachability API provides, you should associate a callback function with the <code>SCNetworkReachabilityRef</code> representing the remote host you’re interested in. The callback function might display the change in the connection to the user or perform some other task.</p><p>To associate a callback function with your target, you first define a function of type <code>SCNetworkReachabilityCallBack</code> (this type is defined in <code>SCNetworkReachability.h</code>). To pass contextual information about the changes to your callback function, you define a structure of type <code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/tdef/SCNetworkReachabilityContext" target="_top">SCNetworkReachabilityContext</a></code>. You use the <code>info</code> argument to contain the context information (you can also specify NULL, if context information is unnecessary). Finally, you pass the callback function, the <code>SCNetworkReachabilityRef</code> representing the remote host, and the context to the <code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilitySetCallback" target="_top">SCNetworkReachabilitySetCallback</a></code> function.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001065-CH204-SW4" title="Note"></a><p><strong>Note:</strong>&nbsp;If you pass NULL for the <code>SCNetworkReachabilityCallBack</code> parameter, you remove the callback function currently associated with the target.</p></div><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF106" title="Determining Reachability"></a><h3>Determining Reachability</h3><p>The SCNetworkReachability API provides the <code><a href="../../../Reference/SysConfig/SCNetworkReachability/CompositePage.html#//apple_ref/c/func/SCNetworkReachabilityGetFlags" target="_top">SCNetworkReachabilityGetFlags</a></code> function you can use to determine the reachability of a remote host. This function supplies the same connection-status flags the older reachability functions defined in <code>SCNetwork.h</code> supplied. </p><p>To use this function, you supply the <code>SCNetworkReachabilityRef</code> for your remote host and the address of the variable you declare to contain the flags. The flags you can receive are listed in <span class="content_text">Table 4-1</span>.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-BHACIADJ" title="Table 4-1SCNetworkConnectionFlags"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 4-1&nbsp;&nbsp;</strong><code>SCNetworkConnectionFlags</code></caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Flag name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Meaning</p></th></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsTransientConnection</code></p></td><td ><p>The target is reachable through a transient connection (for example, PPP).</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsReachable</code></p></td><td ><p>The target is reachable using the current network configuration.</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsConnectionRequired</code></p></td><td ><p>The target is reachable using the current network configuration, but a connection must be established first. For example, a suitable dialup connection exists, but it is not active.</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsConnectionAutomatic</code></p></td><td ><p>The target is reachable using the current network configuration, but a connection must be established first. Further, any traffic directed to the target will automatically initiate the connection.</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsInterventionRequired</code></p></td><td ><p>The target is reachable using the current network configuration, but a connection must be established first. Further, some user action is required to establish connection (for example, providing a password).</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsIsLocalAddress</code></p></td><td ><p>The target is associated with a network interface on the current system. For example, the target address is one of the IP addresses assigned to the system.</p></td></tr><tr><td  scope="row"><p><code>kSCNetworkFlagsIsDirect</code></p></td><td ><p>Network traffic to the target will not pass through a router because the destination address is on a network that’s directly connected to one of the local machine’s interfaces (for example, it’s on the same subnet as the local machine).</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF107" title="Using the Network Connection API"></a><h2>Using the Network Connection API</h2><p>In Mac OS X version 10.3, the System Configuration framework introduced the SCNetworkConnection API. This API allows an application to control connection-oriented services already defined in the system. Currently, an application can control only PPP services with this API.</p><p>In addition to controlling an existing service, an application can use the SCNetworkConnection API to get information about the connection. The API provides connection-status information on two levels:</p><ul class="ul"><li class="li"><p>High-level, generic information that describes the status of the network connection, such as connected or disconnected</p></li><li class="li"><p>Detailed, PPP-specific information that describes the status of the PPP stack</p></li></ul><p>These two levels of status information target different types of applications. A network-aware application might want to display whether or not a network link connection is live, but is probably uninterested in knowing if the PPP controller is currently configuring the link layer. A complex dialer application, on the other hand, might need to know exactly what the PPP controller is doing at each step of the connection process. </p><p>Although these functions are defined in the same header file, this chapter does not describe the PPP-specific connection-status functions in <code>SCNetworkConnection.h</code>. For more information on how to use these functions and how to use the System Configuration schema to interpret the results, see <span class="content_text"><a href="../SC_UnderstandSchema/SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDIHDCG">“The System Configuration Schema.”</a></span> Instead, this chapter focuses on the remainder of the SCNetworkConnection API, describing how an application can use it to accomplish the following tasks:</p><ul class="ul"><li class="li"><p>Create a reference representing the connection you can use with other connection functions.</p></li><li class="li"><p>Add the connection reference to your application’s run loop.</p></li><li class="li"><p>Start a connection.</p></li><li class="li"><p>Get the status of a connection.</p></li><li class="li"><p>Stop an existing connection.</p></li></ul><p>For a code example demonstrating the use of the SCNetworkConnection API, see <em><a href="../../../../../samplecode/SimpleDial/index.html#//apple_ref/doc/uid/DTS10003237" target="_top">SimpleDial</a></em>.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF108" title="Creating a Connection Reference"></a><h3>Creating a Connection Reference</h3><p>The SCNetworkConnection API provides one function you can use to create a connection reference: <code><!--a-->SCNetworkConnectionCreateWithServiceID<!--/a--></code>. To use this function, you supply a service ID and a callback function, along with a couple of other parameters, and you receive an object of type <code>SCNetworkConnectionRef</code>. You use this object to represent the connection in the other SCNetworkConnection functions. </p><p>Because you’ll be using the <code>SCNetworkConnectionRef</code> to refer to a specific PPP connection, you must supply a unique service ID to identify it. There are two ways to get this service ID. One way is to look in the dynamic store for available services and choose one. The second way is for your application to use the <code><!--a-->SCNetworkConnectionCopyUserPreferences<!--/a--></code> function to get the default service ID (the one the Internet Connect application uses).</p><p>Although you can pass NULL for the callback function parameter, it is not recommended. If you don’t define a callback function, your application will not receive status-change notifications and will have to poll for updates.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF109" title="Adding a Connection Reference to a Run Loop"></a><h3>Adding a Connection Reference to a Run Loop</h3><p>To ensure your application gets notified of changes in a specific connection’s status, you can add the <code>SCNetworkConnectionRef</code> representing the connection to your application’s run loop. When the connection’s status changes, the <code>SCNetworkConnectionRef</code> alerts the run loop and the run loop passes control to the callback function you provide. </p><p>To add an <code>SCNetworkConnectionRef</code> to your application’s run loop, you use the <code><!--a-->SCNetworkConnectionScheduleWithRunLoop<!--/a--></code> function. You provide the <code>SCNetworkConnectionRef</code>, a reference to your application’s run loop, and the mode in which the run loop should run (in most cases, the default mode). For more information on run loops and modes, see <span class="content_text"><a href="../../../../CoreFoundation/Conceptual/CFRunLoops/CFRunLoops.html#//apple_ref/doc/uid/10000135" target="_top">Introduction to Run Loops</a></span> in the <span class="content_text"><a href="../../../../../referencelibrary/CoreFoundation/index.html#//apple_ref/doc/uid/TP30000943-TP30000421" target="_top">Core Foundation Reference Library</a></span>.</p><p>To remove the <code>SCNetworkConnectionRef</code> from your application’s run loop, you use the <code><!--a-->SCNetworkConnectionUnscheduleFromRunLoop<!--/a--></code> function. Like the <code><!--a-->SCNetworkConnectionScheduleWithRunLoop<!--/a--></code> function, this function expects the <code>SCNetworkConnectionRef</code>, a reference to your application’s run loop, and the run loop mode.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF110" title="Starting and Stopping a Connection"></a><h3>Starting and Stopping a Connection</h3><p>The SCNetworkConnection API provides two functions your application can use to control a connection using an <code>SCNetworkConnectionRef</code> object:</p><ul class="spaceabove"><li class="li"><p><code><!--a-->SCNetworkConnectionStart<!--/a--></code></p></li><li class="li"><p><code><!--a-->SCNetworkConnectionStop<!--/a--></code></p></li></ul><p>Both functions return immediately while the connection or disconnection process they initiate proceeds asynchronously. If you add the connection’s <code>SCNetworkConnectionRef</code> to your application’s run loop and provide a callback function, your application is notified when the status of the connection changes. Your application can then check the status to determine if the connection process is complete. If you don’t add the connection reference to the run loop, you will have to poll to discover the connection status, and this is not recommended.</p><p>By default, the <code><!--a-->SCNetworkConnectionStart<!--/a--></code> function uses the user’s preferred connection settings to start the connection. You can, however, provide a dictionary of values to override some of these settings for the duration of the connection. </p><p>If you do provide a dictionary of additional settings be aware that: </p><ul class="spaceabove"><li class="li"><p>The dictionary must be in the correct format for a network service dictionary (described in <span class="content_text"><a href="../SC_UnderstandSchema/SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDFBDCB">“The NetworkServices Dictionary”</a></span>). If you do not follow this format precisely, the PPP controller may ignore the dictionary.</p></li><li class="li"><p>The PPP controller merges the settings you provide with the user’s existing settings before the connection is established, ignoring any inappropriate values in your dictionary.</p></li></ul><p>Starting and stopping a connection are implicitly arbitrated. This means that the interest other applications may have in a connection is taken into account before the connection is stopped. For example, application “B” can start a connection that has already been started by application “A”. Application “A” may choose to stop the connection but the system should not stop the connection until “B” is finished with it. Using the SCNetworkConnection functions, application “A” can call <code><!--a-->SCNetworkConnectionStop<!--/a--></code> on the connection and the function will return success, but the connection will not stop until “B” calls <code><!--a-->SCNetworkConnectionStop<!--/a--></code>. An application can also use the <code>linger</code> parameter (discussed below) to register interest.</p><p>The <code><!--a-->SCNetworkConnectionStart<!--/a--></code> function allows an application to indicate an interest in a connection. In this way, an application can request that the existence of the connection be tied to actions the application takes. In the simplest case, an application might want a connection to start when the application calls <code><!--a-->SCNetworkConnectionStart<!--/a--></code> and stop when any of the following events occur:</p><ul class="spaceabove"><li class="li"><p>The application quits.</p></li><li class="li"><p>The application releases the <code>SCNetworkConnectionRef</code> representing the connection.</p></li><li class="li"><p>The application calls <code><!--a-->SCNetworkConnectionStop<!--/a--></code>.</p></li></ul><p>To indicate interest in a connection, an application can use the <code>linger</code> parameter of the <code><!--a-->SCNetworkConnectionStart<!--/a--></code> function. An application, such as an email client, that needs to get connected, perform its tasks, and get disconnected, sets the parameter to <code>FALSE</code>. This indicates that the connection should stop when the application quits or releases the connection reference. A PPP dialer application, on the other hand, might choose to set the parameter to <code>TRUE</code> so that the user has control over the modem. The <code>TRUE</code> value indicates the connection should <em>not</em> stop when the application quits or releases the connection reference.</p><p>It’s important to note, however, that several concurrent applications might register interest in the same connection. When this is the case, the System Configuration framework keeps track of the references to the connection, stopping it when the last reference is released (or the last application holding a reference quits).</p><p>The <code><!--a-->SCNetworkConnectionStop<!--/a--></code> function performs an arbitrated stop of the connection. In other words, it closes the connection if:</p><ul class="spaceabove"><li class="li"><p>There are no other interested applications currently running or holding references to the connection. If there are, the <code><!--a-->SCNetworkConnectionStop<!--/a--></code> function returns success to the calling application, but the connection will persist until all interested applications terminate or release their references to the connection.</p></li><li class="li"><p>An application calls <code><!--a-->SCNetworkConnectionStop<!--/a--></code> and passes <code>TRUE</code> in the <code>forceDisconnect</code> parameter. This stops the connection regardless of the interest of other currently running applications. Most applications do not need to force a connection to stop in this way. A PPP dialer application, however, would probably choose to do this because it ensures that the connection stops when the user wants it to.</p></li></ul><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF111" title="Getting the Status of a Connection"></a><h3>Getting the Status of a Connection</h3><p>An application can use the <code><!--a-->SCNetworkConnectionGetStatus<!--/a--></code> function to get the high-level status of the connection. You pass the <code>SCNetworkConnectionRef</code> representing the connection to the function and you receive one of the constants shown in <span class="content_text"><a href="../SC_Intro/SC_Intro.html#//apple_ref/doc/uid/TP40001065-CH201-TPXREF101">“Introduction to System Configuration Programming Guidelines.”</a></span></p><a name="//apple_ref/doc/uid/TP40001065-CH204-TPXREF101" title="Table 4-2High-level connection status values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 4-2&nbsp;&nbsp;</strong>High-level connection status values</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Status</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Meaning</p></th></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionInvalid<!--/a--></code></p></td><td ><p>The network connection refers to an invalid service.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionDisconnected<!--/a--></code></p></td><td ><p>The network connection is disconnected.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionConnecting<!--/a--></code></p></td><td ><p>The network connection is connecting.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionConnected<!--/a--></code></p></td><td ><p>The network connection is connected.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionDisconnecting<!--/a--></code></p></td><td ><p>The network connection is disconnecting.</p></td></tr></table></div><p>If your application needs to know more about the PPP connection, such as when the PPP controller is authenticating to the server, you should use the <code><!--a-->SCNetworkConnectionCopyExtendedStatus<!--/a--></code> function. You pass the <code>SCNetworkConnectionRef</code> representing the connection to the function and you receive a dictionary that contains subdictionaries for each subcomponent of the service, such as PPP, IPv4, and Modem. The PPP connection status is represented by a constant defined in the SCNetworkConnection API. <span class="content_text"><a href="SC_ReachConnect.html#//apple_ref/doc/uid/TP40001065-CH204-BABGEACC">Table 4-3</a></span> shows the current set of constants. Note that additional status values might be defined in the future, so your application should be able to handle an unknown value.</p><a name="//apple_ref/doc/uid/TP40001065-CH204-BABGEACC" title="Table 4-3PPP connection status values"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 4-3&nbsp;&nbsp;</strong>PPP connection status values</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Status</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Meaning</p></th></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPDisconnected<!--/a--></code></p></td><td ><p>PPP is disconnected.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPInitializing<!--/a--></code></p></td><td ><p>PPP is initializing.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPConnectingLink<!--/a--></code></p></td><td ><p>PPP is connecting the lower layer (as when, for example, the modem is dialing out).</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPDialOnTraffic<!--/a--></code></p></td><td ><p>PPP is waiting for networking traffic to automatically establish the connection.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPNegotiatingLink<!--/a--></code></p></td><td ><p>The PPP lower layer is connected and PPP is negotiating the link layer (the LCP protocol).</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPAuthenticating<!--/a--></code></p></td><td ><p>PPP is authenticating to the server (using PAP, CHAP, MSCHAP, or EAP protocol).</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPWaitingForCallBack<!--/a--></code></p></td><td ><p>PPP is waiting for the server to call back. <em>Note</em>: this state is defined but will not occur because CallBack is not supported in Mac OS X version 10.3.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPNetgotiatingNetwork<!--/a--></code></p></td><td ><p>PPP is authenticated and is now negotiating the networking layer (using IPCP or IPv6CP protocol).</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPConnected<!--/a--></code></p></td><td ><p>PPP is fully connected for at least one networking layer. Additional networking protocols might still be negotiating.</p></td></tr><tr><td  scope="row"><p>kSCNetworkConnectionPPPTerminating</p></td><td ><p>PPP networking and link protocols are terminating.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPDisconnectingLink<!--/a--></code></p></td><td ><p>PPP is disconnecting the lower connection layer (as when, for example, the modem is hanging up).</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPHoldingLinkOff<!--/a--></code></p></td><td ><p>PPP is disconnected and maintaining the link temporarily “off”.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPSuspended<!--/a--></code></p></td><td ><p>PPP is suspended as the result of the “suspend” command as when, for example, a V92 Modem is “On Hold”.</p></td></tr><tr><td  scope="row"><p><code><!--a  -->kSCNetworkConnectionPPPWaitingForRedial<!--/a--></code></p></td><td ><p>PPP found a busy server and is waiting for redial.</p></td></tr></table></div><p>For more information on why you might choose to use the <code><!--a-->SCNetworkConnectionCopyExtendedStatus<!--/a--></code> function, see <span class="content_text"><a href="../SC_UnderstandSchema/SC_UnderstandSchema.html#//apple_ref/doc/uid/TP40001065-CH203-CHDHDCIE">“Getting Detailed PPP Connection-Status Information.”</a></span></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../SC_UnderstandSchema/SC_UnderstandSchema.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SC_RevHistory/SC_RevHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-02-07<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_ReachConnect/SC_ReachConnect.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_ReachConnect/SC_ReachConnect.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Networking/Conceptual/SystemConfigFrameworks/SC_ReachConnect/SC_ReachConnect.html%3Fid%3DTP40001065-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>