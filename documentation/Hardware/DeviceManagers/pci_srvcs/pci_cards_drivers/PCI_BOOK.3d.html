<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Startup Firmware</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.3c.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.3c.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.3e.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3325"> </A><A NAME="22733"> </A>Startup Firmware</H1><P CLASS="T1.Text1"><A NAME="pgfId=3327"> </A>The Open Firmware startup process is driven by <B CLASS="bold">startup firmware </B>(also called<A NAME="marker=3326"> </A> <I CLASS="italics">boot</I> <I CLASS="italics"> firmware</I>) in the <B CLASS="bold">Power Macintosh ROM</B> and in memory chips on expansion cards, called <B CLASS="bold">expansion ROMs.</B><A NAME="marker=3328"> </A> </P><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=14542"> </A>Note</b></p><P CLASS="Note"><A NAME="pgfId=3329"> </A>Power Macintosh computers that implement the NewWorld architecture (iMac and later) have the startup code in a small <B CLASS="bold">bootROM</B>. The remainder of what has been traditionally referred to as the Macintosh Toolbox is loaded from a file, called Mac OS ROM, located on disk, and then stitched into RAM to appear as one contiguous read-only ROM. Power Macintosh computers built before the NewWorld implementation have the startup code and the Macintosh Toolbox code in a larger ROM, usually on the order of 4&nbsp;MB in size.  </P></blockquote><P CLASS="T1.Text1"><A NAME="pgfId=3330"> </A>While the Open Firmware startup code is running, the Power Macintosh computer starts up and configures its on-board hardware, including all peripheral devices the startup code knows about or has config variables for, independently of any operating system. The computer then finds an operating system in ROM or on a mass storage device, loads it into RAM, and terminates the Open Firmware startup process by giving the operating system control of the PowerPC processor. The operating system may be Mac OS or a different system, provided it uses the PowerPC instruction set.</P><P CLASS="T1.Text1"><A NAME="pgfId=3331"> </A>The Open Firmware startup process includes these specific features:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3333"> </A>Startup firmware, as defined by IEEE Standard 1275, is written in the <A NAME="marker=3332"> </A>Forth language. Firmware code is stored in an abbreviated representation called <A NAME="marker=3334"> </A><B CLASS="bold">FCode,</B> a version of Forth in which most Forth words are replaced by single bytes or 2-byte groups. The startup firmware in the Power Macintosh ROM provides an <A NAME="marker=3335"> </A>FCode loader that installs FCode in system RAM that the Open Firmware Forth interpreter executes. Expansion card firmware can modify the Open Firmware startup process by supplying a FCode boot driver that the computer's startup firmware loads and runs before launching an operating system. The expansion card startup firmware can also include a minimal run-time driver that works in the Open Firmware environment and is replaced by a comprehensive driver later in the boot process. </LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3337"> </A>The Macintosh startup firmware creates a hierarchical data structure of nodes called a <A NAME="marker=3336"> </A><B CLASS="bold">device tree,</B> in which each device is described by a <A NAME="marker=3338"> </A><B CLASS="bold">property list</B>, and optional properties and methods. The device tree is stored in system RAM. The nodes, which are also called packages, contain properties and methods. Properties are attributes that describe the hardware and driver. Methods do work much like subroutines or procedures. The operating system that is ultimately installed and launched can search the device tree to determine what hardware is available. For example, Mac OS extracts information from the device tree to create the device portion of the Macintosh Name Registry, described in Chapter <A HREF="PCI_BOOK.f8.html#12320" CLASS="XRef">10</A>. The full list of standard device tree properties is given in IEEE Standard 1275; the properties that Mac&nbsp;OS uses are listed in <A HREF="PCI_BOOK.12e.html#17372" CLASS="XRef">Table&nbsp;10-1</A>. An example of a device node in a device tree is given in <A HREF="PCI_BOOK.102.html#23624" CLASS="XRef">Listing&nbsp;10-1</A>.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3349"> </A>Device drivers that are required during system startup are also written in FCode. Plug-in expansion cards for startup devices must contain all the driver code required during startup in the expansion ROM on the card and may also need to provide other driver support resources such as fonts. The startup firmware in the Power Macintosh ROM installs Open Firmware boot drivers in system RAM and the Open Firmware Forth interpreter executes the driver FCode. Examples of devices needed during system startup include display, keyboard, and mouse devices; storage devices such as SCSI, IDE, floppy disk, and magneto-optical drives; and network interfaces if the target OS supports network booting.</LI></UL><P CLASS="T1.Text1"><A NAME="pgfId=3350"> </A>You can write PCI expansion ROM code in standard Forth words and then reduce the result to FCode by using an <A NAME="marker=3351"> </A><B CLASS="bold">FCode tokenizer,</B> a program that translates Forth words into FCodes. The <A NAME="marker=3352"> </A>Forth vocabulary that you can use is presented in IEEE Standard 1275. For a description of the Open Firmware user interface, see <A HREF="PCI_BOOK.5d.html#12753" CLASS="XRef">Open Firmware User Interface</A>. </P></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.3c.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.3c.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.3e.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>