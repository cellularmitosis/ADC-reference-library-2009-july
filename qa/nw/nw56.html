<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A NW56: Accessing the ARA/PPP password</title>		<meta name="keywords" content="Mac OS 8 Open Transport creating ARA/PPP password resource"><meta name="Description" content="Technical Q&amp;A NW56: Q&amp;A states where the ARA/PPP passwordfor a given configuration is stored, how the password isencoded including a code snippet that illustrates encodinga password, and how to set the pass resource."><meta name="categories" content="Networking"><meta name="week-posted" content="May 17, 1999 - May 21, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001468" title="Accessing the ARA/PPP password"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A NW56</div>
<div id="pageheadsub">Accessing the ARA/PPP password</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><hr width=500 align=center><p id=p2>Q: My code needs to set the password used by ARA/PPP, but I can't find any documentation on how the password works. How do I create a password resource?</P>         <p id=p4>A: The Open Transport ARA/PPP password for a given configuration is stored in the <CODE>'pass'</CODE> resource of the "Remote Access Connections" file, which resides in the "Remote Access" preference folder. As of ARA version 2.0, the size of the <CODE>'pass'</CODE> resource has been extended to 256 bytes.</P>         <p id=p4>The actual password data is encoded using the Data         Encryption Standard (DES) algorithm in Electronic Code Book         (ECB) Mode. The key schedule for the encryption is derived         from the first 56 bits (7 bytes) of the ARA/PPP         configurations user name.</P>         <p id=p4>Currently there is no Open Transport API for encoding the         ARA password. However, since the password is encoded using         ECB mode of DES, it is possible to use the         <CODE>PassWordMunger</CODE> function of the older Apple         Remote Access API to encode a modern ARA/PPP password.</P>         <p id=p4>To properly encode the password, you must first zero pad         the password data in a 256-byte buffer. Then, encode the         cleartext password 8 bytes at a time using the user name         string as a key, appending the result to the         <CODE>'pass'</CODE> resource until all 256 bytes are         processed. When you have completed this, zero out the first         byte of the <CODE>'pass'</CODE> resource.</P>         <p id=p4>This process is illustrated in the following code         snippet, taken from the MoreNetworkSetup module of the DTS         MoreIsBetter library.</P>         <TABLE BORDER=0>            <TR>               <td bgcolor="#e6e6e6" align=left>                  <pre>static OSStatus EncodeRemotePasswordARA(                                ConstStr255Param userName,                                ConstStr255Param password,                                Str255 encodedPassword)    // Encodes a password using the ARA API.{    OSStatus err;    TRemoteAccessPasswordMunger pb;    UInt8 chunkOfPassword[9];    ByteCount offset;&nbsp;    // Zero the encoded password buffer and copy the    // password (sans length byte) into it.    OTMemzero(encodedPassword, sizeof(Str255));    BlockMoveData(&amp;password[1], encodedPassword, password[0]);    // Now walk through the password in chunks, copying    // a chunk into the chunkOfPassword buffer, encrypting    // that buffer with the ARA API, and then copying the    // buffer back out to the encrypted password.    // Note that the for loop increments offset by 8 each time.&nbsp;    for (offset = 0; offset &lt; 256 ; offset += 8) {        // Copy a chunk of the password into chunkOfPassword.        BlockMoveData(encodedPassword + offset, &amp;chunkOfPassword[1], 8);        chunkOfPassword[0] = 8;&nbsp;        // Setup the parameter block for a remote access API call.&nbsp;        pb.csCode       = RAM_EXTENDED_CALL;        pb.resultStrPtr = nil;        pb.extendedType = (char*) REMOTEACCESSNAME;        pb.extendedCode = CmdRemoteAccess_PassWordMunger;        pb.userNamePtr  = (UInt8 *) userName;        pb.passWordPtr  = chunkOfPassword;        pb.reserved     = 0;&nbsp;        err = PBRemoteAccess((TPRemoteAccessParamBlock) &amp;pb, false);        if (err == noErr) {            err = pb.ioResult;        }        if (err == noErr) {&nbsp;            // Copy the encrypted chunk of password back out into            // encodedPassword.            BlockMoveData(&amp;chunkOfPassword[1], encodedPassword + offset, 8);        } else {            break;        }    }&nbsp;    // Tidy up encoded password.  Move the encrypted data up    // one byte and insert a zero length byte.  Don't ask me    // why this is required, I didn't invent this scheme (-:&nbsp;    BlockMoveData(encodedPassword, encodedPassword + 1, sizeof(Str255) - 1);    encodedPassword[0] = 0;    return err;}</pre>               </TD></TR>         </TABLE>         <p id=p4>Once you have processed the encoded the password, you can         set the actual <CODE>'pass'</CODE> resource in a number of         ways:</P>                  <OL>            <LI>The preferred method is to use the Network Setup            API, which is part of Open Transport 2.0 included            with MacOS&nbsp;8.5. The Network Setup SDK really is the            proper long-term solution to accessing the configuration            database. A good example of how to use this API can be            found in the DTS sample code            <A HREF="ftp://ftp.apple.com/developer/Sample_Code/Networking/MoreNetworkSetup.sit">More            NetworkSetup</A>.</LI>            <LI>As an alternative, you can send an AppleEvent to            <I>Network Setup Scripting</I> to set the password for a            given configuration. This is described below.            <B>Note:</B> Version 1.0 of <I>Network Setup            Scripting</I> does not encode the password properly; use            version 1.0.2 or newer.</LI>         </OL>           		<TABLE BORDER=0>            <TR>               <td bgcolor="#e6e6e6" align=left>                  <pre>--setpassword("Configuration", "password")&nbsp; <B>on</B> setpassword(configName, thePassword)    <B>tell</B> application "Network Setup Scripting"        open database        begin transaction         <B>set</B> password of Remote Access configurationconfigName <B>to</B> thePassword         end transaction         close database    <B>end tellend</B> setpassword&nbsp;</pre>               </TD></TR>         </TABLE><BR>                  <OL TYPE="1" START="3">            <LI>As a last resort, your code could open and write into            the "Remote Access Connections" file directly. This            method is risky and I highly recommend against it. Since            ARA could open it at any time, you run the risk of            corrupting the file's resource map. There is also no            promise that the preference file data formats will not            change in the future.</LI>         </OL>         <p id=p4>At some point in the future, we hope that the Network         Setup API will provide an interface for encoding the         password. Until that happens, the above example should be         sufficient.</P>                  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=10>            <TR>               <td valign=top align=left>                 Further Reference:               </TD><td valign=top align=left>                  <a href="http://developer.apple.com/documentation/macos8/NetworkCommSvcs/OpenTransport/opentransport.html" target="blank">Inside Macintosh: Open Transport</A><BR>                                    <A HREF="ftp://ftp.apple.com/developer/Sample_Code/Networking/MoreNetworkSetup.sit">Sample Code: MoreNetworkSetup</A>               </TD></TR>         </TABLE>    </td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[May 17 1999]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/nw/nw56.html%3Fid%3DDTS10001468-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/nw/nw56.html%3Fid%3DDTS10001468-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/nw/nw56.html%3Fid%3DDTS10001468-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center> </BODY></HTML>