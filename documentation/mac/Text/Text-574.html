<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Key Translation(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING574></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-573.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-575.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-570.html"><B>Appendix C - Keyboard Resources</B></A> / <A HREF="Text-572.html"><B>About the Keyboard Resources</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING574-0></A>
<H2><A NAME=MARKER-9-34></A>Key Translation</H2>
 <A NAME=MARKER-2-35></A>Key translation is the conversion of keystrokes to character codes. In early versions of the Macintosh, keyboard translation was simple and direct: two low-memory pointers in the System file (accessed through global variables <A NAME=MARKER-2-36></A><CODE>Key1Trans</CODE> or <CODE>Key2Trans</CODE>) pointed to the translation routines. Those pointers are still available and are called by the Macintosh Plus but are not called by newer systems. The pointers are preserved so that applications that call them can still function correctly. However, they now point to a routine that implements a new standard mechanism.<P>
 <A NAME=MARKER-2-19></A>The standard mechanism was developed with the advent of ADB keyboards; it was needed to map the different sets of raw key codes to a standard set of virtual key codes, which could in turn be mapped to character codes. In the standard method, a keystroke generates an interrupt; the keyboard driver maps the raw key code to a virtual key code, which it sends to the Event Manager; the Event Manager maps the virtual key code to a character code, and returns the character code to the driver. The driver in turn posts the key-down event. This method has two advantages:<P>
<UL>
<LI>The mapping from raw key code to virtual key code achieves keyboard hardware independence. The raw mapping routine uses the table of a key-map resource for the keyboard, in the System file or in ROM.
<LI><A NAME=MARKER-2-63></A>The mapping from virtual key code to character code allows support of multiple character sets. It is performed by the Event Manager <CODE>KeyTranslate</CODE> function, which is accessed through the <A NAME=MARKER-2-66></A><CODE>_KeyTrans</CODE> trap (not to be confused with the <CODE>Key1Trans</CODE> or <CODE>Key2Trans</CODE> pointers). <CODE>KeyTranslate</CODE> maps the virtual key code (plus modifiers, if any) to a character code, using tables in a keyboard-layout resource, also in the System file or in ROM. (<CODE>KeyTranslate</CODE> also handles <I>dead keys;</I> see <A HREF=Text-584.html#MARKER-9-72>page C-19</A>.)<P>
</UL>
 The Macintosh keyboard routines handle the keyboard properly for all script systems. Except for purely hardware-specific characteristics such as controlling lights on the keyboard, the function of the keyboard is completely determined by character-encoding tables in the keyboard-layout resource (with an optional associated key-remap resource). For each virtual key code and each possible modifier-key state, the character-encoding tables specify the equivalent character code. <A HREF=#MARKER-9-42>Figure C-3</A> summarizes the key translation process:<P>
<OL>
<LI> A keystroke initially produces a raw key code.
<LI>The keyboard driver uses the hardware-dependent key-map resource to map that raw key code into a hardware-independent virtual key code, and to set bits indicating the state of the modifier keys.
<LI>It then calls the Event Manager <CODE>KeyTranslate</CODE> function. The optional key-remap resource specifies how <CODE>KeyTranslate</CODE> should remap certain key combinations on certain keyboards before it performs its mapping. The key-remap resource reintroduces hardware dependence because certain scripts, languages, and regions need subtle differences in layout for specific keyboards. Generally, the key-remap resource affects only a few keys.
<LI><CODE><A NAME=MARKER-2-73></A>KeyTranslate</CODE> uses the keyboard-layout resource to map a modifier state and a virtual key code into a character code, such as an ASCII code.
<LI><CODE>KeyTranslate</CODE> returns the character code, and if the character code is nonzero the keyboard driver posts the key-down event into the event queue.<P>
</OL>
 The net result of the process of key translation is a virtual key code and a character code in the <CODE>message</CODE> field of an event record, and modifier-key information in the <CODE>modifiers</CODE> field of the event record.<P>
<DL>
<DT><B>Note</B>
<DD>On the Macintosh Plus, the event record contains raw key codes, not virtual key codes. However, except in the case of the small Macintosh 512K Keyboard with ISO layout, the Macintosh Plus raw key codes are identical to the virtual key codes that would have been produced.<EM></EM><A NAME=MARKER-2-41></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=MARKER-9-42></A><B>Figure C-3  The key translation<A NAME=MARKER-2-43></A> process</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/KR_L-10.jpg">
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-573.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-575.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
