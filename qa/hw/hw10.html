<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A HW10: Interrupt Management</title><meta name="keywords" content="Mac OS 8 Interrupt Management installation native driver"><meta name="Description" content="Technical Q&amp;A HW10: Q&amp;A provides a code sample that illustrateshow to handle interrupt installation in a native ndrv."><meta name="categories" content="Hardware"><meta name="week-posted" content="Jul 10, 1995 - Jul 21, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001280" title="Interrupt Management"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxPCIandPCCard-date.html" target="_blank">Hardware & Drivers > PCI and PC Card</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A HW10</div>
<div id="pageheadsub">Interrupt Management</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->            <!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id = p2>Q:  I am having trouble with Interrupt Management in my native ndrv. I can get itto work once using the <code>GetInterruptFunctions()</code> and <code>InstallInterruptFunctions()</code>calls, but I can't undo this Interrupt install/enable sequence so that I canturn them on again later. In fact, it crashes the second time I use theinstall/enable sequence. Do I need to handle the default enabler and/ordisabler differently in order to make the process repeatable?</p><p id=p4>A:  The code sample below shows how to handle interrupt installation:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>/*===================================================================GraphicsOSSInstallVBLInterrupts()  This routine is specific for VBL interrupts and assumes that  a driver's 'driver-ist' only pertains to VBL's. The Video  Services Library (VSL) kHBLService and kFrameService are ignored.  Interrogate the HAL to get the interrupt handler, the interrupt  enabler, the interrupt disabler, and the VBL 'refCon' (private HAL  data that the HAL might need to carry out the functions).  This version of GDX interrupt handling isolates the HAL from knowing  stuff about how the handlers are installed. Conventions interrupt  routines must follow:      interrupt handler:  clear the hw interrupt source      interrupt enabler:  enable the hw interrupt source      interrupt disabler: disable the hw interrupt source and:         return true if interrupts were enabled  before the call         return false if interrupts were disabled before the call          -&gt;   regEntryID      Name Registry RegEntryID that                                  should  have the propertyName==========================================================================*/GDXErr GraphicsOSSInstallVBLInterrupts(RegEntryID *regEntryID) {    Boolean installVBLInterrupts;    InterruptEnabler enabler;    InterruptDisabler disabler;    OSSData *ossData;    GDXErr err;        /* Ask HAL if OSS should install VBL routines */    installVBLInterrupts = false;        /* Use default enabler if HAL's enabler is NULL */    enabler = NULL;    ossData = GraphicsOSSGetOSSData();        /* Use default disabler if HAL's disabler is NULL */    disabler = NULL;    err = GraphicsHALGetVBLInterruptRoutines(        &amp;installVBLInterrupts,        &amp;ossData-&gt;chainDefault,        &amp;ossData-&gt;halVBLHandler,        &amp;ossData-&gt;halVBLEnabler,        &amp;ossData-&gt;halVBLDisabler,        &amp;ossData-&gt;vblRefCon);    if (err != noErr)        goto ErrorExit;    if (installVBLInterrupts) {            /* The OSS should handle the HAL's vbl interrupts            It is possible that OSS should install the routines            but doesn't have the InterruptSetMember */        if (ossData-&gt;hasInterruptSetMember) {            InterruptServiceIDType vslServiceID;            OSStatus osStatusErr;            OSErr osErr;            osStatusErr = GetInterruptFunctions(                ossData-&gt;interruptSetMember.setID,                ossData-&gt;interruptSetMember.member,                &amp;ossData-&gt;defaultRefCon,                &amp;ossData-&gt;defaultVBLHandler,                &amp;ossData-&gt;defaultVBLEnabler,                &amp;ossData-&gt;defaultVBLDisabler );            if (osStatusErr != noErr) {                err = kGDXErrOSSNoDefaultVBLRoutines;                goto ErrorExit;            }                /* If the HAL's enabler/disabler functions are                NULL, that indicates that the HAL can use the                default enabler/disabler function. Otherwise,                the OSS enabler/disabler functions will be                installed. NOTE: Making a call to                InstallInterruptFunctions() with NULL as the                enabler/disabler,  than the enablers currently                installed (the 'default enablers') are used. */            if (NULL != ossData-&gt;halVBLEnabler)                enabler = GraphicsOSSVBLInterruptEnabler;            if (NULL != ossData-&gt;halVBLDisabler)                disabler = GraphicsOSSVBLInterruptDisabler;            osStatusErr = InstallInterruptFunctions(                ossData-&gt;interruptSetMember.setID,                ossData-&gt;interruptSetMember.member,                ossData-&gt;vblRefCon,                GraphicsOSSVBLInterruptHandler,                enabler, disabler);            if (osStatusErr != noErr) {                err = kGDXErrOSSUnableToInstallVBLRoutines;                goto ErrorExit;            }            // Successfully installed the routines.            ossData-&gt;installedHALVBLRoutines = true;        } else {            err = kGDXErrOSSNoISTProperty;            goto ErrorExit;        }    }ErrorExit:    return err;}</pre>	</TD></TR></TABLE></CENTER></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Jul 15 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/hw/hw10.html%3Fid%3DDTS10001280-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/hw/hw10.html%3Fid%3DDTS10001280-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/hw/hw10.html%3Fid%3DDTS10001280-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <hr width=500 align=center> </BODY> </HTML>