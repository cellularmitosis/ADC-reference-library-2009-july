<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Using Palettes With Offscreen Graphics Worlds</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING27></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-14.html"><B>Chapter 1 - Palette Manager</B></A> / <A HREF="ACI-21.html"><B>Using the Palette Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H2>Using Palettes With Offscreen Graphics Worlds</H2>
 You can attach a palette to an offscreen graphics world; however, the only Palette Manager color usage categories that you can use to specify the types of colors in such a case are <CODE>pmCourteous</CODE> and <CODE>pmBlack</CODE> and <CODE>pmWhite</CODE>. The other three color usage categories, <CODE>pmTolerant</CODE>, <CODE>pmAnimated</CODE>, and <CODE>pmExplicit</CODE>, are interpreted in an offscreen graphics world as <CODE>pmCourteous</CODE>, so they are of no use in this environment. <P>
 This section first explains why and how you might use <CODE>pmCourteous</CODE>, <CODE>pmBlack</CODE>, and <CODE>pmWhite</CODE> and then shows how to simulate the effects of the other usage modifiers that you cannot use with an offscreen graphics world.<P>
 After you've created a palette and assigned it to an offscreen graphics world, you can pass indexes from your palette to the <CODE>PmForeColor</CODE> and <CODE>PmBackColor</CODE> functions and then draw in the offscreen world. The advantage of using courteous colors for the offscreen graphics world is that otherwise you must hard-code colors into your code. If you or a software localizer wants to change the colors in the offscreen worlds, you can do so by changing the <CODE>'pltt</CODE>' resource that defines the palette rather than making code changes and recompiling the application.<P>
 The <CODE>pmBlack</CODE> and <CODE>pmWhite</CODE> usage modifiers simply allow you to specify which colors map to white and which to black in a black-and-white environment. If your application is working with red and dark blue, for example, both might get mapped to black on a 1-bit device. By assigning <CODE>pmWhite</CODE> to one and <CODE>pmBlack</CODE> to the other, you assure that they are always distinct. <P>
 Explicit colors in a palette attached to an offscreen graphics world are interpreted as courteous. Therefore, instead of using a palette, you should convert your pixel value to an RGB color and use this as the foreground or background color. After setting the current graphics device to the offscreen graphics world to set the color environment, convert your pixel value to the corresponding RGB color using the <CODE>IndexToColor</CODE> function. Then you can draw by passing the RGB color to the <CODE>RGBForeColor</CODE> and <CODE>RGBBackColor</CODE> functions. <P>
 Both tolerant and animated colors are interpreted as courteous in an offscreen graphics world. To use these types of colors, you can change the color environment of the offscreen graphics world by assigning it a whole new color table. <A HREF=#MARKER-9-133>Listing 1-6</A> shows how to do this. <P>
<B>Listing 1-6  <A NAME=MARKER-9-133></A>Changing the color environment of an offscreen graphics world</B><P>
<PRE>
   #define  clutID   150
   #define  numcolor 256

   WindowPtr   myWindow;
   CTabHandle  mycolors;
   PaletteHandlesrcPalette

   GetGWorld (&amp;SavePort, &amp;SaveGD);
   mycolors = GetCTable (clutID);
   /* create a new window */
   myWindow = NewCWindow(nil, &amp;BaseRect, &quot;&quot;, TRUE, zoomDocProc, 
                     (WindowPtr) -1, TRUE, nil);
   SetGWorld((CGrafPtr)myWindow, SaveGD);
   DrawGrowIcon (myWindow);

   (*mycolors)-&gt;ctFlags |= 0x4000;

   /* create a 256-color palette */
   srcPalette = NewPalette (numcolor, mycolors, pmCourteous, 0);
   /* call DoSetInhibited to set color usage */
   DoSetInhibited(pmCourteous);
   SetPalette ((WindowPtr) myWindow, srcPalette, TRUE);
   
   GetGWorld (&amp;SavePort, &amp;SaveGD);
   err = NewGWorld (&amp;offscreenGWorld, 8, &amp;InitWindowSize, 
                mycolors, nil, nil);
   if (err)
      Debugger();
   SetGWorld (offscreenGWorld, nil);
   EraseRect (&amp;InitWindowSize);
   DrawPicture (ThePict, &amp;InitWindowSize);
   SetGWorld (SavePort, SaveGD);

</PRE>
 After defining constants and declaring variables, the code in <A HREF=#MARKER-9-133>Listing 1-6</A> calls the QuickDraw <CODE>GetGWorld</CODE> function to get and save the current graphics port so that you can restore it later. The <CODE>GetCTable</CODE> function retrieves a handle to a color table--from a <CODE>'clut'</CODE> resource with ID 150--and stores it in the <CODE>mycolors</CODE> variable. You will use this color table for the offscreen graphics world and to create a palette. <P>
 The <CODE>NewCWindow</CODE> function creates a new window and the <CODE>SetGWorld</CODE> function assigns the current graphics port to this newly created window. The <CODE>DrawGrowIcon</CODE> function draws the window's size box.<P>
 The next piece of code:<P>
<PRE>
   (*mycolors)-&gt;ctFlags |= 0x4000;
</PRE>
 sets bit 14 of the <CODE>ctFlags</CODE> field in the color table. Setting this bit synchronizes the color table to a palette. It does this by reinterpreting the <CODE>ctTable</CODE> field of the color table. Normally, this field contains an array of <CODE>ColorSpec</CODE> entries, each of which contains a <I>pixel</I> value and a color. After setting bit 14 of the <CODE>ctFlags</CODE> field, each array in the <CODE>ctTable</CODE> field contains an <I>index</I> value and a color.<P>
 The <CODE>NewPalette</CODE> function creates a new palette from the color table retrieved by the <CODE>GetCTable</CODE> function. It contains 256 colors. Initially, all the colors are courteous and must match exactly (have a zero tolerance value). <P>
 The <CODE>DoSetInhibited</CODE> function (whose code is not shown here) uses the Palette Manager <CODE>SetEntryUsage</CODE> function to change the usage categories of the palette when the usage of the palette changes. For example, it sets the colors in the palette to courteous, tolerant, explicit, or animated, depending on menu selections that a user makes. The <CODE>DoSetInhibited</CODE> function also inhibits certain colors in the palette depending on the bit-depth of the screen on which the window is currently displayed. In this way, the palette can contain entries for multiple screen bit-depths and will display properly on each type of screen. See <A HREF=ACI-22.html#MARKER-9-113>"Selecting the Right Color Set" (page 1-25)</A> for an example of how to create a palette that will display on screens with different bit-depths. The application calls <CODE>DoSetInhibited</CODE> at this point to set the palette for the appropriate screen depth. Since <CODE>pmCourteous</CODE> is passed to <CODE>DoSetInhibited</CODE>, the usage category is not being changed. <P>
 The <CODE>SetPalette</CODE> function assigns the newly created palette to the window created by <CODE>NewCWindow</CODE>. The <CODE>GetGWorld</CODE> function gets and saves the current graphics port so it can be restored later. The <CODE>NewGWorld</CODE> function creates an offscreen graphics world and the <CODE>SetGWorld</CODE> function sets the current graphics port to the newly created offscreen graphics world. <P>
 The <CODE>EraseRect</CODE> and <CODE>DrawPicture</CODE> functions erase and draw in the offscreen graphics world. <P>
 The final <CODE>SetGWorld</CODE> function restores the graphics port to the window created by the <CODE>NewCWindow</CODE> function. (To move the offscreen drawing to the screen, use the QuickDraw <CODE>CopyBits</CODE> function--see the chapter, "QuickDraw Drawing," in <I>Inside Macintosh: Imaging With QuickDraw</I> for an example of how to do this.) The colors from the offscreen world--which come from the color table--match the colors of the window--which are controlled by the palette--because the color table and the palette are identical and synchronized. The advantage of this synchronization is that your application doesn't have to use the offscreen world's color matching algorithm to synchronize the colors from the offscreen world with the colors of the palette. Having to do so would greatly slow down your application, and speed is one of the primary reasons to use an offscreen world for drawing in the first place. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
