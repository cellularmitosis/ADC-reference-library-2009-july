<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Apple Events Programming Guide: Creating and Sending Apple Events</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating and Sending Apple Events"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001449-CH209" title="Creating and Sending Apple Events"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000494" target="_top">Carbon</a> &gt; <a href="../intro_aepg/intro_aepg.html#//apple_ref/doc/uid/TP40001449-CH201-DontLinkElementID_65">Apple Events Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../responding_aepg/responding_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../coercions_aepg/coercions_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001449-CH209-BABDAJGB" title="Creating and Sending Apple Events"></a><h1>Creating and Sending Apple Events</h1><p>This chapter provides information and sample code that will help you create and send Apple events and handle Apple events you receive in response to those you send. Before reading this chapter, you should be familiar with the information in <span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-BABDAJGB">“Building an Apple Event.”</a></span></p><p>Applications most commonly create and send Apple events for one of the reasons described in <span class="content_text"><a href="../about_aes_aepg/about_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH202-CEGGBHDH">“When Applications Use Apple Events”</a></span>: to communicate directly with other applications or to support recording in a scriptable application. And as described in <span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-CEGDCFEJ">“Two Approaches to Creating an Apple Event,”</a></span> you can create an Apple event in one step with the <code>AEBuildAppleEvent</code> function, or you can create a possibly incomplete Apple event with <code>AECreateAppleEvent</code>, then add attributes and parameters to complete the event.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_54" title="Note"></a><p><strong>Note:</strong>&nbsp;<span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-CEGDCFEJ">“Two Approaches to Creating an Apple Event”</a></span> also briefly describes a third approach, using stream-oriented calling conventions, and points to documentation for that approach.</p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_21">Functions for Creating Apple Event Data Structures</a>
				
			<br/>
			
        
			
			
				<a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABCJGAJ">Specifying a Target Address</a>
				
			<br/>
			
        
			
			
				<a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_23">Creating an Apple Event</a>
				
			<br/>
			
        
			
			
				<a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABIAGJI">Sending an Apple Event</a>
				
			<br/>
			
        
			
			
				<a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABHHAJB">Handling a Reply Apple Event</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_21" title="Functions for Creating Apple Event Data Structures"></a><h2>Functions for Creating Apple Event Data Structures</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_171"></a>In addition to the <code>AEBuildAppleEvent</code> and <code>AECreateAppleEvent</code> functions for creating Apple events, you use the following functions for creating other data structures you use with Apple events:</p><ul class="ul"><li class="li"><p>For creating descriptor records and lists and adding items to lists:</p><p><code>AEBuildDesc</code>, <code>AECreateDesc</code>, <code>AECreateList</code>, <code>AEPutPtr</code>, <code>AEPutDesc</code></p></li><li class="li"><p>For adding attributes and parameters to Apple events and Apple event records:</p><p><code>AEBuildParameters</code>, <code>AEPutParameter</code>, <code>AEPutParamDesc</code>, <code>AEPutAttributePtr</code>, <code>AEPutAttributeDesc</code></p></li></ul><p><span class="content_text"><a href="../appendix1_aepg/appendix1_aepg.html#//apple_ref/doc/uid/TP40001449-CH211-CEGGJADB">Table A-1</a></span> lists these and other Apple Event Manager functions. For complete function descriptions, see <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_172"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABCJGAJ" title="Specifying a Target Address"></a><h2>Specifying a Target Address</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_173"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_174"></a>When you create an Apple event, you must specify the address of the target. The <strong>target address</strong> identifies the particular application or process to send the Apple event to. You can send Apple events to applications on the local computer or on remote computers on the network. You specify a target address with a <strong>target address descriptor</strong><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_175"></a>.</p><p>The preferred descriptor types for identifying the address in an address descriptor are shown in <span class="content_text"><a href="../appendix2_aepg/appendix2_aepg.html#//apple_ref/doc/uid/TP40001449-CH212-CHDJFJDD">“Address Descriptor Type Constants.”</a></span> <a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_176"></a>You can also use another type if your application provides a coercion handler that coerces that type into one of the address types that the Apple Event Manager recognizes. See <span class="content_text"><a href="../coercions_aepg/coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-BABDAJGB">“Writing and Installing Coercion Handlers”</a></span> for more information on coercion handlers.</p><p>To address an Apple event to a target on a remote computer on the network, you generally use <code>typeApplicationURL</code> for the address descriptor type. To address an Apple event to a target on the local computer you can use any of the address types.</p><p>The fastest way for your application to send an Apple event to itself is to use a target address with a process serial number of <code>kCurrentProcess</code>. For more information, see <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABEIJCA">“Addressing an Apple Event for Direct Dispatching.”</a></span></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABFFIJF" title="Creating a Target Address Descriptor"></a><h3>Creating a Target Address Descriptor</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_177"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_178"></a>If you want to create an Apple event with the <code>AECreateAppleEvent</code> function, you need to create a target address descriptor to pass to the function. You can do so by calling the <code>AECreateDesc</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_179"></a> function. <span class="content_text">Listing 6-1</span> shows how to create an address descriptor for a process serial number (<code>typeProcessSerialNumber</code>). Other target address descriptor types are shown in <span class="content_text"><a href="../appendix2_aepg/appendix2_aepg.html#//apple_ref/doc/uid/TP40001449-CH212-CHDJFJDD">“Address Descriptor Type Constants.”</a></span></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABEGIEC" title="Listing 6-1Creating an address descriptor using a process serial number"></a><p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>Creating an address descriptor using a process serial number</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr               err;<span></span></pre></td></tr><tr><td scope="row"><pre>ProcessSerialNumber thePSN;<span></span></pre></td></tr><tr><td scope="row"><pre>AEAddressDesc       addressDesc;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = GetProcessNumber(&amp;thePSN);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    err = AECreateDesc(typeProcessSerialNumber,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;thePSN, sizeof(thePSN), &amp;addressDesc);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s a description of how this code snippet works:</p><ol class="ol"><li class="li"><p>It calls an application-defined function, <code>GetProcessNumber</code>, to obtain the process serial number of another process.</p><p>To create a target address descriptor for the current process, see <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABEHHJA">Listing 6-2</a></span>.</p></li><li class="li"><p>It calls <code>AECreateDesc</code> to create a target address based on the specified process serial number.</p><p>Your application should call <code>AEDisposeDesc</code> to dispose of the address descriptor when it is finished with it.</p></li></ol><p>When you create an Apple event with the <code>AEBuildAppleEvent<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_180"></a></code> function, it uses information from the following three parameters to create a target address descriptor:</p><dl class="termdef">	<dt><code>DescType addressType</code></dt><dd><p>The address type for the address information described in the next two parameters: for example, <code><a href="../../../../Carbon/Reference/Apple_Event_Manager/Reference/reference.html#//apple_ref/doc/c_ref/typeProcessSerialNumber" target="_top">typeProcessSerialNumber</a></code> or <code><a href="../../../../Carbon/Reference/Apple_Event_Manager/Reference/reference.html#//apple_ref/doc/c_ref/typeKernelProcessID" target="_top">typeKernelProcessID</a></code>.</p></dd></dl><dl class="termdef">	<dt><code>const void * addressData</code></dt><dd><p>A pointer to the address information.</p></dd></dl><dl class="termdef">	<dt><code>long addressLength</code></dt><dd><p>The number of bytes pointed to by the <code>addressData</code> parameter.</p></dd></dl><p>For a code example that uses <code>AEBuildAppleEvent</code>, see <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABDBBDC">Listing 6-4</a></span>.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_181"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_182"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABEIJCA" title="Addressing an Apple Event for Direct Dispatching"></a><h3>Addressing an Apple Event for Direct Dispatching</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_183"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_184"></a>Applications typically send Apple events to themselves to support recordability, discussed briefly in <span class="content_text"><a href="../about_aes_aepg/about_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH202-CEGGBHDH">“When Applications Use Apple Events.”</a></span> The best way for your application to send Apple events to itself is to use an address descriptor of <code>typeProcessSerialNumber</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_185"></a> with the <code>lowLongOfPSN</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_186"></a> field set to <code>kCurrentProcess</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_187"></a> and the <code>highLongOfPSN</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_188"></a> field set to 0. <span class="content_text">Listing 6-2</span> shows how to do this.</p><p>When you send an Apple event with this type of target address descriptor, the Apple Event Manager jumps directly to the appropriate Apple event handler without going through the normal event-processing sequence. This is not only more efficient, it avoids the situation in which an Apple event sent in response to a user action arrives in the event queue after some other event that really occurred later than the user action. For example, suppose a user chooses Cut from the Edit menu and then clicks in another window. If the <code>cut</code> Apple event arrives in the queue after the window activate event, a selection in the wrong window might be cut.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABEHHJA" title="Listing 6-2Creating an address descriptor that specifies the current application"></a><p class="codesample"><strong>Listing 6-2&nbsp;&nbsp;</strong>Creating an address descriptor that specifies the current application</p><div class="codesample"><table><tr><td scope="row"><pre>    AEAddressDesc addressDesc;<span></span></pre></td></tr><tr><td scope="row"><pre>    ProcessSerialNumber selfPSN = { 0, kCurrentProcess };<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = AECreateDesc(typeProcessSerialNumber, &amp;selfPSN,<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof(selfPSN), &amp;addressDesc);<span>// 2</span></pre></td></tr></table></div><p>Here’s a description of how this code snippet works:</p><ol class="ol"><li class="li"><p>Sets up a process serial number for the current process, as described above.</p></li><li class="li"><p>Calls <code>AECreateDesc</code> to create a target address that specifies the current application by its process serial number.</p><p>Your application should call <code>AEDisposeDesc</code> to dispose of the address descriptor when it is finished with it.</p></li></ol><p>Your application can send events to itself using other forms of target addressing. However, this can lead to the event dispatching sequence problems just described.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_55" title="Important:"></a><p><strong>Important:</strong>&nbsp;When Apple event recording has been turned on, the Apple Event Manager records every event that your application sends to itself unless you specify the <code>kAEDontRecord</code> flag in the <code>sendMode</code> parameter of the <code>AESend</code> or <code>AESendMessage</code> function.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_189"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_190"></a></p><p></p></div><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_22" title="Obtaining the Addresses of Remote Processes"></a><h3>Obtaining the Addresses of Remote Processes</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_191"></a>You can use <code>AECreateRemoteProcessResolver</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_192"></a> and related functions to obtain the addresses of other processes on the network. To do so you follow these steps:</p><ol class="ol"><li class="li"><p>Call <code>AECreateRemoteProcessResolver</code> to get a process resolver.</p></li><li class="li"><p>Call <code>AERemoteProcessResolverGetProcesses</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_193"></a> to obtain a dictionary containing, for each remote application, the URL of the application and its human readable name (and possibly other information).</p></li><li class="li"><p>Call <code>AEDisposeRemoteProcessResolver</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_194"></a> to dispose of the process resolver.</p></li><li class="li"><p>Create a target address descriptor based on a specified URL.</p><ol class="ol"><li class="ol ol"><p>Extract the URL from the dictionary entry as a <code>CFURLRef</code>.</p></li><li class="ol ol"><p>Convert it to a <code>CFStringRef</code> (for example, with <code>CFURLGetString</code>).</p></li><li class="ol ol"><p>Extract a text string in UTF-8 encoding. (For an example of code that extracts unicode text from a <code>CFStringRef</code>, see <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGDDABA">Listing 5-3</a></span>.)</p></li><li class="ol ol"><p>Put the text into an address descriptor using the type <code>typeApplicationURL</code>. The format of the URL associated with this type is described in the Discussion section of “Descriptor Type Constants” in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p></li></ol></li><li class="li"><p>Alternatively, if the dictionary entry contains a process ID for the remote process, you can create an address descriptor based on the type <code>typeKernelProcessID</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_195"></a>.</p></li></ol><p>You can use the remote process resolver technology, for example, to present an interface to allow a user to select a remote application. For more information on these functions, see the section “Locating Processes on Remote Computers” in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_196"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_197"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_198"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_23" title="Creating an Apple Event"></a><h2>Creating an Apple Event</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_199"></a>This section provides examples of how to create an Apple event with <code>AECreateAppleEvent</code> and with <code>AEBuildAppleEvent</code>. These functions are introduced in <span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-CEGDCFEJ">“Two Approaches to Creating an Apple Event.”</a></span></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABHDIJA" title="Creating an Apple Event With AEBuildAppleEvent"></a><h3>Creating an Apple Event With AEBuildAppleEvent</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_200"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_201"></a>The <code>AEBuildAppleEvent</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_202"></a> function provides a mechanism for converting a specially formatted string into a complete Apple event. This function is similar to <code>AECreateAppleEvent</code>, but contains additional parameters it uses in creating the Apple event and constructing parameters for it.</p><p>The <code>AEBuildAppleEvent</code> function is similar to the <code>printf</code> family of routines in the standard C library. The syntax for the format string defines an Apple event as a sequence of name-value pairs, with optional parameters preceded with a tilde (~) character. For details, see Technical Note TN2106, <span class="content_text"><a href="http://developer.apple.com/technotes/tn/tn2045.html" target="_top">AEBuild*, AEPrint*, and Friends</a></span>.</p><p>The next two code listings show how you might use <code>AEBuildAppleEvent</code> to create an Apple event that tells the Finder to reveal the startup disk (make it visible on the desktop).</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABHHEBD" title="Listing 6-3Constants used in creating a reveal Apple event for the Finder"></a><p class="codesample"><strong>Listing 6-3&nbsp;&nbsp;</strong>Constants used in creating a reveal Apple event for the Finder</p><div class="codesample"><table><tr><td scope="row"><pre>const CFStringRef startupDiskPath = CFSTR("/");<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>const OSType finderSignature = 'MACS';<span>// 2</span></pre></td></tr></table></div><p>Here’s a description of these constants, which are defined in <code>AERegistry.h</code> and used by the Finder in its Apple event support:</p><ol class="ol"><li class="li"><p>Defines a string reference for the POSIX-style path of the startup disk.</p></li><li class="li"><p>Defines the application signature for the Mac OS Finder application.</p><p>Because the Finder is always running in Mac OS X, it is generally safe to send it an Apple event without first making sure it has been launched.</p></li></ol><p><span class="content_text">Listing 6-4</span> shows a function that creates an Apple event to reveal the startup disk in the Finder.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABDBBDC" title="Listing 6-4Creating a reveal Apple event with AEBuildAppleEvent"></a><p class="codesample"><strong>Listing 6-4&nbsp;&nbsp;</strong>Creating a reveal Apple event with AEBuildAppleEvent</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr BuildRevealStartupDiskAE (AppleEvent * revealEvent)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    FSRef startupDiskFSRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    AliasHandle startupDiskAlias;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFURLRef startupURLRef =<span></span></pre></td></tr><tr><td scope="row"><pre>        CFURLCreateWithFileSystemPath(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>            startupDiskPath, kCFURLPOSIXPathStyle, true);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (CFURLGetFSRef(startupURLRef, &amp;startupDiskFSRef))<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = FSNewAlias(NULL, &amp;startupDiskFSRef, &amp;startupDiskAlias);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            err = AEBuildAppleEvent(<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                    kAEMiscStandards,<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                    kAEMakeObjectsVisible,<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                    typeApplSignature,<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                    &amp;finderSignature,<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                    sizeof(finderSignature),<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                    kAutoGenerateReturnID, <span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                    kAnyTransactionID,<span>// 12</span></pre></td></tr><tr><td scope="row"><pre>                    revealEvent,<span>// 13</span></pre></td></tr><tr><td scope="row"><pre>                    NULL,<span>// 14</span></pre></td></tr><tr><td scope="row"><pre>                    "'----':[alis(@@)]",<span>// 15</span></pre></td></tr><tr><td scope="row"><pre>                    startupDiskAlias);<span>// 16</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        err = memFullErr;<span>// 17</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span>// 18</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s a description of how the <code>BuildRevealStartupDiskAE</code> function works:</p><ol class="ol"><li class="li"><p>It is passed a pointer to an Apple event data structure for the event to be created.</p></li><li class="li"><p>It calls <code>CFURLCreateWithFileSystemPath</code> to create a <code>CFURLRef</code> for the path to the startup disk, passing the constant <code>startupDiskPath</code> declared in <span class="content_text">Listing 6-3</span>.</p></li><li class="li"><p>It calls <code>CFURLGetFSRef</code> to get an <code>FSRef</code> file reference to the startup disk from the <code>CFURLRef</code>.</p></li><li class="li"><p>It calls <code>FSNewAlias</code> to convert the <code>FSRef</code> to an alias handle for the startup disk, to use in creating the Apple event.</p></li><li class="li"><p>It calls <code>AEBuildAppleEvent</code> to create the Apple event. The next several items describe the parameters you pass to that function.</p></li><li class="li"><p>Specifies <code>kAEMiscStandards</code>, a constant defined in <code>AERegistry.h</code>, for the event class.</p></li><li class="li"><p>Specifies <code>kAEMakeObjectsVisible</code>, also defined in <code>AERegistry.h</code>, for the event ID.</p></li><li class="li"><p>Passes <code>typeApplSignature</code> to specify a target address type.</p></li><li class="li"><p>Passes <code>finderSignature</code>, defined in <span class="content_text">Listing 6-3</span>, to specify the application signature for the Finder.</p></li><li class="li"><p>Passes the size of the application signature.</p></li><li class="li"><p>Passes the Apple Event Manager constant <code>kAutoGenerateReturnID</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_203"></a>, indicating the Apple Event Manager should set a return ID for the event. Your application can specify its own return ID, if needed.</p></li><li class="li"><p>Passes the Apple Event Manager constant <code>kAnyTransactionID</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_204"></a>, indicating the event is not part of a series of interdependent transactions.</p></li><li class="li"><p>Passes a pointer to the Apple event to be built.</p></li><li class="li"><p>Passes a value of <code>NULL</code>, indicating no error information is required.</p><p>See Technical Note TN2106, <span class="content_text"><a href="http://developer.apple.com/technotes/tn/tn2045.html" target="_top">AEBuild*, AEPrint*, and Friends</a></span> for information on working with error information when using <code>AEBuildAppleEvent</code>.</p></li><li class="li"><p>Passes a format string containing information for any attributes and parameters to add to the Apple event. In this case, there is just one parameter, an alias (<code>'----'</code>).</p><p>The identifier for the direct parameter in an Apple event is specified by the constant <code>keyDirectObject</code> (<code>'----'</code>). The minus sign has special meaning in AEBuild strings, so it should always be enclosed in single quotes when it is used to identify the direct parameter for an Apple event.</p></li><li class="li"><p>Passes the previously created alias handle as the data corresponding to the entry in the format string.</p></li><li class="li"><p>In the case where the function could not create an <code>FSRef</code>, it sets a return error value.</p></li><li class="li"><p>It returns a value indicating whether an error occurred.</p></li></ol><p> To see how the <code>BuildRevealStartupDiskAE</code> function is called, and how you can send the resulting Apple event, see <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABHADGJ">Listing 6-7</a></span>.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_205"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABJCGDJ" title="Creating an Apple Event With AECreateAppleEvent"></a><h3>Creating an Apple Event With AECreateAppleEvent</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_206"></a>To create an Apple event with <code>AECreateAppleEvent</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_207"></a>, you perform these steps:</p><ul class="spaceabove"><li class="li"><p>Prepare a target address descriptor, as described in <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABFFIJF">“Creating a Target Address Descriptor.”</a></span></p></li><li class="li"><p>Call <code>AECreateAppleEvent</code> to create the Apple event, passing the event class, event ID, and other information.</p></li><li class="li"><p>If necessary, call other Apple Event Manager functions to add additional information to the event, until it contains all the information required for the task you want to perform.</p></li></ul><p>For example, suppose your application wants to send a <code>quit</code> Apple event to another application. It might do this to terminate an application it launched previously, or perhaps to make sure an application is not running so it can perform an update. <span class="content_text">Listing 6-5</span> shows how to create a <code>quit</code> application Apple event.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABGCHDH" title="Listing 6-5Creating a quit Apple event with AECreateAppleEvent"></a><p class="codesample"><strong>Listing 6-5&nbsp;&nbsp;</strong>Creating a quit Apple event with AECreateAppleEvent</p><div class="codesample"><table><tr><td scope="row"><pre>AppleEvent someAE;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = AECreateAppleEvent(<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        kCoreEventClass,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        kAEQuitApplication,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        &amp;theTarget,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        kAutoGenerateReturnID,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        kAnyTransactionID,<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        &amp;someAE);<span>// 7</span></pre></td></tr></table></div><p>Here’s how the code in <span class="content_text">Listing 6-5</span> works:</p><ol class="ol"><li class="li"><p>It calls <code>AECreateAppleEvent</code> to create the Apple event. The following items describe the parameters you pass to that function.</p></li><li class="li"><p>Specifies <code>kCoreEventClass</code>, a constant defined in <code>AppleEvents.h</code>, for the event class.</p></li><li class="li"><p>Specifies <code>kAEQuitApplication</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_208"></a>, also defined in <code>AppleEvents.h</code>, for the event ID.</p></li><li class="li"><p>Passes the address of the previously constructed target address descriptor, which identifies the application to send the <code>quit</code> event to.</p></li><li class="li"><p>Passes the Apple Event Manager constant <code>kAutoGenerateReturnID</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_209"></a>, indicating the Apple Event Manager should set a return ID for the event. Your application can specify its own return ID, if needed.</p></li><li class="li"><p>Passes the Apple Event Manager constant <code>kAnyTransactionID</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_210"></a>, indicating the event is not part of a series of interdependent transactions.</p></li><li class="li"><p>It passes the address of an Apple event data structure for the event to be created.</p></li></ol><p>That’s all you need to do to create a <code>quit</code> Apple event. However, to create a more complicated Apple event, you typically need to add attributes or parameters to the event. For example, your application might receive a <code>get data</code> Apple event for which it returns some specified text as the direct parameter of the reply Apple event. <span class="content_text">Listing 6-6</span> shows how to add such a direct parameter, using a previously defined function.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABCDIJI" title="Listing 6-6Adding a direct parameter to an Apple event"></a><p class="codesample"><strong>Listing 6-6&nbsp;&nbsp;</strong>Adding a direct parameter to an Apple event</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr anErr = AEPutParamString(<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                    reply,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                    keyDirectObject,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    textStringRef);<span>// 4</span></pre></td></tr></table></div><p>Here’s how the code in <span class="content_text">Listing 6-6</span> works:</p><ol class="ol"><li class="li"><p>It calls the application-defined function <code>AEPutParamString</code>, shown in <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGDDABA">Listing 5-3</a></span>. The following items describe the parameters you pass to add a direct parameter to the Apple event.</p></li><li class="li"><p>A pointer to the Apple event to add the parameter to.</p></li><li class="li"><p>An Apple Event Manager keyword constant specifying that the parameter is to be added as the direct parameter of the Apple event.</p></li><li class="li"><p>A <code>CFStringRef</code>, obtained prior to the call, that specifies the text for the direct parameter.</p></li></ol><p>You can also use the <code>AEBuildParameters</code> function, introduced in <span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-CEGDCFEJ">“Two Approaches to Creating an Apple Event,”</a></span> to add more complicated attributes or parameters to an existing Apple event.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_211"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_24" title="Disposing of Apple Events You Create"></a><h3>Disposing of Apple Events You Create</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_212"></a>Regardless of how you create an Apple event, your application is responsible for disposing of it with the <code>AEDisposeDesc</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_213"></a> function when you are finished with it. Your application must also dispose of all the descriptor records it creates when adding parameters and attributes to an Apple event—remember, many Apple Event Manager functions make copies of descriptors and of their associated data, as noted in <span class="content_text"><a href="../data_in_ae_aepg/data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABEDEGI">“Disposing of Apple Event Data Structures.”</a></span></p><p>You normally dispose of your Apple event and its reply, if any, after you send the event and receive a result (either from <code>AESend</code> or <code>AESendMessage</code>). You should dispose of the data structures you created even if the sending function returns an error. If you are sending the event asynchronously, you need not wait for the reply Apple event before disposing of the sent Apple event.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_214"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_215"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABIAGJI" title="Sending an Apple Event"></a><h2>Sending an Apple Event</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_216"></a>Once you have created an Apple event, the Apple Event Manager provides two choices for sending it. The <code>AESend</code> function provides more options but higher overhead, while the <code>AESendMessage</code> function provides fewer options but less overhead.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_25" title="When to Use AESend"></a><h3>When to Use AESend</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_217"></a>The <code>AESend</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_218"></a> function has parameters for specifying how to handle timeouts, idle processing, and event filtering. It requires your application to link with the entire Carbon framework, which brings in the HIToolbox framework and requires a connection to the window server.</p><p>Using <code>AESend</code> is appropriate only for applications that require the use of idle processing and event filtering. This type of processing is not generally needed, or recommended, for applications that handle events with Carbon event handlers. Therefore, only Carbon applications that use older style event handling are likely to need to use <code>AESend</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_56" title="Note"></a><p><strong>Note:</strong>&nbsp;If you call <code>AESend</code> and pass <code>NULL</code> for the filter and idle functions, <code>AESend</code> will call through to the less expensive <code>AESendMessage</code> function.</p></div><p>The <code>AESend</code> function provides these parameters that are not available to <code>AESendMessage</code>:</p><dl class="termdef">	<dt><code>AESendPriority sendPriority</code></dt><dd><p>This parameter is deprecated in Mac OS X.</p></dd></dl><dl class="termdef">	<dt><code>AEIdleUPP idleProc</code></dt><dd><p>A universal procedure pointer to a function that handles events (such as update, operating-system, activate, and null events) that your application receives while waiting for a reply. Your idle function can also perform other tasks (such as displaying a delay cursor) while waiting for a reply or a return receipt.</p><p>If your application specifies the <code>kAEWaitReply</code> flag in the <code>sendMode</code> parameter and you wish your application to get periodic time while waiting for the reply to return, you must provide an idle function. Otherwise, you can pass a value of <code>NULL</code> for this parameter.</p><p>For advice on whether to use idle functions, see <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABGEAHG">“Specifying Send and Reply Options.”</a></span></p></dd></dl><dl class="termdef">	<dt><code>AEFilterUPP filterProc</code></dt><dd><p>A universal procedure pointer to a function that determines which incoming Apple events should be received while the handler waits for a reply or a return receipt. If your application doesn’t need to filter Apple events, you can pass a value of <code>NULL</code> for this parameter. If you do so, no application-oriented Apple events are processed while waiting.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_219"></a></p></dd></dl><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_26" title="When to Use AESendMessage"></a><h3>When to Use AESendMessage</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_220"></a>The <code>AESendMessage</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_221"></a> function requires less overhead than the <code>AESend</code> function. It also allows you to send Apple events by linking with just the Application Services framework, and not the entire Carbon framework (and window server), as required by <code>AESend</code>.</p><p>Using the <code>AESendMessage</code> function is appropriate for applications that don’t require idle processing and event filtering (most modern Carbon applications), and where any of the following applies:</p><ul class="spaceabove"><li class="li"><p>Efficiency is a key concern.</p></li><li class="li"><p>The application has no user interface.</p></li><li class="li"><p>The application should not link with Carbon.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_222"></a></p></li></ul><a name="//apple_ref/doc/uid/TP40001449-CH209-BABGEAHG" title="Specifying Send and Reply Options"></a><h3>Specifying Send and Reply Options</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_223"></a>Regardless of which function you use to send Apple events, you’ll need to specify certain options, such as how to interact with the user, whether you want a reply Apple event, and if so, how to receive it. You do this by setting flags in the <code>sendMode</code> parameter, present in both <code>AESend</code> and <code>AESendMessage</code>. Here’s a brief description of that parameter:</p><dl class="termdef">	<dt><code>AESendMode sendMode</code></dt><dd><p>Specifies options for how the server application should handle the Apple event. To obtain a value for this parameter, you add together constants to set bits that specify the reply mode, the interaction level, and possibly flags for other options.</p></dd></dl><p>You can read a full description of all the constants for setting send mode flags in the constant section "AESendMode” in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>. But here are some of the more common choices you might make for these flags.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABCIEIH" title="Specifying a Reply in the Send Mode Parameter"></a><h4>Specifying a Reply in the Send Mode Parameter</h4><p>If you do not want a reply to the Apple event you are sending, you specify the <code>kAENoReply</code> flag in the <code>sendMode</code> parameter.</p><p>If you’re willing to wait a certain amount of time for a reply, specify <code>kAEWaitReply</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_224"></a>—the function does not return until the timeout specified by the <code>timeoutInTicks</code> parameter expires or the server application returns a reply. When the server application returns a reply, the <code>reply</code> parameter contains the reply Apple event.</p><p>If you specify the <code>kAEWaitReply</code> flag to <code>AESend</code>, you should provide an idle function to process any non-high-level events that occur while your application is waiting for a reply. You supply a pointer to your idle function as a parameter to the <code>AESend</code> function. So that your application can process other Apple events while it is waiting for a reply, you can also specify an optional filter function.</p><p>You don't provide an idle function or a  filter function when you call the <code>AESendMessage</code> function because it doesn’t provide parameters for them. If you specify <code>kAEWaitReply</code> to <code>AESendMessage</code>, it executes in such a way that any timers or event sources added to your run loop are not called while inside <code>AESendMessage</code>.</p><p>Rather than wait for a reply, you can send Apple events asynchronously and receive reply events when they’re ready through normal event processing. To do this, you specify the <code>kAEQueueReply</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_225"></a> flag and register a handler for reply events with the event class <code>kCoreEventClass</code> and event ID <code>kAEAnswer</code>. Your application processes reply events in the same way it does other Apple events. This approach is recommended because it is far more efficient than waiting in an idle routine. In addition, it avoids the possibility of getting into odd states, such as loops within loops while waiting for replies as the idle routine processes events.</p><p>If you specify <code>kAEWaitReply</code> or <code>kAEQueueReply</code>, the Apple Event Manager automatically passes a default reply Apple event to the server. The Apple Event Manager returns any nonzero result code from the server’s handler in the <code>keyErrorNumber</code> parameter of the reply Apple event. The server can return an error string in the <code>keyErrorString</code> parameter of the reply Apple event. The server can also use the reply Apple event to return any data you requested—for example, the results of a numeric calculation or a list of misspelled words.</p><p>If you specify the <code>kAENoReply</code> flag, the reply Apple event passed to the server application consists of a null descriptor record.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_27" title="Specifying User Interaction in the Send Mode Parameter"></a><h4>Specifying User Interaction in the Send Mode Parameter</h4><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_226"></a>If your Apple event may require the user to interact with the server application (for example, to specify print or file options), you can communicate your user interaction preferences to the server by specifying additional flags in the <code>sendMode</code> parameter. These flags specify the conditions, if any, under which the server application can interact with the user and, if interaction is allowed, whether the server should come directly to the foreground or post a notification request.</p><p>The server application specifies its own preferences for user interaction by specifying flags to the <code>AESetInteractionAllowed</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_227"></a> function, as described in <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGJDIJB">“Interacting With the User.”</a></span><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_228"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_229"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABFFCGI" title="Sending an Apple Event With AESend"></a><h3>Sending an Apple Event With AESend</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_230"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_231"></a><span class="content_text">Listing 6-7</span> shows how you can build an Apple event with <code>AEBuildAppleEvent</code> and send the event with <code>AESend</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_232"></a>.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABHADGJ" title="Listing 6-7Sending an Apple event with the AESend function"></a><p class="codesample"><strong>Listing 6-7&nbsp;&nbsp;</strong>Sending an Apple event with the AESend function</p><div class="codesample"><table><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    AppleEvent revealEvent;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = BuildRevealStartupDiskAE(&amp;revealEvent);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = AESend(&amp;revealEvent,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                    NULL,       // No reply event needed.<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    kAENoReply | kAECanInteract,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                    kAENormalPriority,// Normal priority.<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                    kAEDefaultTimeout,// Let AE Mgr decide on timeout.<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                    NULL,           // No idle function.<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                    NULL);          // No filter function.<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = AEDisposeDesc(&amp;revealEvent);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s how the code in <span class="content_text">Listing 6-7</span> works:</p><ol class="ol"><li class="li"><p>Calls the application-defined function <code>BuildRevealStartupDiskAE</code>, shown in <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABDBBDC">Listing 6-4</a></span>, to build an Apple event that tells the Finder to reveal the startup disk.</p></li><li class="li"><p>Calls the function <code>AESend</code>, passing the Apple event obtained by the previous function call. The next several items describe the remaining parameters you pass to the <code>AESend</code> function.</p></li><li class="li"><p>Passes <code>NULL</code> for the reply event because no reply is expected.</p></li><li class="li"><p>Passes a logical combination of constants indicating that no reply is expected and that interaction with the user is allowed (although none is likely for this event).</p><p>In the case where your application wants an asynchronous reply and does not allow interaction, you would pass <code>kAEQueueReply | kAENeverInteract</code>.</p></li><li class="li"><p>Passes a constant indicating the event should have normal priority. However, priority is ignored on Mac OS X.</p></li><li class="li"><p>Passes a constant indicating the Apple Event Manager should use the default timeout length (usually about thirty seconds). You can, instead, pass a specific value for the number of ticks (sixtieths of a second) to delay.</p></li><li class="li"><p>Passes <code>NULL</code>, indicating it will not use an idle function (needed only in specific cases where your application waits for a reply).</p></li><li class="li"><p>Passes <code>NULL</code>, indicating it will not use a filter function (needed, in conjunction with an idle function, only in specific cases where your application waits for a reply).</p></li><li class="li"><p>Calls <code>AEDisposeDesc</code> to dispose of the Apple event.</p><p>In cases where you expect a reply Apple event, your application should dispose of that event as well, once it is finished with it. If the reply is handled asynchronously, dispose of the reply event in the reply handler.</p></li></ol><p>In this example, the call to <code>AESend</code> does not supply an idle function or a filter function. As a result, <code>AESend</code> will fall through and call the <code>AESendMessage</code> function, which has less overhead. When you don’t require idle and filter functions, you can, of course, call <code>AESendMessage</code> directly, as described in the next section.</p><p>As noted in <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABCIEIH">“Specifying a Reply in the Send Mode Parameter,”</a></span> even in the case where your application expects a delayed reply to an Apple event it sends, the most efficient mechanism is to ask for queued replies and register a handler to receive them.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_233"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABHDDAB" title="Sending an Apple Event With AESendMessage"></a><h3>Sending an Apple Event With AESendMessage</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_234"></a><span class="content_text">Listing 6-8</span> shows how you can send an Apple event with <code>AESendMessage</code><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_235"></a>.</p><a name="//apple_ref/doc/uid/TP40001449-CH209-BABJIAGI" title="Listing 6-8Sending an Apple event with the AESendMessage function"></a><p class="codesample"><strong>Listing 6-8&nbsp;&nbsp;</strong>Sending an Apple event with the AESendMessage function</p><div class="codesample"><table><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    AppleEvent revealEvent;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = BuildRevealStartupDiskAE(&amp;revealEvent);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = AESendMessage(&amp;revealEvent,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                    NULL,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    kAENoReply | kAENeverInteract,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                    kAEDefaultTimeout);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = AEDisposeDesc(&amp;revealEvent);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s how the code in <span class="content_text">Listing 6-7</span> works:</p><ol class="ol"><li class="li"><p>Calls the application-defined function <code>BuildRevealStartupDiskAE</code>, shown in <span class="content_text"><a href="create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABDBBDC">Listing 6-4</a></span>, to build an Apple event that tells the Finder to reveal the startup disk.</p></li><li class="li"><p>Calls the function <code>AESendMessage</code>, passing the Apple event obtained by the previous function call. The next several items describe the remaining parameters you pass to the <code>AESendMessage</code> function.</p></li><li class="li"><p>Passes <code>NULL</code> for the reply event because no reply is expected.</p></li><li class="li"><p>Passes a logical combination of constants indicating that no reply is expected and that interaction with the user is not allowed.</p></li><li class="li"><p>Passes a constant indicating the Apple Event Manager should use the default timeout length (usually about thirty seconds). You can, instead, pass a specific value for the number of ticks (sixtieths of a second) to delay.</p></li><li class="li"><p>Calls <code>AEDisposeDesc</code> to dispose of the Apple event.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_236"></a><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_237"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001449-CH209-BABHHAJB" title="Handling a Reply Apple Event"></a><h2>Handling a Reply Apple Event</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_238"></a>When your application receives a reply event, either as a return parameter from the sending routine or in a return event handler, it uses Apple Event Manager functions to extract the information it needs from the event. This process is the same as the one described in <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-BABDAJGB">“Responding to Apple Events.”</a></span></p><p>Whenever a server application provides an error string parameter in a reply event, it should also provide an error number. However, you can’t count on all server applications to do so. A client application should therefore check for both the <code>keyErrorNumber</code> (for example, see <span class="content_text"><a href="../responding_aepg/responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGBCICI">Listing 5-2</a></span>) and <code>keyErrorString</code> parameters before assuming that no error has occurred.</p><p>When your application has finished using the reply Apple event, it should dispose of it by calling the <code>AEDisposeDesc</code> function. The Apple Event Manager takes care of disposing of both the Apple event and the reply Apple event after a server application’s handler returns, but the server is responsible for disposing of any data structures it creates while extracting data from the event.<a name="//apple_ref/doc/uid/TP40001449-CH209-DontLinkElementID_239"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../responding_aepg/responding_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../coercions_aepg/coercions_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/AppleEvents/create_send_aepg/create_send_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/AppleEvents/create_send_aepg/create_send_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/AppleEvents/create_send_aepg/create_send_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>