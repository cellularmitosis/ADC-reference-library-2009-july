<html><head><title>Mac OS X Developer Tools
 Manual Page For EV_SET(2)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/2/EV_SET" title="Mac OS X Developer Tools
 Manual Page for EV_SET(2)"><!-- headerDoc=man; indexgroup=Section 2; uid="//apple_ref/doc/man/2/EV_SET"; name=EV_SET(2) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
KQUEUE(2)                   BSD System Calls Manual                  <!-- a -->KQUEUE(2)<!-- /a -->

<b>NAME</b>
     <b>kqueue</b>, <b>kevent</b> -- kernel event notification mechanism

<b>LIBRARY</b>
     Standard C Library (libc, -lc)

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/types.h&gt;</b>
     <b>#include</b> <b>&lt;sys/event.h&gt;</b>
     <b>#include</b> <b>&lt;sys/time.h&gt;</b>

     <u>int</u>
     <b>kqueue</b>(<u>void</u>);

     <u>int</u>
     <b>kevent</b>(<u>int</u> <u>kq</u>, <u>const</u> <u>struct</u> <u>kevent</u> <u>*changelist</u>, <u>int</u> <u>nchanges</u>, <u>struct</u> <u>kevent</u> <u>*eventlist</u>, <u>int</u> <u>nevents</u>,
         <u>const</u> <u>struct</u> <u>timespec</u> <u>*timeout</u>);

     <b>EV_SET</b>(<u>&amp;kev</u>, <u>ident</u>, <u>filter</u>, <u>flags</u>, <u>fflags</u>, <u>data</u>, <u>udata</u>);

<b>DESCRIPTION</b>
     The <b>kqueue</b>() system call provides a generic method of notifying the user when an kernel event (kevent)
     happens or a condition holds, based on the results of small pieces of kernel code termed filters.  A
     kevent is identified by an (ident, filter) pair and specifies the interesting conditions to be notified
     about for that pair.  An (ident, filter) pair can only appear once is a given kqueue.  Subsequent
     attempts to register the same pair for a given kqueue will result in the replacement of the conditions
     being watched, not an addition.

     The filter identified in a kevent is executed upon the initial registration of that event in order to
     detect whether a preexisting condition is present, and is also executed whenever an event is passed to
     the filter for evaluation.  If the filter determines that the condition should be reported, then the
     kevent is placed on the kqueue for the user to retrieve.

     The filter is also run when the user attempts to retrieve the kevent from the kqueue.  If the filter
     indicates that the condition that triggered the event no longer holds, the kevent is removed from the
     kqueue and is not returned.

     Multiple events which trigger the filter do not result in multiple kevents being placed on the kqueue;
     instead, the filter will aggregate the events into a single struct kevent.  Calling <b>close</b>() on a file
     descriptor will remove any kevents that reference the descriptor.

     The <b>kqueue</b>() system call creates a new kernel event queue and returns a descriptor.  The queue is not
     inherited by a child created with <a href="fork.2.html#//apple_ref/doc/man/2/fork">fork(2)</a>.

     The <b>kevent</b>() system call is used to register events with the queue, and return any pending events to
     the user.  The <u>changelist</u> argument is a pointer to an array of <u>kevent</u> structures, as defined in
     &lt;<u>sys/event.h&gt;</u>.  All changes contained in the <u>changelist</u> are applied before any pending events are read
     from the queue.  The <u>nchanges</u> argument gives the size of <u>changelist</u>.  The <u>eventlist</u> argument is a
     pointer to an array of kevent structures.  The <u>nevents</u> argument determines the size of <u>eventlist</u>.  If
     <u>timeout</u> is a non-NULL pointer, it specifies a maximum interval to wait for an event, which will be
     interpreted as a struct timespec.  If <u>timeout</u> is a NULL pointer, <b>kevent</b>() waits indefinitely.  To
     effect a poll, the <u>timeout</u> argument should be non-NULL, pointing to a zero-valued <u>timespec</u> structure.
     The same array may be used for the <u>changelist</u> and <u>eventlist</u>.

     The <b>EV_SET</b>() macro is provided for ease of initializing a kevent structure.

     The <u>kevent</u> structure is defined as:

     struct kevent {
             uintptr_t ident;        /* identifier for this event */
             short     filter;       /* filter for event */
             u_short   flags;        /* action flags for kqueue */
             u_int     fflags;       /* filter flag value */
             intptr_t  data;         /* filter data value */
             void      *udata;       /* opaque user data identifier */
     };

     The fields of <u>struct</u> <u>kevent</u> are:

     ident      Value used to identify this event.  The exact interpretation is determined by the attached
                filter, but often is a file descriptor.

     filter     Identifies the kernel filter used to process this event.  The pre-defined system filters are
                described below.

     flags      Actions to perform on the event.

     fflags     Filter-specific flags.

     data       Filter-specific data value.

     udata      Opaque user-defined value passed through the kernel unchanged.

     The <u>flags</u> field can contain the following values:

     EV_ADD         Adds the event to the kqueue.  Re-adding an existing event will modify the parameters of
                    the original event, and not result in a duplicate entry.  Adding an event automatically
                    enables it, unless overridden by the EV_DISABLE flag.

     EV_ENABLE      Permit <b>kevent</b>() to return the event if it is triggered.

     EV_DISABLE     Disable the event so <b>kevent</b>() will not return it.  The filter itself is not disabled.

     EV_DELETE      Removes the event from the kqueue.  Events which are attached to file descriptors are
                    automatically deleted on the last close of the descriptor.

     EV_RECEIPT     This flag is useful for making bulk changes to a kqueue without draining any pending
                    events. When passed as input, it forces EV_ERROR to always be returned.  When a filter
                    is successfully added. The <u>data</u> field will be zero.

     EV_ONESHOT     Causes the event to return only the first occurrence of the filter being triggered.
                    After the user retrieves the event from the kqueue, it is deleted.

     EV_CLEAR       After the event is retrieved by the user, its state is reset.  This is useful for fil-<font color="#ffffff" class="whiteout">ters&nbsp;filters</font>
                    ters which report state transitions instead of the current state.  Note that some fil-<font color="#ffffff" class="whiteout">ters&nbsp;filters</font>
                    ters may automatically set this flag internally.

     EV_EOF         Filters may set this flag to indicate filter-specific EOF condition.

     EV_ERROR       See <u>RETURN</u> <u>VALUES</u> below.

     The predefined system filters are listed below.  Arguments may be passed to and from the filter via the
     <u>fflags</u> and <u>data</u> fields in the kevent structure.

     EVFILT_READ    Takes a file descriptor as the identifier, and returns whenever there is data available
                    to read.  The behavior of the filter is slightly different depending on the descriptor
                    type.

                    Sockets
                        Sockets which have previously been passed to <b>listen</b>() return when there is an incom-<font color="#ffffff" class="whiteout">ing&nbsp;incoming</font>
                        ing connection pending.  <u>data</u> contains the size of the listen backlog.

                        Other socket descriptors return when there is data to be read, subject to the
                        SO_RCVLOWAT value of the socket buffer.  This may be overridden with a per-filter
                        low water mark at the time the filter is added by setting the NOTE_LOWAT flag in
                        <u>fflags</u>, and specifying the new low water mark in <u>data</u>.  On return, <u>data</u> contains the
                        number of bytes of protocol data available to read.

                        If the read direction of the socket has shutdown, then the filter also sets EV_EOF
                        in <u>flags</u>, and returns the socket error (if any) in <u>fflags</u>.  It is possible for EOF
                        to be returned (indicating the connection is gone) while there is still data pending
                        in the socket buffer.

                    Vnodes
                        Returns when the file pointer is not at the end of file.  <u>data</u> contains the offset
                        from current position to end of file, and may be negative.

                    Fifos, Pipes
                        Returns when the there is data to read; <u>data</u> contains the number of bytes available.

                        When the last writer disconnects, the filter will set EV_EOF in <u>flags</u>.  This may be
                        cleared by passing in EV_CLEAR, at which point the filter will resume waiting for
                        data to become available before returning.

     EVFILT_WRITE   Takes a file descriptor as the identifier, and returns whenever it is possible to write
                    to the descriptor.  For sockets, pipes and fifos, <u>data</u> will contain the amount of space
                    remaining in the write buffer.  The filter will set EV_EOF when the reader disconnects,
                    and for the fifo case, this may be cleared by use of EV_CLEAR.  Note that this filter is
                    not supported for vnodes.

                    For sockets, the low water mark and socket error handling is identical to the
                    EVFILT_READ case.

     EVFILT_AIO     This filter is currently unsupported.

     EVFILT_VNODE   Takes a file descriptor as the identifier and the events to watch for in <u>fflags</u>, and
                    returns when one or more of the requested events occurs on the descriptor.  The events
                    to monitor are:

                    NOTE_DELETE    The <b>unlink</b>() system call was called on the file referenced by the
                                   descriptor.

                    NOTE_WRITE     A write occurred on the file referenced by the descriptor.

                    NOTE_EXTEND    The file referenced by the descriptor was extended.

                    NOTE_ATTRIB    The file referenced by the descriptor had its attributes changed.

                    NOTE_LINK      The link count on the file changed.

                    NOTE_RENAME    The file referenced by the descriptor was renamed.

                    NOTE_REVOKE    Access to the file was revoked via <a href="revoke.2.html#//apple_ref/doc/man/2/revoke">revoke(2)</a> or the underlying fileystem
                                   was unmounted.

                    On return, <u>fflags</u> contains the events which triggered the filter.

     EVFILT_PROC    Takes the process ID to monitor as the identifier and the events to watch for in <u>fflags</u>,
                    and returns when the process performs one or more of the requested events.  If a process
                    can normally see another process, it can attach an event to it.  The events to monitor
                    are:

                    NOTE_EXIT
                       The process has exited.

                    NOTE_FORK
                       The process created a child process via <a href="fork.2.html#//apple_ref/doc/man/2/fork">fork(2)</a> or similar call.

                    NOTE_EXEC
                       The process executed a new process via <a href="execve.2.html#//apple_ref/doc/man/2/execve">execve(2)</a> or similar call.

                    NOTE_SIGNAL
                       The process was sent a signal. Status can be checked via <a href="waitpid.2.html#//apple_ref/doc/man/2/waitpid">waitpid(2)</a> or similar call.

                    NOTE_REAP
                       The process was reaped by the parent via <a href="wait.2.html#//apple_ref/doc/man/2/wait">wait(2)</a> or similar call.

                    On return, <u>fflags</u> contains the events which triggered the filter.

     EVFILT_SIGNAL  Takes the signal number to monitor as the identifier and returns when the given signal
                    is delivered to the process.  This coexists with the <b>signal</b>() and <b>sigaction</b>() facili-<font color="#ffffff" class="whiteout">ties,&nbsp;facilities,</font>
                    ties, and has a lower precedence.  The filter will record all attempts to deliver a sig-<font color="#ffffff" class="whiteout">nal&nbsp;signal</font>
                    nal to a process, even if the signal has been marked as SIG_IGN.  Event notification
                    happens after normal signal delivery processing.  <u>data</u> returns the number of times the
                    signal has occurred since the last call to <b>kevent</b>().  This filter automatically sets the
                    EV_CLEAR flag internally.

     EVFILT_TIMER   This filter is currently unsupported.

<b>RETURN</b> <b>VALUES</b>
     The <b>kqueue</b>() system call creates a new kernel event queue and returns a file descriptor.  If there was
     an error creating the kernel event queue, a value of -1 is returned and errno set.

     The <b>kevent</b>() system call returns the number of events placed in the <u>eventlist</u>, up to the value given by
     <u>nevents</u>.  If an error occurs while processing an element of the <u>changelist</u> and there is enough room in
     the <u>eventlist</u>, then the event will be placed in the <u>eventlist</u> with EV_ERROR set in <u>flags</u> and the system
     error in <u>data</u>.  Otherwise, -1 will be returned, and errno will be set to indicate the error condition.
     If the time limit expires, then <b>kevent</b>() returns 0.

<b>ERRORS</b>
     The <b>kqueue</b>() system call fails if:

     [ENOMEM]           The kernel failed to allocate enough memory for the kernel queue.

     [EMFILE]           The per-process descriptor table is full.

     [ENFILE]           The system file table is full.

     The <b>kevent</b>() system call fails if:

     [EACCES]           The process does not have permission to register a filter.

     [EFAULT]           There was an error reading or writing the <u>kevent</u> structure.

     [EBADF]            The specified descriptor is invalid.

     [EINTR]            A signal was delivered before the timeout expired and before any events were placed
                        on the kqueue for return.

     [EINVAL]           The specified time limit or filter is invalid.

     [ENOENT]           The event could not be found to be modified or deleted.

     [ENOMEM]           No memory was available to register the event.

     [ESRCH]            The specified process to attach to does not exist.

<b>SEE</b> <b>ALSO</b>
     <a href="aio_error.2.html#//apple_ref/doc/man/2/aio_error">aio_error(2)</a>, <a href="aio_read.2.html#//apple_ref/doc/man/2/aio_read">aio_read(2)</a>, <a href="aio_return.2.html#//apple_ref/doc/man/2/aio_return">aio_return(2)</a>, <a href="read.2.html#//apple_ref/doc/man/2/read">read(2)</a>, <a href="select.2.html#//apple_ref/doc/man/2/select">select(2)</a>, <a href="sigaction.2.html#//apple_ref/doc/man/2/sigaction">sigaction(2)</a>, <a href="write.2.html#//apple_ref/doc/man/2/write">write(2)</a>, <a href="../man3/signal.3.html#//apple_ref/doc/man/3/signal">signal(3)</a>

<b>HISTORY</b>
     The <b>kqueue</b>() and <b>kevent</b>() system calls first appeared in FreeBSD 4.1.

<b>AUTHORS</b>
     The <b>kqueue</b>() system and this manual page were written by Jonathan Lemon &lt;jlemon@FreeBSD.org&gt;.

<b>BUGS</b>
     Not all filesystem types support kqueue-style notifications.  And even some that do, like some remote
     filesystems, may only support a subset of the notification semantics described here.

BSD                             April 14, 2000                             BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man2/EV_SET.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man2/EV_SET.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man2/EV_SET.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
