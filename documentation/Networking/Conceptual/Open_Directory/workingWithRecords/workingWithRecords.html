<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Open Directory Programming Guide: Working with Records</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Working with Records"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000917-CH6" title="Working with Records"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000429" target="_top">Networking</a> &gt; <a href="../../../MacOSXServer-date.html#//apple_ref/doc/uid/TP30000440-TP30000429-TP30000542" target="_top">Mac OS X Server</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40000917-CH1-DontLinkElementID_4">Open Directory Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../workingWithNodes/workingWithNodes.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000917-CH6-SW1" title="Working with Records"></a><h1>Working with Records</h1><p>Using records is an essential part of using Open Directory. This chapter covers basic examples of how to interact with records.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-52922">Listing Records</a>
				
			<br/>
			
        
			
			
				<a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-51654">Getting Information About a Record’s Attribute</a>
				
			<br/>
			
        
			
			
				<a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-102212">Setting the Name of a Record</a>
				
			<br/>
			
        
			
			
				<a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-102655">Creating a Record and Adding an Attribute</a>
				
			<br/>
			
        
			
			
				<a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-103157">Deleting a Record</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000917-CH6-52922" title="Listing Records"></a><h2>Listing Records</h2><p>The sample code in <span class="content_text"><a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-51627">Listing 3-1</a></span> demonstrates how to list all records in a node. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated. The <code>MyOpenDirNode</code> routine is described in the section <span class="content_text"><a href="../workingWithNodes/workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51298">“Opening and Closing a Node.”</a></span></p><p>The sample code then calls its <code>ListRecord</code> routine and passes to it the node reference (<code>nodeRef</code>) obtained by calling its <code>MyOpenDirNode</code> routine.</p><p>The <code>GetRecordList</code> routine calls <code>dsDataBufferAllocate</code> to allocate a buffer for storing the results of calling <code>dsGetRecordList</code>. It also builds three data lists for determining which records to include in the list: one for record names (<code>recNames</code>), one for record types (<code>recTypes</code>), and one for attribute types (<code>attrTypes</code>). It sets <code>recName</code> to <code>kDSRecordsAll</code> (to include all record of any name in the list), <code>recTypes</code> to <code>kDSStdRecordTypeUsers</code> to include standard user type records in the list, and sets <code>attrTypes</code> to <code>kDSAttributesAll</code> to include all attributes of the records in the list.</p><p>Then the <code>GetRecordList</code> routine calls <code>dsGetRecordList</code> to fill the data buffer with matching records and their attributes. By specifying <code>eDSExact</code> as the fourth parameter (<code>inPatternMatchType</code>), <code>dsGetRecordList</code> gets records that exactly match the requirements specified by the <code>recNames</code> parameter. By specifying <code>false</code> as the seventh parameter (<code>inAttributeInfoOnly</code>), <code>dsGetRecordList</code> gets attribute values as well as attribute information.</p><p>The <code>dsGetRecordList</code> function returns in its <code>recCount</code> parameter the count of the number of records returned in its <code>dataBuffer</code> parameter. Using <code>recCount</code> as a limit, the <code>GetRecordList</code> routine walks through the data buffer calling <code>dsGetRecordEntry</code> to get the record entry information for each record.</p><p>The record entry information contains an attribute count that <code>GetRecordList</code> uses as a limit to walk through the record’s attributes, calling <code>dsGetAttributeEntry</code> for each attribute. For each attribute entry, <code>GetRecordList</code> calls <code>dsGetAttributeValue</code> and prints the attribute’s value and its attribute ID.</p><p>The <code>GetRecordList</code> routine continues printing attribute values and attribute IDs until <code>dsGetRecordList</code> returns a <code>context</code> parameter that is <code>NULL</code>. It cleans up by calling <code>dsDeallocAttributeEntry</code> and <code>dsDeallocAttributeValueEntry</code> to reclaim the memory associated with the attribute entry and attribute value entry that were created by calling <code>dsGetAttributeEntry</code> and <code>dsGetAttributeValueEntry</code>. It also calls <code>dsDeallocRecordEntry</code> to reclaim the memory associated with the record entry. Before it returns, <code>GetRecordList</code> should call <code>dsDataListDeallocate</code> to reclaim the memory associated with the <code>recNames</code>, <code>recTypes</code>, and <code>attrTypes</code> data lists. It should also call <code>dsDataBufferDeAllocate</code> to deallocate the data buffer.</p><p>When the <code>GetRecordList</code> routine returns, the sample code in <span class="content_text">Listing 3-1</span> calls <code>dsCloseDirNode</code> to close the node that it opened in order to get the record list.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-51627" title="Listing 3-1Listing records in a node"></a><a name="//apple_ref/doc/uid/TP40000917-CH6-SW2" title="Listing 3-1Listing records in a node"></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>Listing records in a node</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            GetRecordList(nodeRef);<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>long GetRecordList ( const tDirNodeReference nodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long i = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long j = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long k = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long recCount = 0; // Get all records.<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataBufferPtr dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tContextData context = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tAttributeListRef attrListRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tAttributeValueListRef valueRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tRecordEntry *pRecEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tAttributeEntry *pAttrEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tAttributeValueEntry *pValueEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataList recNames;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataList recTypes;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataList attrTypes;<span></span></pre></td></tr><tr><td scope="row"><pre>    dataBuffer = dsDataBufferAllocate( gDirRef, 2 * 1024 ); // allocate  a 2k buffer<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dataBuffer != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // For readability, the sample code does not check dirStatus  after<span></span></pre></td></tr><tr><td scope="row"><pre>        // each call, but<span></span></pre></td></tr><tr><td scope="row"><pre>        // your code should.<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsBuildListFromStringsAlloc ( gDirRef, &amp;recNames,  kDSRecordsAll, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsBuildListFromStringsAlloc ( gDirRef, &amp;recTypes,  kDSStdRecordTypeUsers, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsBuildListFromStringsAlloc ( gDirRef, &amp;attrTypes,  kDSAttributesAll, NULL );<span></span></pre></td></tr><tr><td scope="row"><pre>        do<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsGetRecordList( nodeRef, dataBuffer, &amp;recNames,  eDSExact,  &amp;recTypes, &amp;attrTypes, false, &amp;recCount, &amp;context  );<span></span></pre></td></tr><tr><td scope="row"><pre>            for ( i = 1; i &lt;= recCount; i++ )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsGetRecordEntry( nodeRef, dataBuffer,  i, &amp;attrListRef,  &amp;pRecEntry );<span></span></pre></td></tr><tr><td scope="row"><pre>                for ( j = 1; j &lt;= pRecEntry->fRecordAttributeCount;  j++ )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsGetAttributeEntry( nodeRef, dataBuffer,  attrListRef, j, &amp;valueRef, &amp;pAttrEntry );<span></span></pre></td></tr><tr><td scope="row"><pre>                    for ( k = 1; k &lt;= pAttrEntry->fAttributeValueCount;  k++ )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsGetAttributeValue( nodeRef,  dataBuffer, k,  valueRef, &amp;pValueEntry );<span></span></pre></td></tr><tr><td scope="row"><pre>                        printf( "%s\t- %lu\n", pValueEntry->fAttributeValueData.fBufferData, pValueEntry->fAttributeValueID  );<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsDeallocAttributeValueEntry(  gDirRef,  pValueEntry );<span></span></pre></td></tr><tr><td scope="row"><pre>                        pValueEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                        // Deallocate pAttrEntry, pValueEntry, and  pRecEntry<span></span></pre></td></tr><tr><td scope="row"><pre>                        // by calling dsDeallocAttributeEntry,<span></span></pre></td></tr><tr><td scope="row"><pre>                        // dsDeallocAttributeValueEntry, and<span></span></pre></td></tr><tr><td scope="row"><pre>                        // dsDeallocRecordEntry, respectively.<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsCloseAttributeValueList( valueRef  );<span></span></pre></td></tr><tr><td scope="row"><pre>                    valueRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsDeallocAttributeEntry( gDirRef,  pAttrEntry);<span></span></pre></td></tr><tr><td scope="row"><pre>                    pAttrEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsCloseAttributeList( attrListRef );<span></span></pre></td></tr><tr><td scope="row"><pre>                attrListRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsDeallocRecordEntry( gDirRef, pRecEntry  );<span></span></pre></td></tr><tr><td scope="row"><pre>                pRecEntry = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        } while (context != NULL); // Loop until all data has been  obtained.<span></span></pre></td></tr><tr><td scope="row"><pre>        // Call dsDataListDeallocate to deallocate recNames, recTypes,  and<span></span></pre></td></tr><tr><td scope="row"><pre>        // attrTypes.<span></span></pre></td></tr><tr><td scope="row"><pre>        // Deallocate dataBuffer by calling dsDataBufferDeAllocate.<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataListDeallocate ( gDirRef, &amp;recNames );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataListDeallocate ( gDirRef, &amp;recTypes );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataListDeallocate ( gDirRef, &amp;attrTypes );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataBufferDeAllocate ( gDirRef, dataBuffer );<span></span></pre></td></tr><tr><td scope="row"><pre>            dataBuffer = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return dirStatus;<span></span></pre></td></tr><tr><td scope="row"><pre>} // GetRecordList<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000917-CH6-51654" title="Getting Information About a Record&acirc;&#128;&#153;s Attribute"></a><h2>Getting Information About a Record’s Attribute</h2><p>The sample code in <span class="content_text"><a href="workingWithRecords.html#//apple_ref/doc/uid/TP40000917-CH6-51760">Listing 3-2</a></span> demonstrates how to get information about a record’s attribute. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated. The <code>MyOpenDirNode</code> routine is described in the section <span class="content_text"><a href="../workingWithNodes/workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51298">“Opening and Closing a Node.”</a></span></p><p>The sample code then calls its <code>GetRecInfo</code> routine and passes to it the node reference (<code>nodeRef</code>) obtained by calling its <code>MyOpenDirNode</code> routine.</p><p>The <code>GetRecInfo</code> routine calls <code>dsDataNodeAllocateString</code> to allocate two data nodes: one named <code>recName</code> allocated using the string “admin” and one named <code>recType</code> using the constant <code></code><code>kDSStdRecordTypeGroups</code>. Then the <code>GetRecInfo</code> routine calls <code>dsOpenRecord</code> to open the record whose name and record type match <code>recName</code> and <code>recType</code>.</p><p>If <code>dsOpenRecord</code> returns successfully, the <code>GetRecInfo</code> routine calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>attrType</code>) containing the constant <code>kDS1AttrPrimaryGroupID</code>. It then calls <code>dsGetRecordAttributeInfo</code> using <code>attrType</code> to specify which attribute to get information for. The <code>dsGetRecordAttributeInfo</code> function stores the attribute’s information in a <code>tAttributeEntry</code> structure.</p><p>To clean up, <code>GetRecInfo</code> calls <code>dsDeallocAttributeEntry</code> to deallocate the memory associated with <code>pAttrInfo</code> and call <code>dsDataNodeDeAllocate</code> to reclaim the memory asociated with <code>attrType</code>, <code>recName</code>, and <code>recType</code>.</p><p>When the <code>GetRecInfo</code> routine returns, the sample code in <span class="content_text">Listing 3-2</span> calls <code>dsCloseDirNode</code> to close the node that it opened in order to get the information about a record’s attribute.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-51760" title="Listing 3-2Getting information about a record&acirc;&#128;&#153;s attribute"></a><a name="//apple_ref/doc/uid/TP40000917-CH6-SW3" title="Listing 3-2Getting information about a record&acirc;&#128;&#153;s attribute"></a><p class="codesample"><strong>Listing 3-2&nbsp;&nbsp;</strong>Getting information about a record’s attribute</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            GetRecInfo(nodeRef);<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void GetRecInfo ( const tDirNodeReference inDirNodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tRecordReference recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tAttributeEntryPtr pAttrInfo = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr attrType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    recName = dsDataNodeAllocateString( gDirRef, "admin"  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( recName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        recType = dsDataNodeAllocateString( gDirRef, kDSStdRecordTypeGroups);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( recType != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsOpenRecord( inDirNodeRef, recType, recName,  &amp;recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                attrType = dsDataNodeAllocateString(gDirRef,  kDS1AttrPrimaryGroupID );<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( attrType != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsGetRecordAttributeInfo(recRef,  attrType,  &amp;pAttrInfo );<span></span></pre></td></tr><tr><td scope="row"><pre>                    if ( pAttrInfo != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsDeallocAttributeEntry( gDirRef,  pAttrInfo );<span></span></pre></td></tr><tr><td scope="row"><pre>                        pAttrInfo = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsDataNodeDeAllocate( gDirRef, attrType  );<span></span></pre></td></tr><tr><td scope="row"><pre>                    attrType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsDataNodeDeAllocate( gDirRef, recType );<span></span></pre></td></tr><tr><td scope="row"><pre>            recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsDataNodeDeAllocate( gDirRef, recName );<span></span></pre></td></tr><tr><td scope="row"><pre>        recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // GetRecInfo<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000917-CH6-102212" title="Setting the Name of a Record"></a><h2>Setting the Name of a Record</h2><p>The sample code in <span class="content_text">Listing 3-3</span> demonstrates how to set the name of a record. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated. The <code>MyOpenDirNode</code> routine is described in the section <span class="content_text"><a href="../workingWithNodes/workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51298">“Opening and Closing a Node.”</a></span></p><p>The sample code then calls its <code>SetRecordName</code> routine and passes to it the node reference (<code>nodeRef</code>) obtained by calling its <code>MyOpenDirNode</code> routine.</p><p>The <code>SetRecordName</code> routine calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>recName</code>) containing the string “testuser”. This is the current name of the record. Then the <code>SetRecordName</code> routine calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>recType</code>) that specifies the record type (<code>kDSStdRecordTypeUsers</code>) of the record whose name is to be set.</p><p>The <code>SetRecordName</code> routine then calls <code>dsOpenRecord</code> with <code>recName</code> and <code>recType</code> as parameters to specify the record to open. If <code>SetRecordName</code> successfully opens the record, it receives a record reference (<code>recRef</code>). Then <code>SetRecordName</code> calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>newRecName</code>) containing the string “Robert Smith” (the new name that is it be set). The <code>SetRecordName</code> routine then calls <code>dsSetRecordName</code> to set the record’s new name and <code>dsCloseRecord</code> to close the record. It then cleans up by calling <code>dsDataNodeDeAllocate</code> to reclaim the memory associated with <code>recName</code>, <code>recType</code>, and <code>newRecName</code>.</p><p>When the <code>SetRecordName</code> routine returns, the sample code in <span class="content_text">Listing 3-3</span> calls <code>dsCloseDirNode</code> to close the node that it opened in order to set the record’s name.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-102381" title="Listing 3-3Setting the name of a record"></a><a name="//apple_ref/doc/uid/TP40000917-CH6-SW4" title="Listing 3-3Setting the name of a record"></a><p class="codesample"><strong>Listing 3-3&nbsp;&nbsp;</strong>Setting the name of a record</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            SetRecordName( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void SetRecordName ( const tDirNodeReference nodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tRecordReference recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr newRecName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    recName = dsDataNodeAllocateString( gDirRef, "testuser"  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( recName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        recType = dsDataNodeAllocateString( gDirRef, kDSStdRecordTypeUsers  );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( recType != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsOpenRecord( nodeRef, recType, recName,  &amp;recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                newRecName = dsDataNodeAllocateString(gDirRef, "newtestname"  );<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( newRecName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsSetRecordName( recRef, newRecName  );<span></span></pre></td></tr><tr><td scope="row"><pre>                    dsDataNodeDeAllocate( gDirRef, newRecName );<span></span></pre></td></tr><tr><td scope="row"><pre>                    newRecName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsCloseRecord( recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>                recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataNodeDeAllocate( gDirRef, recType );<span></span></pre></td></tr><tr><td scope="row"><pre>            recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        dsDataNodeDeAllocate( gDirRef, recName );<span></span></pre></td></tr><tr><td scope="row"><pre>        recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // SetRecordName<span></span></pre></td></tr></table></div><p>Note that for this example to work, it would have to be run by a root process on the local NetInfo domain, or by a user process that has called <code>dsDoDirNodeAuth</code> with the <code>inDirNodeAuthOnlyFlag</code> parameter set to <code>FALSE</code> to get permission to make this change.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-102655" title="Creating a Record and Adding an Attribute"></a><h2>Creating a Record and Adding an Attribute</h2><p>The sample code in <span class="content_text">Listing 3-4</span> demonstrates how to create a record, open it, and add an attribute to it. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated. The <code>MyOpenDirNode</code> routine is described in the section <span class="content_text"><a href="../workingWithNodes/workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51298">“Opening and Closing a Node.”</a></span></p><p>The sample code then calls its <code>CreateRecord</code> routine and passes to it the node reference (<code>nodeRef</code>) obtained by calling its <code>MyOpenDirNode</code> routine.</p><p>The <code>CreateRecord</code> routine calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>recName</code>) containing the string “NewUserRecordName” and another data node (<code>recType</code>) specifying <code>kDSStdRecordTypeUsers</code> as the record type for the record that is to be created.</p><p>Then the <code>CreateRecord</code> routine then calls <code>dsCreateRecordAndOpen</code>, passing to it the node reference created when <code>dsOpenDirService</code> was called, <code>recName</code>, <code>recType</code>, and the address of a record reference value (<code>recRef</code>) initialized to zero. If <code>dsCreateRecordAndOpen</code> returns successfully, <code>recRef</code> will contain a record reference that the <code>CreateRecord</code> routine will use to add an attribute for the record.</p><p>The <code>CreateRecord</code> routine then calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>attrName</code>) containing <code>kDS1AttrDistinguishedName</code><code></code>. It also calls <code>dsDataNodeAllocateString</code> to allocate a data node containing the string “User Record’s Display Name”, which will be set as the value of the attribute.</p><p>To add the attribute and set its value, the <code>CreateRecord</code> routine calls <code>dsAddAttribute</code>. It then cleans up by calling <code>dsCloseRecord</code> to close the record and <code>dsDataNodeDeAllocate</code> to reclaim the memory associated with <code>attrName</code>, <code>recType</code>, and <code>recName</code>.</p><p>When the <code>CreateRecord</code> routine returns, the sample code in <span class="content_text">Listing 3-4</span> calls <code>dsCloseDirNode</code> to close the node that it opened in order to create and open the record.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-102850" title="Listing 3-4Creating and opening a record and adding an attribute"></a><a name="//apple_ref/doc/uid/TP40000917-CH6-SW5" title="Listing 3-4Creating and opening a record and adding an attribute"></a><p class="codesample"><strong>Listing 3-4&nbsp;&nbsp;</strong>Creating and opening a record and adding an attribute</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            CreateRecord( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void CreateRecord ( const tDirNodeReference inDirNodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr attrName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr attrValue = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tRecordReference recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    recName = dsDataNodeAllocateString( gDirRef, "NewUserRecordName"  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( recName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        recType = dsDataNodeAllocateString( gDirRef, kDSStdRecordTypeUsers  );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( recType != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsCreateRecordAndOpen( inDirNodeRef, recType,  recName,  &amp;recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                attrName = dsDataNodeAllocateString(gDirRef,  kDS1AttrDistinguishedName );<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( attrName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    attrValue = dsDataNodeAllocateString( gDirRef,  "User Record's  Display Name");<span></span></pre></td></tr><tr><td scope="row"><pre>                    if ( attrValue != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>                    {<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsAddAttribute(recRef, attrName,  NULL,  attrValue );<span></span></pre></td></tr><tr><td scope="row"><pre>                        dirStatus = dsDataNodeDeAllocate( gDirRef,  attrValue );<span></span></pre></td></tr><tr><td scope="row"><pre>                        attrValue = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsDataNodeDeAllocate( gDirRef, attrName  );<span></span></pre></td></tr><tr><td scope="row"><pre>                    attrName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsCloseRecord( recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>                recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsDataNodeDeAllocate( gDirRef, recType );<span></span></pre></td></tr><tr><td scope="row"><pre>            recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsDataNodeDeAllocate( gDirRef, recName );<span></span></pre></td></tr><tr><td scope="row"><pre>        recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // CreateRecord<span></span></pre></td></tr></table></div><p>Note that for this example to work, it would have to be run by a root process on the local NetInfo domain, or by a user process that has called <code>dsDoDirNodeAuth</code> with the <code>inDirNodeAuthOnlyFlag</code> parameter set to <code>FALSE</code> to get permission to make this change.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-103157" title="Deleting a Record"></a><h2>Deleting a Record</h2><p>The sample code in <span class="content_text">Listing 3-5</span> demonstrates how to delete a record. The sample code opens an Open Directory session and gets an Open Directory reference. Then it calls its <code>MyOpenDirNode</code> routine and passes to it the address of the node reference (<code>nodeRef</code>) that it has allocated. The <code>MyOpenDirNode</code> routine is described in the section <span class="content_text"><a href="../workingWithNodes/workingWithNodes.html#//apple_ref/doc/uid/TP40000917-CH5-51298">“Opening and Closing a Node.”</a></span></p><p>The sample code then calls its <code>DeleteRecord</code> routine and passes to it the node reference (<code>nodeRef</code>) obtained by calling its <code>MyOpenDirNode</code> routine.</p><p>The <code>DeleteRecord</code> routine calls <code>dsDataNodeAllocateString</code> to allocate a data node (<code>recName</code>) containing the string “testuser” as the name of the record that is to be deleted and another data node (<code>recType</code>) specifying <code>kDSStdRecordTypeUsers</code> as the record type of the record that is to be deleted. It then calls <code>dsOpenRecord</code> to open the record that is to be deleted and calls <code>dsDeleteRecord</code> to delete the record.</p><p>To reclaim memory associated with <code>recType</code> and <code>recName</code>, the <code>DeleteRecord</code> routine calls <code>dsDataNodeDeAllocate</code>.</p><p>The <code>dsDeleteRecord</code> function implicitly closes any record that it deletes. If <code>dsDeleteRecord</code> returns an error, indicating that the record was not deleted, the <code>DeleteRecord</code> routine in <span class="content_text">Listing 3-5</span> calls <code>dsCloseRecord</code> to close the record.</p><a name="//apple_ref/doc/uid/TP40000917-CH6-52654" title="Listing 3-5Deleting a record"></a><a name="//apple_ref/doc/uid/TP40000917-CH6-SW6" title="Listing 3-5Deleting a record"></a><p class="codesample"><strong>Listing 3-5&nbsp;&nbsp;</strong>Deleting a record</p><div class="codesample"><table><tr><td scope="row"><pre>void main ( )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDirNodeReference nodeRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    dirStatus = dsOpenDirService( &amp;gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = MyOpenDirNode( &amp;nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            DeleteRecord( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            dsCloseDirNode( nodeRef );<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gDirRef != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        dirStatus = dsCloseDirService( gDirRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>void DeleteRecord ( const tDirNodeReference nodeRef )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    long dirStatus = eDSNoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tRecordReference recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    tDataNodePtr recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    recName = dsDataNodeAllocateString( gDirRef, "testuser"  );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( recName != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        recType = dsDataNodeAllocateString( gDirRef, kDSStdRecordTypeUsers  );<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( recType != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            dirStatus = dsOpenRecord( nodeRef, recType, recName,  &amp;recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>            if ( dirStatus == eDSNoErr )<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                dirStatus = dsDeleteRecord( recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>                if (dirStatus != eDSNoErr)<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    // The record was not deleted, so close it.<span></span></pre></td></tr><tr><td scope="row"><pre>                    dirStatus = dsCloseRecord( recRef );<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                recRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            dsDataNodeDeAllocate( gDirRef, recType );<span></span></pre></td></tr><tr><td scope="row"><pre>            recType = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        dsDataNodeDeAllocate( gDirRef, recName );<span></span></pre></td></tr><tr><td scope="row"><pre>        recName = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} // DeleteRecord<span></span></pre></td></tr></table></div><p>Note that for this example to work, it would have to be run by a root process on the local NetInfo domain, or by a user process that has called <code>dsDoDirNodeAuth</code> with the <code>inDirNodeAuthOnlyFlag</code> parameter set to <code>FALSE</code> to get permission to make this change.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../workingWithNodes/workingWithNodes.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-01-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Networking/Conceptual/Open_Directory/workingWithRecords/workingWithRecords.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Networking/Conceptual/Open_Directory/workingWithRecords/workingWithRecords.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Networking/Conceptual/Open_Directory/workingWithRecords/workingWithRecords.html%3Fid%3DTP40000917-3.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>