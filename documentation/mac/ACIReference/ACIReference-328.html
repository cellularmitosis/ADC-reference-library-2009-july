<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyCMCheckPixMap(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING328></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-327.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-329.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-314.html"><B>Chapter 4 - ColorSync Manager Reference for Color Management Modules</B></A> / <A HREF="ACIReference-322.html"><B>Optional CMM-Defined Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B></B></A> / <A HREF="ACIReference-317.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING328-0></A>
<H3><A NAME=MARKER-9-59></A>MyCMCheckPixMap</H3>
 Handles the <CODE>kCMMCheckPixMap</CODE> request by checking the colors of the specified pixel map image against the color gamut of the destination profile.<P>
 A CMM should <A NAME=MARKER-2-60></A>respond to the <CODE>kCMMCheckPixMap</CODE> request code, but it is not required to do so. The ColorSync Manager sends this request code to your CMM on behalf of an application that called the <CODE>CWCheckPixMap</CODE> function. The ColorSync Manager dispatches this request to the Component Manager, which calls your CMM to service the request. A CMM typically responds to the <CODE>kCMMCheckPixMap</CODE> request code by calling a CMM-defined function (for example, <A NAME=MARKER-11-61></A><CODE>MyCMCheckPixMap</CODE>) to handle the request. <P>
 The MyCMCheckPixMap function is a color management module-defined subroutine.<P>
<PRE>
pascal CMError MyCMCheckPixMap(
ComponentInstance CMSession,
const PixMap *myPixMap,
CMBitmapCallBackUPP progressProc,
BitMap *myBitMap,
void *refCon);
</PRE>
<DL>
<DT><CODE>CMsession</CODE>
<DD> A handle to your CMM's storage for the instance of your component associated with the calling application or device driver.
<DT><CODE>myPixMap</CODE>
<DD> A pointer to a nonrelocatable pixel map whose colors are to be checked. A pixel map is a QuickDraw structure describing pixel data. 
<DT><CODE>progressProc</CODE>
<DD> A pointer to a callback function, supplied by the calling application or device driver, that monitors the color-checking progress or terminates the operation as your function checks the pixel map colors. Your <CODE>MyCMCheckPixMap</CODE> function must call this function at regular intervals to allow it to report progress to the user. 
<DT><CODE>myBitMap</CODE>
<DD> A pointer to a QuickDraw bitmap whose boundaries equal those of the pixel map indicated by the <CODE>myPixMap</CODE> parameter. Your <CODE>MyCMCheckPixMap</CODE> function must set a pixel to 1 if the corresponding pixel of the pixel map indicated by <CODE>myPixMap</CODE> is out of gamut.
<DT><CODE>refCon</CODE>
<DD> A reference constant passed from the calling application or driver, which your <CODE>MyCMCheckPixMap</CODE> function must pass through as a parameter to calls it makes to the <CODE>MyCMBitmapCallBackProc</CODE> function.
<DT><I>function result</I>
<DD> A result code of type CMError. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-172)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING328-11></A>
<H5>DISCUSSION</H5>
 If your CMM supports this request code, your <CODE>MyCMCheckPixMap</CODE> function should be prepared to receive any of the pixel map types defined by QuickDraw.Your <CODE>MyCMCheckPixMap</CODE> function must check the colors of the pixel map image pointed to by the <CODE>myPixMap</CODE> parameter against the color gamut of the destination profile to determine if the colors are within the gamut. If a pixel color of the pixel map indicated by <CODE>myPixMap</CODE> is out of gamut, your function must set to 1 the corresponding pixel of the bitmap indicated by <CODE>myBitMap</CODE>. The ColorSync Manager returns the bitmap showing the gamut check results to the calling application or device driver. <P>
 Before the Component Manager calls your CMM with a ColorSync request to check the colors of a pixel map, it calls your CMM with a <CODE>kNCMMInit</CODE> or <CODE>kCMMConcatInit</CODE> request. Your CMM sets up the destination profile information during initialization in response to the <CODE>kNCMMInit</CODE> or <CODE>kCMMConcatInit</CODE> request code. <P>
 When the Component Manager calls your CMM with the <CODE>kCMMCheckPixMap</CODE> request code, it passes to your CMM in the <CODE>session</CODE> parameter a handle to your CMM's private storage for the calling applications's component instance. Your <CODE>MyCMCheckPixMap</CODE> function should use the profile data you set in your storage for this component instance. If you used some other method to store profile data for this component instance when you initialized the session, you should obtain the profile data you require for the color-checking process from that storage. <P>
 Your <CODE>MyCMMatchPixMap</CODE> function must call the progress function supplied by the calling application or device driver at regular intervals to allow it to report progress to the user on the color-checking session. Your <CODE>MyCMCheckPixMap</CODE> function should monitor the progress function for a returned value of <CODE>true</CODE>, which indicates that the user interrupted the color-checking process. In this case, you should terminate the color-checking process. The Apple-supplied CMM calls the progress function approximately every half-second, unless color checking takes less time; this happens when there is a small amount of data to match. <P>
 Here is the prototype for the <CODE>MyCMBitmapCallBackProc</CODE> function pointed to by the <CODE>progressProc</CODE> parameter:<P>
<PRE>
pascal Boolean MyCMBitmapCallBackProc (
                     long progress, 
                     void *refCon);
</PRE>
 Each time your <CODE>MyCMCheckPixMap</CODE> function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, it must pass to the function any data stored in the reference constant. When the Component Manager called your CMM with the <CODE>kCMMCheckPixMap</CODE> <CODE>r</CODE>equest code, it passed to your CMM the reference constant from the calling program. <P>
 Each time your function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, your function must pass it a byte count in the <CODE>progress</CODE> parameter identifying the remaining number of bytes to check. As your <CODE>MyCMCheckPixMap</CODE> function checks the pixels of the <CODE>myPixMap</CODE> map, it should set the corresponding pixel of <CODE>myBitMap</CODE> to 0 if the color is in gamut and 1 if it is out of gamut. The last time your <CODE>MyCMCheckPixMap</CODE> function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, it must pass a byte count of 0 to indicate the completion of the color-checking process, signaling the progress function to perform any cleanup operations it requires. <P>
 The data color space of a pixel map is implicitly RGB. If the source and destination profiles' data color spaces (<CODE>dataColorSpace</CODE> field) are not also RGB, your function should not perform the color check. Instead, it should return an error. <P>
 If your CMM does not support a pixel map type that you receive, you can return an unimplemented error. In this case, the ColorSync Manager unpacks the colors of the pixel map and calls your <CODE>MyCMMatchColors</CODE> function, passing it the pixel map colors in a color list. You should avoid defaulting to this behavior, if possible, because it incurs overhead and slows down performance. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-327.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-329.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
