<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>DefProcs - /LDefProc0.A</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">DefProcs</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">DefProcs</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/LDefProc0.A</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/butcdef.a</option>
<option value="listing2.html">/LDefProc0.A</option>
<option value="listing3.html">/mdefproc.a</option>
<option value="listing4.html">/rdocproc.a</option>
<option value="listing5.html">/Read Me â€¢ DefProcs.txt</option>
<option value="listing6.html">/sbarcdef.a</option>
<option value="listing7.html">/wprocasm.a</option></select>
				</p>
				</form>
				<p><strong><a href="DefProcs.zip">Download Sample</a></strong> (&#147;DefProcs.zip&#148;, 78.9K)<BR>
<strong><a href="DefProcs.dmg">Download Sample</a></strong> (&#147;DefProcs.dmg&#148;, 151.3K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">;EASE$$$ READ ONLY COPY of file &quot;LDefProc0.A&quot;; 1.0  CCH 11/16/1988 Added to EASE.; END EASE MODIFICATION HISTORY ; File LDefProc0.a;-------------------------------------------------------------;; Standard List Definition Procedure for simple text;;    Ernie Beernink  March 1985;; This is the standard List defProc.  Its primary task is to draw; the contents of a list manager cell, either selected or deselected.; It is passed a pointer to the cell's data, the length of the cell's; data, and a rectangle in which to draw the cell.  When it is called,; the clip region is set to that rect.  The cell data does NOT include a; length byte.;; MODIFICATION HISTORY:; S3  05Jan87  JTC  32-bit support changes.;;    version $0001;     8jun87 sad color hilighting, trucation (conditional);-------------------------------------------------------------               BLANKS         ON               STRING         ASIS;        LOAD      'sysallqk.d'        LOAD      'nequ.d'        INCLUDE    'SysEqu.a'        INCLUDE    'Traps.a'        INCLUDE    'QuickEqu.a'        INCLUDE    'PackMacs.a'truncate  equ 0  ; truncation offLDEF0          PROC    EXPORT; PROCEDURE    DrawCell(LMessage:INTEGER; LSelect:BOOLEAN; LRect:Rect; LCell: Cell;;            LDataOffset, LDataLen:INTEGER; LHandle:Handle);; Message equates:;InitMsg        .EQU    0          ; tell drawing routines to init themselves;DrawMsg        .EQU    1          ; draw (and de/select) the indicated data;HiliteMsg      .EQU    2          ; de/select the indicated data;CloseMsg       .EQU    3          ; shut down, the list is being disposed; Stack Frame definition for ListDefProc 0LHandle         EQU    8         ; Handle to list data recordLDataLen       EQU    LHandle+4       ; length of dataLDataOffset    EQU    LDataLen+2       ; offset to dataLCell         EQU    LDataOffset+2       ; cell that was hitLRect         EQU    LCell+4       ; rect to draw inLSelect         EQU    LRect+4       ; 1=selected, 0=not selectedLMessage       EQU    LSelect+2       ; 0=Init, 1=Draw, 2=Hilite, 3=CloseLParamSize     EQU    LMessage+2-8       ; # of bytes of parameters               BRA.S   @0         ; enter here; standard header               DC.W    0      ; flags word               DC.B    'LDEF'  ; type               DC.W    0     ; ID               DC.W    $0001    ; version@0               LINK   A6,#0         ; set up a stack frame               MOVEM.L   D3-D7/A2-A4,-(SP)   ; save the usual stuff               MOVE.L   LHandle(A6),A4       ; get handle to list record               MOVE.L   (A4),A3       ; get pointer to (locked) record               MOVE.W   LMessage(A6),D0     ; why am I being called?               SUBQ   #1,D0         ; check next in line               BEQ.S  ListDraw    ; code = 1 -&gt; draw cell               SUBQ   #1,D0         ; check next               BEQ.S   LHilite       ; code = 2 -&gt; invert cell               BPL.S   LDefExit       ; other calls not needed here;---------------; LInit; Here is the code that does the initialization for this defprocLInit; just set up our indent               SUBQ   #8,SP         ; make room for GetFontInfo record               MOVE.L   SP,-(SP)       ; point to it               _GetFontInfo         ; and go get info               MOVE.W   (SP),indent+v(A3)   ; indent.v := ascent               MOVE.W   #4,indent+h(A3)     ; indent.h := 4               ADDQ   #8,SP         ; fix up stackLDefExit               MOVEM.L   (SP)+,D3-D7/A2-A4   ; restore the usual stuff               UNLK   A6         ; unlink our frame               MOVE.L   (SP)+,A0       ; get return address               ADD.L   #LParamSize,SP       ; strip off parameters               JMP   (A0)         ; and return;---------------; LHilite -- Here is the code that hilights/unhilights the; cell.   We know that it's drawn, and that we're only called; if it needs to be de/selected, so inverrect is all we need.LHilite         bclr    #7,HiliteMode    ; now in color! &lt;8jun87&gt;               MOVE.L   LRect(A6),-(SP)     ; push rect               _InverRect         ; and invert it               BRA.S   LDefExit       ; all done;---------------; ListDraw -- Here is the code that does the drawing; for the defProc.ListDraw      MOVE.L  LRect(A6),A4    ; get rect into A4      MOVE.L  topLeft(A4),-(SP)  ; move pen to indent point      MOVE.L  indent(A3),-(SP)      PEA    4(SP)      _AddPt      _MoveTo; use default text mode      _PenNormal      MOVE.L   cells(A3),A2    ; get data handle      MOVEA.L  A2,A0        ; data handle      &lt;S3&gt;      TST.W  ROM85        ; old ROMs?        &lt;S3&gt;      BMI.S  @oldROMs      ; MI means old      &lt;S3&gt;      _HGetState          ; D0 := lock state    &lt;S3&gt;      MOVE.B  D0,-(SP)      ; save lock state    &lt;S3&gt;      BRA.S  @oldEnd        ; skip over old way    &lt;S3&gt;@oldROMs                ;            &lt;S3&gt;      MOVE.B  (A0),-(SP)      ; save lock state old way&lt;S3&gt;@oldEnd                  ;            &lt;S3&gt;      _HLock            ; lock across QD calls  &lt;S3&gt;      MOVE.L  A4,-(SP)      ; clear out the rect      _EraseRect      MOVE.W  LDataLen(A6),D3    ; anything to draw?      BLE.S  @nodraw        ; =&gt;nope, don't draw &lt;22jul87 sad&gt; if truncate then            ; &lt;22jul87 sad&gt; to endif       MOVE.L  (a2),d6        ; d6.l = ptr to the text &lt;22jul87 sad&gt;      MOVE.W  LDataOffset(a6),d5  ; d5.w = offset to first byte of this cell &lt;22jul87 sad&gt;  ; calculate avail width      move  right(a4),d7      sub    left(a4),d7      sub    indent+h(a3),d7    ; left indent      sub    #1,d7        ; right indent      moveq  #0,d4        ; no trunc yet@truncloop      sub    #2,sp      move.l  d6,-(sp)      move  d5,-(sp)      move  d3,-(sp)      _TextWidth      cmp    (sp)+,d7      ; will string fit?      bge.s  @truncout      ; yes, leave        ; no, truncate by one char      tst.b  d4          ; truncated any yet?      bnz.s  @3          ; yes, just drop a char        ; no, add elipsis and drop a character      sub    #2,sp      move  #'\xC9',-(sp)      _CharWidth      sub    (sp)+,d7      moveq  #1,d4        ; remember that we have truncated@3      sub    #1,d3        ; drop the last character      bz.s  @nodraw        ; no more chars      bra.s  @truncloop      @truncout      MOVE.L  d6,-(sp)      ; point to the text      MOVE.W  d5,-(sp)      ; offset to first byte of this cell else       MOVE.L  (A2),-(SP)      ; point to the text      MOVE.W  LDataOffset(A6),-(SP)  ; offset to first byte endif        ; end &lt;22jul87 sad&gt;      MOVE.W  D3,-(SP)      ; and number of bytes      _DrawText if truncate then            ; &lt;22jul87 sad&gt; to endif       tst.b  d4          ; truncated any?      bz.s  @noelipsis      ; no, don't draw elipsis        ; yes      move  #'\xC9',-(sp)      _DrawChar@noelipsis endif                  ; end &lt;22jul87 sad&gt;@nodraw        ; &lt;22jul87 sad&gt;      MOVEA.L  A2,A0        ; data handle      &lt;S3&gt;      TST.W  ROM85        ; do we have new ROMs?  &lt;S3&gt;      BMI.S  @old2ROMs      ; MI means no, do it the old way  &lt;S3&gt;      MOVE.B  (SP)+,D0      ; saved lock state    &lt;S3&gt;      _HSetState          ; stuffed back to handle&lt;S3&gt;      BRA.S  @old2End      ;            &lt;S3&gt;@old2ROMs                ;            &lt;S3&gt;      MOVE.B  (SP)+,(A0)      ; restore lock state@old2End                ;            &lt;S3&gt;      TST.B  LSelect(A6)      ; selected? &lt;22jul87 sad&gt; if truncate then      bnz    LHilite        ; yes &lt;22jul87 sad&gt; else      bnz.s  LHilite        ; yes &lt;22jul87 sad&gt; endif        ; no &lt;22jul87 sad&gt; if truncate then      BRA    LDefExit      ; and return &lt;22jul87 sad&gt; else      BRA.S  LDefExit      ; and return endif       END</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/DefProcs/listing2.html%3Fid%3DDTS10000184-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/DefProcs/listing2.html%3Fid%3DDTS10000184-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/DefProcs/listing2.html%3Fid%3DDTS10000184-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>