<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created on February, 19 2008 by texi2html 1.70 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>GNU Libtool: 3. Using libtool</title>

<meta name="description" content="GNU Libtool: 3. Using libtool">
<meta name="keywords" content="GNU Libtool: 3. Using libtool">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.70">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="NOD8"></a>
<a name="SEC7"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="libtool_2.html#SEC6" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC8" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool_2.html#SEC6" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 3. Using libtool </h1>

<p>It makes little sense to talk about using libtool in your own packages
until you have seen how it makes your life simpler.  The examples in
this chapter introduce the main features of libtool by comparing the
standard library building procedure to libtool's operation on two
different platforms:

</p><dl compact="compact">
<dt>`<samp> a23</samp>'</dt>
<dd><p>An Ultrix 4.2 platform with only static libraries.

</p></dd>
<dt>`<samp> burger</samp>'</dt>
<dd><p>A NetBSD/i386 1.2 platform with shared libraries.
</p></dd>
</dl>

<p>You can follow these examples on your own platform, using the
preconfigured libtool script that was installed with libtool
(see section <a href="libtool_5.html#SEC26">Configuring libtool</a>).

</p><p>Source files for the following examples are taken from the `<tt>demo</tt>'
subdirectory of the libtool distribution.  Assume that we are building a
library, `<tt>libhello</tt>', out of the files `<tt>foo.c</tt>' and
`<tt>hello.c</tt>'.

</p><p>Note that the `<tt>foo.c</tt>' source file uses the <code>cos</code> math library
function, which is usually found in the standalone math library, and not
the C library (see <a href="../libc/Trig-Functions.html">(libc)Trig Functions</a> section `Trigonometric Functions' in <cite>The GNU C Library Reference Manual</cite>).  So, we need to add <kbd>-lm</kbd> to
the end of the link line whenever we link `<tt>foo.o</tt>' or `<tt>foo.lo</tt>'
into an executable or a library (see section <a href="libtool_8.html#SEC39">Inter-library dependencies</a>).

</p><p>The same rule applies whenever you use functions that don't appear in
the standard C library&hellip; you need to add the appropriate
<kbd>-l<var>name</var></kbd> flag to the end of the link line when you link
against those objects.

</p><p>After we have built that library, we want to create a program by linking
`<tt>main.o</tt>' against `<tt>libhello</tt>'.

</p><table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top" scope="row"><a href="#SEC8">3.1 Creating object files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">       Compiling object files for libraries.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC9">3.2 Linking libraries</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">           Creating libraries from object files.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC10">3.3 Linking executables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">         Linking object files against libtool libraries.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC11">3.4 Debugging executables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">       Running GDB on libtool-generated programs.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC12">3.5 Installing libraries</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">        Making libraries available to users.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC13">3.6 Installing executables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">      Making programs available to users.
</td></tr>
<tr><td align="left" valign="top" scope="row"><a href="#SEC14">3.7 Linking static libraries</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">            When shared libraries are not wanted.
</td></tr>
</table>

<hr size="6">
<a name="NOD9"></a>
<a name="SEC8"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC7" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC9" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.1 Creating object files </h2>

<p>To create an object file from a source file, the compiler is invoked
with the `-c' flag (and any other desired flags):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gcc -g -O -c main.c</kbd>
burger$
</pre></td></tr></table>
<p>The above compiler command produces an object file, `<tt>main.o</tt>', from
the source file `<tt>main.c</tt>'.

</p><p>For most library systems, creating object files that become part of a
static library is as simple as creating object files that are linked to
form an executable:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gcc -g -O -c foo.c</kbd>
burger$ <kbd>gcc -g -O -c hello.c</kbd>
burger$
</pre></td></tr></table>
<a name="IDX6"></a>
<a name="IDX7"></a>
<p>Shared libraries, however, may only be built from
<em>position-independent code</em> (PIC).  So, special flags must be passed
to the compiler to tell it to generate PIC rather than the standard
position-dependent code.

</p><a name="IDX8"></a>
<a name="IDX9"></a>
<a name="IDX10"></a>
<p>Since this is a library implementation detail, libtool hides the
complexity of PIC compiler flags by using separate library object files
(which end in `<samp>.lo</samp>' instead of `<samp>.o</samp>').  On systems without shared
libraries (or without special PIC compiler flags), these library object
files are identical to &quot;standard&quot; object files.

</p><p>To create library object files for `<tt>foo.c</tt>' and `<tt>hello.c</tt>',
simply invoke libtool with the standard compilation command as
arguments (see section <a href="libtool_4.html#SEC16">Compile mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23$ <kbd>libtool --mode=compile gcc -g -O -c foo.c</kbd>
gcc -g -O -c foo.c
echo timestamp &gt; foo.lo
a23$ <kbd>libtool --mode=compile gcc -g -O -c hello.c</kbd>
gcc -g -O -c hello.c
echo timestamp &gt; hello.lo
a23$
</pre></td></tr></table>
<p>Note that libtool creates two files for each invocation.  The `<samp>.lo</samp>'
file is a library object, which may be built into a shared library, and
the `<samp>.o</samp>' file is a standard object file.  On `<samp>a23</samp>', the
library objects are just timestamps, because only static libraries are
supported.

</p><p>On shared library systems, libtool automatically inserts the PIC
generation flags into the compilation command, so that the library
object and the standard object differ:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=compile gcc -g -O -c foo.c</kbd>
gcc -g -O -c -fPIC -DPIC foo.c
mv -f foo.o foo.lo
gcc -g -O -c foo.c &gt;/dev/null 2&gt;&amp;1
burger$ <kbd>libtool --mode=compile gcc -g -O -c hello.c</kbd>
gcc -g -O -c -fPIC -DPIC hello.c
mv -f hello.o hello.lo
gcc -g -O -c hello.c &gt;/dev/null 2&gt;&amp;1
burger$
</pre></td></tr></table>
<p>Notice that the second run of GCC has its output discarded.  This is
done so that compiler warnings aren't annoyingly duplicated.

</p><hr size="6">
<a name="NOD10"></a>
<a name="SEC9"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC8" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.2 Linking libraries </h2>

<p>Without libtool, the programmer would invoke the <code>ar</code> command to
create a static library:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>ar cru libhello.a hello.o foo.o</kbd>
burger$
</pre></td></tr></table>
<a name="IDX11"></a>
<p>But of course, that would be too simple, so many systems require that
you run the <code>ranlib</code> command on the resulting library (to give it
better karma, or something):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>ranlib libhello.a</kbd>
burger$
</pre></td></tr></table>
<p>It seems more natural to use the C compiler for this task, given
libtool's &quot;libraries are programs&quot; approach.  So, on platforms without
shared libraries, libtool simply acts as a wrapper for the system
<code>ar</code> (and possibly <code>ranlib</code>) commands.

</p><a name="IDX12"></a>
<a name="IDX13"></a>
<p>Again, the libtool library name differs from the standard name (it has a
`<samp>.la</samp>' suffix instead of a `<samp>.a</samp>' suffix).  The arguments to libtool are
the same ones you would use to produce an executable named
`<tt>libhello.la</tt>' with your compiler (see section <a href="libtool_4.html#SEC17">Link mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23$ <kbd>libtool --mode=link gcc -g -O -o libhello.la foo.o hello.o</kbd>
libtool: cannot build libtool library `libhello.la' from non-libtool \
                objects
a23$
</pre></td></tr></table>
<p>Aha!  Libtool caught a common error&hellip; trying to build a library
from standard objects instead of library objects.  This doesn't matter
for static libraries, but on shared library systems, it is of great
importance.

</p><p>So, let's try again, this time with the library object files.  Remember
also that we need to add <kbd>-lm</kbd> to the link command line because
`<tt>foo.c</tt>' uses the <code>cos</code> math library function (see section <a href="#SEC7">Using libtool</a>).

</p><p>Another complication in building shared libraries is that we need to
specify the path to the directory in which they (eventually) will be
installed (in this case, `<tt>/usr/local/lib</tt>')<a name="DOCF1" href="libtool_fot.html#FOOT1">(1)</a>:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23$ <kbd>libtool --mode=link gcc -g -O -o libhello.la foo.lo hello.lo \
                -rpath /usr/local/lib -lm</kbd>
mkdir .libs
ar cru .libs/libhello.a foo.o hello.o
ranlib .libs/libhello.a
creating libhello.la
a23$
</pre></td></tr></table>
<p>Now, let's try the same trick on the shared library platform:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=link gcc -g -O -o libhello.la foo.lo hello.lo \
                -rpath /usr/local/lib -lm</kbd>
mkdir .libs
ld -Bshareable -o .libs/libhello.so.0.0 foo.lo hello.lo -lm
ar cru .libs/libhello.a foo.o hello.o
ranlib .libs/libhello.a
creating libhello.la
burger$
</pre></td></tr></table>
<p>Now that's significantly cooler&hellip; libtool just ran an obscure
<code>ld</code> command to create a shared library, as well as the static
library.

</p><a name="IDX14"></a>
<p>Note how libtool creates extra files in the `<tt>.libs</tt>'
subdirectory, rather than the current directory.  This feature is to
make it easier to clean up the build directory, and to help ensure that
other programs fail horribly if you accidentally forget to use libtool
when you should.

</p><hr size="6">
<a name="NOD11"></a>
<a name="SEC10"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC9" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC11" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.3 Linking executables </h2>

<p>If you choose at this point to <em>install</em> the library (put it in a
permanent location) before linking executables against it, then you
don't need to use libtool to do the linking.  Simply use the appropriate
`<samp>-L</samp>' and `<samp>-l</samp>' flags to specify the library's location.

</p><a name="IDX15"></a>
<p>Some system linkers insist on encoding the full directory name of each
shared library in the resulting executable.  Libtool has to work around
this misfeature by special magic to ensure that only permanent directory
names are put into installed executables.

</p><a name="IDX16"></a>
<a name="IDX17"></a>
<p>The importance of this bug must not be overlooked: it won't cause
programs to crash in obvious ways.  It creates a security hole,
and possibly even worse, if you are modifying the library source code
after you have installed the package, you will change the behaviour of
the installed programs!

</p><p>So, if you want to link programs against the library before you install
it, you must use libtool to do the linking.

</p><a name="IDX18"></a>
<p>Here's the old way of linking against an uninstalled library:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gcc -g -O -o hell.old main.o libhello.a -lm</kbd>
burger$
</pre></td></tr></table>
<p>Libtool's way is almost the same<a name="DOCF2" href="libtool_fot.html#FOOT2">(2)</a>
(see section <a href="libtool_4.html#SEC17">Link mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23$ <kbd>libtool --mode=link gcc -g -O -o hell main.o libhello.la -lm</kbd>
gcc -g -O -o hell main.o ./.libs/libhello.a -lm
a23$
</pre></td></tr></table>
<p>That looks too simple to be true.  All libtool did was transform
`<tt>libhello.la</tt>' to `<tt>./.libs/libhello.a</tt>', but remember
that `<samp>a23</samp>' has no shared libraries.

</p><p>On `<samp>burger</samp>' the situation is different:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=link gcc -g -O -o hell main.o libhello.la -lm</kbd>
gcc -g -O -o .libs/hell main.o -L./.libs -R/usr/local/lib -lhello -lm
creating hell
burger$
</pre></td></tr></table>
<a name="IDX19"></a>

<p>Now assume `<tt>libhello.la</tt>' had already been installed, and you want
to link a new program with it.  You could figure out where it lives by
yourself, then run:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gcc -g -O -o test test.o -L/usr/local/lib -lhello</kbd>
</pre></td></tr></table>
<p>However, unless `<tt>/usr/local/lib</tt>' is in the standard library search
path, you won't be able to run <code>test</code>.  However, if you use libtool
to link the already-installed libtool library, it will do The Right
Thing (TM) for you:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=link gcc -g -O -o test \
                test.o /usr/local/lib/libhello.la</kbd>
gcc -g -O -o .libs/test test.o -Wl,--rpath
-Wl,/usr/local/lib /usr/local/lib/libhello.a -lm
creating test
burger$
</pre></td></tr></table>
<p>Note that libtool added the necessary run-time path flag, as well as
`<samp>-lm</samp>', the library libhello.la depended upon.  Nice, huh?

</p><p>Since libtool created a wrapper script, you should use libtool to
install it and debug it too.  However, since the program does not depend
on any uninstalled libtool library, it is probably usable even without
the wrapper script.  Libtool could probably be made smarter to avoid the
creation of the wrapper script in this case, but this is left as an
exercise for the reader.

</p>
<a name="IDX20"></a>
<a name="IDX21"></a>
<p>Notice that the executable, <code>hell</code>, was actually created in the
`<tt>.libs</tt>' subdirectory.  Then, a wrapper script was created
in the current directory.

</p><p>On NetBSD 1.2, libtool encodes the installation directory of
`<tt>libhello</tt>', by using the `<samp>-R/usr/local/lib</samp>' compiler flag.
Then, the wrapper script guarantees that the executable finds the
correct shared library (the one in `<tt>./.libs</tt>') until it is
properly installed.

</p><p>Let's compare the two different programs:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>time ./hell.old</kbd>
Welcome to GNU Hell!
** This is not GNU Hello.  There is no built-in mail reader. **
        0.21 real         0.02 user         0.08 sys
burger$ <kbd>time ./hell</kbd>
Welcome to GNU Hell!
** This is not GNU Hello.  There is no built-in mail reader. **
        0.63 real         0.09 user         0.59 sys
burger$
</pre></td></tr></table>
<p>The wrapper script takes significantly longer to execute, but at least
the results are correct, even though the shared library hasn't been
installed yet.

</p><p>So, what about all the space savings that shared libraries are supposed
to yield?

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>ls -l hell.old libhello.a</kbd>
-rwxr-xr-x  1 gord  gord  15481 Nov 14 12:11 hell.old
-rw-r--r--  1 gord  gord   4274 Nov 13 18:02 libhello.a
burger$ <kbd>ls -l .libs/hell .libs/libhello.*</kbd>
-rwxr-xr-x  1 gord  gord  11647 Nov 14 12:10 .libs/hell
-rw-r--r--  1 gord  gord   4274 Nov 13 18:44 .libs/libhello.a
-rwxr-xr-x  1 gord  gord  12205 Nov 13 18:44 .libs/libhello.so.0.0
burger$
</pre></td></tr></table>
<p>Well, that sucks.  Maybe I should just scrap this project and take up
basket weaving.

</p><p>Actually, it just proves an important point: shared libraries incur
overhead because of their (relative) complexity.  In this situation, the
price of being dynamic is eight kilobytes, and the payoff is about four
kilobytes.  So, having a shared `<tt>libhello</tt>' won't be an advantage
until we link it against at least a few more programs.

</p><hr size="6">
<a name="NOD12"></a>
<a name="SEC11"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC10" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC12" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.4 Debugging executables </h2>

<p>If `<tt>hell</tt>' was a complicated program, you would certainly want to
test and debug it before installing it on your system.  In the above
section, you saw how the libtool wrapper script makes it possible to run
the program directly, but unfortunately, this mechanism interferes with
the debugger:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gdb hell</kbd>
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type &quot;show copying&quot; to see the conditions.
There is no warranty for GDB; type &quot;show warranty&quot; for details.
GDB 4.16 (i386-unknown-netbsd), (C) 1996 Free Software Foundation, Inc.

&quot;hell&quot;: not in executable format: File format not recognized

(gdb) <kbd>quit</kbd>
burger$
</pre></td></tr></table>
<p>Sad.  It doesn't work because GDB doesn't know where the executable
lives.  So, let's try again, by invoking GDB directly on the executable:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>gdb .libs/hell</kbd>
trick:/home/src/libtool/demo$ gdb .libs/hell
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type &quot;show copying&quot; to see the conditions.
There is no warranty for GDB; type &quot;show warranty&quot; for details.
GDB 4.16 (i386-unknown-netbsd), (C) 1996 Free Software Foundation, Inc.
(gdb) <kbd>break main</kbd>
Breakpoint 1 at 0x8048547: file main.c, line 29.
(gdb) <kbd>run</kbd>
Starting program: /home/src/libtool/demo/.libs/hell
/home/src/libtool/demo/.libs/hell: can't load library 'libhello.so.2'

Program exited with code 020.
(gdb) <kbd>quit</kbd>
burger$
</pre></td></tr></table>
<p>Argh.  Now GDB complains because it cannot find the shared library that
`<tt>hell</tt>' is linked against.  So, we must use libtool in order to
properly set the library path and run the debugger.  Fortunately, we can
forget all about the `<tt>.libs</tt>' directory, and just run it on
the executable wrapper (see section <a href="libtool_4.html#SEC18">Execute mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=execute gdb hell</kbd>
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type &quot;show copying&quot; to see the conditions.
There is no warranty for GDB; type &quot;show warranty&quot; for details.
GDB 4.16 (i386-unknown-netbsd), (C) 1996 Free Software Foundation, Inc.
(gdb) <kbd>break main</kbd>
Breakpoint 1 at 0x8048547: file main.c, line 29.
(gdb) <kbd>run</kbd>
Starting program: /home/src/libtool/demo/.libs/hell

Breakpoint 1, main (argc=1, argv=0xbffffc40) at main.c:29
29	  printf (&quot;Welcome to GNU Hell!\n&quot;);
(gdb) <kbd>quit</kbd>
The program is running.  Quit anyway (and kill it)? (y or n) <kbd>y</kbd>
burger$
</pre></td></tr></table>
<hr size="6">
<a name="NOD13"></a>
<a name="SEC12"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC11" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC13" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.5 Installing libraries </h2>

<p>Installing libraries on a non-libtool system is quite
straightforward&hellip; just copy them into place:<a name="DOCF3" href="libtool_fot.html#FOOT3">(3)</a>

</p><a name="IDX22"></a>
<table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>su</kbd>
Password: <kbd>********</kbd>
burger# <kbd>cp libhello.a /usr/local/lib/libhello.a</kbd>
burger#
</pre></td></tr></table>
<p>Oops, don't forget the <code>ranlib</code> command:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger# <kbd>ranlib /usr/local/lib/libhello.a</kbd>
burger#
</pre></td></tr></table>
<a name="IDX23"></a>
<p>Libtool installation is quite simple, as well.  Just use the
<code>install</code> or <code>cp</code> command that you normally would
(see section <a href="libtool_4.html#SEC19">Install mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23# <kbd>libtool --mode=install cp libhello.la /usr/local/lib/libhello.la</kbd>
cp libhello.la /usr/local/lib/libhello.la
cp .libs/libhello.a /usr/local/lib/libhello.a
ranlib /usr/local/lib/libhello.a
a23#
</pre></td></tr></table>
<p>Note that the libtool library `<tt>libhello.la</tt>' is also installed, to
help libtool with uninstallation (see section <a href="libtool_4.html#SEC21">Uninstall mode</a>) and linking
(see section <a href="#SEC10">Linking executables</a>) and to help programs with dlopening
(see section <a href="libtool_9.html#SEC40">Dlopened modules</a>).

</p><p>Here is the shared library example:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger# <kbd>libtool --mode=install install -c libhello.la \
                /usr/local/lib/libhello.la</kbd>
install -c .libs/libhello.so.0.0 /usr/local/lib/libhello.so.0.0
install -c libhello.la /usr/local/lib/libhello.la
install -c .libs/libhello.a /usr/local/lib/libhello.a
ranlib /usr/local/lib/libhello.a
burger#
</pre></td></tr></table>
<a name="IDX24"></a>
<a name="IDX25"></a>
<p>It is safe to specify the `<samp>-s</samp>' (strip symbols) flag if you use a
BSD-compatible install program when installing libraries.
Libtool will either ignore the `<samp>-s</samp>' flag, or will run a program
that will strip only debugging and compiler symbols from the library.

</p><p>Once the libraries have been put in place, there may be some additional
configuration that you need to do before using them.  First, you must
make sure that where the library is installed actually agrees with the
`<samp>-rpath</samp>' flag you used to build it.

</p><a name="IDX26"></a>
<a name="IDX27"></a>
<a name="IDX28"></a>
<p>Then, running `<samp>libtool -n --mode=finish <var>libdir</var></samp>' can give you
further hints on what to do (see section <a href="libtool_4.html#SEC20">Finish mode</a>):

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger# <kbd>libtool -n --mode=finish /usr/local/lib</kbd>
PATH=&quot;$PATH:/sbin&quot; ldconfig -m /usr/local/lib
-----------------------------------------------------------------
Libraries have been installed in:
   /usr/local/lib

To link against installed libraries in a given directory, LIBDIR,
you must use the `-LLIBDIR' flag during linking.

 You will also need to do one of the following:
   - add LIBDIR to the `LD_LIBRARY_PATH' environment variable
     during execution
   - add LIBDIR to the `LD_RUN_PATH' environment variable
     during linking
   - use the `-RLIBDIR' linker flag

See any operating system documentation about shared libraries for
more information, such as the ld and ld.so manual pages.
-----------------------------------------------------------------
burger#
</pre></td></tr></table>
<p>After you have completed these steps, you can go on to begin using the
installed libraries.  You may also install any executables that depend
on libraries you created.

</p><hr size="6">
<a name="NOD14"></a>
<a name="SEC13"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC12" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC14" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.6 Installing executables </h2>

<p>If you used libtool to link any executables against uninstalled libtool
libraries (see section <a href="#SEC10">Linking executables</a>), you need to use libtool to
install the executables after the libraries have been installed
(see section <a href="#SEC12">Installing libraries</a>).

</p><p>So, for our Ultrix example, we would run:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">a23# libtool install -c hell /usr/local/bin/hell
install -c hell /usr/local/bin/hell
a23#
</pre></td></tr></table>
<p>On shared library systems, libtool just ignores the wrapper script and
installs the correct binary:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger# libtool install -c hell /usr/local/bin/hell
install -c .libs/hell /usr/local/bin/hell
burger#
</pre></td></tr></table>
<hr size="6">
<a name="NOD15"></a>
<a name="SEC14"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC13" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.7 Linking static libraries </h2>

<p>Why return to <code>ar</code> and <code>ranlib</code> silliness when you've had a
taste of libtool?  Well, sometimes it is desirable to create a static
archive that can never be shared.  The most frequent case is when you
have a set of object files that you use to build several different
programs.  You can create a &quot;convenience library&quot; out of those
objects, and link programs with the library, instead of listing all
object files for every program.  This technique is often used to
overcome GNU automake's lack of support for linking object files built
from sources in other directories, because it supports linking with
libraries from other directories.  This limitation applies to GNU
automake up to release 1.4; newer releases should support sources in
other directories.

</p><p>If you just want to link this convenience library into programs, then
you could just ignore libtool entirely, and use the old <code>ar</code> and
<code>ranlib</code> commands (or the corresponding GNU automake
`<samp>_LIBRARIES</samp>' rules).  You can even install a convenience library
(but you probably don't want to) using libtool:

</p><table><tr><td scope="row">&nbsp;</td><td><pre class="example">burger$ <kbd>libtool --mode=install ./install-sh -c libhello.a \
                /local/lib/libhello.a</kbd>
./install-sh -c libhello.a /local/lib/libhello.a
ranlib /local/lib/libhello.a
burger$
</pre></td></tr></table>
<p>Using libtool for static library installation protects your library from
being accidentally stripped (if the installer used the `<samp>-s</samp>' flag),
as well as automatically running the correct <code>ranlib</code> command.

</p><p>But libtool libraries are more than just collections of object files:
they can also carry library dependency information, which old archives
do not.  If you want to create a libtool static convenience library, you
can omit the `<samp>-rpath</samp>' flag and use `<samp>-static</samp>' to indicate that
you're only interested in a static library.  When you link a program
with such a library, libtool will actually link all object files and
dependency libraries into the program.

</p><p>If you omit both `<samp>-rpath</samp>' and `<samp>-static</samp>', libtool will create a
convenience library that can be used to create other libtool
libraries, even shared ones.  Just like in the static case, the library
behaves as an alias to a set of object files and dependency libraries,
but in this case the object files are suitable for inclusion in shared
libraries.  But be careful not to link a single convenience library,
directly or indirectly, into a single program or library, otherwise you
may get errors about symbol redefinitions.

</p><p>When GNU automake is used, you should use <code>noinst_LTLIBRARIES</code>
instead of <code>lib_LTLIBRARIES</code> for convenience libraries, so that
the `<samp>-rpath</samp>' option is not passed when they are linked.

</p><p>As a rule of thumb, link a libtool convenience library into at most one
libtool library, and never into a program, and link libtool static
convenience libraries only into programs, and only if you need to carry
library dependency information to the user of the static convenience
library.

</p><a name="IDX29"></a>
<p>Another common situation where static linking is desirable is in
creating a standalone binary.  Use libtool to do the linking and add the
`<samp>-all-static</samp>' flag.

</p><hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left" scope="row">[<a href="#SEC7" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="libtool_4.html#SEC15" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="libtool.html#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="libtool_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="libtool_15.html#SEC86" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="libtool_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated by <em>System Administrator</em> on <em>February, 19 2008</em> using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.70</em></a>.
 </font>
 <br>

</p>
</body>
</html>
