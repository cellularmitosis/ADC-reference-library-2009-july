<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>TubeTest - /TubeTest.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">TubeTest</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxGraphicsImaging-date.html" target="_blank">Carbon > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">TubeTest</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/TubeTest.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/CarbonPrefix.h</option>
<option value="listing2.html">/TubeTest.c</option></select>
				</p>
				</form>
				<p><strong><a href="TubeTest.zip">Download Sample</a></strong> (&#147;TubeTest.zip&#148;, 16.8K)<BR>
<strong><a href="TubeTest.dmg">Download Sample</a></strong> (&#147;TubeTest.dmg&#148;, 76.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    TubeTest.c  Contains:  The TubeTest program is a simple demonstration of how to use the Palette         Manager in a color program.  It has a special color palette that is associated        with the main window.  The colors are animated using the Palette Manager         to give a flowing tube effect.  The program is very simple, and the Palette        Manager and drawing parts are put in separate subroutines to make it easier        to figure out what is happening.          The program is still a complete Macintosh application with a Main Event Loop,        so there is the extra code to run the MEL.            There is a resource file that is necessary as well, to define the Menus, Window,        Dialog, and Palette resources used in the program.            See Sample and TESample for the general structure and MultiFinder techniques that        we recommend that you use when building a new application.  Written by: BJ    Copyright:  Copyright &copy; 1988-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        08/2000    JM        Carbonized, non-Carbon code is commented out                      for demonstration purposes.        7/14/1999  KG        Updated for Metrowerks Codewarror Pro 2.1        */#include &quot;CarbonPrefix.h&quot;#include &lt;Quickdraw.h&gt;#include &lt;Palettes.h&gt;#include &lt;Events.h&gt;#include &lt;Menus.h&gt;#include &lt;Windows.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Devices.h&gt;#include &lt;Events.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;Sound.h&gt;#include &lt;Gestalt.h&gt;  /* Constants */#define appleID        1000      /* resource IDs/menu IDs for Apple, */#define fileID        1001      /*   File and */#define editID        1002      /*  Edit menus */  #define appleM        0        /* Index for each menu in myMenus (array of menu handles) */#define fileM        1#define editM        2#define menuCount      3        /* Total number of menus */#define windowID      1000      /* Resource ID for main window */#define aboutMeDLOG     1000      /* And Resource ID for About box dialog. */#define tubularItem      1        /* When checked, animation of colors. */#define quitItem      3        /* Quit in the menu of course. */#define aboutMeCommand    1        /* Menu item in apple menu for About TubeTest item */  #define totalColors      152        /* use 150 colors in our palette for drawing eyes. */#define numColors      150        /* to skip black and white. */    /* Globals */MenuHandle  myMenus[menuCount];Rect    dragRect;            /* Rectangle used to mark bounds for dragging window */Boolean    doneFlag,            /* true if user has chosen Quit command */      tubeCheck;            /* if true, the menu is checked, and we animate. */EventRecord  myEvent;WindowPtr  myWindow,      whichWindow;char    theChar;OSErr    error;SysEnvRec  theWorld;/* Prototypes */void DrawEyes();void SetUpMenus();void ShiftyColors();void ShowAboutMeDialog();void DoCommand(long int mResult);/* Make the 2.0 Interface for passing Points to the Toolbox by address,   emulate the 3.0 method of passing Points by value. This list only contains   the affected routines actually used in this sample, and is not intended to   be a comprehensive list of the affected routines. */#ifdef MPW2#  define FindWindow  FINDWINDOW#  define MenuSelect  MENUSELECT#endif  void main(){  /*  **  Test the computer to be sure we can do color.    **  If not we would crash, which would be bad.    **  If we can't run, just beep and exit.  */  /*error = SysEnvirons(1, &amp;theWorld);  if (theWorld.hasColorQD == false) {    SysBeep (50);    ExitToShell();              // If no color QD, we must leave.   };*/    long  result;  BitMap  bitMap;    error = Gestalt(gestaltQuickdrawVersion, &amp;result);  if (result &lt; gestalt8BitQD) {    SysBeep (50);    ExitToShell();  }  /*InitGraf(&amp;qd.thePort);  InitFonts();  InitWindows();  InitMenus();  TEInit();  InitDialogs(nil);*/  InitCursor();  GetQDGlobalsScreenBits(&amp;bitMap);  //SetRect(&amp;dragRect, 4, 24, qd.screenBits.bounds.right - 4, qd.screenBits.bounds.bottom - 4);  SetRect(&amp;dragRect, 4, 24, bitMap.bounds.right - 4, bitMap.bounds.bottom - 4);  doneFlag = false;              /* flag to detect when Quit command is chosen */  tubeCheck = false;              /* flag for animating color is initially off. */  /*  **  Open the color window.  */  myWindow = GetNewCWindow(windowID, nil, (WindowPtr) -1);  //SetPort(myWindow);  SetPortWindowPort(myWindow);  /*  **  Set up menus last, since the menu drawing can then use   **  the palette we have for our window.   **  Makes the Apple look better, in particular.  */  SetUpMenus();    /*  **  Main Event Loop  */  do {    //SystemTask();  //er, what does(did) this do?    if (GetNextEvent(everyEvent, &amp;myEvent)) {      switch (myEvent.what) {        /* case on event type */        case mouseDown:          switch (FindWindow(myEvent.where, &amp;whichWindow)) {            case inSysWindow:    /* desk accessory window: call Desk Manager to handle it */              //SystemClick(&amp;myEvent, whichWindow);              break;            case inMenuBar:      /* Menu bar: learn which command, then execute it. */              DoCommand(MenuSelect(myEvent.where));              break;            case inDrag:      /* title bar: call Window Manager to drag */              DragWindow(whichWindow, myEvent.where, &amp;dragRect);              break;            case inContent:      /* body of application window: */              if (whichWindow != FrontWindow())                SelectWindow(whichWindow); /* and make it active if not */              break;          }          break;        case updateEvt:          /* Update the eyes in window. */          if ((WindowPtr) myEvent.message == myWindow) {            BeginUpdate((WindowPtr) myEvent.message);            DrawEyes();            EndUpdate((WindowPtr) myEvent.message);          }          break;                      case keyDown:        case autoKey:          /* key pressed once or held down to repeat */          if (myWindow == FrontWindow()) {            theChar = (myEvent.message &amp; charCodeMask); /* get the char */            /*             **  If Command key down, do it as a Menu Command.            */            if (myEvent.modifiers &amp; cmdKey)              DoCommand(MenuKey(theChar));          }          break;      }    }    /*      **  If we have menu item checked, go ahead and animate colors.    */    if (tubeCheck) ShiftyColors();      } while (!doneFlag);  /*  **  clean up after palette manager,   **  so he can chuck the palette in use.  */  //DisposeWindow (myWindow);}/***  This routine will update the window when required by update events.  It**  will draw two circular dudes that are indexed in colors through the colors**  we are using. 0 and 1 are skipped, since those are white and black in the**  palette.*/void DrawEyes(){  Rect  tempRect;  int    i;    SetRect(&amp;tempRect, numColors, numColors, numColors, numColors);  for (i = 2; i &lt;= totalColors; i++) {    PmForeColor(i);    FrameOval (&amp;tempRect);    InsetRect (&amp;tempRect, -1, -1);  }    SetRect(&amp;tempRect, numColors*3, numColors, numColors*3, numColors);  for (i = totalColors; i &gt;= 2; i--) {    PmForeColor(i);    FrameOval (&amp;tempRect);    InsetRect (&amp;tempRect, -1, -1);  }}/***  Read menu descriptions from resource file into memory **  and store handles in myMenus array.**  Insert into MenuBar and draw.*/void SetUpMenus(){  int i;  myMenus[appleM] = GetMenu(appleID);     /* read Apple menu from resource file */  AppendResMenu(myMenus[appleM], 'DRVR');    /* add desk accessory names to Apple menu */  myMenus[fileM] = GetMenu(fileID);      /* read file menu from resource file */  myMenus[editM] = GetMenu(editID);      /* read edit menu from resource file */  for (i = 0; i &lt; menuCount; i++)     InsertMenu(myMenus[i], 0);         /* install menus in menu bar */    DrawMenuBar();                /* and draw menu bar */}/***  Use the Palette currently attached to the main window to animate the colors **  in the circular eye shapes.  This will rotate them around to give the flowing **  tube effect. We make the palette into a color table so we can move entries **  around.  We have to skip the first two entries since those are black and white. **  (entries 0 and 1)*/void ShiftyColors(){    PaletteHandle  currPalette;  CTabHandle    destCTab;  ColorSpec    lastCSpec;    //SetPort (myWindow);  SetPortWindowPort(myWindow);    currPalette = GetPalette(myWindow);  destCTab = (CTabHandle) NewHandle(sizeof(ColorTable)+(totalColors*sizeof(ColorSpec)));  if (destCTab == nil)  return;  Palette2CTab(currPalette, destCTab);    /*  **  Move the colors around in the color table, skipping 0 and 1, and moving  **  all the elements down by one, and copying the element at 2 back to the   **  end of the table. The effect is to rotate the colors in the table.  */  lastCSpec = (*destCTab)-&gt;ctTable[2];            /* pull first one off. */  BlockMove (&amp;(*destCTab)-&gt;ctTable[3],          &amp;(*destCTab)-&gt;ctTable[2],          (numColors) * sizeof(ColorSpec) );        /* copy all one entry down. */  (*destCTab)-&gt;ctTable[totalColors-1] = lastCSpec;      /* put last color back on front. */      AnimatePalette(myWindow, destCTab, 2, 2, numColors);    DisposeHandle ((Handle) destCTab);}/*  **  Display the dialog box in response to the 'About TubeTest' menu item*/void ShowAboutMeDialog(){  DialogPtr  theDialog;  short    itemHit;  theDialog = GetNewDialog(aboutMeDLOG, nil, (WindowPtr) -1);  ModalDialog(nil, &amp;itemHit);  DisposeDialog(theDialog);}/***  Execute menu command specified by mResult,**  the result of MenuSelect*/void DoCommand(long int mResult){  short  theItem,              /* menu item number from mResult low-order word */      theMenu;              /* menu number from mResult high-order word */  //Str255  name;                /* desk accessory name */  //int    temp;  //Boolean  dummy;  theItem = LoWord(mResult);          /* call Toolbox Utility routines to */  theMenu = HiWord(mResult);          /* set menu item number and menu */  switch (theMenu) {              /* switch on menu ID */    case appleID:      if (theItem == aboutMeCommand)        ShowAboutMeDialog();      else {          /*GetMenuItemText(myMenus[appleM], theItem, name);          temp = OpenDeskAcc(name);*/          //SetPort(myWindow);          SetPortWindowPort(myWindow);      }      break;    case fileID:      if (theItem == quitItem)        doneFlag = true;      else if (theItem == tubularItem) {          tubeCheck = !tubeCheck;          //CheckItem(myMenus[fileM], tubularItem, tubeCheck);          CheckMenuItem(myMenus[fileM], tubularItem, tubeCheck);      }      break;    case editID:      //dummy = SystemEdit(theItem - 1);  /* Pass the command on to the Desk Manager. */      break;  }  HiliteMenu(0);                /* Unhighlight menu title */                        /* (highlighted by MenuSelect) */}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/TubeTest/listing2.html%3Fid%3DDTS10000176-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/TubeTest/listing2.html%3Fid%3DDTS10000176-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/TubeTest/listing2.html%3Fid%3DDTS10000176-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>