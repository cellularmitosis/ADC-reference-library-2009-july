<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Getting a Resource (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING18></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-17.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-19.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-9.html"><B>Chapter 1 - Resource Manager</B></A> / <A HREF="MoreToolbox-16.html"><B>Using the Resource Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING18-0></A>
<H2><A NAME=MARKER-9-128></A>Getting a Resource</H2>
 <A NAME=MARKER-2-265></A>You usually use the <CODE>GetResource</CODE> function to read data from resources other than menus, windows, dialog boxes, and controls. You supply the resource type and resource ID of the desired resource, and the <CODE>GetResource</CODE> function searches the resource maps of open resource forks (according to the search path described in <A HREF=MoreToolbox-14.html#MARKER-9-104>"Search Path for Resources" beginning on page 1-8</A>) for that resource's entry. <A NAME=MARKER-21-258></A><P>
 If the <CODE>GetResource</CODE> function finds an entry for the requested resource in the resource map and the resource is in memory (that is, if the resource map in memory does not specify the resource's location with a handle whose value is <CODE>NIL</CODE>), <CODE>GetResource</CODE> returns a handle to the resource. If the resource is listed in the resource map but is not in memory (the resource map in memory specifies the resource's location with a handle whose value is <CODE>NIL</CODE>), <CODE>GetResource</CODE> reads the resource data from disk into memory, replaces the entry for the resource's location with a handle to the resource, and returns to your application a handle to the resource. For a resource that cannot be purged (that is, whose purgeable attribute is not set) you can use the returned handle to refer to the resource in other Resource Manager routines. (Handles to purgeable resources are discussed later in this section.) <A NAME=MARKER-2-70></A><P>
 For example, this code uses <CODE>GetResource</CODE> to get a handle to an <CODE>'snd '</CODE> resource with resource ID 128.<P>
<PRE>
VAR
   resourceType:  ResType;
   resourceID:    Integer;
   myHndl:        Handle;

resourceType := 'snd ';
resourceID := 128;
myHndl := GetResource(resourceType, resourceID);
</PRE>
 <A HREF=#MARKER-9-132>Figure 1-7</A> shows how <CODE>GetResource</CODE> returns a handle to a resource at your application's request.<P>
<B>Figure 1-7  <A NAME=MARKER-9-132></A>Getting a handle to a resource</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RM-L-05.jpg">
 Note that the handle returned to your application is a copy of the handle in the resource map. The resource map contains a handle to the resource data, and the Resource Manager returns a handle to the same block of memory for use by your application. If you use <CODE>GetResource</CODE> to get a handle to a resource that has the purgeable attribute set or if you intend to modify such a resource, keep the following discussion in mind.<P>
 If a resource is marked purgeable and the Memory Manager determines that it must purge a resource to make more room in your application's heap, it releases the memory occupied by the resource. In this case, the handle to the resource data is no longer valid, because the handle's master pointer is set to <CODE>NIL</CODE>. If your application attempts to use the handle previously returned by the Resource Manager, the handle no longer refers to the resource. <A HREF=#MARKER-9-133>Figure 1-8</A> shows a handle to a resource that is no longer valid, because the Memory Manager has purged the resource. To avoid this situation, you should call the <CODE>LoadResource</CODE> procedure to make sure that the resource is in memory before attempting to refer to it. <P>
<B>Figure 1-8  <A NAME=MARKER-9-133></A>A handle to a purgeable resource after the resource has been purged</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RM-L-06.jpg">
 If you need to make changes to a purgeable resource using routines that may cause the Memory Manager to purge the resource, you should make the resource temporarily not purgeable. You can use the Memory Manager procedures <CODE>HGetState</CODE>, <CODE>HNoPurge</CODE>, and <CODE>HSetState</CODE> for this purpose. After calling <CODE>HGetState</CODE> and <CODE>HNoPurge</CODE>, change the resource as necessary. To make the changes permanent, use the <CODE>ChangedResource</CODE> and <CODE>WriteResource</CODE> procedures; then call <CODE>HSetState</CODE> when you're finished. <A HREF=#MARKER-9-134>Listing 1-2</A> illustrates the use of these routines. <P>
<B>Listing 1-2  <A NAME=MARKER-9-134></A>Safely changing a resource that is purgeable <A NAME=MARKER-21-167></A></B><P>
<PRE>
VAR
   resourceType:  ResType;
   resourceID:    Integer;
   myHndl:        Handle;
   state:         SignedByte;

resourceType := 'snd ';
resourceID := 128;
{read the resource into memory}
myHndl := GetResource(resourceType, resourceID);
state := HGetState(myHndl); {get the state of the handle}
HNoPurge(myHndl);          {mark the handle as not purgeable}
{modify the resource as needed}
{...}
ChangedResource(myHndl);   {mark the resource as changed}
WriteResource(myHndl);     {write the resource to disk}
HSetState(myHndl, state);  {restore the handle's state} 
</PRE>
 Although you'll usually want to use <CODE>WriteResource</CODE> to write a resource's data to disk immediately (as shown in <A HREF=#MARKER-9-134>Listing 1-2</A>), you can instead use the <CODE>SetResPurge</CODE> procedure and specify <CODE>TRUE</CODE> in the <CODE>install</CODE> parameter. If you do this, the Memory Manager calls the Resource Manager before purging data specified by a handle. The Resource Manager determines whether the passed handle is that of a resource in your application's heap, and, if so, calls <CODE>WriteResource</CODE> to write the resource to disk if its changed attribute is set. You can call the <CODE>SetResPurge</CODE> procedure and specify <CODE>FALSE</CODE> in the <CODE>install</CODE> parameter to restore the normal state, so that the Memory Manager purges resource data in memory without checking with the Resource Manager. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-17.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-19.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
