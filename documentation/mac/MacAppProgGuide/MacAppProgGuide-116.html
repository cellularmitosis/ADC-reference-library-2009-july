<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Overview (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING116></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-115.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-117.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-115.html"><B>Chapter 22 - Working With the Clipboard</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING116-0></A>
<H1><A NAME=MARKER-9-20></A>Overview</H1>
 The Macintosh Operating System provides a number of mechanisms for exchanging data between applications, from static copy and paste operations using the Clipboard, to drag-and-drop data transfer, to dynamic data exchange using the Edition Manager.<B> </B>Supporting the Macintosh Clipboard is a vital component of any application because users expect this capability to be available.<P>
 <A NAME=MARKER-2-21></A>MacApp's Clipboard support is designed to help your application work with the Macintosh Clipboard. The following terms are used to describe Clipboard functions:<P>
<UL>
<LI><B><A NAME=MARKER-2-22></A><A NAME=MARKER-2-23></A><A NAME=MARKER-2-24></A>Desk scrap,</B> or <A NAME=MARKER-2-25></A><B>public scrap.</B> The place in the operating system where data is stored when it is cut (or copied) and pasted between applications. The desk scrap can be in memory or on disk.
<LI><B>Desk scrap data type,</B> or <B>scrap type.</B> A specific type of data that can be stored in the desk scrap. A desk scrap data type is specified by a sequence of four characters, similar to a resource type. The standard types are text (a series of ASCII characters identified by the scrap type <CODE>'TEXT'</CODE>) and picture (a QuickDraw picture identified by the scrap type <CODE>'PICT'</CODE>). Other types include <CODE>'styl'</CODE> for text style information and <CODE>'moov'</CODE> for QuickTime movie data.
<LI><B>Private scrap.</B> The location in which an application keeps its own scrap data.
<LI><B>Scrap data.</B> Data, stored in a public or private scrap, that can be moved between applications through Clipboard operations.<P>
</UL>
<A NAME=HEADING116-7></A>
<H2>Basic Clipboard Operations</H2>
 Clipboard support requires a combination of the following activities:<P>
<UL>
<LI>storing and retrieving standard data types
<LI>storing and retrieving an application's private data types
<LI>converting between standard and private data types
<LI>providing a view to display data<P>
</UL>
<A NAME=HEADING116-13></A>
<H3><A NAME=MARKER-2-26></A>Using the Desk Scrap</H3>
 An application supplies data for the Clipboard by putting it on the desk scrap, along with a data type to identify it. Data is put on the desk scrap with the Toolbox call <CODE>PutScrap</CODE>. An application can put more than one data type on the desk scrap. For example, it may put data in a private format, as well as in the public formats <CODE>'TEXT'</CODE> and <CODE>'PICT'</CODE>. There should not be more than one item on the desk scrap for each data type, so it is common to call the Toolbox routine <CODE>ZeroScrap</CODE> to clear the desk scrap, then make one or more calls to <CODE>PutScrap</CODE> to add data of different types.<P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-9-27></A>An application's private desk scrap data types can be registered with Apple Computer so that they will not be used by other applications. You can register types at the World Wide Web location http://dev.info.apple.com/cftype/main.html.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 When pasting data from the desk scrap, an application looks first for its most preferred data type, but it may use other data types if the preferred type is not available. To find out whether data of a desired type is available, an application uses the Toolbox call <CODE>GetScrap</CODE>, which is described in the next section.<P>
<A NAME=HEADING116-17></A>
<H3><A NAME=MARKER-9-28></A>Using the Toolbox GetScrap Routine</H3>
 You use the <CODE>GetScrap</CODE> routine from the Macintosh Scrap Manager to copy data from the Clipboard. The <CODE>GetScrap</CODE> routine is declared as follows:<P>
<PRE>
long GetScrap (Handle hDest, ResType theType, long&amp; offset);
</PRE>
 Depending on how you set the hDest parameter, you can use the <CODE>GetScrap</CODE> routine for one of two purposes: to determine if the scrap contains data of a specified type or to retrieve desk scrap data of the specified type in the passed handle.<P>
<UL>
<LI>If you want to know only if the desk scrap contains data of a specified type, you set the <CODE>hDest</CODE> field to <CODE>NULL</CODE>. If data is present, <CODE>GetScrap</CODE> returns the length of the data and sets the offset parameter to the location of the data in the desk scrap. Otherwise, it returns a negative error code.
<LI>If you want to retrieve desk scrap data, you pass an existing destination handle along with the data type. <CODE>GetScrap</CODE> behaves as before, except that if the data is present, it stores it in the passed handle.<P>
</UL>
 You normally use <CODE>GetScrap</CODE> by calling it once to determine if the appropriate data type is in the scrap. If it is, you then allocate a handle for the data and call <CODE>GetScrap</CODE> again to copy the data into that handle. Code to read Clipboard data often looks something like the following:<P>
<PRE>
long  datasize, offset, err;

// First see if your scrap type is present.
datasize = GetScrap(NULL, kMyPrivateScrapType, &amp;offset);
if  (datasize &gt; 0)
{
   // Now copy the scrap data into an existing handle field.
   // NOTE: Some apps set the handle size to the returned data size
   //     value before calling GetScrap the second time.
   err=  GetScrap(fMyDataHandle, kMyPrivateScrapType, &amp;offset);
   // If we can't read data, cause a failure and display the error.
   if  (err &lt; 0)
      FailOSErr((short) err);
}
</PRE>
 In this example, the fMyDataHandle field is a data handle that was created earlier. For another example of reading desk scrap data, see <A HREF=MacAppProgGuide-117.html#MARKER-9-66>"Recipe--Creating a Clipboard View for Your Private Data Type," beginning on page 508</A>.<P>
 Within your application, you can get Clipboard data by calling the global Clipboard manager's <CODE>GetDataToPaste</CODE> method. The manager is described in <A HREF=#MARKER-9-33>"The Clipboard Manager," beginning on page 504</A>.<P>
<A NAME=HEADING116-27></A>
<H3><A NAME=MARKER-2-29></A>Using a Private Scrap</H3>
 Your application can set up a private scrap for storing data that is cut and pasted internally. If you cut and paste only the standard data types, it's probably easier to use the desk scrap, but if you need to work with large amounts of data, a private scrap may result in faster Clipboard operations within your application.<P>
 To use a private scrap, your application must be able to convert data from its private scrap format to a public desk scrap format when it is switched out, and back from the public desk scrap format to its private format when it is switched in. <A HREF=#MARKER-9-30>Figure 22-1</A> shows an application copying its private scrap to the Clipboard when a user quits the application.<P>
<B>Figure 22-1  <A NAME=MARKER-9-30></A>An application copying its private scrap to the Clipboard</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-011.gif"><P>
<A NAME=HEADING116-32></A>
<H2><A NAME=MARKER-2-31></A>MacApp's Clipboard Support</H2>
 MacApp's Clipboard support is designed to help your application manage a private scrap. It provides facilities to<P>
<UL>
<LI>support commands that cut, copy, clear, and paste data
<LI>manage a Clipboard view to display the current Clipboard data
<LI>interact with the desk scrap to get data when your application is switched in or put data when your application is switched out
<LI>work with the standard desk scrap data types <CODE>'TEXT'</CODE> and <CODE>'PICT'</CODE><P>
</UL>
 When the user cuts or copies data in your application, you create a view to display and handle the data. The display view usually has the same view type as the one that originally displayed the data. This makes it convenient for Clipboard data to be stored in your application's private format, which is easy to use within the application. However, when the user quits or switches to another program, a well-behaved application puts information on the Clipboard in one or both of the standard data types (text and picture), for other applications to use, as well as in its private format. <P>
 MacApp's default Clipboard support provides the following features:<P>
<UL>
<LI>an Edit menu with choices for Cut, Copy, Paste, Clear, and Show Clipboard
<LI>a default Clipboard view, of type <CODE>TDeskScrapView</CODE>, that is shown when the user chooses Show Clipboard (The default Clipboard view can display the two standard desk scrap data types, text and picture.)<P>
</UL>
 Your application can take advantage of MacApp's default Clipboard support by adding the following line to the file <I>YourApp<CODE>.r</CODE></I>:<P>
<PRE>
include &quot;Defaults.rsrc&quot; 'CMNU' (mEdit);
</PRE>
 This line includes the <CODE>'CMNU'</CODE> resource for the Edit menu, which is defined in the file <CODE>Defaults.r</CODE>.<P>
<DL>
<DT><B>Note</B>
<DD>You don't have to create a view to display <CODE>'PICT'</CODE> or <CODE>'TEXT'</CODE> data from the desk scrap. When your application starts, MacApp automatically creates an object of type <CODE>TDeskScrapView</CODE> to display these data types.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING116-46></A>
<H2><A NAME=MARKER-2-32></A>More Sophisticated Clipboard Support</H2>
 With a little extra work, your application can support its own private desk scrap data types and provide more sophisticated Clipboard support. MacApp provides several facilities to help you do so.<P>
<A NAME=HEADING116-48></A>
<H3><A NAME=MARKER-9-33></A>The Clipboard Manager</H3>
 The <A NAME=MARKER-2-34></A><CODE>TClipboardMgr</CODE> class is a subclass of <CODE>TBehavior</CODE> that manages the application's interaction with the Scrap Manager and maintains a view for the current Clipboard. MacApp creates a single <CODE>TClipboardMgr</CODE> object during initialization of your application and assigns it to the global variable <CODE>gClipboardMgr</CODE>. The Clipboard manager works together with your view, application, and document classes to support Clipboard activity in your application. The classes and methods used to provide Clipboard support are shown in <A HREF=#MARKER-9-35>Figure 22-2</A>.<P>
<B>Figure 22-2  <A NAME=MARKER-9-35></A>Classes and methods used to provide Clipboard support</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-079.gif"><P>
 MacApp calls methods of <CODE>gClipboardMgr</CODE> at the appropriate time; your application also calls methods of <CODE>gClipboardMgr</CODE> during Clipboard operations. The following methods of <CODE>TClipboardMgr</CODE> are the most frequently used:<P>
<DL>
<DT><CODE>AboutToLoseControl</CODE>
<DD> MacApp calls the <A NAME=MARKER-2-37></A><CODE>AboutToLoseControl</CODE> method when your application is switched out. It gives the current Clipboard view a chance to write its data, converting from a private to a standard data type, if necessary.
<DT><B><CODE>CanPaste</CODE></B>
<DD> <B>Your view class calls <A NAME=MARKER-2-39></A><CODE>CanPaste to let the Clipboard manager know what kind of data it can paste. If that data is available, the Clipboard manager enables the Paste menu command.</CODE></B>
<DT><CODE>GetDataToPaste<B></B></CODE>
<DD> The <A NAME=MARKER-2-41></A><CODE>GetDataToPaste</CODE> method asks the current Clipboard view to return data of the specified type by calling the view's <CODE>GivePasteData</CODE> method. You override <A NAME=MARKER-2-42></A><CODE>GivePasteData</CODE> in the view class you use to provide a Clipboard view. Your Paste command object might call <CODE>GetDataToPaste</CODE> to get data to paste.
<DT><CODE><A NAME=MARKER-10-7></A>PutDeskScrapData<B></B></CODE>
<DD> You pass a data handle and a data type to the <CODE><A NAME=MARKER-2-44></A>PutDeskScrapData</CODE> method; it writes the handle to the desk scrap. 
<DT><CODE>RegainControl<B></B></CODE>
<DD> MacApp calls <A NAME=MARKER-2-46></A><CODE>RegainControl</CODE> when your application is switched in. It calls <CODE>CheckDeskScrap</CODE> to see if there is any new data on the desk scrap. If so, your application gets a chance to make a view to read and display the new data.
</DL>
<A NAME=HEADING116-58></A>
<H3>Clipboard Support in TCommand</H3>
 The <CODE>TCommand</CODE> class supplies several fields and methods that are used in working with the Clipboard:<P>
<DL>
<DT><CODE>fClipboardView<B></B></CODE>
<DD> The <A NAME=MARKER-2-48></A><CODE>fClipboardView</CODE> field identifies the view for displaying Clipboard data when a command is in the do or redo phase.
<DT><A NAME=MARKER-10-5></A><CODE>fUndoClipboardView</CODE>
<DD> The <A NAME=MARKER-2-50></A><CODE>fUndoClipboardView</CODE> field identifies the view for displaying Clipboard data when the command is in the undo phase.
<DT><CODE>AbandonClipboardView</CODE>
<DD> The <A NAME=MARKER-2-52></A><CODE>AbandonClipboardView</CODE> method frees the view referenced by <CODE>fClipboardView</CODE>, when appropriate.
<DT><CODE>AbandonUndoClipboardView</CODE>
<DD> The <A NAME=MARKER-2-54></A><CODE>AbandonUndoClipboardView</CODE> method frees the view referenced by <CODE>fUndoClipboardView</CODE>, when appropriate.
<DT><CODE>ClaimClipboard<B></B></CODE>
<DD> The <A NAME=MARKER-2-56></A><CODE>ClaimClipboard</CODE> method installs the passed view as the <CODE>fClipboardView</CODE> and saves the previous value of <CODE>fClipboardView</CODE> in <CODE>fUndoClipboardView</CODE>.
<DT><A NAME=MARKER-9-77></A><CODE>UndoRedoClipboard</CODE>
<DD> The <A NAME=MARKER-2-58></A><CODE>UndoRedoClipboard</CODE> method installs the appropriate Clipboard view, depending on whether the current request is to undo or redo the command.
</DL>
 The recipes that follow describe how your application works with MacApp to provide custom Clipboard support.<A NAME=MARKER-2-59></A><A NAME=MARKER-2-60></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-115.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-117.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
