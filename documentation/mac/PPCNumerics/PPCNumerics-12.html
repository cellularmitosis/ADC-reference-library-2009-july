<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Using IEEE Arithmetic(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<A NAME="HEADING12"></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-11.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-13.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<FONT SIZE="-1"><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-9.html"><B>Part 1 - The PowerPC Numerics Environment</B></A><BR><DD><A HREF="PPCNumerics-10.html"><B>Chapter 1 - IEEE Standard Arithmetic</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME="HEADING12-0"></A>
<H1>Using IEEE Arithmetic</H1>
 This section provides some example computations and describes how using IEEE arithmetic in the PowerPC Numerics environment makes programming these computations easier.<P>
<A NAME="HEADING12-2"></A>
<H2>Evaluating Continued Fractions</H2>
 Consider a typical continued fraction 
<MATH>
cf(x)
</MATH>

.<P>
 
<MATH>
cf(x) = 4+-3 OVER x+-2+-1 OVER x+-7+10 OVER x+-2+-2 OVER x+-3
</MATH>

<P>
 An algebraically equivalent expression is 
<MATH>
rf(x)
</MATH>

:<P>
 
<MATH>
rf(x) = 622+-x(751+-x(324+-x(59+-4x))) OVER 112+-x(151+-x(72+-x(14+-x)))
</MATH>

<P>
 Both expressions represent the same rational function, one whose graph is smooth and unexceptional, as shown in <A HREF="#MARKER-9-33">Figure 1-2</A>.<P>
<B>Figure 1-2  <A NAME="MARKER-9-33"></A>Graph of continued fraction functions <DFN>cf(<I>x)</I></DFN> and <DFN>rf(<I>x)</I></DFN></B><P>
<IMG ALIGN="BOTTOM" SRC="graphics/PPCN-L-16.jpg"><P>
 Although the two functions 
<MATH>
rf(x)
</MATH>

 and 
<MATH>
cf(x)
</MATH>

 are equal, they are not computationally equivalent. For instance, consider 
<MATH>
rf(x)
</MATH>

 at the following values of <I>x</I>:<P>
<DL>
<DT>
<MATH>
x = 1
</MATH>


<DD> 
<MATH>
rf(1) = 7
</MATH>


<DT>
<MATH>
x = 2
</MATH>


<DD> 
<MATH>
rf(2) = 4
</MATH>


<DT>
<MATH>
x = 3
</MATH>


<DD> 
<MATH>
rf(3) = 8/5
</MATH>


<DT>
<MATH>
x = 4
</MATH>


<DD>
<MATH>
rf(4) = 5/2
</MATH>


</DL>
 Whereas 
<MATH>
rf(x)
</MATH>

 is perfectly well behaved, those values of <I>x</I> lead to division by zero when computing 
<MATH>
cf(x)
</MATH>

 and cause many computers to stop. In IEEE standard arithmetic, division by zero produces an Infinity. Therefore, PowerPC Numerics has no difficulty in computing 
<MATH>
cf(x)
</MATH>

 for those values.<P>
 On the other hand, simply computing 
<MATH>
rf(x)
</MATH>

 instead of 
<MATH>
cf(x)
</MATH>

 can also cause problems. If the absolute value of <I>x</I> is so big that 
<MATH>
x<SUP>4</SUP>
</MATH>

overflows the chosen data format, then 
<MATH>
cf(x)
</MATH>

 approaches 
<MATH>
cf( <IMG BORDER="NONE" SRC="graphics/infinity.gif"> ) = 4
</MATH>

 but computing 
<MATH>
rf(x)
</MATH>

 encounters 
<MATH>
(overflow)/(underflow)
</MATH>

, which yields something else. PowerPC Numerics returns NaN for such cases; some other machines return 
<MATH>
(maximumvalue)/(maximumvalue) = 1
</MATH>

. Also, at arguments <I>x</I> between 1.6 and 2.4, the formula 
<MATH>
rf(x)
</MATH>

 suffers from roundoff error much more than 
<MATH>
cf(x)
</MATH>

 does. For those reasons, computing 
<MATH>
cf(x)
</MATH>

 is preferable to computing 
<MATH>
rf(x)
</MATH>

 if division by zero works the way it does in PowerPC Numerics, that is, if it produces Infinity instead of stopping computation.<P>
 In general, division by zero is an exceptional event not merely because it is rare but because different applications require different consequences. If you are not satisfied with the consequences supplied by the default PowerPC Numerics environment, you can choose other consequences by making the program test for NaNs and Infinities (or for the flags that signal their creation).<P>
 Rather than sprinkle tests throughout the program in an attempt to keep exceptions from occurring, you might prefer to put one or two tests near the end of the code to detect the (rare) occurrence of an exception and modify the results appropriately. That is more economical than testing every divisor for zero (since zero divisors are rare).<P>
<A NAME="HEADING12-19"></A>
<H2>Computing the Area of a Triangle</H2>
 Here is a familiar and straightforward task that fails when subtraction is aberrant: Compute the area 
<MATH>
A(x,y,z)
</MATH>

 of a triangle given the lengths 
<MATH>
x,y,z
</MATH>

 of its sides. The formula given here performs this calculation almost as accurately as its individual floating-point operations are performed by the computer it runs on, provided the computer does not drop digits prematurely during subtraction. The formula works correctly, and provably so, on a wide range of machines, including all implementations of PowerPC Numerics.<P>
 The classical formula, attributed to Heron of Alexandria, is<P>
 
<MATH>
A(x,y,z) = SQRTs(s+-x)(s+-y)(s+-z)
</MATH>

<P>
 where 
<MATH>
s = (x+y+z)/2
</MATH>

.<P>
 For needle-shaped triangles, that formula gives incorrect results on computers <I>even when every arithmetic operation is correctly rounded</I>. For example, <A HREF="#MARKER-9-2">Table 1-2</A> shows an extreme case with results rounded to five decimal digits. With the values shown, rounded <BR>
<MATH>
(x+(y+z))/2
</MATH>

 must give either 100.01 or 100.02. Substituting those values for <I>s</I> in Heron's formula yields either 0.0 or 1.5813 instead of the correct value 1.000025.<P>
 Evidently, Heron's formula would be a very bad way for computers to calculate ratios of areas of nearly congruent needle-shaped triangles.
<TABLE BORDER="0" CELLPADDING="3">
<CAPTION><A NAME="MARKER-9-2"></A><B>Table 1-2 Area using Heron's formula</B></CAPTION>
<TH>&nbsp;<TH>  Correct<TH>Rounding downward<TH>Rounding<BR>upward<TH>&nbsp;<TR>
<TD><I>x</I><TD>100.01<TD>100.01<TD>100.01<TD>&nbsp;<TR>
<TD><I>y</I><TD>99.995<TD>99.995<TD>99.995<TD>&nbsp;<TR>
<TD><I>z</I><TD>0.025<TD>0.025<TD>0.025<TD>&nbsp;<TR>
<TD>(<I>x</I>+(<I>y</I>+<I>z</I>))/2<TD>100.015<TD>100.01<TD>100.02<TD>&nbsp;<TR>
<TD><I>A</I><TD>1.000025<TD>0.0000<TD>1.5813<TD>&nbsp;</TABLE>
<P>
 A good procedure, numerically stable on machines that do not truncate prematurely during subtraction (such as machines that use IEEE arithmetic), is the following:<P>
<OL>
<LI>Sort 
<MATH>
x,y,z
</MATH>

 so that 
<MATH>
x <IMG BORDER="NONE" SRC="graphics/greaterthan.gif"> y
</MATH>

.
<LI>Test for 
<MATH>
z <IMG BORDER="NONE" SRC="graphics/greaterthan.gif"> x+-y
</MATH>

 to see whether the triangle exists.
<LI>Compute <I>A</I> by the formula<EM></EM><P>
</OL>
 
<MATH>
<I>A</I> = SQRT((x+(y+z))(z+-(x+-y))(x+(y+-z)))/4
</MATH>

<P>
<DL>
<DT><B>WARNING</B>
<DD>This formula works correctly only if you do not remove any of the parentheses.<EM></EM>  <IMG ALIGN="BOTTOM" SRC="graphics/triangle.gif">
</DL>
 The success of the formula depends upon the following easily proved theorem:<P>
 THEOREM  <I>If p and q are represented exactly in the same conventional floating-point format, and if 
<MATH>
1/2 <IMG BORDER="NONE" SRC="graphics/lessthan.gif"> p/q <IMG BORDER="NONE" SRC="graphics/lessthan.gif"> 2
</MATH>

, then 
<MATH>
p+-q
</MATH>

 too is representable exactly in the same format (unless 
<MATH>
p+-q
</MATH>

 suffers underflow, something that cannot happen in IEEE arithmetic).</I><P>
 The theorem merely confirms that subtraction is exact when massive cancellation occurs. That is why each factor inside the square root expression is computed correctly to within a unit or two in its last digit kept, and <I>A</I> is not much worse, on computers that subtract the way PowerPC Numerics does. On machines that flush tiny results to zero, this formula for <I>A</I> fails because 
<MATH>
(p+-q)
</MATH>

can underflow.<P>

</BLOCKQUOTE>
<HR>
<CENTER>
<A HREF="PPCNumerics-11.html"><IMG ALIGN="BOTTOM" SRC="prev.gif" BORDER="none" HSPACE="20" ALT="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN="BOTTOM" SRC="content.gif" BORDER="none" HSPACE="20" ALT="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN="BOTTOM" SRC="index.gif" BORDER="none" HSPACE="20" ALT="Book Index"></A> <A HREF="PPCNumerics-13.html"><IMG ALIGN="BOTTOM" SRC="next.gif" BORDER="none" HSPACE="20" ALT="Next"></A> </CENTER><P>
<CENTER><FONT SIZE="-1"><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><BR>13 JUL 1996</CENTER></FONT><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
