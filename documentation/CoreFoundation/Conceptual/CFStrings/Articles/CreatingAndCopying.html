<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Strings Programming Guide for Core Foundation: Creating and Copying Strings</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating and Copying Strings"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001183" title="Creating and Copying Strings"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000421" target="_top">Core Foundation</a> &gt; <a href="../../../DataManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000421-TP30000445" target="_top">Data Management</a> &gt; <a href="../index.html" target="_top">Strings Programming Guide for Core Foundation</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="StringStorage.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="AccessingContents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20001183-CJBEHAAG" title="Creating and Copying Strings"></a><hr /><H1>Creating and Copying Strings</H1><p>String objects give you a variety of ways to create CFString objects—from constant strings, from buffers, from formatted strings, and by using existing CFString objects. The following sections describe each of these techniques.</p><p>Some functions that return references to CFString objects are described elsewhere. The <code>CFStringCreateWithBytes</code> function is described in <span class="content_text"><a href="Converting.html#//apple_ref/doc/uid/20001187-CJBEHAAG">“Converting Between String Encodings.”</a></span> The section <span class="content_text"><a href="ExternalReps.html#//apple_ref/doc/uid/20001188-CJBEHAAG">“Handling External Representations of Strings”</a></span> describes the <code>CFStringCreateFromExternalRepresentation</code> function.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-100988-TPXREF110">Creating CFString Objects From Constant Strings</a>
				
			<br/>
			
        
			
			
				<a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101074-TPXREF111">Creating CFString Objects From String Buffers</a>
				
			<br/>
			
        
			
			
				<a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101309-CHDDBDFF">Creating String Objects From Formatted Strings</a>
				
			<br/>
			
        
			
			
				<a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101594-CHDDFEJH">Creating Mutable String Objects</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001183-100988" title="Creating CFString Objects From Constant Strings"></a><a name="//apple_ref/doc/uid/20001183-100988-TPXREF110" title="Creating CFString Objects From Constant Strings"></a><h2>Creating CFString Objects From Constant Strings</h2><p>The easiest way to create immutable CFString objects is to use the <code>CFSTR</code> macro. The argument of the macro must be a constant compile-time string—text enclosed in quotation marks. <code>CFSTR</code> returns a reference to a CFString object.</p><p>Here’s an example:</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef hello = CFSTR("Hello, world.");<span></span></pre></td></tr></table></div><p>Non-ASCII characters (that is, character codes greater than 127) are not supported. If you use them, the result is undefined. Even if using them works for you in testing, it might not work if the user selects a different language preference.</p><p>The returned CFString has the following semantics:</p><ul class="ul"><li class="li"><p>Because <code>CFSTR</code> is not a Create or Copy function, you are not responsible for releasing the string when you no longer need it.</p></li><li class="li"><p>The string is not released by CFString. In other words, CFString guarantees its validity until the program terminates.</p></li><li class="li"><p>The string can be retained and released in a balanced fashion, like any other CFString.</p></li></ul><p>If there are two or more exact instances of a constant string in an executable, in some cases only one might be stored. A common use of the <code>CFSTR</code> macro is in the creation of formatted strings (see <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101309">“Creating String Objects From Formatted Strings”</a></span> for more information).</p><a name="//apple_ref/doc/uid/20001183-101074" title="Creating CFString Objects From String Buffers"></a><a name="//apple_ref/doc/uid/20001183-101074-TPXREF111" title="Creating CFString Objects From String Buffers"></a><h2>Creating CFString Objects From String Buffers</h2><p>By far the most common technique for creating a CFString object is to call functions that take C or Pascal character buffers (or string pointers) as “source” for the object. These functions are the counterparts of functions that convert CFString objects to C or Pascal strings; see <span class="content_text"><a href="AccessingContents.html#//apple_ref/doc/uid/20001184-CJBEHAAG">“Accessing the Contents of String Objects”</a></span> for more on these functions.</p><p>These functions come in two varieties. One set of functions copies the buffer into the internal storage of the created CFString object. Once you create the object you are free to dispose of the buffer. <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101104-CHDBBFCI">Listing 1</a></span> shows the creation of a CFString object from a Pascal string buffer with the <code>CFStringCreateWithPascalString</code> function.</p><a name="//apple_ref/doc/uid/20001183-101104-CHDBBFCI" title="Listing 1Creating a CFString object from a Pascal string buffer"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101104" title="Listing 1Creating a CFString object from a Pascal string buffer"></a><strong>Listing 1&nbsp;&nbsp;</strong>Creating a CFString object from a Pascal string buffer</p><div class="codesample"><table><tr><td scope="row"><pre>const UInt8 somePascalBytes[] = {5, ‘H’, ‘e’, ‘l’, ‘l’, ‘o’};<span></span></pre></td></tr><tr><td scope="row"><pre>CFStringRef str;<span></span></pre></td></tr><tr><td scope="row"><pre>str = CFStringCreateWithPascalString(NULL, somePascalBytes,<span></span></pre></td></tr><tr><td scope="row"><pre>    kCFStringEncodingMacRoman);<span></span></pre></td></tr></table></div><p>In this example, the <code>NULL</code> parameter specifies that the default CFAllocator object should be used to allocate memory for the backing store; the last parameter specifies the encoding of the characters in the buffer. Instead of initializing the <code>somePascalBytes</code> array as done in the example above, you can just insert the <code>\p</code> control character before the string to designate it a Pascal string (<code>"\pHello"</code>).</p><p>Related functions create CFString objects from C string buffers (<code>CFStringCreateWithCString</code>) and from Unicode string buffers (<code>CFStringCreateWithCharacters</code>). The latter function takes an extra parameter for character count but does not include the encoding parameter.</p><p>A parallel set of functions have corresponding names that end with <code>NoCopy</code>. These functions also create CFString objects from a user-supplied string buffer but they do not always copy the buffer to the object’s internal storage. They try to but are not guaranteed to take the provided pointer as-is, using the buffer as the backing store without copying the data. Obviously you must ensure that you do not free the buffer while the CFString exists. The character data should never be on the stack or be data with a lifetime you cannot guarantee.</p><p>In practice, these <code>NoCopy</code> functions are useful in a limited number of circumstances:</p><ul class="ul"><li class="li"><p>You have compile-time constant data such as a C string (“Hello”) or a Pascal string (“\pYes”). The <code>NoCopy</code> functions offer an efficient way to make CFString objects from this data and, if you specify <code><a href="../../../Reference/CFAllocatorRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFAllocatorNull" target="_top">kCFAllocatorNull</a></code> as the last parameter (see below), when the CFString ceases to exist the buffer is not automatically deallocated. (Often you can use the <code>CFSTR</code> macro for the same purpose.)</p></li><li class="li"><p>You allocate some memory for some string data and you want to put a CFString object in it but otherwise you don’t need the original memory. Of course, you can create a CFString object with one of the non-<code>NoCopy</code> functions (which copies the data) and then free the buffer. But the <code>NoCopy</code> functions allow you to transfer ownership of the memory to a CFString object, saving you the need to free it yourself.</p></li></ul><p>The <code>NoCopy</code> functions include an extra parameter (<em>contentsDeallocator</em>) for passing a reference to a CFAllocator object that is used for deallocating the buffer when it is no longer needed. If the default CFAllocator object is sufficient for this purpose, you can pass <code>NULL</code>. If you do not want the CFString object to deallocate the buffer, pass <code><a href="../../../Reference/CFAllocatorRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFAllocatorNull" target="_top">kCFAllocatorNull</a></code>. </p><p><span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101233-CHDCJEHA">Listing 2</a></span> shows the creation of a CFString object with the <code>CFStringCreateWithCStringNoCopy</code> function:</p><a name="//apple_ref/doc/uid/20001183-101233-CHDCJEHA" title="Listing 2Creating a CFString object with a NoCopy function"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101233" title="Listing 2Creating a CFString object with a NoCopy function"></a><strong>Listing 2&nbsp;&nbsp;</strong>Creating a CFString object with a NoCopy function</p><div class="codesample"><table><tr><td scope="row"><pre>const char *bytes;<span></span></pre></td></tr><tr><td scope="row"><pre>CFStringRef str;<span></span></pre></td></tr><tr><td scope="row"><pre>bytes = CFAllocatorAllocate(CFAllocatorGetDefault(), 6, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>strcpy(bytes, "Hello");<span></span></pre></td></tr><tr><td scope="row"><pre>str = CFStringCreateWithCStringNoCopy(NULL, bytes,<span></span></pre></td></tr><tr><td scope="row"><pre>    kCFStringEncodingMacRoman, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>/* do something with str here...*/<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(str); /* default allocator also frees bytes */<span></span></pre></td></tr></table></div><div class="importantbox"><a name="//apple_ref/doc/uid/20001183-DontLinkElementID_14" title="Important:"></a><p><strong>Important:</strong>&nbsp;The CFString objects created by the <code>NoCopy</code> function do not necessarily use the buffer you supply. In some cases the object might free the buffer and use something else; for instance, it may decide to use Unicode encoding internally. This behavior may change from release to release.</p><p></p></div><p>You can also create mutable CFString objects with source buffers that you control entirely; see <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101684">“Mutable Strings With Client-Owned Buffers”</a></span> for more on this matter.</p><a name="//apple_ref/doc/uid/20001183-101309" title="Creating String Objects From Formatted Strings"></a><a name="//apple_ref/doc/uid/20001183-101309-CHDDBDFF" title="Creating String Objects From Formatted Strings"></a><h2>Creating String Objects From Formatted Strings</h2><p>String objects includes functions that create CFString objects from formatted strings—strings incorporating <code>printf</code>-style specifiers for substituting variable values into the string, after converting them (if necessary) to character data. String format specifiers are defined in <span class="content_text"><a href="../formatSpecifiers.html#//apple_ref/doc/uid/TP40004265-SW1" target="_self">String Format Specifiers</a></span>. Formatted strings are useful when it is necessary to display information that may have changeable elements. For example, you might need to use these functions when you put up a dialog box to show the progress of an operation, such as “Copying file <em>x</em> of <em>y</em>.”</p><p>The <code>CFStringCreateWithFormat</code> function creates a CFString object from a simple formatted string, as shown in <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101347-CHDBCAEF">Listing 3</a></span>.</p><a name="//apple_ref/doc/uid/20001183-101347-CHDBCAEF" title="Listing 3Creating a CFString object from a formatted string"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101347" title="Listing 3Creating a CFString object from a formatted string"></a><strong>Listing 3&nbsp;&nbsp;</strong>Creating a CFString object from a formatted string</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef PrintGross(CFStringRef employeeName, UInt8 hours, float wage) {<span></span></pre></td></tr><tr><td scope="row"><pre>    return CFStringCreateWithFormat(NULL, NULL, CFSTR("Employee %@<span></span></pre></td></tr><tr><td scope="row"><pre>    earned $%.2f this week."), employeeName, hours * wage);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The first parameter, as usual, specifies the allocator object to use (<code>NULL</code> means use the default CFAllocator object). The second parameter is for locale-dependent format options, such as thousand and decimal separators; it is currently not used. The remaining parameters are for the format string and the variable values.</p><p>As mentioned earlier, the format string has <code>printf</code>-style specifiers embedded in it (for example, <code>"%d %s %2.2f"</code>). Core Foundation introduces a couple of extensions to this convention. One is the <code>%@</code> specifier (shown in <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101347-CHDBCAEF">Listing 3</a></span>) which indicates any Core Foundation object. Another new specifier indicates argument order. This specifier takes the form <em>n</em><code>$</code> where <em>n</em> is the order-number of the argument following the string. This argument-order feature is useful when you want to localize whole sentences or even paragraphs to other languages without worrying about the order of arguments, which might vary from one language to another. </p><p>For example, the function above would result in a string such as “John Doe earned $1012.32 this week.” But in another language the grammatically proper way of expressing the same sentence might be (roughly translated) “$1012.32 was earned by John Doe this week.” You wouldn’t have to call <code>CFStringCreateWithFormat</code> again with the arguments in a different order. Instead, you would have a function call that looked like this:</p><div class="codesample"><table><tr><td scope="row"><pre>return CFStringCreateWithFormat(NULL, NULL, CFSTR("$%2$.2f was earned by<span></span></pre></td></tr><tr><td scope="row"><pre>    employee %1$@."), employeeName, hours * wage);<span></span></pre></td></tr></table></div><p>Of course, the string itself would not be hard-coded, but would be loaded from a file (for instance, an XML property list or an OpenStep ASCII property list) that contains localized strings and their translations.</p><p>Another CFString function, <code>CFStringCreateWithFormatAndArguments</code>, takes a variable argument list (<code>vararg</code>) as well as a format string. This function allows the formatting of <code>vararg</code>s passed into your function. <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101475-CHDBBFFI">Listing 4</a></span> shows how it might be used:</p><a name="//apple_ref/doc/uid/20001183-101475-CHDBBFFI" title="Listing 4Creating a CFString from a variable argument list"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101475" title="Listing 4Creating a CFString from a variable argument list"></a><strong>Listing 4&nbsp;&nbsp;</strong>Creating a CFString from a variable argument list</p><div class="codesample"><table><tr><td scope="row"><pre>void show(CFStringRef formatString, ...) {<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef resultString;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDataRef data;<span></span></pre></td></tr><tr><td scope="row"><pre>    va_list argList;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    va_start(argList, formatString);<span></span></pre></td></tr><tr><td scope="row"><pre>    resultString = CFStringCreateWithFormatAndArguments(NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>        formatString, argList);<span></span></pre></td></tr><tr><td scope="row"><pre>    va_end(argList);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    data = CFStringCreateExternalRepresentation(NULL, resultString,<span></span></pre></td></tr><tr><td scope="row"><pre>        kCFStringEncodingMacRoman, '?');<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (data != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        printf ("%.*s\n\n", (int)CFDataGetLength(data),<span></span></pre></td></tr><tr><td scope="row"><pre>            CFDataGetBytePtr(data));<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease(data);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(resultString);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/20001183-101594" title="Creating Mutable String Objects"></a><a name="//apple_ref/doc/uid/20001183-101594-CHDDFEJH" title="Creating Mutable String Objects"></a><h2>Creating Mutable String Objects</h2><p>String objects includes only a handful of functions for creating mutable CFString objects. The reason for this much smaller set is obvious. Because these are mutable objects, you can modify them after you create them with the functions described in <span class="content_text"><a href="MutableStrings.html#//apple_ref/doc/uid/20001186-CJBEHAAG">“Manipulating Mutable String Objects.”</a></span></p><p>There are two basic functions for creating mutable CFString objects. The <code>CFStringCreateMutable</code> function creates an “empty” object; the <code>CFStringCreateMutableCopy</code> makes a mutable copy of an immutable CFString object. <span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101628-CHDCCFBB">Listing 5</a></span> illustrates the latter function and shows a character being appended to the created object:</p><a name="//apple_ref/doc/uid/20001183-101628-CHDCCFBB" title="Listing 5Creating a mutable copy of a CFString object"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101628" title="Listing 5Creating a mutable copy of a CFString object"></a><strong>Listing 5&nbsp;&nbsp;</strong>Creating a mutable copy of a CFString object</p><div class="codesample"><table><tr><td scope="row"><pre>const UniChar u[] = {'5', '+', '*', ‘d’, 'x', '4', 'Q', '?'};<span></span></pre></td></tr><tr><td scope="row"><pre>CFMutableStringRef str;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>str = CFStringCreateMutableCopy(alloc, 0, CFSTR("abc"));<span></span></pre></td></tr><tr><td scope="row"><pre>CFStringAppendCharacters(str, &amp;u[3], 1);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(str);<span></span></pre></td></tr></table></div><p>The second parameter of both functions is a <code>CFIndex</code> value named <em>maxLength</em>. This value specifies the maximum numbers of characters in the string and allows the created object to optimize its storage and catch errors if too many characters are inserted. If 0 is specified for this parameter (as above), the string can grow to any size.</p><a name="//apple_ref/doc/uid/20001183-101684" title="Mutable Strings With Client-Owned Buffers"></a><a name="//apple_ref/doc/uid/20001183-101684-CHDDEJAH" title="Mutable Strings With Client-Owned Buffers"></a><h3>Mutable Strings With Client-Owned Buffers</h3><p>When you create most Core Foundation objects, the object takes the initializing data you provide and stores that data internally. String objects allow some exceptions to this behavior, and for mutable CFString objects that exception is the <code>CFStringCreateMutableWithExternalCharactersNoCopy</code> function. This function creates a mutable CFString object whose backing store is some Unicode buffer that you create and own. You can test and manipulate this buffer independently of the object.</p><p><span class="content_text"><a href="CreatingAndCopying.html#//apple_ref/doc/uid/20001183-101710-CHDDEDFG">Listing 6</a></span> shows how to create such a cheap mutable CFString “wrapper” for your character buffer.</p><a name="//apple_ref/doc/uid/20001183-101710-CHDDEDFG" title="Listing 6Creating a mutable CFString object with independent backing store"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001183-101710" title="Listing 6Creating a mutable CFString object with independent backing store"></a><strong>Listing 6&nbsp;&nbsp;</strong>Creating a mutable CFString object with independent backing store</p><div class="codesample"><table><tr><td scope="row"><pre>void stringWithExternalContentsExample(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>#define BufferSize 1000<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableStringRef mutStr;<span></span></pre></td></tr><tr><td scope="row"><pre>    UniChar *myBuffer;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myBuffer = malloc(BufferSize * sizeof(UniChar));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    mutStr = CFStringCreateMutableWithExternalCharactersNoCopy(NULL, myBuffer, 0, BufferSize, kCFAllocatorNull);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringAppend(mutStr, CFSTR("Appended string... "));<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringAppend(mutStr, CFSTR("More stuff... "));<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringAppendPascalString(mutStr, "\pA ASCII string. ", kCFStringEncodingMacRoman);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringAppendFormat(mutStr, NULL, CFSTR("%d %4.2f %@..."), 42, -3.14, CFSTR("Hello"));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(mutStr);<span></span></pre></td></tr><tr><td scope="row"><pre>    free(myBuffer);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The third and fourth parameters in the creation function specify the number of characters in the buffer and the buffer capacity. The final parameter, <em>externalCharsAllocator</em>, specifies the CFAllocator object to use for reallocating the buffer when editing takes place and for deallocating the buffer when the CFString object is deallocated. In the above example, <code><a href="../../../Reference/CFAllocatorRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFAllocatorNull" target="_top">kCFAllocatorNull</a></code> is specified, which tells the object that the client assumes responsibility for these actions. If you specified an allocator object to use, such as <code>NULL</code> for the default allocator, there is usually no need to worry about reallocation or deallocation of the buffer.</p><p>The example illustrates how you can modify the contents of the buffer with CFString functions. You can also modify the contents of the buffer directly, but if you do so, you must notify the mutable CFString “wrapper” object with the <code>CFStringSetExternalCharactersNoCopy</code> function. You can also substitute an entirely different buffer with this function because it makes the mutable CFString object point directly at the specified <code>UniChar</code> array as its backing store. (However, the CFString object must have been created with the <code>CFStringCreateMutableWithExternalCharactersNoCopy</code> function.) The <code>CFStringSetExternalCharactersNoCopy</code> function does not free the previous buffer.</p><p>Using these functions comes at a cost because some CFString optimizations are invalidated. For example, mutable CFString objects can no longer use a gap for editing, and they cannot optimize storage by using 8-bit characters.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="StringStorage.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="AccessingContents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-03-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/CreatingAndCopying.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/CreatingAndCopying.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/CoreFoundation/Conceptual/CFStrings/Articles/CreatingAndCopying.html%3Fid%3D10000131i-3.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
