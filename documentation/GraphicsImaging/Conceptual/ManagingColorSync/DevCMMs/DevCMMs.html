<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Managing Colors With ColorSync in Mac OS 9 (Legacy): Developing Color Management Modules</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Developing Color Management Modules"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000276" title="Developing Color Management Modules"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/MacOS9Earlier-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000540" target="_top">Mac OS 9 &amp; Earlier</a> &gt; <a href="../PrefaceCS/PrefaceCS.html#//apple_ref/doc/uid/TP30000249-DontLinkElementID_94">Managing Colors With ColorSync in Mac OS 9 (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DevCSSDevDrvrs/DevCSSDevDrvrs.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../VersAndCompat/VersAndCompat.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_1" title="Developing Color Management Modules"></a><h1><a name="//apple_ref/doc/uid/TP30000276-BCIDGEBC" title="Developing Color Management Modules "></a>Developing Color Management Modules </h1><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_117"></a>This <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_118"></a>section gives a brief overview of color management modules (CMMs) and the role a CMM plays in the ColorSync color management system. You should read this section if you are a third-party developer who creates CMMs that ColorSync (versions 2.0 and greater) can use instead of, or in conjunction with, the default CMM.</p><p>Before reading this section, you should read <span class="content_text"><a href="../IntroCSMngr/IntroCSMngr.html#//apple_ref/doc/uid/TP30000279-BBCFGIBI">Overview of ColorSync</a></span> for a more complete conceptual explanation of how a CMM fits within the ColorSync system. If you are unfamiliar with terms and concepts such as profile, color space, CMM, and color management, or would like to review these topics, you should also read <span class="content_text"><a href="../IntroCSpaces/IntroCSpaces.html#//apple_ref/doc/uid/TP30000280-BBCBDGDD">Overview of Color and Color Management Systems</a></span>.</p><p>At a minimum, a ColorSync-compatible CMM must be able to match colors across color spaces belonging to different base families and check colors expressed in the color gamut of one device against the color gamut of another device.</p><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_119"></a>In addition to the minimum set of requests a CMM must service, a CMM can also implement support for other requests a ColorSync-supportive application or device driver might make. Among the optional services a CMM might provide are verifying if a particular profile contains the base set of required elements for a profile of its type and directing the process of converting profile data embedded in a graphics file to data in an external profile file accessed through a profile reference and vice versa. A CMM can also provide services for PostScript printers by obtaining or deriving from a profile specific data required by PostScript printers for color-matching processes and returning the data in a format that can be sent to the PostScript printer.</p><p>This section provides a high-level discussion of the required and optional ColorSync Manager request codes your CMM might be called to handle, and also describes the Component Manager required request codes to which every component must respond.</p><p>For complete details on components and their structure, see the chapter Component Manager in Inside Macintosh: More Macintosh Toolbox.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-TPXREF101">About Color Management Modules</a>
				
			<br/>
			
        
			
			
				<a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-TPXREF102">Creating a Color Management Module</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000276-TPXREF101" title="About Color Management Modules "></a><h2>About Color Management Modules </h2><p>A <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_120"></a>color management module (<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_121"></a>CMM) is a component that implements color matching, color gamut checking, and other services and performs these services in response to requests from ColorSync-supportive applications or device drivers.</p><p>A CMM component interacts directly with the Component Manager, which calls the CMM on behalf of the ColorSync Manager and the requesting application or driver. When they call ColorSync Manager functions to request color-matching and color gamut-checking services, ColorSync-supportive applications and device drivers specify the profiles to use. These profiles characterize the devices involved; they include information giving the color spaces and the color gamuts of the devices and the preferred CMM to carry out the work. A CMM uses the information contained in these profiles to perform the processing required to service requests. <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJIABF">Figure 6-1</a></span> shows the relationship between a ColorSync-supportive application or driver, the ColorSync Manager, the Component Manager, and one or more available CMM components.</p><p>A CMM should support all seven classes of profiles defined by the ICC. For information on the seven classes of profiles, see Profile Class or the International Color Consortium Profile Format Specification, version 2.x or higher. To obtain a copy of the specification, or to get other information about the ICC, visit the ICC Web site at &lt;http://www.color.org/>.</p><p>In some cases, a CMM will not be able to convert and match colors directly from the color space of one profile to that of another. Instead, it will need to convert colors to the device-independent color space specified by the profile. A CMM uses device-independent color spaces, or interchange color spaces, to interchange color data from the native color space of one device to the native color space of another device.The profile connection space field of a profile header specifies the interchange color space for that profile. Version 2.x of the ColorSync Manager supports two interchange color spaces: XYZ and Lab.</p><br/><div><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_2" title="Figure 6-1The ColorSync Manager and the Component Manager"></a><p><a name="//apple_ref/doc/uid/TP30000276-BCIJIABF" title="Figure 6-1The ColorSync Manager and the Component Manager"></a><strong>Figure 6-1&nbsp;&nbsp;</strong>The ColorSync Manager and the Component Manager</p><img src = "../art/csl01.gif" alt = "The ColorSync Manager and the Component Manager" width="271" height="308"></div><br/><p>When interchange color spaces are involved, the ColorSync Manager handles the process, which is largely transparent to the CMM. The ColorSync Manager passes to the CMM the correct profiles for color matching. For example, in a case in which both the source and destination profile’s CMMs are required to complete the color matching using color space profiles, the ColorSync Manager calls the source profile’s CMM with the source profile and an interchange color space profile. Then it calls the destination profile’s CMM with an interchange color space profile and the destination profile. The ColorSync Manager assesses the requirements and breaks the process down so that the correct CMM is called with the correct set of profiles. This process is described from the perspective of an application or device driver in <span class="content_text"><a href="../DevCSApps/DevCSApps.html#//apple_ref/doc/uid/TP30000278-BBCBBFJD">How the ColorSync Manager Selects a CMM</a></span>.</p><p>A CMM uses lookup tables and algorithms for color matching, using one device to preview the color reproduction capabilities of another device, and checking for colors that cannot be reproduced.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_122"></a></p><a name="//apple_ref/doc/uid/TP30000276-TPXREF102" title="Creating a Color Management Module "></a><h2>Creating a Color Management Module </h2><p>This section describes how to create a CMM component, including how to respond to required Component Manager and ColorSync Manager requests and optional ColorSync Manager requests. For more detailed information on working with components, see the chapter Component Manager in Inside Macintosh: More Macintosh Toolbox.</p><a name="//apple_ref/doc/uid/TP30000276-BCIJGCBG" title="Creating a Component Resource for a CMM"></a><h3>Creating a Component Resource for a CMM</h3><p>A CMM is stored as a component resource. It contains a number of resources, including the standard component resource (a resource of type <code>'thng'</code>) required of any Component Manager component. In addition, a CMM must contain code to handle required request codes passed to it by the Component Manager. This includes support for Component Manager required request codes as well as ColorSync Manager required request codes. For an example of the resources your CMM should include, refer to the DemoCMM project available with the ColorSync SDK.</p><p>To allow the ColorSync Manager to use your CMM when a profile specifies it as its preferred CMM, your CMM should be located in the Extensions folder, where it will automatically be registered at startup. The file type for component files must be set to <code>'thng'</code><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_123"></a>.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF103" title="The Component Resource"></a><h4>The Component Resource</h4><p>The component resource contains all the information needed to register a code resource as a component. Information in the component resource tells the Component Manager where to find the code for the component. As part of the component resource, you must provide a component description record that specifies the component type, subtype, manufacturer, and flags. Here is the data structure for the component description:<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_124"></a></p><div class="codesample"><table><tr><td scope="row"><pre>struct ComponentDescription {<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType              componentType;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType              componentSubType;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType              componentManufacturer;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long       componentFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    unsigned long       componentFlagsMask;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>The following are the key fields of the component description data structure for creating a CMM component:</p><ul class="spaceabove"><li class="li"><p>The <code>componentType</code> field contains a unique 4-byte code specifying the resource type and resource ID of the component’s executable code. For your CMM, set this field to <code>'cmm '</code>.</p></li><li class="li"><p>The <code>componentSubType</code> field indicates the type of services your CMM provides. You should set this field to your CMM name. This value must match exactly the value specified in the profile header’s <code>CMMType</code> field. You must register this value with the International Color Consortium (ICC). To obtain information about the ICC, visit the ICC Web site at &lt;http://www.color.org/>.</p></li><li class="li"><p>The <code>componentManufacturer</code> field indicates the creator of the CMM. You may set this field to any value you wish.</p></li><li class="li"><p>The <code>componentFlags</code> field is a 32-bit field that provides additional information about your CMM component. The high-order 8 bits are reserved for definition by the Component Manager. The low-order 24 bits are specific to each component type. You can use these flags to indicate any special capabilities or features of your component.</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_3" title="Note"></a><p><strong>Note:</strong>&nbsp;Values you specify for all fields except the <code>componentType</code> field must include at least one uppercase character. Apple Computer reserves values containing all lowercase characters for its own use.</p></div><a name="//apple_ref/doc/uid/TP30000276-TPXREF104" title="The Extended Component Resource"></a><h4>The Extended Component Resource</h4><p>Since it was first defined, the component resource has been extended to include additional information. That additional information includes the following field for specifying the version of your component:</p><div class="codesample"><table><tr><td scope="row"><pre>long    componentVersion;   /* version of Component */<span></span></pre></td></tr></table></div><ul class="spaceabove"><li class="li"><p>The <code>componentVersion</code> field indicates the version of the CMM. For related information on specifying the CMM version, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIGDFAI">Required Component Manager Request Codes</a></span>.</p></li></ul><p>For more information on component data types, see the following files from the Universal Interfaces distributed with development systems for the Mac OS:</p><ul class="spaceabove"><li class="li"><p>Components.h</p></li><li class="li"><p>Components.r</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-TPXREF105" title="How Your CMM Is Called by the Component Manager"></a><h3>How Your CMM Is Called by the Component Manager</h3><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_125"></a>Because a CMM is a direct client of the Component Manager, it must conform to the Component Manager’s interface requirements, including supporting and responding to required Component Manager calls.</p><p>The code for your CMM should be contained in a resource. The Component Manager expects the entry point to this resource to be a function having this format:</p><div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult main(ComponentParameters *params, Handle storage);<span></span></pre></td></tr></table></div><p>Whenever the Component Manager receives a request for your CMM, it calls your component’s entry point and passes any parameters, along with information about the current connection, in a data structure of type <code>ComponentParameters</code>. This entry point must be the first function in your CMM’s code segment. The Component Manager also passes a handle to the private storage (if any) associated with the current instance of your component. Here is the component parameters data structure, which is described in detail in Inside Macintosh: More Macintosh Toolbox.</p><div class="codesample"><table><tr><td scope="row"><pre>struct ComponentParameters {<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char       flags;<span></span></pre></td></tr><tr><td scope="row"><pre>        unsigned char       paramSize;<span></span></pre></td></tr><tr><td scope="row"><pre>        short               what;<span></span></pre></td></tr><tr><td scope="row"><pre>        long                params[1];<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>The first field of the <code>ComponentParameters</code> data structure is reserved. The following three fields carry information your CMM needs to perform its processing. The <code>what</code> field contains a value that identifies the type of request. The <code>paramSize</code> field specifies the size in bytes of the parameters passed from the ColorSync-supportive calling application to your CMM. The parameters themselves are passed in the <code>params</code> field.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_126"></a></p><a name="//apple_ref/doc/uid/TP30000276-BCIGDFAI" title="Required Component Manager Request Codes"></a><h3>Required Component Manager Request Codes</h3><p>At a minimum, your CMM must handle the required Component Manager and required ColorSync Manager request codes. The required Component Manager request codes are defined by these constants:</p><ul class="spaceabove"><li class="li"><p><code>kComponentOpenSelect</code> (<code>-1</code>)  Requests that you open an instance of the component. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHHIEF">Establishing the Environment for a New Component Instance</a></span>.</p></li><li class="li"><p><code>kComponentCloseSelect</code> (<code>-2</code>)  Requests that you close the component instance. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIGGIJJ">Releasing Private Storage and Closing the Component Instance</a></span>.</p></li><li class="li"><p><code>kComponentCanDoSelect</code> (<code>-3</code>)  Requests that you tell whether your CMM handles a specific request. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIEAIIH">Determining Whether Your CMM Supports a Request</a></span>.</p></li><li class="li"><p><code>kComponentVersionSelect</code> (<code>-4</code>) Requests that you return your CMM’s version number. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHFJBB">Providing Your CMM Version Number</a></span>. Note that if you provide your version number in an extended component resource, the Component Manager can obtain the version number without having to call your code that handles this request code.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-TPXREF106" title="Required ColorSync Manager Request Codes"></a><h3>Required ColorSync Manager Request Codes</h3><p>Your CMM must also be able to handle the required ColorSync Manager request codes defined by these constants:</p><ul class="spaceabove"><li class="li"><p><code>kCMMMatchColors</code> (<code>1</code>) Requests that you <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_127"></a>color match the specified colors from one color space to another. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJADJB">Matching a List of Colors to the Destination Profile’s Color Space</a></span>.</p></li><li class="li"><p><code>kCMMCheckColors</code> (<code>2</code>) Requests that you <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_128"></a>check the specified colors against the gamut of the destination device whose profile is specified. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHFACJ">Checking a List of Colors</a></span>.</p></li><li class="li"><p><code>kNCMMInit</code> (<code>6</code>) Requests that you initialize the current component instance of your CMM for a ColorSync Manager 2.x session. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDBGDJ">Initializing the Current Component Instance for a Two-Profile Session</a></span>.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-TPXREF107" title="Optional ColorSync Manager Request Codes"></a><h3>Optional ColorSync Manager Request Codes</h3><p>The Component Manager may also call your CMM with the following ColorSync Manager request codes that are considered optional. A CMM may support these requests, although you are not required to do so.</p><ul class="spaceabove"><li class="li"><p><code>kCMMInit</code> (<code>0</code>) Requests that you <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_129"></a>initialize the current component instance of your CMM for a ColorSync 1.0 session. This is a required request code only if your CMM supports ColorSync 1.0 profiles.</p></li><li class="li"><p><code>kCMMMatchPixMap</code> (<code>3</code>) Requests that you match the colors <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_130"></a>of a pixel map image to the color gamut of a destination profile, replacing the original pixel colors with their corresponding colors. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJHIEA">Matching the Colors of a Pixel Map Image</a></span>.</p></li><li class="li"><p><code>kCMMCheckPixMap</code> (<code>4</code>) Requests that you check<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_131"></a> the colors of a pixel map image against the gamut of a destination device for inclusion and report the results. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHBABE">Checking the Colors of a Pixel Map Image</a></span>.</p></li><li class="li"><p><code>kCMMConcatenateProfiles</code> (<code>5</code>) This request code is for backward compatibility with ColorSync 1.0.</p></li><li class="li"><p><code>kCMMConcatInit</code> (<code>7</code>) Requests that you initialize any private data your CMM will need for a color session involving the set of profiles specified by the profile array pointed to by the <code>profileSet</code> parameter. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIEFJGA">Initializing the Component Instance for a Session Using Concatenated Profiles</a></span>.</p></li><li class="li"><p><code>kCMMValidateProfile </code>(<code>8</code>) Requests that <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_132"></a>you test a specific profile to determine if the profile contains the minimum set of elements required for a profile of its type. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIAECA">Validating That a Profile Meets the Base Content Requirements</a></span>.</p></li><li class="li"><p><code>kCMMMatchBitmap</code> (<code>9</code>) Requests that you match the colors of a source image bitmap to the color gamut of a destination profile. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIDBFG">Matching the Colors of a Bitmap</a></span>.</p></li><li class="li"><p><code>kCMMCheckBitmap</code> (<code>10</code>) Requests that you check the <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_133"></a>colors of a source image bitmap against the color gamut of a destination profile. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIGFIIJ">Checking the Colors of a Bitmap</a></span>.</p></li><li class="li"><p><code>kCMMGetPS2ColorSpace</code> (<code>11</code>) Requests that you obtain or derive the color space<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_134"></a> data from a source profile and pass the data to a low-level data-transfer function supplied by the calling application or device driver. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDACDD">Obtaining PostScript-Related Data From a Profile</a></span>.</p></li><li class="li"><p><code>kCMMGetPS2ColorRenderingIntent</code> (<code>12</code>) Requests that you obtain the color-rendering intent from the header of a source profile and then pass the data to a low-level data-transfer function supplied by the calling application or device driver. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDACDD">Obtaining PostScript-Related Data From a Profile</a></span>.</p></li><li class="li"><p><code>kCMMGetPS2ColorRendering</code> (<code>13</code>) Requests that you obtain the rendering intent from the source profile’s header, generate the color rendering dictionary (CRD) data from the destination profile, and then pass the data to a low-level data-transfer function supplied by the calling application or device driver. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDACDD">Obtaining PostScript-Related Data From a Profile</a></span>.</p></li><li class="li"><p><code>kCMMGetPS2ColorRenderingVMSize</code> (<code>17</code>) Requests that you obtain or assess the maximum<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_135"></a> virtual memory (VM) size of the color rendering dictionary (CRD) specified by a destination profile. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJBBDH">Obtaining the Size of the Color Rendering Dictionary for PostScript Printers</a></span>.</p></li><li class="li"><p><code>kCMMFlattenProfile</code> (<code>14</code>) Requests that you extract <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_136"></a>profile data from the profile to be flattened and pass the profile data to a function supplied by the calling program. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIBAHJF">Flattening a Profile for Embedding in a Graphics File</a></span>.</p><p>Changed in ColorSync 2.5: Starting with ColorSync version 2.5, the ColorSync Manager calls the function provided by the calling program directly, without going through the preferred, or any, CMM. Your CMM only needs to handle this request code for versions of ColorSync prior to version 2.5.</p></li><li class="li"><p><code>kCMMUnflattenProfile</code> (<code>15</code>) Requests that you create a file in the temporary items folder in which to store profile data you receive from a function. The calling program supplies the function. You call this function to obtain the profile data. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIFCCDF">Unflattening a Profile</a></span>.</p><p>Changed in ColorSync 2.5: Starting with ColorSync version 2.5, the ColorSync Manager calls the function provided by the calling program directly, without going through the preferred, or any, CMM. Your CMM only needs to handle this request code for versions of ColorSync prior to version 2.5.</p></li><li class="li"><p><code>kCMMNewLinkProfile</code> (<code>16</code>) Requests that<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_137"></a> you create a single device link profile that includes the profiles passed to you in an array. For more information, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIJEJE">Creating a Device Link Profile and Opening a Reference to It</a></span>.</p></li><li class="li"><p><code>kCMMGetNamedColorInfo (70) </code>Requests that you extract and return named color data from the passed profile reference.</p></li><li class="li"><p><code>kCMMGetNamedColorValue (71) </code>Requests that you extract and return device and profile connection space (PCS) color values for the specified color name from the passed profile reference.</p></li><li class="li"><p><code>kCMMGetIndNamedColorValue (72) </code>Requests that you extract and return device and PCS color values for the specified named color index from the passed profile reference.</p></li><li class="li"><p><code>kCMMGetNamedColorIndex (73) </code>Requests that you extract and return a named color index for the specified color name from the passed profile reference.</p></li><li class="li"><p><code>kCMMGetNamedColorName (74) </code>Requests that you extract and return a named color name for the specified named color index from the passed profile reference.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-TPXREF108" title="Handling Request Codes"></a><h3>Handling Request Codes</h3><p>When your <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_138"></a>component receives a request, it should examine the <code>what</code> field of the <code>ComponentParameters</code> data structure to determine the nature of the request, perform the appropriate processing, set an error code if necessary, and return an appropriate function result to the Component Manager.</p><p>Your entry point routine can call a separate subroutine to handle each type of request. <em>ColorSync Manager Reference</em> describes the prototypes for functions your CMM must supply to handle the corresponding ColorSync Manager request codes. The entry routine itself can unpack the parameters from the params parameter to pass to its subroutines, or it can call the Component Manager’s <code>CallComponentFunctionWithStorage</code> routine or <code>CallComponentFunction</code> routine to perform these services.</p><p>The <code>CallComponentFunctionWithStorage</code> function is useful if your CMM uses private storage. When you call this function, you pass it a handle to the storage for this component instance, the <code>ComponentParameters</code> data structure, and the address of your subroutine handler. Each time it calls your entry point function, the Component Manager passes to your function the storage handle along with the <code>ComponentParameters</code> data structure. For a description of how you associate private storage with a component instance, see <span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHHIEF">Establishing the Environment for a New Component Instance</a></span>. The Component Manager’s <code>CallComponentFunctionWithStorage</code> function extracts the calling application’s parameters from the <code>ComponentParameters</code> data structure and invokes your function, passing to it the extracted parameters and the private storage handle.</p><p>For sample code that illustrates how to respond to the required Component Manager and ColorSync Manager requests, see the DemoCMM project available with the ColorSync SDK. You may also wish to refer to the Apple technical note QT05, Component Manager Version 3.0. This technical note shows how to create a fat component, which is a single component usable for both 68K-based and PowerPC-based systems.</p><p>For more information describing how your CMM component should respond to request code calls from the Component Manager, see Creating Components in Inside Macintosh: More Macintosh Toolbox.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF109" title="Responding to Required Component Manager Request Codes"></a><h3>Responding to Required Component Manager Request Codes</h3><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_139"></a><p>This section describes some of the processes your CMM can perform in response to the following Component Manager requests that it must handle:</p><ul class="spaceabove"><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHHIEF">Establishing the Environment for a New Component Instance</a></span> describes how to handle a <code>kComponentOpenSelect</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIGGIJJ">Releasing Private Storage and Closing the Component Instance</a></span> describes how to handle a <code>kComponentCloseSelect</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIEAIIH">Determining Whether Your CMM Supports a Request</a></span> describes how to handle a <code>kComponentCanDoSelect</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHFJBB">Providing Your CMM Version Number</a></span> describes how to handle a <code>kComponentVersionSelect</code> request.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-BCIHHIEF" title="Establishing the Environment for a New Component Instance"></a><h4>Establishing the Environment for a New Component Instance</h4><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_140"></a><p>When a ColorSync-supportive application or device driver first calls a function that requires the services of your CMM, the Component Manager calls your CMM with a <code>kComponentOpenSelect</code> request to open and establish an instance of your component for the calling program. The component instance defines a unique connection between the calling program and your CMM.</p><p>In response to this request, you should allocate memory for any private data you require for the connection. You should allocate memory from the current heap zone. It that attempt fails, you should allocate memory from the system heap or the temporary heap. You can use the <code>SetComponentInstanceStorage</code> function to associate the allocated memory with the component instance.</p><p>For more information on how to respond to this request and open connections to other components, see Creating Components in Inside Macintosh: More Macintosh Toolbox.</p><a name="//apple_ref/doc/uid/TP30000276-BCIGGIJJ" title="Releasing Private Storage and Closing the Component Instance"></a><h4>Releasing Private Storage and Closing the Component Instance</h4><p>To call your CMM with a <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_141"></a>close request, the Component Manager sets the <code>what</code> field of the <code>ComponentParameters</code> data structure to <code>kComponentCloseSelect</code>. In response to this request code, your CMM should dispose of the storage memory associated with the connection.</p><a name="//apple_ref/doc/uid/TP30000276-BCIEAIIH" title="Determining Whether Your CMM Supports a Request"></a><h4>Determining Whether Your CMM Supports a Request</h4><p>Before t<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_142"></a>he ColorSync Manager calls your CMM with a request code on behalf of a ColorSync-supportive application or driver that called the corresponding function, the Component Manager calls your CMM with a can do request to determine if your CMM implements support for the request.</p><p>To call your CMM with a can do request, the Component Manager sets the <code>what</code> field of the <code>ComponentParameters</code> data structure to the value <code>kComponentCanDoSelect</code>. In response, you should set your CMM entry point function’s result to 1 if your CMM supports the request and 0 if it doesn’t.</p><a name="//apple_ref/doc/uid/TP30000276-BCIHFJBB" title="Providing Your CMM Version Number"></a><h4>Providing Your CMM Version Number</h4><p>To call your CMM requesting its version number, the Component Manager sets the <code>what</code> field of the <code>ComponentParameters</code> data structure to the value <code>kComponentVersionSelect</code>. <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_143"></a>In response, you should set your CMM entry point function’s result to the CMM version number. Use the high-order 16 bits to represent the major version and the low-order 16 bits to represent the minor version. The major version should represent the component specification level; the minor version should represent your implementation’s version number.</p><p>If your CMM supports the ColorSync Manager version 2.x, your CMM should return the constant for the major version defined by the following enumeration when the Component Manager calls your CMM with the <code>kComponentVersionSelect</code> request code:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    CMMInterfaceVersion = 1<span></span></pre></td></tr><tr><td scope="row"><pre>    };<span></span></pre></td></tr></table></div><p>Note that if you provide your version number in an extended component resource, the Component Manager can obtain the version number without having to call your code that handles this request code.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF110" title="Responding to Required ColorSync Manager Request Codes"></a><h3>Responding to Required ColorSync Manager Request Codes</h3><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_144"></a><p>This section describes some of the processes your CMM can perform in response to the following ColorSync Manager requests that it must handle:</p><ul class="spaceabove"><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDBGDJ">Initializing the Current Component Instance for a Two-Profile Session</a></span> describes how to handle the <code>kNCMMInit</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJADJB">Matching a List of Colors to the Destination Profile’s Color Space</a></span> describes how to handle a <code>kCMMMatchColors</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHFACJ">Checking a List of Colors</a></span> describes how to handle a <code>kCMMCheckColors</code> request.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-BCIDBGDJ" title="Initializing the Current Component Instance for a Two-Profile Session"></a><h4>Initializing the Current Component Instance for a Two-Profile Session</h4><p>The Component Manager calls your CMM with an <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_145"></a>initialization request, setting the <code>what</code> field of the <code>ComponentParameters</code> data structure to <code>kNCMMInit</code>. In most cases the Component Manager calls your CMM with an <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_146"></a>initialization request before it calls your <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_147"></a>CMM with any other ColorSync Manager requests.</p><p>In response to this request, your CMM should call its <code>NCMInit</code> initialization subroutine. For a description of the function prototype your initialization subroutine must adhere to, see <code><!--a-->NCMInit<!--/a--></code>.</p><p>Using the private storage you allocated in response to the open request, your initialization subroutine should instantiate any private data it needs for the component instance. Before your entry point function returns a function result to the Component Manager, your subroutine should store any profile information it requires. In addition to the standard profile information, you should store the profile header’s quality flags setting, the profile size, and the rendering intent. After you return control to the Component Manager, you cannot use the profile references again.</p><p>The <code>kNCMMInit</code> request gives you the opportunity to examine the profile contents before storing them. If you do not support some aspect of the profile, then you should return an unimplemented error in response to this request. For example, if your CMM does not implement multichannel color support, you should return an unimplemented error at this point.</p><p>The Component Manager may call your CMM with the <code>kNCMMInit</code> request code multiple times after it calls your CMM with a request to open the CMM. For example, it may call your CMM with an initialization request once with one pair of profiles and then again with another pair of profiles. For each call, you need to reinitialize the storage based on the content of the current profiles.</p><p>Your CMM should support all seven classes of profiles defined by the ICC. For the constants used to specify the seven classes of profiles, see <em>ColorSync Manager Reference</em>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIJADJB" title="Matching a List of Colors to the Destination Profile&acirc;&#128;&#153;s Color Space"></a><h4>Matching a List of Colors to the Destination Profile’s Color Space</h4><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_148"></a>When a ColorSync-supportive application or device driver calls the <code>CWMatchColors</code> function for your CMM to handle, the Component Manager calls your CMM with a color-matching session request, setting the <code>what</code> field of the <code>ComponentParameters</code> data structure to <code>kCMMMatchColors</code> and passing you a list of colors to match<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_149"></a>. The Component Manager may also call your CMM with this request code to handle other cases, for example, when a ColorSync-supportive program calls the <code>CWMatchPixMap</code> function.</p><p>Before it calls your CMM with this request, the Component Manager calls your CMM with one of the initialization requests—<code>kCMMInit</code>, <code>kNCMMInit</code>, or <code>kCMMConcatInit</code>—passing to your CMM in the <code>params</code> field of the <code>ComponentParameters</code> data structure the profiles for the color-matching session.</p><p>In response to the <code>kCMMMatchColors</code> request, your CMM should call its <code>CMMatchColors</code> subroutine by calling the Component Manager’s <code>CallComponentFunctionWithStorage</code> function and passing it a handle to the storage for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMatchColors</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMatchColors<!--/a--></code>.</p><p>The parameters passed to your CMM for this request include an array of type <code>CMColor</code> containing the list of colors to match and a one-based count of the number of colors in the list.</p><p>To handle this request, your CMM must match the source colors in the list to the color gamut of the destination profile, replacing the color value specifications in the <code>myColors</code> array with the matched colors specified in the destination profile’s data color space. You should use the rendering intent and the quality flag setting of the source profile in matching the colors. For a description of the color list array data structure, see <code>CMColor</code>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIHFACJ" title="Checking a List of Colors"></a><h4>Checking a List of Colors</h4><p>When a ColorSync-supportive application or device driver calls the <code>CWCheckColors</code> function for your<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_150"></a> CMM to handle, the Component Manager calls your CMM with a color gamut-checking session request, setting the <code>what</code> field of the <code>ComponentParameters</code> data structure to <code>kCMMCheckColors</code> and passing you a list of colors to check.</p><p>Before the Component Manager calls your CMM with the <code>kCMMCheckColors</code> request, it calls your CMM with one of the initialization requests—<code>kCMMInit</code>, <code>kNCMMInit</code>, or <code>kCMMConcatInit</code>—passing to your CMM in the <code>params</code> field of the <code>ComponentParameters</code> data structure the profiles for the color gamut-checking session.</p><p>I<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_151"></a>n response to the <code>kCMMCheckColors</code> request, your CMM should call its <code>CMCheckColors</code> subroutine. For example, if you use the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, you pass it a handle to the storage for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMCheckColors</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMCheckColors<!--/a--></code>.</p><p>In addition to the handle to the private storage containing the profile data, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMCheckColors</code> subroutine an array of type <code>CMColor</code> containing the list of colors to gamut check, a one-based count of the number of colors in the list, and an array of longs.</p><p>To handle this request, your CMM should test the given list of colors against the gamut specified by the destination profile to determine whether the colors fall within a destination device’s color gamut. For each source color in the list that is out of gamut, you must set the corresponding bit in the result array to 1. <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_152"></a></p><a name="//apple_ref/doc/uid/TP30000276-TPXREF111" title="Responding to ColorSync Manager Optional Request Codes"></a><h3>Responding to ColorSync Manager Optional Request Codes</h3><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_153"></a>This section describes some of the processes your CMM can perform in response to the optional ColorSync Manager requests if your CMM supports them. Before the Component Manager calls your CMM with any of these requests, it first calls your CMM with a can do request to determine if you support the specific optional request code. This section includes the following:</p><ul class="spaceabove"><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIAECA">Validating That a Profile Meets the Base Content Requirements</a></span> describes how to handle a <code>kCMMValidateProfile</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIDBFG">Matching the Colors of a Bitmap</a></span> describes how to handle a <code>kCMMMatchBitmap</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIGFIIJ">Checking the Colors of a Bitmap</a></span> describes how to handle a <code>kCMMCheckBitmap</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJHIEA">Matching the Colors of a Pixel Map Image</a></span> describes how to handle the <code>kCMMMatchPixMap</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIHBABE">Checking the Colors of a Pixel Map Image</a></span> describes how to handle the <code>kCMMCheckPixMap</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIEFJGA">Initializing the Component Instance for a Session Using Concatenated Profiles</a></span> describes how to handle a <code>kCMMConcatInit</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIIJEJE">Creating a Device Link Profile and Opening a Reference to It</a></span> describes how to handle a <code>kCMMNewLinkProfile</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIDACDD">Obtaining PostScript-Related Data From a Profile</a></span> describes how to handle the <code>kCMMGetPS2ColorSpace</code>, <code>kCMMGetPS2ColorRenderingIntent</code>, and <code>kCMMGetPS2ColorRendering </code>requests.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIJBBDH">Obtaining the Size of the Color Rendering Dictionary for PostScript Printers</a></span> describes how to handle a <code>kCMMGetPS2ColorRenderingVMSize</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIBAHJF">Flattening a Profile for Embedding in a Graphics File</a></span> describes how to handle a <code>kCMMFlattenProfile</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIFCCDF">Unflattening a Profile</a></span> describes how to handle a <code>kCMMUnflattenProfile</code> request.</p></li><li class="li"><p><span class="content_text"><a href="DevCMMs.html#//apple_ref/doc/uid/TP30000276-BCIEIEBJ">Supplying Named Color Space Information</a></span> describes how to handle the kCMMGetNamedColorInfo, kCMMGetNamedColorValue, kCMMGetIndNamedColorValue, kCMMGetNamedColorIndex, and kCMMGetNamedColorName requests.</p></li></ul><a name="//apple_ref/doc/uid/TP30000276-BCIIAECA" title="Validating That a Profile Meets the Base Content Requirements"></a><h4>Validating That a Profile Meets the Base Content Requirements</h4><p>When a C<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_154"></a>olorSync-supportive application or device-driver calls the <code>CMValidateProfile</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMValidateProfile</code> if your CMM supports the request.</p><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_155"></a>In response to this request code, your CMM should call its <code>CMMValidateProfile </code>subroutine. One way to do this, for example, is by calling the Component Manager’s <code>CallComponentFunction</code> function, passing it the <code>ComponentParameters</code> data structure and the address of your <code>CMMValidateProfile</code> subroutine. To handle this request, you don’t need private storage for ColorSync profile information, because the profile reference is passed to your function. However, if your CMM uses private storage for other purposes, you should call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMValidateProfile<!--/a--></code>.</p><p>The <code>CallComponentFunction</code> function passes to your <code>CMMValidateProfile</code> subroutine a reference to the profile whose contents you must check and a flag whose value you must set to report the results.</p><p>To handle this request, your CMM should test the profile contents against the baseline profile elements requirements for a profile of this type as specified by the International Color Consortium. It should determine if the profile contains the minimum set of elements required for its type and set the response flag to <code>true</code> if the profile contains the required elements and <code>false</code> if it doesn’t.</p><p>To obtain a copy of the International Color Consortium Profile Format Specification, version 2.x, visit the ICC Web site at &lt;http://www.color.org/>.</p><p>The ICC also defines optional tags, which may be included in a profile. Your CMM might use these optional elements to optimize or improve its processing. Additionally, a profile might include private tags defined to provide your CMM with processing capability it uses. The profile developer can define these private tags, register the tag signatures with the ICC, and include the tags in a profile.</p><p>If your CMM is dependent on optional or private tags, your <code>CMMValidateProfile</code> function should check for the existence of these tags also.</p><p>Instead of itself checking the profile for the minimum profile elements requirements for the profile class, your <code>CMMValidateProfile</code> function may use the Component Manager functions to call the default CMM and have it perform the minimum defaults requirements validation.</p><p>To call the default CMM when responding to a <code>kCMMValidateProfile</code> request from an application, your CMM can use the standard mechanisms applications use to call a component. For information on these mechanisms, see the chapter Component Manager in Inside Macintosh: More Macintosh Toolbox.</p><a name="//apple_ref/doc/uid/TP30000276-BCIIDBFG" title="Matching the Colors of a Bitmap"></a><h4>Matching the Colors of a Bitmap</h4><p>Whe<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_156"></a>n a C<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_157"></a>olorSync-supportive application or device driver calls the <code>CWMatchBitMap</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMMatchBitmap</code> if your CMM supports the request. If your CMM supports this request code, your CMM should be prepared to receive any of the bitmap types defined by the ColorSync Manager.</p><p>In response to this request code, your CMM should call its <code>CMMatchBitmap</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMatchBitmap</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMatchBitmap<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMMatchBitmap</code> subroutine a pointer to the bitmap containing the source image data whose colors your function must match, a pointer to a callback function supplied by the calling program, a reference constant your subroutine must pass to the callback function when you invoke it, and a pointer to a bitmap in which your function stores the resulting color-matched image.</p><p>The callback function supplied by the calling function monitors the color-matching progress as your function matches the bitmap colors. You should call this function at regular intervals. Your <code>CMMatchBitmap</code> function should monitor the progress function for a returned value of <code>true</code>, which indicates that the user interrupted the color-matching process. In this case, you should terminate the color-matching process.</p><p>To handle this request, your <code>CMMatchBitmap</code> function must match the colors of the source image bitmap to the color gamut of the destination profile using the profiles specified by a previous <code>kNCMInit</code>, <code>kCMMInit</code>, or <code>kCMMConcatInit</code> request to your CMM for this component instance. You must store the color-matched image in the bitmap result parameter passed to your subroutine. If you are passed a <code>NULL </code>parameter, you must match the bitmap in place.</p><p>For a description of the prototype of the callback function supplied by the calling program, see <code><!--a-->MyCMBitmapCallBackProc<!--/a--></code>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIGFIIJ" title="Checking the Colors of a Bitmap"></a><h4>Checking the Colors of a Bitmap</h4><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_158"></a>When a <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_159"></a>ColorSync-supportive application or device driver calls the <code>CWCheckBitMap</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMCheckBitmap</code> if your CMM supports the request. If your CMM supports this request code, your CMM should be prepared to receive any of the bitmap types defined by the ColorSync Manager.</p><p>In response to this request code, your CMM should call its <code>CMCheckBitmap</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMCheckBitmap</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->MyCMBitmapCallBackProc<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMCheckBitmap</code> subroutine a pointer to the bitmap containing the source image data whose colors your function must check, a pointer to a callback progress-reporting function supplied by the calling program, a reference constant your subroutine must pass to the callback function when you invoke it, and a pointer to a resulting bitmap whose pixels your subroutine must set to show if the corresponding source color is in or out of gamut. A black pixel (value 1) in the returned bitmap indicates an out-of-gamut color, while a white pixel (value 0) indicates the color is in gamut.</p><p>The callback function supplied by the calling function monitors the color gamut-checking progress. You should call this function at regular intervals. Your <code>CMCheckBitmap</code> function should monitor the progress function for a returned value of <code>true</code>, which indicates that the user interrupted the color gamut-checking process. In this case, you should terminate the process.</p><p>For a description of the prototype of the callback function supplied by the calling program, see <code><!--a-->MyCMBitmapCallBackProc<!--/a--></code>.</p><p>Using the content of the profiles that you stored at initialization time for this component instance, your <code>CMCheckBitmap</code> subroutine must check the colors of the source image bitmap against the color gamut of the destination profile. If a pixel is out of gamut, your function must set the corresponding pixel in the result image bitmap to 1. The ColorSync Manager returns the resulting bitmap to the calling application or driver to report the outcome of the check.</p><p>For complete details on the <code>CMCheckBitmap</code> subroutine parameters and how your <code>CMCheckBitmap</code> subroutine communicates with the callback function, see <code><!--a-->MyCMBitmapCallBackProc<!--/a--></code>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIJHIEA" title="Matching the Colors of a Pixel Map Image"></a><h4>Matching the Colors of a Pixel Map Image</h4><p>When a ColorSync<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_160"></a>-supportive <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_161"></a>application or device driver calls the <code>CWMatchPixMap</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMMatchPixMap</code> if your CMM supports the request. If your CMM supports this request code, your <code>CMMatchPixMap</code> function should be prepared to receive any of the pixel map types defined by QuickDraw.</p><p>In response to this request code, your CMM should call its <code>CMMatchPixMap</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMatchPixMap</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMatchPixMap<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMMatchPixMap</code> subroutine a pointer to the pixel map containing the source image to match, a pointer to a callback progress-reporting function supplied by the calling program, and a reference constant your subroutine must pass to the callback function when you invoke it.</p><p>To handle this request, your <code>CMMatchPixMap</code> subroutine must match the colors of the source pixel map image to the color gamut of the destination profile, replacing the original pixel colors of the source image with their corresponding colors expressed in the data color space of the destination profile. The ColorSync Manager returns the resulting color-matched pixel map to the calling application or driver.</p><p>The callback function supplied by the calling function monitors the color-matching progress. You should call this function at regular intervals. Your <code>CMMatchPixMap</code> function should monitor the progress function for a returned value of <code>true</code>, which indicates that the user interrupted the color-matching process. In this case, you should terminate the process.</p><p>For a description of the prototype of the callback function supplied by the calling program, see <code><!--a-->MyCMBitmapCallBackProc<!--/a--></code>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIHBABE" title="Checking the Colors of a Pixel Map Image"></a><h4>Checking the Colors of a Pixel Map Image</h4><p>When a ColorSync-supportive application or device-driver calls the <code>CWCheckPixMap</code> function f<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_162"></a>or your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data stru<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_163"></a>cture set to <code>kCMMCheckPixMap</code> if your CMM supports the request.</p><p>In response to this request code, your CMM should call its <code>CMCheckPixMap</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMCheckPixMap</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMCheckPixMap<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMCheckPixMap</code> subroutine a pointer to the pixel map containing the source image to check, a QuickDraw bitmap in which to report the color gamut-checking results, a pointer to a callback progress-reporting function supplied by the calling program, and a reference constant your subroutine must pass to the callback function when you invoke it.</p><p>Using the content of the profiles passed to you at initialization time, your <code>CMCheckPixMap</code> subroutine must check the colors of the source pixel map image against the color gamut of the destination profile to determine if the pixel colors are within the gamut. If a pixel is out of gamut, your subroutine must set to 1 the corresponding pixel of the result bitmap. The ColorSync Manager returns the bitmap showing the color gamut-checking results to the calling application or device driver.</p><a name="//apple_ref/doc/uid/TP30000276-BCIEFJGA" title="Initializing the Component Instance for a Session Using Concatenated Profiles"></a><h4>Initializing the Component Instance for a Session Using Concatenated Profiles</h4><p>When a ColorSync-supportive application or device driver calls the <code>CWConcatColorWorld</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMConcatInit</code> if your CMM supports the request.</p><p>In response to this request code, your CMM should call its <code>CMConcatInit</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMConcatInit</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMConcatInit<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMConcatInit</code> subroutine a pointer to a data structure of type <code>CMConcatProfileSet</code> containing an array of profiles to use in a subsequent color-matching or color gamut-checking session. The profiles in the array are in processing order—source through destination. The <code>profileSet</code> field of the data structure contains the array. If the profile array contains only one profile, that profile is a device link profile. For a description of the <code>CMConcatProfileSet</code> data structure, see <code>CMConcatProfileSet</code>.</p><p>Using the storage passed to your entry point function in the <code>CMSession </code>parameter, your <code>CMConcatInit</code> function should initialize any private data your CMM will need for a subsequent color session involving the set of profiles. Before your function returns control to the Component Manager, your subroutine should store any profile information it requires. In addition to the standard profile information, you should store the profile header’s quality flags setting, the profile size, and the rendering intent. After you return control to the Component Manager, you cannot use the profile references again.</p><p>A color-matching or color gamut-checking session for a set of profiles entails various color transformations among devices in a sequence for which your CMM is responsible. Your CMM may use Component Manager functions to call other CMMs if necessary.</p><p>There are special guidelines your CMM must follow in using a set of concatenated profiles for subsequent color-matching or gamut-checking sessions. These guidelines are described in <code><!--a-->CMConcatInit<!--/a--></code>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIIJEJE" title="Creating a Device Link Profile and Opening a Reference to It"></a><h4>Creating a Device Link Profile and Opening a Reference to It</h4><p>When a<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_164"></a><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_165"></a> ColorSync-supportive application or device driver calls the <code>CWNewLinkProfile</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMNewLinkProfile</code> if your CMM supports the request.</p><p>In response to this request code, your CMM should call its <code>CMNewLinkProfile</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMNewLinkProfile</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMNewLinkProfile<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMNewLinkProfile</code> subroutine a pointer to a data structure of type <code>CMConcatProfileSet</code> containing the array of profiles that will make up the device link profile.</p><p>To handle this request, your subroutine must create a single device link profile of type <code>DeviceLink</code> that includes the profiles passed to you in the array pointed to by the <code>profileSet</code> parameter. Your CMM must create a file specification for the device link profile. A device link profile cannot be a temporary profile: that is, you cannot specify a location type of <code>cmNoProfileBase</code> for a device link profile. For information on how to specify the file location, see Profile Location Type.</p><p>The profiles in the array are in the processing order—source through destination—which you must preserve. After your CMM creates the device link profile, it must open a reference to the profile and return the profile reference along with the location specification.</p><a name="//apple_ref/doc/uid/TP30000276-BCIDACDD" title="Obtaining PostScript-Related Data From a Profile"></a><h4>Obtaining PostScript-Related Data From a Profile</h4><p>There are three very similar PostScript-related request codes that your CMM may support. Each of the<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_166"></a>se codes requests that your CMM obtain or derive information required by a PostScript printer from the specified profile and pass that information to a function supplied by the calling program.</p><p>When a ColorSync-supportive application or device driver calls the high-level function corresponding to the request code and your CMM is specified to handle it, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to the corresponding request code if your CMM supports it. Here are the three high-level functions and their corresponding request codes:</p><ul class="spaceabove"><li class="li"><p>When the application or device drive<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_167"></a>r calls the <code>CMGetPS2ColorSpace</code> function, the Component Manager calls your CMM with a <code>kCMMGetPS2ColorSpace</code> request code. To respond to this request, your CMM must obtain the color space data from a source profile and pass the data to a low-level data-transfer function supplied by the calling application or device driver.</p></li><li class="li"><p>When the application or device driver calls the <code>CMGetPS2ColorRenderingIntent</code> function, the Component Manager calls your CMM with a <code>kCMMGetPS2ColorRenderingIntent</code><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_168"></a>request code. To respond to this request, your CMM must obtain the color rendering intent from the source profile and pass the data to a low-level data-transfer function supplied by the calling application or device driver.</p></li><li class="li"><p>When the application or device driver calls the <code>CMGetPS2ColorRendering</code> function, the Component Manager calls your CMM with a <code>kCMMGetPS2ColorRendering</code> request code. <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_169"></a>To respond to this request, your CMM must obtain the rendering intent from the source profile’s header. Then your CMM must obtain or derive the color rendering dictionary for that rendering intent from the destination profile and pass the CRD data to a low-level data-transfer function supplied by the calling application or device driver.</p></li></ul><p>In response to each of these request codes, your CMM should call its subroutine that handles the request. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your subroutine handler.</p><p>For a description of the function prototypes to which your subroutine must adhere for each of these requests, see <em>ColorSync Manager Reference</em>.</p><ul class="spaceabove"><li class="li"><p>For <code>kCMMGetPS2ColorSpace</code>, see <code><!--a-->CMMGetPS2ColorSpace<!--/a--></code></p></li><li class="li"><p>For <code>kCMMGetPS2ColorRenderingIntent</code>, see <code><!--a-->CMMGetPS2ColorRenderingIntent<!--/a--></code></p></li><li class="li"><p>For <code>kCMMGetPS2ColorRendering</code>, see <code><!--a-->CMMGetPS2ColorRendering<!--/a--></code>.</p></li></ul><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your subroutine a reference to the source profile containing the data you must obtain or derive, a pointer to the function supplied by the calling program, and a reference constant that you must pass to the supplied function each time your CMM calls it. For <code>kCMMGetPS2ColorRendering</code>, your CMM is also passed a reference to the destination profile.</p><p>To handle each of these requests, your subroutine must allocate a <code>data</code> buffer in which to pass the particular PostScript-related data to the function supplied by the calling application or driver. Your subroutine must call the supplied function repeatedly until you have passed all the data to it. For a description of the prototype of the application or driver-supplied function, see <code><!--a-->MyColorSyncDataTransfer<!--/a--></code>.</p><p>For a description of how each of your subroutines must interact with the calling program’s supplied function, see the descriptions of the prototypes for the subroutines in <em>ColorSync Manager Reference</em>.</p><a name="//apple_ref/doc/uid/TP30000276-BCIJBBDH" title="Obtaining the Size of the Color Rendering Dictionary for PostScript Printers"></a><h4>Obtaining the Size of the Color Rendering Dictionary for PostScript Printers</h4><p>When a ColorSync-supportive application or device driver calls the <code>CMGetPS2ColorRenderingVMSize</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMGetPS2ColorRenderingVMSize</code> if your CMM supports the request.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_170"></a></p><p>In response to this request code, your CMM should call its <code>CMMGetPS2ColorRenderingVMSize</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMGetPS2ColorRenderingVMSize</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <em>ColorSync Manager Reference</em>.</p><p>In addition to the storage handle for global data for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMMGetPS2ColorRenderingVMSize</code> subroutine a reference to the source profile identifying the rendering intent and a reference to the destination profile containing the color rendering dictionary (CRD) for the specified rendering intent.</p><p>To handle this request, your CMM must obtain or assess and return the maximum VM size for the CRD of the specified rendering intent.</p><p>If the destination profile contains the Apple-defined private tag <code>'psvm'</code>, described in the next paragraph, then your CMM may read the tag and return the CRD VM size data supplied by this tag for the specified rendering intent. If the destination profile does not contain this tag, then you must assess the VM size of the CRD.</p><p>The <code>CMPS2CRDVMSizeType</code> data type defines the Apple-defined <code>'psvm'</code> optional tag that a printer profile may contain to identify the maximum VM size of a CRD for different rendering intents.</p><p>This tag’s element data includes an array containing one entry for each rendering intent and its virtual memory size. For a description of the data structures that define the tag’s element data, see <em>ColorSync Manager Reference</em>.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_171"></a></p><a name="//apple_ref/doc/uid/TP30000276-BCIBAHJF" title="Flattening a Profile for Embedding in a Graphics File"></a><h4>Flattening a Profile for Embedding in a Graphics File</h4><p>Flattening refers to transferring a profile stored in an independent disk file to an external profile format that can be embedded in a graphics document. Unflattening refers to transferring from the embedded format to an independent disk file.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF112" title="Starting With ColorSync 2.5"></a><h5>Starting With ColorSync 2.5</h5><p>Starting with ColorSync version 2.5, when a ColorSync-supportive application or device driver calls the <code>CMFlattenProfile</code> function, the ColorSync Manager calls the flatten function provided by the calling program or driver directly, without going through the preferred, or any, CMM.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF113" title="Prior to ColorSync 2.5"></a><h5>Prior to ColorSync 2.5</h5><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_172"></a>Prior to ColorSync version 2.5, when a ColorSync-supportive application <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_173"></a>or device driver calls the <code>CMFlattenProfile</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMFlattenProfile</code> if your CMM supports the request.</p><p>In <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_174"></a>response to this request code, your CMM should call its <code>CMMFlattenProfile</code> subroutine. For example, to do this, your CMM may call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMFlattenProfile</code> subroutine. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMFlattenProfile<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMMFlattenProfile</code> subroutine a reference to the profile to be flattened, a pointer to a function supplied by the calling program, and a reference constant your subroutine must pass to the calling program’s function when you invoke it.</p><p>To handle this request, your subroutine must extract the profile data from the profile, allocate a buffer in which to pass the profile data to the supplied function, and pass the profile data to the function, keeping track of the amount of data remaining to pass.</p><p>For a description of the prototype of the function supplied by the calling program, see <code><!--a-->MyColorSyncDataTransfer<!--/a--></code>. See also <code><!--a-->CMMFlattenProfile<!--/a--></code> for details on how your <code>CMMFlattenProfile</code> subroutine communicates with the function supplied by the calling program.</p><a name="//apple_ref/doc/uid/TP30000276-BCIFCCDF" title="Unflattening a Profile"></a><h4>Unflattening a Profile</h4><p>Unflattening refers to transferring from the embedded format to an independent disk file. Flattening refers to transferring a profile stored in an independent disk file to an external profile format that can be embedded in a graphics document.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF114" title="Starting With ColorSync 2.5"></a><h5>Starting With ColorSync 2.5</h5><p>Starting with ColorSync version 2.5, when a ColorSync-supportive application or device driver calls the <code>CMUnflattenProfile</code> function, the ColorSync Manager calls the unflatten function provided by the calling program or driver directly, without going through the preferred, or any, CMM.</p><a name="//apple_ref/doc/uid/TP30000276-TPXREF115" title="Prior to ColorSync 2.5"></a><h5>Prior to ColorSync 2.5</h5><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_175"></a>Prior to ColorSync version 2.5, when a ColorSync-supportive application or device driver calls the <a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_176"></a><code>CMUnflattenProfile</code> function, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to <code>kCMMUnflattenProfile</code>, if your CMM supports that request code.</p><p>In re<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_177"></a>sponse to the <code>kCMMUnflattenProfile</code> request code, your CMM should call its <code>CMMUnflattenProfile</code> function. To do this, your CMM can call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your <code>CMMUnflattenProfile</code> function. For more information, see <code><!--a-->CMMUnflattenProfile<!--/a--></code>.</p><p>In addition to the storage handle for private storage for this component instance, the <code>CallComponentFunctionWithStorage</code> function passes to your <code>CMMUnflattenProfile</code> function a pointer to a function supplied by the calling program and a reference constant. Your function passes the reference constant to the calling program’s function when you invoke it. The calling program’s function obtains the profile data and returns it to your subroutine. For a more information on the data transfer function, see <code><!--a-->MyColorSyncDataTransfer<!--/a--></code>.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_178"></a></p><p>To handle this request, your subroutine must create a file in which to store the profile data. You should create the file in the temporary items folder. Your <code>CMMUnflattenProfile</code> subroutine must call the supplied <code>ColorSyncDataTransfer</code> function repeatedly to obtain the profile data. Before calling the <code>ColorSyncDataTransfer</code> function, your <code>CMMUnflattenProfile</code> function must allocate a buffer to hold the returned profile data.</p><p>Your <code>CMMUnflattenProfile</code> function must identify the profile size and maintain a counter to track the amount of data transferred and the amount of data remaining. This information allows you to determine when to call the <code>ColorSyncDataTransfer</code> function for the final time.</p><a name="//apple_ref/doc/uid/TP30000276-BCIEIEBJ" title="Supplying Named Color Space Information"></a><h4>Supplying Named Color Space Information</h4><p><a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_179"></a>When a ColorSync-supportive application or device driver calls the <code>CMGetNamedColorInfo</code> function for your CMM to handle, the Component Manager calls your CMM with the <code>what</code> field of the <code>ComponentParameters</code> data structure set to kCMMGetNamedColorInfo if your CMM supports the request.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_180"></a></p><p>In response to this request code, your CMM should call its CMMGetNamedColorInfo subroutine. To do this, your CMM might call the Component Manager’s <code>CallComponentFunctionWithStorage</code> function, passing it the storage handle for this component instance, the <code>ComponentParameters</code> data structure, and the address of your CMMGetNamedColorInfo subroutine.</p><p>The CMMGetNamedColorInfo function returns information about a named color space from its profile reference. For a description of the function prototype to which your subroutine must adhere, see <code><!--a-->CMMGetNamedColorInfo<!--/a--></code>.</p><p>A named color profile has a value of <code>'nmcl'</code> in the Profile/Device class field of its header. If the source profile passed to your CMMGetNamedColorInfo subroutine is a named color profile, you can extract the necessary information to return in the parameters of the CMMGetNamedColorInfo routine.</p><p>Your CMM can obtain named color information as well as profile header information by reading the <code>namedColor2Tag</code> tag (signature <code>'ncl2'</code>). This tag’s element data includes a count of named colors, the number of device channels, and a prefix and suffix for each named color name. The data also includes the named color names themselves, along with profile connection space (PCS) and device color information for each named color. For information on the format of the <code>namedColor2Tag</code> tag, see the International Color Consortium Profile Format Specification.</p><p>Your CMM responds similarly for other named color requests:</p><ul class="spaceabove"><li class="li"><p>The <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetNamedColorValue" target="_top">CMGetNamedColorValue</a></code> routine generates a kCMMGetNamedColorValue request, which you respond to in your CMMGetNamedColorValue routine. The CMMGetNamedColorValue routine returns device and PCS color values from a named color space profile for a specific color name.</p></li><li class="li"><p>The <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetIndNamedColorValue" target="_top">CMGetIndNamedColorValue</a></code> routine generates a kCMMGetIndNamedColorValue request, which you respond to in your CMMGetIndNamedColorValue routine. The CMMGetIndNamedColorValue routine returns device and PCS color values from a named color space profile for a specific named color index.</p></li><li class="li"><p>The CMGetNamedColorIndex routine generates a kCMMGetNamedColorIndex request, which you respond to in your CMMGetNamedColorIndex routine. The CMMGetNamedColorIndex routine returns a named color index from a named color space profile for a specific color name.</p></li><li class="li"><p>The <code><a href="../../../Reference/ColorSync_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CMGetNamedColorName" target="_top">CMGetNamedColorName</a></code> routine generates a kCMMGetNamedColorName request, which you respond to in your CMMGetNamedColorName routine. The CMMGetNamedColorName routine returns a named color name from a named color space profile for a specific named color index.<a name="//apple_ref/doc/uid/TP30000276-DontLinkElementID_181"></a></p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DevCSSDevDrvrs/DevCSSDevDrvrs.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../VersAndCompat/VersAndCompat.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 1999, 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-02-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCMMs/DevCMMs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCMMs/DevCMMs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/ManagingColorSync/DevCMMs/DevCMMs.html%3Fid%3DTP40000896-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>