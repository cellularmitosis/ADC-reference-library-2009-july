<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Loading and Executing Script Data(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING336></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-335.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-337.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-331.html"><B>Chapter 10 - Scripting Components</B></A> / <A HREF="IAC-333.html"><B>Using Scripting Component Routines</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING336-0></A>
<H2><A NAME=MARKER-9-117></A>Loading and Executing Script Data</H2>
 <A NAME=MARKER-2-199></A><A HREF=IAC-292.html#MARKER-9-35>Figure 7-4 on page 7-10</A> illustrates how an application might execute a script whenever the user presses the Tab key after entering a customer's name in the "Customer Name" field of an electronic form. To execute a script in response to some user action, your application must be able to load and execute the script data for a compiled script. <A NAME=MARKER-2-119></A> <A NAME=MARKER-2-120></A><P>
 This section describes how to load and execute a previously compiled and saved script. The next section, <A HREF=IAC-337.html#MARKER-9-128>"Modifying and Recompiling a Compiled Script,"</A> describes how to allow a user to modify a compiled script.<P>
 The <CODE>OSALoad</CODE> function takes three input parameters: a component instance that identifies a connection with a scripting component; a descriptor record that contains a handle to the script data to be loaded; and a parameter that contains flags for use by individual scripting components. The function returns, in the fourth parameter, a script ID for the script data. <A NAME=MARKER-2-395></A><P>
 When your application calls <CODE>OSALoad</CODE> with a component instance that identifies a connection with the generic scripting component, the generic scripting component in turn uses a connection with the scripting component that created the script data (if that component is registered with the Component Manager on the local computer). If the descriptor record passed to <CODE>OSALoad</CODE> is of type <CODE>typeOSAGenericStorage</CODE>, the generic scripting component uses the trailer that follows the script data to determine which scripting component to open a connection with. If the descriptor record's type is the subtype value for some other scripting component, the generic scripting component does not look for a trailer and uses the descriptor type to identify the scripting component. <A NAME=MARKER-2-415></A><P>
 When your application calls <CODE>OSALoad</CODE> with a component instance that identifies a connection to any scripting component other than the generic scripting component, that component can load script data only if it was saved as the data for a descriptor record whose descriptor type matches the scripting component's subtype. In this case, however, your application easily can take advantage of additional routines and other special capabilities provided by that scripting component.<P>
 It is also possible to call <CODE>OSALoad</CODE> using the generic scripting component, then use generic scripting component routines to identify the specific component associated with the loaded script. This allows you to use component-specific routines with a script originally loaded by the generic scripting component. For information about how to do this, see <A HREF=IAC-412.html#MARKER-9-290>"Routines Used by Scripting Components,"</A> which begins on <A HREF=IAC-412.html#MARKER-9-290>page 10-91</A>.<P>
 The <CODE>OSALoad</CODE> function returns a script ID for the loaded script data. The generic scripting component always associates the returned script ID with the scripting component that created the script. In this way, it can use a connection with that component again whenever the client application passes the returned script ID to other scripting component routines.<P>
 <A HREF=#MARKER-9-123>Listing 10-4</A> shows a procedure that loads and executes a script. The <CODE>MyLoadAndExecute</CODE> procedure takes a handle to script data that was previously saved using a generic storage descriptor record, obtains a script ID for the equivalent compiled script, executes the compiled script in the default context, and disposes of both the compiled script and the resulting script value ID. If the <CODE>OSAExecute</CODE> function returns a script execution error, <CODE>MyLoadAndExecute</CODE> obtains further information about the error and displays it to the user. <P>
<B>Listing 10-4  <A NAME=MARKER-9-123></A>A routine that loads and executes script data previously saved using a generic storage descriptor record<A NAME=MARKER-2-124></A></B><P>
<PRE>
PROCEDURE MyLoadAndExecute (scriptData: Handle);
VAR
   scriptDesc:                   AEDesc;
   scriptID, resultID:           OSAID;
   scriptText:                   AEDesc;
   myOSAErr, ignoreErr:          OSAError;
BEGIN
   {load the script data}
   scriptDesc.descriptorType := typeOSAGenericStorage;
   scriptDesc.dataHandle := scriptData;
   myOSAErr := OSALoad(gScriptingComponent, scriptDesc, 
                        kOSAModeNull, scriptID);
   IF myOSAErr = noErr THEN 
   BEGIN
      {execute the resulting compiled script in the default }
      { context}   
      myOSAErr := OSAExecute(gScriptingComponent, scriptID, 
                           kOSANullScript, kOSAModeNull, 
                           resultID);
      ignoreErr := OSADispose(gScriptingComponent, scriptID);
      ignoreErr := OSADispose(gScriptingComponent, resultID);
   END;
   IF myOSAErr = errOSAScriptError THEN 
      MyGetScriptErrorInfo;
END;
</PRE>
 The <CODE>OSALoad</CODE> function in <A HREF=#MARKER-9-123>Listing 10-4</A> takes a component instance, a generic storage descriptor record for the script data to be loaded, and a parameter that contains the mode flags, if any, for loading the script. In this case the constant <CODE>kOSAModeNull</CODE> indicates that no mode flags are set. The <CODE>OSALoad</CODE> function returns a script ID for the resulting compiled script, which the <CODE>MyLoadAndExecute</CODE> procedure then passes to the <CODE>OSAExecute</CODE> function.<P>
 In addition to a component instance and the script ID for the compiled script to be executed, the <CODE>OSAExecute</CODE> function takes a script ID for a context and a parameter that contains the mode flags, if any, for script execution. In <A HREF=#MARKER-9-123>Listing 10-4</A>, the script ID passed to <CODE>OSAExecute</CODE> for the script context is <CODE>kOSANullScript</CODE>, indicating that the scripting component can use its default context to bind any variables. The constant <CODE>kOSAModeNull</CODE> in the next parameter indicates that no mode flags are set for script execution. <P>
 After disposing of the compiled script and the resulting script value, <CODE>MyLoadAndExecute</CODE> checks the result code returned by <CODE>OSAExecute</CODE>. If it is <CODE>errOSAScriptError</CODE>, <CODE>MyLoadAndExecute</CODE> calls the <CODE>MyGetScriptErrorInfo</CODE> procedure (see <A HREF=IAC-334.html#MARKER-9-96>Listing 10-3 on page 10-11</A>), which in turn uses the <CODE>OSAScriptError</CODE> function to obtain more information about the error.<P>
 You can use the <CODE>OSALoad</CODE> and <CODE>OSAExecute</CODE> functions as shown in <A HREF=#MARKER-9-123>Listing 10-4</A> if you expect the user to execute the compiled script several times or manipulate it in some other way. If you want to load and execute a script just one time and don't need to keep the compiled script in memory after it has been executed, you can use <CODE>OSALoadExecute</CODE> instead of <CODE>OSALoad</CODE>, <CODE>OSAExecute</CODE>, and <CODE>OSADispose</CODE>. This function takes a component instance, a descriptor record for the script data to be loaded and executed, a context ID, and a <CODE>modeFlags</CODE> parameter. The <CODE>OSALoadExecute</CODE> function executes the resulting compiled script, disposes of the compiled script, and returns the script ID for the resulting script data. <A NAME=MARKER-2-398></A> <A NAME=MARKER-2-394></A> <A NAME=MARKER-2-127></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-335.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-337.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
