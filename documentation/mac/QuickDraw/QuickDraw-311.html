<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>NewGWorld (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING311></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-302.html"><B>Chapter 6 - Offscreen Graphics Worlds</B></A> / <A HREF="QuickDraw-305.html"><B>Offscreen Graphics Worlds Reference</B></A><BR><DL><DD><A HREF="QuickDraw-309.html"><B>Routines</B></A> / <A HREF="QuickDraw-310.html"><B>Creating, Altering, and Disposing of Offscreen Graphics Worlds</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING311-0></A>
<H3><A NAME=MARKER-9-118></A>NewGWorld</H3>
 <A NAME=MARKER-11-120></A><A NAME=MARKER-11-120></A><A NAME=MARKER-2-97></A><A NAME=MARKER-2-183></A>Use the <CODE>NewGWorld</CODE> function to create an offscreen graphics world. <P>
<PRE>
FUNCTION NewGWorld (VAR offscreenGWorld: GWorldPtr; 
                    pixelDepth: Integer; boundsRect: Rect; 
                    cTable: CTabHandle; aGDevice: GDHandle; 
                    flags: GWorldFlags): QDErr;
</PRE>
<DL>
<DT><CODE>offscreenGWorld</CODE>
<DD> A pointer to the offscreen graphics world created by this routine.
<DT><CODE>pixelDepth</CODE>
<DD> The pixel depth of the offscreen world; possible depths are 1, 2, 4, 8, 16, and 32 bits per pixel. If you specify 0 in this parameter, you get the default behavior for the <CODE>NewGWorld</CODE> function--that is, it uses the pixel depth of the screen with the greatest pixel depth from among all screens whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter. If you specify 0 in this parameter, <CODE>NewGWorld</CODE> also uses the <CODE>GDevice</CODE> record from this device instead of creating a new <CODE>GDevice</CODE> record for the offscreen world. If you use <CODE>NewGWorld</CODE> on a computer that supports only basic QuickDraw, you may specify only 0 or 1 in this parameter.
<DT><CODE>boundsRect</CODE>
<DD> The boundary rectangle and port rectangle for the offscreen pixel map. This becomes the boundary rectangle for the <CODE>GDevice</CODE> record, if <CODE>NewGWorld</CODE> creates one. If you specify 0 in the <CODE>pixelDepth</CODE> parameter, <CODE>NewGWorld</CODE> interprets the boundaries in global coordinates that it uses to determine which screens intersect the rectangle. (<CODE>NewGWorld</CODE> then uses the pixel depth, color table, and <CODE>GDevice</CODE> record from the screen with the greatest pixel depth from among all screens whose boundary rectangles intersect this rectangle.) Typically, your application supplies this parameter with the port rectangle for the onscreen window into which your application will copy the pixel image from this offscreen world.
<DT><CODE>cTable</CODE>
<DD> A handle to a <CODE>ColorTable</CODE> record. If you pass <CODE>NIL</CODE> in this parameter, <CODE>NewGWorld</CODE> uses the default color table for the pixel depth that you specify in the <CODE>pixelDepth</CODE> parameter. If you set the <CODE>pixelDepth</CODE> parameter to 0, <CODE>NewGWorld</CODE> ignores the <CODE>cTable</CODE> parameter and instead copies and uses the color table of the graphics device with the greatest pixel depth among all graphics devices whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter. If you use <CODE>NewGWorld</CODE> on a computer that supports only basic QuickDraw, you may specify only <CODE>NIL</CODE> in this parameter.
<DT><CODE>aGDevice</CODE>
<DD> A handle to a <CODE>GDevice</CODE> record that is used only when you specify the <CODE>noNewDevice</CODE> flag in the <CODE>flags</CODE> parameter, in which case <CODE>NewGWorld</CODE> attaches this <CODE>GDevice</CODE> record to the new offscreen graphics world. If you set the <CODE>pixelDepth</CODE> parameter to 0, or if you do not set the <CODE>noNewDevice</CODE> flag, <CODE>NewGWorld</CODE> ignores the <CODE>aGDevice</CODE> parameter, so you should set it to <CODE>NIL</CODE>. If you set the <CODE>pixelDepth</CODE> parameter to 0, <CODE>NewGWorld</CODE> uses the <CODE>GDevice</CODE> record for the graphics device with the greatest pixel depth among all graphics devices whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter. You should pass <CODE>NIL</CODE> in this parameter if the computer supports only basic QuickDraw. Generally, your application should never create <CODE>GDevice</CODE> records for offscreen graphics worlds.
<DT><CODE>flags</CODE>
<DD> Options available to your application. You can set a combination of the flags <CODE>pixPurge</CODE>, <CODE>noNewDevice</CODE>, <CODE>useTempMem</CODE>, and <CODE>keepLocal</CODE>. If you don't wish to use any of these flags, pass the empty set ([ ]) in your Pascal code or 0 in your C code in this parameter, in which case you get the default behavior for <CODE>NewGWorld</CODE>--that is, it creates an offscreen graphics world where the base address for the offscreen pixel image is unpurgeable, it uses an existing <CODE>GDevice</CODE> record (if you pass 0 in the <CODE>depth</CODE> parameter) or creates a new <CODE>GDevice</CODE> record, it uses memory in your application heap, and it allows graphics accelerators to cache the offscreen pixel image. The available flags are described here:
</DL>
<PRE>
TYPE GWorldFlags = 
SET OF (       {flags for only NewGWorld are listed here}
 pixPurge,     {make base address for offscreen pixel }
               { image purgeable}
 noNewDevice,  {do not create an offscreen GDevice }
               { record}
 useTempMem,   {create base address for offscreen pixel }
               { image in temporary memory}
 keepLocal,    {keep offscreen pixel image in main }
               { memory where it cannot be cached to }
               { a graphics accelerator card}
);
</PRE>
<A NAME=HEADING311-10></A>
<H5>DESCRIPTION</H5>
 The <CODE>NewGWorld</CODE> function creates an offscreen graphics world with the pixel depth you specify in the <CODE>pixelDepth</CODE> parameter, the boundary rectangle you specify in the <CODE>boundsRect</CODE> parameter, the color table you specify in the <CODE>cTable</CODE> parameter, and the options you specify in the <CODE>flags</CODE> parameter. The <CODE>NewGWorld</CODE> function returns a pointer to the new offscreen graphics world in the <CODE>offscreenGWorld</CODE> parameter. You use this pointer when referring to this new offscreen world in other routines described in this chapter.<P>
 Typically, you pass 0 in the <CODE>pixelDepth</CODE> parameter, a window's port rectangle in the <CODE>boundsRect</CODE> parameter, <CODE>NIL</CODE> in the <CODE>cTable</CODE> and <CODE>aGDevice</CODE> parameters, and--in the <CODE>flags</CODE> parameter--an empty set ([ ]) for Pascal code or 0 for C code. This provides your application with the default behavior of <CODE>NewGWorld</CODE>, and it supports computers running basic QuickDraw. This also allows QuickDraw to optimize the <CODE>CopyBits</CODE>, <CODE>CopyMask</CODE>, and <CODE>CopyDeepMask</CODE> procedures when your application copies the image in an offscreen graphics world into an onscreen graphics port.<P>
 The <CODE>NewGWorld</CODE> function allocates memory for an offscreen graphics port and its pixel map. On computers that support only basic QuickDraw, <CODE>NewGWorld</CODE> creates a 1-bit pixel map that your application can manipulate using other relevant routines described in this chapter. Your application can copy this 1-bit pixel map into basic graphics ports.<P>
 Unless you specify 0 in the <CODE>pixelDepth</CODE> parameter--or pass the <CODE>noNewDevice</CODE> flag in the <CODE>flags</CODE> parameter and supply a <CODE>GDevice</CODE> record in the <CODE>aGDevice</CODE> parameter--<CODE>NewGWorld</CODE> also allocates a new offscreen <CODE>GDevice</CODE> record. <P>
 When creating an image, your application can use the <CODE>NewGWorld</CODE> function to create an offscreen graphics world that is optimized for an image's characteristics--for example, its best pixel depth. After creating the image, your application can then use the <CODE>CopyBits</CODE>, <CODE>CopyMask</CODE>, or <CODE>CopyDeepMask</CODE> procedure to copy that image to an onscreen graphics port. Color QuickDraw automatically renders the image at the best available pixel depth for the screen. Creating an image in an offscreen graphics port and then copying it to the screen in this way prevents the visual choppiness that would otherwise occur if your application were to build a complex image directly onscreen.<P>
 The <CODE>NewGWorld</CODE> function initializes the offscreen graphics port by calling the <CODE>OpenCPort</CODE> function. The <CODE>NewGWorld</CODE> function sets the offscreen graphics port's visible region to a rectangular region coincident with its boundary rectangle. The <CODE>NewGWorld</CODE> function generates an inverse table with the Color Manager procedure <CODE>MakeITable</CODE>, unless one of the <CODE>GDevice</CODE> records for the screens has the same color table as the <CODE>GDevice</CODE> record for the offscreen world, in which case <CODE>NewGWorld</CODE> uses the inverse table from that <CODE>GDevice</CODE> record.<P>
 The address of the offscreen pixel image is not directly accessible from the <CODE>PixMap</CODE> record for the offscreen graphics world. However, you can use the <CODE>GetPixBaseAddr</CODE> function (described on <A HREF=QuickDraw-329.html#MARKER-9-229>page 6-38</A>) to get a pointer to the beginning of the offscreen pixel image. <P>
 For purposes of estimating memory use, you can compute the size of the offscreen pixel image by using this formula:<P>
<PRE>
rowBytes * (boundsRect.bottom - boundsRect.top)
</PRE>
 In the <CODE>flags</CODE> parameter, you can specify several options that are defined by the <CODE>GWorldFlags</CODE> data type. If you don't wish to use any of these options, pass an empty set ([ ]) in the <CODE>flags</CODE> parameter for Pascal code or pass 0 here for C code.<P>
<UL>
<LI>If you specify the <CODE>pixPurge</CODE> flag, <CODE>NewGWorld</CODE> stores the offscreen pixel image in a purgeable block of memory. In this case, before drawing to or from the offscreen pixel image, your application should call the <CODE>LockPixels</CODE> function (described on <A HREF=QuickDraw-323.html#MARKER-9-191>page 6-32</A>) and ensure that it returns <CODE>TRUE</CODE>. If <CODE>LockPixels</CODE> returns <CODE>FALSE</CODE>, the memory for the pixel image has been purged, and your application should either call <CODE>UpdateGWorld</CODE> to reallocate it and then reconstruct the pixel image, or draw directly in a window instead of preparing the image in an offscreen graphics world. Never draw to or copy from an offscreen pixel image that has been purged without reallocating its memory and then reconstructing it.<A NAME=MARKER-2-51></A>
<LI>If you specify the <CODE>noNewDevice</CODE> flag, <CODE>NewGWorld</CODE> does not create a new offscreen <CODE>GDevice</CODE> record. Instead, it uses the <CODE>GDevice</CODE> record that you specify in the <CODE>aGDevice</CODE> parameter--and its associated pixel depth and color table--to create the offscreen graphics world. (If you set the <CODE>pixelDepth</CODE> parameter to 0, <CODE>NewGWorld</CODE> uses the <CODE>GDevice</CODE> record for the screen with the greatest pixel depth among all screens whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter--even if you specify the <CODE>noNewDevice</CODE> flag.) The <CODE>NewGWorld</CODE> function keeps a reference to the <CODE>GDevice</CODE> record for the offscreen graphics world, and the <CODE>SetGWorld</CODE> procedure (described on <A HREF=QuickDraw-319.html#MARKER-9-164>page 6-28</A>) uses that record to set the current graphics device. <A NAME=MARKER-2-53></A>
<LI>If you set the <CODE>useTempMem</CODE> flag, <CODE>NewGWorld</CODE> creates the base address for an offscreen pixel image in temporary memory. You generally would not use this flag, because you should use temporary memory only for fleeting purposes and only with the <CODE>AllowPurgePixels</CODE> procedure (described on <A HREF=QuickDraw-325.html#MARKER-9-203>page 6-34</A>).<A NAME=MARKER-2-56></A>
<LI>If you specify the <CODE>keepLocal</CODE> flag, your offscreen pixel image is kept in Macintosh main memory and is not cached to a graphics accelerator card. Use this flag carefully, as it negates the advantages provided by any graphics acceleration card that might be present.<A NAME=MARKER-2-7></A><P>
</UL>
 As its function result, <CODE>NewGWorld</CODE> returns one of three result codes.<P>
<A NAME=HEADING311-26></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 If you supply a handle to a <CODE>ColorTable</CODE> record in the <CODE>cTable</CODE> parameter, <CODE>NewGWorld</CODE> makes a copy of the record and stores its handle in the offscreen <CODE>PixMap</CODE> record. It is your application's responsibility to make sure that the <CODE>ColorTable</CODE> record you specify in the <CODE>cTable</CODE> parameter is valid for the offscreen graphics port's pixel depth. <P>
 If when using <CODE>NewGWorld</CODE> you specify a pixel depth, color table, or <CODE>GDevice</CODE> record that differs from those used by the window into which you copy your offscreen image, the <CODE>CopyBits</CODE>, <CODE>CopyMask</CODE>, and <CODE>CopyDeepMask</CODE> procedures require extra time to complete.<P>
 To use a custom color table in an offscreen graphics world, you need to create the associated offscreen <CODE>GDevice</CODE> record, because Color QuickDraw needs its inverse table. <P>
 The <CODE>NewGWorld</CODE> function may move or purge memory blocks in the application heap. Your application should not call this function at interrupt time.<P>
<A NAME=HEADING311-31></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The trap macro and routine selector for the <CODE>NewGWorld</CODE> function are
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Trap macro<TH>Selector<TR>
<TD>_QDExtensions<TD>$00160000</TABLE>
<P>
<A NAME=HEADING311-33></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>paramErr<TD>-50<TD>Illegal parameter<TR>
<TD>cDepthErr<TD>-157<TD>Invalid pixel depth</TABLE>
</H5>
<A NAME=HEADING311-34></A>
<H5>SEE ALSO</H5>
 <A HREF=QuickDraw-304.html#MARKER-9-27>Listing 6-1 on page 6-5</A> and <A HREF=QuickDraw-304.html#MARKER-9-59>Listing 6-2 on page 6-10</A> illustrate how to use <CODE>NewGWorld</CODE> to create offscreen graphics worlds.<P>
 If your application needs to change the pixel depth, boundary rectangle, or color table for an offscreen graphics world, use the <CODE>UpdateGWorld</CODE> function, described on <A HREF=QuickDraw-314.html#MARKER-9-136>page 6-23</A>.<A NAME=MARKER-2-184></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-310.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-312.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
