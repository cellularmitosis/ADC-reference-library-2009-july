<html><head><title>Mac OS X
 Manual Page For dn_expand(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/dn_expand" title="Mac OS X
 Manual Page for dn_expand(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/dn_expand"; name=dn_expand(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
RESOLVER(3)              BSD Library Functions Manual              <!-- a -->RESOLVER(3)<!-- /a -->

<b>NAME</b>
     <b>res_query</b>, <b>res_search</b>, <b>res_mkquery</b>, <b>res_send</b>, <b>res_init</b>, <b>dn_comp</b>, <b>dn_expand</b>, <b>dn_skipname</b>, <b>ns_get16</b>,
     <b>ns_get32</b>, <b>ns_put16</b>, <b>ns_put32</b> -- resolver routines

<b>LIBRARY</b>
     DNS Resolver Library (libresolv, -lresolv)

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/types.h&gt;</b>
     <b>#include</b> <b>&lt;netinet/in.h&gt;</b>
     <b>#include</b> <b>&lt;arpa/nameser.h&gt;</b>
     <b>#include</b> <b>&lt;resolv.h&gt;</b>

     <u>int</u>
     <b>res_query</b>(<u>const</u> <u>char</u> <u>*dname</u>, <u>int</u> <u>class</u>, <u>int</u> <u>type</u>, <u>u</u><b>_</b><u>char</u> <u>*answer</u>, <u>int</u> <u>anslen</u>);

     <u>int</u>
     <b>res_search</b>(<u>const</u> <u>char</u> <u>*dname</u>, <u>int</u> <u>class</u>, <u>int</u> <u>type</u>, <u>u</u><b>_</b><u>char</u> <u>*answer</u>, <u>int</u> <u>anslen</u>);

     <u>int</u>
     <b>res_mkquery</b>(<u>int</u> <u>op</u>, <u>const</u> <u>char</u> <u>*dname</u>, <u>int</u> <u>class</u>, <u>int</u> <u>type</u>, <u>const</u> <u>u</u><b>_</b><u>char</u> <u>*data</u>, <u>int</u> <u>datalen</u>,
         <u>const</u> <u>u</u><b>_</b><u>char</u> <u>*newrr</u><b>_</b><u>in</u>, <u>u</u><b>_</b><u>char</u> <u>*buf</u>, <u>int</u> <u>buflen</u>);

     <u>int</u>
     <b>res_send</b>(<u>const</u> <u>u</u><b>_</b><u>char</u> <u>*msg</u>, <u>int</u> <u>msglen</u>, <u>u</u><b>_</b><u>char</u> <u>*answer</u>, <u>int</u> <u>anslen</u>);

     <u>int</u>
     <b>res_init</b>();

     <u>int</u>
     <b>dn_comp</b>(<u>const</u> <u>char</u> <u>*exp</u><b>_</b><u>dn</u>, <u>u</u><b>_</b><u>char</u> <u>*comp</u><b>_</b><u>dn</u>, <u>int</u> <u>length</u>, <u>u</u><b>_</b><u>char</u> <u>**dnptrs</u>, <u>u</u><b>_</b><u>char</u> <u>**lastdnptr</u>);

     <u>int</u>
     <b>dn_expand</b>(<u>const</u> <u>u</u><b>_</b><u>char</u> <u>*msg</u>, <u>const</u> <u>u</u><b>_</b><u>char</u> <u>*eomorig</u>, <u>const</u> <u>u</u><b>_</b><u>char</u> <u>*comp</u><b>_</b><u>dn</u>, <u>char</u> <u>*exp</u><b>_</b><u>dn</u>, <u>int</u> <u>length</u>);

     <u>int</u>
     <b>dn_skipname</b>(<u>const</u> <u>u</u><b>_</b><u>char</u> <u>*comp</u><b>_</b><u>dn</u>, <u>const</u> <u>u</u><b>_</b><u>char</u> <u>*eom</u>);

     <u>u</u><b>_</b><u>int</u>
     <b>ns_get16</b>(<u>const</u> <u>u</u><b>_</b><u>char</u> <u>*src</u>);

     <u>u</u><b>_</b><u>long</u>
     <b>ns_get32</b>(<u>const</u> <u>u</u><b>_</b><u>char</u> <u>*src</u>);

     <u>void</u>
     <b>ns_put16</b>(<u>u</u><b>_</b><u>int</u> <u>src</u>, <u>u</u><b>_</b><u>char</u> <u>*dst</u>);

     <u>void</u>
     <b>ns_put32</b>(<u>u</u><b>_</b><u>long</u> <u>src</u>, <u>u</u><b>_</b><u>char</u> <u>*dst</u>);

<b>DESCRIPTION</b>
     These routines are used for making, sending and interpreting query and reply messages with Internet
     domain name servers.

     These functions use numerical constants for class and type.  These constants can be found in
     &lt;arpa/nameserver.h&gt;.  Historical constants are available in &lt;arpa/nameser_compat.h&gt; and
     &lt;arpa/nameser8_compat.h&gt; for compatibility with older code.

     Global configuration and state information that is used by the resolver routines is kept in the struc-<font color="#ffffff" class="whiteout">ture&nbsp;structure</font>
     ture <b>_</b><u>res</u>.  Most of the values have reasonable defaults and can be ignored.  Options stored in
     <b>_</b><u>res.options</u> are defined in <u>resolv.h</u> and are as follows.  Options are stored as a simple bit mask con-<font color="#ffffff" class="whiteout">taining&nbsp;containing</font>
     taining the bitwise ``or'' of the options enabled.

     RES_INIT       True if the initial name server address and default domain name are initialized (i.e.,
                    <b>res_init</b>() has been called).

     RES_DEBUG      Print debugging messages.

     RES_AAONLY     Accept authoritative answers only.  With this option, <b>res_send</b>() should continue until
                    it finds an authoritative answer or finds an error.  Currently this is not implemented.

     RES_USEVC      Use TCP connections for queries instead of UDP datagrams.

     RES_STAYOPEN   Used with RES_USEVC to keep the TCP connection open between queries.  This is useful
                    only in programs that regularly do many queries.  UDP should be the normal mode used.

     RES_IGNTC      Unused currently (ignore truncation errors, i.e., don't retry with TCP).

     RES_RECURSE    Set the recursion-desired bit in queries.  This is the default.  (<b>res_send</b>() does not do
                    iterative queries and expects the name server to handle recursion.)

     RES_DEFNAMES   If set, <b>res_search</b>() will append the default domain name to single-component names
                    (those that do not contain a dot).  This option is enabled by default.

     RES_DNSRCH     If this option is set, <b>res_search</b>() will search for host names in the current domain and
                    in parent domains; see <a href="../man7/hostname.7.html#//apple_ref/doc/man/7/hostname">hostname(7)</a>.  This is used by the standard host lookup routine
                    <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a>.  This option is enabled by default.

     RES_NOALIASES  This option turns off the user level aliasing feature controlled by the ``HOSTALIASES''
                    environment variable.  Network daemons should set this option.

     RES_USE_INET6  Enables support for IPv6-only applications.  This causes IPv4 addresses to be returned
                    as an IPv4 mapped address.  For example, 10.1.1.1 will be returned as ::ffff:10.1.1.1.
                    The option is meaningful with certain kernel configuration only.

     RES_USE_EDNS0  Enables support for OPT pseudo-RR for EDNS0 extension.  With the option, resolver code
                    will attach OPT pseudo-RR into DNS queries, to inform of our receive buffer size.  The
                    option will allow DNS servers to take advantage of non-default receive buffer size, and
                    to send larger replies.  DNS query packets with EDNS0 extension is not compatible with
                    non-EDNS0 DNS servers.

     The <b>res_init</b>() routine reads the configuration file (if any; see <a href="../man5/resolver.5.html#//apple_ref/doc/man/5/resolver">resolver(5)</a>) to get the default domain
     name, search list and the Internet address of the local name <!-- a -->server(s)<!-- /a -->.  If no server is configured,
     the host running the resolver is tried.  The current domain name is defined by the hostname if not
     specified in the configuration file; it can be overridden by the environment variable LOCALDOMAIN.
     This environment variable may contain several blank-separated tokens if you wish to override the <u>search</u>
     <u>list</u> on a per-process basis.  This is similar to the <u>search</u> command in the configuration file.  Another
     environment variable ``RES_OPTIONS'' can be set to override certain internal resolver options which are
     otherwise set by changing fields in the <b>_</b><u>res</u> structure or are inherited from the configuration file's
     <u>options</u> command.  The syntax of the ``RES_OPTIONS'' environment variable is explained in <a href="../man5/resolver.5.html#//apple_ref/doc/man/5/resolver">resolver(5)</a>.
     Initialization normally occurs on the first call to one of the following routines.

     The <b>res_query</b>() function provides an interface to the server query mechanism.  It constructs a query,
     sends it to the local server, awaits a response, and makes preliminary checks on the reply.  The query
     requests information of the specified <u>type</u> and <u>class</u> for the specified fully-qualified domain name
     <u>dname</u>.  The reply message is left in the <u>answer</u> buffer with length <u>anslen</u> supplied by the caller.

     The <b>res_search</b>() routine makes a query and awaits a response like <b>res_query</b>(), but in addition, it
     implements the default and search rules controlled by the RES_DEFNAMES and RES_DNSRCH options.  It
     returns the first successful reply.

     The remaining routines are lower-level routines used by <b>res_query</b>().  The <b>res_mkquery</b>() function con-<font color="#ffffff" class="whiteout">structs&nbsp;constructs</font>
     structs a standard query message and places it in <u>buf</u>.  It returns the size of the query, or -1 if the
     query is larger than <u>buflen</u>.  The query type <u>op</u> is usually QUERY, but can be any of the query types
     defined in &lt;<u>arpa/nameser.h&gt;</u>.  The domain name for the query is given by <u>dname</u>.  <u>Newrr</u> is currently
     unused but is intended for making update messages.

     The <b>res_send</b>() routine sends a pre-formatted query and returns an answer.  It will call <b>res_init</b>() if
     RES_INIT is not set, send the query to the local name server, and handle timeouts and retries.  The
     length of the reply message is returned, or -1 if there were errors.

     The <b>dn_comp</b>() function compresses the domain name <u>exp</u><b>_</b><u>dn</u> and stores it in <u>comp</u><b>_</b><u>dn</u>.  The size of the
     compressed name is returned or -1 if there were errors.  The size of the array pointed to by <u>comp</u><b>_</b><u>dn</u> is
     given by <u>length</u>.  The compression uses an array of pointers <u>dnptrs</u> to previously-compressed names in
     the current message.  The first pointer points to the beginning of the message and the list ends with
     NULL.  The limit to the array is specified by <u>lastdnptr</u>.  A side effect of <b>dn_comp</b>() is to update the
     list of pointers for labels inserted into the message as the name is compressed.  If <u>dnptr</u> is NULL,
     names are not compressed.  If <u>lastdnptr</u> is NULL, the list of labels is not updated.

     The <b>dn_expand</b>() entry expands the compressed domain name <u>comp</u><b>_</b><u>dn</u> to a full domain name The compressed
     name is contained in a query or reply message; <u>msg</u> is a pointer to the beginning of the message.  The
     uncompressed name is placed in the buffer indicated by <u>exp</u><b>_</b><u>dn</u> which is of size <u>length</u>.  The size of
     compressed name is returned or -1 if there was an error.

     The <b>dn_skipname</b>() function skips over a compressed domain name, which starts at a location pointed to
     by <u>comp</u><b>_</b><u>dn</u>.  The compressed name is contained in a query or reply message; <u>eom</u> is a pointer to the end
     of the message.  The size of compressed name is returned or -1 if there was an error.

     The <b>ns_get16</b>() function gets a 16-bit quantity from a buffer pointed to by <u>src</u>.

     The <b>ns_get32</b>() function gets a 32-bit quantity from a buffer pointed to by <u>src</u>.

     The <b>ns_put16</b>() function puts a 16-bit quantity <u>src</u> to a buffer pointed to by <u>dst</u>.

     The <b>ns_put32</b>() function puts a 32-bit quantity <u>src</u> to a buffer pointed to by <u>dst</u>.

<b>FILES</b>
     /etc/resolv.conf  The configuration file, see <a href="../man5/resolver.5.html#//apple_ref/doc/man/5/resolver">resolver(5)</a>.

<b>SEE</b> <b>ALSO</b>
     <a href="gethostbyname.3.html#//apple_ref/doc/man/3/gethostbyname">gethostbyname(3)</a>, <a href="../man5/resolver.5.html#//apple_ref/doc/man/5/resolver">resolver(5)</a>, <a href="../man7/hostname.7.html#//apple_ref/doc/man/7/hostname">hostname(7)</a>, <a href="../man8/named.8.html#//apple_ref/doc/man/8/named">named(8)</a>

     <u>RFC1032</u>, <u>RFC1033</u>, <u>RFC1034</u>, <u>RFC1035</u>, <u>RFC974</u>

     <u>Name</u> <u>Server</u> <u>Operations</u> <u>Guide</u> <u>for</u> <u>BIND</u>.

<b>HISTORY</b>
     The <b>res_query</b> function appeared in 4.3BSD.

BSD                              June 4, 1993                              BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/dn_expand.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/dn_expand.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/dn_expand.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
