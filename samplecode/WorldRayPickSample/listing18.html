<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>WorldRayPickSample - /Source/WRay_Pick.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">WorldRayPickSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">WorldRayPickSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/WRay_Pick.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Headers/WRay_Document.h</option>
<option value="listing2.html">/Headers/WRay_Error.h</option>
<option value="listing3.html">/Headers/WRay_Events.h</option>
<option value="listing4.html">/Headers/WRay_Main.h</option>
<option value="listing5.html">/Headers/WRay_Memory.h</option>
<option value="listing6.html">/Headers/WRay_Menu.h</option>
<option value="listing7.html">/Headers/WRay_Message.h</option>
<option value="listing8.html">/Headers/WRay_Pick.h</option>
<option value="listing9.html">/Headers/WRay_Scene.h</option>
<option value="listing10.html">/Headers/WRay_System.h</option>
<option value="listing11.html">/Source/WRay_Document.c</option>
<option value="listing12.html">/Source/WRay_Error.c</option>
<option value="listing13.html">/Source/WRay_Events.c</option>
<option value="listing14.html">/Source/WRay_Main.c</option>
<option value="listing15.html">/Source/WRay_Memory.c</option>
<option value="listing16.html">/Source/WRay_Menu.c</option>
<option value="listing17.html">/Source/WRay_Message.c</option>
<option value="listing18.html">/Source/WRay_Pick.c</option>
<option value="listing19.html">/Source/WRay_Scene.c</option>
<option value="listing20.html">/Source/WRay_System.c</option></select>
				</p>
				</form>
				<p><strong><a href="WorldRayPickSample.zip">Download Sample</a></strong> (&#147;WorldRayPickSample.zip&#148;, 42.5K)<BR>
<strong><a href="WorldRayPickSample.dmg">Download Sample</a></strong> (&#147;WorldRayPickSample.dmg&#148;, 101.9K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  *  WRay_Pick.c * *  QuickDraw 3D 1.6 Sample *  Robert Dierkes * *   07/28/98  RDD    Created. *//*------------------*//*  Include Files  *//*------------------*/#include &quot;QD3D.h&quot;#include &quot;QD3DMath.h&quot;#include &quot;QD3DGroup.h&quot;#include &quot;QD3DPick.h&quot;#include &quot;QD3DTransform.h&quot;#include &quot;QD3DView.h&quot;#include &quot;WRay_Error.h&quot;#include &quot;WRay_Document.h&quot;#include &quot;WRay_Memory.h&quot;#include &quot;WRay_Scene.h&quot;#include &quot;WRay_System.h&quot;#include &quot;WRay_Pick.h&quot;#include &lt;math.h&gt;/*------------------*//*    Constants    *//*------------------*//*------------------*//*    Macros    *//*------------------*/#define  kFirstHit        0#define  kHitDistance      (kCylRadius + 0.01f)#define  HAS_Object(validMask)  ((validMask &amp; kQ3PickDetailMaskObject)  !=0)#define  HAS_Distance(validMask)  ((validMask &amp; kQ3PickDetailMaskDistance)!=0)/*----------------------*//*  Global Declarations  *//*----------------------*/static  TQ3PickObject    gPick = NULL;static  TQ3Ray3D      gWorldRay;static  TQ3Vector3D      gWorldDelta;static  TQ3GroupPosition  gBallGroupPosn  = NULL;static  TQ3GeometryObject  gBallGeo = NULL;static  TQ3GeometryObject  gCurGeoHit  = NULL;/*----------------------*//*  Local Prototypes  *//*----------------------*/staticTQ3PickObject Pick_New(      TQ3Ray3D      *pWorldRay);staticTQ3Status Pick_Document(      TDocumentPtr    pDoc,      TQ3PickObject    pickObj,      unsigned long     *pNumHits);staticTQ3Status Pick_InitializeWorldRay(      TQ3PickObject    pickObj,      TQ3Ray3D      *pWorldRay,      TQ3Vector3D      *pWorldDelta);staticTQ3Status Pick_ComputeReflectedWorldRay(      TQ3PickObject    pickObj,      TQ3Ray3D      *pWorldRay,      TQ3Vector3D      *pWorldDelta);staticTQ3GeometryObject Pick_CreateMovingObject(      TDocumentPtr    pDoc,      TQ3Ray3D      *pRay,      TQ3GroupPosition  *pGroupPosn);staticTQ3Status Pick_GetNearestObject(      TQ3PickObject    pickObj,      float        minDistance,      TQ3GeometryObject  *pGeoHit,      TQ3GeometryObject  *pPrevGeoHit);staticTQ3Status Pick_HighlightObject(      TDocumentPtr    pDoc,      TQ3GeometryObject  geoObj,      TQ3Boolean      doHighlight);/* *  Pick_Initialize */TQ3Boolean Pick_Initialize(  void){  TQ3Status  status = kQ3Failure;  gPick      = NULL;  gBallGroupPosn  = NULL;  gBallGeo    = NULL;  gCurGeoHit    = NULL;  Q3Point3D_Set(&amp;gWorldRay.origin,   0.0, 0.0, 0.0);  Q3Vector3D_Set(&amp;gWorldRay.direction, 0.0, 0.0, 1.0);  gPick = Pick_New(&amp;gWorldRay);  return (gPick != NULL) ? kQ3True : kQ3False;}/* *  Pick_Exit */TQ3Boolean Pick_Exit(  void){  Object_Dispose_NULL(&amp;gPick);  Object_Dispose_NULL(&amp;gBallGeo);  Object_Dispose_NULL(&amp;gCurGeoHit);  return kQ3True;}#pragma mark -/* *  Pick_New */TQ3PickObject Pick_New(  TQ3Ray3D      *pWorldRay){  TQ3WorldRayPickData  rayPickData;  TQ3PickObject    pickObject = NULL;  /*   * Tolerance values are only used for Point, Line, Ellipse,   * NURB Curve, PolyLine, Mesh geometries and are measured   * in world space.   */  #define  kVertexTolerance  0.01  #define  kEdgeTolerance    0.005  rayPickData.data.sort = kQ3PickSortNearToFar;  rayPickData.data.mask = kQ3PickDetailMaskObject    |              kQ3PickDetailMaskXYZ    |              kQ3PickDetailMaskDistance  |              kQ3PickDetailMaskNormal;  rayPickData.data.numHitsToReturn = 1;  /* Make sure ray is normalized */  Q3Vector3D_Normalize(&amp;pWorldRay-&gt;direction, &amp;pWorldRay-&gt;direction);  rayPickData.ray = *pWorldRay;  rayPickData.vertexTolerance  = kVertexTolerance;  rayPickData.edgeTolerance  = kEdgeTolerance;  /* Create the new world ray pick object */  pickObject = Q3WorldRayPick_New(&amp;rayPickData);  DEBUG_ASSERT(pickObject != NULL, Q3WorldRayPick_New);  return pickObject;}/* *  Pick_Document */staticTQ3Status Pick_Document(  TDocumentPtr    pDoc,  TQ3PickObject    pickObj,  unsigned long     *pNumHits){  TQ3Status    status = kQ3Success;  TQ3ViewStatus  viewStatus = kQ3ViewStatusError;  if (Q3View_StartPicking(pDoc-&gt;fView, pickObj) == kQ3Failure) {    ERROR_DEBUG_STR(&quot;Pick_Document: Q3View_StartPicking failed.&quot;);    return kQ3Failure;  }  do {    Document_Submit_Objects(pDoc, pDoc-&gt;fView);    viewStatus = Q3View_EndPicking(pDoc-&gt;fView);  }  while (viewStatus == kQ3ViewStatusRetraverse);  DEBUG_ASSERT(viewStatus == kQ3ViewStatusDone, Pick_Document);  status = Q3Pick_GetNumHits(pickObj, pNumHits);  return status;}#pragma mark -/* *  Pick_IsAnimating */TQ3Boolean Pick_IsAnimating(  void){  return (gBallGeo != NULL) ? kQ3True : kQ3False;}/* *  Pick_BeginAnimation */TQ3Status Pick_BeginAnimation(  TDocumentPtr    pDoc){  TQ3Status      status = kQ3Failure;  if (Pick_IsAnimating() == kQ3True) {    /* Animation already taking place */    return status;  }  /* Setup initial world ray origin and direction */  status = Pick_InitializeWorldRay(gPick, &amp;gWorldRay, &amp;gWorldDelta);  if (status == kQ3Failure) {    return status;  }  /* Create ball */  gBallGeo = Pick_CreateMovingObject(pDoc, &amp;gWorldRay, &amp;gBallGroupPosn);  DEBUG_ASSERT(gBallGeo != NULL, Pick_CreateMovingObject);  if (gBallGeo == NULL) {    return kQ3Failure;  }  return status;}/* *  Pick_Animate * *  Move ball through the scene avoiding objects using *  ray picking to check for geometries in its path. */TQ3Status Pick_Animate(  TDocumentPtr    pDoc){  TQ3Status      status  = kQ3Failure;  unsigned long    numHits;  TQ3GeometryObject  prevGeoHit  = NULL;  if (Pick_IsAnimating() == kQ3False) {    /* If animation hasn't started then do nothing */    return kQ3Failure;  }  /* Submit scene for picking */  status = Pick_Document(pDoc, gPick, &amp;numHits);  DEBUG_ASSERT(status == kQ3Success, Pick_Document);  if (numHits &gt; 0) {    status = Pick_GetNearestObject(gPick, kHitDistance, &amp;gCurGeoHit, &amp;prevGeoHit);    if (gCurGeoHit != prevGeoHit) {      if (prevGeoHit != NULL) {        /* Unhighlight the ball &amp; previous geometry */        Pick_HighlightObject(pDoc, gBallGeo, kQ3False);        Pick_HighlightObject(pDoc, prevGeoHit, kQ3False);        Object_Dispose_NULL(&amp;prevGeoHit);      }      if (gCurGeoHit != NULL) {        /* Highlight the ball &amp; the new closest geometry*/        Pick_HighlightObject(pDoc, gBallGeo, kQ3True);        Pick_HighlightObject(pDoc, gCurGeoHit, kQ3True);        /* status = */ Pick_ComputeReflectedWorldRay(gPick, &amp;gWorldRay, &amp;gWorldDelta);        System_Sound();      }    }  }  else {    /* Nothing hit */    if (gCurGeoHit != NULL) {      /* Unhighlight the ball &amp; current geometry */      Pick_HighlightObject(pDoc, gBallGeo, kQ3False);      Pick_HighlightObject(pDoc, gCurGeoHit, kQ3False);      Object_Dispose_NULL(&amp;gCurGeoHit);    }  }  Q3Pick_EmptyHitList(gPick);  /* Advance ball by delta amount */  Q3Point3D_Vector3D_Add(&amp;gWorldRay.origin, &amp;gWorldDelta, &amp;gWorldRay.origin);  Q3Ellipsoid_SetOrigin(gBallGeo, &amp;gWorldRay.origin);  /* Set ray again */  status = Q3WorldRayPick_SetRay(gPick, &amp;gWorldRay);  DEBUG_ASSERT(status == kQ3Success, Q3WorldRayPick_SetRay);  return status;}/* *  Pick_EndAnimation */TQ3Status Pick_EndAnimation(  TDocumentPtr    pDoc){  if (Pick_IsAnimating() == kQ3False) {    /* Animation not taking place */    return kQ3Failure;  }  /* Unhighlight anything that's still highlighted */  if (gCurGeoHit != NULL) {    /* Unhighlight the ball &amp; current geometry */    Pick_HighlightObject(pDoc, gBallGeo, kQ3False);    Pick_HighlightObject(pDoc, gCurGeoHit, kQ3False);    Object_Dispose_NULL(&amp;gCurGeoHit);  }  Object_Dispose_NULL(&amp;gBallGeo);  /* Remove temporary ball group from main group */  if (gBallGroupPosn != NULL) {    DEBUG_ASSERT(gCurGeoHit == NULL, Pick_EndAnimation);    gCurGeoHit = Q3Group_RemovePosition (pDoc-&gt;fModel, gBallGroupPosn);    Object_Dispose_NULL(&amp;gCurGeoHit);    gBallGroupPosn = NULL;  }  Document_Draw(pDoc);  return kQ3Success;}#pragma mark -/* *  Pick_InitializeWorldRay * *  Create an world delta vector with a random direction with a *  magnitude that controls the rate.  Normalize this vector to *  make the actual world ray. The world ray is initially positioned *  at the origin. */staticTQ3Status Pick_InitializeWorldRay(  TQ3PickObject    pickObj,  TQ3Ray3D      *pWorldRay,  TQ3Vector3D      *pWorldDelta){  TQ3Status      status = kQ3Failure;  Q3Point3D_Set(&amp;pWorldRay-&gt;origin, 0.0, 0.0, 0.0);  /* Generate a random vector in XY plane */  Q3Vector3D_Set(pWorldDelta, System_RandomFloat(), System_RandomFloat(), 0.0);  Q3Vector3D_Normalize(pWorldDelta, &amp;pWorldRay-&gt;direction);  /* Set world ray's origin and direction */  status = Q3WorldRayPick_SetRay(pickObj, pWorldRay);  DEBUG_ASSERT(status == kQ3Success, Q3WorldRayPick_SetRay);  return status;}/* *  Pick_ComputeReflectedWorldRay * *  Given:  pDelta, pRay-&gt;direction (a normalized pDelta), normal *  Find:  new pDelta with a negative angle relative to the angle between delta and normal * *      ++ *       /!|\ *      / !| \ *     / N!|  \ *    D /   !|   \ D' *     /    V|    \ *    /      |     \ *   /     D1|      \ *  v&lt;-----  V -----&gt;v *      D2     D2' * *  !  N  = Normal *  /  D  = Delta *  |  D1 = Delta component *  -  D2 = Delta component *  \  D' = Reflection of D *    c  = scalar for D projection onto N * *        D * N *    c = -----  but since N * N = 1 then  c = D * N *      N * N * *    D  = D1 + D2 *    D1 = cN * *    D  = cN + D2  therefore *    D2 = D - cN * *    D2' = Negate(D2) *    D' = D1 + D2' */staticTQ3Status Pick_ComputeReflectedWorldRay(  TQ3PickObject    pickObj,  TQ3Ray3D      *pWorldRay,  TQ3Vector3D      *pWorldDelta){  TQ3Status      status;  TQ3Vector3D      normal,            newDelta,            delta1,            delta2;  float        c;  status = Q3Pick_GetPickDetailData (pickObj, kFirstHit, kQ3PickDetailMaskNormal, &amp;normal);  DEBUG_ASSERT(status == kQ3Success, Q3Pick_GetPickDetailData);  if (status == kQ3Failure) {    return status;  }  /* We negate pWorldDelta to reverse it's direction giving us the newDelta */  Q3Vector3D_Negate(pWorldDelta, &amp;newDelta);  /* Compute delta1 by projecting delta onto normal */  c = Q3Vector3D_Dot(&amp;newDelta, &amp;normal);  Q3Vector3D_Scale(&amp;normal, c, &amp;delta1);  Q3Vector3D_Subtract(&amp;newDelta, &amp;delta1, &amp;delta2);  /* Compute deltaPrime from delta1 and negated delta2. This is delta reflected through the normal */  Q3Vector3D_Negate(&amp;delta2, &amp;delta2);  Q3Vector3D_Add(&amp;delta1, &amp;delta2, pWorldDelta);  /* Make sure pick ray is normalized */  Q3Vector3D_Normalize(pWorldDelta, &amp;pWorldRay-&gt;direction);  return status;}#pragma mark -/* *  Pick_CreateMovingObject */staticTQ3GeometryObject Pick_CreateMovingObject(      TDocumentPtr    pDoc,      TQ3Ray3D      *pRay,      TQ3GroupPosition  *pGroupPosn){  TQ3EllipsoidData  data;  TQ3GeometryObject  geometry = NULL;  TQ3AttributeSet    attr   = NULL;  TQ3GroupObject    group   = NULL;  #define  kObjectRadius    (kCylRadius * 0.95f)  #define  kDefaultObjectColor  0.8, 0.8, 0.0  data.origin  = pRay-&gt;origin;  data.orientation.x = 0.0;  data.orientation.y = kObjectRadius;  data.orientation.z = 0.0;  data.majorRadius.x = 0.0;  data.majorRadius.y = 0.0;  data.majorRadius.z = kObjectRadius;  data.minorRadius.x = kObjectRadius;  data.minorRadius.y = 0.0;  data.minorRadius.z = 0.0;  data.uMin = data.vMin = 0.0f;  data.uMax = data.vMax = 1.0f;  data.caps = kQ3EndCapNone;  data.interiorAttributeSet  = NULL;  data.ellipsoidAttributeSet  = NULL;  attr = Q3AttributeSet_New ();  if (attr != NULL) {    TQ3ColorRGB  color = { kDefaultObjectColor };    data.ellipsoidAttributeSet = attr;    Q3AttributeSet_Add(attr, kQ3AttributeTypeDiffuseColor, &amp;color);    geometry = Q3Ellipsoid_New(&amp;data);    DEBUG_ASSERT(geometry != NULL, Q3Ellipsoid_New);    Object_Dispose_NULL(&amp;attr);  }  /* Put geometry in an unpickable group */  group = Q3OrderedDisplayGroup_New();  DEBUG_ASSERT(group != NULL, Q3OrderedDisplayGroup_New);  if (group != NULL) {    TQ3DisplayGroupState  state;    if (Q3DisplayGroup_GetState(group, &amp;state) == kQ3Success) {      state &amp;= ~kQ3DisplayGroupStateMaskIsPicked;      Q3DisplayGroup_SetState(group, state);    }    /* Add geometry to group but don't decrement reference */    Q3Group_AddObject(group, geometry);    /* Add group to main group */    *pGroupPosn = Q3Group_AddObject(pDoc-&gt;fModel, group);    Object_Dispose_NULL(&amp;group);  }  else {    /* Error */    Object_Dispose_NULL(&amp;geometry);  }  return geometry;}/* *  Pick_GetNearestObject * *  Find and return object hit if it's within minDistance. * *  In this sample code since we're picking with a single ray *  and our moving object is several units wide portions of *  this object may pass through other objects because we're *  testing with a ray cast from the center of our moving object *  rather than near it's outer extents. */staticTQ3Status Pick_GetNearestObject(  TQ3PickObject    pickObj,  float        minDistance,  TQ3GeometryObject  *pGeoHit,  TQ3GeometryObject  *pPrevGeoHit){  TQ3Status      status  = kQ3Failure;  TQ3PickDetail    pickDetailValidMask;  float        distance;  TQ3GeometryObject  objectHit = NULL;  #define  kDistanceTolerance  0.025    /* TODO This may need refinement */  status = Q3Pick_GetPickDetailValidMask(pickObj, kFirstHit, &amp;pickDetailValidMask);  /* Get distance from ray to intersected geometry */  if (HAS_Distance(pickDetailValidMask)) {    status = Q3Pick_GetPickDetailData (pickObj, kFirstHit, kQ3PickDetailMaskDistance, &amp;distance);    DEBUG_ASSERT(status == kQ3Success, Q3Pick_GetPickDetailData);    /* Is this geometry within &quot;minDistance&quot;? */    if ((distance &lt;= (minDistance - kDistanceTolerance))  ||      (distance &lt;= (minDistance + kDistanceTolerance)))    {      if (HAS_Object(pickDetailValidMask)) {        /* Get the object */        status = Q3Pick_GetPickDetailData (pickObj, kFirstHit, kQ3PickDetailMaskObject, &amp;objectHit);        if (objectHit == *pGeoHit) {          /* We've hit the same geometry */          Object_Dispose_NULL(&amp;objectHit);        }        else {          /* Return new geometry hit */          *pPrevGeoHit = *pGeoHit;  /* Need to unhighlight this if non-NULL */          *pGeoHit     = objectHit;        }      }    }    else {      *pPrevGeoHit = *pGeoHit;  /* Need to unhighlight this if non-NULL */      *pGeoHit     = NULL;    }  }  return status;}/* *  Pick_HighlightObject */staticTQ3Status Pick_HighlightObject(  TDocumentPtr    pDoc,  TQ3GeometryObject  geoObj,  TQ3Boolean      doHighlight){  TQ3Status      status  = kQ3Failure;  TQ3AttributeSet    attr  = NULL;  TQ3Switch      isHighlighted = kQ3On;  TQ3Boolean      doesContain,            doUpdate = kQ3False;  DEBUG_ASSERT(pDoc != NULL, Pick_HighlightObject);  DEBUG_ASSERT(geoObj != NULL, Pick_HighlightObject);  status = Q3Geometry_GetAttributeSet(geoObj, &amp;attr);  DEBUG_ASSERT(status == kQ3Success, Q3Geometry_GetAttributeSet);  DEBUG_ASSERT(attr != NULL, Q3Geometry_GetAttributeSet__attr);  if (status == kQ3Success) {    if (attr != NULL) {      doesContain = Q3AttributeSet_Contains(              attr, kQ3AttributeTypeHighlightState);      /* Add highlight if geometry doesn't contain one */      if (doHighlight == kQ3True) {        if (doesContain == kQ3False) {          Q3AttributeSet_Add(                attr, kQ3AttributeTypeHighlightState, &amp;isHighlighted);          doUpdate = kQ3True;        }      }      else {        /* Remove highlight if there is one */        if (doesContain == kQ3True) {          Q3AttributeSet_Clear(                attr, kQ3AttributeTypeHighlightState);          doUpdate = kQ3True;        }      }      if (doUpdate == kQ3True) {        status = Q3Geometry_SetAttributeSet(geoObj, attr);        DEBUG_ASSERT(status == kQ3Success, Q3Geometry_SetAttributeSet);        Document_Draw(pDoc);      }    }  }  Object_Dispose_NULL(&amp;attr);  return status;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/WorldRayPickSample/listing18.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/WorldRayPickSample/listing18.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/WorldRayPickSample/listing18.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>