<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1136: MicroBug: The ROM Debugger</title>       <meta name="keywords" content="Mac OS 8 MicroBug ROM debugger commands expressions dump memory">    <meta name="Description" content="Technical Note TN1136: This Technical Note describes thefeatures of MicroBug, the ROM debugger present in all Macintoshesfrom the Mac  Plus onward. Along with the history of MicroBug,MicroBug commands, expressions and MicroBug Esoteria (e.g.force quitting) is discussed."><meta name="categories" content="Platforms and Tools"><meta name="week-posted" content="Aug 31, 1998 - Sep 4, 1998"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002975" title="MicroBug: The ROM Debugger"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1136</div>
<div id="pageheadsub">MicroBug: The ROM Debugger</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box -->         <table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>        </tr>        <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left>       <span id="menutitle">                            CONTENTS   <br>  <br>       </span>   </td>        </tr>        <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left>       <!-- begin_toc -->       <p id="menutext">              <A HREF = "#AboutMicroBug">About MicroBug</A><BR><BR>       <A HREF = "#MicroBugCommands">MicroBug         Commands</A><BR><BR>                  <A HREF = "#MicroBugEsoterica">MicroBug         Esoterica</A><BR><BR>                  <A HREF = "#Summary">Summary</A><BR><BR><A HREF = "#References">References</A><BR><BR><A HREF = "#Changes">Change History</A><BR><BR><A HREF = "#Downloads">Downloadables</A></p><!-- end_toc --></td>        </tr>        <tr>   <td width=300 align=left scope="row">       <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>        </tr>    </table></td><td width=300 valign="top" align=left>            <!-- begin_intro_text -->               <P id = "introtext">This Technote         describes the features of MicroBug, the ROM debugger present         in all Macintoshes from the Mac Plus onward.</P>         <P id = "introtext">This Note is directed at bored developers looking for         something historically interesting to read on the train         going home after a hard day's coding. It's also directed at         developers trying to debug a problem that disappears when         they install MacsBug.</p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Sep 28 1998]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content -->         <P><A NAME="AboutMicroBug"></A></P>                  <H2>About MicroBug</H2>                  <P>MicroBug was first introduced with the Mac Plus and has         been a standard component in the ROM of all Mac OS computers         since then. MicroBug is invoked when the system takes a         Non-Maskable Interrupt (NMI) and there is no other debugger         (e.g., MacsBug) installed.</P>                  <P>MicroBug is not present on the Macintosh 128, Macintosh         512, and Macintosh XL computers.</P>                  <H3>Environment</H3>                  <P>MicroBug uses standard system services to operate its         user interface. Specifically, MicroBug uses         <a href="http://developer.apple.com/documentation/mac/QuickDraw/QuickDraw-2.html">QuickDraw</A>         to draw its window and the         <a href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-28.html">Event         Manager</A> to get keyboard events. Internally, it shares a         lot of code with the         <a href="http://developer.apple.com/documentation/mac/OSUtilities/OSUtilities-28.html">System         Error Handler</A>. This stands in contrast to MacsBug, which         uses its own low-level drawing and input handling routines.         The upshot is that MicroBug is less likely to be functional         in the face of a "damaged" system than MacsBug.</P>                  <H3>Expressions</H3>                  <P>MicroBug expressions consist of:</P>                  <DL>            <DT>hex number (with or without a leading "$")</DT>                        <DD>Yields the value of the hex number.</DD>                        <DT>"."</DT>                        <DD>Yields the dot address. This address is initially set            to 0 and is subsequently set by <CODE>DM</CODE> and <CODE>SM</CODE> commands.</dd>                        <DT>@ &lt;expr&gt;</DT>                        <DD>Yields the value of the memory at &lt;expr&gt;.</DD>                        <DT>RA<CODE>x</CODE></DT>                        <DD>Yields the contents of 680x0 address register            A<CODE>x</CODE> .</DD>                        <DT>RD<CODE>x</CODE></DT>                        <DD>Yields the contents of 680x0 address register            D<CODE>x</CODE> .</DD>                        <DT>PC</DT>                        <DD>Yields the contents of the 680x0 Program Counter            register.</DD>                        <DT>- &lt;expr&gt;</DT>                        <DD>Yields &lt;expr&gt; negated.</DD>                        <DT>&lt;expr&gt; + &lt;expr&gt;</DT>                        <DD>Yields the sum of the two expressions.</DD>                        <DT>&lt;expr&gt; - &lt;expr&gt;</DT>                        <DD>Yields the difference of the two expressions.</DD>         </DL>                  <P>All expressions have an inherent size, which is the         number of valid bytes the expression returns. The size of a         hex number is determined by the number of hex digits in the         number. One or two hex digits yields a size of one (1) byte,         three or four hex digits yields a size of two (2) bytes, and         five or more hex digits yields a size of four (4) bytes.         </P>                  <P>The size of ".", indirect, and all register expressions         is four (4) bytes.</P>                  <P>The size of an arithmetic expression is the maximum of         the size of the components.</p><BR><P><A HREF="#top">Back to top</A></P>         <P><A NAME="MicroBugCommands"></A></P>                  <H2>MicroBug Commands</H2>                  <H3>Dump Memory</H3>                  <BLOCKQUOTE><P><CODE>DM addr</CODE></P>                  <P><CODE>DM</CODE></P></BLOCKQUOTE>                  <P>With an argument, the dump memory command dumps the         contents of memory at the address specified by         <CODE>addr</CODE> . Without an argument, the dump memory         command continues dumping memory from the memory location         where the previous dump memory command left off.</P>                  <P>Both variants set the dot address to the address where         the dump started.</P>                  <P>Typing Return after entering this command will continue         dumping memory.</P>                  <H3>Set Memory</H3>                  <BLOCKQUOTE><P><CODE>SM addr</CODE> <CODE>expr</CODE>...         </P></BLOCKQUOTE>                  <P>The set memory command sets the contents of memory,         starting at the address specified by <CODE>addr</CODE>, to         the values specified by the <CODE>expr</CODE> expressions.         The command stores either a byte, word or long, depending on         the size of the expression. On completion, the command         displays a dump of the memory, starting at the first         location set.</P>                  <P>The command sets the dot address to the address where the         dump started.</P>                  <P>Typing Return after entering this command will continue         dumping memory.</P>                  <H3>Go</H3>                  <BLOCKQUOTE><P>G <CODE>addr</CODE></P>                  <P>G</P></BLOCKQUOTE>                  <P>With an argument, the go command starts execution at the         address specified by <CODE>addr</CODE>. Without an argument,         the go command resumes execution from where MicroBug was         entered.</P>                  <H3>Total Display</H3>                  <BLOCKQUOTE><P>TD</P></BLOCKQUOTE>                  <P>Displays all the standard <CODE>680x0</CODE> registers by         dumping the memory where they were stored on entry to         MicroBug. The following table describes the specific memory         locations of interest:</P>                  <TABLE BORDER=1>            <TR>               <td width=57 align=left>                  <P><STRONG>Address</STRONG></p>               </TD><td width=74 align=left>                  <P><STRONG>Size</STRONG></p>               </TD><td width=254 align=left>                  <P><STRONG>Description</STRONG></p>               </TD><td align="left">                  <P><STRONG>Name</STRONG></p>               </TD></TR>            <TR>               <td width=57 align=left>                  <P><CODE>$0C30</CODE></p>               </TD><td width=74 align=left>                  <P>16 x 4 bytes</p>               </TD><td width=254 align=left>                  <P><CODE>680x0</CODE> registers d0-d7 and a0-a7 in                  that order</p>               </TD><td align="left">                  <P><CODE>SEVarBase</CODE></p>               </TD></TR>            <TR>               <td width=57 align=left>                  <P><CODE>$0C6C</CODE></p>               </TD><td width=74 align=left>                  <P>4 bytes</p>               </TD><td width=254 align=left>                  <P><CODE>680x0</CODE> SP register</p>               </TD><td align="left">                  <P><CODE>MacsBugSP</CODE></p>               </TD></TR>            <TR>               <td width=57 align=left>                  <P><CODE>$0C70</CODE></p>               </TD><td width=74 align=left>                  <P>4 bytes</p>               </TD><td width=254 align=left>                  <P><CODE>680x0</CODE> PC register</p>               </TD><td align="left">                  <P><CODE>MacsBugPC</CODE></p>               </TD></TR>            <TR>               <td width=57 align=left>                  <P><CODE>$0C74</CODE></p>               </TD><td width=74 align=left>                  <P>2 bytes</p>               </TD><td width=254 align=left>                  <P><CODE>680x0</CODE> SR register</p>               </TD><td align="left">                  <P><CODE>MacsBugSR</CODE></p>               </TD></TR>         </TABLE>                  <P>Typing Return after entering this command will repeat the         command.</P>                  <H3>Set and Display Register         </H3>                  <BLOCKQUOTE><P>A<CODE>x</CODE> <CODE> expr</CODE></P>                  <P>A<CODE>x</CODE></P>                  <P>D<CODE>x</CODE> <CODE> expr</CODE></P>                  <P>D<CODE>x</CODE></P>                  <P>PC <CODE>expr</CODE></P>                  <P>PC</P>                  <P>SR <CODE>expr</CODE></P>                  <P>SR</P></BLOCKQUOTE>                  <P>With an argument, these command set the specified         register to the <CODE>expr</CODE> . Without an argument,         these commands display the specified register. <CODE>         x</CODE> determines the address or data register of         interest, and can be any digit from 0 through 7.</P>                  <P>Typing Return after entering one of these commands will         repeat the command.</p><BR><P><A HREF="#top">Back to top</A></P>         <P><A NAME="MicroBugEsoterica"></A></P>                  <H2>MicroBug Esoterica</H2>                  <H3>Force Quitting</H3>                  <P>If you want to force quit the current process, you can         just type:</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>SM 0 A9F4G 0</pre></TD></TR></TABLE></CENTER><BR><BR>                  <P>This places an <CODE>_ExitToShell</CODE> trap at location         0 and then continues execution at that trap. Of course, this         trick is now mostly pointless because Mac OS supports the         Command-Option-Escape key sequence to force quit a hung         process.</P>                  <P>Some enterprising souls have discovered that commands         like:</P>                           <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>G FINDERG EXITTOSHELL</pre></TD></TR></TABLE></CENTER><BR><BR>                                 <P>will also force quit an application. This is because         MicroBug's expression evaluator is extremely forgiving, so         seemingly irrelevant strings will successfully evaluate to         expressions. In both cases shown above, the resulting value         is odd. Going to an odd address causes the 680x0         microprocessor (or the emulated microprocessor, on         PowerPC-based computers) to take an "address error"         exception. Mac OS responds to this exception by terminating         the current process, which was the desired result.</P>                  <P>Given the serendipitous nature of this feature, DTS         continues to recommend the first sequence of commands.</P>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>        A Pascal version of MicroBug's expressionevaluation algorithm is shown below.</P></TD></TR></TABLE></CENTER><BR><BR>                  <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre><B>function</B> StringToNumber(numberText : string) : longint;    <B>var</B>        result : longint;        i : integer;        digit : integer;<B>begin</B>    result := 0;    <B>for</B> i := 1 <B>to</B> length(numberText) <B>do</B> <B>begin</B>        digit := ord(numberText[i]);        <B>if</B> digit &gt; $39 <B>then</B> <B>begin</B>            digit := digit - 7;        <B>end</B>; (* if *)        digit := band(digit, $000F);        result := result * 16 + digit;    <B>end</B>; (* for *)    StringToNumber := result;<B>end</B>; (* StringToNumber *)</pre></TD></TR></TABLE></CENTER><BR><BR>                                                                                <P>Using this algorithm, the value for "FINDER" is                  <CODE>$00F27DEB</CODE> and the value for "EXITTOSHELL" is                  <CODE>$DD8C1E55</CODE>.</p>                                <H3>MicroBug and the Modem</H3>                  <P>If you crash into the debugger and the system hangs, try         turning off your modem.</P>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>I have no idea whether this is still useful advice,but how could I remove such a cryptic comment fromthe technote? -- 1998</P></TD></TR></TABLE></CENTER><BR><BR>                  <H3>Using MicroBug Seriously</H3>                  <P>If you're using MicroBug to debug a problem, it         <EM>really</EM> pays off to have another machine running         MacsBug right next to it. You can then use MacsBug commands         to assist in your debugging. MacsBug commands like         <CODE>dh</CODE> (to disassemble hex words), <CODE>mcd</CODE>         and <CODE>wh</CODE> (to find low-memory globals), and         <CODE>dm 0 &lt;template&gt;</CODE> (to find the offsets of         fields within a structure) are all extremely helpful.</p>        <BR><P><A HREF="#top">Back to top</A></P>         <A NAME="Summary"></A>                  <H2>Summary</H2>                  <P>MacsBug is your friend. MicroBug is much less of your         friend, but when you're a Mac programmer with a bug that         disappears when you install MacsBug, you need all the         friends you can get.</P><BR><P><A HREF="#top">Back to top</A></P><a name="References"></a><H2>References</H2>         <p><CITE>MacsBug Reference and Debugging Guide, for            MacsBug version 6.2</CITE> , Apple Computer, Inc.,            Addison-Wesley, 1990</p><BR><P><A HREF="#top">Back to top</A></P><a name="Changes"></a><H2>Change History</H2><TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>1-June-1986</P>               </TD>               <td align="left">                  <P>Originally written as Technote 38 "ROM Debugger."</P>               </TD>            </TR>             <TR>               <td width=100 align=left>                  <P ALIGN=center>1-March-1998</P>               </TD>               <td align="left">                  <P>Revised as Technote PT 33 "The ROM Debugger."</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>1-August-1998</P>               </TD>               <td align="left">                  <P>Rewritten as Technote 1136 "MicroBug: The ROM Debugger". <BR>This version contains a more complete description of the debugger   commands.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>28-September-1998</P>               </TD>               <td align="left">                  <P>Revised to explain why "G FINDER" works.<BR></P>               </TD>            </TR></table><BR><P><A HREF="#top">Back to top</A></P>        <A NAME="Downloads"></A>         <h2>Downloadables</h2>        <center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600">         <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P>            </TD>            <td align="left">               <p>Acrobat version of this Note (36K).</P>            </TD>            <td width=60 align=left>               <p><A HREF="pdf/tn1136.pdf">Download</A></P>            </TD>          </TR>              </table></center><BR><BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1136.html%3Fid%3DDTS10002975-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1136.html%3Fid%3DDTS10002975-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1136.html%3Fid%3DDTS10002975-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>