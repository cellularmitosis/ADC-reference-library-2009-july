<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>GetZoneList(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING96></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-95.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-97.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-84.html"><B>Chapter 4 - Zone Information Protocol (ZIP)</B></A> / <A HREF="Networking-89.html"><B>ZIP Reference</B></A><BR><DL><DD><A HREF="Networking-92.html"><B>Routines</B></A> / <A HREF="Networking-93.html"><B>Obtaining Zone Information</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING96-0></A>
<H3>GetZoneList</H3>
 <A NAME=MARKER-11-92></A>The <CODE>GetZoneList</CODE> <A NAME=MARKER-9-16></A>function returns a complete list of all the zone names on the <A NAME=MARKER-2-5></A>internet. <P>
<PRE>
FUNCTION GetZoneList (thePBptr: XPPParmBlkPtr; 
                      async: Boolean): OSErr;
</PRE>
<DL>
<DT><CODE>thePBptr</CODE>
<DD> A pointer to an XPP parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean that indicates whether the function should be executed asynchronously or synchronously. Specify <CODE>TRUE</CODE> for asynchronous execution.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result. <TR>
<TD>--><TD>csCode<TD>Integer<TD>Always <CODE>xCall</CODE> for this function.<TR>
<TD>--><TD>xppSubCode<TD>Integer<TD>Always <CODE>zipGetZoneList</CODE> for this function.<TR>
<TD>--><TD>xppTimeout<TD>Byte<TD>The retry interval in seconds.<TR>
<TD>--><TD>xppRetry<TD>Byte<TD>The retry count.<TR>
<TD>--><TD>zipBuffPtr<TD>Ptr<TD>A pointer to data buffer.<TR>
<TD><--<TD>zipNumZones<TD><CODE>Integer</CODE><TD>The number of names returned.<TR>
<TD><--<TD>zipLastFlag<TD><CODE>Byte</CODE><TD>A flag that is nonzero if there are no more names.<TR>
<TD>--><TD>zipInfoField<TD><CODE>PACKED ARRAY</CODE><TD>A data buffer for use by ZIP; first word set to 0.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>xppSubCode</CODE>
<DD> A routine selector. This field is automatically set by the MPW interface to <CODE>zipGetZoneList</CODE> for this function.
<DT><A NAME=MARKER-2-51></A>xppTimeout
<DD> The amount of time, in seconds, that the .ATP driver should wait between attempts to obtain the data. A value of 3 or 4 seconds for the <CODE>xppTimeout</CODE> field generally gives good results.
<DT><A NAME=MARKER-2-39></A>xppRetry
<DD> The number of times the .ATP driver should attempt to obtain the data before returning the request failed (<CODE>reqFailed</CODE>) result code. <BR>A value of 3 or 4 is usually sufficient.
<DT><A NAME=MARKER-2-74></A>zipBuffPtr
<DD> A pointer to a 578-byte data buffer that you must allocate. ZIP returns the zone names into this buffer as a packed array of <BR>Pascal strings. 
<DT><CODE><A NAME=MARKER-9-128></A>zipNumZones</CODE> 
<DD> The number of zone names that ZIP placed in the data buffer. <A NAME=MARKER-2-61></A><A NAME=MARKER-2-100></A>
<DT><CODE><A NAME=MARKER-2-19></A>zipLastFlag</CODE> 
<DD> A value that indicates if there are more zone names for your network beyond those that ZIP returned in the <CODE>zipBuffPtr</CODE> field. The .XPP driver sets this field to 1 if there are no more zone names for your network. 
<DT><A NAME=MARKER-2-29></A>zipInfoField
<DD> <A NAME=MARKER-2-27></A>A 70-byte data buffer that you must allocate for use by ZIP. Typically, you call <CODE>GetZoneList</CODE> repeatedly from within a loop. You must set the first word of this buffer to 0 before you call the <CODE>GetZoneList</CODE> function the first time through the loop, and you must not change the contents of this field thereafter.<A NAME=MARKER-9-75></A>
</DL>
<A NAME=HEADING96-13></A>
<H5>DESCRIPTION</H5>
 <A NAME=MARKER-21-84></A>The <CODE>GetZoneList</CODE> function returns a complete list of all the zone names on the internet to which the local network of the node running your application belongs. The <CODE>GetZoneList</CODE> function uses ATP to retrieve the zone information.<A NAME=MARKER-2-88></A> The buffer that you allocate to hold the returned zone names is the size of a single ATP response. You must call the <CODE>GetZoneList</CODE> function repeatedly until all of the zones for the local network have been returned. <P>
 Your application must check the <CODE>zipLastFlag</CODE> field to determine if there are more zone names for your network. If the value of this field is 1, there are no more zone names for your local network. If the value of this field is still 0 when the <CODE>GetZoneList</CODE> function completes execution, you must empty the data buffer pointed to by the <CODE>zipBuffPtr</CODE> parameter and immediately call the <CODE>GetZoneList</CODE> function again without changing the value in the <CODE>zipInfoField</CODE> parameter.<P>
 If you receive a <CODE>GetZoneList</CODE> function result of <CODE>tooManyReqs</CODE>, wait a minute or so, and then try again; some transactions can take up to 30 seconds to complete. <P>
 To obtain a list of only the zone names on the local network, use the <CODE>GetLocalZones</CODE> function instead. If you use the <CODE>GetZoneList</CODE> function on a nonextended network, the function returns the <CODE>reqFailed</CODE> result code.<A NAME=MARKER-2-36></A><A NAME=MARKER-2-108></A><P>
<A NAME=HEADING96-18></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The memory that you allocate for the parameter block and the two buffers required by the <CODE>GetZoneList</CODE> function belongs to the .XPP driver until the function completes execution. You can reuse the memory or dispose of it after the operation completes. <P>
<A NAME=HEADING96-20></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>GetZoneList</CODE> function from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>xCall</CODE> in the <CODE>csCode</CODE> field of the parameter block and a value of<CODE> zipGetZoneList</CODE> in the <CODE>xppSubCode</CODE> field of the parameter block. To execute this function from assembly language, you must also specify the .XPP driver reference number.<P>
<A NAME=HEADING96-22></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>noBridgeErr<TD>-93<TD>No router is available<TR>
<TD>reqFailed<TD>-1096<TD>Request to contact router failed; retry count exceeded <TR>
<TD>tooManyReqs<TD>-1097<TD>Too many concurrent requests<TR>
<TD>noDataArea<TD>-1104<TD>Too many outstanding ATP calls</TABLE>
</H5>
<A NAME=HEADING96-23></A>
<H5>SEE ALSO</H5>
 For the <CODE>XPPParamBlock</CODE> data type, see <A HREF=Networking-91.html#MARKER-9-41>"The XPP Parameter Block for ZIP" beginning on page 4-10</A>.<P>
 To get the correct reference number for the .XPP driver, you can use the Device Manager's <CODE>OpenDriver</CODE> function, which returns the driver reference number. For information about the <CODE>OpenDriver</CODE> function<A NAME=MARKER-9-11></A>, see the chapter "Device Manager" in <BR><I>Inside Macintosh: <A NAME=MARKER-2-26></A>Devices</I>.<A NAME=MARKER-9-72></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-95.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-97.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
