<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN""http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 11-30-00--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QTMCC20: Keyframes and AddMediaSample</title><meta name="keywords" content="Keyframe, mediaSampleNotSync, notSyncFlag"><meta name="Description" content="Technical Q&amp;A QTMCC20: The Q&amp;A describes how to pass thecorrect mediaSample flag to AddMediaSample which identifiesthe newly added sample as a difference frame or a keyframe."><meta name="categories" content="QuickTime Image Compression Manager and QuickTime Components"><meta name="week-posted" content="Nov 27, 2000 - Dec 1, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001963" title="Keyframes and AddMediaSample"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxMovieCreation-date.html">Movie Creation</a> &gt; </p><!-- end_header_information --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QTMCC20</div>
<div id="pageheadsub">Keyframes and AddMediaSample</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0"><tr><td align="left" scope="row"><!-- --> <!-- Document Body -->          <hr width=500 align=center><P ID="p2">Q: I'm generating QuickTime movie files from my own data and encountering problems when the movie controller is used to scrub my movie files. These movies seem to play fine unless they are started in the middle or if the movie controller is being moved back and forth.  In this case, the picture falls apart until a key frame is processed. Is there a movie option I need to set when creating the movie or something that needs to be done when adding frames?</P><P ID="p4">A: You need to set the flags correctly when adding media samples and be make sure to mark keyframes and difference frames.</P><P ID="p4">With <CODE>SCCompressSequenceFrame</CODE>, you get a value called <CODE>notSyncFlag</CODE> back to tell you this information. This flag will be set to the <CODE>mediaSampleNotSync</CODE> constant for a difference frame, so you can pass it in the flags parameter to <CODE>AddMediaSample</CODE>.</P><P ID="p4">When you compress video with <CODE>CompressSequenceFrame</CODE> you get a similarity parameter back. If this is non-zero, pass <CODE>mediaSampleNotSync</CODE> in the flags to <CODE>AddMediaSample</CODE>.</P><P ID="p4">If you don't do this, all frames will be marked as keyframes, and QuickTime doesn't do the extra work to decompress preceding frames when your users scrub back and forth.</P><CENTER><TABLE BORDER=0 CELLPADDING=4 width=500><TR><td bgcolor="#e6e6e6" align=left><pre>// Frame compress loopfor (frameNum = 0; frameNum &lt; frameCount; frameNum++) {  short notSyncFlag;  .  .  .  // Compress the frame  SCCompressSequenceFrame(ci,              // compression seq ID                          GetGWorldPixMap(srcGWorld),                          &amp;srcRect,                          &amp;compressedData, // handle to newly compressed data                          &amp;dataSize,       // size of compressed data                          &amp;notSyncFlag);   // key frame flag  // Append the compressed image data to the media  AddMediaSample(dstMedia,      // media specifier       compressedData,          // sample data       0,       dataSize,                // size of sample data       duration,     (SampleDescriptionHandle)idh,     1,                         // number of samples     notSyncFlag,               // sync sample flags 1 = mediaSampleNotSync     NULL);  .  .  .}</pre>		</TD>	</TR></TABLE></center><P ID="p4">The above snippet from ConvertToMovie Jr. shows how this flag is returned and how it's passed to <CODE>AddMediaSample</CODE>; the full sample can be found at the following URL:</P><A HREF="http://developer.apple.com/samplecode/Sample_Code/QuickTime/Importers_and_Exporters/ConvertToMovieJr.htm">http://developer.apple.com/samplecode/Sample_Code/QuickTime/Importers_and_Exporters/ConvertToMovieJr.htm</A><!-- end_content --><!--Template 11-30-00--><!-- begin_date --><H4 ALIGN=center>[Dec 01 2000]</H4><!-- end_date --></td></tr></table></CENTER></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qtmcc/qtmcc20.html%3Fid%3DDTS10001963-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qtmcc/qtmcc20.html%3Fid%3DDTS10001963-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qtmcc/qtmcc20.html%3Fid%3DDTS10001963-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>