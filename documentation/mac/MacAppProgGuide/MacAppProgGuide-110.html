<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Overview (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING110></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-109.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-111.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-109.html"><B>Chapter 20 - Working With the Keyboard</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING110-0></A>
<H1>Overview</H1>
 <A NAME=MARKER-2-20></A>When a user presses a key while your program is active, the application object receives a key-down event from the operating system. The application passes the event to the target chain, as shown in <A HREF=MacAppProgGuide-42.html#MARKER-9-65>Figure 5-2 on page 104</A>. The event is passed from object to object in the target chain until an event-handler or behavior object in the chain handles the keystroke.<P>
 If the key-down event is a Command-key combination, the application object automatically determines whether it is a keyboard equivalent for a menu command. The application doesn't check for keyboard equivalents that use other modifier keys, such as the Option or Control key.<P>
 Your application handles a menu command by overriding the <CODE>DoMenuCommand</CODE> method in any event-handling or behavior class, including subclasses of <CODE>TApplication</CODE>, <CODE>TDocument</CODE>, <CODE>TView</CODE>, <CODE>TWindow</CODE>, and <CODE>TBehavior</CODE>. (These classes already handle certain menu commands in their implementations of <CODE>DoMenuCommand</CODE>.) You can specify a Command-key equivalent for a menu command by adding the key equivalent to the menu definition in your resource file, as described in <A HREF=MacAppProgGuide-86.html#MARKER-9-37>"Defining Menu Contents With a 'CMNU' Resource," beginning on page 303</A>.<P>
 MacApp supplies the <CODE>TTEView</CODE> class and a number of command classes for working with text entry. For more information on text editing, see<B> <A HREF=MacAppProgGuide-70.html#MARKER-9-316>"Editing Text" on page 246</A>.</B><P>
 <A HREF=#MARKER-9-21>Figure 20-1</A> shows some of the classes and methods MacApp uses to process keystrokes.<P>
<A NAME=HEADING110-6></A>
<H2>Simple Keystrokes</H2>
 A simple keystroke is one that does not include a modifier key. Your application typically handles simple keystrokes by overriding the <CODE>DoKeyEvent</CODE> method in an event-handling or behavior class. Your implementation of <CODE>DoKeyEvent</CODE> handles any key event that has meaning for your application; otherwise, it calls <CODE>Inherited::DoKeyEvent</CODE>. This allows other classes in the object's class hierarchy to handle the event. If none does, the event is passed on to the next object in the target chain, if there is one.<P>
<B>Figure 20-1  <A NAME=MARKER-9-21></A><A NAME=MARKER-2-31></A>Keystroke-handling classes and methods</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-078.gif"><P>
<A NAME=HEADING110-10></A>
<H2><A NAME=MARKER-2-23></A><A NAME=MARKER-9-24></A>Command-Key Combinations With Menu Command Equivalents</H2>
 If a Command-key combination has a menu command equivalent, the application object calls the <CODE>HandleMenuCommand</CODE> method of the current target object, which in turn calls the <CODE>DoMenuCommand</CODE> method. For example, the Open command on the File menu has the command equivalent of Command-O. When a user types Command-O, the application object calls the <CODE>HandleMenuCommand</CODE> method of the current target object, passing the <CODE>cOpen</CODE> command constant. (Command-key processing is described in detail in <A HREF=MacAppProgGuide-42.html#MARKER-9-99>"Key-Down Events," beginning on page 110</A>.)<P>
<A NAME=HEADING110-12></A>
<H2>Command-Key Combinations With No Menu Equivalent</H2>
 Your application handles a Command-key combination that is not equivalent to a menu command by overriding the <CODE>DoCommandKeyEvent</CODE> method in an event-handling or behavior class. Command-key combinations are often handled in a subclass of the application class. In your implementation of the <CODE>DoCommandKeyEvent</CODE> method, you respond to the Command-key combinations that have special meaning for your application and pass any other combinations down the target chain by calling <CODE>Inherited</CODE>.<P>
<A NAME=HEADING110-14></A>
<H2><A NAME=MARKER-2-21></A><A NAME=MARKER-9-26></A>Other Modifier Keys</H2>
 Your application can respond to other modifier keys, including the Shift, Option, Control, and Caps Lock keys, by overriding the <CODE>DoKeyEvent</CODE> method in an event-handling or behavior class. The <CODE>DoKeyEvent</CODE> method is passed the parameter<P>
<PRE>
TToolboxEvent* event
</PRE>
 One of the fields of <CODE>TToolboxEvent</CODE> is<P>
<PRE>
EventRecord : fEventRecord;
</PRE>
 The <CODE>EventRecord</CODE> structure contains information about the Toolbox event generated by the original keystroke, including the state of the modifier keys. Your override version of <CODE>DoKeyEvent</CODE> can examine <CODE>fEventRecord</CODE> to determine whether a modifier key you are interested in was pressed. This is demonstrated in the code sample <A HREF=MacAppProgGuide-117.html#MARKER-9-70>"Recipe--Handling a Keystroke Other Than a Command-Key Combination," beginning on page 480</A>.<P>
 The chapter "Event Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> describes Toolbox events and the <CODE>EventRecord</CODE> data type.<P>
<A NAME=HEADING110-21></A>
<H2><A NAME=MARKER-2-38></A><A NAME=MARKER-9-28></A>Function Keys and Other Extended Keyboard Keys</H2>
 MacApp provides built-in support for handling the function keys F1 through F4 (Undo, Cut, Copy, Paste) and the Clear key on the numeric keypad. If no other object in the target chain responds first, the application object's <CODE>DoKeyEvent</CODE> method maps F1 to <CODE>cUndo</CODE>, F2 to <CODE>cCut</CODE>, F3 to <CODE>cCopy</CODE>, F4 to <CODE>cPaste</CODE>, and Clear to <CODE>cClear</CODE> and generates a call to the <CODE>HandleMenuCommand</CODE> method of the current target object, which in turn calls the <CODE>DoMenuCommand</CODE> method, passing the command constant (as it does for Command-key combinations with menu command equivalents).<P>
 As a result, your application can respond to the function keys F1 through F4 and the Clear key by overriding <CODE>DoMenuCommand</CODE> in an event-handling or behavior class and by looking for the <CODE>cUndo</CODE>, <CODE>cCut</CODE>, <CODE>cCopy</CODE>, <CODE>cPaste</CODE>, or <CODE>cClear</CODE> command constant.<P>
<DL>
<DT><B>Note</B>
<DD>The <CODE>TTEView</CODE> class handles the command constants <CODE>cCut</CODE>, <CODE>cCopy</CODE>, <CODE>cPaste</CODE>, and <CODE>cClear</CODE> in its <CODE>DoMenuCommand</CODE> method. When you use <CODE>TTEView</CODE> or a subclass, you may not need to supply any additional code for these commands.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Your application can also respond to function keys in the <CODE>DoKeyEvent</CODE> method of an event-handling or behavior class. Command constants for the function keys F1 through F15, the Esc (Escape) key, the Fwd Del (Forward Delete) key, and the Clear key are defined in the file <CODE>MacAppTypes.h</CODE>. In your implementation of <CODE>DoKeyEvent</CODE>, you compare the <CODE>fKeyCode</CODE> field of the passed <CODE>TToolboxEvent</CODE> object to any of these constants to identify special keys your application is interested in.<P>
<A NAME=HEADING110-26></A>
<H2><A NAME=MARKER-9-39></A>Scripting Note</H2>
 <A HREF=MacAppProgGuide-48.html#MARKER-9-19>Chapter 6, "Scripting,"</A> lists scripting issues to keep in mind while designing an application. <I>Factoring</I> the application (separating code that controls the user interface from code that responds to user actions, and breaking functions into discrete operations that can be implemented as separate tasks) is important in handling keystrokes, as it is for other user actions.<P>
 Suppose, for example, a user presses the F2 function key (Cut) after selecting a graphic object in a window in your application. The application object's <CODE>DoKeyEvent</CODE> method calls the current target object's <CODE>HandleMenuCommand</CODE> method, passing the value <CODE>cCut</CODE>. Each object in the target chain gets a chance to respond to the <CODE>cCut</CODE> command number in its <A NAME=MARKER-2-30></A><CODE>DoMenuCommand</CODE> method.<P>
 The <CODE>T<I>YourView::DoMenuCommand</I></CODE> method handles <CODE>cCut</CODE> by creating a command object that knows how to perform the cut operation and send an Apple event to describe it. The <CODE>DoMenuCommand</CODE> method sets the command's <A NAME=MARKER-2-31></A><CODE>fUseAppleEvent</CODE> field to <CODE>TRUE</CODE>. When the command is executed, it first sends the Apple event (making the operation recordable and giving any attached script a chance to handle the command), then performs the specified cut (if no script intercepts the command).<P>
 When an Apple event describing a similar cut operation is received from a script or an outside source, it is dispatched to your view object. The view's <CODE>DoScriptCommand</CODE> method creates a command object of the same type as that created by the <CODE>DoMenuCommand</CODE> method. However, in this case it sets <CODE>fUseAppleEvent</CODE> to <CODE>FALSE</CODE>. (Actually, <CODE>fUseAppleEvent</CODE> defaults to <CODE>FALSE</CODE>, so no further work is required.) It also calls the command's <CODE>Process</CODE> method directly rather than post the command to the command queue. When the command is executed, it performs the specified cut operation but doesn't send an Apple event, because the command itself was created in response to an Apple event.<P>
 If you follow this implementation strategy, cutting with the F2 function key will be a scriptable, recordable operation in your application.<A NAME=MARKER-2-32></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-109.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-111.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
