<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyColorSyncDataTransfer(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING309></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-308.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-310.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-154.html"><B>Chapter 3 - ColorSync Manager Reference for Applications and Device Drivers</B></A> / <A HREF="ACIReference-218.html"><B>ColorSync Manager Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B>Application-Defined Functions for the ColorSync Manager </B></A> / <A HREF="ACIReference-282.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING309-0></A>
<H3><A NAME=MARKER-9-471></A>MyColorSyncDataTransfer</H3>
 Application-defined function that transfers profile data from the format for embedded profiles to disk file format or vice versa. Used by PostScript functions to transfer data from a profile to text format usable by a PostScript driver. <P>
 This application-supplied function must conform to the following declaration, although the function name is arbitrary:<P>
<PRE>
pascal OSErr MyColorSyncDataTransfer (
long command,
long *size,
void *data,
void *refCon);
</PRE>
<DL>
<DT><CODE>command</CODE>
<DD> The command with which the <A NAME=MARKER-11-472></A><CODE>MyColorSyncDataTransfer</CODE> function is called. This command specifies the operation the function is to perform. 
<DT><CODE>size</CODE>
<DD> A pointer to a size value. On input, the size in bytes of the data to transfer. On output, the size of the data actually transferred. 
<DT><CODE>data</CODE>
<DD> A pointer to the buffer supplied by the ColorSync Manager to use for the data transfer.
<DT><CODE>refCon</CODE>
<DD> A reference constant that holds the application data passed in from the <CODE>CMFlattenProfile</CODE> function, the <CODE>CMUnflattenProfile</CODE> function, or the <CODE>CMGetPS2ColorSpace</CODE>, <CODE>CMGetPS2ColorRenderingIntent</CODE>, or <CODE>CMGetPS2ColorRendering</CODE> functions. Each time the CMM calls your <CODE>MyColorSyncDataTransfer</CODE> function, it passes this data to the function.
<DT><I>function result</I>
<DD> A result code of type OSErr. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-174)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING309-9></A>
<H5>DISCUSSION</H5>
 Your <CODE>MyColorSyncDataTransfer</CODE> function is called to flatten and unflatten profiles or to transfer PostScript-related data from a profile to the PostScript format to send to an application or device driver. <P>
 The ColorSync dispatcher and the CMM communicate with the <CODE>MyColorSyncDataTransfer</CODE> function using the command parameter to identify the operation to perform. To read and write profile data, your function must the support the following commands: <CODE>openReadSpool</CODE>, <CODE>openWriteSpool</CODE>, <CODE>readSpool</CODE>, <CODE>writeSpool</CODE>, and <CODE>closeSpool</CODE>. <P>
 You determine the behavior of your <CODE>MyColorSyncDataTransfer</CODE> function. This section describes how your function might handle the flattening and unflattening processes.<P>
<A NAME=HEADING309-13></A>
<H5>FLATTENING A PROFILE</H5>
 The ColorSync Manager calls the specified profile's preferred CMM when an application calls the <CODE>CMFlattenProfile</CODE> function to transfer profile data embedded in a graphics document. <P>
 The ColorSync Manager determines if the CMM supports the <CODE>CMFlattenProfile</CODE> function. If so, the ColorSync Manager dispatches the <CODE>CMFlattenProfile</CODE> function to the CMM. If not, ColorSync calls the default Apple CMM, dispatching the <CODE>CMFlattenProfile</CODE> function to it.<P>
 The CMM communicates with the <CODE>MyColorSyncDataTransfer</CODE> function using a command parameter to identify the operation to perform. The CMM calls your function as often as necessary, passing to it on each call any data transferred to the CMM from the <CODE>CMFlattenProfile</CODE> function's <CODE>refCon</CODE> parameter. <P>
 The ColorSync Manager calls your function with the following sequence of commands: <CODE>openWriteSpool</CODE>, <CODE>writeSpool</CODE>, and <CODE>closeSpool</CODE>. Here is how you should handle these commands:<P>
<UL>
<LI>When the CMM calls your function with the <CODE>openWriteSpool</CODE> command, you should perform any initialization required to write profile data you receive from the CMM to a buffer or file. 
<LI>The CMM will call your function with the <CODE>writeSpool</CODE> command as many times as necessary to transfer all the profile data to you. Each time you are called, you should receive the data and write it to your buffer or file, returning in the <CODE>size</CODE> parameter the number of bytes of data you actually accepted.
<LI>When the CMM calls your function with the <CODE>closeSpool</CODE> command, you should perform any required cleanup processes. <P>
</UL>
 As part of this process, your function can embed the profile data in a graphics document, for example, a PICT file or a TIFF file. For example, your <CODE>MyColorSyncDataTransfer</CODE> function can call the QuickDraw <CODE>PicComment</CODE> function to embed the flattened profile in a picture.<P>
<A NAME=HEADING309-22></A>
<H5>UNFLATTENING A PROFILE</H5>
 When an application calls the <CODE>CMUnflattenProfile</CODE> function to transfer a profile that was embedded in a graphics document to an independent disk file, the ColorSync dispatcher calls your <CODE>MyColorSyncDataTransfer</CODE> function to obtain the preferred CMM of the profile to flatten. The ColorSync Manager calls your function with the following sequence of commands: <CODE>openReadSpool</CODE>, <CODE>readSpool</CODE>, <CODE>closeSpool</CODE>. Here is how you should handle these commands:<P>
<UL>
<LI>When the CMM calls your function with the <CODE>openReadSpool</CODE> command, you should perform any initialization required to read from the embedded profile format. 
<LI>The CMM will call your function with the <CODE>readSpool</CODE> command as many times as necessary, directing your function to extract the profile data from the embedded format in the image file and return it to the CMM in the <CODE>data </CODE>buffer. The CMM passes in the <CODE>size</CODE> parameter the number of bytes of data you should return. Each time your function is called, it should read and return the data, also returning in the <CODE>size</CODE> parameter the number of bytes of data you actually returned to the CMM.
<LI>When the CMM calls your function with the <CODE>closeSpool</CODE> command, you should perform any required cleanup processes. <P>
</UL>
 The preferred CMM is stored in the profile header's <CODE>CMMType</CODE> field. The <CODE>MyColorSyncDataTransfer</CODE> function must be able to buffer at least 8 bytes of data to hold the <CODE>CMMType</CODE> field value.<P>
 The ColorSync Manager determines if the CMM supports the <CODE>CMUnflattenProfile</CODE> function. If so, the ColorSync Manager calls the preferred CMM to dispatch the <CODE>CMUnflattenProfile</CODE> function to it. If not, the ColorSync Manager calls the default Apple CMM to dispatch the <CODE>CMUnflattenProfile</CODE> function to it.<P>
 The CMM calls the <CODE>MyColorSyncDataTransfer</CODE> function, supplied by the calling application, to unflatten the profile data and write it to a disk file. The CMM calls the function as often as necessary, passing to it on each call any data transferred to the CMM from the <CODE>CMUnflattenProfile</CODE> function's <CODE>refCon</CODE> parameter. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-308.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-310.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
