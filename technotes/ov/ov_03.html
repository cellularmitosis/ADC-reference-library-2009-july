<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OV03: Compatibility Guidelines</title><meta name="keywords" content="Mac OS 8 Compatibility guidelines apple computers CPUFlag"><meta name="Description" content="Technical Note OV03: This Technical Note provides a checklistof compatibility items developers should be aware of whenprogramming for the Macintosh. These items stress futurecompatibility with (then) upcoming Apple computers, includedare such topics as: system queues, location of screen, checkingfor RAM sizes, etc.">                                       <meta name="categories" content="Overview"><meta name="week-posted" content="Dec 30, 1985 - Jan 3, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002601" title="Compatibility Guidelines"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OV03</div>
<div id="pageheadsub">Compatibility Guidelines</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					<A HREF="#Section1">Introduction</A><br><br> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">Apple has many enhancements planned for the Macintosh family of computers. Tohelp ensure your software's compatibility with these enhancements, check eachitem in this note to be sure that you're following the recommendations.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jan 01 1986]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->          <P><A NAME=Section1></A></P><h2>Introduction</h2><p>If your software is written in a high-level language like Pascal or C and ifyou adhere to the guidelines listed in <i>Inside Macintosh</i>, many of thequestions in this note won't concern you. If you develop in assembly language,you should read each question carefully. If you answer any question "yes," yoursoftware may encounter difficulty running on future Macintosh computers, andyou should take the recommended action to change your software.</p><h3>Do you depend on 68000 instructions which require that the processor be insupervisor mode?</h3><p>In general, your software should not include instructions which depend onsupervisor mode. These include modifying the contents of the status register.Most programs which modify the status register are only changing the ConditionCode Register (CCR) half of the status register, so an instruction whichaddresses the CCR will work fine. Also, your software should not use the UserStack Pointer (USP) or turn interrupts on and off.</p><h3>Do you have code which executes in response to an exception and relies on theposition of data in the exception's local stack frame?</h3><p>Exception stack frames vary on different microprocessors in the 68000 family,some of which may be used in future Macintosh computers. You should avoid usingthe <code>TRAP</code> instruction.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>You can determine which microprocessor is installed by examiningthe low-memory global <code>CPUFlag</code> (a byte at <code>$12F</code>). These are the values:</p><h3>CPUFlag microprocessor</h3><p>$00 68000</p><p>$01 68010</p><p>$02 68020</p><p>$03 68030</p></TD></TR></TABLE></CENTER><BR><h3>Do you use low-memory globals not documented in <i>Inside Macintosh</i>?</h3><p>Other microprocessors in the 68000 family use the exception vectors inlocations <code>$0</code> through <code>$FF</code> in different ways. No undocumentedlocation below the system heap (<code>$100</code> through <code>$13FF</code>) isguaranteed to be available for use in future systems.</p><h3>Do you make assumptions about the file system which are not consistent withboth the original Macintosh File System and the Hierarchical File System?</h3><p>Your applications should be compatible with both file systems. The easiest wayto do this is to stick to the old files system trap calls (which work with bothfile systems) and avoid direct manipulation of data structures such as filecontrol blocks and volume control blocks whenever possible.</p><h3>Do you depend on the system or application heaps starting at a hard-coded address?</h3><p>The starting addresses and the size of the system and application heaps hasalready changed (Macintosh vs. Macintosh Plus) and will change again in the future. Use the global <code>ApplZone</code> to find the application heap and <code>SysZone</code> to find the system heap. Also, don't count on the application heap zone starting at an address less than 65536 (that is, a system heap smaller than 64K).</p><h3>Do you look through the system's queues directly?</h3><p>In general, you should avoid examining queue elements directly. Instead, usethe Operating System calls to manipulate queue elements.</p><h3>Do you directly address memory-mapped hardware such as the VIA, the SCC, or the IWM?</h3><p>You should avoid accessing this memory directly and use trap calls instead(disk driver, serial driver, etc.). Future machines may include a memorymanagement unit (MMU) which may prevent access to memory-mapped hardware. Also,these memory-mapped devices may not be present on future machines. Theaddresses of these devices are likely to change, so if you must access thehardware directly, get the base address of the device from the appropriatelow-memory global (obtainable from includes and interface files):</p><h3>device global</h3><p>VIA    $1D4</p>    <p>SCCRd $1D8</p>    <p>SCCWr $1DC</p>    <p>IWM     $1E0</p><h3>Do you assume the location or size of the screen?</h3><p>The location, size, and bit depth of the screen is different in variousmachines. You can determine its location and size by examining the QuickDrawglobal variable <code>screenBits</code> on machines without Color QuickDraw. On machines with Color QuickDraw, the device list, described in the Graphics Devices chapter of <i>Inside Macintosh</i>, tells the locationand size and bit depth of each screen, <code>screenBits</code> contains the location and size of themain device, and <code>GrayRgn</code> contains a region describing the shape and size of the desktop.</p><h3>Does your software fail on some Macintosh models or on A/UX?</h3><p>If so, you should determine the reason. Failure to run on all versions of theMacintosh may indicate problems which will prevent your software from workingon future machines. Failure to run on A/UX, Apple's Unix for the Macintosh,also may indicate such problems.</p><h3>Do you change master pointer flags of relocatable blocks directly with BSET orBCLR instructions?</h3><p>In the future and on A/UX, all 32 bits of a master pointer may be used, withthe flags byte moved elsewhere. Use the Memory Manager calls <code>HPurge</code>, <code>HNoPurge</code>, <code>HLock</code>, <code>HUnlock, HSetRBit</code>, <code>HClrRBit</code>, <code>HGetState</code>, and <code>HSetState</code> to manipulate the master pointer flags. (See the Memory Manager chapter of <i>Inside Macintosh Volume IV</i> for information on these calls.)</p><h3>Do you check for 128K, 512K, and 1M RAM sizes?</h3><p>You should be flexible enough to allow for non-standard memory sizes. This willallow your software to work in environments like MultiFinder.</p><h3>Is your software incompatible with a third-party vendor's hardware?</h3><p>If so, the incompatibility may prevent your software from working on futuremachines. You should research the incompatibility and try to determine a solution.</p><h3>Do you rely on system resources being in RAM?</h3><p>On most of our systems, some system resources are in ROM. You should notassume, for example, that you can regain RAM space by releasing systemresources.</p><h3>Does your software have timing-sensitive code?</h3><p>Various Macintoshes run at different clock speeds, so timing loops will beinvalid. You can use the trap call <code>Delay</code> for timing, or you canexamine the global variable <code>Ticks</code>.</p><h3>Do you have code which writes to addresses within the code itself?</h3><p>A memory management unit (MMU) may one day prevent code from writing toaddresses within code memory. Also, some microprocessors in the 68000 familycache code as it's encountered. Your data blocks should be allocated on thestack or in heap blocks separate from the code, and your code should not modify itself.</p><h3>Do you rely on keyboard key codes rather than ASCII codes?</h3><p>The various keyboards are slightly different; future keyboards may be differentfrom them. For textual input, you should read ASCII codes rather than key codes.</p><h3>Do you rely on the format of packed addresses in the trap dispatch table?</h3><p>The trap dispatch table is different on various Macintoshes. There's noguarantee of the trap table's format in the future. You should use the systemcalls <code>GetTrapAddress</code> and <code>SetTrapAddress</code> to manipulate thetrap dispatch table.</p><h3>Do you use the Resource Manager calls <code>AddReference</code> or <code>RmveReference</code>?</h3><p>These calls have been removed from the 128K ROM. They are no longer supported.</p><h3>Do you store information in the application parameters area (the 32 bytesbetween the application and unit globals and the jump table)?</h3><p>This space is reserved for use by Apple.</p><h3>Do you depend on values in registers after a trap call, other than thosedocumented in <i>Inside Macintosh</i>?</h3><p>These values aren't guaranteed. The register conventions documented in<i>Inside Macintosh</i> will, of course, be supported. Often, you may notrealize that your code is depending on these undocumented values, so check yourregister usage carefully.</p><h3>Do you use the IMMED bit in File Manager calls?</h3><p>This bit, which was documented in early versions of <i>Inside Macintosh</i> as a special formof File Manager call, actually did nothing for File Manager calls, and was used only for Device Manager calls.With the advent of the Hierarchical File System, this bit indicates that the call has a parameter block with hierarchical information.</p><h3>Do you make assumptions about the number and size of disk drives?</h3><p>There are now five sizes of Apple disks for the Macintosh (400K, 800K, and 20M,40M, 80M), as well as many more from third-party vendors. You should use Standard File and File Manager calls to determine the number and size of disk drives.</p><h3>Do you depend on alternate (page 2) sound or video buffers?</h3><p>Some Macintoshes do not support alternate sound and video buffers.</p><h3>Do you print by sending ASCII directly to the printer driver?</h3><p>To retain compatibility with both locally-connected and AppleTalk-connectedprinters, you should print using Printing Manager, as documented in <i>Inside Macintosh</i>.</p><h3>Does your application fail when it's the startup application (i.e., without theFinder being run first)?</h3><p>If so, you're probably not initializing a variable. If your application doesnot work as the startup application, you should determine why and fix theproblem, since it may cause your application to fail in the future.</p> <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ov_03.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ov/ov_03.html%3Fid%3DDTS10002601-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ov/ov_03.html%3Fid%3DDTS10002601-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ov/ov_03.html%3Fid%3DDTS10002601-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>