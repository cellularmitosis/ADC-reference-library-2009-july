<html><head><title>Mac OS X
 Manual Page For SafeBase(ntcl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/ntcl/SafeBase" title="Mac OS X
 Manual Page for SafeBase(ntcl)"><a name="//apple_ref/doc/man/n/SafeBase" title="Mac OS X
 Manual Page for SafeBase(ntcl)"><!-- headerDoc=man; indexgroup=Section ntcl; uid="//apple_ref/doc/man/ntcl/SafeBase"; name=SafeBase(ntcl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
Safe <a href="Tcl.ntcl.html#//apple_ref/doc/man/n/Tcl">Tcl(n)</a>                                 Tcl Built-In Commands                                Safe <a href="Tcl.ntcl.html#//apple_ref/doc/man/n/Tcl">Tcl(n)</a>



____________________________________________________________________________________________________________

<b>NAME</b>
       Safe Base - A mechanism for creating and manipulating safe interpreters.

<b>SYNOPSIS</b>
       <b>::safe::interpCreate</b> ?<u>slave</u>? ?<u>options...</u>?

       <b>::safe::interpInit</b> <u>slave</u> ?<u>options...</u>?

       <b>::safe::interpConfigure</b> <u>slave</u> ?<u>options...</u>?

       <b>::safe::interpDelete</b> <u>slave</u>

       <b>::safe::interpAddToAccessPath</b> <u>slave</u> <u>directory</u>

       <b>::safe::interpFindInAccessPath</b> <u>slave</u> <u>directory</u>

       <b>::safe::setLogCmd</b> ?<u>cmd</u> <u>arg...</u>?

<b>OPTIONS</b>
       ?<b>-accessPath</b> <u>pathList</u>?  ?<b>-statics</b> <u>boolean</u>? ?<b>-noStatics</b>?  ?<b>-nested</b> <u>boolean</u>? ?<b>-nestedLoadOk</b>?  ?<b>-delete</b>-<font color="#ffffff" class="whiteout">Hook&nbsp;?-deleteHook</font>
       <b>Hook</b> <u>script</u>?
____________________________________________________________________________________________________________


<b>DESCRIPTION</b>
       Safe Tcl is a mechanism for executing untrusted Tcl scripts safely and for providing mediated  access
       by such scripts to potentially dangerous functionality.

       The  Safe Base ensures that untrusted Tcl scripts cannot harm the hosting application.  The Safe Base
       prevents integrity and privacy attacks. Untrusted Tcl scripts are prevented from corrupting the state
       of the hosting application or computer. Untrusted scripts are also prevented from disclosing informa-<font color="#ffffff" class="whiteout">tion&nbsp;information</font>
       tion stored on the hosting computer or in the hosting application to any party.

       The Safe Base allows a master interpreter to create safe, restricted interpreters that contain a  set
       of predefined aliases for the <b>source</b>, <b>load</b>, <b>file</b>, <b>encoding</b>, and <b>exit</b> commands and are able to use the
       auto-loading and package mechanisms.

       No knowledge of the file system structure is leaked to the safe interpreter, because  it  has  access
       only to a virtualized path containing tokens. When the safe interpreter requests to source a file, it
       uses the token in the virtual path as part of the file name to source; the master interpreter  trans-<font color="#ffffff" class="whiteout">parently&nbsp;transparently</font>
       parently  translates  the  token into a real directory name and executes the requested operation (see
       the section <b>SECURITY</b> below for details).  Different levels of security can be selected by  using  the
       optional flags of the commands described below.

       All commands provided in the master interpreter by the Safe Base reside in the <b>safe</b> namespace:


<b>COMMANDS</b>
       The following commands are provided in the master interpreter:

       <b>::safe::interpCreate</b> ?<u>slave</u>? ?<u>options...</u>?
              Creates a safe interpreter, installs the aliases described in the section <b>ALIASES</b> and initial-<font color="#ffffff" class="whiteout">izes&nbsp;initializes</font>
              izes the auto-loading and package mechanism as specified by the  supplied  <b>options</b>.   See  the
              <b>OPTIONS</b>  section  below for a description of the optional arguments.  If the <u>slave</u> argument is
              omitted, a name will be generated.  <b>::safe::interpCreate</b> always returns the interpreter  name.

       <b>::safe::interpInit</b> <u>slave</u> ?<u>options...</u>?
              This  command  is similar to <b>interpCreate</b> except it that does not create the safe interpreter.
              <u>slave</u> must have been created by some other means, like <b>interp</b> <b>create</b> <b>-safe</b>.

       <b>::safe::interpConfigure</b> <u>slave</u> ?<u>options...</u>?
              If no <u>options</u> are given, returns the settings for all options for the named  safe  interpreter
              as a list of options and their current values for that <u>slave</u>.  If a single additional argument
              is provided, it will return a list of 2 elements <u>name</u> and <u>value</u> where <u>name</u> is the full name of
              that option and <u>value</u> the current value for that option and the <u>slave</u>.  If more than two addi-<font color="#ffffff" class="whiteout">tional&nbsp;additional</font>
              tional arguments are provided, it will reconfigure the safe interpreter and  change  each  and
              only the provided options.  See the section on <b>OPTIONS</b> below for options description.  Example
              of use:
                     # Create a new interp with the same configuration as "$i0" :
                     set i1 [eval safe::interpCreate [safe::interpConfigure $i0]]
                     # Get the current deleteHook
                     set dh [safe::interpConfigure $i0  -del]
                     # Change (only) the statics loading ok attribute of an interp
                     # and its deleteHook (leaving the rest unchanged) :
                     safe::interpConfigure $i0  -delete {foo bar} -statics 0 ;

       <b>::safe::interpDelete</b> <u>slave</u>
              Deletes the safe interpreter and cleans up the corresponding master  interpreter  data  struc-<font color="#ffffff" class="whiteout">tures.&nbsp;structures.</font>
              tures.   If  a <u>deleteHook</u> script was specified for this interpreter it is evaluated before the
              interpreter is deleted, with the name of the interpreter as an additional argument.

       <b>::safe::interpFindInAccessPath</b> <u>slave</u> <u>directory</u>
              This command finds and returns the token for the real directory <u>directory</u> in the  safe  inter-<font color="#ffffff" class="whiteout">preter's&nbsp;interpreter's</font>
              preter's  current  virtual  access path.  It generates an error if the directory is not found.
              Example of use:
                     $slave eval [list set tk_library [::safe::interpFindInAccessPath $name $tk_library]]

       <b>::safe::interpAddToAccessPath</b> <u>slave</u> <u>directory</u>
              This command adds <u>directory</u> to the virtual path maintained for the  safe  interpreter  in  the
              master,  and  returns  the  token that can be used in the safe interpreter to obtain access to
              files in that directory.  If the directory is already in the virtual path, it only returns the
              token without adding the directory to the virtual path again.  Example of use:
                     $slave eval [list set tk_library [::safe::interpAddToAccessPath $name $tk_library]]

       <b>::safe::setLogCmd</b> ?<u>cmd</u> <u>arg...</u>?
              This  command  installs  a script that will be called when interesting life cycle events occur
              for a safe interpreter.  When called with no arguments, it  returns  the  currently  installed
              script.   When  called  with  one argument, an empty string, the currently installed script is
              removed and logging is turned off.  The script will be invoked with one additional argument, a
              string describing the event of interest.  The main purpose is to help in debugging safe inter-<font color="#ffffff" class="whiteout">preters.&nbsp;interpreters.</font>
              preters.  Using this facility you can get complete error messages while the  safe  interpreter
              gets only generic error messages.  This prevents a safe interpreter from seeing messages about
              failures and other events that might contain sensitive  information  such  as  real  directory
              names.
              Example of use:
                     ::safe::setLogCmd puts stderr
              Below is the output of a sample session in which a safe interpreter attempted to source a file
              not found in its virtual access path.  Note that the safe interpreter only received  an  error
              message saying that the file was not found:
                     NOTICE for slave interp10 : Created
                     NOTICE for slave interp10 : Setting accessPath=(/foo/bar) staticsok=1 nestedok=0 deletehook=()
                     NOTICE for slave interp10 : auto_path in interp10 has been set to {$p(:0:)}
                     ERROR for slave interp10 : /foo/bar/init.tcl: no such file or directory


<b>OPTIONS</b>
       The  following options are common to <b>::safe::interpCreate</b>, <b>::safe::interpInit</b>, and <b>::safe::interpCon</b>-<font color="#ffffff" class="whiteout">figure.&nbsp;::safe::interpConfigure.</font>
       <b>figure</b>.  Any option name can be abbreviated to its minimal non-ambiguous name.  Option names are  not
       case sensitive.

       <b>-accessPath</b> <u>directoryList</u>
              This  option  sets the list of directories from which the safe interpreter can <b>source</b> and <b>load</b>
              files.  If this option is not specified, or if it is given as the empty list, the safe  inter-<font color="#ffffff" class="whiteout">preter&nbsp;interpreter</font>
              preter will use the same directories as its master for auto-loading.  See the section <b>SECURITY</b>
              below for more detail about virtual paths, tokens and access control.

       <b>-statics</b> <u>boolean</u>
              This option specifies if the safe interpreter will be allowed to load statically linked  pack-<font color="#ffffff" class="whiteout">ages&nbsp;packages</font>
              ages  (like  <b>load</b>  <b>{}</b>  <b>Tk</b>).  The default value is <b>true</b> : safe interpreters are allowed to load
              statically linked packages.

       <b>-noStatics</b>
              This option is a convenience shortcut for <b>-statics</b> <b>false</b> and  thus  specifies  that  the  safe
              interpreter will not be allowed to load statically linked packages.

       <b>-nested</b> <u>boolean</u>
              This  option  specifies  if the safe interpreter will be allowed to load packages into its own
              sub-interpreters.  The default value is <b>false</b> : safe interpreters  are  not  allowed  to  load
              packages into their own sub-interpreters.

       <b>-nestedLoadOk</b>
              This option is a convenience shortcut for <b>-nested</b> <b>true</b> and thus specifies the safe interpreter
              will be allowed to load packages into its own sub-interpreters.

       <b>-deleteHook</b> <u>script</u>
              When this option is given an non empty <u>script</u>, it will be evaluated in  the  master  with  the
              name  of the safe interpreter as an additional argument just before actually deleting the safe
              interpreter.  Giving an empty value removes any currently installed deletion hook  script  for
              that safe interpreter.  The default value (<b>{}</b>) is not to have any deletion call back.

<b>ALIASES</b>
       The following aliases are provided in a safe interpreter:

       <b>source</b> <u>fileName</u>
              The  requested  file,  a Tcl source file, is sourced into the safe interpreter if it is found.
              The <b>source</b> alias can only source files from directories in  the  virtual  path  for  the  safe
              interpreter.  The  <b>source</b> alias requires the safe interpreter to use one of the token names in
              its virtual path to denote the directory in which the file to be sourced can  be  found.   See
              the section on <b>SECURITY</b> for more discussion of restrictions on valid filenames.

       <b>load</b> <u>fileName</u>
              The  requested  file, a shared object file, is dynamically loaded into the safe interpreter if
              it is found.  The filename must contain a token name mentioned in the  virtual  path  for  the
              safe  interpreter  for it to be found successfully.  Additionally, the shared object file must
              contain a safe entry point; see the manual page for the <b>load</b> command for more details.

       <b>file</b> ?<u>subCmd</u> <u>args...</u>?
              The <b>file</b> alias provides access to a safe subset of the subcommands of  the  <b>file</b>  command;  it
              allows  only  <b>dirname</b>,  <b>join</b>,  <b>extension</b>, <b>root</b>, <b>tail</b>, <b>pathname</b> and <b>split</b> subcommands. For more
              details on what these subcommands do see the manual page for the <b>file</b> command.

       <b>encoding</b> ?<u>subCmd</u> <u>args...</u>?
              The <b>encoding</b> alias provides access to a safe subset of the subcommands of  the  <b>encoding</b>  com-<font color="#ffffff" class="whiteout">mand;&nbsp;command;</font>
              mand;  it disallows setting of the system encoding, but allows all other subcommands including
              <b>system</b> to check the current encoding.

       <b>exit</b>   The calling interpreter is deleted and its computation is stopped,  but  the  Tcl  process  in
              which this interpreter exists is not terminated.


<b>SECURITY</b>
       The  Safe  Base does not attempt to completely prevent annoyance and denial of service attacks. These
       forms of attack prevent the application or user from temporarily using the computer to perform useful
       work,  for  example  by  consuming all available CPU time or all available screen real estate.  These
       attacks, while aggravating, are deemed to be of lesser importance in general than integrity and  pri-<font color="#ffffff" class="whiteout">vacy&nbsp;privacy</font>
       vacy attacks that the Safe Base is to prevent.

       The commands available in a safe interpreter, in addition to the safe set as defined in <b>interp</b> manual
       page, are mediated aliases for <b>source</b>, <b>load</b>, <b>exit</b>, and safe subsets of <b>file</b> and  <b>encoding</b>.  The  safe
       interpreter can also auto-load code and it can request that packages be loaded.

       Because  some  of  these  commands access the local file system, there is a potential for information
       leakage about its directory structure.  To prevent this, commands that take file names  as  arguments
       in a safe interpreter use tokens instead of the real directory names.  These tokens are translated to
       the real directory name while a request to, e.g., source a file is  mediated  by  the  master  inter-<font color="#ffffff" class="whiteout">preter.&nbsp;interpreter.</font>
       preter.   This  virtual path system is maintained in the master interpreter for each safe interpreter
       created by <b>::safe::interpCreate</b> or initialized by <b>::safe::interpInit</b> and the path maps tokens  acces-<font color="#ffffff" class="whiteout">sible&nbsp;accessible</font>
       sible  in  the  safe  interpreter  into real path names on the local file system thus preventing safe
       interpreters from gaining knowledge about the structure of the file system of the host on  which  the
       interpreter  is  executing.  The only valid file names arguments for the <b>source</b> and <b>load</b> aliases pro-<font color="#ffffff" class="whiteout">vided&nbsp;provided</font>
       vided to the slave are path in the form of <b>[file</b> <b>join</b> <u>token</u> <u>filename</u><b>]</b> (ie, when using the native file
       path  formats:  <u>token</u><b>/</b><u>filename</u>  on  Unix,  <u>token</u><b>\</b><u>filename</u> on Windows, and <u>token</u><b>:</b><u>filename</u> on the Mac),
       where <u>token</u> is representing one of the directories of the <u>accessPath</u> list and <u>filename</u> is one file in
       that directory (no sub directories access are allowed).

       When  a  token  is  used  in  a  safe interpreter in a request to source or load a file, the token is
       checked and translated to a real path name and the file to be sourced or loaded  is  located  on  the
       file system.  The safe interpreter never gains knowledge of the actual path name under which the file
       is stored on the file system.

       To further prevent potential information leakage from sensitive files that are accidentally  included
       in  the  set of files that can be sourced by a safe interpreter, the <b>source</b> alias restricts access to
       files meeting the following constraints: the file name must fourteen characters or shorter, must  not
       contain more than one dot ("<b>.</b>"), must end up with the extension <b>.tcl</b> or be called <b>tclIndex</b>.

       Each  element  of the initial access path list will be assigned a token that will be set in the slave
       <b>auto_path</b> and the first element of that list will be set as the <b>tcl_library</b> for that slave.

       If the access path argument is not given or is the empty list, the default behavior  is  to  let  the
       slave  access  the  same  packages  as the master has access to (Or to be more precise: only packages
       written in Tcl (which by definition can't be dangerous as they run in the slave  interpreter)  and  C
       extensions  that  provides a Safe_Init entry point). For that purpose, the master's <b>auto_path</b> will be
       used to construct the slave access path.  In order that the slave successfully loads the Tcl  library
       files  (which  includes  the auto-loading mechanism itself) the <b>tcl_library</b> will be added or moved to
       the first position if necessary, in the slave access path, so the slave <b>tcl_library</b> will be the  same
       as  the  master's  (its  real path will still be invisible to the slave though).  In order that auto-<font color="#ffffff" class="whiteout">loading&nbsp;autoloading</font>
       loading works the same for the slave and the master in this by  default  case,  the  first-level  sub
       directories of each directory in the master <b>auto_path</b> will also be added (if not already included) to
       the slave access path.  You can always specify a more restrictive path for which sub directories will
       never  be  searched by explicitly specifying your directory list with the <b>-accessPath</b> flag instead of
       relying on this default mechanism.

       When the <u>accessPath</u> is changed after the first creation or initialization (ie through <b>interpConfigure</b>
       <b>-accessPath</b>  <u>list</u>),  an  <b>auto_reset</b> is automatically evaluated in the safe interpreter to synchronize
       its <b>auto_index</b> with the new token list.


<b>SEE</b> <b>ALSO</b>
       <a href="interp.ntcl.html#//apple_ref/doc/man/n/interp">interp(n)</a>, <a href="library.ntcl.html#//apple_ref/doc/man/n/library">library(n)</a>, <a href="load.ntcl.html#//apple_ref/doc/man/n/load">load(n)</a>, <a href="package.ntcl.html#//apple_ref/doc/man/n/package">package(n)</a>, <a href="source.ntcl.html#//apple_ref/doc/man/n/source">source(n)</a>, <a href="unknown.ntcl.html#//apple_ref/doc/man/n/unknown">unknown(n)</a>


<b>KEYWORDS</b>
       alias, auto-loading, auto_mkindex, load, master interpreter,  safe  interpreter,  slave  interpreter,
       source



Tcl                                                  8.0                                         Safe <a href="Tcl.ntcl.html#//apple_ref/doc/man/n/Tcl">Tcl(n)</a>
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/mann/SafeBase.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/mann/SafeBase.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/mann/SafeBase.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
