<html><head><title>Mac OS X
 Manual Page For ipsec_set_policy(3)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3/ipsec_set_policy" title="Mac OS X
 Manual Page for ipsec_set_policy(3)"><!-- headerDoc=man; indexgroup=Section 3; uid="//apple_ref/doc/man/3/ipsec_set_policy"; name=ipsec_set_policy(3) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
IPSEC_SET_POLICY(3)      BSD Library Functions Manual      IPSEC_SET_POLICY(3)

<b>NAME</b>
     <b>ipsec_dump_policy</b>, <b>ipsec_get_policylen</b>, <b>ipsec_set_policy</b> -- manipulate IPsec policy specification
     structure from human-readable policy string

<b>LIBRARY</b>
     IPsec Policy Control Library (libipsec, -lipsec)

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;netinet6/ipsec.h&gt;</b>

     <u>char</u> <u>*</u>
     <b>ipsec_dump_policy</b>(<u>caddr</u><b>_</b><u>t</u> <u>buf</u>, <u>char</u> <u>*delim</u>);

     <u>int</u>
     <b>ipsec_get_policylen</b>(<u>caddr</u><b>_</b><u>t</u> <u>buf</u>);

     <u>char</u> <u>*</u>
     <b>ipsec_set_policy</b>(<u>char</u> <u>*policy</u>, <u>int</u> <u>len</u>);

<b>DESCRIPTION</b>
     <b>ipsec_set_policy</b>() generates an IPsec policy specification structure, namely struct sadb_x_policy
     and/or struct sadb_x_ipsecrequest from a human-readable policy specification.  The policy specification
     must be given as a C string <u>policy</u> and its length <u>len</u>.  <b>ipsec_set_policy</b>() will return a buffer with
     the corresponding IPsec policy specification structure.  The buffer is dynamically allocated, and must
     be <a href="free.3.html#//apple_ref/doc/man/3/free">free(3)</a>'d by the caller.

     You can get the length of the generated buffer with <b>ipsec_get_policylen</b>() (i.e. for calling
     <a href="../man2/setsockopt.2.html#//apple_ref/doc/man/2/setsockopt">setsockopt(2)</a>).

     <b>ipsec_dump_policy</b>() converts an IPsec policy structure into human-readable form.  Therefore,
     <b>ipsec_dump_policy</b>() can be regarded as the inverse function to <b>ipsec_set_policy</b>().  <u>buf</u> points to an
     IPsec policy structure, struct sadb_x_policy.  <u>delim</u> is a delimiter string, which is usually a blank
     character.  If you set <u>delim</u> to NULL, a single whitespace is assumed.  <b>ipsec_dump_policy</b>() returns a
     pointer to a dynamically allocated string.  It is the caller's responsibility to <a href="free.3.html#//apple_ref/doc/man/3/free">free(3)</a> it.

     <u>policy</u> is formatted as either of the following:

     <u>direction</u> <u>[priority</u> <u>specification]</u> discard
              <u>direction</u> must be in, out, or fwd.  <u>direction</u> specifies in which direction the policy needs to
              be applied.  The non-standard direction fwd is substituted with in on platforms which do not
              support forward policies.

              <u>priority</u> <u>specification</u> is used to control the placement of the policy within the SPD.  The
              policy position is determined by a signed integer where higher priorities indicate the policy
              is placed closer to the beginning of the list and lower priorities indicate the policy is
              placed closer to the end of the list.  Policies with equal priorities are added at the end of
              the group of such policies.

              Priority can only be specified when libipsec has been compiled against kernel headers that
              support policy priorities (Linux &gt;= 2.6.6).  It takes one of the following formats:

              <u>{priority,prio}</u> <u>offset</u>
                       <u>offset</u> is an integer in the range -2147483647..214783648.

              <u>{priority,prio}</u> <u>base</u> <u>{+,-}</u> <u>offset</u>
                       <u>base</u> is either low (-1073741824), def (0), or high (1073741824).

                       <u>offset</u> is an unsigned integer.  It can be up to 1073741824 for positive offsets, and
                       up to 1073741823 for negative offsets.

              The interpretation of policy priority in these functions and the kernel DOES differ.  The
              relationship between the two can be described as p(kernel) = 0x80000000 - p(func)

              With discard policy, packets will be dropped if they match the policy.

     <u>direction</u> <u>[priority</u> <u>specification]</u> entrust
              entrust means to consult the SPD defined by <a href="../man8/setkey.8.html#//apple_ref/doc/man/8/setkey">setkey(8)</a>.

     <u>direction</u> <u>[priority</u> <u>specification]</u> bypass
              bypass means to bypass the IPsec processing.  (the packet will be transmitted in clear).  This
              is for privileged sockets.

     <u>direction</u> [<u>priority</u> <u>specification</u>] ipsec <u>request</u> <u>...</u>
              ipsec means that the matching packets are subject to IPsec processing.  ipsec can be followed
              by one or more <u>request</u> strings, which are formatted as below:

              <u>protocol</u> / <u>mode</u> / <u>src</u> - <u>dst</u> [<u>/level</u>]
                       <u>protocol</u> is either ah, esp, or ipcomp.

                       <u>mode</u> is either transport or tunnel.

                       <u>src</u> and <u>dst</u> specifies the IPsec endpoint.  <u>src</u> always means the ``sending node'' and
                       <u>dst</u> always means the ``receiving node''.  Therefore, when <u>direction</u> is in, <u>dst</u> is
                       this node and <u>src</u> is the other node (peer).  If <u>mode</u> is transport, Both <u>src</u> and <u>dst</u>
                       can be omitted.

                       <u>level</u> must be set to one of the following: default, use, require, or unique.  default
                       means that the kernel should consult the system default policy defined by <a href="../man8/sysctl.8.html#//apple_ref/doc/man/8/sysctl">sysctl(8)</a>,
                       such as net.inet.ipsec.esp_trans_deflev.  See <a href="../man4/ipsec.4.html#//apple_ref/doc/man/4/ipsec">ipsec(4)</a> regarding the system default.
                       use means that a relevant SA can be used when available, since the kernel may perform
                       IPsec operation against packets when possible.  In this case, packets can be trans-<font color="#ffffff" class="whiteout">mitted&nbsp;transmitted</font>
                       mitted in clear (when SA is not available), or encrypted (when SA is available).
                       require means that a relevant SA is required, since the kernel must perform IPsec
                       operation against packets.  unique is the same as require, but adds the restriction
                       that the SA for outbound traffic is used only for this policy.  You may need the
                       identifier in order to relate the policy and the SA when you define the SA by manual
                       keying.  You can put the decimal number as the identifier after unique like unique:
                       number.  number must be between 1 and 32767 .  If the <u>request</u> string is kept unam-<font color="#ffffff" class="whiteout">biguous,&nbsp;unambiguous,</font>
                       biguous, <u>level</u> and slash prior to <u>level</u> can be omitted.  However, it is encouraged to
                       specify them explicitly to avoid unintended behavior.  If <u>level</u> is omitted, it will
                       be interpreted as default.

              Note that there are slight differences to the specification of <a href="../man8/setkey.8.html#//apple_ref/doc/man/8/setkey">setkey(8)</a>.  In the specifica-<font color="#ffffff" class="whiteout">tion&nbsp;specification</font>
              tion of <a href="../man8/setkey.8.html#//apple_ref/doc/man/8/setkey">setkey(8)</a>, both entrust and bypass are not used.  Refer to <a href="../man8/setkey.8.html#//apple_ref/doc/man/8/setkey">setkey(8)</a> for details.

              Here are several examples (long lines are wrapped for readability):

                    in discard
                    out ipsec esp/transport//require
                    in ipsec ah/transport//require
                    out ipsec esp/tunnel/10.1.1.2-10.1.1.1/use
                    in ipsec ipcomp/transport//use
                            esp/transport//use

<b>RETURN</b> <b>VALUES</b>
     <b>ipsec_set_policy</b>() returns a pointer to the allocated buffer with the policy specification if success-<font color="#ffffff" class="whiteout">ful;&nbsp;successful;</font>
     ful; otherwise a NULL pointer is returned.  <b>ipsec_get_policylen</b>() returns a positive value (meaning the
     buffer size) on success, and a negative value on errors.  <b>ipsec_dump_policy</b>() returns a pointer to a
     dynamically allocated region on success, and NULL on errors.

<b>SEE</b> <b>ALSO</b>
     <a href="ipsec_strerror.3.html#//apple_ref/doc/man/3/ipsec_strerror">ipsec_strerror(3)</a>, <a href="../man4/ipsec.4.html#//apple_ref/doc/man/4/ipsec">ipsec(4)</a>, <a href="../man8/setkey.8.html#//apple_ref/doc/man/8/setkey">setkey(8)</a>

<b>HISTORY</b>
     The functions first appeared in the WIDE/KAME IPv6 protocol stack kit.

BSD                               May 5, 1998                              BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/ipsec_set_policy.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/ipsec_set_policy.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/ipsec_set_policy.3.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
