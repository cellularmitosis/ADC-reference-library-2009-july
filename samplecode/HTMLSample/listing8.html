<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>HTMLSample - /History.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxUserExperience-date.html">User Experience</a> &gt; <A HREF="javascript:location.replace('index.html');">HTMLSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Not Recommended Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>The information in this document is <strong>Not Recommended</strong> and should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxUserExperience-date.html" target="_blank">Carbon > User Experience</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">HTMLSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/History.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/AboutBox.c</option>
<option value="listing2.html">/AboutBox.h</option>
<option value="listing3.html">/CIconButtons.c</option>
<option value="listing4.html">/CIconButtons.h</option>
<option value="listing5.html">/CWDefines.h</option>
<option value="listing6.html">/debugf.c</option>
<option value="listing7.html">/debugf.h</option>
<option value="listing8.html">/History.c</option>
<option value="listing9.html">/History.h</option>
<option value="listing10.html">/HTMLSample Help/buttons.html</option>
<option value="listing11.html">/HTMLSample Help/index.html</option>
<option value="listing12.html">/HTMLSample Pages/docs/display.html</option>
<option value="listing13.html">/HTMLSample Pages/docs/drawing.html</option>
<option value="listing14.html">/HTMLSample Pages/docs/generalroutines.html</option>
<option value="listing15.html">/HTMLSample Pages/docs/index.html</option>
<option value="listing16.html">/HTMLSample Pages/docs/intro.html</option>
<option value="listing17.html">/HTMLSample Pages/docs/types.html</option>
<option value="listing18.html">/HTMLSample Pages/docs/userdefined.html</option>
<option value="listing19.html">/HTMLSample Pages/docs/utilities.html</option>
<option value="listing20.html">/HTMLSample Pages/error.html</option>
<option value="listing21.html">/HTMLSample Pages/index.html</option>
<option value="listing22.html">/HTMLSample.c</option>
<option value="listing23.html">/HTMLSample.h</option>
<option value="listing24.html">/HTMLSample.r</option>
<option value="listing25.html">/RenderingWindow.c</option>
<option value="listing26.html">/RenderingWindow.h</option>
<option value="listing27.html">/SampleUtils.c</option>
<option value="listing28.html">/SampleUtils.h</option></select>
				</p>
				</form>
				<p><strong><a href="HTMLSample.zip">Download Sample</a></strong> (&#147;HTMLSample.zip&#148;, 279.4K)<BR>
<strong><a href="HTMLSample.dmg">Download Sample</a></strong> (&#147;HTMLSample.dmg&#148;, 330.4K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  file History.c    Description:  These routines are used to store visitled links.    HTMLSample is an application illustrating how to use the new  HTMLRenderingLib services found in Mac OS 9. HTMLRenderingLib  is Apple's light-weight HTML rendering engine capable of  displaying HTML files.  by John Montbriand, 1999.  Copyright: &copy; 1999 by Apple Computer, Inc.  all rights reserved.    Disclaimer:  You may incorporate this sample code into your applications without  restriction, though the sample code has been provided &quot;AS IS&quot; and the  responsibility for its operation is 100% yours.  However, what you are  not permitted to do is to redistribute the source as &quot;DSC Sample Code&quot;  after having made changes. If you're going to re-distribute the source,  we require that you make it clear in the source that the code was  descended from Apple Sample Code, but that you've made changes.    Change History (most recent first):  10/16/99 created by John Montbriand*/#include &quot;History.h&quot;#include &quot;SampleUtils.h&quot;#include &lt;stddef.h&gt;#ifdef __APPLE_CC__#include &lt;Carbon/Carbon.h&gt;#else#include &lt;Carbon.h&gt;#endif#include &lt;string.h&gt;/* individual elements in the history are stored in a linked  list.  it's a two way list for easy insertions and deletions. */typedef struct HistoryStruct HistoryRecord;typedef HistoryRecord *HistoryPtr, **HistoryHandle;struct HistoryStruct {  HistoryHandle prev, next;  char url[1];  unsigned char printName[1];};/* the history data handle contains a list of history  elements along with a pointer to the current  element being displayed. */struct HistoryData {  HistoryHandle first, last;  HistoryHandle current;};/* NewHistory creats a new history and returns  a handle to it. Here, we just return an handled  set to zero. */HistoryDataHandle NewHistory(void) {  return (HistoryDataHandle) NewHandleClear(sizeof(HistoryData));}/* DisposeHistory disposes of a history and all of the  structures allocated for it. */void DisposeHistory(HistoryDataHandle hd) {  HistoryHandle rover, temp;  rover = (**hd).first;    /* delete all of the elements in the history list */  while (rover != NULL) {    temp = rover;    rover = (**rover).next;    DisposeHandle((Handle) temp);  }  DisposeHandle((Handle) hd);}/* AddToHistory adds a new element to the history.  Both  the URL and the printed representation of its url  are stored.  NOTE:  if we have called GoBack a few times  before this call, then those previously viewed items  are removed from the history. This is so if we choose  GoBack again, then we will arrive at the same link we  are looking at now.  */OSErr AddToHistory(HistoryDataHandle hd, char const* url, StringPtr printName) {  HistoryHandle hrec, rover;  long strbytes;    /* create a new history record */  strbytes = SUstrlen(url);  hrec = (HistoryHandle) NewHandle(offsetof(HistoryRecord, url) + strbytes + 1 + printName[0] + 1);  if (hrec == NULL) return memFullErr;  BlockMoveData(url, (**hrec).url, strbytes + 1);  BlockMoveData(printName, (**hrec).url + strbytes + 1, printName[0] + 1);  (**hrec).prev = (**hrec).next = NULL;    /* clear out records after current.  We do this    so the next time we choose the go back command,    we'll arrive at the same one that was the current    one before this routine was called.  Essentially, the    user is conducting a depth first search of the html,    and here we are branching.  */  while ((**hd).current != (**hd).last &amp;&amp; (**hd).current != NULL) {    rover = (**(**hd).current).next;    if ((**rover).next != NULL)      (**(**rover).next).prev = (**rover).prev;    else (**hd).last = (**rover).prev;    if ((**rover).prev != NULL)      (**(**rover).prev).next = (**rover).next;    else (**hd).first = (**rover).next;    DisposeHandle((Handle) rover);  }    /* add the new record to the end of the list */  if ((**hd).first == NULL)    (**hd).first = (**hd).last = hrec;  else {    (**hrec).prev = (**hd).last;    (**(**hd).last).next = hrec;    (**hd).last = hrec;  }  (**hd).current = hrec;  return noErr;}/* InHistory returns true if the URL is among the urls  currently stored in the history. */Boolean InHistory(HistoryDataHandle hd, char const* url) {  HistoryHandle rover;  Boolean isequal;  for (rover = (**hd).first; rover != NULL; rover = (**rover).next) {    HLock((Handle) rover);    isequal = (SUstrcmp(url, (**rover).url) == 0);    HUnlock((Handle) rover);    if (isequal) return true;  }  return false;}/* CanGoBack returns true if it makes sense to call the  GoBack command.  i.e. if there are one or more links  in the history beyond the current one. */Boolean CanGoBack(HistoryDataHandle hd) {  if ((**hd).current == NULL)    return false;  else return ((**(**hd).current).prev != NULL);}/* GoBack copies the previous url in the history  into a new handle and returns that handle in  *url.  It is the caller's responsibility to dispose  of the handle after it has been used. */OSErr GoBack(HistoryDataHandle hd, Handle *url) {  OSErr err;  HistoryHandle nextcurrent;  if ((**hd).current == NULL) return paramErr;  nextcurrent = (**(**hd).current).prev;  HLock((Handle) nextcurrent);  err = PtrToHand((**nextcurrent).url, url, SUstrlen((**nextcurrent).url) + 1);  HUnlock((Handle) nextcurrent);  if (err == noErr)    (**hd).current = nextcurrent;  return err;}/* CanGoForward returns true if it makes sense to call the  GoForward command.  i.e. if there are one or more links  in the history ahead of the current one.  This can only  happen after the user has chosen GoBack one or more  times. */Boolean CanGoForward(HistoryDataHandle hd) {  if ((**hd).current == NULL)    return false;  else return ((**(**hd).current).next != NULL);}/* GoForward copies the next url in the history  into a new handle and returns that handle in  *url.  It is the caller's responsibility to dispose  of the handle after it has been used. */OSErr GoForward(HistoryDataHandle hd, Handle *url) {  OSErr err;  HistoryHandle nextcurrent;  if ((**hd).current == NULL) return paramErr;  nextcurrent = (**(**hd).current).next;  HLock((Handle) nextcurrent);  err = PtrToHand((**nextcurrent).url, url, SUstrlen((**nextcurrent).url) + 1);  HUnlock((Handle) nextcurrent);  if (err == noErr)    (**hd).current = nextcurrent;  return err;}/* CanGoHome returns true if it makes sense to call the  GoHome command.  i.e. if there are one or more links  in the history.  This can only happen after AddToHistory  has been called one or more times. */Boolean CanGoHome(HistoryDataHandle hd) {  return ((**hd).first != (**hd).current) &amp;&amp; ((**hd).current != NULL);}/* GoBack copies the first url in the history  into a new handle and returns that handle in  *url.  It is the caller's responsibility to dispose  of the handle after it has been used. */OSErr GoHome(HistoryDataHandle hd, Handle *url) {  OSErr err;  if ((**hd).first == NULL) return paramErr;  HLock((Handle) (**hd).first);  err = PtrToHand((**(**hd).first).url, url, SUstrlen((**(**hd).first).url) + 1);  HUnlock((Handle) (**hd).first);  if (err == noErr)    (**hd).current = (**hd).first;  return err;}/* AppendHistoryToMenu rebuilds the Go menu adding items to the  bottom of the menu according to the items in the  history.  The names of the items are the same as  the printNames provided in the AddToHistory command. */OSErr AppendHistoryToMenu(HistoryDataHandle hd, MenuHandle theMenu) {  HistoryHandle rover;  Str255 title;  unsigned char *titlep;  if ((**hd).last == NULL) return noErr;  AppendMenu(theMenu, &quot;\p(-&quot;);  for (rover = (**hd).last; rover != NULL; rover = (**rover).prev) {    HUnlock((Handle) rover);    titlep = (unsigned char *) ((**rover).url + SUstrlen((**rover).url) + 1);    BlockMoveData(titlep, title, titlep[0] + 1);    AppendMenu(theMenu, title);    HUnlock((Handle) rover);  }  return noErr;}/* GoToMenuItem copies the itemIndex'th url in the history  into a new handle and returns that handle in  *url.  It is the caller's responsibility to dispose  of the handle after it has been used.  This routine  should only be called after a menu selection has  been made in a menu built by AppendHistoryToMenu.  */OSErr GoToMenuItem(HistoryDataHandle hd, Handle *url, short itemIndex) {  HistoryHandle rover;  short i;  OSErr err;  if ((**hd).last == NULL) return paramErr;  for (i = 1, rover = (**hd).last; rover != NULL; rover = (**rover).prev, i++) {    if (i == itemIndex) {      HLock((Handle) rover);      err = PtrToHand((**rover).url, url, SUstrlen((**rover).url) + 1);      HUnlock((Handle) rover);      if (err == noErr)        (**hd).current = rover;      return err;    }  }  return noErr;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/HTMLSample/listing8.html%3Fid%3DDTS10000579-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/HTMLSample/listing8.html%3Fid%3DDTS10000579-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/HTMLSample/listing8.html%3Fid%3DDTS10000579-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>