<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The ADSP Connection Control Block Record(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING117></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-116.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-118.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-98.html"><B>Chapter 5 - AppleTalk Data Stream Protocol (ADSP) </B></A> / <A HREF="Networking-115.html"><B>ADSP Reference</B></A><BR><DL><DD><A HREF="Networking-116.html"><B>Data Structures</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING117-0></A>
<H3><A NAME=MARKER-9-232></A>The ADSP Connection Control Block Record</H3>
 <A NAME=MARKER-9-63></A><A NAME=MARKER-9-77></A>The connection control block (CCB) data structure is a record of type <CODE>TRCCB</CODE> that consists of 242 bytes. ADSP uses the CCB to store state information about the connection end. You allocate a nonrelocatable block of memory for this data structure when you create a connection end. <A NAME=MARKER-2-235></A><A NAME=MARKER-2-236></A>You may read the fields in the CCB to obtain information about the connection end, but you are not allowed to write to any of the fields except one, the <CODE>userFlags</CODE> field.<P>
<PRE>
TYPE TRCCB = 
PACKED RECORD
   ccbLink:       TPCCB;      {link to next CCB}
   refNum:        Integer;    {reference number}
   state:         Integer;    {state of the connection end}
   userFlags:     Byte;       {user flags for connection}
   localSocket:   Byte;       {local socket number}
   remoteAddress: AddrBlock;  {remote end internet address}
   attnCode:      Integer;    {attention code received}
   attnSize:      Integer;    {size of attention data}
   attnPtr:       Ptr;        {pointer to attention data}
   reserved:      PACKED ARRAY[1..220] OF Byte;
                              {reserved for use by ADSP}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE>ccbLink</CODE>
<DD> A pointer to the next CCB. This field is for use by ADSP only.<A NAME=MARKER-2-237></A>
<DT><CODE>refNum</CODE>
<DD> The reference number of the CCB. This number is assigned by ADSP when you establish the connection end.<A NAME=MARKER-2-238></A>
<DT><CODE>state</CODE>
<DD> The state of the connection end, as follows:<A NAME=MARKER-2-239></A>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>State<TH>Value<TH>Meaning<TR>
<TD rowspan=6>&nbsp;<TD rowspan=6>sListening<TD rowspan=6>1<TD rowspan=6><A NAME=MARKER-13-18></A>The socket is a connection listener--<BR>that is, a socket that accepts ADSP requests to open connections and passes them on to a socket client. A connection listening socket passes <BR>the open-connection request on to a routine that can establish the connec-<BR>tion on any socket. The connection listening state is ordinarily used only by connection servers.<A NAME=MARKER-2-19></A><TR>
<TR>
<TR>
<TR>
<TR>
<TR>
<TD rowspan=9>&nbsp;<TD rowspan=9>sPassive<TD rowspan=9>2<TD rowspan=9><A NAME=MARKER-13-22></A>The socket client is inactive but capable of accepting an ADSP request to open <BR>a connection. Unlike a connection listening socket, a socket client in the <CODE>sPassive</CODE> state can accept an open-<BR>connection request only to establish itself as a connection end.<A NAME=MARKER-2-23></A><TR>
<TR>
<TR>
<TR>
<TR>
<TR>
<TR>
<TR>
<TR>
<TD rowspan=3>&nbsp;<TD rowspan=3>sOpening<TD rowspan=3>3<TD rowspan=3><A NAME=MARKER-13-24></A>The socket client has sent an open-connection request and is waiting for acknowledgment. <A NAME=MARKER-2-25></A><TR>
<TR>
<TR>
<TD>&nbsp;<TD>sOpen<TD>4<TD><A NAME=MARKER-13-26></A>The connection is open.<A NAME=MARKER-2-27></A><TR>
<TD rowspan=5>&nbsp;<TD rowspan=5>sClosing<TD rowspan=5>5<TD rowspan=5><A NAME=MARKER-13-28></A>The socket client has requested that ADSP close the connection, and ADSP is sending data or waiting for acknowl-<BR>edgment of data it has sent before closing the connection. <A NAME=MARKER-2-29></A><TR>
<TR>
<TR>
<TR>
<TR>
<TD>&nbsp;<TD>sClosed<TD>6<TD><A NAME=MARKER-13-30></A>The connection <A NAME=MARKER-2-31></A>is closed.</TABLE>

<DT><CODE>userFlags</CODE>
<DD> Flags that indicate an unsolicited connection event has occurred. An unsolicited connection event is an event initiated by ADSP or the remote connection end that is not in response to any ADSP routine that you executed.<A NAME=MARKER-2-240></A><A NAME=MARKER-2-241></A>
<DT>
<DD> Each time an unsolicited connection event occurs, ADSP sets a flag in the <CODE>userFlags</CODE> field of the CCB and calls the routine you specified in the <CODE>userRoutine</CODE> parameter to the <CODE>dspInit</CODE> routine (if any). The user routine must read the <CODE>userFlags</CODE> field and then clear the flag to 0. ADSP cannot notify your routine of future events unless you clear the flag after each event.
<DT>
<DD> <A NAME=MARKER-2-242></A>ADSP recognizes four types of unsolicited connection events, one corresponding to each of the flags in this field. The events and flags are defined as follows, where bit 7 is the most significant bit:<A NAME=MARKER-2-243></A>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Event<TH>Flag <BR>bit<TH>Meaning<TR>
<TD>&nbsp;<TD>eClosed<TD>7<TD><A NAME=MARKER-13-32></A>ADSP has been informed by the remote connection end that the remote connection end has closed the connection. <A NAME=MARKER-2-33></A><TR>
<TD>&nbsp;<TD>eTearDown<TD>6<TD><A NAME=MARKER-13-34></A>ADSP has determined that the remote connection end is not responding and so has closed the connection. <A NAME=MARKER-2-35></A><TR>
<TD>&nbsp;<TD>eAttention<TD>5<TD><A NAME=MARKER-13-36></A>ADSP has received an attention message from the remote connection end. <A NAME=MARKER-2-37></A><TR>
<TD>&nbsp;<TD>eFwdReset<TD>4<TD><A NAME=MARKER-13-38></A>ADSP has received a forward reset command from the remote connection end, has discarded all ADSP data not yet delivered--including the data in the local client end's receive queue--and has resynchronized the connection. <A NAME=MARKER-2-39></A><TR>
<TD>&nbsp;<TD>None<TD>3-0<TD>Reserved.</TABLE>

<DT><CODE>localSocket</CODE>
<DD> The socket number through which DDP transmits and receives the ADSP packets.
<DT><CODE>remoteAddress</CODE>
<DD> The AppleTalk internet address of the socket used by the remote connection end.
<DT><CODE>attnCode</CODE>
<DD> The attention code received by ADSP when the remote connection end sends an <A NAME=MARKER-2-246></A>attention message.<A NAME=MARKER-2-248></A>
<DT><CODE>attnSize</CODE>
<DD> The size of the attention message received by ADSP when the remote connection end sends an attention message.
<DT><CODE>attnPtr</CODE>
<DD> A pointer to a buffer containing the attention message received by ADSP from the remote connection end.
<DT><CODE>reserved</CODE>
<DD> A data buffer reserved for use by ADSP.<A NAME=MARKER-2-250></A>
</DL>



</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-116.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-118.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  

