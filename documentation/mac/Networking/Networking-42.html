<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Selecting a Node in the Server Range(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING42></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-35.html"><B>Chapter 2 - AppleTalk Utilities</B></A> / <A HREF="Networking-36.html"><B>About the AppleTalk Utilities </B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING42-0></A>
<H2><A NAME=MARKER-9-50></A>Selecting a Node in the Server Range<A NAME=MARKER-2-54></A></H2>
 AppleTalk node IDs are divided into two classes: <B>user <A NAME=MARKER-9-52></A>node IDs</B> and <B>server node IDs.</B><P>
<UL>
<LI><A NAME=MARKER-2-83></A>User node IDs are in the range 1-127 ($01-$7F).
<LI><A NAME=MARKER-2-82></A>Server node IDs are in the range 128-254 ($80-$FE). <P>
</UL>
 AppleTalk's <A NAME=MARKER-9-55></A>dynamic node assignment occurs through a process in which the node acquiring a node ID sends out enquiry packets to determine if the ID that the node suggests is available. Although unlikely, problems can occur if a node that owns the suggested ID fails to respond to the enquiry because it is busy. <B></B><P>
 User nodes are switched on and off more frequently than are server nodes. Separating user node ID assignment from server node ID assignment allows for different degrees of verification. <P>
 Within the user node ID range, verification is performed quickly with fewer retransmis-<BR>sions of the enquiry control packet than are sent for server node ID verification; this decreases the initialization time for user nodes. A more thorough node ID verification is performed for servers. This scheme increases the initialization time for server nodes but is not detrimental to the server's operation because server nodes are rarely switched on and off. <P>
 You can start up AppleTalk so that it will assign a node ID within the server range by making an extended <CODE>Open</CODE> call to the .MPP driver. To do this, you set the immediate <BR>bit in the <CODE>_Open</CODE> trap. To request a server node ID, set to 1 the high bit (bit 31) of the extension longword field <CODE>ioMix</CODE> in the extended call. Set to 0 the remaining bits in the <CODE>ioMix</CODE> field and the bits of all the other unused fields in the queue element. The code in <A HREF=#MARKER-9-56>Listing 2-1</A> sets the high bit in the <CODE>ioMix</CODE> field, then it calls an assembly-language routine that is not shown in this listing, <CODE>PBOpenImmedSync</CODE>, to make the extended open call. The code uses the following global constants:<P>
<PRE>
SPConfig       = $01FB;
portBClearMask = $F0;
</PRE>
 The code in <A HREF=#MARKER-9-56>Listing 2-1</A> assumes that the .MPP driver is not currently open. It is important to remember that you can only request a server node ID when you first <BR>open the .MPP driver. <P>
<B>Listing 2-1  <A NAME=MARKER-9-56></A>Opening the .MPP driver and obtaining a node ID in the server range</B><P>
<PRE>
FUNCTION PBOpenImmedSync(paramBlock: ParmBlkPtr): OSErr;
INLINE $205F,$A200,$3E80;
FUNCTION OpenNodeInServerRange: OSerr;
IMPLEMENTATION
FUNCTION OpenNodeInServerRange: OSerr;
VAR
   MPPPtr:        ParmBlkPtr;
   err:           OSerr;
   MPPName:       Str31;
   SpConfigPtr:   Ptr;
BEGIN
   IF IsMPPOpen THEN
      BEGIN
         OpenNodeInServerRange := openErr;
      END
   ELSE
      BEGIN
         SPConfigPtr  := Ptr(SPConfig);
         SPConfigPtr^ := BYTE(BAND(SPConfigPtr^, portBClearMask));
         SPConfigPtr^ := BYTE(BOR(SPConfigPtr^, UseATalk));
         MPPName := '.MPP';
         MPPPtr := ParmBlkPtr(NewPtrClear(sizeof(ParamBlockRec)));
         MPPPtr^.ioMix := Ptr($80000000);
         MPPPtr^.ioNamePtr := @MPPName;
         OpenNodeInServerRange := PBOpenImmedSync(MPPPtr);
      END
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
