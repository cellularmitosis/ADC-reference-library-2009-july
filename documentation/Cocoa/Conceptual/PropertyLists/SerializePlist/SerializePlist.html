<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Property List Programming Guide: Serializing a Property List</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Serializing a Property List"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/10000048i-CH7" title="Serializing a Property List"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DataManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000445" target="_top">Data Management</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/10000048-CJBGDEGD">Property List Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../UnderstandXMLPlist/UnderstandXMLPlist.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ReadWritePlistData/ReadWritePlistData.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/10000048i-CH7-SW1" title="Serializing a Property List"></a><h1>Serializing a Property List </h1><p>Using the <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/cl/NSPropertyListSerialization" target="_top">NSPropertyListSerialization</a></code> class or Property List Services (Core Foundation), you can serialize property lists in their runtime (object) form to a static represesntation that can be stored in the file system; later you can deserialize that static representation back into the original property-list objects. Property-list serialization automatically takes account of endianness on different platforms—for example, you can correctly read on an Intel-based Macintosh a binary property list created on a PowerPC-based Macintosh. </p><p>The property-list serialization APIs allow you to save graphs of property-list objects as binary data as well as XML property lists. See <span class="content_text"><a href="../AboutPropertyLists/AboutPropertyLists.html#//apple_ref/doc/uid/20001010-46719">“Property List Representations”</a></span> for the relative advantages and disadvantages of XML and binary property lists.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="SerializePlist.html#//apple_ref/doc/uid/10000048i-CH7-SW4">Saving and Restoring a Property List in Objective-C</a>
				
			<br/>
			
        
			
			
				<a href="SerializePlist.html#//apple_ref/doc/uid/10000048i-CH7-SW5">Saving and Restoring a Property List in Core Foundation</a>
				
			<br/>
			
        
			
			
				<a href="SerializePlist.html#//apple_ref/doc/uid/10000048i-CH7-55206-CJBEICIH">Using Property List Services with Cocoa</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/10000048i-CH7-SW4" title="Saving and Restoring a Property List in Objective-C"></a><h2>Saving and Restoring a Property List in Objective-C</h2><p>The <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/cl/NSPropertyListSerialization" target="_top">NSPropertyListSerialization</a></code> class (available in Mac OS X v10.2 and later) provides methods for saving and restoring property lists from the two major supported formats, XML and binary. To save a property list in XML format, call the <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/clm/NSPropertyListSerialization/dataFromPropertyList:format:errorDescription:" target="_top">dataFromPropertyList:format:errorDescription:</a></code> method, specifying <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListXMLFormat_v1_0" target="_top">NSPropertyListXMLFormat_v1_0</a></code> as the second parameter; to save in binary format, specify <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListBinaryFormat_v1_0" target="_top">NSPropertyListBinaryFormat_v1_0</a></code> instead. </p><p><span class="content_text">Listing 5-1</span> saves an object graph of property-list objects as an XML property list in the application bundle.</p><a name="//apple_ref/doc/uid/10000048i-CH7-SW3" title="Listing 5-1Saving a property list as an XML property list (Objective-C)"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Saving a property list as an XML property list (Objective-C)</p><div class="codesample"><table><tr><td scope="row"><pre>id plist;       // Assume this property list exists.<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *path = [[NSBundle mainBundle] pathForResource:@"Data" ofType:@"plist"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSData *xmlData;<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *error;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>xmlData = [NSPropertyListSerialization dataFromPropertyList:plist<span></span></pre></td></tr><tr><td scope="row"><pre>                                       format:NSPropertyListXMLFormat_v1_0<span></span></pre></td></tr><tr><td scope="row"><pre>                                       errorDescription:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>if(xmlData) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"No error creating XML data.");<span></span></pre></td></tr><tr><td scope="row"><pre>    [xmlData writeToFile:path atomically:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>else {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(error);<span></span></pre></td></tr><tr><td scope="row"><pre>    [error release];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/10000048i-CH7-SW6" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X v10.5 (and earlier versions of the operating system), it is necessary to release the error-description string in <span class="content_text">Listing 5-1</span>.</p></div><p>Because you cannot save a property list in the old-style (OpenStep) format, the only valid format parameters for this method are <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListXMLFormat_v1_0" target="_top">NSPropertyListXMLFormat_v1_0</a></code> and <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListBinaryFormat_v1_0" target="_top">NSPropertyListBinaryFormat_v1_0</a></code>. The <code><a href="../../../Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/occ/cl/NSData" target="_top">NSData</a></code> object returned by <code>dataFromPropertyList:format:errorDescription:</code> encapsulates the XML or binary data. You can then call the <code><a href="../../../Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/occ/instm/NSData/writeToFile:atomically:" target="_top">writeToFile:atomically:</a></code> or <code><a href="../../../Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/occ/instm/NSData/writeToURL:atomically:" target="_top">writeToURL:atomically:</a></code> method to store the data in the file system.</p><div class="notebox"><a name="//apple_ref/doc/uid/10000048i-CH7-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;If the root property-list object is an <code><a href="../../../Reference/Foundation/Classes/NSDictionary_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDictionary" target="_top">NSDictionary</a></code> or <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/cl/NSArray" target="_top">NSArray</a></code> object (the typical case), you can serialize the property list as an XML property list <em>and</em> write it out to disk at the same time using the appropriate methods of those classes. See <span class="content_text"><a href="../ReadWritePlistData/ReadWritePlistData.html#//apple_ref/doc/uid/10000048i-CH8-SW1">“Reading and Writing Property-List Data”</a></span> for details.</p></div><p>To restore a property list from a data object by deserializing it, call the <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/clm/NSPropertyListSerialization/propertyListFromData:mutabilityOption:format:errorDescription:" target="_top">propertyListFromData:mutabilityOption:format:errorDescription:</a></code> class method of the <code>NSPropertyListSerialization</code> class, passing in the data object. <span class="content_text">Listing 5-2</span> creates an immutable property list from the file at <code>path</code>:</p><a name="//apple_ref/doc/uid/10000048i-CH7-SW2" title="Listing 5-2Restoring a property list (Objective-C)"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>Restoring a property list (Objective-C)</p><div class="codesample"><table><tr><td scope="row"><pre>NSString *path = [[NSBundle mainBundle] pathForResource:@"Data" ofType:@"plist"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSData *plistData = [NSData dataWithContentsOfFile:path];<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *error;<span></span></pre></td></tr><tr><td scope="row"><pre>NSPropertyListFormat format;<span></span></pre></td></tr><tr><td scope="row"><pre>id plist;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>plist = [NSPropertyListSerialization propertyListFromData:plistData<span></span></pre></td></tr><tr><td scope="row"><pre>                                mutabilityOption:NSPropertyListImmutable<span></span></pre></td></tr><tr><td scope="row"><pre>                                format:&amp;format<span></span></pre></td></tr><tr><td scope="row"><pre>                                errorDescription:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>if(!plist){<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(error);<span></span></pre></td></tr><tr><td scope="row"><pre>    [error release];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The mutability-option parameter of the deserialization method controls whether the deserialized property-list objects are created as mutable or immutable. You can specify that all objects are immutable, that only the container objects are mutable, or that all objects are mutable. Unless you have a specific reason to mutate the collections and other objects in a deserialized property list, use the immutable option. It is faster and uses less memory.</p><p>The last two parameters of <code>propertyListFromData:mutabilityOption:format:errorDescription:</code> are by-reference. On return from a call, the format parameter holds a constant indicating the on-disk format of the property list: <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListXMLFormat_v1_0" target="_top">NSPropertyListXMLFormat_v1_0</a></code>,  <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListBinaryFormat_v1_0" target="_top">NSPropertyListBinaryFormat_v1_0</a></code>, or <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/c/econst/NSPropertyListOpenStepFormat" target="_top">NSPropertyListOpenStepFormat</a></code>. You may pass in <code>NULL</code> if you are not interested in the format.</p><p>If the method call returns <code>nil</code>, the final parameter—the error-description string—states the reason the deserialization did not succeed.</p><div class="notebox"><a name="//apple_ref/doc/uid/10000048i-CH7-SW8" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X v10.5 (and earlier versions of the operating system), it is necessary to release the error-description string in <span class="content_text">Listing 5-2</span>.</p></div><a name="//apple_ref/doc/uid/10000048i-CH7-SW5" title="Saving and Restoring a Property List in Core Foundation"></a><h2>Saving and Restoring a Property List in Core Foundation</h2><p>Property List Services of Core Foundation has serialization functions corresponding to the class methods of <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/cl/NSPropertyListSerialization" target="_top">NSPropertyListSerialization</a></code> described in <span class="content_text">“Saving and Restoring a Property List in Objective-C.”</span> To create an XML property list from a property list object, call the <code><a href="../../../../CoreFoundation/Reference/CFPropertyListRef/Reference/reference.html#//apple_ref/c/func/CFPropertyListCreateXMLData" target="_top">CFPropertyListCreateXMLData</a></code> function. To restore a property list object from XML data, call the <code><a href="../../../../CoreFoundation/Reference/CFPropertyListRef/Reference/reference.html#//apple_ref/c/func/CFPropertyListCreateFromXMLData" target="_top">CFPropertyListCreateFromXMLData</a></code> function.</p><p><span class="content_text">Listing 5-3</span> shows you how to create a complex property list, convert it to XML, write it to disk, and then re-create the original data structure using the saved XML. For more information about using CFDictionary objects see <em><a href="../../../../CoreFoundation/Conceptual/CFCollections/index.html#//apple_ref/doc/uid/10000124i" target="_top">Collections Programming Topics for Core Foundation</a></em>.</p><a name="//apple_ref/doc/uid/10000048i-CH7-110145-BCIDGCIH" title="Listing 5-3Saving and restoring property list data (Core Foundation)"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001175-110145" title="Listing 5-3Saving and restoring property list data (Core Foundation)"></a><strong>Listing 5-3&nbsp;&nbsp;</strong>Saving and restoring property list data (Core Foundation)</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;CoreFoundation/CoreFoundation.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define kNumKids 2<span></span></pre></td></tr><tr><td scope="row"><pre>#define kNumBytesInPic 10<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFDictionaryRef CreateMyDictionary( void );<span></span></pre></td></tr><tr><td scope="row"><pre>CFPropertyListRef CreateMyPropertyListFromFile( CFURLRef fileURL );<span></span></pre></td></tr><tr><td scope="row"><pre>void WriteMyPropertyListToFile( CFPropertyListRef propertyList,<span></span></pre></td></tr><tr><td scope="row"><pre>            CFURLRef fileURL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main () {<span></span></pre></td></tr><tr><td scope="row"><pre>   CFPropertyListRef propertyList;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFURLRef fileURL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Construct a complex dictionary object;<span></span></pre></td></tr><tr><td scope="row"><pre>   propertyList = CreateMyDictionary();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Create a URL that specifies the file we will create to<span></span></pre></td></tr><tr><td scope="row"><pre>   // hold the XML data.<span></span></pre></td></tr><tr><td scope="row"><pre>   fileURL = CFURLCreateWithFileSystemPath( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFSTR("test.txt"),       // file path name<span></span></pre></td></tr><tr><td scope="row"><pre>               kCFURLPOSIXPathStyle,    // interpret as POSIX path<span></span></pre></td></tr><tr><td scope="row"><pre>               false );                 // is it a directory?<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Write the property list to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>   WriteMyPropertyListToFile( propertyList, fileURL );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease(propertyList);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Recreate the property list from the file.<span></span></pre></td></tr><tr><td scope="row"><pre>   propertyList = CreateMyPropertyListFromFile( fileURL );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Release any objects to which we have references.<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease(propertyList);<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease(fileURL);<span></span></pre></td></tr><tr><td scope="row"><pre>   return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFDictionaryRef CreateMyDictionary( void ) {<span></span></pre></td></tr><tr><td scope="row"><pre>   CFMutableDictionaryRef dict;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFNumberRef            num;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFArrayRef             array;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDataRef              data;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   int                    yearOfBirth;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFStringRef            kidsNames[kNumKids];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Fake data to stand in for a picture of John Doe.<span></span></pre></td></tr><tr><td scope="row"><pre>   const unsigned char pic[kNumBytesInPic] = {0x3c, 0x42, 0x81,<span></span></pre></td></tr><tr><td scope="row"><pre>            0xa5, 0x81, 0xa5, 0x99, 0x81, 0x42, 0x3c};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Define some data.<span></span></pre></td></tr><tr><td scope="row"><pre>   kidsNames[0] = CFSTR("John");<span></span></pre></td></tr><tr><td scope="row"><pre>   kidsNames[1] = CFSTR("Kyra");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   yearOfBirth = 1965;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Create a dictionary that will hold the data.<span></span></pre></td></tr><tr><td scope="row"><pre>   dict = CFDictionaryCreateMutable( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>            0,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;kCFTypeDictionaryKeyCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;kCFTypeDictionaryValueCallBacks );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Put the various items into the dictionary.<span></span></pre></td></tr><tr><td scope="row"><pre>   // Because the values are retained as they are placed into the<span></span></pre></td></tr><tr><td scope="row"><pre>   //  dictionary, we can release any allocated objects here.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict, CFSTR("Name"), CFSTR("John Doe") );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict,<span></span></pre></td></tr><tr><td scope="row"><pre>            CFSTR("City of Birth"),<span></span></pre></td></tr><tr><td scope="row"><pre>            CFSTR("Springfield") );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   num = CFNumberCreate( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>            kCFNumberIntType,<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;yearOfBirth );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict, CFSTR("Year Of Birth"), num );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease( num );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   array = CFArrayCreate( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>               (const void **)kidsNames,<span></span></pre></td></tr><tr><td scope="row"><pre>               kNumKids,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;kCFTypeArrayCallBacks );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict, CFSTR("Kids Names"), array );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease( array );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   array = CFArrayCreate( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>               NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>               0,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;kCFTypeArrayCallBacks );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict, CFSTR("Pets Names"), array );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease( array );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   data = CFDataCreate( kCFAllocatorDefault, pic, kNumBytesInPic );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDictionarySetValue( dict, CFSTR("Picture"), data );<span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease( data );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   return dict;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void WriteMyPropertyListToFile( CFPropertyListRef propertyList,<span></span></pre></td></tr><tr><td scope="row"><pre>            CFURLRef fileURL ) {<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDataRef xmlData;<span></span></pre></td></tr><tr><td scope="row"><pre>   Boolean status;<span></span></pre></td></tr><tr><td scope="row"><pre>   SInt32 errorCode;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Convert the property list into XML data.<span></span></pre></td></tr><tr><td scope="row"><pre>   xmlData = CFPropertyListCreateXMLData( kCFAllocatorDefault, propertyList );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Write the XML data to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>   status = CFURLWriteDataAndPropertiesToResource (<span></span></pre></td></tr><tr><td scope="row"><pre>               fileURL,                  // URL to use<span></span></pre></td></tr><tr><td scope="row"><pre>               xmlData,                  // data to write<span></span></pre></td></tr><tr><td scope="row"><pre>               NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;errorCode);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   CFRelease(xmlData);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFPropertyListRef CreateMyPropertyListFromFile( CFURLRef fileURL ) {<span></span></pre></td></tr><tr><td scope="row"><pre>   CFPropertyListRef propertyList;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFStringRef       errorString;<span></span></pre></td></tr><tr><td scope="row"><pre>   CFDataRef         resourceData;<span></span></pre></td></tr><tr><td scope="row"><pre>   Boolean           status;<span></span></pre></td></tr><tr><td scope="row"><pre>   SInt32            errorCode;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Read the XML file.<span></span></pre></td></tr><tr><td scope="row"><pre>   status = CFURLCreateDataAndPropertiesFromResource(<span></span></pre></td></tr><tr><td scope="row"><pre>               kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>               fileURL,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;resourceData,            // place to put file data<span></span></pre></td></tr><tr><td scope="row"><pre>               NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>               NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;errorCode);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   // Reconstitute the dictionary using the XML data.<span></span></pre></td></tr><tr><td scope="row"><pre>   propertyList = CFPropertyListCreateFromXMLData( kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>               resourceData,<span></span></pre></td></tr><tr><td scope="row"><pre>               kCFPropertyListImmutable,<span></span></pre></td></tr><tr><td scope="row"><pre>               &amp;errorString);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>   if (resourceData) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease( resourceData );<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease( errorString );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>   return propertyList;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>For a discussion of the mutability-option parameter of <code>CFPropertyListCreateFromXMLData</code> see the discussion of the corresponding parameter of the <code><a href="../../../Reference/Foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html#//apple_ref/occ/clm/NSPropertyListSerialization/propertyListFromData:mutabilityOption:format:errorDescription:" target="_top">propertyListFromData:mutabilityOption:format:errorDescription:</a></code> method in <span class="content_text"><a href="SerializePlist.html#//apple_ref/doc/uid/10000048i-CH7-SW4">“Saving and Restoring a Property List in Objective-C.”</a></span></p><p><span class="content_text">Listing 5-4</span> shows how the contents of <code>xmlData</code>, created in <span class="content_text"><a href="SerializePlist.html#//apple_ref/doc/uid/10000048i-CH7-SW3">Listing 5-1</a></span>, would look if printed to the screen.</p><a name="//apple_ref/doc/uid/10000048i-CH7-101566-BCIBCDHB" title="Listing 5-4XML file contents created by the sample program"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001175-101566" title="Listing 5-4XML file contents created by the sample program"></a><strong>Listing 5-4&nbsp;&nbsp;</strong>XML file contents created by the sample program</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"<span></span></pre></td></tr><tr><td scope="row"><pre>        "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;plist version="1.0"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Year Of Birth&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;integer>1965&lt;/integer><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Pets Names&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;array/><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Picture&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;data><span></span></pre></td></tr><tr><td scope="row"><pre>        PEKBpYGlmYFCPA==<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/data><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>City of Birth&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>Springfield&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Name&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>John Doe&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>Kids Names&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>John&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>Kyra&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/plist><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/20001014-55206" title="Using Property List Services with Cocoa"></a><a name="//apple_ref/doc/uid/10000048i-CH7-55206-CJBEICIH" title="Using Property List Services with Cocoa"></a><h2>Using Property List Services with Cocoa</h2><p>Cocoa uses the Core Foundation property list API to read and write XML property lists. In some cases, you may wish to access the API directly in an Objective-C Cocoa application. For example, if you want to save an instance of a class other than <code>NSArray</code> or <code>NSDictionary</code> as the root object of an XML plist, currently the easiest way to do this is through Property List Services. This process is made simple because Cocoa objects can be cast to and from corresponding Core Foundation types. This conversion between Cocoa and Core Foundation object types is known as <strong>toll-free bridging</strong>.</p><p>To create an XML property list from a property list object, call the <code><a href="../../../../CoreFoundation/Reference/CFPropertyListRef/Reference/reference.html#//apple_ref/c/func/CFPropertyListCreateXMLData" target="_top">CFPropertyListCreateXMLData</a></code> function. This code fragment saves the property list <code>plist</code> into a file at <code>path</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>NSString *path = [NSString stringWithFormat:@"%@/MyData.plist", NSTemporaryDirectory()];<span></span></pre></td></tr><tr><td scope="row"><pre>id plist;       // Assume this is a valid property list.<span></span></pre></td></tr><tr><td scope="row"><pre>NSData *xmlData;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>xmlData = (NSData *)CFPropertyListCreateXMLData(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                                               (CFPropertyListRef)plist);<span></span></pre></td></tr><tr><td scope="row"><pre>[xmlData writeToFile:path atomically:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>[xmlData release];<span></span></pre></td></tr></table></div><p>To restore a property list object from XML data, call the <code><a href="../../../../CoreFoundation/Reference/CFPropertyListRef/Reference/reference.html#//apple_ref/c/func/CFPropertyListCreateFromXMLData" target="_top">CFPropertyListCreateFromXMLData</a></code> function. This code fragment restores property list from the XML plist file at <code>path</code> with mutable containers but immutable leaves:</p><div class="codesample"><table><tr><td scope="row"><pre>NSString *path = [NSString stringWithFormat:@"%@/MyData.plist", NSTemporaryDirectory()];<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *errorString;<span></span></pre></td></tr><tr><td scope="row"><pre>NSData *xmlData;<span></span></pre></td></tr><tr><td scope="row"><pre>id plist;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>xmlData = [NSData dataWithContentsOfFile:path];<span></span></pre></td></tr><tr><td scope="row"><pre>plist = (id)CFPropertyListCreateFromXMLData(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                 (CFDataRef)xmlData, kCFPropertyListMutableContainers,<span></span></pre></td></tr><tr><td scope="row"><pre>                 (CFStringRef *)&amp;errorString);<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../UnderstandXMLPlist/UnderstandXMLPlist.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ReadWritePlistData/ReadWritePlistData.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-11-19<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/PropertyLists/SerializePlist/SerializePlist.html%3Fid%3D10000048i-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/PropertyLists/SerializePlist/SerializePlist.html%3Fid%3D10000048i-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/PropertyLists/SerializePlist/SerializePlist.html%3Fid%3D10000048i-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>