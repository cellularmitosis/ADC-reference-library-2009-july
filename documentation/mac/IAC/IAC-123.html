<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Replying to an Apple Event(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING123></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-122.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-124.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-116.html"><B>Handling Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING123-0></A>
<H2><A NAME=MARKER-9-362></A><A NAME=MARKER-21-363></A>Replying to an Apple Event</H2>
 <A NAME=MARKER-9-233></A>Your handler routine for a particular Apple event is responsible for performing the action requested by the Apple event, and can optionally return data in a reply Apple event. The Apple Event Manager passes a default reply Apple event to your handler. The default reply Apple event has no parameters when it is passed to your handler. Your handler can add parameters to the reply Apple event. If the client application requested a reply, the Apple Event Manager returns the reply Apple event to the client. <P>
 The reply Apple event is identified by the <CODE>kCoreEventClass</CODE> event class and by the <CODE>kAEAnswer</CODE> event ID.<A NAME=MARKER-2-4></A><A NAME=MARKER-2-5></A><A NAME=MARKER-2-6></A> If the client application specified the <CODE>kAENoReply</CODE> flag in the <CODE>reply</CODE> parameter of the <CODE>AESend</CODE> function, the Apple Event Manager passes a null descriptor record (a descriptor record of type <CODE>typeNull</CODE> whose data handle has the value <CODE>NIL</CODE>) to your handler instead of a default reply Apple event. Your handler should check the descriptor type of the reply Apple event before attempting to add any attributes or parameters to it. An attempt to add an Apple event attribute or parameter to a null descriptor record generates an error. <A NAME=MARKER-2-368></A><P>
 If the client application requests a reply, the Apple Event Manager prepares a reply Apple event for the client by passing a default reply Apple event to your handler. The default reply Apple event has no parameters when it is passed to your handler. Your handler can add any parameters to the reply Apple event. If your application is a spelling checker, for example, you can return a list of misspelled words in a parameter. <P>
 When your handler finishes processing an Apple event, it returns a result code to <CODE>AEProcessAppleEvent</CODE>, which returns this result code as its function result. If your handler returns a nonzero result code, and if you have not added your own <CODE>keyErrorNumber</CODE> parameter, the Apple Event Manager also returns this result code to the client application by putting the result code into a <CODE>keyErrorNumber</CODE> parameter for the reply Apple event. The client can check for the existence of this parameter to determine whether the handler performed the requested action.<A NAME=MARKER-2-7></A><A NAME=MARKER-2-8></A><P>
 The client application specifies whether it wants a reply Apple event or not by specifying flags (represented by constants) in the <CODE>sendMode</CODE> parameter of the <CODE>AESend</CODE> function.<P>
 If the client specifies the <CODE>kAEWaitReply</CODE> flag in the <CODE>sendMode</CODE> parameter, the <CODE>AESend</CODE> function does not return until the timeout specified by the <CODE>timeoutInTicks</CODE> parameter expires or the server application returns a reply. When the server application returns a reply, the <CODE>reply</CODE> parameter to <CODE>AESend</CODE> contains the reply Apple event that your handler returned to the <CODE>AEProcessAppleEvent</CODE> function. When the client application no longer needs the original Apple event and the reply event, it must dispose of them, but the Apple Event Manager disposes of both the Apple event and the reply event for the server application when the server's handler returns to <CODE>AEProcessAppleEvent</CODE>.<A NAME=MARKER-2-9></A> <A NAME=MARKER-2-10></A> <P>
 If the client specified the <CODE>kAEQueueReply</CODE> flag, the client receives the reply event at a later time during its normal processing of other events.<A NAME=MARKER-2-11></A><A NAME=MARKER-2-12></A> <P>
 Your handler should always set its function result to <CODE>noErr</CODE> if it successfully <BR>handles the Apple event. If an error occurs, your handler should return either <CODE>errAEEventNotHandled</CODE> or some other nonzero result code. If the error <BR>occurs because your application cannot understand the event, return <CODE>errAEEventNotHandled</CODE>. This allows the Apple Event Manager to look for a handler in the system special handler or system Apple event dispatch tables that might be able to handle the event. If the error occurs because the event is impossible to handle as specified, return the result code returned by whatever function caused the failure, or whatever other result code is appropriate.<P>
 For example, suppose your application receives a Get Data event requesting the name of the current printer, and your application cannot handle such an event. In this situation, you should return <CODE>errAEEventNotHandled</CODE> in case another handler available to the Apple Event Manager can handle the Get Data event. This strategy allows users to take advantage of system capabilities from within your application via system handlers. <P>
 However, if your application cannot handle a Get Data event that requests the fifth paragraph in a document because the document contains only four paragraphs, you should return some other nonzero error, because further attempts to handle the event are pointless.<P>
 If your Apple event handler calls the <CODE>AEResolve</CODE> function and <CODE>AEResolve</CODE> calls an object accessor function in the system object accessor dispatch table, your Apple event handler may not recognize the descriptor type of the token returned by the function. In this case, your handler should return the result code <CODE>errAEUnknownObjectType</CODE>. When your handler returns this result code, the Apple Event Manager attempts to locate a system Apple event handler that can recognize the token. For more information, see <A HREF=IAC-239.html#MARKER-9-132>"Installing Entries in the Object Accessor Dispatch Tables,"</A> which begins on <A HREF=IAC-239.html#MARKER-9-132>page 6-21</A>.<P>
 The Apple Event Manager automatically adds any nonzero result code that your handler returns to a <CODE>keyErrorNumber</CODE> parameter in the reply Apple event. In addition to returning a result code, your handler can also return an error string in the <CODE>keyErrorString</CODE> parameter of the reply Apple event. Your handler should provide meaningful text in the <CODE>keyErrorString</CODE> parameter, so that the client can display this string to the user if desired.<A NAME=MARKER-2-226></A><A NAME=MARKER-2-56></A><A NAME=MARKER-9-127></A><A NAME=MARKER-2-61></A> <P>
 <A HREF=#MARKER-9-379>Listing 4-12</A> shows how to add the <CODE>keyErrorString</CODE> parameter to the reply Apple event. See <A HREF=IAC-197.html#MARKER-9-31>"Adding Parameters to an Apple Event" on page 5-5</A> for a description of the <CODE>AEPutParamPtr</CODE> function.<P>
<B>Listing 4-12  <A NAME=MARKER-9-379></A><A NAME=MARKER-21-380></A>Adding the <CODE>keyErrorString</CODE> parameter to the reply Apple event<A NAME=MARKER-2-244></A></B><P>
<PRE>
FUNCTION MyHandler (theAppleEvent: AppleEvent; reply: AppleEvent;
                    handlerRefcon: LongInt): OSErr; 
VAR
   myErr:      OSErr;
   errStr:     Str255;
BEGIN
   {handle your Apple event here}

   {if an error occurs when handling an Apple event, set the }
   { function result and error string accordingly}
   IF myErr &lt;&gt; noErr THEN
   BEGIN
      MyHandler := myErr; {result code to be returned--the }
                           { Apple Event Manager adds this }
                           { result code to the reply Apple }
                           { event as the keyErrorNumber }
                           { parameter}
      IF (reply.dataHandle &lt;&gt; NIL) THEN
      {add error string parameter to the default reply}
      BEGIN
         {strings should normally be stored in resources}
         errStr := 'Why error occurred';
         myErr := AEPutParamPtr(reply, keyErrorString, 
                                 typeIntlText, @errStr[1], 
                                 length(errStr));
      END;
   END
   ELSE
      MyHandler := noErr;
END;
</PRE>
 If your handler needs to return data to the client, it can add parameters to the reply Apple event. <A HREF=#MARKER-9-382>Listing 4-13</A> shows how a handler for the Multiply event (an imaginary Apple event that asks the server to multiply two numbers) might return the results of the multiplication to the client.<P>
<B>Listing 4-13  <A NAME=MARKER-9-382></A><A NAME=MARKER-21-383></A>Adding parameters to the reply Apple event<A NAME=MARKER-2-250></A></B><P>
<PRE>
FUNCTION MyMultHandler (theAppleEvent: AppleEvent; 
                        reply: AppleEvent; 
                        handlerRefcon: LongInt): OSErr; 
VAR
   myErr:            OSErr;
   number1,number2:  LongInt;
   replyResult:      LongInt;
   actualSize:       Size;
   returnedType:     DescType;
BEGIN
   {get the numbers to multiply from the parameters of the }
   { Apple event; put the numbers in the number1 and number2 }
   { variables and then perform the requested multiplication}
   myErr := MyDoMultiply(theAppleEvent, number1, 
                           number2, replyResult);
   IF myErr = noErr THEN 
      IF (reply.dataHandle &lt;&gt; NIL) THEN
         {return result of the multiplication in the reply Apple }
         { event}
         myErr := AEPutParamPtr(reply, keyDirectObject, 
                                 typeLongInteger, @replyResult, 
                                 SizeOf(replyResult));
   MyMultHandler := myErr;
   {if an error occurs, set the error string }
   { accordingly, as shown in Listing 4-12}
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-122.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-124.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
