<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Creating a Notification Request (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING108></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-107.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-109.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-105.html"><B>Chapter 5 - Notification Manager</B></A> / <A HREF="Processes-107.html"><B>Using the Notification Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING108-0></A>
<H2>Creating a Notification Request</H2>
 <A NAME=MARKER-2-8></A>Information describing each notification request is contained in the <B>notification queue</B>, which is a standard operating-system queue (as described in the chapter "Queue Utilities" in <I><A HREF="../OSUtilities/OSUtilities-2.html">Inside Macintosh: Operating System Utilities</A></I>). Each entry in the notification queue is a <B>notification record</B>--a static and nonrelocatable record of type <CODE>NMRec</CODE>. When installing a request in the notification queue, your application must supply a pointer to a notification record that indicates the type of notification you desire. Here is the <CODE>NMRec</CODE> data structure:<A NAME=MARKER-2-34></A><A NAME=MARKER-2-33></A><A NAME=MARKER-2-52></A><A NAME=MARKER-2-95></A><P>
<PRE>
TYPE NMRec =
   RECORD
      qLink:      QElemPtr;   {next queue entry}
      qType:      Integer;    {queue type}
      nmFlags:    Integer;    {reserved}
      nmPrivate:  LongInt;    {reserved}
      nmReserved: Integer;    {reserved}
      nmMark:     Integer;    {item to mark in menu}
      nmIcon:     Handle;     {handle to icon}
      nmSound:    Handle;     {handle to sound resource}
      nmStr:      StringPtr;  {string to appear in alert box}
      nmResp:     ProcPtr;    {pointer to response procedure}
      nmRefCon:   LongInt;    {for application's use}
   END;
</PRE>
 To set up a notification request, you need to fill in the fields <CODE>qType</CODE>, <CODE>nmMark</CODE>, <CODE>nmIcon</CODE>, <CODE>nmSound</CODE>, <CODE>nmStr</CODE>, <CODE>nmResp</CODE>, and <CODE>nmRefCon</CODE>. The remaining fields of this record are used internally by the Notification Manager or are reserved for use by Apple Computer, Inc.<P>
<DL>
<H5>Field Description</H5>
<DT><CODE>qLink</CODE>
<DD> Points to the next element in the queue. This field is used internally by the Notification Manager.<A NAME=MARKER-2-54></A>
<DT><CODE>qType</CODE>
<DD> Indicates the type of queue. You should set this field to the value <CODE>ORD(nmType)</CODE>, which is 8.<A NAME=MARKER-2-55></A><A NAME=MARKER-2-56></A>
<DT><CODE>nmFlags</CODE>
<DD> Reserved for use by Apple Computer, Inc.<A NAME=MARKER-2-57></A>
<DT><CODE>nmPrivate</CODE>
<DD> Reserved for use by Apple Computer, Inc.<A NAME=MARKER-2-30></A>
<DT><CODE>nmReserved</CODE>
<DD> Reserved for use by Apple Computer, Inc.<A NAME=MARKER-2-33></A>
<DT><CODE>nmMark</CODE>
<DD> Indicates whether to place a diamond-shaped mark next to the name of the application in the Application menu. If the value of <CODE>nmMark</CODE> is 0, no such mark appears. If the value of <CODE>nmMark</CODE> is 1, the mark appears next to the name of the calling application. If the value of <CODE>nmMark</CODE> is neither 0 nor 1, it is interpreted as the reference number of a desk accessory. An application should pass 1, a desk accessory should pass its own reference number, and a driver or a detached background task (such as a VBL task or Time Manager task) should pass 0.<A NAME=MARKER-2-60></A><A NAME=MARKER-2-61></A><A NAME=MARKER-2-62></A><A NAME=MARKER-2-63></A><A NAME=MARKER-2-1></A><A NAME=MARKER-2-7></A>
<DT><CODE>nmIcon</CODE>
<DD> Contains a handle to a small icon that is to blink periodically in the menu bar. If the value of <CODE>nmIcon</CODE> is <CODE>NIL</CODE>, no icon appears in the menu bar. This handle must be valid at the time that the notification occurs; it does not need to be locked, but it must be nonpurgeable.<A NAME=MARKER-2-48></A><A NAME=MARKER-2-6></A><A NAME=MARKER-2-78></A><A NAME=MARKER-2-69></A><A NAME=MARKER-2-49></A>
<DT><CODE>nmSound</CODE>
<DD> Contains a handle to a sound resource to be played with <CODE>SndPlay</CODE>. If the value of <CODE>nmSound</CODE> is <CODE>NIL</CODE>, no sound is produced. If the value of <CODE>nmSound</CODE> is -1, then the system alert sound plays. This handle does not need to be locked, but it must be nonpurgeable.<A NAME=MARKER-2-71></A><A NAME=MARKER-9-105></A>
<DT><CODE>nmStr</CODE>
<DD> Points to a string that appears in the alert box. If the value of <CODE>nmStr</CODE> is <CODE>NIL</CODE>, no alert box appears. Because the Notification Manager does not make a copy of this string, your application should not release this memory until it removes the notification request.<A NAME=MARKER-2-73></A><A NAME=MARKER-2-5></A>
<DT><CODE>nmResp</CODE>
<DD> Points to a response procedure. If the value of <CODE>nmResp</CODE> is <CODE>NIL</CODE>, no response procedure is executed when the notification is posted. If the value of <CODE>nmResp</CODE> is -1, then a predefined procedure removes the notification request immediately after it has completed.<A NAME=MARKER-2-20></A><A NAME=MARKER-2-29></A><A NAME=MARKER-9-24></A><A NAME=MARKER-2-48></A>
<DT><CODE>nmRefCon</CODE>
<DD> A long integer available for your application's own use.<A NAME=MARKER-2-49></A><A NAME=MARKER-2-80></A>
</DL>
 <A HREF=#MARKER-9-82>Listing 5-1</A> illustrates how to set up a notification record. In this listing, <CODE>gMyNotification</CODE> is a global variable of type <CODE>NMRec</CODE> and <CODE>gText</CODE> is a global variable of type <CODE>Str255</CODE>.<A NAME=MARKER-2-54></A><P>
<B>Listing 5-1  <A NAME=MARKER-9-82></A><A NAME=MARKER-21-83></A>Setting up a notification record</B><P>
<PRE>
VAR
   myResNum:         Integer;    {resource ID of small icon}
   myResHand:        Handle;     {handle to small icon resource}
BEGIN
   myResNum := 1234;             {resource ID in resource fork}
   myResHand := GetResource('SICN', myResNum);
                                 {get icon from resource fork}
   gText := 'Sample Alert Box';  {set message for alert box}
   WITH gMyNotification DO
   BEGIN
      qType := ORD(nmType);      {set queue type}
      nmMark := 1;               {put mark in Application menu}
      nmIcon := myResHand;       {blinking icon}
      nmSound := Handle(-1);     {play system alert sound}
      nmStr := @gText;           {display alert box}
      nmResp := NIL;             {no response procedure}
      nmRefCon := 0;             {not needed here}
   END;
END;
</PRE>
 This notification record requests all three types of notification--polite (blinking small icon), audible (system alert sound), and alert (alert box). In addition, the diamond appears in front of the application's name in the Application menu. In this case, the small icon has resource ID 1234 of type <CODE>'SICN'</CODE> in the application's resource fork.<A NAME=MARKER-2-70></A><A NAME=MARKER-9-65></A><A NAME=MARKER-9-26></A><A NAME=MARKER-2-87></A><P>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-107.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-109.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
