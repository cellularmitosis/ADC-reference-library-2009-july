<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>DVD Playback Services Programming Guide: Basic Programming Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Basic Programming Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002950" title="Basic Programming Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Video-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP40001677" target="_top">Video</a> &gt; <a href="../dvdguide_intro/dvdguide_intro.html#//apple_ref/doc/uid/TP40002948-TPXREF101">DVD Playback Services Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dvdguide_concepts/dvdguide_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dvdguide_tasks_2/dvdguide_tasks_2.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40002950-TPXREF101" title="Basic Programming Tasks"></a><h1>Basic Programming Tasks</h1><p>In this chapter, you'll learn about the basic operations you must implement in order to play DVD-Video media. To play DVD-Video media using DVD Playback Services, you'll need to perform this sequence of operations: </p><ol class="ol"><li class="li"><p>Begin a new DVD playback session. </p></li><li class="li"><p>Set the window to be used for video playback. </p></li><li class="li"><p>Set the video display device for the window. </p></li><li class="li"><p>Set the bounds of the video area inside the window. </p></li><li class="li"><p>Open a DVD-Video media folder.</p></li><li class="li"><p>Play the media and respond to user actions.</p></li><li class="li"><p>Close the media folder.</p></li><li class="li"><p>End the DVD playback session.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_51" title="Note"></a><p><strong>Note:</strong>&nbsp;In the interest of brevity, the code examples in this guide do not always check the result codes returned from DVD Playback Services functions.</p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-SW1">Starting a Playback Session</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_17">Creating a Video Window</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_18">Choosing a Graphics Display</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_19">Setting the Bounds of the Video Area</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_20">Opening Media</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_22">Playing Media</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_23">Responding to User Actions in DVD Menus</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-DontLinkElementID_24">Closing Media</a>
				
			<br/>
			
        
			
			
				<a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-SW2">Ending a Playback Session</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002950-SW1" title="Starting a Playback Session"></a><h2>Starting a Playback Session</h2><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_15" title="Initialization"></a><h3>Initialization</h3><p>When your application is ready to begin a DVD playback session, the first step is to call the  <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDInitialize" target="_top">DVDInitialize</a></code> function. The result code indicates whether the API is available for use. If the result code is <code>noErr</code>, you're ready to proceed to the next step. </p><p>In this example, the application quits if DVD Playback Services cannot be initialized: </p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = DVDInitialize();<span></span></pre></td></tr><tr><td scope="row"><pre>if (err != noErr) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"DVDInitialize returned %d", err);<span></span></pre></td></tr><tr><td scope="row"><pre>    [NSApp terminate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_16" title="Registering an Error Handler"></a><h3>Registering an Error Handler</h3><p>DVD Playback Services uses a callback mechanism to notify your application if an I/O error makes it impossible to play the media. Typically this error occurs when the optical disc is dirty or damaged. If you don't register a callback function to receive this error, your application may crash unexpectedly. Your error callback should do two things: (1) notify the user that a fatal error has occured, and (2) end the playback session (see <span class="content_text"><a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-SW2">“Ending a Playback Session”</a></span>). </p><p>This line of code shows how to register a callback function to handle a fatal error: </p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = DVDSetFatalErrorCallBack (MyDVDErrorHandler, (UInt32) self);<span></span></pre></td></tr></table></div><p>In this example, the callback passes the error code to a method that handles the error: </p><div class="codesample"><table><tr><td scope="row"><pre>void MyDVDErrorHandler (DVDErrorCode inErrorCode, UInt32 inRefCon) {<span></span></pre></td></tr><tr><td scope="row"><pre>    Controller *controller = (Controller *)inRefCon;<span></span></pre></td></tr><tr><td scope="row"><pre>    [controller handleDVDError:inErrorCode];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) handleDVDError:(DVDErrorCode)error {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSLog(@"fatal error %d", error);<span></span></pre></td></tr><tr><td scope="row"><pre>    [NSApp terminate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_17" title="Creating a Video Window"></a><h2>Creating a Video Window</h2><p>Once the session is active, your application needs to create a window for video playback. Typically the characteristics of your video window are specified in an Interface Builder nib file, and the window is instantiated at runtime when your application loads the nib. </p><p>The recommended window type is a document window with zoom, minimize, and resize controls. The recommended initial view size is 640 x 480, which corresponds to the standard DVD aspect ratio of 4:3. </p><p>If the video window is a Cocoa window, you set the video playback window with the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDSetVideoWindowID" target="_top">DVDSetVideoWindowID</a></code> function. In CocoaDVDPlayer, the video window is a subclass of NSWindow, which has a method to get the window number. Here's the line of code that sets the window:</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = DVDSetVideoWindowID ([self windowNumber]);<span></span></pre></td></tr></table></div><p>Here's the line of code that sets the video window in a Carbon application. The window is a variable of type <code><a href="../../../../Carbon/Reference/Window_Manager/Reference/reference.html#//apple_ref/c/tdef/WindowRef" target="_top">WindowRef</a></code>): </p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = DVDSetVideoPort (GetWindowPort (myWindow));<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_18" title="Choosing a Graphics Display"></a><h2>Choosing a Graphics Display</h2><p>After the video window is created, your application needs to tell DVD Playback Services which graphics display to use for DVD playback. </p><p>Cocoa applications should set the playback display with <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDSwitchToDisplay" target="_top">DVDSwitchToDisplay</a></code>, a convenience function that also validates the display to make sure it's supported for playback. Be sure the check the boolean value that's passed back to verify that the display is supported. If it's not supported, your application should notify the user and terminate the playback session. </p><p>A Cocoa window can find its display ID and set the display as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>CGDirectDisplayID display = (CGDirectDisplayID)<span></span></pre></td></tr><tr><td scope="row"><pre>    [[[[self screen] deviceDescription] valueForKey:@"NSScreenNumber"] intValue];<span></span></pre></td></tr><tr><td scope="row"><pre>Boolean isSupported;<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus err = DVDSwitchToDisplay (display, &amp;isSupported);<span></span></pre></td></tr></table></div><p>Carbon applications can find the graphics device for their video window using the Window Manager function <code><a href="../../../../Carbon/Reference/Window_Manager/Reference/reference.html#//apple_ref/c/func/GetWindowGreatestAreaDevice" target="_top">GetWindowGreatestAreaDevice</a></code>, and can set the playback display using the convenience function <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDSwitchToDevice" target="_top">DVDSwitchToDevice</a></code>. As with <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDSwitchToDisplay" target="_top">DVDSwitchToDisplay</a></code>, be sure to check the boolean value that's passed back. </p><div class="codesample"><table><tr><td scope="row"><pre>GDHandle device;<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus err = GetWindowGreatestAreaDevice (myWindow, kWindowContentRgn, &amp;device, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>Boolean isSupported;<span></span></pre></td></tr><tr><td scope="row"><pre>err = DVDSwitchToDevice (device, &amp;isSupported);<span></span></pre></td></tr></table></div><p>If the video window is moved to a different display during playback, you should use the same procedure to set the new display. </p><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_19" title="Setting the Bounds of the Video Area "></a><h2>Setting the Bounds of the Video Area </h2><p>The next step is to use the <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDSetVideoBounds" target="_top">DVDSetVideoBounds</a></code> function to tell DVD Playback Services where to display the video content. This function takes a QuickDraw rectangle (<code>Rect</code>) that represents the bounds of the video area inside your window. The rectangle is expressed in window local coordinates. DVD Playback Services automatically scales the video content to fit inside this video area. Typically the dimensions of the video area are the same as the content area of the window, but this isn't a requirement. </p><p>For the video content to look right, the video area should always have one of two aspect ratios: standard (4:3) or wide (16:9). The initial aspect ratio of the video area is typically 4:3, the aspect ratio of the first title or menu on most DVDs. </p><p>Applications that use a Cocoa rectangle (<code><a href="../../../../Cocoa/Reference/Foundation/Miscellaneous/Foundation_DataTypes/Reference/reference.html#//apple_ref/c/tdef/NSRect" target="_top">NSRect</a></code>) or a Quartz rectangle (<code><a href="../../../Reference/CGGeometry/Reference/reference.html#//apple_ref/c/tdef/CGRect" target="_top">CGRect</a></code> to represent the bounds of the video area must convert it to a QuickDraw rectangle before calling <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDSetVideoBounds" target="_top">DVDSetVideoBounds</a></code>. <span class="content_text">Listing 2-1</span> shows how this is done for a Cocoa window in which the video area and the content view have the same bounds. </p><a name="//apple_ref/doc/uid/TP40002950-SW8" title="Listing 2-1Setting the video bounds"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Setting the video bounds</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) setVideoBounds<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRect content = [[self contentView] bounds]; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    NSRect frame = [self frame]; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Rect qdRect; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    qdRect.left = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    qdRect.right = content.size.width;<span></span></pre></td></tr><tr><td scope="row"><pre>    qdRect.bottom = frame.size.height;<span></span></pre></td></tr><tr><td scope="row"><pre>    qdRect.top = frame.size.height - content.size.height; <span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus err = DVDSetVideoBounds (&amp;qdRect);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here's what this code does: </p><ol class="ol"><li class="li"><p>Gets the height and width of the content view. </p></li><li class="li"><p>Gets the height of the window, including the title bar. </p></li><li class="li"><p>Creates a QuickDraw rectangle to represent the video bounds. </p></li><li class="li"><p>Computes the position of the top edge in window local coordinates.</p></li></ol><p>Whenever the user resizes the window or displays a new title with a different the aspect ratio, your application needs to call <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDSetVideoBounds" target="_top">DVDSetVideoBounds</a></code> again to notify DVD Playback Services that the video area has changed. </p><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_20" title="Opening Media"></a><h2>Opening Media</h2><p>Now you're ready to open DVD-Video media for playback. Standard-definition media is stored inside a media folder named VIDEO_TS. A standard-definition DVD-Video disc has a VIDEO_TS folder in its root directory, for example. DVD Playback Services allows only one media folder to be open at a time; before you attempt to open a media folder, you should use the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDHasMedia" target="_top">DVDHasMedia</a></code> function to check to see if media is already open. </p><p>DVD Playback Services provides two functions to open media: </p><ul class="ul"><li class="li"><p>To open DVD-Video media on a disc volume, you should call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDOpenMediaVolume" target="_top">DVDOpenMediaVolume</a></code> function and pass a file object that specifies the media folder at the root level of the volume—for example, <code>/Volumes/CITIZEN_KANE/VIDEO_TS</code>. </p></li><li class="li"><p>To open DVD-Video media on a hard drive, you should call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDOpenMediaFile" target="_top">DVDOpenMediaFile</a></code> function and pass a file object that specifies the full path to the media folder—for example, <code>/Users/Orson/Movies/CITIZEN_KANE/VIDEO_TS</code>. </p></li></ul><p>Both functions take as input a file object of type <code><a href="../../../../Carbon/Reference/File_Manager/Reference/reference.html#//apple_ref/c/tdef/FSRef" target="_top">FSRef</a></code> that specifies the path to the media folder. Before calling one of these functions, you should validate the file object using the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDIsValidMediaRef" target="_top">DVDIsValidMediaRef</a></code> function. </p><p> <span class="content_text">Listing 2-2</span> shows how to use these functions: </p><a name="//apple_ref/doc/uid/TP40002950-SW13" title="Listing 2-2Opening media"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Opening media</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) openMedia:(FSRef *)media isVolume:(BOOL)isVolume<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean isValid;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus err = DVDIsValidMediaRef (media, &amp;isValid);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (isValid)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if ([self hasMedia] == YES) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [self closeMedia];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (isVolume) {<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDOpenMediaVolume (media);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else {<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDOpenMediaFile (media);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return isValid;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_21" title="Opening a Media Folder"></a><h3>Opening a Media Folder</h3><p>DVD authoring applications such as iDVD and DVD Studio Pro can be used to create VIDEO_TS media folders on the users' hard drive. Your application may be called upon to open such a folder and play its contents. <span class="content_text">Listing 2-3</span> shows how a Cocoa application could display an Open dialog that allows the user to navigate to and open a media folder. </p><a name="//apple_ref/doc/uid/TP40002950-SW9" title="Listing 2-3Opening a media folder"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Opening a media folder</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) onOpenMediaFolder:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSOpenPanel *panel = [NSOpenPanel openPanel]; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    [panel setCanChooseFiles:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>    [panel setCanChooseDirectories:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [panel setAllowsMultipleSelection:NO];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ([panel runModalForTypes:nil] == NSOKButton) <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSString *folderPath = [[panel filenames] objectAtIndex:0]; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        const char *cPath = [folderPath cStringUsingEncoding:NSASCIIStringEncoding]; <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        FSRef fileRef;<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus err = FSPathMakeRef ((UInt8*)cPath, &amp;fileRef, NULL); <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        [self openMedia:&amp;fileRef isVolume:NO]; <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here's what this code does: </p><ol class="ol"><li class="li"><p>Creates an Open panel and configures it to open a single folder. </p></li><li class="li"><p>Displays the panel and checks for the OK button. </p></li><li class="li"><p>Retrieves a POSIX path to the selected folder. </p></li><li class="li"><p>Gets a C string representation of the path. </p></li><li class="li"><p>Converts the path string into a file object. </p></li><li class="li"><p>Passes the path to the <code>openMedia</code> method (see <span class="content_text"><a href="dvdguide_tasks_1.html#//apple_ref/doc/uid/TP40002950-SW13">Listing 2-2</a></span>. </p></li></ol><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_22" title="Playing Media "></a><h2>Playing Media </h2><p>If media is open and playback is stopped or paused, you can begin playing media by calling the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDPlay" target="_top">DVDPlay</a></code> function. This function does not take any arguments to control the position at which playback begins. Instead, DVD Playback Services maintains a position marker called the <strong>last play bookmark</strong>. This bookmark specifies the last known playback position. In a new playback session, the last play bookmark is cleared to indicate that playback should start at the beginning of the media. Your application can update or reset this bookmark using the functions <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDSetLastPlayBookmark" target="_top">DVDSetLastPlayBookmark</a></code> and <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDClearLastPlayBookmark" target="_top">DVDClearLastPlayBookmark</a></code>. </p><p>The initial media playback stream usually takes the viewer to an on-screen menu. To play a feature title or branch to a different menu, the user operates the mouse or keyboard to select and press a menu button. In response, DVD Playback Services uses instructions embedded in the media itself to update the last play bookmark and begin playing the specified choice. In this situation, your application does not need to use <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDPlay" target="_top">DVDPlay</a></code>. </p><p>While media is playing, you can pause or stop playback at the current frame. If you call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDStop" target="_top">DVDStop</a></code> function twice in succession, the last play bookmark is cleared. </p><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_23" title="Responding to User Actions in DVD Menus "></a><h2>Responding to User Actions in DVD Menus </h2><p>When a title is playing and the user decides to display a menu, you should respond by calling the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDGoToMenu" target="_top">DVDGoToMenu</a></code> function. Conversely, you should call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDReturnToTitle" target="_top">DVDReturnToTitle</a></code> function when a menu is on the screen and the user decides to return to the current title. </p><p>If the user clicks the Menu button in CocoaDVDPlayer, for example, this action method switches between a title and its root menu: </p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) onToggleMenu:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((mDVDState == kDVDStatePlaying) ||<span></span></pre></td></tr><tr><td scope="row"><pre>        (mDVDState == kDVDStatePlayingStill) ||<span></span></pre></td></tr><tr><td scope="row"><pre>        (mDVDState == kDVDStatePaused))<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        Boolean onMenu = false;<span></span></pre></td></tr><tr><td scope="row"><pre>        DVDMenu whichMenu;<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus err = DVDIsOnMenu (&amp;onMenu, &amp;whichMenu);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (onMenu) {<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDReturnToTitle();<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDGoToMenu (kDVDMenuRoot);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When a DVD menu is first displayed, generally the first (topmost) button is selected, as shown in <span class="content_text"><a href="../dvdguide_concepts/dvdguide_concepts.html#//apple_ref/doc/uid/TP40002949-SW3">Figure 1-2</a></span>. As the user operates the mouse or keyboard to select and press the desired button, your application responds by notifying DVD Playback Services. DVD Playback Services responds by selecting or activating the correct button on screen. </p><p>To implement this behavior, your application needs to perform the following actions: </p><ul class="ul"><li class="li"><p>If the user presses an arrow key or chooses a navigation command such as Up or Down from an application menu, call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDDoUserNavigation" target="_top">DVDDoUserNavigation</a></code> function, passing a constant such as <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/econst/kDVDUserNavigationMoveDown" target="_top">kDVDUserNavigationMoveDown</a></code> to select the next button. </p></li><li class="li"><p>If the user presses the Enter or Return key, call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDDoUserNavigation" target="_top">DVDDoUserNavigation</a></code> function to activate the selected button, passing the constant <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/econst/kDVDUserNavigationEnter" target="_top">kDVDUserNavigationEnter</a></code> to activate the selected button. </p></li><li class="li"><p>If the user moves the mouse somewhere inside the video area, call the <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDDoMenuMouseOver" target="_top">DVDDoMenuMouseOver</a></code> function and pass in the location of the mouse. </p></li><li class="li"><p>If the user clicks the mouse inside the video area, call the <code><a href="../../../Reference/DVDPlaybackRef/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/DVDDoMenuClick" target="_top">DVDDoMenuClick</a></code> function and pass in the location of the mouse. </p></li></ul><p><span class="content_text">Listing 2-4</span> shows how to handle mouse events in the video window. In a Cocoa application, to receive mouse-moved events you'll also need to send the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/setAcceptsMouseMovedEvents:" target="_top">setAcceptsMouseMovedEvents:YES</a></code> message to the window. </p><a name="//apple_ref/doc/uid/TP40002950-SW4" title="Listing 2-4Handling mouse events in the video window"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Handling mouse events in the video window</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) sendEvent:(NSEvent *)theEvent<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt32 index = kDVDButtonIndexNone; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSPoint location = [theEvent locationInWindow]; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    Point portPt;<span></span></pre></td></tr><tr><td scope="row"><pre>    portPt.h = location.x;<span></span></pre></td></tr><tr><td scope="row"><pre>    portPt.v = [self frame].size.height - location.y;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch ([theEvent type])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus err;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSMouseMoved:<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDDoMenuMouseOver (portPt, &amp;index); <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSLeftMouseDown:<span></span></pre></td></tr><tr><td scope="row"><pre>            err = DVDDoMenuClick (portPt, &amp;index); <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* sync the cursor */<span></span></pre></td></tr><tr><td scope="row"><pre>    NSCursor *cursor;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (index != kDVDButtonIndexNone) { <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        cursor = [NSCursor pointingHandCursor];<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            cursor = [NSCursor arrowCursor];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [cursor set];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [super sendEvent:theEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here's what the code does:</p><ol class="ol"><li class="li"><p>Declares a variable to receive the button index if the mouse is over a button. </p></li><li class="li"><p>Gets the mouse location in Quartz coordinates (origin in lower left corner of window). </p></li><li class="li"><p>Displays visual feedback in the video window when the mouse cursor is inside a DVD button. </p></li><li class="li"><p>Activates a DVD button if the mouse cursor is inside the button when the mouse is clicked. </p></li><li class="li"><p>Sets the cursor to a pointing hand when the mouse is over a button. </p></li></ol><p><span class="content_text">Listing 2-5</span> shows how to handle keyboard events when a menu is displayed. </p><a name="//apple_ref/doc/uid/TP40002950-SW12" title="Listing 2-5Handling keyboard events"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Handling keyboard events</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) onKeyDown: (NSEvent *)theEvent<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *keyString = [theEvent characters]; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    unichar key = [keyString characterAtIndex:0]; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    BOOL keyIsHandled = YES;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (key) { <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        case NSUpArrowFunctionKey:<span></span></pre></td></tr><tr><td scope="row"><pre>            DVDDoUserNavigation(kDVDUserNavigationMoveUp);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSDownArrowFunctionKey:<span></span></pre></td></tr><tr><td scope="row"><pre>            DVDDoUserNavigation(kDVDUserNavigationMoveDown);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSLeftArrowFunctionKey:<span></span></pre></td></tr><tr><td scope="row"><pre>            DVDDoUserNavigation(kDVDUserNavigationMoveLeft);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSRightArrowFunctionKey:<span></span></pre></td></tr><tr><td scope="row"><pre>            DVDDoUserNavigation(kDVDUserNavigationMoveRight);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSCarriageReturnCharacter:<span></span></pre></td></tr><tr><td scope="row"><pre>        case NSEnterCharacter:<span></span></pre></td></tr><tr><td scope="row"><pre>            DVDDoUserNavigation(kDVDUserNavigationEnter);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case ' ':<span></span></pre></td></tr><tr><td scope="row"><pre>            if (mDVDState == kDVDStatePlaying)<span></span></pre></td></tr><tr><td scope="row"><pre>                [self onPause:self];<span></span></pre></td></tr><tr><td scope="row"><pre>            else if (mDVDState == kDVDStatePaused)<span></span></pre></td></tr><tr><td scope="row"><pre>                [self onPlay:self];<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            keyIsHandled = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return keyIsHandled; <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here's what this code does: </p><ol class="ol"><li class="li"><p>Gets a string that contains a Unicode representation of one or more keys pressed by the user. </p></li><li class="li"><p>Gets the first Unicode character in the string. </p></li><li class="li"><p>Handles the key. The arrow keys are used to navigate between buttons; the enter and return keys are used to press a button; the spacebar toggles between play and pause. </p></li><li class="li"><p>Returns a status flag (indicating whether the event was handled) to the window that received the event. </p></li></ol><a name="//apple_ref/doc/uid/TP40002950-DontLinkElementID_24" title="Closing Media"></a><h2>Closing Media</h2><p>When the user is finished playing a media volume or folder, you should close the media. Before attempting to close the media, you should call the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDHasMedia" target="_top">DVDHasMedia</a></code> function to make sure the media is currently open. Depending on how the media was previously opened, you need to call one of two functions to close it: </p><ul class="ul"><li class="li"><p>If you opened the media with the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDOpenMediaFile" target="_top">DVDOpenMediaFile</a></code> function, you should close it by calling the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDCloseMediaFile" target="_top">DVDCloseMediaFile</a></code> function. </p></li><li class="li"><p>If you opened the media with the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDOpenMediaVolume" target="_top">DVDOpenMediaVolume</a></code> function, you should close it by calling the <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDCloseMediaVolume" target="_top">DVDCloseMediaVolume</a></code> function. </p></li></ul><a name="//apple_ref/doc/uid/TP40002950-SW2" title="Ending a Playback Session"></a><h2>Ending a Playback Session</h2><p>When the user is finished using DVD Playback Services, or when a fatal error occurs, you should end the playback session. There are two basic tasks: (1) unregister all DVD event callbacks, and (2) call the function <code><a href="../../../Reference/DVDPlaybackRef/Reference/reference.html#//apple_ref/c/func/DVDDispose" target="_top">DVDDispose</a></code>, which allows another process to use DVD Playback Services. </p><p>In this example, the event callback registration number is used as a flag to make sure a playback session is active. You'll learn how this registration number is obtained in <span class="content_text"><a href="../dvdguide_tasks_2/dvdguide_tasks_2.html#//apple_ref/doc/uid/TP40002163-TP40003220-SW11">“Registering for DVD Events.”</a></span> </p><div class="codesample"><table><tr><td scope="row"><pre>- (void) endSession<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (mEventCallBackID) {<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus err = DVDUnregisterEventCallBack (mEventCallBackID);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = DVDDispose();<span></span></pre></td></tr><tr><td scope="row"><pre>        mEventCallBackID = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dvdguide_concepts/dvdguide_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dvdguide_tasks_2/dvdguide_tasks_2.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-03-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/DVDPlaybackGuide/dvdguide_tasks_1/dvdguide_tasks_1.html%3Fid%3DTP40002163-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/DVDPlaybackGuide/dvdguide_tasks_1/dvdguide_tasks_1.html%3Fid%3DTP40002163-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/DVDPlaybackGuide/dvdguide_tasks_1/dvdguide_tasks_1.html%3Fid%3DTP40002163-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>