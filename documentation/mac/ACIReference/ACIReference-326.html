<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyCMConcatInit(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING326></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-325.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-327.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-314.html"><B>Chapter 4 - ColorSync Manager Reference for Color Management Modules</B></A> / <A HREF="ACIReference-322.html"><B>Optional CMM-Defined Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B></B></A> / <A HREF="ACIReference-317.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING326-0></A>
<H3><A NAME=MARKER-11-53></A><A NAME=MARKER-9-54></A>MyCMConcatInit</H3>
 Handles the <CODE>kCMMConcatInit</CODE> request by initializing any private data the CMM will need for a color session involving the specified set of profiles.<P>
 A CMM should <A NAME=MARKER-2-55></A>respond to the <CODE>kCMMConcatInit</CODE> request code, but it is not required to do so. The ColorSync Manager sends this request code to your CMM on behalf of an application or device driver that called the <CODE>CWConcatColorWorld</CODE> function. The ColorSync Manager dispatches this request to the Component Manager, which calls your CMM to service the request. A CMM typically responds to the <CODE>kCMMConcatInit</CODE> request code by calling a CMM-defined function (for example, <CODE>MyCMConcatInit</CODE>) to handle the request. <P>
 The MyCMConcatInit function is a color management module-defined subroutine.<P>
<PRE>
pascal CMError MyCMConcatInit (
ComponentInstance CMSession,
CMConcatProfileSet *profileSet); 
</PRE>
<DL>
<DT><CODE>CMsession</CODE>
<DD> A handle to your CMM's storage for the instance of your component associated with the calling application or device driver.
<DT><CODE>profileSet</CODE>
<DD> A pointer to an array of profiles <A HREF=ACIReference-189.html#MARKER-9-250>(page 3-46)</A> to use in a color-matching or color-checking session. The profiles in the array are in processing order--source through destination. The <CODE>profileSet</CODE> field of the data structure contains the array. For a description of the <CODE>CMConcatProfileSet</CODE> data structure, see <A HREF=ACIReference-189.html#MARKER-9-250>"Concatenated Profile Set Structure" (page 3-46)</A>.
<DT><I>function result</I>
<DD> A result code of type CMError. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-172)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING326-8></A>
<H5>DISCUSSION</H5>
 Using the private storage pointed to by the <CODE>CMSession</CODE> handle, your <CODE>MyCMConcatInit</CODE> function should initialize any private data your CMM will need for a color session involving the set of profiles specified by the profile array pointed to by the <CODE>profileSet</CODE> parameter. Your function should also initialize any additional private data needed in handling subsequent calls pertaining to this component instance.<P>
 A color-matching or color-checking session for a set of profiles entails various color transformations among devices in a sequence for which your CMM is responsible. Your function must obtain required information from the profiles and initialize private data for subsequent color-matching or color-checking sessions with these values. After your function returns to the Component Manager, it no longer has access to the profiles. <P>
 This request gives you the opportunity to examine the profile contents before storing them. If you do not support some aspect of the profile, then you should return an unimplemented error in response to this request. For example, if your CMM does not implement multichannel color support, you should return an unimplemented error at this point.<P>
 When your CMM uses a device-linked profile or a set of concatenated profiles, you must adhere to the following guidelines and rules:<P>
<UL>
<LI>You should use the quality flag setting--indicating normal mode, draft mode, or best mode--specified by the first profile for the entire color-matching session; you should ignore the quality flags of following profiles in the sequence. The profile header <CODE>flag</CODE> field holds the quality flag setting. Your CMM may choose to ignore the quality flag. This is allowed, but not recommended unless you support best mode by default. 
<LI>You must use the rendering intent specified by the first profile to color match to the second profile, the rendering intent specified by the second profile to color match to the third profile, and so on through the series of concatenated profiles. 
<LI>If the calling application or driver passed a color space profile in the middle of the profile sequence, the Apple-supplied CMM ignores this profile. Your CMM should also ignore it. <P>
</UL>
 For specific guidelines on handling device-linked profiles and additional information on handling concatenated profiles, see <A HREF=ACIReference-154.html#MARKER-9-33>"ColorSync Manager Reference for Applications and Device Drivers" (page 3-7)</A>.<P>
 The Component Manager calls your CMM with a standard open request to open the CMM when a ColorSync-supportive application or device driver requests that the Component Manager open a connection to your component. At this time, your component should allocate any memory it needs to maintain a connection for the requesting application or driver. You should attempt to allocate memory from the current heap zone. If that attempt fails, you should allocate memory from the system heap or the temporary heap. You can use the <CODE>SetComponentInstanceStorage</CODE> function to associate the allocated memory with the component instance. Whenever the calling application or driver requests services from your component, the Component Manager supplies you with the handle to this memory in the <CODE>session</CODE> parameter. For complete details on the <CODE>SetComponentInstanceStorage</CODE> function, see the chapter "Component Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<P>
 The Component Manager may call your CMM with the <CODE>kCMMConcatInit</CODE> request code multiple times after it calls your CMM with a request to open the CMM. For example, it may call your CMM with an initialization request once with one pair of profiles and then again with another pair of profiles. For each call, you need to reinitialize the storage based on the content of the current profiles. <P>
 Your CMM should support all seven classes of profiles defined by the ICC. For information on the seven classes of profiles, see <A HREF=ACIReference-160.html#MARKER-9-68>"Profile Classes" (page 3-13)</A>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-325.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-327.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
