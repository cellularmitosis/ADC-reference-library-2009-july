<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects XML Serialization Guide: Transforming XML Documents</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Transforming XML Documents"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000182" title="Transforming XML Documents"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../AboutThisBook/AboutThisBook.html#//apple_ref/doc/uid/TP30000177-DontLinkElementID_4">WebObjects XML Serialization Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Transformation/Transformation.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SchemaAndDTD/SchemaAndDTD.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000182-SW13" title="Transforming XML Documents"></a><h1>Transforming XML Documents</h1><p><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_214"></a>In <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW36">“Serializing Objects and Data”</a></span> you learned how to serialize and deserialize objects and primitive-type values. This chapter explains how you transform a stream containing serialized data into an XML document using an XSLT script.</p><p>The chapter contains the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="Transforming.html#//apple_ref/doc/uid/TP30000182-SW1">“The Transformation Process”</a></span> contains example code fragments that perform transformations.</p></li><li class="li"><p><span class="content_text"><a href="Transforming.html#//apple_ref/doc/uid/TP30000182-SW5">“Creating the Transformation Project”</a></span> shows how to create the project.</p></li><li class="li"><p><span class="content_text"><a href="Transforming.html#//apple_ref/doc/uid/TP30000182-SW6">“Transforming Primitive-Type Values Using Keys”</a></span> explains how to create an XML document from data serialized using keys.</p></li><li class="li"><p><span class="content_text"><a href="Transforming.html#//apple_ref/doc/uid/TP30000182-SW10">“Transforming an Array of Movies”</a></span> explains how to transform an NSArray of custom objects into an XML document.</p></li></ul><a name="//apple_ref/doc/uid/TP30000182-SW1" title="The Transformation Process"></a><h2>The Transformation Process</h2><p><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_215"></a>The XMLSerializer<a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_216"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_217"></a> class of the Serialization project, introduced in<span class="content_text"><a href="../Serialization/Serialization.html#//apple_ref/doc/uid/TP30000179-SW16">“XML Serialization Essentials”</a></span> and listed in <span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW4">Listing B-2</a></span> includes the <code>transformObject</code> method, shown in <span class="content_text">Listing 5-1</span>.</p><a name="//apple_ref/doc/uid/TP30000182-SW2" title="Listing 5-1The transformObject method in XMLSerializer .java"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>The <code>transformObject</code> method in <code>XMLSerializer .java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes objects and data to a stream, which can also be<span></span></pre></td></tr><tr><td scope="row"><pre> * transformed. The product of the process is written to a file.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param source          object to serialize or transform<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename        filename of the target document,<span></span></pre></td></tr><tr><td scope="row"><pre> *                        including path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> * @param transformation  type of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre> *                        indicates which transformation script to use.<span></span></pre></td></tr><tr><td scope="row"><pre> *                        When &lt;code>null&lt;/code>, no transformation<span></span></pre></td></tr><tr><td scope="row"><pre> *                        is performed, only serialization.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @return &lt;code>true&lt;/code> when the process succeeds.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public static boolean transformObject(Object source, String filename, String transformation) {<span></span></pre></td></tr><tr><td scope="row"><pre>    boolean success = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create a stream to the output file.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream stream = (NSXMLOutputStream)openStream(filename, false, transformation);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Serialize data to XML output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeObject(source);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        stream.flush();<span></span></pre></td></tr><tr><td scope="row"><pre>        closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        success = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return success;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The <code>transformObject</code> method opens an output stream (line numbered 1) to a file using the <code>openStream</code> method (<span class="content_text">Listing 5-2</span>), which initializes the XML transformer using the <code>initializeTransformer</code> method (line 1), shown in <span class="content_text"><a href="Transforming.html#//apple_ref/doc/uid/TP30000182-SW4">Listing 5-3</a></span>. The <code>openStream</code> method also turns indenting<a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_218"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_219"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_220"></a> on using the <code>NSXMLOutputFormat(boolean)</code> constructor of the NSXMLOutputFormat class (lines 2 and 3)<a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_221"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_222"></a>.</p><a name="//apple_ref/doc/uid/TP30000182-SW3" title="Listing 5-2The openStream method in XMLSerializer.java"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>The <code>openStream</code> method in <code>XMLSerializer.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Opens a file stream to or from a file and a corresponding<span></span></pre></td></tr><tr><td scope="row"><pre> * output or input object stream.<span></span></pre></td></tr><tr><td scope="row"><pre> * Adds the pair of streams to an internal dictionary for use by<span></span></pre></td></tr><tr><td scope="row"><pre> * the &lt;code>closeStream&lt;/code> method.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename         fully qualified filename of the<span></span></pre></td></tr><tr><td scope="row"><pre> *                         target or source file; identifies<span></span></pre></td></tr><tr><td scope="row"><pre> *                         the channel to open<span></span></pre></td></tr><tr><td scope="row"><pre> * @param input_stream     indicates whether the stream returned<span></span></pre></td></tr><tr><td scope="row"><pre> *                         is an input stream or an output stream:<span></span></pre></td></tr><tr><td scope="row"><pre> *                         &lt;code>true&lt;/code> for an input stream and<span></span></pre></td></tr><tr><td scope="row"><pre> *                        &lt;code>false&lt;/code> for an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre> * @param transformation  type of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre> *                        indicates which transformation script to use.<span></span></pre></td></tr><tr><td scope="row"><pre> *                        When &lt;code>null&lt;/code>, no transformation<span></span></pre></td></tr><tr><td scope="row"><pre> *                        is performed, only serialization.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @return object stream, &lt;code>null&lt;/code> when the stream<span></span></pre></td></tr><tr><td scope="row"><pre> *         could not be created.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>private static Object openStream(String filename, boolean input_stream, String transformation) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>    BufferedOutputStream file_output_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    BufferedInputStream file_input_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    Channel channel;<span></span></pre></td></tr><tr><td scope="row"><pre>    Object xml_stream = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (input_stream) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an input stream from the file.<span></span></pre></td></tr><tr><td scope="row"><pre>        file_input_stream = new BufferedInputStream(new FileInputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create object input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream = new NSXMLInputStream(file_input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        channel = new Channel(file_input_stream, xml_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an output stream to the file.<span></span></pre></td></tr><tr><td scope="row"><pre>        file_output_stream = new BufferedOutputStream(new FileOutputStream(filename));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create object output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        if (transformation != null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            xml_stream = initializeTransformer(file_output_stream, transformation);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>            xml_stream = new NSXMLOutputStream(file_output_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Set the format of the output document (XML).<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputFormat format = new NSXMLOutputFormat(true);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        ((NSXMLOutputStream)xml_stream).setOutputFormat(format);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        channel = new Channel(file_output_stream, xml_stream, input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    channels.setObjectForKey(channel, filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000182-SW4" title="Listing 5-3The initializeTransformer method in XMLSerializer.java"></a><p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>The <code>initializeTransformer</code> method in <code>XMLSerializer.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Initializes the transformer.<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param file_stream       target file stream<span></span></pre></td></tr><tr><td scope="row"><pre> * @param transformation    type of transformation to perform;<span></span></pre></td></tr><tr><td scope="row"><pre> *                          indicates which transformation file to use<span></span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @throws IOException when there's a problem initializing the transformer.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>private static NSXMLOutputStream initializeTransformer(BufferedOutputStream file_stream, String transformation) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSXMLOutputStream xml_stream = new NSXMLOutputStream(file_stream, new File(transformationURI(transformation)));<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    Transformer transformer = ((NSXMLOutputStream)xml_stream).transformer();<span></span></pre></td></tr><tr><td scope="row"><pre>    transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return xml_stream;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The <code>initializeTransformer</code> method takes a stream to a file in the <em>file_stream</em> parameter, which it uses to create the NSXMLOutputStream object (1) that transforms whatever is written to it using the transformation script indicated by the <em>transformation</em> parameter. Then it sets an output property of the transformer; in this case it sets the indentation level of the new document.<a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_223"></a></p><a name="//apple_ref/doc/uid/TP30000182-SW5" title="Creating the Transformation Project"></a><h2>Creating the Transformation Project</h2><p>This section shows you how to create the Transformation project, which is based on the Serialization project created in <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW36">“Serializing Objects and Data.”</a></span> (You can avoid all the manual work by copying the Transformation folder in <code>projects/Transformation/Starter</code> to your working directory.)</p><ol class="ol"><li class="li"><p>In Project Builder, create a WebObjects application project and name it <code>Transformation</code>.</p></li><li class="li"><p>Add an empty file to the project's Resources group and name it <code>SimpleTransformation.xsl</code> and enter the XSLT transformation script in <span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW6">Listing B-3</a></span> as the file's contents. (Alternatively, you can add the <code>SimpleTransformation.xsl</code> file in <code>projects/Transforming/Starter/Transformation</code> to your project.) Assign <code>SimpleTransformation.xsl</code> to the Application Server target.</p></li><li class="li"><p>Copy the <code>Application.java</code> file from the Serialization project's folder into the Transformation project's folder.</p></li><li class="li"><p>Add <code>Movie.java</code> and <code>XMLSerializer.java</code> from the Serialization project to the Transformation project. Make sure to copy the files to the Transformation folder and to assign them to the Application Server target.</p><div class="item_figure"><img src = "../art/add_serialization_files.gif" alt = "Transformation.pbproj" width="823" height="460"></div></li></ol><a name="//apple_ref/doc/uid/TP30000182-SW6" title="Transforming Primitive-Type Values Using Keys"></a><h2>Transforming Primitive-Type Values Using Keys</h2><p><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_224"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_225"></a>This section shows you how to convert a stream generated by NSXMLOutputStream into an XML document in which the element name of each data element is derived from the value of the <code>key</code> attribute of each serialized object.</p><p>All you have to do is copy the <code>serializePrimitives</code> method of <code>Application.java</code> and paste it at the bottom of the file. Then edit the method so that it looks like <span class="content_text">Listing 5-4</span> (change the numbered lines). <span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW6">Listing B-3</a></span> shows the XSLT script used to perform the transformation. </p><a name="//apple_ref/doc/uid/TP30000182-SW7" title="Listing 5-4The transformPrimitives method in the Application class"></a><p class="codesample"><strong>Listing 5-4&nbsp;&nbsp;</strong>The <code>transformPrimitives</code> method in the Application class</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Transforms a set of primitive values.<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename      identifies the target file including its<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> *                      path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> * @param an_int        value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_boolean     value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_char        value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> * @param a_double      value to serialize<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void transformPrimitives(filename, int an_int, boolean a_boolean, char a_char, double a_double) {<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Open an output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream stream = XMLSerializer.openOutputStream(filename, XMLSerializer.TRANSFORM_SIMPLE);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write values.<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeInt(an_int, "my_integer");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeBoolean(a_boolean, "my_boolean");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeChar(a_char, "my_char");<span></span></pre></td></tr><tr><td scope="row"><pre>        stream.writeDouble(a_double, "my_double");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        XMLSerializer.closeStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Now, add a call to the <code>transformPrimitives</code> method to Application's constructor, (for example, the code lines below) and build and run the application.</p><div class="codesample"><table><tr><td scope="row"><pre>// Transform a set of primitive values.<span></span></pre></td></tr><tr><td scope="row"><pre>transformPrimitives("/tmp/PrimitivesTransformed.xml", 5, true, 'u', 3.14);<span></span></pre></td></tr></table></div><p>In the transformation process, the document in <span class="content_text">Listing 5-5</span> is transformed into the one in <span class="content_text">Listing 5-6</span>. The first document is not written to a file; it's the source document that the XSLT processor uses to produce the document that is actually written to the file system.</p><a name="//apple_ref/doc/uid/TP30000182-SW8" title="Listing 5-5The source document: produced by NSXMLOutputStream before transformation"></a><p class="codesample"><strong>Listing 5-5&nbsp;&nbsp;</strong>The source document: produced by NSXMLOutputStream before transformation</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content ...><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;int key="my_integer">5&lt;/int><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;boolean key="my_boolean">true&lt;/boolean><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;ch key="my_char">u&lt;/ch><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;double key="my_double">3.14&lt;/double><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000182-SW9" title="Listing 5-6The target document: PrimitivesTransformed.xml"></a><p class="codesample"><strong>Listing 5-6&nbsp;&nbsp;</strong>The target document: <code>PrimitivesTransformed.xml</code></p><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_226"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_227"></a><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;my_integer>5&lt;/my_integer><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;my_boolean>true&lt;/my_boolean><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;my_char>u&lt;/my_char><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;my_double>3.14&lt;/my_double><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000182-SW10" title="Transforming an Array of Movies"></a><h2>Transforming an Array of Movies</h2><p><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_228"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_229"></a>As you may recall, <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW30">“Serializing Custom Objects to an XML Document,”</a></span> explains how to serialize a custom object with key values. <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW32">Listing 3-14</a></span> shows the document generated. This section explains how to transform that document into another XML document.</p><p>Copy the <code>serializeMovieArray</code> method of <code>Application.java</code> to the end of the file and rename it to <code>transformMovieArray</code>. Edit the new method so that it looks like <span class="content_text">Listing 5-7</span> (change the numbered lines).</p><a name="//apple_ref/doc/uid/TP30000182-SW11" title="Listing 5-7The transformMovieArray method in Application.java"></a><p class="codesample"><strong>Listing 5-7&nbsp;&nbsp;</strong>The <code>transformMovieArray</code> method in <code>Application.java</code></p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Transforms a Movie array.<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> *<span></span></pre></td></tr><tr><td scope="row"><pre> * @param filename   identifies the target file, including<span></span></pre></td></tr><tr><td scope="row"><pre> *                   its path and extension<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void transformMovieArray(String filename) {<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    // Set the local time zone.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTimeZone timeZone = NSTimeZone.timeZoneWithName("America/Los_Angeles", true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Initialize the array.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray movies = new NSMutableArray();<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Alien", "20th Century Fox", new NSTimestamp(1979, 10, 25, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Blade Runner", "Warner Brothers", new NSTimestamp(1982, 1, 3, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre>    movies.addObject(new Movie("Star Wars", "20th Century Fox", new NSTimestamp(1977, 12, 29, 0, 0, 0, timeZone)));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Transform the array.<span></span></pre></td></tr><tr><td scope="row"><pre>    XMLSerializer.transformObject(movies, filename, XMLSerializer.TRANSFORM_SIMPLE);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Add the following code lines to Application's constructor and build and run the application.</p><div class="codesample"><table><tr><td scope="row"><pre>// Transform an array of Movie objects.<span></span></pre></td></tr><tr><td scope="row"><pre>transformMovieArray("/tmp/MoviesTransformed.xml");<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 5-8</span> shows the product of the transformation. Notice how the transformation script (<span class="content_text"><a href="../Listings/Listings.html#//apple_ref/doc/uid/TP30000184-SW6">Listing B-3</a></span>) replaced the reference to the studio of <em>Star Wars</em> (see <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW32">Listing 3-14</a></span>) with the correct value (20th Century Fox).<a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_230"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_231"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_232"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_233"></a><a name="//apple_ref/doc/uid/TP30000182-DontLinkElementID_234"></a></p><a name="//apple_ref/doc/uid/TP30000182-SW12" title="Listing 5-8The MoviesTransformed.xml file"></a><p class="codesample"><strong>Listing 5-8&nbsp;&nbsp;</strong>The <code>MoviesTransformed.xml</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;content><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;Movie><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;title>Alien&lt;/title><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;studio>20th Century Fox&lt;/studio><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;release_date>1979-10-25 07:00:00 Etc/GMT&lt;/release_date><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/Movie><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;Movie><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;title>Blade Runner&lt;/title><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;studio>Warner Brothers&lt;/studio><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;release_date>1982-01-03 08:00:00 Etc/GMT&lt;/release_date><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/Movie><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;Movie><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;title>Star Wars&lt;/title><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;studio>20th Century Fox&lt;/studio><span></span></pre></td></tr><tr><td scope="row"><pre>      &lt;release_date>1977-12-29 08:00:00 Etc/GMT&lt;/release_date><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/Movie><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/content><span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Transformation/Transformation.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../SchemaAndDTD/SchemaAndDTD.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/XML_Serialization/Transforming/Transforming.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/XML_Serialization/Transforming/Transforming.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/XML_Serialization/Transforming/Transforming.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>