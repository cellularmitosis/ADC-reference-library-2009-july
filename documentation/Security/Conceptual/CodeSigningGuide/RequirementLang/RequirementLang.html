<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Code Signing Guide: Code Signing Requirement Language</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Code Signing Requirement Language"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005929-CH5" title="Code Signing Requirement Language"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000434" target="_top">Security</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40005929-CH1-DontLinkElementID_28">Code Signing Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Procedures/Procedures.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005929-CH5-SW1" title="Code Signing Requirement Language"></a><h1>Code Signing Requirement Language</h1><p>When you use the <code>codesign</code> command to sign a block of code, you can specify internal requirements; that is, the criteria that you recommend should be used to evaluate the code signature. It is up to the verifier to decide whether to apply the internal requirements or some other set of requirements when deciding how to treat the signed code. You use the code requirement language described in this chapter when specifying requirements to the <code>codesign</code> or <code>csreq</code> command (see the manual pages for <code>codesign(1)</code> and <code>csreq(1)</code>).</p><p>This chapter describes the requirement language source code. You can compile a set of requirements and save them in binary form using the <code>csreq</code> command. You can provide requirements to the <code>codesign</code> command either as source code or as a binary file. Both the <code>codesign</code> and <code>csreq</code> commands can convert a binary requirement set to text. Although there is some flexibility in the source code syntax (for example, quotes can always be used around string constants but are not always required), conversion from binary to text always uses the same form:</p><ul class="ul"><li class="li"><p>Parentheses are placed (usually only) where required to clarify operator precedence.</p></li><li class="li"><p>String constants are quoted (usually only) where needed.</p></li><li class="li"><p>Whether originally specified as constants or through file paths, certificate hashes are always returned as hash constants.</p></li><li class="li"><p>Comments in the original source are not preserved in the reconstructed text.</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_13">Language Syntax</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_14">Evaluation of Requirements</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_15">Constants</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_18">Variables</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW3">Logical Operators</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW4">Comparison Operations</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_21">Constraints</a>
				
			<br/>
			
        
			
			
				<a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_27">Requirement Sets</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_13" title="Language Syntax"></a><h2>Language Syntax</h2><p>Some basic features of the language syntax are:</p><ul class="ul"><li class="li"><p>Expressions use conventional infix notation (that is, the operator is placed between the two entities being acted on; for example <em>quantity</em> <code>&lt;</code> <em>constant</em>).</p></li><li class="li"><p>Keywords are reserved, but can be quoted to be included as part of ordinary strings.</p></li><li class="li"><p>Comments are allowed in C, Objective C, and C++.</p></li><li class="li"><p>Unquoted whitespace is allowed between tokens, but strings containing whitespace must be quoted.</p></li><li class="li"><p>Line endings have no special meaning and are treated as whitespace.</p></li></ul><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_14" title="Evaluation of Requirements"></a><h2>Evaluation of Requirements</h2><p>A requirement constitutes an expression without side effects. Each requirement can have any number of subexpressions, each of which is evaluated with a Boolean (succeed-fail) result. There is no defined order of evaluation. The subexpressions are combined using logical operators in the expression to yield an overall Boolean result for the expression. Depending on the operators used, an expression can succeed even if some subexpressions fail. For example, the expression</p><div class="codesample"><table><tr><td scope="row"><pre>anchor apple or anchor = "/var/db/yourcorporateanchor.cert"<span></span></pre></td></tr></table></div><p>succeeds if either subexpression succeeds—that is, if the code was signed either by Apple or by your company—even though one of the subexpressions is sure to fail.</p><p>If an error occurs during evaluation, on the other hand, evaluation stops immediately and the <code>codesign</code> or <code>csreq</code> command returns with a result code indicating the reason for failure.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_15" title="Constants"></a><h2>Constants</h2><p>This section describes the use of string, integer, hash-value, and binary constants in the code signing requirement language.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_16" title="String Constants"></a><h3>String Constants</h3><p>String constants must be enclosed by double quotes (<code>" "</code>) unless the string contains only letters, digits, and periods (.), in which case the quotes are optional. Absolute file paths, which start with a slash, do not require quotes unless they contain spaces. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>com.apple.mail                       //no quotes are required<span></span></pre></td></tr><tr><td scope="row"><pre>"com.apple.mail"                     //quotes are optional<span></span></pre></td></tr><tr><td scope="row"><pre>"My Company's signing identity"      //requires quotes for spaces and apostrophe<span></span></pre></td></tr><tr><td scope="row"><pre>/Volumes/myCA/root.crt               //no quotes are required<span></span></pre></td></tr><tr><td scope="row"><pre>"/Volumes/my CA/root.crt"            //space requires quotes<span></span></pre></td></tr><tr><td scope="row"><pre>"/Volumes/my_CA/root.crt"            //underscore requires quotes<span></span></pre></td></tr></table></div><p>It’s never incorrect to enclose the string in quotes—if in doubt, use quotes.</p><p>Use a backslash to “escape” any character. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>"one \" embedded quote"              //one " embedded quote<span></span></pre></td></tr><tr><td scope="row"><pre>"one \\ embedded backslash"          //one \ embedded backslash<span></span></pre></td></tr></table></div><p>There is nothing special about the single quote character (').</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_17" title="Integer Constants"></a><h3>Integer Constants</h3><p>Integer constants are written as decimal constants are in C. The language does not allow radix prefixes (such as <code>0x</code>) or leading plus or minus (<code>+</code> or <code>-</code>) signs. </p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW2" title="Hash Constants"></a><h3>Hash Constants</h3><p>Hash values are written either as a hexadecimal number in quotes preceded by an <code>H</code>, or as a path to a file containing a binary certificate. If you use the first form, the number must include the exact number of digits in the hash value. A SHA-1 hash (the only kind currently supported) requires exactly 40 digits; for example:</p><div class="codesample"><table><tr><td scope="row"><pre>H"0123456789ABCDEFFEDCBA98765432100A2BC5DA"<span></span></pre></td></tr></table></div><p>You can use either uppercase or lowercase letters (<code>A..F</code> or <code>a..f</code>) in the hexadecimal numbers.</p><p>If you specify a file path, the compiler reads the binary certificate and calculates the hash for you. The compiled version of the requirement code includes only the hash; the certificate file and the path are not retained. If you convert the requirement back to text, you get the hexadecimal hash constant. The file path must point to a file containing an X.509 DER encoded certificate. No container forms (PKCS7, PKCS12) are allowed, nor is the OpenSSL "PEM" form supported. </p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_18" title="Variables"></a><h2>Variables</h2><p>There are currently no variables in the requirement language. </p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW3" title="Logical Operators"></a><h2>Logical Operators</h2><p>The requirement language includes the following logical operators, in order of decreasing precedence: </p><ul class="ul"><li class="li"><p><code>!</code> (negation)</p></li><li class="li"><p><code>and</code> (logical AND)</p></li><li class="li"><p><code>or</code> (logical OR)</p></li></ul><p>These operators can be used to combine subexpressions into more complex expressions. The negation operator (<code>!</code>) is a unary prefix operator. The others are infix operators. Parentheses can be used to override the precedence of the operators.</p><p>Because the language is free of side effects, evaluation order of subexpressions is unspecified.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW4" title="Comparison Operations"></a><h2>Comparison Operations</h2><p>The requirement language includes the following comparison operators:</p><ul class="ul"><li class="li"><p><code>=</code> (equals)</p></li><li class="li"><p><code>&lt;</code> (less than)</p></li><li class="li"><p><code>></code> (greater than)</p></li><li class="li"><p><code>&lt;=</code> (less than or equal to)</p></li><li class="li"><p><code>>=</code> (greater than or equal to)</p></li><li class="li"><p><code>exists</code> (value is present)</p></li></ul><p>The value-present (<code>exists</code>) operator is a unary suffix operator. The others are infix operators.</p><p>There are no operators for non-matches (not equal to, not greater than, and so on). Use the negation operator (<code>!</code>) together with the comparison operators to make non-match comparisons.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW8" title="Equality"></a><h3>Equality</h3><p>All equality operations compare some value to a constant. The value and constant must be of the same type: a string matches a string constant, a data value matches a hexadecimal constant. The equality operation evaluates to <code>true</code> if the value exists and is equal to the constant. String matching uses the same matching rules as <code>CFString</code> (see <em><a href="../../../../CoreFoundation/Reference/CFStringRef/index.html#//apple_ref/doc/uid/20001211" target="_top">CFString Reference</a></em>). </p><p>In match expressions (see <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW5">“Info,”</a></span> <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW6">“Part of a Certificate,”</a></span> and <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW7">“Entitlement”</a></span>), substrings of string constants can be matched by using the <code>*</code> wildcard character:</p><ul class="spaceabove"><li class="li"><p><code>value = *constant*</code> is <code>true</code> if the value exists and any substring of the value matches the constant; for example: </p><ul class="nested"><li class="nested li"><p><code>thunderbolt = *under*</code></p></li><li class="nested li"><p><code>thunderbolt = *thunder*</code></p></li><li class="nested li"><p><code>thunderbolt = *bolt*</code></p></li></ul></li><li class="li"><p><code>value = constant*</code> is <code>true</code> if the value exists and begins with the constant; for example: </p><ul class="nested"><li class="nested li"><p><code>thunderbolt = thunder*</code></p></li><li class="nested li"><p><code>thunderbolt = thun*</code></p></li></ul></li><li class="li"><p><code>value = *constant</code> is <code>true</code> if the value exists and ends with the constant; for example: </p><ul class="nested"><li class="nested li"><p><code>thunderbolt = *bolt</code></p></li><li class="nested li"><p><code>thunderbolt = *underbolt</code></p></li></ul></li></ul><p>If the constant is written with quotation marks, the asterisks must be outside the quotes. An asterisk inside the quotation marks is taken literally. For example:</p><ul class="spaceabove"><li class="li"><p><code>"ten thunderbolts" = "ten thunder"*</code> is <code>true</code></p></li><li class="li"><p><code>"ten thunder*bolts" = "ten thunder*"*</code> is <code>true</code></p></li><li class="li"><p><code>"ten thunderbolts" = "ten thunder*"</code> is <code>false</code></p></li></ul><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_19" title="Inequality"></a><h3>Inequality</h3><p>Inequality operations compare some value to a constant. The value and constant must be of the same type: a string matches a string constant, a data value matches a hexadecimal constant. String comparisons use the same matching rules as <code>CFString</code> with the <code>kCFCompareNumerically</code> option flag; for example, <code>"17.4"</code> is greater than <code>"7.4"</code>. </p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_20" title="Existence"></a><h3>Existence</h3><p>The existence operator tests whether the value exists. It evaluates to <code>false</code> only if the value does not exist at all or is exactly the Boolean value <code>false</code>. An empty string and the number <code>0</code> are considered to exist.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_21" title="Constraints"></a><h2>Constraints</h2><p>Several keywords in the requirement language are used to require that specific certificates be present or other conditions be met.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_22" title="Identifier"></a><h3>Identifier</h3><p>The expression </p><p><code>identifier = </code><em>constant</em></p><p>succeeds if the unique identifier string embedded in the code signature is exactly equal to <em>constant</em>. The equal sign is optional in identifier expressions. Signing identifiers can be tested only for exact equality; the wildcard character (<code>*</code>) can not be used with the identifier constraint, nor can identifiers be tested for inequality.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW5" title="Info"></a><h3>Info</h3><p>The expression </p><p><code>info [</code><em>key</em><code>]</code><em>match expression</em></p><p>succeeds if the value associated with the top-level key in the code’s <code>info.plist</code> file matches <em>match expression</em>, where <em>match expression</em> can include any of the operators listed in <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW3">“Logical Operators”</a></span> and <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW4">“Comparison Operations.”</a></span> For example:</p><div class="codesample"><table><tr><td scope="row"><pre>info [CFBundleShortVersionString] &lt; "17.4"<span></span></pre></td></tr></table></div><p>or</p><div class="codesample"><table><tr><td scope="row"><pre>info [MySpecialMarker] exists<span></span></pre></td></tr></table></div><p>You must specify <em>key</em> as a string constant.</p><p>If the value of the specified key is a string, the match is applied to it directly. If the value is an array, it must be an array of strings and the match is made to each in turn, succeeding if any of them matches. Substrings of string constants can be matched by using any match expression (see <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW4">“Comparison Operations”</a></span>).</p><p>If the code has no <code>info.plist</code> file, or the <code>info.plist</code> does not contain the specified key, this expression evaluates to <code>false</code> without returning an error.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW9" title="Certificate"></a><h3>Certificate</h3><p>Certificate constraints refer to certificates in the certificate chain used to validate the signature. Most uses of the <code>certificate</code> keyword accept an integer that indicates the position of the certificate in the chain: positive integers count from the anchor (0) toward the leaf. Negative integers count backward from the signing certificate (-1). For example, <code>certificate 1</code> indicates the certificate that was directly signed by the anchor, and <code>certificate -2</code> is the intermediate certificate that was used to sign the leaf (that is, the signing certificate). Note that this convention is the same as that used for array indexing in the Perl and Ruby programming languages:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Anchor</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>First intermediate</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Second Intermediate</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Leaf</p></th></tr><tr><td  scope="row"><p><code>certificate 0</code></p></td><td ><p><code>certificate 1</code></p></td><td ><p><code>certificate 2</code></p></td><td ><p><code>certificate 3</code></p></td></tr><tr><td  scope="row"><p><code>certificate -4</code></p></td><td ><p><code>certificate -3</code></p></td><td ><p><code>certificate -2</code></p></td><td ><p><code>certificate -1</code></p></td></tr></table></div><p>Other keywords include:</p><ul class="spaceabove"><li class="li"><p><code>certificate root</code>—the anchor certificate; same as certificate 0</p></li><li class="li"><p><code>anchor</code>—same as <code>certificate root</code></p></li><li class="li"><p><code>certificate leaf</code>—the signing certificate; same as <code>certificate -1</code></p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_29" title="Note"></a><p><strong>Note:</strong>&nbsp;The short form <code>cert</code> is allowed for the keyword <code>certificate</code>.</p></div><p>If there is no certificate at the specified position, the constraint evaluates to <code>false</code> without returning an error.</p><p>If the code was signed using an ad-hoc signature, there are no certiﬁcates at all and all certiﬁcate constraints evaluate to <code>false</code>. (An ad-hoc signature is created by signing with the pseudo-identity <code>-</code> (a dash). An ad-hoc signature does not use or record a cryptographic identity, and thus identifies exactly and only the one program being signed.) </p><p>If the code was signed by a self-signed certiﬁcate, then the leaf and root refer to the same single certiﬁcate.</p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_23" title="Whole Certificate"></a><h4>Whole Certificate</h4><p>To require a particular certificate to be present in the certificate chain, use the form</p><p><code>certificate</code> <em>position</em><code> = </code><em>hash</em></p><p>or one of the equivalent forms discussed above, such as <code>anchor = </code><em>hash</em>. Hash constants are described in <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW2">“Hash Constants.”</a></span></p><p>For Apple’s own code, signed by Apple, you can use the short form</p><p><code>anchor apple</code></p><p>For code signed by Apple, including code signed using a signing certificate issued by Apple to other developers, use the form</p><p><code>anchor apple generic</code></p><a name="//apple_ref/doc/uid/TP40005929-CH5-SW6" title="Part of a Certificate"></a><h4>Part of a Certificate</h4><p>To match a well-defined element of a certificate, use the form</p><p><code>certificate </code><em>position</em><code>[</code><em>element</em><code>]</code><em>match expression</em></p><p>where <em>match expression</em> can include the <code>*</code> wildcard character and any of the operators listed in <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW3">“Logical Operators”</a></span> and <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW4">“Comparison Operations.”</a></span> The currently supported elements are as follows:</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_30" title="Note"></a><p><strong>Note:</strong>&nbsp;Case is significant in element names.</p></div><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Element name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Meaning</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th></tr><tr><td  scope="row"><p><code>Subject.CN</code></p></td><td ><p>Subject common name</p></td><td ><p>Shown in Keychain Access utility</p></td></tr><tr><td  scope="row"><p><code>Subject.C</code></p></td><td ><p>Subject country name</p></td><td ><p></p></td></tr><tr><td  scope="row"><p><code>Subject.D</code></p></td><td ><p>Subject description</p></td><td ><p></p></td></tr><tr><td  scope="row"><p><code>Subject.L</code></p></td><td ><p>Subject locality</p></td><td ><p></p></td></tr><tr><td  scope="row"><p><code>Subject.O</code></p></td><td ><p>Subject organization</p></td><td ><p>Usually company or organization</p></td></tr><tr><td  scope="row"><p><code>Subject.OU</code></p></td><td ><p>Subject organizational unit</p></td><td ><p></p></td></tr><tr><td  scope="row"><p><code>Subject.STREET</code></p></td><td ><p>Subject street address</p></td><td ><p></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_24" title="Certificate Field by OID"></a><h4>Certificate Field by OID</h4><p>To check for the existence of any certificate field identified by its X.509 object identifier (OID), use the form</p><p><code>certificate </code><em>position</em><code> [field.</code><em>OID</em><code>] exists</code></p><p>The object identifier must be written in numeric form (<em>x</em><code>.</code><em>y</em><code>.</code><em>z</em>...) and can be the OID of a certificate extension or of a conventional element of a certificate as defined by the CSSM standard (see Chapter 31 in <em>Common Security: CDSA and CSSM</em>, version 2 (with corrigenda) by the Open Group (<span class="content_text"><a href="http://www.opengroup.org/security/cdsa.htm" target="_blank">http://www.opengroup.org/security/cdsa.htm</a></span>)). </p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_25" title="Trusted"></a><h3>Trusted</h3><p>The expression</p><p><code>certificate </code><em>position</em><code> trusted</code></p><p>succeeds if the certificate specified by <em>position</em> is marked trusted for the code signing certificate policy in the system’s Trust Settings database. The <em>position</em> argument is an integer or keyword that indicates the position of the certificate in the chain; see the discussion under <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW9">“Certificate.”</a></span></p><p>The expression</p><p><code>anchor trusted</code></p><p>succeeds if any certificate in the signature’s certificate chain is marked trusted for the code signing certificate policy in the system’s Trust Settings database, provided that no certificate closer to the leaf certificate is explicitly untrusted. </p><p>Thus, using the <code>trusted</code> keyword with a certificate position checks only the specified certificate, while using it with the <code>anchor</code> keyword checks all the certificates, giving precedence to the trust setting found closest to the leaf.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_31" title="Important:"></a><p><strong>Important:</strong>&nbsp;The syntax <code>anchor trusted</code> is <em>not</em> a synonym for <code>certificate anchor trusted</code>. Whereas the former checks all certificates in the signature, the latter checks only the anchor certificate.</p><p></p></div><p>Certificates can have per-user trust settings and system-wide trust settings, and trust settings apply to specific policies. The <code>trusted</code> keyword in the code signing requirement language causes trust to be checked for the specified certificate or certificates for the user performing the validation. If there are no settings for that user, then the system settings are used. In all cases, only the trust settings for the code-signing policy are checked. Policies and trust are discussed in <em><a href="../../CertKeyTrustProgGuide/index.html#//apple_ref/doc/uid/TP40001358" target="_top">Certificate, Key, and Trust Services Programming Guide</a></em>.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_32" title="Important:"></a><p><strong>Important:</strong>&nbsp;If you do not include an expression using the <code>trusted</code> keyword in your code signing requirement, then the verifier does not check the trust status of the certificates in the code signature at all.</p><p></p></div><a name="//apple_ref/doc/uid/TP40005929-CH5-SW7" title="Entitlement"></a><h3>Entitlement</h3><p>The expression</p><p><code>entitlement [</code><em>key</em><code>] </code><em>match expression</em></p><p>succeeds if the value associated with the specified key in the signature’s embedded entitlement dictionary matches <em>match expression</em>, where <em>match expression</em> can include the <code>*</code> wildcard character and any of the operators listed in <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW3">“Logical Operators”</a></span> and <span class="content_text"><a href="RequirementLang.html#//apple_ref/doc/uid/TP40005929-CH5-SW4">“Comparison Operations.”</a></span> You must specify <em>key</em> as a string constant. The entitlement dictionary is included in signatures for certain platforms.  </p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_26" title="Code Directory Hash"></a><h3>Code Directory Hash</h3><p>The expression</p><p><code>cdhash </code><em>hash-constant</em></p><p>computes a SHA-1 hash of the program’s CodeDirectory resource and succeeds if the value of this hash exactly equals the specified hash constant. </p><p>The CodeDirectory resource is the master directory of the contents of the program. It consists of a versioned header followed by an array of hashes. This array consists of a set of optional special hashes for other resources, plus a vector of hashes for pages of the main executable. The CodeSignature and CodeDirectory resources together make up the signature of the code. </p><p>You can use the codesign utility with (at least) three levels of verbosity to obtain the hash constant of a program’s CodeDirectory resource:</p><div class="codesample"><table><tr><td scope="row"><pre>    $ codesign -dvvv /bin/ls<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre>    CodeDirectory v=20001 size=257 flags=0x0(none) hashes=8+2 location=embedded<span></span></pre></td></tr><tr><td scope="row"><pre>    CDHash=4bccbc576205de37914a3023cae7e737a0b6a802<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr></table></div><p>Because the code directory changes whenever the program changes in a nontrivial way, this test can be used to unambiguously identify one specific version of a program. When the operating system signs an otherwise unsigned program (so that the keychain or Parental Controls can recognize the program, for example), it uses this requirement. </p><a name="//apple_ref/doc/uid/TP40005929-CH5-DontLinkElementID_27" title="Requirement Sets"></a><h2>Requirement Sets</h2><p>A requirement set is a collection of distinct requirements, each indexed (tagged) with a type code. The expression</p><p><em>tag</em><code> => </code><em>requirement</em></p><p>applies <em>requirement</em> to the type of code indicated by <em>tag</em>, where possible tags are</p><ul class="ul"><li class="li"><p><code>host</code>—this requirement is applied to the direct host of this code module; each code module in the hosting path can have its own host requirement, where the hosting path is the chain of code signing hosts starting with the most specific code known to be running, and ending with the root of trust (the kernel)</p></li><li class="li"><p><code>guest</code>—this requirement is applied to each code module that is hosted by this code module</p></li><li class="li"><p><code>library</code>—this requirement is applied to all libraries mounted by the signed code</p></li><li class="li"><p><code>designated</code>—this is an explicitly specified designated requirement for the signed code; if there is no explicitly specified designated requirement for the code, then there is no <code>designated</code> internal requirement</p></li></ul><p>The primary use of requirement sets is to represent the internal requirements of the signed code. For example:  </p><div class="codesample"><table><tr><td scope="row"><pre>    codesign -r='host => anchor apple and identifier com.apple.perl designated => anchor /my/root and identifier com.bar.foo'<span></span></pre></td></tr></table></div><p>sets the internal requirements of some code, having a host requirement of <code>anchor apple and identifier com.apple.perl</code> (“I'm a Perl script and I want to be run by Apple's Perl interpreter”) and an explicit designated requirement of <code>anchor /my/root and identifier com.bar.foo</code>. Note that this command sets no guest or library requirements.</p><p>You can also put the requirement set in a file and point to the file:</p><div class="codesample"><table><tr><td scope="row"><pre>    codesign -r myrequirements.rqset<span></span></pre></td></tr></table></div><p>where the file <code>myrequirements.rqset</code> might contain:</p><div class="codesample"><table><tr><td scope="row"><pre>    //internal requirements<span></span></pre></td></tr><tr><td scope="row"><pre>      host => anchor apple and identifier com.apple.perl //require Apple's Perl interpreter<span></span></pre></td></tr><tr><td scope="row"><pre>      designated => anchor /my/root and identifier com.bar.foo<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Procedures/Procedures.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-11-19<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Security/Conceptual/CodeSigningGuide/RequirementLang/RequirementLang.html%3Fid%3DTP40005929-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Security/Conceptual/CodeSigningGuide/RequirementLang/RequirementLang.html%3Fid%3DTP40005929-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Security/Conceptual/CodeSigningGuide/RequirementLang/RequirementLang.html%3Fid%3DTP40005929-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>