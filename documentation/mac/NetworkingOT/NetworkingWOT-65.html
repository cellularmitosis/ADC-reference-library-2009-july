<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Using AppleTalk Service Providers</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING65></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-64.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-66.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-10.html"><B>Part 1 - Open Transport Essentials</B></A><BR><DD><A HREF="NetworkingWOT-63.html"><B>Chapter 14 - AppleTalk Service Providers</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING65-0></A>
<H1><A NAME=MARKER-9-27></A>Using AppleTalk Service Providers</H1>
 <A NAME=MARKER-13-28></A>This section explains how you open an AppleTalk service provider and how you use its functions to obtain<P>
<UL>
<P><LI>the name of the zone for your application's node 
<P><LI>the names of the zones in your local network or AppleTalk internet
<P><LI>information about your current AppleTalk environment<P>
</UL>
 You can use AppleTalk service provider functions to get the name of your node's zone. If you are running on a node that belongs to an extended network, you can call an AppleTalk service provider function to get a list of all the zone names associated with that network. For example, the AppleTalk control panel calls the <CODE>OTATalkGetLocalZones</CODE> function to provide the user with a list of local zones.<P>
 You can also use <A NAME=MARKER-13-29></A>AppleTalk service provider functions in conjunction with mapper functions (described in the chapter "Mappers"<A HREF=NetworkingWOT-36.html#MARKER-9-33></A>. For example, you can use an AppleTalk service provider to look up all the zones on the network, then use the mapper function <A NAME=MARKER-11-55></A><CODE>OTLookUpName</CODE> to look up the names in each zone. <P>
<A NAME=HEADING65-7></A>
<H2><A NAME=MARKER-13-31></A>Creating AppleTalk Service Providers</H2>
 In order to use the zone and network information functions, you must open an AppleTalk service provider. As with other Open Transport providers, you can open these providers synchronously or asynchronously, and in many ways they behave similarly to endpoint and mapper providers. For example, you open an AppleTalk service provider by calling either the <A NAME=MARKER-13-108></A><CODE>OTOpenAppleTalkServices</CODE> function or the <A NAME=MARKER-13-105></A><CODE>OTAsyncOpenAppleTalkServices</CODE> function, both of which return an <A NAME=MARKER-13-34></A>AppleTalk service provider reference to identify the provider you just opened. You use this reference in AppleTalk service provider functions just as you use an endpoint reference in most endpoint provider functions. If you open more than one AppleTalk service provider, the AppleTalk service provider reference lets you to distinguish one provider from another.<P>
 If you open the AppleTalk service provider asynchronously, you need to specify a <A NAME=MARKER-13-35></A>notifier function that the provider can use to send you completion events and other function-specific information. This notifier API is the same as the one you need to use for asynchronous endpoints. <P>
 When you are done using the functions provided by the AppleTalk service provider, you must explicitly close the provider with the generic Open Transport function, <A NAME=MARKER-13-64></A><CODE>OTCloseProvider</CODE>, to release the memory it uses. The <CODE>OTCloseProvider</CODE> function is described in the chapter <A HREF=NetworkingWOT-23.html#MARKER-9-28>"Providers"</A>. <P>
<A NAME=HEADING65-11></A>
<H2><A NAME=MARKER-9-37></A>Working With AppleTalk Zones</H2>
 The NBP name used in the NBP address format has three parts, one of which is the zone name. A <B><A NAME=MARKER-13-38></A>zone</B> is a logical grouping of nodes within an AppleTalk network. You do not specify the zone when you bind an endpoint; you obtain this value from the system. <P>
 Note that the functions, <CODE>OTATalkGetMyZone</CODE>, <CODE>OTATalkGetLocalZones</CODE>, and <CODE>OTATalkGetZoneList</CODE>, return data to you using the <CODE>TNetbuf</CODE> structure. This means that you have to define your buffer size in the <CODE>maxlen</CODE> field of the <CODE>TNetbuf</CODE> structure.<P>
 An AppleTalk zone name is stored as a Pascal string that contains a maximum of 32 characters. When you add a length byte, you have a string that can have a maximum of 33 bytes. You need to calculate the amount of <A NAME=MARKER-13-39></A>buffer space you need based on this maximum string size. <P>
 The <CODE>OTATalkGetMyZone</CODE> function only returns one zone name, so an appropriate buffer size would be 33 bytes. The <CODE>OTATalkGetLocalZones</CODE> function, however, returns all the zone names in an extended network, which can hold up to 254 zones, so a maximum buffer size for this function would be 8382 bytes. Because zone names often use less than 32 characters and AppleTalk service providers don't pad short names, 6 KB is likely to be a safe value for this buffer's size.<P>
 A much larger buffer would be needed for the <CODE>OTATalkGetZoneList</CODE> function, which returns all the zones in all the networks in your AppleTalk internet. You can end up with up to 64 KB of data. To keep the buffer as small and efficient as possible, you can set up a large buffer, test for the <CODE>kOTBufferOverflowErr</CODE> error, and then increase the size of the buffer and reissue the call if this error is returned. <P>
 For more information about using zones in NBP names and addresses, see the chapters <A HREF=NetworkingWOT-57.html#MARKER-9-37>"Introduction to AppleTalk"</A> and <A HREF=NetworkingWOT-60.html#MARKER-9-21>"AppleTalk Addressing"</A>. <A NAME=MARKER-13-40></A><P>
<A NAME=HEADING65-18></A>
<H2><A NAME=MARKER-13-41></A>Getting the Name of an Application's Zone</H2>
 You can get the name of your application's zone by calling the <A NAME=MARKER-13-111></A><CODE>OTATalkGetMyZone</CODE> function. If you call this function asynchronously, the event <A NAME=MARKER-13-2></A><CODE>T_GETMYZONECOMPLETE</CODE> signals the completion of the function, and your notifier's <CODE>cookie</CODE> parameter points to the zone name with the <CODE>zone</CODE> parameter.<P>
 <A HREF=#MARKER-9-46>Listing 14-1</A> shows the synchronous application-defined <A NAME=MARKER-13-44></A><CODE>DoGetMyZone</CODE> function, which opens an AppleTalk service provider and calls the <CODE>OTATalkGetMyZone</CODE> function. Note that the length of the buffer, a <CODE>TNetbuf</CODE> structure, is set to 0. Open Transport adjusts it to the actual length of the zone name when the function returns. Note also that the function adds a <CODE>NULL</CODE> character to the zone name. This is optional, but adding the <CODE>NULL</CODE> character turns the string into a C string and makes it easier to handle if you have further use for this string.<P>
 Another item to note is that the listing uses the recommended configuration string, the constant <A NAME=MARKER-13-100></A><CODE>kDefaultAppleTalkServicesPath</CODE>. Open Transport recommends using this string, not the <CODE>kZIPName</CODE> constant.<P>
<B>Listing 14-1  <A NAME=MARKER-9-46></A>Using the DoGetMyZone function synchronously</B><P>
<PRE>
<A NAME=MARKER-2-47></A>OSStatus DoGetMyZone (char* zoneName)
{
   OSStatus result;
   ATSvcRef svcRef;
   TNetbuf  zoneNetbuf;

   svcRef = OTOpenAppleTalkServices
                  (kDefaultAppleTalkServicesPath, 0, &amp;result);
   if (result == noErr)
   {
      zoneNetbuf.maxlen = 33;
      zoneNetbuf.len = 0;
      zoneNetbuf.buf = zoneName;
      result = OTATalkGetMyZone(svcRef, &amp;zoneNetbuf);
      zoneName[zoneNetBuf.len] = '\0';
      OTCloseProvider(svcRef);
   }
   return result;
}
</PRE>
<A NAME=HEADING65-24></A>
<H2><A NAME=MARKER-13-48></A>Getting a List of Zone Names </H2>
 If you are on an AppleTalk extended network, you can get a list of the names of all the zones in your local network by calling the <A NAME=MARKER-13-115></A><CODE>OTATalkGetLocalZones</CODE> function. If you are on a nonextended network, your network is all on the same zone, and this function returns the name of the zone, which is the same result as you would get from using the <CODE>OTATalkGetMyZone</CODE> function. <P>
 If you call the <CODE>OTATalkGetLocalZones</CODE> function asynchronously, the event <A NAME=MARKER-13-3></A><CODE>T_GETLOCALZONESCOMPLETE</CODE> signals the completion of the function, and your notifier's <CODE>cookie</CODE> parameter points to a list of zone names with the <CODE>zones</CODE> parameter. <P>
 If you are on a network that is part of an AppleTalk internet, you can also use the <A NAME=MARKER-13-118></A><CODE>OTATalkGetZoneList</CODE> function to obtain a list of all the zones in the AppleTalk internet to which your node's network belongs. As with the <CODE>OTATalkGetLocalZones</CODE> function, if you call the <CODE>OTATalkGetZoneList</CODE> function asynchronously, Open Transport sends your notifier a completion event, in this case the <A NAME=MARKER-13-4></A><CODE>T_GETZONELISTCOMPLETE</CODE> event, to signal the completion of the function, and your notifier's <CODE>cookie</CODE> parameter points to a list of zone names with the <CODE>zones</CODE> parameter. <P>
 It is your responsibility to allocate a buffer that is large enough to hold the list of zone names returned. See the section <A HREF=#MARKER-9-37>"Working With AppleTalk Zones"</A> for more information about buffer sizes.<P>
<A NAME=HEADING65-29></A>
<H2><A NAME=MARKER-13-53></A>Getting Information About the Current AppleTalk Environment</H2>
 You can use the function <A NAME=MARKER-13-122></A><CODE>OTATalkGetInfo</CODE> to access an AppleTalk information structure (of type <A NAME=MARKER-14-102></A><CODE>AppleTalkInfo</CODE>) that contains information about the AppleTalk environment for the node on which your application is running. This information can be useful if you are configuring a network or checking that a network has been configured correctly. <P>
 If your application's network is extended or nonextended, this function provides your application's network address and the address of a local router. If your application's network is extended, this function also sets a flag indicating that it's an extended network and provides the current network range for the extended network to which your node belongs. <P>
 In either case, this function can also set two other flags: one that indicates that there is a router on the same network, and one that indicates that the network only has one zone.<P>
 If you call this function synchronously, the AppleTalk service provider uses the <CODE>info</CODE> parameter to provide information about your current network environment. If you call this function asynchronously, the event <A NAME=MARKER-13-5></A><CODE>T_GETATALKINFOCOMPLETE</CODE> signals the completion of the function, and your notifier's <CODE>cookie</CODE> parameter points to the AppleTalk environment information with the <CODE>info</CODE> parameter.<P>
 If the node is <A NAME=MARKER-13-57></A>multihoming--that is, if multiple network numbers and node numbers are associated with the same node--the <CODE>OTATalkGetInfo</CODE> function returns information about the node whose network number and node ID are selected in the AppleTalk control panel. <A NAME=MARKER-13-58></A><A NAME=MARKER-13-59></A><P>
 <P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DT><A HREF="NetworkingWOT-65.html#HEADING65-7">Creating AppleTalk Service Providers</A>
<DD>
<DT><A HREF="NetworkingWOT-65.html#HEADING65-11">Working With AppleTalk Zones</A>
<DD>
<DT><A HREF="NetworkingWOT-65.html#HEADING65-18">Getting the Name of an Application's Zone</A>
<DD>
<DT><A HREF="NetworkingWOT-65.html#HEADING65-24">Getting a List of Zone Names </A>
<DD>
<DT><A HREF="NetworkingWOT-65.html#HEADING65-29">Getting Information About the Current AppleTalk Environment</A>
<DD>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-64.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-66.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
